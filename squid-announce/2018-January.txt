From squid3 at treenet.co.nz  Thu Jan 18 15:16:49 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 19 Jan 2018 04:16:49 +1300
Subject: [squid-announce] RFC: Squid ESI processor changes
Message-ID: <04eefb10-68c8-f24e-f067-34a6df45b181@treenet.co.nz>

The Squid team are planning to remove the Custom XML parser used for ESI 
processing from the next Squid version.

At first this seemed like a simple removal if unused functionality. 
However during review of the changes it turns out this functionality may 
be used in many situations when it should not have been.


Can people using ESI please provide answers for these questions:


What is your setting for esi_parser squid.conf directive?

  a) did not set it
  b) "expat"
  c) "libxml2"
  d) "custom"

If you answered (d), why choose that one?


If you answer (a) does setting it explicitly to either of the other 
parsers cause a large impact on your traffic performance?

   Yes/No

If yes, which did you choose?

  ... and how much of an impact was seen?



If you are not comfortable answering this to the squid-dev mailing list 
please feel free to send your responses directly to me.

Amos Jeffries
The Squid Software Foundation


From squid3 at treenet.co.nz  Sun Jan 21 07:52:07 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 21 Jan 2018 20:52:07 +1300
Subject: [squid-announce] Squid 4.0.23 beta is available
Message-ID: <613605c1-79a3-5a22-9eab-1e0fe62dffaf@treenet.co.nz>

The Squid HTTP Proxy team is very pleased to announce the availability
of the Squid-4.0.23 release!


This release is a security vulnerability and bug fix release resolving
several issues found in the prior Squid releases.


The major changes to be aware of:

* SQUID-2018:1 Denial of Service issue in ESI Response processing.

Squid would crash when receiving certain ESI syntax from its origin 
servers. This is particularly problematic for servers which only deliver 
the relevant syntax on uncommon responses so are not easily detected.

The SSL-Bump feature for HTTPS interception was entangled with 
reverse-proxy processing (and in some cases may still be). Making use of 
the SSL-Bump feature also at risk of encountering the responses from 
servers. Both splice and bump actions are affected.


The fix for Squid-4 is to remove the affected ESI custom parser 
entirely. The use of libxml2 or libexpat is now required for ESI 
support. The default behaviour is to auto-select the most preferred 
library built against.

Installations explicitly choosing "esi_parser custom" in their 
squid.conf will need to change to one of the above mentioned libraries.


Please see the accompanying ADVISORY for details on determining your 
proxy vulnerability and for patches applicable to older versions.


* SQUID-2018:2 Denial of Service issue in HTTP Message processing.

Squid generating ESI sub-requests and requests by the new auto-Download 
feature for intermediary TLS certificates could lead to crashes when 
preparing to log the transaction. This issue can be triggered on demand 
by clients.

Please see the accompanying ADVISORY for details on determining your 
proxy vulnerability and for patches applicable to older versions.


* Bug 4679: User names not sent to url_rewrite_program

This bug appeared as missing user name in url_rewrite_extras parameters 
to the re-writer program when that name was retrieved via an 
authorization mechanism instead of authorization. Specifically IDENT 
protocol or external ACL helpers.


* Bug 4631: security_file_certgen helper without disk cache

This helpers reliance on disk cache management can slow it down on some 
systems which are otherwise able to generate certificates fast. Running 
it purely from memory is now a possibility to avoid these performance 
issues. However, there is no memory cache as yet so this memory-only 
operation requires generating new certificates on every lookup.

Admin encountering significant speed issues with SSL-Bump are encouraged 
to try this helper behaviour. Others


* Nettle v3.4 support

The Nettle library API used by Squid has undergone several updates 
across its 3.3 and 3.4 releases which make recent Squid not able to 
build with these recent libraries.

This Squid now supports the Nettle-3.4 API, with backward compatibility 
provided if older Nettle versions are being used.


* Fix %<Hs, %<pt, %<tt, %<bs calculation bugs for error responses

These logformat macros/codes were not producing accurate outputs in 
certain transactions. Most issues were related to CONNECT tunnel 
transactions, although some issues occurred in other transactions. All 
known issues with these macros/codes are fixed in this Squid release.



  All users of Squid-4.x are urged to upgrade to this release as
soon as possible.

  All users of Squid-3 are encouraged to test this release out and plan
for upgrades where possible.


  See the ChangeLog for the full list of changes in this and earlier
  releases.

Please refer to the release notes at
http://www.squid-cache.org/Versions/v4/RELEASENOTES.html
when you are ready to make the switch to Squid-4

This new release can be downloaded from our HTTP or FTP servers

  http://www.squid-cache.org/Versions/v4/
  ftp://ftp.squid-cache.org/pub/squid/
  ftp://ftp.squid-cache.org/pub/archive/4/

or the mirrors. For a list of mirror sites see

  http://www.squid-cache.org/Download/http-mirrors.html
  http://www.squid-cache.org/Download/mirrors.html

If you encounter any issues with this release please file a bug report.
http://bugs.squid-cache.org/


Amos Jeffries

From squid3 at treenet.co.nz  Sun Jan 21 07:52:24 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 21 Jan 2018 20:52:24 +1300
Subject: [squid-announce] [ADVISORY] SQUID-2018:2 Denial of Service issue in
 HTTP Message processing
Message-ID: <4e307c39-d1c1-eaca-2ce4-96a32892ccd5@treenet.co.nz>

__________________________________________________________________

     Squid Proxy Cache Security Update Advisory SQUID-2018:2
__________________________________________________________________

Advisory ID:        SQUID-2018:2
Date:               Jan 19, 2018
Summary:            Denial of Service issue
                     in HTTP Message processing.
Affected versions:  Squid 3.x -> 3.5.27
                     Squid 4.x -> 4.0.22
Fixed in version:   Squid 4.0.23
__________________________________________________________________

     http://www.squid-cache.org/Advisories/SQUID-2018_2.txt
__________________________________________________________________

Problem Description:

  Due to incorrect pointer handling Squid is vulnerable to denial
  of service attack when processing ESI responses or downloading
  intermediate CA certificates.

__________________________________________________________________

Severity:

  This problem allows a remote client delivering certain HTTP
  requests in conjunction with certain trusted server responses to
  trigger a denial of service for all clients accessing the Squid
  service.

__________________________________________________________________

Updated Packages:

  This bug is fixed by Squid version 4.0.23.

  In addition, patches addressing this problem for the stable
  releases can be found in our patch archives:

Squid 3.5:
  <http://www.squid-cache.org/Versions/v3/3.5/changesets/SQUID-2018_2.patch>

Squid 4:
  <http://www.squid-cache.org/Versions/v4/changesets/SQUID-2018_2.patch>

  If you are using a prepackaged version of Squid then please refer
  to the package vendor for availability information on updated
  packages.

__________________________________________________________________

Determining if your version is vulnerable:

  All Squid configured with "log_uses_indirect_client off" are not
  vulnerable.

  All Squid-3.0 versions built with --enable-esi and being used for
  reverse-proxy with squid.conf containing
  "log_uses_indirect_client on" are vulnerable.

  All Squid-3.1 and later versions up to and including
  Squid-3.5.27 being used for reverse-proxy with squid.conf
  containing "log_uses_indirect_client on" are vulnerable.

  All Squid-4 up to and including Squid-4.0.22 being used for
  reverse-proxy with squid.conf containing
  "log_uses_indirect_client on" are vulnerable.

  All unpatched Squid-4 up to and including Squid-4.0.22 being
  used for TLS/HTTPS intercept proxy with squid.conf containing
  "log_uses_indirect_client on" are vulnerable.

__________________________________________________________________

Workarounds:

  Configure "log_uses_indirect_client off" in squid.conf

__________________________________________________________________

Contact details for the Squid project:

  For installation / upgrade support on binary packaged versions
  of Squid: Your first point of contact should be your binary
  package vendor.

  If your install and build Squid from the original Squid sources
  then the squid-users at lists.squid-cache.org mailing list is your
  primary support point. For subscription details see
  <http://www.squid-cache.org/Support/mailing-lists.html>.

  For reporting of non-security bugs in the latest STABLE release
  the squid bugzilla database should be used
  <http://bugs.squid-cache.org/>.

  For reporting of security sensitive bugs send an email to the
  squid-bugs at lists.squid-cache.org mailing list. It's a closed
  list (though anyone can post) and security related bug reports
  are treated in confidence until the impact has been established.

__________________________________________________________________

Credits:

  The initial issue was reported by Louis Dion-Marcil on behalf of
  GoSecure.

  Fixed by Amos Jeffries from Treehouse Networks Ltd.

__________________________________________________________________

Revision history:

  2017-12-13 20:09:30 UTC Initial Report
  2018-01-18 23:10:00 UTC Patches Released
  2018-01-21 07:45:00 UTC Advisory and fixed packages released
__________________________________________________________________
END

From squid3 at treenet.co.nz  Sun Jan 21 07:52:36 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 21 Jan 2018 20:52:36 +1300
Subject: [squid-announce] [ADVISORY] SQUID-2018:1 Denial of Service issue in
 ESI Response processing
Message-ID: <b04c0b88-9a23-5c07-1f26-55765b38d76b@treenet.co.nz>

__________________________________________________________________

     Squid Proxy Cache Security Update Advisory SQUID-2018:1
__________________________________________________________________

Advisory ID:        SQUID-2018:1
Date:               Jan 19, 2018
Summary:            Denial of Service issue
                     in ESI Response processing.
Affected versions:  Squid 3.x -> 3.5.27
                     Squid 4.x -> 4.0.22
Fixed in version:   Squid 4.0.23
__________________________________________________________________

     http://www.squid-cache.org/Advisories/SQUID-2018_1.txt
__________________________________________________________________

Problem Description:

  Due to incorrect pointer handling Squid is vulnerable to denial
  of service attack when processing ESI responses.

__________________________________________________________________

Severity:

  This problem allows a remote server delivering certain ESI
  response syntax to trigger a denial of service for all clients
  accessing the Squid service.

  This problem is limited to the Squid custom ESI parser.
  Squid built to use libxml2 or libexpat XML parsers do not have
  this problem.

__________________________________________________________________

Updated Packages:

  This bug is fixed by Squid version 4.0.23.

  In addition, patches addressing this problem for the stable
  releases can be found in our patch archives:

Squid 3.5:
  <http://www.squid-cache.org/Versions/v3/3.5/changesets/SQUID-2018_1.patch>

Squid 4:
  <http://www.squid-cache.org/Versions/v4/changesets/SQUID-2018_1.patch>

  If you are using a prepackaged version of Squid then please refer
  to the package vendor for availability information on updated
  packages.

__________________________________________________________________

Determining if your version is vulnerable:

  All Squid-2.x are not vulnerable.

  All Squid built with --disable-esi are not vulnerable.

  All Squid configured with "esi_parser expat" are not vulnerable.

  All Squid configured with "esi_parser libxml2" are not
  vulnerable.

  All Squid-3.0 versions built without --enable-esi are not
  vulnerable.

  All Squid-3.0 versions built with --enable-esi and using
  custom ESI parser for reverse-proxy are vulnerable.

  All Squid-3.1 and later versions up to and including
  Squid-3.5.27 being used for reverse-proxy are vulnerable.

  All Squid-3.1 and later versions up to and including
  Squid-3.5.27 being used for TLS / HTTPS interception are
  vulnerable.

  All unpatched Squid-4 up to and including Squid-4.0.22 being
  used as reverse-proxy are vulnerable.

  All unpatched Squid-4 up to and including Squid-4.0.22 being
  used as TLS/HTTPS intercept proxy are vulnerable.

__________________________________________________________________

Workarounds:

Either;

  Build Squid with --disable-esi

Or,

  Build Squid with "--enable-esi --with-libxml2" and in squid.conf
  configure "esi_parser libxml2"

Or,

  Build Squid with "--enable-esi --with-expat" and in squid.conf
  configure "esi_parser expat"

__________________________________________________________________

Contact details for the Squid project:

  For installation / upgrade support on binary packaged versions
  of Squid: Your first point of contact should be your binary
  package vendor.

  If your install and build Squid from the original Squid sources
  then the squid-users at lists.squid-cache.org mailing list is your
  primary support point. For subscription details see
  <http://www.squid-cache.org/Support/mailing-lists.html>.

  For reporting of non-security bugs in the latest STABLE release
  the squid bugzilla database should be used
  <http://bugs.squid-cache.org/>.

  For reporting of security sensitive bugs send an email to the
  squid-bugs at lists.squid-cache.org mailing list. It's a closed
  list (though anyone can post) and security related bug reports
  are treated in confidence until the impact has been established.

__________________________________________________________________

Credits:

  The initial issue was reported by Louis Dion-Marcil on behalf of
  GoSecure.

  Fixed by Amos Jeffries from Treehouse Networks Ltd.

__________________________________________________________________

Revision history:

  2017-12-13 20:09:30 UTC Initial Report
  2018-01-18 23:10:00 UTC Patches Released
  2018-01-21 07:45:00 UTC Advisory and fixed packages released
__________________________________________________________________
END

