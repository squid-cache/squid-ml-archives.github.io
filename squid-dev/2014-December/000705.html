<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] invalid certificates and spliced connections
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20invalid%20certificates%20and%20spliced%20connections&In-Reply-To=%3C54948493.80802%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="000692.html">
   <LINK REL="Next"  HREF="000808.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] invalid certificates and spliced connections</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20invalid%20certificates%20and%20spliced%20connections&In-Reply-To=%3C54948493.80802%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] invalid certificates and spliced connections">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Dec 19 20:03:31 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="000692.html">[squid-dev] [PATCH] invalid certificates and spliced connections
</A></li>
        <LI>Next message: <A HREF="000808.html">[squid-dev] [PATCH] invalid certificates and spliced connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#705">[ date ]</a>
              <a href="thread.html#705">[ thread ]</a>
              <a href="subject.html#705">[ subject ]</a>
              <a href="author.html#705">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 20/12/2014 7:27 a.m., Tsantilas Christos wrote:


Okay. &quot;transparent&quot; is good there.





A) Consider that CONNECT is always attempted being bumped, but non-TLS
protocols exist within CONNECT.
 Also non-TLS protocols over port 443.
 Also SSL v1 / v2 / v3 over port 443 when the library used by Squid
has all support and knowledge of those protocols removed.

According to at least one user report Skype uses a TLS look-alike
clientHello and something strange as serverHello. So we may not be
able to rely on clientHello to indicate TLS. I dont know for certain
the accuracy of that, you may have observed it or know differently.


B) Remember that TLS is about *security*. In security decision making
you validate strictly and if it fails to pass you abort (fail closed)
quickly with nothing or a code containing as few details as necessary
to be clear something is wrong.


In the (A) vs (B) cases above the errors are all internal to TLS. No
need to get HTTP involved if we can avoid it. If there is a TLS alert
code to signal malformed traffic, use it, otherwise just abort.

Possibly a fast ACL is appropriate:
   ssl_bump_error allow/deny [acls...]

Which is run to make the above decision. ONLY in the event that TLS
protocol syntax errors or malformations.  Not for cert/cipher/option
issues such as bad combinations of valid things, or insecure settings.
 Default action on this *_error directive should be &quot;deny all&quot;.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUlISSAAoJELJo5wb/XPRjmfEIALgYe7YaYQw2pw/EdgSfpjaX
kMEoxEijZQn88+ljTAKOGSJLL8mAdEQufyhgT3qUkWwV7+wcBDp+TfbR4c1Pl+XV
sUBBSIdQ1i7sNLMVE9AVAkK+4DL+O+ifSZdBPRRs8lgobF9xfcTmYzTn5PSh4kIV
yfs+tu4vwPe0JOJ1+31TS67uGti+fGDufkEx68LAImLONqH5FwkgZO+vt3X4q97t
dDq1+rrv2LJBj7eWSBDhlI96zGMeEY/H5z2osyTcoxT98RD/g2aohPpJ4LuBUg2E
bujb3FhwU72U3mgheDTIWn1iig/GBr4CSwXAxvZoCSJS/oMPl5/hAJcWHsYePEU=
=Vg/W
-----END PGP SIGNATURE-----
</PRE>













































































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000692.html">[squid-dev] [PATCH] invalid certificates and spliced connections
</A></li>
	<LI>Next message: <A HREF="000808.html">[squid-dev] [PATCH] invalid certificates and spliced connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#705">[ date ]</a>
              <a href="thread.html#705">[ thread ]</a>
              <a href="subject.html#705">[ subject ]</a>
              <a href="author.html#705">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
