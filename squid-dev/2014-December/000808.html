<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] invalid certificates and spliced connections
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20invalid%20certificates%20and%20spliced%20connections&In-Reply-To=%3C54983794.8070600%40users.sourceforge.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="000705.html">
   <LINK REL="Next"  HREF="000835.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] invalid certificates and spliced connections</H1>
    <B>Tsantilas Christos</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20invalid%20certificates%20and%20spliced%20connections&In-Reply-To=%3C54983794.8070600%40users.sourceforge.net%3E"
       TITLE="[squid-dev] [PATCH] invalid certificates and spliced connections">chtsanti at users.sourceforge.net
       </A><BR>
    <I>Mon Dec 22 15:24:04 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="000705.html">[squid-dev] [PATCH] invalid certificates and spliced connections
</A></li>
        <LI>Next message: <A HREF="000835.html">[squid-dev] [PATCH] invalid certificates and spliced connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#808">[ date ]</a>
              <a href="thread.html#808">[ thread ]</a>
              <a href="subject.html#808">[ subject ]</a>
              <a href="author.html#808">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12/19/2014 10:03 PM, Amos Jeffries wrote:
&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i> Hash: SHA1
</I>&gt;<i> On 20/12/2014 7:27 a.m., Tsantilas Christos wrote:
</I>&gt;<i>
</I>&gt;<i> Okay. &quot;transparent&quot; is good there.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> A) Consider that CONNECT is always attempted being bumped, but non-TLS
</I>&gt;<i> protocols exist within CONNECT.
</I>&gt;<i>   Also non-TLS protocols over port 443.
</I>&gt;<i>   Also SSL v1 / v2 / v3 over port 443 when the library used by Squid
</I>&gt;<i> has all support and knowledge of those protocols removed.
</I>&gt;<i>
</I>&gt;<i> According to at least one user report Skype uses a TLS look-alike
</I>&gt;<i> clientHello and something strange as serverHello. So we may not be
</I>&gt;<i> able to rely on clientHello to indicate TLS. I dont know for certain
</I>&gt;<i> the accuracy of that, you may have observed it or know differently.
</I>
ok.

&gt;<i>
</I>&gt;<i>
</I>&gt;<i> B) Remember that TLS is about *security*. In security decision making
</I>&gt;<i> you validate strictly and if it fails to pass you abort (fail closed)
</I>&gt;<i> quickly with nothing or a code containing as few details as necessary
</I>&gt;<i> to be clear something is wrong.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> In the (A) vs (B) cases above the errors are all internal to TLS. No
</I>&gt;<i> need to get HTTP involved if we can avoid it. If there is a TLS alert
</I>&gt;<i> code to signal malformed traffic, use it, otherwise just abort.
</I>
It is not very easy to correctly handle all of the openSSL error 
messages. My sense is that it will be difficult to maintain it ...


&gt;<i> Possibly a fast ACL is appropriate:
</I>&gt;<i>     ssl_bump_error allow/deny [acls...]
</I>&gt;<i>
</I>&gt;<i> Which is run to make the above decision. ONLY in the event that TLS
</I>&gt;<i> protocol syntax errors or malformations.  Not for cert/cipher/option
</I>&gt;<i> issues such as bad combinations of valid things, or insecure settings.
</I>&gt;<i>   Default action on this *_error directive should be &quot;deny all&quot;.
</I>
I believe it is OK to let this patch as is for now.
This patch will abort imediatelly:
  - If no certificate found and checked using squid ssl verify procedure 
(mostly because the server response was malformed, or unsupported)
  - if a server certificate validation failed

I believe this is handles most of the cases. The cipher or option issues 
may still be ignored, but this errors may caused because of unsupported 
features by openSSL library we are using.
But still we have verify server certificates, and this is should be 
enough for security.


&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>
</PRE>





























































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000705.html">[squid-dev] [PATCH] invalid certificates and spliced connections
</A></li>
	<LI>Next message: <A HREF="000835.html">[squid-dev] [PATCH] invalid certificates and spliced connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#808">[ date ]</a>
              <a href="thread.html#808">[ thread ]</a>
              <a href="subject.html#808">[ subject ]</a>
              <a href="author.html#808">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
