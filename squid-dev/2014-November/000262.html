<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] FYI: the C++11 roadmap
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20FYI%3A%20the%20C%2B%2B11%20roadmap&In-Reply-To=%3C545A5D50.2080508%40urlfilterdb.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="000259.html">
   <LINK REL="Next"  HREF="000265.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] FYI: the C++11 roadmap</H1>
    <B>Marcus Kool</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20FYI%3A%20the%20C%2B%2B11%20roadmap&In-Reply-To=%3C545A5D50.2080508%40urlfilterdb.com%3E"
       TITLE="[squid-dev] FYI: the C++11 roadmap">marcus.kool at urlfilterdb.com
       </A><BR>
    <I>Wed Nov  5 17:24:32 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="000259.html">[squid-dev] FYI: the C++11 roadmap
</A></li>
        <LI>Next message: <A HREF="000265.html">[squid-dev] FYI: the C++11 roadmap
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#262">[ date ]</a>
              <a href="thread.html#262">[ thread ]</a>
              <a href="subject.html#262">[ subject ]</a>
              <a href="author.html#262">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 6/11/2014 1:27 a.m., Marcus Kool wrote:
 &gt;
 &gt;
 &gt; On 11/05/2014 02:01 AM, Amos Jeffries wrote: On 6/05/2014 2:21
 &gt; a.m., Amos Jeffries wrote:
 &gt;&gt;&gt;&gt; I have just announced the change in 3.4.5 regarding C++11
 &gt;&gt;&gt;&gt; support and accompanied it with a notice that GCC verion 4.8
 &gt;&gt;&gt;&gt; is likely to become the minimum version later this calendar
 &gt;&gt;&gt;&gt; year.
 &gt;&gt;&gt;&gt;
 &gt;&gt;&gt;&gt; As it stands (discussed earlier):
 &gt;&gt;&gt;&gt;
 &gt;&gt;&gt;&gt; * Squid-3.4 needs to build with any GCC 4.0+ version with
 &gt;&gt;&gt;&gt; C++03.
 &gt;&gt;&gt;&gt;
 &gt;&gt;&gt;&gt; * Squid-3.6 will need to build with C++11.
 &gt;&gt;&gt;&gt;
 &gt;&gt;&gt;&gt; * The Squid-3.5 situation is still in limbo and will depend
 &gt;&gt;&gt;&gt; on how long we go before it branches.
 &gt;
 &gt; Squid-3.5 retains GCC 4.0+ support shared with older versions.
 &gt;
 &gt;&gt;&gt;&gt;
 &gt;&gt;&gt;&gt; We have a growing list of items needing C++11 features for
 &gt;&gt;&gt;&gt; simpler implementation. At this point I am going to throw a
 &gt;&gt;&gt;&gt; peg out and say Sept or Oct for starting to use C++11
 &gt;&gt;&gt;&gt; specific code features.

&gt;&gt;<i> This &quot;peg&quot; has now moved to Nov. The code cleanup and polishing
</I>&gt;&gt;<i> patches now going into trunk work fine with C++11 builds but
</I>&gt;&gt;<i> possibly not with compilers older than Clang 3.3 or GCC 4.8.
</I>
Are you referring here to building squid 3.5 or 3.6 ?
Do you think that changing to C++11 is ok for both versions?

&gt;&gt;&gt;<i> It is understandable that developers want to move forward.
</I>&gt;&gt;&gt;<i> Almost everybody does. But system administrators tend to do the
</I>&gt;&gt;&gt;<i> opposite: they stay on a stable platform for as long as possible
</I>&gt;&gt;&gt;<i> while they wait for a new platform to mature. Lets look at the
</I>&gt;&gt;&gt;<i> most popular Linux server platform: Redhat 6 / CentOS 6. Redhat 6
</I>&gt;&gt;&gt;<i> has gcc 4.4 while the successor Redhat 7 has gcc 4.8. This means
</I>&gt;&gt;&gt;<i> that when Squid gets a new requirement with gcc 4.8 the new
</I>&gt;&gt;&gt;<i> versions will not run on Redhat 6.
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Because Redhat 6 is the most popular and stable server platform
</I>&gt;&gt;&gt;<i> and Redhat 7 is not mature and does not meet my expectations of a
</I>&gt;&gt;&gt;<i> stable platform (especially systemd is still a big troublemaker),
</I>&gt;&gt;&gt;<i> this implies that choosing for C++11 effectively means that new
</I>&gt;&gt;&gt;<i> releases of Squid will not be installed any longer on the most
</I>&gt;&gt;&gt;<i> popular Linux server platform.
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> So I think my opinion from the point of view of a system
</I>&gt;&gt;&gt;<i> administrator is clearly &quot;choose for installability, choose
</I>&gt;&gt;&gt;<i> C++03&quot;.
</I>&gt;<i>
</I>&gt;<i> &quot;If an admin is so dearly wanting aged-stability. What are they doing
</I>&gt;<i> building the latest Squid release in its youth?&quot;
</I>
Admins do not want &quot;the latest&quot;, they want &quot;the latest proven&quot;.
For me that is 3.4.9 and when 3.5.5 comes out, it is time to evaluate
upgrading.  Depends also on the number and nature of complaints
on the mailing list.

&gt;<i> Seriously though, these are my reasons for the timing:
</I>&gt;<i>
</I>&gt;<i> * Both clang 3.3 and gcc 4.8 were released in early 2013. By the time
</I>&gt;<i> these Squid-3.6 builds get near a beta release these compiler versions
</I>&gt;<i> will already be nearing their 3rd birthdays.
</I>
The man page of gcc 4.8 explains the -std=c11 like this:
ISO C11, the 2011 revision of the ISO C standard.  Support is incomplete and experimental.

The man page of gcc 4.9.1 has a new text:
ISO C11, the 2011 revision of the ISO C standard.  This
standard is substantially completely supported, modulo bugs,
extended identifiers (supported except for corner cases when
-fextended-identifiers is used), floating-point issues (mainly
but not entirely relating to optional C11 features from Annexes
F and G) and the optional Annexes K (Bounds-checking
interfaces) and L (Analyzability).

Not sure if we can rely on man pages; it seems that gcc 4.9 is a safer 'minimal requirement'.

&gt;<i> * Most of C++11'isms expected to be useful are the early &quot;C++0x&quot;
</I>&gt;<i> features (atomics, auto etc.) which are supported by GCC 4.4 from
</I>&gt;<i> RHEL6 anyway. RHEL6 people just need to explicitly pass one of the
</I>&gt;<i> special C++0x flags when building. The reason for naming those
</I>&gt;<i> specific compilers is that they are the first to offer *full* C++11
</I>&gt;<i> support.
</I>&gt;<i>    ** if someone wants to work on auto-detecting RHEL6 / CentOS6.5 and
</I>&gt;<i> auto-enabling that option, great.
</I>&gt;<i>
</I>&gt;<i> * It is growing more and more difficult to prevent useful C++isms
</I>&gt;<i> showing up.
</I>&gt;<i> <A HREF="http://www.squid-cache.org/Versions/v3/3.5/changesets/squid-3-13627.patch">http://www.squid-cache.org/Versions/v3/3.5/changesets/squid-3-13627.patch</A>
</I>&gt;<i> took several days with clean rebuilds to even find out what the
</I>&gt;<i> problem was. Some like auto have now been around in the literature and
</I>&gt;<i> example code for 5+ years.
</I>&gt;<i>
</I>&gt;<i> ...regarding RHEL and CentOS specifically...
</I>&gt;<i>
</I>&gt;<i> * RHEL/CentOS are the only OS family which has this problem. The
</I>&gt;<i> others are all on shorter or simply earlier cycles of turnover and
</I>&gt;<i> will be providing the compilers in their mainstream OS versions by
</I>&gt;<i> about the same time Squid-3.6 goes beta, if not already now.
</I>
Suse 11 SP3 does not have gcc 4.8 either (only 4.7)
Suse 12 is also not mature, so it has the same problem as Redhat 7.

&gt;<i> * If RHEL7 matches the same cycle as 6 and 5 before it did then we can
</I>&gt;<i> expect a RHEL7.1 in a couple of months when todays trunk starts to get
</I>&gt;<i> early adopters, and a RHEL7.2 around the end of next year when todays
</I>&gt;<i> trunk becomes Squid-3.6 beta. 7.4-ish being the popular one approx. 1
</I>&gt;<i> year behind Squid-3.6 going stable. Squid appears to have about a year
</I>&gt;<i> lag in popularity anyway, though Eliezers' packages are helping things
</I>&gt;<i> change a bit there.
</I>
Most likely the systems with Redhat 6 stay on Redhat 6 for 18+ months
before upgrading to Redhat 7.  So until they upgrade, they have gcc 4.4.
Although I have no numbers on installed packages, it is very likely
that Eliezers' packages indeed help.  I bet that if the packages would be
downloadable from squid-cache.org their popularity will increase.

&gt;<i> So now seems about right to introduce C++11.
</I>
I understand.

Marcus

&gt;<i> Amos
</I>&gt;<i> -----BEGIN PGP SIGNATURE-----
</I>&gt;<i> Version: GnuPG v2.0.22 (MingW32)
</I>&gt;<i>
</I>&gt;<i> iQEcBAEBAgAGBQJUWj45AAoJELJo5wb/XPRjcuEH/1pLRCnnEpwJ7igE2+x5rFN9
</I>&gt;<i> 6R/wUbZmnkzlYJnYMgUB1Pu8i9NQbuYWgxMqv0pW+iB6us/Pj3xYawyIZ50aOPkA
</I>&gt;<i> 5f4nD3Bb5X5poGOUqEJ2XwouzoIqIdDeXqAgKFsdpOOKr7aICHxMFMkrzra0RSjd
</I>&gt;<i> jsHEhX41FtNzwvspUpYe+dZIIFiAcfoZesYR2rzry1o/O/WHQhJSeZ1vgbYS/NrC
</I>&gt;<i> ehZ/EdxR0gAEFSMDPIjdUYECyKq8iT6ylmyPtNj8uuaVKlL07IegdznXPKQL0ZFF
</I>&gt;<i> pELQo4IZtglw5A3YaIXaveVh13jfYz1oHZ79Q4R/eOZhWfZuuOH1LCXHQd7YMWw=
</I>&gt;<i> =mCGV
</I>&gt;<i> -----END PGP SIGNATURE-----
</I>&gt;<i>
</I>&gt;<i>
</I></PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000259.html">[squid-dev] FYI: the C++11 roadmap
</A></li>
	<LI>Next message: <A HREF="000265.html">[squid-dev] FYI: the C++11 roadmap
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#262">[ date ]</a>
              <a href="thread.html#262">[ thread ]</a>
              <a href="subject.html#262">[ subject ]</a>
              <a href="author.html#262">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
