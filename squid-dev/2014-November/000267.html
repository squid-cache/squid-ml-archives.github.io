<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] When i redirected to more traffic to squid box for testing goal via web-polygraph . find error info &quot;OS probably ran out of ephemeral ports at 192.168.2.1:0&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20When%20i%20redirected%20to%20more%20traffic%20to%20squid%20box%20for%0A%20testing%20goal%20via%20web-polygraph%20.%20find%20error%20info%20%22OS%20probably%20ran%20out%20of%0A%20ephemeral%20ports%20at%20192.168.2.1%3A0%22&In-Reply-To=%3C545B250F.6030901%40yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="000309.html">
   <LINK REL="Next"  HREF="000293.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] When i redirected to more traffic to squid box for testing goal via web-polygraph . find error info &quot;OS probably ran out of ephemeral ports at 192.168.2.1:0&quot;</H1>
    <B>johnzeng</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20When%20i%20redirected%20to%20more%20traffic%20to%20squid%20box%20for%0A%20testing%20goal%20via%20web-polygraph%20.%20find%20error%20info%20%22OS%20probably%20ran%20out%20of%0A%20ephemeral%20ports%20at%20192.168.2.1%3A0%22&In-Reply-To=%3C545B250F.6030901%40yahoo.com%3E"
       TITLE="[squid-dev] When i redirected to more traffic to squid box for testing goal via web-polygraph . find error info &quot;OS probably ran out of ephemeral ports at 192.168.2.1:0&quot;">johnzeng2013 at yahoo.com
       </A><BR>
    <I>Thu Nov  6 07:36:47 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="000309.html">[squid-dev] FYI: the C++11 roadmap
</A></li>
        <LI>Next message: <A HREF="000293.html">[squid-dev] When i redirected to more traffic to squid box for testing goal via web-polygraph . find error info &quot;OS probably ran out of ephemeral ports at 192.168.2.1:0&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#267">[ date ]</a>
              <a href="thread.html#267">[ thread ]</a>
              <a href="subject.html#267">[ subject ]</a>
              <a href="author.html#267">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hello :

i meet a problem , When i redirected to more traffic to squid box for
testing goal via web-polygraph .

squidbox ip is 192.168.2.2 web-polygraph_box ip is 192.168.2.3

/polygraph-client --config
/accerater/testtool/share/polygraph/workloads/simple.pg --proxy
192.168.2.2:80 --verb_lvl 10

./polygraph-server --config
/accerater/testtool/share/polygraph/workloads/simple.pg --verb_lvl 10

When testing traffic is 1500request/sec , i found more error info ,

but my os setting is net.ipv4.ip_local_port_range = 1024 65535
open files (-n) 65536
max user processes (-u) 10000
/proc/sys/fs/file-max 6815744


and i found these error info still , how will i do ? if possible , give
me some help or advisement please .

******************************
error info
******************************

EphPortMgr.cc:23: error: 34920/69877 (s98) Address already in use
005.28| OS probably ran out of ephemeral ports at 192.168.2.3:0
005.28| Client.cc:347: error: 34920/69878 (c63) failed to establish a
connection
005.28| 192.168.2.3 failed to connect to 192.168.2.2:80
005.31| i-dflt 104811 0.00 -1 -1.00 3904 32336
005.59| PolyApp.cc:189: error: 39/75599 (c58) internal timers may be
getting beh

005.90| EphPortMgr.cc:23: error: 64/129 (s98) Address already in use
005.90| OS probably ran out of ephemeral ports at 192.168.2.1:0
005.90| Client.cc:347: error: 64/130 (c63) failed to establish a connection
005.90| 192.168.2.1 failed to connect to 192.168.2.2:80
005.90| PolyApp.cc:189: error: 4/180 (c58) internal timers may be
getting behind
005.90| record level of timing drift: 179msec; last check was 3msec ago
005.90| EphPortMgr.cc:23: error: 128/260 (s98) Address already in use
005.90| OS probably ran out of ephemeral ports at 192.168.2.1:0
005.90| Client.cc:347: error: 128/261 (c63) failed to establish a connection
005.90| 192.168.2.1 failed to connect to 192.168.2.2:80
005.91| PolyApp.cc:189: error: 8/460 (c58) internal timers may be
getting behind
005.91| record level of timing drift: 383msec; last check was 3msec ago









***********************************
Web-polygraph configration
***********************************


Content SimpleContent = {
size = exp(13KB); // response sizes distributed exponentially
cachable = 80%; // 20% of content is uncachable
};

// a primitive server cleverly labeled &quot;S101&quot;
// normally, you would specify more properties,
// but we will mostly rely on defaults for now
Server S = {
kind = &quot;S101&quot;;
contents = [ SimpleContent ];
direct_access = contents;

addresses = ['192.168.2.1:9090']; // where to create these server agents
};

// a primitive robot
Robot R = {
kind = &quot;R101&quot;;
pop_model = { pop_distr = popUnif(); };
recurrence = 55% / SimpleContent.cachable; // adjusted to get 55% DHR
req_rate = 1600/sec;


origins = S.addresses; // where the origin servers are
addresses = ['192.168.2.1']; // where these robot agents will be created
};




**************************************
sysctl.conf
**************************************


fs.file-max = 6815744
fs.aio-max-nr = 1048576
kernel.shmmax = 4294967295
kernel.threads-max = 212992
kernel.sem = 250 256000 100 1024
net.core.rmem_max=5165824
net.core.wmem_max=262144
net.ipv4.tcp_rmem=5165824 5165824 5165824
net.ipv4.tcp_wmem=262144 262144 262144
net.core.rmem_default = 5165824
net.core.wmem_default = 262144
net.core.optmem_max = 25165824
net.ipv4.ip_local_port_range = 1024 65535
net.nf_conntrack_max = 6553600
net.netfilter.nf_conntrack_tcp_timeout_established = 1200


net.ipv4.tcp_tw_recycle = 1
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_fin_timeout = 10
net.ipv4.tcp_orphan_retries = 3
net.ipv4.tcp_retries2 = 5
net.ipv4.tcp_keepalive_intvl = 15
net.ipv4.tcp_syn_retries = 5
net.ipv4.tcp_synack_retries = 2
net.ipv4.tcp_keepalive_time = 1800
net.core.netdev_max_backlog = 3000000
net.ipv4.tcp_max_syn_backlog = 262144000
net.ipv4.tcp_max_tw_buckets = 500000000
net.core.somaxconn = 262144000
net.ipv4.tcp_sack = 1
net.ipv4.tcp_fack = 1

net.ipv4.tcp_timestamps = 0
net.ipv4.tcp_window_scaling = 1
net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_no_metrics_save=1
net.ipv4.tcp_max_orphans = 26214400
net.ipv4.tcp_synack_retries = 2
net.ipv4.tcp_low_latency = 1
net.ipv4.tcp_rfc1337 = 1

</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000309.html">[squid-dev] FYI: the C++11 roadmap
</A></li>
	<LI>Next message: <A HREF="000293.html">[squid-dev] When i redirected to more traffic to squid box for testing goal via web-polygraph . find error info &quot;OS probably ran out of ephemeral ports at 192.168.2.1:0&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#267">[ date ]</a>
              <a href="thread.html#267">[ thread ]</a>
              <a href="subject.html#267">[ subject ]</a>
              <a href="author.html#267">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
