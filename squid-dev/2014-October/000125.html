<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] How to run the unit tests of Squid?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20How%20to%20run%20the%20unit%20tests%20of%20Squid%3F&In-Reply-To=%3C543CFA6B.6010201%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="000122.html">
   <LINK REL="Next"  HREF="000127.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] How to run the unit tests of Squid?</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20How%20to%20run%20the%20unit%20tests%20of%20Squid%3F&In-Reply-To=%3C543CFA6B.6010201%40treenet.co.nz%3E"
       TITLE="[squid-dev] How to run the unit tests of Squid?">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Oct 14 10:26:51 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="000122.html">[squid-dev] How to run the unit tests of Squid?
</A></li>
        <LI>Next message: <A HREF="000127.html">[squid-dev] Build failed in Jenkins: 3.HEAD-amd64-centos-7-clang #58
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#125">[ date ]</a>
              <a href="thread.html#125">[ thread ]</a>
              <a href="subject.html#125">[ subject ]</a>
              <a href="author.html#125">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 14/10/2014 8:40 p.m., Tianyin Xu wrote:
&gt;<i> Thanks, Amos!
</I>&gt;<i> 
</I>&gt;<i> One more question. I see test-builds.sh tries to run the tests in
</I>&gt;<i> the &quot;test-suites&quot; at the top directory. What's the difference
</I>&gt;<i> between the test under &quot;src/tests&quot; and &quot;test-suites&quot;?
</I>&gt;<i> 
</I>&gt;<i> I'm a little bit confused since you said the tests in &quot;src/tests&quot;
</I>&gt;<i> contains all the unit tests.
</I>&gt;<i> 
</I>&gt;<i> Also, I can successfully ran make check. But when I checked out the
</I>&gt;<i> trunk and ran ./test-builds.sh at the top directory, many tests
</I>&gt;<i> fail. Is this normal? (sorry I actually do not understand what
</I>&gt;<i> &quot;test-suites&quot; does)
</I>
That depends on how complete your build environment is. The script
begins with testing ./bootstrap.sh to ensure the toolchain is complete
and working. Recent autoconf produce a lot of warnings about
subdir-objects feature, but should still finish saying &quot;success&quot;.
 If it does not then the error it exits with should explain what needs
to be resolved, usually some portion of the autotools build
environment is outdated or missing.

For the later &quot;layers&quot; being tested (eg the ESI layer) there are some
additional libraries needed to be installed which are optional for
normal users.

You *need* this script to run to completion with no errors on the
current 3.HEAD code for it to be worth going any further into the testing.

So, what OS are you building on?
 and what are the specific error(s) the script is failing with?

&gt;<i> 
</I>&gt;<i> Oh, I forget to mention the web page I referred to. Actually I'm
</I>&gt;<i> referring to the &quot;tasks needing a volunteer&quot; in the following wiki
</I>&gt;<i> page, <A HREF="http://wiki.squid-cache.org/Features/CodeTestBed">http://wiki.squid-cache.org/Features/CodeTestBed</A> Are these
</I>&gt;<i> tasks still alive? Since I'm looking at the tests, I think I can 
</I>&gt;<i> give a hand.
</I>
Aha. Wonderful thank you. In that case I better explain in a bit more
detail than just how to use them. :-)

src/tests/ content is the main code for what the wiki page Details
section refer to as &quot;ad-hoc CPP Unit-tests&quot;. Other unit-tests also
exist elsewhere in the sources (eg pre-compiler unit tests in compat/).

Each of those src/tests/test*.cc is a test of a single &quot;unit&quot; (aka.
C++ class). &quot;make check&quot; turns it into a binary that is supposed to
exhaustively test what happens when any permutation of input is
presented to the class API/methods, including edge cases and soemtimes
wrong inputs.

Unit-tests like that can only test one way of compiling the code at a
time. Which is fine for validating that some pre-built binary will
work as intended. But fails miserably to validate source code for
software like Squid with many possible features built (or not) by users.

That is where the ./test-builds.sh script comes in. (See under
&quot;Component Test Controls&quot;.) It runs the unit tests with different
permutations of ./configure settings.

It also runs some large scale tests, such as squid.conf parsing for
various known squid.conf contents which have or might cause trouble,
or the bootstrap to check the build chain is operational.

Ideally both unit-test and the ./configure tests would be exhaustive
and cover every bit of code at least once. That is a very long way off
still, and may actually never happen. But that is the goal.


So, yes the items in both &quot;Tasks needing a volunteer:&quot; lists still
need doing.

 The work is being coordinated in wiki page
&lt;<A HREF="http://wiki.squid-cache.org/Features/SourceLayout">http://wiki.squid-cache.org/Features/SourceLayout</A>&gt;. The main table
first column indicates whether the new polished convenience libraries
have unit-tests for the classes inside.
 That column content is outdated, in fact many of those classes do
have unit-tests but nobody has audited to check if they are complete
and correct for the current API. So part of the needed work is
correcting that column entries.

 There is another item related to the testing which is not documented
there. That is the compiler build options which are available to
detect potential issues. Squid is only able to build cleanly with a
small set at present, additional work is needed to try building with
others and fix the issues they highlight.


I hope that is clear enough to understand. I am assuming you at least
know the basics of what testing is all about.


PS. since 3.5 is now in beta I will this week be auditing the
./configure tests options are up to date. That may affect the test
coverage and results somewhat in the coming days.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUPPpqAAoJELJo5wb/XPRjKhEH/1QjhBXv6n3MM+EhduJ5q5NP
vKYzNTrg71vkoCcZ/7VoTTp5NXCdS9D4mg5cfaZtjHYU5HhZJqaJ3sxp3iuRE8Sh
EWHEIUWPu3+95PAdnnB4FAzEcwrDZoTvbMc7P7Mo+/vKQp3ljfA2x+uYLUZjtucV
h/N5W96ZfAWqYFdHUeZFh0xJ6+bNtsV1ndjlnSddPfMFfCCZIzEk/+QQacuZm9d7
aS7lO8Ig7IlZ+v6FJglWbVt7PGEnvQclS/J9hH6lQqV5bwQPnGZiS4zsLm2MFfPK
vMIRngmKrAw6vDrdCpuEXHjFBxosaGdLHTvrwwMMTFTMbFo0fRN9lcFJiZ7qI+g=
=zK+F
-----END PGP SIGNATURE-----
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000122.html">[squid-dev] How to run the unit tests of Squid?
</A></li>
	<LI>Next message: <A HREF="000127.html">[squid-dev] Build failed in Jenkins: 3.HEAD-amd64-centos-7-clang #58
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#125">[ date ]</a>
              <a href="thread.html#125">[ thread ]</a>
              <a href="subject.html#125">[ subject ]</a>
              <a href="author.html#125">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
