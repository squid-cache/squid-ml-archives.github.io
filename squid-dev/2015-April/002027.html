<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] splicing resumed sessions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20splicing%20resumed%20sessions&In-Reply-To=%3C55265A11.6040100%40users.sourceforge.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="002022.html">
   <LINK REL="Next"  HREF="002029.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] splicing resumed sessions</H1>
    <B>Tsantilas Christos</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20splicing%20resumed%20sessions&In-Reply-To=%3C55265A11.6040100%40users.sourceforge.net%3E"
       TITLE="[squid-dev] [PATCH] splicing resumed sessions">chtsanti at users.sourceforge.net
       </A><BR>
    <I>Thu Apr  9 10:53:05 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="002022.html">[squid-dev] [PATCH] splicing resumed sessions
</A></li>
        <LI>Next message: <A HREF="002029.html">[squid-dev] [PATCH] splicing resumed sessions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2027">[ date ]</a>
              <a href="thread.html#2027">[ thread ]</a>
              <a href="subject.html#2027">[ subject ]</a>
              <a href="author.html#2027">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>A new version of the patch.

This is removes the ssl_bump_resuming_sessions directive, includes many 
fixes over the previous patch.
Also include support for NPN and ALPN tls extensions, required to 
correctly bump SSL connections.
Please read carefully the patch preamble , specially the technical note 
part.

The resumed sessions and the NPN/ALPN extensions problem appeared in 
squid after our decision to not allow splicing of connections for which 
we do not have access on the server certificates. The resumed sessions 
does not include server certificates, and the NPN/ALPN extensions causes 
openSSL to abort before retrieve and verify server certificates.

The problem affects the ssl bumping and make it unusable for many cases. 
Many of the problems which reported by the users for squid-3.5 should be 
related to this.
So probably this patch should applied to squid-3.5 too. If yes I will 
post the patch for squid-3.5 too.

Regards,
    Christos



On 03/17/2015 07:21 PM, Tsantilas Christos wrote:
&gt;<i> This patch adds the &quot;ssl_bump_resuming_sessions&quot; directive that controls
</I>&gt;<i> SslBump behavior when dealing with &quot;resuming SSL/TLS sessions&quot;. Without
</I>&gt;<i> these changes, SslBump usually terminates all resuming sessions with an
</I>&gt;<i> error because such sessions do not include server certificates,
</I>&gt;<i> preventing Squid from successfully validating the server identity.
</I>&gt;<i>
</I>&gt;<i> After these changes, Squid either terminates or splices resuming
</I>&gt;<i> sessions, depending on configuration. Splicing is the right default
</I>&gt;<i> because Squid most likely has spliced the original connections that the
</I>&gt;<i> client and server are trying to resume now.  Most likely, the splicing
</I>&gt;<i> decision would not change now (but the lack of the server certificate
</I>&gt;<i> information means we cannot repeat the original ACL checks and need a
</I>&gt;<i> special directive to tell Squid what to do). Also, without SslBump,
</I>&gt;<i> session resumption would just work, and SslBump default should approach
</I>&gt;<i> that ideal.
</I>&gt;<i>
</I>&gt;<i> In many deployment scenarios, this straightforward &quot;splice or terminate
</I>&gt;<i> resuming sessions&quot; implementation is exactly what the admin wants.
</I>&gt;<i> Future projects may add more complex algorithms, including maintaining
</I>&gt;<i> an SMP-shared cache of sessions that may be resumed in the future and
</I>&gt;<i> evaluating client/server attempts to resume a session using that cache.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Example:
</I>&gt;<i>    # splice all resuming sessions [this is the default]
</I>&gt;<i>    ssl_bump_resuming_sessions allow all
</I>&gt;<i>
</I>&gt;<i> This patch also makes SSL client Hello message parsing more robust and
</I>&gt;<i> adds an SSL server Hello message parser.
</I>&gt;<i>
</I>&gt;<i> This patch also prevents occasional segfaults when dealing with SSL
</I>&gt;<i> cache_peer negotiation failures.
</I>&gt;<i>
</I>&gt;<i> The last two changes should applied to squid-3.5 even if this patch will
</I>&gt;<i> not go into squid-3.5.
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>     Christos
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
A non-text attachment was scrubbed...
Name: SQUID-14-splicing-resumed-sessions-t11.patch
Type: text/x-patch
Size: 56965 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20150409/002d04d1/attachment-0001.bin">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20150409/002d04d1/attachment-0001.bin</A>&gt;
</PRE>
































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002022.html">[squid-dev] [PATCH] splicing resumed sessions
</A></li>
	<LI>Next message: <A HREF="002029.html">[squid-dev] [PATCH] splicing resumed sessions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2027">[ date ]</a>
              <a href="thread.html#2027">[ thread ]</a>
              <a href="subject.html#2027">[ subject ]</a>
              <a href="author.html#2027">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
