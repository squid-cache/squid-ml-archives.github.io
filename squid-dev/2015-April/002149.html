<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] squid tcp_outgoing_address feature not working
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20squid%20tcp_outgoing_address%20feature%20not%20working&In-Reply-To=%3C552E3919.2080604%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="002148.html">
   <LINK REL="Next"  HREF="002150.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] squid tcp_outgoing_address feature not working</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20squid%20tcp_outgoing_address%20feature%20not%20working&In-Reply-To=%3C552E3919.2080604%40treenet.co.nz%3E"
       TITLE="[squid-dev] squid tcp_outgoing_address feature not working">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Apr 15 10:10:33 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="002148.html">[squid-dev] squid tcp_outgoing_address feature not working
</A></li>
        <LI>Next message: <A HREF="002150.html">[squid-dev] Basic tests results for the proxy protocol with	squid.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2149">[ date ]</a>
              <a href="thread.html#2149">[ thread ]</a>
              <a href="subject.html#2149">[ subject ]</a>
              <a href="author.html#2149">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 15/04/2015 9:16 p.m., naishal0748 wrote:&gt;
&gt;<i> I have setup squid transparent proxy with following configurations in
</I>centos
&gt;<i> 6.2 :
</I>&gt;<i>
</I>&gt;<i> eth0 - LAN Network
</I>&gt;<i> eth1 - WAN1 - IP - 192.168.3.15 - Gateway IP - 192.168.3.1
</I>&gt;<i> eth2 - WAN2 - IP - 192.168.5.15 - Gateway IP - 192.168.5.1 (Default
</I>Gateway)
&gt;<i>
</I>&gt;<i> I want to route 10.2.0.0/16 traffic to WAN1
</I>&gt;<i>
</I>&gt;<i> I have used my squid.conf file to mention that as below
</I>&gt;<i>
</I>&gt;<i> acl localnet src 10.2.0.0/16
</I>&gt;<i>
</I>&gt;<i> tcp_outgoing_address 192.168.3.15 localnet
</I>&gt;<i>
</I>&gt;<i> But all the traffic is going through eth2 only. I want all the traffic
</I>to go
&gt;<i> through eth1 based on my source address.
</I>
Welcome to the world of application layer gateways.

There is no guarantee that IPv4 is being used outbound. You may in fact
be using IPv6 to contact servers.
 All that means is that you need to set a WAN1 IPv6 address in a second
tcp_outgoing_address line for the IPv6.


Also be aware the selection of NIC is entirely up to the kernel routing
logics. Older Linux were well-known for their annoying ability to accept
or send from any NIC using any IP assigned to the machine, depending on
whether you had some voodoo setup in the routing config or not. CentOS
uses ancient enough kernels that it probably does not have the bug fixes
for that.

So, double check that Squid is actually sending from 192.168.3.15 like
you expect. If not we can help you a little further to figure out why
and see if that fixes things for you.


One other effect I've seen in action is that NAT on outbound can take
Squids tcp_outgoing_address and change it so the packets go out the
wrong NIC with different IP entirely.


Otherwise its a kernel routing problem, and we probably cant help with that.

&gt;<i>
</I>&gt;<i> I have already setup routing on my linux server for eth1 and eth2.
</I>&gt;<i>
</I>&gt;<i> Someone please help.
</I>
NP: Please use squid-users for this type of help query in future.

Amos

</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002148.html">[squid-dev] squid tcp_outgoing_address feature not working
</A></li>
	<LI>Next message: <A HREF="002150.html">[squid-dev] Basic tests results for the proxy protocol with	squid.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2149">[ date ]</a>
              <a href="thread.html#2149">[ thread ]</a>
              <a href="subject.html#2149">[ subject ]</a>
              <a href="author.html#2149">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
