<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [RFC] removal of SSL version options
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20removal%20of%20SSL%20version%20options&In-Reply-To=%3C552FCF93.5080806%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="002167.html">
   <LINK REL="Next"  HREF="002155.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [RFC] removal of SSL version options</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20removal%20of%20SSL%20version%20options&In-Reply-To=%3C552FCF93.5080806%40measurement-factory.com%3E"
       TITLE="[squid-dev] [RFC] removal of SSL version options">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Apr 16 15:04:51 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="002167.html">[squid-dev] [RFC] removal of SSL version options
</A></li>
        <LI>Next message: <A HREF="002155.html">[squid-dev] Build failed in Jenkins: trunk-matrix » clang,d-ubuntu-trusty #169
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2173">[ date ]</a>
              <a href="thread.html#2173">[ thread ]</a>
              <a href="subject.html#2173">[ subject ]</a>
              <a href="author.html#2173">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 04/16/2015 12:45 AM, Amos Jeffries wrote:
&gt;<i> On 16/04/2015 5:35 p.m., Alex Rousskov wrote:
</I>&gt;&gt;<i> On 04/15/2015 06:17 AM, Amos Jeffries wrote:
</I>&gt;&gt;&gt;<i> Squid currently has several &quot;version&quot; options to set the SSL/TLS
</I>&gt;&gt;&gt;<i> protocol version.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>   http(s)_port ... version=
</I>&gt;&gt;&gt;<i>   cache_peer ... sslversion
</I>&gt;&gt;&gt;<i>   sslproxy_version ...
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> However,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 1) the option configures version X-only. Which does not follow with
</I>&gt;&gt;&gt;<i> current best practice of most other TLS enabled software offering a
</I>&gt;&gt;&gt;<i> minimum-version option for compliance with TLS version auto-upgrade
</I>&gt;&gt;&gt;<i> mechanisms.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> This can result in Squid installations being stuck unnecessarily on
</I>&gt;&gt;&gt;<i> outdated protocol versions with insecure ciphers.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 2) these options overlap with the related ssloptions= values.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> These can easily be configured to conflict. Such as version setting
</I>&gt;&gt;&gt;<i> TLSv1.0-only and ssl-options enabling other versions with v1.0
</I>&gt;&gt;&gt;<i> forbidden. The order of security context setup prevents this being a
</I>&gt;&gt;&gt;<i> major problem, but it can result in security doing things the admin does
</I>&gt;&gt;&gt;<i> not exactly expect.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 3) the http(s)_port option is also easily confused with protocol= since
</I>&gt;&gt;&gt;<i> it lacks a &quot;ssl&quot; prefix seen elsewhere.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I would like to eventually move towards having a TLS minimum-version
</I>&gt;&gt;&gt;<i> parameter like other software. Which means we at least need to begin
</I>&gt;&gt;&gt;<i> clearing up this problem ASAP.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Given that the ssloptions= parameters can be used to reach the same
</I>&gt;&gt;&gt;<i> configuration I propose that we simply remove the current sslversion
</I>&gt;&gt;&gt;<i> options.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Opinions?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I agree that having both ssloptions and sslversion is wrong when both
</I>&gt;&gt;<i> can restrict SSL versions. However, I am pretty sure there are cases
</I>&gt;&gt;<i> where the admin needs to restrict SSL version to be &quot;exactly X&quot; rather
</I>&gt;&gt;<i> than &quot;X or later&quot;. Removing an existing interface that supports such
</I>&gt;&gt;<i> &quot;exactly X&quot; configurations seems wrong to me. If you remove sslversion,
</I>&gt;&gt;<i> can you add ONLY_SSLv3, ONLY_TLSv1, etc. values to the remaining ssloptions?
</I>&gt;<i> 
</I>&gt;<i> ssloptions already supports enumerating the protocols one does not want
</I>&gt;<i> to support.
</I>
Which is different than enumerating the protocols one wants to support
when the set of possible protocols is a moving target.


&gt;<i> sslversion=1  ==  ssloptions=
</I>&gt;<i> sslversion=3  ==  ssloptions=NO_TLSv1,NO_TLSv1_1,NO_TLSv1_2
</I>&gt;<i> sslversion=4  ==  ssloptions=NO_SSLv3,NO_TLSv1_1,NO_TLSv1_2
</I>&gt;<i> sslversion=5  ==  ssloptions=NO_SSLv3,NO_TLSv1,NO_TLSv1_2
</I>&gt;<i> sslversion=6  ==  ssloptions=NO_SSLv3,NO_TLSv1,NO_TLSv1_1
</I>

The above does not look equivalent to me when TLS v1.3 appears. As you
said, we should care about old configurations that get &quot;stuck&quot; with the
now-wrong set of options. When the admin wants Squid to use X (e.g.,
because the peer requires X), they should be able to say so and not
depend on any new versions added to OpenSSL.


&gt;&gt;<i> Alternatively, instead of removing sslversion, consider obsoleting
</I>&gt;&gt;<i> NO_SSL* and NO_TLS* options in ssloptions while adding support for a
</I>&gt;&gt;<i> more flexible sslversion configuration:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     cache_peer ... sslversion=TLSv1.0+ # TLSv1.0 or later
</I>&gt;&gt;<i>     cache_peer ... sslversion=TLSv1.1  # exactly TLSv1.1
</I>&gt;&gt;<i>     cache_peer ... sslversion=TLSv1.0,TLSv1.0 # TLSv1.0 or 1.1
</I>&gt;&gt;<i>     ...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This will allow admins to configure &quot;minimum-version&quot; (in most cases)
</I>&gt;&gt;<i> without losing the ability to restrict versions to a specific subset (in
</I>&gt;&gt;<i> special cases).
</I>&gt;<i> 
</I>&gt;<i> This is similar to what I was wanting to move towards. If you think I
</I>&gt;<i> should compress the timeline and go straight to this I can:
</I>&gt;<i> 
</I>&gt;<i>    cache_peer ... tls-version=1.0+ # TLSv1.0 or later
</I>&gt;<i>    cache_peer ... tls-version=1.1  # exactly TLSv1.1 (warn risky, etc)
</I>
If you deprecate the old sslversion values, do not drop SSL support, and
allow versions enumeration (assuming it is useful, see below), sure! If
you prefer to do two configuration changes instead of one, please
explain why you think those two changes would be better than their
cumulative result.



&gt;<i> Your third example *version=N,M conflicts with the specifications. 
</I>
[ Real-world often conflicts with specifications. As you probably know,
I think we ought to support real-world requirements rather than
specification recommendations when the two are in conflict. Everybody
should support your persistent efforts to make Squid compliant with
currently popular specifications (and follow new terminology), but not
at the expense of real-world compatibility (and admin convenience). ]

If you are sure that nobody needs version=N,M support or that OpenSSL
does not support such configurations, then do not add it. Avoid it not
[just] because some specification told you so, but because it is useless!


Cheers,

Alex.

</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002167.html">[squid-dev] [RFC] removal of SSL version options
</A></li>
	<LI>Next message: <A HREF="002155.html">[squid-dev] Build failed in Jenkins: trunk-matrix » clang,d-ubuntu-trusty #169
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2173">[ date ]</a>
              <a href="thread.html#2173">[ thread ]</a>
              <a href="subject.html#2173">[ subject ]</a>
              <a href="author.html#2173">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
