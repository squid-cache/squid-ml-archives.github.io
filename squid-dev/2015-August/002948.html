<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Reject responses with conflicting Content-Length
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Reject%20responses%20with%20conflicting%20Content-Length&In-Reply-To=%3C55C51AFF.80708%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="002947.html">
   <LINK REL="Next"  HREF="002950.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Reject responses with conflicting Content-Length</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Reject%20responses%20with%20conflicting%20Content-Length&In-Reply-To=%3C55C51AFF.80708%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] Reject responses with conflicting Content-Length">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Aug  7 20:54:23 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="002947.html">[squid-dev] Jenkins build is back to normal : trunk-polygraph #805
</A></li>
        <LI>Next message: <A HREF="002950.html">[squid-dev] [PATCH] Reject responses with conflicting Content-Length
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2948">[ date ]</a>
              <a href="thread.html#2948">[ thread ]</a>
              <a href="subject.html#2948">[ subject ]</a>
              <a href="author.html#2948">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

    Squid trusts and forwards the largest Content-Length header. This
behavior violates an RFC 7230 MUST in Section 3.3.3 item #4. It also
confuses some ICAP services and probably some HTTP clients. With the
proposed changes, Squid refuses to forward the message to the ICAP
service and HTTP client, responding with an HTTP 502 error instead.

This is a quick-and-dirty implementation. A polished version should
reject responses with invalid Content-Length values as well (per RFC
7230 MUST), should return 502 even with a strict parser (this is not a
header parsing issue), and should probably not warn the admin when all
values actually match.

I am not volunteering to provide a more polished version at this time,
but the proposed changes solve a known problem and are a step in the
right direction towards better Content-Length processing.


HTH,

Alex.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SQUID-98-reject-multi-cont-len-resp-t4.patch
Type: text/x-diff
Size: 17073 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20150807/a7109e87/attachment.patch">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20150807/a7109e87/attachment.patch</A>&gt;
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002947.html">[squid-dev] Jenkins build is back to normal : trunk-polygraph #805
</A></li>
	<LI>Next message: <A HREF="002950.html">[squid-dev] [PATCH] Reject responses with conflicting Content-Length
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2948">[ date ]</a>
              <a href="thread.html#2948">[ thread ]</a>
              <a href="subject.html#2948">[ subject ]</a>
              <a href="author.html#2948">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
