<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] squid SSL subsystem did not initialized	correctly
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20squid%20SSL%20subsystem%20did%20not%20initialized%0A%09correctly&In-Reply-To=%3C55C88B24.5060608%40users.sourceforge.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="002939.html">
   <LINK REL="Next"  HREF="002959.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] squid SSL subsystem did not initialized	correctly</H1>
    <B>Tsantilas Christos</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20squid%20SSL%20subsystem%20did%20not%20initialized%0A%09correctly&In-Reply-To=%3C55C88B24.5060608%40users.sourceforge.net%3E"
       TITLE="[squid-dev] [PATCH] squid SSL subsystem did not initialized	correctly">chtsanti at users.sourceforge.net
       </A><BR>
    <I>Mon Aug 10 11:29:40 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="002939.html">[squid-dev] [PATCH] squid SSL subsystem did not initialized correctly
</A></li>
        <LI>Next message: <A HREF="002959.html">[squid-dev] [PATCH] squid SSL subsystem did not initialized correctly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2958">[ date ]</a>
              <a href="thread.html#2958">[ thread ]</a>
              <a href="subject.html#2958">[ subject ]</a>
              <a href="author.html#2958">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 08/06/2015 02:55 PM, Amos Jeffries wrote:
&gt;<i> On 6/08/2015 9:54 p.m., Tsantilas Christos wrote:
</I>&gt;&gt;<i> Hi all,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     Currently SSL subsystem did not initialized correctly in squid trunk.
</I>&gt;&gt;<i> This is because of the Security::ProxyOutgoingConfig.encryptTransport
</I>&gt;&gt;<i> which is always false so the client SSL CTX object never builds. As a
</I>&gt;&gt;<i> result squid may not start if SSL is configured. I am attaching a small
</I>&gt;&gt;<i> patch I am using in my squid trees to work with SSL.
</I>&gt;<i>
</I>&gt;<i> This always-enabled code is not compatible with the possible admin
</I>&gt;<i> configuration:
</I>&gt;<i>
</I>&gt;<i>   tls_outgoing_options disable
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Can you please try this instead:
</I>&gt;<i>
</I>&gt;<i>   Security::PeerOptions::parse(const char *token)
</I>&gt;<i>   {
</I>&gt;<i>       if (strncmp(token, &quot;disable&quot;, 7) == 0) {
</I>&gt;<i>           clear();
</I>&gt;<i> +        return;
</I>&gt;<i>       } else if (strncmp(token, &quot;cert=&quot;, 5) == 0) {
</I>&gt;<i> ...
</I>&gt;<i>       } else {
</I>&gt;<i>           debugs(3, DBG_CRITICAL, &quot;ERROR: Unknown TLS option '&quot; &lt;&lt; ...
</I>&gt;<i> +        return;
</I>&gt;<i>       }
</I>&gt;<i> +
</I>&gt;<i> +    encryptTransport = true;
</I>&gt;<i>   }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> If that works you can go through and also remove uses of
</I>&gt;<i> &quot;secure.encryptTransport = true&quot; from adaptation/ServiceConfig.cc and
</I>&gt;<i> cache_cf.cc where it is set next to a call to secure.parse()
</I>&gt;<i> ... but not the other one where it is set to always-on for https_port.
</I>
This is will not work, because it is not required for someone to 
configure any of the sslproxy options for the SSL client to work.
Squid can always work with the default options.

The Security::ProxyOutgoingConfig.encryptTransport = true must be always 
true unless the the SSL client is disabled.

In previous squid releases it was not possible to disable SSL client, 
but now looks that this is can be done using the
   &quot;tls_outgoing_options disable&quot;

Maybe we need to add a parameter to Security::PeerOptions constructor, 
to define if the SSL is enabled by default (for example in the case of 
ProxyOutgoingConfig) or not (for example in HTTP ports configuration).


&gt;<i>
</I>&gt;<i> If the final result still works, please commit.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002939.html">[squid-dev] [PATCH] squid SSL subsystem did not initialized correctly
</A></li>
	<LI>Next message: <A HREF="002959.html">[squid-dev] [PATCH] squid SSL subsystem did not initialized correctly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2958">[ date ]</a>
              <a href="thread.html#2958">[ thread ]</a>
              <a href="subject.html#2958">[ subject ]</a>
              <a href="author.html#2958">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
