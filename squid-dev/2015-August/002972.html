<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] squid-3.5.6 -- debug missing? and a few others?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20squid-3.5.6%20--%20debug%20missing%3F%20and%20a%20few%20others%3F&In-Reply-To=%3C55C95BDC.3010809%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="002968.html">
   <LINK REL="Next"  HREF="002988.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] squid-3.5.6 -- debug missing? and a few others?</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20squid-3.5.6%20--%20debug%20missing%3F%20and%20a%20few%20others%3F&In-Reply-To=%3C55C95BDC.3010809%40treenet.co.nz%3E"
       TITLE="[squid-dev] squid-3.5.6 -- debug missing? and a few others?">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Aug 11 02:20:12 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="002968.html">[squid-dev] squid-3.5.6  -- debug missing? and a few others?
</A></li>
        <LI>Next message: <A HREF="002988.html">[squid-dev] squid-3.5.7 -- xstrerror missing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2972">[ date ]</a>
              <a href="thread.html#2972">[ thread ]</a>
              <a href="subject.html#2972">[ subject ]</a>
              <a href="author.html#2972">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Linda W,

  I see &quot;ltrans0&quot; in your debug trace. Is this the issue you mentioned
in squid-users earlier and followed up by saying was fixed?


On 11/08/2015 10:04 a.m., Linda A. Walsh wrote:
&gt;<i> I hope this is the right place to send Q's on building squid --
</I>&gt;<i> it seems like it's a source issue and not a squid configuration
</I>&gt;<i> issue.   BTW, just for clarity.  I also tried turning off all
</I>&gt;<i> of the compiler optimization options and just using
</I>&gt;<i> &quot;CFLAGS=&quot;-O2 -m64 -march=native -fpie -pipe&quot; -- but that made
</I>&gt;<i> no difference.  If I should send this to the user list, let me
</I>&gt;<i> know... all forward it there, but it doesn't seem the Q's on there
</I>&gt;<i> have so much to do with build issues.
</I>
CFLAGS is only used by some third-party libraries.
Squid-3 uses CXXFLAGS.

Link issues can be related to --disable-inline and -O usage. Usually
appearing at lower levels of inline optimization.


&gt;<i> 
</I>&gt;<i> Sorry to bother you guys, but am having problems building squid unless I
</I>&gt;<i> disable all 'auth' (then it builds)...  At this point -- I get a couple
</I>&gt;<i> of errors:
</I>&gt;<i> 
</I>&gt;<i> I can see where there are references and a definition in
</I>&gt;<i> compat/debug.{h,cc}.  Looks like something pulled in the
</I>&gt;<i> compat/debug.h header, but the compat/debug.cc module isn't getting
</I>&gt;<i> bound in.. (and of course there are symbols missing
</I>&gt;<i> as well.  This look like it is creating a library (libtool) --
</I>&gt;<i> wouldn't that imply all the symbols do not have to be present, as it
</I>&gt;<i> isn't a final link?
</I>
No this is the libtool compiler using g++ to do final linkage for the
basic_ldap_auth helper. The filename after the &quot;-o&quot; in the line.


&gt;<i> 
</I>&gt;<i> What am I missing?
</I>&gt;<i> 
</I>&gt;<i> options to configure:
</I>&gt;<i> 
</I>&gt;<i> --prefix=/ --bindir=/usr/sbin --datadir=/usr/share/squid
</I>&gt;<i> --datarootdir=/usr/share --libexecdir=/usr/sbin
</I>&gt;<i> --sharedstatedir=/var/squid --sysconfdir=/etc/squid --enable-build-info
</I>
--enable-build-info requires a string parameter which will be embeded in
the squid -v output. Helping you identify who built it or any special
patching done.


&gt;<i> --enable-cachemgr-hostname
</I>
--enable-cachemgr-hostname requires a string parameter for the FQDN the
cachemgr.cgi will attempt to connect to by default.

&gt;<i> --enable-disk-io
</I>
--enable-disk-io requires a list of the Disk I/O modules to be built.
Absence of any module names means synchronous Blocking I/O will be used
by Squid. (VERY slow Squid)


&gt;<i> --enable-eui --enable-htcp
</I>&gt;<i> --enable-icmp --enable-kill-parent-hack --enable-linux-netfilter
</I>&gt;<i> --enable-ltdl-install
</I>
--enable-ltdl-install may affect your system provided LTDL library. That
is probably not a good thing as all other LTDL programs are using it.
Squid bundles with the latest LTDL from Debian.


&gt;<i> --enable-referer-log
</I>
referer-log is no longer a Squid build option. If you need, it is now a
built-in logformat.


&gt;<i> --enable-removal-policies=lru
</I>&gt;<i> --enable-heap --enable-stacktraces --enable-auth-basic
</I>&gt;<i> --enable-auth-negotiate --enable-auth-ntml
</I>
--enable-auth-* without parameters is the default. It means all
available helpers will be auto-detected and used if their dependencies
are present. I dont see digest listed here, which means its on.

So all these --enable-auth-* options are equivalent to the simpler
--enable-auth



&gt;<i> --enable-external-acl-helpers
</I>&gt;<i> --enable-storeio
</I>
--enable-storeio requires a list of the cache_dir modules to be built.
Absence of any module names means only UFS will be usable by Squid.

&gt;<i> --enable-useragent-log
</I>
useragent-log is no longer a Squid build option. If you need, it is now
a built-in logformat.

&gt;<i> --enable-xmalloc-statistics
</I>&gt;<i> --enable-x-accelerator-vary 
</I>
x-accelerator-vary is VERY rarely necessary. HTTP/1.1 now supports the
Vary: header as part of HTTP protocol.


&gt;<i> --enable-zph-qos --enable-wccp
</I>&gt;<i> --enable-wccpv2 --disable-ecap --disable-icap-client
</I>&gt;<i> --disable-storeid_rewrite
</I>
--disable-storeid-rewrite (note the _ / - change).

&gt;<i> --disable-static
</I>
Mumble. Probably not a good idea unless you know very well how static vs
dynamic library linking works. Particularly in relation to the LTDL
situation.


&gt;<i> --disable-auto-locale
</I>&gt;<i> --disable-ident-lookups --disable-ipv6 --disable-snmp
</I>&gt;<i> --disable-translation --disable-static
</I>
duplicate --disable-static

&gt;<i> --with-aufs-threads=72
</I>&gt;<i> --with-logdir=/var/log/squid --with-mandir=/usr/share/man
</I>&gt;<i> --with-pidfile=/run/squid.pid --with-default-user=squid
</I>&gt;<i> --with-large-files --with-included-ltdl
</I>
--with-included-ltdl see above about --disable-static and
--enable-ltdl-install.

&gt;<i> --with-openssl
</I>&gt;<i> 
</I>

I dont see anywhere on this list:
 --disable-inline        to prevent inline optimizations
 --disable-optimizations to prevent compiler -O levels
 --disable-arch-native   to prevent -march=native auto-detection

You said you disabled them ?


&gt;<i> 
</I>&gt;<i> libtool: link: g++ -Wall -Wpointer-arith -Wwrite-strings -Wcomments
</I>&gt;<i> -Wshadow -Werror -pipe -D_REENTRANT -m64 -DOPENSSL_LOAD_CONF
</I>&gt;<i> -I/usr/include/p11-kit-1 -O2 -m64 -fasynchronous-unwind-tables
</I>&gt;<i> -fbranch-target-load-optimize -fdelete-null-pointer-checks
</I>&gt;<i> -fgcse-after-reload -fgcse-las -fgcse-sm -fgraphite-identity
</I>&gt;<i> -finline-functions -fipa-pta -fivopts -floop-block -floop-flatten
</I>&gt;<i> -floop-interchange -floop-strip-mine -flto -fmessage-length=0
</I>&gt;<i> -fpredictive-commoning -frename-registers -freorder-blocks-and-partition
</I>&gt;<i> -ftracer -fsched-stalled-insns=1 -fsched-stalled-insns-dep=1
</I>&gt;<i> -ftree-loop-linear -ftree-loop-distribution
</I>&gt;<i> -ftree-loop-distribute-patterns -ftree-loop-im -ftree-loop-ivcanon
</I>&gt;<i> -ftree-vectorize -ftree-slp-vectorize -funswitch-loops -funwind-tables
</I>&gt;<i> -fvariable-expansion-in-unroller -fvect-cost-model -fweb -fwhole-program
</I>&gt;<i> -march=native -fpie -pipe -march=native -std=c++11 -m64 -flto=6 -fpie
</I>&gt;<i> -fuse-linker-plugin -o basic_ldap_auth basic_ldap_auth.o 
</I>&gt;<i> ../../../lib/.libs/libmiscencoding.a
</I>&gt;<i> ../../../compat/.libs/libcompat-squid.a -lldap -llber
</I>
&gt;<i> /tmp/ccfruVCQ.ltrans0.ltrans.o: In function `checkLDAP(ldap*, char
</I>&gt;<i> const*, char const*, char const*, int)':
</I>&gt;<i> ccfruVCQ.ltrans0.o:(.text+0x30d): undefined reference to `debug_enabled'
</I>&gt;<i> ccfruVCQ.ltrans0.o:(.text+0x469): undefined reference to `debug_enabled'
</I>&gt;<i> ccfruVCQ.ltrans0.o:(.text+0x5ea): undefined reference to `debug_enabled'
</I>&gt;<i> ccfruVCQ.ltrans0.o:(.text+0x69d): undefined reference to `debug_enabled'
</I>&gt;<i> ccfruVCQ.ltrans0.o:(.text+0x7c0): undefined reference to `debug_enabled'
</I>&gt;<i> /tmp/ccfruVCQ.ltrans0.ltrans.o:ccfruVCQ.ltrans0.o:(.text+0x8fc): more
</I>&gt;<i> undefined references to `debug_enabled' follow
</I>&gt;<i> /tmp/ccfruVCQ.ltrans0.ltrans.o: In function `main':
</I>&gt;<i> ccfruVCQ.ltrans0.o:(.text.startup+0x14a): undefined reference to `xstrdup'
</I>&gt;<i> ccfruVCQ.ltrans0.o:(.text.startup+0x1e0): undefined reference to
</I>&gt;<i> `debug_enabled'
</I>&gt;<i> ccfruVCQ.ltrans0.o:(.text.startup+0x9e4): undefined reference to `xstrdup'
</I>&gt;<i> ccfruVCQ.ltrans0.o:(.text.startup+0xa28): undefined reference to `xstrdup'
</I>&gt;<i> ../../../lib/.libs/libmiscencoding.a(rfc1738.o): In function `xfree':
</I>&gt;<i> rfc1738.c:(.text+0x1b): undefined reference to `free_const'
</I>&gt;<i> ../../../lib/.libs/libmiscencoding.a(rfc1738.o): In function
</I>&gt;<i> `rfc1738_do_escape':
</I>&gt;<i> rfc1738.c:(.text+0xa2): undefined reference to `xcalloc'
</I>&gt;<i> collect2: error: ld returned 1 exit status
</I>
All of these missing symbols are provided by the libcompat-squid library
in the Squid compat/ directory.

The ltrans thing seems to be just a temporary file used by the compiler
toolchain during the build.

If you are building in side /tmp it is a bad idea. The system requires
that it or any operating program can erase things in there without
notice at any time it wants more space. You should create another
directory somewhere else to build in.

For example my test builds go something like this:

 gunzip squid-3.5.6.tar.gz &amp;&amp;
  tar -xvf squid-3.5.6.tar &amp;&amp;
  mkdir squid-3.5.6/_build &amp;&amp;
  cd squid-3.5.6/_build &amp;&amp;
  ../configure ...blah blah blah...  &amp;&amp;
  make check &amp;&amp; make install



If none of the above helps, then
 what OS are you building on?
 with what GCC / autoconf / automake / libtool / ltdl versions ?

Amos

</PRE>





































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002968.html">[squid-dev] squid-3.5.6  -- debug missing? and a few others?
</A></li>
	<LI>Next message: <A HREF="002988.html">[squid-dev] squid-3.5.7 -- xstrerror missing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2972">[ date ]</a>
              <a href="thread.html#2972">[ thread ]</a>
              <a href="subject.html#2972">[ subject ]</a>
              <a href="author.html#2972">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
