<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] squid-3.5.7 -- xstrerror missing
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20squid-3.5.7%20--%20xstrerror%20missing&In-Reply-To=%3C55CA7E2A.40209%40tlinx.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="002972.html">
   <LINK REL="Next"  HREF="002989.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] squid-3.5.7 -- xstrerror missing</H1>
    <B>Linda A. Walsh</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20squid-3.5.7%20--%20xstrerror%20missing&In-Reply-To=%3C55CA7E2A.40209%40tlinx.org%3E"
       TITLE="[squid-dev] squid-3.5.7 -- xstrerror missing">squid-user at tlinx.org
       </A><BR>
    <I>Tue Aug 11 22:58:50 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="002972.html">[squid-dev] squid-3.5.6 -- debug missing? and a few others?
</A></li>
        <LI>Next message: <A HREF="002989.html">[squid-dev] squid-3.5.7 -- xstrerror missing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2988">[ date ]</a>
              <a href="thread.html#2988">[ thread ]</a>
              <a href="subject.html#2988">[ subject ]</a>
              <a href="author.html#2988">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Amos Jeffries wrote:
&gt;<i> Hi Linda W,
</I>&gt;<i>
</I>&gt;<i>   I see &quot;ltrans0&quot; in your debug trace. Is this the issue you mentioned
</I>&gt;<i> in squid-users earlier and followed up by saying was fixed?
</I>&gt;<i>   
</I>----
Well, I thought it was --- I've been busy trying multiple things since
I wrote the original.


&gt;<i>
</I>&gt;<i> On 11/08/2015 10:04 a.m., Linda A. Walsh wrote:
</I>&gt;<i>   
</I>&gt;&gt;<i> I hope this is the right place to send Q's on building squid --
</I>&gt;&gt;<i> it seems like it's a source issue and not a squid configuration
</I>&gt;&gt;<i> issue.   BTW, just for clarity.  I also tried turning off all
</I>&gt;&gt;<i> of the compiler optimization options and just using
</I>&gt;&gt;<i> &quot;CFLAGS=&quot;-O2 -m64 -march=native -fpie -pipe&quot; -- but that made
</I>&gt;&gt;<i> no difference.  If I should send this to the user list, let me
</I>&gt;&gt;<i> know... all forward it there, but it doesn't seem the Q's on there
</I>&gt;&gt;<i> have so much to do with build issues.
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> CFLAGS is only used by some third-party libraries.
</I>&gt;<i> Squid-3 uses CXXFLAGS.
</I>&gt;<i>   
</I>----
    A generic script I use to run configure's set CFLAGS and usually
CXXFLAGS=CFLAGS+ c++ specific flags ...

I'm not disabling inline that I know of. 
&gt;<i>
</I>&gt;<i> No this is the libtool compiler using g++ to do final linkage for the
</I>&gt;<i> basic_ldap_auth helper. The filename after the &quot;-o&quot; in the line.
</I>&gt;<i>
</I>&gt;<i>   
</I>&gt;<i> --enable-build-info requires a string parameter which will be embeded in
</I>&gt;<i> the squid -v output. Helping you identify who built it or any special
</I>&gt;<i> patching done.
</I>&gt;<i>   
</I>---
       Oh... in 'perl' and the kernel, the build options are included
automatically -- they don't trust a user-supplied string.  ;-)....


&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> --enable-cachemgr-hostname
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> --enable-cachemgr-hostname requires a string parameter for the FQDN the
</I>&gt;<i> cachemgr.cgi will attempt to connect to by default.
</I>&gt;<i>   
</I>----
    Again, thought that was filled in from the FQDN of the build host
(if not supplied), on assumption this would run on the buildhost....  I'll
just toss it as well...

&gt;<i>   
</I>&gt;&gt;<i> --enable-disk-io
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> --enable-disk-io requires a list of the Disk I/O modules to be built.
</I>&gt;<i> Absence of any module names means synchronous Blocking I/O will be used
</I>&gt;<i> by Squid. (VERY slow Squid)
</I>&gt;<i>   
</I>-----
    I  think that is where I am stuck now... --- currently options look 
like:

array with=( 
            aufs-threads=$async_io_threads
            default-user=$user
            dl
            filedescriptors=2048
            gnu-ld
            logdir=/var/log/$pkg                   
            mandir=/usr/share/man        pidfile=/run/$pkg.pid
            large-files included-ltdl openssl    )   


array enable=(
            disk-io=&quot;DiskThreads,AIO,Blocking,IpcIo,Mmapped&quot;
            eui htcp     icmp
            kill-parent-hack   
            linux-netfilter   
            ltdl-install     
            removal-policies=&quot;heap,lru&quot;
            auth
            log-daemon-helpers=&quot;file&quot;
            silent-rules
            stacktraces
            storeio=&quot;aufs,ufs&quot;
            useragent-log wccp wccpv2
            xmalloc-statistics x-accelerator-vary zph-qos )


array disable=( ecap        icap-client        storeid_rewrite
            auth-basic auth-ntlm auth-negotiate auth-digest 
url-rewrite-helpers
            external-acl-helpers
            storeid-rewrite-helpers
            auto-locale ident-lookups ipv6     translation )

array  without=()
---------------------

As you can see I filled in the diskio --- I had it filled in on last
build -- but left it empty this time to try to see if any other modules 
built --
thinking that if I didn't specify the modules the default was to try to 
build
all of them.???  Seems that's a minor inconsistency in the build script?



&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> --enable-eui --enable-htcp
</I>&gt;&gt;<i> --enable-icmp --enable-kill-parent-hack --enable-linux-netfilter
</I>&gt;&gt;<i> --enable-ltdl-install
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> --enable-ltdl-install may affect your system provided LTDL library. That
</I>&gt;<i> is probably not a good thing as all other LTDL programs are using it.
</I>&gt;<i> Squid bundles with the latest LTDL from Debian.
</I>&gt;<i>   
</I>----
    been using ltdl w/other builds, so by default, I throw it in here...

&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> --enable-referer-log
</I>&gt;&gt;<i>     
</I>----
    Figured that one out --  I started with a build-script from a
few versions ago -- and have worked on updating that to the new options.

&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> --enable-removal-policies=lru
</I>&gt;&gt;<i> --enable-heap --enable-stacktraces --enable-auth-basic
</I>&gt;&gt;<i> --enable-auth-negotiate --enable-auth-ntml
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> --enable-auth-* without parameters is the default. It means all
</I>&gt;<i> available helpers will be auto-detected and used if their dependencies
</I>&gt;<i> are present. I dont see digest listed here, which means its on.
</I>&gt;<i>   
</I>I think all of them are in the disable category (above), now...
&gt;<i> So all these --enable-auth-* options are equivalent to the simpler
</I>&gt;<i> --enable-auth
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> --enable-external-acl-helpers
</I>&gt;&gt;<i> --enable-storeio
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> --enable-storeio requires a list of the cache_dir modules to be built.
</I>&gt;<i> Absence of any module names means only UFS will be usable by Squid.
</I>&gt;<i>   
</I>--- just the opposite of auth...
I think some of these have changed defaults since I last built them --
i.e. thought most of them were to try to build any that it could. *sigh*...
&gt;<i>   
</I>&gt;&gt;<i> --enable-useragent-log
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> useragent-log is no longer a Squid build option. If you need, it is now
</I>&gt;<i> a built-in logformat.
</I>&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> --enable-xmalloc-statistics
</I>&gt;&gt;<i> --enable-x-accelerator-vary 
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> x-accelerator-vary is VERY rarely necessary. HTTP/1.1 now supports the
</I>&gt;<i> Vary: header as part of HTTP protocol.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> --enable-zph-qos --enable-wccp
</I>&gt;&gt;<i> --enable-wccpv2 --disable-ecap --disable-icap-client
</I>&gt;&gt;<i> --disable-storeid_rewrite
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> --disable-storeid-rewrite (note the _ / - change).
</I>&gt;<i>   
</I>----
must have caught that, don't see it in my ops now...

&gt;<i>   
</I>&gt;&gt;<i> --disable-static
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> Mumble. Probably not a good idea unless you know very well how static vs
</I>&gt;<i> dynamic library linking works. Particularly in relation to the LTDL
</I>&gt;<i> situation.
</I>&gt;<i>   
</I>----
I &quot;undisabled&quot; it -- but in the past, static builds haven't been an option
on suse as they generally didn't provide the static libs...they are starting
to... so I re-enabled it..
&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> --disable-auto-locale
</I>&gt;&gt;<i> --disable-ident-lookups --disable-ipv6 --disable-snmp
</I>&gt;&gt;<i> --disable-translation --disable-static
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> duplicate --disable-static
</I>&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> --with-aufs-threads=72
</I>&gt;&gt;<i> --with-logdir=/var/log/squid --with-mandir=/usr/share/man
</I>&gt;&gt;<i> --with-pidfile=/run/squid.pid --with-default-user=squid
</I>&gt;&gt;<i> --with-large-files --with-included-ltdl
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> --with-included-ltdl see above about --disable-static and
</I>&gt;<i> --enable-ltdl-install.
</I>&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> --with-openssl
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I dont see anywhere on this list:
</I>&gt;<i>  --disable-inline        to prevent inline optimizations
</I>&gt;<i>  --disable-optimizations to prevent compiler -O levels
</I>&gt;<i>  --disable-arch-native   to prevent -march=native auto-detection
</I>&gt;<i>
</I>&gt;<i> You said you disabled them ?  
</I>&gt;<i>   
</I>I did?....I don't think so...

&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> libtool: link: g++ -Wall -Wpointer-arith -Wwrite-strings -Wcomments
</I>&gt;&gt;<i> -Wshadow -Werror -pipe -D_REENTRANT -m64 -DOPENSSL_LOAD_CONF
</I>&gt;&gt;<i> -I/usr/include/p11-kit-1 -O2 -m64 -fasynchronous-unwind-tables
</I>&gt;&gt;<i> -fbranch-target-load-optimize -fdelete-null-pointer-checks
</I>&gt;&gt;<i> -fgcse-after-reload -fgcse-las -fgcse-sm -fgraphite-identity
</I>&gt;&gt;<i> -finline-functions -fipa-pta -fivopts -floop-block -floop-flatten
</I>&gt;&gt;<i> -floop-interchange -floop-strip-mine -flto -fmessage-length=0
</I>&gt;&gt;<i> -fpredictive-commoning -frename-registers -freorder-blocks-and-partition
</I>&gt;&gt;<i> -ftracer -fsched-stalled-insns=1 -fsched-stalled-insns-dep=1
</I>&gt;&gt;<i> -ftree-loop-linear -ftree-loop-distribution
</I>&gt;&gt;<i> -ftree-loop-distribute-patterns -ftree-loop-im -ftree-loop-ivcanon
</I>&gt;&gt;<i> -ftree-vectorize -ftree-slp-vectorize -funswitch-loops -funwind-tables
</I>&gt;&gt;<i> -fvariable-expansion-in-unroller -fvect-cost-model -fweb -fwhole-program
</I>&gt;&gt;<i> -march=native -fpie -pipe -march=native -std=c++11 -m64 -flto=6 -fpie
</I>&gt;&gt;<i> -fuse-linker-plugin -o basic_ldap_auth basic_ldap_auth.o 
</I>&gt;&gt;<i> ../../../lib/.libs/libmiscencoding.a
</I>&gt;&gt;<i> ../../../compat/.libs/libcompat-squid.a -lldap -llber
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> /tmp/ccfruVCQ.ltrans0.ltrans.o: In function `checkLDAP(ldap*, char
</I>&gt;&gt;<i> const*, char const*, char const*, int)':
</I>&gt;&gt;<i> ccfruVCQ.ltrans0.o:(.text+0x30d): undefined reference to `debug_enabled'
</I>&gt;&gt;<i> ccfruVCQ.ltrans0.o:(.text+0x469): undefined reference to `debug_enabled'
</I>&gt;&gt;<i> ccfruVCQ.ltrans0.o:(.text+0x5ea): undefined reference to `debug_enabled'
</I>&gt;&gt;<i> ccfruVCQ.ltrans0.o:(.text+0x69d): undefined reference to `debug_enabled'
</I>&gt;&gt;<i> ccfruVCQ.ltrans0.o:(.text+0x7c0): undefined reference to `debug_enabled'
</I>&gt;&gt;<i> /tmp/ccfruVCQ.ltrans0.ltrans.o:ccfruVCQ.ltrans0.o:(.text+0x8fc): more
</I>&gt;&gt;<i> undefined references to `debug_enabled' follow
</I>&gt;&gt;<i> /tmp/ccfruVCQ.ltrans0.ltrans.o: In function `main':
</I>&gt;&gt;<i> ccfruVCQ.ltrans0.o:(.text.startup+0x14a): undefined reference to `xstrdup'
</I>&gt;&gt;<i> ccfruVCQ.ltrans0.o:(.text.startup+0x1e0): undefined reference to
</I>&gt;&gt;<i> `debug_enabled'
</I>&gt;&gt;<i> ccfruVCQ.ltrans0.o:(.text.startup+0x9e4): undefined reference to `xstrdup'
</I>&gt;&gt;<i> ccfruVCQ.ltrans0.o:(.text.startup+0xa28): undefined reference to `xstrdup'
</I>&gt;&gt;<i> ../../../lib/.libs/libmiscencoding.a(rfc1738.o): In function `xfree':
</I>&gt;&gt;<i> rfc1738.c:(.text+0x1b): undefined reference to `free_const'
</I>&gt;&gt;<i> ../../../lib/.libs/libmiscencoding.a(rfc1738.o): In function
</I>&gt;&gt;<i> `rfc1738_do_escape':
</I>&gt;&gt;<i> rfc1738.c:(.text+0xa2): undefined reference to `xcalloc'
</I>&gt;&gt;<i> collect2: error: ld returned 1 exit status
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i> All of these missing symbols are provided by the libcompat-squid library
</I>&gt;<i> in the Squid compat/ directory.
</I>&gt;<i>   
</I>--- yeah have seen them there,... not sure why they aren't building in.
&gt;<i> If you are building in side /tmp it is a bad idea.
</I>----
Not building in tmp --- /home/tools/squid/squid-Version -- I think the
compiler was using tmp?

latest error is on xstrerr:
le'
  CXX      log_file_daemon.o
  CXXLD    log_file_daemon
/tmp/cc1skyFO.ltrans0.ltrans.o: In function `rotate':
/home/tools/squid/squid-3.5.7/helpers/log_daemon/file/log_file_daemon.cc:62: 
undefined reference to `xstrerr(int)'
/home/tools/squid/squid-3.5.7/helpers/log_daemon/file/log_file_daemon.cc:73: 
undefined reference to `xstrerr(int)'
/tmp/cc1skyFO.ltrans0.ltrans.o: In function `main':
/home/tools/squid/squid-3.5.7/helpers/log_daemon/file/log_file_daemon.cc:127: 
undefined reference to `xstrerr(int)'
collect2: error: ld returned 1 exit status
make[3]: *** [log_file_daemon] Error 1
make[3]: Leaving directory 
`/home/tools/squid/squid-3.5.7/helpers/log_daemon/file'
make[2]: *** [all-recursive] Error 1
make[2]: Leaving directory 
`/home/tools/squid/squid-3.5.7/helpers/log_daemon'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `/home/tools/squid/squid-3.5.7/helpers'
make: *** [all-recursive] Error 1

which seems to be a wrapper for the strerror (convert errno to a string)
as some systems return NULL on a not-found error ... so why would
the logdaemon not bring in the compat options it needs?


&gt;<i> If none of the above helps, then
</I>&gt;<i>  what OS are you building on?
</I>&gt;<i>  with what GCC / autoconf / automake / libtool / ltdl versions ?
</I>&gt;<i>   
</I>----
    suse 13.1/2 (upgrading... )
gcc 4.9
autoconf (GNU Autoconf) 2.69
automake (GNU automake) 1.13.4
libtool in /usr/bin is 2.4.2, but one keeps appearing in the build dir.
(which is the same version...hmmm).

&gt;<i>  for f in /usr/lib64/libltdl*; do echo &quot;$(rpm -qf &quot;$f&quot;): $f&quot;;done
</I>libtool-2.4.2-15.2.2.x86_64: /usr/lib64/libltdl.a
libtool-2.4.2-15.2.2.x86_64: /usr/lib64/libltdl.la
libtool-2.4.2-15.2.2.x86_64: /usr/lib64/libltdl.so
libltdl3-1.5.26-27.1.2.x86_64: /usr/lib64/libltdl.so.3
libltdl3-1.5.26-27.1.2.x86_64: /usr/lib64/libltdl.so.3.1.6
libltdl7-2.4.2-15.2.2.x86_64: /usr/lib64/libltdl.so.7
libltdl7-2.4.2-15.2.2.x86_64: /usr/lib64/libltdl.so.7.3.0

---
looks like 2 versions are dl'd 3 and 7 -- had both of them on there
before, and in installing the rpms -- they don't conflict, so
I assumed the compilers chose one or the other based on something
I didn't know about.

So what should be pulling in the compat modules that I'm not getting
(was just about to put in a copy of the xstrerror from compat
into the disk module...)..... I try alot of non-standard things
sometimes to figure out problems (most don't work out, but it's
better than twiddling my thumbs -- usually)..;-)



thx,
linda
&gt;<i>   
</I></PRE>


























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002972.html">[squid-dev] squid-3.5.6 -- debug missing? and a few others?
</A></li>
	<LI>Next message: <A HREF="002989.html">[squid-dev] squid-3.5.7 -- xstrerror missing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2988">[ date ]</a>
              <a href="thread.html#2988">[ thread ]</a>
              <a href="subject.html#2988">[ subject ]</a>
              <a href="author.html#2988">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
