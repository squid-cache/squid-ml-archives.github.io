<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Reject responses with conflicting Content-Length
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Reject%20responses%20with%20conflicting%0A%20Content-Length&In-Reply-To=%3C55CE9460.8040508%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="002999.html">
   <LINK REL="Next"  HREF="003023.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Reject responses with conflicting Content-Length</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Reject%20responses%20with%20conflicting%0A%20Content-Length&In-Reply-To=%3C55CE9460.8040508%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] Reject responses with conflicting Content-Length">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Aug 15 01:22:40 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="002999.html">[squid-dev] [PATCH] Reject responses with conflicting	Content-Length
</A></li>
        <LI>Next message: <A HREF="003023.html">[squid-dev] [PATCH] Reject responses with conflicting	Content-Length
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3018">[ date ]</a>
              <a href="thread.html#3018">[ thread ]</a>
              <a href="subject.html#3018">[ subject ]</a>
              <a href="author.html#3018">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 13/08/2015 3:03 a.m., Alex Rousskov wrote:
&gt;<i> On 08/11/2015 11:49 PM, Amos Jeffries wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> Which one of these malformations is not malign ?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  * non-numeric Content-Length
</I>&gt;&gt;<i>  * negative value Content-Length
</I>&gt;&gt;<i>  * Content-Length with also Transfer-Encoding header
</I>&gt;&gt;<i>  * multiple different-value Content-Length
</I>&gt;&gt;<i>  * Content-Length on 204 response
</I>&gt;<i> 
</I>&gt;<i> All of them may be benign in _some_ cases.
</I>
No. All of them corrupt the possible interpretations of what object the
message is conveying. There is no way to reliably and safely handle the
payload of the message theu describe, and certainly not for any
following messages.

The only reasonable course of action to all of them is to reject with
4xx/5xx and terminate the entire connection. I dont see that outcome as
even possibly being non-harmful for the client operations.


The T-E and 204 cases are the most subtle. One could assume that C-L
might be ignored or dropped in some cases. But that actually is an
assumption that closer inspection does not bear out - all it does is
pass incorrect data on to the recipient. Either an endpoint recipient
after Squid, or Squids own internal logic gets told some wrong thing.
The result in all permutations of assumption is harm (smuggling,
truncation or corruption) at some point in the processing that follows.



&gt;<i> Again, just because something
</I>&gt;<i> is malformed, does not mean it was created with an evil purpose and
</I>&gt;<i> cannot be proxied as intended, without harm, in some specific environments.
</I>&gt;<i> 
</I>&gt;<i> It is pointless to argue about this. You are simply using a different
</I>&gt;<i> definition of &quot;benign&quot;. My definition, in this context, is &quot;broken but
</I>&gt;<i> not intended to maim&quot;.
</I>
I suspect you are thinking of benevolent/malicious.

Oxford/Cambridge dictionaries I use list &quot;benign - not causing serious
harm&quot;, and/or not *capable* of causing serious harm. Intent does not
enter into it.

benign/malign are used for innanimate things, or animate mindless
things. Cancer often the example, does not have a mind and therefore no
intent. Yet is benign or malign.

American English / Websters adds &quot;pleasant and kind; not harmful or
severe&quot;. But in terms of basic mood/emotional outlook underlying a
persons character.


benevolent/malicious are defined directly in terms of intention to cause
some benign/malign outcome respectively.


&gt;<i> 
</I>&gt;<i> Please note that I am _not_ arguing that all benign traffic has to be
</I>&gt;<i> proxied and cannot be blocked.
</I>&gt;<i> 
</I>
I do. If it is benign it certainly should be tolerated. But benign !=
benevolent.

Some things are malign benevolent. Thats what we need to step up and
stop allowing as much as malicious inputs. Unintentional harm does more
damage, more often than active malevolence. Usually by allowing the
malicious actors the cracks to work with in the first place.

Amos

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002999.html">[squid-dev] [PATCH] Reject responses with conflicting	Content-Length
</A></li>
	<LI>Next message: <A HREF="003023.html">[squid-dev] [PATCH] Reject responses with conflicting	Content-Length
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3018">[ date ]</a>
              <a href="thread.html#3018">[ thread ]</a>
              <a href="subject.html#3018">[ subject ]</a>
              <a href="author.html#3018">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
