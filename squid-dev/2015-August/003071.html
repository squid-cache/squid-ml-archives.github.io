<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Non-zeroing mempools
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Non-zeroing%20mempools&In-Reply-To=%3C55D56167.4060003%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="003059.html">
   <LINK REL="Next"  HREF="003101.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Non-zeroing mempools</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Non-zeroing%20mempools&In-Reply-To=%3C55D56167.4060003%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] Non-zeroing mempools">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Aug 20 05:11:03 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="003059.html">[squid-dev] [PATCH] Non-zeroing mempools
</A></li>
        <LI>Next message: <A HREF="003101.html">[squid-dev] [PATCH] Non-zeroing mempools
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3071">[ date ]</a>
              <a href="thread.html#3071">[ thread ]</a>
              <a href="subject.html#3071">[ subject ]</a>
              <a href="author.html#3071">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 20/08/2015 7:28 a.m., Kinkie wrote:
&gt;<i> Hi all,
</I>&gt;<i>   the attached patch (a merge request from
</I>&gt;<i> lp:~kinkie/squid/mempools-nozero) changes MEMPROXY_CLASS so that it doesn't
</I>&gt;<i> zero memory before releasing it to requestors. The constructors of all
</I>&gt;<i> classes using that feature were checked, so that they fully initialize all
</I>&gt;<i> data members and thus require no zeroing.
</I>&gt;<i> It also changes Debug::OutStream to use MEMPROXY_CLASS instead of
</I>&gt;<i> new/derelete, and changes constructors to initializer lists whenever
</I>&gt;<i> possible and sensible (aka justified by other changes), same for dropping
</I>&gt;<i> HERE and adopting nullptr.
</I>&gt;<i> It also changes some code in Makefile.am to use make variables in place of
</I>&gt;<i> full paths.
</I>&gt;<i> The code has been run-tested (default config only), build-farm-tested and
</I>&gt;<i> polygraph-tested. It shows a small but noticeable performance improvement
</I>&gt;<i> in performance (of course, numbers are to be taken with a big grain of
</I>&gt;<i> salt).
</I>&gt;<i> 
</I>&gt;<i> When reviewing, please do not focus on formatting issues; if this patch
</I>&gt;<i> passes review I'll run a source-formatting before merging.
</I>

* in Makefiles please add the new bits of *_SOURCE lists in alphabetical
order.
 - you have several stub_libmem.cc going after stub_M and stub_S* filenames.


* Please make the initializer lists one member per line.
 - the auto-formatting wont do that for us yet.
 - it greatly helps readability and manual checking for missing or
out-of-order items. We can also then easily add comments to lines
explain odd default values.


* in memset() please use 0 integer value not '\0' to set flags.
 - it helps the compiler know it is safe to optimize up to larger than
8-bit values of 0.


* in MemObject::MemObject() please leave the _reply initialization like
it was so that the HTTMSGLOCK hack is kept visibly associated with the
new operation.


* You add several &quot;// needs mempool-managed zeroing.&quot;
 - but you say this patch makes the MEMPROXYC_CLASS macro do zero-ing
already. Those should be reverted.


* src/HttpHeader.cc - revert


* when adding a new constructor ensure the big-5 operators (ctor, dtor,
assign, emplace, emplace-assign) are all present. Even if they use &quot;=
default&quot;
 - looking at StoreMeta, maybe others.


* wordlist missing 'explicit' on the raw-pointer ctor
 - also other big-5 operators


* in test-suite/Makefile.am please try to avoid adding LIBMEM_STUBS.
- DEBUG_SOURCE entries should be enough, and it doesnt matter of extra
stubs get linked to unit tests.


* please do one of these:

 + return the XXX to Debugs.h, but it can move up to explain why
AllocatorProxy.h is used instead of mem/forward.h

 + move the definition of FREE to mem/forward.h, and make anything
including AllocatorProxy.h directly include mem/forward.h instead


Amos

</PRE>










































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003059.html">[squid-dev] [PATCH] Non-zeroing mempools
</A></li>
	<LI>Next message: <A HREF="003101.html">[squid-dev] [PATCH] Non-zeroing mempools
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3071">[ date ]</a>
              <a href="thread.html#3071">[ thread ]</a>
              <a href="subject.html#3071">[ subject ]</a>
              <a href="author.html#3071">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
