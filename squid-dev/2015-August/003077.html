<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Developing customized Cache Selection algorithm from Round Robin, Least Load
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Developing%20customized%20Cache%20Selection%20algorithm%0A%20from%20Round%20Robin%2C%20Least%20Load&In-Reply-To=%3CE5924590149B4B46AA1B326C644B60643263F1%40NABESITE.InterDigital.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="003069.html">
   <LINK REL="Next"  HREF="003053.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Developing customized Cache Selection algorithm from Round Robin, Least Load</H1>
    <B>Du, Hongfei</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Developing%20customized%20Cache%20Selection%20algorithm%0A%20from%20Round%20Robin%2C%20Least%20Load&In-Reply-To=%3CE5924590149B4B46AA1B326C644B60643263F1%40NABESITE.InterDigital.com%3E"
       TITLE="[squid-dev] Developing customized Cache Selection algorithm from Round Robin, Least Load">Hongfei.Du at InterDigital.com
       </A><BR>
    <I>Thu Aug 20 09:50:45 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="003069.html">[squid-dev] Developing customized Cache Selection algorithm from Round Robin, Least Load
</A></li>
        <LI>Next message: <A HREF="003053.html">[squid-dev] Build failed in Jenkins: trunk-matrix » gcc,d-opensuse-13.2 #306
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3077">[ date ]</a>
              <a href="thread.html#3077">[ thread ]</a>
              <a href="subject.html#3077">[ subject ]</a>
              <a href="author.html#3077">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Alex
Thanks for the comments, really helpful, actually by the time I read this email in the morning, I have managed to find some things exactly using search methodology as you mentioned, please find my findings inline.

Best Regards,

Humphrey

/*

Hongfei Du
Staff Engineer (UK Software)
InterDigital UK, Inc.
Shoreditch Business Center
64 Great Eastern Street
London,  EC2A 3QR
T: +44 207.749.9140
<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">Hongfei.Du at InterDigital.com</A>
www.InterDigital.com&lt;<A HREF="http://www.interdigital.com">http://www.interdigital.com</A>&gt;

[cid:<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">image5363d4.BMP at 8e96b82c.42b8be99</A>]

This e-mail is intended only for the use of the individual or entity to which it is addressed, and may contain information that is privileged, confidential and/or otherwise protected from disclosure to anyone other than its intended recipient. Unintended transmission shall not constitute waiver of any privilege or confidentiality obligation. If you received this communication in error, please do not review, copy or distribute it, notify me immediately by email, and delete the original message and any attachments. Unless expressly stated in this e-mail, nothing in this message or any attachment should be construed as a digital or electronic signature.


-----Original Message-----
/*From: Alex Rousskov [mailto:<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">rousskov at measurement-factory.com</A>]
/*Sent: Thursday, August 20, 2015 5:16 AM
/*To: <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev at lists.squid-cache.org</A>
/*Cc: Du, Hongfei &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">Hongfei.Du at InterDigital.com</A>&gt;
/*Subject: Re: [squid-dev] Developing customized Cache Selection algorithm from
/*Round Robin, Least Load
/*
/*On 08/19/2015 05:03 AM, Du, Hongfei wrote:
/*
/*&gt; We are in an attempt to extend Squid Cache selection algorithm to
/*&gt; develop a solution for controlled storage of subscriber’s content in
/*&gt; Squid Caches, and thereafter apply access rule on these contents, a
/*&gt; few questions to start with:
/*&gt;
/*&gt; ·        As we probably has to rewrite new algorithm and recompile it,
/*&gt; so does anyone know where(or which file) is the existing Round Robin
/*&gt; or Least Load algorithm defined in source codes?
/*
/*Search for the storeDirSelectSwapDir variable in src/store_dir.cc. To learn more
/*about customizing cache dir selection code, run:
/*
/*  $ bzr grep Config.store_dir_select_algorithm
/*
/*or an equivalent search command.
/*
[Du, Hongfei(Humphrey)] Using search commands, I found the following points:
- grep store_dir_select_algorithm, first hit at src/SquidConfig.h
- LL and RR is declared at store_dir.cc using static STDIRSELECT
- storeDirSelectSwapDir is really the one playing the trick(i.e. returns where the content is to be put into ), and it uses dirn as index with Config.cacheSwap.n_configured(I guess this is the total number of caches predefined in the disk?) I attached RR algorithm definition, really short yet helpful to learn the logics:

static int
storeDirSelectSwapDirRoundRobin(const StoreEntry * e)
{
   // e-&gt;objectLen() is negative at this point when we are still STORE_PENDING
   ssize_t objsize = e-&gt;mem_obj-&gt;expectedReplySize();
   if (objsize != -1)
       objsize += e-&gt;mem_obj-&gt;swap_hdr_sz;

   // Increment the first candidate once per selection (not once per
   // iteration) to reduce bias when some disk(s) attract more entries.
   static int firstCandidate = 0;
   if (++firstCandidate &gt;= Config.cacheSwap.n_configured)
       firstCandidate = 0;

   for (int i = 0; i &lt; Config.cacheSwap.n_configured; ++i) {
       const int dirn = (firstCandidate + i) % Config.cacheSwap.n_configured;
       const SwapDir *sd = dynamic_cast&lt;SwapDir*&gt;(INDEXSD(dirn));

       int load = 0;
       if (!sd-&gt;canStore(*e, objsize, load))
           continue;

       if (load &lt; 0 || load &gt; 1000) {
           continue;
       }

       return dirn;
   }

   return -1;
}


/*
/*&gt; ·        Is there straight forward method to tell/instruct squid to
/*&gt; store content(e.g. an URL)  from network in a predefined specific disk
/*&gt; folder rather than using the selection algorithm itself?
/*
/*You can use cache_dir min-size and max-size options to control cache_dir
/*selection to some extent.
/*
/*You can use the &quot;cache&quot; directive in squid.conf to control what gets stored and
/*served from the cache. This directive accepts Squid ACLs, so it can be applied to
/*specific URLs, but it cannot allow or prohibit individual cache_dir usage.
/*
/*I am not aware of any other configurable interface at the individual URL level.
/*There is no configurable mapping of URLs/StoreIDs to cache_dirs (and beyond).
/*The storeDirSelectSwapDir variable mentioned above points to one of the two
/*functions that do the mapping (selected at configuration time based on
/*store_dir_select_algorithm in squid.conf).
/*
/*
/*The details of the cache_dir selection code are rather ugly, with several half-
/*broken interfaces augmented by weird storage module-dependent
/*implementations. Do not expect a smooth sailing.
/*
[Du, Hongfei(Humphrey)] We tested many access control functions with squid.conf, and managed to response correctly from squidclient URL requests, works perfectly via monitoring terminals, the key issue now is to find a way to instruct squid to understand request from client at URL level before mapping to dir accordingly. Not sure if anyone has been successful of implementing similar thing before?
/*
/*Good luck,
/*
/*Alex.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: image5363d4.BMP
Type: image/bmp
Size: 13078 bytes
Desc: image5363d4.BMP
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20150820/f95a77b6/attachment-0001.bin">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20150820/f95a77b6/attachment-0001.bin</A>&gt;
</PRE>




































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003069.html">[squid-dev] Developing customized Cache Selection algorithm from Round Robin, Least Load
</A></li>
	<LI>Next message: <A HREF="003053.html">[squid-dev] Build failed in Jenkins: trunk-matrix » gcc,d-opensuse-13.2 #306
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3077">[ date ]</a>
              <a href="thread.html#3077">[ thread ]</a>
              <a href="subject.html#3077">[ subject ]</a>
              <a href="author.html#3077">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
