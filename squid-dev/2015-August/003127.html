<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Non-zeroing mempools
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Non-zeroing%20mempools&In-Reply-To=%3C55DA1C1D.1040106%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="003137.html">
   <LINK REL="Next"  HREF="003133.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Non-zeroing mempools</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Non-zeroing%20mempools&In-Reply-To=%3C55DA1C1D.1040106%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] Non-zeroing mempools">rousskov at measurement-factory.com
       </A><BR>
    <I>Sun Aug 23 19:16:45 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="003137.html">[squid-dev] [PATCH] Non-zeroing mempools
</A></li>
        <LI>Next message: <A HREF="003133.html">[squid-dev] [PATCH] Non-zeroing mempools
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3127">[ date ]</a>
              <a href="thread.html#3127">[ thread ]</a>
              <a href="subject.html#3127">[ subject ]</a>
              <a href="author.html#3127">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 08/19/2015 11:11 PM, Amos Jeffries wrote:

&gt;<i> * when adding a new constructor ensure the big-5 operators (ctor, dtor,
</I>&gt;<i> assign, emplace, emplace-assign) are all present. Even if they use &quot;=
</I>&gt;<i> default&quot;
</I>
IMO, the above rule is wrong because it forces developers to add
absolutely unnecessary code in many cases (unnecessary from any points
of view, even code readability and documentation).


A better set of rules would say something like this:

Big3 methods: copy constructor, destructor, and assignment operator.
Move methods: move constructor and move assignment operator.

0. If the class works well without any of the Big3 methods, do not
define any of the Big3 methods.

1. If you have to define one of Big3, declare all of Big3.

2. If your class has a non-default destructor implementation, you may
decide to define one of the Move methods. If you define one Move method,
declare the other Move method as well.

3. Whenever you declare a method, use a &quot;= default&quot; declaration when the
default method implementation matches your needs and use a &quot;= delete&quot;
declaration when using the declared method is prohibited.


[ I also like the &quot;Rule of 0&quot; that states that &quot;if you specify any of
the default members, then your class must deal exclusively with a single
resource&quot;, but we probably have too many violations of this rule and too
many raw pointers floating around to enforce it. ]


AFAICT, StoreMeta in the last patch does not satisfy rule #3. To satisfy
that rule, StoreMeta should:

* use &quot;= default&quot; for the virtual destructor

* use either &quot;= default&quot; or &quot;= delete&quot; for the copy constructor and the
assignment operator.


&gt;<i> Omitting emplace and implementing the others as protected for
</I>&gt;<i> completeness' sake.
</I>
Why protected?

* Making default constructor protected is the same as keeping it public
because the class is abstract (nobody can create a StoreMeta object).

* If you want to prohibit copying, use &quot;= delete&quot; for copy constructor
and assignment operator. Given the class use of raw pointers, deleting
sounds like a good idea, but I did not study this class usage in detail.
In general, prohibiting dangerous operations is better than allowing
them so if &quot;= delete&quot; works well, we should use it.


HTH,

Alex.

</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003137.html">[squid-dev] [PATCH] Non-zeroing mempools
</A></li>
	<LI>Next message: <A HREF="003133.html">[squid-dev] [PATCH] Non-zeroing mempools
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3127">[ date ]</a>
              <a href="thread.html#3127">[ thread ]</a>
              <a href="subject.html#3127">[ subject ]</a>
              <a href="author.html#3127">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
