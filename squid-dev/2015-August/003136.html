<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Coverity(-inspired) fixes part four, HttpHeader refactor
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Coverity%28-inspired%29%20fixes%20part%20four%2C%0A%20HttpHeader%20refactor&In-Reply-To=%3C55DA6FFD.8080703%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="003131.html">
   <LINK REL="Next"  HREF="003140.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Coverity(-inspired) fixes part four, HttpHeader refactor</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Coverity%28-inspired%29%20fixes%20part%20four%2C%0A%20HttpHeader%20refactor&In-Reply-To=%3C55DA6FFD.8080703%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] Coverity(-inspired) fixes part four, HttpHeader refactor">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Aug 24 01:14:37 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="003131.html">[squid-dev] [PATCH] Coverity(-inspired) fixes part four, HttpHeader refactor
</A></li>
        <LI>Next message: <A HREF="003140.html">[squid-dev] [PATCH] Coverity(-inspired) fixes part four, HttpHeader refactor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3136">[ date ]</a>
              <a href="thread.html#3136">[ thread ]</a>
              <a href="subject.html#3136">[ subject ]</a>
              <a href="author.html#3136">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 08/23/2015 04:01 PM, Kinkie wrote:
&gt;<i>     Adding comment: &quot;will reallocate if ilen happens to equal pool size&quot;
</I>
I would recommend not adding a comment at all if &quot;no comment&quot; and the
above &quot;low-level description of the current c_str logic&quot; are the two
choices, but it is your call. Not important.


&gt;<i>     This is what it looks like right now:
</I>&gt;<i> 
</I>&gt;<i>         //set all items in entries where item is not nullptr and
</I>&gt;<i>         // has same id as argument, to nullptr. Increment count variable
</I>&gt;<i>         // as a side-effect on matches during sweep
</I>&gt;<i>         std::replace_if(entries.begin(), entries.end(),
</I>&gt;<i>             [&amp;](HttpHeaderEntry *e) {
</I>&gt;<i>                 if (e &amp;&amp; e-&gt;id == id) {
</I>&gt;<i>                     ++count;
</I>&gt;<i>                     return true;
</I>&gt;<i>                 }
</I>&gt;<i>                 return false;
</I>&gt;<i>             },
</I>&gt;<i>             nullptr);
</I>&gt;<i> 
</I>&gt;<i>     Hopefully the comment will clarify intent :)
</I>
If you think this warrants a comment at all, consider just saying:

    // replace matching items with nil and count them

Again, if you think repeating your code using words is better, do that.
Not important.


&gt;<i>     example.cc:11:28: error: invalid operands to binary expression
</I>&gt;<i>     ('foo' and 'foo')
</I>&gt;<i>     std::int8_t var = foo::one | foo::four;
</I>&gt;<i>                       ~~~~~~~~ ^ ~~~~~~~~~
</I>&gt;<i>     1 error generated.
</I>
Thank you. We should not mix header IDs and header masks (a mask is not
an ID). I am not saying that you must change how Squid masks headers in
your patch, of course, but it does feel like the compiler has identified
a design flaw in our code. We should fix that at some point. It is your
call whether your patch is the right place for that fix.


&gt;<i>     If I understand correclty, that the only point to clear before merge
</I>&gt;<i>     is how many lines away from a touched line should a HERE be to be
</I>&gt;<i>     removed
</I>
I do not have the time to argue about this super important [sarcasm]
issue: I have suggested and even implemented a simple and precise rule.
If others prefer something else, so be it. When we are wasting days
arguing about other stuff that should not be argued about, this minor
issue is just a blimp on the radar. A few HERE changes is _not_ the
reason to avoid committing your (or any other!) patch.


Cheers,

Alex.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003131.html">[squid-dev] [PATCH] Coverity(-inspired) fixes part four, HttpHeader refactor
</A></li>
	<LI>Next message: <A HREF="003140.html">[squid-dev] [PATCH] Coverity(-inspired) fixes part four, HttpHeader refactor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3136">[ date ]</a>
              <a href="thread.html#3136">[ thread ]</a>
              <a href="subject.html#3136">[ subject ]</a>
              <a href="author.html#3136">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
