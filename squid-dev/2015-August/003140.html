<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Coverity(-inspired) fixes part four, HttpHeader refactor
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Coverity%28-inspired%29%20fixes%20part%20four%2C%0A%20HttpHeader%20refactor&In-Reply-To=%3C55DB09B0.2090804%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="003136.html">
   <LINK REL="Next"  HREF="003269.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Coverity(-inspired) fixes part four, HttpHeader refactor</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Coverity%28-inspired%29%20fixes%20part%20four%2C%0A%20HttpHeader%20refactor&In-Reply-To=%3C55DB09B0.2090804%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] Coverity(-inspired) fixes part four, HttpHeader refactor">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Aug 24 12:10:24 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="003136.html">[squid-dev] [PATCH] Coverity(-inspired) fixes part four, HttpHeader refactor
</A></li>
        <LI>Next message: <A HREF="003269.html">[squid-dev] [PATCH] Coverity(-inspired) fixes part four, HttpHeader refactor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3140">[ date ]</a>
              <a href="thread.html#3140">[ thread ]</a>
              <a href="subject.html#3140">[ subject ]</a>
              <a href="author.html#3140">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 24/08/2015 1:14 p.m., Alex Rousskov wrote:
&gt;<i> On 08/23/2015 04:01 PM, Kinkie wrote:
</I>&gt;&gt;<i>     Adding comment: &quot;will reallocate if ilen happens to equal pool size&quot;
</I>&gt;<i> 
</I>&gt;<i> I would recommend not adding a comment at all if &quot;no comment&quot; and the
</I>&gt;<i> above &quot;low-level description of the current c_str logic&quot; are the two
</I>&gt;<i> choices, but it is your call. Not important.
</I>
Agreed.

Which is also why I just suggested the terse &quot;performance regression,
c_str() reallocates&quot; in all cases where it *can*. Removal of those cases
is still important (thus X vs TODO) but not reasonable at current time.


&gt;<i> 
</I>&gt;&gt;<i>     example.cc:11:28: error: invalid operands to binary expression
</I>&gt;&gt;<i>     ('foo' and 'foo')
</I>&gt;&gt;<i>     std::int8_t var = foo::one | foo::four;
</I>&gt;&gt;<i>                       ~~~~~~~~ ^ ~~~~~~~~~
</I>&gt;&gt;<i>     1 error generated.
</I>&gt;<i> 
</I>&gt;<i> Thank you. We should not mix header IDs and header masks (a mask is not
</I>&gt;<i> an ID). I am not saying that you must change how Squid masks headers in
</I>&gt;<i> your patch, of course, but it does feel like the compiler has identified
</I>&gt;<i> a design flaw in our code. We should fix that at some point. It is your
</I>&gt;<i> call whether your patch is the right place for that fix.
</I>
This is not about header IDs - thats a different alteration leading to
this change. This bitmask thing is about enumerating the property flags
that can be set in the table record. So we dont have to list false
explicitly for all the irrelevant ones, or to depend on ordering.


The design flaw I think is in use of enum class at all. Its just not
suitable for bitmasks since the OR/AND-ing individual mask values does
not produce a valid point-value within the defined set of enum class
point-values. Wantig the compiler to reject that is exactly when enum
class should be used.

The basic c-style enum provides implicit type-casting to int_type which
is what we need when using an enum to name bitmask bits. It does not
necessarily mean badness. Just use with care. Its bad reputation is from
people who didn't, or were forced to abuse it.

Amos

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003136.html">[squid-dev] [PATCH] Coverity(-inspired) fixes part four, HttpHeader refactor
</A></li>
	<LI>Next message: <A HREF="003269.html">[squid-dev] [PATCH] Coverity(-inspired) fixes part four, HttpHeader refactor
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3140">[ date ]</a>
              <a href="thread.html#3140">[ thread ]</a>
              <a href="subject.html#3140">[ subject ]</a>
              <a href="author.html#3140">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
