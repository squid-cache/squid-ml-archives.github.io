<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Coverity-fixes, part 1: EnumIterator
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Coverity-fixes%2C%20part%201%3A%20EnumIterator&In-Reply-To=%3CCA%2BY8hcNTMYdJhbvqyekREpsCh8U9BD8Hk7PSnysViQrSurwnDw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="003173.html">
   <LINK REL="Next"  HREF="003261.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Coverity-fixes, part 1: EnumIterator</H1>
    <B>Kinkie</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Coverity-fixes%2C%20part%201%3A%20EnumIterator&In-Reply-To=%3CCA%2BY8hcNTMYdJhbvqyekREpsCh8U9BD8Hk7PSnysViQrSurwnDw%40mail.gmail.com%3E"
       TITLE="[squid-dev] [PATCH] Coverity-fixes, part 1: EnumIterator">gkinkie at gmail.com
       </A><BR>
    <I>Thu Aug 27 09:04:18 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="003173.html">[squid-dev] [PATCH] Coverity-fixes, part 1: EnumIterator
</A></li>
        <LI>Next message: <A HREF="003261.html">[squid-dev] [PATCH] Coverity-fixes, part 1: EnumIterator
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3253">[ date ]</a>
              <a href="thread.html#3253">[ thread ]</a>
              <a href="subject.html#3253">[ subject ]</a>
              <a href="author.html#3253">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Aug 24, 2015 at 9:41 PM, Alex Rousskov &lt;
<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">rousskov at measurement-factory.com</A>&gt; wrote:

&gt;<i> On 08/24/2015 01:21 PM, Kinkie wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; On Mon, Aug 24, 2015 at 8:37 PM, Alex Rousskov wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     On 08/24/2015 12:08 PM, Amos Jeffries wrote:
</I>&gt;<i> &gt;     &gt; On 25/08/2015 4:49 a.m., Kinkie wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     &gt; + * behavior is undefined if the iterator
</I>&gt;<i> &gt;     &gt; + * is incremented (or decremented) outside the range representing
</I>&gt;<i> &gt;     valid
</I>&gt;<i> &gt;     &gt; + * enum symbols
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     I hope that behavior is well defined: For many enums/iterators,
</I>&gt;<i> &gt;     iterators are &quot;incremented outside the range representing valid enum
</I>&gt;<i> &gt;     symbols&quot; to reach end() and rend(). I asked you about these
</I>&gt;<i> beyond-range
</I>&gt;<i> &gt;     increments, and you assured me that they work fine. We should not
</I>&gt;<i> add a
</I>&gt;<i> &gt;     comment saying otherwise.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I may have difficulty expressing myself here. The iterators work just
</I>&gt;<i> &gt; fine outside the range. Dereferencing them is another matter, as there
</I>&gt;<i> &gt; is no valid symbol to cast them to.
</I>&gt;<i>
</I>&gt;<i> Remove that paragraph then. It is a Bad Idea to try to document how
</I>&gt;<i> iterators work in general when describing a specific class. Incrementing
</I>&gt;<i> or dereferencing end() or equivalent is not going to work well, but we
</I>&gt;<i> should not document that.
</I>&gt;<i>
</I>
How about:
 * The iterator does not check for bounds when incrementing or decrementing,
 * that responsibility is left to the caller
?


&gt;<i> &gt;     &gt;&gt; + *   zeroth, first, second, onePastLast, fourth
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     Please make onePastLast last.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; I'm trying to highlight the fact that
</I>&gt;<i> &gt; the dereferencing will only happen on EnumType::first and
</I>&gt;<i> &gt; EnumType::second. Any suggestion on how to clearly express it is welcome.
</I>&gt;<i>
</I>&gt;<i> 1. Replace the current enum values with five color names: white, blue,
</I>&gt;<i> red, orange, pink.
</I>&gt;<i>
</I>&gt;<i> 2. Iterate from blue to orange.
</I>&gt;<i>
</I>&gt;<i> 3. Add a do_stuff(v) call comment saying that it will be called with red
</I>&gt;<i> and blue values only.
</I>&gt;<i>
</I>
Done


&gt;<i> For extra points, order colors by hue :-).
</I>&gt;<i>
</I>
Dammit Jim, I'm an engineer, not a painter! :P


&gt;<i> &gt;     You might want to add a comment that EnumRange() cannot be used to
</I>&gt;<i> &gt;     iterate whole enums without [end] markers and, hence, all enums that
</I>&gt;<i> &gt;     require iteration of the entire range must have markers.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; I'm trying to detail that in the documentation for EnumRangeT. Not
</I>&gt;<i> &gt; clearly enough, I guess.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> My bad. Sorry I missed that paragraph. It is OK. I would remove the
</I>&gt;<i> &quot;Otherwise you will have to ...&quot; suggestion though -- no need to
</I>&gt;<i> instruct folks to write bad code.
</I>&gt;<i>
</I>
Ok.


&gt;<i> Note that one _can_ use EnumRange() to iterate whole enums; they just
</I>&gt;<i> need a marker to do that. You do not have to polish your comment though.
</I>&gt;<i>
</I>
That'd be quite redundant, it's stated well enough already that the last
element in the range is not going to be involved in the loop.
Thanks, and sorry for missing your comments earlier on. Updated patch will
follow after I address Amos' comments as well.

  Francesco
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20150827/c6645167/attachment.html">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20150827/c6645167/attachment.html</A>&gt;
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003173.html">[squid-dev] [PATCH] Coverity-fixes, part 1: EnumIterator
</A></li>
	<LI>Next message: <A HREF="003261.html">[squid-dev] [PATCH] Coverity-fixes, part 1: EnumIterator
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3253">[ date ]</a>
              <a href="thread.html#3253">[ thread ]</a>
              <a href="subject.html#3253">[ subject ]</a>
              <a href="author.html#3253">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
