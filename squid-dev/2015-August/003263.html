<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] mempools-nozero: turn StoreEntry into	MEMPROXY_CLASS
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20mempools-nozero%3A%20turn%20StoreEntry%20into%0A%09MEMPROXY_CLASS&In-Reply-To=%3CCA%2BY8hcNUmpLi4J0%2BsjB85JkkjNNVKfEXsVAA3qZErg3CjKQQgQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="003258.html">
   <LINK REL="Next"  HREF="003264.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] mempools-nozero: turn StoreEntry into	MEMPROXY_CLASS</H1>
    <B>Kinkie</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20mempools-nozero%3A%20turn%20StoreEntry%20into%0A%09MEMPROXY_CLASS&In-Reply-To=%3CCA%2BY8hcNUmpLi4J0%2BsjB85JkkjNNVKfEXsVAA3qZErg3CjKQQgQ%40mail.gmail.com%3E"
       TITLE="[squid-dev] [PATCH] mempools-nozero: turn StoreEntry into	MEMPROXY_CLASS">gkinkie at gmail.com
       </A><BR>
    <I>Fri Aug 28 15:02:09 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="003258.html">[squid-dev] [PATCH] mempools-nozero: turn StoreEntry into MEMPROXY_CLASS
</A></li>
        <LI>Next message: <A HREF="003264.html">[squid-dev] [PATCH] mempools-nozero: turn StoreEntry into MEMPROXY_CLASS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3263">[ date ]</a>
              <a href="thread.html#3263">[ thread ]</a>
              <a href="subject.html#3263">[ subject ]</a>
              <a href="author.html#3263">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Aug 27, 2015 at 9:28 PM, Alex Rousskov &lt;
<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">rousskov at measurement-factory.com</A>&gt; wrote:

&gt;<i> On 08/27/2015 08:58 AM, Kinkie wrote:
</I>&gt;<i>
</I>&gt;<i> &gt;   this patch turns StoreEntry into MEMPROXY_CLASS, getting rid of the
</I>&gt;<i> &gt; default constructors.
</I>&gt;<i> &gt;   In the process, it turns hash_link into a class, giving it a default
</I>&gt;<i> &gt; constructor in order to support nonzeroing pools.
</I>&gt;<i> &gt;   The old custom allocator also gave a nonstandard chunk size; that
</I>&gt;<i> &gt; tweak should not be necessary anymore.
</I>&gt;<i>
</I>&gt;<i> Can you explain why that tweak should not be necessary any more?
</I>&gt;<i>
</I>
It was discussed on IRC (log edited for clarity, date is 2015-08-20)

&lt;yadi&gt; AFAIK its optimized for cache_mem holding StoreEntry objects without
either going over the configured cache_mem limit or badly restricting
object count when many 0-byte objects are present.
so som sort of dynamic pool size thing needs to be created. then String,
MemBuf, SBuf, and StoreEntry can use it for their pools.
...
&lt;yadi&gt; looking at StoreEntry itelf Im not clear on why it needs 2MB chunks
in the first place. maybe its just that we have so many in the air all the
time it would mean avoiding long list of chunks in the allocator state.
&lt;yadi&gt; lifeless, have any idea on this? its sort of early Squid-3 or
Squid-2 era stuff
&lt;lifeless&gt; storeentry having a 2MB chunk is relatively recent AFAIK,
post-2004
&lt;lifeless&gt; I'd bet its an optimisation patch though
&lt;yadi&gt; lifeless: I tracked the 2MB Storeentry chunk back toa a patch by
Duane in 1998 documented &quot;adding&quot;, for squid 1.2.beta12 it seems
&lt;yadi&gt; kinkie: I think this calls for an experimental targeted conversion
with lots of tests on what behaviour is affected.

I have no objections related to the patch, but FYI:
&gt;<i>
</I>&gt;<i> &gt; $ find-bad-changes.pl &lt; /tmp/mempools-nozero-storeentry.patch
</I>&gt;<i> &gt; src/store.cc:307: Unnecessary code change of: -    mem_obj(NULL),
</I>&gt;<i> &gt; src/store.cc:308:                     ... to: +    mem_obj(nullptr),
</I>&gt;<i>
</I>


-- 
    Francesco
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20150828/9763abcc/attachment.html">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20150828/9763abcc/attachment.html</A>&gt;
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003258.html">[squid-dev] [PATCH] mempools-nozero: turn StoreEntry into MEMPROXY_CLASS
</A></li>
	<LI>Next message: <A HREF="003264.html">[squid-dev] [PATCH] mempools-nozero: turn StoreEntry into MEMPROXY_CLASS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3263">[ date ]</a>
              <a href="thread.html#3263">[ thread ]</a>
              <a href="subject.html#3263">[ subject ]</a>
              <a href="author.html#3263">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
