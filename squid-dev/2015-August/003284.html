<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] splitting typedefs.h and enums.h
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20splitting%20typedefs.h%20and%20enums.h&In-Reply-To=%3C55E41971.7050007%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="003283.html">
   <LINK REL="Next"  HREF="003287.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] splitting typedefs.h and enums.h</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20splitting%20typedefs.h%20and%20enums.h&In-Reply-To=%3C55E41971.7050007%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] splitting typedefs.h and enums.h">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Aug 31 09:08:01 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="003283.html">[squid-dev] [PATCH] splitting typedefs.h and enums.h
</A></li>
        <LI>Next message: <A HREF="003287.html">[squid-dev] [PATCH] splitting typedefs.h and enums.h
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3284">[ date ]</a>
              <a href="thread.html#3284">[ thread ]</a>
              <a href="subject.html#3284">[ subject ]</a>
              <a href="author.html#3284">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 31/08/2015 8:13 p.m., Kinkie wrote:
&gt;<i> On Sun, Aug 30, 2015 at 1:01 PM, Amos Jeffries wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> On 30/08/2015 2:20 p.m., Kinkie wrote:
</I>&gt;&gt;&gt;<i> Hi,
</I>&gt;&gt;&gt;<i>   this is a snapshot of my current effort to split typedefs.h and
</I>&gt;&gt;<i> enums.h,
</I>&gt;&gt;&gt;<i> removing unneeded definitions and shuffling the remaining ones to
</I>&gt;&gt;<i> locations
</I>&gt;&gt;&gt;<i> where they are actually used.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> If there are no objections, I would consider this to be a merge
</I>&gt;&gt;<i> candidate,
</I>&gt;&gt;&gt;<i> although the effort is not yet completed. typedefs.h is almost complete,
</I>&gt;&gt;&gt;<i> and enums.h just started. I'd like to carry on with the latter, but it's
</I>&gt;&gt;&gt;<i> already a big patch as it is.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Thanks
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> grumblie: I asked you to avoid touching enums during the typedefs.h scope.
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> I must do something about my English. I had understood you discouraged it,
</I>&gt;<i> but not this strongly.
</I>&gt;<i> Reverted enums.h changes
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> What I would like to see in this patch scope is only removing the
</I>&gt;&gt;<i> #include enums.h from typedefs.h and adding *only* equivalent #include
</I>&gt;&gt;<i> enums.h directly into other files which break as a result. No shuffling
</I>&gt;&gt;<i> of enums content themselves.
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> Can't do. IRCB takes an enum as argument; we need to get IRCB out of
</I>&gt;<i> typedefs to do that. Without going into the AsyncJob rework you were
</I>&gt;<i> referring to, where could it be shuffled to?
</I>&gt;<i> 
</I>
Sorry I was not being clear still. What I meant by &quot;only&quot; at the
beginning was that enums.h move/remove/add as an example of the limit of
changes related to enums which might be in scope. If part (ie. removing
enume.h from typedefs.h) is not possible, then by all means avoid that too.


&gt;<i> 
</I>&gt;&gt;<i> All of this shuffling risks build failures and bitrot in components we
</I>&gt;&gt;<i> might overlook. Which means backportage when its discovered.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The bigger the patch is the more difficulty to backporting efforts when
</I>&gt;&gt;<i> only a small piece of it needs to accompany a portage patch. The
</I>&gt;&gt;<i> typedefs change by the nature of typedef affects far fewer portages than
</I>&gt;&gt;<i> enums will. Theoretically each of these symbol changes should be in a
</I>&gt;&gt;<i> different commit, but that is taking it a little far in the opposite
</I>&gt;&gt;<i> direction for typedefs. (I will be requesting much lower granularity for
</I>&gt;&gt;<i> enums however.)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> NP: yes these are mostly the same arguments we hear from Alex about HERE
</I>&gt;&gt;<i> removal. And for good reason. They are valid in both discussions.
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> No problems with that. Only downside to more granularity is that it takes
</I>&gt;<i> more time due to wait for audits.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In src/CacheDigest.h
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * you can remove the &quot;for cache_key&quot; comments now. Its obvious enough
</I>&gt;&gt;<i> from the filename.
</I>&gt;&gt;<i>  - the comment was only there to see why typedefs.h was still needed.
</I>&gt;&gt;<i>  - same in src/tests/stub_CacheDigest.cc
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * kb_t comment is outdated now
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> Can't find it, where?
</I>&gt;<i> 
</I>
Sorry that was in src/ClientInfo.h on the new #include

&gt;&gt;<i> In src/SquidTime.h
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * s/miliseconds/milliseconds/
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * s/*Use/* Use/
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> Ok
</I>&gt;<i> 
</I>
lol. Now the space at the end is missing. oops.



&gt;&gt;<i>
</I>&gt;&gt;<i> In src/fs/forward.h
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * missing empty line after the copyright
</I>&gt;&gt;<i> * double-empty line needs removing
</I>&gt;&gt;<i> * missing empty line at end of file
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> Ok for the first two, empty line at end of file seems present to me..
</I>&gt;<i> 
</I>
Oh well, the maintenance tools will catch it.


&gt;&gt;<i> NP: add to our TODO list that fs/rock/RockForward.h should be
</I>&gt;&gt;<i> fs/rock/forward.h and lacks documentation. Sigh.
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> Either I do that now, or I suspect it won't be done. Should I?
</I>&gt;<i> 
</I>
Next once this is in maybe. Or I could.

Looks okay to me. +1 if it still builds after the audit tweaks.

Amos
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003283.html">[squid-dev] [PATCH] splitting typedefs.h and enums.h
</A></li>
	<LI>Next message: <A HREF="003287.html">[squid-dev] [PATCH] splitting typedefs.h and enums.h
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3284">[ date ]</a>
              <a href="thread.html#3284">[ thread ]</a>
              <a href="subject.html#3284">[ subject ]</a>
              <a href="author.html#3284">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
