<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Bug 4305: Squid reports X509_V_ERR_UNABLE_TO_GET_ISSUER_CERT_LOCALLY...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Bug%204305%3A%20Squid%20reports%0A%20X509_V_ERR_UNABLE_TO_GET_ISSUER_CERT_LOCALLY...&In-Reply-To=%3C565D86D3.3050704%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="004022.html">
   <LINK REL="Next"  HREF="004024.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Bug 4305: Squid reports X509_V_ERR_UNABLE_TO_GET_ISSUER_CERT_LOCALLY...</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Bug%204305%3A%20Squid%20reports%0A%20X509_V_ERR_UNABLE_TO_GET_ISSUER_CERT_LOCALLY...&In-Reply-To=%3C565D86D3.3050704%40treenet.co.nz%3E"
       TITLE="[squid-dev] Bug 4305: Squid reports X509_V_ERR_UNABLE_TO_GET_ISSUER_CERT_LOCALLY...">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Dec  1 11:38:59 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="004022.html">[squid-dev] Bug 4305: Squid reports X509_V_ERR_UNABLE_TO_GET_ISSUER_CERT_LOCALLY...
</A></li>
        <LI>Next message: <A HREF="004024.html">[squid-dev] Bug 4305: Squid reports X509_V_ERR_UNABLE_TO_GET_ISSUER_CERT_LOCALLY...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4023">[ date ]</a>
              <a href="thread.html#4023">[ thread ]</a>
              <a href="subject.html#4023">[ subject ]</a>
              <a href="author.html#4023">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/12/2015 9:36 p.m., Christos Tsantilas wrote:
&gt;<i> On 11/29/2015 09:00 AM, Amos Jeffries wrote:
</I>&gt;&gt;<i> On 28/11/2015 9:35 p.m., Christos Tsantilas wrote:
</I>&gt;&gt;&gt;<i> Hi all,
</I>&gt;&gt;&gt;<i>    Sometimes the SSL servers does not send the full chain of
</I>&gt;&gt;&gt;<i> intermediate
</I>&gt;&gt;&gt;<i> certificates, but instead send a link where the client can download the
</I>&gt;&gt;&gt;<i> intermediate certificates.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Currently squid can not handle such cases. Measurement Factory build a
</I>&gt;&gt;&gt;<i> patch which provides a workaround for this problem: Allow the users to
</I>&gt;&gt;&gt;<i> build a database of intermediate certificates, which can be used by
</I>&gt;&gt;&gt;<i> squid to complete certificate chains.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Measurement Factory currently works to implement a full solution for
</I>&gt;&gt;&gt;<i> this bug, a downloader for squid which will retrieve missing
</I>&gt;&gt;&gt;<i> certificates from the net.
</I>&gt;&gt;&gt;<i> However this solution may take some time to test and finish it.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Is it OK to apply to trunk the workaround patch in bug 4305?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It touches the squid.conf UI so I would rather not at this point.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> That said the problem it resolves is rather more important than
</I>&gt;&gt;<i> preserving an arbitrary policy. So I am in agreement with it going in
</I>&gt;&gt;<i> sooner rather than later provided it works as planned.
</I>&gt;<i> 
</I>&gt;<i> This is means that I should apply it to trunk?
</I>&gt;<i> 
</I>
Yes, +1 with the documentation change being discussed below.

&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> But please extend the squid.conf documentation to state that self-signed
</I>&gt;&gt;<i> (aka root) certificates are not supported by the new option and will be
</I>&gt;&gt;<i> ignored. They are ignores silently, so it needs to be stated somewhere
</I>&gt;&gt;<i> to avoid confusion.
</I>&gt;<i> 
</I>&gt;<i> The new directive &quot;sslproxy_untrusted_certs&quot; documented as
</I>&gt;<i> 
</I>&gt;<i> &quot;Squid uses the intermediate certificates pre-loaded from the specified
</I>&gt;<i> file to validate origin server certificate chains. Squid receives many
</I>&gt;<i> incomplete chains (i.e., chains with intermediate certificates missing).
</I>&gt;<i> The file is expected to contain zero or more PEM-encoded intermediate
</I>&gt;<i> certificates. These certificates are not treated as trusted root
</I>&gt;<i> certificates.&quot;
</I>&gt;<i> 
</I>&gt;<i> Isn't it enough the following reference: &quot;These certificates are not
</I>&gt;<i> treated as trusted root certificates.&quot;?
</I>
No, that sentence currently implies that root certificates are still
useable. Reality in the code is that they will not be even added to the
chain. Just silently skipped.

(that skip should probably be done in Ssl::loadCerts() to save memory).


&gt;<i> Moreover the name of new directive it should be clear about the purpose
</I>&gt;<i> of these certificates.
</I>
Nod. &quot;untrusted&quot; is not exactly a clear name to anyone unfamiliar with
the internals of OpenSSL. To the rest of the world (including Squid's
usage) these are &quot;intermediate certificates&quot;. So calling it
&quot;sslproxy_intermediate_certs&quot; might be clearer to admin than untrusted.
But I dont have any preference either way.


Also, now that I think of it, the code is already capable of loading
multiple files. That needs to be mentioned too.


So, I suggest this for the full doc:
&quot;
DOC_START
  Many origin servers fail to send their full server certificate
  chain for verification. Assuming the client already has or can
  easily locate any intermediate certificates that are missing.

  Squid uses the certificates from the specified file to fill in
  these missing chains when trying to validate origin server
  certificate chains.

  The file is expected to contain zero or more PEM-encoded
  intermediate certificates. These certificates are not treated
  as trusted root certificates and any self-signed certificate in
  this file will be ignored.

  This directive may be repeated to load multiple files
DOC_END
&quot;

Amos

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004022.html">[squid-dev] Bug 4305: Squid reports X509_V_ERR_UNABLE_TO_GET_ISSUER_CERT_LOCALLY...
</A></li>
	<LI>Next message: <A HREF="004024.html">[squid-dev] Bug 4305: Squid reports X509_V_ERR_UNABLE_TO_GET_ISSUER_CERT_LOCALLY...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4023">[ date ]</a>
              <a href="thread.html#4023">[ thread ]</a>
              <a href="subject.html#4023">[ subject ]</a>
              <a href="author.html#4023">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
