<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [RFC] Where do ACL flags belong?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20Where%20do%20ACL%20flags%20belong%3F&In-Reply-To=%3C56618BCC.4060506%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="004042.html">
   <LINK REL="Next"  HREF="004045.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [RFC] Where do ACL flags belong?</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20Where%20do%20ACL%20flags%20belong%3F&In-Reply-To=%3C56618BCC.4060506%40ngtech.co.il%3E"
       TITLE="[squid-dev] [RFC] Where do ACL flags belong?">eliezer at ngtech.co.il
       </A><BR>
    <I>Fri Dec  4 12:49:16 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="004042.html">[squid-dev] [RFC] Where do ACL flags belong?
</A></li>
        <LI>Next message: <A HREF="004045.html">[squid-dev] [RFC] Where do ACL flags belong?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4043">[ date ]</a>
              <a href="thread.html#4043">[ thread ]</a>
              <a href="subject.html#4043">[ subject ]</a>
              <a href="author.html#4043">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sorry to bump into the discussion without too much warnings.

On 04/12/2015 08:51, Alex Rousskov wrote:
&gt;<i>
</I>&gt;<i> The -n approach is overall better than _str suffix approach because the
</I>&gt;<i> former makes it easy to mix-and-match multiple flags and to support
</I>&gt;<i> flags with values such as -m=delimiters.
</I>&gt;<i>
</I>
The only real differences that I can understand(after almost 24 hours 
straight no sleep) is that admins are used to use &quot;-n&quot; in many unix tools.
Squid used the &quot;-n&quot; for a specific reason which might be wrong.

&gt;&gt;&gt;&gt;<i> &gt;&gt;&gt;AFAICS it should not be much more difficult to
</I>&gt;&gt;&gt;&gt;<i> &gt;&gt;&gt;re-implement -n using #1 than to re-implement regex parsing and -i to
</I>&gt;&gt;&gt;&gt;<i> &gt;&gt;&gt;implement #2.
</I>&gt;&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;&gt;<i> &gt;&gt;True, but I do not think we should touch the -i interface. It works as
</I>&gt;&gt;&gt;<i> &gt;&gt;expected.
</I>&gt;&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;Then I must have completely misunderstood what your #2 proposal was about.
</I>&gt;<i> #2 issues a warning when -n is used on some but not all lines of a given
</I>&gt;<i> ACL foo. No other changes in #2.
</I>
This should be done as a first step before anything else since it's 
really something that the admin should be notified about.
Later we can decide what to do and if required to removed the notice 
after any fix.

&gt;&gt;<i> &gt;  -i flag operates per-line, and resets at the EOL.
</I>&gt;<i> Yes (which, BTW, also breaks the &quot;multiple lines are the same as one
</I>&gt;<i> combined line&quot; design principle).
</I>&gt;<i>
</I>I will stick to the &quot;-n&quot; only for now

&gt;&gt;<i> &gt;If we remove per-line/value flags then a lot of configs are broken.
</I>&gt;<i> Neither #1 nor #2 change how -i works.
</I>&gt;<i>
</I>&gt;<i> #1 makes -n work per line, as intended.
</I>
Which sounds great!

&gt;<i> #2 does not change how -n works, but issues a warning if -n is used
</I>&gt;<i> inconsistently across multiple lines.
</I>Which should be pretty simple to implement(leaving aside my C,C++ love 
issues)

&gt;&gt;<i> &gt;I am proposing option #3 be that we have the flag (or ACL type _suffix)
</I>&gt;&gt;<i> &gt;cause parser to generate a similar sub-tree of nodes to what anyof would
</I>&gt;&gt;<i> &gt;generate. BUT using only the specific named type of ACL that the line
</I>&gt;&gt;<i> &gt;was given.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;So this:
</I>&gt;&gt;<i> &gt;  acl foo dstdomain 192.0.2.1
</I>&gt;&gt;<i> &gt;  acl foo dstdomain -n 192.0.2.3
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;or this:
</I>&gt;&gt;<i> &gt;  acl foo dstdomain 192.0.2.1
</I>&gt;&gt;<i> &gt;  acl foo dstdomain_str 192.0.2.3
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;both generates internally a tree identical to:
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;   acl foo:1 dstdomain 192.0.2.1
</I>&gt;&gt;<i> &gt;   acl foo:2 dstdomain -n 192.0.2.3
</I>&gt;&gt;<i> &gt;   acl foo anyof foo:1 foo:2
</I>&gt;<i>
</I>&gt;<i> AFAICT this is the same as optimized #1 I have mentioned earlier (except
</I>&gt;<i> for the _suffix part which I think we should avoid as discussed above).
</I>&gt;<i> To illustrate this even better, you need to add more lines and values:
</I>&gt;<i>
</I>&gt;<i>    acl foo dstdomain v1
</I>&gt;<i>    acl foo dstdomain -n v2a v2b
</I>&gt;<i>    acl foo dstdomain v3
</I>&gt;<i>
</I>&gt;<i> is interpreted after #1 changes as
</I>&gt;<i>
</I>&gt;<i>    acl foo1  dstdomain v1
</I>&gt;<i>    acl foo2a dstdomain -n v2a
</I>&gt;<i>    acl foo2b dstdomain -n v2b
</I>&gt;<i>    acl foo3  dstdomain v3
</I>&gt;<i>    acl foo anyof foo1 foo2a foo2b foo3
</I>&gt;<i>
</I>&gt;<i> Does this match what you think we should do? If yes, what to do about
</I>&gt;<i> backward compatibility? Break it because -n is not that widely used?
</I>
The idea above seems somehow reasonable to me but in the other hand I am 
almost sure that there is a mixture of &quot;do we want to stick with -n 
being one thing in almost all unix systems? or choose another path?&quot;
(I have tried to interpret the admins side of the picture from my eyes 
and maybe couple others on the config file.)

As much as I like the &quot;-n&quot; and as much as I do not want to harm running 
config files I am pretty sure that dstdomain_str would be the easiest 
and maybe(since I am not really 100% sure) the less riskier solution 
from the code side of the picture since it will not bring something that 
is actually new. It will only polish couple things.(*...assumption only*)

So +1 for both ideas but another +0.5 to dstdomain_str just because I 
sometimes just don't like -n and all sort of cryptic meanings that 
shortened words or flags have.

Eliezer

&gt;<i> Thank you,
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004042.html">[squid-dev] [RFC] Where do ACL flags belong?
</A></li>
	<LI>Next message: <A HREF="004045.html">[squid-dev] [RFC] Where do ACL flags belong?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4043">[ date ]</a>
              <a href="thread.html#4043">[ thread ]</a>
              <a href="subject.html#4043">[ subject ]</a>
              <a href="author.html#4043">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
