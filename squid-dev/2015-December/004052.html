<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [RFC] Where do ACL flags belong?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20Where%20do%20ACL%20flags%20belong%3F&In-Reply-To=%3C5661ECBA.4020707%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="004044.html">
   <LINK REL="Next"  HREF="004063.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [RFC] Where do ACL flags belong?</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20Where%20do%20ACL%20flags%20belong%3F&In-Reply-To=%3C5661ECBA.4020707%40measurement-factory.com%3E"
       TITLE="[squid-dev] [RFC] Where do ACL flags belong?">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Dec  4 19:42:50 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="004044.html">[squid-dev] [RFC] Where do ACL flags belong?
</A></li>
        <LI>Next message: <A HREF="004063.html">[squid-dev] [RFC] Where do ACL flags belong?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4052">[ date ]</a>
              <a href="thread.html#4052">[ thread ]</a>
              <a href="subject.html#4052">[ subject ]</a>
              <a href="author.html#4052">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12/04/2015 06:26 AM, Amos Jeffries wrote:
&gt;<i> On 4/12/2015 7:51 p.m., Alex Rousskov wrote:
</I>&gt;&gt;<i> To illustrate this even better, you need to add more lines and values:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   acl foo dstdomain v1
</I>&gt;&gt;<i>   acl foo dstdomain -n v2a v2b
</I>&gt;&gt;<i>   acl foo dstdomain v3
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> is interpreted after #1 changes as
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   acl foo1  dstdomain v1
</I>&gt;&gt;<i>   acl foo2a dstdomain -n v2a
</I>&gt;&gt;<i>   acl foo2b dstdomain -n v2b
</I>&gt;&gt;<i>   acl foo3  dstdomain v3
</I>&gt;&gt;<i>   acl foo anyof foo1 foo2a foo2b foo3
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Does this match what you think we should do?
</I>

&gt;<i> Yes.
</I>

&gt;&gt;<i> If yes, what to do about
</I>&gt;&gt;<i> backward compatibility? Break it because -n is not that widely used?
</I>&gt;<i> 
</I>&gt;<i> Yes. 
</I>
Noted.


&gt;<i> With a +n flag (akin to the +i, re-enabling what -n disabled) we
</I>&gt;<i> can follow -i/+i pattern with an auto-reset at the end of each line but
</I>&gt;<i> add a warning if the +n is omitted on the next one.
</I>
I am not against adding +n support, but I do not recommend forcing users
to add +n, just like we do not force them to add +i.

Now for flags in-between acl values on the same line:

  acl old dstname foo -n bar -x baz

I think we should prohibit general flags between same-line values (-i
support preserved for backward compatibility, but I would probably warn
about it anyway). Such support does not really add much value AFAICT,
but the resulting ACL lines become more and more difficult for a human
to interpret correctly because each flag &quot;area&quot; overlaps subsequent
flags on the same line. KISS.

General flags in front of lines loaded from an acl parameter file should
be supported.


To protect admins from typos and such, we need to prohibit non-quoted
acl values that

a) start with a dash followed by a single character (-x and -x=foo)

and possibly (for future flags)

b) start with two dashes followed by one or more characters (--long and
--long=foo)

Same for those starting with a + sign.

We can start with deprecation warnings (except for +n which will be
mis-interpreted in old configurations read by newer Squid, I guess).


Would you recommend any changes to the above approach?


&gt;<i> The internal implementation of that could be a node listing values to
</I>&gt;<i> check pre-rDNS and a node listing values only checked post-rDNS.
</I>
Most likely, this fix will not be done using multiple ACL nodes because
each ACL class object is meant to combine everything about a single ACL
named foo. We could add more &quot;fake&quot; or &quot;implicit&quot; ACL objects to handle
this, but I think it would be better to change ACLData instead. That's
how I would start anyway.


&gt;<i> Could this be something completed quickly enough for Squid-4?
</I>
IMO, this change can always go into Squid-4 because it is essentially a
bug fix. If Factory does the work, and accounting for current overload
and upcoming holidays, we can probably deliver #1 patch for review by
the end of January 2016, but this is an estimate and not a promise. Do
you want Factory to work on this?


Thank you,

Alex.

</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004044.html">[squid-dev] [RFC] Where do ACL flags belong?
</A></li>
	<LI>Next message: <A HREF="004063.html">[squid-dev] [RFC] Where do ACL flags belong?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4052">[ date ]</a>
              <a href="thread.html#4052">[ thread ]</a>
              <a href="subject.html#4052">[ subject ]</a>
              <a href="author.html#4052">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
