<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Ntlm helper child exceeds limit
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Ntlm%20helper%20child%20exceeds%20limit&In-Reply-To=%3C56696010.3000609%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="004127.html">
   <LINK REL="Next"  HREF="004129.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Ntlm helper child exceeds limit</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Ntlm%20helper%20child%20exceeds%20limit&In-Reply-To=%3C56696010.3000609%40treenet.co.nz%3E"
       TITLE="[squid-dev] Ntlm helper child exceeds limit">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Dec 10 11:20:48 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="004127.html">[squid-dev] Ntlm helper child exceeds limit
</A></li>
        <LI>Next message: <A HREF="004129.html">[squid-dev] [PATCH] Avoid memory leaks when a certificate validator is used with SslBump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4128">[ date ]</a>
              <a href="thread.html#4128">[ thread ]</a>
              <a href="subject.html#4128">[ subject ]</a>
              <a href="author.html#4128">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/12/2015 10:42 p.m., manojmaybe wrote:
&gt;<i> I have used squid 3.3 proxy server with NTLM authentication. I have use the
</I>&gt;<i> squid config file for  maximum of 3000 children.
</I>
Please upgrade your Squid. 3.5 is the current stable release.

&gt;<i> 
</I>&gt;<i> auth_param ntlm children 3000 startup=0 idle=0
</I>&gt;<i> 
</I>&gt;<i> but when traffic is very high ,found that more than 3000 ntlm helper
</I>&gt;<i> children is active (used ps command to get the number of ntlm child process)
</I>&gt;<i> and helper child are going to be crash and showing error cache log
</I>&gt;<i> 
</I>
If you have so many users that you need 3K NTLM helpers then NTLM is
probably the worst thing you could be doing for authentication.

It takes a relatively long time to authenticate a single client
connection, and they are statefully locked the entire time so no other
visitors can use them to authenticate. That causes huge memory resource
consumption in the proxy. And the system has limits on how many AD
connections can be made simulteneously. Winbindd itself starts failing
after 255 concurrent logins, Samba is a bit higher but not 3K.


&gt;<i> 
</I>&gt;<i> read(net): Connection reset by peer
</I>&gt;<i> read(net): Connection reset by peer
</I>&gt;<i> read(net): Connection reset by peer
</I>&gt;<i> read(net): Connection reset by peer
</I>&gt;<i> read(net): Connection reset by peer
</I>
Where is that coming from? Not Squid.

&gt;<i> 2015/12/09 15:01:36 kid2| ERROR: NTLM Authentication Helper '0x160fa948'
</I>&gt;<i> crashed!.
</I>&gt;<i> 2015/12/09 15:01:36 kid2| ERROR: NTLM Authentication validating user. Error
</I>&gt;<i> returned 'BH Internal error'
</I>&gt;<i> 2015/12/09 15:01:36 kid2| WARNING: ntlmauthenticator #1 exited
</I>&gt;<i> 2015/12/09 15:01:36 kid2| Too few ntlmauthenticator processes are running
</I>&gt;<i> (need 1/300)
</I>&gt;<i> 2015/12/09 15:01:36 kid2| Starting new helpers
</I>&gt;<i> 2015/12/09 15:01:36 kid2| helperOpenServers: Starting 1/300 'netcat'
</I>&gt;<i> processes
</I>
Does netcat speak NTLM protocol? or Squid helper protocol for that matter?

AFAIK the netcat tool has a habit of closing connections, but only
half-way. Squid helpers MUST NOT close any of their connections to Squid
unless they are aborting and shutting down.

netcat may also be diverting and hiding critical error messages produced
by whatever the real authenticator is on stderr.

Amos

</PRE>






























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004127.html">[squid-dev] Ntlm helper child exceeds limit
</A></li>
	<LI>Next message: <A HREF="004129.html">[squid-dev] [PATCH] Avoid memory leaks when a certificate validator is used with SslBump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4128">[ date ]</a>
              <a href="thread.html#4128">[ thread ]</a>
              <a href="subject.html#4128">[ subject ]</a>
              <a href="author.html#4128">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
