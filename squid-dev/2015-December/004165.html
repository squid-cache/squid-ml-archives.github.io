<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Note ACL substrings matching
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Note%20ACL%20substrings%20matching&In-Reply-To=%3C566F0F6C.8030108%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="004164.html">
   <LINK REL="Next"  HREF="004404.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Note ACL substrings matching</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Note%20ACL%20substrings%20matching&In-Reply-To=%3C566F0F6C.8030108%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] Note ACL substrings matching">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Dec 14 18:50:20 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="004164.html">[squid-dev] [PATCH] Note ACL substrings matching
</A></li>
        <LI>Next message: <A HREF="004404.html">[squid-dev] [PATCH] Note ACL substrings matching
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4165">[ date ]</a>
              <a href="thread.html#4165">[ thread ]</a>
              <a href="subject.html#4165">[ subject ]</a>
              <a href="author.html#4165">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 15/12/2015 5:43 a.m., Alex Rousskov wrote:
&gt;<i> On 12/14/2015 09:04 AM, Amos Jeffries wrote:
</I>&gt;&gt;<i> Last queston:
</I>&gt;&gt;<i> * why m?
</I>&gt;<i> 
</I>&gt;<i> &quot;m&quot; is for &quot;member&quot; -- this is a list Membership test. If you insist on
</I>&gt;<i> any other character, we will use that instead. For example, I agree that
</I>&gt;<i> &quot;-d&quot; for &quot;delimited&quot; or &quot;-l&quot; for &quot;list&quot; also makes sense.
</I>&gt;<i> 
</I>
Thanks. That was what I was looking for.


Moving on to the more detailed audit;


in src/acl/Acl.cc:

* ACLFlags::FlagsTokenizer::nextFlag()
 - the else condition does not need brackets (up to you, just shorter code)
 - the tokPos should use pre-increment.

* ACLFlags::parseFlags()
 - status member is used outside the switch statement, please use
supported(flag) directly as the switch() parameter.
 - if you keeping it as local variable, please use auto or const auto
type instead of Status. That helps avoid implicit enum casting and
enables safer compiler checks on the switch case values.


in src/acl/Acl.h:

* please remove extra whitespace in &quot;{ }&quot; on the new constructor.

* supported()
 - Status is not a boolean type, so the functinon cannot return &quot;True&quot;.
   this should perhapse reference the enum of states, and say which
one(s) are returned on success case(s).
 - also s/flag supported/flag is supported/ assuming you keep that part
of the text.

* parameterSupported(), parameter(), and isSet()
 - replace &quot;True&quot; with doxygen &quot;\return true&quot;
 - replace &quot;Return&quot; with &quot;\return&quot;
 - also most of the FlagsTokenizer methods need matching changes

* class FlagsTokenizer description
 - please use the (A)BNF syntax:
&quot;
  Support flag tokens in the form:
    flag :=  '-' [A-Z|a-z]+ ['=' parameter ]
&quot;

* pre-existing flags_ documentation has wrong grammar, please take the
oportunity to fix that.
 - it should say &quot;The flags which are set&quot;  (s/is/are)


in src/acl/Note.cc:

* ACLNoteStrategy::match()
 - the request local can be reduced in scope:
&quot;
   if (const auto request = checklist-&gt;request)
&quot;

* ACLNoteStrategy::noteDelimiters()
 - the use of static on a local which gets reset on every use is
pointless. It might as well be a normal local variable.
 - I think enact the TODO


in src/acl/Note.h:
* class pre-defines in alphabetical order please.


in src/acl/NoteData.h:
* #includes in alphabetical order please
 - if that means more includes elsewhere so be it, they have to pass the
.h unit tests anyway.


in src/acl/StringData.cc:
* please add an XXX note that ACLStringData::match(char const *toFind)
now has a performance regression because SBuf(char*) data-copies.
 - it will also need a doxygen &quot;\deprecated use match(SBuf&amp;)&quot; note to
start people using the better one.


in src/cf.data.pre:
* what does &quot;produce an empty token&quot; mean when matching? it cannot be
matched? that needs stating clearly.




Please commit the CharacterSet changes as as separate commit. There are
no audit details found in there, so +1 on CharacterSet right now.

+0 on the rest. most of it is documentation and polish, though there are
a few logic requests. Up to you whether you want to go through another
round of audit or just commit with the changes. I dont think it will
needs to unless you have any objections to the above.

Amos

</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004164.html">[squid-dev] [PATCH] Note ACL substrings matching
</A></li>
	<LI>Next message: <A HREF="004404.html">[squid-dev] [PATCH] Note ACL substrings matching
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4165">[ date ]</a>
              <a href="thread.html#4165">[ thread ]</a>
              <a href="subject.html#4165">[ subject ]</a>
              <a href="author.html#4165">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
