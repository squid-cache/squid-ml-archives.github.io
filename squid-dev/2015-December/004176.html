<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] TLS NPN updates
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20TLS%20NPN%20updates&In-Reply-To=%3C5671F156.7080105%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="004174.html">
   <LINK REL="Next"  HREF="004263.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] TLS NPN updates</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20TLS%20NPN%20updates&In-Reply-To=%3C5671F156.7080105%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] TLS NPN updates">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Dec 16 23:18:46 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="004174.html">[squid-dev] [PATCH] TLS NPN updates
</A></li>
        <LI>Next message: <A HREF="004263.html">[squid-dev] [PATCH] TLS NPN updates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4176">[ date ]</a>
              <a href="thread.html#4176">[ thread ]</a>
              <a href="subject.html#4176">[ subject ]</a>
              <a href="author.html#4176">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 17/12/2015 4:34 a.m., Alex Rousskov wrote:
&gt;<i> On 12/15/2015 10:19 PM, Amos Jeffries wrote:
</I>&gt;&gt;<i> This patch is shuffling the TLS NPN gadgetry into libsecurity.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It would be a non-audit commit except that ...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * there is a new config option added (tls-no-npn) to fully disable NPN
</I>&gt;&gt;<i> on selected peers or ports.
</I>&gt;<i> 
</I>&gt;<i> Please document (in the commit message) why it is sometimes useful to
</I>&gt;<i> disable NPN.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> * ICAPS connections are setting that option by default to prevent NPN
</I>&gt;&gt;<i> wrongly advertising them as HTTPS connections.
</I>&gt;<i> 
</I>&gt;<i> You could add code to advertise ICAP/1.0 connections correctly instead.
</I>&gt;<i> However, that should have been done when NPN support was added and can
</I>&gt;<i> be considered out of this patch scope, so I certainly do not insist on
</I>&gt;<i> this addition.
</I>
I considered that. However NPN is already deprecated as a feature and
only available in aging OpenSSL anyway. I am instead hoping to get ALPN
implemented properly at some point in this process and look towards drop
the NPN.

Along those lines, is there anything you can do to help push the ICAP
people towards getting a formal ALPN assignment for ICAPS ?

&gt;<i> 
</I>&gt;&gt;<i> +        /// do not use the TLS NPN extension on these connections
</I>&gt;&gt;<i> +        bool noTlsNpn;
</I>&gt;<i> 
</I>&gt;<i> Or use it, depending on the data member value. &quot;Whether to use ...&quot; is
</I>&gt;<i> the neutral description variant.
</I>
Okay.

&gt;<i> 
</I>&gt;<i> Please do not add negative (&quot;no-something&quot;) booleans to code. It is
</I>&gt;<i> difficult to read double negations in initializations
</I>&gt;<i> (noSomething=false) and expressions (!noSomething). It is usually
</I>&gt;<i> possible to rename to doSomething (and adjust code) or, if necessary, to
</I>&gt;<i> avoidSomething (without code adjustments) to mitigate those code
</I>&gt;<i> comprehension problems.
</I>
Changing it.

But FTR we do not use or need double negations like that. This and the
other flag options are used to short-circuit logics ie. &quot;if
(flags.noFoo) return;&quot;.  Or in the case of the config parse/dump using
&quot;if (flags.noFoo)&quot; 'flags is true' semantics.

Making these to positive flags just causes the code to use if(!X)
constructs.

I'm okay either way, it just seemed cleaner code this way around.


&gt;<i> 
</I>&gt;<i> Negative options are borderline OK in configuration files (because we
</I>&gt;<i> can add the positive &quot;yes-something&quot; version), although they break the
</I>&gt;<i> option=value convention by essentially placing the value in front of the
</I>&gt;<i> option.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> If there are no objections to those two small changes I would like to
</I>&gt;&gt;<i> fast-track this patch and apply in ~48hrs.
</I>&gt;<i> 
</I>&gt;<i> My suggestions above are not blocking objections.
</I>&gt;<i> 
</I>
Thank you for the review. I have applied as trunk rev.14447.

(PS, and followed up with polishing rev.14448 that changes the
noDefaultCa flag to match).

Amos

</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004174.html">[squid-dev] [PATCH] TLS NPN updates
</A></li>
	<LI>Next message: <A HREF="004263.html">[squid-dev] [PATCH] TLS NPN updates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4176">[ date ]</a>
              <a href="thread.html#4176">[ thread ]</a>
              <a href="subject.html#4176">[ subject ]</a>
              <a href="author.html#4176">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
