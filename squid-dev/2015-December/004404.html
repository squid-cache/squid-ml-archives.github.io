<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Note ACL substrings matching
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Note%20ACL%20substrings%20matching&In-Reply-To=%3C567B9773.7040606%40chtsanti.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="004165.html">
   <LINK REL="Next"  HREF="004109.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Note ACL substrings matching</H1>
    <B>Christos Tsantilas</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Note%20ACL%20substrings%20matching&In-Reply-To=%3C567B9773.7040606%40chtsanti.net%3E"
       TITLE="[squid-dev] [PATCH] Note ACL substrings matching">christos at chtsanti.net
       </A><BR>
    <I>Thu Dec 24 06:57:55 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="004165.html">[squid-dev] [PATCH] Note ACL substrings matching
</A></li>
        <LI>Next message: <A HREF="004109.html">[squid-dev] [RFC] on_crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4404">[ date ]</a>
              <a href="thread.html#4404">[ thread ]</a>
              <a href="subject.html#4404">[ subject ]</a>
              <a href="author.html#4404">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12/14/2015 08:50 PM, Amos Jeffries wrote:
&gt;<i> On 15/12/2015 5:43 a.m., Alex Rousskov wrote:
</I>&gt;&gt;<i> On 12/14/2015 09:04 AM, Amos Jeffries wrote:
</I>&gt;&gt;&gt;<i> Last queston:
</I>&gt;&gt;&gt;<i> * why m?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &quot;m&quot; is for &quot;member&quot; -- this is a list Membership test. If you insist on
</I>&gt;&gt;<i> any other character, we will use that instead. For example, I agree that
</I>&gt;&gt;<i> &quot;-d&quot; for &quot;delimited&quot; or &quot;-l&quot; for &quot;list&quot; also makes sense.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks. That was what I was looking for.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Moving on to the more detailed audit;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> in src/acl/Acl.cc:
</I>&gt;<i>
</I>&gt;<i> * ACLFlags::FlagsTokenizer::nextFlag()
</I>&gt;<i>   - the else condition does not need brackets (up to you, just shorter code)
</I>&gt;<i>   - the tokPos should use pre-increment.
</I>&gt;<i>
</I>&gt;<i> * ACLFlags::parseFlags()
</I>&gt;<i>   - status member is used outside the switch statement, please use
</I>&gt;<i> supported(flag) directly as the switch() parameter.
</I>&gt;<i>   - if you keeping it as local variable, please use auto or const auto
</I>&gt;<i> type instead of Status. That helps avoid implicit enum casting and
</I>&gt;<i> enables safer compiler checks on the switch case values.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> in src/acl/Acl.h:
</I>&gt;<i>
</I>&gt;<i> * please remove extra whitespace in &quot;{ }&quot; on the new constructor.
</I>&gt;<i>
</I>&gt;<i> * supported()
</I>&gt;<i>   - Status is not a boolean type, so the functinon cannot return &quot;True&quot;.
</I>&gt;<i>     this should perhapse reference the enum of states, and say which
</I>&gt;<i> one(s) are returned on success case(s).
</I>&gt;<i>   - also s/flag supported/flag is supported/ assuming you keep that part
</I>&gt;<i> of the text.
</I>&gt;<i>
</I>&gt;<i> * parameterSupported(), parameter(), and isSet()
</I>&gt;<i>   - replace &quot;True&quot; with doxygen &quot;\return true&quot;
</I>&gt;<i>   - replace &quot;Return&quot; with &quot;\return&quot;
</I>&gt;<i>   - also most of the FlagsTokenizer methods need matching changes
</I>&gt;<i>
</I>&gt;<i> * class FlagsTokenizer description
</I>&gt;<i>   - please use the (A)BNF syntax:
</I>&gt;<i> &quot;
</I>&gt;<i>    Support flag tokens in the form:
</I>&gt;<i>      flag :=  '-' [A-Z|a-z]+ ['=' parameter ]
</I>&gt;<i> &quot;
</I>&gt;<i>
</I>&gt;<i> * pre-existing flags_ documentation has wrong grammar, please take the
</I>&gt;<i> oportunity to fix that.
</I>&gt;<i>   - it should say &quot;The flags which are set&quot;  (s/is/are)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> in src/acl/Note.cc:
</I>&gt;<i>
</I>&gt;<i> * ACLNoteStrategy::match()
</I>&gt;<i>   - the request local can be reduced in scope:
</I>&gt;<i> &quot;
</I>&gt;<i>     if (const auto request = checklist-&gt;request)
</I>&gt;<i> &quot;
</I>&gt;<i>
</I>&gt;<i> * ACLNoteStrategy::noteDelimiters()
</I>&gt;<i>   - the use of static on a local which gets reset on every use is
</I>&gt;<i> pointless. It might as well be a normal local variable.
</I>&gt;<i>   - I think enact the TODO
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> in src/acl/Note.h:
</I>&gt;<i> * class pre-defines in alphabetical order please.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> in src/acl/NoteData.h:
</I>&gt;<i> * #includes in alphabetical order please
</I>&gt;<i>   - if that means more includes elsewhere so be it, they have to pass the
</I>&gt;<i> .h unit tests anyway.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> in src/acl/StringData.cc:
</I>&gt;<i> * please add an XXX note that ACLStringData::match(char const *toFind)
</I>&gt;<i> now has a performance regression because SBuf(char*) data-copies.
</I>&gt;<i>   - it will also need a doxygen &quot;\deprecated use match(SBuf&amp;)&quot; note to
</I>&gt;<i> start people using the better one.
</I>&gt;<i>
</I>
All of the above addressed in the patch applied to trunk

&gt;<i>
</I>&gt;<i> in src/cf.data.pre:
</I>&gt;<i> * what does &quot;produce an empty token&quot; mean when matching? it cannot be
</I>&gt;<i> matched? that needs stating clearly.
</I>
Actually this was not true. There are not empty tokens. Two sequential 
separators, eg &quot;,,&quot; handled as one separator.
The  Parser::Tokenizer class is used to get sub-strings, which has this 
behaviour.
The related sentence removed from cf.data.pre documentation.

&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Please commit the CharacterSet changes as as separate commit. There are
</I>&gt;<i> no audit details found in there, so +1 on CharacterSet right now.
</I>
The CharacterSet changes are not needed anymore. The 
ACLNoteStrategy::noteDelimiters() fixes removed the need for this 
changes too.

&gt;<i>
</I>&gt;<i> +0 on the rest. most of it is documentation and polish, though there are
</I>&gt;<i> a few logic requests. Up to you whether you want to go through another
</I>&gt;<i> round of audit or just commit with the changes. I dont think it will
</I>&gt;<i> needs to unless you have any objections to the above.
</I>
I applied the final patch to trunk as r14465.

&gt;<i>
</I>&gt;<i> Amos
</I></PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004165.html">[squid-dev] [PATCH] Note ACL substrings matching
</A></li>
	<LI>Next message: <A HREF="004109.html">[squid-dev] [RFC] on_crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4404">[ date ]</a>
              <a href="thread.html#4404">[ thread ]</a>
              <a href="subject.html#4404">[ subject ]</a>
              <a href="author.html#4404">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
