<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] improve CharacterSet
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20improve%20CharacterSet&In-Reply-To=%3C568089F1.7030401%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="004434.html">
   <LINK REL="Next"  HREF="004457.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] improve CharacterSet</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20improve%20CharacterSet&In-Reply-To=%3C568089F1.7030401%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] improve CharacterSet">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Dec 28 01:01:37 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="004434.html">[squid-dev] [PATCH] improve CharacterSet
</A></li>
        <LI>Next message: <A HREF="004457.html">[squid-dev] [PATCH] improve CharacterSet
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4451">[ date ]</a>
              <a href="thread.html#4451">[ thread ]</a>
              <a href="subject.html#4451">[ subject ]</a>
              <a href="author.html#4451">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 27/12/2015 10:37 p.m., Kinkie wrote:
&gt;<i> On Sun, Dec 27, 2015 at 2:50 AM, Alex Rousskov
</I>&gt;<i> &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">rousskov at measurement-factory.com</A>&gt; wrote:
</I>&gt;&gt;<i> On 12/26/2015 09:03 AM, Kinkie wrote:
</I>&gt;&gt;&gt;<i> Hi all,
</I>&gt;&gt;&gt;<i>   the attached patch improves CharacterSet by adding a subtraction
</I>&gt;&gt;&gt;<i> operator, equality test and associated unit tests.
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> Hi Alex, thanks for taking the time.
</I>&gt;<i> 
</I>&gt;&gt;<i> Perhaps this is different in C++11, but IIRC we are supposed to:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 1. declare non-modifying operators such as &quot;-&quot; outside the class
</I>&gt;<i> 
</I>&gt;<i> That's typical but not mandatory. Changing all to reflect
</I>&gt;<i> 
</I>&gt;&gt;<i> 2. declare an inequality operator &quot;!=&quot; when declaring an equality operator
</I>&gt;<i> 
</I>&gt;<i> If unequality is not tested.. Still, adding it is trivial, so I'm doing that.
</I>&gt;<i> 
</I>&gt;&gt;<i> For #1, you can claim code consistency as an excuse because the &quot;+&quot;
</I>&gt;&gt;<i> operator was already misplaced, but since no existing or proposed code
</I>&gt;&gt;<i> uses the new operators (AFAIK), it seems like it would be a good idea to
</I>&gt;&gt;<i> fix the wrong location before (or while) adding the new [unused] ones.
</I>&gt;<i> 
</I>&gt;<i> Done.
</I>&gt;<i> 
</I>

AFAIK that guideline labeling these as 'misplaced' is all about whether
the global scope has something else where an implicit cast does bad
things. If so then global scope operator is effectively mandatory to
prevent the cast. Otherwise class scope operator works fine, and
preferring class scope helps reduce such clashes in future that might
cast to/from a CharacterSet.

I dont have any preference either way. But it does appear clear that we
should stick to doing it one way or the other consistently.

Shall we pick one and write it into the guidelines?

&gt;&gt;<i> /// set subtraction: remove all characters that are also in src
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &quot;src&quot; is a weird name for the parameter subtraction operator argument.
</I>&gt;&gt;<i> You can cite code consistency as an excuse but consider using &quot;other&quot; or
</I>&gt;&gt;<i> perhaps something like &quot;banned&quot; instead.
</I>&gt;<i> 
</I>&gt;<i> rhs? that's fairly common for operators
</I>
Either IMO.

&gt;<i> 
</I>&gt;&gt;&gt;<i>      /// return a new CharacterSet containing the union of two sets, labeled as the first argument
</I>&gt;&gt;&gt;<i>      CharacterSet operator +(const CharacterSet &amp;src) const;
</I>&gt;&gt;<i> ...
</I>&gt;&gt;&gt;<i> +    /// return a new CharacterSet containing the set of characters in the first but not in the second
</I>&gt;&gt;&gt;<i> +    CharacterSet operator -(const CharacterSet &amp;src) const;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It is funny that you preserved many bad things but decided to drop
</I>&gt;&gt;<i> documentation about the label. Please add it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Please note that neither the old operator &quot;+&quot; nor the new operator &quot;-&quot;
</I>&gt;&gt;<i> have two [explicit] arguments [until they are moved outside the class as
</I>&gt;&gt;<i> discussed in #1 above] so the comment using words &quot;first&quot; and &quot;second&quot;
</I>&gt;&gt;<i> is rather confusing!
</I>&gt;<i> 
</I>&gt;<i> Moved outside class; renamed parameters to lhs and rhs, reworked
</I>&gt;<i> doxygen comment.
</I>&gt;<i> 
</I>

I think we should be adding a remove() method. And implementing the +/-
operators using a loop calling add() and remove().


&gt;&gt;&gt;<i> +static
</I>&gt;&gt;&gt;<i> +std::ostream&amp; operator&lt;&lt; (std::ostream &amp;s, const CharacterSet &amp;c)
</I>&gt;&gt;&gt;<i> +{
</I>&gt;&gt;&gt;<i> +    s &lt;&lt; &quot;CharacterSet(&quot; &lt;&lt; c.name &lt;&lt; ')';
</I>&gt;&gt;&gt;<i> +    return s;
</I>&gt;&gt;&gt;<i> +}
</I>&gt;&gt;&gt;<i> +
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Perhaps this should be provided in the CharacterSet header, for all to
</I>&gt;&gt;<i> use? You would have to split the definition from the declaration to
</I>&gt;&gt;<i> avoid dragging iostream into the header, but this operator feels useful
</I>&gt;&gt;<i> to me, even in its current &quot;primitive&quot; form.
</I>&gt;<i> 
</I>&gt;<i> I've thought about it, and decided not to, as it'd pull in iostream to
</I>&gt;<i> all users of CharacterSet.
</I>&gt;<i> This is mostly meant as a convenience to allow using
</I>&gt;<i> CPPUNIT_ASSERT_EQUAL which is more telling that CPPUNIT_ASSERT but
</I>&gt;<i> requires being able to print arguments.
</I>&gt;<i> 
</I>
It is useful for debugs() as well.

Does using iosfwd and explicitly using inline attribute avoid iostream
in the .cc where the operator is unused?

Amos

</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004434.html">[squid-dev] [PATCH] improve CharacterSet
</A></li>
	<LI>Next message: <A HREF="004457.html">[squid-dev] [PATCH] improve CharacterSet
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4451">[ date ]</a>
              <a href="thread.html#4451">[ thread ]</a>
              <a href="subject.html#4451">[ subject ]</a>
              <a href="author.html#4451">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
