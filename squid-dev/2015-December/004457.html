<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] improve CharacterSet
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20improve%20CharacterSet&In-Reply-To=%3C5680CAC8.9060206%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="004451.html">
   <LINK REL="Next"  HREF="004474.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] improve CharacterSet</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20improve%20CharacterSet&In-Reply-To=%3C5680CAC8.9060206%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] improve CharacterSet">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Dec 28 05:38:16 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="004451.html">[squid-dev] [PATCH] improve CharacterSet
</A></li>
        <LI>Next message: <A HREF="004474.html">[squid-dev] [PATCH] improve CharacterSet
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4457">[ date ]</a>
              <a href="thread.html#4457">[ thread ]</a>
              <a href="subject.html#4457">[ subject ]</a>
              <a href="author.html#4457">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12/27/2015 06:01 PM, Amos Jeffries wrote:
&gt;<i> On 27/12/2015 10:37 p.m., Kinkie wrote:
</I>&gt;&gt;<i> On Sun, Dec 27, 2015 at 2:50 AM, Alex Rousskov wrote:
</I>&gt;&gt;&gt;<i> Perhaps this is different in C++11, but IIRC we are supposed to:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 1. declare non-modifying operators such as &quot;-&quot; outside the class
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> That's typical but not mandatory. Changing all to reflect
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 2. declare an inequality operator &quot;!=&quot; when declaring an equality operator
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If unequality is not tested.. Still, adding it is trivial, so I'm doing that.
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> For #1, you can claim code consistency as an excuse because the &quot;+&quot;
</I>&gt;&gt;&gt;<i> operator was already misplaced, but since no existing or proposed code
</I>&gt;&gt;&gt;<i> uses the new operators (AFAIK), it seems like it would be a good idea to
</I>&gt;&gt;&gt;<i> fix the wrong location before (or while) adding the new [unused] ones.
</I>

&gt;<i> AFAIK that guideline labeling these as 'misplaced' is all about whether
</I>&gt;<i> the global scope has something else where an implicit cast does bad
</I>&gt;<i> things. 
</I>
s/bad/good/

If global implicit casts are possible they must be good (desirable,
intentional, welcomed, etc). If global implicit casts are possible and
are bad, then they have to be removed, of course, but that would mean
that the problem is elsewhere, and, after that other problem is fixed,
any remaining global implicit casts are the good ones.


&gt;<i> Shall we pick one and write it into the guidelines?
</I>
Yes, we should follow the C++ best practice of declaring non-modifying
operators such as &quot;-&quot; outside the class. I am not 100% we can or should
re-document all C++ best practices &quot;locally&quot;, but please do not
misinterpret my doubts as an objection to attempting to do that.



&gt;&gt;&gt;&gt;<i> +static
</I>&gt;&gt;&gt;&gt;<i> +std::ostream&amp; operator&lt;&lt; (std::ostream &amp;s, const CharacterSet &amp;c)
</I>&gt;&gt;&gt;&gt;<i> +{
</I>&gt;&gt;&gt;&gt;<i> +    s &lt;&lt; &quot;CharacterSet(&quot; &lt;&lt; c.name &lt;&lt; ')';
</I>&gt;&gt;&gt;&gt;<i> +    return s;
</I>&gt;&gt;&gt;&gt;<i> +}
</I>&gt;&gt;&gt;&gt;<i> +
</I>
&gt;&gt;&gt;<i> Perhaps this should be provided in the CharacterSet header, for all to
</I>&gt;&gt;&gt;<i> use? You would have to split the definition from the declaration to
</I>&gt;&gt;&gt;<i> avoid dragging iostream into the header, but this operator feels useful
</I>&gt;&gt;&gt;<i> to me, even in its current &quot;primitive&quot; form.
</I>
&gt;&gt;<i> I've thought about it, and decided not to, as it'd pull in iostream to
</I>&gt;&gt;<i> all users of CharacterSet.
</I>&gt;&gt;<i> This is mostly meant as a convenience to allow using
</I>&gt;&gt;<i> CPPUNIT_ASSERT_EQUAL which is more telling that CPPUNIT_ASSERT but
</I>&gt;&gt;<i> requires being able to print arguments.
</I>
&gt;<i> It is useful for debugs() as well.
</I>
Exactly.


&gt;<i> Does using iosfwd and explicitly using inline attribute avoid iostream
</I>&gt;<i> in the .cc where the operator is unused?
</I>
I hope that iosfwd avoids most iostream overheads. That is why I
suggested avoiding iostream in the CharacterSet header.


HTH,

Alex.

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004451.html">[squid-dev] [PATCH] improve CharacterSet
</A></li>
	<LI>Next message: <A HREF="004474.html">[squid-dev] [PATCH] improve CharacterSet
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4457">[ date ]</a>
              <a href="thread.html#4457">[ thread ]</a>
              <a href="subject.html#4457">[ subject ]</a>
              <a href="author.html#4457">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
