<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] SBuf API improvements
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20SBuf%20API%20improvements&In-Reply-To=%3C5681A947.6020108%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="004460.html">
   <LINK REL="Next"  HREF="004469.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] SBuf API improvements</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20SBuf%20API%20improvements&In-Reply-To=%3C5681A947.6020108%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] SBuf API improvements">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Dec 28 21:27:35 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="004460.html">[squid-dev] [PATCH] SBuf API improvements
</A></li>
        <LI>Next message: <A HREF="004469.html">[squid-dev] [PATCH] SBuf API improvements
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4465">[ date ]</a>
              <a href="thread.html#4465">[ thread ]</a>
              <a href="subject.html#4465">[ subject ]</a>
              <a href="author.html#4465">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12/28/2015 06:41 AM, Kinkie wrote:

&gt;<i>   the attached patch is a proposal for a couple of small extensions to
</I>&gt;<i> SBuf, which are meant to make it more API-compatible with std::string.
</I>
... as well as increase the probability of callers using the wrong SBuf
API as discussed below.


&gt;<i> - it adds a &quot;fill&quot; operator: append(size_type n, char c)
</I>&gt;<i> - it aliases append(char) to push_back(char)
</I>
If this change goes forward, I recommend removing our custom
append(char) because it conflicts with the other &quot;standard&quot; append,
increasing API confusion:

  string&amp; append(const char* s);

The old append(char) calling code would need to be adjusted to call
push_back(), of course.



&gt;<i> - it aliases reserveCapacity to reserve
</I>
The standard reserve() has a default argument value of zero. Yours does
not. If you want compatibility, you have to provide that default IMO.


&gt;<i> It is debateable whether reserveCapacity should be just renamed
</I>&gt;<i> instead of aliased; feedback is welcome.
</I>
I do not have a strong opinion on this. reserveCapacity() is not called
reserve() today because we also have reserveSpace() and knowing that
there are two different methods is important for some callers. Once you
add plain reserve(), the probability that a caller will notice
reserveSpace() that the caller needs will go down.


&gt;<i> The objective of this change will be clear in the followup rfc3986
</I>&gt;<i> patch, which is templatized in order to be available both to helpers
</I>&gt;<i> who use std::string and to squid using SBuf.
</I>
SBuf is already suffering from being too many things to too many
different callers. I suspect that requiring API compatibility with
std::string [in certain poorly defined areas] will make the situation
worse, but I cannot prove that. Same for writing templated code that can
work with both std::string and SBuf.

If helpers really need SBuf, give them SBuf. If helpers want to use
std::string, they already can. Assuring that one can be substituted with
another feels like a false goal that would bring more trouble in the
long run than it would help in the short term. Again, I cannot prove
that and will not veto these changes.


HTH,

Alex.

</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004460.html">[squid-dev] [PATCH] SBuf API improvements
</A></li>
	<LI>Next message: <A HREF="004469.html">[squid-dev] [PATCH] SBuf API improvements
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4465">[ date ]</a>
              <a href="thread.html#4465">[ thread ]</a>
              <a href="subject.html#4465">[ subject ]</a>
              <a href="author.html#4465">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
