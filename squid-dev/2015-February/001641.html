<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [RFC] Secure ICAP
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20Secure%20ICAP&In-Reply-To=%3C54DD5AC9.80509%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="001640.html">
   <LINK REL="Next"  HREF="001451.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [RFC] Secure ICAP</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20Secure%20ICAP&In-Reply-To=%3C54DD5AC9.80509%40treenet.co.nz%3E"
       TITLE="[squid-dev] [RFC] Secure ICAP">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Feb 13 02:00:41 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="001640.html">[squid-dev] [RFC] Secure ICAP
</A></li>
        <LI>Next message: <A HREF="001451.html">[squid-dev] Build failed in Jenkins: trunk-matrix » gcc,j-fbsd-93 #74
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1641">[ date ]</a>
              <a href="thread.html#1641">[ thread ]</a>
              <a href="subject.html#1641">[ subject ]</a>
              <a href="author.html#1641">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 13/02/2015 11:51 a.m., Alex Rousskov wrote:
&gt;<i> On 02/03/2015 07:02 PM, Amos Jeffries wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> My plan for the Crypto-NG / libsecurity work already in audit was to
</I>&gt;&gt;<i> followup with a Security::Encryptor AsyncJob that could be passed the
</I>&gt;&gt;<i> Comm::Connection object from a newely opened connection plus the
</I>&gt;&gt;<i> Security::PeerOptions from squid.conf and initiate TLS/SSL on the
</I>&gt;&gt;<i> connection.
</I>&gt;<i> 
</I>&gt;<i> We already have PeerConnector -- an async job that encapsulates most of
</I>&gt;<i> the security-related logic when it comes to connecting to other servers.
</I>&gt;<i> It is used by TunnelStateData, FwdState, and PeerPoolMgr. I doubt you
</I>&gt;<i> need another job that does the same.
</I>&gt;<i> 
</I>
Is that class what you are proposing be used by ICAP? if not, then you
already have the answer why we need something slighty different.

Essentially yes, but its very tightly bound in design to how OpenSSL's
API operates.

&gt;<i> 
</I>&gt;&gt;<i> That model is reusable for cache_peer, DIRECT connections, ICAP, and any
</I>&gt;&gt;<i> other protocols which use the X-over-TLS protocol layering. Without any
</I>&gt;&gt;<i> major changes to the existing code - we just update the appropriate Comm
</I>&gt;&gt;<i> callback to kick off the new Security::Encryptor job once the server FD
</I>&gt;&gt;<i> is opened.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I would like to push that update forward rather than anyone writing
</I>&gt;&gt;<i> another protocol-specific connection setup pathway. A good chunk of the
</I>&gt;&gt;<i> preparation work is already done, so the time to completion would also
</I>&gt;&gt;<i> be faster than a new project.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Sure, we would gladly reuse anything available as long as we do not have
</I>&gt;<i> to wait for it. AFAICT, if we use PeerConnector for Secure ICAP, and
</I>&gt;<i> your NG changes go inside PeerConnector, then we will not be stepping on
</I>&gt;<i> each other toes too much.
</I>
Okay.

The Encryptor I have sketched out so far can be a parent to
PeerConnector but without the SSL-Bump specific parts. I've been working
on figuring which bits are agnostic by making it PeerConnectors' parent
and abstracting upwards with an eye towards making Ssl::PeerConnector
the OpenSSL interface and a Tls::PeerConnector for the GnuTLS
alternative - with shared parts all in the NG Security::Encryptor.

Amos

</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001640.html">[squid-dev] [RFC] Secure ICAP
</A></li>
	<LI>Next message: <A HREF="001451.html">[squid-dev] Build failed in Jenkins: trunk-matrix » gcc,j-fbsd-93 #74
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1641">[ date ]</a>
              <a href="thread.html#1641">[ thread ]</a>
              <a href="subject.html#1641">[ subject ]</a>
              <a href="author.html#1641">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
