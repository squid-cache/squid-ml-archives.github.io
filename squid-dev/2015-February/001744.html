<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Digest related question.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Digest%20related%20question.&In-Reply-To=%3C54EB0081.2000307%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="001737.html">
   <LINK REL="Next"  HREF="001746.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Digest related question.</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Digest%20related%20question.&In-Reply-To=%3C54EB0081.2000307%40treenet.co.nz%3E"
       TITLE="[squid-dev] Digest related question.">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Feb 23 10:27:13 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="001737.html">[squid-dev] Digest related question.
</A></li>
        <LI>Next message: <A HREF="001746.html">[squid-dev] Digest related question.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1744">[ date ]</a>
              <a href="thread.html#1744">[ thread ]</a>
              <a href="subject.html#1744">[ subject ]</a>
              <a href="author.html#1744">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 22/02/2015 2:31 p.m., Eliezer Croitoru wrote:
&gt;<i> On 22/02/2015 02:46, Amos Jeffries wrote:
</I>&gt;&gt;<i> The response to a HEAD request is supposed to be exactly identical to a
</I>&gt;&gt;<i> response to the GET, but with the body/payload/entity cropped off. Even
</I>&gt;&gt;<i> the Content-Length headers etc should be present saying what size the
</I>&gt;&gt;<i> body would have been.
</I>&gt;<i> 
</I>&gt;<i> So just to make sure I understand the reality:
</I>&gt;<i> In a case I start squid with 0 objects and run only one transaction of a
</I>&gt;<i> GET request it would create two objects?
</I>&gt;<i> From what I have seen in the code in the past(very long ago) I remember
</I>&gt;<i> that it might not be this way.
</I>&gt;<i> So I cannot just run a HEAD request and expect it to reflect too much
</I>&gt;<i> information about the cached data.
</I>
No, once the GET request is cached Squid can answer either GET or HEAD
requests using it.

&gt;<i> 
</I>&gt;<i> About the store log, I have one issue with it and it is that I would not
</I>&gt;<i> be able to &quot;know&quot; if the object is in the cache unless I will follow
</I>&gt;<i> everything in the store log including cache removals.
</I>
Yes. Thats why its only suitable for the proof of concept.

The final version had probably best use HTCP to query the cache index
live. But until the Link feature you are experimenting with has actually
been implemented in Squid that will not work since HTCP does not
understand the Link keys.

The choice is between doing a PoC with not-easy interface, or just
designing and writing the feature in-place.


&gt;<i> 
</I>&gt;<i> So one process that will follow the store log and will store it will be
</I>&gt;<i> enough to supply the currently &quot;cached&quot; object list per squid instance
</I>&gt;<i> start till the squid shuts down.
</I>&gt;<i> In a case I would try to &quot;save&quot; it for after a shutdown would be more
</I>&gt;<i> difficult.
</I>&gt;<i> 
</I>&gt;<i> From another point of view which is the actual content digest I would
</I>&gt;<i> need some way to receive the file\response content and I was thinking
</I>&gt;<i> about an ICAP based solution which might be combined with the store log
</I>&gt;<i> &quot;follower&quot;.
</I>&gt;<i> 
</I>

IIRC, some while back Alex was working on providing Content-MD5 hashes
for all cached objects. I forget what happend to that project. Its
needed for other things too, so would be worth getting into trunk.


&gt;<i> I have a situation in mind for some situation with this kind of a setup:
</I>&gt;<i> Fetch a URL which will be digested as we go and then will be &quot;followed&quot;
</I>&gt;<i> and in a case the associated url will be purged from the cache the
</I>&gt;<i> digest will also be erased from the DB.
</I>&gt;<i> 
</I>&gt;<i> Now the next part is the right way to &quot;know&quot; if there is a way to
</I>&gt;<i> pre-find the request digest from the origin server.
</I>&gt;<i> And it seems like a HEAD request to the origin server might be enough.
</I>&gt;<i> So the origin server must be publicly accessible so the &quot;follower&quot; might
</I>&gt;<i> be able to fetch a HEAD of the file and lookup any digest data in the
</I>&gt;<i> response.
</I>
Only if the upstream server delivers Content-MD5 or similar in the
response headers (*not* ETag). HEAD or HTCP query should then return it.


&gt;<i> In turn a metalink file link in the HEAD headers might be usable for a
</I>&gt;<i> more complicated options.
</I>&gt;<i> There is another issue with digest &quot;validation&quot; which can be considered
</I>&gt;<i> as an option for black\white list a server for digest\metalink credibility.
</I>&gt;<i> 
</I>&gt;<i> Do you think this idea looks a bit sane?
</I>
Yes.

Amos
</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001737.html">[squid-dev] Digest related question.
</A></li>
	<LI>Next message: <A HREF="001746.html">[squid-dev] Digest related question.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1744">[ date ]</a>
              <a href="thread.html#1744">[ thread ]</a>
              <a href="subject.html#1744">[ subject ]</a>
              <a href="author.html#1744">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
