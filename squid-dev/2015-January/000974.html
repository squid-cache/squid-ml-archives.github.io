<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [MERGE] Fix splay
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BMERGE%5D%20Fix%20splay&In-Reply-To=%3CCA%2BY8hcNMGR3Vu%3DXnLFZESwWcGJTu%3DTFEvBQ1Fm89GO4sHxV%3Drw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="001097.html">
   <LINK REL="Next"  HREF="000975.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [MERGE] Fix splay</H1>
    <B>Kinkie</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BMERGE%5D%20Fix%20splay&In-Reply-To=%3CCA%2BY8hcNMGR3Vu%3DXnLFZESwWcGJTu%3DTFEvBQ1Fm89GO4sHxV%3Drw%40mail.gmail.com%3E"
       TITLE="[squid-dev] [MERGE] Fix splay">gkinkie at gmail.com
       </A><BR>
    <I>Fri Jan  2 10:25:58 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="001097.html">[squid-dev] Jenkins build is back to normal : 3.HEAD-amd64-ubuntu-precise-clang #60
</A></li>
        <LI>Next message: <A HREF="000975.html">[squid-dev] [MERGE] Fix splay
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#974">[ date ]</a>
              <a href="thread.html#974">[ thread ]</a>
              <a href="subject.html#974">[ subject ]</a>
              <a href="author.html#974">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,
  splay uses lots of C-isms still, which make recent clang fail the build badly.

Things like:
SplayNode&lt;foo&gt; *root = NULL
root-&gt;insert(data)

The attached patch :
- migrates all clients from using the now-private SplayNode API to Splay
- fixes Splay to account for some corner-cases
- removes always-true or always-false conditionals in SplayNode (if
(this == NULL))
- ports parts of the unit test (most were not ported assuming the aim
is to test the private API)

This builds and checks fine on ubuntu utopic with gcc and clang (clang
halts the build on a similar issue in src/comm/Read.cc but that's
another topic).

Public branch is at lp:~squid/squid/splayfix

To me this is a reasonable merge candidate; please review.

Thanks

-- 
    Francesco
-------------- next part --------------
A non-text attachment was scrubbed...
Name: splayfix-v1.patch
Type: text/x-diff
Size: 49876 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20150102/8e6bed11/attachment-0001.patch">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20150102/8e6bed11/attachment-0001.patch</A>&gt;
</PRE>












































































































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001097.html">[squid-dev] Jenkins build is back to normal : 3.HEAD-amd64-ubuntu-precise-clang #60
</A></li>
	<LI>Next message: <A HREF="000975.html">[squid-dev] [MERGE] Fix splay
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#974">[ date ]</a>
              <a href="thread.html#974">[ thread ]</a>
              <a href="subject.html#974">[ subject ]</a>
              <a href="author.html#974">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
