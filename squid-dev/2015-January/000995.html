<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Non-HTTP bypass
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Non-HTTP%20bypass&In-Reply-To=%3C54A6D31F.8070908%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="000984.html">
   <LINK REL="Next"  HREF="001110.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Non-HTTP bypass</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Non-HTTP%20bypass&In-Reply-To=%3C54A6D31F.8070908%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] Non-HTTP bypass">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Jan  2 17:19:27 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="000984.html">[squid-dev] [PATCH] Non-HTTP bypass
</A></li>
        <LI>Next message: <A HREF="001110.html">[squid-dev] [PATCH] Non-HTTP bypass
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#995">[ date ]</a>
              <a href="thread.html#995">[ thread ]</a>
              <a href="subject.html#995">[ subject ]</a>
              <a href="author.html#995">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 01/02/2015 09:16 AM, Marcus Kool wrote:
&gt;<i> On 12/31/2014 02:31 PM, Alex Rousskov wrote:
</I>&gt;&gt;<i> On 12/31/2014 03:33 AM, Marcus Kool wrote:
</I>&gt;&gt;&gt;<i> On 12/31/2014 05:54 AM, Alex Rousskov wrote:
</I>&gt;&gt;&gt;&gt;<i> What would help is to decide whether we want to focus on
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>     A) multiple conditions for establishing a TCP tunnel;
</I>&gt;&gt;&gt;&gt;<i>     B) multiple ways to handle an unrecognized protocol error; OR
</I>&gt;&gt;&gt;&gt;<i>     C) multiple ways to handle multiple errors.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> IMO, we want (B) or perhaps (C) while leaving (A) as a separate
</I>&gt;&gt;&gt;&gt;<i> out-of-scope feature.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> The proposed patch implements (B). To implement (C), the patch needs to
</I>&gt;&gt;&gt;&gt;<i> add an ACL type to distinguish an &quot;unrecognized protocol&quot; error from
</I>&gt;&gt;&gt;&gt;<i> other errors.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  From an administrators point of view, the admins that want Squid to
</I>&gt;&gt;&gt;<i> filter internet access, definitely want (B).  They want (B) to block
</I>&gt;&gt;&gt;<i> audio, video, SSH tunnnels, VPNs, chat, file sharing, webdisks and all
</I>&gt;&gt;&gt;<i> sorts of applications (but not all!) that use port 443.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Agreed, except this is not limited to port 443. The scope includes
</I>&gt;&gt;<i> intercepted port 80 connections and even CONNECT tunnels.
</I>
&gt;<i> If CONNECT tunnels are in scope, then so are all the applications that
</I>&gt;<i> use it, including webdisk, audio, video, SSH etc.
</I>
Yes, of course. The receiving Squid port and current connection state
affects what protocol Squid expects to find/parse, whether Squid may
perform (or has performed) bumping, etc., but all those decisions and
actions happen before and/or after the new feature kicks in. The
detection of an unsupported protocol and computation of the
corresponding tunnel/respond decision is what we focus on here.


&gt;<i> I think it was Amos who said that application builders hould use
</I>&gt;<i> application-specific
</I>&gt;<i> ports, but reality is that all firewalls block those ports by default.
</I>
Yes, the &quot;each application has a dedicated port&quot; idea[l] is too far from
reality to matter.


&gt;&gt;&gt;<i> Basically
</I>&gt;&gt;&gt;<i> this means that admins desire a more fine-grained control about what to
</I>&gt;&gt;&gt;<i> do with each tunnel.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> There are two different needs here, actually:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 1. A choice of actions (i.e., &quot;what to do&quot;) when dealing with an
</I>&gt;&gt;<i> unsupported protocol. Currently, there is only one action: Send an HTTP
</I>&gt;&gt;<i> error response. The proposed feature adds another action (tunnel) and,
</I>&gt;&gt;<i> more importantly, adds a configuration interface to support more actions
</I>&gt;&gt;<i> later.
</I>&gt;<i> 
</I>&gt;<i> Sending an HTTP error to an application that does not speak HTTP is not
</I>&gt;<i> very useful.  Skype, SSH, videoplayers etc. only get confused at best.
</I>&gt;<i> Simply closing the tunnel may be better and may result in an end user
</I>&gt;<i> message
</I>&gt;<i> 'cannot connect to ...' instead of 'server sends garbage' or 'undefined
</I>&gt;<i> protocol'.
</I>

I may have already mentioned that &quot;terminate&quot; is another candidate
action. For now, it is possible to emulate that action in some
deployments by using custom &quot;TCP_RESET&quot; error bodies, but that hack is
too rigid: It does not discriminate the error context/environment. That
is what ACLs in the new feature are meant to do.

Whether it is better to simply terminate the connection or send some
diagnostic text to the user client should be up to the admin to decide.
Different deployment environments will benefit from different actions.
The proposed feature builds the initial framework for those decisions.


Cheers,

Alex.

</PRE>

































































































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000984.html">[squid-dev] [PATCH] Non-HTTP bypass
</A></li>
	<LI>Next message: <A HREF="001110.html">[squid-dev] [PATCH] Non-HTTP bypass
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#995">[ date ]</a>
              <a href="thread.html#995">[ thread ]</a>
              <a href="subject.html#995">[ subject ]</a>
              <a href="author.html#995">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
