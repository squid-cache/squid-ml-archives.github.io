<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Non-HTTP bypass
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Non-HTTP%20bypass&In-Reply-To=%3C54B56243.5030006%40users.sourceforge.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="001133.html">
   <LINK REL="Next"  HREF="001156.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Non-HTTP bypass</H1>
    <B>Tsantilas Christos</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Non-HTTP%20bypass&In-Reply-To=%3C54B56243.5030006%40users.sourceforge.net%3E"
       TITLE="[squid-dev] [PATCH] Non-HTTP bypass">chtsanti at users.sourceforge.net
       </A><BR>
    <I>Tue Jan 13 18:21:55 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="001133.html">[squid-dev] [PATCH] Non-HTTP bypass
</A></li>
        <LI>Next message: <A HREF="001156.html">[squid-dev] [PATCH] Non-HTTP bypass
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1146">[ date ]</a>
              <a href="thread.html#1146">[ thread ]</a>
              <a href="subject.html#1146">[ subject ]</a>
              <a href="author.html#1146">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I made all requested changes/fixes.
The patch also ported to latest trunk.


On 01/12/2015 06:46 PM, Amos Jeffries wrote:
&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i> Hash: SHA1
</I>&gt;<i>
</I>&gt;<i> On 31/12/2014 11:40 p.m., Tsantilas Christos wrote:
</I>&gt;&gt;<i> On 12/31/2014 09:54 AM, Alex Rousskov wrote:
</I>&gt;&gt;&gt;<i> On 12/30/2014 06:19 PM, Amos Jeffries wrote:
</I>&gt;&gt;&gt;&gt;<i> On 31/12/2014 7:30 a.m., Alex Rousskov wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Amos, if on_first_request_error is converted into on_error
</I>&gt;&gt;&gt;&gt;&gt;<i> with a first_request (or similar) ACL, would you continue to
</I>&gt;&gt;&gt;&gt;&gt;<i> block this frequently-requested bypass feature?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Mosly I am waiting to see an updated patch. The blocker was on
</I>&gt;&gt;&gt;&gt;<i> waiting for Parser-NG request handling re-write which is now
</I>&gt;&gt;&gt;&gt;<i> in.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I am interpreting your answer as a &quot;no&quot; and ask Christos to
</I>&gt;&gt;&gt;<i> update the patch to better integrate with the new parsing code.
</I>&gt;&gt;&gt;<i> AFAIK, the only integration is in detecting an &quot;HTTP request
</I>&gt;&gt;&gt;<i> parsing has failed&quot; condition, which is hopefully easy.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> OK I will post an updated patch. If the problem is only the name
</I>&gt;&gt;<i> then we can easily change it.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> It seems the updated patch submission did not get through to me for
</I>&gt;<i> review. Sorry about that and the delay its caused. Here is the review:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> * Regarding &quot;ERR_WRONG_PROTOCOL&quot;
</I>&gt;<i>   Please call this ERR_PROTOCOL_UNKNOWN. There is no clear &quot;wrong&quot; to
</I>&gt;<i> be fixed.
</I>
Fixed.

&gt;<i>
</I>&gt;<i>
</I>&gt;<i> * add the copyright blurb from scripts/boilerplate.h to the top of all
</I>&gt;<i> new source code files.
</I>&gt;<i>   - please see the latest version of other ERR_ templates for how to
</I>&gt;<i> copyright the new template.
</I>
Yep. fixed.

&gt;<i>
</I>&gt;<i>
</I>&gt;<i> in src/acl/SquidError.h:
</I>&gt;<i> * dont add dead code: //virtual bool requiresRequest() ...
</I>
line removed.

&gt;<i>
</I>&gt;<i>
</I>&gt;<i> in src/acl/SquidErrorData.cc:
</I>&gt;<i> * please bump the debugs level in ACLSquidErrorData::match() to
</I>&gt;<i> something deeper (eg 3 or 4). We dont need a high level log entry on
</I>&gt;<i> every attempted value match.
</I>
fixed

&gt;<i>
</I>&gt;<i> * ACLSquidErrorData::parse() should be able to have token declared n
</I>&gt;<i> the while() scope, like so:
</I>&gt;<i>    while (char *token = ...) {
</I>
fixed

&gt;<i>
</I>&gt;<i> * debugs error message missing &quot;FATAL: &quot; prefix in
</I>&gt;<i> ACLSquidErrorData::parse().
</I>
&gt;<i>   - Also, this is a relatively minor config issue for which the
</I>&gt;<i> self_destruct() can be skipped when doing -k parse (if global variable
</I>&gt;<i> opt_parse_cfg_only is set non-0). Though leave the FATAL debugs
</I>&gt;<i> message displaying.
</I>
I add the &quot;FATAL: &quot; prefix and  self_destruct called only when 
opt_parse_cfg_only is not set.

&gt;<i>
</I>&gt;<i>
</I>&gt;<i> in src/cf.data.pre:
</I>&gt;<i> * instead of &quot;DEFAULT: none&quot; please use &quot;DEFAULT_DOC: ...&quot; to state a
</I>&gt;<i> one-line about what happens if there are none of these directive lines
</I>&gt;<i> configured.
</I>&gt;<i>   eg. DEFAULT_DOC: Respond with an error message to unidentifiable traffic.
</I>&gt;<i>
</I>
OK. I left &quot;DEFAULT: none&quot;, looks that other directives have both 
&quot;DEFAULT: none&quot; and DEFAULT_DOC

&gt;<i>
</I>&gt;<i> in src/client_side.cc:
</I>&gt;<i> * dont add HERE in new debugs() in clientTunnelOnError()
</I>
OK.

&gt;<i>
</I>&gt;<i> * fix \retval documentation on Squid_SSL_accept()
</I>&gt;<i>   - &quot;\retval&quot; takes two parameters: VALUE MEANING_OF_VALUE
</I>
fixed

&gt;<i>
</I>&gt;<i> * clientPeekAndSpliceSSL() has the ConnStateData object (conn)
</I>&gt;<i> available with its conn-&gt;clientConnection.
</I>&gt;<i>   - IF (only if) the &quot;fd&quot; being closed is supposed to be the client
</I>&gt;<i> connection rather than other FD, then please use
</I>&gt;<i> conn-&gt;clientConnection-&gt;close() to close it cleanly.
</I>
Yes the client connection is closed here. I am using 
conn-&gt;clientConnection-&gt;close() now.

&gt;<i>
</I>&gt;<i>
</I>&gt;<i> in src/client_side.h:
</I>&gt;<i> * issues with \retval again for spliceOnError()
</I>&gt;<i>
</I>&gt;<i> * grammar in docs for preservedClientData:   s/as is/as-is/
</I>&gt;<i>
</I>&gt;<i> * lowercase 'True' in docs for receivedFirstByte_
</I>
ok.

&gt;<i>
</I>&gt;<i>
</I>&gt;<i> in src/http/one/RequestParser.cc:
</I>&gt;<i> * accepting the full range of valid method characters is important,
</I>&gt;<i> the new implementation will make us start to fail some coadvisor
</I>&gt;<i> testing for special cased methods like the dot (.) method, and WebDAV
</I>&gt;<i> extension methods with hyphens or underscores, etc.
</I>&gt;<i>   NP: I am not aware of any other characters being used, but if the
</I>&gt;<i> mechanism to test is easily extended we can fill others in later.
</I>
You are right.
Now I am accepting as valid chars any printable ascii. I hope it is OK.

&gt;<i>
</I>&gt;<i>
</I>&gt;<i> in src/servers/HttpServer.cc:
</I>&gt;<i> * missing body to two if-statements in buildHttpRequest().
</I>&gt;<i>    - if (!clientTunnelOnError(...)) {/* missing code ?? */}
</I>&gt;<i>   please fix or document why nothing is done.
</I>
It is OK as is.
We may want to call clientProcessRequestFinished(), because maybe in the 
future executes code which is required. But not it is not required.

Regards,
    Christos



&gt;<i>
</I>&gt;<i>
</I>&gt;<i> HTH
</I>&gt;<i> Amos
</I>&gt;<i> -----BEGIN PGP SIGNATURE-----
</I>&gt;<i> Version: GnuPG v2.0.22 (MingW32)
</I>&gt;<i>
</I>&gt;<i> iQEcBAEBAgAGBQJUs/paAAoJELJo5wb/XPRjf3sIAOC85ezF2m2OvqbLSxDwGoO1
</I>&gt;<i> dkLmHHGqQv1X5qcyWzDXlS2XFP67zNCwcCiuLnT5nqsF4tcGTAZ3Phi9+LQTlR18
</I>&gt;<i> H67Qp6uSJLzKLeVCdjEEbvAOPtJ8EldkkhlMFOEaKzhVKqNStqXjg8SUOkYJz/V7
</I>&gt;<i> Ouo8G/Re0StVp3w4WtHND0zDGh6Dupw4B+E7EBfxMu61MjqXB4WzAcgzIqIQeT8/
</I>&gt;<i> phJT4ObSYyOvHEPRIeAUGrMrryr5wwmKTynhB6xbT9Q4Kks0bzirdjhaiKVffIdm
</I>&gt;<i> mMTHKuUbJesouAGZSTueXBBU9AobpRGVSecfDiLfFTJL7Fy417jIKtfqDsnsHUU=
</I>&gt;<i> =wIBa
</I>&gt;<i> -----END PGP SIGNATURE-----
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-dev mailing list
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">http://lists.squid-cache.org/listinfo/squid-dev</A>
</I>&gt;<i>
</I>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: trunk-non-HTTP-bypass-v8.patch
Type: text/x-patch
Size: 94416 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20150113/caecd58b/attachment-0001.bin">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20150113/caecd58b/attachment-0001.bin</A>&gt;
</PRE>



























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001133.html">[squid-dev] [PATCH] Non-HTTP bypass
</A></li>
	<LI>Next message: <A HREF="001156.html">[squid-dev] [PATCH] Non-HTTP bypass
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1146">[ date ]</a>
              <a href="thread.html#1146">[ thread ]</a>
              <a href="subject.html#1146">[ subject ]</a>
              <a href="author.html#1146">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
