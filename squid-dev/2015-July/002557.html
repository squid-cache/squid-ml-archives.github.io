<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Errors served using invalid certificates when dealing with SSL server errors.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Errors%20served%20using%20invalid%20certificates%20when%0A%20dealing%20with%20SSL%20server%20errors.&In-Reply-To=%3C559BFE37.3010101%40users.sourceforge.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="002573.html">
   <LINK REL="Next"  HREF="002570.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Errors served using invalid certificates when dealing with SSL server errors.</H1>
    <B>Tsantilas Christos</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Errors%20served%20using%20invalid%20certificates%20when%0A%20dealing%20with%20SSL%20server%20errors.&In-Reply-To=%3C559BFE37.3010101%40users.sourceforge.net%3E"
       TITLE="[squid-dev] [PATCH] Errors served using invalid certificates when dealing with SSL server errors.">chtsanti at users.sourceforge.net
       </A><BR>
    <I>Tue Jul  7 16:28:39 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="002573.html">[squid-dev] Jenkins build is back to normal : trunk-matrix » clang,d-fedora-21 #239
</A></li>
        <LI>Next message: <A HREF="002570.html">[squid-dev] [PATCH] Errors served using invalid certificates when dealing with SSL server errors.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2557">[ date ]</a>
              <a href="thread.html#2557">[ thread ]</a>
              <a href="subject.html#2557">[ subject ]</a>
              <a href="author.html#2557">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

When bumping Squid needs to send an Squid-generated error &quot;page&quot; over a 
secure connection, Squid needs to generate a certificate for that 
connection. Prior to these changes, several scenarios could lead to 
Squid generating a certificate that clients could not validate. In those 
cases, the user would get a cryptic and misleading browser error instead 
of a Squid-generated error page with useful details about the problem.

For example, is a server certificate that is rejected by the certificate 
validation helper. Squid no longer uses CN from that certificate to 
generate a fake certificate.

Another example is a user accessing an origin server using one of its 
&quot;alternative names&quot; and getting a Squid-generated certificate containing 
just the server common name (CN).

These changes make sure that certificate for error pages is generated 
using SNI (when peeking or staring, if available) or CONNECT host name 
(including server-first bumping mode). We now update the 
ConnStateData::sslCommonName  field (used as CN field for generated 
certificates) only _after_ the server certificate is successfully validated.

This is a Measurement Factory project.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Invalid-Certificate-on-Blocked-SSL-Errors-trunk-t2.patch
Type: text/x-patch
Size: 6675 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20150707/3d44489b/attachment.bin">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20150707/3d44489b/attachment.bin</A>&gt;
</PRE>























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002573.html">[squid-dev] Jenkins build is back to normal : trunk-matrix » clang,d-fedora-21 #239
</A></li>
	<LI>Next message: <A HREF="002570.html">[squid-dev] [PATCH] Errors served using invalid certificates when dealing with SSL server errors.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2557">[ date ]</a>
              <a href="thread.html#2557">[ thread ]</a>
              <a href="subject.html#2557">[ subject ]</a>
              <a href="author.html#2557">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
