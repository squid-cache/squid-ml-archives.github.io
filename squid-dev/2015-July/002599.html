<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [RFC] removal of http(s)_port clientca= parameter
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20removal%20of%20http%28s%29_port%20clientca%3D%20parameter&In-Reply-To=%3C55A21421.5010408%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="002613.html">
   <LINK REL="Next"  HREF="002614.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [RFC] removal of http(s)_port clientca= parameter</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20removal%20of%20http%28s%29_port%20clientca%3D%20parameter&In-Reply-To=%3C55A21421.5010408%40treenet.co.nz%3E"
       TITLE="[squid-dev] [RFC] removal of http(s)_port clientca= parameter">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Jul 12 07:15:45 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="002613.html">[squid-dev] [PATCH] avoid clobbering errno in debugs()
</A></li>
        <LI>Next message: <A HREF="002614.html">[squid-dev] [RFC] removal of http(s)_port clientca= parameter
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2599">[ date ]</a>
              <a href="thread.html#2599">[ thread ]</a>
              <a href="subject.html#2599">[ subject ]</a>
              <a href="author.html#2599">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>While converting the TLS/SSL context initialization code into generic
Security:: API operations I have run into the clientca= parameter.

It appears to perform identical CA loading operations to cafile=
parameter. But also stores the CA details in Squid memory, with no
apparent need to do so.

Different from cafile= currently it turns on TLS client authentication
options.

First Bug : This is not obvious from the documentation which states that
cafile= is the parameter for loading CA used in client cert
authentication, whereas clientca= is just &quot;additional CA&quot; to be used.
IIRC there has been some user confusion over the use of these two
options in the past.

Only when both are used at once does client certificate authentication
appear to work as documented. I suspect that OpenSSL is doing some form
of opportunistic client certificate authentication using cafile=
contents *if* the client spontaneously sends a cert. If not then
configuring cafile= is useless.

Second Bug : when cafile= is not set and clientca= is set clientca= gets
loaded twice and added to the context twice. Loaded from file into
memory as a batch, then from file to context as a batch, then copied one
at a time from memory to context. Causing a much larger than necessary
memory footprint for listening ports.



I believe we should do the following:

* Add a new option &quot;tls-require-client-auth&quot; to turn on the client
certificatate verification / authentication actions.
 - This could be a sslflags= value, but I plan to turn those into
individual flag parameters later. So avoiding adding new ones right now.

* Remove clientca=. The config &quot;clientca=/foo&quot; would now be equivalent
to &quot;cafile=/foo tls-require-client-auth&quot; and treated as such by
back-compat code.


PS. The glaring oddity is that all this storing of CA and CRL lists in
memory is happening on the listening ports which change contexts rarely.
Ideal memory optimization would do it for outgoing server connections
where contexts are generated as-needed. But that code is continuously
loading its CA/CRL lists from files.

Amos
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002613.html">[squid-dev] [PATCH] avoid clobbering errno in debugs()
</A></li>
	<LI>Next message: <A HREF="002614.html">[squid-dev] [RFC] removal of http(s)_port clientca= parameter
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2599">[ date ]</a>
              <a href="thread.html#2599">[ thread ]</a>
              <a href="subject.html#2599">[ subject ]</a>
              <a href="author.html#2599">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
