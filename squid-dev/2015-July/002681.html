<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] received_encrypted ACL
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20received_encrypted%20ACL&In-Reply-To=%3C55A93FF3.7070208%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="002680.html">
   <LINK REL="Next"  HREF="002683.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] received_encrypted ACL</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20received_encrypted%20ACL&In-Reply-To=%3C55A93FF3.7070208%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] received_encrypted ACL">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Jul 17 17:48:35 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="002680.html">[squid-dev] [PATCH] received_encrypted ACL
</A></li>
        <LI>Next message: <A HREF="002683.html">[squid-dev] [PATCH] received_encrypted ACL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2681">[ date ]</a>
              <a href="thread.html#2681">[ thread ]</a>
              <a href="subject.html#2681">[ subject ]</a>
              <a href="author.html#2681">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 18/07/2015 3:13 a.m., Tsantilas Christos wrote:
&gt;<i> This patch adds received_encrypted ACL
</I>&gt;<i> 
</I>&gt;<i> The new received_encrypted ACL matches transactions where all HTTP
</I>&gt;<i> messages were received over TLS or SSL transport connections, including
</I>&gt;<i> messages received from ICAP servers.
</I>&gt;<i> 
</I>&gt;<i> Some eCAP services receive data from unencrypted sources. Some eCAP
</I>&gt;<i> services are &quot;secure&quot;, but we assume that all are not &quot;secure&quot; until we
</I>&gt;<i> add a configuration option to mark secure eCAP services.
</I>&gt;<i> 
</I>&gt;<i> Use case: Sending everything to Secure ICAP services increases
</I>&gt;<i> adaptation performance overhead. Folks want to send received_encrypted
</I>&gt;<i> transactions and only those transactions to Secure ICAP services.
</I>
-1 on principle I object to making this ACL available for this use case.


And the (very) long answer:

This is conceptually very bad. Good citizens don't take a mugging victim
and throw in a few more punches simply because they were mugged. Other
far better reasons would be necessary instead.


The protocol level signals are simple and quite clear already:

* <A HREF="https://">https://</A> scheme traffic is *supposed* to be kept secure no matter
what. Either they need to obey that requirement or they dont (due to
non-TLS security).

* <A HREF="http://">http://</A> and the other non-secure schemes are optional.

What other components of Squid are doing with the message has no
relevance to whether those criteria apply. If one of them is being
insecure compounding the problem is undesirable.

Please do instead encourage using the request URI scheme (&quot;proto&quot; ACL)
to make that determination of whether ICAP security is desirable or not.

In other news; HTTP is growing this thing called &quot;opportunistc security&quot;
(aka. encryption). Where <A HREF="http://">http://</A> schemed requests will be arriving over
TLS, and maybe even going out via it and it traverses fully secure
components. HTTPbis WG are already finding problems with servers not
handling the schemes right in these conditions. Lets not add another
bunch of bad assumptions to the mix. Follow the scheme.


Also;
1) we know about the directly connected security. But the connections
beyond that may be insecure. You note this yourself about eCAP. Same
goes for TLS connections!!
(again: URI scheme is supposed to tell us the end-to-end situation anyhow.)

2) Even when something is supposedly secure it can have wildly differing
degrees of security from other things. TLS itself has NULL-cipher with
zero security.

3) non-TLS forms of connection security exist (IPSEC, VPN, stunnel, etc)
and may be used today without Squid knowledge.
 - this is where admin configurability of whether to let <A HREF="https://">https://</A>
traffic go or not to a <A HREF="icap://">icap://</A> service comes in handy. But matters not
for <A HREF="icaps://">icaps://</A> services.

So any determination of &quot;security&quot; based on existence or lack of TLS or
other assumed properties is false information. We can't be sure about
other components real security, and it should not matter to the
component (ICAP service) making its decision.



On the other hand the mechanics behind it could be of some use outside
the security area. You may have noticed I'm currently working on getting
LogTags to be a flag set. Part of this is logging accuracy. Part of it
is completing the ancient feature request for an ACL that matches
against &quot;HIT&quot; or &quot;MISS&quot; etc.
 TLS listening port is already planned to be one new tag there. The
other sources your patch is marking are good candidates as well. So the
result_code ACL (or whatever its called in the end) will overlap a lot
with what this &quot;received_encrypted&quot; is doing.


On the third hand (:-P), whats wrong with using a transaction annotation
in the HttpRequest set by insecure components if they are passed an
<A HREF="https://">https://</A> request?
 Would probably be a good thing to do simply for logging trouble spots
regardless of &quot;received_encrypted&quot; existence.



&gt;<i> 
</I>&gt;<i> NOTE: Currently there is not any mechanism to indicate if a cached
</I>&gt;<i> object came from secure source or not, so we assume that all hits for
</I>&gt;<i> secure requests  are secure too.
</I>
Again here the URI-scheme used to cache the object in the first place
already tells us it was (at least supposed to be) from a guaranteed
secure source.

How that security differs between now and when it was fetched may vary
even if the same components were used only a short time ago (think what
a &quot;patch tuesday&quot; could do to servers on auto-update).


(Phew, sorry for the length of that)

Amos

</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002680.html">[squid-dev] [PATCH] received_encrypted ACL
</A></li>
	<LI>Next message: <A HREF="002683.html">[squid-dev] [PATCH] received_encrypted ACL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2681">[ date ]</a>
              <a href="thread.html#2681">[ thread ]</a>
              <a href="subject.html#2681">[ subject ]</a>
              <a href="author.html#2681">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
