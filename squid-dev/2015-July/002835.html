<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] suffix parsing and skipping
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20suffix%20parsing%20and%20skipping&In-Reply-To=%3C55B10371.8010705%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="002833.html">
   <LINK REL="Next"  HREF="002836.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] suffix parsing and skipping</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20suffix%20parsing%20and%20skipping&In-Reply-To=%3C55B10371.8010705%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] suffix parsing and skipping">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Jul 23 15:08:33 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="002833.html">[squid-dev] [PATCH] suffix parsing and skipping
</A></li>
        <LI>Next message: <A HREF="002836.html">[squid-dev] [PATCH] suffix parsing and skipping
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2835">[ date ]</a>
              <a href="thread.html#2835">[ thread ]</a>
              <a href="subject.html#2835">[ subject ]</a>
              <a href="author.html#2835">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 24/07/2015 1:55 a.m., Alex Rousskov wrote:
&gt;<i> On 07/23/2015 01:46 AM, Kinkie wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> the only thing I don't understand is the XXX in
</I>&gt;&gt;<i> parsedSize(); it's not clear why the comment, 
</I>&gt;<i> 
</I>&gt;<i> The parsedSize() method is broken: It claims to return the number of
</I>&gt;<i> bytes parsed, but it does not return that. It usually returns the number
</I>&gt;<i> of bytes parsed from the left, but not from the right of the string. For
</I>&gt;<i> example,
</I>&gt;<i> 
</I>&gt;<i>   skipOne()
</I>&gt;<i>   skipOneTrailing()
</I>&gt;<i> 
</I>&gt;<i> should usually result in parsedSize() returning 2 because 2 bytes were
</I>&gt;<i> parsed and removed from the string. It usually returns 1.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> and what to use instead.
</I>&gt;<i> 
</I>&gt;<i> There is currently no good alternative. Discussing the best way forward
</I>&gt;<i> is outside this project scope (but I welcome such a separate discussion,
</I>&gt;<i> of course). Fortunately, no existing code misuses parsedSize() today AFAIK.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> as soon as that's improved, +1.
</I>&gt;<i> 
</I>&gt;<i> Why?! This is not something the patch breaks. Do you want me to remove
</I>&gt;<i> the XXX and just pretend that we have not discovered the problem?
</I>
The parsedSize() function is used by Parser to measure the HTTP message
size for testing whether the message has exceeded the admin configured
limits.

 The reverse-parse bytes is not worth accounting in current trunk code
because the incremental HTTP Parser is always using its primary
Tokenizer forwards. The special-case reverse-parse uses a separate
temporary Tokenizer is only used on a sub-section of line accounted for
by the LF seek pass.

That changes if the proposed Parser refactor Alex has in parallel gets
merged. Since it depends on sizes of things produced by the temporary
reverse Tokenizer. But I note the bug is not fixed in that patch either.


I -0 right now for reasons of minor new bug I found in the patch
already. Audit partially completed with details to follow.

Amos
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002833.html">[squid-dev] [PATCH] suffix parsing and skipping
</A></li>
	<LI>Next message: <A HREF="002836.html">[squid-dev] [PATCH] suffix parsing and skipping
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2835">[ date ]</a>
              <a href="thread.html#2835">[ thread ]</a>
              <a href="subject.html#2835">[ subject ]</a>
              <a href="author.html#2835">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
