<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] suffix parsing and skipping
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20suffix%20parsing%20and%20skipping&In-Reply-To=%3C55B105C7.8060608%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="002835.html">
   <LINK REL="Next"  HREF="002839.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] suffix parsing and skipping</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20suffix%20parsing%20and%20skipping&In-Reply-To=%3C55B105C7.8060608%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] suffix parsing and skipping">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Jul 23 15:18:31 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="002835.html">[squid-dev] [PATCH] suffix parsing and skipping
</A></li>
        <LI>Next message: <A HREF="002839.html">[squid-dev] [PATCH] suffix parsing and skipping
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2836">[ date ]</a>
              <a href="thread.html#2836">[ thread ]</a>
              <a href="subject.html#2836">[ subject ]</a>
              <a href="author.html#2836">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07/23/2015 09:08 AM, Amos Jeffries wrote:
&gt;<i> On 24/07/2015 1:55 a.m., Alex Rousskov wrote:
</I>&gt;&gt;<i> On 07/23/2015 01:46 AM, Kinkie wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> the only thing I don't understand is the XXX in
</I>&gt;&gt;&gt;<i> parsedSize(); it's not clear why the comment, 
</I>...
&gt;&gt;&gt;<i> as soon as that's improved, +1.
</I>
&gt;&gt;<i> Why?! This is not something the patch breaks. Do you want me to remove
</I>&gt;&gt;<i> the XXX and just pretend that we have not discovered the problem?
</I>
&gt;<i> The reverse-parse bytes is not worth accounting in current trunk code
</I>&gt;<i> because the incremental HTTP Parser is always using its primary
</I>&gt;<i> Tokenizer forwards. The special-case reverse-parse uses a separate
</I>&gt;<i> temporary Tokenizer is only used on a sub-section of line accounted for
</I>&gt;<i> by the LF seek pass.
</I>&gt;<i> 
</I>&gt;<i> That changes if the proposed Parser refactor Alex has in parallel gets
</I>&gt;<i> merged.
</I>
That does not change. This discussion ought to be completely out of this
thread scope, but the proposed parser refactoring still uses forward
parsing as far as any parseRequestFirstLine() caller is concerned:

Http::One::RequestParser::parseRequestFirstLine()
{
    ::Parser::Tokenizer lineTok(buf_);
    if (!lineTok.prefix(line, lineChars) || !lineTok.skip('\n')) {
        debugs(74, 5, &quot;Parser needs more data&quot;);
        return 0;
    }

    ... code not touching lineTok or buf_ here ...

    parseStatusCode = Http::scOkay;
    buf_ = lineTok.remaining(); // incremental parse checkpoint
    return 1;
}

Alex.

</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002835.html">[squid-dev] [PATCH] suffix parsing and skipping
</A></li>
	<LI>Next message: <A HREF="002839.html">[squid-dev] [PATCH] suffix parsing and skipping
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2836">[ date ]</a>
              <a href="thread.html#2836">[ thread ]</a>
              <a href="subject.html#2836">[ subject ]</a>
              <a href="author.html#2836">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
