<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] received_encrypted ACL
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20received_encrypted%20ACL&In-Reply-To=%3C55B259AE.4040600%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="002847.html">
   <LINK REL="Next"  HREF="002850.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] received_encrypted ACL</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20received_encrypted%20ACL&In-Reply-To=%3C55B259AE.4040600%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] received_encrypted ACL">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Jul 24 15:28:46 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="002847.html">[squid-dev] [PATCH] received_encrypted ACL
</A></li>
        <LI>Next message: <A HREF="002850.html">[squid-dev] [PATCH] received_encrypted ACL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2849">[ date ]</a>
              <a href="thread.html#2849">[ thread ]</a>
              <a href="subject.html#2849">[ subject ]</a>
              <a href="author.html#2849">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07/24/2015 05:26 AM, Amos Jeffries wrote:
&gt;<i> I think you still misunderstand the OppSec RFC meanings.
</I>
Ditto.


&gt;<i> Since SSL support first went into Squid back in 1998 we have allowed
</I>&gt;<i> cache_peer to connect to a remote https_port and sent <A HREF="http://">http://</A> traffic
</I>&gt;<i> over it.
</I>
Using the above as a sub-case of the use case we are considering, a
third independent proxy intercepting that peer-to-peer link (among other
traffic) should send bumped <A HREF="http://">http://</A> messages from that link to a remote
ICAP service using Secure ICAP. To configure that desirable behavior,
the intercepting proxy admin may use received_encrypted.

In short, what is &quot;optional&quot; or &quot;opportunistic&quot; for some is often
&quot;required&quot; or &quot;highly desirable&quot; for others. Independent intercepting
intermediaries should honor others' decision to use encryption, even
when that use was &quot;optional&quot; or &quot;opportunistic&quot;. There are many
exceptions and wrinkles to these simple rules of thumb, and the admin
has the power to configure them.


&gt;<i> * the &quot;received&quot; part of the AC type name seems a bit odd.
</I>&gt;<i>  - perhapse &quot;connections_encrypted&quot; makes more sense with the
</I>&gt;<i> description for it, and focus on TLS connections.
</I>
I disagree that connections_encrypted is better than received_encrypted,
especially in the presence of connectionless eCAP and
half-connectionless hits. A more general name may make this ACL more
forward-compatible.

However, if you insist, we will use your &quot;connections_encrypted&quot; name to
avoid discussing this further [unless somebody else suggests a better
name that you agree to, of course].


&gt;<i> * you mentionend cache HITs earlier.
</I>&gt;<i>  - IMO you can drop all mention of cache HIT in the commit message on
</I>&gt;<i> grounds that no reply connection was involved with HIT at the scope
</I>&gt;<i> level of &quot;current transaction&quot;.
</I>
The new ACL is evaluated against the master transaction (a set of
messages), not reply connection, so we have to document what happens to
cache hits IMO. I hope that you will not object to more explicit
documentation as long as it is correct, matches the code, etc.


&gt;<i> in src/HttpMsg.h:
</I>&gt;<i> 
</I>&gt;<i> * Unless you are going to add secure eCAP flag functionality as part of
</I>&gt;<i> ths patch scope I dont see why we should have the extra code or enum for
</I>&gt;<i> srcEcaps existing yet.
</I>&gt;<i>  - please remove srcEcaps, or implement the ecaps flag feature.
</I>&gt;<i>  - TODO in places where the ecaps flag feature would need to hook in
</I>&gt;<i> seems sufficient to me at present.
</I>&gt;<i>  - what remains is plain eCAP which does not naturally involve network
</I>&gt;<i> connections, TLS or otherwise.
</I>&gt;<i>  - marking eCAP involvement does not seem useful either until that ecaps
</I>&gt;<i> feature is added. Please consider turning those into TODO as well,
</I>&gt;<i> though I will accept the current code for srcEcap.
</I>
I disagree that a TODO comment is better than correct, small, and
symmetric code, but we will replace eCAP-related code with TODO comments
to avoid prolonging this discussion.


&gt;<i> * can you explain the rational of doing this with a bitmask instead of a
</I>&gt;<i> default-true 'tlsEncrypted' boolean flag in class HttpMsg ?
</I>
IIRC, there were two reasons for using distinct, named flags:

1. They simplify adding received_encrypted parameters that adjust how
the ACL is applied/computed.

2. &quot;tlsEncrypted&quot; or similar does not work well for connection-less
things like eCAP and hits. By using protocol/module names, we were able
to avoid this naming problem.

Distinct flags also serve as an excellent way of finding various message
sources in Squid source code, but we probably did not realize that when
designing the code.

If you insist, we can use boolean storage OR reduce the storage member
size to 16 bits (let us know what would you prefer).


Your other comments not discussed above should be addressed in the next
patch version. Please comment on what changes discussed above you insist on.


Thank you,

Alex.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002847.html">[squid-dev] [PATCH] received_encrypted ACL
</A></li>
	<LI>Next message: <A HREF="002850.html">[squid-dev] [PATCH] received_encrypted ACL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2849">[ date ]</a>
              <a href="thread.html#2849">[ thread ]</a>
              <a href="subject.html#2849">[ subject ]</a>
              <a href="author.html#2849">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
