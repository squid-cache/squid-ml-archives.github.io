<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Injecting custom JavaScript
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Injecting%20custom%20JavaScript&In-Reply-To=%3C5582B567.1080207%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="002424.html">
   <LINK REL="Next"  HREF="002427.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Injecting custom JavaScript</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Injecting%20custom%20JavaScript&In-Reply-To=%3C5582B567.1080207%40treenet.co.nz%3E"
       TITLE="[squid-dev] Injecting custom JavaScript">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Jun 18 12:11:19 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="002424.html">[squid-dev] Injecting custom JavaScript
</A></li>
        <LI>Next message: <A HREF="002427.html">[squid-dev] Injecting custom JavaScript
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2425">[ date ]</a>
              <a href="thread.html#2425">[ thread ]</a>
              <a href="subject.html#2425">[ subject ]</a>
              <a href="author.html#2425">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 18/06/2015 11:42 p.m., James Hunter wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I've been looking to inject special JavaScript code into every HTML page
</I>&gt;<i> my squid proxy receives via HTTPS connections, this is for an
</I>&gt;<i> application where the users will be fully aware of the injection.
</I>
Lets start with how this is a truly terrible idea.

The content you are seeking to change is:
a) somebody elses property,
b) copyrighted as such,
c) potentially subject to external checksum and digital protections,
d) HTTP relies on it being unchanged from origin server copies for
correct revalidation operations.

&gt;<i> 
</I>&gt;<i> I've correctly configured Squid to do the SSL Bump, having verified in
</I>&gt;<i> WireShark that the two sides are communicating via separate connections.
</I>
That means little these days. Splice works via two connections and Squid
does not participate in the TLS layer inside those connections.

You have to also confirm that Squid has access to the decrypted data,
that shows up in wireshark as different sets of crypto operating on each
connection.

&gt;<i> 
</I>&gt;<i> Can someone point out where the plain HTTP / TCP request flows through
</I>&gt;<i> squid, after it's deciphered by one side - but before it's encrypted for
</I>&gt;<i> the other? I want to scan the buffer's to find any &lt;BODY&gt; tags and
</I>&gt;<i> ensure that the script is inserted.
</I>
The &quot;page&quot; is not plaintext HTTP. Its binary payload. Squid is designed
explicitly NOT to touch them.

It is also relayed as given, spread over many smaller buffer segments
and very likely compressed. There is 0 guarantee that you will be able
to see a whole sequence of &quot;&lt;BODY&gt;&quot; characters as a string even if one
existed bare in the payload.

If you want to do payload adaptation use an ICAP service or eCAP module.
The above guarantee is still not provided, but the *CAP APIs provide
easier ways to access the transaction data.
NP: Dont forget to skip altering any and all messages with
&quot;Cache-Control:no-transform&quot; header - that is critical.

Amos

</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002424.html">[squid-dev] Injecting custom JavaScript
</A></li>
	<LI>Next message: <A HREF="002427.html">[squid-dev] Injecting custom JavaScript
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2425">[ date ]</a>
              <a href="thread.html#2425">[ thread ]</a>
              <a href="subject.html#2425">[ subject ]</a>
              <a href="author.html#2425">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
