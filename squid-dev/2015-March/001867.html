<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] server_name ACL
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20server_name%20ACL&In-Reply-To=%3C55006F39.3040903%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="001855.html">
   <LINK REL="Next"  HREF="001860.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] server_name ACL</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20server_name%20ACL&In-Reply-To=%3C55006F39.3040903%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] server_name ACL">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Mar 11 16:37:13 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="001855.html">[squid-dev] [PATCH] server_name ACL
</A></li>
        <LI>Next message: <A HREF="001860.html">[squid-dev] I need a small help with an ICAP issue.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1867">[ date ]</a>
              <a href="thread.html#1867">[ thread ]</a>
              <a href="subject.html#1867">[ subject ]</a>
              <a href="author.html#1867">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Second try. Lets see if this goe through...

On 25/02/2015 9:29 a.m., Tsantilas Christos wrote:
&gt;<i> Hi all,
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> This patch adds server_name ACL matching server name(s) obtained from
</I>&gt;<i> various sources such as CONNECT request URI, client SNI, and SSL server
</I>&gt;<i> certificate CN.
</I>&gt;<i> 
</I>&gt;<i> During each SslBump step, Squid improves its understanding of a &quot;true
</I>&gt;<i> server name&quot;, with a bias towards server-provided (and Squid-validated)
</I>&gt;<i> information.
</I>&gt;<i> 
</I>&gt;<i> The server-provided server names are retrieved from the server
</I>&gt;<i> certificate CN and Subject Alternate Names. The new server_name ACL
</I>&gt;<i> matches any of alternate names and CN. If the CN or an alternate name is
</I>&gt;<i> a wildcard, then the new ACL matches any domain that matches the domain
</I>&gt;<i> with the wildcard.
</I>
The principle for ACLs is to test specific things about the transaction.
Having tests like this server_name that tests generic name (which can
vary wildly across the transaction processing) is not a good idea. It
dilutes the certainty about what is being tested and what will match for
any given circumstances.


I think we should be adding two ACLs here, one for the SNI and one for
the cert Subject field value, unless they are guaranteed to be the same
and we reject traffic where they differ (like Host header validation
ensures dstdomain is the/a domain for the server contacted).
 Mentioning which - the CONNECT request URI hostname and client SNI
values need to be validated against each other, or the CVE-2009-0801
type of issue is opened all over again for HTTPS.


I'm also a bit worried that server_name will be confusing for newcomers
who may think its meaning more like that actually filled by dstdomain.

&quot;sni&quot; should be sufficient since the term is more commonly known by the
acronym.


Also note that bumping is not the only source of SNI information.
 * In reverse-proxy HTTPS connections there is SNI containing the
virtual hosted domain name.
 * In TLS connections to an explict proxy there is SNI for the proxy
name the client knows about.

Note how that second form of SNI is *not* the origin server name.

Amos
</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001855.html">[squid-dev] [PATCH] server_name ACL
</A></li>
	<LI>Next message: <A HREF="001860.html">[squid-dev] I need a small help with an ICAP issue.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1867">[ date ]</a>
              <a href="thread.html#1867">[ thread ]</a>
              <a href="subject.html#1867">[ subject ]</a>
              <a href="author.html#1867">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
