<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Basic tests results for the proxy protocol with squid.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Basic%20tests%20results%20for%20the%20proxy%20protocol%20with%20squid.&In-Reply-To=%3C55029ADE.4080609%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="001873.html">
   <LINK REL="Next"  HREF="001871.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Basic tests results for the proxy protocol with squid.</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Basic%20tests%20results%20for%20the%20proxy%20protocol%20with%20squid.&In-Reply-To=%3C55029ADE.4080609%40ngtech.co.il%3E"
       TITLE="[squid-dev] Basic tests results for the proxy protocol with squid.">eliezer at ngtech.co.il
       </A><BR>
    <I>Fri Mar 13 08:07:58 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="001873.html">[squid-dev] [RFC] trunk vs LTS distro versions
</A></li>
        <LI>Next message: <A HREF="001871.html">[squid-dev] Basic tests results for the proxy protocol with	squid.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1870">[ date ]</a>
              <a href="thread.html#1870">[ thread ]</a>
              <a href="subject.html#1870">[ subject ]</a>
              <a href="author.html#1870">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I started testing squid 3.5.2 with the proxy protocol and I have setup a 
basic haproxy settings for it.
<A HREF="http://ngtech.co.il/paste/1287/">http://ngtech.co.il/paste/1287/</A>

copy of the logs at:
<A HREF="http://www1.ngtech.co.il/paste/1288/">http://www1.ngtech.co.il/paste/1288/</A>

While testing I started first haproxy with regular squid forward proxy 
and then moved to a proxy protocol supported forward proxy setup.

While with forward proxy the acls seems to work fine with the proxy 
protocol I am encountering couple weird things:
1426233543.491     28 192.168.10.131 TCP_MISS/404 611 GET 
<A HREF="http://ngtech.co.il/favico.ico">http://ngtech.co.il/favico.ico</A> - HIER_DIRECT/84.95.212.160 text/html
1426233562.110  29091 192.168.10.131 TCP_TUNNEL/200 3374 CONNECT 
tiles.services.mozilla.com:443 - HIER_DIRECT/54.149.185.208 -
1426233562.119      1 192.168.10.151 TCP_MISS/403 4324 GET 
<A HREF="http://ngtech.co.il/favicon.ico">http://ngtech.co.il/favicon.ico</A> - HIER_NONE/- text/html
1426233562.122      5 192.168.10.131 TCP_MISS/403 4461 GET 
<A HREF="http://ngtech.co.il/favicon.ico">http://ngtech.co.il/favicon.ico</A> - ORIGINAL_DST/192.168.10.151 text/html
1426233562.259      1 192.168.10.151 TCP_MISS/403 4382 GET 
<A HREF="http://www.squid-cache.org/Artwork/SN.png">http://www.squid-cache.org/Artwork/SN.png</A> - HIER_NONE/- text/html
1426233562.261      3 192.168.10.131 TCP_MISS/403 4519 GET 
<A HREF="http://www.squid-cache.org/Artwork/SN.png">http://www.squid-cache.org/Artwork/SN.png</A> - ORIGINAL_DST/192.168.10.151 
text/html
1426233562.294      1 192.168.10.151 TCP_MISS/403 4306 GET 
<A HREF="http://ngtech.co.il/favicon.ico">http://ngtech.co.il/favicon.ico</A> - HIER_NONE/- text/html
1426233562.296      2 192.168.10.131 TCP_MISS/403 4443 GET 
<A HREF="http://ngtech.co.il/favicon.ico">http://ngtech.co.il/favicon.ico</A> - ORIGINAL_DST/192.168.10.151 text/html


The first two requests are on the regular forward proxy port.
Then the 403 response is not a TCP_DENIED but I am still watching the 
screen and see a squid access denied page which is identified by the 
with the local proxy name.
Why would I see an &quot;ORIGINAL_DST&quot; at all in these requests??? there is 
none...(else then the haproxy).

So summery of the setup:
1 host with both squid and haproxy installed and configured for proxy 
protocol version 1(version 2 didn't worked for me at all)
haproxy listens on one port(13128) and squid on receives the requests on 
the loopback interface(port 23128).

I think it's a bug but first I am putting the details here in the dev 
list and later next week I will file a bugzilla report.

Eliezer

* I followed the release notes at 
<A HREF="http://www.squid-cache.org/Versions/v3/3.5/RELEASENOTES.html#ss2.7">http://www.squid-cache.org/Versions/v3/3.5/RELEASENOTES.html#ss2.7</A>
</PRE>







































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001873.html">[squid-dev] [RFC] trunk vs LTS distro versions
</A></li>
	<LI>Next message: <A HREF="001871.html">[squid-dev] Basic tests results for the proxy protocol with	squid.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1870">[ date ]</a>
              <a href="thread.html#1870">[ thread ]</a>
              <a href="subject.html#1870">[ subject ]</a>
              <a href="author.html#1870">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
