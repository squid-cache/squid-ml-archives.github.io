<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Digest related question.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Digest%20related%20question.&In-Reply-To=%3C5509F231.4050506%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="001898.html">
   <LINK REL="Next"  HREF="001963.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Digest related question.</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Digest%20related%20question.&In-Reply-To=%3C5509F231.4050506%40ngtech.co.il%3E"
       TITLE="[squid-dev] Digest related question.">eliezer at ngtech.co.il
       </A><BR>
    <I>Wed Mar 18 21:46:25 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="001898.html">[squid-dev] Digest related question.
</A></li>
        <LI>Next message: <A HREF="001963.html">[squid-dev] Digest related question.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1907">[ date ]</a>
              <a href="thread.html#1907">[ thread ]</a>
              <a href="subject.html#1907">[ subject ]</a>
              <a href="author.html#1907">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Jack,

I will try to write down here instead of as notes.

About the trust issues:
In the Internet I am used to trusted sources since indeed the Internet 
is a great place.
But like life and very far from the movies there are people out-there in 
the world that just likes to benefit more then they deserve or they 
think they should benefit more for any other reason.
There are cases which indeed the work should be rewarded and even 
con-artists deserve more then a penny for their time.

I would not run to do the math about power consumption for others but I 
do it for myself and in many cases I would prefer to run a super CPU 
intensive task then relying on what ever &quot;event&quot; that will might trigger 
a set of tasks.
The above is due to the basic fact that I have seen cases which an event 
would just not come and a pending task was staying there for ages.
Back to Digest, For squid in the current state of things it would 
require a bit of juggling to &quot;re-compile&quot; the StoreID after the file was 
downloaded.(lat time I was reading the code)
It will not block collapse-forwarding but it will require more then just 
CPU.
Also what it means is that as a proxy the only option to send the client 
a verified download is after I downloaded the full file and there for an 
issue.
So the above limits squid into a specific Database structure and a way 
of operation.
It is not a bad way to do things but since Digest headers RFC exist and 
Digest DBs do exist for most sane large file storage systems(even if not 
available to the end user throw an API) I would prefer to first consider 
them and then Digesting all sorts of files.

About a self made Digest DB:
I will trust it but it will be very limited and will be of a great help 
for a non trusted source rather then a trusted one.
Trusting the origin service means that I trust a part of a very big 
system that tries to ensure that I as a human will not be exploited.
There are places on the planet and on the Internet which the situation 
is that the user cannot trust the service provider(s).
I learned that If I do not trust the ISP I am trying another one but I 
cannot switch the Ethernet cables from my PC to the wall.
If a bunch of users will prove that the situation is that they cannot 
trust their ISP for a 3-7MB RPM signed by me on-top of http I would be 
glad to sit and hear their assumption and will hear the arguments about 
how to first collide MD5 and then each of the SHA Digest family.
I must admit that I have encountered some engineer(which has never been 
in the squid list) that have tried to make me believe that he can 
replace my RPM with a fake one and the users will not notice about it.
Sorry for him he is still trying...


About the improvement, it's good to re-validate that the file have the 
same creation\modification time and it should reflect that the Digest 
was not changed and vice versa.
I assume that in the future when data will take less place or will 
consume more then it is today and a RPM such as the one I created could 
be(if at all) at will re-calculated to match a colliding Digest, another 
way to verify data integrity will be there.
Until then the internet is safe enough that a simple single encrypted 
&quot;control&quot; channel or two would be enough to verify the integrity of the 
data.

And since I am human sometimes I think about something and I am sure I 
did it and it happens that it was not written even if I invested lots of 
time in reviewing the pesudo code line by line.
Ho well, I assume that this how humans are.. they are allowed to have a 
mistake or two.

Verifying that the object is cached or not before running any logic is a 
good choice if the DB is not too big and I will add it to the pesudo 
later on with a new version.
HTCP would be my first choice to do that and I will make efforts and 
re-learn it to make sure that the pesudo can run for testing.

Eliezer Croitoru

* I have seen some of the great series Hustel due to two recommendations 
of friends and family:
<A HREF="http://www.imdb.com/title/tt0379632/">http://www.imdb.com/title/tt0379632/</A>


On 16/03/2015 19:42, Jack Bates wrote:
&gt;<i> On 15/03/15 07:03 PM, Eliezer Croitoru wrote:
</I>&gt;&gt;<i> Hey Jack,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks for the links and the help.
</I>&gt;&gt;<i> I have started working on a pesudo for a way to test\implement some of
</I>&gt;&gt;<i> the ideas but it is still very far from reality.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The basic code is at:
</I>&gt;&gt;<i> <A HREF="http://www1.ngtech.co.il/paste/1292/">http://www1.ngtech.co.il/paste/1292/</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Which means that if I do trust the source domain I will try to analyze a
</I>&gt;&gt;<i> head request first before any decision.
</I>&gt;&gt;<i> (there should be a way to override the request redirection or any other
</I>&gt;&gt;<i> thing we would want to do with it)
</I>&gt;<i>
</I>&gt;<i> Is trust an issue?
</I>&gt;<i> Assuming you populate the database
</I>&gt;<i> with digests that you compute yourself.
</I>&gt;<i> If an origin sends a Digest header
</I>&gt;<i> and you rewrite the response so a client gets a matching file,
</I>&gt;<i> do you need to trust the origin?
</I>&gt;<i>
</I>&gt;&gt;<i> An option would be to add the url into a DB with one to many and many to
</I>&gt;&gt;<i> one relationship.
</I>&gt;&gt;<i> And since the pesudo code should be the first step before StoreID helper
</I>&gt;&gt;<i> run-time, StoreID in place can apply an internal address per a digest of
</I>&gt;&gt;<i> choice or even multiple choices.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> My main concern until now is that if squid would have the cached object
</I>&gt;&gt;<i> in a digest url form such as:
</I>&gt;&gt;<i> <A HREF="http://digest.squid.internal/MD5/xyz123">http://digest.squid.internal/MD5/xyz123</A>&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Squid would in many cases try to verify against the origin server that
</I>&gt;&gt;<i> the cached object has the same ETAG and MODIFICATION time.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I am unsure yet on how to &quot;resolve&quot; this issue in an elegant way which
</I>&gt;&gt;<i> would not violate the RFCs.
</I>&gt;<i>
</I>&gt;<i> Good point.
</I>&gt;<i> When the Traffic Server plugin checks if the file is already cached,
</I>&gt;<i> I don't know off hand if it also checks if it's valid.
</I>&gt;<i> The plugin could quite possibly redirect a client
</I>&gt;<i> to a URL that must be revalidated with the origin.
</I>&gt;<i> But maybe this is still an improvement?
</I>&gt;<i> Maybe it's good enough, at least for a first iteration?
</I>&gt;<i> The plugin does check that the original URL is *not* cached
</I>&gt;<i> before rewriting the response.
</I>&gt;<i> In your pseudo code,
</I>&gt;<i> can you check that the original URL is *not* cached,
</I>&gt;<i> before querying the database with the digest?
</I>&gt;<i>
</I>
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001898.html">[squid-dev] Digest related question.
</A></li>
	<LI>Next message: <A HREF="001963.html">[squid-dev] Digest related question.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1907">[ date ]</a>
              <a href="thread.html#1907">[ thread ]</a>
              <a href="subject.html#1907">[ subject ]</a>
              <a href="author.html#1907">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
