<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] splicing resumed sessions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20splicing%20resumed%20sessions&In-Reply-To=%3C550C3E49.5050707%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="001965.html">
   <LINK REL="Next"  HREF="001969.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] splicing resumed sessions</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20splicing%20resumed%20sessions&In-Reply-To=%3C550C3E49.5050707%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] splicing resumed sessions">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Mar 20 15:35:37 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="001965.html">[squid-dev] [PATCH] splicing resumed sessions
</A></li>
        <LI>Next message: <A HREF="001969.html">[squid-dev] [PATCH] splicing resumed sessions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1966">[ date ]</a>
              <a href="thread.html#1966">[ thread ]</a>
              <a href="subject.html#1966">[ subject ]</a>
              <a href="author.html#1966">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 03/20/2015 02:06 AM, Amos Jeffries wrote:
&gt;<i> On 18/03/2015 6:21 a.m., Tsantilas Christos wrote:
</I>&gt;&gt;<i> This patch adds the &quot;ssl_bump_resuming_sessions&quot; directive that controls
</I>&gt;&gt;<i> SslBump behavior when dealing with &quot;resuming SSL/TLS sessions&quot;. Without
</I>&gt;&gt;<i> these changes, SslBump usually terminates all resuming sessions with an
</I>&gt;&gt;<i> error because such sessions do not include server certificates,
</I>&gt;&gt;<i> preventing Squid from successfully validating the server identity.
</I>

&gt;<i> The RFC 2818 has mandatory validation of the HTTP CONNECT, client SNI
</I>&gt;<i> (with server ack), and server certificate dNSname values before session
</I>&gt;<i> resume may be performed.
</I>

I am afraid you have misunderstood the problem domain because RFC 2818
is irrelevant here. That RFC is about sending HTTP over TLS. Here, Squid
does not establish a secure HTTP connection with the client or server so
Squid is not subject to that RFC (the client and server are).

Without the patch, a client and server cannot resume secure sessions.
Users suffer from disconnects and various associated errors even though
Squid does not bump their connections. With the patch, things work, and
work without violating any TLS/SSL rules. Moreover, an admin can now
explicitly control whether resumed sessions are allowed or not (the
default &quot;allow&quot; is what nearly everybody should want).


&gt;<i> I dont think we have any such validation in Squid yet. So the current
</I>&gt;<i> behaviour of terminate is mandatory for compliance with TLS.
</I>

As Christos has said, proper validation is impossible in this case even
if we wanted to do it: Squid most likely have already spliced the
previous TLS session (a compliant behavior!) and now does not have
enough information to validate the new connection to the server (because
the server does not send its certificate during session resumption) and
splices the connections again.

HTTP, TLS, and SSL RFCs do not apply to traffic on spliced connections.
When splicing, Squid works as a TCP proxy. The fact that Squid may have
peeked into the connections (before deciding to splice them) is
irrelevant because that peeking did not affect the security of those
connections.


HTH,

Alex.

</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001965.html">[squid-dev] [PATCH] splicing resumed sessions
</A></li>
	<LI>Next message: <A HREF="001969.html">[squid-dev] [PATCH] splicing resumed sessions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1966">[ date ]</a>
              <a href="thread.html#1966">[ thread ]</a>
              <a href="subject.html#1966">[ subject ]</a>
              <a href="author.html#1966">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
