<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] pconn_lifetime robustness fixes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20pconn_lifetime%20robustness%20fixes&In-Reply-To=%3C5543A9DF.6080809%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="002379.html">
   <LINK REL="Next"  HREF="002297.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] pconn_lifetime robustness fixes</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20pconn_lifetime%20robustness%20fixes&In-Reply-To=%3C5543A9DF.6080809%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] pconn_lifetime robustness fixes">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri May  1 16:29:19 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="002379.html">[squid-dev] [PATCH] Add chained certificates and signing certificate to bumpAndSpliced connections
</A></li>
        <LI>Next message: <A HREF="002297.html">[squid-dev] [PATCH] Secure ICAP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2296">[ date ]</a>
              <a href="thread.html#2296">[ thread ]</a>
              <a href="subject.html#2296">[ subject ]</a>
              <a href="author.html#2296">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 04/28/2015 08:18 AM, Amos Jeffries wrote:
&gt;<i> It is worth noting that this patch means the directive is now no longer
</I>&gt;<i> guaranteed to meet its primary use case:
</I>
Yes, but only if one misinterprets the primary use case. AFAICT after
rereading the original pconn_lifetime thread, this misinterpretation has
started from the very beginning and, apparently, has not quite ended
yet. The feature limits the total lifetime of a connection, but it is
applied to idle persistent connections only.


&gt;<i> With the reversion to the keep-alive -&gt; close action any existing and
</I>&gt;<i> ongoing pipeline of requests will cause the connection to persist past
</I>&gt;<i> its lifetime indefinitely. 
</I>
Yes, the limit should affect idle persistent connections only. We tried
to expand the definition of &quot;idle&quot; and &quot;persistent&quot; to cover more use
cases (in part, to accommodate squid-dev review comments IIRC), but the
real world was against us. For example, terminating connections between
pipelined requests caused interoperability problems even though they are
not supposed to happen with compliant HTTP clients. I suspect HTTP/2
solves this problem, but we are not there yet.

I would not be surprised to see more fixes in this direction. For
example, we have an untriaged bug report about FTP control connections
being negatively affected, with an argument that FTP does not have a
concept of &quot;idle&quot; and so should not be the subject to pconn_lifetime limits.


Cheers,

Alex.



&gt;&gt;<i> On 04/27/2015 06:40 PM, Tsantilas Christos wrote:
</I>&gt;&gt;&gt;<i> If there is not any objection I will apply this patch to trunk.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On 04/15/2015 07:11 PM, Tsantilas Christos wrote:
</I>&gt;&gt;&gt;&gt;<i> Hi all,
</I>&gt;&gt;&gt;&gt;<i>   I am attaching which fixes pconn_lifetime feature.
</I>&gt;&gt;&gt;&gt;<i> We had a long discussion for this feature, which is resulted to the
</I>&gt;&gt;&gt;&gt;<i> patch r13780, but unfortunately, Measurement Factory customers reported
</I>&gt;&gt;&gt;&gt;<i> problems:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> 1. Squid closed connections with partially received requests when they
</I>&gt;&gt;&gt;&gt;<i> reached pconn_lifetime limit. We should only close _idle_ connections.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> 2. When connecting to Squid without sending anything for longer than
</I>&gt;&gt;&gt;&gt;<i> pconn_lifetime, the connection hangs if the request is sent after the
</I>&gt;&gt;&gt;&gt;<i> waiting period.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> 3. The connection also hangs if the initial request is starting to be
</I>&gt;&gt;&gt;&gt;<i> transmitted but then there is a longer pause before the request is
</I>&gt;&gt;&gt;&gt;<i> completed.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Please read the patch preamble for more informations.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> This is a Measurement Factory project.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Amos
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-dev mailing list
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">http://lists.squid-cache.org/listinfo/squid-dev</A>
</I>&gt;<i> 
</I>
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002379.html">[squid-dev] [PATCH] Add chained certificates and signing certificate to bumpAndSpliced connections
</A></li>
	<LI>Next message: <A HREF="002297.html">[squid-dev] [PATCH] Secure ICAP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2296">[ date ]</a>
              <a href="thread.html#2296">[ thread ]</a>
              <a href="subject.html#2296">[ subject ]</a>
              <a href="author.html#2296">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
