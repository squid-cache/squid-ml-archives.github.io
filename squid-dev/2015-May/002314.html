<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Consistently apply notes from cached external	ACL replies
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Consistently%20apply%20notes%20from%20cached%20external%0A%09ACL%20replies&In-Reply-To=%3CCAGUJm7YX7mq-kOjtL-NjAboMa4QZJ2QC%3DHmi%3DTd9V79vUwmPVw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="002357.html">
   <LINK REL="Next"  HREF="002317.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Consistently apply notes from cached external	ACL replies</H1>
    <B>Nathan Hoad</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Consistently%20apply%20notes%20from%20cached%20external%0A%09ACL%20replies&In-Reply-To=%3CCAGUJm7YX7mq-kOjtL-NjAboMa4QZJ2QC%3DHmi%3DTd9V79vUwmPVw%40mail.gmail.com%3E"
       TITLE="[squid-dev] [PATCH] Consistently apply notes from cached external	ACL replies">nathan at getoffmalawn.com
       </A><BR>
    <I>Fri May  8 10:52:10 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="002357.html">[squid-dev] [PATCH] Refactor IcmpConfig
</A></li>
        <LI>Next message: <A HREF="002317.html">[squid-dev] [PATCH] Consistently apply notes from cached external ACL replies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2314">[ date ]</a>
              <a href="thread.html#2314">[ thread ]</a>
              <a href="subject.html#2314">[ subject ]</a>
              <a href="author.html#2314">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

Attached is a patch that adds notes from cached ACL helpers to request objects.

Without this patch, when you have an external ACL that replies with
notes, they are only added onto the HTTP request that kicked off the
external ACL lookup, and not cached ACL responses. This means if you
set notes from an external ACL that are used for some processing in
other ACLs, or post-processing on logs, things may be missed.

To illustrate what I mean...

external_acl_type foo %DST /path/to/fakehelper.py
acl foo external foo
http_access allow foo

logformat foolog %ru %note %et
access_log /path/to/access.log foolog

fakehelper is a script that always replies with &quot;OK tag=fromacl
foo=bar bar=baz&quot;.

Access log prior to the patch:

<A HREF="http://google.com/">http://google.com/</A> foo:%20bar%0D%0Atag:%20fromacl%0D%0Abar:%20baz%0D%0A fromacl
<A HREF="http://google.com/">http://google.com/</A> - fromacl

Access log after the patch:

<A HREF="http://google.com/">http://google.com/</A> foo:%20bar%0D%0Atag:%20fromacl%0D%0Abar:%20baz%0D%0A fromacl
<A HREF="http://google.com/">http://google.com/</A> foo:%20bar%0D%0Atag:%20fromacl%0D%0Abar:%20baz%0D%0A fromacl

Thank you,

Nathan.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: apply-cached-notes.patch
Type: text/x-patch
Size: 1382 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20150508/b6e38fb7/attachment.bin">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20150508/b6e38fb7/attachment.bin</A>&gt;
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002357.html">[squid-dev] [PATCH] Refactor IcmpConfig
</A></li>
	<LI>Next message: <A HREF="002317.html">[squid-dev] [PATCH] Consistently apply notes from cached external ACL replies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2314">[ date ]</a>
              <a href="thread.html#2314">[ thread ]</a>
              <a href="subject.html#2314">[ subject ]</a>
              <a href="author.html#2314">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
