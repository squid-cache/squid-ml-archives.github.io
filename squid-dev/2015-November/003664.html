<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Simpler and more robust request line parser
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Simpler%20and%20more%20robust%20request%20line%20parser&In-Reply-To=%3C56387A97.8060001%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="003693.html">
   <LINK REL="Next"  HREF="003665.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Simpler and more robust request line parser</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Simpler%20and%20more%20robust%20request%20line%20parser&In-Reply-To=%3C56387A97.8060001%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] Simpler and more robust request line parser">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Nov  3 09:12:55 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="003693.html">[squid-dev] [PATCH] add support for using an existing kerberos cache instead of a keytab
</A></li>
        <LI>Next message: <A HREF="003665.html">[squid-dev] [PATCH] Simpler and more robust request line parser
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3664">[ date ]</a>
              <a href="thread.html#3664">[ thread ]</a>
              <a href="subject.html#3664">[ subject ]</a>
              <a href="author.html#3664">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 5/08/2015 7:37 p.m., Amos Jeffries wrote:
&gt;<i> On 24/07/2015 11:13 a.m., Alex Rousskov wrote:
</I>&gt;&gt;<i> On 07/23/2015 08:16 AM, Amos Jeffries wrote:
</I>&gt;&gt;&gt;<i> Please note: most of my comments in this long email are informational.
</I>&gt;&gt;&gt;<i> Things which need to be taken into consideration when touching the parser.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Noted. I will do my best to treat them as such.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I request performance testing of the final version of this change vs
</I>&gt;&gt;&gt;<i> lastest trunk at the time.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Noted.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The next patch will address comments not discussed in this email. Thank
</I>&gt;&gt;<i> you for those!
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The rest of this email is the usual waste of time discussing
</I>&gt;&gt;<i> non-existent bugs, arguing about mostly irrelevant issues, burning straw
</I>&gt;&gt;<i> men, and talking past each other. The only important bit of information
</I>&gt;&gt;<i> is probably the following paragraph that I will quote here for those who
</I>&gt;&gt;<i> do not want to waste their time reading everything:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &quot;I am happy to restrict URIs to what older Squids accepted or more.
</I>&gt;&gt;<i> Recent parser changes broke Squid. There is no need to go beyond what we
</I>&gt;&gt;<i> were doing before those changes. I will gladly make a simple patch
</I>&gt;&gt;<i> change to restrict URIs to either that old subset or to the current
</I>&gt;&gt;<i> trunk subset, whichever is larger. Exactly what subset do you want me to
</I>&gt;&gt;<i> use?&quot;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Current trunk already accepts all ASCII printable characters, and a
</I>&gt;<i> bunch of whitespace / control codes.
</I>&gt;<i> 
</I>&gt;<i> &quot;What I would like&quot; is:
</I>&gt;<i> 
</I>&gt;<i> // RFC 3986 URI component character set(s)
</I>&gt;<i> // RFC 7230 request-line delimiter
</I>&gt;<i> // RFC 7230 HTTP-version character set
</I>&gt;<i> auto permit = uriValidCharacters() + CharacterSet::SP;
</I>&gt;<i> 
</I>&gt;<i> if (relaxed_header_parser) {
</I>&gt;<i> 
</I>&gt;<i>  // RFC7230 section 3.5 alternative control-code whitespace
</I>&gt;<i>  permit += CharacterSet::HTAB
</I>&gt;<i>    + CharacterSet(&quot;VT,FF&quot;,&quot;\x0B\x0C&quot;)
</I>&gt;<i>    + CharacterSet::CR;
</I>&gt;<i> 
</I>&gt;<i> #if USE_HTTP_VIOLATIONS
</I>&gt;<i>   // RFC 2396 unwise character set
</I>&gt;<i>   // the &quot;transport agents are known to sometimes modify or use as
</I>&gt;<i> delimiter&quot; set
</I>&gt;<i>   // which must never be transmitted in un-escaped form
</I>&gt;<i>   permit.add('\0');
</I>&gt;<i>   permit += CharacterSet(&quot;RFC2396-unwise&quot;,&quot;\&quot;\\|^&lt;&gt;`{}&quot;);
</I>&gt;<i> #endif
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Which leaves some 27 CTL characters (0x01-0x1F) still forbidden. Things
</I>&gt;<i> like delete, backslash, bell, escape, end-of-transmission. I hope you
</I>&gt;<i> are not going to argue for re-enabling those inside this parser.
</I>&gt;<i> 
</I>&gt;<i> Of course the bare UTF-8 extended unicode characters are omitted too.
</I>&gt;<i> Those is prohibited anywhere in HTTP, and a sure sign that its non-HTTP
</I>&gt;<i> being processed. So definitely exit this parser.
</I>&gt;<i> 
</I>&gt;<i> IFF you have no objections to the above charsets then the only thing
</I>&gt;<i> this patch is waiting on in the technical sense is polygraph test results.
</I>&gt;<i> 
</I>
Ping. Do we have agreement on those character sets ?

I'm willing to skip the polygraph request and let the regular trunk
testing handle that part now.

Amos
</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003693.html">[squid-dev] [PATCH] add support for using an existing kerberos cache instead of a keytab
</A></li>
	<LI>Next message: <A HREF="003665.html">[squid-dev] [PATCH] Simpler and more robust request line parser
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3664">[ date ]</a>
              <a href="thread.html#3664">[ thread ]</a>
              <a href="subject.html#3664">[ subject ]</a>
              <a href="author.html#3664">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
