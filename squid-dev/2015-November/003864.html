<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Store API changes blocking bug #7
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Store%20API%20changes%20blocking%20bug%20%237&In-Reply-To=%3C564D663A.6000408%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="003768.html">
   <LINK REL="Next"  HREF="003865.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Store API changes blocking bug #7</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Store%20API%20changes%20blocking%20bug%20%237&In-Reply-To=%3C564D663A.6000408%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] Store API changes blocking bug #7">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Nov 19 06:03:38 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="003768.html">[squid-dev] [PATCH] Store API changes blocking bug #7
</A></li>
        <LI>Next message: <A HREF="003865.html">[squid-dev] [PATCH] Store API changes blocking bug #7
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3864">[ date ]</a>
              <a href="thread.html#3864">[ thread ]</a>
              <a href="subject.html#3864">[ subject ]</a>
              <a href="author.html#3864">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/18/2015 01:03 AM, Amos Jeffries wrote:

&gt;<i> * in src/fs/ufs/UFSSwapDir.h and src/tests/TestSwapDir.h (at least) you
</I>&gt;<i> have one class with a mix of override/non-override virtuals.
</I>&gt;<i>  - Kinkie and I have found the hard way earlier that some compilers
</I>&gt;<i> error if only some virtual methods in a class heirarchy are marked with
</I>&gt;<i> it. It is an all-or-nothing per-heirarchy situation with that keyword.
</I>
If it was an error (and not just a warning), then that sounds like a
broken compiler to me. Said that, &quot;apply specifiers consistently&quot; is a
good general rule, of course. I ignored that rule to minimize
unnecessary old code changes.

I now modified UFSSwapDir.h, TestSwapDir.h, MemStore.h, and Transients.h
to comply with that rule per your request.


[ I think we would have to rely on compilers to find all the missed
cases. It is impractical to reliably do that manually because a class
may both introduce new virtual methods (no override) and override
parents virtual methods at the same time, making simple string searches
ineffective.

Also, because of various tricks like the CBDATA_CLASS() macro, we may
have to disable that compiler warning by default or in certain contexts.

Overall, enforcing consistent override use looks like a whole project on
its own! ]


&gt;<i> * I seem to recall a fair amount of trouble over the local vs non-local
</I>&gt;<i> vs unused/dead objects situation on a per-object basis rather than
</I>&gt;<i> per-store. That was behind wantsLocalMemory parameter to
</I>&gt;<i> Store::Controller::dereferenceIdle() which is being removed from some of
</I>&gt;<i> the sub-calls.
</I>&gt;<i>  - is that a fixed problem now?
</I>
I wish! That big problem is still there. It got a tiny bit easier to
solve because related non-Root methods have a simpler interface now.


&gt;<i> * in src/store/Disks.cc please take advantage of the move to doxygen
</I>&gt;<i> commen (\**) the functions that have prefix documentation already.
</I>
Done.


&gt;<i> * in src/tests/stub_store_search.cc please use nullptr
</I>&gt;<i>  - also since the stub is for StoreSearch.cc it should be named
</I>&gt;<i> stub_StoreSearch.cc
</I>
That stub file is gone now. I discovered that it is no longer needed.


&gt;<i> +1 provided the override issue is fixed. Though I don't think that will
</I>&gt;<i> need another audit.
</I>
Committed to trunk (r14411).


Thank you,

Alex.

</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003768.html">[squid-dev] [PATCH] Store API changes blocking bug #7
</A></li>
	<LI>Next message: <A HREF="003865.html">[squid-dev] [PATCH] Store API changes blocking bug #7
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3864">[ date ]</a>
              <a href="thread.html#3864">[ thread ]</a>
              <a href="subject.html#3864">[ subject ]</a>
              <a href="author.html#3864">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
