<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] What is your opinion: Debugging and cache enhancement tool, what is the preferred implementation?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20What%20is%20your%20opinion%3A%20Debugging%20and%20cache%0A%20enhancement%20tool%2C%20what%20is%20the%20preferred%20implementation%3F&In-Reply-To=%3C564DFA65.5070105%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="003868.html">
   <LINK REL="Next"  HREF="003875.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] What is your opinion: Debugging and cache enhancement tool, what is the preferred implementation?</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20What%20is%20your%20opinion%3A%20Debugging%20and%20cache%0A%20enhancement%20tool%2C%20what%20is%20the%20preferred%20implementation%3F&In-Reply-To=%3C564DFA65.5070105%40measurement-factory.com%3E"
       TITLE="[squid-dev] What is your opinion: Debugging and cache enhancement tool, what is the preferred implementation?">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Nov 19 16:35:49 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="003868.html">[squid-dev] What is your opinion: Debugging and cache enhancement tool, what is the preferred implementation?
</A></li>
        <LI>Next message: <A HREF="003875.html">[squid-dev] What is your opinion: Debugging and cache enhancement tool, what is the preferred implementation?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3874">[ date ]</a>
              <a href="thread.html#3874">[ thread ]</a>
              <a href="subject.html#3874">[ subject ]</a>
              <a href="author.html#3874">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/19/2015 03:54 AM, Eliezer Croitoru wrote:
&gt;<i> I have two options:
</I>
&gt;<i> - adding code to squid which with a on\off switch(can be some
</I>&gt;<i> debug_options level) will add an informative header... like many CDN
</I>&gt;<i> proxies does already.( returning the latest StoreID that is being used
</I>&gt;<i> by squid, since squid changes the StoreID in some cases after the
</I>&gt;<i> response started... &quot;Vary&quot; etc)
</I>
&gt;<i> - Writing an ICAP service that will do the trick by adding these
</I>&gt;<i> informative headers externally based on the understanding of squid
</I>&gt;<i> internals.
</I>
I do not recommend implementing either of the above options.


&gt;<i> If you have another idea how to implement the idea let me know.
</I>

There are two different aspects of the problem you are trying to solve:

1. How to _enable_ debugging of caching decisions for transaction X.
2. How to _relay_ caching decisions for transaction X to the admin.


1. For the first part of the problem, debug_options are too crude and so
will be any on/off switch you might add. To be usable in production
(high background volume of irrelevant transactions while you want to
triage only one or a few), this has to be done using a new ACL-driven
directive. We may call it &quot;triage&quot; and eventually expand its use to
cases beyond caching:

  triage caching acl1 acl2 ...
  triage peering acl3 acl4 ...
  triage acls acl5 acl6 ...
  triage all acl7 acl8 ...

The new directive should probably be evaluated a few times during master
transaction (and the corresponding connections) lifetime: client
connection acceptance, virgin request headers parsed, adapted request
headers parsed, server connection establishment, virgin response headers
parsed, adapted response headers parsed. The matching connection and
master transaction should be marked as such.


2. Now to the second problem: In general, &quot;Why was [not] request X
served from cache?&quot; and &quot;Why was [not] response Y cached?&quot; questions are
often nearly impossible to fully answer using &quot;an informative header&quot;.
There is often just too much information to conveniently relay using an
HTTP header value. For simple cases, we already have X-Cache headers. As
you know, they do not solve the problem. We need detailed debugging.

On the other hand, headers conveniently isolate triage information to a
given transaction. With enough detail, they can relay enough information
to cover many cases.

Fortunately, both detailed debugging and header value accumulation can
be done in the same code so we do not have to pick one over the other.

I recommend a two-prong approach to solve the second part of the
problem. Both (A) and (B) below should be applied only to the master
transaction matching the &quot;triage caching&quot; directive described above:

2A. Go through caching code and enable informative debugging of each
decision. Use a new debugging section so that the admin can control
output verbosity. Unlike the existing sections, this new debugging
section will only apply to matching transactions, not &quot;source code
files&quot;. I would give it a name (e.g., &quot;CachingTriage&quot;) instead of a number:

    debug_options ALL,1 CachingTriage,9 AclTriage,5

2B. Go through caching code and collect a list of primary decisions in
the form of a list of enumerated values or a list of key=value pairs.
Store that list in the master transaction object. Return that list in
the X-Cache-Triage response header.

Again, both (2A) and (2B) should only have an effect for master
transactions that matched the &quot;triage caching&quot; directive described in
Section 1.


&gt;<i> I know that the best practical way to do that is to add this as a squid
</I>&gt;<i> feature, but since I do not like to work with C++ and since it is a
</I>&gt;<i> complex task to learn from 0(my brain have some &quot;ram&quot; cache only and a
</I>&gt;<i> good sleep many times just restarts the cache) I will prefer to write an
</I>&gt;<i> ICAP service that does that.
</I>
ICAP and eCAP services do not get enough information to triage most
caching problems. IMO, to be generally useful, this should be done in Squid.


HTH,

Alex.

</PRE>




































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003868.html">[squid-dev] What is your opinion: Debugging and cache enhancement tool, what is the preferred implementation?
</A></li>
	<LI>Next message: <A HREF="003875.html">[squid-dev] What is your opinion: Debugging and cache enhancement tool, what is the preferred implementation?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3874">[ date ]</a>
              <a href="thread.html#3874">[ thread ]</a>
              <a href="subject.html#3874">[ subject ]</a>
              <a href="author.html#3874">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
