<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] convert squidaio_ctrl_t to MEMPROXY_CLASS
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20convert%20squidaio_ctrl_t%20to%20MEMPROXY_CLASS&In-Reply-To=%3C560D53A0.3090903%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="003565.html">
   <LINK REL="Next"  HREF="003567.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] convert squidaio_ctrl_t to MEMPROXY_CLASS</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20convert%20squidaio_ctrl_t%20to%20MEMPROXY_CLASS&In-Reply-To=%3C560D53A0.3090903%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] convert squidaio_ctrl_t to MEMPROXY_CLASS">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Oct  1 15:39:12 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="003565.html">[squid-dev] [PATCH] convert squidaio_ctrl_t to MEMPROXY_CLASS
</A></li>
        <LI>Next message: <A HREF="003567.html">[squid-dev] FYI: RFC 2617 (&quot;HTTP Authentication: Basic and Digest Access Authentication&quot;) is obsolete
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3566">[ date ]</a>
              <a href="thread.html#3566">[ thread ]</a>
              <a href="subject.html#3566">[ subject ]</a>
              <a href="author.html#3566">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2/10/2015 3:29 a.m., Kinkie wrote:
&gt;<i> Hi,
</I>&gt;<i>    the attached large-context patch converts squidaio_ctrl_t to MEMPROXY_CLASS.
</I>&gt;<i> It also:
</I>&gt;<i> - adds a tiny bit of documentation to some fields of squidaio_ctrl_t
</I>&gt;<i> - extends the MEMPROXY_CLASS API to expose the pool's use-count as a
</I>&gt;<i> static function
</I>&gt;<i> - fixes a tiny bit of documentation in aiops.cc
</I>&gt;<i> - fixes a bug in aioWrite [1]
</I>&gt;<i> 
</I>&gt;<i> [1] old code wouldn't set ctrlp-&gt;len; when free_func would eventually
</I>&gt;<i> be called, it'd happen with a length argument of 0 (default length
</I>&gt;<i> value). I'm quite surprised this hasn't caused havoc so far. New code
</I>&gt;<i> sets len. So either this fixes an issue, or it introduces one ;)
</I>&gt;<i> 
</I>
That sounds like the freeFunc do not use len. Maybe its another bit of
dead code left over from Squid-2 logics?


in src/DiskIO/DiskThreads/DiskThreads.h:
* please reduce the 2 spaces before some &quot;= delete;&quot;
 - also are these default &amp; copy ctor and copy-assign removals actually
needed since there is a ctor with parameters defined?

* &quot;struct squidaio_ctrl_t *next;&quot; is now wrong for a non-struct
 - maybe other uses of &quot;struct squidaio_ctrl_t&quot;


in src/DiskIO/DiskThreads/aiops.cc:

* since the name length of the parameters is causing line wrap, the
answer is to shorten the parameter names.
 - consider abbreviations
 - please use one member per line on the initializer list


in src/DiskIO/DiskThreads/async_io.cc:

* please merge+sort mem/Pool.h into the include list

* please move the &quot;squidaio_ctrl_t *ctrlp;&quot; down to their relevant
position of first use. I can see at least one defined a couple of lines
above the 'ctrlp = new ...' .


Amos

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003565.html">[squid-dev] [PATCH] convert squidaio_ctrl_t to MEMPROXY_CLASS
</A></li>
	<LI>Next message: <A HREF="003567.html">[squid-dev] FYI: RFC 2617 (&quot;HTTP Authentication: Basic and Digest Access Authentication&quot;) is obsolete
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3566">[ date ]</a>
              <a href="thread.html#3566">[ thread ]</a>
              <a href="subject.html#3566">[ subject ]</a>
              <a href="author.html#3566">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
