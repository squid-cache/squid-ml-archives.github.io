<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] %&lt;lp missing for persistent connections
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20%25%3Clp%20missing%20for%20persistent%20connections&In-Reply-To=%3C562709B2.70304%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="003616.html">
   <LINK REL="Next"  HREF="003618.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] %&lt;lp missing for persistent connections</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20%25%3Clp%20missing%20for%20persistent%20connections&In-Reply-To=%3C562709B2.70304%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] %&lt;lp missing for persistent connections">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Oct 21 03:42:42 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="003616.html">[squid-dev] [squid-users] POST upload splits tcp stream in many small 39byte sized pakets
</A></li>
        <LI>Next message: <A HREF="003618.html">[squid-dev] [PATCH] %&lt;lp missing for persistent connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3617">[ date ]</a>
              <a href="thread.html#3617">[ thread ]</a>
              <a href="subject.html#3617">[ subject ]</a>
              <a href="author.html#3617">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

    Connection stats, including %&lt;lp, were missing for persistent
connections.

The code reusing a pconn was missing a hier.note() call, resulting in 0
values logged for %&lt;lp (local port number of the last server or peer
connection) and probably other missing stats.

Also refactored poorly copied statistics collection code to remove
duplication and always update to-server connection stats when the actual
connection becomes available.

Positive side effect: Upon setsockopt(2) failures, the tos and nfmark
fields of a pinned connection were set to the desired (but not actually
applied) values, while persistent connection fields were left intact
(and, hence, stale). Both fields are now reset to zero on failures, for
both types of connections.


HTH,

Alex.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SQUID-106-intermittent-0-outgoing-port-t3.patch
Type: text/x-diff
Size: 14732 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20151020/9d8d4016/attachment.patch">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20151020/9d8d4016/attachment.patch</A>&gt;
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003616.html">[squid-dev] [squid-users] POST upload splits tcp stream in many small 39byte sized pakets
</A></li>
	<LI>Next message: <A HREF="003618.html">[squid-dev] [PATCH] %&lt;lp missing for persistent connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3617">[ date ]</a>
              <a href="thread.html#3617">[ thread ]</a>
              <a href="subject.html#3617">[ subject ]</a>
              <a href="author.html#3617">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
