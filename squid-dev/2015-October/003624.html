<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] add support for using an existing kerberos cache instead of a keytab
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20add%20support%20for%20using%20an%20existing%20kerberos%0A%20cache%20instead%20of%20a%20keytab&In-Reply-To=%3C5628EF9A.6020404%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="003622.html">
   <LINK REL="Next"  HREF="003625.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] add support for using an existing kerberos cache instead of a keytab</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20add%20support%20for%20using%20an%20existing%20kerberos%0A%20cache%20instead%20of%20a%20keytab&In-Reply-To=%3C5628EF9A.6020404%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] add support for using an existing kerberos cache instead of a keytab">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Oct 22 14:15:54 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="003622.html">[squid-dev] [PATCH] add support for using an existing kerberos cache instead of a keytab
</A></li>
        <LI>Next message: <A HREF="003625.html">[squid-dev] [PATCH] add support for using an existing kerberos cache instead of a keytab
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3624">[ date ]</a>
              <a href="thread.html#3624">[ thread ]</a>
              <a href="subject.html#3624">[ subject ]</a>
              <a href="author.html#3624">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 23/10/2015 2:30 a.m., aymericvincent wrote:
&gt;<i> 
</I>
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> the attached patch adds a NOKEYTAB option to the login=NEGOTIATE case
</I>&gt;<i> (a local proxy needs to authenticate via kerberos to a proxy peer).
</I>&gt;<i> 
</I>&gt;<i> When specified, this option prevents squid from crafting a kerberos
</I>&gt;<i> credentials cache from a keytab, but instead lets GSSAPI use an
</I>&gt;<i> existing credentials cache.
</I>&gt;<i> 
</I>&gt;<i> This is very useful to allow a normal user to use his user
</I>&gt;<i> credentials to run a local unprivileged squid on his desktop/laptop
</I>&gt;<i> without having to deploy a keytab on the (say) parent proxy.
</I>&gt;<i> 
</I>&gt;<i> The way the option is specified is IMHO sub-optimal (sorry) but
</I>&gt;<i> minimises diff footprint, and I'm open to any suggestion if you're
</I>&gt;<i> interested in incorporating this simple yet useful change.
</I>&gt;<i> 
</I>
There are two existing Negotiate auth cases.

* One where a &quot;login=NEGOTIATE:principle_name&quot; is given and causes Squid
to load the named entry from the users keytab.

* One where only &quot;login=NEGOTIATE&quot; is given, and causes Squid to load
the default (first) entry from the users default keytab.

In both cases the keytab entry can specify a memory cache contains the
credentials, or a specific named account. But that is stored in the
keytab itself. Not in squid.conf settings.

This patch appears to make Squid ignore loading keytabs entirely and
just allow random credentials from unspecified location(s) to be used.

In the absence of a location from which to load the credentials where
does GSSAPI load the credentials from?

Is the users generic cache backed by a keytab somewhere in the local
account? and why can't we just load that?

Is that GSSAPI behaviour consistent across the four krb5 libraries Squid
can be built to use?


Overall this seems to me to be making Squid pick a random user account
from the machine and sending a lot of traffic through some peer
pretending to be that user instead of a proxy. That is bad security, and
Kerberos is supposed to be the most secure authentication possible. So I
am not happy with this (yet).

Whatever we end up with Squid should never be impersonating a user
account. Ever. It is an automated service, not a person.



NP: don't worry about small diff. We are in feature freeze for Squid-4
beta cycle. Since this is a small UI change it will be held anyway until
Squid-5 branching, which is likely to be a month or two away.

IMO if accepted this should be a separate flag option available on
cache_peer. It would then be a boolean value in the CachePeer object
instead of a global macro #define.

Amos
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003622.html">[squid-dev] [PATCH] add support for using an existing kerberos cache instead of a keytab
</A></li>
	<LI>Next message: <A HREF="003625.html">[squid-dev] [PATCH] add support for using an existing kerberos cache instead of a keytab
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3624">[ date ]</a>
              <a href="thread.html#3624">[ thread ]</a>
              <a href="subject.html#3624">[ subject ]</a>
              <a href="author.html#3624">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
