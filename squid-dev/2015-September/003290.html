<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Handle SSL v2 Hello
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Handle%20SSL%20v2%20Hello&In-Reply-To=%3C55E5385E.5050503%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   <LINK REL="Next"  HREF="003291.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Handle SSL v2 Hello</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Handle%20SSL%20v2%20Hello&In-Reply-To=%3C55E5385E.5050503%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] Handle SSL v2 Hello">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Sep  1 05:32:14 UTC 2015</I>
    <P><UL>
        
        <LI>Next message: <A HREF="003291.html">[squid-dev] [PATCH] Handle SSL v2 Hello
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3290">[ date ]</a>
              <a href="thread.html#3290">[ thread ]</a>
              <a href="subject.html#3290">[ subject ]</a>
              <a href="author.html#3290">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

    The attached trunk and v3.5 patches allow Squid to splice SSLv3 and
TLSv1 sessions that start with an SSL v2 Hello message. Such sessions
are created, for example, by some SSL clients using OpenSSL v0.9.8 with
default options. These patches do _not_ re-enable SSLv2 sessions support
in trunk.

Bumping TLSv1 sessions that start with SSL v2 Hello also appears to work.


In my tests, attempts to bump SSLv3 sessions that start with SSL v2
Hello message terminate during server handshake if Squid stares at the
server certificate (i.e., if an &quot;ssl_bump stare&quot; rule matches at bumping
step #2). When this happens, Squid logs the following error message:

2015/08/31 22:11:56.459| Error negotiating SSL on FD 14:
  error:1409F07F:SSL routines:SSL3_WRITE_PENDING:bad write retry
  (1/-1/0)

However, AFAICT, the same or similar problem exists in the unpatched
Squid (for connections that start with SSL v3 Hello). It could be
another bug or a deficiency of my test setup.


HTH,

Alex.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SQUID-100-parse-sslv2-hello-t2.patch
Type: text/x-diff
Size: 9333 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20150831/e51c81c3/attachment.patch">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20150831/e51c81c3/attachment.patch</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SQUID-100-parse-sslv2-hello-v3p5-t2.patch
Type: text/x-diff
Size: 9331 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20150831/e51c81c3/attachment-0001.patch">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20150831/e51c81c3/attachment-0001.patch</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="003291.html">[squid-dev] [PATCH] Handle SSL v2 Hello
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3290">[ date ]</a>
              <a href="thread.html#3290">[ thread ]</a>
              <a href="subject.html#3290">[ subject ]</a>
              <a href="author.html#3290">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
