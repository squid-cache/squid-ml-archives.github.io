<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Do not update gperf-generated files through make
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Do%20not%20update%20gperf-generated%20files%20through%0A%20make&In-Reply-To=%3C56003DAF.2060106%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="003421.html">
   <LINK REL="Next"  HREF="003439.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Do not update gperf-generated files through make</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Do%20not%20update%20gperf-generated%20files%20through%0A%20make&In-Reply-To=%3C56003DAF.2060106%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] Do not update gperf-generated files through make">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Sep 21 17:26:07 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="003421.html">[squid-dev] [PATCH] Do not update gperf-generated files through make
</A></li>
        <LI>Next message: <A HREF="003439.html">[squid-dev] [PATCH] Do not update gperf-generated files through	make
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3422">[ date ]</a>
              <a href="thread.html#3422">[ thread ]</a>
              <a href="subject.html#3422">[ subject ]</a>
              <a href="author.html#3422">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>A slightly more working version. If this works, please feel free to commit.

Amos

-------------- next part --------------
=== modified file 'scripts/source-maintenance.sh'
--- scripts/source-maintenance.sh	2015-08-04 05:32:35 +0000
+++ scripts/source-maintenance.sh	2015-09-21 17:11:56 +0000
@@ -260,27 +260,30 @@
 for f in `ls -1 ${ROOT}/doc/manuals/*.po | sort -u`
 do
 	echo &quot; \\&quot;
 	echo -n &quot;    ${f}&quot;
 done
 echo &quot; &quot;
 )| sed s%${ROOT}/doc/manuals/%%g | sed s%\.po%\.lang%g &gt;${ROOT}/doc/manuals/language.list
 
 # Build STUB framework include from current stub_* available
 (
 sed -e 's%\ \*%##%' -e 's%/\*%##%' -e 's%##/%##%' &lt;scripts/boilerplate.h
 echo -n &quot;STUB_SOURCE= tests/STUB.h&quot;
 for f in `ls -1 ${ROOT}/src/tests/stub_*.cc | sort -u`
 do
 	echo &quot; \\&quot;
 	echo -n &quot;	${f}&quot;
 done
 echo &quot; &quot;
 )| sed s%${ROOT}/src/%%g &gt;${ROOT}/src/tests/Stub.list
 
+# Build the GPERF generated content
+make -C src/http gperf-files
+
 # Run formating
 echo &quot;&quot; &gt;${ROOT}/doc/debug-sections.tmp
 srcformat || exit 1
 sort -u &lt;${ROOT}/doc/debug-sections.tmp | sort -n &gt;${ROOT}/doc/debug-sections.tmp2
 cat scripts/boilerplate.h ${ROOT}/doc/debug-sections.tmp2 &gt;${ROOT}/doc/debug-sections.txt
 rm ${ROOT}/doc/debug-sections.tmp ${ROOT}/doc/debug-sections.tmp2
 rm ${ROOT}/boilerplate_fix.sed

=== modified file 'src/http/Makefile.am'
--- src/http/Makefile.am	2015-09-05 18:52:17 +0000
+++ src/http/Makefile.am	2015-09-21 17:19:23 +0000
@@ -4,38 +4,43 @@
 ## contributions from numerous individuals and organizations.
 ## Please see the COPYING and CONTRIBUTORS files for details.
 ##
 
 include $(top_srcdir)/src/Common.am
 include $(top_srcdir)/src/TestHeaders.am
 
 SUBDIRS = one
 DIST_SUBDIRS = one
 
 noinst_LTLIBRARIES = libsquid-http.la
 
 libsquid_http_la_SOURCES = \
 	forward.h \
 	MethodType.cc \
 	MethodType.h \
 	ProtocolVersion.h \
 	RegisteredHeaders.h \
 	RegisteredHeaders.cc \
 	RegisteredHeadersHash.cci \
-	RegisteredHeadersHash.gperf \
 	RequestMethod.cc \
 	RequestMethod.h \
 	StatusCode.cc \
 	StatusCode.h \
 	StatusLine.cc \
 	StatusLine.h
 
 libsquid_http_la_LIBADD= one/libhttp1.la
 
 MethodType.cc: MethodType.h $(top_srcdir)/src/mk-string-arrays.awk
 	($(AWK) -f $(top_srcdir)/src/mk-string-arrays.awk sbuf=1 &lt; $(srcdir)/MethodType.h | \
 		sed -e 's%METHOD_%%' -e 's%_C%-C%' &gt;$@) || ($(RM) -f $@ &amp;&amp; exit 1)
 
-RegisteredHeadersHash.cci: RegisteredHeadersHash.gperf
-	gperf --output-file=$@ -m 100000 $&lt;
-
 CLEANFILES += MethodType.cc
+
+gperf-files: RegisteredHeadersHash.gperf
+	@if test $(srcdir)/RegisteredHeadersHash.gperf -nt $(srcdir)/RegisteredHeadersHash.cci; then \
+		gperf --output-file=$(srcdir)/RegisteredHeadersHash.cci -m 100000 $(srcdir)/RegisteredHeadersHash.gperf \
+	fi
+
+EXTRA_DIST = RegisteredHeadersHash.gperf
+
+.PHONY: gperf-files

</PRE>





























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003421.html">[squid-dev] [PATCH] Do not update gperf-generated files through make
</A></li>
	<LI>Next message: <A HREF="003439.html">[squid-dev] [PATCH] Do not update gperf-generated files through	make
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3422">[ date ]</a>
              <a href="thread.html#3422">[ thread ]</a>
              <a href="subject.html#3422">[ subject ]</a>
              <a href="author.html#3422">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
