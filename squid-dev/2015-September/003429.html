<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] The next step towards: StoreID and metalink.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20The%20next%20step%20towards%3A%20StoreID%20and%20metalink.&In-Reply-To=%3C56007D44.20200%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="003426.html">
   <LINK REL="Next"  HREF="003433.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] The next step towards: StoreID and metalink.</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20The%20next%20step%20towards%3A%20StoreID%20and%20metalink.&In-Reply-To=%3C56007D44.20200%40treenet.co.nz%3E"
       TITLE="[squid-dev] The next step towards: StoreID and metalink.">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Sep 21 21:57:24 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="003426.html">[squid-dev] The next step towards: StoreID and metalink.
</A></li>
        <LI>Next message: <A HREF="003433.html">[squid-dev] The next step towards: StoreID and metalink.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3429">[ date ]</a>
              <a href="thread.html#3429">[ thread ]</a>
              <a href="subject.html#3429">[ subject ]</a>
              <a href="author.html#3429">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 22/09/2015 9:40 a.m., Eliezer Croitoru wrote:
&gt;<i> Alex, Amos,
</I>&gt;<i> 
</I>&gt;<i> The first step now I am trying to grasp first what could be done in the
</I>&gt;<i> current state of squid and ECAP without any changes.
</I>&gt;<i> Currently squid provides the methods to modify a request and\or response.
</I>&gt;<i> 
</I>&gt;<i> Basic StoreID support in a REQMOD should be possible in any case to
</I>&gt;<i> allow an ECAP module to do those things and also sine it has more
</I>&gt;<i> information about the request details it can decide better then the
</I>&gt;<i> current StoreID helpers.
</I>&gt;<i> Leaving the StoreID aside and back to hashes.
</I>&gt;<i> Currently the ECAP module can calculate hashes on the fly and then in
</I>&gt;<i> the end of the transaction write the result to either a log file or a DB.
</I>&gt;<i> For now the benefits i see from this is the option to find duplicate
</I>&gt;<i> content based on the hash.
</I>&gt;<i> For example: running a db lookup for similar hashes or something like
</I>&gt;<i> sort by hash.
</I>&gt;<i> pesudo:
</I>&gt;<i> iterate on the hashes and urls
</I>&gt;<i> if hash exists add the url to the array
</I>&gt;<i> else create a new hash to url array mapping.
</I>&gt;<i> then list urls with more then one url and get statistics for that.
</I>&gt;<i> * the statistics can be based on an access.log object/download size lookup
</I>&gt;<i> 
</I>&gt;<i> It would require some relational DB or some other way to store it in a
</I>&gt;<i> K\V DB.
</I>&gt;<i> 
</I>&gt;<i> I think that in the current state of ECAP I can only build a statistics
</I>&gt;<i> tool based on the ECAP module.
</I>&gt;<i> 
</I>&gt;<i> The actual cases which might benefit from a cache lookup would be
</I>&gt;<i> metalinks.
</I>&gt;<i> And a &quot;If Modified Digest&quot; might also benefit from it.
</I>&gt;<i> 
</I>&gt;<i> There is another way to de-duplicate content for metalinks using cache
</I>&gt;<i> objects planting\redirection.
</I>&gt;<i> The procedure would involve a setup which will allow for example a 302
</I>&gt;<i> redirection planting.
</I>&gt;<i> I will describe it more in depth:
</I>&gt;<i> A response from a trusted source was found with metalink sources.
</I>&gt;<i> Once the hash was validated a series of objects &quot;insertion&quot; or
</I>&gt;<i> &quot;implanting&quot; stage will start.
</I>&gt;<i> In this stage each and everyone of the link urls will be planted in the
</I>&gt;<i> DB with a 302 redirect url.
</I>&gt;<i> (it can be inserted into squid cached objects or using an external DB)
</I>&gt;<i> The result will be:
</I>&gt;<i> If someone tries to contact a specific URL which is the DB, a 302
</I>&gt;<i> redirection will be issued towards the already cached and hashed url.
</I>&gt;<i> it's not 100% full proof unless there is knowledge about the cache
</I>&gt;<i> internals but as Amos suggested in the past, the store.log might be
</I>&gt;<i> enough to make it possible to track cache removals and insertions.
</I>&gt;<i> 
</I>&gt;<i> Which of the ideas is a more realistic one compared to changing squid
</I>&gt;<i> and\or ECAP?
</I>
Using 302 kind of defeats the purpose of metalinks: that the content can
be fetched from alternative URLs if one breaks in any way (by the
client, or by Squid on revalidation retries).

Using StoreID helper to re-write the IDs to the same cached content is
more inline with the metalinks model, in that Squid and/or client can
revalidate the cached object from whatever URI the client is fetching
and it updates all the other ones the StoreID maps to that sfileno ID.


Note that all this use of eCAP and StoreID is for PoC testing how
metalinks works. Long-term these actions should all be an internal
feature of Squid. If we find that Squid needs to be altered to make the
PoC work then we are probably better just patching the related part of
metalinks operation in directly, or re-designing the PoC.

Amos

</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003426.html">[squid-dev] The next step towards: StoreID and metalink.
</A></li>
	<LI>Next message: <A HREF="003433.html">[squid-dev] The next step towards: StoreID and metalink.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3429">[ date ]</a>
              <a href="thread.html#3429">[ thread ]</a>
              <a href="subject.html#3429">[ subject ]</a>
              <a href="author.html#3429">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
