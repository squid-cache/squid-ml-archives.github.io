<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Fix broken cross-include guards in Linux Netfilter code
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Fix%20broken%20cross-include%20guards%20in%20Linux%0A%20Netfilter%20code&In-Reply-To=%3C560161E3.6050704%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="003441.html">
   <LINK REL="Next"  HREF="003446.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Fix broken cross-include guards in Linux Netfilter code</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Fix%20broken%20cross-include%20guards%20in%20Linux%0A%20Netfilter%20code&In-Reply-To=%3C560161E3.6050704%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] Fix broken cross-include guards in Linux Netfilter code">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Sep 22 14:12:51 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="003441.html">[squid-dev] [PATCH] Fix broken cross-include guards in Linux	Netfilter code
</A></li>
        <LI>Next message: <A HREF="003446.html">[squid-dev] [PATCH] Fix broken cross-include guards in Linux Netfilter code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3445">[ date ]</a>
              <a href="thread.html#3445">[ thread ]</a>
              <a href="subject.html#3445">[ subject ]</a>
              <a href="author.html#3445">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 22/09/2015 10:00 p.m., Kinkie wrote:
&gt;<i> Hello,
</I>&gt;<i>   recent Linux kernels have a new behavior, by which linux/in.h
</I>&gt;<i> defines some symbols which are also defined in netinet/in.h. This is
</I>&gt;<i> currently causing broken builds on redhat rawhide, but others will
</I>&gt;<i> follow for sure.
</I>&gt;<i> 
</I>&gt;<i> The Linux developers have included some cross-include guards (in
</I>&gt;<i> linux/libc-compat.h); problem is, they are currently not working for
</I>&gt;<i> us.
</I>&gt;<i> 
</I>&gt;<i> The reason for this failure is in this include chain:
</I>&gt;<i> - compat/os/linux.h includes linux/capability.h which which includes
</I>&gt;<i> libc-compat.h.
</I>&gt;<i> libc-compat.h looks for the include-guards of _NETINET_IN_H, which are
</I>&gt;<i> not (yet) defined to define a macro preventing redefinnition of the
</I>&gt;<i> symbols
</I>&gt;<i> - later on, we include netinet/in.h
</I>&gt;<i> - later on, we include linux/if.h which includes linux/in.h
</I>&gt;<i> 
</I>&gt;<i> The attached patch #undef-s the linux/libc-compat.h include guards
</I>&gt;<i> before including any linux/*.h header but after including
</I>&gt;<i> netinet/in.h; this causes libc-compat.h to be reevaluated and the
</I>&gt;<i> correct guards to be defined.
</I>&gt;<i> 
</I>&gt;<i> It's a hack, but it's proven working. The long route would probably
</I>&gt;<i> have to be to  rework compat/os/linux which I'm quite wary of.
</I>&gt;<i> 
</I>&gt;<i> Opinions?
</I>
I'd like these bits to be isolated in compat/os/linux.h if at all possible.

NP: this is &lt;<A HREF="http://bugs.squid-cache.org/show_bug.cgi?id=4323">http://bugs.squid-cache.org/show_bug.cgi?id=4323</A>&gt;

Amos

</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003441.html">[squid-dev] [PATCH] Fix broken cross-include guards in Linux	Netfilter code
</A></li>
	<LI>Next message: <A HREF="003446.html">[squid-dev] [PATCH] Fix broken cross-include guards in Linux Netfilter code
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3445">[ date ]</a>
              <a href="thread.html#3445">[ thread ]</a>
              <a href="subject.html#3445">[ subject ]</a>
              <a href="author.html#3445">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
