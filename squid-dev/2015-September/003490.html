<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] convert digest_nonce_h to MEMPROXY_CLASS
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20convert%20digest_nonce_h%20to%20MEMPROXY_CLASS&In-Reply-To=%3CCA%2BY8hcNceYeSaQdCHGhr0_89ikRjY%3DFMJBhpJmRDrccimU%2Bu6g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="003488.html">
   <LINK REL="Next"  HREF="003492.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] convert digest_nonce_h to MEMPROXY_CLASS</H1>
    <B>Kinkie</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20convert%20digest_nonce_h%20to%20MEMPROXY_CLASS&In-Reply-To=%3CCA%2BY8hcNceYeSaQdCHGhr0_89ikRjY%3DFMJBhpJmRDrccimU%2Bu6g%40mail.gmail.com%3E"
       TITLE="[squid-dev] [PATCH] convert digest_nonce_h to MEMPROXY_CLASS">gkinkie at gmail.com
       </A><BR>
    <I>Sun Sep 27 17:40:10 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="003488.html">[squid-dev] [PATCH] convert digest_nonce_h to MEMPROXY_CLASS
</A></li>
        <LI>Next message: <A HREF="003492.html">[squid-dev] [PATCH] convert digest_nonce_h to MEMPROXY_CLASS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3490">[ date ]</a>
              <a href="thread.html#3490">[ thread ]</a>
              <a href="subject.html#3490">[ subject ]</a>
              <a href="author.html#3490">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sun, Sep 27, 2015 at 12:51 PM, Amos Jeffries &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid3 at treenet.co.nz</A>&gt; wrote:
&gt;<i> On 27/09/2015 10:30 p.m., Kinkie wrote:
</I>&gt;&gt;<i> .. and remove one XXX in the process.
</I>&gt;&gt;<i> Not much to add besides the subject.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> build- and lightly run-tested, seems to be ok.
</I>&gt;&gt;<i> Big-context patch attached.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Two big problems stand right out.
</I>&gt;<i>
</I>&gt;<i> * The static random and distribution objects were specificaly internal
</I>&gt;<i> to a function in order so that they got initialized on first use, but
</I>&gt;<i> did not get initialized if never used.
</I>&gt;<i>
</I>&gt;<i> That is somewhat important to a) save the machine available entropy bits
</I>&gt;<i> for other useswhen Digest is not configured, and b) decrease the
</I>&gt;<i> probability that the workers initialize them within the same second -
</I>&gt;<i> they only get initialized on first traffic request handled, not during
</I>&gt;<i> the startup second. And so the seeding can survive fork()'ing.
</I>
Whoops, I had misinterpreted the intention in this code as stated in
the first comment in authenticateDigestNonceNew. Is that not
intentional?
But if the problem is unique seeding, isn't it also useful to mix time
with a known-unique quantity, e.g. the PID?
In the meantime I've moved these data members as static members of
digest_nonce_data::refreshRandomData() and referenced that from the
ctor .

&gt;<i> * the contents of authenticateDigestNonceNew() should be in the nonce
</I>&gt;<i> object ctor, or at least a method called by it.
</I>
Are you sure? It seems to me that it's actually the other way around:
authenticateDigestNonceNew is the only place where digest_nonce_data
gets instantiated, I've factored the POD instantiation code out of
digest_nonce_data to the ctor. The code could certainly be improved,
e.g. by moving the nonces registry and the nonce base64 encoding as a
static member of digest_nonce_h . It may be argued that the comment
block in authenticateDigestNonceNew could be moved elsewhere, I don't
really know what could be the best location for it tho.

&gt;<i> * the contents of authenticateDigestNonceDelete() should be the nonce
</I>&gt;<i> objects dtor.
</I>
Not unless we move the cache in the nonce_data class. It's doable but
I consider it out of scope for this effort. I've added an XXX about
that.

Updated patch attached.

-- 
    Francesco
-------------- next part --------------
A non-text attachment was scrubbed...
Name: mempool-nozero-digest_nonce_h-v2.patch
Type: text/x-patch
Size: 11717 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20150927/f1bfdbdb/attachment.bin">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20150927/f1bfdbdb/attachment.bin</A>&gt;
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003488.html">[squid-dev] [PATCH] convert digest_nonce_h to MEMPROXY_CLASS
</A></li>
	<LI>Next message: <A HREF="003492.html">[squid-dev] [PATCH] convert digest_nonce_h to MEMPROXY_CLASS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3490">[ date ]</a>
              <a href="thread.html#3490">[ thread ]</a>
              <a href="subject.html#3490">[ subject ]</a>
              <a href="author.html#3490">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
