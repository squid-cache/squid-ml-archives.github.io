<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] ICAP REQMOD request and response structure expectations?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20ICAP%20REQMOD%20request%20and%20response%20structure%20expectations%3F&In-Reply-To=%3C5609D3F0.5070302%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="003537.html">
   <LINK REL="Next"  HREF="003544.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] ICAP REQMOD request and response structure expectations?</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20ICAP%20REQMOD%20request%20and%20response%20structure%20expectations%3F&In-Reply-To=%3C5609D3F0.5070302%40ngtech.co.il%3E"
       TITLE="[squid-dev] ICAP REQMOD request and response structure expectations?">eliezer at ngtech.co.il
       </A><BR>
    <I>Mon Sep 28 23:57:36 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="003537.html">[squid-dev] Jenkins build is back to normal : trunk-polygraph #877
</A></li>
        <LI>Next message: <A HREF="003544.html">[squid-dev] ICAP REQMOD request and response structure expectations?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3538">[ date ]</a>
              <a href="thread.html#3538">[ thread ]</a>
              <a href="subject.html#3538">[ subject ]</a>
              <a href="author.html#3538">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have been working on an ICAP service and eventually I found out that 
some of the issues I have been struggling to resolve are just there 
because the library implementer partially read the RFC or just not fully 
considered the code he was writing.

So after reading the ICAP RFC(who knows what time) I found out that 
squid obeys it but it seems to alter the requests a bit.
So I wanted to verify as much as possible I understand correctly what is 
possible.
For HTTP requests squid seems to replace the original request first line 
PATH to a full URI.
I have tried couple times to verify and this is how it works..
I remember that there might have been an RFC that allows the usage of a 
full url in the path of the Request first line and I know but it is 
supported by many web servers.

So would it be expected to be always like that in squid? since it 
applies to tproxy and forward proxy mode I assume it will be the same 
for everything else including reverse proxy mode.
Another case is the CONNECT method, there I know that in a forward proxy 
mode a URI is not being used in the path but a domain\ip:port is there 
always.

Now to the main question:
In a case I would modify a request to perform a url rewrite like 
operation, which is to replace url_rewrite helper I can do one of two 
things.
- I can either modify the full request and transparently send the client 
to another page.
- or use the same request and append a response such as 302 or 307 
redirection.

The second case is simple to implement but the first one(changing the 
original request) means that I am changing the URL, but what squid 
expects me to change in the request? or what response does it expects?
Does squid expect me to change the URI only in the request first line or 
also the Host header?

It is not a &quot;critical&quot; question since for now I replace them both, but 
if squid expects only the URI in the first request line to be changed 
there is no point to change the Host header.

Thanks In Advance,
Eliezer

* I am trying to think about documenting couple things about ICAP in the 
WIKI with an example ICAP service.
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003537.html">[squid-dev] Jenkins build is back to normal : trunk-polygraph #877
</A></li>
	<LI>Next message: <A HREF="003544.html">[squid-dev] ICAP REQMOD request and response structure expectations?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3538">[ date ]</a>
              <a href="thread.html#3538">[ thread ]</a>
              <a href="subject.html#3538">[ subject ]</a>
              <a href="author.html#3538">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
