<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Do not hide important/critical messages
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Do%20not%20hide%20important/critical%20messages&In-Reply-To=%3C5709D9CF.7080201%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="005571.html">
   <LINK REL="Next"  HREF="005580.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Do not hide important/critical messages</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Do%20not%20hide%20important/critical%20messages&In-Reply-To=%3C5709D9CF.7080201%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] Do not hide important/critical messages">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Apr 10 04:42:55 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="005571.html">[squid-dev] Jenkins build is back to normal : trunk-full-matrix » gcc,d-ubuntu-trusty #140
</A></li>
        <LI>Next message: <A HREF="005580.html">[squid-dev] [PATCH] Do not hide important/critical messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5575">[ date ]</a>
              <a href="thread.html#5575">[ thread ]</a>
              <a href="subject.html#5575">[ subject ]</a>
              <a href="author.html#5575">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 29/03/2016 12:44 p.m., Alex Rousskov wrote:
&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i>     While working on Squid bug 4465 (Header forgery detection leads to
</I>&gt;<i> crash), I noticed that Squid may hide important/critical debugs()
</I>&gt;<i> messages from the admin if those messages are assembled using code that
</I>&gt;<i> also uses debugs(). For example, unpatched Squid console only says:
</I>&gt;<i> 
</I>&gt;<i>   2016/03/27 14:19:48.297| SECURITY ALERT: By user agent:
</I>&gt;<i>   2016/03/27 14:19:48.297| SECURITY ALERT: on URL: dut70.test:443
</I>&gt;<i> 
</I>&gt;<i> A patched Squid produces the expected three console lines:
</I>&gt;<i> 
</I>&gt;<i>   2016/03/27 15:25:42| SECURITY ALERT: Host header forgery detected...
</I>&gt;<i>   2016/03/27 15:25:42| SECURITY ALERT: By user agent:
</I>&gt;<i>   2016/03/27 15:25:42| SECURITY ALERT: on URL: dut70.test:443
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> The underlying debugs() bug leads to several rather confusing problems.
</I>&gt;<i> For example, the unpatched output quoted above has millisecond
</I>&gt;<i> timestamps that are not supposed to be there; the hidden lines may
</I>&gt;<i> actually be logged into cache.log (but not on the console/stderr or
</I>&gt;<i> system log). It took several patch rewrites and many tests to better
</I>&gt;<i> understand these side effects (which explains, in part, why the patch
</I>&gt;<i> has more cleanup pieces than are strictly necessary to fix the bug in
</I>&gt;<i> the subject line).
</I>&gt;<i> 
</I>&gt;<i> The attached v3.5 patch fixes the underlying bug and has several
</I>&gt;<i> positive side-effects such as faster debugs() performance, no clobbered
</I>&gt;<i> messages, and cleaner code. Please see patch preamble for a complete
</I>&gt;<i> list of known side effects.
</I>&gt;<i> 
</I>&gt;<i> If this v3.5 patch is accepted in principle, I hope somebody volunteers
</I>&gt;<i> a trunk port (which should not be difficult).
</I>&gt;<i> 
</I>
This appears to be just a polished implementation of the intended
debugs() original design. So in principle its already acceptible.

To get into v3.5 it does need to go in through v4 first though. We don't
want a repeat of the 2.x forking situation.

Amos

</PRE>



























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005571.html">[squid-dev] Jenkins build is back to normal : trunk-full-matrix » gcc,d-ubuntu-trusty #140
</A></li>
	<LI>Next message: <A HREF="005580.html">[squid-dev] [PATCH] Do not hide important/critical messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5575">[ date ]</a>
              <a href="thread.html#5575">[ thread ]</a>
              <a href="subject.html#5575">[ subject ]</a>
              <a href="author.html#5575">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
