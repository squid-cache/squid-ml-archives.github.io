<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Piping existing SSL session into squid SSL session cache
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Piping%20existing%20SSL%20session%20into%20squid%20SSL%20session%0A%20cache&In-Reply-To=%3Cfa2363de-50bc-1826-163f-4704cd5b2e5c%40fscr.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="005624.html">
   <LINK REL="Next"  HREF="005627.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Piping existing SSL session into squid SSL session cache</H1>
    <B>Florian Schüttler</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Piping%20existing%20SSL%20session%20into%20squid%20SSL%20session%0A%20cache&In-Reply-To=%3Cfa2363de-50bc-1826-163f-4704cd5b2e5c%40fscr.de%3E"
       TITLE="[squid-dev] Piping existing SSL session into squid SSL session cache">florian.schuettler at fscr.de
       </A><BR>
    <I>Wed Apr 27 21:29:32 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="005624.html">[squid-dev] Piping existing SSL session into squid SSL session cache
</A></li>
        <LI>Next message: <A HREF="005627.html">[squid-dev] [PATCH] Don't force -b 2048 into sslcrtd_program	arguments
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5625">[ date ]</a>
              <a href="thread.html#5625">[ thread ]</a>
              <a href="subject.html#5625">[ subject ]</a>
              <a href="author.html#5625">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 04/27/2016 at 23:06 Alex Rousskov wrote:
&gt;<i> On 04/27/2016 01:01 PM, Florian Schüttler wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> I have a scenario in which clients (&lt;10) are connected to a server using
</I>&gt;&gt;<i> an application protocol inside a TLS connection. These clients should
</I>&gt;&gt;<i> now be able to reuse the existing TLS session for a TLS connection to
</I>&gt;&gt;<i> Squid running on the same server by passing the session (e.g. using two
</I>&gt;&gt;<i> OpenSSL s_client instances and parameter -sess_out resp. -sess_in). That
</I>&gt;&gt;<i> would save an expensive key exchange operation. So far, my application
</I>&gt;&gt;<i> server writes the session info to a named pipe when the handshake is
</I>&gt;&gt;<i> completed using OpenSSL's PEM_write_SSL_SESSION().
</I>&gt;<i> 
</I>&gt;<i> Just to clarify: Do you want the client-to-Squid TLS connection to reuse
</I>&gt;<i> a TLS session established when the client was talking to an application
</I>&gt;<i> server that has nothing to do with Squid/HTTP except that both Squid and
</I>&gt;<i> the application server run on the same box?
</I>&gt;<i> 
</I>Well, the application protocol advertises the proxy service to the
client, but other than that they are independent. The client is an
embedded system, so key exchanges are very expensive which makes me want
to reuse the master key of the existing connection.
&gt;<i> 
</I>&gt;&gt;<i> I would now like to implement a feature in Squid which periodically
</I>&gt;&gt;<i> reads the pipe and adds this session information to the staticSslContext
</I>&gt;&gt;<i> in Squid using PEM_read_SSL_SESSION(). Ideally, this would integrate
</I>&gt;&gt;<i> into the event scheduling infrastructure (commEngine?) and not just be
</I>&gt;&gt;<i> hacked into the main loop, but I can not find easy documentation about
</I>&gt;&gt;<i> how to achieve this. Can anyone give me some pointers?
</I>&gt;<i> 
</I>&gt;<i> AFAIK, there is no &quot;easy documentation&quot; for what you want to do.
</I>&gt;<i> 
</I>&gt;<i> If possible, I would simplify this a lot by writing session information
</I>&gt;<i> into a well-known file and [re]loading the session information [if it
</I>&gt;<i> has changed] just after accepting a TCP connection on https_port and
</I>&gt;<i> before calling SSL_accept(). This way, there is no need to add any new
</I>&gt;<i> Squid &quot;events&quot; and maintain an asynchronous session-updating job
</I>&gt;<i> reacting to those events.
</I>&gt;<i> 
</I>Yeah, maybe this will be easier, the pipe could then be used as a buffer
and I would not need to read it directly after writing. At the moment it
is just a proof of concept/prototype anyway.
&gt;<i> 
</I>&gt;<i> HTH,
</I>&gt;<i> 
</I>&gt;<i> Alex.
</I>&gt;<i> 
</I>Thanks,
Florian

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005624.html">[squid-dev] Piping existing SSL session into squid SSL session cache
</A></li>
	<LI>Next message: <A HREF="005627.html">[squid-dev] [PATCH] Don't force -b 2048 into sslcrtd_program	arguments
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5625">[ date ]</a>
              <a href="thread.html#5625">[ thread ]</a>
              <a href="subject.html#5625">[ subject ]</a>
              <a href="author.html#5625">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
