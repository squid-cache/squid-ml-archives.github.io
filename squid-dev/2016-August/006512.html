<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PREVIEW] Fixed reporting of NULL header characters
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPREVIEW%5D%20Fixed%20reporting%20of%20NULL%20header%20characters&In-Reply-To=%3C57A42413.5030302%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="006603.html">
   <LINK REL="Next"  HREF="006519.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PREVIEW] Fixed reporting of NULL header characters</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPREVIEW%5D%20Fixed%20reporting%20of%20NULL%20header%20characters&In-Reply-To=%3C57A42413.5030302%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PREVIEW] Fixed reporting of NULL header characters">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Aug  5 05:28:51 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="006603.html">[squid-dev] [PATCH] GnuTLS session redo
</A></li>
        <LI>Next message: <A HREF="006519.html">[squid-dev] Build failed in Jenkins: trunk-matrix » clang,d-debian-jessie #716
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6512">[ date ]</a>
              <a href="thread.html#6512">[ thread ]</a>
              <a href="subject.html#6512">[ subject ]</a>
              <a href="author.html#6512">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

    Our Level-1 &quot;WARNING: HTTP header contains NULL characters&quot; messages
were broken as was the level-7 reporting of the headers being parsed.
Level-2 reporting of &quot;HTTP Server RESPONSE&quot; headers (and probably raw
data in other contexts) was and still is broken. These lying-debugging
problems could waste quite a bit of time during triage.

Please see the patch preamble for details. I believe similar problems
affect both v3.5 and trunk although I have been working only with trunk
during triage. Sample debugging logs are quoted below.

I am posting this patch as a PREVIEW to warn folks about these bugs and
to ask for volunteers to complete the two remaining TODOs detailed in
the preamble. Would anybody be willing to be responsible for this work?


Thank you,

Alex.

------ unpatched v3.5 output ------

&gt;<i> 2016/08/04 23:16:48.738| 55,7| HttpHeader.cc(597) parse: parsing hdr: (0x23ea928)
</I>&gt;<i> Before-Null: foo
</I>&gt;<i> 
</I>&gt;<i> 2016/08/04 23:16:48.738| WARNING: HTTP header contains NULL characters {Before-Null: foo
</I>&gt;<i> }
</I>&gt;<i> NULL
</I>&gt;<i> {Before-Null: foo
</I>&gt;<i> 
</I>&gt;<i> 2016/08/04 23:16:48.738| 55,7| HttpHeader.cc(480) clean: cleaning hdr: 0x23ea928 owner: 3
</I>

------ patched trunk output -------

&gt;<i> 2016/08/04 23:13:40.879| 55,7| HttpHeader.cc(329) parse: 0x175f668 got buf[171]={
</I>&gt;<i> Before-Null: foo
</I>&gt;<i> .After-Null: bar
</I>&gt;<i> Server: DaftServer/1.0
</I>&gt;<i> Connection: close
</I>&gt;<i> Date: Fri, 05 Aug 2016 05:13:40 GMT
</I>&gt;<i> X-Daft-Response-ID: midcc64dd2c
</I>&gt;<i> Content-Length: 12
</I>&gt;<i> 
</I>&gt;<i> }
</I>&gt;<i> 2016/08/04 23:13:40.879| WARNING: HTTP header contains a NULL character; before[18]={
</I>&gt;<i> Before-Null: foo
</I>&gt;<i> } and after[152]={
</I>&gt;<i> After-Null: bar
</I>&gt;<i> Server: DaftServer/1.0
</I>&gt;<i> Connection: close
</I>&gt;<i> Date: Fri, 05 Aug 2016 05:13:40 GMT
</I>&gt;<i> X-Daft-Response-ID: midcc64dd2c
</I>&gt;<i> Content-Length: 12
</I>&gt;<i> 
</I>&gt;<i> }
</I>&gt;<i> 2016/08/04 23:13:40.879| 55,7| HttpHeader.cc(184) clean: cleaning hdr: 0x175f668 owner: 3
</I>-------------- next part --------------
A non-text attachment was scrubbed...
Name: null-char-in-header-t1.patch
Type: text/x-diff
Size: 9423 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20160804/ee7699cc/attachment.patch">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20160804/ee7699cc/attachment.patch</A>&gt;
</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006603.html">[squid-dev] [PATCH] GnuTLS session redo
</A></li>
	<LI>Next message: <A HREF="006519.html">[squid-dev] Build failed in Jenkins: trunk-matrix » clang,d-debian-jessie #716
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6512">[ date ]</a>
              <a href="thread.html#6512">[ thread ]</a>
              <a href="subject.html#6512">[ subject ]</a>
              <a href="author.html#6512">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
