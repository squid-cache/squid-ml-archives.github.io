<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Ipc::MemMap::ttl removal
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Ipc%3A%3AMemMap%3A%3Attl%20removal&In-Reply-To=%3Cbdeda637-6737-aa3f-ab97-83338565d358%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="006537.html">
   <LINK REL="Next"  HREF="006536.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Ipc::MemMap::ttl removal</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Ipc%3A%3AMemMap%3A%3Attl%20removal&In-Reply-To=%3Cbdeda637-6737-aa3f-ab97-83338565d358%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] Ipc::MemMap::ttl removal">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Aug  8 14:12:29 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="006537.html">[squid-dev] [RFC] eCAP auto-enable
</A></li>
        <LI>Next message: <A HREF="006536.html">[squid-dev] [PATCH] Ipc::MemMap::ttl removal
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6530">[ date ]</a>
              <a href="thread.html#6530">[ thread ]</a>
              <a href="subject.html#6530">[ subject ]</a>
              <a href="author.html#6530">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Coverity Scan latest checks are reporting that the ttl member of
Ipc::MemMap is being left uninitialized.

It sounds like something which would lead to major bugs. Except that it
turns out, AFAICS, that this ttl member is never actually being used.

Anyone have a reason not to simply drop it from the code?

Amos
-------------- next part --------------
=== modified file 'src/ipc/MemMap.h'
--- src/ipc/MemMap.h	2016-02-23 08:51:22 +0000
+++ src/ipc/MemMap.h	2016-08-08 13:58:49 +0000
@@ -107,41 +107,40 @@
     /// close slot after reading, decrements read level
     void closeForReading(const sfileno fileno);
 
     bool full() const; ///&lt; there are no empty slots left
     bool valid(const int n) const; ///&lt; whether n is a valid slot coordinate
     int entryCount() const; ///&lt; number of used slots
     int entryLimit() const; ///&lt; maximum number of slots that can be used
 
     /// adds approximate current stats to the supplied ones
     void updateStats(ReadWriteLockStats &amp;stats) const;
 
     /// The cleaner MemMapCleaner::noteFreeMapSlot method called when a
     /// readable entry is freed.
     MemMapCleaner *cleaner;
 
 protected:
     static Owner *Init(const char *const path, const int limit, const size_t extrasSize);
 
     const SBuf path; ///&lt; cache_dir path, used for logging
     Mem::Pointer&lt;Shared&gt; shared;
-    int ttl;
 
 private:
     int slotIndexByKey(const cache_key *const key) const;
     Slot &amp;slotByKey(const cache_key *const key);
 
     Slot *openForReading(Slot &amp;s);
     void abortWriting(const sfileno fileno);
     void freeIfNeeded(Slot &amp;s);
     void freeLocked(Slot &amp;s, bool keepLocked);
 };
 
 /// API for adjusting external state when dirty map slot is being freed
 class MemMapCleaner
 {
 public:
     virtual ~MemMapCleaner() {}
 
     /// adjust slot-linked state before a locked Readable slot is erased
     virtual void noteFreeMapSlot(const sfileno slotId) = 0;
 };

</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006537.html">[squid-dev] [RFC] eCAP auto-enable
</A></li>
	<LI>Next message: <A HREF="006536.html">[squid-dev] [PATCH] Ipc::MemMap::ttl removal
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6530">[ date ]</a>
              <a href="thread.html#6530">[ thread ]</a>
              <a href="subject.html#6530">[ subject ]</a>
              <a href="author.html#6530">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
