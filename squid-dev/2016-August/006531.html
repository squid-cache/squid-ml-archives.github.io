<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Make Squid death due to overloaded helpers	optional
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Make%20Squid%20death%20due%20to%20overloaded%20helpers%0A%09optional&In-Reply-To=%3C57A8A1F3.6070206%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="006540.html">
   <LINK REL="Next"  HREF="006535.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Make Squid death due to overloaded helpers	optional</H1>
    <B>Eduard Bagdasaryan</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Make%20Squid%20death%20due%20to%20overloaded%20helpers%0A%09optional&In-Reply-To=%3C57A8A1F3.6070206%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] Make Squid death due to overloaded helpers	optional">eduard.bagdasaryan at measurement-factory.com
       </A><BR>
    <I>Mon Aug  8 15:14:59 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="006540.html">[squid-dev] [PATCH] Ipc::MemMap::ttl removal
</A></li>
        <LI>Next message: <A HREF="006535.html">[squid-dev] [PATCH] Make Squid death due to overloaded helpers optional
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6531">[ date ]</a>
              <a href="thread.html#6531">[ thread ]</a>
              <a href="subject.html#6531">[ subject ]</a>
              <a href="author.html#6531">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This patch allows to configure Squid so that it reject overloaded helper
requests instead of [default] crashing.

Added on-persistent-overload=action option to helpers. Helper overload
is defined as running with an overflowing queue. Persistent helper
overload is [still] defined as being overloaded for more than 3 minutes.

The default behavior is unchanged(*) -- Squid worker dies with a fatal
error at the attempt to submit a new request to a persistenly overloaded
helper. This default behavior can also be configured explicitly using
on-persistent-overload=die.

With on-persistent-overload=err, when dealing with a persistently
overloaded helper, Squid immediately drops the helper request and sends
an empty response to the caller which should handle that empty response
as an error. Squid informs the admin when it starts and when it stops
dropping helper requests due to persistent overload.

The code had conflicting notions of an &quot;overloaded helper&quot;. The external
ACL helper, the URL rewriter, and the store ID code used queueFull() to
test whether the new request would overflow the queue (and, hence,
overload the helper), but queueFull() itself did not check whether the
queue was full! It checked whether the queue was already overflowing.
This confusion resulted in that code scheduling one extra helper request
before enabling bypass. The code and its documentation are now more
consistent (and better match the &quot;overload&quot; terminology used by the new
configuration option, which also feels better than calling the helper
&quot;full&quot;).

(*) Resolving the above confusion resulted in minor (one request)
differences in the number of helper requests queued by Squid for
external ACL, URL rewriting, and store ID helpers, with the adjusted
behavior [better] matching the documentation.

Regards,
Eduard.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SQUID-30-reject-helper-requests-on-overload-t10.patch
Type: text/x-patch
Size: 52989 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20160808/2b5541e7/attachment-0001.bin">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20160808/2b5541e7/attachment-0001.bin</A>&gt;
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006540.html">[squid-dev] [PATCH] Ipc::MemMap::ttl removal
</A></li>
	<LI>Next message: <A HREF="006535.html">[squid-dev] [PATCH] Make Squid death due to overloaded helpers optional
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6531">[ date ]</a>
              <a href="thread.html#6531">[ thread ]</a>
              <a href="subject.html#6531">[ subject ]</a>
              <a href="author.html#6531">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
