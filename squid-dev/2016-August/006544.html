<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Make Squid death due to overloaded helpers optional
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Make%20Squid%20death%20due%20to%20overloaded%20helpers%0A%20optional&In-Reply-To=%3Ce7ccb427-a7c8-6a2b-1987-8eb20f7122cb%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="006543.html">
   <LINK REL="Next"  HREF="006545.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Make Squid death due to overloaded helpers optional</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Make%20Squid%20death%20due%20to%20overloaded%20helpers%0A%20optional&In-Reply-To=%3Ce7ccb427-a7c8-6a2b-1987-8eb20f7122cb%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] Make Squid death due to overloaded helpers optional">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Aug  9 17:39:04 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="006543.html">[squid-dev] [PATCH] Make Squid death due to overloaded helpers optional
</A></li>
        <LI>Next message: <A HREF="006545.html">[squid-dev] [PATCH] Make Squid death due to overloaded helpers optional
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6544">[ date ]</a>
              <a href="thread.html#6544">[ thread ]</a>
              <a href="subject.html#6544">[ subject ]</a>
              <a href="author.html#6544">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/08/2016 4:41 a.m., Alex Rousskov wrote:
&gt;<i> On 08/09/2016 05:38 AM, Eduard Bagdasaryan wrote:
</I>&gt;&gt;<i> On 08/08/2016 02:17 PM, Amos Jeffries wrote:
</I>&gt;&gt;&gt;<i> * helper::SubmissionFailure is also changing what was previously
</I>&gt;&gt;<i> Helper::Unknown result codes to Helper::Error.
</I>&gt;&gt;<i>  - Helper::Error is one of the helper output codes, it means success.
</I>&gt;&gt;<i> Obviousy when hlp == NULL, there is no success going on.
</I>&gt;&gt;<i>  - please revert to sending helper::Unknown code.
</I>&gt;<i> 
</I>&gt;&gt;<i> Reverted. Note that for helper::Unknown some callers print a bit
</I>&gt;&gt;<i> misleading error message, when requests are dropped, e.g.:
</I>&gt;&gt;<i> &quot;ERROR: storeID helper returned invalid result code. Wrong helper?&quot;
</I>&gt;<i> 
</I>&gt;<i> and the documentation now lies:
</I>&gt;<i> 
</I>&gt;&gt;<i> +		Two [on-persistent-overload] actions are supported:
</I>&gt;&gt;<i> +
</I>&gt;&gt;<i> +		  die	Squid worker quits. This is the default behavior.
</I>&gt;&gt;<i> +
</I>&gt;&gt;<i> +		  err	Squid treats the helper request as if it was
</I>&gt;&gt;<i> +				immediately submitted, and the helper immediately 
</I>&gt;&gt;<i> +				responded with an error. This action has no effect on
</I>&gt;&gt;<i> +				the already queued and in-progress helper requests.
</I>&gt;<i> 
</I>&gt;<i> Perhaps SubmissionFailure() should use Helper::Unknown when its hlp
</I>&gt;<i> parameter is nil and Helper::Error in other cases?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> FYI: The original intent and the documentation say that we should return
</I>&gt;<i> Helper::Error. Yes, Helper::Error means a &quot;successfully parsed&quot; helper
</I>&gt;<i> response [with helper-specific semantics], and IIRC, that is what we
</I>&gt;<i> wanted to relay to the helper-using code because that code has a better
</I>&gt;<i> chance of doing the right thing when receiving Helper::Error (compared
</I>&gt;<i> to handling Helper::Unknown).
</I>&gt;<i> 
</I>&gt;<i> We also considered adding a new result code for overload but rejected
</I>&gt;<i> that idea for several reasons, including the expectation that the
</I>&gt;<i> helper-using code already has logic to handle Helper::Error and that
</I>&gt;<i> logic will work for on-persistent-overload=err cases well.
</I>&gt;<i> 
</I>&gt;<i> Please note that I am not advocating a _change_ in the current Squid
</I>&gt;<i> default behavior. I am only questioning whether it is a good idea to
</I>&gt;<i> return Helper::Unknown instead of Helper::Error with
</I>&gt;<i> on-persistent-overload=err. Amos' arguments do not apply to that
</I>&gt;<i> specific case AFAICT because there is no &quot;change&quot; in that specific case
</I>&gt;<i> (it is a new behavior).
</I>&gt;<i> 
</I>
At the moment Helper::Unknown means a problem in Squid side of things
(fail). BH means a problem internally to the helper (fail). And both
OK/ERR mean helper decision was made (success).
 The naming may not great, and the way they map down to boolean
allow/deny type values is very painful, but thats what we have to work
with currently.

The decision of whether Unknown maps to ERR is something each different
helper interface needs to decide for itself based on what its purpose is.

Amos

</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006543.html">[squid-dev] [PATCH] Make Squid death due to overloaded helpers optional
</A></li>
	<LI>Next message: <A HREF="006545.html">[squid-dev] [PATCH] Make Squid death due to overloaded helpers optional
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6544">[ date ]</a>
              <a href="thread.html#6544">[ thread ]</a>
              <a href="subject.html#6544">[ subject ]</a>
              <a href="author.html#6544">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
