<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Revalidate without Last-Modified
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Revalidate%20without%20Last-Modified&In-Reply-To=%3C57B8C6B5.2060301%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="006604.html">
   <LINK REL="Next"  HREF="006606.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Revalidate without Last-Modified</H1>
    <B>Eduard Bagdasaryan</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Revalidate%20without%20Last-Modified&In-Reply-To=%3C57B8C6B5.2060301%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] Revalidate without Last-Modified">eduard.bagdasaryan at measurement-factory.com
       </A><BR>
    <I>Sat Aug 20 21:08:05 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="006604.html">[squid-dev] [PATCH] Better support for unknown URL schemes
</A></li>
        <LI>Next message: <A HREF="006606.html">[squid-dev] [PATCH] Revalidate without Last-Modified
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6605">[ date ]</a>
              <a href="thread.html#6605">[ thread ]</a>
              <a href="subject.html#6605">[ subject ]</a>
              <a href="author.html#6605">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

This patch fixes bug 4471.

The bug was caused by the fact that Squid used only Last-Modified header
value for evaluating entry's last modification time while making an
internal revalidation request. So, without Last-Modified it was not
possible to correctly fill If-Modified-Since header value. As a result,
the revalidation request was not initiated when it should be.

To fix this problem, we should generate If-Modified-Since based on other
data, showing how &quot;old&quot; the cached response is, such as Date and Age
header values.  Both Date and Age header values are utilized while
calculating entry's timestamp.  Therefore, we could use the timestamp if
Last-Modified is unavailable.

XXX: HttpRequest::imslen support looks broken/deprecated. Using this
field inside StoreEntry::modifiedSince() leads to several useless checks
and probably may cause other [hidden] problems.

Regards,
Eduard.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SQUID-209-revalidate-without-last-modified-t1.patch
Type: text/x-patch
Size: 62690 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20160821/f18d3920/attachment-0001.bin">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20160821/f18d3920/attachment-0001.bin</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006604.html">[squid-dev] [PATCH] Better support for unknown URL schemes
</A></li>
	<LI>Next message: <A HREF="006606.html">[squid-dev] [PATCH] Revalidate without Last-Modified
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6605">[ date ]</a>
              <a href="thread.html#6605">[ thread ]</a>
              <a href="subject.html#6605">[ subject ]</a>
              <a href="author.html#6605">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
