<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Older response must not update
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Older%20response%20must%20not%20update&In-Reply-To=%3Cfebc50c7-e680-a994-3fb0-d4f1a7cb0d02%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="006636.html">
   <LINK REL="Next"  HREF="006644.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Older response must not update</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Older%20response%20must%20not%20update&In-Reply-To=%3Cfebc50c7-e680-a994-3fb0-d4f1a7cb0d02%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] Older response must not update">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Aug 27 14:23:48 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="006636.html">[squid-dev] [PATCH] Older response must not update
</A></li>
        <LI>Next message: <A HREF="006644.html">[squid-dev] [PATCH] Older response must not update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6640">[ date ]</a>
              <a href="thread.html#6640">[ thread ]</a>
              <a href="subject.html#6640">[ subject ]</a>
              <a href="author.html#6640">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 26/08/2016 5:05 a.m., Alex Rousskov wrote:
&gt;<i> On 08/25/2016 08:18 AM, Eduard Bagdasaryan wrote:
</I>&gt;&gt;<i> 2016-08-24 18:20 GMT+03:00 Amos Jeffries &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid3 at treenet.co.nz</A>&gt;:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> in src/LogTags.cc:
</I>&gt;&gt;&gt;<i> * instead of adding new enum entry please extend LogTags with a new bool
</I>&gt;&gt;&gt;<i> flag and the c_str() to append the &quot;IGNORED&quot; when that flag is true.
</I>&gt;<i> 
</I>&gt;&gt;<i> Added a new LogTags::ignored for this.
</I>&gt;<i> 
</I>&gt;<i> The naming of things in logging code is exceptionally poor so please do
</I>&gt;<i> not feel upset that you got this wrong. The &quot;_IGNORED&quot; flag Amos is
</I>&gt;<i> talking about should go into LogTags::Errors.
</I>
Yes. Sorry for not being more clear on that.

&gt;<i> 
</I>&gt;<i> I recommend renaming and re-documenting that subclass:
</I>&gt;<i> 
</I>&gt;<i> /// Things that may happen to a transaction while it is being
</I>&gt;<i> /// processed according to its LOG_* category. Logged as _SUFFIX(es).
</I>&gt;<i> /// Unlike LOG_* categories, these flags may not be mutually exclusive.
</I>&gt;<i> class Flags
</I>&gt;<i> {
</I>&gt;<i> ...
</I>&gt;<i>    bool ignored; ///&lt; _IGNORED: the response was not used for anything
</I>&gt;<i>    bool timedout; ///&lt; _TIMEDOUT: terminated due to a lifetime or I/O
</I>&gt;<i> timeout
</I>&gt;<i>    bool aborted; ///&lt; _ABORTED: other abnormal termination (e.g., I/O error)
</I>&gt;<i> } flags;
</I>&gt;<i> 
</I>&gt;<i> This does not fix all the problems, but reduces the confusion
</I>&gt;<i> considerably IMHO.
</I>
Well, yes and no. 'Flags' is too generic. The sub-struct is called
'Errs' because it stores the data for the fail 'errors' that occured
during processing. We will eventually have several groups of flags in
similar sub-struct/class - grouped as per the wiki meaning groupings and
documented along the lines of what the wiki says already.

I'm fine with a name change if we can preserve the fail/error/abnormal
event meaning in it.

&gt;<i> 
</I>&gt;&gt;<i> I wonder whether the
</I>&gt;&gt;<i> LogTags assignment operator should copy this member too.
</I>&gt;<i> 
</I>&gt;<i> Which assignment operator?
</I>&gt;<i> 
</I>&gt;<i> * The compiler-generated assignment operator will copy all members
</I>&gt;<i> automatically, of course.
</I>&gt;<i> 
</I>&gt;<i> * The explicitly-defined LogTags_ot conversion assignment operator is
</I>&gt;<i> already buggy or dangerous. It should be removed. Whether it was meant
</I>&gt;<i> to clear the flags, I do not know, unfortunately. I recommend leaving it
</I>&gt;<i> as is because fixing it is out of scope and may not be trivial. Adding
</I>&gt;<i> an &quot;XXX: this operator does not reset flags&quot; and &quot;TODO: either replace
</I>&gt;<i> with a category-only setter or remove&quot; comments would be appropriate.
</I>
It is a setter for (only) the old &quot;mutually exclusive&quot; LOG_* category
detail - it still seems like a realatively (but not perfect) way to set
the category. The other flags are not erased by category having changed
since the event that caused them to be set has still previously occured
in the transaction. The only reason we would have for clearing those
would be a retry/reforward which is not something the LogTags itself is
aware of. The caller changing the category is expected to be aware of
the old category value and preserve anything that needs preserving
(which is part of what is wrong with the old categories way).

Amos

</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006636.html">[squid-dev] [PATCH] Older response must not update
</A></li>
	<LI>Next message: <A HREF="006644.html">[squid-dev] [PATCH] Older response must not update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6640">[ date ]</a>
              <a href="thread.html#6640">[ thread ]</a>
              <a href="subject.html#6640">[ subject ]</a>
              <a href="author.html#6640">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
