<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Older response must not update
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Older%20response%20must%20not%20update&In-Reply-To=%3C7f7d74dd-5e05-fa69-e9ca-a5a9dbffa538%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="006640.html">
   <LINK REL="Next"  HREF="006625.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Older response must not update</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Older%20response%20must%20not%20update&In-Reply-To=%3C7f7d74dd-5e05-fa69-e9ca-a5a9dbffa538%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] Older response must not update">rousskov at measurement-factory.com
       </A><BR>
    <I>Sat Aug 27 22:51:07 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="006640.html">[squid-dev] [PATCH] Older response must not update
</A></li>
        <LI>Next message: <A HREF="006625.html">[squid-dev] [PATCH] SSL CN wildcard must only match a single domain component [fragment]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6644">[ date ]</a>
              <a href="thread.html#6644">[ thread ]</a>
              <a href="subject.html#6644">[ subject ]</a>
              <a href="author.html#6644">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 08/27/2016 08:23 AM, Amos Jeffries wrote:
&gt;<i> On 26/08/2016 5:05 a.m., Alex Rousskov wrote:
</I>&gt;&gt;<i> I recommend renaming and re-documenting that subclass:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> /// Things that may happen to a transaction while it is being
</I>&gt;&gt;<i> /// processed according to its LOG_* category. Logged as _SUFFIX(es).
</I>&gt;&gt;<i> /// Unlike LOG_* categories, these flags may not be mutually exclusive.
</I>&gt;&gt;<i> class Flags
</I>&gt;&gt;<i> {
</I>&gt;&gt;<i> ...
</I>&gt;&gt;<i>    bool ignored; ///&lt; _IGNORED: the response was not used for anything
</I>&gt;&gt;<i>    bool timedout; ///&lt; _TIMEDOUT: terminated due to a lifetime or I/O
</I>&gt;&gt;<i> timeout
</I>&gt;&gt;<i>    bool aborted; ///&lt; _ABORTED: other abnormal termination (e.g., I/O error)
</I>&gt;&gt;<i> } flags;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This does not fix all the problems, but reduces the confusion
</I>&gt;&gt;<i> considerably IMHO.
</I>

&gt;<i> Well, yes and no. 'Flags' is too generic. The sub-struct is called
</I>&gt;<i> 'Errs' because it stores the data for the fail 'errors' that occured
</I>&gt;<i> during processing. 
</I>
I am not sure we want to restrict flags to errors, and it is often
difficult to say whether something is an error. For example, a response
with a smaller Date value is not really an error from the
sender/protocol point of view but can be seen as an error by the end
user that wasted all that time waiting for it. Squid does not need to
take sides. It just needs to tell the admin what has happened.


&gt;<i> We will eventually have several groups of flags in
</I>&gt;<i> similar sub-struct/class - grouped as per the wiki meaning groupings and
</I>&gt;<i> documented along the lines of what the wiki says already.
</I>&gt;<i> <A HREF="http://wiki.squid-cache.org/SquidFaq/SquidLogs#Squid_result_codes">http://wiki.squid-cache.org/SquidFaq/SquidLogs#Squid_result_codes</A>
</I>
FWIW, I doubt that wiki page is ready to represent consensus regarding
future implementation -- I see a few problems with the way tags are
classified right now, and it is not even clear whether most of the
groups contain mutually exclusive values (like enums) or flags (like
bitmaps or a bunch of boolean fields). If all but one group contains
enums, then having that special Flags &quot;bitmap&quot; group would make a lot of
sense.


&gt;<i> I'm fine with a name change if we can preserve the fail/error/abnormal
</I>&gt;<i> event meaning in it.
</I>
If you insist, the committer can rename Flags back to Errors. I doubt
Errors is better or that it is the right direction, but I am not going
to argue about it.


&gt;&gt;<i> * The explicitly-defined LogTags_ot conversion assignment operator is
</I>&gt;&gt;<i> already buggy or dangerous. It should be removed. Whether it was meant
</I>&gt;&gt;<i> to clear the flags, I do not know, unfortunately. I recommend leaving it
</I>&gt;&gt;<i> as is because fixing it is out of scope and may not be trivial.
</I>
&gt;<i> It is a setter for (only) the old &quot;mutually exclusive&quot; LOG_* category
</I>&gt;<i> detail - it still seems like a realatively (but not perfect) way to set
</I>&gt;<i> the category. The other flags are not erased by category having changed
</I>&gt;<i> since the event that caused them to be set has still previously occured
</I>&gt;<i> in the transaction. The only reason we would have for clearing those
</I>&gt;<i> would be a retry/reforward which is not something the LogTags itself is
</I>&gt;<i> aware of. The caller changing the category is expected to be aware of
</I>&gt;<i> the old category value and preserve anything that needs preserving
</I>&gt;<i> (which is part of what is wrong with the old categories way).
</I>
Thank you for explaining this. Based on the above, the TODO comment in
the patch can be made more specific to just say &quot;replace with a
category-only setter&quot;. A comitter can do that.

The new XXX comment remains correct as is: Using an assignment operator
to _partially_ reset an object is just plain wrong because it violates
the expected assignment semantics.


In summary, if you are going to commit the patch, it is your call
whether to rename Flags. If you want me to commit, please let me know
what name to use for that class. And the new TODO comment should be
adjusted to say &quot;replace with a category-only setter&quot;.


Thank you,

Alex.

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006640.html">[squid-dev] [PATCH] Older response must not update
</A></li>
	<LI>Next message: <A HREF="006625.html">[squid-dev] [PATCH] SSL CN wildcard must only match a single domain component [fragment]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6644">[ date ]</a>
              <a href="thread.html#6644">[ thread ]</a>
              <a href="subject.html#6644">[ subject ]</a>
              <a href="author.html#6644">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
