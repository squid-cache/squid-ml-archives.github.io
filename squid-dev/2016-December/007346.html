<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] auth_schemes directive
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20auth_schemes%20directive&In-Reply-To=%3C52800304-946c-31d1-282a-3b9f5d2318e5%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="007356.html">
   <LINK REL="Next"  HREF="007347.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] auth_schemes directive</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20auth_schemes%20directive&In-Reply-To=%3C52800304-946c-31d1-282a-3b9f5d2318e5%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] auth_schemes directive">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Dec  2 06:53:04 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="007356.html">[squid-dev] [PATCH] Update refresh_pattern	description	regarding 'max' option
</A></li>
        <LI>Next message: <A HREF="007347.html">[squid-dev] [PATCH] auth_schemes directive
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7346">[ date ]</a>
              <a href="thread.html#7346">[ thread ]</a>
              <a href="subject.html#7346">[ subject ]</a>
              <a href="author.html#7346">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/12/2016 8:00 a.m., Alex Rousskov wrote:
&gt;<i> On 11/30/2016 12:06 AM, Alex Rousskov wrote:
</I>&gt;&gt;<i> Perhaps there is a way to keep the per-scheme access list advantage
</I>&gt;&gt;<i> without opening the 403 Pandora box and preserving the whole-list
</I>&gt;&gt;<i> visualization provided by auth_schemes?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> For example, we could support something like this:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   auth_schemes &quot;ALL except S1&quot;    acl1 ...
</I>&gt;&gt;<i>   auth_schemes &quot;ALL except S1,S2&quot; acl2 ...
</I>&gt;&gt;<i>   auth_schemes S1,S2              acl3 ...
</I>&gt;&gt;<i>   auth_schemes ALL                acl4 ...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> but I do not like how this syntax essentially moves operators inside
</I>&gt;&gt;<i> quoted strings.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Another alternative is:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   auth_schemes S1    deny  acl1 ... # ALL except S1
</I>&gt;&gt;<i>   auth_schemes S1,S2 deny  acl2 ... # ALL except S1 and S2
</I>&gt;&gt;<i>   auth_schemes S1,S2 allow acl3 ... # just S1 and S2
</I>&gt;&gt;<i>   auth_schemes ALL   allow acl4 ... # ALL
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> (with the configuration implementation similar to the existing
</I>&gt;&gt;<i> request_header_access rules).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Unfortunately, in all these cases, we would have to special-case
</I>&gt;&gt;<i> denying/excepting all schemes to avoid opening the 403 Pandora box. Only
</I>&gt;&gt;<i> the current auth_schemes implementation avoids that 403 problem (because
</I>&gt;&gt;<i> an empty list is a syntax-level/configure-time violation).
</I>&gt;<i> 
</I>&gt;<i> I just got a nice illustration why that 403-via-lack-of-schemes Pandora
</I>&gt;<i> box should remain closed:
</I>&gt;<i> 
</I>&gt;<i> A customer has indicated that &quot;auth_schemes NONE&quot; support would make
</I>&gt;<i> writing their configurations a little easier. That comment appeared to
</I>&gt;<i> support your assertion that lack-of-schemes should be treated as a
</I>&gt;<i> special useful 403 Forbidden case. However, to my surprise, the
</I>&gt;<i> follow-up conversation revealed that the customer expected &quot;auth_schemes
</I>&gt;<i> NONE&quot; to _allow_ access, not forbid it!
</I>
Excellent. Not sure if you intended to but you have just done a good CHI
test.

One of the top UI design rules is that users feel comfortable with UI
things they have repeated.
 A user enjoying new experience with something means previous experience
with another UI of the same structure.
 Most of the time familiarity is a good thing. But one has to be very
careful to actually follow the common design pattern, and not lead to
implicit contradictions.

Your wording/layout of that directive has clearly collided with some
other config grammar that user is more familiar with from somewhere
else. It may even be a collision with the other Squid directive
patterns. see (1) below.


&gt;<i> 
</I>&gt;<i> This example of diametrically opposed expectations reinforces my
</I>&gt;<i> original worries about supporting this special &quot;no authentication
</I>&gt;<i> schemes&quot; case. I think we should continue to rely on http_access to
</I>&gt;<i> permit or forbid access (including permitting or forbidding access
</I>&gt;<i> without authentication) and require at least one authentication scheme
</I>&gt;<i> to be available when authentication schemes are configured/used.
</I>
The CHI test says nothing about the case itself. It says that the
intended UI for configuring it is flawed and unable to convey true
meaning accurately.

If the user had understood it correctly and still had trouble with it
there would be a worry about supporting it.


&gt;<i> 
</I>&gt;<i> Said that, there might still be a way to configure the list of schemes
</I>&gt;<i> better than the posted auth_schemes does. I have not found it yet though.
</I>&gt;<i> 
</I>
I propose:

1) get rid of the &quot;allow/deny&quot; field. Make all those lines allow if all
the line ACLs match, and skip if one of them non-match.

We have a common pattern in Squid that directives allowing/denying
access to traffic pathways use allow/deny keywords, but directives that
control some component of Squid being enabled/disabled just have a list
of ACL names and the directive &quot;thing&quot; happens if they all match.

This directive is one of the latter type. So it would be more consistent
with existing pattern if they were not there. It does make config
slightly less convenient, but that can be balanced partially by using
all-of ACL.


2) try other names for the directive:
   auth_scheme_order seems more clear description to me.


3) if necessary after (2), try other ways to name the 'none' case:
  reject, fail-auth, no-scheme, etc.


Though IMO you should find that just (1) and (2) are sufficient:

 The line &quot;auth_scheme_order none all&quot; etc. seems more likely to lead a
user to &quot;WTF, I have to look that up&quot; than assuming wrong knowledge
about access being allowed.


Also, what is this &quot;ALL&quot; case in the above examples?
 did you mean &quot;default&quot;? as in 'the default order'.

Amos
</PRE>





























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007356.html">[squid-dev] [PATCH] Update refresh_pattern	description	regarding 'max' option
</A></li>
	<LI>Next message: <A HREF="007347.html">[squid-dev] [PATCH] auth_schemes directive
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7346">[ date ]</a>
              <a href="thread.html#7346">[ thread ]</a>
              <a href="subject.html#7346">[ subject ]</a>
              <a href="author.html#7346">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
