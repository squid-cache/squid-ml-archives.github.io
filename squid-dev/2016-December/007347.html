<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] auth_schemes directive
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20auth_schemes%20directive&In-Reply-To=%3Cb2c8b123-2d60-6048-dd7a-ec51d817cd78%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="007346.html">
   <LINK REL="Next"  HREF="007358.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] auth_schemes directive</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20auth_schemes%20directive&In-Reply-To=%3Cb2c8b123-2d60-6048-dd7a-ec51d817cd78%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] auth_schemes directive">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Dec  2 16:41:07 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="007346.html">[squid-dev] [PATCH] auth_schemes directive
</A></li>
        <LI>Next message: <A HREF="007358.html">[squid-dev] [PATCH] auth_schemes directive
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7347">[ date ]</a>
              <a href="thread.html#7347">[ thread ]</a>
              <a href="subject.html#7347">[ subject ]</a>
              <a href="author.html#7347">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12/01/2016 11:53 PM, Amos Jeffries wrote:

&gt;<i> Not sure if you intended to but you have just done a good CHI test.
</I>
I do not know what you mean by &quot;CHI test&quot;. Googling did not help.


&gt;<i> Your wording/layout of that directive has clearly collided with some
</I>&gt;<i> other config grammar that user is more familiar with from somewhere
</I>&gt;<i> else.
</I>
Yes, although this has nothing to do with the example I was talking
about. And it is not &quot;wording&quot;. Other directives assemble &quot;lists&quot;
implicitly, by combining the effect of multiple matching rules. In
auth_schemes case, the list is set explicitly by the first matching
rule. The list is treated as a single monolithic whole. There are other
directives where the first matching rile selects a monolithic value, but
they do not deal with lists IIRC.

The implemented design solves a couple of serious problems. The question
is whether the traditional implicit list assembly would have been better
in this case. I think (and tried to illustrate why) it would have been
worse, but others may think otherwise, of course.


&gt;<i> the
</I>&gt;<i> intended UI for configuring it is flawed and unable to convey true
</I>&gt;<i> meaning accurately.
</I>
Yes, provided NONE becomes a part of the auth_schemes UI. It is not now,
and it should not be added. Without NONE, there is no confusion. I agree
that some other, more specific magic words may be added (after careful
consideration of alternatives) to support various NONE use cases, as you
have proposed in (3) below.


&gt;<i> I propose:
</I>&gt;<i> 
</I>&gt;<i> 1) get rid of the &quot;allow/deny&quot; field. Make all those lines allow if all
</I>&gt;<i> the line ACLs match, and skip if one of them non-match.
</I>
Done. Implemented auth_schemes do not use allow/deny. Your proposal
matches what we have implemented.

The implemented auth_schemes make it impossible to say &quot;ALL except S1&quot;
without explicitly enumerating all schemes:

  auth_schemes S2,S3,... acl1 ... # ugly: ALL except S1
  auth_schemes S1,S3,... acl2 ... # ugly: ALL except S2

In my earlier example of an alternative design, I considered adding
allow/deny to avoid that explicit enumeration of schemes:

  auth_schemes S1 deny acl1 ... # nice: ALL except S1
  auth_schemes S2 deny acl2 ... # nice: ALL except S2

I subsequently ruled that alternative out as inferior because it may
lead to dangerously confusing configurations like:

  auth_schemes ALL deny acl1 ... # no schemes; but what does that mean?!
  auth_schemes S1,S2,... deny acl2 ... # same problem but now _implicit_



&gt;<i> 2) try other names for the directive:
</I>&gt;<i>    auth_scheme_order seems more clear description to me.
</I>
The _order suffix does not make sense to me because the directive
controls both order and presence; and the &quot;presence&quot; is a far more
common use case. I think auth_schemes is close to perfection but I am
happy to discuss other alternatives!


&gt;<i> 3) if necessary after (2), try other ways to name the 'none' case:
</I>&gt;<i>   reject, fail-auth, no-scheme, etc.
</I>
Sounds good, but adding more magic names to supporting NONE caseS (there
are many!) can (and IMO should) be considered separately. The feature
works fine without NONE support. Deciding how to properly support NONE
cases (and which of them to support) is difficult. There is no necessity
to enlarge the scope of this project.

We seem to agree that more magic names may be added to support more use
cases, so committing the current implementation does not hurt that
future work. When the subject of other/NONE use cases is studied (as a
separate project), we should determine if those use cases are best
supported via more magic names in auth_schemes, new directives, and/or
good old http_access ACLs.


&gt;<i> Also, what is this &quot;ALL&quot; case in the above examples?
</I>&gt;<i>  did you mean &quot;default&quot;? as in 'the default order'.
</I>
The magic ALL name stands for &quot;all configured authentication schemes&quot;.
Here are the relevant parts of the documentation:

&gt;<i> +	Use this directive to customize authentication schemes presence and
</I>&gt;<i> +	order in Squid's Unauthorized and Authentication Required responses.
</I>&gt;<i> +
</I>&gt;<i> +		auth_schemes scheme1,scheme2,... [!]aclname ...
</I>&gt;<i> +
</I>&gt;<i> +	where schemeN is the name of one of the authentication schemes
</I>&gt;<i> +	configured using auth_param directives.
</I>
&gt;<i> +	A special &quot;ALL&quot; scheme name expands to all auth_param-configured
</I>&gt;<i> +	schemes in their configuration order.
</I>
&gt;<i> +	The following example sends basic and negotiate authentication
</I>&gt;<i> +	schemes, in that order, when requesting authentication of HTTP
</I>&gt;<i> +	requests matching the isIE ACL (not shown) while sending all
</I>&gt;<i> +	auth_param schemes in their configuration order to other clients:
</I>&gt;<i> +
</I>&gt;<i> +		auth_schemes basic,negotiate isIE
</I>&gt;<i> +		auth_schemes ALL all # explicit default
</I>
Directive naming aside, since what you have proposed is already
implemented, we will proceed with splitting the patch into two parts, as
you have requested earlier. This will give you and others more time to
suggest a better name than auth_schemes.


Thank you,

Alex.

</PRE>






























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007346.html">[squid-dev] [PATCH] auth_schemes directive
</A></li>
	<LI>Next message: <A HREF="007358.html">[squid-dev] [PATCH] auth_schemes directive
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7347">[ date ]</a>
              <a href="thread.html#7347">[ thread ]</a>
              <a href="subject.html#7347">[ subject ]</a>
              <a href="author.html#7347">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
