<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Fix If-None-Match processing and related bug 4169
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Fix%20If-None-Match%20processing%20and%20related%20bug%204169&In-Reply-To=%3C08cf5537-1074-24a9-a73e-a6ea84c847f5%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="007455.html">
   <LINK REL="Next"  HREF="007351.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Fix If-None-Match processing and related bug 4169</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Fix%20If-None-Match%20processing%20and%20related%20bug%204169&In-Reply-To=%3C08cf5537-1074-24a9-a73e-a6ea84c847f5%40measurement-factory.com%3E"
       TITLE="[squid-dev] Fix If-None-Match processing and related bug 4169">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Dec  5 03:05:26 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="007455.html">[squid-dev] Automake bug workaround
</A></li>
        <LI>Next message: <A HREF="007351.html">[squid-dev] Fix If-None-Match processing and related bug 4169
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7350">[ date ]</a>
              <a href="thread.html#7350">[ thread ]</a>
              <a href="subject.html#7350">[ subject ]</a>
              <a href="author.html#7350">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/30/2016 08:12 AM, Garri Djavadyan wrote:

&gt;<i> I've attached fixed version.
</I>
&gt;<i> +        // If-None-Match did not match; treat as an unconditional hit
</I>&gt;<i> +        return false;
</I>
Actually, in this case, If-None-Match matched (i.e., &quot;no one matched&quot; is
true). And this is exactly why we can ignore that conditional header
field and treat the request as an unconditional hit. All these
conditional headers have the same overall logic: If the answer to the
&quot;If&quot; question asked by the header field name is &quot;yes&quot;, then the header
field is essentially ignored.

How about:

  // None-Match is true (no one matched); treat as an unconditional hit

I apologize for using the wrong comment wording in the earlier sketch.


&gt;<i>      if (r.flags.ims) {
</I>&gt;<i>          // handle If-Modified-Since requests from the client
</I>&gt;<i>          if (e-&gt;modifiedSince(r.ims, r.imslen)) {
</I>&gt;<i> +	    // object modified; treat as an unconditional hit
</I>&gt;<i> +	    return false;
</I>
The comment sounds weird because it is not clear which object it is
talking about and when it was modified: Client's object or Squid's
object? Since client cached it or since Squid cached it? The answer is,
of course, that the resource was modified since the client has cached
its response (but before Squid cached its response). I suggest using
something like this instead:

  // Modified-Since is true; treat as an unconditional hit

These comment fixes can be done during commit IMO.


&gt;<i> On Thu, 2016-12-01 at 01:20 +1300, Amos Jeffries wrote:
</I>&gt;&gt;<i> I would really like the LogTags flag to be an actual flag, but I can
</I>&gt;&gt;<i> do that as a followup or later when I convert the others to flags.
</I>&gt;<i> 
</I>&gt;<i> Should I revert TCP_INM_HIT to TCP_IMS_HIT at the moment?
</I>
I do not know the answer to that question, but it sounded like Amos was
OK with your changes regarding the INM pseudo-flag.

If you have not done so, please do check _all_ TCP_IMS_HIT occurrences
(at least) to make sure the surrounding code is still valid after
splitting TCP_IMS_HIT into two values.


Disclaimer: I only sanity-checked the modified code. I did not validate
whether the changes actually fix the bugs you referred to. I trust they
do and do not plan to review this further.


Thank you,

Alex.

</PRE>







































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007455.html">[squid-dev] Automake bug workaround
</A></li>
	<LI>Next message: <A HREF="007351.html">[squid-dev] Fix If-None-Match processing and related bug 4169
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7350">[ date ]</a>
              <a href="thread.html#7350">[ thread ]</a>
              <a href="subject.html#7350">[ subject ]</a>
              <a href="author.html#7350">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
