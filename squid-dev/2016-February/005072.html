<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Fixed step3 splicing
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Fixed%20step3%20splicing&In-Reply-To=%3C56B378F8.60801%40chtsanti.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="005070.html">
   <LINK REL="Next"  HREF="005080.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Fixed step3 splicing</H1>
    <B>Christos Tsantilas</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Fixed%20step3%20splicing&In-Reply-To=%3C56B378F8.60801%40chtsanti.net%3E"
       TITLE="[squid-dev] [PATCH] Fixed step3 splicing">christos at chtsanti.net
       </A><BR>
    <I>Thu Feb  4 16:14:48 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="005070.html">[squid-dev] TCP passthrough of none-HTTP protocols
</A></li>
        <LI>Next message: <A HREF="005080.html">[squid-dev] [PATCH] Fixed step3 splicing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5072">[ date ]</a>
              <a href="thread.html#5072">[ thread ]</a>
              <a href="subject.html#5072">[ subject ]</a>
              <a href="author.html#5072">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The information about PeekingPeerConnector splicing the connections
was lost in some cases, resulting in two different bugs:

  - With a certificate validator, the PeekingPeerConnector class calls 
back FwdState, which calls the ConnStateData class, which then tries 
secure the connection with the already tunneled SSL client and closes 
the connection on negotiating errors.

  - Without a certificate validator, the PeekingPeerConnector class 
never calls FwdState class, and both PeekingPeerConnector and FwdState 
objects stall until finishing tunnelState closes server and client 
connections.

Now, PeerConnector always calls FwdState back, marking spliced
connections as such. This has the following positive side-effects:

  - When FwdState learns about spliced connections, it does not call 
ConnStateData back. Instead, it terminates and gets destroyed. The 
tunnel continues uninterrupted.

  - The PeekingPeerConnector job ends and is destroyed instead of 
waiting to call FwdState.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: fix-splicing-with-certvalidator-t2.patch
Type: text/x-patch
Size: 13443 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20160204/c5f6e72f/attachment.bin">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20160204/c5f6e72f/attachment.bin</A>&gt;
</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005070.html">[squid-dev] TCP passthrough of none-HTTP protocols
</A></li>
	<LI>Next message: <A HREF="005080.html">[squid-dev] [PATCH] Fixed step3 splicing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5072">[ date ]</a>
              <a href="thread.html#5072">[ thread ]</a>
              <a href="subject.html#5072">[ subject ]</a>
              <a href="author.html#5072">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
