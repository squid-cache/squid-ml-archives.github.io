<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Patches proposal
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Patches%20proposal&In-Reply-To=%3C56C5BD80.3050502%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="005157.html">
   <LINK REL="Next"  HREF="005163.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Patches proposal</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Patches%20proposal&In-Reply-To=%3C56C5BD80.3050502%40ngtech.co.il%3E"
       TITLE="[squid-dev] Patches proposal">eliezer at ngtech.co.il
       </A><BR>
    <I>Thu Feb 18 12:48:00 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="005157.html">[squid-dev] Patches proposal
</A></li>
        <LI>Next message: <A HREF="005163.html">[squid-dev] Patches proposal
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5159">[ date ]</a>
              <a href="thread.html#5159">[ thread ]</a>
              <a href="subject.html#5159">[ subject ]</a>
              <a href="author.html#5159">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I want to add couple cycles of mine to the subject.

On 18/02/2016 01:11, Alex Rousskov wrote:
&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> &gt;&gt;&gt;The OpenSSL local filesystem one is now called &quot;security_file_certgen&quot;.
</I>&gt;&gt;&gt;&gt;<i> &gt;&gt;&gt;A Redis DB helper would be &quot;security_redis_certgen&quot;.
</I>&gt;&gt;&gt;<i> &gt;&gt;Why create a whole new binary?
</I>&gt;<i>
</I>&gt;&gt;<i> &gt;Because the &quot;file&quot; in its name means the data is stored to the local
</I>&gt;&gt;<i> &gt;filesystem in some &quot;flat-file&quot; DB format. My understanding is that redis
</I>&gt;&gt;<i> &gt;uses its own binary DB format.
</I>&gt;<i> The current helper name does not answer the question: If the current
</I>&gt;<i> helper was badly renamed to wrongly limit its scope, then we should
</I>&gt;<i> surely rename it again to avoid that limitation.
</I>
+1

&gt;&gt;<i> &gt;The redis version requires a whole new library linkage, its header files
</I>&gt;&gt;<i> &gt;and code for its API use.
</I>&gt;<i> Yes, but why is that important here? Many Squid features require &quot;whole
</I>&gt;<i> library linkage and header files&quot;. Those dependencies do not result in
</I>&gt;<i> ten Squid binary names as far as we are concerned.
</I>
+1 but.. adding something.
Portability for some systems might be an issue. We can distinguish full 
fledged servers from some embedded systems(routers, switches etc..)

&gt;&gt;<i> &gt;As a result the two binaries will act very
</I>&gt;&gt;<i> &gt;differently when passed the same data.
</I>&gt;<i> They will act exactly the same from the caller point of view. The
</I>&gt;<i> database is one of the many internal optimizations.
</I>
OK so we are talking about &quot;functionality&quot; in general.
However I do see one specific issue with a DISK and Redis DB.
If for any reason the site headers will contain HSTS rules and the Redis 
DB(mem only..) will be restarted then the certificate would be different 
and the client will probably(to my understating) get some nice error 
page from the browser.
So it's exactly the same as long the Redis DB is persistent and\or was 
not restarted recently.

&gt;&gt;<i> &gt;With a lot of policy and security implications around those differences.
</I>&gt;<i> Same with configuring Squid to use different cache_dirs, but we do not
</I>&gt;<i> create many Squid executables because of the many cache_dir types.
</I>..
&gt;&gt;<i> &gt;A generic distro builder who builds two helpers leaves the
</I>&gt;&gt;<i> &gt;installers with the option to actually install only one binary if the
</I>&gt;&gt;<i> &gt;other does not meet local policy/security requirements.
</I>&gt;<i> That sounds like a valid argument, although you seem to be invalidating
</I>&gt;<i> it below. Not sure our cycles are best spent accommodating such cases,
</I>&gt;<i> but you know better.
</I>
I am sorry but if for example RedHat or any other distribution will have 
some issue
with one helper having the option to use more then one back-end they are 
in more troubles then builder\maintainer.
And what I mean is that this is not the first binary to do so.

&gt;&gt;<i> &gt;In the generic builders this is best supported by providing different
</I>&gt;&gt;<i> &gt;packages with different binaries inside.
</I>&gt;<i> Which means the &quot;generic builder&quot; is no longer &quot;generic&quot;. It is a person
</I>&gt;<i> that understands the difference between various Squid pieces. Such a
</I>&gt;<i> person can create multiple binaries using ./configure options and/or VMs.
</I>
Which should be the default for any builder. A generic builder can never 
decide what to do with any more then minimal complexity packages(ie one 
or couple binaries).

&gt;&gt;<i> &gt;Which gets very annoying and/or
</I>&gt;&gt;<i> &gt;tricky if the difference is ./configure parameters
</I>&gt;&gt;<i> &gt;(--with/--without-hiredis) to produce different binaries.
</I>&gt;<i> You may be right, but it is not obvious to me why different ./configure
</I>&gt;<i> options is such a big deal to a person who already understands the
</I>&gt;<i> difference between two certificate generation helpers that Squid builds
</I>&gt;<i> by default and who have installed enough libraries for both helpers to
</I>&gt;<i> be built by default.
</I>
I think that the point would be choosing the defaults rather then the 
additions. For some builders adding &quot;hiredis&quot; support by default means 
they need to kind of &quot;audit&quot; or &quot;validate&quot; another whole side to the 
package. It might not only be just adding &quot;hiredis&quot; to the build but 
also testing couple other things.

I am not in the point to decide what to implement and what to do but 
&quot;--without-hiredis&quot; is fine for my RPMs(not saying William should 
implement it) . It will allow me to take in account that in the future I 
will want to add this dependency to the main package or to even package 
the specific binary by it's own to not affect the core package 
dependencies and giving the system admin the option to choose the 
packages installation policy.

Eliezer
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005157.html">[squid-dev] Patches proposal
</A></li>
	<LI>Next message: <A HREF="005163.html">[squid-dev] Patches proposal
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5159">[ date ]</a>
              <a href="thread.html#5159">[ thread ]</a>
              <a href="subject.html#5159">[ subject ]</a>
              <a href="author.html#5159">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
