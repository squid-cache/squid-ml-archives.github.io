<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [RFC] --&gt; Redirect attack
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20--%3E%20Redirect%20attack&In-Reply-To=%3C56C70D3F.5000406%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="005162.html">
   <LINK REL="Next"  HREF="005169.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [RFC] --&gt; Redirect attack</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20--%3E%20Redirect%20attack&In-Reply-To=%3C56C70D3F.5000406%40ngtech.co.il%3E"
       TITLE="[squid-dev] [RFC] --&gt; Redirect attack">eliezer at ngtech.co.il
       </A><BR>
    <I>Fri Feb 19 12:40:31 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="005162.html">[squid-dev] [RFC] How would you call this &quot;authentication&quot; way?(a bit long)
</A></li>
        <LI>Next message: <A HREF="005169.html">[squid-dev] Trunk profusely leaks memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5165">[ date ]</a>
              <a href="thread.html#5165">[ thread ]</a>
              <a href="subject.html#5165">[ subject ]</a>
              <a href="author.html#5165">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for the detailed response!

 From what I understand until now it seems to me that the main reason 
that nobody created a &quot;standard&quot; for MITM proxies authentication is 
since the current HTTP implementations and UA are somehow aware of the 
option to the wildness of the networks and the Internet world.


While reviewing OAuth and SSO technologies I noticed that it is very 
&quot;simple&quot; to attack them using some kind of MITM and I was kind of amazed 
by what issues might arise if the UA in some way contacts some public 
Internet system.
It gets even more complicated with NAT and until now the solutions for 
SSO and OAuth are to somehow use an Internal Authentication and 
Authorization system in the UA\Session level.

Maybe I missed something but I am unsure. Authorization and 
Authentication can work in a way together or in separated ways(leaving 
squid and other acls aside).
What Authorization helpers I have missed?
The ones I know about that a transparent(MITM) proxy can use are:
- Radius(IP)
- Time_quota(IP)
- session(IP)

These are good for specific usages and will probably not be good enough 
for full authentication and authorization for VNC\RDP\NAT environments.

I do not argue with the risks that do exists and organizations do 
consider them over and over again. Some use VPN connections to somehow 
evade every HTTP\HTTPS MITM proxies in the wild but many do not require 
that and I really do not know how they make sure that the connections 
are secure else then TLS\SSL.

One of the really hard things I have seen lately in the security 
industry was Anti Viruses that are doing machine local HTTPS MITM. And 
the harder thing was that these programs implement some kind of &quot;sensor&quot; 
net which sends data to their main systems. The most weird thing I have 
seen is that most of them didn't even used HTTPS connections to these 
&quot;sensor&quot; networks main API system.

There is a whole other aspect about CDN security, many offer free domain 
level SSL.

The dilemma that stands is:
If these Security firms use plain HTTP for so many delicate things, why 
should I trust them or why do I use HTTPS?

As a result to this dilemma and the thread opening subject I was 
starting to think about writing a wiki article. In some relation to 
squid without providing any code, would it be right to describe in some 
technical details this kind of attack?
The pros:
- It will give another aspect when looking at the attack.
- It will make the awareness to the subjects a bit better.
- The time on the research about the subject was already invested.

The cons:
- Many wrote about the subject in the past.
- It's not a caching subject but rather a security one.

What do you and maybe others think about security related articles in 
the wiki?

Eliezer

On 18/02/2016 19:19, Amos Jeffries wrote:
&gt;<i> On 19/02/2016 5:28 a.m., Eliezer Croitoru wrote:
</I>&gt;&gt;<i> After playing with couple SSO ideas in general I noticed that something
</I>&gt;&gt;<i> similar can be done with squid while it will not be as secured as
</I>&gt;&gt;<i> kerberos and couple other nice implementation.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Deatils:
</I>&gt;&gt;<i> A transparent proxy cannot authenticate users in the session level. The
</I>&gt;&gt;<i> current known available options are using some session db(by IP) or
</I>&gt;&gt;<i> Radius or LDAP(by ip) and couple others.
</I>&gt;&gt;<i> So for couple specific environments which uses either NAT or multiple
</I>&gt;&gt;<i> VNC\RDP sessions there is no option to authenticate a specific user but
</I>&gt;&gt;<i> a whole IP\machine.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The real solution would be to somehow make it possible for a browser to
</I>&gt;&gt;<i> know about the option of a &quot;transparent proxy&quot; and to also trust it.
</I>&gt;&gt;<i> Also this specific network must be secured enough so no rough dhcp
</I>&gt;&gt;<i> services will pop up and couple other network level restrictions will be
</I>&gt;&gt;<i> applied to ensure that the browser can authenticate to the proxy in the
</I>&gt;&gt;<i> case he will be there.(There might be some other attacks which I didn't
</I>&gt;&gt;<i> mentioned)
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &quot;transparent proxy&quot; is a badly overloaded phrase.
</I>&gt;<i>   * Taken literally it means the same as &quot;forward-proxy&quot; in HTTP terminology.
</I>&gt;<i>   * Taken as a colloquial way of saying &quot;interception proxy&quot;, aka. MITM.
</I>&gt;<i> It is by definition not possible to have trust since the identity of the
</I>&gt;<i> proxy is unverifiable.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> Another approach to the issue:
</I>&gt;&gt;<i> Currently browsers use cookies to authenticate banks, police, health and
</I>&gt;&gt;<i> many other systems. They are not highly secured but they are being used
</I>&gt;&gt;<i> in many places.
</I>&gt;<i>
</I>&gt;<i> Let me stop you right there.
</I>&gt;<i>
</I>&gt;<i> In order to set a Cookie that is in any way equivalent to the
</I>&gt;<i> authentication/authorization sessions. The proxy has to first be able to
</I>&gt;<i> determine whether any two random connections came from the same client UA.
</I>&gt;<i>    If it is capable of doing that already then that is how the
</I>&gt;<i> authorization session helper should be operating. No need for Cookie to
</I>&gt;<i> be involved.
</I>&gt;<i>
</I>&gt;<i> The ability to set Cookies for generic UA-&gt;interceptor authorization is
</I>&gt;<i> an *outcome* of having a session. Not the reverse.
</I>&gt;<i>
</I>&gt;<i> They could be used for the much more limited scope of tying two UA
</I>&gt;<i> connections for the same domain into a session. But ...
</I>&gt;<i>
</I>&gt;<i> A secondary effect of using Cookie is that the Cookie data is then
</I>&gt;<i> delivered by the UA to the origin it thinks that Cookie belongs to.
</I>&gt;<i> Including down channels the proxy is not intercepting. This wastes a lot
</I>&gt;<i> of bandwidth, reveals not just the proxy existence but its session
</I>&gt;<i> credentials as well into the WAN.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> There is still the ultimate question of trust needing to verify the
</I>&gt;<i> proxies identity. To ensure that the unseen proxy setting the Cookie is
</I>&gt;<i> the one its going to be delivered to later.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Maybe we can use them for something?
</I>&gt;&gt;<i> Since the first days of cookies security restrictions was applied on
</I>&gt;&gt;<i> them to disable phishing, impersonation etc.
</I>&gt;&gt;<i> Many vendors &quot;secure&quot; the cookies based on user-agent string,
</I>&gt;&gt;<i> timestamps, origin ip and many others. These in very specific cases can
</I>&gt;&gt;<i> make it somehow harder on the cookie finder to use them but it still
</I>&gt;&gt;<i> might not be enough for many systems.
</I>&gt;<i>
</I>&gt;<i> What you go on to describe is a Redirect attack. Its particularly a
</I>&gt;<i> favorite when attacking websites using OAuth.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-dev mailing list
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">http://lists.squid-cache.org/listinfo/squid-dev</A>
</I>&gt;<i>
</I>
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005162.html">[squid-dev] [RFC] How would you call this &quot;authentication&quot; way?(a bit long)
</A></li>
	<LI>Next message: <A HREF="005169.html">[squid-dev] Trunk profusely leaks memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5165">[ date ]</a>
              <a href="thread.html#5165">[ thread ]</a>
              <a href="subject.html#5165">[ subject ]</a>
              <a href="author.html#5165">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
