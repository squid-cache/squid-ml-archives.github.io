<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] implement RFC3986
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20implement%20RFC3986&In-Reply-To=%3C56C9DCF8.8010103%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="005173.html">
   <LINK REL="Next"  HREF="005183.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] implement RFC3986</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20implement%20RFC3986&In-Reply-To=%3C56C9DCF8.8010103%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] implement RFC3986">rousskov at measurement-factory.com
       </A><BR>
    <I>Sun Feb 21 15:51:20 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="005173.html">[squid-dev] [PATCH] implement RFC3986
</A></li>
        <LI>Next message: <A HREF="005183.html">[squid-dev] [PATCH] implement RFC3986
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5178">[ date ]</a>
              <a href="thread.html#5178">[ thread ]</a>
              <a href="subject.html#5178">[ subject ]</a>
              <a href="author.html#5178">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 02/20/2016 11:27 AM, Kinkie wrote:

&gt;<i> Sorry to bring this topic up again, but honestly I don't understand
</I>&gt;<i> your position.
</I>&gt;<i> 
</I>&gt;<i> I believe that the deadlock we currently are in
</I>
There is no deadlock. I think the design decision to use templated
escape functions to accomodate std::string-using helpers was wrong, but
I am not bold enough to stop you from committing it. Much worse code
goes in despite my objections or without proper audit.


&gt;<i> is caused by the fact
</I>&gt;<i> that we are discussing about two topics at the same time.
</I>&gt;<i> One is: should Rfc3986 target both SBuf and std::string, if the
</I>&gt;<i> performance and complexity penalty in doing so is none or small? I
</I>&gt;<i> (and I believe Amos) think it's a good, or at least not a bad idea.
</I>
Any &quot;Should I do X if X is good?&quot; question is pointless. The question is
&quot;Should I do X?&quot;. I have already outlined why I think doing X is harmful.


&gt;<i> The other is: should we use std::string or SBuf or c-strings in
</I>&gt;<i> helpers? My opinion is that std::string would be preferable, yours is
</I>&gt;<i> that SBuf is preferable, if any change is performed over the current
</I>&gt;<i> state of using c-strings. I think change over current state is a good
</I>&gt;<i> idea, you - I believe - are averse enough to using std::string that
</I>&gt;<i> would prefer no change.
</I>
I think helpers should use whatever works best for them, given the
available Squid APIs and other factors. The question is not about what
helpers should use but whether Squid code should bend over backwards
(e.g., providing a templated function to escape strings and adjust SBuf
to work with that function) to accommodate a helper. The answer, IMO, is
&quot;no&quot;. It is much better to

* provide SBuf to helpers that want top performance

and

* provide a trivial std::string-escaping function (that uses
SBuf-escaping function internally) to helpers that want to use C-strings
or std::strings.


&gt;<i> Can we try to decouple the two discussions and see if this helps us
</I>&gt;<i> reach a consensus?
</I>&gt;<i> 
</I>&gt;<i> My point of view is:
</I>&gt;<i> - having a more generic API costs us nothing - the code is compact,
</I>&gt;<i> readable and efficient regardless the genericity, so we should merge
</I>&gt;<i> Rfc3986.
</I>
A single template costs virtually nothing. I speculate that the design
decision to treat std::string-using helpers as the primary driving
factor for Squid APIs will cost a lot long-term.

This is very similar to assert(string_size &lt; 64K). The cost of that
single line was nothing when it was written. However, the cost of the
design decision that Strings can self-limit their size is a growing
collection of CVEs. IMO, you are opening a Pandora box. The cost of
lifting the lid is indeed negligible, but that cost is not what I am
worried about.


&gt;<i> - there is no performance or readability benefit in using SBuf in
</I>&gt;<i> helpers due to the way client code is structured.
</I>
I agree regarding readability. SBuf is about the same or a little worse
than std::string.

If you are right about performance and safety across all helpers, then
there is no benefit in using SBuf in Squid.


&gt;<i> Also, we would need
</I>&gt;<i> to stub a lot of functionality it relies on (e.g. mempools,
</I>&gt;<i> statistics, cachemgr). 
</I>
I am not sure that is true, but even if it is true, it should not be
important for this discussion. The vast majority of such refactoring,
would benefit Squid. For example, if our SBuf code depends on cache
manager, then we made a mistake that should be fixed.

Alex.

</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005173.html">[squid-dev] [PATCH] implement RFC3986
</A></li>
	<LI>Next message: <A HREF="005183.html">[squid-dev] [PATCH] implement RFC3986
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5178">[ date ]</a>
              <a href="thread.html#5178">[ thread ]</a>
              <a href="subject.html#5178">[ subject ]</a>
              <a href="author.html#5178">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
