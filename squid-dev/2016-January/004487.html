<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] connections_encrypted ACL
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20connections_encrypted%20ACL&In-Reply-To=%3C29154486c969a427f263ca03e0cf4710%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="004491.html">
   <LINK REL="Next"  HREF="004510.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] connections_encrypted ACL</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20connections_encrypted%20ACL&In-Reply-To=%3C29154486c969a427f263ca03e0cf4710%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] connections_encrypted ACL">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Jan  2 03:23:46 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="004491.html">[squid-dev] [PATCH] SBuf API improvements
</A></li>
        <LI>Next message: <A HREF="004510.html">[squid-dev] [PATCH] connections_encrypted ACL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4487">[ date ]</a>
              <a href="thread.html#4487">[ thread ]</a>
              <a href="subject.html#4487">[ subject ]</a>
              <a href="author.html#4487">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2015-12-30 23:23, Christos Tsantilas wrote:
&gt;<i> This patch initialy discussed in squid-dev under the thread &quot;[PATCH]
</I>&gt;<i> received_encrypted ACL&quot; some months ago:
</I>&gt;<i>   
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/pipermail/squid-dev/2015-July/002680.html">http://lists.squid-cache.org/pipermail/squid-dev/2015-July/002680.html</A>
</I>&gt;<i> 
</I>&gt;<i> The &quot;received_encrypted&quot; was the original name of a new ACL which in
</I>&gt;<i> this patch (t7) renamed to connections_encrypted
</I>&gt;<i> 
</I>&gt;<i> I am reposting here as new patch.
</I>&gt;<i> 
</I>&gt;<i> (New) Patch description:
</I>&gt;<i> 
</I>&gt;<i> The new connections_encrypted ACL matches transactions where all HTTP
</I>&gt;<i> messages were received over TLS transport connections, including
</I>&gt;<i> messages received from ICAP servers.
</I>&gt;<i> 
</I>&gt;<i> Some ICAP/eCAP services receive data from unencrypted sources. Some
</I>&gt;<i> ICAP/eCAP services are &quot;secure&quot;. By default we assume that all eCAP
</I>&gt;<i> services and all ICAP services on TLS transport connections  are
</I>&gt;<i> &quot;secure&quot; unless the user uses the &quot;connection_encryption&quot; option in
</I>&gt;<i> service configuration line.
</I>&gt;<i> 
</I>&gt;<i> This is a Measurement Factory project.
</I>

in src/acl/ConnectionsEncrypted.h:

* the #ifndef wrapper string s/ENTRYPTED/ENCRYPTED/

* please use a space between &quot;operator=&quot;

* please add empty line between end of namespace and file wrapper #endif


in src/adaptation/ServiceConfig.h:

* something seems wrong about the use of connectionsEncryptedSet member.
  - it is using twice as much memory to configure a boolean option than 
it should be able to.


The options are documented as being configured *after* the service URI. 
So it seems to me that the service URI should set the flag default based 
on the icap/icaps (or ecap/ecaps) nature. Then the user option set/unset 
it later if they want to override. No need for a separate &quot;user set it&quot; 
member, or for special casing of ICAP/eCAP non-S.

On the dumpCfg() side the service URI type could be checked to see if it 
the value needs to be dumped out or not. The user setting it to the 
default is a no-op.

in src/cf.data.pre:

* the documentation implies that connection_encrypted=on turns the taint 
check *OFF* for ICAPS connections. But does not un-taint ICAP 
connections. The code does not seem to match.

Amos

</PRE>





























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004491.html">[squid-dev] [PATCH] SBuf API improvements
</A></li>
	<LI>Next message: <A HREF="004510.html">[squid-dev] [PATCH] connections_encrypted ACL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4487">[ date ]</a>
              <a href="thread.html#4487">[ thread ]</a>
              <a href="subject.html#4487">[ subject ]</a>
              <a href="author.html#4487">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
