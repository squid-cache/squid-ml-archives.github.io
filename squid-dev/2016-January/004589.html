<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Squid 3.5.11 ntlm helper crashes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Squid%203.5.11%20ntlm%20helper%20crashes&In-Reply-To=%3C568D0340.3050602%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="004588.html">
   <LINK REL="Next"  HREF="004591.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Squid 3.5.11 ntlm helper crashes</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Squid%203.5.11%20ntlm%20helper%20crashes&In-Reply-To=%3C568D0340.3050602%40treenet.co.nz%3E"
       TITLE="[squid-dev] Squid 3.5.11 ntlm helper crashes">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Jan  6 12:06:24 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="004588.html">[squid-dev] Squid 3.5.11 ntlm helper crashes
</A></li>
        <LI>Next message: <A HREF="004591.html">[squid-dev] [RFC\PREVIEW] ICAP service nodown option addition.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4589">[ date ]</a>
              <a href="thread.html#4589">[ thread ]</a>
              <a href="subject.html#4589">[ subject ]</a>
              <a href="author.html#4589">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 6/01/2016 11:49 p.m., manojmaybe wrote:
&gt;<i> I have used squid 3.3.13 is used as proxy server with ntlm authentication.
</I>&gt;<i> For detecting client ip in ntlm messages i have write a patch in squid
</I>&gt;<i> source that pass client ip to ntlm helper messages.
</I>
What do you mean &quot;detecting client IP in NTLM messages&quot; ?

IP address of the client plays no part in NTLM authentication. The
security credentials token is supposed to be generated unique with each
new TCP connection regardless of IP. Squid ties the resulting
credentials to the TCP connection state.

If you are using IP address to speed up NTLM and &quot;bypass&quot; auth system
limits. Then you are only destrying the one last remainign security
protectino NTLM offers by adding replay vulnerability to the already
weak NTLM crypto problems.
&lt;snip&gt;
&gt;<i> 
</I>&gt;<i> This patch is successfully running.
</I>&gt;<i> Currently i upgraded to squid 3.5.11 with ntlm authentication. In 3.5.11
</I>&gt;<i> version an squid directive is used to pass key extras to ntlm helpers such
</I>&gt;<i> as client ip, i used shown below
</I>
There are 2 differences between the patch and the key-extras feature.

1) key-extras places the exatra bits in separate (space delimited)
fields after the credentials token.

2) key-extras does *not* embed the IP into the auth token used to verify
future requests on the same persistent connection.


&gt;<i> 
</I>&gt;<i> auth_param ntlm program /usr/local/helpers/ntlmauthenticator
</I>&gt;<i> auth_param ntlm children 3000 startup=0 idle=0
</I>
idle should not be 0. It is the number of helpers to start when more are
needed.


&gt;<i> auth_param ntlm keep_alive on
</I>&gt;<i> auth_param ntlm key_extras &quot;%&gt;a&quot;
</I>&gt;<i> 
</I>&gt;<i> This configuration directive i used to pass client ip to my ntlm helper, and
</I>&gt;<i> also changes made on ntlm helper program for handling ntlm hand shake
</I>&gt;<i> messages. But after few houres (nearly 3 hour ) running the squid, the ntlm
</I>&gt;<i> helper is crashed or sometimes squid is crashed and restarted when more than
</I>&gt;<i> 1000 request/second is received (as per squid cache manager)
</I>
How?

The helper crashing sounds like your helper code is broken.

If any helper crashes often enough Squid will self-terminate (not
&quot;crash&quot;) to protect itself and any other services operating on the machine.

Amos
</PRE>






























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004588.html">[squid-dev] Squid 3.5.11 ntlm helper crashes
</A></li>
	<LI>Next message: <A HREF="004591.html">[squid-dev] [RFC\PREVIEW] ICAP service nodown option addition.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4589">[ date ]</a>
              <a href="thread.html#4589">[ thread ]</a>
              <a href="subject.html#4589">[ subject ]</a>
              <a href="author.html#4589">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
