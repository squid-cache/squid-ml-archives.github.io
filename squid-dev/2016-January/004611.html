<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] YesNoNone class updates
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20YesNoNone%20class%20updates&In-Reply-To=%3C569525C1.6010700%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="004610.html">
   <LINK REL="Next"  HREF="004672.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] YesNoNone class updates</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20YesNoNone%20class%20updates&In-Reply-To=%3C569525C1.6010700%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] YesNoNone class updates">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Jan 12 16:11:45 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="004610.html">[squid-dev] [PATCH] YesNoNone class updates
</A></li>
        <LI>Next message: <A HREF="004672.html">[squid-dev] [PATCH] YesNoNone class updates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4611">[ date ]</a>
              <a href="thread.html#4611">[ thread ]</a>
              <a href="subject.html#4611">[ subject ]</a>
              <a href="author.html#4611">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 01/11/2016 06:36 PM, Amos Jeffries wrote:
&gt;<i> Update class YesNoNone to use C++11 features which allow better boolean
</I>&gt;<i> conversion, assignment, copy, and move ctors.
</I>
The safer boolean operator is welcomed, of course.


&gt;<i> +    YesNoNone &amp;operator =(bool beSet) {configure(beSet); return *this;}
</I>
This is a bad idea IMO. If we want to distinguish configuration-set
options from code-set options, we should not have implicit conversions
like that. The caller should use the existing configure() method instead.



&gt;<i> +    explicit YesNoNone(const YesNoNone &amp;) = default;
</I>&gt;<i> +    YesNoNone &amp;operator =(const YesNoNone &amp;) = default;
</I>&gt;<i> +
</I>&gt;<i> +    explicit YesNoNone(YesNoNone &amp;&amp;) = default;
</I>&gt;<i> +    YesNoNone &amp;operator =(YesNoNone &amp;&amp;) = default;
</I>&gt;<i> +
</I>&gt;<i> +    ~YesNoNone() = default;
</I>
All the added &quot;= default&quot; methods should be removed as well AFAICT. We
are not violating Big Three or Big Five rules without them, and adding
them misleads the reader into thinking there is something complex about
this class internal data structures and memory usage.


&gt;<i> Distinction is made between implicit and explicit configuration.
</I>
Why do we need this increased complexity? Your patch does not seem to
show any places where this will be used. I am not saying this added
complexity is necessarily wrong, but it is missing the motivation/usage
examples to justify it.

If we do need to distinguish configuration-set from code-set options, a
different implementation is needed IMO: Instead of using three awkward
values for &quot;beSet&quot; and a hard-to-guess-when-to-check boolean &quot;implicit&quot;
member, we should be using a simple boolean &quot;isSet&quot; and a tri-valued
&quot;setHow&quot; member with optUnset, optConfigured, optImplicit values (or
similar).



&gt;<i> +    /// \return true iff enabled; asserts if the option has not been configured
</I>&gt;<i> +    explicit operator bool() const;
</I>&gt;<i> +
</I>&gt;<i> +    /// \return true iff disabled; asserts if the option has not been configured
</I>&gt;<i> +    bool operator !() const;
</I>

The above descriptions became very misleading after your changes. The
[old] code is still correct -- it asserts on unspecified option values.
However, specifying the value no longer requires calling configure()
because you have added &quot;implicit&quot; configuration via constructor.
s/configured/specified/


&gt;<i> +    explicit YesNoNone(bool beSet);
</I>
Please add a description to say that this constructor specifies the
option value implicitly.


&gt;<i> +bool
</I>&gt;<i> +YesNoNone::operator !() const
</I>&gt;<i> +{
</I>&gt;<i> +    assert(option != YesNoNone::optUnspecified);
</I>&gt;<i> +    return option == YesNoNone::optDisabled;
</I>&gt;<i>  }
</I>
Please never reverse the existing operator bool code. Inline the
negation of that operator call instead.


&gt;<i> +YesNoNone::YesNoNone(bool beSet):
</I>&gt;<i> +    implicit(true)
</I>&gt;<i> +{
</I>&gt;<i> +    // do not use configure() so implicit remains unchanged.
</I>&gt;<i> +    option = beSet ? YesNoNone::optEnabled : YesNoNone::optDisabled;
</I>&gt;<i> +}
</I>
Please initialize both members in the initialization list. This
constructor should be inlined IMO.


&gt;<i> +    option = beSet ? YesNoNone::optEnabled : YesNoNone::optDisabled;
</I>
&gt;<i> +    option = beSet ? YesNoNone::optEnabled : YesNoNone::optDisabled;
</I>
&gt;<i> +    assert(option != YesNoNone::optUnspecified);
</I>&gt;<i> +    return option == YesNoNone::optEnabled;
</I>
&gt;<i> +    assert(option != YesNoNone::optUnspecified);
</I>&gt;<i> +    return option == YesNoNone::optDisabled;
</I>
&gt;<i> +    YesNoNone(): option(YesNoNone::optUnspecified), implicit(false) {}
</I>
Here and elsewhere, please avoid the &quot;YesNoNone::&quot; scope prefix inside
the YesNoNone class itself.


HTH,

Alex.

</PRE>













































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004610.html">[squid-dev] [PATCH] YesNoNone class updates
</A></li>
	<LI>Next message: <A HREF="004672.html">[squid-dev] [PATCH] YesNoNone class updates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4611">[ date ]</a>
              <a href="thread.html#4611">[ thread ]</a>
              <a href="subject.html#4611">[ subject ]</a>
              <a href="author.html#4611">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
