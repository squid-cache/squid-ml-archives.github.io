<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [RFC] The situation with helpers/
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20The%20situation%20with%20helpers/&In-Reply-To=%3CCA%2BY8hcOQOLfaXoapvrGgP%2BJ1ZmqnpGmAYgwa3%2B0%3DAzBruEcsnA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="004586.html">
   <LINK REL="Next"  HREF="004663.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [RFC] The situation with helpers/</H1>
    <B>Kinkie</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20The%20situation%20with%20helpers/&In-Reply-To=%3CCA%2BY8hcOQOLfaXoapvrGgP%2BJ1ZmqnpGmAYgwa3%2B0%3DAzBruEcsnA%40mail.gmail.com%3E"
       TITLE="[squid-dev] [RFC] The situation with helpers/">gkinkie at gmail.com
       </A><BR>
    <I>Wed Jan 13 13:12:10 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="004586.html">[squid-dev] [RFC] The situation with helpers/
</A></li>
        <LI>Next message: <A HREF="004663.html">[squid-dev] [RFC] The situation with helpers/
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4651">[ date ]</a>
              <a href="thread.html#4651">[ thread ]</a>
              <a href="subject.html#4651">[ subject ]</a>
              <a href="author.html#4651">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Jan 5, 2016 at 6:01 PM, Alex Rousskov
&lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">rousskov at measurement-factory.com</A>&gt; wrote:
&gt;<i> On 01/04/2016 08:58 PM, Amos Jeffries wrote:
</I>&gt;&gt;<i> The SBuf and CharacterSet patch auditing has brought up the questions of
</I>&gt;&gt;<i> why helpers/ is separate from src/, built first, what cross-dependency
</I>&gt;&gt;<i> there can be, and even why we are bundling C++ helpers to begin with.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So lets clarify it formally once and for all.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Q1: why is helpers/ built before src/ ?
</I>&gt;<i>
</I>&gt;<i> A1: Primarily for historical and paranoia reasons.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> Q2: why is helpers/ separate from src/ ?
</I>&gt;<i>
</I>&gt;<i> A2: Primarily for historical and paranoia reasons.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> should we shuffle them back to src/*/helpers/ directories on a
</I>&gt;&gt;<i> per-component basis ?
</I>&gt;<i>
</I>&gt;<i> Yes w.r.t. src/. There is no known good reason to enact artificial hard
</I>&gt;<i> barriers between parts of Squid code. All Squid code should be in src/.
</I>
Could or could not. For sure it would help with dependency tracking
where needed, and there are cases where it is needed.

&gt;<i> Not sure whether the helpers/ subdirectory is [always] needed but that
</I>&gt;<i> is a separate question.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> * it does somewhat hinder anyone wanting to manually build a single
</I>&gt;&gt;<i> helper. Though I have not heard of anyone doing so in many years.
</I>&gt;<i>
</I>&gt;<i> The move does not preclude anyone from building a helper. The fact that
</I>&gt;<i> a few more things may be built along the way is a minor detail IMO.
</I>&gt;<i> Patches to improve dependency tracking (by migrating away from recursive
</I>&gt;<i> Makefiles??) are welcomed.
</I>
Ugh. see src/Makefile.am for the monster file this would yield.

&gt;&gt;<i> * it does mean we should probably discard the goal of having the helpers
</I>&gt;&gt;<i> be demo code examples for people to base their custom helpers on.
</I>&gt;<i>
</I>&gt;<i> The location of the helper code is pretty much irrelevant for the above
</I>&gt;<i> goal. However, if we want to provide demo helpers that are easy to
</I>&gt;<i> understand and customize, then we probably should not use C++ to write
</I>&gt;<i> those demo helpers.
</I>
I don't agree. We should use whatever tool makes sense, depending on
the availability of libraries, complexity, volunteer time etc.

&gt;<i> * If we want to provide the smallest set of default helpers for the
</I>&gt;<i> widest possible set of deployment environments, then internal
</I>&gt;<i> dependencies are preferred to the external ones and, hence, C++ is the
</I>&gt;<i> best language choice.
</I>&gt;<i>
</I>&gt;<i> * If we want to provide default production-quality helpers for the most
</I>&gt;<i> demanding deployment environments, then internal dependencies are
</I>&gt;<i> irrelevant, and C++ is the best language choice. Please note that I do
</I>&gt;<i> not know whether it is wise to declare performance the primary goal,
</I>&gt;<i> given the performance deficiencies of the helper interface itself and
</I>&gt;<i> the current Squid Project resources.
</I>&gt;<i> Any open source helper can be examined, customized, and cloned, of
</I>&gt;<i> course. Our decision with regard to programming language and
</I>&gt;<i> dependencies may make it easier or more difficult, but not impossible.
</I>&gt;<i> It is a question of the primary optimization target: ease of
</I>&gt;<i> understanding/customizability versus supported platforms versus performance.
</I>
I believe our goals should be, in descending order of importance:
1- cover a reasonable set of needs
2- provide a gallery of examples for administrators who have special
needs not covered by the provided set of helpers. Corollaries of this
objective are:
2a- bundled helpers should aim at being as readable as possible.
Whether this qualifies as &quot;high quality&quot; is up for debate :)
2b- bundled helpers should try to avoid relying on Squid internal code
within reason. We can expect administrators embarking in the task to
be competent programmers, asking them to be also competent Squid
coders is maybe too much to ask.
3- performance is nice to have


About build dependencies from src/ : while refactoring some helpers I
came across a recipe which seems reasonably clean and maintainable,
and I submit it for consideration until a more structured approach
(such as lifting helpers/ into src/) can be chosen:

In each helper's Makefile.am, the following clauses must be added:

IMPORTED_FILES = &lt;list of files including paths relative to src/ to be
imported into the helper's directory from src&gt;
nodist_&lt;target&gt;_SOURCES = $(IMPORTED_FILES)
&lt;target&gt;_DEPENDENCIES = $(IMPORTED_FILES)
CLEANFILES += $(IMPORTED_FILES)

$(IMPORTED_FILES): $(top_srcdir)/src/$@
        test -d $(dir $@)|| mkdir -p $(dir $@)
        cp $(top_srcdir)/src/$@ $@

&lt;target&gt; must be replaced with the executable's name. The need for
this replacement unfortunately means that this recipe must be copied
to each helper, and can't be factored out.
This has been tested on the full build farm and satisfies our
portability requirements.

-- 
    Francesco
</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004586.html">[squid-dev] [RFC] The situation with helpers/
</A></li>
	<LI>Next message: <A HREF="004663.html">[squid-dev] [RFC] The situation with helpers/
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4651">[ date ]</a>
              <a href="thread.html#4651">[ thread ]</a>
              <a href="subject.html#4651">[ subject ]</a>
              <a href="author.html#4651">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
