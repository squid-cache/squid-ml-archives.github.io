<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] ftruncate() failures on OS X (Darwin)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20ftruncate%28%29%20failures%20on%20OS%20X%20%28Darwin%29&In-Reply-To=%3CCANEuBv5-i%2BWnNcdkZgb6vSTuYVEem9dPQMDBtfD%3D4QOAhJunZA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="004837.html">
   <LINK REL="Next"  HREF="004843.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] ftruncate() failures on OS X (Darwin)</H1>
    <B>Markus Mayer</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20ftruncate%28%29%20failures%20on%20OS%20X%20%28Darwin%29&In-Reply-To=%3CCANEuBv5-i%2BWnNcdkZgb6vSTuYVEem9dPQMDBtfD%3D4QOAhJunZA%40mail.gmail.com%3E"
       TITLE="[squid-dev] ftruncate() failures on OS X (Darwin)">code at mmayer.net
       </A><BR>
    <I>Fri Jan 22 03:03:30 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="004837.html">[squid-dev] ftruncate() failures on OS X (Darwin)
</A></li>
        <LI>Next message: <A HREF="004843.html">[squid-dev] ftruncate() failures on OS X (Darwin)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4838">[ date ]</a>
              <a href="thread.html#4838">[ thread ]</a>
              <a href="subject.html#4838">[ subject ]</a>
              <a href="author.html#4838">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Alright. Here is the patch as git patch. Hope that works.

I left out the &quot;flags&quot; variable from the shm_open() call that you showed,
since I didn't see it being used or declared anywhere.

The commit message is lengthy, but I tried to explain what's going on, so
others don't have to go digging for the same problem in the future.

I did test it, and it works &quot;as advertised&quot;. I noticed that the 4.0 code
base of Squid does a much better job of cleaning up after itself than 3.5
did. With 3.5, I could trigger the problem by starting Squid in the
foreground (&quot;squid -N&quot;) and then hitting Ctrl-C twice (the second time
would interrupt the cleanup process). With the 4.0 code base, I had to use
&quot;kill -9&quot; to get it to leave the shared memory segments behind. My other
attempts at triggering the problem failed, because it continued to clean up
properly, despite being sent multiple signals.

The improved cleanup is good news. It means the EEXIST condition won't be
hit nearly as much as it would otherwise.

Regards,
-Markus
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20160121/d69f596b/attachment.html">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20160121/d69f596b/attachment.html</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0001-Fix-Ipc-Mem-Segment-create-for-OS-X.patch
Type: application/octet-stream
Size: 4340 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20160121/d69f596b/attachment.obj">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20160121/d69f596b/attachment.obj</A>&gt;
</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004837.html">[squid-dev] ftruncate() failures on OS X (Darwin)
</A></li>
	<LI>Next message: <A HREF="004843.html">[squid-dev] ftruncate() failures on OS X (Darwin)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4838">[ date ]</a>
              <a href="thread.html#4838">[ thread ]</a>
              <a href="subject.html#4838">[ subject ]</a>
              <a href="author.html#4838">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
