<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Http::StreamContext refactoring
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Http%3A%3AStreamContext%20refactoring&In-Reply-To=%3C56A27C2F.2040907%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="004839.html">
   <LINK REL="Next"  HREF="004842.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Http::StreamContext refactoring</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Http%3A%3AStreamContext%20refactoring&In-Reply-To=%3C56A27C2F.2040907%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] Http::StreamContext refactoring">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Jan 22 18:59:59 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="004839.html">[squid-dev] [PATCH] Http::StreamContext refactoring
</A></li>
        <LI>Next message: <A HREF="004842.html">[squid-dev] [PATCH] Http::StreamContext refactoring
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4840">[ date ]</a>
              <a href="thread.html#4840">[ thread ]</a>
              <a href="subject.html#4840">[ subject ]</a>
              <a href="author.html#4840">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 01/14/2016 05:53 AM, Amos Jeffries wrote:

&gt;<i> The ClientSocketContext is renamed and shuffled to Http::StreamContext.
</I>
This class does not belong to the Http namespace. It represents the user
side of a master transaction. While Squid historically uses classes
named after HTTP to represent various master transaction aspects (e.g.,
HttpRequest and HttpReply), we should not fall into this trap when
naming new classes or renaming the old ones. As you know, the user side
of a master transaction may correspond to any of these (at least):

  * An HTTP stream (user coming from an http_port or alike).
  * An FTP stream (user coming from an ftp_port).
  * An internal stream (various Squid-originated downloads).

The &quot;Context&quot; suffix adds nothing to the meaning of the new name. It is
essentially noise, like most &quot;State&quot;, &quot;Data&quot;, and &quot;Object&quot; suffixes. I
suggest dropping it.

Since there are many Squid things that can be considered &quot;streams&quot;, we
do need some distinguishing qualifier for the new name. As you know, we
are avoiding old &quot;client/server side&quot; terminology so ClientStream would
not work. If this thing is going to be specific to user traffic, we
could call it UserStream. If you think it will be eventually used for
peer/origin transactions as well, then a different qualifier is needed.


The renaming/moving part of the patch scope changes lots of code. It is
very unfortunate that you have decided to combine the above
functionality-preserving polishing with the functionality changes below.
The former makes it very difficult to see the latter. If I had enough
guts, I would -1 this patch for this reason alone. Renaming/moving
changes should have been done separately!


&gt;<i> Pipeline class is updated to use the ID number to manage its contents
</I>&gt;<i> rather than Pointer value matching. It is also updated to drop the
</I>&gt;<i> HTTP/1 specific assumptions within the Pipeline implementation. As a
</I>&gt;<i> behavioural requirement the sequential flow is now left for the Server
</I>&gt;<i> and ClientHttpRequest Jobs to ensure correctness.
</I>

The new Pipeline::popById() method is a bad idea IMO: Linear search is
wrong for both HTTP/1 and HTTP/2.


&gt;<i> The old &quot;client-side&quot; classes are now split along the following scopes:
</I>

&gt;<i> * ::Server / ConnStateData/ *::Server
</I>&gt;<i>  - the AsynJob managing I/O on a client connection.
</I>&gt;<i> 
</I>&gt;<i> * ClientHttpRequest
</I>&gt;<i>  - the AsyncJob operating transaction internal behaviours and Calls.
</I>&gt;<i> Will make use of ConnStateData and Http::StreamContext to perform its
</I>&gt;<i> duties (has not yet been refactored to do so cleanly yet).
</I>&gt;<i> 
</I>&gt;<i> * Http::StreamContext
</I>&gt;<i>  - the state data for a transaction. Refcounted and used by the Server
</I>&gt;<i> and ClientHttpRequest Jobs for their mutual data storage.
</I>

As I said earlier, I will have to come back to this part later, but
perhaps you can already clarify whether this patch has actually changed
any of the above (besides renaming)?


Thank you,

Alex.

</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004839.html">[squid-dev] [PATCH] Http::StreamContext refactoring
</A></li>
	<LI>Next message: <A HREF="004842.html">[squid-dev] [PATCH] Http::StreamContext refactoring
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4840">[ date ]</a>
              <a href="thread.html#4840">[ thread ]</a>
              <a href="subject.html#4840">[ subject ]</a>
              <a href="author.html#4840">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
