<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [RFC] V6 connectivity testing and dns_v4_first auto setter bash script.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20V6%20connectivity%20testing%20and%20dns_v4_first%20auto%0A%20setter%20bash%20script.&In-Reply-To=%3C56AB1BF8.5070509%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="004876.html">
   <LINK REL="Next"  HREF="004880.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [RFC] V6 connectivity testing and dns_v4_first auto setter bash script.</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20V6%20connectivity%20testing%20and%20dns_v4_first%20auto%0A%20setter%20bash%20script.&In-Reply-To=%3C56AB1BF8.5070509%40treenet.co.nz%3E"
       TITLE="[squid-dev] [RFC] V6 connectivity testing and dns_v4_first auto setter bash script.">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Jan 29 07:59:52 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="004876.html">[squid-dev] [RFC] V6 connectivity testing and dns_v4_first auto setter bash script.
</A></li>
        <LI>Next message: <A HREF="004880.html">[squid-dev] Build failed in Jenkins: trunk-matrix » clang,d-centos-7 #522
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4877">[ date ]</a>
              <a href="thread.html#4877">[ thread ]</a>
              <a href="subject.html#4877">[ subject ]</a>
              <a href="author.html#4877">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 29/01/2016 6:54 p.m., Eliezer Croitoru wrote:
&gt;<i> I wrote a tiny bash script that I will later push into the CentOS RPMs
</I>&gt;<i> and was wondering about pushing it into the squid sources.
</I>&gt;<i> The source at: <A HREF="http://paste.ngtech.co.il/pxizenek2">http://paste.ngtech.co.il/pxizenek2</A>
</I>&gt;<i> 
</I>&gt;<i> It was written for linux but can be modified for FreeBSD and other *NIX
</I>&gt;<i> OS's.
</I>&gt;<i> Checks for IPV6 resolution and connectivity(ping6) and changes
</I>&gt;<i> squid.conf dns_v4_first to or or off.
</I>&gt;<i> My idea was to run it every time before squid starts\restarts.
</I>&gt;<i> 
</I>&gt;<i> What do you think about the idea of testing ipv6 connectivity in general
</I>&gt;<i> before starting squid and about automatically change squid.conf?
</I>
Couple of things:

1) Quite a few of the customer base have issues with software performing
remote connections and sending/receiving data by default. We had quite a
push back against simply adding the <A HREF="http://www.squid-cache.org/*/SN.png">http://www.squid-cache.org/*/SN.png</A>
icon URL to the errorpage.css (to the point of security vulnerability
queries against some distro packages).

2) Squid should do this type of testing in the Ip::ProbeTransport() run
on each startup. So far we just check the socket fuctionality is
working. Remote connectivity checks should be controlled by a new config
directive that defaults to the current limited (non-remote) test set -
but allows admin who want to turn remote tests on if they wish.

3) The issue with IPv6 is not whether its enabled/disabled. A properly
configued IPv4-only network will skip past the IPv6 server connect
attempts in a few nanoseconds.
 The problem is when the network is IPv6-enabled and an upstream
external along the path between Squid and the destination server has
broken/disabled ICMP support or bad tunnel configuration. That issue
shows up as MTU discovery issues, lost IPv6 packets, hanging / timeouts,
etc.
 There is no way we can test that for every upstream server in advance
of Squid startup. If we test it at all it has to be tested on a
per-request basis. Which is exactly the purpose of the pinger helper.

But simply detecting this requires the timeout or whatever to happen in
advance of the request sending (and may only happen on the reply, not
the request). So does not help at all with speeding up anything.


The only solution that really works is to get every network on the
Internet to re-enable ICMP(v6) so it works properly. And tunnel
operators to ensure their path-MTU discovery works as well. We are a
long way towards tunnel operators cleaning up their act though a few
stil remain. ICMP issues are till quite common.


PS. Also, note that the ICMP issues affect IPv4 traffic just as much as
IPv6. Its just that people seems to loudly blame IPv6 when it happens
there and quietly fix IPv4 when that happens, or worse blame IPv6 loudly
then quietly fix IPv4 when it was really IPv4 all along.

Amos

</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004876.html">[squid-dev] [RFC] V6 connectivity testing and dns_v4_first auto setter bash script.
</A></li>
	<LI>Next message: <A HREF="004880.html">[squid-dev] Build failed in Jenkins: trunk-matrix » clang,d-centos-7 #522
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4877">[ date ]</a>
              <a href="thread.html#4877">[ thread ]</a>
              <a href="subject.html#4877">[ subject ]</a>
              <a href="author.html#4877">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
