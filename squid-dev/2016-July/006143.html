<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Care and feeding of ConnStateData
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Care%20and%20feeding%20of%20ConnStateData&In-Reply-To=%3C5780B676.6000301%40chtsanti.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="006148.html">
   <LINK REL="Next"  HREF="006138.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Care and feeding of ConnStateData</H1>
    <B>Christos Tsantilas</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Care%20and%20feeding%20of%20ConnStateData&In-Reply-To=%3C5780B676.6000301%40chtsanti.net%3E"
       TITLE="[squid-dev] Care and feeding of ConnStateData">christos at chtsanti.net
       </A><BR>
    <I>Sat Jul  9 08:31:50 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="006148.html">[squid-dev] Care and feeding of ConnStateData
</A></li>
        <LI>Next message: <A HREF="006138.html">[squid-dev] [PATCH] avoid flooding cache.log with &quot;uninitialized value&quot; messages from ext_wbinfo_group_acl helper script
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6143">[ date ]</a>
              <a href="thread.html#6143">[ thread ]</a>
              <a href="subject.html#6143">[ subject ]</a>
              <a href="author.html#6143">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07/07/2016 10:22 PM, Alex Rousskov wrote:
&gt;<i> On 07/06/2016 10:52 PM, Amos Jeffries wrote:
</I>&gt;&gt;<i> On 7/07/2016 10:24 a.m., Alex Rousskov wrote:
</I>&gt;&gt;&gt;<i> Q2. Where does the pending Downloader class belong?
</I>&gt;<i>
</I>&gt;&gt;<i> In overview I think if we have a good Downloader design those other
</I>&gt;&gt;<i> things and ESIInclude should probably be converted into Downloader or
</I>&gt;&gt;<i> children of it.
</I>&gt;<i>
</I>&gt;<i> Yes, but if and only if ESI needs to download small SBuf-storable
</I>&gt;<i> things. If ESI needs potentially large HTTP response bodies, then ESI
</I>&gt;<i> cannot be refactored to use Downloader.
</I>

My sense is that the ESI uses simple buffers to store data. However not 
sure, we need to review the esi code.  But the Downloader as is now is a 
small class, can be extended in the future to handle large response 
bodies.

If I am not wrong we fixed recently a bug in esi which was related. 
Maybe there are still others bugs in esi too. Using a class like the 
Downloader, which used by other subsystems where there is active 
development and higher users base, may eliminate this type of bugs.


On 07/08/2016 01:16 AM, Amos Jeffries wrote:
&gt;<i> On 8/07/2016 7:22 a.m., Alex Rousskov wrote:
</I>&gt;&gt;<i>    2. Move that remaining generic code into src/servers/Server and src/http/.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> We all have been doing step #1 since then, but we are not yet ready for
</I>&gt;&gt;<i> step #2 because ConnStateData still has HTTP server-specific code in it.
</I>&gt;<i>
</I>&gt;<i> Apart from auditing all I'm seeing from Factory is more and more
</I>&gt;<i> non-Server things being added to ConnStateData. First it was 1xx message
</I>&gt;<i> handling, then ssl-bump, then all the FTP translation logics, then
</I>&gt;<i> Downloader (thanks for reversing on that one).
</I>The 1xx message handling is used by FTP code too.

The ssl-bump my opinion is that it is normal to be handled by 
ConnStateData because it is near the connection level, not near the 
protocol level. We may want to split ConnStateData to a new 
TlsConnStateData class.

There is not a lot of Ftp related code inside ConnStateData. In the 
future we can completely remove the remaining &quot;if (HTTP protocol)&quot; or 
&quot;if (FTP protocol)&quot; which are not many.

Also we may want to move the ProxyProtocol related code under a new 
class inside servers/ProxyProtocol.[cc,h].


</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006148.html">[squid-dev] Care and feeding of ConnStateData
</A></li>
	<LI>Next message: <A HREF="006138.html">[squid-dev] [PATCH] avoid flooding cache.log with &quot;uninitialized value&quot; messages from ext_wbinfo_group_acl helper script
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6143">[ date ]</a>
              <a href="thread.html#6143">[ thread ]</a>
              <a href="subject.html#6143">[ subject ]</a>
              <a href="author.html#6143">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
