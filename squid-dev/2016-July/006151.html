<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH Bug 4534 and N-bit fixes for CacheDigest
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%20Bug%204534%20and%20N-bit%20fixes%20for%20CacheDigest&In-Reply-To=%3C440bcbc3-7332-eb13-701f-b11d7c2f9ced%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="006145.html">
   <LINK REL="Next"  HREF="006156.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH Bug 4534 and N-bit fixes for CacheDigest</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%20Bug%204534%20and%20N-bit%20fixes%20for%20CacheDigest&In-Reply-To=%3C440bcbc3-7332-eb13-701f-b11d7c2f9ced%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH Bug 4534 and N-bit fixes for CacheDigest">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Jul 10 10:08:23 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="006145.html">[squid-dev] [PATCH Bug 4534 and N-bit fixes for CacheDigest
</A></li>
        <LI>Next message: <A HREF="006156.html">[squid-dev] [PATCH Bug 4534 and N-bit fixes for CacheDigest
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6151">[ date ]</a>
              <a href="thread.html#6151">[ thread ]</a>
              <a href="subject.html#6151">[ subject ]</a>
              <a href="author.html#6151">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/07/2016 1:37 a.m., Amos Jeffries wrote:
&gt;<i> This patch converts the CacheDigest members and method parameters to use
</I>&gt;<i> explicitly sized data types more appropriate for what details they hold.
</I>&gt;<i> 
</I>&gt;<i> * 64-bit Digest capacity (entry count)
</I>&gt;<i> * 32-bit Mask Size (byte count)
</I>&gt;<i> *  8-bit Bit count per entry
</I>&gt;<i> 
</I>&gt;<i> Due to various store_digest.cc code still relying on masks not exceeding
</I>&gt;<i> 2^31-1 worth of memory space we have to still assert that bitCount
</I>&gt;<i> calculation does not exceed that value.
</I>&gt;<i> 
</I>
Additional to this, to fully fix the bug 4534 issue we are going to have
to decide if it is reasonable to have extremely large Cache Digest masks
(several tens of GB or memory).

The caches the bug appears on are all several TB of size (by space). But
even more importantly they are spread over more than 5 cache_dir. So the
2^25-ish limit on entries per cache_dir is not keeping the total
Squid-wide object count within a 32-bit value.

Amos

</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006145.html">[squid-dev] [PATCH Bug 4534 and N-bit fixes for CacheDigest
</A></li>
	<LI>Next message: <A HREF="006156.html">[squid-dev] [PATCH Bug 4534 and N-bit fixes for CacheDigest
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6151">[ date ]</a>
              <a href="thread.html#6151">[ thread ]</a>
              <a href="subject.html#6151">[ subject ]</a>
              <a href="author.html#6151">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
