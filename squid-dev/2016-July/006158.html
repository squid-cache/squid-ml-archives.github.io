<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] TidyPointer removal
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20TidyPointer%20removal&In-Reply-To=%3C184624ef-ba1d-0a21-e2c4-3eab583f30e5%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="006157.html">
   <LINK REL="Next"  HREF="006130.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] TidyPointer removal</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20TidyPointer%20removal&In-Reply-To=%3C184624ef-ba1d-0a21-e2c4-3eab583f30e5%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] TidyPointer removal">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Jul 11 01:55:42 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="006157.html">[squid-dev] [PATCH] TidyPointer removal
</A></li>
        <LI>Next message: <A HREF="006130.html">[squid-dev] Care and feeding of ConnStateData
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6158">[ date ]</a>
              <a href="thread.html#6158">[ thread ]</a>
              <a href="subject.html#6158">[ subject ]</a>
              <a href="author.html#6158">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/07/2016 10:20 a.m., Alex Rousskov wrote:
&gt;<i> On 07/10/2016 02:02 AM, Amos Jeffries wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> * For the LockingPointer(T*) ctor and resetWithoutLocking() method
</I>&gt;&gt;<i>  the caller is responsible for:
</I>&gt;&gt;<i>  - doing a +1 lock itself, and
</I>&gt;&gt;<i>  - exactly once for *each time either is used*, and
</I>&gt;&gt;<i>  - doing it before the call/use.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * For release() the caller is taking on responsibility for exactly 1
</I>&gt;&gt;<i> un-lock operation.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * For all other methods and operators the recieving Pointer is
</I>&gt;&gt;<i> responsible for the locking.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> Please reconsider your code examples in light of those requirements and
</I>&gt;&gt;<i> you should see where the bugs in the examples are confusing you.
</I>&gt;<i> 
</I>&gt;<i> I know the requirements. My examples are purposefully built to contain
</I>&gt;<i> problematic self-reset conditions and illustrate the differences between
</I>&gt;<i> self-reset treatment approaches. Real callers may think they follow all
</I>&gt;<i> the rules, but code complexities can easily hide self-assignment/reset
</I>&gt;<i> from them. My examples are simple enough to clearly expose those
</I>&gt;<i> normally hidden problems.
</I>&gt;<i> 
</I>&gt;<i> It is impossible to study self-reset treatment approaches using
</I>&gt;<i> perfectly correct caller code. Perfectly correct caller code does not
</I>&gt;<i> have self-resets.
</I>&gt;<i> 
</I>
So your argument is that people write buggy code sometimes and its
impossible to find 100% of bugs. Therefore we must add a workaround that
hides bugs and actively encourages more buggy code to be written by
turning the actual cases of good code into hard-to-identify memory leaks.

Hell no.

If caller(s) need to use a Pointer that does not unlock its delegated
values. Then they should be using TidyPointer/unique_ptr instead of
abusing the LockingPointer. The entire purpose of LockingPointer is to
ensure the unlocking happens when its stored value goes out of scope
(gets replaced, even with self).

Amos

</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006157.html">[squid-dev] [PATCH] TidyPointer removal
</A></li>
	<LI>Next message: <A HREF="006130.html">[squid-dev] Care and feeding of ConnStateData
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6158">[ date ]</a>
              <a href="thread.html#6158">[ thread ]</a>
              <a href="subject.html#6158">[ subject ]</a>
              <a href="author.html#6158">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
