<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Fetch missing certificates
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Fetch%20missing%20certificates&In-Reply-To=%3C5787AAB7.4060302%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="006232.html">
   <LINK REL="Next"  HREF="006282.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Fetch missing certificates</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Fetch%20missing%20certificates&In-Reply-To=%3C5787AAB7.4060302%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] Fetch missing certificates">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Jul 14 15:07:35 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="006232.html">[squid-dev] [PATCH] Fetch missing certificates
</A></li>
        <LI>Next message: <A HREF="006282.html">[squid-dev] [PATCH] Fetch missing certificates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6252">[ date ]</a>
              <a href="thread.html#6252">[ thread ]</a>
              <a href="subject.html#6252">[ subject ]</a>
              <a href="author.html#6252">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07/14/2016 05:16 AM, Amos Jeffries wrote:
&gt;<i> * the debugs lines indicating constructor and destructor have been run
</I>&gt;<i> need to be symmetrical and name the object type.
</I>&gt;<i> 
</I>&gt;<i>  - They are there for the find-alive.pl script, so need to match the
</I>&gt;<i> pattern it is searching for:
</I>&gt;<i>  eg. debugs(33, 6, &quot;Downloader constructed, this=&quot; &lt;&lt; (void*)this);
</I>&gt;<i>  eg. debugs(33, 6, &quot;Downloader destructed, this=&quot; &lt;&lt; (void*)this);
</I>&gt;<i> 
</I>&gt;<i>  - same for other new objects contrustors and destructors. IF you have
</I>&gt;<i> debugs() namign them.
</I>
However, if a parent class already provides those, then I recommend not
adding more constructed/destructed lines in kids as they will not help
find-alive.pl. Not a big deal either way though.


&gt;<i>   Since we are considering Downloader a type of high level protocol
</I>&gt;<i> actor its conceivable that we will want to use 11,2 for displaying its
</I>&gt;<i> HTTP-ish messages before the rest of Squid logic gets to mangle them.
</I>
I agree that showing Downloader requests at ALL,2 is a good idea,
especially if it is easy to report [until the routing layer supplies
that functionality for all routing clients]. Needless to say, that
reporting should be done when the request is formed, not in the class
destructor.


&gt;<i> * Downloader::downloadFinished method
</I>
&gt;<i>  - that comment brings up the question of whether that Must() should be
</I>&gt;<i> confirming doneAll() instead of done() ?
</I>
Must(done()) is correct. doneAll() becomes true when a _positive_
termination goal has been reached so when we want to assert that the job
is done (for any reason) we must use the more comprehensive done().

Please remove the following &quot;Squid will delete...&quot; comment or replace it
with a more accurate one:

    Must(done()); // we will be deleted upon exiting job's AsyncCall

We should probably add an AsyncJob method that encapsulates the above
check _and_ verifies that the job is currently handling an async call,
but that improvement is outside your project scope, of course.


&gt;<i>  - the symbol name 'callback' has a clash between the private method,
</I>&gt;<i> and the private member Pointer. This is a case where the '_' suffix is
</I>&gt;<i> required to distinguish them.
</I>
AFAICT, that private method is spelled callBack (appropriately making
the method name a verb rather than a &quot;callback&quot; noun used for the data
member) so there is no clash. I am not against adding the '_' suffix though.


&gt;<i> in src/ssl/PeerConnector.h:
</I>&gt;<i> 
</I>&gt;<i> * since certsDownloads is apparently constrained to values up to
</I>&gt;<i> MaxCertsDownloads. Can we please use a small integer type like uint8_t
</I>&gt;<i> instead of a full 'int' ?
</I>
Please do not use uint8_t. I believe this has been discussed already:
Size-specific types should only be used when there is a specific correct
size (e.g., we must replicate a system structure) and/or we must
minimize memory footprint (e.g., lots of structures containing this
member are expected, especially inside a large container).

Using &quot;int&quot; is the correct default because it does not force the reader
to pause and think &quot;Why 8 bits?&quot;, is usually faster, will be printed as
a number on std::ostream (rather than a character), and has fewer
chances to accidentally overflow when somebody decides to increase
MaxCertsDownloads (e.g., by making it configurable) without updating
certsDownloads.


Thank you,

Alex.

</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006232.html">[squid-dev] [PATCH] Fetch missing certificates
</A></li>
	<LI>Next message: <A HREF="006282.html">[squid-dev] [PATCH] Fetch missing certificates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6252">[ date ]</a>
              <a href="thread.html#6252">[ thread ]</a>
              <a href="subject.html#6252">[ subject ]</a>
              <a href="author.html#6252">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
