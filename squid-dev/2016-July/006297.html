<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Fetch missing certificates
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Fetch%20missing%20certificates&In-Reply-To=%3C5788FDE0.5020901%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="006283.html">
   <LINK REL="Next"  HREF="006289.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Fetch missing certificates</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Fetch%20missing%20certificates&In-Reply-To=%3C5788FDE0.5020901%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] Fetch missing certificates">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Jul 15 15:14:40 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="006283.html">[squid-dev] [PATCH] Fetch missing certificates
</A></li>
        <LI>Next message: <A HREF="006289.html">[squid-dev] [PATCH] Fetch missing certificates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6297">[ date ]</a>
              <a href="thread.html#6297">[ thread ]</a>
              <a href="subject.html#6297">[ subject ]</a>
              <a href="author.html#6297">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07/15/2016 02:14 AM, Amos Jeffries wrote:
&gt;<i> On 15/07/2016 3:07 a.m., Alex Rousskov wrote:
</I>&gt;&gt;<i> On 07/14/2016 05:16 AM, Amos Jeffries wrote:
</I>&gt;&gt;&gt;<i> * since certsDownloads is apparently constrained to values up to
</I>&gt;&gt;&gt;<i> MaxCertsDownloads. Can we please use a small integer type like uint8_t
</I>&gt;&gt;&gt;<i> instead of a full 'int' ?
</I>
&gt;&gt;<i> Please do not use uint8_t. I believe this has been discussed already:
</I>&gt;&gt;<i> Size-specific types should only be used when there is a specific correct
</I>&gt;&gt;<i> size (e.g., we must replicate a system structure) and/or we must
</I>&gt;&gt;<i> minimize memory footprint (e.g., lots of structures containing this
</I>&gt;&gt;<i> member are expected, especially inside a large container).
</I>
&gt;<i> Or when we need some certainty about what the size of the data field
</I>&gt;<i> actually is.
</I>
Agreed, although I cannot think of a good example where this third
reason would not be already covered by the first two.


&gt;<i> Side track: For sizes of payload objects we should be centering on
</I>&gt;<i> uint64_t to handle the large objects instead of size_t or int which
</I>&gt;<i> can't handle them.
</I>
Not exactly:

* size_t is for payload kept in RAM as a single contiguous blob.

* uint64_t is for all other payload without size-specific constraints;
such &quot;other&quot; payload is usually &quot;streamed&quot; using multiple constant blobs
or recycling the same buffer.


&gt;<i> This situation is ambiguous for Downloader though since its
</I>&gt;<i> HTTP_REQBUF_SZ can only able to handle 4 KB or smaller objects.
</I>
There is no ambiguity: Downloader scope is explicitly defined as payload
that can be stored in SBuf. Downloader should use whatever size type
SBuf is using. If it does not, it is a bug.

Christos has corrected your misunderstanding regarding I/O buffer size
vs accumulated payload size, but I am focusing on size _types_ here.


&gt;&gt;<i> Using &quot;int&quot; is the correct default because it does not force the reader
</I>&gt;&gt;<i> to pause and think &quot;Why 8 bits?&quot;,
</I>&gt;<i> 
</I>&gt;<i> Not having a fixed size forces the reader to stop and think &quot;what can
</I>&gt;<i> int be?&quot;
</I>
I disagree. A &quot;natural&quot; or &quot;any-reasonable-size&quot; type like &quot;int&quot; does
not force a typical reader to stop and think. Only size-specific types
like &quot;uint8_t&quot; do. That is one of the primary points behind avoiding
size-specific types (the other one is that it is difficult to write
correct code with size-constraint types without special tooling that
Squid currently lacks).

We have discussed that design principle already. If you continue to
disagree with the &quot;use int unless you have specific reasons not to&quot;
approach, there is nothing more I can do to convince you [given the time
constraints], and we would have to live with the hodgepodge of types --
the developer decides on what it the best in their opinion.


&gt;<i> Note that Squid is used on some embeded systems where int != 32-bit.
</I>
Correct &quot;int&quot; usage would cover any reasonable &quot;int&quot; size, which is
guaranteed to be large enough to hold [-32767, 32767] range. When used
correctly, &quot;int&quot; is used because &quot;int&quot; is &quot;large enough&quot; not because
&quot;int has 32 bits&quot;.


&gt;&gt;<i> is usually faster, will be printed as
</I>&gt;&gt;<i> a number on std::ostream (rather than a character), and has fewer
</I>&gt;&gt;<i> chances to accidentally overflow when somebody decides to increase
</I>&gt;&gt;<i> MaxCertsDownloads (e.g., by making it configurable) without updating
</I>&gt;&gt;<i> certsDownloads.
</I>
&gt;<i> The person doing that needs to know the value ranges they are changing
</I>&gt;<i> and what side effects the change will have. Using &quot;int&quot; just obscures
</I>&gt;<i> the issues.
</I>
Using an &quot;int&quot; does not obscure anything IMO. It says &quot;any reasonable
count&quot; should work and the developers did not pay any special attention
to the true absolute maximum, whatever it is.

Using an 8-bit int, on the other hand, says &quot;there are fundamental
reasons why we cannot have more than 255 chained downloads and the code
was painstakingly written to control and document that limit&quot;.

However, this just goes back to the original discussion regarding where
&quot;int&quot; should be used. This is just one of the examples for that
discussion...

Alex.

</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006283.html">[squid-dev] [PATCH] Fetch missing certificates
</A></li>
	<LI>Next message: <A HREF="006289.html">[squid-dev] [PATCH] Fetch missing certificates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6297">[ date ]</a>
              <a href="thread.html#6297">[ thread ]</a>
              <a href="subject.html#6297">[ subject ]</a>
              <a href="author.html#6297">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
