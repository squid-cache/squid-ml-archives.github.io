<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [RFC] &quot;Splicing&quot; bumped requests to resolve\workaround WebSockets issues.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20%22Splicing%22%20bumped%20requests%20to%0A%20resolve%5Cworkaround%20WebSockets%20issues.&In-Reply-To=%3Cbd281310-87f8-bd95-0a10-fed3f51c162c%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="006284.html">
   <LINK REL="Next"  HREF="006345.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [RFC] &quot;Splicing&quot; bumped requests to resolve\workaround WebSockets issues.</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20%22Splicing%22%20bumped%20requests%20to%0A%20resolve%5Cworkaround%20WebSockets%20issues.&In-Reply-To=%3Cbd281310-87f8-bd95-0a10-fed3f51c162c%40treenet.co.nz%3E"
       TITLE="[squid-dev] [RFC] &quot;Splicing&quot; bumped requests to resolve\workaround WebSockets issues.">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Jul 17 12:04:49 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="006284.html">[squid-dev] [RFC] &quot;Splicing&quot; bumped requests to resolve\workaround	WebSockets issues.
</A></li>
        <LI>Next message: <A HREF="006345.html">[squid-dev] [RFC] &quot;Splicing&quot; bumped requests to resolve\workaround WebSockets issues.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6341">[ date ]</a>
              <a href="thread.html#6341">[ thread ]</a>
              <a href="subject.html#6341">[ subject ]</a>
              <a href="author.html#6341">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 15/07/2016 10:29 p.m., Eliezer Croitoru wrote:
&gt;<i> I want to understand the way a WebSocket Splice would work.
</I>&gt;<i> 
</I>&gt;<i> The issue:
</I>&gt;<i> 
</I>&gt;<i> Clients are issuing secured connections which contains WebSockets internally
</I>&gt;<i> and squid HTTP parsing breaks these connections.
</I>
WebSockets is explicitly designed to:

a) wrap the port 80 WS requests in HTTP messages so intermediaries like
Squid can process them as regular HTTP(S) connections.

b) wrap the port 443 WS-over-TLS traffic with WebSockets ALPN value.
Squid on_unsupported_protocol. **


Now, there appear to be some applications which are not able to handle
(a) type HTTP responses coming back from sending that HTTP request and
are saying &quot;you broke my traffic&quot;. Well no, you broken your traffic.

The Squid on_unsupported_protocol mechanism/feature needs to be checked
whether it handles the (b) type connections properly. If not that is a
bug that needs fixing.
 NP: Skype and other *-over-TLS protocol issues might be able to be
fixed as a side effect of the same change.


&gt;<i> 
</I>&gt;<i> From a security aspect of things, many companies would not like the idea of
</I>&gt;<i> the options to &quot;smuggle&quot; data using http through a proxy.
</I>&gt;<i> 
</I>
That is an argument against allowing WebSockets through at all.


&gt;<i> 
</I>&gt;<i> Another related issue which deserves attention:
</I>&gt;<i> 
</I>&gt;<i> Certificate pinning and connection breakage.
</I>&gt;<i> 
</I>&gt;<i> Currently we cannot determine for many connections what is the &quot;issue&quot;, is
</I>&gt;<i> it the bumping itself of the breakage of a WebSocket http connection.
</I>&gt;<i> 
</I>
Squid not implementing HTTP Upgrade feature is severely limiting what
behaviour of WebSocket will work. **

Squid not implementing re-CONNECT to upstream servers is also severely
restricting what behaviour of WebSocket will work. **

The inability of the WebSocket applications to actually implement all of
the required bits of WebSocket protocol leaves them vulnerable to the
above being unavailable.

... the combination of all three is fatal to some applications which for
whatever reason are not able to handle the remaining behaviour. Which is
ironically why those implementation-ignored parts of WS are required in
the first place.



For Squid all we can do is implement the items marked &quot;**&quot; above.

Amos

</PRE>


























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006284.html">[squid-dev] [RFC] &quot;Splicing&quot; bumped requests to resolve\workaround	WebSockets issues.
</A></li>
	<LI>Next message: <A HREF="006345.html">[squid-dev] [RFC] &quot;Splicing&quot; bumped requests to resolve\workaround WebSockets issues.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6341">[ date ]</a>
              <a href="thread.html#6341">[ thread ]</a>
              <a href="subject.html#6341">[ subject ]</a>
              <a href="author.html#6341">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
