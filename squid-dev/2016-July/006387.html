<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Collapse internal revalidation requests (SMP-unaware caches)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Collapse%20internal%20revalidation%20requests%0A%20%28SMP-unaware%20caches%29&In-Reply-To=%3C578F9D61.8040102%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="006383.html">
   <LINK REL="Next"  HREF="006390.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Collapse internal revalidation requests (SMP-unaware caches)</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Collapse%20internal%20revalidation%20requests%0A%20%28SMP-unaware%20caches%29&In-Reply-To=%3C578F9D61.8040102%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] Collapse internal revalidation requests (SMP-unaware caches)">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Jul 20 15:48:49 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="006383.html">[squid-dev] [PATCH] Collapse internal revalidation requests (SMP-unaware caches)
</A></li>
        <LI>Next message: <A HREF="006390.html">[squid-dev] [PATCH] Collapse internal revalidation requests (SMP-unaware caches)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6387">[ date ]</a>
              <a href="thread.html#6387">[ thread ]</a>
              <a href="subject.html#6387">[ subject ]</a>
              <a href="author.html#6387">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07/20/2016 07:21 AM, Amos Jeffries wrote:
&gt;<i> Probably more a question for Alex;
</I>&gt;<i>   whats the point of UsingSmp() in determining transients
</I>&gt;<i> initialization? I would expect collapsing to be doable in both SMP and
</I>&gt;<i> non-SMP modes.
</I>
You are correct: Basic collapsed forwarding works in both SMP and
non-SMP modes, but Transients are not _needed_ for non-SMP mode and may
actually be harmful there. Here is a summary, for the record:

* Caching is supported in both modes.

* Basic collapsed forwarding is supported in both modes.
* Collapsed revalidation is supported in non-SMP mode only [for now?].

* Transients are needed for SMP caching to work.
  Transients are not needed for and are harmful in non-SMP mode.
  They are no longer created when not needed, fixing at least bug 4311.

* Configurations mixing SMP-aware and non-SMP-aware caches
  in SMP mode are still not supported.


&gt;<i> In related things. I am working on improving the log tags to report to
</I>&gt;<i> which transactions have been delayed by collapsed forwarding. ie. the
</I>&gt;<i> crSlave transactions in this patch.
</I>
Please note that being collapsed (crSlave) does not imply a delay. If
collapsing was a success (i.e., the slave was able to use the response
received by an &quot;earlier&quot; concurrent transaction), then it actually
implies a [small] speedup! If collapsed forwarding was a failure (i.e.,
the response was not cachable/usable), then there will likely be a delay
indeed.

If crSlave transactions are &quot;tagged&quot;, then an access log reader may be
able to tell whether they were successful by examining [the lack of]
some origin server connection details, but I have not tested that theory.

I agree that it would be useful to &quot;tag&quot; crSlave transactions in access
logs somehow, but I have not studied the best approach to doing so IIRC.


Thank you,

Alex.

</PRE>





































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006383.html">[squid-dev] [PATCH] Collapse internal revalidation requests (SMP-unaware caches)
</A></li>
	<LI>Next message: <A HREF="006390.html">[squid-dev] [PATCH] Collapse internal revalidation requests (SMP-unaware caches)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6387">[ date ]</a>
              <a href="thread.html#6387">[ thread ]</a>
              <a href="subject.html#6387">[ subject ]</a>
              <a href="author.html#6387">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
