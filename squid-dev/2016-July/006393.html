<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Some failed transactions are not logged
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Some%20failed%20transactions%20are%20not%20logged&In-Reply-To=%3C579008FA.8050909%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="006386.html">
   <LINK REL="Next"  HREF="006398.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Some failed transactions are not logged</H1>
    <B>Eduard Bagdasaryan</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Some%20failed%20transactions%20are%20not%20logged&In-Reply-To=%3C579008FA.8050909%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] Some failed transactions are not logged">eduard.bagdasaryan at measurement-factory.com
       </A><BR>
    <I>Wed Jul 20 23:27:54 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="006386.html">[squid-dev] [PATCH] Some failed transactions are not logged
</A></li>
        <LI>Next message: <A HREF="006398.html">[squid-dev] [PATCH] Some failed transactions are not logged
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6393">[ date ]</a>
              <a href="thread.html#6393">[ thread ]</a>
              <a href="subject.html#6393">[ subject ]</a>
              <a href="author.html#6393">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>2016-07-20 18:23 GMT+03:00 Alex Rousskov &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">rousskov at measurement-factory.com</A>&gt;:
 &gt; On 07/20/2016 09:06 AM, Amos Jeffries wrote:
 &gt; &gt; On 21/07/2016 2:44 a.m., Eduard Bagdasaryan wrote:
 &gt; &gt;&gt; Amos,
 &gt; &gt;&gt; just to clarify: any more touches from my side?
 &gt;
 &gt; &gt; There are the bits where Alex and I agreed on a change. I think 
that was
 &gt; &gt; all cosmetic documentation stuff.
 &gt;
 &gt; In summary:
 &gt;
 &gt; 1. Rename the error URL to &quot;error:accept-client-connection&quot;.
 &gt; 2. Adjust the source code comments using the &quot;Given the new condition, I
 &gt; would do&quot; sketch.
 &gt; 3. Use the getter method for receivedFirstByte_.

Updated the patch with first two changes. We do not have a 'getter' for
receivedFirstByte_. It easy to add it of course, but I assume the current
receivedFirstByte() should be refactored then, adding a 'bool' parameter,
smth. like:

void
ConnStateData::receivedFirstByte(bool on)
{
     if (on == receivedFirstByte_)
         return;
     receivedFirstByte_ = on;
     if (!receivedFirstByte_)
         return;
     // Set timeout to Config.Timeout.request
     typedef CommCbMemFunT&lt;ConnStateData, CommTimeoutCbParams&gt; 
TimeoutDialer;
     AsyncCall::Pointer timeoutCall =  JobCallback(33, 5,
                                       TimeoutDialer, this, 
ConnStateData::requestTimeout);
     commSetConnTimeout(clientConnection, Config.Timeout.request, 
timeoutCall);
}

Then go through the code and use this new method instead of
receivedFirstByte_ assignment. Do we need all this?

BTW, in server.cc &quot;if&quot; check is redundant:
   if (!receivedFirstByte_)
       receivedFirstByte();



Eduard.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SQUID-170-some-failed-transactions-not-logged-t8.patch
Type: text/x-patch
Size: 25285 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20160721/b2146b96/attachment-0001.bin">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20160721/b2146b96/attachment-0001.bin</A>&gt;
</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006386.html">[squid-dev] [PATCH] Some failed transactions are not logged
</A></li>
	<LI>Next message: <A HREF="006398.html">[squid-dev] [PATCH] Some failed transactions are not logged
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6393">[ date ]</a>
              <a href="thread.html#6393">[ thread ]</a>
              <a href="subject.html#6393">[ subject ]</a>
              <a href="author.html#6393">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
