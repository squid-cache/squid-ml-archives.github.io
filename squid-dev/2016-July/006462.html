<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Deletors for std::unique_ptr WAS: Re: Broken trunk after r14735
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Deletors%20for%20std%3A%3Aunique_ptr%20WAS%3A%20Re%3A%0A%20Broken%20trunk%20after%20r14735&In-Reply-To=%3C579CE34A.9010003%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="006461.html">
   <LINK REL="Next"  HREF="006465.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Deletors for std::unique_ptr WAS: Re: Broken trunk after r14735</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Deletors%20for%20std%3A%3Aunique_ptr%20WAS%3A%20Re%3A%0A%20Broken%20trunk%20after%20r14735&In-Reply-To=%3C579CE34A.9010003%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] Deletors for std::unique_ptr WAS: Re: Broken trunk after r14735">rousskov at measurement-factory.com
       </A><BR>
    <I>Sat Jul 30 17:26:34 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="006461.html">[squid-dev] [PATCH] Deletors for std::unique_ptr WAS: Re: Broken trunk after r14735
</A></li>
        <LI>Next message: <A HREF="006465.html">[squid-dev] [PATCH] Deletors for std::unique_ptr WAS: Re: Broken trunk after r14735
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6462">[ date ]</a>
              <a href="thread.html#6462">[ thread ]</a>
              <a href="subject.html#6462">[ subject ]</a>
              <a href="author.html#6462">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07/30/2016 07:03 AM, Amos Jeffries wrote:
&gt;<i> On 30/07/2016 6:29 a.m., Alex Rousskov wrote:
</I>&gt;&gt;<i> On 07/29/2016 09:27 AM, Amos Jeffries wrote:
</I>&gt;&gt;&gt;&gt;&gt;<i> typedef std::unique_ptr&lt;BIO, std::function&lt;decltype(BIO_free)&gt;&gt; BIO_Pointer;
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I got this config parsing crash replicated here and tried a dozen or so
</I>&gt;&gt;&gt;<i> combinations. It does seem to keep coming back to my earlier approach of
</I>&gt;&gt;&gt;<i> using per-type Functors as the most reliable solution.
</I>

&gt;&gt;<i> AFAICT, this is not a question of reliability, and we should not be
</I>&gt;&gt;<i> fixing this by trying various combination of typedef characters until we
</I>&gt;&gt;<i> find one that does not immediately crash Squid. We should figure out
</I>&gt;&gt;<i> _why_ trunk code does not work (and then fix it accordingly).
</I>

&gt;<i> Please clear your head of the notion that I'm tying things bindly or
</I>&gt;<i> randomly.
</I>
You control those notions -- I am going by what you tell me. I can
rarely guess your state of mind unless you document it. The lack of the
problem cause description combined with phrases like &quot;trying dozen or so
combinations&quot;, &quot;seem to&quot;, &quot;the most reliable solution&quot; and other things
you have said, tell me that you do not know what the root of the problem
is and assume that this is a reliability problem (i.e., sometimes a
certain solution works and sometimes it does not).


&gt;<i> The difficulty as I mentioned already has been in finding a working
</I>&gt;<i> solution that is easily used without risking future bugs from people
</I>&gt;<i> misunderstanding the use of these Pointers. That is what I meant by
</I>&gt;<i> &quot;reliable&quot;.
</I>
AFAICT, you have not documented what the cause of the bug is and you
have used a vague &quot;reliable&quot; adjective without enough context to guess
one of its meanings, so blaming others for not knowing your state of
mind is rather unfair.


&gt;<i> You have previously assured me[1] that using std::function&lt;declype(X)&gt;
</I>&gt;<i> was the way to go and would allow removal of the macros. That usage has
</I>&gt;<i> turned out to cause the null derefernce.
</I>
I fully admit that my std::function suggestion was wrong. While my
suggestion and decltype discovery were a big step in the right
direction, I missed the fact that the default functor constructor needs
to create the right target which, AFAIK, std::function cannot do. If you
think that makes me responsible for the bugs in your patch (otherwise
why would you even mention that mistake?), I am not going to waste time
convincing you otherwise.

For the record, my suggestions did remove macros, and I gave no
assurances that they are the final/correct solution (only that they
compile in my tests).

A bigger problem here is that your attitude continues to present a
difficult dilemma for me: When you post bad code, do I simply downvote
it (and get blamed for being harsh and uncooperative while increasing
the risks that we all will have to suffer from the consequences of that
code being committed), or do I spend insane amounts of time trying to
improve it despite the resistance and frequent personal attacks (and
then get blamed for the bugs)? It is difficult to find the lesser evil
among these options!

Alex.

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006461.html">[squid-dev] [PATCH] Deletors for std::unique_ptr WAS: Re: Broken trunk after r14735
</A></li>
	<LI>Next message: <A HREF="006465.html">[squid-dev] [PATCH] Deletors for std::unique_ptr WAS: Re: Broken trunk after r14735
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6462">[ date ]</a>
              <a href="thread.html#6462">[ thread ]</a>
              <a href="subject.html#6462">[ subject ]</a>
              <a href="author.html#6462">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
