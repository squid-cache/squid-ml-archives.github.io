<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [RFC] client header mangling
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20client%20header%20mangling&In-Reply-To=%3C04fa01d1c298%24c59d6860%2450d83920%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="005952.html">
   <LINK REL="Next"  HREF="005962.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [RFC] client header mangling</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20client%20header%20mangling&In-Reply-To=%3C04fa01d1c298%24c59d6860%2450d83920%24%40ngtech.co.il%3E"
       TITLE="[squid-dev] [RFC] client header mangling">eliezer at ngtech.co.il
       </A><BR>
    <I>Thu Jun  9 21:49:17 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="005952.html">[squid-dev] [RFC] client header mangling
</A></li>
        <LI>Next message: <A HREF="005962.html">[squid-dev] [RFC] client header mangling
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5959">[ date ]</a>
              <a href="thread.html#5959">[ thread ]</a>
              <a href="subject.html#5959">[ subject ]</a>
              <a href="author.html#5959">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am trying to understand so bear with me couple seconds.
I have seen that there are pages\servers which doesn't state about the User-Agent in the Vary response while still taking it into account.

The caching side of the picture is storing an object which will never be served.
The HIT ratio is a whole other story  of the picture.

Since I am not inside the code but I do try to understand, currently what happens?
How many lookups are done for\per a request? Do we run an object lookup after the response headers was received from the server?
Can we predict a Vary object based on the request only?(I assume that it will be an estimated and not absolute certainty if at all)
Also let say we have a 1k page ahead, would we want it to be fetched from disk\ram store rather then from the origin server after we told it we want the object?

I am almost sure that lowering the disk and ram stored objects should be a goal by itself if we cannot &quot;dig&quot; them up from ram or disk later for any use.

A request_header_replace can work only for &quot;generic&quot; ones such as without a language preference such as &quot;br&quot; added to some requests by browser add-ons.

Now a step further, I can write a tiny ICAP service that will &quot;handle&quot; common Vary headers from FireFox and other browsers to test how it affects caches in general.

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">eliezer at ngtech.co.il</A>


-----Original Message-----
From: squid-dev [mailto:<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev-bounces at lists.squid-cache.org</A>] On Behalf Of Amos Jeffries
Sent: Tuesday, June 7, 2016 2:10 PM
To: Squid Developers
Subject: [squid-dev] [RFC] client header mangling

I've been looking at ways to resolve the long Vary discussion going on in squid-users with a patch that we can accept into mainline. What they (joe and Yuri) have at present works, but only with extra request_header_replace config preventing integrity problems.

One way to make useful progress would be to finally add the recurring request for request_header_access/replace to work on client messages in a pre-cache doCallouts hook rather than only a post-cache hook.

I am imagining this being done on the adapted request headers after ICAP, eCAP and URL-rewrite have all done their things. And using the same request_header_* directive ACL lists as for outbound traffic.

Any alternative ideas or objections?

Amos

_______________________________________________
squid-dev mailing list
<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev at lists.squid-cache.org</A> &lt;mailto:<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev at lists.squid-cache.org</A>&gt; 
<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">http://lists.squid-cache.org/listinfo/squid-dev</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20160610/72da5080/attachment.html">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20160610/72da5080/attachment.html</A>&gt;
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005952.html">[squid-dev] [RFC] client header mangling
</A></li>
	<LI>Next message: <A HREF="005962.html">[squid-dev] [RFC] client header mangling
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5959">[ date ]</a>
              <a href="thread.html#5959">[ thread ]</a>
              <a href="subject.html#5959">[ subject ]</a>
              <a href="author.html#5959">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
