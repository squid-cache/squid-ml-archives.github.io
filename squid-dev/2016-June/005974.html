<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] cleanup cppunit detection and use
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20cleanup%20cppunit%20detection%20and%20use&In-Reply-To=%3C7575b986-5ad2-1bb0-9f09-5fc6b6658aba%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="005972.html">
   <LINK REL="Next"  HREF="005977.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] cleanup cppunit detection and use</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20cleanup%20cppunit%20detection%20and%20use&In-Reply-To=%3C7575b986-5ad2-1bb0-9f09-5fc6b6658aba%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] cleanup cppunit detection and use">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Jun 12 00:28:10 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="005972.html">[squid-dev] r14701 broke ./configure --enable-ecap
</A></li>
        <LI>Next message: <A HREF="005977.html">[squid-dev] [PATCH] cleanup cppunit detection and use
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5974">[ date ]</a>
              <a href="thread.html#5974">[ thread ]</a>
              <a href="subject.html#5974">[ subject ]</a>
              <a href="author.html#5974">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The cppunit-config tool has apparently been replaced by pkg-config .pc
file years ago and is now in the process of being removed from some OS.
Notably Fedora.

Which means our present way of detecting it for use by &quot;make check&quot; will
increasingly fail.

This converts configure.ac to using the pkg-config method of detection
and updates the --with-cppunit-basedir parameter to --without-cppunit
matching our naming and usage scheme for other similar options. If a
=PATH is explicitly provided cppunit is assumed to exist at that
location without configure-time checking.


Alex: can you test that at least a bootstrap and &quot;make check&quot; cycle run
properly with this patch applied on your old system which has been
having issues recently with ./configure.

Thanks
Amos

-------------- next part --------------
=== modified file 'Makefile.am'
--- Makefile.am	2016-01-30 09:09:25 +0000
+++ Makefile.am	2016-06-11 06:28:51 +0000
@@ -48,7 +48,7 @@
 check: have-cppunit check-recursive
 
 have-cppunit:
-	@if test &quot;$(SQUID_CPPUNIT_INC)$(SQUID_CPPUNIT_LA)$(SQUID_CPPUNIT_LIBS)&quot; = &quot;&quot; ; then \
+	@if test &quot;$(LIBCPPUNIT_CFLAGS)$(LIBCPPUNIT_LIBS)&quot; = &quot;&quot; ; then \
 		echo &quot;FATAL: 'make check' requires cppunit and cppunit development packages. They do not appear to be installed.&quot; ; \
 		exit 1 ; \
 	fi

=== modified file 'compat/Makefile.am'
--- compat/Makefile.am	2016-02-09 08:57:33 +0000
+++ compat/Makefile.am	2016-06-11 06:29:18 +0000
@@ -94,7 +94,7 @@
 testPreCompiler_SOURCES= \
 	testPreCompiler.h \
 	testPreCompiler.cc
-testPreCompiler_LDADD= $(SQUID_CPPUNIT_LA) $(SQUID_CPPUNIT_LIBS)
+testPreCompiler_LDADD= $(LIBCPPUNIT_LIBS)
 testPreCompiler_LDFLAGS=
 
 # os/ subdir prevents us using src/TestHeaders.am

=== modified file 'configure.ac'
--- configure.ac	2016-06-11 05:28:18 +0000
+++ configure.ac	2016-06-11 12:20:31 +0000
@@ -115,10 +115,11 @@
 AC_PATH_PROG(CHMOD, chmod, $FALSE)
 AC_PATH_PROG(TR, tr, $FALSE)
 AC_PATH_PROG(RM, rm, $FALSE)
-AC_PATH_PROG(CPPUNITCONFIG, cppunit-config, false)
 dnl Libtool 2.2.6 requires: rm -f
 RM=&quot;$RM -f&quot;
 
+PKG_PROG_PKG_CONFIG
+
 AC_PATH_PROG(PERL, perl, none)
 if test &quot;x$ac_cv_path_PERL&quot; = &quot;xnone&quot;; then
   AC_MSG_FAILURE([Perl is required to compile Squid. Please install Perl and then re-run configure ])
@@ -984,9 +985,6 @@
     ]
 )
 
-dnl Necessary if the first PKG_CHECK_MODULES call is conditional
-PKG_PROG_PKG_CONFIG
-
 dnl Perform configuration consistency checks for eCAP
 if test &quot;x$squid_opt_use_ecap&quot; != &quot;xno&quot;;
 then
@@ -2725,45 +2723,29 @@
                       [Enable support for the X-Accelerator-Vary HTTP header])
 AC_MSG_NOTICE([X-Accelerator-Vary support enabled: $enable_x_accelerator_vary])
 
-
-if $CPPUNITCONFIG --help &gt;/dev/null; then
-  squid_cv_cppunit_version=&quot;`$CPPUNITCONFIG --version`&quot;
-  AC_MSG_NOTICE([using system installed cppunit version $squid_cv_cppunit_version])
-  unset squid_cv_cppunit_version
-  SQUID_CPPUNIT_LIBS=&quot;`$CPPUNITCONFIG --libs`&quot;
-  SQUID_CPPUNIT_LA=''
-  SQUID_CPPUNIT_INC=&quot;`$CPPUNITCONFIG --cflags`&quot;
-else
-  AC_MSG_WARN([cppunit does not appear to be installed. squid does not require this, but code testing with 'make check' will fail.])
-  SQUID_CPPUNIT_LA='' 
-  SQUID_CPPUNIT_LIBS=''
-  SQUID_CPPUNIT_INC=''
-fi
-
-AC_ARG_WITH(cppunit-basedir,
-  AS_HELP_STRING([--with-cppunit-basedir=PATH],
-              [Path where the cppunit headers are libraries can be found ]), [
-if test -f &quot;$withval/include/cppunit/TestCase.h&quot;; then
-  AC_MSG_NOTICE([Using cppunit includes from $withval])
-  SQUID_CPPUNIT_INC=&quot;-I${withval}/include&quot;
-else
-  AC_MSG_ERROR(Cannot find cppunit at $withval)
-fi
-if test -f &quot;$withval/lib/libcppunit.la&quot;; then
-  AC_MSG_NOTICE([Using cppunit lib from $withval])
-  SQUID_CPPUNIT_LA=&quot;${withval}/lib/libcppunit.la&quot;
-  SQUID_CPPUNIT_LIBS='$(SQUID_CPPUNIT_LA)'
-else
-  AC_MSG_ERROR(Cannot find cppunit at $withval)
-fi
-])
-SQUID_STATE_SAVE(squid_cppunit_state)
-CXXFLAGS=&quot;$CXXFLAGS $SQUID_CPPUNIT_INC&quot;
-AC_CHECK_HEADERS(cppunit/extensions/HelperMacros.h)
-SQUID_STATE_ROLLBACK(squid_cppunit_state)
-AC_SUBST(SQUID_CPPUNIT_LIBS)
-AC_SUBST(SQUID_CPPUNIT_LA)
-AC_SUBST(SQUID_CPPUNIT_INC)
+AC_ARG_WITH([cppunit], AS_HELP_STRING([--without-cppunit],[Do not use cppunit test framework]),[
+  AS_CASE($with_cppunit, [yes|no],[],
+   [
+    AS_IF([test ! -d &quot;$withval&quot;],AC_MSG_ERROR([--with-cppunit PATH does not point to a directory]))
+    LIBCPPUNIT_CFLAGS=&quot;-I$with_cppunit/include&quot;
+    LIBCPPUNIT_LIBS=&quot;-L$with_cppunit/lib -lcppunit&quot;
+  ])
+])
+AS_IF([test &quot;x$with_cppunit&quot; != &quot;xno&quot;],[
+  PKG_CHECK_MODULES([LIBCPPUNIT],[cppunit],[
+    squid_cv_cppunit_version=&quot;`pkg-config cppunit --version`&quot;
+    AC_MSG_NOTICE([using system installed cppunit version $squid_cv_cppunit_version])
+    AS_UNSET(squid_cv_cppunit_version)
+
+    SQUID_STATE_SAVE(squid_cppunit_state)
+    AS_VAR_APPEND(CXXFLAGS,[$LIBCPPUNIT_CFLAGS])
+    AS_VAR_APPEND(LIBS,[$LIBCPPUNIT_LIBS])
+    AC_CHECK_HEADERS(cppunit/extensions/HelperMacros.h)
+    SQUID_STATE_ROLLBACK(squid_cppunit_state)
+  ],[
+    AC_MSG_WARN([cppunit does not appear to be installed. Squid does not require this, but code testing with 'make check' will fail.])
+  ])
+])
 
 # Force some compilers to use ANSI features
 #

=== modified file 'doc/release-notes/release-4.sgml'
--- doc/release-notes/release-4.sgml	2016-06-09 20:31:15 +0000
+++ doc/release-notes/release-4.sgml	2016-06-11 07:59:55 +0000
@@ -407,6 +407,10 @@
 	   certificate checks is provided for testing and as an example
 	   for writing custom helpers.
 
+	&lt;tag&gt;--without-cppunit&lt;/tag&gt;
+	&lt;p&gt;The cppunit testing framework is auto-detected and used when available.
+	   This option can be used to disable it explicitly.
+
 &lt;/descrip&gt;
 
 &lt;sect1&gt;Changes to existing options&lt;label id=&quot;modifiedoptions&quot;&gt;
@@ -434,6 +438,9 @@
 &lt;sect1&gt;Removed options&lt;label id=&quot;removedoptions&quot;&gt;
 &lt;p&gt;
 &lt;descrip&gt;
+	&lt;tag&gt;--with-cppunit-basedir&lt;/tag&gt;
+	&lt;p&gt;Replaced by &lt;em&gt;--with-cppunit=PATH&lt;/em&gt;.
+	   Please prefer the default auto-detection though.
 
 &lt;/descrip&gt;
 

=== modified file 'lib/Makefile.am'
--- lib/Makefile.am	2016-05-31 22:47:03 +0000
+++ lib/Makefile.am	2016-06-11 06:30:08 +0000
@@ -88,9 +88,9 @@
 	tests/testRFC1738.cc
 
 tests_testRFC1738_LDADD= \
-	$(SQUID_CPPUNIT_LA) $(SQUID_CPPUNIT_LIBS) \
 	$(top_builddir)/lib/libmiscencoding.la \
 	$(top_builddir)/lib/libmiscutil.la \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB)
 
 tests_testRFC1738_LDFLAGS = $(LIBADD_DL)

=== modified file 'src/Common.am'
--- src/Common.am	2016-03-18 09:38:10 +0000
+++ src/Common.am	2016-06-11 06:28:04 +0000
@@ -47,7 +47,7 @@
 	-I$(top_srcdir)/lib \
 	-I$(top_srcdir)/src \
 	-I$(top_builddir)/include \
-	$(SQUID_CPPUNIT_INC)
+	$(LIBCPPUNIT_CFLAGS)
 
 ## Kerberos headers require their include path.
 ## Because we use libcompat for comm_err.h header protections ...

=== modified file 'src/Makefile.am'
--- src/Makefile.am	2016-05-31 22:47:03 +0000
+++ src/Makefile.am	2016-06-11 06:29:37 +0000
@@ -914,9 +914,9 @@
 #	$(TESTSOURCES)
 #tests_testX_LDFLAGS = $(LIBADD_DL)
 #tests_testX_LDADD=\
-#	$(SQUID_CPPUNIT_LIBS) \
-#	$(SQUID_CPPUNIT_LA) \
-#	$(COMPAT_LIB) 
+#	$(LIBCPPUNIT_LIBS) \
+#	$(COMPAT_LIB) \
+#	$(XTRA_LIBS)
 
 # - add other component .(h|cc) files needed to link and run tests
 tests_testHttpReply_SOURCES=\
@@ -1017,10 +1017,9 @@
 	$(top_builddir)/lib/libmisccontainers.la \
 	$(top_builddir)/lib/libmiscencoding.la \
 	$(top_builddir)/lib/libmiscutil.la \
-	$(SQUID_CPPUNIT_LIBS) \
-	$(SQUID_CPPUNIT_LA) \
 	$(NETTLELIB) \
 	$(SSLLIB) \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB) \
 	$(XTRA_LIBS)
 
@@ -1150,8 +1149,8 @@
 	$(top_builddir)/lib/libmiscutil.la \
 	$(NETTLELIB) \
 	$(REGEXLIB) \
-	$(SQUID_CPPUNIT_LIBS) \
 	$(SSLLIB) \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB) \
 	$(XTRA_LIBS)
 tests_testACLMaxUserIP_LDFLAGS = $(LIBADD_DL)
@@ -1169,10 +1168,9 @@
 	tests/stub_MemBuf.cc \
 	$(TESTSOURCES)
 tests_testBoilerplate_LDADD= \
-	$(SQUID_CPPUNIT_LIBS) \
-	$(SQUID_CPPUNIT_LA) \
 	$(SSLLIB) \
 	base/libbase.la \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB) \
 	$(XTRA_LIBS)
 tests_testBoilerplate_LDFLAGS = $(LIBADD_DL)
@@ -1191,9 +1189,8 @@
 tests_testCharacterSet_LDFLAGS = $(LIBADD_DL)
 tests_testCharacterSet_LDADD= \
 	base/libbase.la \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB) \
-	$(SQUID_CPPUNIT_LA) \
-	$(SQUID_CPPUNIT_LIBS) \
 	$(XTRA_LIBS)
 
 ## Tests of the CacheManager module.
@@ -1428,10 +1425,9 @@
 	$(top_builddir)/lib/libmiscutil.la \
 	$(NETTLELIB) \
 	$(REGEXLIB) \
-	$(SQUID_CPPUNIT_LIBS) \
-	$(SQUID_CPPUNIT_LA) \
 	$(SSLLIB) \
 	$(KRB5LIBS) \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB) \
 	$(XTRA_LIBS)
 tests_testCacheManager_LDFLAGS = $(LIBADD_DL)
@@ -1601,15 +1597,14 @@
 	$(top_builddir)/lib/libmiscutil.la \
 	$(NETTLELIB) \
 	$(REGEXLIB) \
-	$(SQUID_CPPUNIT_LIBS) \
 	$(SSLLIB) \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB) \
 	$(XTRA_LIBS)
 tests_testDiskIO_LDFLAGS = $(LIBADD_DL)
 tests_testDiskIO_DEPENDENCIES = \
 	DiskIO/libdiskio.la \
-	$(SWAP_TEST_DS) \
-	$(SQUID_CPPUNIT_LA)
+	$(SWAP_TEST_DS)
 
 tests_testDns_SOURCES= \
 	tests/testRFC1035.cc \
@@ -1623,10 +1618,9 @@
 	dns/libdns.la \
 	base/libbase.la \
 	$(top_builddir)/lib/libmiscutil.la \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB) \
-	$(XTRA_LIBS) \
-	$(SQUID_CPPUNIT_LA) \
-	$(SQUID_CPPUNIT_LIBS)
+	$(XTRA_LIBS)
 tests_testDns_LDFLAGS= $(LIBADD_DL)
 
 tests_testEvent_SOURCES = \
@@ -1860,10 +1854,9 @@
 	$(SNMP_LIBS) \
 	$(NETTLELIB) \
 	$(REGEXLIB) \
-	$(SQUID_CPPUNIT_LIBS) \
-	$(SQUID_CPPUNIT_LA) \
 	$(SSLLIB) \
 	$(KRB5LIBS) \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB) \
 	$(XTRA_LIBS)
 tests_testEvent_LDFLAGS = $(LIBADD_DL)
@@ -2099,10 +2092,9 @@
 	$(SNMP_LIBS) \
 	$(NETTLELIB) \
 	$(REGEXLIB) \
-	$(SQUID_CPPUNIT_LIBS) \
-	$(SQUID_CPPUNIT_LA) \
 	$(SSLLIB) \
 	$(KRB5LIBS) \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB) \
 	$(XTRA_LIBS)
 tests_testEventLoop_LDFLAGS = $(LIBADD_DL)
@@ -2334,10 +2326,9 @@
 	$(top_builddir)/lib/libmiscutil.la \
 	$(NETTLELIB) \
 	$(REGEXLIB) \
-	$(SQUID_CPPUNIT_LIBS) \
-	$(SQUID_CPPUNIT_LA) \
 	$(SSLLIB) \
 	$(KRB5LIBS) \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB) \
 	$(XTRA_LIBS)
 tests_test_http_range_LDFLAGS = $(LIBADD_DL)
@@ -2361,9 +2352,8 @@
 	base/libbase.la \
 	sbuf/libsbuf.la \
 	$(top_builddir)/lib/libmiscutil.la \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB) \
-	$(SQUID_CPPUNIT_LA) \
-	$(SQUID_CPPUNIT_LIBS) \
 	$(XTRA_LIBS)
 
 tests_testHttp1Parser_SOURCES = \
@@ -2406,9 +2396,8 @@
 	ip/libip.la \
 	sbuf/libsbuf.la \
 	$(top_builddir)/lib/libmiscutil.la \
-	$(SQUID_CPPUNIT_LIBS) \
-	$(SQUID_CPPUNIT_LA) \
 	$(SSLLIB) \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB) \
 	$(XTRA_LIBS)
 tests_testHttp1Parser_LDFLAGS = $(LIBADD_DL)
@@ -2643,10 +2632,9 @@
 	$(top_builddir)/lib/libmiscutil.la \
 	$(NETTLELIB) \
 	$(REGEXLIB) \
-	$(SQUID_CPPUNIT_LIBS) \
-	$(SQUID_CPPUNIT_LA) \
 	$(SSLLIB) \
 	$(KRB5LIBS) \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB) \
 	$(XTRA_LIBS)
 tests_testHttpRequest_LDFLAGS = $(LIBADD_DL)
@@ -2668,9 +2656,8 @@
 	icmp/libicmpcore.la \
 	ip/libip.la \
 	base/libbase.la \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB) \
-	$(SQUID_CPPUNIT_LA) \
-	$(SQUID_CPPUNIT_LIBS) \
 	$(XTRA_LIBS)
 
 ## Tests for ip/* objects
@@ -2685,9 +2672,8 @@
 tests_testIpAddress_LDADD= \
 	ip/libip.la \
 	base/libbase.la \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB) \
-	$(SQUID_CPPUNIT_LA) \
-	$(SQUID_CPPUNIT_LIBS) \
 	$(XTRA_LIBS)
 tests_testIpAddress_LDFLAGS= $(LIBADD_DL)
 
@@ -2850,10 +2836,9 @@
 	$(top_builddir)/lib/libmiscutil.la \
 	$(NETTLELIB) \
 	$(REGEXLIB) \
-	$(SQUID_CPPUNIT_LIBS) \
-	$(SQUID_CPPUNIT_LA) \
 	$(SSLLIB) \
 	CommCalls.o \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB) \
 	$(XTRA_LIBS)
 tests_testStore_LDFLAGS = $(LIBADD_DL)
@@ -2889,9 +2874,8 @@
 	sbuf/libsbuf.la \
 	$(top_builddir)/lib/libmiscutil.la \
 	$(REGEXLIB) \
-	$(SQUID_CPPUNIT_LIBS) \
-	$(SQUID_CPPUNIT_LA) \
 	$(SSLLIB) \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB) \
 	$(XTRA_LIBS)
 tests_testString_LDFLAGS = $(LIBADD_DL)
@@ -2909,8 +2893,7 @@
 	DiskIO/libdiskio.la \
 	ipc/libipc.la \
 	mgr/libmgr.la \
-	$(REPL_OBJS) \
-	$(SQUID_CPPUNIT_LA)
+	$(REPL_OBJS)
 
 tests_testUfs_SOURCES = \
 	tests/testUfs.cc \
@@ -3076,8 +3059,8 @@
 	$(top_builddir)/lib/libmiscutil.la \
 	$(NETTLELIB) \
 	$(REGEXLIB) \
-	$(SQUID_CPPUNIT_LIBS) \
 	$(SSLLIB) \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB) \
 	$(XTRA_LIBS)
 tests_testUfs_LDFLAGS = $(LIBADD_DL)
@@ -3249,8 +3232,8 @@
 	$(top_builddir)/lib/libmiscutil.la \
 	$(NETTLELIB) \
 	$(REGEXLIB) \
-	$(SQUID_CPPUNIT_LIBS) \
 	$(SSLLIB) \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB) \
 	$(XTRA_LIBS)
 tests_testRock_LDFLAGS = $(AM_CPPFLAGS) $(LIBADD_DL)
@@ -3490,11 +3473,9 @@
 	$(top_builddir)/lib/libmiscencoding.la \
 	$(top_builddir)/lib/libmiscutil.la \
 	$(NETTLELIB) \
-	$(COMPAT_LIB) \
-	$(SQUID_CPPUNIT_LIBS) \
-	$(SQUID_CPPUNIT_LA) \
 	$(SSLLIB) \
 	$(KRB5LIBS) \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB) \
 	$(XTRA_LIBS)
 tests_testURL_LDFLAGS = $(LIBADD_DL)
@@ -3514,10 +3495,9 @@
 tests_testSBuf_LDADD= \
 	sbuf/libsbuf.la \
 	base/libbase.la \
-	$(SQUID_CPPUNIT_LIBS) \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB) \
-	$(XTRA_LIBS) \
-	$(SQUID_CPPUNIT_LA)
+	$(XTRA_LIBS)
 
 tests_testSBufList_SOURCES= \
 	tests/testSBufList.h \
@@ -3532,10 +3512,9 @@
 tests_testSBufList_LDADD=\
 	sbuf/libsbuf.la \
 	base/libbase.la \
-	$(SQUID_CPPUNIT_LIBS) \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB) \
-	$(XTRA_LIBS) \
-	$(SQUID_CPPUNIT_LA)
+	$(XTRA_LIBS)
 
 tests_testConfigParser_SOURCES = \
 	ClientInfo.h \
@@ -3567,13 +3546,12 @@
 	base/libbase.la \
 	$(top_builddir)/lib/libmiscutil.la \
 	$(REGEXLIB) \
-	$(SQUID_CPPUNIT_LIBS) \
-	$(SQUID_CPPUNIT_LA) \
 	$(SSLLIB) \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB) \
 	$(XTRA_LIBS)
 tests_testConfigParser_LDFLAGS = $(LIBADD_DL)
-	
+
 tests_testStatHist_SOURCES = \
 	tests/stub_cbdata.cc \
 	fatal.h \
@@ -3610,8 +3588,7 @@
 	base/libbase.la \
 	$(top_builddir)/lib/libmiscutil.la \
 	$(top_builddir)/lib/libmisccontainers.la \
-	$(SQUID_CPPUNIT_LIBS) \
-	$(SQUID_CPPUNIT_LA) \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB)
 
 tests_testLookupTable_SOURCES = \
@@ -3626,10 +3603,9 @@
 tests_testLookupTable_LDADD = \
 	sbuf/libsbuf.la \
 	base/libbase.la \
-	$(SQUID_CPPUNIT_LIBS) \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB) \
-	$(XTRA_LIBS) \
-	$(SQUID_CPPUNIT_LA)
+	$(XTRA_LIBS)
 
 tests_testEnumIterator_SOURCES = \
 	base/EnumIterator.h \
@@ -3642,9 +3618,8 @@
 tests_testEnumIterator_LDFLAGS = $(LIBADD_DL)
 tests_testEnumIterator_LDADD = \
 	base/libbase.la \
-	$(SQUID_CPPUNIT_LIBS) \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB) \
-	$(SQUID_CPPUNIT_LA) \
 	$(XTRA_LIBS)
 
 tests_testYesNoNone_SOURCES = \
@@ -3657,7 +3632,7 @@
 	base/YesNoNone.h
 tests_testYesNoNone_LDADD= \
 	base/libbase.la \
-	$(SQUID_CPPUNIT_LIBS) \
+	$(LIBCPPUNIT_LIBS) \
 	$(COMPAT_LIB) \
 	$(XTRA_LIBS)
 tests_testYesNoNone_LDFLAGS = $(LIBADD_DL)

=== modified file 'test-suite/buildtests/layer-01-minimal.opts'
--- test-suite/buildtests/layer-01-minimal.opts	2016-03-19 12:52:42 +0000
+++ test-suite/buildtests/layer-01-minimal.opts	2016-06-11 06:31:41 +0000
@@ -28,7 +28,6 @@
 #   --without-default-user \
 #   --without-aufs-threads \
 #   --without-filedescriptors \
-#   --without-cppunit-basedir \
 #   --without-build-environment \
 #
 #

=== modified file 'test-suite/buildtests/layer-02-maximus.opts'
--- test-suite/buildtests/layer-02-maximus.opts	2016-03-20 11:49:15 +0000
+++ test-suite/buildtests/layer-02-maximus.opts	2016-06-11 06:31:47 +0000
@@ -30,7 +30,6 @@
 #   --with-default-user=NAME \
 #   --with-aufs-threads=N \
 #   --with-filedescriptors=N \
-#   --with-cppunit-basedir=PATH \
 #   --with-po2html=PATH \
 #   --with-tags=TAGS \
 #

=== modified file 'test-suite/buildtests/layer-04-noauth-everything.opts'
--- test-suite/buildtests/layer-04-noauth-everything.opts	2016-01-01 00:12:18 +0000
+++ test-suite/buildtests/layer-04-noauth-everything.opts	2016-06-11 06:31:28 +0000
@@ -30,7 +30,6 @@
 #   --with-default-user=NAME \
 #   --with-aufs-threads=N \
 #   --with-filedescriptors=N \
-#   --with-cppunit-basedir=PATH \
 #   --with-openssl=PATH \
 #   --with-po2html=PATH \
 #   --with-tags=TAGS \

=== modified file 'test-suite/buildtests/os-debian.opts'
--- test-suite/buildtests/os-debian.opts	2016-01-01 00:12:18 +0000
+++ test-suite/buildtests/os-debian.opts	2016-06-11 06:31:20 +0000
@@ -31,7 +31,6 @@
 	--datadir=/usr/share/squid3 \
 	--sysconfdir=/etc/squid3 \
 	--mandir=/usr/share/man \
-	--with-cppunit-basedir=/usr \
 	--with-default-user=proxy \
  \
 	--disable-maintainer-mode \

=== modified file 'test-suite/buildtests/os-ubuntu.opts'
--- test-suite/buildtests/os-ubuntu.opts	2016-01-01 00:12:18 +0000
+++ test-suite/buildtests/os-ubuntu.opts	2016-06-11 06:31:16 +0000
@@ -30,7 +30,6 @@
 	--datadir=/usr/share/squid3 \
 	--sysconfdir=/etc/squid3 \
 	--mandir=/usr/share/man \
-	--with-cppunit-basedir=/usr \
 	--with-default-user=proxy \
  \
 	--disable-maintainer-mode \

</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005972.html">[squid-dev] r14701 broke ./configure --enable-ecap
</A></li>
	<LI>Next message: <A HREF="005977.html">[squid-dev] [PATCH] cleanup cppunit detection and use
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5974">[ date ]</a>
              <a href="thread.html#5974">[ thread ]</a>
              <a href="subject.html#5974">[ subject ]</a>
              <a href="author.html#5974">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
