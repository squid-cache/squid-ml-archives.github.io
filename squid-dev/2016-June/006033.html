<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] avoid flooding cache.log with &quot;uninitialized value&quot; messages from ext_wbinfo_group_acl helper script
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20avoid%20flooding%20cache.log%20with%0A%20%22uninitialized%20value%22%20messages%20from%20ext_wbinfo_group_acl%20helper%20script&In-Reply-To=%3C630913501.129459.1466668910567.JavaMail.yahoo%40mail.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="006026.html">
   <LINK REL="Next"  HREF="006034.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] avoid flooding cache.log with &quot;uninitialized value&quot; messages from ext_wbinfo_group_acl helper script</H1>
    <B>Vieri</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20avoid%20flooding%20cache.log%20with%0A%20%22uninitialized%20value%22%20messages%20from%20ext_wbinfo_group_acl%20helper%20script&In-Reply-To=%3C630913501.129459.1466668910567.JavaMail.yahoo%40mail.yahoo.com%3E"
       TITLE="[squid-dev] [PATCH] avoid flooding cache.log with &quot;uninitialized value&quot; messages from ext_wbinfo_group_acl helper script">rentorbuy at yahoo.com
       </A><BR>
    <I>Thu Jun 23 08:01:50 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="006026.html">[squid-dev] [PATCH] avoid flooding cache.log with &quot;uninitialized value&quot; messages from ext_wbinfo_group_acl helper script
</A></li>
        <LI>Next message: <A HREF="006034.html">[squid-dev] [PATCH] avoid flooding cache.log with &quot;uninitialized value&quot; messages from ext_wbinfo_group_acl helper script
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6033">[ date ]</a>
              <a href="thread.html#6033">[ thread ]</a>
              <a href="subject.html#6033">[ subject ]</a>
              <a href="author.html#6033">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

&gt;&gt;<i> On 22/06/2016 7:22 p.m., Vieri wrote:
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> With default debug_options too many &quot;uninitialized value&quot; messages in /var/log/squid/cache.log;
</I>&gt;&gt;<i> Use of uninitialized value $ans in concatenation (.) or string at /usr/libexec/squid/ext_wbinfo_group_acl line 204, &lt;STDIN&gt; &gt;&gt; line 44.
</I>&gt;&gt;<i> Use of uninitialized value $ans in concatenation (.) or string at /usr/libexec/squid/ext_wbinfo_group_acl line 205, &lt;STDIN&gt; &gt;&gt; line 44.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Minor issue fixed with this patch.&gt;
</I>&gt;<i> Thank you.
</I>&gt;<i>
</I>
&gt;<i> I was just double-checking this before applying and it looks to me like $ans should never be unset in a properly configured 
</I>
&gt;<i> group helper.&gt;
</I>&gt;<i> What does your squid.conf contain for this helper? (both the external_acl_type and the &quot;acl ... external&quot; lines using it
</I>
&gt;<i> please)&gt;
</I>&gt;<i> And what does the debug output the helper injects into the log along with those perl warnings look like?
</I>&gt;<i> (should be something like &quot;Sending ... to Squid&quot;.)
</I>&gt;<i>
</I>
&gt;<i> I'm asking because an empty line &quot;\n&quot; is not a valid response from an external ACL helper. What the $ans needs to be 
</I>
&gt;<i> initialized to depends on whether it is a misconfiguration or something else resulting in the perl warning.
</I>&gt;<i>
</I>&gt;<i> PS. sorry for not noticing this earlier when you wrote to squid-users.
</I>

Hi Amos,

I suspect it could be a misconfiguration too.

# grep external /etc/squid/squid.custom.rules
external_acl_type nt_group ttl=0 children-max=10 %LOGIN /usr/libexec/squid/ext_wbinfo_group_acl
acl allowed_groups external nt_group &quot;/SAMBA/proxy-settings/allowed.groups&quot;
acl restricted_groups external nt_group &quot;/SAMBA/proxy-settings/restricted.groups&quot;

Both files are currently empty (/SAMBA/proxy-settings/*).

I'm getting &quot;Sending to squid&quot; messages in the log.


After populating these files I get these messages:

Sending ERR to squid
Sending OK to squid


My log file is no longer flooded with those &quot;uninitialized variable&quot; perl messages anymore.
Could this be it?
If so, shouldn't it be allowed to have empty files (empty acls)?
If $group (@groups array) is empty then the wbinfo call in the check() function will fail. In fact, if the acl files are empty then the &quot;foreach $group (@groups)&quot; loop is never entered, the check() function is never called and $ans is never set. I know that Squid warns the user at startup if an ACL is empty (it only warns about the firt empty ACL declared in squid.conf, not all of them).

So it's really my fault if I use empty ACLs that Squid warned me about. However, does it hurt to patch the helper script so that $ans is 'ERR' by default, even when using empty ACLs?


PS: No problem at all. I appreciate the hard work the squid team has done during all these years.

Vieri
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ext_wbinfo_group_acl.pl.in.diff
Type: application/octet-stream
Size: 332 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20160623/1abb220c/attachment.obj">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20160623/1abb220c/attachment.obj</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006026.html">[squid-dev] [PATCH] avoid flooding cache.log with &quot;uninitialized value&quot; messages from ext_wbinfo_group_acl helper script
</A></li>
	<LI>Next message: <A HREF="006034.html">[squid-dev] [PATCH] avoid flooding cache.log with &quot;uninitialized value&quot; messages from ext_wbinfo_group_acl helper script
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6033">[ date ]</a>
              <a href="thread.html#6033">[ thread ]</a>
              <a href="subject.html#6033">[ subject ]</a>
              <a href="author.html#6033">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
