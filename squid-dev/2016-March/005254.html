<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] tentative fix for bug 4438
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20tentative%20fix%20for%20bug%204438&In-Reply-To=%3C56DCBC84.3080408%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="005253.html">
   <LINK REL="Next"  HREF="005255.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] tentative fix for bug 4438</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20tentative%20fix%20for%20bug%204438&In-Reply-To=%3C56DCBC84.3080408%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] tentative fix for bug 4438">rousskov at measurement-factory.com
       </A><BR>
    <I>Sun Mar  6 23:25:56 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="005253.html">[squid-dev] [PATCH] tentative fix for bug 4438
</A></li>
        <LI>Next message: <A HREF="005255.html">[squid-dev] [PATCH] risky_server_pconn_reuse option
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5254">[ date ]</a>
              <a href="thread.html#5254">[ thread ]</a>
              <a href="subject.html#5254">[ subject ]</a>
              <a href="author.html#5254">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 03/06/2016 02:15 PM, Kinkie wrote:
&gt;<i> On Sun, Mar 6, 2016 at 9:41 PM, Alex Rousskov wrote:
</I>&gt;&gt;<i> On 03/06/2016 11:16 AM, Kinkie wrote:
</I>&gt;<i> Having the MemBlob pools be static
</I>&gt;<i> members of the MemBlob class will guarantee proper initialization
</I>&gt;<i> before even the first MemBlob is instantiated, won't it?
</I>

AFAIK, no, it will not guarantee that: The location of a static object
inside or outside a class is pretty much irrelevant when it comes to the
initialization order of various globals. The initialization algorithm
does not know which code depends on which code. It just goes through all
non-constant non-local objects and creates them one by one, in
essentially random translation units order(*).

For example, given this class declaration in some header file:

  class MemBlob {
  public:
      static Pool Pool_;
      MemBlob(size_t sz) { buffer = Pool_.allocate(sz); }
      ...
  };


It is possible to use the above MemBlob before Pool_ is created because
the .cc file where MemBlob::Pool_ is defined may be processed after the
.cc file where MemBlob user code lives. Here is an example of such user
code in some other.cc file, defining a non-local global MemBlob:

  // will be created either before or after MemBlob::Pool_
  static MemBlob MyBlob(123);


Whether the above is related to Yuri's bug, I do not know.


HTH,

Alex.
(*) I am not being very precise here. Please consult C++ documents for
the exact details and correct terminology. The same documents will
detail other initialization stages not mentioned above.

</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005253.html">[squid-dev] [PATCH] tentative fix for bug 4438
</A></li>
	<LI>Next message: <A HREF="005255.html">[squid-dev] [PATCH] risky_server_pconn_reuse option
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5254">[ date ]</a>
              <a href="thread.html#5254">[ thread ]</a>
              <a href="subject.html#5254">[ subject ]</a>
              <a href="author.html#5254">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
