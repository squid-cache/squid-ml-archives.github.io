<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] shared_memory_locking
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20shared_memory_locking&In-Reply-To=%3C56E0A041.7070601%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="005294.html">
   <LINK REL="Next"  HREF="005263.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] shared_memory_locking</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20shared_memory_locking&In-Reply-To=%3C56E0A041.7070601%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] shared_memory_locking">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Mar  9 22:14:25 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="005294.html">[squid-dev] [PATCH] risky_server_pconn_reuse option
</A></li>
        <LI>Next message: <A HREF="005263.html">[squid-dev] [PATCH] shared_memory_locking
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5260">[ date ]</a>
              <a href="thread.html#5260">[ thread ]</a>
              <a href="subject.html#5260">[ subject ]</a>
              <a href="author.html#5260">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

    The attached patch adds a &quot;shared_memory_locking&quot; configuration
directive to control mlock(2).

Locking shared memory at startup avoids SIGBUS crashes when kernel runs
out of RAM during runtime. This has been discussed during the &quot;[RFC] Fix
shared memory initialization, cleanup. Ensure its usability.&quot; thread
archived at
<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/2015-December/004112.html">http://lists.squid-cache.org/pipermail/squid-dev/2015-December/004112.html</A>

Why not enable locking by default? Unfortunately, locking requires
privileges and/or much-higher-than-default RLIMIT_MEMLOCK limits. Thus,
requiring locked memory by default is likely to cause too many
complaints, especially since Squid has not required that before. Even
&quot;make check&quot; will not work in most environments (without making our unit
tests even less representative)! Thus, the default is off, at least for now.

As we gain more experience, we may enable locking by default while
making default locking failures non-fatal and warning about significant
[accumulated] locking delays. The proposed code was written to make
those possible future changes easier, but I am not volunteering to
implement them at this time.


Thank you,

Alex.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: shm-lock-t3.patch
Type: text/x-diff
Size: 11516 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20160309/867296a4/attachment.patch">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20160309/867296a4/attachment.patch</A>&gt;
</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005294.html">[squid-dev] [PATCH] risky_server_pconn_reuse option
</A></li>
	<LI>Next message: <A HREF="005263.html">[squid-dev] [PATCH] shared_memory_locking
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5260">[ date ]</a>
              <a href="thread.html#5260">[ thread ]</a>
              <a href="subject.html#5260">[ subject ]</a>
              <a href="author.html#5260">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
