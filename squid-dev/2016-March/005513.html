<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] BUg 4466: removal of -k kill command
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20BUg%204466%3A%20removal%20of%20-k%20kill%20command&In-Reply-To=%3C56FAABC7.9020005%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="005510.html">
   <LINK REL="Next"  HREF="005514.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] BUg 4466: removal of -k kill command</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20BUg%204466%3A%20removal%20of%20-k%20kill%20command&In-Reply-To=%3C56FAABC7.9020005%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] BUg 4466: removal of -k kill command">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Mar 29 16:22:31 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="005510.html">[squid-dev] [PATCH] Do not hide important/critical messages
</A></li>
        <LI>Next message: <A HREF="005514.html">[squid-dev] [PATCH] BUg 4466: removal of -k kill command
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5513">[ date ]</a>
              <a href="thread.html#5513">[ thread ]</a>
              <a href="subject.html#5513">[ subject ]</a>
              <a href="author.html#5513">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The Squid &quot;-k kill&quot; command line option is equivalent to &quot;kill -9&quot; on
whatever process has its PID in the .pid file.

Since Squid gained multi-process SMP support it has been declining in
usefulness, and with recent changes to make thee master process be the
one operating the .pid file this command has effectively become irrelevant.

Since admin have the &quot;kill -9&quot; command available anyway and also have
better understanding of what will happen when using that command I
propose removing &quot;squid -k kill&quot; entirely.

The attached patch implements that.

Amos
-------------- next part --------------
=== modified file 'src/ipc/Kid.cc'
--- src/ipc/Kid.cc	2016-01-01 00:12:18 +0000
+++ src/ipc/Kid.cc	2016-03-29 15:41:46 +0000
@@ -81,7 +81,6 @@
              exitedHappy() ||
              hopeless() ||
              shutting_down ||
-             signaled(SIGKILL) || // squid -k kill
              signaled(SIGINT) || // unexpected forced shutdown
              signaled(SIGTERM)); // unexpected forced shutdown
 }

=== modified file 'src/main.cc'
--- src/main.cc	2016-03-03 00:49:45 +0000
+++ src/main.cc	2016-03-29 15:30:47 +0000
@@ -367,7 +367,7 @@
 #ifdef SIGTTIN
             &quot;restart|&quot;
 #endif
-            &quot;interrupt|kill|debug|check|parse\n&quot;
+            &quot;interrupt|debug|check|parse\n&quot;
             &quot;                 Parse configuration file, then send signal to \n&quot;
             &quot;                 running copy (except -k parse) and exit.\n&quot;
             &quot;       -n name   Specify service name to use for service operations\n&quot;
@@ -549,10 +549,6 @@
             else if (!strncmp(optarg, &quot;interrupt&quot;, strlen(optarg)))
                 /** \li On interrupt send SIGINT. */
                 opt_send_signal = SIGINT;
-            else if (!strncmp(optarg, &quot;kill&quot;, strlen(optarg)))
-                /** \li On kill send SIGKILL. */
-                opt_send_signal = SIGKILL;
-
 #ifdef SIGTTIN
 
             else if (!strncmp(optarg, &quot;restart&quot;, strlen(optarg)))

=== modified file 'src/squid.8.in'
--- src/squid.8.in	2016-02-24 23:55:48 +0000
+++ src/squid.8.in	2016-03-29 15:34:52 +0000
@@ -97,7 +97,7 @@
 option).
 .
 .if !'po4a'hide' .TP
-.if !'po4a'hide' .B &quot;\-k reconfigure | rotate | shutdown | interrupt | kill | debug | check | parse&quot;
+.if !'po4a'hide' .B &quot;\-k reconfigure | rotate | shutdown | interrupt | debug | check | parse&quot;
 Parse configuration file, then send signal to running copy 
 (except
 .B &quot;\-k parse&quot;

=== modified file 'tools/sysvinit/squid.rc'
--- tools/sysvinit/squid.rc	2016-01-01 00:12:18 +0000
+++ tools/sysvinit/squid.rc	2016-03-29 16:06:45 +0000
@@ -95,20 +95,20 @@
     fi
     ;;
 
-stop)
+stop|shutdown)
     config || exit 2  # Squid not enabled
 
     squid ${SQUID_OPTIONS-} -k shutdown || exit 1
     ;;
 
-reconf*|rotate|int*|debug|check|kill)
+reconf*|rotate|int*|debug|check)
     config
 
     squid ${SQUID_OPTIONS-} -k &quot;$1&quot;
     ;;
 
 *)
-    echo &quot;usage: $0 {start|stop|reconfigure|rotate|interrupt|debug|check|kill}&quot; &gt;&amp;2
+    echo &quot;usage: $0 {start|stop|reconfigure|rotate|interrupt|debug|check}&quot; &gt;&amp;2
     echo &quot;    start        start squid&quot; &gt;&amp;2
     echo &quot;    stop         clean shutdown&quot; &gt;&amp;2
     echo &quot;    reconfigure  reread configuration files&quot; &gt;&amp;2
@@ -116,7 +116,6 @@
     echo &quot;    interrupt    quick clean shutdown &quot; &gt;&amp;2
     echo &quot;    debug        toggle debug logging&quot; &gt;&amp;2
     echo &quot;    check        check for running squid&quot; &gt;&amp;2
-    echo &quot;    kill         terminate squid by brute force&quot; &gt;&amp;2
 
     exit 1
     ;;

</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005510.html">[squid-dev] [PATCH] Do not hide important/critical messages
</A></li>
	<LI>Next message: <A HREF="005514.html">[squid-dev] [PATCH] BUg 4466: removal of -k kill command
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5513">[ date ]</a>
              <a href="thread.html#5513">[ thread ]</a>
              <a href="subject.html#5513">[ subject ]</a>
              <a href="author.html#5513">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
