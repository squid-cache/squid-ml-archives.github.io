<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Increase request buffer size to 64kb
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Increase%20request%20buffer%20size%20to%2064kb&In-Reply-To=%3CCAGUJm7aMQbjmkYDvxtpv6V98F8Zqp_0-WB-U7MPe%2BYspTKmxWA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="005520.html">
   <LINK REL="Next"  HREF="005522.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Increase request buffer size to 64kb</H1>
    <B>Nathan Hoad</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Increase%20request%20buffer%20size%20to%2064kb&In-Reply-To=%3CCAGUJm7aMQbjmkYDvxtpv6V98F8Zqp_0-WB-U7MPe%2BYspTKmxWA%40mail.gmail.com%3E"
       TITLE="[squid-dev] [PATCH] Increase request buffer size to 64kb">nathan at getoffmalawn.com
       </A><BR>
    <I>Wed Mar 30 04:39:21 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="005520.html">[squid-dev] [PATCH] Increase request buffer size to 64kb
</A></li>
        <LI>Next message: <A HREF="005522.html">[squid-dev] [PATCH] Increase request buffer size to 64kb
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5521">[ date ]</a>
              <a href="thread.html#5521">[ thread ]</a>
              <a href="subject.html#5521">[ subject ]</a>
              <a href="author.html#5521">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 30 March 2016 at 12:11, Alex Rousskov
&lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">rousskov at measurement-factory.com</A>&gt; wrote:
&gt;<i> On 03/29/2016 06:06 PM, Nathan Hoad wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> This (very small) patch increases the request buffer size to 64kb, from 4kb.
</I>&gt;<i>
</I>&gt;&gt;<i> -#define HTTP_REQBUF_SZ  4096
</I>&gt;&gt;<i> +#define HTTP_REQBUF_SZ  65535
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> In my testing, this increases throughput rather dramatically for
</I>&gt;&gt;<i> downloading large files:
</I>&gt;<i>
</I>&gt;<i> Based on your results alone, it is clear that the patch does more than
</I>&gt;<i> &quot;increases the request buffer size&quot;(*). IMO, the important initial
</I>&gt;<i> questions we need to answer are:
</I>&gt;<i>
</I>&gt;<i>   1. Why the performance is improved in this micro test?
</I>&gt;<i>   2. What are the expected effects on other traffic?
</I>
I think these are reasonable questions to ask. Answering question one
will take time - I'll have to go through the uses of the constant and
modify them individually, to expose the specific code that has
benefited from this change.

I'm not sure how I can answer question two definitively - are there
any accepted benchmarking/test suites I can use to test the change on
different types of traffic, to see if particular situations have been
negatively affected?

&gt;<i>
</I>&gt;<i> Increasing a buffer sizes will naturally improve performance on a
</I>&gt;<i> micro-test that targets that buffer(*), but we should know more before
</I>&gt;<i> deciding whether this increase is _generally_ useful and whether there
</I>&gt;<i> is a better way to achieve similar (or better) performance results.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Please note that this message is not meant to disparage your email or
</I>&gt;<i> even the proposed change itself! I am just trying to explain what
</I>&gt;<i> additional information is needed in order to start making an _informed_
</I>&gt;<i> decision about the proposed change. Needless to say, many changes have
</I>&gt;<i> been committed without proper disclosures and analysis, but we should
</I>&gt;<i> strive to do better.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thank you,
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i> P.S. (*) The changed constant _name_ has nothing to do with the micro
</I>&gt;<i> test: download vs. &quot;request buffer size&quot;. IIRC, the constant itself is
</I>&gt;<i> misnamed/misused, but that tidbit may be just the tip of the iceberg.
</I>
Yes I think you are right in that the constant may be
misnamed/misused. Once I've gone through all the places that use it, I
suppose reevaluating its name would be a good idea.

Thank you,

Nathan.
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005520.html">[squid-dev] [PATCH] Increase request buffer size to 64kb
</A></li>
	<LI>Next message: <A HREF="005522.html">[squid-dev] [PATCH] Increase request buffer size to 64kb
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5521">[ date ]</a>
              <a href="thread.html#5521">[ thread ]</a>
              <a href="subject.html#5521">[ subject ]</a>
              <a href="author.html#5521">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
