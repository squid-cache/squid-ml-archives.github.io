<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Retry cache peer DNS failures more	frequently
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Retry%20cache%20peer%20DNS%20failures%20more%0A%09frequently&In-Reply-To=%3C70e613e8-2d9c-bc63-8baf-28abc8e08e92%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="005644.html">
   <LINK REL="Next"  HREF="005647.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Retry cache peer DNS failures more	frequently</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Retry%20cache%20peer%20DNS%20failures%20more%0A%09frequently&In-Reply-To=%3C70e613e8-2d9c-bc63-8baf-28abc8e08e92%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] Retry cache peer DNS failures more	frequently">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue May 10 07:50:32 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="005644.html">[squid-dev] [PATCH] Retry cache peer DNS failures more frequently
</A></li>
        <LI>Next message: <A HREF="005647.html">[squid-dev] [PATCH] Retry cache peer DNS failures more	frequently
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5645">[ date ]</a>
              <a href="thread.html#5645">[ thread ]</a>
              <a href="subject.html#5645">[ subject ]</a>
              <a href="author.html#5645">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/05/2016 2:41 p.m., Nathan Hoad wrote:
&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> Attached is a patch which makes Squid attempt to resolve failed DNS lookups
</I>&gt;<i> for cache peers more frequently than an hour. It's user configurable, with
</I>&gt;<i> a default of one minute.
</I>&gt;<i> 
</I>
IMO the proper fix for this behaviour is to deliver the actual DNS TTL
values via DnsLookupDetails. The ipcache should be able to supply that.
Then each peer gets its own re-lookup event scheduled for happening only
when the DNS records for that peer are expected to need it.


In the event that an actual lookup failure happens then negative_dns_ttl
limit should be used instead of the hard-coded hour. That is 60 seconds
and may be much lower if admin wants fast recovery.



&gt;<i> As the patch preamble states, this is necessary for setups where all
</I>&gt;<i> traffic is forwarded to a cache peer, as a failed DNS lookup will result in
</I>&gt;<i> users being unable to access the web until it is resolved successfully.
</I>&gt;<i> 
</I>&gt;<i> I'm not convinced the configuration option (cache_peer_negative_dns_ttl) is
</I>&gt;<i> the best name, so I'm happy to take suggestions here.
</I>&gt;<i> 
</I>
Options specific for controling cache_peer activity should be on the
cache_peer directive. With global directives like negative_dns_ttl used
for setting the default value in their absence from squid.conf.

Amos

</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005644.html">[squid-dev] [PATCH] Retry cache peer DNS failures more frequently
</A></li>
	<LI>Next message: <A HREF="005647.html">[squid-dev] [PATCH] Retry cache peer DNS failures more	frequently
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5645">[ date ]</a>
              <a href="thread.html#5645">[ thread ]</a>
              <a href="subject.html#5645">[ subject ]</a>
              <a href="author.html#5645">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
