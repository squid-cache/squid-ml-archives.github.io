<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Fast SNI peek
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Fast%20SNI%20peek&In-Reply-To=%3C573609DA.3080505%40chtsanti.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="005690.html">
   <LINK REL="Next"  HREF="005659.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Fast SNI peek</H1>
    <B>Christos Tsantilas</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Fast%20SNI%20peek&In-Reply-To=%3C573609DA.3080505%40chtsanti.net%3E"
       TITLE="[squid-dev] [PATCH] Fast SNI peek">christos at chtsanti.net
       </A><BR>
    <I>Fri May 13 17:07:38 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="005690.html">[squid-dev] Jenkins build is back to normal : trunk-matrix » clang,d-opensuse-13.2 #643
</A></li>
        <LI>Next message: <A HREF="005659.html">[squid-dev] [PATCH] Fast SNI peek
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5658">[ date ]</a>
              <a href="thread.html#5658">[ thread ]</a>
              <a href="subject.html#5658">[ subject ]</a>
              <a href="author.html#5658">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Currently, bumping peek mode at step2 and splice at step2, after the SNI 
is  received is very slow.

The most of the performance overhead comes from openSSL. However Squid 
does not need openSSL to peek at SNI. It needs only to get client TLS 
Hello message, analyse it to retrieve SNI and then splice at step2.

This patch:
  - Postpone creation of the OpenSSL connection (i.e. SSL) object for 
the accepted TCP connection until after we peek at SNI (after step2).

  - Implements the Parser::BinaryTokenizer parser for extracting 
byte-oriented fields from raw input

  - Reimplement a new SSL/TLS handshake messages parser using the 
BinaryTokenizer, and remove old buggy parsing code from ssl/bio.cc

  - Adjust ConnStateData, Ssl::Bio, Ssl::PeerConnector classes to use 
the new parsers and parsing results.

Some performance testing results using polygraph with 1000 robots and 
1000 origin servers:

splice at | trunk | fast-sni
step1        100%     100%
step2         22%      69%
step3         16%      26%


This is a Measurement Factory project
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SQUID-146-fast-sni-t1.patch
Type: text/x-patch
Size: 170492 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20160513/c1bf0fac/attachment-0001.bin">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20160513/c1bf0fac/attachment-0001.bin</A>&gt;
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005690.html">[squid-dev] Jenkins build is back to normal : trunk-matrix » clang,d-opensuse-13.2 #643
</A></li>
	<LI>Next message: <A HREF="005659.html">[squid-dev] [PATCH] Fast SNI peek
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5658">[ date ]</a>
              <a href="thread.html#5658">[ thread ]</a>
              <a href="subject.html#5658">[ subject ]</a>
              <a href="author.html#5658">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
