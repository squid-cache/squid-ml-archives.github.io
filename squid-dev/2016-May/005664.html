<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Fast SNI peek
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Fast%20SNI%20peek&In-Reply-To=%3C02d401d1af47%24b8135ab0%24283a1010%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="005659.html">
   <LINK REL="Next"  HREF="005668.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Fast SNI peek</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Fast%20SNI%20peek&In-Reply-To=%3C02d401d1af47%24b8135ab0%24283a1010%24%40ngtech.co.il%3E"
       TITLE="[squid-dev] [PATCH] Fast SNI peek">eliezer at ngtech.co.il
       </A><BR>
    <I>Mon May 16 07:51:13 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="005659.html">[squid-dev] [PATCH] Fast SNI peek
</A></li>
        <LI>Next message: <A HREF="005668.html">[squid-dev] [PATCH] Fast SNI peek
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5664">[ date ]</a>
              <a href="thread.html#5664">[ thread ]</a>
              <a href="subject.html#5664">[ subject ]</a>
              <a href="author.html#5664">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Alex,

I have a question about this specific file and SNI peek and splice in general.
For the scenario which the SNI declares www.google.com and the destination IP address is not the domain, IE default apache or any other domain. What happens? And specifically about the request splicing?
And in more detail my concern is that if some software will fake the SNI knowing that the destination will never be the requested one but some default of another domain, will the request be spliced anyway?
I am not sure what squid does now and if something might be changed or not.
I do believe that more then one admin will want to enforce dns resolution policy on such requests and to decide what to do with &quot;rough&quot; requests.

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">eliezer at ngtech.co.il</A>


-----Original Message-----
From: squid-dev [mailto:<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev-bounces at lists.squid-cache.org</A>] On Behalf Of Alex Rousskov
Sent: Friday, May 13, 2016 11:38 PM
To: Squid Developers
Subject: Re: [squid-dev] [PATCH] Fast SNI peek

On 05/13/2016 11:07 AM, Christos Tsantilas wrote:

&gt;<i> mode | trunk | fast-sni
</I>&gt;<i> SS1     100%     100%
</I>&gt;<i> SS2      22%      69%
</I>&gt;<i> SS3      16%      26%
</I>
The above [slightly adjusted by me] table needs an explanation and a few disclaimers.

SSN in the first column means &quot;splicing at SslBump stepN&quot;. That is, we have tested recent trunk and fast-sni branch code using these three SslBump configurations:

  # SS1 (baseline):
  ssl_bump splice all

  # SS2 (peek at SNI -- the focus of this project):
  ssl_bump peek step1
  ssl_bump splice all

  # SS3 (peek at SNI then peek at the server certificate):
  ssl_bump peek step1
  ssl_bump peek step2
  ssl_bump splice all

The percentage shown is &quot;Squid performance&quot; compared to SS1/baseline where no peeking is performed. Higher numbers are better.

For example, the SS2 test shows that trunk SNI peeking performance is only about 20% of the &quot;immediately splice everything without peeking&quot;
baseline. In other words, trunk wastes ~80% of performance on SNI peeking. The optimized version loses only about 30%, approaching 70% of &quot;ideal&quot; performance.

Please note that SS3 includes certificate validation so it is not an estimate of step1+2 peeking performance alone; there were even DNS requests during step3 in our rough tests. This could be perfected further, but since our focus is on SNI peeking (SS2), we did not polish.
The significant overheads of those additional activities probably explain why make SS3 trunk and fast-sni performance do not differ as much as performance during SS2.

Absolute performance of trunk and fast SNI branch during SS1 tests was about the same, so 100% baseline is the same for both code flavors and all the reported percentages can be compared with each other.

These results are based on a micro-test using a best-effort Polygraph workload (i.e., each Polygraph robot is configured to send the next requests only after getting a response to the previous one). There were
1000 robots and 1000 origin servers during these tests. We minimized irrelevant activity by sending only HTTPS HEAD requests and intercepting SSL traffic (i.e., no CONNECTs). We are publishing percentages and not absolute request rates or response times that do not estimate true sustained performance in a realistic environment due to these simplifications. Suffice to say that Squid was doing more than 1000 HTTPS requests per second in all these tests.

The results Christos shared did not come from the very last version of trunk (currently untestable anyway) and fast SNI branches, but they should be within a few percentage points of the latest code.


Cheers,

Alex.

_______________________________________________
squid-dev mailing list
<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">http://lists.squid-cache.org/listinfo/squid-dev</A>

</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005659.html">[squid-dev] [PATCH] Fast SNI peek
</A></li>
	<LI>Next message: <A HREF="005668.html">[squid-dev] [PATCH] Fast SNI peek
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5664">[ date ]</a>
              <a href="thread.html#5664">[ thread ]</a>
              <a href="subject.html#5664">[ subject ]</a>
              <a href="author.html#5664">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
