<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Fast SNI peek
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Fast%20SNI%20peek&In-Reply-To=%3C5739A9DE.2090200%40chtsanti.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="005663.html">
   <LINK REL="Next"  HREF="005667.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Fast SNI peek</H1>
    <B>Christos Tsantilas</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Fast%20SNI%20peek&In-Reply-To=%3C5739A9DE.2090200%40chtsanti.net%3E"
       TITLE="[squid-dev] [PATCH] Fast SNI peek">christos at chtsanti.net
       </A><BR>
    <I>Mon May 16 11:07:10 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="005663.html">[squid-dev] [PATCH] Fast SNI peek
</A></li>
        <LI>Next message: <A HREF="005667.html">[squid-dev] [PATCH] Fast SNI peek
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5665">[ date ]</a>
              <a href="thread.html#5665">[ thread ]</a>
              <a href="subject.html#5665">[ subject ]</a>
              <a href="author.html#5665">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 05/15/2016 04:49 PM, Amos Jeffries wrote:
&gt;<i>   (I will hold off on my PeerConnector related changes until this is in).
</I>
thank you.


&gt;<i>
</I>&gt;<i> in src/client_side.h:
</I>&gt;<i>
</I>&gt;<i> * the cpmment block starting with:
</I>&gt;<i>    &quot;// The following block does not needed,&quot;
</I>&gt;<i>
</I>&gt;<i>   can all be replaced with one line:
</I>&gt;<i>    // Setting bio-&gt;rBufData() is not needed. inBuf and rbuf have the same
</I>&gt;<i> content.
</I>  Your suggestion is not correct here.
  The commented coded sets the ConnStateData::inBuf, not the bio-&gt;rBufData.

&gt;<i>
</I>&gt;<i>    - I am a little doubtful about the accuracy of that. Both places are
</I>&gt;<i> using SBuf to hold the buffer. If they are not kept in sync they might
</I>&gt;<i> end up pointing at different MemBlob offsets or different MemBlob
</I>&gt;<i> entirely. Did I might have missed the sync'ing ?
</I>
My old commend was wrong too.
Actually the ConnStateData reads client data (client TLS hello message) 
and store it to inBuf.
After this patch we do not actually care if the 
Ssl::ClientBio::rBufData(), has or not any data, and the nature of these 
data.

The tunnelStartShoveling, if there are any data in ConnStateData::inBuf 
takes care about.

I just removed the commented code and the comment.


&gt;<i>
</I>&gt;<i>
</I>&gt;<i> in src/client_side.cc:
</I>&gt;<i>
</I>&gt;<i> * files in src/security/ should not need wrapping in USE_OPENSSL
</I>&gt;<i>   - referring to the #includes pulling in security/Handshake.h
</I>&gt;<i>   - maybe others
</I>&gt;<i>
</I>&gt;<i> * tlsParser has no doxygen comment
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> in src/parser/BinaryTokenizer.cc:
</I>&gt;<i>
</I>&gt;<i> * #include &quot;parser/BinaryTokenizer.h&quot; instead.
</I>&gt;<i>
</I>&gt;<i> * delegating constructors is a C++11 feature that will definitely fail
</I>&gt;<i> on GCC 4.8.
</I>&gt;<i>   - I have put the question to Alex in how recent patch about dropping
</I>&gt;<i> that support. If we go ahead with that, the BinaryTokenizer construction
</I>&gt;<i> is fine. Otherwise it will have to be expanded to non-delegating.
</I>
No opinion on this. I will wait Alex and you to decide about.
The only I can say is that it looks ok in my g++-4.8.4


&gt;<i>
</I>&gt;<i> * please make BinaryTokenizer_tail a function not a macro.
</I>&gt;<i>   - doing that will also fix the missing (void*) before use of 'this'
</I>The (void *) is not missing here, it is not desired.
What am I missing?

The macro is used in two places and it is faster as macro I think.
But not problem I will make it a method.

&gt;<i>
</I>&gt;<i> * please move the BinaryTokenizerContext inline method definitions
</I>&gt;<i> inside the class {} block.
</I>&gt;<i>   - then you wont need to even use &quot;inline&quot;.
</I>
This is not possible. All of these requires BinaryTokenizer
definition.

&gt;<i>
</I>&gt;<i> in src/ssl/PeekingPeerConnector.cc:
</I>&gt;<i>
</I>&gt;<i> * the debugs dropped from Ssl::PeekingPeerConnector::noteWantWrite() was
</I>&gt;<i> about the srvBio-&gt;holdWrite() in the line above which still remains
</I>&gt;<i> wasn't it?
</I>
Does not actually provides a useful info.
I removed this change from this patch, but we should at least increase 
the level of this debug message, it is not an important info.


&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I></PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005663.html">[squid-dev] [PATCH] Fast SNI peek
</A></li>
	<LI>Next message: <A HREF="005667.html">[squid-dev] [PATCH] Fast SNI peek
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5665">[ date ]</a>
              <a href="thread.html#5665">[ thread ]</a>
              <a href="subject.html#5665">[ subject ]</a>
              <a href="author.html#5665">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
