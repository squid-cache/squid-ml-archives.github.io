<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Fast SNI peek
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Fast%20SNI%20peek&In-Reply-To=%3C573B54C8.20308%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="005675.html">
   <LINK REL="Next"  HREF="005684.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Fast SNI peek</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Fast%20SNI%20peek&In-Reply-To=%3C573B54C8.20308%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] Fast SNI peek">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue May 17 17:28:40 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="005675.html">[squid-dev] [PATCH] Fast SNI peek
</A></li>
        <LI>Next message: <A HREF="005684.html">[squid-dev] [PATCH] Fast SNI peek
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5680">[ date ]</a>
              <a href="thread.html#5680">[ thread ]</a>
              <a href="subject.html#5680">[ subject ]</a>
              <a href="author.html#5680">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 05/17/2016 08:39 AM, Amos Jeffries wrote:
&gt;<i> To answer Christos' question;
</I>&gt;<i>  For iostreams to print the pointer value in hex like seems to be wanted
</I>&gt;<i> here one has to make sure the pointer is a void* and not a type that can
</I>&gt;<i> be dereferenced. Otherwise the streams will try to display its contents
</I>&gt;<i> which would either break, or &quot;work&quot; with unexpected values output.
</I>&gt;<i>  NP: 'this' pointer always has a known type, not void*.
</I>
To be more precise, std::ostream's shift operator prints void pointers
as hex values. Any pointer can be implicitly cast to void*. However, if
there is an std::ostream shift operator with a matching pointer type
other than void*, that more specific operator is used instead of
implicit casting.

Squid does provide such specific shift operators in a few cases to print
object IDs/state without pointer-dereferencing dangers.

If our intent here is to print the raw pointer, we should cast to void*
explicitly. If our intent is to print a tokenizer ID, and we are sure
that any future shift overload will print a tokenizer ID (and not
tokenizer _state_!), then we should not cast to remain
future-compatible. I think our intent is to print a tokenizer ID, but I
cannot be sure about future shift overloads.

Needless to say, the existing code is inconsistent:

  $ bzr grep '&lt;&lt; this' | wc -l
  169
  $ bzr grep '&lt;&lt;.*void.*this' | wc -l
  31


Casting is an easy way to avoid an argument so we should do it.


&gt;&gt;&gt;<i> * you dont need to put /* Ssl:Bio */ or /* ServerBio */ markers between
</I>&gt;&gt;&gt;<i> definitions at the file global level.
</I>
&gt;&gt;<i> Somebody added draconian &quot;no double empty lines&quot; rules to source
</I>&gt;&gt;<i> formatting scripts and those markers are the only thing that clearly
</I>&gt;&gt;<i> separates different class methods in .cc file now. FWIW, they _are_
</I>&gt;&gt;<i> useful to some of us browsing the code.
</I>
&gt;<i> So one browsing the file does not pay attention to the &quot;ServerBio::&quot; or
</I>&gt;<i> &quot;Ssl::Bio::&quot; scope paths in every single method name?
</I>
Scope paths in methods do not stand out visually because all methods
have scope paths. Without additional visual clues, detecting the
boundary between classes takes extra time/effort. The lack of clearly
marked sections may also encourage folks to mix methods from different
classes.

Needless to say, those markers have negative side effects as well. I do
not insist on keeping these markers. @Christos, your call.

Alex.

</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005675.html">[squid-dev] [PATCH] Fast SNI peek
</A></li>
	<LI>Next message: <A HREF="005684.html">[squid-dev] [PATCH] Fast SNI peek
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5680">[ date ]</a>
              <a href="thread.html#5680">[ thread ]</a>
              <a href="subject.html#5680">[ subject ]</a>
              <a href="author.html#5680">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
