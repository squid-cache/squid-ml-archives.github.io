<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Bumping after peek and Splicing after stare
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Bumping%20after%20peek%20and%20Splicing%20after%20stare&In-Reply-To=%3C573EC8C4.80501%40chtsanti.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="005728.html">
   <LINK REL="Next"  HREF="005713.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Bumping after peek and Splicing after stare</H1>
    <B>Christos Tsantilas</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Bumping%20after%20peek%20and%20Splicing%20after%20stare&In-Reply-To=%3C573EC8C4.80501%40chtsanti.net%3E"
       TITLE="[squid-dev] Bumping after peek and Splicing after stare">christos at chtsanti.net
       </A><BR>
    <I>Fri May 20 08:20:20 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="005728.html">[squid-dev] Jenkins build is back to normal : trunk-full-matrix » gcc,j-fbsd-93 #165
</A></li>
        <LI>Next message: <A HREF="005713.html">[squid-dev] Bumping after peek and Splicing after stare
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5711">[ date ]</a>
              <a href="thread.html#5711">[ thread ]</a>
              <a href="subject.html#5711">[ subject ]</a>
              <a href="author.html#5711">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

  On peek bumping mode we are sending the client hello message to the 
SSL server. The client Hello message normally includes the supported 
features by client and a shared key. This is normally makes impossible 
to bump the connection after &quot;peek&quot; mode.

On stare mode squid sends its hello message (with its supported features 
and its shared keys), and this is make impossible to splice the 
connection after stare mode.

However currently we are trying to hack openSSL, if it is possible (the 
same features supported by both squid and client) and fill its internal 
structures with the hello message sent by client to allow:
   - on stare mode splice the connection
   - on peek mode bump the connection.

This was possible and worked if squid and web client was build using the 
same openSSL library, or for older firefox clients (which used a limit 
number of tls extensions).

However recent changes to the source code of openSSL, break this 
feature. Moreover the openSSL source code is significant changed in its 
trunk repository. The upcoming openSSL releases will have major difference.

Looks that it will be very difficult to maintain this hack. And this is 
already make problems to squid. The stare mode may not work in some cases.

The squid code which hacks openSSL is inside adjustSSL function in bio.cc.

I am suggesting to just remove this function and the 
SQUID_CHECK_OPENSSL_HELLO_OVERWRITE_HACK configure.ac check.
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005728.html">[squid-dev] Jenkins build is back to normal : trunk-full-matrix » gcc,j-fbsd-93 #165
</A></li>
	<LI>Next message: <A HREF="005713.html">[squid-dev] Bumping after peek and Splicing after stare
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5711">[ date ]</a>
              <a href="thread.html#5711">[ thread ]</a>
              <a href="subject.html#5711">[ subject ]</a>
              <a href="author.html#5711">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
