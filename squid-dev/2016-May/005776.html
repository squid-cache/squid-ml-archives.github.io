<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Drop ie_refresh configuration option
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Drop%20ie_refresh%20configuration%20option&In-Reply-To=%3C0795baf8-0c32-0807-e81a-22404e1d3585%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="005836.html">
   <LINK REL="Next"  HREF="005778.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Drop ie_refresh configuration option</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Drop%20ie_refresh%20configuration%20option&In-Reply-To=%3C0795baf8-0c32-0807-e81a-22404e1d3585%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] Drop ie_refresh configuration option">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu May 26 09:16:50 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="005836.html">[squid-dev] [PATCH] Deprecating SMB LanMan helpers
</A></li>
        <LI>Next message: <A HREF="005778.html">[squid-dev] [PATCH] Drop ie_refresh configuration option
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5776">[ date ]</a>
              <a href="thread.html#5776">[ thread ]</a>
              <a href="subject.html#5776">[ subject ]</a>
              <a href="author.html#5776">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This option was provided as a hack to workaround problems in MSIE 5.01
and older.

Since those MSIE versions are long deprecated and no longer even
registering on the popularity charts for more than 5 years I think its
time we removed this hack.

Amos
-------------- next part --------------
=== modified file 'doc/release-notes/release-4.sgml'
--- doc/release-notes/release-4.sgml	2016-05-06 10:06:01 +0000
+++ doc/release-notes/release-4.sgml	2016-05-26 09:14:20 +0000
@@ -343,6 +343,9 @@
 	&lt;p&gt;Superceded by &lt;em&gt;cache_peer_access&lt;/em&gt;. Use dstdomain ACL
 	   in the access control list to restrict domains requested.
 
+	&lt;tag&gt;ie_refresh&lt;/tag&gt;
+	&lt;p&gt;Removed. MSIE 3.x, 4.x, 5.0 and 5.01 are no longer popular browsers.
+
 	&lt;tag&gt;sslproxy_cafile&lt;/tag&gt;
 	&lt;p&gt;Replaced by &lt;em&gt;tls_outgoing_options cafile=&lt;/em&gt;.
 	   Which now takes multiple entries.
=== modified file 'src/cf.data.pre'
--- src/cf.data.pre	2016-05-05 06:31:11 +0000
+++ src/cf.data.pre	2016-05-26 09:06:49 +0000
@@ -163,13 +163,19 @@
 	This option is not yet supported by Squid-3.
 DOC_END
 
-# Options removed in 3.6
+# Options removed in 4.x
 NAME: cache_peer_domain cache_host_domain
 TYPE: obsolete
 DOC_START
 	Replace with dstdomain ACLs and cache_peer_access.
 DOC_END
 
+NAME: ie_refresh
+TYPE: obsolete
+DOC_START
+	This option is no longer supported.
+DOC_END
+
 NAME: sslproxy_cafile
 TYPE: obsolete
 DOC_START
@@ -5889,30 +5895,6 @@
 	replies as required by RFC2616.
 DOC_END
 
-NAME: ie_refresh
-COMMENT: on|off
-TYPE: onoff
-LOC: Config.onoff.ie_refresh
-DEFAULT: off
-DOC_START
-	Microsoft Internet Explorer up until version 5.5 Service
-	Pack 1 has an issue with transparent proxies, wherein it
-	is impossible to force a refresh.  Turning this on provides
-	a partial fix to the problem, by causing all IMS-REFRESH
-	requests from older IE versions to check the origin server
-	for fresh content.  This reduces hit ratio by some amount
-	(~10% in my experience), but allows users to actually get
-	fresh content when they want it.  Note because Squid
-	cannot tell if the user is using 5.5 or 5.5SP1, the behavior
-	of 5.5 is unchanged from old versions of Squid (i.e. a
-	forced refresh is impossible).  Newer versions of IE will,
-	hopefully, continue to have the new behavior and will be
-	handled based on that assumption.  This option defaults to
-	the old Squid behavior, which is better for hit ratios but
-	worse for clients using IE, if they need to be able to
-	force fresh content.
-DOC_END
-
 NAME: vary_ignore_expire
 COMMENT: on|off
 TYPE: onoff

=== modified file 'src/client_side_request.cc'
--- src/client_side_request.cc	2016-05-03 01:48:49 +0000
+++ src/client_side_request.cc	2016-05-26 09:05:05 +0000
@@ -1072,28 +1072,6 @@
             // RFC 2616: treat Pragma:no-cache as if it was Cache-Control:no-cache when Cache-Control is missing
         } else if (req_hdr-&gt;has(Http::HdrType::PRAGMA))
             no_cache = req_hdr-&gt;hasListMember(Http::HdrType::PRAGMA,&quot;no-cache&quot;,',');
-
-        /*
-        * Work around for supporting the Reload button in IE browsers when Squid
-        * is used as an accelerator or transparent proxy, by turning accelerated
-        * IMS request to no-cache requests. Now knows about IE 5.5 fix (is
-        * actually only fixed in SP1, but we can't tell whether we are talking to
-        * SP1 or not so all 5.5 versions are treated 'normally').
-        */
-        if (Config.onoff.ie_refresh) {
-            if (http-&gt;flags.accel &amp;&amp; request-&gt;flags.ims) {
-                if ((str = req_hdr-&gt;getStr(Http::HdrType::USER_AGENT))) {
-                    if (strstr(str, &quot;MSIE 5.01&quot;) != NULL)
-                        no_cache=true;
-                    else if (strstr(str, &quot;MSIE 5.0&quot;) != NULL)
-                        no_cache=true;
-                    else if (strstr(str, &quot;MSIE 4.&quot;) != NULL)
-                        no_cache=true;
-                    else if (strstr(str, &quot;MSIE 3.&quot;) != NULL)
-                        no_cache=true;
-                }
-            }
-        }
     }
 
     if (request-&gt;method == Http::METHOD_OTHER) {

</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005836.html">[squid-dev] [PATCH] Deprecating SMB LanMan helpers
</A></li>
	<LI>Next message: <A HREF="005778.html">[squid-dev] [PATCH] Drop ie_refresh configuration option
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5776">[ date ]</a>
              <a href="thread.html#5776">[ thread ]</a>
              <a href="subject.html#5776">[ subject ]</a>
              <a href="author.html#5776">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
