<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Extend SBufContainerJoin to have prefix and suffix arguments
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Extend%20SBufContainerJoin%20to%20have%20prefix%20and%0A%20suffix%20arguments&In-Reply-To=%3CCA%2BY8hcNdEcMn7bTrpDknweEgjNH5Jprfoe-Kyitoz1LrjCav2w%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="007165.html">
   <LINK REL="Next"  HREF="007170.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Extend SBufContainerJoin to have prefix and suffix arguments</H1>
    <B>Kinkie</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Extend%20SBufContainerJoin%20to%20have%20prefix%20and%0A%20suffix%20arguments&In-Reply-To=%3CCA%2BY8hcNdEcMn7bTrpDknweEgjNH5Jprfoe-Kyitoz1LrjCav2w%40mail.gmail.com%3E"
       TITLE="[squid-dev] [PATCH] Extend SBufContainerJoin to have prefix and suffix arguments">gkinkie at gmail.com
       </A><BR>
    <I>Fri Nov  4 07:12:02 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="007165.html">[squid-dev] [PATCH] Extend SBufContainerJoin to have prefix and suffix arguments
</A></li>
        <LI>Next message: <A HREF="007170.html">[squid-dev] [PATCH] Extend SBufContainerJoin to have prefix and suffix arguments
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7167">[ date ]</a>
              <a href="thread.html#7167">[ thread ]</a>
              <a href="subject.html#7167">[ subject ]</a>
              <a href="author.html#7167">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Nov 3, 2016 at 10:55 PM, Alex Rousskov
&lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">rousskov at measurement-factory.com</A>&gt; wrote:
&gt;<i> On 11/03/2016 03:19 PM, Kinkie wrote:
</I>&gt;&gt;<i> On Tue, Nov 1, 2016 at 8:47 PM, Alex Rousskov wrote:
</I>&gt;&gt;&gt;<i> On 11/01/2016 02:02 PM, Kinkie wrote:
</I>&gt;&gt;&gt;&gt;<i>   the attached patch extends SBufContainerJoin to have prefix and
</I>&gt;&gt;&gt;&gt;<i> suffix arguments.
</I>&gt;<i>
</I>&gt;&gt;&gt;<i> I recommend reworking this by adding a dest parameter:
</I>&gt;&gt;&gt;<i> SBuf &amp;ContainerToSBuf(SBuf &amp;dest, ...);
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> Can simply return the modified SBuf.
</I>&gt;<i>
</I>&gt;&gt;<i>  SBuf
</I>&gt;&gt;<i> -SBufContainerJoin(const Container &amp;items, const SBuf&amp; separator)
</I>&gt;&gt;<i> +JoinContainerIntoSBuf(SBuf dest, const ContainerIterator &amp;begin,
</I>&gt;<i>
</I>&gt;<i> This implementation does not avoid copies in a general case: When I
</I>&gt;<i> already have an SBuf with some content, I have to feed my writeable SBuf
</I>&gt;<i> to ContainerToSBuf() to avoid allocating and copying.
</I>&gt;<i>
</I>&gt;<i> AFAICT, the reasonable implementation options are:
</I>&gt;<i>
</I>&gt;<i>   1. Your old simpler implementation without &quot;dest&quot;.
</I>&gt;<i>   2. A more efficient implementation with writeable &quot;dest&quot;.
</I>
attached v3 does this.

&gt;<i> The latest implementation has the complexity of #2 but lacks its
</I>&gt;<i> efficiency. I do not think it is a good API.
</I>
I am not generally worried as it seems you are about copying SBufs as
long as the underlying storage is not reallocated needlessly. But it's
very simple to express one call in terms of the other, so I'm doing
just that. I am convinced that the end result of our discussion is
better than what we had started with, and I'm grateful for that.


-- 
    Francesco
-------------- next part --------------
A non-text attachment was scrubbed...
Name: sbufcontainerjoin-v3.patch
Type: application/octet-stream
Size: 3578 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20161104/ad1da0e0/attachment.obj">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20161104/ad1da0e0/attachment.obj</A>&gt;
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007165.html">[squid-dev] [PATCH] Extend SBufContainerJoin to have prefix and suffix arguments
</A></li>
	<LI>Next message: <A HREF="007170.html">[squid-dev] [PATCH] Extend SBufContainerJoin to have prefix and suffix arguments
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7167">[ date ]</a>
              <a href="thread.html#7167">[ thread ]</a>
              <a href="subject.html#7167">[ subject ]</a>
              <a href="author.html#7167">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
