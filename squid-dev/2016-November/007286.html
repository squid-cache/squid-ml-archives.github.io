<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [RFC] simplifying ssl_bump complexity
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20simplifying%20ssl_bump%20complexity&In-Reply-To=%3C56068785-39c7-da00-4860-1c5fca776217%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="007303.html">
   <LINK REL="Next"  HREF="007275.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [RFC] simplifying ssl_bump complexity</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20simplifying%20ssl_bump%20complexity&In-Reply-To=%3C56068785-39c7-da00-4860-1c5fca776217%40measurement-factory.com%3E"
       TITLE="[squid-dev] [RFC] simplifying ssl_bump complexity">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Nov 28 00:16:23 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="007303.html">[squid-dev] [RFC] simplifying ssl_bump complexity
</A></li>
        <LI>Next message: <A HREF="007275.html">[squid-dev] Build fails after update to rev. 14954
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7286">[ date ]</a>
              <a href="thread.html#7286">[ thread ]</a>
              <a href="subject.html#7286">[ subject ]</a>
              <a href="author.html#7286">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/19/2016 03:07 AM, Amos Jeffries wrote:

&gt;<i> I propose going back to the older config style where each step has its
</I>&gt;<i> own directive name which self-documents what it does.
</I>
IIRC, SslBump has never used step-specific directives: First
implementations applied all ssl_bump actions during step1 and the
current implementation applies various ssl_bump actions at various
steps, but no Squid version had steps with dedicated directive names
AFAICT: <A HREF="http://www.squid-cache.org/Doc/config/ssl_bump/">http://www.squid-cache.org/Doc/config/ssl_bump/</A>


&gt;<i> That will reduce
</I>&gt;<i> the confusion about what is going on at each 'step', and allow us a
</I>&gt;<i> chance to have clearly documented default actions for each step.
</I>
Why do you think that moving the step name into the directive name,
i.e., essentially replacing

  ssl_bump action stepN ...

with

  ssl_bump_stepN action ...

will &quot;reduce the confusion about what is going on at each step, and
allow us a chance to have clearly documented default actions for each
step&quot;? I see no correlation between the proposed change and the expected
result.


There have been cases were being explicit about steps resulted in worse
or broken configurations. There have been cases were being explicit
about steps resulted in better configurations. The exact outcome usually
depends on the level of admin's understanding and specific use cases.
Steps are helpful in some cases and harmful in others. If the consensus
is that explicit steps are usually helpful, we can encourage their use
[without forcing them on all the admins, in all cases].

IMO, the steps are not the core problem; their set will change
long-term; and they should not be the focus of the configuration. The
core problems lie elsewhere:

* The available information varies widely and may (or may not!) change
with each step. Even today, the information available at step1 varies
depending on the bumping environment. It is difficult to deal with
changing information using traditional &quot;fixed&quot; ACLs. We need to arm the
admin with server_name and similar &quot;dynamic&quot; ACLs. A related
&quot;information&quot; problem is server certificate validation: The admins are
surprised to learn that Squid validates the server certificate, and it
is often not clear when Squid does that and how to control whether Squid
should validate.

* The &quot;price&quot; (or side effects) of obtaining more information grows with
each step. For example, one can learn the origin server CN, but only at
the cost of establishing a TCP connection with the origin server and
precluding future splicing (or bumping). There is currently no good way
to tell Squid how much the admin is willing to &quot;pay&quot; for more
information [in the context of the current transaction state].

* Exception handling: When things go wrong, the admins are surprised to
learn that Squid bumps the client (to send an error message). There are
different kinds of errors and Squid reaction to each kind is controlled
by a different configuration directive. It is often not clear what Squid
will do in a particular situation, even when the current step is known.

These problems are fundamental SslBump properties that will not change
regardless of the configuration approach. The best configuration
approach should focus on these fundamental properties rather than on the
[still evolving] &quot;steps&quot; mechanics. The current configuration abilities
have many weak spots, but the proposed changes seem like a step in the
wrong direction to me because they focus on the mechanics rather than on
these fundamentals. They force the admins to detail what should not be
important.



&gt;<i> For example:
</I>&gt;<i>  tls_new_connection
</I>&gt;<i>   - default: peek all
</I>&gt;<i>   - or run ssl_bump check if that directive exists
</I>&gt;<i> 
</I>&gt;<i>  tls_client_hello
</I>&gt;<i>   - default: splice all
</I>&gt;<i>   - or run ssl_bump check if that directive exists
</I>&gt;<i> 
</I>&gt;<i>  tls_server_hello
</I>&gt;<i>   - default: terminate all
</I>&gt;<i>   - or run ssl_bump check if that directive exists
</I>

To illustrate why your proposal will be better than the existing
approach, please compare an old configuration with a new configuration
for a few common use cases. Please do your best to be unbiased in your
comparison -- do not just pick the cases that benefit your proposal.


Also, I suggest to separate naming from the functionality changes. If we
agree to change the functionality, we can then discuss how to name the
new configuration knobs. For now, I am not going to discuss the problems
with the proposed naming scheme.



&gt;<i> The main consideration here is that the default behaviour/actions are
</I>&gt;<i> both a) that legal in almost all jurisdictions users will be working in,
</I>
Please do not bring legality and jurisdictions into this. If there is
quorum, then we are unlikely to reach consensus if we start discussing
what is &quot;legal&quot; and where one &quot;jurisdiction&quot; ends and another begins.
Said that, the existing default behavior is probably already legal in
all jurisdictions so there seems to be no difference here anyway.


&gt;<i> and b) let client connections work if the admin does not configure
</I>&gt;<i> anything different (ie peek + splice).
</I>
How is that different from today? Client connections already work if the
admin configures nothing: Splicing is the default when nothing is
configured. If it is not the default, it should be (and we can certainly
fix that bug if it exists).


Thank you,

Alex.
P.S.
&gt;<i> Since ssl_bump directive went in my original opinion of it as being too
</I>&gt;<i> complicated and confusing has pretty much been demonstrated as correct
</I>&gt;<i> by the vast amount of misconfigurations and failed attempts [to use it].
</I>
I envy your confidence but do not know why you started your RFC with
this flawed attempt to prove some vaguely defined opinion to be correct.
I tried to avoid this distraction and focus on the RFC parts that deal
with reducing ssl_bump configuration complexity instead. If you meant to
discuss why we happen to be where we are today, and who has predicted
what, please start a dedicated email thread.

</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007303.html">[squid-dev] [RFC] simplifying ssl_bump complexity
</A></li>
	<LI>Next message: <A HREF="007275.html">[squid-dev] Build fails after update to rev. 14954
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7286">[ date ]</a>
              <a href="thread.html#7286">[ thread ]</a>
              <a href="subject.html#7286">[ subject ]</a>
              <a href="author.html#7286">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
