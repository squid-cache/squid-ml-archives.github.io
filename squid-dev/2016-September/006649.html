<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Reject or sanitize more problematic	Content-Length values
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Reject%20or%20sanitize%20more%20problematic%0A%09Content-Length%20values&In-Reply-To=%3C79c6baba-6fd3-13c8-86ac-c9b5ce75bd13%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="006865.html">
   <LINK REL="Next"  HREF="006650.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Reject or sanitize more problematic	Content-Length values</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Reject%20or%20sanitize%20more%20problematic%0A%09Content-Length%20values&In-Reply-To=%3C79c6baba-6fd3-13c8-86ac-c9b5ce75bd13%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] Reject or sanitize more problematic	Content-Length values">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Sep  1 23:21:36 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="006865.html">[squid-dev] [PATCH] Incorrect logging of request size
</A></li>
        <LI>Next message: <A HREF="006650.html">[squid-dev] [PATCH] Reject or sanitize more problematic Content-Length values
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6649">[ date ]</a>
              <a href="thread.html#6649">[ thread ]</a>
              <a href="subject.html#6649">[ subject ]</a>
              <a href="author.html#6649">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

    Squid is violating HTTP MUSTs by forwarding messages with
problematic Content-Length values. Some of those bugs were fixed in
trunk r14215. This change handles multiple Content-Length values inside
one header field, negative values, and trailing garbage. Handling the
former required a change in the overall Content-Length interpretation
approach (which is why it was previously left as a TODO).

Squid now passes almost all Co-Advisor tests devoted to this area. We
are not 100% done though: We still need to handle malformed values with
leading signs (e.g., &quot;-0&quot; or &quot;+1&quot;). However, I hope that the remaining
problems are relatively minor. I do not plan on addressing them in the
foreseeable future.

Also improved httpHeaderParseOffset(): Added detection of overflowing
and underflowing integer values; polished malformed value detection code
(Linux strtoll(3) manual page has a good example). The function no
longer considers empty strings valid and reports trailing characters.
The function still accepts leading whitespace and signs. It is still the
wrong approach to HTTP numbers parsing, but further improvements are out
of scope because they are complicated and would require significant
caller rewrites.


HTH,

Alex.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SQUID-227-reject-clen-t4.patch
Type: text/x-diff
Size: 25461 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20160901/6b63da18/attachment.patch">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20160901/6b63da18/attachment.patch</A>&gt;
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006865.html">[squid-dev] [PATCH] Incorrect logging of request size
</A></li>
	<LI>Next message: <A HREF="006650.html">[squid-dev] [PATCH] Reject or sanitize more problematic Content-Length values
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6649">[ date ]</a>
              <a href="thread.html#6649">[ thread ]</a>
              <a href="subject.html#6649">[ subject ]</a>
              <a href="author.html#6649">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
