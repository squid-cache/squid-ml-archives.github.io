<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [RFC] dns_wait_for_all
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20dns_wait_for_all&In-Reply-To=%3C88203835-49d8-fe76-a8dc-0bd5a832c0dd%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="006833.html">
   <LINK REL="Next"  HREF="006837.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [RFC] dns_wait_for_all</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20dns_wait_for_all&In-Reply-To=%3C88203835-49d8-fe76-a8dc-0bd5a832c0dd%40measurement-factory.com%3E"
       TITLE="[squid-dev] [RFC] dns_wait_for_all">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Sep 15 05:11:00 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="006833.html">[squid-dev] [RFC] dns_wait_for_all
</A></li>
        <LI>Next message: <A HREF="006837.html">[squid-dev] [RFC] dns_wait_for_all
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6836">[ date ]</a>
              <a href="thread.html#6836">[ thread ]</a>
              <a href="subject.html#6836">[ subject ]</a>
              <a href="author.html#6836">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 09/14/2016 07:26 PM, Amos Jeffries wrote:
&gt;<i> On 15/09/2016 8:15 a.m., Alex Rousskov wrote:
</I>&gt;&gt;<i> Any better ideas or objections to adding dns_wait_for_all?
</I>

&gt;<i> In principle okay. However, I was intending to redesign the object we
</I>&gt;<i> store DNS RR results in to achieve this is a more useful way. 
</I>
If you are talking about Comm::ConnectionList/serverDestinations, then
that object will have to be redesigned to support this proposal, of
course. The object would also have to be safely shared across FwdState,
peer selection code, and DNS code for the proposed feature to work.


&gt;<i> * slow DNS responses could add to the chain while earlier results are
</I>&gt;<i> still in Async queue pending delivery to a caller.
</I>
... and while the caller is going through the TCP connect steps. That
TCP connect may be unsuccessful, requiring another attempt, possibly
using a different address. We already have the retrying code in place
and I am not proposing to change those algorithms during this project,
but the timing of new destinations arrival will change.


&gt;<i>  - this would obsolete the need for dns_wait_for_all to be configurable.
</I>
I have nothing specific against making the proposed algorithm the only
one, but I am not sure that _all_ side effects of the current
resolve-everything-first code are useless in all environments. AFAICT,
supporting both algorithms is easy (it is supporting the proposed
algorithm that is difficult).


&gt;<i> * ip/fqdn caches can store older data up to some timeout in TTL / LRU
</I>&gt;<i> sequence.
</I>
I am not sure the DNS cache should be affected by the new lookup results
handling algorithm or the new serverDestinations storage of those
results. AFAICT, the DNS cache should store each result independently
while serverDestinations stores an ordered collection of results (some
of which may come from the DNS cache).

If you think that caching must change as a part of this project, can you
detail the related caching changes you would expect or foresee? If
caching changes are mostly independent, then we can discuss them
later/separately (to stay focused).


Thank you,

Alex.

</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006833.html">[squid-dev] [RFC] dns_wait_for_all
</A></li>
	<LI>Next message: <A HREF="006837.html">[squid-dev] [RFC] dns_wait_for_all
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6836">[ date ]</a>
              <a href="thread.html#6836">[ thread ]</a>
              <a href="subject.html#6836">[ subject ]</a>
              <a href="author.html#6836">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
