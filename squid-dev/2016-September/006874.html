<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Bug 3819: &quot;fd &gt;= 0&quot; assertion in file_write() during reconfiguration
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Bug%203819%3A%20%22fd%20%3E%3D%200%22%20assertion%20in%20file_write%28%29%0A%20during%20reconfiguration&In-Reply-To=%3C1625c8e6-a186-c022-84fa-a07857438371%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="006873.html">
   <LINK REL="Next"  HREF="006876.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Bug 3819: &quot;fd &gt;= 0&quot; assertion in file_write() during reconfiguration</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Bug%203819%3A%20%22fd%20%3E%3D%200%22%20assertion%20in%20file_write%28%29%0A%20during%20reconfiguration&In-Reply-To=%3C1625c8e6-a186-c022-84fa-a07857438371%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] Bug 3819: &quot;fd &gt;= 0&quot; assertion in file_write() during reconfiguration">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Sep 19 21:52:58 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="006873.html">[squid-dev] FYI: trunk ContextPtr changes
</A></li>
        <LI>Next message: <A HREF="006876.html">[squid-dev] [PATCH] Bug 3819: &quot;fd &gt;= 0&quot; assertion in file_write() during reconfiguration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6874">[ date ]</a>
              <a href="thread.html#6874">[ thread ]</a>
              <a href="subject.html#6874">[ subject ]</a>
              <a href="author.html#6874">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

    The attached trunk patch fixes bug 3819 in our tests.

Please note that the underlying problem may lead to other assertions,
including &quot;NumberOfUFSDirs&quot; in UFSSwapDir and &quot;fd &gt;= 0&quot; in file_close().

Since trunk r9181.3.1, reconfiguration is done in at least two steps:
First, mainReconfigureStart() closes/cleans/disables all modules
supporting hot reconfiguration and then, at the end of the event loop
iteration, mainReconfigureFinish() opens/configures/enables them again.
UFS code hits assertions if it has to log entries or rebuild swap.state
between those two steps.  The patch disables or delays those activities
during reconfiguration.

The tiny assertion opportunity window hides these bugs from most proxies
that are not doing enough disk I/O or are not being reconfigured
frequently enough.


HTH,

Alex.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: SQUID-231-bug3819-fd-assert-reconf-t5.patch
Type: text/x-diff
Size: 17430 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20160919/6c817d40/attachment.patch">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20160919/6c817d40/attachment.patch</A>&gt;
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006873.html">[squid-dev] FYI: trunk ContextPtr changes
</A></li>
	<LI>Next message: <A HREF="006876.html">[squid-dev] [PATCH] Bug 3819: &quot;fd &gt;= 0&quot; assertion in file_write() during reconfiguration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6874">[ date ]</a>
              <a href="thread.html#6874">[ thread ]</a>
              <a href="subject.html#6874">[ subject ]</a>
              <a href="author.html#6874">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
