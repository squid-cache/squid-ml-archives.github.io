<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [RFC] dns_wait_for_all
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20dns_wait_for_all&In-Reply-To=%3C15829b74-4d82-21a4-5c9a-509730bd97ad%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="006860.html">
   <LINK REL="Next"  HREF="006879.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [RFC] dns_wait_for_all</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20dns_wait_for_all&In-Reply-To=%3C15829b74-4d82-21a4-5c9a-509730bd97ad%40treenet.co.nz%3E"
       TITLE="[squid-dev] [RFC] dns_wait_for_all">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Sep 20 10:41:36 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="006860.html">[squid-dev] [RFC] dns_wait_for_all
</A></li>
        <LI>Next message: <A HREF="006879.html">[squid-dev] [RFC] dns_wait_for_all
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6877">[ date ]</a>
              <a href="thread.html#6877">[ thread ]</a>
              <a href="subject.html#6877">[ subject ]</a>
              <a href="author.html#6877">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 16/09/2016 3:35 a.m., Alex Rousskov wrote:
&gt;<i> On 09/15/2016 03:50 AM, Amos Jeffries wrote:
</I>&gt;&gt;<i> On 15/09/2016 5:11 p.m., Alex Rousskov wrote:
</I>&gt;&gt;&gt;<i> On 09/14/2016 07:26 PM, Amos Jeffries wrote:
</I>&gt;&gt;&gt;&gt;<i> On 15/09/2016 8:15 a.m., Alex Rousskov wrote:
</I>&gt;&gt;&gt;&gt;&gt;<i> Any better ideas or objections to adding dns_wait_for_all?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> In principle okay. However, I was intending to redesign the object we
</I>&gt;&gt;&gt;&gt;<i> store DNS RR results in to achieve this is a more useful way. 
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> If you are talking about Comm::ConnectionList/serverDestinations, then
</I>&gt;&gt;&gt;<i> that object will have to be redesigned to support this proposal, of
</I>&gt;&gt;&gt;<i> course. The object would also have to be safely shared across FwdState,
</I>&gt;&gt;&gt;<i> peer selection code, and DNS code for the proposed feature to work.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I mean Dns::LookupDetails, ipcache_addrs and rfc1035_rr.
</I>&gt;<i> 
</I>&gt;&gt;<i> Something like:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * ipcache_addrs::in_addrs becomes a list of rfc1035_rr instead of array
</I>&gt;&gt;<i> if IP address. (or an equivalent type storing the same details in easier
</I>&gt;&gt;<i> to access type than 'rdata' uses).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * ipcache_addrs::bad_mask moved into rfc1035_rr for a mask on the
</I>&gt;&gt;<i> records in each RR separately.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * ipcache_addrs merged into Dns::LookupDetails.
</I>&gt;<i> 
</I>&gt;<i> That sounds mostly unrelated to the problem at hand. If we need to alter
</I>&gt;<i> Dns::LookupDetails, ipcache_addrs, or rfc1035_rr in some significant
</I>&gt;<i> way, then we will come back to this discussion. Otherwise, it stays as a
</I>&gt;<i> separate/independent not-yet-discussed project.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> The serverDestinations not changing (yet).
</I>&gt;<i> 
</I>&gt;<i> I am pretty sure we have to change that field to implement
</I>&gt;<i> dns_wait_for_all functionality correctly. For example:
</I>&gt;<i> 
</I>&gt;<i> * we need to make its updates (from different jobs!) safe, with
</I>&gt;<i> easy-to-trace debugging.
</I>&gt;<i> 
</I>&gt;<i> * we need to support an EOF-like semantics to signal whether more
</I>&gt;<i> destinations may still be provided.
</I>

I think you are mistaking serverDestinations as being part of the DNS
operations. It is not.

serverDestinations is state in the FwdStateData 'Job', the IP addresses
used by it have to go through the peer selection 'Job' processing and
related access controls applied to whatever comes out of an ipcache
lookup 'Job'.

DNS lookups are buried 3+ 'Job' layers away on the other side of
ipcache. All they do is feed that cache with data.

If you are intending to alter serveDestinations operations, then please
dont call the option dns_* . It is a tcp_outgoing_* thing.

Amos

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006860.html">[squid-dev] [RFC] dns_wait_for_all
</A></li>
	<LI>Next message: <A HREF="006879.html">[squid-dev] [RFC] dns_wait_for_all
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6877">[ date ]</a>
              <a href="thread.html#6877">[ thread ]</a>
              <a href="subject.html#6877">[ subject ]</a>
              <a href="author.html#6877">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
