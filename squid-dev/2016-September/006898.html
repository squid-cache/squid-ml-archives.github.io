<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] polish Config2 using C++11 features
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20polish%20Config2%20using%20C%2B%2B11%20features&In-Reply-To=%3Cc0a87cc9-1b8a-a928-a663-33022f7d2575%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="006894.html">
   <LINK REL="Next"  HREF="006900.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] polish Config2 using C++11 features</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20polish%20Config2%20using%20C%2B%2B11%20features&In-Reply-To=%3Cc0a87cc9-1b8a-a928-a663-33022f7d2575%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] polish Config2 using C++11 features">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Sep 30 15:38:03 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="006894.html">[squid-dev] Build failed in Jenkins: trunk-full-matrix » clang,d-ubuntu-wily #238
</A></li>
        <LI>Next message: <A HREF="006900.html">[squid-dev] [PATCH] polish Config2 using C++11 features
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6898">[ date ]</a>
              <a href="thread.html#6898">[ thread ]</a>
              <a href="subject.html#6898">[ subject ]</a>
              <a href="author.html#6898">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We now seem to have had several patches successfully use members
declared with default values and/or with the &quot;*this = Foo();&quot; shortcut
for a reset/clear method.

So I think we can start using these to replace old C-style
initialization and clear() functions.

This patch begins by replacing the Config2 use of memset(). I for one am
constantly mistaking which of the Config objects has memset() applied to
it at the global level when reconfigure happens. Now we do not need to
care, each object handles its own clearing one way or another.

Amos
-------------- next part --------------
=== modified file 'src/SquidConfig.h'
--- src/SquidConfig.h	2016-09-20 12:41:25 +0000
+++ src/SquidConfig.h	2016-09-30 14:54:55 +0000
@@ -547,11 +547,15 @@
 class SquidConfig2
 {
 public:
+    void clear() {
+        *this = SquidConfig2();
+    }
+
     struct {
-        int enable_purge;
+        int enable_purge = 0;
     } onoff;
-    uid_t effectiveUserID;
-    gid_t effectiveGroupID;
+    uid_t effectiveUserID = 0;
+    gid_t effectiveGroupID = 0;
 };
 
 extern SquidConfig2 Config2;

=== modified file 'src/cache_cf.cc'
--- src/cache_cf.cc	2016-09-21 18:54:45 +0000
+++ src/cache_cf.cc	2016-09-30 14:52:10 +0000
@@ -613,7 +613,7 @@
 static void
 configDoConfigure(void)
 {
-    memset(&amp;Config2, '\0', sizeof(SquidConfig2));
+    Config2.clear();
     /* init memory as early as possible */
     memConfigure();
     /* Sanity checks */

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006894.html">[squid-dev] Build failed in Jenkins: trunk-full-matrix » clang,d-ubuntu-wily #238
</A></li>
	<LI>Next message: <A HREF="006900.html">[squid-dev] [PATCH] polish Config2 using C++11 features
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6898">[ date ]</a>
              <a href="thread.html#6898">[ thread ]</a>
              <a href="subject.html#6898">[ subject ]</a>
              <a href="author.html#6898">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
