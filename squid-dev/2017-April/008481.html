<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [RFC] nullptr conversion (again)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20nullptr%20conversion%20%28again%29&In-Reply-To=%3C281995fc-d0bb-358e-341e-9229fff92773%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008478.html">
   <LINK REL="Next"  HREF="008490.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [RFC] nullptr conversion (again)</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20nullptr%20conversion%20%28again%29&In-Reply-To=%3C281995fc-d0bb-358e-341e-9229fff92773%40treenet.co.nz%3E"
       TITLE="[squid-dev] [RFC] nullptr conversion (again)">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Apr 12 17:39:38 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008478.html">[squid-dev] [RFC] nullptr conversion (again)
</A></li>
        <LI>Next message: <A HREF="008490.html">[squid-dev] [RFC] nullptr conversion (again)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8481">[ date ]</a>
              <a href="thread.html#8481">[ thread ]</a>
              <a href="subject.html#8481">[ subject ]</a>
              <a href="author.html#8481">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 13/04/2017 4:10 a.m., Alex Rousskov wrote:
&gt;<i> On 04/12/2017 09:53 AM, Amos Jeffries wrote:
</I>&gt;&gt;<i> I have been thinking of this again and think I have come up with a way
</I>&gt;&gt;<i> to make some better progress.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The idea is to split the NULL -&gt; nullptr changes into two groups:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 1) those lines where sed s/nullptr/NULL/g can be used to reverse the
</I>&gt;&gt;<i> change completely in backports to 3.x
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 2) everything else. Some refactor is needed so that can stay with the
</I>&gt;&gt;<i> current as-touched policy.
</I>&gt;<i> 
</I>&gt;<i> ...
</I>&gt;<i> 
</I>&gt;&gt;<i> Forward-porting of code will still have some merge related pain
</I>&gt;<i> 
</I>&gt;<i> Other sources of pain will include &quot;v5 to v4&quot; and &quot;v5 to any v5-based
</I>&gt;<i> branch&quot; porting AFAICT.
</I>
Any collisions there will be the lines I bring up in audit as needing
changes to remove the NULL anyway. So the choice is one-off pain now or
delays plus extra pain and maybe extra re-testing in audit.


So, &quot;bzr merge --take-this -c... &quot; handles the merge from the main
branch painlessly and the leftover lines are the above set. So a few
minutes checking the &quot;bzr diff -rsubmit: &quot; patch after the merge is time
spent reducing the audit pain.


&gt;<i> 
</I>&gt;<i> Is it really difficult to write a script that will rename most NULLs
</I>&gt;<i> that are safe to rename without breaking anything? Perhaps I am
</I>&gt;<i> forgetting some context here, but what is the primary reason why making
</I>&gt;<i> such a script is so difficult?
</I>&gt;<i> 
</I>
IMO it is pointlessly simple or too complex to do.

The 'pointlessly simple' part is that;

a) branches can use &quot;bzr merge --take-this -cNN ...&quot; and the hunks/lines
which are ignored are the ones which need manual attention or they will
impact the audit anyway as mentioend above.

b) patches can (usually) use sed NULL/nullptr or the reverse.

NP: This is actually *less* painful when dealing with fully converted vs
non-converted code. So our partial drip-feeding of changes to mainline
is actively preventing this simple handling of some patches.


The 'too complex' part is where major refactoring is needed with change
spread over multiple files. Such as the C++11 initialization sequence
cleanups. It is a bit mind-numbingly for me/us manually but a script to
do that right every time would be effectively AI.


My main aim in this proposal is to try and reduce the signal-to-noise
ratio as it were when we see a NULL still in the code. If I can get this
work agreed and applied then the remaining NULL's become another useful
tag we or beginners can grep for (like TODO or XXX) that finds small-ish
things to do. While the compilers meanwhile get their tiny smidge of
extra optimization.

Amos

</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008478.html">[squid-dev] [RFC] nullptr conversion (again)
</A></li>
	<LI>Next message: <A HREF="008490.html">[squid-dev] [RFC] nullptr conversion (again)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8481">[ date ]</a>
              <a href="thread.html#8481">[ thread ]</a>
              <a href="subject.html#8481">[ subject ]</a>
              <a href="author.html#8481">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
