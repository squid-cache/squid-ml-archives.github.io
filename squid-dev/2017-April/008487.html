<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [RFC] Changes to http_access defaults
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20Changes%20to%20http_access%20defaults&In-Reply-To=%3C9c01ab9e-6f7f-2e82-b3e2-9e1220c26d30%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008482.html">
   <LINK REL="Next"  HREF="008483.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [RFC] Changes to http_access defaults</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20Changes%20to%20http_access%20defaults&In-Reply-To=%3C9c01ab9e-6f7f-2e82-b3e2-9e1220c26d30%40measurement-factory.com%3E"
       TITLE="[squid-dev] [RFC] Changes to http_access defaults">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Apr 13 01:15:22 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008482.html">[squid-dev] [RFC] Changes to http_access defaults
</A></li>
        <LI>Next message: <A HREF="008483.html">[squid-dev] TLS session extended data
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8487">[ date ]</a>
              <a href="thread.html#8487">[ thread ]</a>
              <a href="subject.html#8487">[ subject ]</a>
              <a href="author.html#8487">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 04/12/2017 12:16 PM, Amos Jeffries wrote:

&gt;<i> Changes to http_access defaults
</I>
Clearly stating what you are trying to accomplish with these changes may
help others evaluate your proposal. Your initial email focuses on _how_
you are going to accomplish some implied/vague goal. What is the goal here?


&gt;<i> I have become convinced that Squid always checks those
</I>&gt;<i> security rules, then do the custom access rules. All other orderings
</I>&gt;<i> seem to have turned out to be problematic and security-buggy in some
</I>&gt;<i> edge cases or another.
</I>
s/Squid always checks/Squid should always check/


&gt;<i> What are peoples opinions about making the following items built-in
</I>&gt;<i> defaults?
</I>&gt;<i> 
</I>&gt;<i>  acl Safe_ports port 21 80 443
</I>&gt;<i>  acl CONNECT_ports port 443
</I>&gt;<i>  acl CONNECT method CONNECT
</I>&gt;<i> 
</I>&gt;<i>  http_acces deny !Safe_ports
</I>&gt;<i>  http_access deny CONNECT !CONNECT_ports
</I>
&gt;<i> The above change will have some effect on installations that try to use
</I>&gt;<i> an empty squid.conf.
</I>
And on many other existing installations, of course, especially on those
with complex access rules which are usually the most difficult to
modify/adjust. In other words, this is a pretty serious change.


&gt;<i> If the proposal goes ahead some extra additions
</I>&gt;<i> would be included to retain that default-reject behaviour.
</I>
It is difficult to properly evaluate your proposal until it details how
one would be able to override the proposed defaults. These defaults, in
some shape or form, make sense for most installations, of course. The
difficult parts are:

* minimizing surprises (e.g, when the hidden defaults change, are wrong,
and/or interact with deny_info rules in surprising ways);

* avoiding configurations that compute essentially the same rules
multiple times (hidden defaults + explicit defaults); and

* designing a configuration approach to overwrite defaults without
either screwing up a lot of admins or virtually eliminating the positive
effect of those defaults in new configurations.


To address the last bullet, we could add a

  deny_unsafe_ports &lt;on|off&gt;

directive.

If that directive is &quot;on&quot; by default [for any squid.conf that does not
define a Safe_ports ACL??], then it does not address the first two
bullets well.

Perhaps it should be off by default but explicitly added (and turned
&quot;on&quot;) to every newly generated squid.conf.default?


Also, how will the http_access rules in newly generated
squid.conf.default look like if we add default http_access rules?


I am worried that adding hidden default http_access rules will make
things overall worse rather than solving the problem you are trying to
solve. I wonder if fiddling with http_access internals might be the
wrong direction here.


Thank you,

Alex.

</PRE>























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008482.html">[squid-dev] [RFC] Changes to http_access defaults
</A></li>
	<LI>Next message: <A HREF="008483.html">[squid-dev] TLS session extended data
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8487">[ date ]</a>
              <a href="thread.html#8487">[ thread ]</a>
              <a href="subject.html#8487">[ subject ]</a>
              <a href="author.html#8487">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
