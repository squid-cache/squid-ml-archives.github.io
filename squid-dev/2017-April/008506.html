<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [RFC] CRUSH peer selection method
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20CRUSH%20peer%20selection%20method&In-Reply-To=%3C2b6167a5-5ae4-2407-8d4f-ad90ddb470ff%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008505.html">
   <LINK REL="Next"  HREF="008507.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [RFC] CRUSH peer selection method</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20CRUSH%20peer%20selection%20method&In-Reply-To=%3C2b6167a5-5ae4-2407-8d4f-ad90ddb470ff%40measurement-factory.com%3E"
       TITLE="[squid-dev] [RFC] CRUSH peer selection method">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Apr 17 18:34:16 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008505.html">[squid-dev] [RFC] CRUSH peer selection method
</A></li>
        <LI>Next message: <A HREF="008507.html">[squid-dev] [RFC] CRUSH peer selection method
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8506">[ date ]</a>
              <a href="thread.html#8506">[ thread ]</a>
              <a href="subject.html#8506">[ subject ]</a>
              <a href="author.html#8506">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 04/17/2017 10:53 AM, Loic Dachary wrote:
&gt;<i> On 04/17/2017 06:28 PM, Alex Rousskov wrote:
</I>&gt;&gt;<i> On 04/17/2017 09:08 AM, Loic Dachary wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>   peer 1 targeted by a set of requests (X1)
</I>&gt;&gt;&gt;<i>   peer 2 targeted by a set of requests (X2)
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> and we add a new peer, CRUSH makes it so 1/3 of the requests from peer 1 and 2 move to peer 3
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>   peer 1 targeted by a set of requests (2/3 of X1)
</I>&gt;&gt;&gt;<i>   peer 2 targeted by a set of requests (2/3 of X2)
</I>&gt;&gt;&gt;<i>   peer 3 targeted by a set of requests (1/3 of X1 + 1/3 of X2)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> How would the last three lines look for CARP and sourcehash?
</I>

&gt;<i> I'm not sure :-) But I could write a simulation to figure it out.
</I>&gt;<i> Unless I missed a part of src/carp.cc that mitigates the problem, the
</I>&gt;<i> situation should not be very different from what is described at
</I>&gt;<i> <A HREF="https://docs.openstack.org/developer/swift/ring_background.html#part-2">https://docs.openstack.org/developer/swift/ring_background.html#part-2</A>
</I>
It is totally up to you whether to do anything else. FWIW, AFAICT:

* only math (not simulation) is needed to show that any &quot;peer =
request_hash % n&quot; mapping algorithm (where &quot;n&quot; is the number of peers)
may result in a lot of &quot;moved&quot; request:peer assignments;

* many folks do not know whether CRUSH, CARP and sourcehash use a &quot;peer
= request_hash % n&quot; mapping algorithm (you should say that explicitly);

* it would be both interesting and useful to know how the amount of
&quot;movement&quot; changes with &quot;n&quot; in all compared algorithms (e.g., should I
bother with CRUSH if I have 10 peers?);

* do not assume that we know that a 1/3 movement shown by CRUSH (for
n=2) is a lot less than some X shown by CARP (for the same &quot;n&quot;);

* disclose the price of the reduction of movement (e.g., &quot;a few RAM
bytes per peer to store the more complex mapping and a few CPU cycles to
find the right peer for each request&quot;).

Perhaps your article already addresses all these concerns, but if you
want others to be enthusiastic about CRUSH, it may help to distill its
advantages and costs to something one can grasp by reading a
two-paragraph email with an easy-to-grok table.


HTH,

Alex.

</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008505.html">[squid-dev] [RFC] CRUSH peer selection method
</A></li>
	<LI>Next message: <A HREF="008507.html">[squid-dev] [RFC] CRUSH peer selection method
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8506">[ date ]</a>
              <a href="thread.html#8506">[ thread ]</a>
              <a href="subject.html#8506">[ subject ]</a>
              <a href="author.html#8506">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
