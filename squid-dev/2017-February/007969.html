<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] VIA creation code duplication
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20VIA%20creation%20code%20duplication&In-Reply-To=%3C17361b6f-fc89-dfe7-af96-de2bf1c58478%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="007952.html">
   <LINK REL="Next"  HREF="007972.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] VIA creation code duplication</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20VIA%20creation%20code%20duplication&In-Reply-To=%3C17361b6f-fc89-dfe7-af96-de2bf1c58478%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] VIA creation code duplication">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Feb  9 17:19:13 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="007952.html">[squid-dev] [PATCH] VIA creation code duplication
</A></li>
        <LI>Next message: <A HREF="007972.html">[squid-dev] [PATCH] VIA creation code duplication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7969">[ date ]</a>
              <a href="thread.html#7969">[ thread ]</a>
              <a href="subject.html#7969">[ subject ]</a>
              <a href="author.html#7969">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 3/02/2017 4:02 a.m., Eduard Bagdasaryan wrote:
&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> This patch fixes VIA appending code duplication, moving common
</I>&gt;<i> code into a separate method.
</I>&gt;<i> 
</I>
Since Via is a list header we should be able to just append a new Via
header to the header list with putStr. No need to use getList, String,
delById to inject on the end of existing Via string.

Please also take the opportunity to fix a long standing protocol
violation bug in Via header produced by Squid:
 The version part of the header is only supposed to elide the protocol
label if the that label would be &quot;HTTP/&quot; (ie. for messages received via
HTTP and HTTPS).

eg. for ICY replies:
  Via: ICY/1.1 squid

eg. for FTP gatewayed replies (or relayed requests):
  Via: FTP/2 squid


After those calls that require String are gone please assemble the value
in an SBuf instead of static char* buffer.

Also, for messages where Squid itself generated the message (ie
Downloader or ESI) there should be no Via header added at all.

Amos

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007952.html">[squid-dev] [PATCH] VIA creation code duplication
</A></li>
	<LI>Next message: <A HREF="007972.html">[squid-dev] [PATCH] VIA creation code duplication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7969">[ date ]</a>
              <a href="thread.html#7969">[ thread ]</a>
              <a href="subject.html#7969">[ subject ]</a>
              <a href="author.html#7969">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
