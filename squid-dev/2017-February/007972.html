<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] VIA creation code duplication
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20VIA%20creation%20code%20duplication&In-Reply-To=%3C4c4c28f1-dbc5-1cc8-bf08-1258ba846bb7%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="007969.html">
   <LINK REL="Next"  HREF="007973.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] VIA creation code duplication</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20VIA%20creation%20code%20duplication&In-Reply-To=%3C4c4c28f1-dbc5-1cc8-bf08-1258ba846bb7%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] VIA creation code duplication">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Feb 10 16:04:35 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="007969.html">[squid-dev] [PATCH] VIA creation code duplication
</A></li>
        <LI>Next message: <A HREF="007973.html">[squid-dev] [PATCH] VIA creation code duplication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7972">[ date ]</a>
              <a href="thread.html#7972">[ thread ]</a>
              <a href="subject.html#7972">[ subject ]</a>
              <a href="author.html#7972">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 02/09/2017 10:19 AM, Amos Jeffries wrote:
&gt;<i> On 3/02/2017 4:02 a.m., Eduard Bagdasaryan wrote:
</I>&gt;&gt;<i> This patch fixes VIA appending code duplication, moving common
</I>&gt;&gt;<i> code into a separate method.
</I>
&gt;<i> Since Via is a list header we should be able to just append a new Via
</I>&gt;<i> header to the header list with putStr. No need to use getList, String,
</I>&gt;<i> delById to inject on the end of existing Via string.
</I>&gt;<i> 
</I>&gt;<i> Please also take the opportunity to fix a long standing protocol
</I>&gt;<i> violation bug in Via header produced by Squid:
</I>&gt;<i>  The version part of the header is only supposed to elide the protocol
</I>&gt;<i> label if the that label would be &quot;HTTP/&quot; (ie. for messages received via
</I>&gt;<i> HTTP and HTTPS).
</I>&gt;<i> 
</I>&gt;<i> eg. for ICY replies:
</I>&gt;<i>   Via: ICY/1.1 squid
</I>&gt;<i> 
</I>&gt;<i> eg. for FTP gatewayed replies (or relayed requests):
</I>&gt;<i>   Via: FTP/2 squid
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> After those calls that require String are gone please assemble the value
</I>&gt;<i> in an SBuf instead of static char* buffer.
</I>&gt;<i> 
</I>&gt;<i> Also, for messages where Squid itself generated the message (ie
</I>&gt;<i> Downloader or ESI) there should be no Via header added at all.
</I>

Also, please fix the 10 oldest open bugs on Squid Bugzilla while you are
at it.&lt;/sarcasm&gt;

IMHO, you may declare any and all of the changes requested by Amos to be
outside the scope of the code deduplication patch you have prepared.
Your patch is valuable even with its current narrow scope. If the patch
has no problems, it should be acceptable &quot;as is&quot;. Amos, if you disagree
with this assessment, please say so.

It is your call which additional changes/improvements to implement (and
become responsible for), but my personal recommendation is to treat any
risky changes and any desirable changes visible outside addVia() as
separate issues/projects/TODOs because they probably require
careful/focused consideration and dedicated commits.


Thank you,

Alex.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007969.html">[squid-dev] [PATCH] VIA creation code duplication
</A></li>
	<LI>Next message: <A HREF="007973.html">[squid-dev] [PATCH] VIA creation code duplication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7972">[ date ]</a>
              <a href="thread.html#7972">[ thread ]</a>
              <a href="subject.html#7972">[ subject ]</a>
              <a href="author.html#7972">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
