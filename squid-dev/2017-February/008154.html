<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] How Squid parse the configuration file?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20How%20Squid%20parse%20the%20configuration%20file%3F&In-Reply-To=%3C7b53db4b-61e3-fd28-6a6d-d45dcc8f36fd%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008149.html">
   <LINK REL="Next"  HREF="008180.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] How Squid parse the configuration file?</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20How%20Squid%20parse%20the%20configuration%20file%3F&In-Reply-To=%3C7b53db4b-61e3-fd28-6a6d-d45dcc8f36fd%40measurement-factory.com%3E"
       TITLE="[squid-dev] How Squid parse the configuration file?">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Feb 21 16:52:09 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008149.html">[squid-dev] How Squid parse the configuration file?
</A></li>
        <LI>Next message: <A HREF="008180.html">[squid-dev] How Squid parse the configuration file?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8154">[ date ]</a>
              <a href="thread.html#8154">[ thread ]</a>
              <a href="subject.html#8154">[ subject ]</a>
              <a href="author.html#8154">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 02/21/2017 01:15 AM, 周书林 wrote:
&gt;<i> I found the src/cf.data.pre file, and read the content. But I still want
</I>&gt;<i> to know how squid use this file to build the connection between the
</I>&gt;<i> config file and the source code. 
</I>
As you already know, the parser is generated. The generated code either
places parsed values directly into the global Config object or calls
some helper functions that update the global state. (Updating global
state during parsing is very wrong but that is a different story.)

If you want to see the actual generated parsing code for a given
squid.conf directive, just grep for it! For example,

  $ fgrep -A5 -RI maximum_object_size_in_memory src

will point you to the following code in src/cf_parser.cci:

&gt;<i> src/cf_parser.cci:    if (!strcmp(token, &quot;maximum_object_size_in_memory&quot;)) {
</I>&gt;<i> src/cf_parser.cci:        cfg_directive = &quot;maximum_object_size_in_memory&quot;;
</I>&gt;<i> src/cf_parser.cci-        parse_b_size_t(&amp;Config.Store.maxInMemObjSize);
</I>&gt;<i> src/cf_parser.cci-        cfg_directive = NULL;
</I>&gt;<i> src/cf_parser.cci-        return 1;
</I>

How was that code generated? Search for &quot;cfg_directive = NULL&quot; to find
the parser generator code in the repository:

  $ bzr grep 'cfg_directive = NULL'

&gt;<i> src/cf_gen.cc:    fout &lt;&lt; &quot;        cfg_directive = NULL;&quot; &lt;&lt; std::endl;
</I>
which will point you to the Entry::genParseAlias() method.


HTH,

Alex.



&gt;<i> 2017-01-13 22:14 GMT+08:00 Stuart Henderson:
</I>&gt;<i> 
</I>&gt;<i>     On 2017-01-13, 周书林 &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">zhoushulin1992 at gmail.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">zhoushulin1992 at gmail.com</A>&gt;&gt; wrote:
</I>&gt;<i>     &gt; Why some of the configuration directives in official website cannot find in
</I>&gt;<i>     &gt; the source code? Some could find a relevant program variable in Class
</I>&gt;<i>     &gt; SquidConfig, while majority of the configuration directives cannot be found
</I>&gt;<i>     &gt; in the source code, for example , directive &quot;announce_port&quot;.
</I>&gt;<i>     &gt; So how does Squid parse the configuration file of Users, and use them in
</I>&gt;<i>     &gt; the source code?
</I>&gt;<i> 
</I>&gt;<i>     The parser, sample config, etc, are all generated from src/cf.data.pre.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     _______________________________________________
</I>&gt;<i>     squid-dev mailing list
</I>&gt;<i>     <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev at lists.squid-cache.org</A> &lt;mailto:<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev at lists.squid-cache.org</A>&gt;
</I>&gt;<i>     <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">http://lists.squid-cache.org/listinfo/squid-dev</A>
</I>&gt;<i>     &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">http://lists.squid-cache.org/listinfo/squid-dev</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-dev mailing list
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">http://lists.squid-cache.org/listinfo/squid-dev</A>
</I>&gt;<i> 
</I>
</PRE>







































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008149.html">[squid-dev] How Squid parse the configuration file?
</A></li>
	<LI>Next message: <A HREF="008180.html">[squid-dev] How Squid parse the configuration file?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8154">[ date ]</a>
              <a href="thread.html#8154">[ thread ]</a>
              <a href="subject.html#8154">[ subject ]</a>
              <a href="author.html#8154">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
