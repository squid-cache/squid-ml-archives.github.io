<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PREVIEW] Response delay pools
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPREVIEW%5D%20Response%20delay%20pools&In-Reply-To=%3C7868d08a-6953-4a48-80c0-dbe799b74ca5%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="007760.html">
   <LINK REL="Next"  HREF="007764.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PREVIEW] Response delay pools</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPREVIEW%5D%20Response%20delay%20pools&In-Reply-To=%3C7868d08a-6953-4a48-80c0-dbe799b74ca5%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PREVIEW] Response delay pools">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Jan  9 06:33:10 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="007760.html">[squid-dev] [PATCH] remove --disable-inline and related macros
</A></li>
        <LI>Next message: <A HREF="007764.html">[squid-dev] [PREVIEW] Response delay pools
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7758">[ date ]</a>
              <a href="thread.html#7758">[ thread ]</a>
              <a href="subject.html#7758">[ subject ]</a>
              <a href="author.html#7758">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 24/12/2016 9:26 p.m., Eduard Bagdasaryan wrote:
&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> This patch introduces a new &quot;response_delay_pools&quot; feature.
</I>&gt;<i> The feature restricts Squid-to-client bandwidth and applies to both
</I>&gt;<i> cache hits and misses.
</I>&gt;<i> 
</I>&gt;<i> When Squid starts delivering the final HTTP response to a client, Squid
</I>&gt;<i> checks response_delay_pool_access rules (supporting fast ACLs only), in
</I>&gt;<i> the order they were declared. The first rule with a matching ACL wins.
</I>&gt;<i> If (and only if) an &quot;allow&quot; rule won, Squid assigns the response to the
</I>&gt;<i> corresponding named delay pool.
</I>&gt;<i> 
</I>&gt;<i> If a response is assigned to a delay pool, the response becomes subject
</I>&gt;<i> to the configured bucket and aggregate bandwidth limits of that pool,
</I>&gt;<i> similar to the current &quot;class 2&quot; server-side delay pools, but with a
</I>&gt;<i> brand new, dedicated &quot;individual&quot; filled bucket assigned to the
</I>&gt;<i> matched response.
</I>&gt;<i> 
</I>&gt;<i> The new feature serves the same purpose as the existing client-side
</I>&gt;<i> pools: both features limit Squid-to-client bandwidth. Their common
</I>&gt;<i> interface was placed into a new base BandwidthBucket class.  The
</I>&gt;<i> difference is that client-side pools do not aggregate clients and always
</I>&gt;<i> use one bucket per client IP. It is possible that a response becomes a
</I>&gt;<i> subject of both these pools. In such situations only matched response
</I>&gt;<i> delay pool will be used for Squid-to-client speed limiting.
</I>&gt;<i> 
</I>&gt;<i> The accurate SMP support (with the aggregate bucket shared among
</I>&gt;<i> workers) is outside this patch scope. In SMP configurations,
</I>&gt;<i> Squid should automatically divide the aggregate_speed_limit and
</I>&gt;<i> max_aggregate_size values among the configured number of Squid
</I>&gt;<i> workers.
</I>&gt;<i> 
</I>&gt;<i> I have not synced with last v5 yet: this patch applies to v4 r14793.
</I>&gt;<i> To speed up the process and initiate the discussion I am posting with
</I>&gt;<i> &quot;preview&quot; flag and meanwhile start merging with the current v5 version.
</I>&gt;<i> 
</I>
Thanks. Sorry I didn't get a chance to look at it yet. That should now
happen in the next few days.

Can you please add to the above an explanation of why this is being
added instead of improving ways to send TOS/NFMARK to feed the system
QoS bandwidth controls. We really should not be re-inventing QoS in
Squid (for about the third time AFAICT).

Amos
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007760.html">[squid-dev] [PATCH] remove --disable-inline and related macros
</A></li>
	<LI>Next message: <A HREF="007764.html">[squid-dev] [PREVIEW] Response delay pools
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7758">[ date ]</a>
              <a href="thread.html#7758">[ thread ]</a>
              <a href="subject.html#7758">[ subject ]</a>
              <a href="author.html#7758">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
