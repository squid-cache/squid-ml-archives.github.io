<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Digest Auth support for LDAP HA1 attribute without realm
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Digest%20Auth%20support%20for%20LDAP%20HA1%20attribute%0A%20without%20realm&In-Reply-To=%3Cb0987de8-ba9a-2615-e0f2-929744a36a99%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="007813.html">
   <LINK REL="Next"  HREF="007908.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Digest Auth support for LDAP HA1 attribute without realm</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Digest%20Auth%20support%20for%20LDAP%20HA1%20attribute%0A%20without%20realm&In-Reply-To=%3Cb0987de8-ba9a-2615-e0f2-929744a36a99%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] Digest Auth support for LDAP HA1 attribute without realm">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Jan 29 13:33:15 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="007813.html">[squid-dev] [PATCH] Digest Auth support for LDAP HA1 attribute without realm
</A></li>
        <LI>Next message: <A HREF="007908.html">[squid-dev] [PATCH] Digest Auth support for LDAP HA1 attribute without realm
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7884">[ date ]</a>
              <a href="thread.html#7884">[ thread ]</a>
              <a href="subject.html#7884">[ subject ]</a>
              <a href="author.html#7884">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 21/01/2017 2:05 a.m., FUSTE Emmanuel wrote:
&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> We have to support many historic digest auth implementation for which
</I>&gt;<i> the realm is not included in the digest password attribute:
</I>&gt;<i> The password is effectively stored as &quot;HA1&quot; instead of &quot;REALM:HA1&quot;.
</I>&gt;<i> I would like to kill our own homegrown helpers and use the Squid
</I>&gt;<i> provided one.
</I>&gt;<i>
</I>&gt;<i>   Is something like the attached patch is acceptable/could be included
</I>&gt;<i> in a future Squid release ?
</I>&gt;<i>
</I>&gt;<i> Best regards,
</I>&gt;<i> Emmanuel.
</I>&gt;<i> --
</I>

Sorry it has taken me so long to respond on this. I wanted to verify the
importance of realm in the H(A1) digest. Why it was marked as REQUIRED
to begin with.

Sadly I have to report my suspicion was correct and I vote -1 on this in
its current form. BUT I can think of two ways to get around it, see end
of this mail.


The problems are that;
 1) the realm is both the salting value used within the hash and the
scope limitation on what inputs from HTTP are used to compare against
the A1, and
 2) Squid does not itself verify the realm received was the one offered
and leaves the comparison to the backend system. There is some
possibility the authentication system is using multiple security realms
and Squids realm string is just an offer.


Not having realm tied to the credentials in the backend storage leaves
this particular helper with no other option but to trust the realm sent
(probably) over clear-text by any client/attacker actually matches the
salting. That allows remote senders to manipulate the realm string they
send to perform a collision attack against the stored password.
 They no longer have to find and prove knowledge of the password. But
just find a collision for its hash vs arbitrary realm strings.

Old Digest systems are not the safest things to begin with. They also
tend to use MD5 hashing which was the only one available for many years
and relatively easy to find collisions for.



Workaround #1:

Is there just one (or a few) realm that all your stored passwords use?

I think we can accept the absence of realm per-password if there were a
global realm to check against instead. A command line option could be
added to pass an explicit realm (or multiple?) which the helper can use
to reject the possible attacks.


Workaround #2:

Emmanuel;  are you able to easily implement a LDAP field that adds a
second 'realm:password' value to the LDAP for this helper to check for
without changes?

That is probably the best approach long-term. AFAIK realm:HA1 is a
fairly standard format for modern Digest systems so it may be neeed
anyway for other software than Squid.

Amos

</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007813.html">[squid-dev] [PATCH] Digest Auth support for LDAP HA1 attribute without realm
</A></li>
	<LI>Next message: <A HREF="007908.html">[squid-dev] [PATCH] Digest Auth support for LDAP HA1 attribute without realm
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7884">[ date ]</a>
              <a href="thread.html#7884">[ thread ]</a>
              <a href="subject.html#7884">[ subject ]</a>
              <a href="author.html#7884">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
