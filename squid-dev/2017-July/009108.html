<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATH] Convert the URL::parse method API to take const	URI strings
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATH%5D%20Convert%20the%20URL%3A%3Aparse%20method%20API%20to%20take%20const%0A%09URI%20strings&In-Reply-To=%3C3604de63-5265-102f-d6c7-18d3e6fc4567%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="009106.html">
   <LINK REL="Next"  HREF="009110.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATH] Convert the URL::parse method API to take const	URI strings</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATH%5D%20Convert%20the%20URL%3A%3Aparse%20method%20API%20to%20take%20const%0A%09URI%20strings&In-Reply-To=%3C3604de63-5265-102f-d6c7-18d3e6fc4567%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATH] Convert the URL::parse method API to take const	URI strings">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Jul  8 16:36:47 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="009106.html">[squid-dev] Problems with item delivery, n.9346452
</A></li>
        <LI>Next message: <A HREF="009110.html">[squid-dev] [PATH] Convert the URL::parse method API to take const URI strings
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9108">[ date ]</a>
              <a href="thread.html#9108">[ thread ]</a>
              <a href="subject.html#9108">[ subject ]</a>
              <a href="author.html#9108">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The input buffer is no longer truncated when overly long. All callers 
have been checked that they handle the bool false return value in ways 
that do not rely on that truncation.

Callers that were making non-const copies of buffers specifically for 
the parsing stage are altered not to do so. This allows a few data 
copies and allocations to be removed entirely, or delayed to remove from 
error handling paths.


While checking all the callers of Http::FromUrl several places were 
found to be using the &quot;raw&quot; URL string before the parsing and validation 
was done. The simplest in src/mime.cc is already applied to v5 r15234. A 
more complicated redesign in src/store_digest.cc is included here for 
review. One other marked with an &quot;XXX: polluting ...&quot; note.


Also, added several TODO's to mark code where class URL needs to be used 
when the parser is a bit more efficient.

Also, removed a leftover definition of already removed urlParse() function.


Amos
-------------- next part --------------
A non-text attachment was scrubbed...
Name: url_const_parser_mk1.patch
Type: text/x-patch
Size: 15059 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20170709/992e9fb7/attachment.bin">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20170709/992e9fb7/attachment.bin</A>&gt;
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009106.html">[squid-dev] Problems with item delivery, n.9346452
</A></li>
	<LI>Next message: <A HREF="009110.html">[squid-dev] [PATH] Convert the URL::parse method API to take const URI strings
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9108">[ date ]</a>
              <a href="thread.html#9108">[ thread ]</a>
              <a href="subject.html#9108">[ subject ]</a>
              <a href="author.html#9108">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
