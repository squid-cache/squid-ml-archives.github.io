<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Fix SSL certificate cache refresh and collision handling.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Fix%20SSL%20certificate%20cache%20refresh%20and%0A%20collision%20handling.&In-Reply-To=%3C08a3b6af-1196-35b6-3149-3cf78b087cbc%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="009175.html">
   <LINK REL="Next"  HREF="009180.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Fix SSL certificate cache refresh and collision handling.</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Fix%20SSL%20certificate%20cache%20refresh%20and%0A%20collision%20handling.&In-Reply-To=%3C08a3b6af-1196-35b6-3149-3cf78b087cbc%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] Fix SSL certificate cache refresh and collision handling.">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Jul 14 22:41:17 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="009175.html">[squid-dev] [PATCH] Fix SSL certificate cache refresh and collision	handling.
</A></li>
        <LI>Next message: <A HREF="009180.html">[squid-dev] [PATCH] Fix SSL certificate cache refresh and	collision	handling.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9176">[ date ]</a>
              <a href="thread.html#9176">[ thread ]</a>
              <a href="subject.html#9176">[ subject ]</a>
              <a href="author.html#9176">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07/14/2017 09:18 AM, Christos Tsantilas wrote:
&gt;<i> SslBump was ignoring origin server certificate changes and using the
</I>&gt;<i> previously cached fake certificate (mimicking now-stale properties).
</I>
I suggest replacing the above claim with a more accurate one (based on
our off-list discussions):

&quot;&quot;&quot;
SslBump was ignoring some origin server certificate changes or
differences, incorrectly using the previously cached fake certificate
(mimicking now-stale properties or properties of a slightly different
certificate).
&quot;&quot;&quot;

&gt;<i> +/// \ingroup SslCrtdSslAPI
</I>&gt;<i> +/// \returns certificate database key&quot;
</I>&gt;<i> +std::string &amp;TxtKeyForCertificateProperties(const CertificateProperties &amp;);
</I>
An extra trailing '&quot;'.


&gt;<i> +/**
</I>&gt;<i> +  \ingroup ServerProtocolSSLAPI
</I>&gt;<i> +  * Generates a unique key based on CertificateProperties object and store it to key
</I>&gt;<i> + */
</I>&gt;<i> +void UniqueKeyForCertificateProperties(const Ssl::CertificateProperties &amp;certProperties, SBuf &amp;key);
</I>
&gt;<i>   - Replace Ssl::CertificateProperties::dbKey() with:
</I>&gt;<i>      * Ssl::TxtKeyForCertificateProperties() in ssl/gadgets.cc for
</I>&gt;<i>        on-disk key generation by the ssl_crtd helper;
</I>&gt;<i>      * Ssl::UniqueKeyForCertificateProperties() in ssl/support.cc for
</I>&gt;<i>        in-memory binary keys generation by the SSL context memory cache.
</I>

I think we need to do a better job distinguishing these two functions. I
understand that they make keys (with different sets of features) for two
different databases and that they have to be in different files due to
ssl_crtd linking requirements. I suggest:

* Ssl::OnDiskCertificateDbKey() and Ssl::InRamCertificateDbKey()

or even

* Ssl::DiskDbKey() and Ssl::RamDbKey()


This suggestion also removes the current &quot;unique key&quot; tautology.

I realize that the suggested names do not describe the features of each
key generation method, but neither does the old dbKey() or the new names
in the patch. Those features are too complex to be described in a few
words and, more importantly, are largely irrelevant to the caller.

The above polishing touches can be done during commit.


I cannot track all the low-level changes in the patch, but I agree that
it solves a serious problem, and support the described solution (but I
am biased because I helped design it).


Thank you,

Alex.
</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009175.html">[squid-dev] [PATCH] Fix SSL certificate cache refresh and collision	handling.
</A></li>
	<LI>Next message: <A HREF="009180.html">[squid-dev] [PATCH] Fix SSL certificate cache refresh and	collision	handling.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9176">[ date ]</a>
              <a href="thread.html#9176">[ thread ]</a>
              <a href="subject.html#9176">[ subject ]</a>
              <a href="author.html#9176">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
