<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [RFC] Migrate explicit syslog calls to debugs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20Migrate%20explicit%20syslog%20calls%20to%20debugs&In-Reply-To=%3Cdf728b59-4738-184b-0c9d-bc4ca4b0fadf%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="009238.html">
   <LINK REL="Next"  HREF="009237.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [RFC] Migrate explicit syslog calls to debugs</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20Migrate%20explicit%20syslog%20calls%20to%20debugs&In-Reply-To=%3Cdf728b59-4738-184b-0c9d-bc4ca4b0fadf%40measurement-factory.com%3E"
       TITLE="[squid-dev] [RFC] Migrate explicit syslog calls to debugs">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Jul 31 19:35:32 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="009238.html">[squid-dev] [RFC] Migrate explicit syslog calls to debugs
</A></li>
        <LI>Next message: <A HREF="009237.html">[squid-dev] [PULL REQUEST] Pass-through with-openssl argument
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9242">[ date ]</a>
              <a href="thread.html#9242">[ thread ]</a>
              <a href="subject.html#9242">[ subject ]</a>
              <a href="author.html#9242">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07/31/2017 03:04 AM, Amos Jeffries wrote:
&gt;<i> On 28/07/17 11:12, Alex Rousskov wrote:
</I>&gt;&gt;<i> AFAICT[1], &quot;too long&quot; here means &quot;more than 400 characters&quot; in extreme
</I>&gt;&gt;<i> cases and &quot;more than 2000 characters&quot; in most environments, so any
</I>&gt;&gt;<i> reasonable DBG_CRITICAL and DBG_IMPORTANT messages should be safe. Such
</I>&gt;&gt;<i> messages ought to be brief anyway. And if some overly detailed messages
</I>&gt;&gt;<i> are truncated or wrapped awkwardly, it is not a big deal IMHO.
</I>
&gt;<i> Any log message that mentions a URL (eg a security alert, or a critical
</I>&gt;<i> warning about some transaction-specific thing) may be upwards of 8000
</I>&gt;<i> characters long.
</I>
An even bigger question is whether it is a good idea to log URLs and
similar transaction details at critical/important levels (by default). I
suspect the correct answer is &quot;no, by default, such messages should cite
access.log record IDs and/or internal incident reports instead&quot;, but I
realize that we are a very long way from reaching that ideal, and that
others will probably disagree that it is an &quot;ideal&quot; state, so we will
never reach it anyway.


&gt;<i> In case you missed it, I was not objecting. My point was that you will
</I>&gt;<i> have to review all those 0/1 level outputs to ensure that the maximum
</I>&gt;<i> useful info is output before the truncation point.
</I>
Yes, I gladly noticed that it was not an objection but a design concern.
I agree that it is a valid concern, but I am not yet sure whether it
should be addressed by API or policy. I suspect it is both.

Fortunately, the daemon process where most syslog() messages are written
today does not deal with URLs and similar transaction details, and I am
_not_ proposing that other processes start logging to syslog
automatically (squid -s already gives the admin some control over syslog
logging for other processes). However, I do agree that the change will
make more future debugs() lines suspect. This is why I started asking
questions about addressing that problem.


&gt;<i> FWIW: I have vague recollections of encountering bug reports about one
</I>&gt;<i> syslog implementation causing somebody problems by NOT doing that
</I>&gt;<i> documented truncation, but by slicing the line into multiple parts
</I>&gt;<i> indiscriminantly and prefixing each with the syslog timestamp etc info.
</I>&gt;<i> Words or key=value wrapping at weird places.
</I>
FWIW, I do not think we should invest a lot into improving support for
broken syslog implementations.


&gt;&gt;<i> Do you think that declaring a &quot;keep level-0/1 messages brief&quot; policy
</I>&gt;&gt;<i> would be sufficient here, killing two logging birds with one stone?
</I>
&gt;<i> Not really. The most successful critical messages contain extra text
</I>&gt;<i> telling the admin what they can do. Even the most dumb admin can easily
</I>&gt;<i> get help from more observant people that way.
</I>
The error message may give the admin access to ten pages of information
but remain 200 characters short. Explanations belong to documentation,
and error-specific details can be cached by Squid and then provided via
the cache manager interface (that the error message can link to).


&gt;&gt;&gt;<i> I wonder if the use of clog you suggested years ago to resolve the early
</I>&gt;&gt;&gt;<i> startup messages problems should be fixed first.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I am afraid that fix is currently blocked on your response:
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/pipermail/squid-dev/2017-June/008792.html">http://lists.squid-cache.org/pipermail/squid-dev/2017-June/008792.html</A>
</I>

&gt;<i> Oh? &lt;<A HREF="http://www.squid-cache.org/Versions/v5/changesets/squid-5-15171.patch">http://www.squid-cache.org/Versions/v5/changesets/squid-5-15171.patch</A>&gt;
</I>
Nope, that is a very different patch:

* Blocked: [squid-dev] [PATCH] Do not die silently when dying early
* Committed r15171: Do not die silently when dying via std::terminate()


&gt;<i> IIRC you wanted debugs() to use std::clog instead of std::cerr so that
</I>&gt;<i> the things done before main(), and also the bits before squid.conf
</I>&gt;<i> loading completed could just be buffered then dumped through the
</I>&gt;<i> expected cache.log channel when it became known.
</I>
That idea does not compute for me: The only difference between clog and
cerr is that clog buffers until EOL while cerr does not buffer at all,
but that difference does not allow us to accumulate complete messages.

We could add code to accumulate (while dumping to clog/cerr) and then
log messages (to cache.log), but I see no connection to removing
explicit syslog() calls. Please clarify what that connection is.


Thank you,

Alex.
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009238.html">[squid-dev] [RFC] Migrate explicit syslog calls to debugs
</A></li>
	<LI>Next message: <A HREF="009237.html">[squid-dev] [PULL REQUEST] Pass-through with-openssl argument
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9242">[ date ]</a>
              <a href="thread.html#9242">[ thread ]</a>
              <a href="subject.html#9242">[ subject ]</a>
              <a href="author.html#9242">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
