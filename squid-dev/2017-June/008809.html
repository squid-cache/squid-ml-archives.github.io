<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [POSSIBLE BUG???] &quot;FS Block Size = 1024&quot; printed by cachemgr.cgi
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPOSSIBLE%20BUG%3F%3F%3F%5D%20%22FS%20Block%20Size%20%3D%201024%22%20printed%20by%0A%20cachemgr.cgi&In-Reply-To=%3C7608a126-0ed9-cfac-dac1-263bc8f7a8b2%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008805.html">
   <LINK REL="Next"  HREF="008806.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [POSSIBLE BUG???] &quot;FS Block Size = 1024&quot; printed by cachemgr.cgi</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPOSSIBLE%20BUG%3F%3F%3F%5D%20%22FS%20Block%20Size%20%3D%201024%22%20printed%20by%0A%20cachemgr.cgi&In-Reply-To=%3C7608a126-0ed9-cfac-dac1-263bc8f7a8b2%40measurement-factory.com%3E"
       TITLE="[squid-dev] [POSSIBLE BUG???] &quot;FS Block Size = 1024&quot; printed by cachemgr.cgi">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Jun  9 05:35:40 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008805.html">[squid-dev] [POSSIBLE BUG???] &quot;FS Block Size = 1024&quot; printed by	cachemgr.cgi
</A></li>
        <LI>Next message: <A HREF="008806.html">[squid-dev] [PATCH] Happy Eyeballs: Use each fully resolved destination ASAP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8809">[ date ]</a>
              <a href="thread.html#8809">[ thread ]</a>
              <a href="subject.html#8809">[ subject ]</a>
              <a href="author.html#8809">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 06/08/2017 09:36 PM, St√©phane Ouellette wrote:

&gt;<i> Isn't storeDirGetBlkSize() meant to return the &quot;file system block size&quot;?
</I>
Naturally, storeDirGetBlkSize() is not meant to return the file system
block size.&lt;/sarcasm&gt;

AFAICT, storeDirGetBlkSize() users expect this function to return,
roughly, the disk space occupied by a file containing one byte. That
space is fragment size, not block size (although the two are often the
same).

In other words, the function returns the right value but is misnamed.

In Squid &quot;defense&quot;, I have to note that the names of the statvfs(3)
structure fields have a similar problem:

&gt;<i> struct statvfs {
</I>...
&gt;<i>     unsigned long  f_frsize;   /* Fragment size */
</I>&gt;<i>     fsblkcnt_t     f_blocks;   /* Size of fs in f_frsize units */
</I>

Note how the field called &quot;f_blocks&quot; is actually counting fragments, not
blocks.


FWIW, Squid actually started using the block size (r4727) but that bug
got fixed in ~3 days:

&gt;<i> revno: 4738
</I>&gt;<i> committer: wessels
</I>&gt;<i> branch nick: HEAD
</I>&gt;<i> timestamp: Fri 2001-01-05 02:11:49 +0000
</I>&gt;<i> message:
</I>&gt;<i>   With statvfs, f_bsize means something different.  The fundamental block
</I>&gt;<i>   size element is f_frsize.
</I>

Your patch is essentially undoing that r4738 fix and re-introducing
r4727 bug.


HTH,

Alex.
</PRE>


























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008805.html">[squid-dev] [POSSIBLE BUG???] &quot;FS Block Size = 1024&quot; printed by	cachemgr.cgi
</A></li>
	<LI>Next message: <A HREF="008806.html">[squid-dev] [PATCH] Happy Eyeballs: Use each fully resolved destination ASAP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8809">[ date ]</a>
              <a href="thread.html#8809">[ thread ]</a>
              <a href="subject.html#8809">[ subject ]</a>
              <a href="author.html#8809">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
