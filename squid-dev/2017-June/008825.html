<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] SMP scaling in no_daemon mode?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20SMP%20scaling%20in%20no_daemon%20mode%3F&In-Reply-To=%3Cb9bf4338-162d-74e3-9780-915dc96ce1cc%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008813.html">
   <LINK REL="Next"  HREF="008826.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] SMP scaling in no_daemon mode?</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20SMP%20scaling%20in%20no_daemon%20mode%3F&In-Reply-To=%3Cb9bf4338-162d-74e3-9780-915dc96ce1cc%40measurement-factory.com%3E"
       TITLE="[squid-dev] SMP scaling in no_daemon mode?">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Jun  9 14:23:06 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008813.html">[squid-dev] SMP scaling in no_daemon mode?
</A></li>
        <LI>Next message: <A HREF="008826.html">[squid-dev] SMP scaling in no_daemon mode?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8825">[ date ]</a>
              <a href="thread.html#8825">[ thread ]</a>
              <a href="subject.html#8825">[ subject ]</a>
              <a href="author.html#8825">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 06/09/2017 01:38 AM, Andreas Weigel wrote:

&gt;<i> The
</I>&gt;<i> overall idea was to make the decision to create and manage kids to
</I>&gt;<i> depend on the number of configured workers/diskers. 
</I>
It feels like you may be drifting into a dangerous territory of
fixing/changing &quot;everything&quot; related to SMP. Please stay focused on
fixing --foreground! Fixing --foreground does not change how or whether
kids are created and managed. It only changes who does that.


&gt;<i> But I start to think
</I>&gt;<i> that this is not very wise because it prevents adding worker processes
</I>&gt;<i> by just reloading the configuration? 
</I>
When daemonized, Squid master process does not support reconfiguration
at all. There are plans to change that, but those difficult changes are
completely outside your project scope.


&gt;&gt;<i> * -N: The initial process is a master and a worker process.
</I>&gt;&gt;<i>        No kids.
</I>&gt;&gt;<i>        No daemonimization.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * --foreground: The initial process is the master process.
</I>&gt;&gt;<i>        One or more worker kids (depending on workers=N).
</I>&gt;&gt;<i>        No daemonimization.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * neither: The initial process double-forks the master process.
</I>&gt;&gt;<i>        One or more worker kids (depending on workers=N).
</I>&gt;&gt;<i>        Daemonimization.
</I>
&gt;<i> I think I can agree to that.
</I>
Great. Please limit your changes to making the above true. AFAICT, that
means fixing --foreground. Everything else is already working as
expected as far as the above summary is concerned. There are many other
bugs in that area, especially in v3.5, but you need to ignore them to
succeed.


&gt;<i> And [-N] should definitely not be termed &quot;no daemon&quot;-mode, as
</I>&gt;<i> that is what --foreground will probably do in the future.
</I>
You may be right, but I would _not_ change that terminology now because
all the renaming will obfuscate your true fix and make it more difficult
to understand/review. It may also preclude v3.5 acceptance.


&gt;<i> What I get from <A HREF="http://bugs.squid-cache.org/show_bug.cgi?id=3826#c40">http://bugs.squid-cache.org/show_bug.cgi?id=3826#c40</A> is,
</I>&gt;<i> that the mentioned setup works because systemd broadcasts
</I>&gt;<i> (KillMode=mixed) the signals to all child processes.
</I>
&gt;<i>From design point of view, Squid should not rely on 3rd party
</I>applications sending signals to kids. If such broadcast works today in
some environment, great, but this is not a part of Squid interface. As
far as signaling is concerned, Squid interface is the PID file. All
signals should be sent to the process listed there. Everything else is
unsupported.

Alex.
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008813.html">[squid-dev] SMP scaling in no_daemon mode?
</A></li>
	<LI>Next message: <A HREF="008826.html">[squid-dev] SMP scaling in no_daemon mode?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8825">[ date ]</a>
              <a href="thread.html#8825">[ thread ]</a>
              <a href="subject.html#8825">[ subject ]</a>
              <a href="author.html#8825">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
