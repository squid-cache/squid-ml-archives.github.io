<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] src/forward.h
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20src/forward.h&In-Reply-To=%3C09c25707-cb4b-5d77-1604-f9364e941f81%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="009008.html">
   <LINK REL="Next"  HREF="009011.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] src/forward.h</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20src/forward.h&In-Reply-To=%3C09c25707-cb4b-5d77-1604-f9364e941f81%40treenet.co.nz%3E"
       TITLE="[squid-dev] src/forward.h">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Jun 20 09:39:54 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="009008.html">[squid-dev] src/forward.h
</A></li>
        <LI>Next message: <A HREF="009011.html">[squid-dev] src/forward.h
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9009">[ date ]</a>
              <a href="thread.html#9009">[ thread ]</a>
              <a href="subject.html#9009">[ subject ]</a>
              <a href="author.html#9009">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 20/06/17 21:06, Christos Tsantilas wrote:
&gt;<i> Στις 20/06/2017 01:59 πμ, ο Alex Rousskov έγραψε:
</I>&gt;&gt;&gt;<i> revno: 15212
</I>&gt;&gt;&gt;<i> committer: Amos Jeffries &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid3 at treenet.co.nz</A>&gt;
</I>&gt;&gt;&gt;<i> branch nick: 5
</I>&gt;&gt;&gt;<i> timestamp: Tue 2017-06-20 01:53:03 +1200
</I>&gt;&gt;&gt;<i> message:
</I>&gt;&gt;&gt;<i>    Fix build errors with automake after rev.15194
</I>&gt;&gt;&gt;<i>       We cannot name files in src/ the same as files in
</I>&gt;&gt;&gt;<i> sub-directories due to
</I>&gt;&gt;&gt;<i>    certain automake still implicitly using -I. for search paths.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Aggregating frequently used forward declarations for src/ code is a good
</I>&gt;&gt;<i> idea IMO. If we cannot use a src/forward.h name, then we should use
</I>&gt;&gt;<i> another name to implement that idea (rather than to kill the idea
</I>&gt;&gt;<i> itself). I can suggest:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 1. src/fwd.h (sufficient but should not be replicated to other dirs)
</I>&gt;&gt;<i> 2. src/forward_.h (emphasizes that we are working around a problem)
</I>&gt;&gt;<i> 3. src/src_fwd.h (lowers the chance of replication in other dirs)
</I>&gt;<i>
</I>&gt;<i> We can use the $topdir/include/forward.h
</I>
Nope. While automake is the source of the problem, the file paths in .am 
it is dealing with are fine.

The problem is how the problematic automake's add -I. implicitly to the 
compiler path search strings. So the bug shows up when .h files use:

  #include &quot;forward.h&quot;

. For any name where the local src/foo/bar.h matches a src/bar.h (or 
includes/bar.h) and build is running for src/foo/ we cannot be sure 
which of the bar.h files will be loaded - usually the wrong (./bar.h) one.



The duplicate code you had to add to src/servers/forward.h to predefine 
the Pointer class despite src/forward.h supposedly being included 
earlier shows what this can lead to.
src/servers/Server.cc was loading servers/Server.h which was loading -I. 
forward.h and resulting in undefined errors unless src/servers/forward.h 
contained cut-n-paste identical definitions to src/forward.h.


&gt;&gt;<i>
</I>&gt;&gt;<i> I suggest #1, but it is not a strong preference. Any string preferences,
</I>&gt;&gt;<i> objections, or better ideas?
</I>&gt;&gt;<i>
</I>
For the general case of all src/*.h definitions having some code 
duplication on the pre-defines is not too terrible.

The SourceLayout project plan was to move things into sub-dirs and 
remove that duplication with subdir/forward.h files. While that project 
is proceeding very slowly, there is progress and when things like this 
cause pain points that just makes more incentive to fix that pain in the 
way long-term plan laid out.

FYI: Now that the build is working consistently again I am testing 
whether MasterXaction can be moved into libbase, which was defined as 
being the subdir for these type of widespread things without a clear 
component.


Amos
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009008.html">[squid-dev] src/forward.h
</A></li>
	<LI>Next message: <A HREF="009011.html">[squid-dev] src/forward.h
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9009">[ date ]</a>
              <a href="thread.html#9009">[ thread ]</a>
              <a href="subject.html#9009">[ subject ]</a>
              <a href="author.html#9009">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
