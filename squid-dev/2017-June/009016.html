<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Reduce &quot;!Comm::MonitorsRead(serverConnection-&gt;fd)&quot; assertions.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Reduce%0A%20%22%21Comm%3A%3AMonitorsRead%28serverConnection-%3Efd%29%22%20assertions.&In-Reply-To=%3C12ff36cf-9862-eccc-f411-2fa5c704ba71%40chtsanti.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="009055.html">
   <LINK REL="Next"  HREF="009017.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Reduce &quot;!Comm::MonitorsRead(serverConnection-&gt;fd)&quot; assertions.</H1>
    <B>Christos Tsantilas</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Reduce%0A%20%22%21Comm%3A%3AMonitorsRead%28serverConnection-%3Efd%29%22%20assertions.&In-Reply-To=%3C12ff36cf-9862-eccc-f411-2fa5c704ba71%40chtsanti.net%3E"
       TITLE="[squid-dev] [PATCH] Reduce &quot;!Comm::MonitorsRead(serverConnection-&gt;fd)&quot; assertions.">christos at chtsanti.net
       </A><BR>
    <I>Wed Jun 21 11:40:13 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="009055.html">[squid-dev] [PATCH] squid: let it compile ok for gcc7
</A></li>
        <LI>Next message: <A HREF="009017.html">[squid-dev] [PATCH] Reduce &quot;!Comm::MonitorsRead(serverConnection-&gt;fd)&quot; assertions.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9016">[ date ]</a>
              <a href="thread.html#9016">[ thread ]</a>
              <a href="subject.html#9016">[ subject ]</a>
              <a href="author.html#9016">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
* Protect Squid Client classes from new requests that compete with 
ongoing pinned connection use and
* resume dealing with new requests when those Client classes are done 
using the pinned connection.

Replaced primary ConnStateData::pinConnection() calls with a pair of 
pinBusyConnection() and notePinnedConnectionBecameIdle() calls, 
depending on the pinned connection state (&quot;busy&quot; or &quot;idle&quot;).

Removed pinConnection() parameters that were not longer used or could be 
computed from the remaining parameters.

Removed ConnStateData::httpsPeeked() code &quot;hiding&quot; the originating 
request and connection peer details while entering the first &quot;idle&quot; 
state. The old (trunk r11880.1.6) bump-server-first code used a pair of 
NULLs because &quot;Intercepted connections do not have requests at the 
connection pinning stage&quot;, but that limitation no longer applicable 
because Squid always fakes (when intercepting) or parses (a CONNECT) 
request now, even during SslBump step1.

The added XXX and TODOs are not directly related to this fix. They were 
added to document problems discovered while working on this fix.

In v3.5 code, the same problems manifest as Read.cc 
&quot;fd_table[conn-&gt;fd].halfClosedReader != NULL&quot; assertions.

This is a Measurement Factory project
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SQUID307-half-closed-reader-t8.patch
Type: text/x-patch
Size: 38575 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20170621/5d4c87aa/attachment-0001.bin">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20170621/5d4c87aa/attachment-0001.bin</A>&gt;
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009055.html">[squid-dev] [PATCH] squid: let it compile ok for gcc7
</A></li>
	<LI>Next message: <A HREF="009017.html">[squid-dev] [PATCH] Reduce &quot;!Comm::MonitorsRead(serverConnection-&gt;fd)&quot; assertions.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9016">[ date ]</a>
              <a href="thread.html#9016">[ thread ]</a>
              <a href="subject.html#9016">[ subject ]</a>
              <a href="author.html#9016">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
