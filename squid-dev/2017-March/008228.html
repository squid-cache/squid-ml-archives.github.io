<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Rock store stopped accessing discs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Rock%20store%20stopped%20accessing%20discs&In-Reply-To=%3C408da60f-d09d-cb0f-cdef-f16307791e97%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008227.html">
   <LINK REL="Next"  HREF="008229.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Rock store stopped accessing discs</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Rock%20store%20stopped%20accessing%20discs&In-Reply-To=%3C408da60f-d09d-cb0f-cdef-f16307791e97%40measurement-factory.com%3E"
       TITLE="[squid-dev] Rock store stopped accessing discs">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Mar  7 16:14:48 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008227.html">[squid-dev] Rock store stopped accessing discs
</A></li>
        <LI>Next message: <A HREF="008229.html">[squid-dev] Rock store stopped accessing discs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8228">[ date ]</a>
              <a href="thread.html#8228">[ thread ]</a>
              <a href="subject.html#8228">[ subject ]</a>
              <a href="author.html#8228">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 03/07/2017 08:40 AM, Heiler Bemerguy wrote:
&gt;<i> I'm using squid 4.0.18
</I>&gt;<i> 
</I>&gt;<i> And noticed something: (iostat -x 5)
</I>&gt;<i> 
</I>&gt;<i> Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s
</I>&gt;<i> avgrq-sz avgqu-sz   await r_await w_await  svctm  %util
</I>&gt;<i> sda               0,00     0,00    0,00    0,25     0,00 28,00 224,00     0,00    8,00    0,00    8,00   8,00   0,20
</I>&gt;<i> sdc               0,00     0,00    0,00    0,00     0,00 0,00    0,00     0,00    0,00    0,00    0,00   0,00   0,00
</I>&gt;<i> sdb               0,00     0,00    0,00    0,00     0,00 0,00    0,00     0,00    0,00    0,00    0,00   0,00   0,00
</I>&gt;<i> sdd               0,00     0,00    0,00    0,00     0,00 0,00    0,00     0,00    0,00    0,00    0,00   0,00   0,00
</I>&gt;<i> 
</I>&gt;<i> No hds are being accessed, only the main (SDA) one (which logs are
</I>&gt;<i> saved). Btw squid is sending 80mbit/s to the network, as iftop told me.
</I>&gt;<i> 
</I>&gt;<i> cache.log:
</I>&gt;<i> 
</I>&gt;<i> 2017/03/07 05:23:59 kid5| ERROR: worker I/O push queue for /cache4/rock overflow: ipcIo5.206991w9
</I>&gt;<i> 2017/03/07 05:24:10 kid5| WARNING: communication with /cache4/rock may be too slow or disrupted for about 7.00s; rescued 304 out of 304 I/Os
</I>&gt;<i> 2017/03/07 08:00:30 kid5| WARNING: abandoning 1 /cache2/rock I/Os after at least 7.00s timeout
</I>&gt;<i> 2017/03/07 10:50:45 kid5| WARNING: abandoning 1 /cache2/rock I/Os after at least 7.00s timeout
</I>
I presume your iostat output covers 5 seconds. The cache.log output
spans 5 hours. Were there no cache disk traffic during those 5 hours? Do
those iostat 5 seconds match the timestamp of any single cache.log WARNING?


&gt;<i> squid.conf:
</I>&gt;<i> 
</I>&gt;<i> cache_dir rock /cache2 110000 min-size=0 max-size=65536 max-swap-rate=200 swap-timeout=360
</I>&gt;<i> cache_dir rock /cache3 110000 min-size=65537 max-size=262144 max-swap-rate=200 swap-timeout=380
</I>&gt;<i> cache_dir rock /cache4 110000 min-size=262145 max-swap-rate=200 swap-timeout=500
</I>&gt;<i> 
</I>&gt;<i> Should I raise any values? tweak something?
</I>
Yes, but it is not yet clear what. If you suspect that your disks cannot
handle the load, decrease max-swap-rate. However, there is currently no
firm evidence that your disks cannot handle the load. It could be
something else like insufficient IPC RAM or Squid bugs.

Any Squid kid crashes? How many Squid workers do you use?

Can you collect enough iostat 5-second outputs to correlate with
long-term cache.log messages? I would also collect other system activity
during those hours. The &quot;atop&quot; tool may be useful for collecting
everything in one place.

Alex.

</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008227.html">[squid-dev] Rock store stopped accessing discs
</A></li>
	<LI>Next message: <A HREF="008229.html">[squid-dev] Rock store stopped accessing discs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8228">[ date ]</a>
              <a href="thread.html#8228">[ thread ]</a>
              <a href="subject.html#8228">[ subject ]</a>
              <a href="author.html#8228">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
