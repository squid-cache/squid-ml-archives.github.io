<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Rock store stopped accessing discs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Rock%20store%20stopped%20accessing%20discs&In-Reply-To=%3C39957979-cb44-d62e-b15a-6335da79f993%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008231.html">
   <LINK REL="Next"  HREF="008252.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Rock store stopped accessing discs</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Rock%20store%20stopped%20accessing%20discs&In-Reply-To=%3C39957979-cb44-d62e-b15a-6335da79f993%40measurement-factory.com%3E"
       TITLE="[squid-dev] Rock store stopped accessing discs">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Mar  7 23:26:23 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008231.html">[squid-dev] Rock store stopped accessing discs
</A></li>
        <LI>Next message: <A HREF="008252.html">[squid-dev] Rock store stopped accessing discs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8232">[ date ]</a>
              <a href="thread.html#8232">[ thread ]</a>
              <a href="subject.html#8232">[ subject ]</a>
              <a href="author.html#8232">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 03/07/2017 01:08 PM, Heiler Bemerguy wrote:

&gt;<i> Some log from right now...
</I>
Here is my analysis:

&gt;<i> 15:53:05.255| ipc/Queue.h findOldest: peeking from 7 to 6 at 1
</I>
Squid worker (kid6) is looking at the queue of disker (kid7) responses.
There is just one response in the queue.


&gt;<i> IpcIoFile.cc canWait: cannot wait: 1136930911 oldest: ipcIo6.381049w7
</I>
Squid worker is trying to estimate whether it has enough time to queue
(and eventually perform) more disk I/O. The expected wait is
1'136'930'911 milliseconds or ~13 days. That is longer than the
configured cache_dir swap-timeout (a few hundred milliseconds) so Squid
refuses to queue this disk I/O request:

&gt;<i> store_io.cc storeCreate: no swapdirs for e:=sw1p2RDV/0x206e17d0*4
</I>

The same story happens in your other log snippets AFAICT:

&gt;<i> 15:53:05.302| ipc/Queue.h findOldest: peeking from 8 to 6 at 1
</I>&gt;<i> IpcIoFile.cc canWait: cannot wait: 1136930958 oldest: ipcIo6.153009r8
</I>&gt;<i> store_io.cc storeCreate: no swapdirs for e:=msw1DV/0x3a4d5870*2
</I>
and

&gt;<i> 15:53:05.318| ipc/Queue.h findOldest: peeking from 7 to 6 at 1
</I>&gt;<i> IpcIoFile.cc canWait: cannot wait: 1136930974 oldest: ipcIo6.381049w7
</I>&gt;<i> store_io.cc storeCreate: no swapdirs for e:m381432=w1p2DV/0x3ace6740*4
</I>
and

&gt;<i> 15:53:05.793| ipc/Queue.h findOldest: peeking from 7 to 6 at 1
</I>&gt;<i> IpcIoFile.cc canWait: cannot wait: 1136931448 oldest: ipcIo6.381049w7
</I>&gt;<i> store_io.cc storeCreate: no swapdirs for e:=sw1V/0x206e17d0*1
</I>

Focusing on one disker (kid7), we can see that the oldest response does
not change: It is always ipcIo6.381049w7. This stuck response results in
gradual increment of the expected wait time with every check, matching
wall clock time increment:

&gt;<i> 15:53:05.255| cannot wait: 1136930911
</I>&gt;<i> 15:53:05.318| cannot wait: 1136930974
</I>&gt;<i> 15:53:05.793| cannot wait: 1136931448
</I>
These stuck disker responses probably explain why your disks do not
receive any traffic. It is potentially important that both disker
responses shown in your logs got stuck at approximately the same
absolute time ~13 days ago (around 2017-02-22, give or take a day;
subtract 1136930911 milliseconds from 15:53:05.255 in your Squid time
zone to know the &quot;exact&quot; time when those stuck requests were queued).

How can a disker response get stuck? Most likely, something unusual
happened ~13 days ago. This could be a Squid bug and/or a kid restart.

* Do all currently running Squid kid processes have about the same start
time? [1]

* Do you see ipcIo6.381049w7 or ipcIo6.153009r8 mentioned in any old
non-debugging messages/warnings?

[1]
<A HREF="http://stackoverflow.com/questions/5731234/how-to-get-the-start-time-of-a-long-running-linux-process">http://stackoverflow.com/questions/5731234/how-to-get-the-start-time-of-a-long-running-linux-process</A>


Thank you,

Alex.

</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008231.html">[squid-dev] Rock store stopped accessing discs
</A></li>
	<LI>Next message: <A HREF="008252.html">[squid-dev] Rock store stopped accessing discs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8232">[ date ]</a>
              <a href="thread.html#8232">[ thread ]</a>
              <a href="subject.html#8232">[ subject ]</a>
              <a href="author.html#8232">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
