<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Honor peer timeouts when forwarding CONNECTs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Honor%20peer%20timeouts%20when%20forwarding%20CONNECTs&In-Reply-To=%3Cae970f75-c064-bf91-9935-630ce25126c6%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008262.html">
   <LINK REL="Next"  HREF="008275.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Honor peer timeouts when forwarding CONNECTs</H1>
    <B>Eduard Bagdasaryan</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Honor%20peer%20timeouts%20when%20forwarding%20CONNECTs&In-Reply-To=%3Cae970f75-c064-bf91-9935-630ce25126c6%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] Honor peer timeouts when forwarding CONNECTs">eduard.bagdasaryan at measurement-factory.com
       </A><BR>
    <I>Sun Mar 12 21:50:13 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008262.html">[squid-dev] Fwd: [PATCH] for loops modernization
</A></li>
        <LI>Next message: <A HREF="008275.html">[squid-dev] [PATCH] Honor peer timeouts when forwarding CONNECTs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8243">[ date ]</a>
              <a href="thread.html#8243">[ thread ]</a>
              <a href="subject.html#8243">[ subject ]</a>
              <a href="author.html#8243">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

This patch fixes two bugs with tunneling CONNECT requests (or equivalent
traffic) through a cache_peer:

1. Not detecting dead cache_peers due to missing code to count peer
    connect failures. SSL-level failures were detected (for &quot;tls&quot;
    cache_peers) but TCP/IP connect(2) failures were not (for all peers).

2. Origin server connect_timeout used instead of peer_connect_timeout or
    a peer-specific connect-timeout=N (where configured).

The regular forwarding code path does not have the above bugs. This
change reduces code duplication across the two code paths (that
duplication probably caused these bugs in the first place), but a lot
more work is needed in that direction.

This patch applies to v5 r15094. I assume v4 should be fixed as well:
the same patch applies to v4 r14999.


Thanks,
Eduard.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SQUID-279-honor-peer-timeouts-connect-fwd-t1.patch
Type: text/x-patch
Size: 58320 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20170313/a3de1557/attachment-0001.bin">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20170313/a3de1557/attachment-0001.bin</A>&gt;
</PRE>


































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008262.html">[squid-dev] Fwd: [PATCH] for loops modernization
</A></li>
	<LI>Next message: <A HREF="008275.html">[squid-dev] [PATCH] Honor peer timeouts when forwarding CONNECTs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8243">[ date ]</a>
              <a href="thread.html#8243">[ thread ]</a>
              <a href="subject.html#8243">[ subject ]</a>
              <a href="author.html#8243">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
