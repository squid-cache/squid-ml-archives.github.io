<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Rock store stopped accessing discs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Rock%20store%20stopped%20accessing%20discs&In-Reply-To=%3Ccf61b60c-9a29-3a50-901a-e8681ee9a0d8%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008252.html">
   <LINK REL="Next"  HREF="008269.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Rock store stopped accessing discs</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Rock%20store%20stopped%20accessing%20discs&In-Reply-To=%3Ccf61b60c-9a29-3a50-901a-e8681ee9a0d8%40measurement-factory.com%3E"
       TITLE="[squid-dev] Rock store stopped accessing discs">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Mar 14 19:41:33 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008252.html">[squid-dev] Rock store stopped accessing discs
</A></li>
        <LI>Next message: <A HREF="008269.html">[squid-dev] Rock store stopped accessing discs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8253">[ date ]</a>
              <a href="thread.html#8253">[ thread ]</a>
              <a href="subject.html#8253">[ subject ]</a>
              <a href="author.html#8253">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 03/14/2017 10:43 AM, Heiler Bemerguy wrote:
&gt;<i> Em 07/03/2017 20:26, Alex Rousskov escreveu:
</I>&gt;&gt;<i> How can a disker response get stuck? Most likely, something unusual
</I>&gt;&gt;<i> happened ~13 days ago. This could be a Squid bug and/or a kid restart.
</I>

&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">root at proxy</A>:~# ps auxw |grep squid-
</I>&gt;<i> proxy    10225  0.0  0.0 13964224 21708 ?      S    Mar10   0:10 (squid-coord-10) -s
</I>&gt;<i> proxy    10226  0.1 12.5 14737524 8268056 ?    S    Mar10   7:14 (squid-disk-9) -s
</I>&gt;<i> proxy    10227  0.0 11.6 14737524 7686564 ?    S    Mar10   3:08 (squid-disk-8) -s
</I>&gt;<i> proxy    10228  0.1 14.9 14737540 9863652 ?    S    Mar10   7:30 (squid-disk-7) -s
</I>&gt;<i> proxy    18348  3.5 10.3 17157560 6859904 ?    S    Mar13  48:44 (squid-6) -s
</I>&gt;<i> proxy    18604  2.8  9.0 16903948 5977728 ?    S    Mar13  37:28 (squid-4) -s
</I>&gt;<i> proxy    18637  1.7 10.8 16836872 7163392 ?    R    Mar13  23:03 (squid-1) -s
</I>&gt;<i> proxy    20831 15.3 10.3 17226652 6838372 ?    S    08:50  39:51 (squid-2) -s
</I>&gt;<i> proxy    21189  5.3  2.8 16538064 1871788 ?    S    12:29   2:12 (squid-5) -s
</I>&gt;<i> proxy    21214  3.8  1.5 16448972 1012720 ?    S    12:43   1:03 (squid-3) -s
</I>
&gt;<i> Diskers aren't dying but workers are, a lot.. 
</I>
I suspect that worker deaths may cause SMP queues to get stuck, but I
have not validated that theory. We probably need to add more code to SMP
queues so that they can recover from untimely kid deaths.


&gt;<i> Another weird thing: lots of timeouts and overflows are happening on
</I>&gt;<i> non-active hours.. From 0h to 7h we have like 1-2% of the clients we
</I>&gt;<i> usually have from 8h to 17h.. (commercial time)
</I>
If a queue is stuck, you will see these errors and warnings as long as
there is some need for disk I/O. The volume is not important.


&gt;<i> Still don't know how /cache3 stopped and /cache4 is still active, even
</I>&gt;<i> with all those warnings and errors.. :/
</I>
Do you expect Squid to function well in the presence of assertions and
to explain what went wrong while asserting? Unfortunately, we are very
far from that kind of robustness and self-diagnosis nirvana!

I have not studied your error messages in detail, but it is possible
that there are not-yet-stuck queues that feed cache4 while all cache3
queues are stuck. There is one SMP queue for each worker:disker pair.

Alex.

</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008252.html">[squid-dev] Rock store stopped accessing discs
</A></li>
	<LI>Next message: <A HREF="008269.html">[squid-dev] Rock store stopped accessing discs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8253">[ date ]</a>
              <a href="thread.html#8253">[ thread ]</a>
              <a href="subject.html#8253">[ subject ]</a>
              <a href="author.html#8253">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
