<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] To make squid works in snap world.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20To%20make%20squid%20works%20in%20snap%20world.&In-Reply-To=%3C7a1a7db4-9822-1b86-3272-7fa4e8780e8a%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008297.html">
   <LINK REL="Next"  HREF="008257.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] To make squid works in snap world.</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20To%20make%20squid%20works%20in%20snap%20world.&In-Reply-To=%3C7a1a7db4-9822-1b86-3272-7fa4e8780e8a%40treenet.co.nz%3E"
       TITLE="[squid-dev] To make squid works in snap world.">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Mar 15 04:42:50 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008297.html">[squid-dev] To make squid works in snap world.
</A></li>
        <LI>Next message: <A HREF="008257.html">[squid-dev] To make squid works in snap world.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8255">[ date ]</a>
              <a href="thread.html#8255">[ thread ]</a>
              <a href="subject.html#8255">[ subject ]</a>
              <a href="author.html#8255">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 15/03/2017 3:44 a.m., Gary Wang wrote:
&gt;<i> Hi guys
</I>&gt;<i>     I'm sorry that I'm here so late. :(
</I>&gt;<i>     Generally, regarding the purpose of this MP.
</I>&gt;<i>     <A HREF="https://code.launchpad.net/~gary-wzl77/squid/ipc_prefix/+merge/318714">https://code.launchpad.net/~gary-wzl77/squid/ipc_prefix/+merge/318714</A>
</I>&gt;<i> 
</I>&gt;<i>     I'd like to make squid snap works as a confined
</I>&gt;<i> &lt;<A HREF="https://snapcraft.io/docs/reference/confinement">https://snapcraft.io/docs/reference/confinement</A>&gt;snap in snap world. So
</I>&gt;<i> that we can ship this snap in ubuntu-core.
</I>&gt;<i>     The reason why I need to add compile option to enable to customize IPC
</I>&gt;<i> prefix at compiling time is that in order to use shared memory in an app
</I>&gt;<i> which released as a snap package the only allowed file path will be like
</I>&gt;<i> this  &lt;<A HREF="https://bugs.launchpad.net/snappy/+bug/1653955">https://bugs.launchpad.net/snappy/+bug/1653955</A>&gt;(in the following
</I>&gt;<i> namespace)
</I>&gt;<i>  /dev/shm/sem.snap.@{SNAP_NAME}.*
</I>&gt;<i> 
</I>&gt;<i>     Hence in our case, the shared memory file path should be
</I>&gt;<i>     /dev/shm/sem.snap.squid-snap.{random-string}
</I>&gt;<i>     Otherwise, you will get the following error when running the squid in
</I>&gt;<i> snap world
</I>&gt;<i>     <A HREF="http://paste.ubuntu.com/24175840/">http://paste.ubuntu.com/24175840/</A>
</I>&gt;<i> 
</I>
Having looked at this a lot more now I think the patch is based on an
incorrect assumption.

You see Squid complaining of /dev/shm Permissions error. Other people
getting that error in snap world were using semaphores and fixed it by
using snap /dev/shm/sem.* names. So you fixed the /dev/shm naming to
match snap semaphore naming.

... but Squid does *not* use semaphores.

Simply making Squid pretend to be doing semaphores to bypass the
security is not the right way forward.

The real question is why the permissions error is occuring?

What in snap world is refusing permission?

Amos

</PRE>



















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008297.html">[squid-dev] To make squid works in snap world.
</A></li>
	<LI>Next message: <A HREF="008257.html">[squid-dev] To make squid works in snap world.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8255">[ date ]</a>
              <a href="thread.html#8255">[ thread ]</a>
              <a href="subject.html#8255">[ subject ]</a>
              <a href="author.html#8255">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
