<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] To make squid works in snap world.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20To%20make%20squid%20works%20in%20snap%20world.&In-Reply-To=%3C165501d29d66%24815fcd10%24841f6730%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008255.html">
   <LINK REL="Next"  HREF="008278.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] To make squid works in snap world.</H1>
    <B>Eliezer  Croitoru</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20To%20make%20squid%20works%20in%20snap%20world.&In-Reply-To=%3C165501d29d66%24815fcd10%24841f6730%24%40ngtech.co.il%3E"
       TITLE="[squid-dev] To make squid works in snap world.">eliezer at ngtech.co.il
       </A><BR>
    <I>Wed Mar 15 08:31:12 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008255.html">[squid-dev] To make squid works in snap world.
</A></li>
        <LI>Next message: <A HREF="008278.html">[squid-dev] [PATCH] Update refresh_pattern description regarding 'max' option
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8257">[ date ]</a>
              <a href="thread.html#8257">[ thread ]</a>
              <a href="subject.html#8257">[ subject ]</a>
              <a href="author.html#8257">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>+1

How can I reproduce he error?
Is there a bug report open for this issue?

Thanks,
Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">eliezer at ngtech.co.il</A>


-----Original Message-----
From: squid-dev [mailto:<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev-bounces at lists.squid-cache.org</A>] On Behalf Of Amos Jeffries
Sent: Wednesday, March 15, 2017 6:43 AM
To: <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev at lists.squid-cache.org</A>
Subject: Re: [squid-dev] To make squid works in snap world.

On 15/03/2017 3:44 a.m., Gary Wang wrote:
&gt;<i> Hi guys
</I>&gt;<i>     I'm sorry that I'm here so late. :(
</I>&gt;<i>     Generally, regarding the purpose of this MP.
</I>&gt;<i>     
</I>&gt;<i> <A HREF="https://code.launchpad.net/~gary-wzl77/squid/ipc_prefix/+merge/318714">https://code.launchpad.net/~gary-wzl77/squid/ipc_prefix/+merge/318714</A>
</I>&gt;<i> 
</I>&gt;<i>     I'd like to make squid snap works as a confined 
</I>&gt;<i> &lt;<A HREF="https://snapcraft.io/docs/reference/confinement">https://snapcraft.io/docs/reference/confinement</A>&gt;snap in snap world. 
</I>&gt;<i> So that we can ship this snap in ubuntu-core.
</I>&gt;<i>     The reason why I need to add compile option to enable to customize 
</I>&gt;<i> IPC prefix at compiling time is that in order to use shared memory in 
</I>&gt;<i> an app which released as a snap package the only allowed file path 
</I>&gt;<i> will be like this  &lt;<A HREF="https://bugs.launchpad.net/snappy/+bug/1653955">https://bugs.launchpad.net/snappy/+bug/1653955</A>&gt;(in 
</I>&gt;<i> the following
</I>&gt;<i> namespace)
</I>&gt;<i>  /dev/shm/sem.snap.@{SNAP_NAME}.*
</I>&gt;<i> 
</I>&gt;<i>     Hence in our case, the shared memory file path should be
</I>&gt;<i>     /dev/shm/sem.snap.squid-snap.{random-string}
</I>&gt;<i>     Otherwise, you will get the following error when running the squid 
</I>&gt;<i> in snap world
</I>&gt;<i>     <A HREF="http://paste.ubuntu.com/24175840/">http://paste.ubuntu.com/24175840/</A>
</I>&gt;<i> 
</I>
Having looked at this a lot more now I think the patch is based on an incorrect assumption.

You see Squid complaining of /dev/shm Permissions error. Other people getting that error in snap world were using semaphores and fixed it by using snap /dev/shm/sem.* names. So you fixed the /dev/shm naming to match snap semaphore naming.

... but Squid does *not* use semaphores.

Simply making Squid pretend to be doing semaphores to bypass the security is not the right way forward.

The real question is why the permissions error is occuring?

What in snap world is refusing permission?

Amos

_______________________________________________
squid-dev mailing list
<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">http://lists.squid-cache.org/listinfo/squid-dev</A>

</PRE>


















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008255.html">[squid-dev] To make squid works in snap world.
</A></li>
	<LI>Next message: <A HREF="008278.html">[squid-dev] [PATCH] Update refresh_pattern description regarding 'max' option
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8257">[ date ]</a>
              <a href="thread.html#8257">[ thread ]</a>
              <a href="subject.html#8257">[ subject ]</a>
              <a href="author.html#8257">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
