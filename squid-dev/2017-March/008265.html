<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Fwd: [PATCH] for loops modernization
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Fwd%3A%20%5BPATCH%5D%20for%20loops%20modernization&In-Reply-To=%3C0c4e72ef-f6ae-ba03-85a2-217beff65002%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008260.html">
   <LINK REL="Next"  HREF="008266.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Fwd: [PATCH] for loops modernization</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Fwd%3A%20%5BPATCH%5D%20for%20loops%20modernization&In-Reply-To=%3C0c4e72ef-f6ae-ba03-85a2-217beff65002%40measurement-factory.com%3E"
       TITLE="[squid-dev] Fwd: [PATCH] for loops modernization">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Mar 15 15:38:28 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008260.html">[squid-dev] Fwd: [PATCH] for loops modernization
</A></li>
        <LI>Next message: <A HREF="008266.html">[squid-dev] Fwd: [PATCH] for loops modernization
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8265">[ date ]</a>
              <a href="thread.html#8265">[ thread ]</a>
              <a href="subject.html#8265">[ subject ]</a>
              <a href="author.html#8265">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 03/15/2017 06:57 AM, Adam Majer wrote:
&gt;<i> these types of changes
</I>&gt;<i> do not add anything. They actually make the code more difficult to maintain.
</I>
I disagree.

&gt;<i> For example,
</I>&gt;<i> 
</I>&gt;<i> -    if (HttpRequest *r = dynamic_cast&lt;HttpRequest*&gt;(theMsg)) {
</I>&gt;<i> +    if (auto *r = dynamic_cast&lt;HttpRequest*&gt;(theMsg)) {
</I>&gt;<i> 
</I>&gt;<i> Nothing is gained here. On the contrary, it is not immediately known to
</I>&gt;<i> the reader what this `auto` type actually is until they look to the
</I>&gt;<i> right. So what are we saving?
</I>
While we do have to &quot;look to the right&quot; and that is indeed a drawback,
auto advantages, collectively, outweigh that negative:

* Auto may reduce explicit code duplication. Saying HttpRequest twice is
code duplication. Code duplication is one of the greatest evils we have
to deal with on a daily basis. It causes functionality bugs and
significantly increases code maintenance overheads.

* Auto reduces implicit code duplication: Saying HttpRequest just
because the type returned by the expression on the right is currently
HttpRequest.

* Auto eliminates implicit type conversions. Some of those conversions
have very undesirable effects, including serious performance degradation.

* In most cases, you either do not need to look to the right (because
you do not care about the actual type specifics) or you have to look to
the right for other reasons (because you care about the code details
after &quot;auto&quot; so you have to keep reading anyway).

More on that below, after the nil pointer discussion (including a
reference to an &quot;authoritative&quot; analysis of your readability argument).


&gt;<i> -Adaptation::Message::Message(): header(NULL)
</I>&gt;<i> +Adaptation::Message::Message(): header(nullptr)
</I>&gt;<i> 
</I>&gt;<i> NULL and nullptr are the same thing for these purposes.
</I>
They may or may not be (depending on the header declaration). Since NULL
and nullptr may have different types, they are not identical. More at
<A HREF="http://stackoverflow.com/questions/13816385/what-are-the-advantages-of-using-nullptr">http://stackoverflow.com/questions/13816385/what-are-the-advantages-of-using-nullptr</A>


&gt;<i> Actually, the
</I>&gt;<i> most likely implementation of NULL macro in C++11 is just
</I>&gt;<i> 
</I>&gt;<i> #define NULL nullptr
</I>
According to the comments at the above URL, that would be illegal
because nullptr is not an integral type and NULL has to have an integral
type.


&gt;<i> I have no problem in using either, but changing this just for the same
</I>&gt;<i> of changing it....
</I>
Yes, please do not misinterpret my comments as a disagreement on that
very important point: Nullptr is better than NULL, but the negatives in
just changing lots of old working (and needed to be supported across
various branches) code to nullptr outweigh the advantages.


&gt;<i> -    for (MECI i = master.extensions.begin(); i != master.extensions.end(); ++i) {
</I>&gt;<i> +    for (const auto &amp; extension : master.extensions) {
</I>
&gt;<i> [...] this makes is even more complicated to know the type you
</I>&gt;<i> are referring to. The compiler knows, but the developer? I have no idea.
</I>&gt;<i> master.extentions can be anything with iterator.
</I>
That is usually a good thing: You do _not_ want to know the exact type
in most cases.


&gt;<i> If you really want to fix this, avoid `auto` in code people actually
</I>&gt;<i> want to maintain. The only place it is actually useful is in heavily
</I>&gt;<i> templated code and that is the main reason it was introduced. It was not
</I>&gt;<i> introduced so you can avoid typing the name of POS (plain old
</I>&gt;<i> structures) or types or classes.
</I>
I disagree on all counts. Auto is much more nuanced. The web has a lot
more pro- and cons- arguments about auto, including advice from C++
gurus. For example:
<A HREF="https://herbsutter.com/2013/08/12/gotw-94-solution-aaa-style-almost-always-auto/">https://herbsutter.com/2013/08/12/gotw-94-solution-aaa-style-almost-always-auto/</A>

We should not repeat those debates here IMO. What would be the point? We
are unlikely to come up with better or new arguments... For example, the
above page already discusses your very own readability argument at length!

In my personal experience, going against Sutter and Mayers advice
usually ends up in long-term regrets. They are sometimes wrong, but it
is usually much easier to fix their wrongs than mine. (Just like with
Squid or any other development, it is often about making good mistakes
versus the bad ones.)


Cheers,

Alex.

</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008260.html">[squid-dev] Fwd: [PATCH] for loops modernization
</A></li>
	<LI>Next message: <A HREF="008266.html">[squid-dev] Fwd: [PATCH] for loops modernization
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8265">[ date ]</a>
              <a href="thread.html#8265">[ thread ]</a>
              <a href="subject.html#8265">[ subject ]</a>
              <a href="author.html#8265">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
