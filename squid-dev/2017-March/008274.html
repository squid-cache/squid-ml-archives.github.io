<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Fwd: [PATCH] for loops modernization
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Fwd%3A%20%5BPATCH%5D%20for%20loops%20modernization&In-Reply-To=%3C7950f15f-7e87-126e-42d4-0277fb46ddc0%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008264.html">
   <LINK REL="Next"  HREF="008284.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Fwd: [PATCH] for loops modernization</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Fwd%3A%20%5BPATCH%5D%20for%20loops%20modernization&In-Reply-To=%3C7950f15f-7e87-126e-42d4-0277fb46ddc0%40treenet.co.nz%3E"
       TITLE="[squid-dev] Fwd: [PATCH] for loops modernization">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Mar 16 05:34:33 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008264.html">[squid-dev] Fwd: [PATCH] for loops modernization
</A></li>
        <LI>Next message: <A HREF="008284.html">[squid-dev] Fwd: [PATCH] for loops modernization
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8274">[ date ]</a>
              <a href="thread.html#8274">[ thread ]</a>
              <a href="subject.html#8274">[ subject ]</a>
              <a href="author.html#8274">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 16/03/2017 3:43 a.m., Adam Majer wrote:
&gt;<i> On 03/15/2017 03:17 PM, Amos Jeffries wrote:
</I>&gt;&gt;<i> Theoretically range-for loops should allow multi-threaded CPU to run
</I>&gt;&gt;<i> those loops a bit faster. If that can be demonstrated using a tool like
</I>&gt;&gt;<i> polygraph you have a good argument for a patch containing that change to
</I>&gt;&gt;<i> go in as a pure performance change.
</I>&gt;<i> 
</I>&gt;<i> No. That would break many many things. There are special directives that
</I>&gt;<i> allow this to happen with things like OpenMPI compilers, but that's not
</I>&gt;<i> what we are talking about here.
</I>&gt;<i> 
</I>&gt;<i> And theoretically, if you blindly allow compilers to optimize loops like
</I>&gt;<i> that, you are just as likely to introduce hardware stalls that will
</I>&gt;<i> result in slower execution of the overall loop. The only way to look at
</I>&gt;<i> these,
</I>&gt;<i> 
</I>&gt;<i>     for (TYPE _i : _c )
</I>&gt;<i> 
</I>&gt;<i> is syntactic sugar.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Best regards,
</I>&gt;<i> - Adam
</I>&gt;<i> 
</I>&gt;<i> PS. And if you are talking about vertorization of these loops, that
</I>&gt;<i> already happens with regular loops. See,
</I>&gt;<i> 
</I>&gt;<i>     <A HREF="https://gcc.gnu.org/projects/tree-ssa/vectorization.html">https://gcc.gnu.org/projects/tree-ssa/vectorization.html</A>
</I>
I mean tricks like compiler with CPU-specific knowledge being able to
emit assembly that helps pre-fetch the address pointers for all objects
in the container, and/or if it can prove the objects are read-only can
have hyper-threads pre-load the container contents into L1/L2 cache in
time for the main thread to run the business logic faster without much
loading delays.

AFAIK the range-for does allow certain code flow guarantees (like
full-length container iteration) being known without any analysis. So
not completely syntactic sugar. Yes compiler could do the same with
traditional loops, but only after extra analysis which might be turned off.

I'm not sure if thus would have any visible effect at all. We might be
unlucky in that these things are not supportable, or the data sizes
Squid handles blow the benefits away. Thus the request for proof.

Amos

</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008264.html">[squid-dev] Fwd: [PATCH] for loops modernization
</A></li>
	<LI>Next message: <A HREF="008284.html">[squid-dev] Fwd: [PATCH] for loops modernization
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8274">[ date ]</a>
              <a href="thread.html#8274">[ thread ]</a>
              <a href="subject.html#8274">[ subject ]</a>
              <a href="author.html#8274">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
