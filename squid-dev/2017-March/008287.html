<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Fwd: [PATCH] for loops modernization
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Fwd%3A%20%5BPATCH%5D%20for%20loops%20modernization&In-Reply-To=%3C582ac1f4-0da1-1111-45d3-e5a12229da4a%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008284.html">
   <LINK REL="Next"  HREF="008262.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Fwd: [PATCH] for loops modernization</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Fwd%3A%20%5BPATCH%5D%20for%20loops%20modernization&In-Reply-To=%3C582ac1f4-0da1-1111-45d3-e5a12229da4a%40measurement-factory.com%3E"
       TITLE="[squid-dev] Fwd: [PATCH] for loops modernization">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Mar 16 18:07:45 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008284.html">[squid-dev] Fwd: [PATCH] for loops modernization
</A></li>
        <LI>Next message: <A HREF="008262.html">[squid-dev] Fwd: [PATCH] for loops modernization
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8287">[ date ]</a>
              <a href="thread.html#8287">[ thread ]</a>
              <a href="subject.html#8287">[ subject ]</a>
              <a href="author.html#8287">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 03/16/2017 11:00 AM, khaled belhout wrote:
&gt;<i> but we need to annotate the some functions with [[noreturn]] attribute like :
</I>
I do not think such annotations belong to the source code. If we add
various annotations for various tools, the code readability and
maintainability will suffer.

AFAIK, Coverity can be told which functions never return without
changing source code. Perhaps your tool supports that as well? If not,
request that essential tool feature (meanwhile consider automatically
patching your annotations in before running your code analysis; there
are not so many of them...).


&gt;<i> i hit a problem with xassert in: src/debug.cc
</I>&gt;<i> print the debug massage ,never return if shutting_down flag is clear
</I>&gt;<i> and return if shutting_down flag is set!
</I>
FWIW, I have been bitten by this shutting_down exception in xassert() as
well during triage. While I am sure it is helpful in some situations, I
think that special condition is a bug that should be removed so that
Squid always aborts when an assertion fails.

Alex.



&gt;<i> 2017-03-16 6:34 GMT+01:00 Amos Jeffries &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid3 at treenet.co.nz</A>&gt;:
</I>&gt;&gt;<i> On 16/03/2017 3:43 a.m., Adam Majer wrote:
</I>&gt;&gt;&gt;<i> On 03/15/2017 03:17 PM, Amos Jeffries wrote:
</I>&gt;&gt;&gt;&gt;<i> Theoretically range-for loops should allow multi-threaded CPU to run
</I>&gt;&gt;&gt;&gt;<i> those loops a bit faster. If that can be demonstrated using a tool like
</I>&gt;&gt;&gt;&gt;<i> polygraph you have a good argument for a patch containing that change to
</I>&gt;&gt;&gt;&gt;<i> go in as a pure performance change.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> No. That would break many many things. There are special directives that
</I>&gt;&gt;&gt;<i> allow this to happen with things like OpenMPI compilers, but that's not
</I>&gt;&gt;&gt;<i> what we are talking about here.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> And theoretically, if you blindly allow compilers to optimize loops like
</I>&gt;&gt;&gt;<i> that, you are just as likely to introduce hardware stalls that will
</I>&gt;&gt;&gt;<i> result in slower execution of the overall loop. The only way to look at
</I>&gt;&gt;&gt;<i> these,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     for (TYPE _i : _c )
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> is syntactic sugar.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Best regards,
</I>&gt;&gt;&gt;<i> - Adam
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> PS. And if you are talking about vertorization of these loops, that
</I>&gt;&gt;&gt;<i> already happens with regular loops. See,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     <A HREF="https://gcc.gnu.org/projects/tree-ssa/vectorization.html">https://gcc.gnu.org/projects/tree-ssa/vectorization.html</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I mean tricks like compiler with CPU-specific knowledge being able to
</I>&gt;&gt;<i> emit assembly that helps pre-fetch the address pointers for all objects
</I>&gt;&gt;<i> in the container, and/or if it can prove the objects are read-only can
</I>&gt;&gt;<i> have hyper-threads pre-load the container contents into L1/L2 cache in
</I>&gt;&gt;<i> time for the main thread to run the business logic faster without much
</I>&gt;&gt;<i> loading delays.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> AFAIK the range-for does allow certain code flow guarantees (like
</I>&gt;&gt;<i> full-length container iteration) being known without any analysis. So
</I>&gt;&gt;<i> not completely syntactic sugar. Yes compiler could do the same with
</I>&gt;&gt;<i> traditional loops, but only after extra analysis which might be turned off.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'm not sure if thus would have any visible effect at all. We might be
</I>&gt;&gt;<i> unlucky in that these things are not supportable, or the data sizes
</I>&gt;&gt;<i> Squid handles blow the benefits away. Thus the request for proof.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Amos
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-dev mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">http://lists.squid-cache.org/listinfo/squid-dev</A>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-dev mailing list
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">http://lists.squid-cache.org/listinfo/squid-dev</A>
</I>&gt;<i> 
</I>
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008284.html">[squid-dev] Fwd: [PATCH] for loops modernization
</A></li>
	<LI>Next message: <A HREF="008262.html">[squid-dev] Fwd: [PATCH] for loops modernization
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8287">[ date ]</a>
              <a href="thread.html#8287">[ thread ]</a>
              <a href="subject.html#8287">[ subject ]</a>
              <a href="author.html#8287">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
