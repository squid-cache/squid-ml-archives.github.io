<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [RFC] Do not use idle dead peers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20Do%20not%20use%20idle%20dead%20peers&In-Reply-To=%3C77d75b8c-95d4-11e9-eba4-6213fa854c65%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008320.html">
   <LINK REL="Next"  HREF="008309.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [RFC] Do not use idle dead peers</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20Do%20not%20use%20idle%20dead%20peers&In-Reply-To=%3C77d75b8c-95d4-11e9-eba4-6213fa854c65%40measurement-factory.com%3E"
       TITLE="[squid-dev] [RFC] Do not use idle dead peers">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Mar 21 21:27:25 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008320.html">[squid-dev] configure failed on msys2 mingw32
</A></li>
        <LI>Next message: <A HREF="008309.html">[squid-dev] [RFC] Do not use idle dead peers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8308">[ date ]</a>
              <a href="thread.html#8308">[ thread ]</a>
              <a href="subject.html#8308">[ subject ]</a>
              <a href="author.html#8308">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

    This Request For Comments proposes to remove a subtle Squid
(mis)feature. If you happen to use the corresponding feature, please
speak up to protect it! If nobody defends this feature, we may remove it
(in order to get rid of its bad side effects).

The feature can be summarized as follows: Since 2004 (trunk r6631),
Squid may forward an HTTP request to a dead peer that was idle for some
time. If there were no failures for a while then perhaps the peer is not
dead anymore? Let's try using it for the current HTTP transaction and
see what happens. If we are lucky, we will start using the peer sooner!..


The details of the feature, its negative side effects, and expected
removal impact, are all discussed on squid-users:

<A HREF="http://lists.squid-cache.org/pipermail/squid-users/2017-March/014785.html">http://lists.squid-cache.org/pipermail/squid-users/2017-March/014785.html</A>


Here, I can post the gist of the proposed change for those who want to
look at the affected code:

&gt;<i>  /// OK to add this peer to the list of possible request destinations?
</I>&gt;<i>  bool
</I>&gt;<i>  neighborUp(const CachePeer *p)
</I>&gt;<i>  {
</I>&gt;<i>      if (!p-&gt;tcp_up) { // the peer is DEAD
</I>&gt;<i> -        if (!peerProbeConnect(p))
</I>&gt;<i> +        peerProbeConnect(p);
</I>&gt;<i>              return false;
</I>&gt;<i>      }
</I>&gt;<i>  
</I>&gt;<i>      if (p-&gt;options.no_query)
</I>&gt;<i>          return true; // yes, add this peer
</I>

The above diff is just a sketch and more code polishing is needed to
fully remove this feature, of course.

Does anybody need this &quot;use idle dead peers&quot; feature?


Thank you,

Alex.
P.S. Please resist the temptation to discuss other peering problems on
this thread, including other problems associated with detection and
revival of dead peers. Let's focus on this specific feature proposed for
removal.
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008320.html">[squid-dev] configure failed on msys2 mingw32
</A></li>
	<LI>Next message: <A HREF="008309.html">[squid-dev] [RFC] Do not use idle dead peers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8308">[ date ]</a>
              <a href="thread.html#8308">[ thread ]</a>
              <a href="subject.html#8308">[ subject ]</a>
              <a href="author.html#8308">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
