<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [RFC] Do not use idle dead peers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20Do%20not%20use%20idle%20dead%20peers&In-Reply-To=%3C91b481f5-7933-6cfc-b7b1-93361d518b56%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008308.html">
   <LINK REL="Next"  HREF="008317.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [RFC] Do not use idle dead peers</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20Do%20not%20use%20idle%20dead%20peers&In-Reply-To=%3C91b481f5-7933-6cfc-b7b1-93361d518b56%40treenet.co.nz%3E"
       TITLE="[squid-dev] [RFC] Do not use idle dead peers">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Mar 22 04:27:06 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008308.html">[squid-dev] [RFC] Do not use idle dead peers
</A></li>
        <LI>Next message: <A HREF="008317.html">[squid-dev] [RFC] Do not use idle dead peers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8309">[ date ]</a>
              <a href="thread.html#8309">[ thread ]</a>
              <a href="subject.html#8309">[ subject ]</a>
              <a href="author.html#8309">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 22/03/2017 10:27 a.m., Alex Rousskov wrote:
&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i>     This Request For Comments proposes to remove a subtle Squid
</I>&gt;<i> (mis)feature. If you happen to use the corresponding feature, please
</I>&gt;<i> speak up to protect it! If nobody defends this feature, we may remove it
</I>&gt;<i> (in order to get rid of its bad side effects).
</I>
FYI: I dont intend to defend this feature. Just to indicate that it is
still actively used - however buggy it may be. So fixing the probe
behaviour would be useful, complete removal is not an option (yet).


&gt;<i>From squid-users traffic is appears still quite common for
</I>administrators to disable all of ICP, HTCP, netDB, digests, and ICMP.
Particularly for originserver peers. Without the monitor features from
Squid-2.7 the probes in question are the only way of the peer to be
detected as alive again.
 - that said, sending an active request which might be serviced better
by other peers is very dodgy.


IFAIK touching this feature will result in changes to what status code
and/or error page Squid produces.

It currently should (modulo bugs) result in connection-failed or timeout
types of final error going to the client as the victum requests actively
fail to be forwarded to the truely-dead peer.

After the change I would expect to see more being successful trnsactions
- but only in the presence of other live peers or DIRECT being
permitted. The ones which remain unsuccessful to become
no-forwarding-path errors since now no paths would be detected as usable.
 That remaining error case needs to be checked for exact status code and
how it impacts on caching hierarchies and retry logic.

Since the proposed change is so small has any of that behaviour been
tested already?


Other possibilities (if we have to) would be;
 a) to flag the situation in the FwdServer object used to construct the
destination list and ensure these peers are put as absolute last-resort
destinations instead of where they would normally be placed.

Or maybe simpler;
 b) a new peer select algorithm to find only this type of peer and add
them only if all other algorithms fail to produce a list.


&gt;<i> 
</I>&gt;<i> Does anybody need this &quot;use idle dead peers&quot; feature?
</I>
I expect everyone who has explicitly disabled all other types of
peer-ALIVE detection and where never_direct forbids bypassing the peer.

HTH
Amos

</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008308.html">[squid-dev] [RFC] Do not use idle dead peers
</A></li>
	<LI>Next message: <A HREF="008317.html">[squid-dev] [RFC] Do not use idle dead peers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8309">[ date ]</a>
              <a href="thread.html#8309">[ thread ]</a>
              <a href="subject.html#8309">[ subject ]</a>
              <a href="author.html#8309">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
