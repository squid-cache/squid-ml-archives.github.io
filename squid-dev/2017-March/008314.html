<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] VIA creation code duplication
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20VIA%20creation%20code%20duplication&In-Reply-To=%3C763637b0-c942-a37a-540e-27dd3b3ff6e0%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008285.html">
   <LINK REL="Next"  HREF="008315.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] VIA creation code duplication</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20VIA%20creation%20code%20duplication&In-Reply-To=%3C763637b0-c942-a37a-540e-27dd3b3ff6e0%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] VIA creation code duplication">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Mar 22 13:20:01 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008285.html">[squid-dev] [PATCH] VIA creation code duplication
</A></li>
        <LI>Next message: <A HREF="008315.html">[squid-dev] [PATCH] VIA creation code duplication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8314">[ date ]</a>
              <a href="thread.html#8314">[ thread ]</a>
              <a href="subject.html#8314">[ subject ]</a>
              <a href="author.html#8314">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 17/03/2017 6:17 a.m., Alex Rousskov wrote:
&gt;<i> On 03/16/2017 05:15 AM, Amos Jeffries wrote:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> Any objections to applying this with this added:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   // XXX: putStr() still has String 64KB limits
</I>&gt;&gt;<i>   Must(strVia.length() &lt; 64*1024);
</I>&gt;<i> 
</I>&gt;<i> No objections from me if you replace the magic constant with a new
</I>&gt;<i> inlined String::MaxSizeXXX() method. The slightly misleading source code
</I>&gt;<i> comment above becomes unnecessary after that. Why XXX()? Because no
</I>&gt;<i> correct caller code should know about internal String limits (but it may
</I>&gt;<i> catch exceptions, including exceptions due to those limits).
</I>
Okay.


If you dont mind spending a bit more time to chew that philosophical
point over, I am in slight disagreement that the need for XXX after
avoiding the magic number.

Your argument is good for the case where it is using magic numbers, even
when hidden behind a macro name. That is certainly a slippery slope to
bad news.

However, it seems reasonable for a caller to expect there to be _a_
limit. It is also reasonable for the caller to be aware of some API way
to find it out.

The safety in the latter comes from there being no knowledge of it being
a specific fixed value. For instance it could be changed each lookup or
depend on the currently stored String contents for all the caller knows
or cares - at the needed instant of lookup it is the value provided by
the API, that is all that matters to the caller.
 By using a member which does not require recompiling the caller if it
changes we move from the former bad situation to the latter safe(r) one.


&gt;<i> 
</I>&gt;&gt;<i> (I kind of hate those low-level operations with Must() and assert() like
</I>&gt;&gt;<i> the former - far too little context to be useful debugging with such big
</I>&gt;&gt;<i> impact when they are triggered.)
</I>&gt;<i> 
</I>&gt;<i> While it is indeed tempting to hate those Must(), we must keep in mind
</I>&gt;<i> that low-level assert-replacing Must()s are not meant for debugging or
</I>&gt;<i> even traditional error handling. Their purpose is to (hopefully) prevent
</I>&gt;<i> Squid death.
</I>&gt;<i> 
</I>&gt;<i> When the crash avoidance project completes, we will have a way to dump
</I>&gt;<i> stack traces for specific Must()s, which will provide the same level of
</I>&gt;<i> triage info as an assert() would, but (hopefully) without killing Squid
</I>&gt;<i> in environments where such functionality is supported.
</I>&gt;<i> 
</I>
Any kind of estimate on that?

Amos

</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008285.html">[squid-dev] [PATCH] VIA creation code duplication
</A></li>
	<LI>Next message: <A HREF="008315.html">[squid-dev] [PATCH] VIA creation code duplication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8314">[ date ]</a>
              <a href="thread.html#8314">[ thread ]</a>
              <a href="subject.html#8314">[ subject ]</a>
              <a href="author.html#8314">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
