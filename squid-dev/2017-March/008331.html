<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] on_unsupported_protocol rewrite to support tcp	connection, relay
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20on_unsupported_protocol%20rewrite%20to%20support%20tcp%0A%09connection%2C%20relay&In-Reply-To=%3Ced68efb4-dfdd-6ced-1437-46fde817ef4e%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008330.html">
   <LINK REL="Next"  HREF="008328.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] on_unsupported_protocol rewrite to support tcp	connection, relay</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20on_unsupported_protocol%20rewrite%20to%20support%20tcp%0A%09connection%2C%20relay&In-Reply-To=%3Ced68efb4-dfdd-6ced-1437-46fde817ef4e%40treenet.co.nz%3E"
       TITLE="[squid-dev] on_unsupported_protocol rewrite to support tcp	connection, relay">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Mar 27 10:56:08 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008330.html">[squid-dev] on_unsupported_protocol rewrite to support tcp	connection, relay
</A></li>
        <LI>Next message: <A HREF="008328.html">[squid-dev] Squid-4 status update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8331">[ date ]</a>
              <a href="thread.html#8331">[ thread ]</a>
              <a href="subject.html#8331">[ subject ]</a>
              <a href="author.html#8331">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 27/03/2017 7:35 p.m., 钱国正 wrote:
&gt;&gt;<i> If you want port 80 to just be relayed through - dont send it to Squid.
</I>&gt;<i> 
</I>&gt;&gt;<i> You will probably be able to identify the DNS packets with your firewall
</I>&gt;&gt;<i> rules easier than Squid can tell it apart from a mangled HTTP message.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> What I want to do is to use Squid ecap adaptation to modify some http response.
</I>&gt;<i> But during the running time, I found that some famous mobile app using 80 port
</I>&gt;<i> transport some unknown protocol (not http).
</I>
As you indicated in your last email there is no HTTP in this traffic
received. One of the things that means is that eCAP has nothing to work
with. There is definitely no HTTP response coming out of DNS servers.

Even if we let it through Squid you would still not be able to do
anything. You would barely even be able to see it happening in the logs.

As you may have noticed, the on_unsupported_protocol only has the
options of tunnel and reject ('respond' with an HTTP-format rejection),
nothing else - and those have to be decided before anything actually
happens with the traffic. The ACLs which it offers are also very limited
to the IP:port details and not much else.


&gt;<i> 
</I>&gt;<i> What if the protocol is not http, but using 80 port, can squid relay it to its target server?
</I>&gt;<i> 
</I>
That is the job of a TCP relay, Squid is an HTTP proxy. It is designed
in part to reject non-HTTP protocols.

Port 80 is a &quot;reserved port&quot;. Like all such ports (0-1024) there is a
defined set of things which are possible, and the remainder is not. For
something to be possible on port 80 it has to have a structure and
behaviour matching HTTP/0.9, HTTP/1 or HTTP/2.

I'm aware that almost no software coming out of China these days works
properly when faced with real Internet networks - just because of how
they ignore reserved ports existing protocols. The solution to that is
*not* to make other software ignore the problem.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008330.html">[squid-dev] on_unsupported_protocol rewrite to support tcp	connection, relay
</A></li>
	<LI>Next message: <A HREF="008328.html">[squid-dev] Squid-4 status update
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8331">[ date ]</a>
              <a href="thread.html#8331">[ thread ]</a>
              <a href="subject.html#8331">[ subject ]</a>
              <a href="author.html#8331">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
