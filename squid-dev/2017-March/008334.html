<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] configure.ac cleanup of BerkleyDB related	checks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20configure.ac%20cleanup%20of%20BerkleyDB%20related%0A%09checks&In-Reply-To=%3C0b0f01d2a9c2%2401a70bc0%2404f52340%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008333.html">
   <LINK REL="Next"  HREF="008335.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] configure.ac cleanup of BerkleyDB related	checks</H1>
    <B>Eliezer  Croitoru</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20configure.ac%20cleanup%20of%20BerkleyDB%20related%0A%09checks&In-Reply-To=%3C0b0f01d2a9c2%2401a70bc0%2404f52340%24%40ngtech.co.il%3E"
       TITLE="[squid-dev] [PATCH] configure.ac cleanup of BerkleyDB related	checks">eliezer at ngtech.co.il
       </A><BR>
    <I>Fri Mar 31 01:56:26 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008333.html">[squid-dev] [PATCH] configure.ac cleanup of BerkleyDB related	checks
</A></li>
        <LI>Next message: <A HREF="008335.html">[squid-dev] [PATCH] Second adaptation missing for CONNECTs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8334">[ date ]</a>
              <a href="thread.html#8334">[ thread ]</a>
              <a href="subject.html#8334">[ subject ]</a>
              <a href="author.html#8334">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>+1..

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">eliezer at ngtech.co.il</A>



-----Original Message-----
From: squid-dev [mailto:<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev-bounces at lists.squid-cache.org</A>] On Behalf Of Amos Jeffries
Sent: Monday, March 27, 2017 4:58 PM
To: Squid Developers &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev at lists.squid-cache.org</A>&gt;
Subject: [squid-dev] [PATCH] configure.ac cleanup of BerkleyDB related checks

While looking into the last remaining bits of bug 4610 I have found that most of what we were doing for libdb / -ldb is not necessary any longer.

Most of the logic seems to be hangovers from when session helper was using the BerkleyDB v1.85 compatibility interface. Some of it is possibly still necessary for the time_quota helper, but that helper has not been using it so far and needs an upgrade to match what happened to session helper.

Changes:

* The helpers needing -ldb will not be built unless the library and headers are available. So we can drop the Makefile LIB_DB substitutions and always just link -ldb explicitly to these helpers.

NP: Anyone who needs small minimal binaries, can build with the --as-needed linker flag, or without these helpers. This change has no effect on other helpers or the main squid binary.

* Since we no longer need to check if -ldb is necessary, we can drop the configure.ac and acinclude logic detecting that.

* Remove unused AC_CHECK_DECL(dbopen, ...)
 - resolves one &quot;FIXME&quot;

* Fix the time_quota helper check to only scan db.h header file contents if that file is existing, and if the db_185.h file is not being used instead.

* Fix the session helper check to only try compiling with the db.h header if that header actually exists.

* De-duplicate the library header file detection shared by configure.ac and the helpers required.m4 files (after the above two changes).

* Remove unused DBLIB variable from configure.ac.

Amos


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008333.html">[squid-dev] [PATCH] configure.ac cleanup of BerkleyDB related	checks
</A></li>
	<LI>Next message: <A HREF="008335.html">[squid-dev] [PATCH] Second adaptation missing for CONNECTs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8334">[ date ]</a>
              <a href="thread.html#8334">[ thread ]</a>
              <a href="subject.html#8334">[ subject ]</a>
              <a href="author.html#8334">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
