<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] A new 'has' ACL
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20A%20new%20%27has%27%20ACL&In-Reply-To=%3Ce43adb43-b99e-7ab5-7e06-63553fb64d4c%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008564.html">
   <LINK REL="Next"  HREF="008566.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] A new 'has' ACL</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20A%20new%20%27has%27%20ACL&In-Reply-To=%3Ce43adb43-b99e-7ab5-7e06-63553fb64d4c%40measurement-factory.com%3E"
       TITLE="[squid-dev] A new 'has' ACL">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue May  2 20:53:10 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008564.html">[squid-dev] A new 'has' ACL
</A></li>
        <LI>Next message: <A HREF="008566.html">[squid-dev] A new 'has' ACL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8565">[ date ]</a>
              <a href="thread.html#8565">[ thread ]</a>
              <a href="subject.html#8565">[ subject ]</a>
              <a href="author.html#8565">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 05/02/2017 12:38 PM, Eduard Bagdasaryan wrote:
&gt;<i> after r14752 each transaction has its ALE created. 
</I>
When you say &quot;each transaction&quot;, how do you define &quot;transaction&quot; in this
context?

AFAICT, r14752 deals with transactions originated by client requests and
broken client connections. Even if all those transactions are fully
covered, there are other transactions (e.g., ESI and Downloader
requests) that may or may not be covered (and seem to be completely
unrelated to r14752 changes!). Is there some kind of common interface
that essentially requires all transactions to have ALE now?


&gt;<i> Normally it is stored in
</I>&gt;<i> ClientHttpRequest::al.  However, I see that many ACLFilledChecklist
</I>&gt;<i> objects does not initialize their ACLFilledChecklist::al (assigning from
</I>&gt;<i> the transaction ALE). That works for now in most cases, probably
</I>&gt;<i> because there is the only ACLExternal which needs it and overrides
</I>&gt;<i> requiresAle() to return true. On the other hand, the lack of proper
</I>&gt;<i> ACLFilledChecklist::al initialization makes impossible correct using
</I>&gt;<i> ALE component in our 'has' ACL.
</I>
Thank you for researching this. Does the following summary accurately
reflect your findings as far as the current code is concerned?

&quot;The current ACL-driven code may feed an ACLFilledChecklist object
without ALE to an (ACLExternal) ACL that requires ALE.&quot;


&gt;<i> Evidently, if we fix this (e.g., with mandatory initializing
</I>&gt;<i> ACLFilledChecklist::al in its constructor), we would not need to
</I>&gt;<i> check ALE component either.
</I>
The question is whether we can &quot;fix this&quot; (i.e., guarantee correct ALE
presence when ALE is needed) _quickly_. I doubt that all
ACLFilledChecklist objects can easily reach the right ALE from their
constructing context. I am worried that fixing this will turn into a
serious, large project. Are you sure it will not?

If you are not sure, then I suggest keeping &quot;has ALE&quot; support. We can
easily make &quot;has ALE&quot; a no-op when/if the code is fixed to always have
access to ALE when ALE is needed.

I see no reason to resist supporting &quot;has ALE&quot; if Squid support for ALE
is currently broken and cannot be fixed easily/quickly. If you see flaws
in this logic, please point them out. I may be missing something.


Thank you,

Alex.


&gt;<i> On 01.05.2017 19:11, Alex Rousskov wrote:
</I>&gt;&gt;<i> On 04/30/2017 10:03 PM, Amos Jeffries wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Is there an explicit need you have found for ALE to be on the
</I>&gt;&gt;&gt;<i> component list? Since ALE is currently standing in as a &quot;master
</I>&gt;&gt;&gt;<i> transaction&quot; object for most of the Squid code. It needs to be either
</I>&gt;&gt;&gt;<i> created or provided/fetched from elsewhere whenever it is used.
</I>&gt;&gt;&gt;<i> Having an ACL that bypasses that would defeat bug-finding of places
</I>&gt;&gt;&gt;<i> where it is broken.
</I>&gt;&gt;<i> I would like to polish that question and correct its justification
</I>&gt;&gt;<i> logic: We can abuse admins as bug-finding guinea pigs only if we give
</I>&gt;&gt;<i> them tools to turn those bugs off. The &quot;has&quot; ACL is such a tool. Thus,
</I>&gt;&gt;<i> we need a &quot;has&quot; ACL component for any object that any ACL or ACL-driven
</I>&gt;&gt;<i> code uses (or should be using) conditionally. Hence, the question is:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Does Squid ACL or ACL-driven code correctly use (or should be using) ALE
</I>&gt;&gt;<i> conditionally?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If the answer is &quot;yes&quot;, then ALE should be added to &quot;has&quot;. If the answer
</I>&gt;&gt;<i> is &quot;maybe&quot;, then ALE may be added to &quot;has&quot;.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Please note that it is not necessary to have a specific crash or warning
</I>&gt;&gt;<i> bug report for the answer to become &quot;yes&quot; or &quot;maybe&quot;, justifying ALE
</I>&gt;&gt;<i> support in the &quot;has&quot; ACL. Squid code analysis is sufficient.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I cannot answer that question without doing more research, but I am sure
</I>&gt;&gt;<i> Eduard can find the right answer.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thank you,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Alex.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-dev mailing list
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">http://lists.squid-cache.org/listinfo/squid-dev</A>
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-dev mailing list
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">http://lists.squid-cache.org/listinfo/squid-dev</A>
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008564.html">[squid-dev] A new 'has' ACL
</A></li>
	<LI>Next message: <A HREF="008566.html">[squid-dev] A new 'has' ACL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8565">[ date ]</a>
              <a href="thread.html#8565">[ thread ]</a>
              <a href="subject.html#8565">[ subject ]</a>
              <a href="author.html#8565">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
