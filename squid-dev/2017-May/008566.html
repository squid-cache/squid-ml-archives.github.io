<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] A new 'has' ACL
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20A%20new%20%27has%27%20ACL&In-Reply-To=%3C010e8a79-fd36-0511-150f-11e6b9516acc%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008565.html">
   <LINK REL="Next"  HREF="008567.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] A new 'has' ACL</H1>
    <B>Eduard Bagdasaryan</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20A%20new%20%27has%27%20ACL&In-Reply-To=%3C010e8a79-fd36-0511-150f-11e6b9516acc%40measurement-factory.com%3E"
       TITLE="[squid-dev] A new 'has' ACL">eduard.bagdasaryan at measurement-factory.com
       </A><BR>
    <I>Tue May  2 22:18:00 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008565.html">[squid-dev] A new 'has' ACL
</A></li>
        <LI>Next message: <A HREF="008567.html">[squid-dev] A new 'has' ACL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8566">[ date ]</a>
              <a href="thread.html#8566">[ thread ]</a>
              <a href="subject.html#8566">[ subject ]</a>
              <a href="author.html#8566">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 02.05.2017 23:53, Alex Rousskov wrote:
&gt;<i> AFAICT, r14752 deals with transactions originated by client requests and
</I>&gt;<i> broken client connections. Even if all those transactions are fully
</I>&gt;<i> covered, there are other transactions (e.g., ESI and Downloader
</I>&gt;<i> requests) that may or may not be covered (and seem to be completely
</I>&gt;<i> unrelated to r14752 changes!). Is there some kind of common interface
</I>&gt;<i> that essentially requires all transactions to have ALE now?
</I>I have not found any ALE manipulations inside ESI and Downloader
code, so that is probably unrelated.
ClientHttpRequest is the object used in transactions, (including
Downloader and ESI code). This object owns its ALE, which is
created in the constructor. I have not found 'common interface'
you are talking about, but if all Squid transactions require
ClientHttpRequest object (which is probably true) then they surely
will have the corresponding ALE.
&gt;&gt;<i> Normally it is stored in
</I>&gt;&gt;<i> ClientHttpRequest::al.  However, I see that many ACLFilledChecklist
</I>&gt;&gt;<i> objects does not initialize their ACLFilledChecklist::al (assigning from
</I>&gt;&gt;<i> the transaction ALE). That works for now in most cases, probably
</I>&gt;&gt;<i> because there is the only ACLExternal which needs it and overrides
</I>&gt;&gt;<i> requiresAle() to return true. On the other hand, the lack of proper
</I>&gt;&gt;<i> ACLFilledChecklist::al initialization makes impossible correct using
</I>&gt;&gt;<i> ALE component in our 'has' ACL.
</I>&gt;<i> Thank you for researching this. Does the following summary accurately
</I>&gt;<i> reflect your findings as far as the current code is concerned?
</I>&gt;<i>
</I>&gt;<i> &quot;The current ACL-driven code may feed an ACLFilledChecklist object
</I>&gt;<i> without ALE to an (ACLExternal) ACL that requires ALE.&quot;
</I>
Yes.

&gt;&gt;<i> Evidently, if we fix this (e.g., with mandatory initializing
</I>&gt;&gt;<i> ACLFilledChecklist::al in its constructor), we would not need to
</I>&gt;&gt;<i> check ALE component either.
</I>&gt;<i> The question is whether we can &quot;fix this&quot; (i.e., guarantee correct ALE
</I>&gt;<i> presence when ALE is needed) _quickly_. I doubt that all
</I>&gt;<i> ACLFilledChecklist objects can easily reach the right ALE from their
</I>&gt;<i> constructing context. I am worried that fixing this will turn into a
</I>&gt;<i> serious, large project. Are you sure it will not?
</I>I agree that it is possible large project, because I am not
sure that every ACL checking context have its ALE near at hand.
&gt;<i> If you are not sure, then I suggest keeping &quot;has ALE&quot; support.
</I>
... and have our new 'has' ACL broken from the very beginning too.
As I tried to explain earlier, how can we rely on
ACLFilledChecklist::hasAle(), if the ALE itself have not been provided to
ACLFilledChecklist before?

&gt;<i>   We can
</I>&gt;<i> easily make &quot;has ALE&quot; a no-op when/if the code is fixed to always have
</I>&gt;<i> access to ALE when ALE is needed.
</I>&gt;<i>
</I>&gt;<i> I see no reason to resist supporting &quot;has ALE&quot; if Squid support for ALE
</I>&gt;<i> is currently broken and cannot be fixed easily/quickly. If you see flaws
</I>&gt;<i> in this logic, please point them out. I may be missing something.
</I>

Eduard.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008565.html">[squid-dev] A new 'has' ACL
</A></li>
	<LI>Next message: <A HREF="008567.html">[squid-dev] A new 'has' ACL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8566">[ date ]</a>
              <a href="thread.html#8566">[ thread ]</a>
              <a href="subject.html#8566">[ subject ]</a>
              <a href="author.html#8566">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
