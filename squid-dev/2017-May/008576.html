<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Fix 'miss_access' and 'cache' checks when no ACL rules matched
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Fix%20%27miss_access%27%20and%20%27cache%27%20checks%20when%20no%0A%20ACL%20rules%20matched&In-Reply-To=%3C75437f06-dc80-4ca8-510e-69fc815962e3%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008580.html">
   <LINK REL="Next"  HREF="008593.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Fix 'miss_access' and 'cache' checks when no ACL rules matched</H1>
    <B>Eduard Bagdasaryan</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Fix%20%27miss_access%27%20and%20%27cache%27%20checks%20when%20no%0A%20ACL%20rules%20matched&In-Reply-To=%3C75437f06-dc80-4ca8-510e-69fc815962e3%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] Fix 'miss_access' and 'cache' checks when no ACL rules matched">eduard.bagdasaryan at measurement-factory.com
       </A><BR>
    <I>Fri May  5 14:18:16 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008580.html">[squid-dev] Jenkins build is back to normal : template-full-matrix » gcc,d-ubuntu-wily #337
</A></li>
        <LI>Next message: <A HREF="008593.html">[squid-dev] [PATCH] Fix 'miss_access' and 'cache' checks when no ACL rules matched
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8576">[ date ]</a>
              <a href="thread.html#8576">[ thread ]</a>
              <a href="subject.html#8576">[ subject ]</a>
              <a href="author.html#8576">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

This patch fixes &quot;miss_access&quot; and &quot;cache&quot; checks when no ACL rules
matched.

The miss_access code allowed transactions to reach origin server when no
&quot;allow&quot; rules matched (and no &quot;deny&quot; rule matched either). This could
happen when a miss_access directive ACL could not make a &quot;match&quot; or
&quot;mismatch&quot; decision (e.g., the admin used a slow ACL or an ACL that
required authentication when the user was not authenticated).

Similarly, the &quot;cache&quot; directive code allowed requests to be served from
the cache (and responses to be stored in the cache) when no &quot;allow&quot; (and
&quot;deny&quot;) rules matched. This behavior (established in v5 r14984) does not
contradict &quot;Requests denied by this directive will not be...&quot;
documentation, though.

I believe that both &quot;miss_access&quot; and &quot;cache&quot; directives should behave
like all other directives in similar contexts, i.e., &quot;deny&quot; in such
indeterminate cases because:

* It avoids problems with configurations like:

    # broken if badGuys fails to match or mismatch (allows bad guys)
    acl_driven_option allow !badGuys

   That is what trunk r12176 has partially fixed.

* It makes ACL checking rules consistent with each other, especially if
   there is no good reason for making exception for these two cases.

To help avoid similar problems in the future, and to improve code
consistency, I added an API that eliminates the need for direct
comparison with ACCESS_ALLOWED and ACCESS_DENIED.

Thanks,

Eduard.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: SQUID-277-fix-and-clarify-access-denied-cases-t5.patch
Type: text/x-patch
Size: 127402 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20170505/40e466b0/attachment-0001.bin">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20170505/40e466b0/attachment-0001.bin</A>&gt;
</PRE>
































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008580.html">[squid-dev] Jenkins build is back to normal : template-full-matrix » gcc,d-ubuntu-wily #337
</A></li>
	<LI>Next message: <A HREF="008593.html">[squid-dev] [PATCH] Fix 'miss_access' and 'cache' checks when no ACL rules matched
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8576">[ date ]</a>
              <a href="thread.html#8576">[ thread ]</a>
              <a href="subject.html#8576">[ subject ]</a>
              <a href="author.html#8576">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
