<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Happy Eyeballs: Use each fully resolved	destination ASAP
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Happy%20Eyeballs%3A%20Use%20each%20fully%20resolved%0A%09destination%20ASAP&In-Reply-To=%3Ca6df17ae-ab48-eb59-776d-ac11446f4cc8%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008603.html">
   <LINK REL="Next"  HREF="008612.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Happy Eyeballs: Use each fully resolved	destination ASAP</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Happy%20Eyeballs%3A%20Use%20each%20fully%20resolved%0A%09destination%20ASAP&In-Reply-To=%3Ca6df17ae-ab48-eb59-776d-ac11446f4cc8%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] Happy Eyeballs: Use each fully resolved	destination ASAP">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue May 16 04:33:32 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008603.html">[squid-dev] [PATCH] Create PID file ASAP
</A></li>
        <LI>Next message: <A HREF="008612.html">[squid-dev] [PATCH] Happy Eyeballs: Use each fully resolved destination ASAP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8610">[ date ]</a>
              <a href="thread.html#8610">[ thread ]</a>
              <a href="subject.html#8610">[ subject ]</a>
              <a href="author.html#8610">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

    The attached patch is the first in a short series of patches that
improve Squid support for the Happy Eyeballs principle. The motivation
for these patches has been discussed on the dns_wait_for_all thread:
<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/2016-September/006831.html">http://lists.squid-cache.org/pipermail/squid-dev/2016-September/006831.html</A>

With this change, Squid no longer waits for all request forwarding
destinations to be resolved. Instead, it uses each fully resolved
destination as soon as it is needed. More info is in the patch preamble.

The next planned step is to deliver A and AAAA answers to the peer
selection code independently and ASAP. When both changes are combined,
the FwdState/tunneling code will receive IPvX addresses without waiting
for IPvY addresses (and/or other destination names) to be resolved,
making user eyeballs happier and, hence, facilitating IPv6 deployments.


This patch also adds reporting of peer type when dumping Connection
info. I removed operator &quot;&lt;&lt;&quot; definition from Connection.h header
because we should not burden all Connection users with these low-level
(and performance-unrelated) details. I also removed associated comments
because they were partially misleading (or perhaps outdated) and
partially misplaced (Connection.h is not the right place to state basic
C++ operator overloading rules). If there are no objections, I will
commit this minor improvement separately.

No changes to FwdServer class but its declaration has been moved from
the PeerSelectState.h header to peer_select.cc because FwdServer is
unused by peerSelect() users.

No changes to peerCountMcastPeers functionality. I only documented the
abuse and marked the abused ps_state field with XXX to prevent future
abuses.


Cheers,

Alex.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SQUID69-use-destination-asap-t2.patch
Type: text/x-diff
Size: 78543 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20170515/2cf82c34/attachment-0001.patch">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20170515/2cf82c34/attachment-0001.patch</A>&gt;
</PRE>






























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008603.html">[squid-dev] [PATCH] Create PID file ASAP
</A></li>
	<LI>Next message: <A HREF="008612.html">[squid-dev] [PATCH] Happy Eyeballs: Use each fully resolved destination ASAP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8610">[ date ]</a>
              <a href="thread.html#8610">[ thread ]</a>
              <a href="subject.html#8610">[ subject ]</a>
              <a href="author.html#8610">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
