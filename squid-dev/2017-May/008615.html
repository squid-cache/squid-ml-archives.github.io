<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Make PID file check/creation atomic
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Make%20PID%20file%20check/creation%20atomic&In-Reply-To=%3Ca2fdf056-2da8-8974-c305-c3a84e8af8ba%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008605.html">
   <LINK REL="Next"  HREF="008620.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Make PID file check/creation atomic</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Make%20PID%20file%20check/creation%20atomic&In-Reply-To=%3Ca2fdf056-2da8-8974-c305-c3a84e8af8ba%40treenet.co.nz%3E"
       TITLE="[squid-dev] [PATCH] Make PID file check/creation atomic">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue May 16 12:21:44 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008605.html">[squid-dev] [PATCH] Make PID file check/creation atomic
</A></li>
        <LI>Next message: <A HREF="008620.html">[squid-dev] [PATCH] Make PID file check/creation atomic
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8615">[ date ]</a>
              <a href="thread.html#8615">[ thread ]</a>
              <a href="subject.html#8615">[ subject ]</a>
              <a href="author.html#8615">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 16/05/17 01:42, Eduard Bagdasaryan wrote:
&gt;<i> Could you clarify, what are these processes that 'operate as threads'? 
</I>&gt;<i> AFAIK,
</I>&gt;<i> Squid spawns its children by fork() and execlp(), and each new process 
</I>&gt;<i> is a
</I>&gt;<i> common process with its own address space. As for atomicity, the OS itself
</I>&gt;<i> guarantees that only one process can have an exclusive file lock at a
</I>&gt;<i> given time. Where do you suggest to use std::atomic then?
</I>&gt;<i>
</I>
The main Squid binary is threaded via the DiskIO implementations (at the 
least). These threads may be operational at any time after the first 
StoreInit() call, and unfortunately do reach other parts of the startup 
logic.


An static std::atomic lock/flag around the File::File() try{...} 
internals to make it threadsafe should resolve any potential issues 
there, the fnctl locks should be able to cope with anything once the 
lock() method returns.


Amos

</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008605.html">[squid-dev] [PATCH] Make PID file check/creation atomic
</A></li>
	<LI>Next message: <A HREF="008620.html">[squid-dev] [PATCH] Make PID file check/creation atomic
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8615">[ date ]</a>
              <a href="thread.html#8615">[ thread ]</a>
              <a href="subject.html#8615">[ subject ]</a>
              <a href="author.html#8615">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
