<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Do not die silently when dying via	std::terminate()
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Do%20not%20die%20silently%20when%20dying%20via%0A%09std%3A%3Aterminate%28%29&In-Reply-To=%3Cae73aa8a-82a2-915a-1ca5-e17a263eeafd%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008629.html">
   <LINK REL="Next"  HREF="008649.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Do not die silently when dying via	std::terminate()</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Do%20not%20die%20silently%20when%20dying%20via%0A%09std%3A%3Aterminate%28%29&In-Reply-To=%3Cae73aa8a-82a2-915a-1ca5-e17a263eeafd%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] Do not die silently when dying via	std::terminate()">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu May 18 00:20:55 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008629.html">[squid-dev] Introduction / SslBump prototype patch to ignore unknown ciphers
</A></li>
        <LI>Next message: <A HREF="008649.html">[squid-dev] [PATCH] Do not die silently when dying early
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8630">[ date ]</a>
              <a href="thread.html#8630">[ thread ]</a>
              <a href="subject.html#8630">[ subject ]</a>
              <a href="author.html#8630">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

    While triaging a silent crash of a production Squid, I realized that
our death reporting code has a serious (and recently grown) hole. The
attached patch closes it. This reporting-only patch does not fix any
crashes. There are more technical details in the preamble.

Researching this problem gave me an idea on how we can preserve Squid
stack when dying from unhandled runtime exceptions. This patch does not
implement that idea but adds a corresponding XXX and TODO comments.

This patch changes the same SquidMainSafe() code as the pending atomic
PID patch does. While the changes conflict at the patch level, they are
fully compatible at the &quot;logic level&quot;. The conflict is easy to resolve.


HTH,

Alex.
P.S. The &quot;current exception&quot; reporting code was copied, with
adaptations, from Web Polygraph. It uses a relatively well-known
&quot;re-throw exception to determine its type&quot; trick. There are several ways
to build a reporting API for exceptions. The proposed design worked the
best (after several trials and errors) in Polygraph.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SQUID300-silent-term-death-t4.patch
Type: text/x-diff
Size: 4707 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20170517/50357377/attachment.patch">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20170517/50357377/attachment.patch</A>&gt;
</PRE>











































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008629.html">[squid-dev] Introduction / SslBump prototype patch to ignore unknown ciphers
</A></li>
	<LI>Next message: <A HREF="008649.html">[squid-dev] [PATCH] Do not die silently when dying early
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8630">[ date ]</a>
              <a href="thread.html#8630">[ thread ]</a>
              <a href="subject.html#8630">[ subject ]</a>
              <a href="author.html#8630">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
