<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Do not die silently when dying early
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Do%20not%20die%20silently%20when%20dying%20early&In-Reply-To=%3Cff8d00c0-09ee-eace-1dca-75b4a57cf93d%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008630.html">
   <LINK REL="Next"  HREF="008650.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Do not die silently when dying early</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Do%20not%20die%20silently%20when%20dying%20early&In-Reply-To=%3Cff8d00c0-09ee-eace-1dca-75b4a57cf93d%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] Do not die silently when dying early">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri May 19 22:25:30 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008630.html">[squid-dev] [PATCH] Do not die silently when dying via	std::terminate()
</A></li>
        <LI>Next message: <A HREF="008650.html">[squid-dev] [PATCH] Do not die silently when dying early
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8649">[ date ]</a>
              <a href="thread.html#8649">[ thread ]</a>
              <a href="subject.html#8649">[ subject ]</a>
              <a href="author.html#8649">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

    The attached patch allows Squid to report various problems (e.g.,
mishandled exceptions) that may occur very early in Squid lifetime,
before proper logging is configured by the first _db_init() call.

To enable such early reporting, we started with a trivial debug.cc change:

  -FILE *debug_log = NULL;
  +FILE *debug_log = stderr;

... but then realized that debug_log may not be assigned early enough!
The resulting changes ensure that we can log (to stderr if necessary) as
soon as stderr itself is initialized. They also polish related logging
code, including localization of stderr checks and elimination of
double-closure during log rotation on Windows.

These reporting changes do not bypass or eliminate any failures.

This patch is independent from the &quot;Do not die silently when dying via
std::terminate()&quot; patch posted a few days ago, but, in combination, the
two patches fix reporting of early std::terminate() deaths.


Cheers,

Alex.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: SQUID300-silent-early-death-t4.patch
Type: text/x-diff
Size: 16947 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20170519/e7eb0465/attachment-0001.patch">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20170519/e7eb0465/attachment-0001.patch</A>&gt;
</PRE>

























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008630.html">[squid-dev] [PATCH] Do not die silently when dying via	std::terminate()
</A></li>
	<LI>Next message: <A HREF="008650.html">[squid-dev] [PATCH] Do not die silently when dying early
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8649">[ date ]</a>
              <a href="thread.html#8649">[ thread ]</a>
              <a href="subject.html#8649">[ subject ]</a>
              <a href="author.html#8649">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
