<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [PATCH] Do not die silently when dying early
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Do%20not%20die%20silently%20when%20dying%20early&In-Reply-To=%3C0de16fc1-2d44-e40d-346d-1065fbf1181e%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="008650.html">
   <LINK REL="Next"  HREF="008659.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [PATCH] Do not die silently when dying early</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BPATCH%5D%20Do%20not%20die%20silently%20when%20dying%20early&In-Reply-To=%3C0de16fc1-2d44-e40d-346d-1065fbf1181e%40measurement-factory.com%3E"
       TITLE="[squid-dev] [PATCH] Do not die silently when dying early">rousskov at measurement-factory.com
       </A><BR>
    <I>Sat May 20 16:31:47 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="008650.html">[squid-dev] [PATCH] Do not die silently when dying early
</A></li>
        <LI>Next message: <A HREF="008659.html">[squid-dev] [PATCH] SBuf header names
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8651">[ date ]</a>
              <a href="thread.html#8651">[ thread ]</a>
              <a href="subject.html#8651">[ subject ]</a>
              <a href="author.html#8651">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 05/20/2017 05:04 AM, Amos Jeffries wrote:

&gt;<i> in src/Debug.h:
</I>&gt;<i> 
</I>&gt;<i> * instead of adding yet another wrapper macro, please replace all uses
</I>&gt;<i> of debug_log with DebugStream().
</I>
I will not do that because many (most?) debug_log users should not use
DebugStream(). They should use the standard debugs() API. However,
carefully fixing that code is outside this particular change scope.


&gt;<i>  - we already know from earlier macros that these just lead us to much
</I>&gt;<i> more pain and long arguments in future developments.
</I>
Compared to HERE and NULL, there are very few debug_log users. The
primary reason I left them alone is that many of them require
non-trivial out-of-scope changes other than dumb renaming. It is
actually a good idea to leave the old macro in place as a marker for
that code.


&gt;<i>  - the important comment by Duane in src/main.cc SquidShutdown() is now
</I>&gt;<i> needing an update to reference the current symbol names.
</I>
Since I am refusing to remove debug_log in this patch, the comment does
not need updating. The comment itself should be removed as stale (or
completely rewritten) because (a) Squid provides several services that
must function beyond main() and (b) those services should not have a
&quot;close&quot; API so that we do not need to warn anybody not to use that wrong
API.


&gt;<i> in src/debug.cc:
</I>&gt;<i> 
</I>&gt;<i> * debugOpenLog()
</I>&gt;<i>  - since the bulk of the function is being altered please take the
</I>&gt;<i> opportunity to remove the use of NULL in there.
</I>
I am not going to do what I think is wrong and what I continue to
discourage others from doing. The pain reduction rule we all should
follow IMO is &quot;If you do not have to change a line for in-scope reasons,
then do not change that line&quot;.


&gt;<i>  - in the else condition after fopen() we are writing explicitly to
</I>&gt;<i> stderr then clearing TheLog. It seems to me that a better thing would be
</I>&gt;<i> to do is write that notice to TheLog before clearing it, to perror() and
</I>&gt;<i> then to TheLog after clearing it.
</I>
TheLog is usually closed at the time of that &quot;else&quot; code execution. The
correct solution here is to use debugs(), while making sure that API
works in this (and nearly any other) context and logs to stderr and
syslog as needed. That change is outside this patch scope.

Did I convince you that none of the above requested changes are required?


Thank you,

Alex.

</PRE>

























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008650.html">[squid-dev] [PATCH] Do not die silently when dying early
</A></li>
	<LI>Next message: <A HREF="008659.html">[squid-dev] [PATCH] SBuf header names
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8651">[ date ]</a>
              <a href="thread.html#8651">[ thread ]</a>
              <a href="subject.html#8651">[ subject ]</a>
              <a href="author.html#8651">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
