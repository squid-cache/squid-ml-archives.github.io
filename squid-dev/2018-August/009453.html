<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] TLS proxy-server connection optimization
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20TLS%20proxy-server%20connection%20optimization&In-Reply-To=%3CCABfsTT6rfA%3D5S%2BXrYdim5zHR2FGT170PwF4qjsUbX0T0Of4CaA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="009452.html">
   <LINK REL="Next"  HREF="009454.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] TLS proxy-server connection optimization</H1>
    <B>Vishali Somaskanthan</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20TLS%20proxy-server%20connection%20optimization&In-Reply-To=%3CCABfsTT6rfA%3D5S%2BXrYdim5zHR2FGT170PwF4qjsUbX0T0Of4CaA%40mail.gmail.com%3E"
       TITLE="[squid-dev] TLS proxy-server connection optimization">vishali.somaskanthan at viptela.com
       </A><BR>
    <I>Sat Aug  4 00:15:33 UTC 2018</I>
    <P><UL>
        <LI>Previous message: <A HREF="009452.html">[squid-dev] How to rewrite URL in squid proxy server according to client's custom request header?
</A></li>
        <LI>Next message: <A HREF="009454.html">[squid-dev] TLS proxy-server connection optimization
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9453">[ date ]</a>
              <a href="thread.html#9453">[ thread ]</a>
              <a href="subject.html#9453">[ subject ]</a>
              <a href="author.html#9453">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Alex,

Thank you for mentioning about specific details. Here is the point.

[Alex] Why does Squid close the (not pinned) Squid-to-server connection in
this
case? What code/condition triggers that closure in your tests?

When the SSL-bump steps are
1. *peek-splice and peek-peek-splice*,
we observe the behavior that squid does tunneling and presume that SSL
proxying is not happening in this case.
Hence, after the series of writes, *keepGoingAfterRead()* is called where
the following snippet triggers the closure from squid to server.

*/* Only close the remote end if we've finished queueing data to it */*
*        if (from.len == 0 &amp;&amp; Comm::IsConnOpen(to.conn) ) {*
*            to.conn-&gt;close();*

Here, we would to like to do the optimization where instead of closing
them, we want to Push the connection to Pconn pool which can be used later
for a second request. So that TCP persistence is achieved.

2. *peek-bump*

As we have discussed already in the general forum (<A HREF="http://squid-web-pro">http://squid-web-pro</A>
xy-cache.1019090.n4.nabble.com/server-persistent-connections
-and-cache-td4685973.html), the table contains the cases where pinning
happens and where not, we would like to achieve the SSL persistence here
from squid to-server connection. When we unpin the connection it gets
closed, and we would like to retain them up in the pool. Please let me know
what information is required in this case for further validation.


Thank you,
Vishali


On Tue, Jul 31, 2018 at 4:29 PM, Alex Rousskov &lt;
<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">rousskov at measurement-factory.com</A>&gt; wrote:

&gt;<i> On 07/31/2018 05:00 PM, Vishali Somaskanthan wrote:
</I>&gt;<i> &gt; If I peek @step1 and splice@ step2 -&gt; The connections are **not** pinned
</I>&gt;<i> &gt; as such. However, Client-squid SSL+TCP termination results in
</I>&gt;<i> &gt; squid-server SSL+TCP termination.
</I>&gt;<i>
</I>&gt;<i> Why does Squid close the (not pinned) Squid-to-server connection in this
</I>&gt;<i> case? What code/condition triggers that closure in your tests?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Please provide any insights on whether this is going to be a valid
</I>&gt;<i> &gt; optimization and if we can come up with a set of rules where this
</I>&gt;<i> &gt; could apply.
</I>&gt;<i>
</I>&gt;<i> With enough information/analysis, we should be able to correctly
</I>&gt;<i> evaluate your proposal, but that proposal will have to be a lot more
</I>&gt;<i> specific than &quot;We want to optimize TLS and evaluate if squid to-server
</I>&gt;<i> TLS connection can be reused for consecutive requests from multiple
</I>&gt;<i> clients&quot;. My question above is a (small) step towards formulating a
</I>&gt;<i> specific &quot;We want to change Squid to do X instead of Y&quot; proposal.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thank you,
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i>
</I>


-- 
Regards,
Vishali Somaskanthan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20180803/b07c9247/attachment.html">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20180803/b07c9247/attachment.html</A>&gt;
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009452.html">[squid-dev] How to rewrite URL in squid proxy server according to client's custom request header?
</A></li>
	<LI>Next message: <A HREF="009454.html">[squid-dev] TLS proxy-server connection optimization
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9453">[ date ]</a>
              <a href="thread.html#9453">[ thread ]</a>
              <a href="subject.html#9453">[ subject ]</a>
              <a href="author.html#9453">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
