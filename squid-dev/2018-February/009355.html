<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [RFC] http(s)_port TLS/SSL config redesign
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20http%28s%29_port%20TLS/SSL%20config%20redesign&In-Reply-To=%3C7d3312a3-579d-3423-fb08-9c0bf0282413%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   <LINK REL="Next"  HREF="009356.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [RFC] http(s)_port TLS/SSL config redesign</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5BRFC%5D%20http%28s%29_port%20TLS/SSL%20config%20redesign&In-Reply-To=%3C7d3312a3-579d-3423-fb08-9c0bf0282413%40treenet.co.nz%3E"
       TITLE="[squid-dev] [RFC] http(s)_port TLS/SSL config redesign">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Feb  1 13:11:01 UTC 2018</I>
    <P><UL>
        
        <LI>Next message: <A HREF="009356.html">[squid-dev] [RFC] http(s)_port TLS/SSL config redesign
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9355">[ date ]</a>
              <a href="thread.html#9355">[ thread ]</a>
              <a href="subject.html#9355">[ subject ]</a>
              <a href="author.html#9355">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The final part of the proposal quoted below are now PR'd for audit.

There are several differences from the initial proposal;

* the ServerOptions::signingCa class changes and new default for
generate-host-certificates have allowed a far simpler back-compat check
using the non-existence of a filename by generate-host-certificates=
instead of relying on cert CA checking.
 That CA checking should still be done, but is no longer a required part
of this project.

* generation of reverse-proxy certificates is happening in a separate
parallel project.


Amos


On 20/07/17 13:27, Amos Jeffries wrote:
&gt;<i> Hi all, Christos and Alex particularly,
</I>&gt;<i> 
</I>&gt;<i> I have been mulling over several ideas for how to improve the config
</I>&gt;<i> parameters on the http(s)_port to make them a bit easier for newbies to
</I>&gt;<i> get right, and pros to do powerfully cool stuff.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> So, the most major change I would like to propose is to move the proxies
</I>&gt;<i> CA for cert generation from cert= parameter to
</I>&gt;<i> generate-host-certificates= parameter. Having it configured with a file
</I>&gt;<i> being the same as generate =on and not configuring it default to =off.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> The matching key= and any CA chain would need to be all bundled in the
</I>&gt;<i> same PEM file. That should be fine since the clients get a separate DER
</I>&gt;<i> file installed, not sharing the PEM file loaded into Squid.
</I>&gt;<i> 
</I>&gt;<i> That will stop confusing newbies have over what should go in cert= for
</I>&gt;<i> what Squid use-case. And will allow pros to configure exactly which
</I>&gt;<i> static cert Squid uses as a fallback when auto-generating others -
</I>&gt;<i> simply by using cert= in the normal non-bumping way.
</I>&gt;<i> 
</I>&gt;<i> Also, we can then easily use the two sets of parameters in identical
</I>&gt;<i> fashion for non-SSL-Bump proxies to auto-generate reverse-proxy certs
</I>&gt;<i> based on SNI, or use a fallback static cert of admins choice.
</I>&gt;<i> 
</I>&gt;<i> Bringing these two different use-cases config into line should vastly
</I>&gt;<i> simplify the complexity of working with Squid TLS certs for everybody,
</I>&gt;<i> including us in the code as we no longer have multiple (8! at least)
</I>&gt;<i> code paths for different cert= possibilities and config error handling
</I>&gt;<i> permutations.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> For backward compatibility concerns with existing SSL-Bump configs I
</I>&gt;<i> think we can use the certificate CA vs non-CA property to auto-detect
</I>&gt;<i> old SSL-Bump configs being loaded and handle the compatibility
</I>&gt;<i> auto-upgrade and warnings. The warning will be useful long-term and not
</I>&gt;<i> just for the transitional period.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Now would also be a marginally better than usual time to make the change
</I>&gt;<i> since the parameters are migrating to tls-* prefix in v4 and have extra
</I>&gt;<i> admin attention already.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-dev mailing list
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">http://lists.squid-cache.org/listinfo/squid-dev</A>
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="009356.html">[squid-dev] [RFC] http(s)_port TLS/SSL config redesign
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9355">[ date ]</a>
              <a href="thread.html#9355">[ thread ]</a>
              <a href="subject.html#9355">[ subject ]</a>
              <a href="author.html#9355">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
