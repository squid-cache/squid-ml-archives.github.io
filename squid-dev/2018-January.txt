From squid3 at treenet.co.nz  Tue Jan  9 05:11:15 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 9 Jan 2018 18:11:15 +1300
Subject: [squid-dev] Squid on Windows
In-Reply-To: <CAPu9cN63dyMHY4XhrFKv=ZDrDi9-OJ1X=59e7zPoUMT4Lw4=Aw@mail.gmail.com>
References: <CAPu9cN63dyMHY4XhrFKv=ZDrDi9-OJ1X=59e7zPoUMT4Lw4=Aw@mail.gmail.com>
Message-ID: <fd075368-d44c-ded1-9bca-9cc92f1d89fd@treenet.co.nz>

On 09/01/18 15:56, Lei Wen wrote:
> Hi everyone,
> 
> This is Lei Wen, I am from Microsoft Azure team.
> 
> We are seeking a solution about on host transparent proxy for containers 
> with Squid on Windows.
> 
> We already tried Linux and by using iptables traffic can be redirected 
> to squid port(e.x. 3128).
> 
> We want to know what do we need do to enable transparent proxy on Squid 
> side on Windows Like on the Linux, --enable-linux-netfilter enables 
> transparent proxy.

Hi Lei,

For NAT interception, Squid needs an interface from the OS to lookup NAT 
table mappings given either the accept() provided IP:port pair(s) and/or 
the socket handle. The API needs to provide the original dst-IP:port 
details the client used prior to the NAT alterations.

As far as I/we have been able to tell so far Windows does not provide 
any such interface for use by applications running in user-space like 
Squid. Once an interface is found or created adding a lookup function to 
Squid using the API should be fairly simple.

There have been several attempts that I'm aware of to create custom 
network drivers for Windows. But those turned out to be very much too 
slow and required asynchronous operations inside the preferrably 
synchronous NAT lookup.


An alternative API to look for is TPROXY. But, I've not seen or heard of 
anything like that either for Windows.


Amos Jeffries
The Squid Software Foundation

From maba at mb-systemhaus.net  Thu Jan 18 17:40:56 2018
From: maba at mb-systemhaus.net (Martin Bayreuther)
Date: Thu, 18 Jan 2018 18:40:56 +0100
Subject: [squid-dev] [squid-announce] RFC: Squid ESI processor changes
In-Reply-To: <04eefb10-68c8-f24e-f067-34a6df45b181@treenet.co.nz>
References: <04eefb10-68c8-f24e-f067-34a6df45b181@treenet.co.nz>
Message-ID: <698fdaef-416d-1740-9c1b-7553f7f65cb8@mb-systemhaus.net>

Hello,

I am running two squid instances (Debian stretch - up to date with 
repos). In both instances, the esi_parser config is commented out.
Changing it to whatever value will not impact performance in my 
situation. (10 machines behind a DSL link, squid taking some load off 
the link)

Regards
Maba

Am 18.01.2018 um 16:16 schrieb Amos Jeffries:
> The Squid team are planning to remove the Custom XML parser used for 
> ESI processing from the next Squid version.
>
> At first this seemed like a simple removal if unused functionality. 
> However during review of the changes it turns out this functionality 
> may be used in many situations when it should not have been.
>
>
> Can people using ESI please provide answers for these questions:
>
>
> What is your setting for esi_parser squid.conf directive?
>
>  a) did not set it
>  b) "expat"
>  c) "libxml2"
>  d) "custom"
>
> If you answered (d), why choose that one?
>
>
> If you answer (a) does setting it explicitly to either of the other 
> parsers cause a large impact on your traffic performance?
>
>   Yes/No
>
> If yes, which did you choose?
>
>  ... and how much of an impact was seen?
>
>
>
> If you are not comfortable answering this to the squid-dev mailing 
> list please feel free to send your responses directly to me.
>
> Amos Jeffries
> The Squid Software Foundation
>
> _______________________________________________
> squid-announce mailing list
> squid-announce at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-announce


From squid3 at treenet.co.nz  Thu Jan 18 15:16:49 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 19 Jan 2018 04:16:49 +1300
Subject: [squid-dev] RFC: Squid ESI processor changes
Message-ID: <04eefb10-68c8-f24e-f067-34a6df45b181@treenet.co.nz>

The Squid team are planning to remove the Custom XML parser used for ESI 
processing from the next Squid version.

At first this seemed like a simple removal if unused functionality. 
However during review of the changes it turns out this functionality may 
be used in many situations when it should not have been.


Can people using ESI please provide answers for these questions:


What is your setting for esi_parser squid.conf directive?

  a) did not set it
  b) "expat"
  c) "libxml2"
  d) "custom"

If you answered (d), why choose that one?


If you answer (a) does setting it explicitly to either of the other 
parsers cause a large impact on your traffic performance?

   Yes/No

If yes, which did you choose?

  ... and how much of an impact was seen?



If you are not comfortable answering this to the squid-dev mailing list 
please feel free to send your responses directly to me.

Amos Jeffries
The Squid Software Foundation


From amajer at suse.de  Mon Jan 22 14:10:45 2018
From: amajer at suse.de (Adam Majer)
Date: Mon, 22 Jan 2018 15:10:45 +0100
Subject: [squid-dev] RFC: Squid ESI processor changes
In-Reply-To: <04eefb10-68c8-f24e-f067-34a6df45b181@treenet.co.nz>
References: <04eefb10-68c8-f24e-f067-34a6df45b181@treenet.co.nz>
Message-ID: <2d8b138c-65b5-0fe1-e164-588acd4dfeaa@suse.de>

On 01/18/2018 04:16 PM, Amos Jeffries wrote:
> The Squid team are planning to remove the Custom XML parser used for ESI
> processing from the next Squid version.

For next squid version, do you mean 5.x? next 4.x release? or stable
3.5.x release?

proposed new default? libxml2?

- Adam

From squid3 at treenet.co.nz  Mon Jan 22 14:55:38 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 23 Jan 2018 03:55:38 +1300
Subject: [squid-dev] RFC: Squid ESI processor changes
In-Reply-To: <2d8b138c-65b5-0fe1-e164-588acd4dfeaa@suse.de>
References: <04eefb10-68c8-f24e-f067-34a6df45b181@treenet.co.nz>
 <2d8b138c-65b5-0fe1-e164-588acd4dfeaa@suse.de>
Message-ID: <a73d85d7-d9ac-89ce-3572-7cc4c385092b@treenet.co.nz>

On 23/01/18 03:10, Adam Majer wrote:
> On 01/18/2018 04:16 PM, Amos Jeffries wrote:
>> The Squid team are planning to remove the Custom XML parser used for ESI
>> processing from the next Squid version.
> 
> For next squid version, do you mean 5.x? next 4.x release? or stable
> 3.5.x release?

4.0.23 has a tentative removal to see how it goes.

> 
> proposed new default? libxml2?

Yes and no. Auto-detected from libxml2 or libexpat in that order of
preference, relative to which of them your Squid is built against
(either, both or none).

NP: That preference is based purely on what their popularity and active
development looked like last week.

Amos

From squid3 at treenet.co.nz  Mon Jan 22 15:29:23 2018
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 23 Jan 2018 04:29:23 +1300
Subject: [squid-dev] Introduction
In-Reply-To: <CAAqh3JKyO4T1+VpK5RSSVFxY-Cf8-5z=s=rZp2-m9-eSg6zqGg@mail.gmail.com>
References: <CAAqh3JKyO4T1+VpK5RSSVFxY-Cf8-5z=s=rZp2-m9-eSg6zqGg@mail.gmail.com>
Message-ID: <a7550999-3315-66ed-8c0f-25a014ca01ec@treenet.co.nz>

On 20/12/17 02:11, Daniel Berredo wrote:
> Hello all,
> 
> My name is Daniel Santos and I am a DevOps in Brazil. I am working on a
> Hotspot Captive Portal project using Squid and need to be to able to
> evict an user from the Auth Cache before its ttl expired.
> What would be the best way to start on a proper PR? Is there any dev
> guidelines I should be aware of?
> 
> I am thinking about adding a new method to the CredentialsCache class
> ("evict", for example) and somehow make squid able to respond to a
> variation of the "PURGE" method. Than I would be able to use squid
> client to evict users from Auth Cache.
> 
> Is there anyone that could give me some directions on how to do this?
> 
> Thanks in advance,
> Daniel
> 

Hi Daniel,

 Sorry for the delay your post got stuck in our moderation queue. Please
note that this list now has a normal mailing list subscription process.
You subscribe with the form at
<http://lists.squid-cache.org/listinfo/squid-dev> and follow the bots
instructions.


Information for developers about Squid and the processes used by the
Squid Project is all linked from
<https://wiki.squid-cache.org/DeveloperResources>.


A feature similar to what you describe has been on the wishlist for a
very long time now. Do not go to the effort of a whole new HTTP method,
or anything like PURGE. The CacheMgr interface already has most of the
HTTP message functionality in place to do this type of thing through GET
or POST.

It looks like the external ACL cache is still using the old C-style
dump() code. So it will first need converting into an class inheriting
from Mgr::Action. Then processing added to parse "user=X" tokens from
the URL query-string, and to act on the value found.


Before you go to too much trouble, is there a specific reason why you
are considering this approach instead of just setting shorter TTLs on
the details the helper is supplying Squid?
Be aware the TTL in Squid is simply how often it asks the helper for
updates on the validity. It does *not* relate to when those credentials
expire except as a _maximum_ time until Squid notices actual expiry.


Amos Jeffries
The Squid Software Foundation

From pascal.bruls at kpn.com  Mon Jan 22 11:37:22 2018
From: pascal.bruls at kpn.com (pascal.bruls at kpn.com)
Date: Mon, 22 Jan 2018 11:37:22 +0000
Subject: [squid-dev] [squid-announce] RFC: Squid ESI processor changes
In-Reply-To: <04eefb10-68c8-f24e-f067-34a6df45b181@treenet.co.nz>
References: <04eefb10-68c8-f24e-f067-34a6df45b181@treenet.co.nz>
Message-ID: <AM0PR0102MB32188FF88AA211E19CCA300698EC0@AM0PR0102MB3218.eurprd01.prod.exchangelabs.com>

a) did not set it

-----Original Message-----
From: squid-announce [mailto:squid-announce-bounces at lists.squid-cache.org] On Behalf Of Amos Jeffries
Sent: Thursday, 18 January 2018 16:17
To: squid-announce at lists.squid-cache.org
Subject: [squid-announce] RFC: Squid ESI processor changes

The Squid team are planning to remove the Custom XML parser used for ESI processing from the next Squid version.

At first this seemed like a simple removal if unused functionality. 
However during review of the changes it turns out this functionality may be used in many situations when it should not have been.


Can people using ESI please provide answers for these questions:


What is your setting for esi_parser squid.conf directive?

  a) did not set it
  b) "expat"
  c) "libxml2"
  d) "custom"

If you answered (d), why choose that one?


If you answer (a) does setting it explicitly to either of the other 
parsers cause a large impact on your traffic performance?

   Yes/No

If yes, which did you choose?

  ... and how much of an impact was seen?



If you are not comfortable answering this to the squid-dev mailing list 
please feel free to send your responses directly to me.

Amos Jeffries
The Squid Software Foundation

_______________________________________________
squid-announce mailing list
squid-announce at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-announce

