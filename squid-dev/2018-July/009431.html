<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Terminating ICAP requests for aborted HTTP requests
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Terminating%20ICAP%20requests%20for%20aborted%20HTTP%20requests&In-Reply-To=%3Cda62177d-ea69-0ec6-34bd-2c632a0caf1e%40opendium.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="009430.html">
   <LINK REL="Next"  HREF="009433.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Terminating ICAP requests for aborted HTTP requests</H1>
    <B>Steve Hill</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Terminating%20ICAP%20requests%20for%20aborted%20HTTP%20requests&In-Reply-To=%3Cda62177d-ea69-0ec6-34bd-2c632a0caf1e%40opendium.com%3E"
       TITLE="[squid-dev] Terminating ICAP requests for aborted HTTP requests">steve at opendium.com
       </A><BR>
    <I>Thu Jul 12 08:34:34 UTC 2018</I>
    <P><UL>
        <LI>Previous message: <A HREF="009430.html">[squid-dev] Terminating ICAP requests for aborted HTTP requests
</A></li>
        <LI>Next message: <A HREF="009433.html">[squid-dev] Terminating ICAP requests for aborted HTTP requests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9431">[ date ]</a>
              <a href="thread.html#9431">[ thread ]</a>
              <a href="subject.html#9431">[ subject ]</a>
              <a href="author.html#9431">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/07/18 17:16, Amos Jeffries wrote:

&gt;<i> But the chunking here means end of *ICAP* message. Not end of HTTP message.
</I>&gt;<i> 
</I>&gt;<i> The ICAP server should use the HTTP message headers to know the HTTP
</I>&gt;<i> message sizes when possible. eg Content-Length and Content-Range values
</I>&gt;<i> indicate whether the HTTP delivered is complete or not.
</I>
Indeed, but many responses omit these headers, and it is therefore often 
not possible for the ICAP server to know whether it has seen the whole 
content.  Even HTTP responses that don't use a chunked transfer-encoding 
can omit these headers so long as the connection is closed at the end of 
the response.

I'm certainly not suggesting that Squid is &quot;wrong&quot; in the technical 
sense - it does follow the ICAP protocol specification.  Unfortunately 
the ICAP specification doesn't address aborted HTTP requests at all, so 
I'm wondering what a sensible way of addressing this is.

&gt;<i> If there *is* an ICAP signal then Squid should of course use that in all
</I>&gt;<i> cases of early halted HTTP content. Even when it uses the last-chunk to
</I>&gt;<i> say where the ICAP message ends and the next may begin.
</I>
As far as I'm aware, there is no ICAP signal for an aborted HTTP request 
- the spec does not address this at all.  Could be something for an 
updated ICAP RFC in the future though. :)

-- 
  - Steve Hill
    Technical Director
    Opendium    Online Safety / Web Filtering    <A HREF="http://www.opendium.com">http://www.opendium.com</A>

    Enquiries:  <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">sales at opendium.com</A>      +44-1792-824568
    Support:    <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">support at opendium.com</A>    +44-1792-825748


    Opendium Limited is a company registered in England and Wales.
    Company No. 5465437
    Highfield House, 1 Brue Close, Bruton, Somerset, BA10 0HY, England.
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009430.html">[squid-dev] Terminating ICAP requests for aborted HTTP requests
</A></li>
	<LI>Next message: <A HREF="009433.html">[squid-dev] Terminating ICAP requests for aborted HTTP requests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9431">[ date ]</a>
              <a href="thread.html#9431">[ thread ]</a>
              <a href="subject.html#9431">[ subject ]</a>
              <a href="author.html#9431">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
