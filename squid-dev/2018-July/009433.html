<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Terminating ICAP requests for aborted HTTP requests
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Terminating%20ICAP%20requests%20for%20aborted%20HTTP%20requests&In-Reply-To=%3C5f9003cb-7404-3e3b-ce85-12b407cf280b%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="009431.html">
   <LINK REL="Next"  HREF="009432.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Terminating ICAP requests for aborted HTTP requests</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Terminating%20ICAP%20requests%20for%20aborted%20HTTP%20requests&In-Reply-To=%3C5f9003cb-7404-3e3b-ce85-12b407cf280b%40measurement-factory.com%3E"
       TITLE="[squid-dev] Terminating ICAP requests for aborted HTTP requests">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Jul 12 14:52:51 UTC 2018</I>
    <P><UL>
        <LI>Previous message: <A HREF="009431.html">[squid-dev] Terminating ICAP requests for aborted HTTP requests
</A></li>
        <LI>Next message: <A HREF="009432.html">[squid-dev] StoeiD and ICAP services callouts, when it happens?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9433">[ date ]</a>
              <a href="thread.html#9433">[ thread ]</a>
              <a href="subject.html#9433">[ subject ]</a>
              <a href="author.html#9433">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07/11/2018 10:16 AM, Amos Jeffries wrote:
&gt;<i> On 12/07/18 03:46, Alex Rousskov wrote:
</I>&gt;&gt;<i> Using last-chunk for aborted body termination is a bug. If Squid
</I>&gt;&gt;<i> terminates the body, it should not use the standard last-chunk. Like you
</I>&gt;&gt;<i> suggested below, Squid should either (half-)close the connection or
</I>&gt;&gt;<i> negotiate the use of a chunk extension, both indicating a premature body
</I>&gt;&gt;<i> termination.
</I>
&gt;<i> But the chunking here means end of *ICAP* message. Not end of HTTP message.
</I>
When an ICAP message delivery ends, the HTTP message delivery ends as
well: An HTTP message cannot be spread across multiple ICAP messages. In
many cases, the ICAP recipient cannot tell whether the HTTP message
delivery ended prematurely unless the ICAP sender closes the connection.
That inability to detect premature HTTP message termination is what this
thread is about.


&gt;<i> HTTP Transfer-Encoding messages are a problem though. In absence of a
</I>&gt;<i> proper ICAP signal we should probably abort the ICAP connection at the
</I>&gt;<i> end of what Squid has
</I>
Yes, that is option #1 suggested by Steve.


&gt;<i> If there *is* an ICAP signal then Squid should of course use that in all
</I>&gt;<i> cases of early halted HTTP content.
</I>
There is no such signal. Adding that signal is option #2 suggested by Steve.


Alex.
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009431.html">[squid-dev] Terminating ICAP requests for aborted HTTP requests
</A></li>
	<LI>Next message: <A HREF="009432.html">[squid-dev] StoeiD and ICAP services callouts, when it happens?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9433">[ date ]</a>
              <a href="thread.html#9433">[ thread ]</a>
              <a href="subject.html#9433">[ subject ]</a>
              <a href="author.html#9433">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
