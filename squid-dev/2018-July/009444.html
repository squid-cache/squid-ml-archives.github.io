<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Allowing the admin to decide if a specific DNS+ip	is ok for caching.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Allowing%20the%20admin%20to%20decide%20if%20a%20specific%20DNS%2Bip%0A%09is%20ok%20for%20caching.&In-Reply-To=%3C04f601d42007%248583e320%24908ba960%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="009443.html">
   <LINK REL="Next"  HREF="009445.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Allowing the admin to decide if a specific DNS+ip	is ok for caching.</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Allowing%20the%20admin%20to%20decide%20if%20a%20specific%20DNS%2Bip%0A%09is%20ok%20for%20caching.&In-Reply-To=%3C04f601d42007%248583e320%24908ba960%24%40ngtech.co.il%3E"
       TITLE="[squid-dev] Allowing the admin to decide if a specific DNS+ip	is ok for caching.">eliezer at ngtech.co.il
       </A><BR>
    <I>Fri Jul 20 08:56:17 UTC 2018</I>
    <P><UL>
        <LI>Previous message: <A HREF="009443.html">[squid-dev] Allowing the admin to decide if a specific DNS+ip is ok for caching.
</A></li>
        <LI>Next message: <A HREF="009445.html">[squid-dev] Squid versioning
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9444">[ date ]</a>
              <a href="thread.html#9444">[ thread ]</a>
              <a href="subject.html#9444">[ subject ]</a>
              <a href="author.html#9444">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>OK.

So we will try to make the whole environment more secure rather than more &quot;profitable&quot;.
I think that in general it's a good concept and doesn't sound like some &quot;OCD&quot; alike issue.

I will try to write an article about 4.1 release with this point in mind.

Thanks,
Eliezer

* I do not really care if someone will think or thinks that my articles are profiting me in any way....

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">eliezer at ngtech.co.il</A>



-----Original Message-----
From: squid-dev [mailto:<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev-bounces at lists.squid-cache.org</A>] On Behalf Of Amos Jeffries
Sent: Thursday, July 19, 2018 10:46 AM
To: <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev at lists.squid-cache.org</A>
Subject: Re: [squid-dev] Allowing the admin to decide if a specific DNS+ip is ok for caching.

On 19/07/18 04:56, Eliezer Croitoru wrote:
&gt;<i> Hey Squid-Dev’s,
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> Currently Squid-Cache forces Host Header Forgery on http and https requests.
</I>&gt;<i> 
</I>&gt;<i> -          <A HREF="https://wiki.squid-cache.org/KnowledgeBase/HostHeaderForgery">https://wiki.squid-cache.org/KnowledgeBase/HostHeaderForgery</A>
</I>&gt;<i> 
</I>
Forces? no. Prevents.

&gt;<i> Squid is working properly or “the best” when the client and the proxy
</I>&gt;<i> use the same DNS service.
</I>&gt;<i> 
</I>&gt;<i> In the past I have asked about defining a bumped connection as secured
</I>&gt;<i> and to disable host header forgery checks on some of these.
</I>&gt;<i> 
</I>
Having a connection be bumped does not mean the requests decrypted from
that connection are meant for that server. DONT_VERIFY_PEER and such
false &quot;workaround&quot; are still very common things for admin to do.

A client or intermediary can as easily forge the SNI value on TLS setup
as a Host header in plain-text HTTP. The resulting problems in both
cases are the same.



&gt;<i> The conditions are:
</I>&gt;<i> 
</I>&gt;<i> -          Squid validates that the server certificate is valid against
</I>&gt;<i> the local CA bundles (an admin can add or remove a certificate manually
</I>&gt;<i> or automatically)
</I>&gt;<i> 
</I>&gt;<i> -          The admin defines an external tool that verifies and/or
</I>&gt;<i> allows host header forgery to be disabled per request.
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> I am in the middle of testing 4.1 and wondering what is expected from
</I>&gt;<i> 4.1 regarding host header forgery.
</I>&gt;<i> 
</I>&gt;<i> Was there any change of policy?
</I>&gt;<i> 
</I>
No changes from Squid-3 are expected in terms of these checks. There may
be changes in TLS handling which decrypt more (or less) requests.

Any requests which *are* decrypted, the initial CONNECT (from SNI) are
expected to be verified.
 TPROXY / NAT intercepted traffic is verified against the against the
dst-IP of the intercepted client TCP connection.
 Bumped and non-intercepted traffic (in strict verify mode) against the
server-IP from initial client CONNECT tunnel.

Amos
_______________________________________________
squid-dev mailing list
<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">http://lists.squid-cache.org/listinfo/squid-dev</A>

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009443.html">[squid-dev] Allowing the admin to decide if a specific DNS+ip is ok for caching.
</A></li>
	<LI>Next message: <A HREF="009445.html">[squid-dev] Squid versioning
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9444">[ date ]</a>
              <a href="thread.html#9444">[ thread ]</a>
              <a href="subject.html#9444">[ subject ]</a>
              <a href="author.html#9444">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
