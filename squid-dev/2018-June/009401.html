<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Use MAX_URL for first line limitation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Use%20MAX_URL%20for%20first%20line%20limitation&In-Reply-To=%3C9dc0b958-73c3-ba18-d2c6-dbcc81e233dd%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="009400.html">
   <LINK REL="Next"  HREF="009402.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Use MAX_URL for first line limitation</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Use%20MAX_URL%20for%20first%20line%20limitation&In-Reply-To=%3C9dc0b958-73c3-ba18-d2c6-dbcc81e233dd%40measurement-factory.com%3E"
       TITLE="[squid-dev] Use MAX_URL for first line limitation">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Jun  7 23:18:02 UTC 2018</I>
    <P><UL>
        <LI>Previous message: <A HREF="009400.html">[squid-dev] Use MAX_URL for first line limitation
</A></li>
        <LI>Next message: <A HREF="009402.html">[squid-dev] Use MAX_URL for first line limitation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9401">[ date ]</a>
              <a href="thread.html#9401">[ thread ]</a>
              <a href="subject.html#9401">[ subject ]</a>
              <a href="author.html#9401">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 06/07/2018 04:13 PM, Eduard Bagdasaryan wrote:

&gt;<i> in %&gt;ru Squid logs large and small URLs differently.  For example,
</I>&gt;<i> Squid strips whitespaces from small URLs, while keeping them for
</I>&gt;<i> large ones.
</I>
Is %ru logging consistent with regard to small and large URLs?

* If it is, should we use the same approach to make %&gt;ru consistent?

* Otherwise, we should keep both %ru and %&gt;ru in mind when deciding
whether (and how) to make logging consistent. For example, it would be
OK to ignore this inconsistency if making things consistent requires too
much out-of-scope work.


&gt;<i> 2. Adjust Http::One::RequestParser::parseRequestFirstLine(), immediately
</I>&gt;<i>    rejecting requests with URLs exceeding MAX_URL (use it instead of
</I>&gt;<i>    Config.maxRequestHeaderSize). As a result, access.log would get
</I>&gt;<i>    &quot;error:request-too-large&quot; for such requests. This solution looks
</I>&gt;<i>    better, since anyway, Squid eventually denies such requests and,
</I>&gt;<i>    moreover, there are many contexts in Squid tied up to that MAX_URL
</I>&gt;<i>    limitation.
</I>&gt;<i> 
</I>&gt;<i>   So, the question is: can we go on with (2) without breaking something?
</I>
Clarification: (2) is already known to &quot;break something&quot; -- after (2),
some refused transactions that were previously logged with the actual
URL (prefix) in %ru would be logged with a largely useless
&quot;error:request-too-large&quot; URL. Which evil is lesser:

  a) hiding actual %ru URL for requests with URLs between ~8K and ~64K
  b) inconsistent logging of small vs large URLs


&gt;<i>   Or probably there are any other(better) alternative approaches?
</I>
Yes, that is the other important question. FWIW, I do not know any
better solutions that do not require fixing the 8K/64K problem itself
(which is way out of %&gt;ru fixing scope).


Thank you,

Alex.
P.S. Here, &quot;inconsistent logging&quot; means that two URLs with identical 7K
prefix may be logged differently if one of the URLs is longer than 8K.
Scripts and humans can be easily confused by such inconsistent logging,
and URL lengths are often at the mercy of highly variable parameters
such as search strings, session IDs, context descriptions, etc.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="009400.html">[squid-dev] Use MAX_URL for first line limitation
</A></li>
	<LI>Next message: <A HREF="009402.html">[squid-dev] Use MAX_URL for first line limitation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9401">[ date ]</a>
              <a href="thread.html#9401">[ thread ]</a>
              <a href="subject.html#9401">[ subject ]</a>
              <a href="author.html#9401">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
