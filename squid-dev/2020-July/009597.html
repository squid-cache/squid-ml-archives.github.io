<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Non TLS connections to HTTP and SSL_BUMP ports
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Non%20TLS%20connections%20to%20HTTP%20and%20SSL_BUMP%20ports&In-Reply-To=%3C%21%26%21AAAAAAAAAAAYAAAAAAAAAEGQtNYT0SBEjroouRDlGygigQAAEAAAADWKHUhsR3tOh%2B/1VrdEd9IBAAAAAA%3D%3D%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="009596.html">
   <LINK REL="Next"  HREF="009598.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Non TLS connections to HTTP and SSL_BUMP ports</H1>
    <B>Eliezer Croitor</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Non%20TLS%20connections%20to%20HTTP%20and%20SSL_BUMP%20ports&In-Reply-To=%3C%21%26%21AAAAAAAAAAAYAAAAAAAAAEGQtNYT0SBEjroouRDlGygigQAAEAAAADWKHUhsR3tOh%2B/1VrdEd9IBAAAAAA%3D%3D%40gmail.com%3E"
       TITLE="[squid-dev] Non TLS connections to HTTP and SSL_BUMP ports">ngtech1ltd at gmail.com
       </A><BR>
    <I>Sat Jul  4 21:33:44 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009596.html">[squid-dev] RFC: making TrieNode less memory-hungry
</A></li>
        <LI>Next message (by thread): <A HREF="009598.html">[squid-dev] Non TLS connections to HTTP and SSL_BUMP ports
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9597">[ date ]</a>
              <a href="thread.html#9597">[ thread ]</a>
              <a href="subject.html#9597">[ subject ]</a>
              <a href="author.html#9597">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Dev Team,

 

Long before SSL-BUMP got to what it is now I had a question in my mind:

What about connections on intercepted port which are either non TLS/SSL or 
when squid had some server or client negotiation issues?

 

The first issue with TLS connections is that if for any reason the proxy 
didn't managed to negotiate and establish a TLS connection with the server,
the client is STUCK.

 

I cannot touch TLS related code due to obviates reasons but I believe it's
trivial to have:

-          Proxy side &quot;retries&quot; toward the TLS server

-          A hook point for an ACL to decide what to do in such a scenario
ie in case of an error in the negotiation with the server

 

I have seen Golang code that does something about it and it works based on
the assumption that the client will always send something before the server.

The sketch of such a function can be like the PROXY protocol parsing(in a
way.).

-          If TLS handshake exists, try to parse

-          If parse is OK try to connect the remote server else throw the
connection into some ACL

-          If the remote server responds well to a TLS handshare, bump else
spice

 

I understand that it overlaps some of the bump-first in a way.

 

With this issue the resolution for other scenarios: which a client really
doesn't speak RFC TLS or something similar, might be possible?

I have seen couple times a situation which port 443 is used for customized
protocols such as VPN and others.

 

The risk I can see is that the proxy admins (which we know that do weird
stuff when allowed) will allow any TLS error to be bypassed.

 

If we will leave the error logs into cache.log in debug level 1 like today
but still allow to bypass, would it change anything?

 

I will really appreciate feedback about this specific issue.

 

Eliezer

 

----

Eliezer Croitoru

Tech Support

Mobile: +972-5-28704261

Email:  &lt;mailto:<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">ngtech1ltd at gmail.com</A>&gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">ngtech1ltd at gmail.com</A>

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20200705/7679b546/attachment.html">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20200705/7679b546/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009596.html">[squid-dev] RFC: making TrieNode less memory-hungry
</A></li>
	<LI>Next message (by thread): <A HREF="009598.html">[squid-dev] Non TLS connections to HTTP and SSL_BUMP ports
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9597">[ date ]</a>
              <a href="thread.html#9597">[ thread ]</a>
              <a href="subject.html#9597">[ subject ]</a>
              <a href="author.html#9597">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
