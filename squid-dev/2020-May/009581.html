<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] cppunit -&gt; googletest / gmock?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20cppunit%20-%3E%20googletest%20/%20gmock%3F&In-Reply-To=%3Cc9d0adb0-b3d1-47d6-b824-fb6c436773db%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="009580.html">
   <LINK REL="Next"  HREF="009584.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] cppunit -&gt; googletest / gmock?</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20cppunit%20-%3E%20googletest%20/%20gmock%3F&In-Reply-To=%3Cc9d0adb0-b3d1-47d6-b824-fb6c436773db%40treenet.co.nz%3E"
       TITLE="[squid-dev] cppunit -&gt; googletest / gmock?">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat May 30 18:36:13 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009580.html">[squid-dev] cppunit -&gt; googletest / gmock?
</A></li>
        <LI>Next message (by thread): <A HREF="009584.html">[squid-dev] cppunit -&gt; googletest / gmock?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9581">[ date ]</a>
              <a href="thread.html#9581">[ thread ]</a>
              <a href="subject.html#9581">[ subject ]</a>
              <a href="author.html#9581">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 31/05/20 5:27 am, Francesco Chemolli wrote:
&gt;<i> Hi all,
</I>&gt;<i>    starting from a PR in a conversation with Alex about our current
</I>&gt;<i> approach to unit testing being painful, I've checked what alternatives
</I>&gt;<i> would we have and how practical would they be.
</I>&gt;<i> 
</I>&gt;<i> An easy first option would be googletest/googlemock.
</I>&gt;<i> 
</I>&gt;<i> On a lazy afternoon, I've tried seeing how useful/painful it would be to
</I>&gt;<i> try it, by porting one test over - it's quite trivial and doesn't
</I>&gt;<i> require mocking, so I'll try a more complicated one next - to start a
</I>&gt;<i> conversation about the topic.
</I>&gt;<i> 
</I>&gt;<i> You can find the test branch at <A HREF="https://github.com/kinkie/squid/tree/gtest&#194;&#160;.">https://github.com/kinkie/squid/tree/gtest .</A>
</I>&gt;<i> I've only touched two files, a newly-created src/tests/testMemGtest and
</I>&gt;<i> src/Makefile.am .
</I>&gt;<i> 
</I>&gt;<i> The output from the test run is at <A HREF="https://paste.ubuntu.com/p/3sgTDN7rNm/">https://paste.ubuntu.com/p/3sgTDN7rNm/</A>
</I>&gt;<i> 
</I>&gt;<i> What do you think?
</I>&gt;<i> 
</I>&gt;<i> My initial thoughts:
</I>&gt;<i> - it is somewhat simpler and more powerful than cppunit
</I>&gt;<i> - setting the test environment up is easy but at this time it can only
</I>&gt;<i> be done from source. Adding it to the build farm images is straightforward
</I>
That is a problem. The unit tests are run by pretty much everyone
building Squid.

It is not a complete blocker, but having a process more complex than
simple dependency install does pose a relatively major hurdle that any
framework has to get over to be of much utility.



&gt;<i> - the license is BSD 3-clause new
</I>&gt;<i> (<A HREF="https://github.com/google/googletest/blob/master/LICENSE">https://github.com/google/googletest/blob/master/LICENSE</A>) 
</I>&gt;<i> - googlemock promises to be vastly superior to our current approach
</I>
Where are you seeing evidence of this?

The main issue we have with cppunit itself is that when a test fails it
is not clear from the output which assertion occurred, nor why. One is
left having to try and trigger the unit failure again manually and gdb
from there.

This can be worked around by following best-practice in unit test
implementation. But people contributing to Squid have not been doing so
consistently, and it is just a workaround.

I do see somewhat more verbose output in the logs, and slightly less
code to implement (no .h class). Which is a nice gain, but not what I
would call &quot;vastly superior&quot;.


&gt;<i> - porting memTest took me about one hour, mostly caused by us including
</I>&gt;<i> cppunit headers from squid.h (WUT? A PR is coming up to unentangle that)
</I>&gt;<i> 
</I>
Converting tests from one framework to another is not a problem. We just
have nobody doing the legwork. Case in point being the old tests not
even using cppunit.


The main problem(s) we have with testing of Squid is dev participation:

 a) people are not writing tests to cover new code, and
 b) people are not writing/updating tests to cover bug fixes, and
 c) tests written are generally not following best practice design.

IIRC Alex an I have different ideas about the ideal focus of testing;
 * I prefer the micro-test approach to demonstrate a high quality proof
of code reliability.
 * Alex has stated a preference for high level black-box testing of
behaviour vs design requirements.


Amos
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009580.html">[squid-dev] cppunit -&gt; googletest / gmock?
</A></li>
	<LI>Next message (by thread): <A HREF="009584.html">[squid-dev] cppunit -&gt; googletest / gmock?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9581">[ date ]</a>
              <a href="thread.html#9581">[ thread ]</a>
              <a href="subject.html#9581">[ subject ]</a>
              <a href="author.html#9581">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
