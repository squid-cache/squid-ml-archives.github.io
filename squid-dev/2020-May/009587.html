<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] RFC: Modernizing sources using clang-tidy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20RFC%3A%20Modernizing%20sources%20using%20clang-tidy&In-Reply-To=%3C1d7889b0-b32d-fdb3-bf9d-771c504efe4e%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="009583.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] RFC: Modernizing sources using clang-tidy</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20RFC%3A%20Modernizing%20sources%20using%20clang-tidy&In-Reply-To=%3C1d7889b0-b32d-fdb3-bf9d-771c504efe4e%40measurement-factory.com%3E"
       TITLE="[squid-dev] RFC: Modernizing sources using clang-tidy">rousskov at measurement-factory.com
       </A><BR>
    <I>Sun May 31 21:11:17 UTC 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009583.html">[squid-dev] RFC: Modernizing sources using clang-tidy
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9587">[ date ]</a>
              <a href="thread.html#9587">[ thread ]</a>
              <a href="subject.html#9587">[ subject ]</a>
              <a href="author.html#9587">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 5/30/20 3:22 PM, Amos Jeffries wrote:
&gt;<i> On 20/04/20 2:02 pm, Alex Rousskov wrote:
</I>&gt;&gt;<i>     Squid sources contain a lot of poorly written, obsolete, and
</I>&gt;&gt;<i> inconsistent code that (objectively) complicates development and
</I>&gt;&gt;<i> (unfortunately) increases tensions among developers during review.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Some of those problems can be solved using tools that modify sources.
</I>&gt;&gt;<i> Clang-tidy is one such tool: <A HREF="https://clang.llvm.org/extra/clang-tidy/">https://clang.llvm.org/extra/clang-tidy/</A>
</I>&gt;&gt;<i> It contains 150+ &quot;checks&quot; that can automatically fix some common
</I>&gt;&gt;<i> problems by studying the syntax tree produced by the clang compiler.
</I>

&gt;<i> In order to switch we should be looking for a tool that improves over
</I>&gt;<i> the status-quo. Which is both astyle plus the custom scripts.
</I>&gt;<i> 
</I>&gt;<i> All of the above are high-level abstractions that the existing astyle
</I>&gt;<i> tool provides by itself. So no valid reason for changing is visible yet.
</I>
Amos, you are mixing up two completely different subjects: modernizing
code using clang-tidy (this thread) and formatting sources using
clang-format (Francesco's effort). In hope to make progress, I am
ignoring most comments about astyle.


&gt;&gt;<i> <A HREF="https://clang.llvm.org/extra/clang-tidy/checks/list.html">https://clang.llvm.org/extra/clang-tidy/checks/list.html</A>
</I>
&gt;&gt;<i> * performance-...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Clang-tidy has a few checks focusing on performance optimizations. The
</I>&gt;&gt;<i> following commit shows a combination of the following four checks:
</I>&gt;&gt;<i> performance-trivially-destructible, performance-unnecessary-value-param,
</I>&gt;&gt;<i> performance-for-range-copy, performance-move-const-arg
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Diff: <A HREF="https://github.com/measurement-factory/squid/commit/1ae5d7c">https://github.com/measurement-factory/squid/commit/1ae5d7c</A>
</I>

&gt;<i> IMO this is something we should have a
</I>
Sorry, was this phrase cut prematurely or are you voicing support (in
principle) for applying (some of these) performance-related changes?


&gt;&gt;<i> * modernize-use-nullptr
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Replaces NULL and 0 constants with C++11 nullptr:
</I>&gt;&gt;<i> <A HREF="https://clang.llvm.org/extra/clang-tidy/checks/modernize-use-nullptr.html">https://clang.llvm.org/extra/clang-tidy/checks/modernize-use-nullptr.html</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> While replacing most NULLs is possible with a simple script, this check
</I>&gt;&gt;<i> may be a better solution because it can safely cover more NULL uses and
</I>&gt;&gt;<i> also converts bare 0s which would be impossible using a script.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Diff: <A HREF="https://github.com/measurement-factory/squid/commit/4242604">https://github.com/measurement-factory/squid/commit/4242604</A>
</I>
&gt;<i> As I mentioned earlier when kinkie tried this; I do not like this
</I>&gt;<i> particular tool feature. The &quot;upgrade&quot; it does is far too simplistic for
</I>&gt;<i> a style polishing update. If the end goal were simply to eradicate NULL
</I>&gt;<i> - this would be fine. But the goal of using this tool is to ensure a
</I>&gt;<i> good quality formatting style.
</I>
... except it is not the goal. modernize-use-nullptr does not change
code formatting.


&gt;<i> A simplistic s/NULL/nullptr/ leaves quite
</I>&gt;<i> a few code lines looking just as ugly as they were with NULL.
</I>
And, as I mentioned above, modernize-use-nullptr is not simplistic --
nothing else can detect and replace 0s with nullptr.


&gt;<i> IMO we would be better off going the scripted way to remove the subset
</I>&gt;<i> of cases we can automate and catch the rest with manual edits and in review.
</I>
I do not see a point of automating ourselves if there is an existing
automation that works much better than anything we can do ourselves.


&gt;<i> I like a few things the tool does. But so far it seems like something we
</I>&gt;<i> want to run across the code occasionally. eg as a Jenkins test job.
</I>
Yes, or a Semaphore CI job, and/or on-demand. Please clarify regarding
performance-* checks above. If we are in agreement regarding
modernize-use-override and at least one more check, then I can start
working on a polished proposal for those checks (at least) and the
overall setup.


Cheers,

Alex.
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009583.html">[squid-dev] RFC: Modernizing sources using clang-tidy
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9587">[ date ]</a>
              <a href="thread.html#9587">[ thread ]</a>
              <a href="subject.html#9587">[ subject ]</a>
              <a href="author.html#9587">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
