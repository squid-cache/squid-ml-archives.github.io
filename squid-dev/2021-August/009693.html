<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Coding Style updates
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Coding%20Style%20updates&In-Reply-To=%3Cc2ac5828-e69d-56a3-02f0-ed7ef2239d63%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009692.html">
   <LINK REL="Next"  HREF="009694.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Coding Style updates</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Coding%20Style%20updates&In-Reply-To=%3Cc2ac5828-e69d-56a3-02f0-ed7ef2239d63%40measurement-factory.com%3E"
       TITLE="[squid-dev] Coding Style updates">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Aug 12 16:28:32 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009692.html">[squid-dev] Coding Style updates
</A></li>
        <LI>Next message (by thread): <A HREF="009694.html">[squid-dev] Coding Style updates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9693">[ date ]</a>
              <a href="thread.html#9693">[ thread ]</a>
              <a href="subject.html#9693">[ subject ]</a>
              <a href="author.html#9693">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 8/12/21 12:42 AM, Amos Jeffries wrote:

&gt;<i> 1) return type on separate line from function definition.
</I>&gt;<i> 
</I>&gt;<i> Current style requirement:
</I>&gt;<i> 
</I>&gt;<i> &#160; template&lt;...&gt;
</I>&gt;<i> &#160; void
</I>&gt;<i> &#160; foo(...)
</I>&gt;<i> &#160; {
</I>&gt;<i> &#160;&#160;&#160; ...
</I>&gt;<i> &#160; }
</I>&gt;<i> 
</I>&gt;<i> AFAIK, this based on GNU project style preferences from the far past
</I>&gt;<i> when Squid had a tight relationship with GNU. Today we have a conflict
</I>&gt;<i> between Factory code coming in with the alternative same-line style
</I>&gt;<i> and/or various developers being confused by the mix of code they are
</I>&gt;<i> touching.
</I>
AFAIK, Factory developers try to follow the official style (while
keeping the old code consistent), just like all the other developers
(should) do. They make mistakes just like all other developers do. It is
unfortunate that you felt it is necessary to single out a group of
developers in a negative way (that is completely irrelevant to your
actual proposal).


&gt;<i> IMO; it is easier to work with the one-line style when command-line
</I>&gt;<i> editing, and irrelevant when using more advanced tools.
</I>
FWIW, I do not find it easier to use one-line style when using
command-line tools. In fact, the opposite is probably true in my experience.


&gt;<i> As such I propose converting Squid to the same-line style:
</I>&gt;<i> 
</I>&gt;<i> &#160; template&lt;...&gt;
</I>&gt;<i> &#160; void foo(...)
</I>&gt;<i> &#160; {
</I>&gt;<i> &#160;&#160;&#160; ...
</I>&gt;<i> &#160; }
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Opinions?
</I>
One-line stile increases horizontal wrapping, especially when the return
type is complex/long and there are additional markers like &quot;static&quot;,
&quot;inline&quot;, and &quot;[[ noreturn ]]&quot;.

One line approach itself is inconsistent because template&lt;&gt; is on the
other line(s).

Searching for a function name with unknown-to-searcher or complex return
type becomes a bit more difficult when using &quot;git log -L&quot; and similar tools.

In many cases, function parameters should be on multiple lines as well.
Their alignment would look worse if the function name does not start the
line.

Most function definitions will have &quot;auto&quot; return type after we upgrade
to C++14. Whether that makes one-line style more or less attractive is
debatable, but it is an important factor in delaying related changes.

Eventually, we may be able to automatically remove explicit return types
using one of the clang-tidy tools, but such a tool does not exist yet
(modernize-use-trailing-return-type comes close but is not it).

In summary, I recommend delaying this decision until C++14. However, if
others insist on changing the format and changing it now, then I will
not block these changes, assuming newer astyle produces reasonable results.


Can new astyle support multiline formatting? If not, _that_ could be a
strong argument for changing the style.


&gt;<i> 2) braces on one-liner conditional blocks
</I>&gt;<i> 
</I>&gt;<i> Current code style is a bit confused. We have it as a style to use, with
</I>&gt;<i> exceptions for some old macros etc where the lack of braces causes
</I>&gt;<i> compile issues or bugs.
</I>&gt;<i> 
</I>&gt;<i> Personally I prefer the non-braced style. But it seems far safer to
</I>&gt;<i> automate the always-brace style and not have those special exceptions.
</I>&gt;<i> 
</I>&gt;<i> Opinions?
</I>
I also prefer the non-braced style for simple expressions.

Perhaps there is a way to automatically wrap complex ones, for some
reasonable definition of &quot;complex&quot;?

Alex.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009692.html">[squid-dev] Coding Style updates
</A></li>
	<LI>Next message (by thread): <A HREF="009694.html">[squid-dev] Coding Style updates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9693">[ date ]</a>
              <a href="thread.html#9693">[ thread ]</a>
              <a href="subject.html#9693">[ subject ]</a>
              <a href="author.html#9693">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
