<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] What os/cpu platforms do we want to target as a project?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20What%20os/cpu%20platforms%20do%20we%20want%20to%20target%20as%20a%0A%20project%3F&In-Reply-To=%3CCA%2BY8hcOVbXwwdaGp2zixTDvPHr1%2BxCQzQFvantVG%2Btq7Fm3u0Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009743.html">
   <LINK REL="Next"  HREF="009746.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] What os/cpu platforms do we want to target as a project?</H1>
    <B>Francesco Chemolli</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20What%20os/cpu%20platforms%20do%20we%20want%20to%20target%20as%20a%0A%20project%3F&In-Reply-To=%3CCA%2BY8hcOVbXwwdaGp2zixTDvPHr1%2BxCQzQFvantVG%2Btq7Fm3u0Q%40mail.gmail.com%3E"
       TITLE="[squid-dev] What os/cpu platforms do we want to target as a project?">gkinkie at gmail.com
       </A><BR>
    <I>Mon Dec 27 09:41:16 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009743.html">[squid-dev] What os/cpu platforms do we want to target as a project?
</A></li>
        <LI>Next message (by thread): <A HREF="009746.html">[squid-dev] What os/cpu platforms do we want to target as a project?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9745">[ date ]</a>
              <a href="thread.html#9745">[ thread ]</a>
              <a href="subject.html#9745">[ subject ]</a>
              <a href="author.html#9745">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sun, Dec 26, 2021 at 10:58 PM Alex Rousskov
&lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">rousskov at measurement-factory.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> On 12/26/21 10:30 AM, Francesco Chemolli wrote:
</I>&gt;<i> &gt; On Sun, Dec 5, 2021 at 10:05 PM Alex Rousskov wrote:
</I>&gt;<i> &gt;&gt; On 12/5/21 4:44 AM, Francesco Chemolli wrote:
</I>&gt;<i> &gt;&gt;&gt; I would recommend that we support as main targets:
</I>&gt;<i> &gt;&gt;&gt; - Linux on x64, arm64, arm32 and, if we can, MIPS
</I>&gt;<i> &gt;&gt;&gt; - FreeBSD, OpenBSD on x64
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; As best-effort:
</I>&gt;<i> &gt;&gt;&gt; - Windows on x64, with the aim of eventually promoting to primary target
</I>&gt;<i> &gt;&gt;&gt; - Darwin on x64 and maybe eventually arm64
</I>&gt;<i> &gt;&gt;&gt; - NetBSD on x64
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; What does &quot;support as main targets&quot; and &quot;support as best-effort&quot; mean?
</I>&gt;<i>
</I>&gt;<i> &gt; &quot;main targets&quot; to me means that any regression in build or unit tests
</I>&gt;<i> &gt; on these platforms is PR-blocking. We aim to deliver a working build
</I>&gt;<i> &gt; out of the box on these environments, with no need of maintainer
</I>&gt;<i> &gt; patches.
</I>&gt;<i>
</I>&gt;<i> I am OK with that definition if you remove &quot;in build or unit tests&quot;. Any
</I>&gt;<i> known Squid regression affecting the &quot;main&quot; environment should block the
</I>&gt;<i> PR introducing that regression IMO. I see no need to limit this to
</I>&gt;<i> &quot;build and unit tests&quot; regressions. Are you OK with that definition
</I>&gt;<i> simplification?
</I>
Yes

&gt;<i> I do not think MIPS, FreeBSD, and OpenBSD should be on the &quot;main&quot; list:
</I>&gt;<i> There are just too few users and contributors on those platforms right
</I>&gt;<i> now to grant them primary status AFAICT. I may be missing some important
</I>&gt;<i> signals, of course, but I would downgrade them to best-effort.
</I>
I'm okay with downgrading MIPS - it is present in the embedded space
but testing poses some challenges.
I'm a bit more reluctant with downgrading FreeBSD and (once stable)
OpenBSD. They ship Squid as part of their ports, and while the
developer community may not be very large, I'd expect the user
community to be a bit more prevalent. This would also prevent the risk
of the project becoming a Linux monoculture.

&gt;<i> I am not sure about arm32, for similar reasons, but perhaps there is a
</I>&gt;<i> strong demand for &quot;embedded&quot; Squid that I do not know about (and that
</I>&gt;<i> does not materialize in a stream of PRs because Squid already works well
</I>&gt;<i> in those environments??)? How can we tell?
</I>
We can't, we have to guess. My angle on that is that having arm32 will
help us not become a 64-bit monoculture, which could bring in
regressions in low-level data structures. At this stage in the
embedded world, as far as I'm aware, there are x86-32, arm32, MIPS and
RISC-V. Of these arm32 is the most prevalent and therefore my
preferred choice. It also helps that we have a test environment for it
already, courtesy of a couple of raspberry pi 3.

&gt;<i> &gt; Once achieved this status on any of these platforms,
</I>&gt;<i> &gt; regressions on it are release blockers.
</I>&gt;<i>
</I>&gt;<i> I do not know what you mean by &quot;release&quot; exactly, but we should not add
</I>&gt;<i> rules that block schedule-based branching points and major releases[1].
</I>&gt;<i> As for other/minor releases, I am not against this rule if the
</I>&gt;<i> maintainer is happy about it.
</I>
Amos, what do you think?

&gt;<i>
</I>&gt;<i> [1] <A HREF="https://wiki.squid-cache.org/ReleaseSchedule">https://wiki.squid-cache.org/ReleaseSchedule</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; &quot;support as best effort&quot; means that we keep these environment as build
</I>&gt;<i> &gt; options, and test builds on them. Regressions on build or unit tests
</I>&gt;<i> &gt; on these environments are not PR-blocking but we strongly encourage
</I>&gt;<i> &gt; the PR owner to fix these platforms with followup PRs. We aim to
</I>&gt;<i> &gt; deliver an out-of-the-box build on these platforms but failure to do
</I>&gt;<i> &gt; so or regressions are not a release blocker
</I>&gt;<i>
</I>&gt;<i> OK. If we drop the vague parts, &quot;best effort&quot; simply means that CI
</I>&gt;<i> covers these platforms (but they are not &quot;main&quot; environments and, hence,
</I>&gt;<i> the corresponding CI failures alone are not sufficient to block PRs).
</I>
Sounds good

&gt;<i> AFAICT, the primary costs of keeping a platform on a best-effort list
</I>&gt;<i> are CI testing time and CI maintenance overheads. I suggest capping that
</I>&gt;<i> best-effort list to keep the total CI test time for one PR commit under,
</I>&gt;<i> say, 4 hours and granting CI maintenance team a veto on adding (but not
</I>&gt;<i> removing) platforms. IIRC, we have discussed PR commit testing time a
</I>&gt;<i> few months ago; if we agreed on another number of hours there, let's
</I>&gt;<i> take that as a cap.
</I>
The best-effort model supports testing best-effort platforms
asynchronously, no need to cap there. Regressions would be noted and
hopefully dealt with in followup PRs. We are already using this
practice.

&gt;<i> &gt;&gt;&gt; If anyone in the community wants to support/maintain extra OSes or
</I>&gt;<i> &gt;&gt;&gt; architectures, they're very welcome to do so
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; By &quot;welcome&quot;, do you mean something like &quot;we will accept high-quality
</I>&gt;<i> &gt;&gt; PRs adding such extra support to Squid&quot;? Or &quot;we will consider sharing
</I>&gt;<i> &gt;&gt; references to your work, but please do not ask us to merge your
</I>&gt;<i> &gt;&gt; OS-specific changes into the official Squid code&quot;? Something else? This
</I>&gt;<i> &gt;&gt; bit is critical for understanding the real effect of this proposal IMO.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Fair point. I'd go for the former. If someone has an environment they
</I>&gt;<i> &gt; want to support and do so without adding complexity to the code base,
</I>&gt;<i> &gt; it's a good policy to enable that. The question is &quot;how much
</I>&gt;<i> &gt; complexity is it healthy to impose on other platforms to support
</I>&gt;<i> &gt; niche/obsolete ones?&quot;
</I>&gt;<i> &gt; While setting an objective bar is hard to impossible, this is my
</I>&gt;<i> &gt; attempt to set one for the most active group of developers
</I>&gt;<i>
</I>&gt;<i> I agree regarding the level of difficulty in defining that bar.
</I>&gt;<i>
</I>&gt;<i> Unfortunately, I do not think &quot;we will accept high-quality PRs adding
</I>&gt;<i> such extra support to Squid&quot; is something we should run with. We simply
</I>&gt;<i> do not have the resources to support some new environments, even if PRs
</I>&gt;<i> introducing them are perfect in every respect. For example, a perfect PR
</I>&gt;<i> introducing (explicit) LibreSSL support should be blocked IMO because we
</I>&gt;<i> do not have enough resources to properly handle the two already
</I>&gt;<i> (unfortunately) accepted TLS libraries (OpenSSL and GnuTLS).
</I>&gt;<i>
</I>&gt;<i> However, we can drop this part of your proposal in hope to get to the
</I>&gt;<i> consensus on the other, arguably more important parts: The definitions
</I>&gt;<i> of three support levels (main, best-effort, and other). We can come back
</I>&gt;<i> to this part of the discussion later/separately, armed with established
</I>&gt;<i> and tested support levels.
</I>
Sounds like a good plan to me


-- 
    Francesco
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009743.html">[squid-dev] What os/cpu platforms do we want to target as a project?
</A></li>
	<LI>Next message (by thread): <A HREF="009746.html">[squid-dev] What os/cpu platforms do we want to target as a project?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9745">[ date ]</a>
              <a href="thread.html#9745">[ thread ]</a>
              <a href="subject.html#9745">[ subject ]</a>
              <a href="author.html#9745">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
