<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] What os/cpu platforms do we want to target as a project?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20What%20os/cpu%20platforms%20do%20we%20want%20to%20target%20as%20a%0A%20project%3F&In-Reply-To=%3Cffa556c9-8caf-6d84-c8a8-e15d19b2eb03%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009745.html">
   <LINK REL="Next"  HREF="009732.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] What os/cpu platforms do we want to target as a project?</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20What%20os/cpu%20platforms%20do%20we%20want%20to%20target%20as%20a%0A%20project%3F&In-Reply-To=%3Cffa556c9-8caf-6d84-c8a8-e15d19b2eb03%40measurement-factory.com%3E"
       TITLE="[squid-dev] What os/cpu platforms do we want to target as a project?">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Dec 27 17:04:09 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009745.html">[squid-dev] What os/cpu platforms do we want to target as a project?
</A></li>
        <LI>Next message (by thread): <A HREF="009732.html">[squid-dev] RFC: Categorize level-0/1 messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9746">[ date ]</a>
              <a href="thread.html#9746">[ thread ]</a>
              <a href="subject.html#9746">[ subject ]</a>
              <a href="author.html#9746">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12/27/21 4:41 AM, Francesco Chemolli wrote:
&gt;<i> On Sun, Dec 26, 2021 at 10:58 PM Alex Rousskov wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 12/26/21 10:30 AM, Francesco Chemolli wrote:
</I>&gt;&gt;&gt;<i> On Sun, Dec 5, 2021 at 10:05 PM Alex Rousskov wrote:
</I>&gt;&gt;&gt;&gt;<i> On 12/5/21 4:44 AM, Francesco Chemolli wrote:
</I>&gt;&gt;&gt;&gt;&gt;<i> I would recommend that we support as main targets:
</I>&gt;&gt;&gt;&gt;&gt;<i> - Linux on x64, arm64, arm32 and, if we can, MIPS
</I>&gt;&gt;&gt;&gt;&gt;<i> - FreeBSD, OpenBSD on x64
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> As best-effort:
</I>&gt;&gt;&gt;&gt;&gt;<i> - Windows on x64, with the aim of eventually promoting to primary target
</I>&gt;&gt;&gt;&gt;&gt;<i> - Darwin on x64 and maybe eventually arm64
</I>&gt;&gt;&gt;&gt;&gt;<i> - NetBSD on x64
</I>
First of all, thank you for making good progress on this important thread.


&gt;<i> I'm a bit more reluctant with downgrading FreeBSD and (once stable) 
</I>&gt;<i> OpenBSD. They ship Squid as part of their ports, and while the 
</I>&gt;<i> developer community may not be very large, I'd expect the user 
</I>&gt;<i> community to be a bit more prevalent. This would also prevent the
</I>&gt;<i> risk of the project becoming a Linux monoculture.
</I>
I share the overall sentiment, but I think all of the above concerns can
continue to be adequately addressed with FreeBSD/OpenBSD being assigned
to the second tier (i.e. the &quot;best-effort&quot; tier you have proposed). IMO,
it makes little sense to name two tiers and then essentially treat the
second named tier as &quot;all other&quot;.

The second tier, as proposed, will bring our attention to any
FreeBSD/OpenBSD regressions and, in most cases, we will address them
(because they are usually easy to address). IMO, this level of support
is more than adequate given our lack of resources and relative
unpopularity of those platforms.

Perhaps this difference in approaches is rooted in our current (and
newly discovered!) disagreement on when best-effort/tier-2 results must
be reported (as discussed further below).


&gt;<i> My angle on that is that having arm32 will help us not become a
</I>&gt;<i> 64-bit monoculture, which could bring in regressions in low-level
</I>&gt;<i> data structures. At this stage in the embedded world, as far as I'm
</I>&gt;<i> aware, there are x86-32, arm32, MIPS and RISC-V. Of these arm32 is
</I>&gt;<i> the most prevalent and therefore my preferred choice. It also helps
</I>&gt;<i> that we have a test environment for it already, courtesy of a couple
</I>&gt;<i> of raspberry pi 3.
</I>
Same here: I share the sentiment but consider all these arguments
appropriate for tier-2; they are an overkill for tier-1. Squid can
survive without x86-32, arm32, MIPS, and RISC-V support. Yes, we do not
want to accidentally abandon support for those environments, without a
compelling reason, but that is exactly why we are adding tier-2 -- to
eliminate such accidents: Thanks to tier-2 presence, the decision to
regress support for those platforms (in some specific PR scope) will be
deliberate, _not_ accidental.



&gt;&gt;&gt;<i> Once achieved this status on any of these platforms,
</I>&gt;&gt;&gt;<i> regressions on it are release blockers.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I do not know what you mean by &quot;release&quot; exactly, but we should not add
</I>&gt;&gt;<i> rules that block schedule-based branching points and major releases[1].
</I>&gt;&gt;<i> [1] <A HREF="https://wiki.squid-cache.org/ReleaseSchedule">https://wiki.squid-cache.org/ReleaseSchedule</A>
</I>
Just to avoid misunderstanding, my comments/opinions about minor
releases below apply to the text below. My sentence quoted above is not
about minor releases; it is about major releases; major releases occur
on a fixed schedule; they are not governed by release maintenance rules
that are largely in Amos hands today. Moreover, since no PR can be
merged if it breaks tier-1 support, it is impossible to have a tier-1
regression unless we change the test environment without fixing Squid
first (which we should not do, especially for tier-1 platforms!).


&gt;&gt;<i> As for other/minor releases, I am not against this rule if the
</I>&gt;&gt;<i> maintainer is happy about it.
</I>
&gt;<i> Amos, what do you think?
</I>
I would like to adjust my comment: I think this additional formal rule
is not needed because we should just let the maintainer decide what
maintenance rules work best (and adjust them as needed), but I am not
against adding that formal rule if Amos wants to add it to his current
set of rules.


&gt;&gt;<i> AFAICT, the primary costs of keeping a platform on a best-effort list
</I>&gt;&gt;<i> are CI testing time and CI maintenance overheads. I suggest capping that
</I>&gt;&gt;<i> best-effort list to keep the total CI test time for one PR commit under,
</I>&gt;&gt;<i> say, 4 hours and granting CI maintenance team a veto on adding (but not
</I>&gt;&gt;<i> removing) platforms. IIRC, we have discussed PR commit testing time a
</I>&gt;&gt;<i> few months ago; if we agreed on another number of hours there, let's
</I>&gt;&gt;<i> take that as a cap.
</I>&gt;<i> 
</I>&gt;<i> The best-effort model supports testing best-effort platforms
</I>&gt;<i> asynchronously, no need to cap there. Regressions would be noted and
</I>&gt;<i> hopefully dealt with in followup PRs. We are already using this
</I>&gt;<i> practice.
</I>
The &quot;I will eventually let you know if your old PR broke OpenBSD support
and let you decide whether to revert that PR commit or fix the problem
sometime in the future&quot; approach does not work (and has never worked)
well IMO. We should know about tier-2 regressions _before_ PR is merged
(and excuse them explicitly). For that, tier-2 regressions should be
reported _before_ a PR is merged.

I understand that we may not have the technical capability to achieve
the timely regression reporting goal today, but that should be the goal,
and the tier design/rules should be based on that goal. Otherwise, there
will be little practical difference between best-effort teir-2 and
other/tier-3. Both will occasionally receive post-PR regression reports.
We should eliminate named tier-2 in that case and just let you test
whatever you want, whenever you can, reporting the results whenever you
have the time to do so.

In summary, if we want to define named tiers based, in part, on the PR
reaction to their test results, then those results must be reported
before the reacting PR is merged. Moreover, all other tiers (i.e. tiers
that are not defined in terms of PRs), do not really matter much in
terms of keeping Squid regressions-free. Can we agree to that principle?


Cheers,

Alex.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009745.html">[squid-dev] What os/cpu platforms do we want to target as a project?
</A></li>
	<LI>Next message (by thread): <A HREF="009732.html">[squid-dev] RFC: Categorize level-0/1 messages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9746">[ date ]</a>
              <a href="thread.html#9746">[ thread ]</a>
              <a href="subject.html#9746">[ subject ]</a>
              <a href="author.html#9746">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
