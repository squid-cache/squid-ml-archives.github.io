<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] [squid-users] Host header forgery detected on domain: mobile.pipe.aria.microsoft.com
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5Bsquid-users%5D%20Host%20header%20forgery%20detected%20on%0A%20domain%3A%20mobile.pipe.aria.microsoft.com&In-Reply-To=%3C00b101d6e4a4%24e5be45f0%24b13ad1d0%24%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="009631.html">
   <LINK REL="Next"  HREF="009633.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] [squid-users] Host header forgery detected on domain: mobile.pipe.aria.microsoft.com</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20%5Bsquid-users%5D%20Host%20header%20forgery%20detected%20on%0A%20domain%3A%20mobile.pipe.aria.microsoft.com&In-Reply-To=%3C00b101d6e4a4%24e5be45f0%24b13ad1d0%24%40gmail.com%3E"
       TITLE="[squid-dev] [squid-users] Host header forgery detected on domain: mobile.pipe.aria.microsoft.com">ngtech1ltd at gmail.com
       </A><BR>
    <I>Thu Jan  7 03:26:32 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009631.html">[squid-dev] I have seen this patch for Host Header forgery, I need translation.
</A></li>
        <LI>Next message (by thread): <A HREF="009633.html">[squid-dev] [squid-users] Host header forgery detected on domain: mobile.pipe.aria.microsoft.com
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9632">[ date ]</a>
              <a href="thread.html#9632">[ thread ]</a>
              <a href="subject.html#9632">[ subject ]</a>
              <a href="author.html#9632">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Alex,

The main issue now is the extensive logging.
For a tiny server with a single desktop client the cache.log  are expending a *lot*.
I have a problem with discarding these logs but for this specific case where the ttl is very low ie: lower &lt; 30/20/10 seconds
We can expect for this to happen so we can disable the logs since the service continue to work with this low ttl.
The only and main issue is the extensive logging which is wrong.

Should we continue this on Squid-dev?

Eliezer

----
Eliezer Croitoru
Tech Support
Mobile: +972-5-28704261
Email: <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">ngtech1ltd at gmail.com</A>
Zoom: Coming soon


-----Original Message-----
From: Alex Rousskov &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">rousskov at measurement-factory.com</A>&gt; 
Sent: Wednesday, January 6, 2021 10:42 PM
To: <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-users at lists.squid-cache.org</A>
Cc: Eliezer Croitoru &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">ngtech1ltd at gmail.com</A>&gt;
Subject: Re: [squid-users] Host header forgery detected on domain: mobile.pipe.aria.microsoft.com

On 1/6/21 2:49 PM, Eliezer Croitoru wrote:

&gt;<i> I am trying to think about the right solution for the next issue:
</I>&gt;<i> SECURITY ALERT: Host header forgery detected on conn18767
</I>&gt;<i> local=52.114.32.24:443 remote=192.168.189.52:65107 FD 15 flags=33 (local IP
</I>&gt;<i> does not match any domain IP)
</I>
As you know, this has been discussed many times on this list before,
including recently[1]. I doubt anything has changed since then.

[1]
<A HREF="http://lists.squid-cache.org/pipermail/squid-users/2020-November/022912.html">http://lists.squid-cache.org/pipermail/squid-users/2020-November/022912.html</A>


&gt;<i> All of the hosts use the same DNS service in the LAN however for some reason
</I>&gt;<i> both squid and the client are resolving different addresses
</I>&gt;<i> in a period of  10  Seconds.
</I>
The &quot;however for some reason&quot; part feels misleading to me -- what you
observe is the direct, expected consequence of the low-TTL environment
you have described. There is no contradiction or uncertainty here AFAICT.


&gt;<i> The solution I am thinking is to force a minimum of 60 seconds caching using
</I>&gt;<i> dnsmasq or another caching service.
</I>
FTR: Increasing DNS response TTL will reduce the number/probability of
false positives in forged Host header detection. No more. No less.


&gt;<i> Can we teach (theoretically) squid a way to look at these short TTLs as
</I>&gt;<i> something to decide by an ACL?
</I>
Yes, it is possible. There is positive_dns_ttl already which specifies
an upper bound. One could add a similar positive_dns_ttl_min option that
would specify the lower bound. Like virtually any Squid directive, it
can be made conditional on ACLs.

IMO, violating DNS TTLs is not the right solution for this problem
though. See my response on the [1] thread for a better medium-term solution.


HTH,

Alex.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009631.html">[squid-dev] I have seen this patch for Host Header forgery, I need translation.
</A></li>
	<LI>Next message (by thread): <A HREF="009633.html">[squid-dev] [squid-users] Host header forgery detected on domain: mobile.pipe.aria.microsoft.com
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9632">[ date ]</a>
              <a href="thread.html#9632">[ thread ]</a>
              <a href="subject.html#9632">[ subject ]</a>
              <a href="author.html#9632">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
