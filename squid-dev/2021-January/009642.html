<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] effective acl for tcp_outgoing_address
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20effective%20acl%20for%20tcp_outgoing_address&In-Reply-To=%3COSBPR01MB27762FEF08A0BFFADC72518AE8A20%40OSBPR01MB2776.jpnprd01.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="009641.html">
   <LINK REL="Next"  HREF="009643.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] effective acl for tcp_outgoing_address</H1>
    <B>Hideyuki Kawai</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20effective%20acl%20for%20tcp_outgoing_address&In-Reply-To=%3COSBPR01MB27762FEF08A0BFFADC72518AE8A20%40OSBPR01MB2776.jpnprd01.prod.outlook.com%3E"
       TITLE="[squid-dev] effective acl for tcp_outgoing_address">h.kawai at ntt.com
       </A><BR>
    <I>Wed Jan 20 04:35:56 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009641.html">[squid-dev] effective acl for tcp_outgoing_address
</A></li>
        <LI>Next message (by thread): <A HREF="009643.html">[squid-dev] effective acl for tcp_outgoing_address
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9642">[ date ]</a>
              <a href="thread.html#9642">[ thread ]</a>
              <a href="subject.html#9642">[ subject ]</a>
              <a href="author.html#9642">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dear Mr.Alex,

Thank you very much for your reply.

I have one more question about slow acl type related with tcp_outgoing_address.
(I give up the solution based on &quot;AD security group.)

Then, I would like to map ip address based on username which is required proxy_auth (kerberos).
Because, based on the squid docs (<A HREF="http://www.squid-cache.org/Doc/config/tcp_outgoing_address/">http://www.squid-cache.org/Doc/config/tcp_outgoing_address/</A>), tcp_outgoing_address can map based on &quot;username&quot;.
However, such acl types (ident, proxy_auth) are slow type. (<A HREF="http://www.squid-cache.org/Doc/config/acl/">http://www.squid-cache.org/Doc/config/acl/</A>)
So, it seems also can not use to cp_outgoing_address.... (I confused.)

Do you have any comment?
If you give some comment my question, it is helpful for my understanding...

====== reference (<A HREF="http://www.squid-cache.org/Doc/config/acl/">http://www.squid-cache.org/Doc/config/acl/</A>) ======
	acl aclname ident [-i] username ...
	acl aclname ident_regex [-i] pattern ...
	  # string match on ident output [slow]
	  # use REQUIRED to accept any non-null ident.

	acl aclname proxy_auth [-i] username ...
	acl aclname proxy_auth_regex [-i] pattern ...
	  # perform http authentication challenge to the client and match against
	  # supplied credentials [slow]
	  #
	  # takes a list of allowed usernames.
	  # use REQUIRED to accept any valid username.
	  #
	  # Will use proxy authentication in forward-proxy scenarios, and plain
	  # http authenticaiton in reverse-proxy scenarios
	  #
	  # NOTE: when a Proxy-Authentication header is sent but it is not
	  # needed during ACL checking the username is NOT logged
	  # in access.log.
	  #
	  # NOTE: proxy_auth requires a EXTERNAL authentication program
	  # to check username/password combinations (see
	  # auth_param directive).
	  #
	  # NOTE: proxy_auth can't be used in a transparent/intercepting proxy
	  # as the browser needs to be configured for using a proxy in order
	  # to respond to proxy authentication.
======================

Best regards,
Kawai

-------------------------------------
<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">h.kawai at ntt.com</A>
-------------------------------------

-----Original Message-----
From: Alex Rousskov &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">rousskov at measurement-factory.com</A>&gt; 
Sent: Thursday, January 14, 2021 11:25 PM
To: <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev at lists.squid-cache.org</A>
Cc: Hideyuki Kawai（川井秀行） &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">h.kawai at ntt.com</A>&gt;
Subject: Re: [squid-dev] effective acl for tcp_outgoing_address

On 1/13/21 7:47 PM, Hideyuki Kawai wrote:

&gt;<i> 1. &quot;external_acl&quot; can not use on tcp_outgoing_address. Because the 
</I>&gt;<i> external_acl type is slow. My understanding is correct?
</I>

Yes, your understanding is correct. There are cases where a slow ACL &quot;usually works&quot; with a tcp_outgoing_address directive due to ACL caching side effects, and there are many examples on the web abusing those side effects, but you should not rely on such accidents when using modern Squid versions.


&gt;<i> 2. If yes, how to solve my requirement?
</I>
Use an annotation approach instead. The &quot;note&quot; ACL is fast, and the external ACL helper can annotate transactions (and connections) in modern Squids. The only difficulty with this approach is to find a directive that satisfies all of the conditions below:

1. supports slow ACLs
2. evaluated after the info needed by the external ACL helper is known 3. evaluated before tcp_outgoing_address

In many cases, http_access is such a directive, but YMMV.


HTH,

Alex.
P.S. FWIW, I can agree with one Eliezer statement on this thread: This thread belongs to squid-users, not squid-dev.
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009641.html">[squid-dev] effective acl for tcp_outgoing_address
</A></li>
	<LI>Next message (by thread): <A HREF="009643.html">[squid-dev] effective acl for tcp_outgoing_address
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9642">[ date ]</a>
              <a href="thread.html#9642">[ thread ]</a>
              <a href="subject.html#9642">[ subject ]</a>
              <a href="author.html#9642">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
