<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] squid-5.0.5-20210223-r4af19cc24 difference in behaviors between openbsd and linux
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20squid-5.0.5-20210223-r4af19cc24%20difference%20in%0A%20behaviors%20between%20openbsd%20and%20linux&In-Reply-To=%3Cb6373c5c-7078-e50c-4c97-735ad0dc7190%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="009658.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] squid-5.0.5-20210223-r4af19cc24 difference in behaviors between openbsd and linux</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20squid-5.0.5-20210223-r4af19cc24%20difference%20in%0A%20behaviors%20between%20openbsd%20and%20linux&In-Reply-To=%3Cb6373c5c-7078-e50c-4c97-735ad0dc7190%40treenet.co.nz%3E"
       TITLE="[squid-dev] squid-5.0.5-20210223-r4af19cc24 difference in behaviors between openbsd and linux">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Mar 29 09:33:00 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009658.html">[squid-dev] squid-5.0.5-20210223-r4af19cc24 difference in behaviors between openbsd and linux
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9660">[ date ]</a>
              <a href="thread.html#9660">[ thread ]</a>
              <a href="subject.html#9660">[ subject ]</a>
              <a href="author.html#9660">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 29/03/21 6:16 am, Eliezer Croitoru wrote:
&gt;<i> Hey Robert,
</I>&gt;<i> 
</I>&gt;<i> I am not sure I understood what is the meaning of the description:
</I>&gt;<i> openbsd: Requiring client certificates.
</I>&gt;<i> linux: Not requiring any client certificates
</I>&gt;<i> 
</I>
@Eliezer:
   They are startup messages Squid prints in cache.log when a TLS server 
context is initialized.



&gt;<i> -----Original Message-----
</I>&gt;<i> From: Robert Smith
</I>&gt;<i> Sent: Sunday, March 28, 2021 7:27 PM
</I>&gt;<i> 
</I>&gt;<i> Dear Squid-Dev list:
</I>&gt;<i> 
</I>&gt;<i> I could use some help on this one:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I have a build environment that is identical on linux, openbsd, and macosx
</I>&gt;<i> 
</I>&gt;<i> In this scenario, I am developing under:
</I>&gt;<i> 
</I>&gt;<i> Ubuntu 18.04 - All patches and updates applied as of 3/24
</I>&gt;<i> OpenBSD 6.8 - All patches and updates applied as of 3/24
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I will note that I am really only using the libc from each system whereas every other component dependencies (which are not many! Good job squid team!) are a part of my build system.
</I>&gt;<i> 
</I>&gt;<i> When building squid with the exact same tool chain and library stack, with the same configure options, I am seeing a difference in behavior on the two platforms:
</I>&gt;<i> 
</I>&gt;<i> The difference is that after parsing the configuration file, the two systems differ in whether or not they will require client certificates:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> openbsd: Requiring client certificates.
</I>&gt;<i> 
</I>&gt;<i> linux: Not requiring any client certificates
</I>&gt;<i>
</I>
What the message means depends on whether the http(s)_port, a 
cache_peer, or the outgoing <A HREF="https://">https://</A> context is being initialized. 
Options that directive was supposed to be using (including the default 
security).

Looking at your logs I see:


On OpenBSD Squid detects the presence of an IPv6 split-stack for 
networking. Which means Squid has to clone the internal representation 
of all your squid.conf *_port settings and setup separate contexts and 
state for IPv4 versions of them.
  There seems to be a bug in that cloning process which is turning on 
the TLS client certificates feature. Please report this to our bugzilla 
so it does not get forgotten until fixed.


On Linux Squid is detecting IPv6 disabled in the kernel networking 
setup. So it is disabling its own IPv6 support. That said Linux has a 
hybrid-stack networking so the cloning would not happen anyway. If IPv6 
were enabled here it would be somewhat more obvious that the IPv4 ports 
on OpenBSD are the odd ones.


For a workaround you may be able to set sslflags=DELAYED_AUTH on the 
http*_port lines and leave your ACLs as they are without anything 
requiring a client certificate.



&gt;<i> 
</I>&gt;<i> # openbsd
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">root at openbsd</A>:~# /root/squid.init conftest
</I>
&gt;<i> 2021/03/28 10:47:31| Processing: http_port 3128 ssl-bump cert=/opt/osec/etc/ssl_cert/squid-ca-cert+key.pem generate-host-certificates=on dynamic_cert_mem_cache_size=16MB
</I>&gt;<i> 2021/03/28 10:47:31| Processing: https_port 3129 intercept ssl-bump cert=/opt/osec/etc/ssl_cert/squid-ca-cert+key.pem generate-host-certificates=on dynamic_cert_mem_cache_size=16MB
</I>
&gt;<i> 2021/03/28 10:47:31| Processing: tls_outgoing_options cafile=/opt/osec/etc/pki/tls/certs/ca-bundle.crt
</I>

&gt;<i> 2021/03/28 10:47:31| Initializing <A HREF="https://">https://</A> proxy context
</I>&gt;<i> 2021/03/28 10:47:31| Requiring client certificates.
</I>

&gt;<i> 2021/03/28 10:47:31| Initializing http_port [::]:3128 TLS contexts
</I>&gt;<i> 2021/03/28 10:47:31| Using certificate in /opt/osec/etc/ssl_cert/squid-ca-cert+key.pem
</I>&gt;<i> 2021/03/28 10:47:31| Using certificate chain in /opt/osec/etc/ssl_cert/squid-ca-cert+key.pem
</I>&gt;<i> 2021/03/28 10:47:31| Adding issuer CA: /C=US/ST=Kansas/L=Overland Park/O=Company, Inc./OU=Area 77/CN=local.corp.dom/emailAddress=<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">ssladmin at Company.com</A>
</I>&gt;<i> 2021/03/28 10:47:31| Using key in /opt/osec/etc/ssl_cert/squid-ca-cert+key.pem
</I>&gt;<i> 2021/03/28 10:47:31| Not requiring any client certificates
</I>

&gt;<i> 2021/03/28 10:47:31| Initializing http_port 0.0.0.0:3128 TLS contexts
</I>&gt;<i> 2021/03/28 10:47:31| Using certificate in /opt/osec/etc/ssl_cert/squid-ca-cert+key.pem
</I>&gt;<i> 2021/03/28 10:47:31| Using certificate chain in /opt/osec/etc/ssl_cert/squid-ca-cert+key.pem
</I>&gt;<i> 2021/03/28 10:47:31| Adding issuer CA: /C=US/ST=Kansas/L=Overland Park/O=Company, Inc./OU=Area 77/CN=local.corp.dom/emailAddress=<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">ssladmin at Company.com</A>
</I>&gt;<i> 2021/03/28 10:47:31| Using key in /opt/osec/etc/ssl_cert/squid-ca-cert+key.pem
</I>&gt;<i> 2021/03/28 10:47:31| Requiring client certificates.
</I>

&gt;<i> 2021/03/28 10:47:31| Initializing https_port [::]:3129 TLS contexts
</I>&gt;<i> 2021/03/28 10:47:31| Using certificate in /opt/osec/etc/ssl_cert/squid-ca-cert+key.pem
</I>&gt;<i> 2021/03/28 10:47:31| Using certificate chain in /opt/osec/etc/ssl_cert/squid-ca-cert+key.pem
</I>&gt;<i> 2021/03/28 10:47:31| Adding issuer CA: /C=US/ST=Kansas/L=Overland Park/O=Company, Inc./OU=Area 77/CN=local.corp.dom/emailAddress=<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">ssladmin at Company.com</A>
</I>&gt;<i> 2021/03/28 10:47:31| Using key in /opt/osec/etc/ssl_cert/squid-ca-cert+key.pem
</I>&gt;<i> 2021/03/28 10:47:31| Not requiring any client certificates
</I>

&gt;<i> 2021/03/28 10:47:31| Initializing https_port 0.0.0.0:3129 TLS contexts
</I>&gt;<i> 2021/03/28 10:47:31| Using certificate in /opt/osec/etc/ssl_cert/squid-ca-cert+key.pem
</I>&gt;<i> 2021/03/28 10:47:31| Using certificate chain in /opt/osec/etc/ssl_cert/squid-ca-cert+key.pem
</I>&gt;<i> 2021/03/28 10:47:31| Adding issuer CA: /C=US/ST=Kansas/L=Overland Park/O=Company, Inc./OU=Area 77/CN=local.corp.dom/emailAddress=<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">ssladmin at Company.com</A>
</I>&gt;<i> 2021/03/28 10:47:31| Using key in /opt/osec/etc/ssl_cert/squid-ca-cert+key.pem
</I>&gt;<i> 2021/03/28 10:47:31| Requiring client certificates.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> # linux
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">root at linux</A>:~# /root/squid.init conftest
</I>
&gt;<i> 2021/03/28 10:48:21| WARNING: BCP 177 violation. Detected non-functional IPv6 loopback.
</I>&gt;<i> 2021/03/28 10:48:21| aclIpParseIpData: IPv6 has not been enabled.
</I>&gt;<i> 2021/03/28 10:48:21| aclIpParseIpData: IPv6 has not been enabled.
</I>&gt;<i> 2021/03/28 10:48:21| Initializing <A HREF="https://">https://</A> proxy context
</I>&gt;<i> 2021/03/28 10:48:21| Requiring client certificates.
</I>
&gt;<i> 2021/03/28 10:48:21| Initializing http_port 0.0.0.0:3128 TLS contexts
</I>&gt;<i> 2021/03/28 10:48:21| Using certificate in /opt/osec/etc/ssl_cert/squid-ca-cert+key.pem
</I>&gt;<i> 2021/03/28 10:48:21| Using certificate chain in /opt/osec/etc/ssl_cert/squid-ca-cert+key.pem
</I>&gt;<i> 2021/03/28 10:48:21| Adding issuer CA: /C=US/ST=Kansas/L=Overland Park/O=Company, Inc./OU=Area 77/CN=local.corp.dom/emailAddress=<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">ssladmin at Company.com</A>
</I>&gt;<i> 2021/03/28 10:48:21| Using key in /opt/osec/etc/ssl_cert/squid-ca-cert+key.pem
</I>&gt;<i> 2021/03/28 10:48:21| Not requiring any client certificates
</I>
&gt;<i> 2021/03/28 10:48:21| Initializing https_port 0.0.0.0:3129 TLS contexts
</I>&gt;<i> 2021/03/28 10:48:21| Using certificate in /opt/osec/etc/ssl_cert/squid-ca-cert+key.pem
</I>&gt;<i> 2021/03/28 10:48:21| Using certificate chain in /opt/osec/etc/ssl_cert/squid-ca-cert+key.pem
</I>&gt;<i> 2021/03/28 10:48:21| Adding issuer CA: /C=US/ST=Kansas/L=Overland Park/O=Company, Inc./OU=Area 77/CN=local.corp.dom/emailAddress=<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">ssladmin at Company.com</A>
</I>&gt;<i> 2021/03/28 10:48:21| Using key in /opt/osec/etc/ssl_cert/squid-ca-cert+key.pem
</I>&gt;<i> 2021/03/28 10:48:21| Not requiring any client certificates
</I>&gt;<i> 
</I>


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009658.html">[squid-dev] squid-5.0.5-20210223-r4af19cc24 difference in behaviors between openbsd and linux
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9660">[ date ]</a>
              <a href="thread.html#9660">[ thread ]</a>
              <a href="subject.html#9660">[ subject ]</a>
              <a href="author.html#9660">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
