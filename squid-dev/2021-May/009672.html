<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Strategy about build farm nodes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Strategy%20about%20build%20farm%20nodes&In-Reply-To=%3CCA%2BY8hcP9buYP-DzgADUiX7rNCGiq8Nc7G6Z5WYw%2B7joiDocxCA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="009671.html">
   <LINK REL="Next"  HREF="009673.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Strategy about build farm nodes</H1>
    <B>Francesco Chemolli</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Strategy%20about%20build%20farm%20nodes&In-Reply-To=%3CCA%2BY8hcP9buYP-DzgADUiX7rNCGiq8Nc7G6Z5WYw%2B7joiDocxCA%40mail.gmail.com%3E"
       TITLE="[squid-dev] Strategy about build farm nodes">gkinkie at gmail.com
       </A><BR>
    <I>Mon May  3 04:41:49 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009671.html">[squid-dev] Any code pointers to get sending certificate chain from squid reverse proxy with gnutls?
</A></li>
        <LI>Next message (by thread): <A HREF="009673.html">[squid-dev] Strategy about build farm nodes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9672">[ date ]</a>
              <a href="thread.html#9672">[ thread ]</a>
              <a href="subject.html#9672">[ subject ]</a>
              <a href="author.html#9672">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Apr 28, 2021 at 11:34 PM Alex Rousskov &lt;
<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">rousskov at measurement-factory.com</A>&gt; wrote:

&gt;<i> On 4/28/21 5:12 PM, Amos Jeffries wrote:
</I>&gt;<i> &gt; I'm not sure why this is so controversial still. We have already been
</I>&gt;<i> &gt; over these and have a policy from last time:
</I>&gt;<i>
</I>&gt;<i> Apparently, the recollections of what was agreed upon, if anything,
</I>&gt;<i> during that &quot;last time&quot; differ. If you can provide a pointer to that
</I>&gt;<i> &quot;last time&quot; agreement, please do so.
</I>&gt;<i>
</I>
Merge workflows are agreed, and not in discussion. Recent discussions have
highlighted some issues with what's around them, and I'm trying to clarify
that as well

&gt;<i> * dev PR submissions use the volatile 5-pr-test, after test approval by
</I>&gt;<i> &gt; anyone in QA. Check against unstable OS nodes, as many as possible.
</I>&gt;<i> &gt; Kinkie adds/removes from that set as upgrades fix or break at CI end of
</I>&gt;<i> &gt; things.
</I>&gt;<i>
</I>&gt;<i> I do not know how to interpret the last sentence correctly, but, IMO, we
</I>&gt;<i> should not add or change nodes if doing so breaks master tests. AFAICT
</I>&gt;<i> from PR 806 discussion[1], Francesco thinks that it is not a big deal to
</I>&gt;<i> do so. The current discussion is meant to resolve that disagreement.
</I>&gt;<i>
</I>
Let me highlight the underlying principles for my proposal: IMO our
objectives are, in descending order of importance (all points should be
intended &quot;as possible given our resources&quot;):
1. ensure we ship healthy code to a maximum number of users
2. have minimal friction in the development workflow

These objectives have a set of consequences:
- we want our QA environment to match what users will use. For this reason,
it is not sensible that we just stop upgrading our QA nodes, or we would
target something that doesn't match our users' experience
- it makes little sense to target unstable distributions (fedora rawhide,
possibly centos stream, gentoo, opensuse tumbleweed, debian unstable) as
first-class citizens of the testing workflow, especially on stages that are
executed often (pr-test)

This means that:
- I periodically weed out distributions that are no longer supported (e.g.
Fedora 31, Ubuntu Xenial) and add current distribution (e.g. Ubuntu
Hirsute, Fedora 34).
I take it on me that when I do that, I need to ensure new compiler features
do not block previously undetected behaviours - I am currently failing
this, see <A HREF="https://build.squid-cache.org/job/trunk-matrix/121/">https://build.squid-cache.org/job/trunk-matrix/121/</A> . I will need
to develop a process with a proper staging phase.
- I believe we should define four tiers of runtime environments, and
reflect these in our test setup:
 1. current and stable (e.g. ubuntu-latest-lts). These are not expected to
change much over a span of years, and to offer non-breaking updates over
their lifetime
 2. current (e.g. fedora 34)
 3. bleeding edge: they may introduce breaking changes which it makes sense
to follow because they might highlight real issues and because they will
eventually trickle down to current and then lts
 4. everything else - this includes freebsd and openbsd (mostly due to the
different virtualization tech they use)

I believe we should focus on the first two tiers for our merge workflow,
but then expect devs to fix any breakages in the third and fourth tiers if
caused by their PR, while I will care for any breakages caused by
dist-upgrades


&gt;<i> [1] <A HREF="https://github.com/squid-cache/squid/pull/806#issuecomment-827937563">https://github.com/squid-cache/squid/pull/806#issuecomment-827937563</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; * anubis auto branch tested by curated set of LTS stable nodes only.
</I>&gt;<i>
</I>&gt;<i> FWIW, the above list and the original list by Francesco appears to focus
</I>&gt;<i> on distro stability, popularity, and other factors that are largely
</I>&gt;<i> irrelevant to the disagreement at hand. The disagreement is whether it
</I>&gt;<i> is OK to break master (and, hence, all PR) tests by changing CI. It does
</I>&gt;<i> not matter whether that CI change comes from an upgrade of an &quot;LTS
</I>&gt;<i> stable node&quot;, &quot;unstable node&quot;, or some other source IMO. Breaking
</I>&gt;<i> changes should not be allowed (in the CI environments under our
</I>&gt;<i> control). If they slip through despite careful monitoring for change
</I>&gt;<i> effects, the breaking CI changes should be reverted.
</I>&gt;<i>
</I>
I think it depends.
Breakages due to changes in nodes (e.g. introducing a new distro version)
would be on me and would not stop the merge workflow.
What I would place on each individual dev is the case where a PR breaks
something in the trunk-matrix,trunk-arm32-matrix, trunk-arm64-matrix,
trunk-openbsd-matrix, trunk-freebsd-matrix builds, even if the 5-pr-test
and 5-pr-auto builds fail to detect the breakage because it happens on a
unstable or old platform.

-- 
    Francesco
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-dev/attachments/20210503/17ff450a/attachment.htm">http://lists.squid-cache.org/pipermail/squid-dev/attachments/20210503/17ff450a/attachment.htm</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009671.html">[squid-dev] Any code pointers to get sending certificate chain from squid reverse proxy with gnutls?
</A></li>
	<LI>Next message (by thread): <A HREF="009673.html">[squid-dev] Strategy about build farm nodes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9672">[ date ]</a>
              <a href="thread.html#9672">[ thread ]</a>
              <a href="subject.html#9672">[ subject ]</a>
              <a href="author.html#9672">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
