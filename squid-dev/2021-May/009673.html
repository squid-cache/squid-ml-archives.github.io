<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Strategy about build farm nodes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Strategy%20about%20build%20farm%20nodes&In-Reply-To=%3C81e781b0-9d9b-9a73-e3ca-d7718c4740ec%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="009672.html">
   <LINK REL="Next"  HREF="009674.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Strategy about build farm nodes</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Strategy%20about%20build%20farm%20nodes&In-Reply-To=%3C81e781b0-9d9b-9a73-e3ca-d7718c4740ec%40measurement-factory.com%3E"
       TITLE="[squid-dev] Strategy about build farm nodes">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon May  3 14:29:31 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009672.html">[squid-dev] Strategy about build farm nodes
</A></li>
        <LI>Next message (by thread): <A HREF="009674.html">[squid-dev] Strategy about build farm nodes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9673">[ date ]</a>
              <a href="thread.html#9673">[ thread ]</a>
              <a href="subject.html#9673">[ subject ]</a>
              <a href="author.html#9673">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 5/3/21 12:41 AM, Francesco Chemolli wrote:
&gt;<i> - we want our QA environment to match what users will use. For this
</I>&gt;<i> reason, it is not sensible that we just stop upgrading our QA nodes, 
</I>
I see flaws in reasoning, but I do agree with the conclusion -- yes, we
should upgrade QA nodes. Nobody has proposed a ban on upgrades AFAICT!

The principles I have proposed allow upgrades that do not violate key
invariants. For example, if a proposed upgrade would break master, then
master has to be changed _before_ that upgrade actually happens, not
after. Upgrades must not break master.

What this means in terms of sysadmin steps for doing upgrades is up to
you. You are doing the hard work here, so you can optimize it the way
that works best for _you_. If really necessary, I would not even object
to trial upgrades (that may break master for an hour or two) as long as
you monitor the results and undo the breaking changes quickly and
proactively (without relying on my pleas to fix Jenkins to detect
breakages). I do not know what is feasible and what the best options
are, but, again, it is up to _you_ how to optimize this (while observing
the invariants).


&gt;<i> - I believe we should define four tiers of runtime environments, and
</I>&gt;<i> reflect these in our test setup:
</I>
&gt;<i>  1. current and stable (e.g. ubuntu-latest-lts).
</I>&gt;<i>  2. current (e.g. fedora 34)
</I>&gt;<i>  3. bleeding edge
</I>&gt;<i>  4. everything else - this includes freebsd and openbsd
</I>
I doubt this classification is important to anybody _outside_ this
discussion, so I am OK with whatever classification you propose to
satisfy your internal needs.


&gt;<i> I believe we should focus on the first two tiers for our merge workflow,
</I>&gt;<i> but then expect devs to fix any breakages in the third and fourth tiers
</I>&gt;<i> if caused by their PR,
</I>
FWIW, I do not understand what &quot;focus&quot; implies in this statement, and
why developers should _not_ &quot;fix any breakages&quot; revealed by the tests in
the first two tiers.

The rules I have in mind use two natural tiers:

* If a PR cannot pass a required CI test, that PR has to change before
it can be merged.

* If a PR cannot pass an optional CI test, it is up to PR author and
reviewers to decide what to do next.

These are very simple rules that do not require developer knowledge of
any complex test node tiers that we might define/use internally.

Needless to say, the rules assume that the tests themselves are correct.
If not, the broken tests need to be fixed (by the Squid Project) before
the first bullet/rule above can be meaningfully applied (the second one
is flexible enough to allow PR author and reviewers to ignore optional
test failures).


&gt;<i> Breakages due to changes in nodes (e.g. introducing a new distro
</I>&gt;<i> version) would be on me and would not stop the merge workflow.
</I>
What you do internally to _avoid_ breakage is up to you, but the primary
goal is to _prevent_ CI breakage (rather than to keep CI nodes &quot;up to
date&quot;!). If CI is broken, then it is the responsibility of the Squid
Project to fix CI ASAP. Thank you for assuming that responsibility as
far as Jenkins tests are concerned.

There are many ways to break CI and detect those breakages, of course,
but if master cannot pass required tests after a CI change, then the
change broke CI.


&gt;<i> What I would place on each individual dev is the case where a PR breaks
</I>&gt;<i> something in the trunk-matrix,trunk-arm32-matrix, trunk-arm64-matrix,
</I>&gt;<i> trunk-openbsd-matrix, trunk-freebsd-matrix builds, even if the 5-pr-test
</I>&gt;<i> and 5-pr-auto builds fail to detect the breakage because it happens on a
</I>&gt;<i> unstable or old platform. 
</I>
This feels a bit out of topic for me, but I think you are saying that
some CI tests called trunk-matrix, trunk-arm32-matrix,
trunk-arm64-matrix, trunk-openbsd-matrix, trunk-freebsd-matrix should be
classified as _required_. In other words, a PR must pass those CI tests
before it can be merged. Is that the situation today? Or are you
proposing some changes to the list of required CI tests? What are those
changes?


Thank you,

Alex.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009672.html">[squid-dev] Strategy about build farm nodes
</A></li>
	<LI>Next message (by thread): <A HREF="009674.html">[squid-dev] Strategy about build farm nodes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9673">[ date ]</a>
              <a href="thread.html#9673">[ thread ]</a>
              <a href="subject.html#9673">[ subject ]</a>
              <a href="author.html#9673">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
