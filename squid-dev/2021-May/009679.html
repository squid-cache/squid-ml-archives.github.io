<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Strategy about build farm nodes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Strategy%20about%20build%20farm%20nodes&In-Reply-To=%3Cb7087dcc-3b91-54ba-e197-5643fb2249f5%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="009677.html">
   <LINK REL="Next"  HREF="009680.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Strategy about build farm nodes</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Strategy%20about%20build%20farm%20nodes&In-Reply-To=%3Cb7087dcc-3b91-54ba-e197-5643fb2249f5%40measurement-factory.com%3E"
       TITLE="[squid-dev] Strategy about build farm nodes">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon May 17 18:31:44 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009677.html">[squid-dev] Strategy about build farm nodes
</A></li>
        <LI>Next message (by thread): <A HREF="009680.html">[squid-dev] Strategy about build farm nodes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9679">[ date ]</a>
              <a href="thread.html#9679">[ thread ]</a>
              <a href="subject.html#9679">[ subject ]</a>
              <a href="author.html#9679">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 5/17/21 2:17 AM, Francesco Chemolli wrote:

&gt;<i> Our Linux environments are docker containers on amd64, armv7l and arm64.
</I>&gt;<i> On a roughly monthly cadence, I pull from our dockerfiles repo
</I>&gt;<i> (<A HREF="https://github.com/kinkie/dockerfiles">https://github.com/kinkie/dockerfiles</A>) and
</I>&gt;<i> $ make all push
</I>
Does that &quot;make push&quot; command automatically switch Jenkins CI to using
the new/pushed containers? Or is that a separate manual step?


&gt;&gt;&gt;<i> What I would place on each individual dev is the case where a PR breaks
</I>&gt;&gt;&gt;<i> something in the trunk-matrix,trunk-arm32-matrix, trunk-arm64-matrix,
</I>&gt;&gt;&gt;<i> trunk-openbsd-matrix, trunk-freebsd-matrix builds
</I>
&gt;&gt;<i> I think you are saying that
</I>&gt;&gt;<i> some CI tests called trunk-matrix, trunk-arm32-matrix,
</I>&gt;&gt;<i> trunk-arm64-matrix, trunk-openbsd-matrix, trunk-freebsd-matrix should be
</I>&gt;&gt;<i> classified as _required_.
</I>
&gt;<i> That is how I read the statement too.
</I>
... but it sounds like that is _not_ what you (Francesco) is actually
proposing because you are essentialy saying &quot;that ideal would be
impractical&quot; in the paragraph below. Assuming that you are not attacking
your own proposal, that means Amos and I do not know what your proposal
is -- we both guessed incorrectly...


&gt;<i> In a word of infinite resources and very efficient testing, sure.
</I>&gt;<i> But in a space where a single os/compiler combo takes 2hrs on Linux and
</I>&gt;<i> 4hrs on Freebsd or openbsd, and a full 5-pr-test takes 6 hours end to
</I>&gt;<i> end, we need to optimize or making any of these requirements blocking
</I>&gt;<i> would make these times get 4+ times larger (a full trunk-matrix takes
</I>&gt;<i> just about a day on amd64, 2 days on arm64), and the complaint would
</I>&gt;<i> then be that development or release is slowed down by the amount of
</I>&gt;<i> testing done.
</I>
FWIW, I think that full round of PR tests (i.e. one initial set plus one
staging set) should not exceed ~24 hours, _including_ any wait/queuing
time. This kind of delay should still allow for reasonable progress with
PRs AFAICT. This includes any release PRs, of course. If we exceed these
limits (or whatever limits we can agree on), then we should add testing
resources and/or drop tests.


&gt;<i> My proposal aims to test/land the PR on the systems where we can be
</I>&gt;<i> efficient and that are relevant, and fix any remaining after-the-fact
</I>&gt;<i> issues with followup, PRs, that remain a soft requirement for the dev
</I>&gt;<i> introducing the change.
</I>
Here, I think you are proposing to make some tests optional. Which ones?


&gt;<i> For instance: we currently have a lot of different build-time
</I>&gt;<i> configurations meant to save core memory in runtime environments. Is it
</I>&gt;<i> maybe time to revisit this decision and move these checks to run time?
</I>
Sure, quality proposals for removing #ifdefs should be welcomed, one
(group of) #ifdefs at a time. We can warn squid-users in advance in case
somebody wants to provide evidence of harm.


&gt;<i> Unfortunately, one of the problems we have is that we're running blind.
</I>&gt;<i> We don't know what configurations our users deploy; we can only assume
</I>&gt;<i> and that makes this conversation much more susceptible to opinions and
</I>&gt;<i> harder to build consensus on
</I>
Yes, we are blind, but I doubt we should care much about actual
configuration in this specific context. If we can remove an #ifdef
without serious negative consequences, we should remove it. We can avoid
long discussions by allowing anybody with concrete evidence of problems
to block any particular removal. I bet that conservative approach would
still allow for the removal of many #ifdefs.


FWIW, I do not think reducing the number of #ifdefs will solve our
primary CI problems. I believe we should reduce the number of platforms
we test on and then use Foundation resources to speed up and improve the
remaining tests.


HTH,

Alex.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009677.html">[squid-dev] Strategy about build farm nodes
</A></li>
	<LI>Next message (by thread): <A HREF="009680.html">[squid-dev] Strategy about build farm nodes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9679">[ date ]</a>
              <a href="thread.html#9679">[ thread ]</a>
              <a href="subject.html#9679">[ subject ]</a>
              <a href="author.html#9679">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
