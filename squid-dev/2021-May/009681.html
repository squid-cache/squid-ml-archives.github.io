<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Strategy about build farm nodes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Strategy%20about%20build%20farm%20nodes&In-Reply-To=%3C19cb4b05-71b0-3b8a-bf3f-ef1b74d7cd52%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="009680.html">
   <LINK REL="Next"  HREF="009682.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Strategy about build farm nodes</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Strategy%20about%20build%20farm%20nodes&In-Reply-To=%3C19cb4b05-71b0-3b8a-bf3f-ef1b74d7cd52%40measurement-factory.com%3E"
       TITLE="[squid-dev] Strategy about build farm nodes">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon May 17 21:04:15 UTC 2021</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009680.html">[squid-dev] Strategy about build farm nodes
</A></li>
        <LI>Next message (by thread): <A HREF="009682.html">[squid-dev] Compilling squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9681">[ date ]</a>
              <a href="thread.html#9681">[ thread ]</a>
              <a href="subject.html#9681">[ subject ]</a>
              <a href="author.html#9681">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 5/17/21 3:32 PM, Francesco Chemolli wrote:
&gt;<i> On Mon, May 17, 2021 at 8:32 PM Alex Rousskov wrote:
</I>&gt;<i> 
</I>&gt;<i>     On 5/17/21 2:17 AM, Francesco Chemolli wrote:
</I>&gt;<i>     &gt; $ make all push
</I>&gt;<i> 
</I>&gt;<i>     Does that &quot;make push&quot; command automatically switch Jenkins CI to using
</I>&gt;<i>     the new/pushed containers? Or is that a separate manual step?
</I>
&gt;<i> Right now that's automatic.
</I>&gt;<i> I'm pondering the best way to have a staging step; Docker supports
</I>&gt;<i> versioning of images but we're using that feature to implement
</I>&gt;<i> multiarch. In order to rely on that I'll need to change the naming
</I>&gt;<i> conventions we rely on.
</I>
I think you should be free to use whatever versioning/naming scheme you
think works best for supporting safe Jenkins CI upgrades.

Ideally, the new docker images (and any other changes) should be tested
(against official branches) _before_ the official tests are switched to
use them. I hope you find a way to implement that without a lot of work.
If you need to tap into Foundation resources, please say so!


&gt;<i> The overarching objectives are:
</I>&gt;<i> - focus on where most users probably are
</I>&gt;<i> - allow iterating quickly giving some signal on tracked branches
</I>&gt;<i> - allow landing quickly with more signal
</I>&gt;<i> - be slow but exhaustive on every other platform we can cover. Do not
</I>&gt;<i> block landing new code on less common or harder to test on platforms,
</I>&gt;<i> but still rely on devs to own their changes there, too.
</I>
What exactly do you mean by &quot;own their changes there&quot;? The rest is
general/vague enough to allow for many interpretations I can agree with,
but that last bit seems rather specific, so I wanted to ask...


&gt;<i>     I think that full round of PR tests (i.e. one initial set plus one
</I>&gt;<i>     staging set) should not exceed ~24 hours, _including_ any wait/queuing
</I>&gt;<i>     time.
</I>
&gt;<i> Is everyone okay with such a slow turnaround?
</I>
Well, you should not overload the question by calling a 24-hour delay
for an all-green signal slow :-).

It is all relative, of course: Most Squid PRs take a lot longer to
review and fix. There are open source projects where PRs wait for a week
or more, so 24 hours for a full round (and usually just an hour or two
for the first signal!) would feel very fast for them. Etc.

Yes, 24 hours is not &quot;interactive&quot;, but it is acceptable for the vast
majority of PRs AFAICT, and you are providing dockers for those who want
to test in a more interactive mode.


&gt;<i>     I think you are proposing to make some tests optional. Which ones?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Not the tests, but the platforms.
</I>
&gt;<i>From my test results consumer point of view, they are
</I>[platform-specific] [build] tests.


&gt;<i> Things like gentoo, fedora rawhide, freebsd, openbsd.
</I>&gt;<i> Testing is slower there, so results will lag and we need to batch,
</I>&gt;<i> running a full test suite every week or so
</I>
OK, so you propose to make slow Jenkins platform-specific tests (i.e.
Jenkins tests on platforms where tests run slowly today) optional and
those platforms are gentoo, fedora rawhide, freebsd, openbsd. Got it!

What happens when such a slow test fails and the PR author ignores the
failure of that optional test and/or the PR is already closed? The
answer to that question is the key to evaluating any proposal that
declares any tests optional IMO...


&gt;<i>     FWIW, I do not think reducing the number of #ifdefs will solve our
</I>&gt;<i>     primary CI problems.
</I>

&gt;<i> Each test build is right now 4 full builds and test suites:
</I>&gt;<i> autodetected, minimal, maximum, everytthing-in-except-for-auth
</I>
And all of that takes less than 10 minutes on decent hardware which we
can rent or buy! To me, it feels like we are creating an unsolvable
problem here (i.e. testing a lot of things quickly on a raspberry Pi)
and then trying extra hard to solve that unsolvable problem. We should
either stop testing a lot of things or we should use appropriate
resources for testing a lot of things quickly.

Yes, we can reduce testing time by removing #ifdefs, but that is a lot
of work and does not really scale. #ifdefs should be removed primarily
for other reasons.


Cheers,

Alex.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009680.html">[squid-dev] Strategy about build farm nodes
</A></li>
	<LI>Next message (by thread): <A HREF="009682.html">[squid-dev] Compilling squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9681">[ date ]</a>
              <a href="thread.html#9681">[ thread ]</a>
              <a href="subject.html#9681">[ subject ]</a>
              <a href="author.html#9681">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
