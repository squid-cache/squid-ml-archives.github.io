<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] RFC submodule repositories
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20RFC%20submodule%20repositories&In-Reply-To=%3Cbe77cdd9-c270-14c2-f53c-e17d28096100%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009811.html">
   <LINK REL="Next"  HREF="009813.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] RFC submodule repositories</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20RFC%20submodule%20repositories&In-Reply-To=%3Cbe77cdd9-c270-14c2-f53c-e17d28096100%40measurement-factory.com%3E"
       TITLE="[squid-dev] RFC submodule repositories">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Aug  2 16:40:57 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009811.html">[squid-dev] RFC submodule repositories
</A></li>
        <LI>Next message (by thread): <A HREF="009813.html">[squid-dev] Fwd: [squid-users] Scaling concurrent TCP sessions beyond ephemeral port range
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9812">[ date ]</a>
              <a href="thread.html#9812">[ thread ]</a>
              <a href="subject.html#9812">[ subject ]</a>
              <a href="author.html#9812">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 8/1/22 22:32, Amos Jeffries wrote:
&gt;<i> On 1/08/22 03:09, Alex Rousskov wrote:
</I>&gt;&gt;<i> On 7/31/22 00:29, Amos Jeffries wrote:
</I>&gt;&gt;&gt;<i> When PR #937 merges we will have the ability to shuffle old helpers 
</I>&gt;&gt;&gt;<i> into a separate repository that users can import as a submodule to 
</I>&gt;&gt;&gt;<i> build with their Squid as-needed.
</I>
&gt;&gt;<i> What will we optimize by introducing such a significant
</I>&gt;&gt;<i> complication as git submodules?
</I>

&gt;<i> ( So every change to Squid has to be justified as an optimization now. 
</I>&gt;<i> Right... )
</I>
The verb &quot;optimize&quot; is generally defined as &quot;to make the best or most 
efficient use&quot;. In computing, that definition is relaxed to mean any 
improvement (not necessarily the &quot;best&quot;). Both definitions would work in 
this context, but I used &quot;optimize&quot; in the latter (&quot;to improve&quot;) sense. 
I hope we can all agree that Squid changes should improve Squid.


&gt;<i> We &quot;optimize&quot; future code maintenance workload with the ability to drop 
</I>&gt;<i> outdated helpers which are still required by a small group of users but 
</I>&gt;<i> no longer want to be actively developed by the core dev team.
</I>
N.B. Unless something else changes, simply moving &quot;dropped&quot; helper code 
to a submodule would require reviewing dropped helper update PRs in an 
aggregate &quot;take it or leave it&quot; mode. No dropped helper code change 
requests would be appropriate for such &quot;updated dropped helper H to 
version V&quot; pull requests. I do not know whether that will improve core 
developer lives, but it is likely to require making more judgement calls 
than we have to make today, and jusdgement calls can be especially 
controversial/painful.

How would moving &quot;dropped&quot; helper code to a submodule help core 
developers? AFAICT, just moving a dropped helper into a submodule 
creates more work for core developers because they now have one more 
thing to worry about. Git submodules (and git in general!) have very 
little impact on making &quot;./bootstrap.sh &amp;&amp; ./configure &amp;&amp; make &amp;&amp; sudo 
make install&quot; produce the desired outcome -- with or without submodules, 
we still need to make the whole thing build and work correctly. Thus, 
any improvements must be rooted in some other, yet unspecified Project 
changes besides moving some helper code into submodules. What other 
changes will make that extra core developer work worth it?

In other words, it is possible that the RFC associates &quot;git submodules&quot; 
with some unspecified changes outside the Squid git repository 
structure[1] that RFC readers cannot guess. Identifying any important 
changes the RFC associates with git submodules may help us make progress.

[1] For example, one common submodule use case is having different 
users/permissions for different parts of the Project -- essentially 
having multiple core developer teams with varying levels of access to 
critical Project resources, but all collaborating under one Project 
roof. It is often impractical to achieve that kind of access controls 
within one git/GitHub repository. I am not saying this example applies 
to this RFC -- I am just illustrating how submodules may facilitate 
important changes outside of low-level git mechanisms themselves.


&gt;<i> Case in point being CERN who still require our bundled LanManager 
</I>&gt;<i> helper(s) for some internal needs. That requires a lot of deprecated and 
</I>&gt;<i> rarely touched code being maintained for only one (albeit important) 
</I>&gt;<i> user case.
</I>&gt;<i>  &#160;That code could all be shuffled to a separate repository outside the 
</I>&gt;<i> official Squid release, but maintained by developers that support CERN 
</I>&gt;<i> needs.
</I>
Sure, but we clearly do not need git submodules to &quot;shuffle LanManager
helper(s) code to a separate repository&quot;. Why submodules? The RFC 
implies, without elaborating, that submodules are the right solution to 
some problem. Several RFC reviewers correctly point out that submodules 
are associated with significant &quot;cons&quot;. I am asking what the &quot;pros&quot; are. 
It is a very reasonable request IMO.

Agreeing on the _problem_ definition may also help shorten the number of 
iterations required to reach consensus. What do we really mean when we 
say that &quot;dropped&quot; helpers are &quot;not actively developed by core 
developers&quot;? To me, the lack of core developer involvement implies that 
PRs against Squid master may break &quot;dropped&quot; helpers and that &quot;dropped&quot; 
helper needs are assigned much lower weight compared to &quot;native&quot; Squid 
improvement needs, but others are likely to interpret that phrase 
differently.


&gt;&gt;&gt;<i> What (if any) updates do we need to make to Anubis and other 
</I>&gt;&gt;&gt;<i> infrastructure so support git submodules ?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> That answer probably depends, in part, on what support guarantees we 
</I>&gt;&gt;<i> are going to issue for those submodules and on what our submodule 
</I>&gt;&gt;<i> update policy will be.
</I>
&gt;<i> IMO we should maintain at least one helper officially as a submodule to 
</I>&gt;<i> ensure the git submodule mechanisms remain viable for distributors as a 
</I>&gt;<i> modern replacement for the old squid-2 way of building their custom 
</I>&gt;<i> helpers.
</I>
The above paragraph does not supply the information required for me to 
answer your original question. To make progress, let's temporary assume, 
for simplicity sake, that all &quot;dropped&quot; helpers are moved to &quot;officially 
maintained&quot; submodules. Now, will &quot;./bootstrap...make install&quot; sequence 
be allowed to ignore submodule existence? Ignore build failures related 
to submodules? Treat submodule code specially in some other way?

If the answer to those questions is &quot;no&quot;, then the automation/CI changes 
(that I can think of) would revolve around adding commands to fetch 
submodules before running that sequence (e.g., &quot;git submodules 
update...&quot;). Doing so should be easy in our current Semaphore CI. I am 
not sure about Jenkins.

Alex.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009811.html">[squid-dev] RFC submodule repositories
</A></li>
	<LI>Next message (by thread): <A HREF="009813.html">[squid-dev] Fwd: [squid-users] Scaling concurrent TCP sessions beyond ephemeral port range
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9812">[ date ]</a>
              <a href="thread.html#9812">[ thread ]</a>
              <a href="subject.html#9812">[ subject ]</a>
              <a href="author.html#9812">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
