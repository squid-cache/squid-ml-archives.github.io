<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] ERR_CONFLICT_HOST for HTTP CONNECT request on port 80
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20ERR_CONFLICT_HOST%20for%20HTTP%20CONNECT%20request%20on%20port%0A%2080&In-Reply-To=%3C86c96b0a-c7d6-64e8-1096-a133fd9107fb%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009773.html">
   <LINK REL="Next"  HREF="009772.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] ERR_CONFLICT_HOST for HTTP CONNECT request on port 80</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20ERR_CONFLICT_HOST%20for%20HTTP%20CONNECT%20request%20on%20port%0A%2080&In-Reply-To=%3C86c96b0a-c7d6-64e8-1096-a133fd9107fb%40measurement-factory.com%3E"
       TITLE="[squid-dev] ERR_CONFLICT_HOST for HTTP CONNECT request on port 80">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Mar  4 15:20:16 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009773.html">[squid-dev] ERR_CONFLICT_HOST for HTTP CONNECT request on port 80
</A></li>
        <LI>Next message (by thread): <A HREF="009772.html">[squid-dev] ERR_CONFLICT_HOST for HTTP CONNECT request on port 80
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9775">[ date ]</a>
              <a href="thread.html#9775">[ thread ]</a>
              <a href="subject.html#9775">[ subject ]</a>
              <a href="author.html#9775">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 3/4/22 03:25, YFone Ling wrote:

&gt;<i> I am here just try to understand how the squid determines host conflicts 
</I>&gt;<i> for a simple http connect proxy request?
</I>
The complete answer to your question is large/complicated and 
Squid-version dependent, but, AFAICT, there are no conflicts in the 
simple CONNECT request you have shared. Either the Squid in question is 
buggy or something else is going on (that is not visible in the output 
you have shared).

Are you absolutely sure the CONNECT request looks exactly like the one 
you have copy-pasted? How do you observe that CONNECT request?

Can you reproduce this exact problem using, say, &quot;nc&quot; or &quot;telnet&quot; as a 
proxy client (no TLS)?

Normally, proxies that accept CONNECT requests do not listen on or 
intercept port 80. Normally, CONNECT requests do not target port 80 
either. Are you sure you are supposed to send a CONNECT request to port 
80 and target an origin server port 80?


What do the WiFi providers tell you when you complain to _them_? Can 
they get you in touch with the technical people responsible for their 
Squids?

Alex.




&gt;<i> On Thu, Mar 3, 2022 at 6:28 PM Eliezer Croitoru &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">ngtech1ltd at gmail.com</A> 
</I>&gt;<i> &lt;mailto:<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">ngtech1ltd at gmail.com</A>&gt;&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i>     I am not sure if it&#8217;s for Squid-dev but anyway to clear out the
</I>&gt;<i>     doubts I would suggest attaching the squid.conf
</I>&gt;<i>     and remember to remove any sensitive data.____
</I>&gt;<i> 
</I>&gt;<i>     __ __
</I>&gt;<i> 
</I>&gt;<i>     Eliezer____
</I>&gt;<i> 
</I>&gt;<i>     __ __
</I>&gt;<i> 
</I>&gt;<i>     ----____
</I>&gt;<i> 
</I>&gt;<i>     Eliezer Croitoru____
</I>&gt;<i> 
</I>&gt;<i>     NgTech, Tech Support____
</I>&gt;<i> 
</I>&gt;<i>     Mobile: +972-5-28704261____
</I>&gt;<i> 
</I>&gt;<i>     Email: <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">ngtech1ltd at gmail.com</A> &lt;mailto:<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">ngtech1ltd at gmail.com</A>&gt;____
</I>&gt;<i> 
</I>&gt;<i>     __ __
</I>&gt;<i> 
</I>&gt;<i>     *From:* squid-dev &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev-bounces at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev-bounces at lists.squid-cache.org</A>&gt;&gt; *On Behalf Of
</I>&gt;<i>     *YFone Ling
</I>&gt;<i>     *Sent:* Thursday, March 3, 2022 22:55
</I>&gt;<i>     *To:* <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev at lists.squid-cache.org</A>&gt;
</I>&gt;<i>     *Subject:* [squid-dev] ERR_CONFLICT_HOST for HTTP CONNECT request on
</I>&gt;<i>     port 80____
</I>&gt;<i> 
</I>&gt;<i>     __ __
</I>&gt;<i> 
</I>&gt;<i>     My application sends&#160; HTTP CONNECT requests to a HTTP proxy port 80,
</I>&gt;<i>     but gets a squid&#160;ERR_CONFLICT_HOST error page.____
</I>&gt;<i> 
</I>&gt;<i>     __ __
</I>&gt;<i> 
</I>&gt;<i>     Is the following code really working as the comments pointed out
</I>&gt;<i>     &quot;ignore them&quot; since the following if condition is
</I>&gt;<i>     &quot;http-&gt;request-&gt;method != Http::METHOD_CONNECT&quot;____
</I>&gt;<i> 
</I>&gt;<i>     and the rest has been blocked by error page
</I>&gt;<i>     &quot;repContext-&gt;setReplyToError(ERR_CONFLICT_HOST, Http::scConflict,&quot;?____
</I>&gt;<i> 
</I>&gt;<i>     __ __
</I>&gt;<i> 
</I>&gt;<i>     Does &quot;ignore them&quot; mean block them? ____
</I>&gt;<i> 
</I>&gt;<i>     void____
</I>&gt;<i> 
</I>&gt;<i>     	
</I>&gt;<i> 
</I>&gt;<i>     ClientRequestContext::hostHeaderVerifyFailed(const char *A, const
</I>&gt;<i>     char *B)____
</I>&gt;<i> 
</I>&gt;<i>     	
</I>&gt;<i> 
</I>&gt;<i>     {____
</I>&gt;<i> 
</I>&gt;<i>     	
</I>&gt;<i> 
</I>&gt;<i>     // IP address validation for Host: failed. Admin wants to ignore
</I>&gt;<i>     them.____
</I>&gt;<i> 
</I>&gt;<i>     	
</I>&gt;<i> 
</I>&gt;<i>     // NP: we do not yet handle CONNECT tunnels well, so ignore for them____
</I>&gt;<i> 
</I>&gt;<i>     	
</I>&gt;<i> 
</I>&gt;<i>     if (!Config.onoff.hostStrictVerify &amp;&amp; http-&gt;request-&gt;method !=
</I>&gt;<i>     Http::METHOD_CONNECT) {____
</I>&gt;<i> 
</I>&gt;<i>     	
</I>&gt;<i> 
</I>&gt;<i>     debugs(85, 3, &quot;SECURITY ALERT: Host header forgery detected on &quot; &lt;&lt;
</I>&gt;<i>     http-&gt;getConn()-&gt;clientConnection &lt;&lt;____
</I>&gt;<i> 
</I>&gt;<i>     	
</I>&gt;<i> 
</I>&gt;<i>     &quot;(&quot; &lt;&lt; A &lt;&lt; &quot;does not match &quot; &lt;&lt; B &lt;&lt; &quot;) on URL: &quot; &lt;&lt;
</I>&gt;<i>     http-&gt;request-&gt;effectiveRequestUri());____
</I>&gt;<i> 
</I>&gt;<i>     	
</I>&gt;<i> 
</I>&gt;<i>     __ __
</I>&gt;<i> 
</I>&gt;<i>     __ __
</I>&gt;<i> 
</I>&gt;<i>     How does the squid get &quot;hostHeaderVerifyFailed&quot; for a normal HTTP
</I>&gt;<i>     CONNECT request to&#160;a HTTP Proxy as simple as below?____
</I>&gt;<i> 
</I>&gt;<i>     __ __
</I>&gt;<i> 
</I>&gt;<i>         CONNECT www.zscaler.com:80 &lt;<A HREF="http://www.zscaler.com:80">http://www.zscaler.com:80</A>&gt; HTTP/1.1____
</I>&gt;<i> 
</I>&gt;<i>         Host: www.zscaler.com:80 &lt;<A HREF="http://www.zscaler.com:80">http://www.zscaler.com:80</A>&gt;____
</I>&gt;<i> 
</I>&gt;<i>         User-Agent: Windows Microsoft Windows 10 Enterprise ZTunnel/1.0____
</I>&gt;<i> 
</I>&gt;<i>         Proxy-Connection: keep-alive____
</I>&gt;<i> 
</I>&gt;<i>         Connection: keep-alive____
</I>&gt;<i> 
</I>&gt;<i>     __ __
</I>&gt;<i> 
</I>&gt;<i>         HTTP/1.1 409 Conflict____
</I>&gt;<i> 
</I>&gt;<i>         Server: squid____
</I>&gt;<i> 
</I>&gt;<i>         Mime-Version: 1.0____
</I>&gt;<i> 
</I>&gt;<i>         Date: Tue, 22 Feb 2022 20:59:42 GMT____
</I>&gt;<i> 
</I>&gt;<i>         Content-Type: text/html;charset=utf-8____
</I>&gt;<i> 
</I>&gt;<i>         Content-Length: 2072____
</I>&gt;<i> 
</I>&gt;<i>         X-Squid-Error: ERR_CONFLICT_HOST 0____
</I>&gt;<i> 
</I>&gt;<i>         Vary: Accept-Language____
</I>&gt;<i> 
</I>&gt;<i>         Content-Language: en____
</I>&gt;<i> 
</I>&gt;<i>         X-Cache: MISS from 3____
</I>&gt;<i> 
</I>&gt;<i>         Via: 1.1 3 (squid)____
</I>&gt;<i> 
</I>&gt;<i>         Connection: keep-alive____
</I>&gt;<i> 
</I>&gt;<i>     __ __
</I>&gt;<i> 
</I>&gt;<i>         &lt;/head&gt;&lt;body id=ERR_CONFLICT_HOST&gt;____
</I>&gt;<i> 
</I>&gt;<i>         &lt;div id=&quot;titles&quot;&gt;____
</I>&gt;<i> 
</I>&gt;<i>         &lt;h1&gt;ERROR&lt;/h1&gt;____
</I>&gt;<i> 
</I>&gt;<i>         &lt;h2&gt;The requested URL could not be retrieved&lt;/h2&gt;____
</I>&gt;<i> 
</I>&gt;<i>         &lt;/div&gt;____
</I>&gt;<i> 
</I>&gt;<i>         &lt;hr&gt;____
</I>&gt;<i> 
</I>&gt;<i>     __ __
</I>&gt;<i> 
</I>&gt;<i>         &lt;div id=&quot;content&quot;&gt;____
</I>&gt;<i> 
</I>&gt;<i>         &lt;p&gt;The following error was encountered while trying to retrieve
</I>&gt;<i>         the URL: &lt;a href=&quot;www.zscaler.com:80
</I>&gt;<i>         &lt;<A HREF="http://www.zscaler.com:80">http://www.zscaler.com:80</A>&gt;&quot;&gt;www.zscaler.com:80
</I>&gt;<i>         &lt;<A HREF="http://www.zscaler.com:80">http://www.zscaler.com:80</A>&gt;&lt;/a&gt;&lt;/p&gt;____
</I>&gt;<i> 
</I>&gt;<i>         ......____
</I>&gt;<i> 
</I>&gt;<i>         __ __
</I>&gt;<i> 
</I>&gt;<i>         __ __
</I>&gt;<i> 
</I>&gt;<i>         __ __
</I>&gt;<i> 
</I>&gt;<i>     Thank you for any help on the understanding!____
</I>&gt;<i> 
</I>&gt;<i>     __ __
</I>&gt;<i> 
</I>&gt;<i>     Paul Ling____
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-dev mailing list
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">squid-dev at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">http://lists.squid-cache.org/listinfo/squid-dev</A>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009773.html">[squid-dev] ERR_CONFLICT_HOST for HTTP CONNECT request on port 80
</A></li>
	<LI>Next message (by thread): <A HREF="009772.html">[squid-dev] ERR_CONFLICT_HOST for HTTP CONNECT request on port 80
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9775">[ date ]</a>
              <a href="thread.html#9775">[ thread ]</a>
              <a href="subject.html#9775">[ subject ]</a>
              <a href="author.html#9775">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
