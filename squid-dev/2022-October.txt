From rousskov at measurement-factory.com  Wed Oct 19 14:25:54 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 19 Oct 2022 10:25:54 -0400
Subject: [squid-dev] RFC: Semaphore CI to GitHub Actions migration
Message-ID: <ddbc7328-183c-e236-40fb-fe4988c954cb@measurement-factory.com>

Hello,

     I plan to gradually turn Semaphore CI testing off and make GitHub 
Actions required. We should not babysit the same tests in two setups. 
Here is the current status of CI tests with regard to Semaphore and 
GitHub Actions together with the corresponding planned actions:

1. Functionality tests: Essentially the same set of tests. Semaphore CI 
has one extra/old test but it is disabled for master/v6 code. The 
proxy-collapsed-forwarding test often fails on Semaphore, requiring a 
manual restart of all tests. The busy-restart test usually fails on 
GitHub Actions, but those failures are currently ignored.

Plan: I will leave the busy-restart test running on Semaphore CI until 
we find a way to make it stable in GitHub Actions environment. I will 
turn off the other Semaphore CI functionality tests and make the GitHub 
Actions ones required.


2. Source maintenance tests: The same set of tests. GitHub Actions have 
the right Astyle version, so the formatting test actually works on 
GitHub (but its results are currently ignored on both platforms).

Plan: I will turn off Semaphore CI source maintenance tests and make the 
GitHub Actions ones required instead. Formatting test results will still 
be ignored (that is a separate decision/change/action out of this thread 
scope; let's not discuss it here).


3. Build tests: Semaphore CI uses Ubuntu 14.04. GitHub Actions uses 
Ubuntu 22.04. Semaphore CI has fewer build dependencies installed. 
GitHub Actions do not provide Ubuntu 14.04 runners[1].

Plan: I will keep Semaphore CI build tests and make the GitHub Actions 
tests required. When Semaphore CI build tests start failing (e.g., 
because dependency repositories stop working "as is"), or when we stop 
supporting that old environment, I will disable those tests.


If you have any objections or better ideas about gradually moving away 
from Semaphore CI, please discuss.


Thank you,

Alex.

[1]  GitHub provides Ubuntu 18.04 runners, but they are deprecated, will 
purposefully _fail_ according to GitHub schedule, and will be removed in 
December. We should not use them. Details at 
https://github.blog/changelog/2022-08-09-github-actions-the-ubuntu-18-04-actions-runner-image-is-being-deprecated-and-will-be-removed-by-12-1-22/

From gkinkie at gmail.com  Thu Oct 20 09:40:48 2022
From: gkinkie at gmail.com (Francesco Chemolli)
Date: Thu, 20 Oct 2022 10:40:48 +0100
Subject: [squid-dev] RFC: Semaphore CI to GitHub Actions migration
In-Reply-To: <ddbc7328-183c-e236-40fb-fe4988c954cb@measurement-factory.com>
References: <ddbc7328-183c-e236-40fb-fe4988c954cb@measurement-factory.com>
Message-ID: <CA+Y8hcOb5nN5sgTgHK+inXfsa9RBfpkOQhWqXDZdL2cM9C86iw@mail.gmail.com>

Hi Alex,
   this all sounds sensible to me and in general a good idea

On Wed, Oct 19, 2022 at 3:25 PM Alex Rousskov <
rousskov at measurement-factory.com> wrote:

> Hello,
>
>      I plan to gradually turn Semaphore CI testing off and make GitHub
> Actions required. We should not babysit the same tests in two setups.
> Here is the current status of CI tests with regard to Semaphore and
> GitHub Actions together with the corresponding planned actions:
>
> 1. Functionality tests: Essentially the same set of tests. Semaphore CI
> has one extra/old test but it is disabled for master/v6 code. The
> proxy-collapsed-forwarding test often fails on Semaphore, requiring a
> manual restart of all tests. The busy-restart test usually fails on
> GitHub Actions, but those failures are currently ignored.
>
> Plan: I will leave the busy-restart test running on Semaphore CI until
> we find a way to make it stable in GitHub Actions environment. I will
> turn off the other Semaphore CI functionality tests and make the GitHub
> Actions ones required.
>
>
> 2. Source maintenance tests: The same set of tests. GitHub Actions have
> the right Astyle version, so the formatting test actually works on
> GitHub (but its results are currently ignored on both platforms).
>
> Plan: I will turn off Semaphore CI source maintenance tests and make the
> GitHub Actions ones required instead. Formatting test results will still
> be ignored (that is a separate decision/change/action out of this thread
> scope; let's not discuss it here).
>
>
> 3. Build tests: Semaphore CI uses Ubuntu 14.04. GitHub Actions uses
> Ubuntu 22.04. Semaphore CI has fewer build dependencies installed.
> GitHub Actions do not provide Ubuntu 14.04 runners[1].
>
> Plan: I will keep Semaphore CI build tests and make the GitHub Actions
> tests required. When Semaphore CI build tests start failing (e.g.,
> because dependency repositories stop working "as is"), or when we stop
> supporting that old environment, I will disable those tests.
>
>
> If you have any objections or better ideas about gradually moving away
> from Semaphore CI, please discuss.
>
>
> Thank you,
>
> Alex.
>
> [1]  GitHub provides Ubuntu 18.04 runners, but they are deprecated, will
> purposefully _fail_ according to GitHub schedule, and will be removed in
> December. We should not use them. Details at
>
> https://github.blog/changelog/2022-08-09-github-actions-the-ubuntu-18-04-actions-runner-image-is-being-deprecated-and-will-be-removed-by-12-1-22/
> _______________________________________________
> squid-dev mailing list
> squid-dev at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-dev
>


-- 
    Francesco
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-dev/attachments/20221020/061e7fb0/attachment.htm>

From ngtech1ltd at gmail.com  Thu Oct 20 19:57:34 2022
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Thu, 20 Oct 2022 22:57:34 +0300
Subject: [squid-dev] RFC: Semaphore CI to GitHub Actions migration
In-Reply-To: <CA+Y8hcOb5nN5sgTgHK+inXfsa9RBfpkOQhWqXDZdL2cM9C86iw@mail.gmail.com>
References: <ddbc7328-183c-e236-40fb-fe4988c954cb@measurement-factory.com>
 <CA+Y8hcOb5nN5sgTgHK+inXfsa9RBfpkOQhWqXDZdL2cM9C86iw@mail.gmail.com>
Message-ID: <000701d8e4be$335fdfb0$9a1f9f10$@gmail.com>

Sounds good.
 
----
Eliezer Croitoru
NgTech, Tech Support
Mobile: +972-5-28704261
Email: ngtech1ltd at gmail.com <mailto:ngtech1ltd at gmail.com> 
Web: https://ngtech.co.il/
My-Tube: https://tube.ngtech.co.il/
 
From: squid-dev <squid-dev-bounces at lists.squid-cache.org> On Behalf Of Francesco Chemolli
Sent: Thursday, 20 October 2022 12:41
To: Alex Rousskov <rousskov at measurement-factory.com>
Cc: Squid Developers <squid-dev at lists.squid-cache.org>
Subject: Re: [squid-dev] RFC: Semaphore CI to GitHub Actions migration
 
Hi Alex,
   this all sounds sensible to me and in general a good idea
 
On Wed, Oct 19, 2022 at 3:25 PM Alex Rousskov <rousskov at measurement-factory.com <mailto:rousskov at measurement-factory.com> > wrote:
Hello,

     I plan to gradually turn Semaphore CI testing off and make GitHub 
Actions required. We should not babysit the same tests in two setups. 
Here is the current status of CI tests with regard to Semaphore and 
GitHub Actions together with the corresponding planned actions:

1. Functionality tests: Essentially the same set of tests. Semaphore CI 
has one extra/old test but it is disabled for master/v6 code. The 
proxy-collapsed-forwarding test often fails on Semaphore, requiring a 
manual restart of all tests. The busy-restart test usually fails on 
GitHub Actions, but those failures are currently ignored.

Plan: I will leave the busy-restart test running on Semaphore CI until 
we find a way to make it stable in GitHub Actions environment. I will 
turn off the other Semaphore CI functionality tests and make the GitHub 
Actions ones required.


2. Source maintenance tests: The same set of tests. GitHub Actions have 
the right Astyle version, so the formatting test actually works on 
GitHub (but its results are currently ignored on both platforms).

Plan: I will turn off Semaphore CI source maintenance tests and make the 
GitHub Actions ones required instead. Formatting test results will still 
be ignored (that is a separate decision/change/action out of this thread 
scope; let's not discuss it here).


3. Build tests: Semaphore CI uses Ubuntu 14.04. GitHub Actions uses 
Ubuntu 22.04. Semaphore CI has fewer build dependencies installed. 
GitHub Actions do not provide Ubuntu 14.04 runners[1].

Plan: I will keep Semaphore CI build tests and make the GitHub Actions 
tests required. When Semaphore CI build tests start failing (e.g., 
because dependency repositories stop working "as is"), or when we stop 
supporting that old environment, I will disable those tests.


If you have any objections or better ideas about gradually moving away 
from Semaphore CI, please discuss.


Thank you,

Alex.

[1]  GitHub provides Ubuntu 18.04 runners, but they are deprecated, will 
purposefully _fail_ according to GitHub schedule, and will be removed in 
December. We should not use them. Details at 
https://github.blog/changelog/2022-08-09-github-actions-the-ubuntu-18-04-actions-runner-image-is-being-deprecated-and-will-be-removed-by-12-1-22/
_______________________________________________
squid-dev mailing list
squid-dev at lists.squid-cache.org <mailto:squid-dev at lists.squid-cache.org> 
http://lists.squid-cache.org/listinfo/squid-dev


 
-- 
    Francesco
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-dev/attachments/20221020/ba4df269/attachment-0001.htm>

From squid3 at treenet.co.nz  Sat Oct 22 08:17:50 2022
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 22 Oct 2022 21:17:50 +1300
Subject: [squid-dev] RFC: Semaphore CI to GitHub Actions migration
In-Reply-To: <ddbc7328-183c-e236-40fb-fe4988c954cb@measurement-factory.com>
References: <ddbc7328-183c-e236-40fb-fe4988c954cb@measurement-factory.com>
Message-ID: <754113d4-fc6d-00b5-a385-0bc91e8d0d82@treenet.co.nz>

Sounds good for the most part.


On 20/10/22 03:25, Alex Rousskov wrote:
> Hello,
> 
>  ??? I plan to gradually turn Semaphore CI testing off and make GitHub 
> Actions required. We should not babysit the same tests in two setups. 
> Here is the current status of CI tests with regard to Semaphore and 
> GitHub Actions together with the corresponding planned actions:
> 
> 1. Functionality tests: Essentially the same set of tests. Semaphore CI 
> has one extra/old test but it is disabled for master/v6 code. The 
> proxy-collapsed-forwarding test often fails on Semaphore, requiring a 
> manual restart of all tests. The busy-restart test usually fails on 
> GitHub Actions, but those failures are currently ignored.
> 
> Plan: I will leave the busy-restart test running on Semaphore CI until 
> we find a way to make it stable in GitHub Actions environment. I will 
> turn off the other Semaphore CI functionality tests and make the GitHub 
> Actions ones required.
> 
> 
> 2. Source maintenance tests: The same set of tests. GitHub Actions have 
> the right Astyle version, so the formatting test actually works on 
> GitHub (but its results are currently ignored on both platforms).
> 
> Plan: I will turn off Semaphore CI source maintenance tests and make the 
> GitHub Actions ones required instead. Formatting test results will still 
> be ignored (that is a separate decision/change/action out of this thread 
> scope; let's not discuss it here).
> 
> 
> 3. Build tests: Semaphore CI uses Ubuntu 14.04. GitHub Actions uses 
> Ubuntu 22.04. Semaphore CI has fewer build dependencies installed. 
> GitHub Actions do not provide Ubuntu 14.04 runners[1].
> 
> Plan: I will keep Semaphore CI build tests and make the GitHub Actions 
> tests required. When Semaphore CI build tests start failing (e.g., 
> because dependency repositories stop working "as is"), or when we stop 
> supporting that old environment, I will disable those tests.
> 

FYI the "start failing" condition was met some time ago.

Ubuntu 14.04 provides GCC 4.8.6 which has a broken/incomplete STL 
prohibiting use of several important C++11 features (at least 
std::chrono, maybe also std::regex, and static analysis).

Previous discussions have focused on CentOS 7 which requires the GCC 
4.8.5 and has (had?) a more difficult upgrade path than Ubuntu.


HTH
Amos

From rousskov at measurement-factory.com  Mon Oct 24 18:27:32 2022
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 24 Oct 2022 14:27:32 -0400
Subject: [squid-dev] RFC: Semaphore CI to GitHub Actions migration
In-Reply-To: <754113d4-fc6d-00b5-a385-0bc91e8d0d82@treenet.co.nz>
References: <ddbc7328-183c-e236-40fb-fe4988c954cb@measurement-factory.com>
 <754113d4-fc6d-00b5-a385-0bc91e8d0d82@treenet.co.nz>
Message-ID: <7286c91f-6d64-6978-ae5f-6a2eab9b3e01@measurement-factory.com>

On 10/22/22 04:17, Amos Jeffries wrote:
> On 20/10/22 03:25, Alex Rousskov wrote: >> 3. Build tests: Semaphore CI uses Ubuntu 14.04. GitHub Actions uses
>> Ubuntu 22.04. Semaphore CI has fewer build dependencies installed. 
>> GitHub Actions do not provide Ubuntu 14.04 runners[1].
>>
>> Plan: I will keep Semaphore CI build tests and make the GitHub Actions 
>> tests required. When Semaphore CI build tests start failing (e.g., 
>> because dependency repositories stop working "as is"), or when we stop 
>> supporting that old environment, I will disable those tests.

> FYI the "start failing" condition was met some time ago.

I disagree: Sempahore CI build tests are clearly not failing now.


> Ubuntu 14.04 provides GCC 4.8.6 which has a broken/incomplete STL 
> prohibiting use of several important C++11 features (at least 
> std::chrono, maybe also std::regex, and static analysis).

Squid unconditionally uses std::chrono already. When we start using 
std::regex, we may need to stop using Sempahore CI build tests (if they 
are still running at that time and start failing due to std::regex 
addition), but that likely future is compatible with the above plan.


> Previous discussions have focused on CentOS 7 which requires the GCC 
> 4.8.5 and has (had?) a more difficult upgrade path than Ubuntu.

Sempahore CI build tests should not determine the set of language 
features Squid uses. They have ever determined that IMO. They certainly 
will not determine that going forward since we all agree that we can 
stop running them when they start failing (due to the age of Semaphore 
CI environment).


Cheers,

Alex.

From squid3 at treenet.co.nz  Sun Oct 30 10:42:17 2022
From: squid3 at treenet.co.nz (squid3 at treenet.co.nz)
Date: Sun, 30 Oct 2022 23:42:17 +1300
Subject: [squid-dev] RFC: Semaphore CI to GitHub Actions migration
In-Reply-To: <7286c91f-6d64-6978-ae5f-6a2eab9b3e01@measurement-factory.com>
References: <ddbc7328-183c-e236-40fb-fe4988c954cb@measurement-factory.com>
 <754113d4-fc6d-00b5-a385-0bc91e8d0d82@treenet.co.nz>
 <7286c91f-6d64-6978-ae5f-6a2eab9b3e01@measurement-factory.com>
Message-ID: <556b5ef3396b55839020cc9461ada3a5@treenet.co.nz>

On 2022-10-25 07:27, Alex Rousskov wrote:
> On 10/22/22 04:17, Amos Jeffries wrote:
>> On 20/10/22 03:25, Alex Rousskov wrote: >> 3. Build tests: Semaphore 
>> CI uses Ubuntu 14.04. GitHub Actions uses
>>> Ubuntu 22.04. Semaphore CI has fewer build dependencies installed. 
>>> GitHub Actions do not provide Ubuntu 14.04 runners[1].
>>> 
>>> Plan: I will keep Semaphore CI build tests and make the GitHub 
>>> Actions tests required. When Semaphore CI build tests start failing 
>>> (e.g., because dependency repositories stop working "as is"), or when 
>>> we stop supporting that old environment, I will disable those tests.
> 
>> FYI the "start failing" condition was met some time ago.
> 
> I disagree: Sempahore CI build tests are clearly not failing now.
> 

Only because final polish and merging of the PRs is blocked by the GCC 
support issue I mentioned.


Amos

