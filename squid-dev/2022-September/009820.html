<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Proposal: switch to always-build for some currently optional features
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Proposal%3A%20switch%20to%20always-build%20for%20some%20currently%0A%20optional%20features&In-Reply-To=%3C83db8714-7670-78bd-d411-406ab0ad9197%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009819.html">
   <LINK REL="Next"  HREF="009821.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Proposal: switch to always-build for some currently optional features</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Proposal%3A%20switch%20to%20always-build%20for%20some%20currently%0A%20optional%20features&In-Reply-To=%3C83db8714-7670-78bd-d411-406ab0ad9197%40measurement-factory.com%3E"
       TITLE="[squid-dev] Proposal: switch to always-build for some currently optional features">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Sep 19 21:39:25 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009819.html">[squid-dev] Proposal: switch to always-build for some currently optional features
</A></li>
        <LI>Next message (by thread): <A HREF="009821.html">[squid-dev] Proposal: switch to always-build for some currently optional features
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9820">[ date ]</a>
              <a href="thread.html#9820">[ thread ]</a>
              <a href="subject.html#9820">[ subject ]</a>
              <a href="author.html#9820">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 9/19/22 09:28, Francesco Chemolli wrote:

&gt;<i> there is a bunch of features that are currently gated at compile 
</I>&gt;<i> time: among others, I see:
</I>
&gt;<i> - adaptation (icap, ecap)
</I>&gt;<i> - authentication
</I>&gt;<i> - ident
</I>&gt;<i> - delay pools
</I>&gt;<i> - cache digests
</I>&gt;<i> - htcp
</I>&gt;<i> - cache digests
</I>&gt;<i> - wccp
</I>&gt;<i> - unlinkd
</I>&gt;<i> 
</I>&gt;<i> I'd like to propose that we switch to always-build them.
</I>
&gt;<i> We would gain:
</I>
&gt;<i> - code clarity
</I> &gt; - ease of development

The above two items do not fully apply to features that depend on 
external libraries (which may be absent): eCAP, some authentication 
modules, and possibly others. Their code and related development 
overheads will remain largely unchanged. I suspect that you actually did 
not want to include optional modules with external dependencies in your 
proposal, but please clarify.


&gt;<i> - test coverage
</I>
To be more precise, we would gain reduction of feature _combinations_ 
that should be tested (which is a significant gain!). Basic code 
coverage by tests would remain unchanged because nearly any test can 
enable (and test) all features that can be built.


&gt;<i> - feature uniformity across builds
</I>
Yes, fewer features that can be enabled/disabled at build time helps 
with support.


&gt;<i> We would lose:
</I>&gt;<i> - slightly longer build time
</I>&gt;<i> - larger binaries
</I>
And:

- Larger attack surface if we always build modules like ESI. This can be 
partially mitigated by making sure we default-disable them. This is one 
of the reasons for the precondition at the end of my email.

- Some loss of performance. For example, the cache digests module, when 
enabled, builds cache digests by default (from squid.conf point of 
view). Similarly, ESI parses applicable content. There are probably also 
non-trivial slow ACL-driven checks that a module may bring in by default 
(from squid.conf point of view) if enabled.


&gt;<i> Opinions?
</I>
I agree that modules that can always be built, should be. Such modules 
should have no guarding #ifdefs. I think this is the set of modules that 
your proposal is targeting, but please correct me if I am wrong. FWIW, 
this design stems from an even more general/fundamental rule of thumb: 
Do not add unnecessary #ifdefs.

However, there is a precondition: Any always-built optional feature with 
a potentially significant performance impact or a controversial side 
effect should be disabled by default (via squid.conf). Satisfying this 
precondition will require code changes.


Cheers,

Alex.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009819.html">[squid-dev] Proposal: switch to always-build for some currently optional features
</A></li>
	<LI>Next message (by thread): <A HREF="009821.html">[squid-dev] Proposal: switch to always-build for some currently optional features
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9820">[ date ]</a>
              <a href="thread.html#9820">[ thread ]</a>
              <a href="subject.html#9820">[ subject ]</a>
              <a href="author.html#9820">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
