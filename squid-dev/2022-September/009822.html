<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Proposal: switch to always-build for some currently optional features
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Proposal%3A%20switch%20to%20always-build%20for%20some%20currently%0A%20optional%20features&In-Reply-To=%3C59943cbe-e86a-12df-0eb2-ec4e44996fab%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009821.html">
   <LINK REL="Next"  HREF="009823.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Proposal: switch to always-build for some currently optional features</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Proposal%3A%20switch%20to%20always-build%20for%20some%20currently%0A%20optional%20features&In-Reply-To=%3C59943cbe-e86a-12df-0eb2-ec4e44996fab%40measurement-factory.com%3E"
       TITLE="[squid-dev] Proposal: switch to always-build for some currently optional features">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Sep 20 13:56:59 UTC 2022</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009821.html">[squid-dev] Proposal: switch to always-build for some currently optional features
</A></li>
        <LI>Next message (by thread): <A HREF="009823.html">[squid-dev] Proposal: switch to always-build for some currently optional features
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9822">[ date ]</a>
              <a href="thread.html#9822">[ thread ]</a>
              <a href="subject.html#9822">[ subject ]</a>
              <a href="author.html#9822">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 9/20/22 02:34, Francesco Chemolli wrote:
&gt;<i> 
</I>&gt;<i>     I agree that modules that can always be built, should be. Such modules
</I>&gt;<i>     should have no guarding #ifdefs. I think this is the set of modules
</I>&gt;<i>     that
</I>&gt;<i>     your proposal is targeting, but please correct me if I am wrong. FWIW,
</I>&gt;<i>     this design stems from an even more general/fundamental rule of thumb:
</I>&gt;<i>     Do not add unnecessary #ifdefs.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I agree. We could also work on better isolation, by restricting 
</I>&gt;<i> #ifdef-guarded areas
</I>&gt;<i> to specific delegate classes, and then using c++ features&#160;(e.g. if 
</I>&gt;<i> constexpr, eventually) to
</I>&gt;<i> disable the callsites.
</I>
Yes, of course, but I would start with modules/features that require no 
significant refactoring. I am not sure what the best candidates are, but 
I would evaluate ident, cache digests, htcp, and wccp first (these are 
from your own list of candidates).

For example, a feature like unlinkd (also on your list) would require 
adding a default-disabled configuration option (unlinkd_enable, similar 
to pinger_enable) or introducing support for a special program location 
spelling like &quot;none&quot;. Adding either would break existing configurations 
that willingly run unlinkd. There are probably a few features/modules 
that do _not_ require such disruptive configuration changes. I would 
start with those.


&gt;<i>     However, there is a precondition: Any always-built optional feature
</I>&gt;<i>     with
</I>&gt;<i>     a potentially significant performance impact or a controversial side
</I>&gt;<i>     effect should be disabled by default (via squid.conf). Satisfying this
</I>&gt;<i>     precondition will require code changes.
</I>
&gt;<i> Yes, I agree.
</I>
Glad we are on the same page!

I recommend giving Amos more time to leave feedback before spending time 
on code changes, but if we are all in agreement, then I am looking 
forward to PRs reducing the number of unnecessary #ifdefs. To minimize 
overheads, please use one PR per module/feature and avoid opening 
multiple concurrent PRs (at least until it is clear that we are on the 
same page regarding the overall approach to the corresponding code 
modifications).


Thank you,

Alex.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009821.html">[squid-dev] Proposal: switch to always-build for some currently optional features
</A></li>
	<LI>Next message (by thread): <A HREF="009823.html">[squid-dev] Proposal: switch to always-build for some currently optional features
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9822">[ date ]</a>
              <a href="thread.html#9822">[ thread ]</a>
              <a href="subject.html#9822">[ subject ]</a>
              <a href="author.html#9822">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
