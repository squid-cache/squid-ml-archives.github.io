From rousskov at measurement-factory.com  Sat Apr  1 21:09:27 2023
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sat, 1 Apr 2023 17:09:27 -0400
Subject: [squid-dev] Latest Clang build errors
In-Reply-To: <d8dce2b3-dcd2-5f11-f65c-24961b329e25@treenet.co.nz>
References: <d8dce2b3-dcd2-5f11-f65c-24961b329e25@treenet.co.nz>
Message-ID: <52a87c91-422e-9993-fce1-cdcbf2876c22@measurement-factory.com>

On 3/28/23 09:27, Amos Jeffries wrote:
> Alex, since the whole IPC and SHM system is your design are you able to 
> work on fixing the FlexibleArray build errors we are now getting with 
> clang v15.

> [1] Log excerpt from Jenkins:
...
> 01:00:06 ../../../../src/ipc/mem/FlexibleArray.h:34:52: error: array subscript -1 is below array bounds of 'int [1]' [-Werror=array-bounds=] 
...> 01:00:06 make[4]: Leaving directory
> '/srv/jenkins/workspace/5-pr-test/COMPILER/gcc/OS/fedora-rawhide/label/docker-build-host/btlayer-02-maximus/squid-7.0.0-VCS/_build/sub/src/fs'


AFAICT, the above log is not from a clang build; it is from a GCC build. 
FWIW, I could not find matching clang errors in Jenkins.

With GCC, I can reproduce the -Warray-bounds problem using 
squidcache/buildfarm-fedora-rawhide:latest docker. Thank you, Francesco 
for publishing those! PR 1318 has the proposed fix:
https://github.com/squid-cache/squid/pull/1318


BTW, since GCC v13 has other bugs and has not been officially "released" 
yet, I suggest removing that compiler from the set of required tests 
until it matures enough for us to support it efficiently.


HTH,

Alex.


From gkinkie at gmail.com  Sun Apr  2 07:30:14 2023
From: gkinkie at gmail.com (Francesco Chemolli)
Date: Sun, 2 Apr 2023 08:30:14 +0100
Subject: [squid-dev] Latest Clang build errors
In-Reply-To: <52a87c91-422e-9993-fce1-cdcbf2876c22@measurement-factory.com>
References: <d8dce2b3-dcd2-5f11-f65c-24961b329e25@treenet.co.nz>
 <52a87c91-422e-9993-fce1-cdcbf2876c22@measurement-factory.com>
Message-ID: <CA+Y8hcMzYwuykXy7+sSfobukRuRVR3dohAJEJM=7rMWpcy9BzA@mail.gmail.com>

>
>
> BTW, since GCC v13 has other bugs and has not been officially "released"
> yet, I suggest removing that compiler from the set of required tests
> until it matures enough for us to support it efficiently.
>

That's what Fedora Rawhide ships as default compiler.
We can only do that by stopping to target rawhide for our tests; we can do
that of course but I'd like to get more feedback before doing so.

-- 
    Francesco
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-dev/attachments/20230402/58ee9a38/attachment.htm>

From rousskov at measurement-factory.com  Sun Apr  2 23:30:39 2023
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sun, 2 Apr 2023 19:30:39 -0400
Subject: [squid-dev] Latest Clang build errors
In-Reply-To: <CA+Y8hcMzYwuykXy7+sSfobukRuRVR3dohAJEJM=7rMWpcy9BzA@mail.gmail.com>
References: <d8dce2b3-dcd2-5f11-f65c-24961b329e25@treenet.co.nz>
 <52a87c91-422e-9993-fce1-cdcbf2876c22@measurement-factory.com>
 <CA+Y8hcMzYwuykXy7+sSfobukRuRVR3dohAJEJM=7rMWpcy9BzA@mail.gmail.com>
Message-ID: <e285884c-f593-ee70-b216-d3f11684a4ae@measurement-factory.com>

On 4/2/23 03:30, Francesco Chemolli wrote:
> 
>     BTW, since GCC v13 has other bugs and has not been officially
>     "released"
>     yet, I suggest removing that compiler from the set of required tests
>     until it matures enough for us to support it efficiently.
> 
> 
> That's what Fedora Rawhide ships as default compiler.
> We can only do that by stopping to target rawhide?for our tests;

I disagree that it is the only alternative. For _example_, if somebody 
wants to spend time on future GCC v13 release compatibility, we can run 
_optional_ Jenkins tests with GCC v13 on Rawhide (of the master branch 
or even PR branches) that they will monitor and post Squid bug fixing 
PRs as needed.

As far as Project policy is concerned, given our scarce resources, I 
think it is best to exclude development compiler versions from the 
official support scope. Doing so does not stop anybody from testing with 
those compilers (even using Project's Jenkins setup) and submitting 
Squid improvements.


> I'd like to get more feedback before doing so.

Good luck,

Alex.


From gkinkie at gmail.com  Mon Apr 10 15:47:11 2023
From: gkinkie at gmail.com (Francesco Chemolli)
Date: Mon, 10 Apr 2023 17:47:11 +0200
Subject: [squid-dev] Opensuse tumblweed woes
Message-ID: <CA+Y8hcOWrJVRgYhH4AgbohsHPLSB+vATCpMndP_Xv4Psp+SMeg@mail.gmail.com>

Hi all,
  I'm disabling opensuse tumbleweed from all our test build jobs; in their
current setup all builds are failing with an error in the linker for
undefined references to just about everything (see
https://build.squid-cache.org/job/trunk-amd64-matrix/COMPILER=gcc,CPU=amd64,OS=opensuse-tumbleweed,force_on_docker_arm64=docker-build-host-lowpri/438/console)
.
I've tried figuring out what's wrong but failed miserably.

If anyone has managed to get a full build on OpenSUSE tumbleweed recently -
or will manage to in the future - please get in touch with me so that I can
adopt their solution. Thanks!

-- 
    Francesco
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-dev/attachments/20230410/2ecd69c8/attachment.htm>

From kinkie at squid-cache.org  Tue Apr 11 19:52:04 2023
From: kinkie at squid-cache.org (Francesco Chemolli)
Date: Tue, 11 Apr 2023 21:52:04 +0200
Subject: [squid-dev] CI: trunk is stable again
Message-ID: <CA+Y8hcOB-JUxe50mVyMhcc3kbCKsHTjmPVDS5g-3x14JMeHxYQ@mail.gmail.com>

Hi all,
   trunk build tests can now be relied upon again for correctness checks.
We can set them up again as required for merging PRs

-- 
    Francesco Chemolli
    Squid Software Foundation
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-dev/attachments/20230411/ee98dca9/attachment.htm>

From rousskov at measurement-factory.com  Tue Apr 11 20:07:31 2023
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 11 Apr 2023 16:07:31 -0400
Subject: [squid-dev] CI: trunk is stable again
In-Reply-To: <CA+Y8hcOB-JUxe50mVyMhcc3kbCKsHTjmPVDS5g-3x14JMeHxYQ@mail.gmail.com>
References: <CA+Y8hcOB-JUxe50mVyMhcc3kbCKsHTjmPVDS5g-3x14JMeHxYQ@mail.gmail.com>
Message-ID: <92474e54-e937-8e9a-295a-e8add5595a08@measurement-factory.com>

On 4/11/23 15:52, Francesco Chemolli wrote:

> trunk build tests can now be relied upon again for correctness checks.
> We can set them up again as required for merging PRs

Done. PRs based on earlier/broken master snapshots will need to be 
updated to pass these now-required checks, of course.

Thanks a lot for fixing Jenkins tests!

Alex.


