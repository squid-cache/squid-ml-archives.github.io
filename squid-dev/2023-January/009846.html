<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Drop cache_object protocol support
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Drop%20cache_object%20protocol%20support&In-Reply-To=%3C3ff36659-8269-de2e-de89-2ffadf105e0f%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009845.html">
   <LINK REL="Next"  HREF="009847.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Drop cache_object protocol support</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Drop%20cache_object%20protocol%20support&In-Reply-To=%3C3ff36659-8269-de2e-de89-2ffadf105e0f%40treenet.co.nz%3E"
       TITLE="[squid-dev] Drop cache_object protocol support">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Jan 25 01:57:33 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009845.html">[squid-dev] Drop cache_object protocol support
</A></li>
        <LI>Next message (by thread): <A HREF="009847.html">[squid-dev] Drop cache_object protocol support
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9846">[ date ]</a>
              <a href="thread.html#9846">[ thread ]</a>
              <a href="subject.html#9846">[ subject ]</a>
              <a href="author.html#9846">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 25/01/2023 8:23 am, Alex Rousskov wrote:
&gt;<i> On 1/24/23 12:22, Eduard Bagdasaryan wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Today we can query cache manager in two ways:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 1. with cache_<A HREF="object://">object://</A> URL scheme
</I>&gt;&gt;<i> 2. with an HTTP request having the 'squid-internal-mgr' path prefix.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I guess that when (2) was initially added at e37bd29, its 
</I>&gt;&gt;<i> implementation was somewhat incomplete compared to the old 
</I>&gt;&gt;<i> cache_object scheme (e.g., it lacked authentication
</I>
No and intentionally. It is designed to share the proxy HTTP 
authentication and http_access policy instead of the obsolete userinfo@ 
standard that cache_object uses.

Blocker #1:&#160; The cachemgr_passwd directly still needs to be cleanly 
removed, eg replaced by a manager_access ACL based mechanism.


&gt;&gt;<i> ) and both methods existed. Since then, however, (2) has been 
</I>&gt;&gt;<i> improved and it should be equivalent to (1) by now.&#160; If so, can we 
</I>&gt;&gt;<i> completely remove the non-standard cache_object scheme support from 
</I>&gt;&gt;<i> Squid? This would simplify request forwarding logic, including code 
</I>&gt;&gt;<i> paths where the existing code complexity may result in vulnerability 
</I>&gt;&gt;<i> issues.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> FWIW, I am not aware of any good reason to keep supporting the 
</I>&gt;<i> &quot;cache_object&quot; URI scheme.
</I>&gt;<i>
</I>
Blocker #2: The squidclient tool still sends cache_object: scheme when 
given &quot;mgr:&quot; on the CLI. We need to upgrade that first and allow admin 
some time to upgrade before removing the scheme support in squid itself.


&gt;<i> MgrFieldChars() already calls that scheme deprecated. That special 
</I>&gt;<i> (and undocumented?) scheme did cause significant problems in the past. 
</I>&gt;<i> I am sure it will continue to cause problems if not removed. Removing 
</I>&gt;<i> it will simplify code in several tricky places. There will be some 
</I>&gt;<i> upgrade pains for admins, but we will be better off without 
</I>&gt;<i> cache_object long-term IMO.
</I>
Agreed.

&gt;<i> Needless to say, squidclient and cachemgr.cgi implementations would 
</I>&gt;<i> need to be adjusted to use HTTP URLs instead, but I hope those 
</I>&gt;<i> adjustments are straightforward.
</I>
cachemgr.cgi should already prefer http(s) and only use cache_object as 
a backup.

IMO the CGI tool should stay that way, supporting the scheme for older 
installations even after we drop it from the rest of Squid.

HTH
Amos

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009845.html">[squid-dev] Drop cache_object protocol support
</A></li>
	<LI>Next message (by thread): <A HREF="009847.html">[squid-dev] Drop cache_object protocol support
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9846">[ date ]</a>
              <a href="thread.html#9846">[ thread ]</a>
              <a href="subject.html#9846">[ subject ]</a>
              <a href="author.html#9846">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
