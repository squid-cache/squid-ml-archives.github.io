<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Drop cache_object protocol support
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Drop%20cache_object%20protocol%20support&In-Reply-To=%3C642b9a31-821c-ab67-c77b-41d880ca96f1%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009847.html">
   <LINK REL="Next"  HREF="009849.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Drop cache_object protocol support</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Drop%20cache_object%20protocol%20support&In-Reply-To=%3C642b9a31-821c-ab67-c77b-41d880ca96f1%40treenet.co.nz%3E"
       TITLE="[squid-dev] Drop cache_object protocol support">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Jan 25 12:29:18 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009847.html">[squid-dev] Drop cache_object protocol support
</A></li>
        <LI>Next message (by thread): <A HREF="009849.html">[squid-dev] Drop cache_object protocol support
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9848">[ date ]</a>
              <a href="thread.html#9848">[ thread ]</a>
              <a href="subject.html#9848">[ subject ]</a>
              <a href="author.html#9848">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 25/01/2023 5:34 pm, Alex Rousskov wrote:
&gt;<i> On 1/24/23 20:57, Amos Jeffries wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Blocker #1:&#160; The cachemgr_passwd directly still needs to be cleanly 
</I>&gt;&gt;<i> removed, eg replaced by a manager_access ACL based mechanism.
</I>&gt;<i>
</I>&gt;<i> I do not see a relationship: I have not tested it, but the existing 
</I>&gt;<i> CacheManager::ParseHeaders() code already extracts authentication 
</I>&gt;<i> information from cache manager requests that use &quot;http&quot; scheme AFAICT. 
</I>&gt;<i> Can you detail why the cachemgr_passwd directive/code cannot continue 
</I>&gt;<i> to work essentially as it works today after cache_object scheme 
</I>&gt;<i> support is removed from Squid?
</I>
We should check that then. It may not be as impactful as I am recalling.


&gt;<i>
</I>&gt;&gt;<i> Blocker #2: The squidclient tool still sends cache_object: scheme 
</I>&gt;&gt;<i> when given &quot;mgr:&quot; on the CLI. We need to upgrade that first 
</I>&gt;<i>
</I>&gt;<i> Looks like we are in agreement on that.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> and allow admin some time to upgrade before removing the scheme 
</I>&gt;&gt;<i> support in squid itself.
</I>&gt;<i>
</I>&gt;<i> Agreed. Would six months be enough in your opinion? If yes, we may be 
</I>&gt;<i> able to remove cache_object support in v6. Otherwise, we can remove 
</I>&gt;<i> cache_object support starting with v7 (as far as numbered releases are 
</I>&gt;<i> concerned).
</I>
v6 will &quot;feature freeze&quot; in 10 days. That 6 months beta period is for 
proving the v6 behaviour changes work properly. Not for adding new 
behaviour, especially any cause of admin annoyance.
IMO what we have been discussing is far enough into new feature 
territory to be a &quot;no&quot; for v6 backport. Specific patches may get a 
different answer, but the whole change is unlikely.

Early in v7 cycle should be good.


&gt;<i>
</I>&gt;&gt;<i> cachemgr.cgi should already prefer http(s) and only use cache_object 
</I>&gt;&gt;<i> as a backup.
</I>&gt;<i>
</I>&gt;&gt;<i> IMO the CGI tool should stay that way, supporting the scheme for 
</I>&gt;&gt;<i> older installations even after we drop it from the rest of Squid.
</I>&gt;<i>
</I>&gt;<i> IMO, we should not keep any code that is only needed for Squid v3.1 
</I>&gt;<i> and earlier. Squid v3.2 and later should http-based cache manager 
</I>&gt;<i> access, right? More code always means more maintenance overheads and 
</I>&gt;<i> higher change costs. Given our lack of resources, we should start 
</I>&gt;<i> ignoring Squid v3 needs.
</I>
In sentiment I agree. In practicality we have to cope with &quot;LTS&quot; from 
vendors, and Squid bugs in the manager.

v3.2 has http: but the https:, ftp:, whois:, gopher: schemes were broken 
until late in the v3.5 series backports.
So going by [1] LTS systems still using v3.2 are still a pain.

For completeness, that MGR_INDEX regression you fixed a short while ago 
also means some broken v4/v5 releases may be a pain source during the 
transition.

The longer we wait on removal from the CGI and CLI tools (only) the more 
seamless it goes. So I am inclined to be very conservative on the tools 
capability removal and proactive on ensuring they can cope with the 
squid capability loss.
I would schedule the squid binary cleanup for v7 and the admin tools for 
v8 at earliest (4 years of v3.2 LTS pain).


&gt;<i> Moreover, I do not see how we can keep that &quot;backup&quot; code while 
</I>&gt;<i> supporting newer Squids and Javascript-disabled browsers at the same 
</I>&gt;<i> time: AFAICT, when Javascript is disabled (or not working properly), 
</I>&gt;<i> that &quot;only as a backup&quot; code will send cache_object requests to modern 
</I>&gt;<i> Squids that will no longer support them...
</I>
That would be a serious bug. It breaks admin ability to manage proxies 
newer than their web server installation - which is more likely to be 
running outdated LTS than the proxy servers.


&gt;<i> I think we should upgrade that cachemgr.cgi code rather than preserve 
</I>&gt;<i> it for Squid v3 needs. However, if you insist, it will stay simply 
</I>&gt;<i> because I do not think cachemgr.cgi is worth our time.
</I>&gt;<i>
</I>

[1] My records of what vendors are providing as of Nov 2022 indicate that:
 &#160;* v5, v4, and v3.5 are currently being shipped in new installs.
 &#160;* v3.4 and v3.2 are still in popular 5-10 year old machinery due to 
vendor LTS.
 &#160;* other Squid versions were effectively non-existent.


HTH
Amos

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009847.html">[squid-dev] Drop cache_object protocol support
</A></li>
	<LI>Next message (by thread): <A HREF="009849.html">[squid-dev] Drop cache_object protocol support
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9848">[ date ]</a>
              <a href="thread.html#9848">[ thread ]</a>
              <a href="subject.html#9848">[ subject ]</a>
              <a href="author.html#9848">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
