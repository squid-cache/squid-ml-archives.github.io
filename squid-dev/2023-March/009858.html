<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] RFC: policy change for header #includes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20RFC%3A%20policy%20change%20for%20header%20%23includes&In-Reply-To=%3C9f755242-6254-1541-d888-ab8c3b628ed7%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009861.html">
   <LINK REL="Next"  HREF="009859.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] RFC: policy change for header #includes</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20RFC%3A%20policy%20change%20for%20header%20%23includes&In-Reply-To=%3C9f755242-6254-1541-d888-ab8c3b628ed7%40measurement-factory.com%3E"
       TITLE="[squid-dev] RFC: policy change for header #includes">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Mar  7 15:49:35 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009861.html">[squid-dev] RFC: policy change for header #includes
</A></li>
        <LI>Next message (by thread): <A HREF="009859.html">[squid-dev] acl dst ipv6 doesnot matches all IPv6 addresses
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9858">[ date ]</a>
              <a href="thread.html#9858">[ thread ]</a>
              <a href="subject.html#9858">[ subject ]</a>
              <a href="author.html#9858">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 3/7/23 00:38, Amos Jeffries wrote:
&gt;<i> 
</I>&gt;<i> Current Policy 
</I>&gt;<i> <A HREF="https://wiki.squid-cache.org/DeveloperResources/SquidCodingGuidelines#file-include-guidelines:">https://wiki.squid-cache.org/DeveloperResources/SquidCodingGuidelines#file-include-guidelines:</A>
</I>&gt;<i>  &#160;4. system C headers (with a .h suffix):
</I>&gt;<i>  &#160; &#160; * mandatory HAVE_FOO_H wrapper
</I>

&gt;<i> I propose using the C++17 &quot;__has_include(&lt;foo.h&gt;)&quot; instead of HAVE_FOO_H 
</I>&gt;<i> whenever we can. Which is:
</I>&gt;<i>  &#160;* all .cc and .cci files
</I>&gt;<i>  &#160;* any .h files in the src/ and tools/ areas
</I>

We should not use __has_include() instead of HAVE_FOO_H for most system 
include files because HAVE_FOO_H essentially means &quot;can compile&quot; while 
__has_include() means &quot;exists&quot;. Essentially, __has_include() has the 
same problems that old AC_CHECK_HEADER and AC_CHECK_HEADERS macros had, 
before Autoconf changed them to check whether the header is not just 
present but can be compiled. We should not go back to unreliable 
existence checks IMO!

The semantic difference detailed above is sufficient to avoid the 
proposed change IMO, but I can also mention another significant problem: 
The increased difficulty in deciding when to use __has_include() and 
when HAVE_FOO_H. We already suffer from this problem (a little) in some 
special &quot;Do not use HAVE_X_H for x.h!&quot; cases, but unreliable 
environment-dependent __has_include() checks are likely to make it 
significantly worse IMO.

If we should not use __has_include() instead of HAVE_FOO_H for _most_ 
include files, then we should not use it at all: Code consistency and 
less bickering during reviews are worth the extra ./configure 
changes/time IMO, especially since we do not add new system headers that 
often.


HTH,

Alex.
P.S. To save time, I am not detailing my partial disagreement with the 
pros/cons statements quoted below.


&gt;<i> Pros:
</I>&gt;<i>  &#160;* less configure.ac logic, smaller build logs
</I>&gt;<i>  &#160;* removes need to do a full bootstrap + re-configure when a 
</I>&gt;<i> third-party library or system header is added/remove/changed
</I>&gt;<i>  &#160;* conversion can be semi-scripted
</I>&gt;<i> 
</I>&gt;<i> Cons AFAIK are all about how it cannot be a blanket requirement like 
</I>&gt;<i> HAVE_FOO_H is:
</I>&gt;<i>  &#160;* sometimes headers need to be forbidden include by ./configure logic 
</I>&gt;<i> checks
</I>&gt;<i>  &#160;* C language does not support the __has_include
</I>

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009861.html">[squid-dev] RFC: policy change for header #includes
</A></li>
	<LI>Next message (by thread): <A HREF="009859.html">[squid-dev] acl dst ipv6 doesnot matches all IPv6 addresses
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9858">[ date ]</a>
              <a href="thread.html#9858">[ thread ]</a>
              <a href="subject.html#9858">[ subject ]</a>
              <a href="author.html#9858">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
