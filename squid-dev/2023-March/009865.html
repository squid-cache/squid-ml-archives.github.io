<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Latest Clang build errors
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Latest%20Clang%20build%20errors&In-Reply-To=%3Cd8dce2b3-dcd2-5f11-f65c-24961b329e25%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009863.html">
   <LINK REL="Next"  HREF="009866.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Latest Clang build errors</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Latest%20Clang%20build%20errors&In-Reply-To=%3Cd8dce2b3-dcd2-5f11-f65c-24961b329e25%40treenet.co.nz%3E"
       TITLE="[squid-dev] Latest Clang build errors">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Mar 28 13:27:25 UTC 2023</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009863.html">[squid-dev] 6.0.2 release update
</A></li>
        <LI>Next message (by thread): <A HREF="009866.html">[squid-dev] Latest Clang build errors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9865">[ date ]</a>
              <a href="thread.html#9865">[ thread ]</a>
              <a href="subject.html#9865">[ subject ]</a>
              <a href="author.html#9865">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Alex, since the whole IPC and SHM system is your design are you able to 
work on fixing the FlexibleArray build errors we are now getting with 
clang v15.

IIRC FlexibleArray was a placeholder for std::dynarray, which is now 
officially dead. So if we can do an implementation which uses more 
standard behaviour it would be better.

Cheers
Amos


[1] Log excerpt from Jenkins:

01:00:06 In file included from ../../../../src/ipc/StoreMap.h:12,
01:00:06&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; from ../../../../src/fs/rock/RockRebuild.h:17,
01:00:06&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; from ../../../../src/fs/rock/RockRebuild.cc:15:
01:00:06 In member function 'Item&amp; 
Ipc::Mem::FlexibleArray&lt;Item&gt;::operator[](int) [with Item = long 
unsigned int]',
01:00:06&#160;&#160;&#160;&#160; inlined from 'Ipc::StoreMapItems&lt;C&gt;::Item&amp; 
Ipc::StoreMapItems&lt;C&gt;::at(int) [with C = long unsigned int]' at 
../../../../src/ipc/StoreMap.h:136:21,
01:00:06&#160;&#160;&#160;&#160; inlined from 'Rock::LoadingEntry::LoadingEntry(sfileno, 
Rock::LoadingParts&amp;)' at ../../../../src/fs/rock/RockRebuild.cc:199:27:
01:00:06 ../../../../src/ipc/mem/FlexibleArray.h:34:52: error: array 
subscript -1 is below array bounds of 'long unsigned int [1]' 
[-Werror=array-bounds=]
01:00:06&#160;&#160;&#160; 34 |&#160;&#160;&#160;&#160; Item &amp;operator [](const int idx) { return items[idx]; }
01:00:06&#160;&#160;&#160;&#160;&#160;&#160; | ~~~~~^
01:00:06 ../../../../src/ipc/mem/FlexibleArray.h: In constructor 
'Rock::LoadingEntry::LoadingEntry(sfileno, Rock::LoadingParts&amp;)':
01:00:06 ../../../../src/ipc/mem/FlexibleArray.h:43:10: note: while 
referencing 'Ipc::Mem::FlexibleArray&lt;long unsigned int&gt;::items'
01:00:06&#160;&#160;&#160; 43 |&#160;&#160;&#160;&#160; Item items[1]; // ensures proper alignment of array 
elements
01:00:06&#160;&#160;&#160;&#160;&#160;&#160; |&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ^~~~~
01:00:06 In member function 'Item&amp; 
Ipc::Mem::FlexibleArray&lt;Item&gt;::operator[](int) [with Item = unsigned int]',
01:00:06&#160;&#160;&#160;&#160; inlined from 'Ipc::StoreMapItems&lt;C&gt;::Item&amp; 
Ipc::StoreMapItems&lt;C&gt;::at(int) [with C = unsigned int]' at 
../../../../src/ipc/StoreMap.h:136:21,
01:00:06&#160;&#160;&#160;&#160; inlined from 'Rock::LoadingEntry::LoadingEntry(sfileno, 
Rock::LoadingParts&amp;)' at ../../../../src/fs/rock/RockRebuild.cc:200:33:
01:00:06 ../../../../src/ipc/mem/FlexibleArray.h:34:52: error: array 
subscript -1 is below array bounds of 'unsigned int [1]' 
[-Werror=array-bounds=]
01:00:06&#160;&#160;&#160; 34 |&#160;&#160;&#160;&#160; Item &amp;operator [](const int idx) { return items[idx]; }
01:00:06&#160;&#160;&#160;&#160;&#160;&#160; | ~~~~~^
01:00:06 ../../../../src/ipc/mem/FlexibleArray.h: In constructor 
'Rock::LoadingEntry::LoadingEntry(sfileno, Rock::LoadingParts&amp;)':
01:00:06 ../../../../src/ipc/mem/FlexibleArray.h:43:10: note: while 
referencing 'Ipc::Mem::FlexibleArray&lt;unsigned int&gt;::items'
01:00:06&#160;&#160;&#160; 43 |&#160;&#160;&#160;&#160; Item items[1]; // ensures proper alignment of array 
elements
01:00:06&#160;&#160;&#160;&#160;&#160;&#160; |&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ^~~~~
01:00:06 In member function 'Item&amp; 
Ipc::Mem::FlexibleArray&lt;Item&gt;::operator[](int) [with Item = int]',
01:00:06&#160;&#160;&#160;&#160; inlined from 'Ipc::StoreMapItems&lt;C&gt;::Item&amp; 
Ipc::StoreMapItems&lt;C&gt;::at(int) [with C = int]' at 
../../../../src/ipc/StoreMap.h:136:21,
01:00:06&#160;&#160;&#160;&#160; inlined from 'Rock::LoadingSlot::LoadingSlot(Rock::SlotId, 
Rock::LoadingParts&amp;)' at ../../../../src/fs/rock/RockRebuild.cc:208:27:
01:00:06 ../../../../src/ipc/mem/FlexibleArray.h:34:52: error: array 
subscript -1 is below array bounds of 'int [1]' [-Werror=array-bounds=]
01:00:06&#160;&#160;&#160; 34 |&#160;&#160;&#160;&#160; Item &amp;operator [](const int idx) { return items[idx]; }
01:00:06&#160;&#160;&#160;&#160;&#160;&#160; | ~~~~~^
01:00:06 ../../../../src/ipc/mem/FlexibleArray.h: In constructor 
'Rock::LoadingSlot::LoadingSlot(Rock::SlotId, Rock::LoadingParts&amp;)':
01:00:06 ../../../../src/ipc/mem/FlexibleArray.h:43:10: note: while 
referencing 'Ipc::Mem::FlexibleArray&lt;int&gt;::items'
01:00:06&#160;&#160;&#160; 43 |&#160;&#160;&#160;&#160; Item items[1]; // ensures proper alignment of array 
elements
01:00:06&#160;&#160;&#160;&#160;&#160;&#160; |&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ^~~~~
01:00:06 cc1plus: all warnings being treated as errors
01:00:06 make[4]: *** [Makefile:986: rock/RockRebuild.lo] Error 1
01:00:06 make[4]: Leaving directory 
'/srv/jenkins/workspace/5-pr-test/COMPILER/gcc/OS/fedora-rawhide/label/docker-build-host/btlayer-02-maximus/squid-7.0.0-VCS/_build/sub/src/fs'

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009863.html">[squid-dev] 6.0.2 release update
</A></li>
	<LI>Next message (by thread): <A HREF="009866.html">[squid-dev] Latest Clang build errors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9865">[ date ]</a>
              <a href="thread.html#9865">[ thread ]</a>
              <a href="subject.html#9865">[ subject ]</a>
              <a href="author.html#9865">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
