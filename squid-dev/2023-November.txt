From squid3 at treenet.co.nz  Wed Nov  1 16:05:18 2023
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 2 Nov 2023 05:05:18 +1300
Subject: [squid-dev] mirrors with missing files
In-Reply-To: <7e4ee1a8-f4ca-4c08-80bc-c83c9cf0526d@measurement-factory.com>
References: <7243e5e7-757d-4b4b-8b04-5ec0656cfb32@suse.de>
 <2de7f0f9-b89b-4fb3-8660-bb2a3e71bb92@suse.de>
 <55df0ed0-7722-43a0-9182-8eac3ee8d3ce@measurement-factory.com>
 <CA+Y8hcM0aV742+n4qkr-F6-_CeawVqqbYjSizjvL0=-+Q=0ueQ@mail.gmail.com>
 <7e4ee1a8-f4ca-4c08-80bc-c83c9cf0526d@measurement-factory.com>
Message-ID: <14d48306-ac7b-4539-98c6-4039630ef686@treenet.co.nz>

On 1/11/23 09:59, Alex Rousskov wrote:
> On 2023-10-31 15:39, Francesco Chemolli wrote:
>> Before we can migrate ..., we need to deprecate, cleanup and simplify 
>> a lot.
> 
> Do you really, really _need_ to "deprecate, cleanup, and simplify a lot" 
> in order to stop mirroring tomorrow?! Start doing new minor releases on 
> GitHub a month from now? FWIW, I have asked for specifics many times, 
> but am still unaware of any serious obstacles on the way to those goals.
> 

As I have mentioned multiple times ... there is a reason we have Jenkins 
building the tarballs.


Please run the following commands:

wget 
https://github.com/squid-cache/squid/archive/refs/tags/SQUID_6_3.tar.gz &&
	tar -xvf SQUID_6_3.tar.gz &&
	./configure &&
	make check

> AFAICT, there is just lack of shared goals (or shared priorities) rather 
> than serious obstacles on the way of achieving those two specific goals.
> 


FWIW, one of those goals that we appear not to share is freedom of 
information ... specifically to have Squid code available to everyone. 
There exist countries in this world who forbid access to USA hosted 
content. Having squid-cache.org mirrored keeps us largely out of the 
political arean.


Cheers
Amos

From rousskov at measurement-factory.com  Wed Nov  1 17:34:37 2023
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 1 Nov 2023 13:34:37 -0400
Subject: [squid-dev] mirrors with missing files
In-Reply-To: <14d48306-ac7b-4539-98c6-4039630ef686@treenet.co.nz>
References: <7243e5e7-757d-4b4b-8b04-5ec0656cfb32@suse.de>
 <2de7f0f9-b89b-4fb3-8660-bb2a3e71bb92@suse.de>
 <55df0ed0-7722-43a0-9182-8eac3ee8d3ce@measurement-factory.com>
 <CA+Y8hcM0aV742+n4qkr-F6-_CeawVqqbYjSizjvL0=-+Q=0ueQ@mail.gmail.com>
 <7e4ee1a8-f4ca-4c08-80bc-c83c9cf0526d@measurement-factory.com>
 <14d48306-ac7b-4539-98c6-4039630ef686@treenet.co.nz>
Message-ID: <ccee9b33-2c2d-43c1-8f81-80f6acfabe7a@measurement-factory.com>

On 2023-11-01 12:05, Amos Jeffries wrote:
> On 1/11/23 09:59, Alex Rousskov wrote:
>> On 2023-10-31 15:39, Francesco Chemolli wrote:
>>> Before we can migrate ..., we need to deprecate, cleanup and simplify 
>>> a lot.

>> Do you really, really _need_ to "deprecate, cleanup, and simplify a 
>> lot" in order to stop mirroring tomorrow?! Start doing new minor 
>> releases on GitHub a month from now? FWIW, I have asked for specifics 
>> many times, but am still unaware of any serious obstacles on the way 
>> to those goals.

> As I have mentioned multiple times ... there is a reason we have Jenkins 
> building the tarballs.

The reasons I have heard multiple times do not preclude disabling 
mirroring tomorrow and doing releases on GitHub a month from now.


>> AFAICT, there is just lack of shared goals (or shared priorities) 
>> rather than serious obstacles on the way of achieving those two 
>> specific goals.

> FWIW, one of those goals that we appear not to share is freedom of 
> information > ... specifically to have Squid code available to everyone.
FWIW, I support that particular goal (among others). That goal certainly 
does not preclude disabling mirroring tomorrow and doing releases on 
GitHub a month from now.


> There exist countries in this world who forbid access to USA hosted 
> content. Having squid-cache.org mirrored keeps us largely out of the 
> political arean.

We do not need mirrors to make Squid available on non-US hosted servers, 
especially stale, broken, and infested mirrors (i.e. the subject of this 
email thread).

Alex.


From stu.lists at spacehopper.org  Thu Nov  2 11:59:15 2023
From: stu.lists at spacehopper.org (Stuart Henderson)
Date: Thu, 2 Nov 2023 11:59:15 -0000 (UTC)
Subject: [squid-dev] mirrors with missing files
References: <7243e5e7-757d-4b4b-8b04-5ec0656cfb32@suse.de>
 <2de7f0f9-b89b-4fb3-8660-bb2a3e71bb92@suse.de>
 <55df0ed0-7722-43a0-9182-8eac3ee8d3ce@measurement-factory.com>
 <CA+Y8hcM0aV742+n4qkr-F6-_CeawVqqbYjSizjvL0=-+Q=0ueQ@mail.gmail.com>
 <7e4ee1a8-f4ca-4c08-80bc-c83c9cf0526d@measurement-factory.com>
 <14d48306-ac7b-4539-98c6-4039630ef686@treenet.co.nz>
Message-ID: <slrnuk73oj.2kh6.stu.lists@naiad.spacehopper.org>

On 2023-11-01, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> On 1/11/23 09:59, Alex Rousskov wrote:
>> On 2023-10-31 15:39, Francesco Chemolli wrote:
>>> Before we can migrate ..., we need to deprecate, cleanup and simplify 
>>> a lot.
>> 
>> Do you really, really _need_ to "deprecate, cleanup, and simplify a lot" 
>> in order to stop mirroring tomorrow?! Start doing new minor releases on 
>> GitHub a month from now? FWIW, I have asked for specifics many times, 
>> but am still unaware of any serious obstacles on the way to those goals.
>> 
>
> As I have mentioned multiple times ... there is a reason we have Jenkins 
> building the tarballs.
>
>
> Please run the following commands:
>
> wget 
> https://github.com/squid-cache/squid/archive/refs/tags/SQUID_6_3.tar.gz &&
> 	tar -xvf SQUID_6_3.tar.gz &&
> 	./configure &&
> 	make check

That's using github's on-the-fly generated tarballs; it's also possible to
upload a "release artefact" which is the proper project-generated tar.gz.
See e.g. the irssi releases, https://github.com/irssi/irssi/releases/tag/1.4.5
(though also notice the ugly way they try to make sure people download the
correct file...)

(and it doesn't preclude _also_ having mirrors)



From rousskov at measurement-factory.com  Thu Nov  2 13:01:26 2023
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 2 Nov 2023 09:01:26 -0400
Subject: [squid-dev] mirrors with missing files
In-Reply-To: <slrnuk73oj.2kh6.stu.lists@naiad.spacehopper.org>
References: <7243e5e7-757d-4b4b-8b04-5ec0656cfb32@suse.de>
 <2de7f0f9-b89b-4fb3-8660-bb2a3e71bb92@suse.de>
 <55df0ed0-7722-43a0-9182-8eac3ee8d3ce@measurement-factory.com>
 <CA+Y8hcM0aV742+n4qkr-F6-_CeawVqqbYjSizjvL0=-+Q=0ueQ@mail.gmail.com>
 <7e4ee1a8-f4ca-4c08-80bc-c83c9cf0526d@measurement-factory.com>
 <14d48306-ac7b-4539-98c6-4039630ef686@treenet.co.nz>
 <slrnuk73oj.2kh6.stu.lists@naiad.spacehopper.org>
Message-ID: <1f3372be-e656-4dbb-a350-717fc5e496a9@measurement-factory.com>

On 2023-11-02 07:59, Stuart Henderson wrote:
> On 2023-11-01, Amos Jeffries <squid3 at treenet.co.nz> wrote:
>> On 1/11/23 09:59, Alex Rousskov wrote:
>>> On 2023-10-31 15:39, Francesco Chemolli wrote:
>>>> Before we can migrate ..., we need to deprecate, cleanup and simplify
>>>> a lot.
>>>
>>> Do you really, really _need_ to "deprecate, cleanup, and simplify a lot"
>>> in order to stop mirroring tomorrow?! Start doing new minor releases on
>>> GitHub a month from now? FWIW, I have asked for specifics many times,
>>> but am still unaware of any serious obstacles on the way to those goals.
>>>
>>
>> As I have mentioned multiple times ... there is a reason we have Jenkins
>> building the tarballs.
>>
>>
>> Please run the following commands:
>>
>> wget
>> https://github.com/squid-cache/squid/archive/refs/tags/SQUID_6_3.tar.gz &&
>> 	tar -xvf SQUID_6_3.tar.gz &&
>> 	./configure &&
>> 	make check
> 
> That's using github's on-the-fly generated tarballs; it's also possible to
> upload a "release artefact" which is the proper project-generated tar.gz.


Hi Stuart,

     I hope you have better luck with dismantling these poor excuses and 
FUD! I have been doing that for a long time with no signs of success. 
"Where there is a will, there is a way". We lack the former IMO.


 > (and it doesn't preclude _also_ having mirrors)

... or other valid solutions (for other problems, including the alleged 
problem of "USA hosted content").

Alex.


> See e.g. the irssi releases, https://github.com/irssi/irssi/releases/tag/1.4.5
> (though also notice the ugly way they try to make sure people download the
> correct file...)



From squid3 at treenet.co.nz  Wed Nov 15 16:28:38 2023
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 16 Nov 2023 05:28:38 +1300
Subject: [squid-dev] RFC: Squid documentation upgrade
In-Reply-To: <ec06b294-24d5-4d9a-982c-70c6649cf115@measurement-factory.com>
References: <ac04ffd7-162d-4a8c-acab-dc0cb959fa2c@treenet.co.nz>
 <ec06b294-24d5-4d9a-982c-70c6649cf115@measurement-factory.com>
Message-ID: <4eece1c4-43e7-4b3f-9981-6ab9ba5a5893@treenet.co.nz>

On 12/10/23 03:32, Alex Rousskov wrote:
> On 2023-10-11 02:25, Amos Jeffries wrote:
>> Hi all,
>>
>> As those familiar with Squid sources will know the documentation of 
>> Squid is currently spread across various formats. Some custom ones, 
>> and some very outdated.
>>
>> So far we have a casual agreement amongst the core dev team to use 
>> Markdown when reasonably possible. If anyone has issues with that 
>> please chime in ASAP, otherwise I shall continue under the assumption 
>> that we are good to make it "official".
> 
> FWIW, I (still) agree that we should use Markdown as human-friendly text 
> input format, where reasonable.
> 
> 
>> I am looking at the <https://pandoc.org/> Markdown tools as possible 
>> replacement of linuxdoc tools to translate automatically the following 
>> documentation outputs:
>> ??* release notes,
>> ??* squid.conf.documented,
>> ??* the .man / .info / .pdf files,
>> ??* the INSTALL and QUICKSETUP files
> 
> I do not know what "translate [squid.conf.documented and .pdf] 
> automatically" (to Markdown) means to you in this context,

That re-phrase does not make sense because it is **not** what I wrote.

Specifically your addition "(to Markdown)" is wrong.

Markdown is the proposed source format (in the repository).

The files I listed are **currently** auto-generated from a variety of 
different source formats. My proposal is to change the sources to 
generate **from** Markdown to the various output as-needed.


> especially 
> since (in the official squid repository) "linuxdoc tools" are only used 
> in release notes context. Reaching a rough agreement on what to change, 
> how to change it, and where to change it before changing it may be 
> prudent. Here are a few comments to bootstrap that process:
> 
> * release notes: I recommend discussing changes to release notes 
> maintenance and structure before changing their format. It would be nice 
> to address several persistent problems that we often bump into when 
> working on release notes PRs.

That is a different topic of discussion. I am specifically *not* 
changing the produced outputs content.

> 
> * squid.conf.documented: The format of that file is Squid configuration 
> format, not Markdown.

Well, yes that is the point. I am hoping the text inside COMMENT, and 
DOC sections can use Markdown so we can auto-generate documentation 
files like a squid.conf.8 or the .html more easily with links - without 
making the plain-text form obtuse.

> FWIW, I am against changing the entire cf.data.pre 
> format to Markdown. I am against keeping cf.data.pre as is but 
> translating squid.conf.documented format (or portions thereof) to 
> Markdown (especially if that requires changes in squid repository). We 
> have discussed how cf.data.pre and friends should be restructured and 
> reformatted. We should finish those discussions and implement those 
> changes instead.

IIRC we last discussed it back around 2009-ish with Henrick's proposal 
to split it into a set of multiple files. Are you referring to that?


> 
> * .man, .info, .pdf files: Your call (assuming .8 and similar source 
> files in squid repository remain unchanged).

Assumption is wrong. What I mean is that the source document gets 
converted to Markdown and we have the tools auto-generate the man.8, 
info, or pdf files from that as needed by the user/distro.


> 
> * INSTALL and QUICKSETUP: I support rewriting these and other top-level 
> [A-Z]* files in Markdown, where possible. The other candidates are 
> CONTRIBUTORS, COPYING, CREDITS, ChangeLog, README, and SPONSORS(.list).
> 

COPYING is not on the table since that is the mandatory GPL text not 
under our control.

Amos


> 
> HTH,
> 
> Alex.
> 
> 
>> This would impact anyone building Squid packages from our repository 
>> instead of the formal release bundles. As well as our testing 
>> infrastructure.
>>
>> The tools are GPL with sources public in github, so SHOULD be easily 
>> available everywhere. At the very least it has been available in both 
>> Debian and RHEL distributions for many years. If this change to Squid 
>> build requirements is an issue for anyone please speak up.
>>
>>
>> Cheers
>> Amos
>> _______________________________________________
>> squid-dev mailing list
>> squid-dev at lists.squid-cache.org
>> https://lists.squid-cache.org/listinfo/squid-dev
> 
> _______________________________________________
> squid-dev mailing list
> squid-dev at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-dev

From rousskov at measurement-factory.com  Wed Nov 15 17:26:06 2023
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 15 Nov 2023 12:26:06 -0500
Subject: [squid-dev] RFC: Squid documentation upgrade
In-Reply-To: <4eece1c4-43e7-4b3f-9981-6ab9ba5a5893@treenet.co.nz>
References: <ac04ffd7-162d-4a8c-acab-dc0cb959fa2c@treenet.co.nz>
 <ec06b294-24d5-4d9a-982c-70c6649cf115@measurement-factory.com>
 <4eece1c4-43e7-4b3f-9981-6ab9ba5a5893@treenet.co.nz>
Message-ID: <49e8c874-c6bf-4e63-8430-c2fcda54aed4@measurement-factory.com>

On 2023-11-15 11:28, Amos Jeffries wrote:
> On 12/10/23 03:32, Alex Rousskov wrote:
>> On 2023-10-11 02:25, Amos Jeffries wrote:
>>> Hi all,
>>>
>>> As those familiar with Squid sources will know the documentation of 
>>> Squid is currently spread across various formats. Some custom ones, 
>>> and some very outdated.
>>>
>>> So far we have a casual agreement amongst the core dev team to use 
>>> Markdown when reasonably possible. If anyone has issues with that 
>>> please chime in ASAP, otherwise I shall continue under the assumption 
>>> that we are good to make it "official".
>>
>> FWIW, I (still) agree that we should use Markdown as human-friendly 
>> text input format, where reasonable.
>>
>>
>>> I am looking at the <https://pandoc.org/> Markdown tools as possible 
>>> replacement of linuxdoc tools to translate automatically the 
>>> following documentation outputs:
>>> ??* release notes,
>>> ??* squid.conf.documented,
>>> ??* the .man / .info / .pdf files,
>>> ??* the INSTALL and QUICKSETUP files
>>
>> I do not know what "translate [squid.conf.documented and .pdf] 
>> automatically" (to Markdown) means to you in this context,

> Markdown is the proposed source format (in the repository).
> 
> The files I listed are **currently** auto-generated from a variety of 
> different source formats. My proposal is to change the sources to 
> generate **from** Markdown to the various output as-needed.

Thank you for this clarification. Let's see whether we can reach a rough 
agreement on what sources to change and how to change them before 
changing anything.


>> * release notes: I recommend discussing changes to release notes 
>> maintenance and structure before changing their format. It would be 
>> nice to address several persistent problems that we often bump into 
>> when working on release notes PRs.
> 
> That is a different topic of discussion. I am specifically *not* 
> changing the produced outputs content.

It is the input that worries me, not the output. AFAICT, you _are_ 
proposing changing how release notes are written (i.e. input). My 
recommendation stands.


>> * squid.conf.documented: The format of that file is Squid 
>> configuration format, not Markdown.

> Well, yes that is the point. I am hoping the text inside COMMENT, and 
> DOC sections can use Markdown so we can auto-generate documentation 
> files like a squid.conf.8 or the .html more easily with links - without 
> making the plain-text form obtuse.

I support changing text inside COMMENT and DOC sections to Markdown, but 
only if that change is accompanied by cf.data.pre restructuring. IIRC, 
migration to Markdown was a part of those restructuring plans/discussions.


>> We have discussed how cf.data.pre and friends should be
>> restructured and reformatted. We should finish those discussions
>> and implement those changes instead.

> IIRC we last discussed it back around 2009-ish with Henrick's proposal 
> to split it into a set of multiple files. Are you referring to that?

I believe that those discussions did include the idea of splitting 
cf.data.pre, including providing a dedicated file for each squid.conf 
directive. I do not think those discussions were limited to that idea.

One of the problems we need to address during this restructuring is 
referencing, at least at the level of individual directives and major 
syntax concepts. At the end, one directive description should be able to 
refer to another directive or concept, with rendered versions providing 
the corresponding links and indexes.


>> * .man, .info, .pdf files: Your call (assuming .8 and similar source 
>> files in squid repository remain unchanged).
> 
> Assumption is wrong. What I mean is that the source document gets 
> converted to Markdown and we have the tools auto-generate the man.8, 
> info, or pdf files from that as needed by the user/distro.

Thank you for clarifying this! I need more information to make a 
decision on this item:

* Do you plan to exclude .8 files that are currently generated from 
other sources (e.g., src/log/DB/log_db_daemon.8 and 
src/security/cert_validators/fake/security_fake_certverify.8)?

* AFAICT, .8 files are written in troff or mdoc. Those formatting 
languages have lots of documentation-focused macros that standard 
Markdown does not support. Is there a variation of Markdown (that you 
plan to use for manual page conversion) that adds documentation-writing 
markup? Or are we going to "dumb down" this documentation due to 
Markdown inability to express certain documentation concepts?


>> * INSTALL and QUICKSETUP: I support rewriting these and other 
>> top-level [A-Z]* files in Markdown, where possible. The other 
>> candidates are CONTRIBUTORS, COPYING, CREDITS, ChangeLog, README, and 
>> SPONSORS(.list).
>>
> 
> COPYING is not on the table since that is the mandatory GPL text not 
> under our control.

I am not sure we cannot convert COPYING to valid Markdown without 
violating GPL, but I am not going to argue about it. Glad we appear to 
agree regarding the other top-level [A-Z]* files. FWIW, except for 
ChangeLog and CONTRIBUTORS, that part of the conversion can start at any 
time. I recommend converting one file at a time, at least in the 
beginning (to reduce the number of changes we have to redo during review 
cycles).


Cheers,

Alex.


