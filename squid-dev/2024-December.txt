From squid3 at treenet.co.nz  Wed Dec 11 01:52:48 2024
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 11 Dec 2024 14:52:48 +1300
Subject: [squid-dev] GCC static analysis
Message-ID: <d666464b-a433-42b6-ade9-c1fc43138883@treenet.co.nz>

Here are the results of a static analysis run performed on Squid-7 
("master" branch) with GCC-14

To replicate the build and obtain the full traces;
    ./configure CXXFLAGS=-fanalyzer && make -k


Cheers
Amos
-------------- next part --------------
A non-text attachment was scrubbed...
Name: summary.log
Type: text/x-log
Size: 58223 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-dev/attachments/20241211/1a012ec2/attachment-0001.bin>

From shavashishth at gmail.com  Fri Dec 27 06:07:03 2024
From: shavashishth at gmail.com (Shailesh Vashishth)
Date: Fri, 27 Dec 2024 11:37:03 +0530
Subject: [squid-dev] Introducing myself to Squid Devs
In-Reply-To: <CABHxcG=Hv5Mep+dpEgiea3YmPi9egrPjS_T6CA6uPHd5XQ8XbA@mail.gmail.com>
References: <CABHxcGm+idiH_jxqFWnYB5zYVUismhb-4_GTP54-E8oeTHNY0A@mail.gmail.com>
 <7f9a3302-2798-4699-a8a5-d01d6ce5d131@measurement-factory.com>
 <CABHxcGko8e_X7gX7+81d4UM+MgSkX3OS3h-F=i16pzxtFe2Xxw@mail.gmail.com>
 <CABHxcGkQ5zHVekHayCXZL_8f-yzAryNQtHNmCjgxK53jb3hhOw@mail.gmail.com>
 <CABHxcGmTx_VqQY3O+4STHdAYbsH9+8v0B8yFaCF_DWh9V0YWtA@mail.gmail.com>
 <CABHxcG=Hv5Mep+dpEgiea3YmPi9egrPjS_T6CA6uPHd5XQ8XbA@mail.gmail.com>
Message-ID: <CABHxcGkq87FoxEAWVBViy1j-mmBG_rHqC8CjqfkLJT3o5antdA@mail.gmail.com>

Hi
I am trying to do the following ToDo in store_client.cc.
// TODO: Convert store_client into AsyncJob; make this call asynchronous
CodeContext::Reset(sc->_callback.codeContext);
debugs(90, 3, "checking client #" << i);
storeClientCopy2(this, sc);

Please help me understand why we need to make this call asynchronous?

Regards
Shailesh


On Sun, Oct 27, 2024 at 7:45?PM Shailesh Vashishth <shavashishth at gmail.com>
wrote:

> Hi
> There is another very small ToDo that I would like take up --
>
> This is also a very simple and small change -- replacing *Io with
> Store::IoStatus *and removing the *using *statement
>
> Address the following TODO:
> /* TODO: Remove this change-minimizing hack */
> using Io = Store::IoStatus;
> static constexpr Io ioUndecided = Store::ioUndecided;
> static constexpr Io ioReading = Store::ioReading;
> static constexpr Io ioWriting = Store::ioWriting;
> static constexpr Io ioDone = Store::ioDone;
>
>
> Regards
> Shailesh
>
> On Sat, Oct 26, 2024 at 12:54?AM Shailesh Vashishth <
> shavashishth at gmail.com> wrote:
>
>> Hi
>> I would like to take up another Todo item that is listed here --
>> https://github.com/measurement-factory/squid-notes/blob/start/todos.md
>>
>> I would like to pick this item : I think this requires very small change,
>> where we just print *name_len *on the *stdout *using the custom function
>> for printing debug logs.
>>
>>
>>    - Address the following TODO by adding any using Raw::upto(n) which
>>    will limit the size value of passed to PrintHex() and write() inside
>>    Raw::print(). That value is currently size_.
>>
>> if (name_len > 65534) {
>>> /* String must be LESS THAN 64K and it adds a terminating NULL */
>>> // TODO: update this to show proper name_len in Raw markup, but not
>>> print all that
>>> debugs(55, 2, "ignoring huge header field (" << Raw("field_start",
>>> field_start, 100) << "...)");
>>>
>>
>>
>> My current PR (*https://github.com/squid-cache/squid/pull/1921
>> <https://github.com/squid-cache/squid/pull/1921>*) has succeeded all
>> Pipeline stages, only your approval is remaining.
>>
>> Regards
>> Shailesh
>>
>> On Wed, Oct 23, 2024 at 12:30?AM Shailesh Vashishth <
>> shavashishth at gmail.com> wrote:
>>
>>> Hi
>>> I have made a change to a math expression in store_client.cc and raised
>>> the following pull request.
>>>
>>> if (curlen > expectlen*(Config.quickAbort.pct/100.0)) {
>>> debugs(90, 3, "quick-abort? NO past point of no return");
>>> return false;
>>> }
>>>
>>> I have also ran the test-build.sh (suggested in Submissions Checklist)
>>> and it passed all test cases.
>>>
>>> Please review the following pull request -
>>> https://github.com/squid-cache/squid/pull/1921
>>>
>>> Regards
>>> Shailesh
>>>
>>> On Sat, Oct 5, 2024 at 1:27?PM Shailesh Vashishth <
>>> shavashishth at gmail.com> wrote:
>>>
>>>> Hi Alex,
>>>> I read your hint and made changes accordingly, it didn't go to spam
>>>> this time. I was going through the Squid Docs, on how to submit PR and do
>>>> those pre-merge self tests (Submission Checklist).
>>>>
>>>> I will do the steps given in the Submission Checklist and submit a PR
>>>> in a day or two.
>>>>
>>>> Thank you for helping me with getting started and joining the project.
>>>>
>>>> Regards
>>>> Shailesh
>>>>
>>>>
>>>> On Fri, Oct 4, 2024 at 6:53?PM Alex Rousskov <
>>>> rousskov at measurement-factory.com> wrote:
>>>>
>>>>> On 2024-10-03 15:49, Shailesh Vashishth wrote:
>>>>>
>>>>> > I would like to contribute to the Squid Project and I have picked
>>>>> one
>>>>> > small task out of the ToDos  for myself.
>>>>>
>>>>>
>>>>> Hello Shailesh,
>>>>>
>>>>>      Welcome to the Project and good luck with your first task! If you
>>>>> need any help, please do not hesitate to ask on this mailing list or
>>>>> to
>>>>> post a draft pull request for discussion on GitHub:
>>>>> https://wiki.squid-cache.org/MergeProcedure
>>>>>
>>>>> BTW, I have also emailed you a few hints regarding the code below when
>>>>> you asked about it privately -- check your spam folder if you have not
>>>>> seen my response dated September 30, 2024...
>>>>>
>>>>>
>>>>> Cheers,
>>>>>
>>>>> Alex.
>>>>>
>>>>>
>>>>> >     *// XXX: This is absurd! TODO: For positives, "a/(b/c) > d" is
>>>>> "a*c
>>>>> >      > b*d".
>>>>> >     **if (expectlen < 100) {
>>>>> >     **   debugs(90, 3, "quick-abort? NO avoid FPE");
>>>>> >     **   return false;
>>>>> >     **}*
>>>>> >
>>>>> >     */_if ((curlen / (expectlen / 100)) > (Config.quickAbort.pct)) {
>>>>> >     _/**   debugs(90, 3, "quick-abort? NO past point of no return");
>>>>> >     **   return false;
>>>>> >     **}*
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-dev/attachments/20241227/f6c54be8/attachment.htm>

From rousskov at measurement-factory.com  Fri Dec 27 22:18:21 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 27 Dec 2024 17:18:21 -0500
Subject: [squid-dev] Convert store_client into AsyncJob
In-Reply-To: <CABHxcGkq87FoxEAWVBViy1j-mmBG_rHqC8CjqfkLJT3o5antdA@mail.gmail.com>
References: <CABHxcGm+idiH_jxqFWnYB5zYVUismhb-4_GTP54-E8oeTHNY0A@mail.gmail.com>
 <7f9a3302-2798-4699-a8a5-d01d6ce5d131@measurement-factory.com>
 <CABHxcGko8e_X7gX7+81d4UM+MgSkX3OS3h-F=i16pzxtFe2Xxw@mail.gmail.com>
 <CABHxcGkQ5zHVekHayCXZL_8f-yzAryNQtHNmCjgxK53jb3hhOw@mail.gmail.com>
 <CABHxcGmTx_VqQY3O+4STHdAYbsH9+8v0B8yFaCF_DWh9V0YWtA@mail.gmail.com>
 <CABHxcG=Hv5Mep+dpEgiea3YmPi9egrPjS_T6CA6uPHd5XQ8XbA@mail.gmail.com>
 <CABHxcGkq87FoxEAWVBViy1j-mmBG_rHqC8CjqfkLJT3o5antdA@mail.gmail.com>
Message-ID: <e2f34f41-73f8-4fb0-947f-1620625e9ad3@measurement-factory.com>

On 2024-12-27 01:07, Shailesh Vashishth wrote:

> I am trying to do the following ToDo in store_client.cc.
> // TODO: Convert store_client into AsyncJob; make this call asynchronous

I do not recommend working on that to-do:

1. It is too complex, requiring good understanding of AsyncJob design 
that may be difficult to obtain through reading documentation alone.

2. It may be premature because we probably should "Merge store_client 
into StoreClient" first (or at the same time), as documented in another 
TODO in StoreClient.h.

3. The change requires serious testing that would be difficult to 
perform and nearly impossible to validate via review.


> storeClientCopy2(this, sc);

> Please help me understand why we need to make this call asynchronous?

The relevant StoreEntry::invokeHandlers() code is best interpreted as 
the following pseudo-code loop:

     for (const auto &client: entry->store_clients)
         client->do_something_complex_with(entry);

In other words, the code is contacting individual store_client tasks in 
a loop while asking each task to perform complex actions with numerous 
side effects, including cases where an action of one task affects 
another task (and/or the looping/entry object itself!).

This is essentially spaghetti code in disguise, where (very indirect!) 
recursive function calls and same-object recursive "visits" have 
replaced classic "goto" statements: 
https://en.wikipedia.org/wiki/Spaghetti_code

Experience shows that humans are terrible at writing and especially 
maintaining correct spaghetti code. This specific invokeHandlers() loop 
has caused many costly problems! Not all of them have been solved IIRC.


Asynchronous calls untangle this mess because they prevent recursive 
calls and revisits. They have their own cons, of course, but they are a 
part of a much better overall design.


HTH,

Alex.


From gkinkie at gmail.com  Mon Dec 30 15:02:37 2024
From: gkinkie at gmail.com (Francesco Chemolli)
Date: Mon, 30 Dec 2024 15:02:37 +0000
Subject: [squid-dev] Proposal: clean our git tags up
Message-ID: <CA+Y8hcMb0hGT_VLpQ7F1UqwvTow5PN7BZFJ6h6gLhSp1KGCLrw@mail.gmail.com>

Hi all,
  There are a lot of tags attached to Squid's git repository that do not
seem to be relevant; I'm proposing to remove them, unless there's a reason
not to.

I refer to:

   -  *-snapshot and *-master-snapshot (e.g. 4.15-20210522-snapshot)
   - BumpSslServerFirst.*
   - M-staged-PR* (the latest being M-staged-PR379)
   - for-libecap-v0p1
   - merge-candidate-* (e.g. merge-candidate-3-v1)
   - sourceformat-review-1
   - take* (e.g. take1, take00)

Does anyone have any objections? I plan to perform this cleanup on The 12th
of January 2025 unless there's any reasons not to.

-- 
    Francesco
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-dev/attachments/20241230/93e341eb/attachment.htm>

From rousskov at measurement-factory.com  Mon Dec 30 16:01:57 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 30 Dec 2024 11:01:57 -0500
Subject: [squid-dev] Proposal: clean our git tags up
In-Reply-To: <CA+Y8hcMb0hGT_VLpQ7F1UqwvTow5PN7BZFJ6h6gLhSp1KGCLrw@mail.gmail.com>
References: <CA+Y8hcMb0hGT_VLpQ7F1UqwvTow5PN7BZFJ6h6gLhSp1KGCLrw@mail.gmail.com>
Message-ID: <5754c609-c479-4441-949c-74b812f32fb0@measurement-factory.com>

On 2024-12-30 10:02, Francesco Chemolli wrote:

> There are a lot of tags attached to Squid's git repository that do 
> not seem to be relevant; I'm proposing?to remove?them, unless there's a 
> reason not to.

Great minds think alike! I was going to propose that as well, but did 
not want to interrupt your release publication process/project :-).


> I refer?to:
> 
>   * *-snapshot and *-master-snapshot (e.g.?4.15-20210522-snapshot)
>   * BumpSslServerFirst.*
>   * M-staged-PR* (the latest being?M-staged-PR379)
>   * for-libecap-v0p1
>   * merge-candidate-* (e.g.?merge-candidate-3-v1)
>   * sourceformat-review-1
>   * take* (e.g. take1, take00)

And a tag called "BASIC_TPROXY4".

And a tag called "latest".

FWIW, the following rough script shows all tags that should be removed 
from the official repository (called "upstream" below):

regex=".-snapshot"
regex="$regex|.-master-snapshot"
regex="$regex|BumpSslServerFirst"
regex="$regex|M-staged-PR.*"
regex="$regex|for-libecap-v0p1"
regex="$regex|merge-candidate-"
regex="$regex|sourceformat-review-1"
regex="$regex|take"
regex="$regex|BASIC_TPROXY4"
regex="$regex|latest"
git ls-remote --tags upstream | grep -E "$regex"

I get 135 tags.


AFAICT, after removing the above tags, the official repository will have 
256 SQUID_... release tags and the new HISTORIC_RELEASES tag.


> Does anyone have any objections? I plan to perform this cleanup on The 
> 12th of January 2025 unless there's any reasons not to.


Please do.


Thank you,

Alex.


