From squid3 at treenet.co.nz  Sat Sep  7 15:43:02 2024
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 8 Sep 2024 03:43:02 +1200
Subject: [squid-dev] RFC: Removal of ESI Support from Squid
Message-ID: <6d98aeb1-22b6-44bd-9545-2dc9078bfde7@treenet.co.nz>

Hi all,

The ESI (Edge Side Includes) feature of Squid has a growing number of 
unfixed bugs, more than a few are turning into security issues.

Also, the current Squid developers do not have spare brain cycles to 
maintain everything and v7 is seeing a lot more effort to prune away old 
and unused mechanisms in Squid.


As such this is a callout to see how much use there is for this feature.


       DO you need ESI in Squid?  Yes or No.

    Speak Now, or face regrets at upgrade time.



Thank You
Amos


From ngtech1ltd at gmail.com  Sun Sep  8 22:39:08 2024
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Mon, 9 Sep 2024 01:39:08 +0300
Subject: [squid-dev] [squid-users] RFC: Removal of ESI Support from Squid
In-Reply-To: <B60BA550-4BA2-4BCF-8FAE-19560B65CAB2@gmail.com>
References: <6d98aeb1-22b6-44bd-9545-2dc9078bfde7@treenet.co.nz>
 <B60BA550-4BA2-4BCF-8FAE-19560B65CAB2@gmail.com>
Message-ID: <029001db023f$ee322320$ca966960$@gmail.com>

Hey Jonathan,

The issues and comparison between 5.x to 6.x can be tested and verified.
The ESI related code can be disabled in these tests and I think that the subject you are talking about is different then the subject of the thread.
I will be happy to try and assist with testing these performance issues since I currently am using in production 6.10.

Eliezer


-----Original Message-----
From: squid-users <squid-users-bounces at lists.squid-cache.org> On Behalf Of Jonathan Lee
Sent: Saturday, September 7, 2024 7:30 PM
To: Amos Jeffries <squid3 at treenet.co.nz>
Cc: Squid Developers <squid-dev at lists.squid-cache.org>; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] RFC: Removal of ESI Support from Squid

I use bump splice, with split acls and access lists that match MAC addresses, plus cachemgr, I hate to admit I am using 5.8 because 6.6 has issues with so many errors showing and is so much slower. I do not want to reissue all my certificates, it works perfect for what I need in my mini firewall. 

It took many many hours of config and years of testing and changes to get it to this level of performance. I was very happy that 6.6 was released but it broke a lot of the php gui tools. Again it is like 5.8 is an everything bagel, it?s protected behind a firewall so I am less concerned as well. I am not protecting a massive corporate environment, it is just home issue Sent from my iPhone

> On Sep 7, 2024, at 08:52, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> 
> ?Hi all,
> 
> The ESI (Edge Side Includes) feature of Squid has a growing number of unfixed bugs, more than a few are turning into security issues.
> 
> Also, the current Squid developers do not have spare brain cycles to maintain everything and v7 is seeing a lot more effort to prune away old and unused mechanisms in Squid.
> 
> 
> As such this is a callout to see how much use there is for this feature.
> 
> 
>      DO you need ESI in Squid?  Yes or No.
> 
>   Speak Now, or face regrets at upgrade time.
> 
> 
> 
> Thank You
> Amos
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> https://lists.squid-cache.org/listinfo/squid-users
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
https://lists.squid-cache.org/listinfo/squid-users


From rick at rackow.io  Mon Sep 23 08:21:06 2024
From: rick at rackow.io (Rick Rackow)
Date: Mon, 23 Sep 2024 10:21:06 +0200
Subject: [squid-dev] Validate Config before reload
Message-ID: <2ADABD23-7F05-479A-992A-A4B9D48257B9@rackow.io>

Hey Team,
We have the following scenario: we get a list of IPs from an external service, add them to our squid ACLs via a cronjob and then in the same cronjob also reload squid. In this scenario it can happen that occasionally we get some nonsense response from the external service and that lands in the config, causing the config file to be invalid. Now if we to `systemctl reload squid` squid crashes on the restart because the config is invalid and thereafter can?t be restarted without explicitly stating `systemctl start squid`. 

The question is, has it been considered to validate the config file before performing the actual reload, so there?s no disruption to squid if there was a working config beforehand?

Best Regards

Rick Rackow

From stu.lists at spacehopper.org  Mon Sep 23 11:27:36 2024
From: stu.lists at spacehopper.org (Stuart Henderson)
Date: Mon, 23 Sep 2024 11:27:36 -0000 (UTC)
Subject: [squid-dev] Validate Config before reload
References: <2ADABD23-7F05-479A-992A-A4B9D48257B9@rackow.io>
Message-ID: <slrnvf2k58.2rcl.stu.lists@naiad.spacehopper.org>

On 2024-09-23, Rick Rackow <rick at rackow.io> wrote:
> Hey Team,
> We have the following scenario: we get a list of IPs from an external service, add them to our squid ACLs via a cronjob and then in the same cronjob also reload squid. In this scenario it can happen that occasionally we get some nonsense response from the external service and that lands in the config, causing the config file to be invalid. Now if we to `systemctl reload squid` squid crashes on the restart because the config is invalid and thereafter can?t be restarted without explicitly stating `systemctl start squid`. 
>
> The question is, has it been considered to validate the config file before performing the actual reload, so there?s no disruption to squid if there was a working config beforehand?

That's easy to do from your cronjob: write the new config to a temporary
file, check it with "squid -f $filename -k parse", only move into place
and reload if ok.



From gkinkie at gmail.com  Mon Sep 23 13:20:08 2024
From: gkinkie at gmail.com (Francesco Chemolli)
Date: Mon, 23 Sep 2024 15:20:08 +0200
Subject: [squid-dev] Validate Config before reload
In-Reply-To: <slrnvf2k58.2rcl.stu.lists@naiad.spacehopper.org>
References: <2ADABD23-7F05-479A-992A-A4B9D48257B9@rackow.io>
 <slrnvf2k58.2rcl.stu.lists@naiad.spacehopper.org>
Message-ID: <CA+Y8hcOuGUM+tV9yaJvqv1dDjF9j6qNBtur4Bhk8=ryyZ9ch9Q@mail.gmail.com>

On Mon, Sep 23, 2024 at 1:27?PM Stuart Henderson
<stu.lists at spacehopper.org> wrote:
>
> On 2024-09-23, Rick Rackow <rick at rackow.io> wrote:
> > Hey Team,
> > We have the following scenario: we get a list of IPs from an external service, add them to our squid ACLs via a cronjob and then in the same cronjob also reload squid. In this scenario it can happen that occasionally we get some nonsense response from the external service and that lands in the config, causing the config file to be invalid. Now if we to `systemctl reload squid` squid crashes on the restart because the config is invalid and thereafter can?t be restarted without explicitly stating `systemctl start squid`.
> >
> > The question is, has it been considered to validate the config file before performing the actual reload, so there?s no disruption to squid if there was a working config beforehand?
>
> That's easy to do from your cronjob: write the new config to a temporary
> file, check it with "squid -f $filename -k parse", only move into place
> and reload if ok.

Note however that will only protect from malformed configuration
candidates, not from configuration candidates that, while being
syntactically well formed, contain gibberish. For that you probably
want to do something like having some guard values that, if not
present, alert fail the reconfigure test.


-- 
    Francesco

From ngtech1ltd at gmail.com  Tue Sep 24 06:00:44 2024
From: ngtech1ltd at gmail.com (ngtech1ltd at gmail.com)
Date: Tue, 24 Sep 2024 09:00:44 +0300
Subject: [squid-dev] Validate Config before reload
In-Reply-To: <slrnvf2k58.2rcl.stu.lists@naiad.spacehopper.org>
References: <2ADABD23-7F05-479A-992A-A4B9D48257B9@rackow.io>
 <slrnvf2k58.2rcl.stu.lists@naiad.spacehopper.org>
Message-ID: <039301db0e47$196ea4b0$4c4bee10$@gmail.com>

Hey,

My recommendation is to validation the when downloading it before testing the config.
I have a ready to use lists syntax and duplication validation tools.
If you need just let me know what type of ACL you are using and I can publish the sources later on.

Eliezer

-----Original Message-----
From: squid-dev <squid-dev-bounces at lists.squid-cache.org> On Behalf Of Stuart Henderson
Sent: Monday, September 23, 2024 2:28 PM
To: squid-dev at lists.squid-cache.org
Subject: Re: [squid-dev] Validate Config before reload

On 2024-09-23, Rick Rackow <rick at rackow.io> wrote:
> Hey Team,
> We have the following scenario: we get a list of IPs from an external service, add them to our squid ACLs via a cronjob and then in the same cronjob also reload squid. In this scenario it can happen that occasionally we get some nonsense response from the external service and that lands in the config, causing the config file to be invalid. Now if we to `systemctl reload squid` squid crashes on the restart because the config is invalid and thereafter can?t be restarted without explicitly stating `systemctl start squid`. 
>
> The question is, has it been considered to validate the config file before performing the actual reload, so there?s no disruption to squid if there was a working config beforehand?

That's easy to do from your cronjob: write the new config to a temporary
file, check it with "squid -f $filename -k parse", only move into place
and reload if ok.


_______________________________________________
squid-dev mailing list
squid-dev at lists.squid-cache.org
https://lists.squid-cache.org/listinfo/squid-dev


From rousskov at measurement-factory.com  Mon Sep 30 13:35:54 2024
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 30 Sep 2024 09:35:54 -0400
Subject: [squid-dev] Validate Config before reload
In-Reply-To: <2ADABD23-7F05-479A-992A-A4B9D48257B9@rackow.io>
References: <2ADABD23-7F05-479A-992A-A4B9D48257B9@rackow.io>
Message-ID: <de17939c-9abb-4162-9d8e-5c0c7c67c2af@measurement-factory.com>

On 2024-09-23 04:21, Rick Rackow wrote:

> The question is, has it been considered to validate the config file
> before performing the actual reload

Yes, it has been considered. The progress towards that "reject malformed 
configurations during reconfiguration" ideal is painfully slow 
(primarily for non-technical reasons), but we will get there.

Meanwhile, please see other responses on this thread for workarounds.

Alex.


