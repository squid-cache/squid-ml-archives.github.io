<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-dev] Validate Config before reload
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Validate%20Config%20before%20reload&In-Reply-To=%3CCA%2BY8hcOuGUM%2BtV9yaJvqv1dDjF9j6qNBtur4Bhk8%3DryyZ9ch9Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009917.html">
   <LINK REL="Next"  HREF="009919.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-dev] Validate Config before reload</H1>
    <B>Francesco Chemolli</B> 
    <A HREF="mailto:squid-dev%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-dev%5D%20Validate%20Config%20before%20reload&In-Reply-To=%3CCA%2BY8hcOuGUM%2BtV9yaJvqv1dDjF9j6qNBtur4Bhk8%3DryyZ9ch9Q%40mail.gmail.com%3E"
       TITLE="[squid-dev] Validate Config before reload">gkinkie at gmail.com
       </A><BR>
    <I>Mon Sep 23 13:20:08 UTC 2024</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009917.html">[squid-dev] Validate Config before reload
</A></li>
        <LI>Next message (by thread): <A HREF="009919.html">[squid-dev] Validate Config before reload
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9918">[ date ]</a>
              <a href="thread.html#9918">[ thread ]</a>
              <a href="subject.html#9918">[ subject ]</a>
              <a href="author.html#9918">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Sep 23, 2024 at 1:27&#8239;PM Stuart Henderson
&lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-dev">stu.lists at spacehopper.org</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> On 2024-09-23, Rick Rackow &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-dev">rick at rackow.io</A>&gt; wrote:
</I>&gt;<i> &gt; Hey Team,
</I>&gt;<i> &gt; We have the following scenario: we get a list of IPs from an external service, add them to our squid ACLs via a cronjob and then in the same cronjob also reload squid. In this scenario it can happen that occasionally we get some nonsense response from the external service and that lands in the config, causing the config file to be invalid. Now if we to `systemctl reload squid` squid crashes on the restart because the config is invalid and thereafter can&#8217;t be restarted without explicitly stating `systemctl start squid`.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The question is, has it been considered to validate the config file before performing the actual reload, so there&#8217;s no disruption to squid if there was a working config beforehand?
</I>&gt;<i>
</I>&gt;<i> That's easy to do from your cronjob: write the new config to a temporary
</I>&gt;<i> file, check it with &quot;squid -f $filename -k parse&quot;, only move into place
</I>&gt;<i> and reload if ok.
</I>
Note however that will only protect from malformed configuration
candidates, not from configuration candidates that, while being
syntactically well formed, contain gibberish. For that you probably
want to do something like having some guard values that, if not
present, alert fail the reconfigure test.


-- 
    Francesco
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009917.html">[squid-dev] Validate Config before reload
</A></li>
	<LI>Next message (by thread): <A HREF="009919.html">[squid-dev] Validate Config before reload
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9918">[ date ]</a>
              <a href="thread.html#9918">[ thread ]</a>
              <a href="subject.html#9918">[ subject ]</a>
              <a href="author.html#9918">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-dev">More information about the squid-dev
mailing list</a><br>
</body></html>
