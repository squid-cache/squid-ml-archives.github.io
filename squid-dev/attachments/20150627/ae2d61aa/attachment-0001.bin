=== modified file 'src/SBuf.cc'
--- src/SBuf.cc	2015-03-17 02:51:04 +0000
+++ src/SBuf.cc	2015-06-27 18:47:43 +0000
@@ -853,8 +853,13 @@
     debugs(24, 8, "\"" << *this << "\"");
     for (size_type j = 0; j < length(); ++j) {
         const int c = (*this)[j];
-        if (isupper(c))
-            setAt(j, tolower(c));
+        if (isupper(c)) {
+            try {
+                setAt(j, tolower(c));
+            } catch (OutOfBoundsException e) {
+                // bounds are checked by the loop, exception not possible.
+            }
+        }
     }
     debugs(24, 8, "result: \"" << *this << "\"");
     ++stats.caseChange;
@@ -866,8 +871,13 @@
     debugs(24, 8, "\"" << *this << "\"");
     for (size_type j = 0; j < length(); ++j) {
         const int c = (*this)[j];
-        if (islower(c))
-            setAt(j, toupper(c));
+        if (islower(c)) {
+            try {
+                setAt(j, toupper(c));
+            } catch (OutOfBoundsException e) {
+                // bounds are checked by the loop, exception not possible.
+            }
+        }
     }
     debugs(24, 8, "result: \"" << *this << "\"");
     ++stats.caseChange;

