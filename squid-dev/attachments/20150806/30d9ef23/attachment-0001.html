<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Merged&nbsp;as&nbsp;revision&nbsp;14210&nbsp;with&nbsp;some&nbsp;minor&nbsp;added&nbsp;polish&nbsp;(ostream&lt;&lt;&nbsp;for&nbsp;HttpHdrCcType&nbsp;and&nbsp;Http::HdrType).&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Wed,&nbsp;Aug&nbsp;5,&nbsp;2015&nbsp;at&nbsp;3:58&nbsp;PM,&nbsp;Kinkie&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:gkinkie@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;gkinkie@gmail.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;On&nbsp;Wed,&nbsp;Aug&nbsp;5,&nbsp;2015&nbsp;at&nbsp;4:08&nbsp;AM,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;On&nbsp;5/08/2015&nbsp;9:08&nbsp;a.m.,&nbsp;Kinkie&nbsp;wrote:&lt;br&gt;<br>
&lt;div&gt;&lt;div&gt;&gt;&nbsp;On&nbsp;Tue,&nbsp;Aug&nbsp;4,&nbsp;2015&nbsp;at&nbsp;2:58&nbsp;PM,&nbsp;Amos&nbsp;Jeffries&nbsp;wrote:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;On&nbsp;4/08/2015&nbsp;11:22&nbsp;p.m.,&nbsp;Kinkie&nbsp;wrote:&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;Hi&nbsp;all,&lt;br&gt;<br>
&gt;&gt;&gt; &nbsp; the&nbsp;attached&nbsp;patch&nbsp;is&nbsp;a&nbsp;build-&nbsp;and&nbsp;run-tested&nbsp;merge&nbsp;proposal&nbsp;for&nbsp;next&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;round&nbsp;of&nbsp;the&nbsp;coverity-fixes&nbsp;branch,&nbsp;currently&nbsp;focusing&nbsp;on&nbsp;more&nbsp;effective&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;header&nbsp;name&nbsp;-&gt;&nbsp;id&nbsp;lookups.&lt;br&gt;<br>
&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;Here&#39;s&nbsp;the&nbsp;status&nbsp;with&nbsp;the&nbsp;current&nbsp;todo&nbsp;checklist:&lt;br&gt;<br>
&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt; &nbsp;*&nbsp;DONE&nbsp;1.&nbsp;shift&nbsp;HDR_BAD_HDR&nbsp;to&nbsp;end&nbsp;of&nbsp;enum&lt;br&gt;<br>
&gt;&gt;&gt; &nbsp;*&nbsp;DONE&nbsp;2.&nbsp;shift&nbsp;headers&nbsp;data&nbsp;array&nbsp;to&nbsp;http/RegistredHeaders.cc&lt;br&gt;<br>
&gt;&gt;&gt; &nbsp;*&nbsp;DONE&nbsp;3.&nbsp;creatign&nbsp;LookupTable&nbsp;object&nbsp;from&nbsp;teh&nbsp;enum&nbsp;and&nbsp;array&lt;br&gt;<br>
&gt;&gt;&gt; &nbsp;*&nbsp;(with&nbsp;HDR_BAD_HDR&nbsp;as&nbsp;invalid&nbsp;value)&lt;br&gt;<br>
&gt;&gt;&gt; &nbsp;*&nbsp;DONE&nbsp;4.&nbsp;replacing&nbsp;httpHeaderIdByName()&nbsp;uses&nbsp;with&nbsp;the&nbsp;lookup&nbsp;table&lt;br&gt;<br>
&gt;&gt;&gt; &nbsp;*&nbsp;NOT&nbsp;POSSIBLE&nbsp;5.&nbsp;merge&nbsp;HDR_BAD_HDR&nbsp;and&nbsp;HDR_ENUM_END&nbsp;into&nbsp;one&nbsp;thing&nbsp;-&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;HDR_ENUM_END&nbsp;is&nbsp;overloaded&nbsp;meaning&nbsp;&quot;All&quot;&nbsp;headers&nbsp;in&nbsp;Manglers.&lt;br&gt;<br>
&gt;&gt;&gt; &nbsp;*&nbsp;DONE&nbsp;6.&nbsp;replacing&nbsp;httpHeaderNameById&nbsp;with&nbsp;direct&nbsp;array&nbsp;lookups&lt;br&gt;<br>
&gt;&gt;&gt; &nbsp;*&nbsp;DONE&nbsp;7.&nbsp;being&nbsp;looking&nbsp;at&nbsp;the&nbsp;other&nbsp;arrays&nbsp;removal&lt;br&gt;<br>
&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;In&nbsp;working&nbsp;on&nbsp;this&nbsp;I&nbsp;found&nbsp;out&nbsp;several&nbsp;instances&nbsp;of&nbsp;enum&nbsp;abuses&nbsp;-&lt;br&gt;<br>
&gt;&gt;&nbsp;tracking&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;those&nbsp;down&nbsp;has&nbsp;been&nbsp;the&nbsp;hardest&nbsp;part&nbsp;of&nbsp;the&nbsp;effort.&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;HttpHeader::parse&nbsp;is&nbsp;being&nbsp;used&nbsp;to&nbsp;parse&nbsp;error&nbsp;page&nbsp;templates&nbsp;-&nbsp;thus&nbsp;the&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;relaxed&nbsp;any_registered_header()&nbsp;checks&nbsp;in&nbsp;some&nbsp;methods,&nbsp;e.g.&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;HttpHdeader::addEntry().&lt;br&gt;<br>
&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;Next&nbsp;steps,&nbsp;if&nbsp;there&nbsp;is&nbsp;consensus:&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;-&nbsp;moving&nbsp;LookupTable&nbsp;away&nbsp;from&nbsp;std::map&nbsp;to&nbsp;std::hash&nbsp;with&nbsp;custom&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;gperf-derived&nbsp;Hashers&nbsp;for&nbsp;extra&nbsp;boost&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;-&nbsp;investigating&nbsp;whether&nbsp;strongly-typed&nbsp;enums&nbsp;can&nbsp;be&nbsp;used&nbsp;instead&nbsp;of&lt;br&gt;<br>
&gt;&gt;&nbsp;C-style&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;enums&nbsp;in&nbsp;more&nbsp;places.&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;-&nbsp;moving&nbsp;away&nbsp;from&nbsp;homegrown&nbsp;bitfields&nbsp;(CBIT_TEST&nbsp;etc.)&nbsp;towards&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;std::vector&lt;bool&gt;&nbsp;or&nbsp;std::vector&lt;unsigned&nbsp;char&gt;,&nbsp;possibly&nbsp;via&nbsp;a&nbsp;class&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;bitfield&nbsp;or&nbsp;somesuch.&lt;br&gt;<br>
&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;audit&nbsp;results:&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;*&nbsp;httpHdrCcCleanModule()&nbsp;and&nbsp;httpHdrScCleanModule()&nbsp;can&nbsp;both&nbsp;be&nbsp;fully&lt;br&gt;<br>
&gt;&gt;&nbsp;deleted&nbsp;now.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Yes.&nbsp;I&nbsp;chose&nbsp;to&nbsp;let&nbsp;them&nbsp;in:&nbsp;they&nbsp;are&nbsp;NOPs,&nbsp;not&nbsp;in&nbsp;the&nbsp;critical&nbsp;path,&nbsp;and&lt;br&gt;<br>
&gt;&nbsp;may&nbsp;be&nbsp;useful&nbsp;in&nbsp;the&nbsp;future.&nbsp;Let&nbsp;me&nbsp;know&nbsp;if&nbsp;you&nbsp;still&nbsp;want&nbsp;them&nbsp;removed.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;:-(&nbsp;more&nbsp;&#39;dead&#39;&nbsp;code.&nbsp;This&nbsp;kind&nbsp;of&nbsp;thing&nbsp;is&nbsp;useful&nbsp;for&lt;br&gt;<br>
ctpr/dtor/functor/virtual&nbsp;definition.&nbsp;But&nbsp;C&nbsp;functions&nbsp;that&nbsp;are&nbsp;not&nbsp;even&lt;br&gt;<br>
used&nbsp;as&nbsp;functors&nbsp;is&nbsp;a&nbsp;waste&nbsp;of&nbsp;LOC&nbsp;and&nbsp;also&nbsp;compiler&nbsp;time&nbsp;dealing&nbsp;with&lt;br&gt;<br>
the&nbsp;symbols.&lt;br&gt;<br>
 Its&nbsp;minor&nbsp;but&nbsp;still&nbsp;technical&nbsp;debt.&nbsp;The&nbsp;long-term&nbsp;plan&nbsp;is&nbsp;also&nbsp;to&nbsp;use&lt;br&gt;<br>
RegisteredRunners&nbsp;for&nbsp;this&nbsp;type&nbsp;of&nbsp;thing&nbsp;not&nbsp;C&nbsp;functions.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;Ok.&nbsp;Removed&nbsp;all&nbsp;empty&nbsp;module&nbsp;cleanup&nbsp;functions&nbsp;-&nbsp;which&nbsp;are&nbsp;only&nbsp;invoked&nbsp;if&nbsp;LEAKCHECK&nbsp;is&nbsp;enabled&nbsp;anyway.&lt;br&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;span&gt;<br>
&gt;&gt;&nbsp;*&nbsp;LookupTableRecord&nbsp;should&nbsp;be&nbsp;a&nbsp;class.&lt;br&gt;<br>
&gt;&gt; &nbsp;-&nbsp;custom&nbsp;storage&nbsp;types&nbsp;can&nbsp;then&nbsp;inherit&nbsp;from&nbsp;it,&nbsp;with&nbsp;it&nbsp;as&nbsp;the&nbsp;first&lt;br&gt;<br>
&gt;&gt;&nbsp;parent&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Well,&nbsp;templatization&nbsp;can&nbsp;prevent&nbsp;that&nbsp;need,&nbsp;but&nbsp;sure.&nbsp;Should&nbsp;I&nbsp;implement&lt;br&gt;<br>
&gt;&nbsp;that?&lt;br&gt;<br>
&gt;&nbsp;Isn&#39;t&nbsp;nowadays&nbsp;a&nbsp;struct&nbsp;==&nbsp;all-public&nbsp;class&nbsp;though?&nbsp;It&nbsp;looks&nbsp;odd,&nbsp;but&lt;br&gt;<br>
&gt;&nbsp;functionally&nbsp;is&nbsp;the&nbsp;same&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;Avoid&nbsp;&quot;looks&nbsp;odd&quot;&nbsp;whenever&nbsp;possible&nbsp;:-)&nbsp;as&nbsp;you&nbsp;say,&nbsp;the&nbsp;compiler&nbsp;dont&lt;br&gt;<br>
care.&nbsp;But&nbsp;this&nbsp;is&nbsp;about&nbsp;us&nbsp;humans&nbsp;quick&nbsp;and&nbsp;easy&nbsp;reading&nbsp;it&nbsp;in&nbsp;10&nbsp;years&lt;br&gt;<br>
time.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;think&nbsp;its&nbsp;okay&nbsp;for&nbsp;useful&nbsp;code&nbsp;optimizations.&nbsp;Bt&nbsp;then&nbsp;the&nbsp;design&lt;br&gt;<br>
choice&nbsp;needs&nbsp;documenting&nbsp;so&nbsp;nobody&nbsp;breaks&nbsp;or&nbsp;undoes&nbsp;it&nbsp;casually.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;Ok.&lt;br&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;span&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;in&nbsp;src/HttpHeader.cc:&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;*&nbsp;can&nbsp;you&nbsp;move&nbsp;the&nbsp;headerLookupTable&nbsp;to&nbsp;src/http/RegisteredHeaders.cc&lt;br&gt;<br>
&gt;&gt;&nbsp;and&nbsp;the&nbsp;Http::&nbsp;namespace&nbsp;as&nbsp;well&nbsp;please&nbsp;?&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Moved&nbsp;to&nbsp;RegisteredHeaders&nbsp;and&nbsp;renamed&nbsp;HDR_FOO&nbsp;to&nbsp;Http::HdrType::FOO&nbsp;.&lt;br&gt;<br>
&gt;&nbsp;Moving&nbsp;to&nbsp;a&nbsp;strongly-typed&nbsp;enum&nbsp;is&nbsp;unfortunately&nbsp;not&nbsp;feasible&nbsp;as&nbsp;eCAP&lt;br&gt;<br>
&gt;&nbsp;requires&nbsp;integer-enum&nbsp;equivalence;&nbsp;it&nbsp;may&nbsp;be&nbsp;that&nbsp;the&nbsp;whole&nbsp;change&nbsp;has&nbsp;to&lt;br&gt;<br>
&gt;&nbsp;be&nbsp;reverted.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;I&nbsp;thought&nbsp;&quot;enum&nbsp;class&quot;&nbsp;with&nbsp;first&nbsp;parameter&nbsp;value&nbsp;assigned&nbsp;0&lt;br&gt;<br>
(&quot;HDR_ACCEPT&nbsp;=&nbsp;0,&quot;)&nbsp;should&nbsp;do&nbsp;that.&nbsp;ie.&nbsp;strongly&nbsp;typed&nbsp;to&nbsp;unsigned&lt;br&gt;<br>
integer&nbsp;values.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;No.&lt;br&gt;&lt;/div&gt;&lt;div&gt;strongly-typed&nbsp;==&nbsp;doesn&#39;t&nbsp;automatically&nbsp;cast&nbsp;to&nbsp;int,&nbsp;if&nbsp;you&nbsp;use&nbsp;strongly-typed&nbsp;you&nbsp;have&nbsp;to&nbsp;static_cast,&nbsp;while&nbsp;for&nbsp;old-style&nbsp;enum&nbsp;casting&nbsp;is&nbsp;automatic.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;in&nbsp;c++11&nbsp;the&nbsp;full&nbsp;enum&nbsp;syntax&nbsp;(square&nbsp;brackets&nbsp;mean&nbsp;optional)&nbsp;is&lt;br&gt;&lt;/div&gt;&lt;div&gt;enum&nbsp;[&nbsp;class&nbsp;]&nbsp;enumName&nbsp;[&nbsp;:&nbsp;storage_specification&nbsp;]&nbsp;{&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp;enum_elem_1&nbsp;[&nbsp;=&nbsp;elem-1-representation&nbsp;],&lt;br&gt; &nbsp;...&lt;br&gt;};&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;where&nbsp;storage_specification&nbsp;is&nbsp;the&nbsp;underlying&nbsp;integral&nbsp;data&nbsp;type.&lt;br&gt;&lt;/div&gt;&lt;div&gt;Using&nbsp;the&nbsp;optional&nbsp;&quot;class&quot;&nbsp;specification&nbsp;disables&nbsp;auto-cast-to-int.&lt;br&gt;&lt;/div&gt;&lt;div&gt;Elements&nbsp;can&nbsp;then&nbsp;be&nbsp;referenced&nbsp;by&nbsp;enumName::enum_elem_name&nbsp;,&nbsp;where&nbsp;the&nbsp;enumName&nbsp;specification&nbsp;is&nbsp;mandatory&nbsp;for&nbsp;&quot;enum&nbsp;class&quot;,&nbsp;optional&nbsp;for&nbsp;old-style&nbsp;enum.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;BTW:&nbsp;I&#39;ve&nbsp;tried&nbsp;changing&nbsp;the&nbsp;underlying&nbsp;storage&nbsp;to&nbsp;unsigned,&nbsp;and&nbsp;I&nbsp;get&nbsp;asserts&nbsp;in&nbsp;masks&nbsp;calculation.&lt;br&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;span&gt;<br>
&gt;&gt;&nbsp;*&nbsp;any_registered_header()&nbsp;is&nbsp;wrong.&lt;br&gt;<br>
&gt;&gt; &nbsp;-&nbsp;it&nbsp;matches&nbsp;for&nbsp;HDR_OTHER&nbsp;which&nbsp;by&nbsp;definition&nbsp;is&nbsp;a&nbsp;non-registered&nbsp;header&lt;br&gt;<br>
&gt;&gt; &nbsp;-&nbsp;assert_eid()&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;any_valid_header()&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Then&nbsp;we&nbsp;need&nbsp;to&nbsp;change&nbsp;name.&nbsp;We&nbsp;need&nbsp;two&nbsp;semantics:&lt;br&gt;<br>
&gt;&nbsp;1)&nbsp;any&nbsp;header&nbsp;which&nbsp;is&nbsp;valid&nbsp;and&nbsp;defined&nbsp;(including&nbsp;OTHER)&lt;br&gt;<br>
&gt;&nbsp;2)&nbsp;any&nbsp;header&nbsp;ID&nbsp;which&nbsp;will&nbsp;not&nbsp;go&nbsp;out-of-bounds&nbsp;(same&nbsp;as&nbsp;(1)&nbsp;+&nbsp;HDR_BAD_HDR)&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;any&nbsp;suggestion?&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;(1)&nbsp;is&nbsp;already&nbsp;any_valid_header().&lt;br&gt;<br>
&lt;br&gt;<br>
(2)&nbsp;any_HdrType_enum_value()&lt;br&gt;<br>
&lt;br&gt;<br>
But&nbsp;where/why&nbsp;do&nbsp;we&nbsp;need&nbsp;(2)&nbsp;?&lt;br&gt;<br>
 Any&nbsp;value&nbsp;input&nbsp;or&nbsp;received&nbsp;that&nbsp;is&nbsp;non-(1)&nbsp;needs&nbsp;to&nbsp;be&nbsp;represented&nbsp;as&lt;br&gt;<br>
BAD_HDR&nbsp;when&nbsp;parsing/validating&nbsp;the&nbsp;input&nbsp;to&nbsp;an&nbsp;enum&nbsp;value.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;It&#39;s&nbsp;sprinkled&nbsp;all&nbsp;over&nbsp;the&nbsp;place,&nbsp;mostly&nbsp;meant&nbsp;to&nbsp;protect&nbsp;against&nbsp;int-related&nbsp;abuses&nbsp;which&nbsp;may&nbsp;end&nbsp;up&nbsp;causing&nbsp;out&nbsp;of&nbsp;bounds&nbsp;in&nbsp;arrays,&nbsp;vectors&nbsp;and&nbsp;masks.&nbsp;Moving&nbsp;to&nbsp;enum&nbsp;class&nbsp;would&nbsp;mean&nbsp;implicit&nbsp;safety&nbsp;in&nbsp;this&nbsp;regard,&nbsp;but&nbsp;would&nbsp;require&nbsp;accessor&nbsp;functions&nbsp;to&nbsp;ensure&nbsp;consistent&nbsp;checks&nbsp;in&nbsp;typecasts.&nbsp;Hello&nbsp;again&nbsp;HdrIdFromName&nbsp;and&nbsp;HdrDescFromId.&nbsp;I&#39;m&nbsp;cool&nbsp;with&nbsp;it,&nbsp;if&nbsp;that&#39;s&nbsp;a&nbsp;wise&nbsp;design&nbsp;decision&nbsp;in&nbsp;your&nbsp;opinion.&nbsp;It&#39;d&nbsp;save&nbsp;the&nbsp;need&nbsp;of&nbsp;a&nbsp;dozen&nbsp;asserts&nbsp;or&nbsp;so.&lt;br&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Are&nbsp;you&nbsp;looking&nbsp;at&nbsp;things&nbsp;HttpHeader.cc&nbsp;line&nbsp;~524:&lt;br&gt;<br>
&lt;br&gt;<br>
AA)&lt;br&gt;<br>
&lt;br&gt;<br>
+ &nbsp;if&nbsp;(e-&gt;id&nbsp;&gt;=&nbsp;Http::HdrType::ENUM_END)&nbsp;{&lt;br&gt;<br>
 &nbsp; &nbsp;debugs(55,&nbsp;DBG_CRITICAL,&nbsp;&quot;BUG:&nbsp;invalid&nbsp;entry&nbsp;(&quot;&nbsp;&lt;&lt;&nbsp;e-&gt;id&nbsp;&lt;&lt;&nbsp;&quot;)...&lt;br&gt;<br>
&lt;br&gt;<br>
That&nbsp;should&nbsp;probably&nbsp;be&nbsp;if(!any_valid_header(e-&gt;id))&nbsp;since&nbsp;BAD&nbsp;is&nbsp;also&lt;br&gt;<br>
invalid&nbsp;entry&nbsp;value&nbsp;for&nbsp;a&nbsp;header.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;aha,&nbsp;got&nbsp;it&nbsp;and&nbsp;turned&nbsp;in&nbsp;all&nbsp;places&nbsp;where&nbsp;ENUM_END&nbsp;is&nbsp;used&nbsp;to&nbsp;this&nbsp;end.&lt;br&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
If&nbsp;the&nbsp;logic&nbsp;there&nbsp;explicitly&nbsp;requires&nbsp;BAD&nbsp;handling,&nbsp;it&nbsp;should&nbsp;be:&lt;br&gt;<br>
 &nbsp;//&nbsp;some&nbsp;reason&nbsp;for&nbsp;why&nbsp;BAD&nbsp;is&nbsp;accepted&nbsp;as&nbsp;&#39;valid&#39;.&lt;br&gt;<br>
 &nbsp;if(!any_valid_header(e-&gt;id)&nbsp;&amp;&amp;&nbsp;e-&gt;id&nbsp;!=&nbsp;BAD)&lt;br&gt;<br>
&lt;br&gt;<br>
Although&nbsp;note&nbsp;that&nbsp;when&nbsp;parsing&nbsp;is&nbsp;fixed&nbsp;BAD&nbsp;will&nbsp;represent&nbsp;*any*&lt;br&gt;<br>
invalid&nbsp;value.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
or&nbsp;BB)&nbsp;the&nbsp;header&nbsp;manglers&nbsp;&quot;All&quot;&nbsp;?&lt;br&gt;<br>
&lt;br&gt;<br>
For&nbsp;that&nbsp;I&nbsp;think&nbsp;we&nbsp;need&nbsp;a&nbsp;new&nbsp;enum&nbsp;value&nbsp;like&nbsp;&quot;Other,&quot; &nbsp;(&quot;All,&quot;&nbsp;?)&lt;br&gt;<br>
which&nbsp;is&nbsp;outside&nbsp;registered&nbsp;headers,&nbsp;but&nbsp;valid&nbsp;only&nbsp;as&nbsp;an&nbsp;enum&nbsp;entry.&lt;br&gt;<br>
Currently&nbsp;END,&nbsp;but&nbsp;that&nbsp;needs&nbsp;a&nbsp;rename&nbsp;and&nbsp;never&nbsp;to&nbsp;be&nbsp;used&nbsp;by&lt;br&gt;<br>
non-mangler&nbsp;code.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;span&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt; &nbsp;-&nbsp;please&nbsp;consider&nbsp;removing&nbsp;the&nbsp;assert(assert(any_valid_header(id)))&lt;br&gt;<br>
&gt;&gt; &nbsp; &nbsp;it&nbsp;could&nbsp;probably&nbsp;be&nbsp;replaced&nbsp;by:&lt;br&gt;<br>
&gt;&gt; &nbsp; &nbsp; &nbsp; if&nbsp;(!assert(any_valid_header(id)))&lt;br&gt;<br>
&gt;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; id&nbsp;=&nbsp;HDR_OTHER&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Huh?&nbsp;I&nbsp;can&#39;t&nbsp;find&nbsp;any&nbsp;nested&nbsp;assert&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;copy-paste&nbsp;error&nbsp;on&nbsp;my&nbsp;part.&nbsp;It&nbsp;is&nbsp;the&nbsp;assert&nbsp;you&nbsp;are&nbsp;adding&nbsp;three&nbsp;lines&lt;br&gt;<br>
below&nbsp;what&nbsp;is&nbsp;now&nbsp;&quot;got&nbsp;hdr-id=&quot;&nbsp;in&nbsp;the&nbsp;chunk&nbsp;@1512.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;can&#39;t&nbsp;see&nbsp;the&nbsp;function&nbsp;name,&nbsp;but&nbsp;it&nbsp;looks&nbsp;like&nbsp;parsing&nbsp;some&nbsp;input.&lt;br&gt;<br>
Avoid&nbsp;assert&nbsp;in&nbsp;all&nbsp;parsers.&nbsp;Output&nbsp;BAD&nbsp;or&nbsp;OTHER&nbsp;as&nbsp;appropriate&nbsp;instead.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;It&#39;s&nbsp;HttpHeader::parse.&lt;br&gt;&lt;/div&gt;&lt;div&gt;That&nbsp;assert&nbsp;is&nbsp;actually&nbsp;useless:&nbsp;it&#39;s&nbsp;set&nbsp;by&nbsp;a&nbsp;HeaderLookupTable.lookup.&nbsp;It&#39;s&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;valid&nbsp;(if&nbsp;BAD,&nbsp;and&nbsp;the&nbsp;BAD&nbsp;case&nbsp;is&nbsp;handled&nbsp;by&nbsp;reassigning&nbsp;to&nbsp;OTHER.&lt;br&gt;&lt;/div&gt;&lt;div&gt;Removing&nbsp;that&nbsp;assert&nbsp;full&nbsp;stop.&lt;br&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
I&nbsp;been&nbsp;thinking&nbsp;a&nbsp;bit&nbsp;more&nbsp;(sorry&nbsp;dangerous).&lt;br&gt;<br>
&lt;br&gt;<br>
It&nbsp;may&nbsp;be&nbsp;worth&nbsp;adjusting&nbsp;the&nbsp;src/mk-string-arrays.awk&nbsp;script&nbsp;to&nbsp;also&nbsp;be&lt;br&gt;<br>
capable&nbsp;of&nbsp;output&nbsp;LookupTable&lt;X&gt;::Record&nbsp;arrays.&nbsp;That&nbsp;script&nbsp;is&nbsp;designed&lt;br&gt;<br>
to&nbsp;guarantee&nbsp;invariance.&nbsp;Though&nbsp;it&nbsp;does&nbsp;leave&nbsp;us&nbsp;with&nbsp;another&nbsp;.cc.&lt;br&gt;<br>
Anyhow&nbsp;thats&nbsp;a&nbsp;followup&nbsp;to&nbsp;think&nbsp;about,&nbsp;not&nbsp;in&nbsp;this&nbsp;scope.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;I&nbsp;agree&nbsp;on&nbsp;it&nbsp;not&nbsp;being&nbsp;in&nbsp;scope.&nbsp;Also&nbsp;because&nbsp;if&nbsp;we&nbsp;wish&nbsp;to&nbsp;use&nbsp;gperf&nbsp;to&nbsp;generate&nbsp;the&nbsp;perfect&nbsp;hashes,&nbsp;then&nbsp;gperf&nbsp;could&nbsp;(and&nbsp;thus&nbsp;should)&nbsp;do&nbsp;that&nbsp;for&nbsp;us&nbsp;(see&nbsp;&lt;a&nbsp;href=&quot;http://www.gnu.org/software/gperf/manual/html_node/User_002dsupplied-Struct.html#User_002dsupplied-Struct&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.gnu.org/software/gperf/manual/html_node/User_002dsupplied-Struct.html#User_002dsupplied-Struct&lt;/a&gt;&nbsp;)&lt;/div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
second&nbsp;round&nbsp;audit:&lt;br&gt;<br>
&lt;br&gt;<br>
in&nbsp;src/HttpHdrCc.cc:&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;valid_id&nbsp;in&nbsp;httpHdrCcStatDumper()&nbsp;can&nbsp;probably&nbsp;be&nbsp;a&nbsp;const&nbsp;bool&nbsp;like&lt;br&gt;<br>
the&nbsp;other.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;Yes.&nbsp;Done.&nbsp;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
in&nbsp;src/HttpHdrSc.cc:&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;useless&nbsp;include&nbsp;of&nbsp;dlink.h&nbsp;since&nbsp;its&nbsp;done&nbsp;in&nbsp;the&nbsp;.h&lt;br&gt;&lt;/blockquote&gt;&lt;/span&gt;&lt;div&gt;&lt;br&gt;Ok.&lt;br&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
*&nbsp;a&nbsp;duplicate&nbsp;include&nbsp;of&nbsp;HttpHdrSc.h&nbsp;since&nbsp;its&nbsp;pulled&nbsp;in&nbsp;by&lt;br&gt;<br>
HttpHdrScTarget.h.&lt;br&gt;<br>
 -&nbsp;but&nbsp;in&nbsp;this&nbsp;case&nbsp;I&nbsp;think&nbsp;replece&nbsp;it&nbsp;with:&lt;br&gt;<br>
 &nbsp;//#include&nbsp;&quot;HttpHdrSc.h&quot;&nbsp;//&nbsp;pulled&nbsp;in&nbsp;by&nbsp;HttpHdrScTarget.h&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;Done.&nbsp;Good&nbsp;idea,&nbsp;it&#39;d&nbsp;look&nbsp;odd&nbsp;otherwise.&lt;br&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
in&nbsp;src/HttpHdrSc.h:&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;please&nbsp;use&nbsp;mem/forward.h&nbsp;instead&nbsp;of&nbsp;mem/AllocatorProxy.h&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;Ok&lt;br&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
*&nbsp;please&nbsp;store&nbsp;the&nbsp;class&nbsp;pre-defines&nbsp;alphabetically.&lt;br&gt;<br>
 -&nbsp;Packable&nbsp;above&nbsp;StatHist.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;Done.&nbsp;&lt;br&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
in&nbsp;src/HttpHdrScTarget.cc:&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;useless&nbsp;include&nbsp;of&nbsp;HttpHdrSc.h&lt;br&gt;<br>
 -&nbsp;thanks&nbsp;for&nbsp;fixing&nbsp;the&nbsp;missing&nbsp;HttpHdrScTarget.h&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;Done.&nbsp;NP&nbsp;:)&lt;br&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
in&nbsp;src/HttpHdrScTarget.h:&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;now&nbsp;has&nbsp;useless&nbsp;include&nbsp;of&nbsp;mem/forward.h&nbsp;(after&nbsp;above&nbsp;fix),&lt;br&gt;<br>
SquidString.h,&nbsp;dlink.h,&nbsp;typedefs.h&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/span&gt;&lt;div&gt;Ok.&lt;br&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
in&nbsp;src/HttpHeader.cc:&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;please&nbsp;take&nbsp;the&nbsp;opportunity&nbsp;to&nbsp;remove&nbsp;useless&nbsp;includes&nbsp;overlapping&lt;br&gt;<br>
with&nbsp;HttpHdrCc.h&nbsp;and&nbsp;HttpHdrSc.h&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;Done.&nbsp;I&#39;ve&nbsp;commented&nbsp;them&nbsp;and&nbsp;mentioned&nbsp;the&nbsp;indirect&nbsp;inclusion&nbsp;in&nbsp;a&nbsp;comment.&lt;br&gt; &lt;br&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
*&nbsp;please&nbsp;replace&nbsp;include&nbsp;fof&nbsp;HttpHdrSc.h&nbsp;with&nbsp;HttpHdrScTarget.h&nbsp;in&nbsp;the&lt;br&gt;<br>
new&nbsp;include&nbsp;nesting.&lt;br&gt;<br>
 -&nbsp;also&nbsp;checking&nbsp;for&nbsp;duplicate&nbsp;includes&nbsp;between&nbsp;HttpHdrScTarget.h&nbsp;and&lt;br&gt;<br>
HttpHeader.cc&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;Ok.&lt;br&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
*&nbsp;chunk&nbsp;@562,&nbsp;s/NULL/nullptr/&lt;br&gt;<br>
 -&nbsp;maybe&nbsp;others&nbsp;in&nbsp;the&nbsp;touched&nbsp;lines&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;Done.&lt;br&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
*&nbsp;HttpHeaderEntry&nbsp;dtor&nbsp;use&nbsp;of&nbsp;assert(any_valid_header(id));&nbsp;at&nbsp;the&nbsp;top&lt;br&gt;<br>
is&nbsp;needless.&lt;br&gt;<br>
 -&nbsp;protect&nbsp;the&nbsp;stats&nbsp;accounting&nbsp;against&nbsp;BAD&nbsp;though&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;Done.&lt;br&gt; &lt;br&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
*&nbsp;HttpHeaderEntry&nbsp;ctor&nbsp;accepts&nbsp;OTHER&nbsp;but&nbsp;also&nbsp;&quot;anId&nbsp;!=&nbsp;BAD&quot;&nbsp;implies&nbsp;that&lt;br&gt;<br>
it&nbsp;accepts&nbsp;BAD&nbsp;as&nbsp;well&nbsp;despite&nbsp;the&nbsp;previous&lt;br&gt;<br>
assert(any_registered_header(anId)).&lt;br&gt;<br>
 -&nbsp;wrap&nbsp;the&nbsp;stats&nbsp;accounting&nbsp;in&nbsp;if&nbsp;(id&nbsp;!=&nbsp;BAD).&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;done&lt;br&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
 -&nbsp;fixing&nbsp;those&nbsp;ctor/dtor&nbsp;asserts&nbsp;will&nbsp;avoid&nbsp;any&nbsp;potential&nbsp;for&nbsp;assertion&lt;br&gt;<br>
from&nbsp;temporary&nbsp;default-&nbsp;or&nbsp;partially-&nbsp;constructed&nbsp;objects,&nbsp;or&nbsp;bad&lt;br&gt;<br>
emplacement&nbsp;destructions.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;..which&nbsp;are&nbsp;not&nbsp;there,&nbsp;or&nbsp;we&#39;d&nbsp;assert&nbsp;all&nbsp;over&nbsp;the&nbsp;place.&nbsp;But&nbsp;sure.&lt;br&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
in&nbsp;src/acl/RequestHeaderStrategy.h:&lt;br&gt;<br>
&lt;br&gt;<br>
 *&nbsp;please&nbsp;take&nbsp;the&nbsp;opportunity&nbsp;to&nbsp;remove&nbsp;that&nbsp;empty&nbsp;line&nbsp;between&lt;br&gt;<br>
&#39;template&#39;&nbsp;and&nbsp;&#39;class&#39;&nbsp;at&nbsp;lines&nbsp;at&nbsp;~14&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;Done&nbsp;&lt;br&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
in&nbsp;src/http/RegisteredHeaders.cc:&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;please&nbsp;add&nbsp;empty&nbsp;line&nbsp;between&nbsp;namespace&nbsp;&#39;{&#39;&nbsp;and&nbsp;start&nbsp;of&nbsp;comment.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;Ok&lt;br&gt; &lt;br&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
in&nbsp;src/http/RegisteredHeaders.h:&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;please&nbsp;document&nbsp;on&nbsp;HeaderTable&nbsp;that&nbsp;lookup()&nbsp;will&nbsp;return&nbsp;BAD&nbsp;if&nbsp;the&lt;br&gt;<br>
header&nbsp;is&nbsp;unknown&nbsp;/&nbsp;unregistered.&nbsp;callers&nbsp;need&nbsp;to&nbsp;check&nbsp;and&nbsp;handle&nbsp;that&lt;br&gt;<br>
case&nbsp;properly.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;Ok.&lt;br&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
I&nbsp;think&nbsp;that&nbsp;is&nbsp;all.&nbsp;And&nbsp;all&nbsp;polish&nbsp;:-)&lt;br&gt;<br>
&lt;br&gt;<br>
+1&nbsp;on&nbsp;this&nbsp;so&nbsp;far.&nbsp;Though&nbsp;you/we&nbsp;still&nbsp;need&nbsp;to&nbsp;sort&nbsp;the&nbsp;valid&nbsp;registered&lt;br&gt;<br>
ID&nbsp;tests&nbsp;before&nbsp;commit.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;I&nbsp;think&nbsp;I&nbsp;have&nbsp;fixed&nbsp;those,&nbsp;although&nbsp;it&#39;s&nbsp;hard&nbsp;to&nbsp;be&nbsp;sure&nbsp;-&nbsp;layering&nbsp;violations&nbsp;all&nbsp;over&nbsp;the&nbsp;place.&lt;br&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
NOTE:&nbsp;these&nbsp;are&nbsp;about&nbsp;old&nbsp;bugs&nbsp;you&nbsp;are&nbsp;uncovering.&nbsp;I&#39;d&nbsp;like&nbsp;to&nbsp;take&nbsp;the&lt;br&gt;<br>
opportunity&nbsp;to&nbsp;fix&nbsp;them.&nbsp;But&nbsp;this&nbsp;is&nbsp;already&nbsp;huge,&nbsp;so&nbsp;for&nbsp;now&nbsp;just&nbsp;XXX&lt;br&gt;<br>
mark&nbsp;it&nbsp;and&nbsp;followup&nbsp;patch.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/span&gt;&lt;div&gt;Like&nbsp;many&nbsp;other&nbsp;areas,&nbsp;there&nbsp;is&nbsp;(plenty&nbsp;of)&nbsp;room&nbsp;for&nbsp;improvement&nbsp;:)&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;not&nbsp;performance-wise,&nbsp;certainly&nbsp;code-wise.&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&#39;d&nbsp;leave&nbsp;them&nbsp;as&nbsp;a&nbsp;follow-up&nbsp;effort.&lt;br&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
*&nbsp;I&#39;m&nbsp;still&nbsp;not&nbsp;clear&nbsp;on&nbsp;why&nbsp;insertEntry()&nbsp;checks&nbsp;for&nbsp;valid&nbsp;header&nbsp;enum&lt;br&gt;<br>
values&nbsp;but&nbsp;addEntry()&nbsp;needs&nbsp;to&nbsp;accept&nbsp;BAD.&lt;br&gt;<br>
 -&nbsp;if&nbsp;that&nbsp;need&nbsp;is&nbsp;true&nbsp;its&nbsp;worth&nbsp;a&nbsp;comment&nbsp;to&nbsp;document.&nbsp;otherwise&lt;br&gt;<br>
update&nbsp;top&nbsp;of&nbsp;addEntry()&nbsp;to&nbsp;match&nbsp;insertEntry().&lt;br&gt;<br>
 -&nbsp;NP:&nbsp;we&nbsp;should&nbsp;*never*&nbsp;be&nbsp;adding&nbsp;a&nbsp;BAD/invalid&nbsp;header&nbsp;entry&nbsp;to&nbsp;a&lt;br&gt;<br>
message&nbsp;object.&nbsp;Custom&nbsp;ones&nbsp;yes,&nbsp;but&nbsp;they&nbsp;are&nbsp;OTHER.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;like&nbsp;has()&nbsp;all&nbsp;the&nbsp;has/put/get*(ID,&nbsp;...)&nbsp;methods&nbsp;need&nbsp;to&nbsp;exclude&nbsp;BAD&lt;br&gt;<br>
and&nbsp;OTHER&nbsp;as&nbsp;a&nbsp;valid&nbsp;inputs.&lt;br&gt;<br>
 -&nbsp;OTHER&nbsp;means&nbsp;we&nbsp;are&nbsp;accessing&nbsp;and&nbsp;using&nbsp;the&nbsp;Entry&nbsp;by&nbsp;string&nbsp;name,&nbsp;not&lt;br&gt;<br>
by&nbsp;ID&nbsp;value.&lt;br&gt;<br>
 -&nbsp;BAD&nbsp;means&nbsp;we&nbsp;should&nbsp;never&nbsp;have&nbsp;put&nbsp;it&nbsp;into&nbsp;object&nbsp;in&nbsp;the&nbsp;first&nbsp;place.&lt;br&gt;<br>
 -&nbsp;the&nbsp;put*(ID,&nbsp;...)&nbsp;accepting&nbsp;OTHER&nbsp;may&nbsp;be&nbsp;where&nbsp;addEntry(ID,...)&nbsp;goes&lt;br&gt;<br>
wrong.&lt;br&gt;<br>
 -&nbsp;sorry&nbsp;these&nbsp;seem&nbsp;to&nbsp;have&nbsp;got&nbsp;caught&nbsp;in&nbsp;cleaning&nbsp;up&nbsp;one&nbsp;of&nbsp;my&nbsp;earlier&lt;br&gt;<br>
comments&nbsp;which&nbsp;was&nbsp;about&nbsp;another&nbsp;changed&nbsp;use&nbsp;of&nbsp;assert_eid().&lt;br&gt;<br>
assert_eid()&nbsp;test&nbsp;was&nbsp;wrong&nbsp;for&nbsp;these&nbsp;get/put/has*(ID,...)&nbsp;to&nbsp;begin&nbsp;with.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
[[&nbsp;httpHeaderFieldStatDumper()&nbsp;earning&nbsp;itself&nbsp;a&nbsp;place&nbsp;in&nbsp;the&nbsp;hall&nbsp;of&lt;br&gt;<br>
horrors&nbsp;:-(&lt;br&gt;<br>
 &nbsp;...,&nbsp;double&nbsp;val,&nbsp;...&lt;br&gt;<br>
 &nbsp;const&nbsp;int&nbsp;id&nbsp;=&nbsp;static_cast&lt;int&gt;(val);&lt;br&gt;<br>
 &nbsp;const&nbsp;bool&nbsp;valid_id&nbsp;=&nbsp;id&nbsp;&lt;&nbsp;Http::HdrType::ENUM_END;&lt;br&gt;<br>
 //&nbsp;back&nbsp;away,&nbsp;quietly&nbsp;...&lt;br&gt;<br>
]]&lt;br&gt;<br>
&lt;span&gt;&lt;/span&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;/span&gt;&lt;/div&gt;&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;&lt;div&gt; &nbsp; &nbsp;Francesco&lt;/div&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&gt; &nbsp; &nbsp;Francesco&lt;/div&gt;<br>
&lt;/div&gt;<br>

</tt>
