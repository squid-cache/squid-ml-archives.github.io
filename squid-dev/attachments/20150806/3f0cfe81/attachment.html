<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Hi,&lt;br&gt;&lt;/div&gt; &nbsp;the&nbsp;preliminary&nbsp;polygraph&nbsp;results&nbsp;for&nbsp;using&nbsp;a&nbsp;std::unordered_map&nbsp;with&nbsp;a&nbsp;perfect&nbsp;hash&nbsp;(generated&nbsp;by&nbsp;gperf)&nbsp;to&nbsp;do&nbsp;RegisteredHeader&nbsp;-&gt;&nbsp;HttpHdr&nbsp;lookups&nbsp;are&nbsp;in,&nbsp;and&nbsp;are&nbsp;quite&nbsp;disappointing.&lt;br&gt;&lt;/div&gt;The&nbsp;hash&nbsp;is&nbsp;as&nbsp;effective&nbsp;as&nbsp;it&nbsp;can&nbsp;be:&nbsp;two&nbsp;table&nbsp;lookups&nbsp;and&nbsp;simple&nbsp;calculations.&nbsp;Yet&nbsp;when&nbsp;using&nbsp;it&nbsp;squid&nbsp;loses&nbsp;about&nbsp;10RPS&nbsp;(on&nbsp;about&nbsp;2k)&nbsp;over&nbsp;std::map&nbsp;(-0.5%&nbsp;performance);&nbsp;I&nbsp;guess&nbsp;that&nbsp;for&nbsp;a&nbsp;small&nbsp;hash&nbsp;such&nbsp;as&nbsp;the&nbsp;one&nbsp;we&#39;re&nbsp;using,&nbsp;the&nbsp;effort&nbsp;to&nbsp;walk&nbsp;the&nbsp;hash&nbsp;structure&nbsp;&lt;br&gt;&lt;/div&gt;I&#39;ll&nbsp;next&nbsp;try&nbsp;to&nbsp;go&nbsp;the&nbsp;full&nbsp;length&nbsp;and&nbsp;get&nbsp;rid&nbsp;of&nbsp;std::unordered_map&nbsp;and&nbsp;using&nbsp;gperf&nbsp;for&nbsp;all&nbsp;the&nbsp;work&nbsp;(it&nbsp;stores&nbsp;data&nbsp;in&nbsp;a&nbsp;single&nbsp;const&nbsp;array),&nbsp;and&nbsp;I&#39;ll&nbsp;validate&nbsp;the&nbsp;numbers,&nbsp;but&nbsp;if&nbsp;things&nbsp;won&#39;t&nbsp;change&nbsp;significantly,&nbsp;I&#39;ll&nbsp;just&nbsp;stick&nbsp;with&nbsp;std::map.&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&gt; &nbsp; &nbsp;Francesco&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
