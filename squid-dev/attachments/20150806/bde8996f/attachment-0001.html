<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Aug&nbsp;6,&nbsp;2015&nbsp;at&nbsp;12:38&nbsp;AM,&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;span&gt;On&nbsp;08/05/2015&nbsp;09:33&nbsp;AM,&nbsp;Kinkie&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;crossed&nbsp;the&nbsp;topic&nbsp;of&nbsp;enumerating&nbsp;over&nbsp;iterations.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;You&nbsp;mean&nbsp;iterating&nbsp;enum[eration]s&nbsp;:-)&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;my&nbsp;thinking&nbsp;cap&nbsp;backwards&nbsp;;)&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;span&gt;<br>
&gt;&nbsp;We&nbsp;kind-of&nbsp;follow&nbsp;(C-ish)best&lt;br&gt;<br>
&gt;&nbsp;practices&nbsp;on&nbsp;that,&nbsp;but&nbsp;that&nbsp;got&nbsp;me&nbsp;wondering&nbsp;if&nbsp;we&nbsp;can&nbsp;do&nbsp;better.&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;came&nbsp;up&nbsp;with&nbsp;a&nbsp;trinket&nbsp;which&nbsp;on&nbsp;its&nbsp;face&nbsp;looks&nbsp;quite&nbsp;elegant&nbsp;to&nbsp;me,&lt;br&gt;<br>
&gt;&nbsp;and&nbsp;I&#39;d&nbsp;like&nbsp;to&nbsp;understand&nbsp;with&nbsp;you&nbsp;guys&nbsp;if&nbsp;it&nbsp;makes&nbsp;sense&nbsp;to&nbsp;deploy&nbsp;it&lt;br&gt;<br>
&gt;&nbsp;in&nbsp;our&nbsp;code.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;Maybe,&nbsp;after&nbsp;quite&nbsp;a&nbsp;few&nbsp;changes.&nbsp;It&nbsp;is&nbsp;risky&nbsp;for&nbsp;me&nbsp;to&nbsp;review&nbsp;this&lt;br&gt;<br>
because&nbsp;the&nbsp;problems&nbsp;in&nbsp;the&nbsp;posted&nbsp;code&nbsp;lie&nbsp;on&nbsp;several&nbsp;very&nbsp;different&lt;br&gt;<br>
layers,&nbsp;the&nbsp;code&nbsp;is&nbsp;outside&nbsp;Squid&nbsp;context,&nbsp;and&nbsp;I&nbsp;am&nbsp;not&nbsp;even&nbsp;sure&nbsp;what&lt;br&gt;<br>
[CODE]&nbsp;thread&nbsp;designation&nbsp;means.&nbsp;I&nbsp;hope&nbsp;this&nbsp;does&nbsp;not&nbsp;lead&nbsp;to&nbsp;a&nbsp;long&lt;br&gt;<br>
discussion,&nbsp;but&nbsp;here&nbsp;are&nbsp;a&nbsp;few&nbsp;things&nbsp;to&nbsp;consider:&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[CODE]&nbsp;means&nbsp;that&nbsp;it&nbsp;contains&nbsp;code&nbsp;which&nbsp;is&nbsp;not&nbsp;a&nbsp;[PATCH]&nbsp;but&nbsp;meant&nbsp;to&nbsp;spark&nbsp;a&nbsp;discussion&nbsp;which&nbsp;may&nbsp;or&nbsp;may&nbsp;not&nbsp;result&nbsp;into&nbsp;a&nbsp;patch.&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;hope&nbsp;that&nbsp;the&nbsp;discussion&nbsp;will&nbsp;be&nbsp;fruitful,&nbsp;I&nbsp;don&#39;t&nbsp;mind&nbsp;if&nbsp;it&#39;s&nbsp;long&nbsp;as&nbsp;long&nbsp;as&nbsp;it&nbsp;doesn&#39;t&nbsp;waste&nbsp;people&#39;s&nbsp;time&nbsp;(read:&nbsp;it&#39;s&nbsp;fruitful)&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
*&nbsp;Iterating&nbsp;enums&nbsp;under&nbsp;Squid&nbsp;control&nbsp;ought&nbsp;to&nbsp;be&nbsp;a&nbsp;lot&nbsp;easier,&nbsp;safer,&lt;br&gt;<br>
and&nbsp;cheaper&nbsp;because&nbsp;we&nbsp;can&nbsp;add&nbsp;begin/end&nbsp;markers&nbsp;*with&nbsp;standard&nbsp;names*&lt;br&gt;<br>
to&nbsp;each&nbsp;enum.&nbsp;This&nbsp;is&nbsp;important&nbsp;because&nbsp;most&nbsp;iterations&nbsp;iterate&lt;br&gt;<br>
everything&nbsp;_and_&nbsp;C++11&nbsp;range&nbsp;loops&nbsp;always&nbsp;iterate&nbsp;everything.&nbsp;The&lt;br&gt;<br>
&quot;everything&quot;&nbsp;case&nbsp;is&nbsp;worth&nbsp;focusing&nbsp;on!&nbsp;See&nbsp;attached&nbsp;files&nbsp;for&nbsp;examples&lt;br&gt;<br>
of&nbsp;how&nbsp;standardized&nbsp;begin/end&nbsp;marks&nbsp;can&nbsp;be&nbsp;used.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;agree.&nbsp;We&#39;d&nbsp;need&nbsp;to&nbsp;take&nbsp;care&nbsp;to&nbsp;avoid&nbsp;the&nbsp;anti-pattern&nbsp;of&nbsp;&quot;iterate&nbsp;over&nbsp;everything&nbsp;but&nbsp;not&nbsp;really&nbsp;everything&quot;,&nbsp;but&nbsp;that&#39;s&nbsp;exactly&nbsp;the&nbsp;itch&nbsp;I&nbsp;was&nbsp;trying&nbsp;to&nbsp;scratch,&nbsp;and&nbsp;found&nbsp;unsatisfactorily&nbsp;scratched&nbsp;in&nbsp;my&nbsp;online&nbsp;research.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
*&nbsp;Your&nbsp;Iterator&nbsp;class&nbsp;is&nbsp;mixing&nbsp;two&nbsp;very&nbsp;different&nbsp;interfaces/APIs:&nbsp;One&lt;br&gt;<br>
provides&nbsp;begin/end()&nbsp;methods&nbsp;and&nbsp;is&nbsp;required&nbsp;for&nbsp;range&nbsp;loops&nbsp;(I&nbsp;do&nbsp;not&lt;br&gt;<br>
know&nbsp;how&nbsp;this&nbsp;API&nbsp;is&nbsp;called&nbsp;in&nbsp;the&nbsp;C++&nbsp;standard).&nbsp;The&nbsp;other&nbsp;one&nbsp;is&nbsp;a&lt;br&gt;<br>
[partial]&nbsp;iterator&nbsp;API.&nbsp;Do&nbsp;not&nbsp;mix&nbsp;those&nbsp;two&nbsp;APIs!&nbsp;Each&nbsp;of&nbsp;the&nbsp;attached&lt;br&gt;<br>
files&nbsp;illustrates&nbsp;how&nbsp;to&nbsp;separate&nbsp;them&nbsp;(and&nbsp;there&nbsp;are&nbsp;two&nbsp;ways&nbsp;to&lt;br&gt;<br>
implement&nbsp;the&nbsp;second/iterator&nbsp;API).&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Yes,&nbsp;I&nbsp;had&nbsp;unintentionally&nbsp;borrowed&nbsp;from&nbsp;Python&nbsp;where&nbsp;an&nbsp;object&nbsp;sometimes&nbsp;is&nbsp;its&nbsp;own&nbsp;iterator.&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;don&#39;t&nbsp;have&nbsp;any&nbsp;particular&nbsp;attachment&nbsp;to&nbsp;the&nbsp;way&nbsp;I&nbsp;coded&nbsp;this&nbsp;-&nbsp;if&nbsp;that&#39;s&nbsp;what&nbsp;you&nbsp;are&nbsp;afraid&nbsp;of&nbsp;when&nbsp;you&nbsp;refer&nbsp;to&nbsp;the&nbsp;long&nbsp;discussion.&nbsp;Anything&nbsp;that&nbsp;is&nbsp;well&nbsp;self-contained&nbsp;and&nbsp;easy&nbsp;to&nbsp;use&nbsp;will&nbsp;fill&nbsp;the&nbsp;bill&nbsp;for&nbsp;me&nbsp;:)&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
*&nbsp;The&nbsp;stand-alone&nbsp;iterator&nbsp;API&nbsp;implementation&nbsp;in&lt;br&gt;<br>
t-enum-stand-alone-v3.cc&nbsp;allows&nbsp;for&nbsp;nice&nbsp;explicit&nbsp;for-loops&nbsp;and&nbsp;such,&lt;br&gt;<br>
but&nbsp;those&nbsp;global&nbsp;operators&nbsp;are&nbsp;rather&nbsp;invasive,&nbsp;and&nbsp;I&nbsp;am&nbsp;worried&nbsp;they&lt;br&gt;<br>
will&nbsp;cause&nbsp;problems&nbsp;in&nbsp;Squid&nbsp;context&nbsp;(as&nbsp;opposed&nbsp;a&nbsp;tiny&nbsp;test&nbsp;file!).&nbsp;I&lt;br&gt;<br>
recommend&nbsp;that&nbsp;you&nbsp;start&nbsp;with&nbsp;t-enum-v3.cc&nbsp;and&nbsp;then&nbsp;diff&nbsp;the&nbsp;two&lt;br&gt;<br>
attached&nbsp;files&nbsp;to&nbsp;see&nbsp;changes&nbsp;related&nbsp;to&nbsp;the&nbsp;stand-alone&nbsp;iterator&nbsp;API&lt;br&gt;<br>
implementation.&nbsp;If&nbsp;you&nbsp;really&nbsp;like&nbsp;stand-alone&nbsp;operator&nbsp;side-effects,&lt;br&gt;<br>
you&nbsp;may&nbsp;want&nbsp;to&nbsp;investigate&nbsp;whether&nbsp;they&nbsp;would&nbsp;work&nbsp;well&nbsp;in&nbsp;Squid&nbsp;context.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Instinctivelty&nbsp;I&nbsp;would&nbsp;go&nbsp;for&nbsp;the&nbsp;class-based&nbsp;approach&nbsp;as&nbsp;it&nbsp;feels&nbsp;less&nbsp;invasive.&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;I&nbsp;understand&nbsp;from&nbsp;the&nbsp;changes&nbsp;you&nbsp;propose&nbsp;is&nbsp;that:&lt;br&gt;&lt;/div&gt;&lt;div&gt;1.&nbsp;instead&nbsp;of&nbsp;having&nbsp;explicit&nbsp;begin/end&nbsp;markers&nbsp;passed&nbsp;as&nbsp;template&nbsp;arguments&nbsp;you&nbsp;propose&nbsp;to&nbsp;have&nbsp;a&nbsp;convention&nbsp;on&nbsp;begin/end&nbsp;markers.&lt;br&gt;&lt;/div&gt;&lt;div&gt;2.&nbsp;you&nbsp;skip&nbsp;the&nbsp;typedef&nbsp;fixing&nbsp;these&nbsp;parameters&nbsp;in&nbsp;favor&nbsp;of&nbsp;letting&nbsp;the&nbsp;template&nbsp;parameters&nbsp;appear&nbsp;in&nbsp;the&nbsp;calls.&nbsp;This&nbsp;is&nbsp;quite&nbsp;consistent&nbsp;with&nbsp;an&nbsp;approach&nbsp;often&nbsp;taken&nbsp;in&nbsp;the&nbsp;stdlib&nbsp;(e.g.&nbsp;std::numeric_limits).&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1.&nbsp;looks&nbsp;interesting,&nbsp;especially&nbsp;as&nbsp;an&nbsp;enum&nbsp;missing&nbsp;those&nbsp;markers&nbsp;will&nbsp;fail&nbsp;to&nbsp;compile.&nbsp;Maybe&nbsp;both&nbsp;approaches&nbsp;can&nbsp;be&nbsp;combined&nbsp;by&nbsp;using&nbsp;default&nbsp;template&nbsp;arguments,&nbsp;what&nbsp;do&nbsp;you&nbsp;think?&lt;br&gt;&lt;/div&gt;&lt;div&gt;template&nbsp;&lt;typename&nbsp;C,&nbsp;C&nbsp;first&nbsp;=&nbsp;C::enumBegin_,&nbsp;C&nbsp;last_plus_one&nbsp;=&nbsp;C::enumEnd_&gt;&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2.&nbsp;looks&nbsp;verbose&nbsp;to&nbsp;me,&nbsp;but&nbsp;it&nbsp;can&nbsp;be&nbsp;decided&nbsp;on&nbsp;a&nbsp;case-by-case&nbsp;basis,&nbsp;which&nbsp;can&nbsp;be&nbsp;a&nbsp;good&nbsp;or&nbsp;a&nbsp;bad&nbsp;thing.&lt;br&gt;&lt;/div&gt;&lt;div&gt;3.&nbsp;we&nbsp;could&nbsp;maybe&nbsp;combine&nbsp;the&nbsp;benefits&nbsp;of&nbsp;beautiful&nbsp;range-for&nbsp;and&nbsp;ugly&nbsp;explicit-for&nbsp;also&nbsp;for&nbsp;shorter&nbsp;ranges&nbsp;by&nbsp;having&nbsp;(in&nbsp;the&nbsp;class-based&nbsp;variant),&nbsp;on&nbsp;top&nbsp;of&nbsp;what&nbsp;you&nbsp;have&nbsp;already&nbsp;proposed&nbsp;(untested)&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;template&nbsp;&lt;typename&nbsp;Enum&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;class&nbsp;WholeEnum&lt;br&gt;{&lt;br&gt;&lt;/div&gt;&lt;div&gt;  &nbsp;Enum&nbsp;first,&nbsp;lastplusone;&lt;br&gt;&lt;/div&gt;&lt;div&gt;public:&lt;br&gt;&lt;/div&gt;&lt;div&gt;  &nbsp;WholeEnum&nbsp;(Enum&nbsp;firstValue,&nbsp;Enum&nbsp;lastValuePlusOne)&nbsp;:&nbsp;first(firstValue),&nbsp;lastplusone(lastValuePlusOne)&nbsp;{}&lt;br&gt;&lt;/div&gt;&lt;div&gt;  &nbsp;Iterator&nbsp;begin()&nbsp;{&nbsp;return&nbsp;Iterator(first);&nbsp;}&lt;br&gt;&lt;/div&gt;&lt;div&gt;  &nbsp;Iterator&nbsp;end()&nbsp;{&nbsp;return&nbsp;Iterator(lastplusone);&nbsp;}&lt;br&gt;}&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;this&nbsp;would&nbsp;allow&nbsp;to&nbsp;do&lt;br&gt;&lt;/div&gt;&lt;div&gt;for&nbsp;(auto&nbsp;i&nbsp;:&nbsp;WholeEnum&lt;Numbers&gt;(Numbers::one,&nbsp;Numbers::three))&nbsp;{&lt;br&gt;&lt;/div&gt;&lt;div&gt; //&nbsp;do&nbsp;stuff&lt;br&gt;}&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;do&nbsp;you&nbsp;think?&nbsp;Not&nbsp;very&nbsp;kosher&nbsp;maybe,&nbsp;but&nbsp;it&nbsp;should&nbsp;work.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
*&nbsp;Avoid&nbsp;static&nbsp;variables&nbsp;in&nbsp;templates,&nbsp;especially&nbsp;when&nbsp;you&nbsp;want&nbsp;to&lt;br&gt;<br>
instantiate&nbsp;different&nbsp;templates&nbsp;based&nbsp;on&nbsp;such&nbsp;trivial&nbsp;things&nbsp;as&nbsp;range&lt;br&gt;<br>
boundaries.&nbsp;This&nbsp;is&nbsp;(or&nbsp;used&nbsp;to&nbsp;be?)&nbsp;one&nbsp;of&nbsp;the&nbsp;dark&nbsp;C++&nbsp;corners;&nbsp;they&lt;br&gt;<br>
might&nbsp;hurt&nbsp;inlining/performance&nbsp;as&nbsp;well.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Ok.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
The&nbsp;attached&nbsp;files&nbsp;are&nbsp;unpolished,&nbsp;but&nbsp;should&nbsp;illustrate&nbsp;the&nbsp;above&lt;br&gt;<br>
points&nbsp;and&nbsp;how&nbsp;to&nbsp;avoid&nbsp;some&nbsp;of&nbsp;the&nbsp;problems&nbsp;discussed&nbsp;here.&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;It&nbsp;looks&nbsp;to&nbsp;me&nbsp;that&nbsp;I&nbsp;have&nbsp;crossed&nbsp;an&nbsp;itch&nbsp;you&nbsp;feel&nbsp;as&nbsp;well,&nbsp;and&nbsp;this&nbsp;effort&nbsp;may&nbsp;be&nbsp;useful&nbsp;after&nbsp;all.&nbsp;&lt;br&gt;&lt;/div&gt;Thanks&nbsp;for&nbsp;taking&nbsp;the&nbsp;time!&lt;br&gt;--&nbsp;&lt;br&gt;&lt;div&gt; &nbsp; &nbsp;Francesco&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;<br>

</tt>
