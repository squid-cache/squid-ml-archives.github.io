<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Aug&nbsp;20,&nbsp;2015&nbsp;at&nbsp;7:11&nbsp;AM,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;On&nbsp;20/08/2015&nbsp;7:28&nbsp;a.m.,&nbsp;Kinkie&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Hi&nbsp;all,&lt;br&gt;<br>
&gt; &nbsp; the&nbsp;attached&nbsp;patch&nbsp;(a&nbsp;merge&nbsp;request&nbsp;from&lt;br&gt;<br>
&gt;&nbsp;lp:~kinkie/squid/mempools-nozero)&nbsp;changes&nbsp;MEMPROXY_CLASS&nbsp;so&nbsp;that&nbsp;it&nbsp;doesn&#39;t&lt;br&gt;<br>
&gt;&nbsp;zero&nbsp;memory&nbsp;before&nbsp;releasing&nbsp;it&nbsp;to&nbsp;requestors.&nbsp;The&nbsp;constructors&nbsp;of&nbsp;all&lt;br&gt;<br>
&gt;&nbsp;classes&nbsp;using&nbsp;that&nbsp;feature&nbsp;were&nbsp;checked,&nbsp;so&nbsp;that&nbsp;they&nbsp;fully&nbsp;initialize&nbsp;all&lt;br&gt;<br>
&gt;&nbsp;data&nbsp;members&nbsp;and&nbsp;thus&nbsp;require&nbsp;no&nbsp;zeroing.&lt;br&gt;<br>
&gt;&nbsp;It&nbsp;also&nbsp;changes&nbsp;Debug::OutStream&nbsp;to&nbsp;use&nbsp;MEMPROXY_CLASS&nbsp;instead&nbsp;of&lt;br&gt;<br>
&gt;&nbsp;new/derelete,&nbsp;and&nbsp;changes&nbsp;constructors&nbsp;to&nbsp;initializer&nbsp;lists&nbsp;whenever&lt;br&gt;<br>
&gt;&nbsp;possible&nbsp;and&nbsp;sensible&nbsp;(aka&nbsp;justified&nbsp;by&nbsp;other&nbsp;changes),&nbsp;same&nbsp;for&nbsp;dropping&lt;br&gt;<br>
&gt;&nbsp;HERE&nbsp;and&nbsp;adopting&nbsp;nullptr.&lt;br&gt;<br>
&gt;&nbsp;It&nbsp;also&nbsp;changes&nbsp;some&nbsp;code&nbsp;in&nbsp;Makefile.am&nbsp;to&nbsp;use&nbsp;make&nbsp;variables&nbsp;in&nbsp;place&nbsp;of&lt;br&gt;<br>
&gt;&nbsp;full&nbsp;paths.&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;code&nbsp;has&nbsp;been&nbsp;run-tested&nbsp;(default&nbsp;config&nbsp;only),&nbsp;build-farm-tested&nbsp;and&lt;br&gt;<br>
&gt;&nbsp;polygraph-tested.&nbsp;It&nbsp;shows&nbsp;a&nbsp;small&nbsp;but&nbsp;noticeable&nbsp;performance&nbsp;improvement&lt;br&gt;<br>
&gt;&nbsp;in&nbsp;performance&nbsp;(of&nbsp;course,&nbsp;numbers&nbsp;are&nbsp;to&nbsp;be&nbsp;taken&nbsp;with&nbsp;a&nbsp;big&nbsp;grain&nbsp;of&lt;br&gt;<br>
&gt;&nbsp;salt).&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;When&nbsp;reviewing,&nbsp;please&nbsp;do&nbsp;not&nbsp;focus&nbsp;on&nbsp;formatting&nbsp;issues;&nbsp;if&nbsp;this&nbsp;patch&lt;br&gt;<br>
&gt;&nbsp;passes&nbsp;review&nbsp;I&#39;ll&nbsp;run&nbsp;a&nbsp;source-formatting&nbsp;before&nbsp;merging.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;*&nbsp;in&nbsp;Makefiles&nbsp;please&nbsp;add&nbsp;the&nbsp;new&nbsp;bits&nbsp;of&nbsp;*_SOURCE&nbsp;lists&nbsp;in&nbsp;alphabetical&lt;br&gt;<br>
order.&lt;br&gt;<br>
 -&nbsp;you&nbsp;have&nbsp;several&nbsp;stub_libmem.cc&nbsp;going&nbsp;after&nbsp;stub_M&nbsp;and&nbsp;stub_S*&nbsp;filenames.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;think&nbsp;I&nbsp;fixed&nbsp;them.&nbsp;It&nbsp;was&nbsp;mentioned&nbsp;in&nbsp;the&nbsp;coverity-fixes&nbsp;thread&nbsp;that&nbsp;it&nbsp;could&nbsp;be&nbsp;a&nbsp;good&nbsp;idea&nbsp;to&nbsp;do&nbsp;a&nbsp;formatting&nbsp;round&nbsp;sorting&nbsp;all&nbsp;entries&nbsp;in&nbsp;Makefiles,&nbsp;once&nbsp;the&nbsp;updated&nbsp;standards&nbsp;are&nbsp;finalized.&nbsp;I&#39;d&nbsp;defer&nbsp;any&nbsp;leftover&nbsp;unsorted&nbsp;entries&nbsp;till&nbsp;then.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
*&nbsp;Please&nbsp;make&nbsp;the&nbsp;initializer&nbsp;lists&nbsp;one&nbsp;member&nbsp;per&nbsp;line.&lt;br&gt;<br>
 -&nbsp;the&nbsp;auto-formatting&nbsp;wont&nbsp;do&nbsp;that&nbsp;for&nbsp;us&nbsp;yet.&lt;br&gt;<br>
 -&nbsp;it&nbsp;greatly&nbsp;helps&nbsp;readability&nbsp;and&nbsp;manual&nbsp;checking&nbsp;for&nbsp;missing&nbsp;or&lt;br&gt;<br>
out-of-order&nbsp;items.&nbsp;We&nbsp;can&nbsp;also&nbsp;then&nbsp;easily&nbsp;add&nbsp;comments&nbsp;to&nbsp;lines&lt;br&gt;<br>
explain&nbsp;odd&nbsp;default&nbsp;values.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Sure&nbsp;for&nbsp;.cc,&nbsp;not&nbsp;so&nbsp;sure&nbsp;for&nbsp;.h,&nbsp;where&nbsp;compactness&nbsp;helps&nbsp;readability&nbsp;and&nbsp;presence&nbsp;and&nbsp;order&nbsp;should&nbsp;be&nbsp;easier&nbsp;to&nbsp;spot.&nbsp;Finally,&nbsp;many&nbsp;missing&nbsp;or&nbsp;out-of-order&nbsp;should&nbsp;get&nbsp;caught&nbsp;either&nbsp;by&nbsp;Coverity&nbsp;or&nbsp;gcc.&lt;br&gt;&lt;/div&gt;&lt;div&gt;Changed&nbsp;for&nbsp;all&nbsp;.cc,&nbsp;not&nbsp;done&nbsp;for&nbsp;.h&nbsp;(where&nbsp;lists&nbsp;are&nbsp;quite&nbsp;shorter)&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
*&nbsp;in&nbsp;memset()&nbsp;please&nbsp;use&nbsp;0&nbsp;integer&nbsp;value&nbsp;not&nbsp;&#39;\0&#39;&nbsp;to&nbsp;set&nbsp;flags.&lt;br&gt;<br>
 -&nbsp;it&nbsp;helps&nbsp;the&nbsp;compiler&nbsp;know&nbsp;it&nbsp;is&nbsp;safe&nbsp;to&nbsp;optimize&nbsp;up&nbsp;to&nbsp;larger&nbsp;than&lt;br&gt;<br>
8-bit&nbsp;values&nbsp;of&nbsp;0.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Ok.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
*&nbsp;in&nbsp;MemObject::MemObject()&nbsp;please&nbsp;leave&nbsp;the&nbsp;_reply&nbsp;initialization&nbsp;like&lt;br&gt;<br>
it&nbsp;was&nbsp;so&nbsp;that&nbsp;the&nbsp;HTTMSGLOCK&nbsp;hack&nbsp;is&nbsp;kept&nbsp;visibly&nbsp;associated&nbsp;with&nbsp;the&lt;br&gt;<br>
new&nbsp;operation.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Ok.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
*&nbsp;You&nbsp;add&nbsp;several&nbsp;&quot;//&nbsp;needs&nbsp;mempool-managed&nbsp;zeroing.&quot;&lt;br&gt;<br>
 -&nbsp;but&nbsp;you&nbsp;say&nbsp;this&nbsp;patch&nbsp;makes&nbsp;the&nbsp;MEMPROXYC_CLASS&nbsp;macro&nbsp;do&nbsp;zero-ing&lt;br&gt;<br>
already.&nbsp;Those&nbsp;should&nbsp;be&nbsp;reverted.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;commets&nbsp;are&nbsp;wrong&nbsp;and&nbsp;based&nbsp;on&nbsp;an&nbsp;outdated&nbsp;analysis&nbsp;of&nbsp;StoreMeta.&nbsp;Removed&nbsp;the&nbsp;comments.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
*&nbsp;src/HttpHeader.cc&nbsp;-&nbsp;revert&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Yes.&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
*&nbsp;when&nbsp;adding&nbsp;a&nbsp;new&nbsp;constructor&nbsp;ensure&nbsp;the&nbsp;big-5&nbsp;operators&nbsp;(ctor,&nbsp;dtor,&lt;br&gt;<br>
assign,&nbsp;emplace,&nbsp;emplace-assign)&nbsp;are&nbsp;all&nbsp;present.&nbsp;Even&nbsp;if&nbsp;they&nbsp;use&nbsp;&quot;=&lt;br&gt;<br>
default&quot;&lt;br&gt;<br>
 -&nbsp;looking&nbsp;at&nbsp;StoreMeta,&nbsp;maybe&nbsp;others.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;StoreMeta&nbsp;is&nbsp;pure-virtual;&nbsp;Also,&nbsp;it&nbsp;has&nbsp;no&nbsp;complex&nbsp;members&nbsp;so&nbsp;emplace&nbsp;doesn&#39;t&nbsp;add&nbsp;value&nbsp;vs.&nbsp;copy.&lt;br&gt;&lt;/div&gt;&lt;div&gt;Omitting&nbsp;emplace&nbsp;and&nbsp;implementing&nbsp;the&nbsp;others&nbsp;as&nbsp;protected&nbsp;for&nbsp;completeness&#39;&nbsp;sake.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
*&nbsp;wordlist&nbsp;missing&nbsp;&#39;explicit&#39;&nbsp;on&nbsp;the&nbsp;raw-pointer&nbsp;ctor&lt;br&gt;<br>
 -&nbsp;also&nbsp;other&nbsp;big-5&nbsp;operators&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;wordlist&nbsp;must&nbsp;die;&nbsp;it&#39;s&nbsp;a&nbsp;C&nbsp;relic&nbsp;which&nbsp;doesn&#39;t&nbsp;belong&nbsp;to&nbsp;squid&nbsp;anymore.&lt;br&gt;&lt;/div&gt;&lt;div&gt;Kinda-implemented&nbsp;with&nbsp;a&nbsp;private&nbsp;default&nbsp;destructor&nbsp;(friended&nbsp;by&nbsp;wordlistDestroy)&nbsp;and&nbsp;deleted&nbsp;assignment&nbsp;and&nbsp;copyconstructor.&nbsp;This&nbsp;helped&nbsp;catch&nbsp;a&nbsp;leak&nbsp;in&nbsp;FtpGateway.cc&nbsp;so&nbsp;at&nbsp;least&nbsp;it&nbsp;was&nbsp;used&nbsp;for&nbsp;something&nbsp;-even&nbsp;if&nbsp;it&#39;s&nbsp;very&nbsp;ugly.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
*&nbsp;in&nbsp;test-suite/Makefile.am&nbsp;please&nbsp;try&nbsp;to&nbsp;avoid&nbsp;adding&nbsp;LIBMEM_STUBS.&lt;br&gt;<br>
-&nbsp;DEBUG_SOURCE&nbsp;entries&nbsp;should&nbsp;be&nbsp;enough,&nbsp;and&nbsp;it&nbsp;doesnt&nbsp;matter&nbsp;of&nbsp;extra&lt;br&gt;<br>
stubs&nbsp;get&nbsp;linked&nbsp;to&nbsp;unit&nbsp;tests.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Done&nbsp;in&nbsp;a&nbsp;different&nbsp;way:&nbsp;some&nbsp;unit&nbsp;tests&nbsp;need&nbsp;the&nbsp;full&nbsp;&lt;a&nbsp;href=&quot;http://libmem.la&quot;&gt;libmem.la&lt;/a&gt;;&nbsp;the&nbsp;stub&nbsp;symbols&nbsp;would&nbsp;override&nbsp;the&nbsp;library,&nbsp;causing&nbsp;failures.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
*&nbsp;please&nbsp;do&nbsp;one&nbsp;of&nbsp;these:&lt;br&gt;<br>
&lt;br&gt;<br>
 +&nbsp;return&nbsp;the&nbsp;XXX&nbsp;to&nbsp;Debugs.h,&nbsp;but&nbsp;it&nbsp;can&nbsp;move&nbsp;up&nbsp;to&nbsp;explain&nbsp;why&lt;br&gt;<br>
AllocatorProxy.h&nbsp;is&nbsp;used&nbsp;instead&nbsp;of&nbsp;mem/forward.h&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;doesn&#39;t&nbsp;need&nbsp;to.&nbsp;I&#39;m&nbsp;dumb&nbsp;and&nbsp;should&nbsp;have&nbsp;used&nbsp;mem/forward&nbsp;in&nbsp;the&nbsp;first&nbsp;place&nbsp;-&nbsp;you&nbsp;had&nbsp;even&nbsp;told&nbsp;me&nbsp;not&nbsp;too&nbsp;long&nbsp;ago.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Revised&nbsp;patch&nbsp;(with&nbsp;huge&nbsp;context,&nbsp;hence&nbsp;the&nbsp;big&nbsp;size)&nbsp;attached.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&gt; &nbsp; &nbsp;Francesco&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;<br>

</tt>
