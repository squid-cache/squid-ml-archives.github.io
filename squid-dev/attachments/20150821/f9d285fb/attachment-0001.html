<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Aug&nbsp;20,&nbsp;2015&nbsp;at&nbsp;8:46&nbsp;AM,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&gt;&lt;div&gt;On&nbsp;16/08/2015&nbsp;7:09&nbsp;p.m.,&nbsp;Kinkie&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Hi&nbsp;all,&lt;br&gt;<br>
&gt; &nbsp; the&nbsp;attached&nbsp;patch&nbsp;does:&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;EnumIterator,&nbsp;which&nbsp;now&nbsp;uses&nbsp;autoconf&nbsp;to&nbsp;detect&nbsp;std::underlying_type&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;Removes&nbsp;header&nbsp;masks&nbsp;in&nbsp;HttpHeader.cc&nbsp;and&nbsp;HttpReply&nbsp;in&nbsp;favor&nbsp;of..&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;gperf-generated&nbsp;header&nbsp;table&nbsp;with&nbsp;flags&nbsp;describing&nbsp;headers&nbsp;all&nbsp;collected&lt;br&gt;<br>
&gt;&nbsp;in&nbsp;one&nbsp;place&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;replaces&nbsp;HttpHeader::getEntry&nbsp;with&nbsp;explicit&nbsp;vector&nbsp;iteration&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;Implements&nbsp;and&nbsp;uses&nbsp;Http::HeaderTable.lookup(string-or-Http::HdrType)&nbsp;to&lt;br&gt;<br>
&gt;&nbsp;look&nbsp;up&nbsp;headers&nbsp;in&nbsp;the&nbsp;gperf-generated&nbsp;hash&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;small&nbsp;optimizationi&nbsp;in&nbsp;HttpHeader::getLastEntry&nbsp;thanks&nbsp;to&nbsp;reverse&lt;br&gt;<br>
&gt;&nbsp;iterators&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;use&nbsp;erase-remove&nbsp;pattern&nbsp;in&nbsp;HttpHeader::compact&nbsp;in&nbsp;place&nbsp;of&nbsp;resize()&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;use&nbsp;std::&nbsp;algorithms&nbsp;instead&nbsp;of&nbsp;explicit&nbsp;loop&nbsp;in&nbsp;HttpHeader::delById&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;gets&nbsp;rid&nbsp;of&nbsp;httpHeaderCalcMask&nbsp;-&nbsp;masks&nbsp;are&nbsp;still&nbsp;used&nbsp;elsewhere&nbsp;but&lt;br&gt;<br>
&gt;&nbsp;generating&nbsp;them&nbsp;is&nbsp;now&nbsp;easier&nbsp;thanks&nbsp;to&nbsp;WholeEnum&lt;type&gt;&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;some&nbsp;readability&nbsp;improvements&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;refactor&nbsp;HeaderManglers::track&nbsp;to&nbsp;avoid&nbsp;overloading&nbsp;of&nbsp;meaning&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;enumEnd_&nbsp;enumerator&nbsp;-&nbsp;please&nbsp;help&nbsp;me&nbsp;checking&nbsp;carefully&nbsp;I&nbsp;haven&#39;t&nbsp;altered&lt;br&gt;<br>
&gt;&nbsp;functionality&nbsp;here&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;implements&nbsp;a&nbsp;case-insensitve&nbsp;hash&nbsp;function&nbsp;for&nbsp;SBuf&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;all&nbsp;known&nbsp;headers&nbsp;are&nbsp;now&nbsp;unconditionally&nbsp;parsed.&nbsp;May&nbsp;not&nbsp;be&nbsp;acted&nbsp;upon&lt;br&gt;<br>
&gt;&nbsp;if&nbsp;some&nbsp;functions&nbsp;are&nbsp;not&nbsp;compiled&nbsp;in&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;LookupTable&nbsp;now&nbsp;uses&nbsp;an&nbsp;unordered_map&nbsp;instead&nbsp;of&nbsp;map&nbsp;for&nbsp;backing&nbsp;storage.&lt;br&gt;<br>
&gt;&nbsp;No&nbsp;user-visible&nbsp;change&nbsp;for&nbsp;SBuf&nbsp;and&nbsp;std::string&nbsp;users&nbsp;unless&nbsp;they&nbsp;wish&nbsp;to&lt;br&gt;<br>
&gt;&nbsp;have&nbsp;a&nbsp;custom&nbsp;hasher&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Most&nbsp;code&nbsp;has&nbsp;been&nbsp;run-tested&nbsp;(most&nbsp;notable&nbsp;exception:&nbsp;HeaderManglers),&lt;br&gt;<br>
&gt;&nbsp;farm-build-,&nbsp;coadvisor-&nbsp;and&nbsp;polygraph-&nbsp;tested.&nbsp;The&nbsp;main&nbsp;focus&nbsp;of&nbsp;this&lt;br&gt;<br>
&gt;&nbsp;refactoring&nbsp;is&nbsp;correctness&nbsp;and&nbsp;readability,&nbsp;c++11-ification&nbsp;and&nbsp;recovering&lt;br&gt;<br>
&gt;&nbsp;from&nbsp;the&nbsp;performance&nbsp;regression&nbsp;that&nbsp;was&nbsp;introduced&nbsp;~10&nbsp;days&nbsp;ago.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;Here&nbsp;goes.&nbsp;Audit:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;IMO&nbsp;the&nbsp;HeaderManglers&nbsp;really&nbsp;do&nbsp;need&nbsp;at&nbsp;least&nbsp;basic&nbsp;testing&nbsp;with&lt;br&gt;<br>
these&nbsp;changes.&nbsp;A&nbsp;regression&nbsp;there&nbsp;affects&nbsp;widely&nbsp;used&nbsp;features.&lt;br&gt;<br>
&lt;br&gt;<br>
basic&nbsp;tests&nbsp;are&nbsp;easy&nbsp;enough.&nbsp;A&nbsp;simple&nbsp;proxy&nbsp;altering&nbsp;the&nbsp;Server&nbsp;header&lt;br&gt;<br>
to&nbsp;a&nbsp;fixed&nbsp;value,&nbsp;adding&nbsp;some&nbsp;custom&nbsp;new&nbsp;header,&nbsp;and&nbsp;stripping&nbsp;something&lt;br&gt;<br>
common&nbsp;like&nbsp;Expires&nbsp;should&nbsp;be&nbsp;sufficient&nbsp;to&nbsp;trigger&nbsp;any&nbsp;code&nbsp;problems&lt;br&gt;<br>
and&nbsp;eyeball&nbsp;any&nbsp;major&nbsp;issues&nbsp;from&nbsp;the&nbsp;squidclient&nbsp;output&nbsp;to&nbsp;verify&nbsp;working.&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;After&nbsp;some&nbsp;careful&nbsp;checking:&lt;br&gt;&lt;/div&gt;&lt;div&gt;*_header_access&nbsp;and&nbsp;*_header_add&nbsp;work&nbsp;fine.&lt;br&gt;&lt;/div&gt;&lt;div&gt;*_header_replace&nbsp;is&nbsp;broken,&nbsp;but&nbsp;it&#39;s&nbsp;been&nbsp;for&nbsp;a&nbsp;long&nbsp;time&nbsp;(I&nbsp;run-tested&nbsp;with&nbsp;code&nbsp;from&nbsp;february).&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
in&nbsp;acinclude/*&nbsp;and&nbsp;&lt;a&nbsp;href=&quot;http://configure.ac&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;configure.ac&lt;/a&gt;:&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;tests&nbsp;and&nbsp;macro&nbsp;defines&nbsp;for&nbsp;C++11/0x&nbsp;back-compat&nbsp;are&nbsp;in&lt;br&gt;<br>
acinclude/ax_cxx_0x_types.m4&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;file&nbsp;name&nbsp;seems&nbsp;inappropriate,&nbsp;but&nbsp;sure.&lt;br&gt;&lt;/div&gt;&lt;div&gt;Done.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
in&nbsp;src/HttpHeader.cc:&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;please&nbsp;use&nbsp;{}&nbsp;on&nbsp;the&nbsp;for&nbsp;in&nbsp;HttpHeader::append().&lt;br&gt;<br>
 -&nbsp;aids&nbsp;readability&nbsp;of&nbsp;multiple&nbsp;nesting&nbsp;layers&lt;br&gt;<br>
 -&nbsp;same&nbsp;occurs&nbsp;elsewhere,&nbsp;I&nbsp;cant&nbsp;see&nbsp;the&nbsp;method&nbsp;name.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;findEntry,&nbsp;findLastEntry,&nbsp;refreshMask,&nbsp;getList.&nbsp;Done.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
*&nbsp;&quot;assert(!&nbsp;Http::HeaderLookupTable.lookup&quot;&nbsp;looks&nbsp;-&nbsp;odd.&lt;br&gt;<br>
 -&nbsp;the&nbsp;extra&nbsp;whitespace&nbsp;does&nbsp;not&nbsp;really&nbsp;add&nbsp;anything&nbsp;and&nbsp;detracts&nbsp;from&lt;br&gt;<br>
searching&nbsp;for&nbsp;&quot;!Http::HeaderLookupTable.lookup&quot;&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Changed.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
*&nbsp;inconsistent&nbsp;changes&nbsp;ofr&nbsp;NULL-&gt;nullptr&lt;br&gt;<br>
 -&nbsp;eg&nbsp;in&nbsp;HttpHeader::findLastEntry()&nbsp;NULL&nbsp;is&nbsp;not&nbsp;changed,&nbsp;but&nbsp;elsewhere&lt;br&gt;<br>
it&nbsp;usually&nbsp;is.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;That&#39;s&nbsp;actually&nbsp;intentional:&nbsp;I&nbsp;changed&nbsp;that&nbsp;only&nbsp;when&nbsp;something&nbsp;in&nbsp;the&nbsp;vicinity&nbsp;changed&nbsp;so&nbsp;not&nbsp;to&nbsp;make&nbsp;the&nbsp;patch&nbsp;any&nbsp;more&nbsp;enormous.&nbsp;I&nbsp;can&nbsp;blanket&nbsp;change&nbsp;if&nbsp;that&#39;s&nbsp;preferred.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
in&nbsp;src/HttpHeaderTools.cc:&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;HeaderManglers::dumpReplacement()&nbsp;has&nbsp;some&nbsp;odd&nbsp;line&nbsp;wrapping&nbsp;in&nbsp;the&lt;br&gt;<br>
parameter&nbsp;lists&nbsp;of&nbsp;header_mangler_dump_replacement()&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Removed&nbsp;all&nbsp;line&nbsp;wrapping.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
in&nbsp;src/Makefile.am:&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;for&nbsp;testEnumIterator&nbsp;please&nbsp;add&nbsp;$(SQUID_CPPUNIT_LA)&nbsp;to&nbsp;the&nbsp;*_LDADD&lt;br&gt;<br>
list&nbsp;instead&nbsp;of&nbsp;a&nbsp;*_DEPENDENCIES&nbsp;entry&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;hm..&nbsp;it&#39;s&nbsp;applied&nbsp;inconsistently.&nbsp;Documentation&nbsp;(at&nbsp;line&nbsp;957)&nbsp;says&nbsp;to&nbsp;have&nbsp;it&nbsp;in&nbsp;both&nbsp;places.&lt;br&gt;&lt;/div&gt;&lt;div&gt;testUfs,&nbsp;testRock&nbsp;:&nbsp;do&nbsp;not&nbsp;have&nbsp;it&nbsp;as&nbsp;a&nbsp;dependency&lt;br&gt;&lt;/div&gt;&lt;div&gt;testHttpReply,&nbsp;testBoilerplate,&nbsp;testCacheManager,&nbsp;testDiskIO,&nbsp;testEvent,&nbsp;testEventLoop,&nbsp;test_http_range,&nbsp;testHttp1Parser,&nbsp;testHttpRequest,&nbsp;testStore,&nbsp;testString,&nbsp;testUrl,&nbsp;testSBuf,&nbsp;testSBufList,&nbsp;testConfigParser,&nbsp;testStatHist&nbsp;(and&nbsp;so&nbsp;on..)&nbsp;have&nbsp;it&nbsp;as&nbsp;a&nbsp;dependency&lt;br&gt;testACLMaxUserIP&nbsp;:&nbsp;used&nbsp;to&nbsp;have&nbsp;it&nbsp;as&nbsp;a&nbsp;dependency&nbsp;(but&nbsp;now&nbsp;it&#39;s&nbsp;commented&nbsp;out)&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;div&gt;For&nbsp;now&nbsp;I&#39;m&nbsp;following&nbsp;documentation&nbsp;and&nbsp;leaving&nbsp;it&nbsp;in&nbsp;both&nbsp;places;&nbsp;if&nbsp;you&nbsp;have&nbsp;an&nbsp;opinion&nbsp;about&nbsp;how&nbsp;it&nbsp;should&nbsp;be&nbsp;I&#39;ll&nbsp;gladly&nbsp;carpet-apply&nbsp;that&nbsp;to&nbsp;the&nbsp;whole&nbsp;file.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
*&nbsp;also&nbsp;please&nbsp;place&nbsp;tests/stub_*&nbsp;and&nbsp;base/EnumIterator.h&nbsp;in&nbsp;the&nbsp;nodist_*&lt;br&gt;<br>
list&nbsp;from&nbsp;now&nbsp;on.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Ok.&nbsp;Changed&nbsp;documentation&nbsp;at&nbsp;about&nbsp;line&nbsp;951&nbsp;to&nbsp;reflect&nbsp;that.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
 -&nbsp;the&nbsp;test&nbsp;_SOURCE&nbsp;list&nbsp;should&nbsp;now&nbsp;only&nbsp;contain&nbsp;the&nbsp;tests/test*.{h,cc}&lt;br&gt;<br>
actually&nbsp;containing&nbsp;the&nbsp;unit-test&nbsp;code.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;Does&nbsp;this&nbsp;also&nbsp;apply&nbsp;to&nbsp;the&nbsp;files&nbsp;actually&nbsp;being&nbsp;tested?&nbsp;(X.h,&nbsp;X.cc)&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;fine&nbsp;either&nbsp;way,&nbsp;I&nbsp;would&nbsp;just&nbsp;like&nbsp;it&nbsp;to&nbsp;be&nbsp;reflected&nbsp;in&nbsp;the&nbsp;documentation.&nbsp;Not&nbsp;changed&nbsp;there&nbsp;for&nbsp;now,&nbsp;just&nbsp;in&nbsp;the&nbsp;testEnumIterator&nbsp;part.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
 -&nbsp;this&nbsp;helps&nbsp;prevent&nbsp;unit&nbsp;tests&nbsp;being&nbsp;the&nbsp;only&nbsp;reason&nbsp;files&nbsp;are&nbsp;dist&lt;br&gt;<br>
(found&nbsp;a&nbsp;few&nbsp;like&nbsp;that&nbsp;already),&nbsp;so&nbsp;we&nbsp;can&nbsp;ensure&nbsp;they&nbsp;are&nbsp;linked&nbsp;to&lt;br&gt;<br>
Squid&nbsp;main&nbsp;binary&nbsp;or&nbsp;libraries&nbsp;properly&nbsp;for&nbsp;automake&nbsp;dependency&nbsp;detection.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
in&nbsp;src/SBufAlgos.cc:&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;whats&nbsp;cctype&nbsp;needed&nbsp;for?&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;tolower(3).&lt;br&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
in&nbsp;src/SBufAlgos.h:&lt;br&gt;<br>
&lt;br&gt;<br>
 *&nbsp;please&nbsp;doxygen&nbsp;comment&nbsp;new&nbsp;class&nbsp;CaseInsensitiveSBufHash&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Done.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
in&nbsp;src/adaptation/icap/ModXact.cc:&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;why&nbsp;is&nbsp;#if&nbsp;USE_ADAPTATION&nbsp;wrappers&nbsp;being&nbsp;added?&lt;br&gt;<br>
 -&nbsp;this&nbsp;entire&nbsp;file&nbsp;and&nbsp;even&nbsp;&lt;a&nbsp;href=&quot;http://libicap.la&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;libicap.la&lt;/a&gt;&nbsp;should&nbsp;never&nbsp;be&nbsp;linked&nbsp;if&lt;br&gt;<br>
adaptation&nbsp;is&nbsp;disabled.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;By&nbsp;mistake.&nbsp;Thanks&nbsp;for&nbsp;catching&nbsp;this.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
in&nbsp;src/base/EnumIterator.h:&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;please&nbsp;place&nbsp;the&nbsp;#if&nbsp;wrappers&nbsp;underneath&nbsp;the&nbsp;copyright&nbsp;blurb.&lt;br&gt;<br>
 -&nbsp;ensures&nbsp;the&nbsp;squid&nbsp;copyright&nbsp;is&nbsp;part&nbsp;of&nbsp;any&nbsp;code&nbsp;using&nbsp;that&nbsp;squid&lt;br&gt;<br>
header,&nbsp;and&lt;br&gt;<br>
 -&nbsp;makes&nbsp;the&nbsp;maintenance&nbsp;tools&nbsp;detect&nbsp;it&nbsp;as&nbsp;ours&nbsp;not&nbsp;a&nbsp;third-party&lt;br&gt;<br>
copyright.&lt;br&gt;<br>
 -&nbsp;same&nbsp;for&nbsp;tests/testEnumIterator.h&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Ok.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
*&nbsp;please&nbsp;doxygen&nbsp;comment&nbsp;new&nbsp;class&nbsp;EnumIteratorBase,&nbsp;ReverseEnumIterator,&lt;br&gt;<br>
 -&nbsp;eg,&nbsp;do&nbsp;these&nbsp;cover&nbsp;all&nbsp;values?&lt;br&gt;<br>
 &nbsp; where&nbsp;does&nbsp;it&nbsp;stop&nbsp;iterating?&lt;br&gt;<br>
 &nbsp; what&nbsp;value&nbsp;is&nbsp;produced&nbsp;for&nbsp;out-of-bounds&nbsp;?&lt;br&gt;<br>
 &nbsp; uni&nbsp;or&nbsp;bi-directional&nbsp;?&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Done.&nbsp;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
*&nbsp;for&nbsp;EnumRangeT&nbsp;and&nbsp;WholeEnum&lt;br&gt;<br>
 -&nbsp;utilize&nbsp;&#39;empty&#39;&nbsp;lines&nbsp;between&nbsp;paragraphs&lt;br&gt;<br>
 -&nbsp;\note&nbsp;for&nbsp;highlighting&nbsp;additional&nbsp;notes&lt;br&gt;<br>
 -&nbsp;highlight&nbsp;example&nbsp;code&nbsp;with&nbsp;\code&nbsp;...&nbsp;\endcode).&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Done&nbsp;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
*&nbsp;s/Enum/EnumType/&lt;br&gt;<br>
 -&nbsp;to&nbsp;avoid&nbsp;any&nbsp;confusion&nbsp;with&nbsp;keyword&nbsp;&#39;enum&#39;&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Done.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
in&nbsp;src/base/Makefile.am:&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;alphabetical&nbsp;order.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Done.&nbsp;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
in&nbsp;src/http.cc:&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;please&nbsp;mark&nbsp;use&nbsp;of&nbsp;name.c_str()&nbsp;with&nbsp;&quot;XXX:&nbsp;performance&nbsp;regression,&lt;br&gt;<br>
c_str()&nbsp;reallocates&quot;&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Actually,&nbsp;no&nbsp;in&nbsp;this&nbsp;case&nbsp;it&nbsp;doesn&#39;t&nbsp;unless&nbsp;ilen&nbsp;is&nbsp;exactly&nbsp;equal&nbsp;to&nbsp;one&nbsp;of&nbsp;the&nbsp;MemBlob&nbsp;MemPool&nbsp;sizes&nbsp;(possible&nbsp;but&nbsp;unlikely,&nbsp;I&nbsp;estimate&nbsp;in&nbsp;the&nbsp;0.1%&nbsp;range).&lt;br&gt;There&nbsp;are&nbsp;some&nbsp;performance&nbsp;deltas&nbsp;but&nbsp;they&nbsp;are&nbsp;IMO&nbsp;quite&nbsp;marginal:&lt;br&gt;&lt;/div&gt;&lt;div&gt;slowdowns:&nbsp;SBuf&nbsp;housekeeping,&nbsp;temp&nbsp;creation&nbsp;(of&nbsp;ilen+1&nbsp;bytes)&nbsp;done&nbsp;in&nbsp;two&nbsp;steps&nbsp;instead&nbsp;of&nbsp;one&lt;br&gt;&lt;/div&gt;&lt;div&gt;speedups:&nbsp;SBuf&nbsp;uses&nbsp;mempools,&nbsp;&quot;*&quot;&nbsp;case&nbsp;is&nbsp;checked&nbsp;before&nbsp;lowering&nbsp;case&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
 -&nbsp;the&nbsp;xmalloc&nbsp;removal&nbsp;is&nbsp;countered&nbsp;by&nbsp;the&nbsp;data-copy&nbsp;into&nbsp;&quot;SBuf&nbsp;name&quot;.&lt;br&gt;<br>
Making&nbsp;this&nbsp;a&nbsp;new&nbsp;second&nbsp;data-copy.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
in&nbsp;src/http/RegisteredHeaders.h:&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;please&nbsp;lock&nbsp;ACCEPT&nbsp;in&nbsp;as&nbsp;first&nbsp;entry;&lt;br&gt;<br>
&quot;&lt;br&gt;<br>
 &nbsp;enumBegin_&nbsp;=&nbsp;0,&lt;br&gt;<br>
 &nbsp;ACCEPT&nbsp;=&nbsp;enumBegin_,&lt;br&gt;<br>
 &nbsp;...&lt;br&gt;<br>
&quot;&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;already&nbsp;was,&nbsp;by&nbsp;assigning&nbsp;both&nbsp;enumBegin&nbsp;and&nbsp;ACCEPT&nbsp;value&nbsp;0.&nbsp;Changed&nbsp;for&nbsp;clarity&#39;s&nbsp;sake.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
*&nbsp;please&nbsp;delimit&nbsp;the&nbsp;methods&nbsp;and&nbsp;members&nbsp;of&nbsp;HeaderTableRecord&nbsp;with&nbsp;an&lt;br&gt;<br>
empty&nbsp;line&nbsp;(and&nbsp;maybe&nbsp;another&nbsp;&quot;public:&quot;)&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Done.&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
*&nbsp;a&nbsp;formatter&nbsp;run&nbsp;is&nbsp;going&nbsp;to&nbsp;be&nbsp;needed.&nbsp;Things&nbsp;like&nbsp;enum&nbsp;HdrKind&lt;br&gt;<br>
contain&nbsp;tab-indented&nbsp;lines&nbsp;and&nbsp;double-empty&nbsp;lines.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Yes.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
*&nbsp;HeaderLookupTable_t&lt;br&gt;<br>
 -&nbsp;need&nbsp;empty&nbsp;lines&nbsp;between&nbsp;paragraphs&nbsp;in&nbsp;doxygen&nbsp;comments&nbsp;again.&lt;br&gt;<br>
 -&nbsp;ie&nbsp;before&nbsp;the&nbsp;paragraph&nbsp;starting&nbsp;&quot;Actual&nbsp;records&nbsp;are&nbsp;...&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;&quot;///look&nbsp;record&nbsp;...&quot;&nbsp;--&gt;&nbsp;&quot;///&nbsp;look&nbsp;...&quot;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;Ok&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
in&nbsp;src/http/RegisteredHeadersHash.cci:&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;is&nbsp;there&nbsp;any&nbsp;way&nbsp;to&nbsp;add&nbsp;a&nbsp;comment&nbsp;blurb&nbsp;&quot;/*&nbsp;AUTO-GENERATED&nbsp;DO&nbsp;NOT&nbsp;EDIT&lt;br&gt;<br>
*/&quot;&nbsp;to&nbsp;the&nbsp;top&nbsp;of&nbsp;this&nbsp;file&nbsp;?&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;can&nbsp;and&nbsp;I&nbsp;did,&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;possible&nbsp;at&nbsp;the&nbsp;very&nbsp;top&nbsp;unfortunately.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
*&nbsp;also&nbsp;need&nbsp;to&nbsp;add&nbsp;the&nbsp;copyright&nbsp;boilerplate&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;Same&nbsp;thing.&lt;br&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
in &nbsp;src/http/RegisteredHeadersHash.gperf:&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;need&nbsp;a&nbsp;way&nbsp;to&nbsp;add&nbsp;the&nbsp;copyright&nbsp;boilerplate&nbsp;as&nbsp;a&nbsp;gperf-ignored&nbsp;comment&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Done&nbsp;that.&nbsp;There&nbsp;is&nbsp;a&nbsp;preamble&nbsp;section&nbsp;into&nbsp;which&nbsp;I&nbsp;copied&nbsp;the&nbsp;C++&nbsp;comments&nbsp;above.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
in &nbsp;src/tests/testEnumIterator.cc:&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;include&nbsp;path&nbsp;&quot;testEnumIterator.h&quot;&nbsp;-&gt;&nbsp;tests/testEnumIterator.h&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Done.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
*&nbsp;test&nbsp;enums&nbsp;should&nbsp;also&nbsp;use&nbsp;the&nbsp;&quot;&nbsp;first&nbsp;=&nbsp;enumBegin_,&nbsp;&quot;&nbsp;trick&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Done.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
*&nbsp;testBidirectionalIter()&nbsp;also&nbsp;needs&nbsp;to&nbsp;test&nbsp;for&nbsp;reaching&nbsp;out-of-bounds&lt;br&gt;<br>
conditions&nbsp;in&nbsp;either&nbsp;direction.&lt;br&gt;<br>
 -&nbsp;can&nbsp;it&nbsp;go&nbsp;fully&nbsp;across&nbsp;begin()&nbsp;-&gt;&nbsp;end()&nbsp;-&gt;&nbsp;begin()&nbsp;successfully&nbsp;in&lt;br&gt;<br>
only&nbsp;the&nbsp;expected&nbsp;count&nbsp;of&nbsp;iterations?&nbsp;(no&nbsp;more,&nbsp;no&nbsp;less)&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Ok,&nbsp;added&nbsp;and&nbsp;tested.&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;Updated&nbsp;patch&nbsp;attached.&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;&lt;div&gt; &nbsp; &nbsp;Francesco&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;<br>

</tt>
