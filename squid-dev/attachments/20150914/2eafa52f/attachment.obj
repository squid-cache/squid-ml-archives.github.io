=== modified file 'src/client_side.cc'
--- src/client_side.cc	2015-08-30 00:26:47 +0000
+++ src/client_side.cc	2015-09-13 16:15:05 +0000
@@ -588,6 +588,7 @@
         al->cache.objectSize = loggingEntry()->contentLen(); // payload duplicate ?? with or without TE ?
 
     al->http.clientRequestSz.header = req_sz;
+    al->http.clientRequestSz.payloadData = in_size;
     al->http.clientReplySz.header = out.headers_sz;
     // XXX: calculate without payload encoding or headers !!
     al->http.clientReplySz.payloadData = out.size - out.headers_sz; // pretend its all un-encoded data for now.
@@ -4245,7 +4246,7 @@
         in.buf.append(rbuf.content(), rbuf.contentSize());
         ClientSocketContext::Pointer context = getCurrentContext();
         ClientHttpRequest *http = context->http;
-        tunnelStart(http, &http->out.size, &http->al->http.code, http->al);
+        tunnelStart(http, &http->al->http.code, http->al);
     }
 }
 

=== modified file 'src/client_side_request.cc'
--- src/client_side_request.cc	2015-08-04 19:57:07 +0000
+++ src/client_side_request.cc	2015-09-13 16:09:21 +0000
@@ -150,6 +150,7 @@
     request(NULL),
     uri(NULL),
     log_uri(NULL),
+    in_size(0),
     req_sz(0),
     logType(LOG_TAG_NONE),
     calloutContext(NULL),
@@ -1514,7 +1515,7 @@
         }
 #endif
         getConn()->stopReading(); // tunnels read for themselves
-        tunnelStart(this, &out.size, &al->http.code, al);
+        tunnelStart(this, &al->http.code, al);
         return;
     }
 

=== modified file 'src/client_side_request.h'
--- src/client_side_request.h	2015-05-16 08:41:00 +0000
+++ src/client_side_request.h	2015-09-13 16:09:36 +0000
@@ -80,6 +80,8 @@
         size_t headers_sz;
     } out;
 
+    int64_t in_size;    /* size of payload uploaded through a tunnel */
+
     HttpHdrRangeIter range_iter;    /* data for iterating thru range specs */
     size_t req_sz;      /* raw request size on input, not current request size */
 
@@ -186,7 +188,7 @@
 void clientAccessCheck(ClientHttpRequest *);
 
 /* ones that should be elsewhere */
-void tunnelStart(ClientHttpRequest *, int64_t *, int *, const AccessLogEntry::Pointer &al);
+void tunnelStart(ClientHttpRequest *, int *, const AccessLogEntry::Pointer &al);
 
 #if _USE_INLINE_
 #include "client_side_request.cci"

=== modified file 'src/tests/stub_tunnel.cc'
--- src/tests/stub_tunnel.cc	2015-01-13 07:25:36 +0000
+++ src/tests/stub_tunnel.cc	2015-09-13 16:11:11 +0000
@@ -14,7 +14,7 @@
 #include "FwdState.h"
 class ClientHttpRequest;
 
-void tunnelStart(ClientHttpRequest *, int64_t *, int *, const AccessLogEntryPointer &al) STUB
+void tunnelStart(ClientHttpRequest *, int *, const AccessLogEntryPointer &al) STUB
 
 void switchToTunnel(HttpRequest *request, Comm::ConnectionPointer &clientConn, Comm::ConnectionPointer &srvConn) STUB
 

=== modified file 'src/tunnel.cc'
--- src/tunnel.cc	2015-09-02 14:17:07 +0000
+++ src/tunnel.cc	2015-09-13 16:10:26 +0000
@@ -988,7 +988,7 @@
 }
 
 void
-tunnelStart(ClientHttpRequest * http, int64_t * size_ptr, int *status_ptr, const AccessLogEntryPointer &al)
+tunnelStart(ClientHttpRequest * http, int *status_ptr, const AccessLogEntryPointer &al)
 {
     debugs(26, 3, HERE);
     /* Create state structure. */
@@ -1030,7 +1030,8 @@
 #endif
     tunnelState->url = xstrdup(url);
     tunnelState->request = request;
-    tunnelState->server.size_ptr = size_ptr;
+    tunnelState->server.size_ptr = &http->out.size;
+    tunnelState->client.size_ptr = &http->in_size;
     tunnelState->status_ptr = status_ptr;
     tunnelState->logTag_ptr = &http->logType;
     tunnelState->client.conn = http->getConn()->clientConnection;

