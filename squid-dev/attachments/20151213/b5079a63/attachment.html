<tt>
&lt;p&nbsp;dir=&quot;ltr&quot;&gt;Agreed.&nbsp;Thanks&lt;/p&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Dec&nbsp;11,&nbsp;2015&nbsp;17:41,&nbsp;&quot;Alex&nbsp;Rousskov&quot;&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&nbsp;type=&quot;attribution&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;On&nbsp;12/10/2015&nbsp;02:23&nbsp;PM,&nbsp;Kinkie&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;Thu,&nbsp;Dec&nbsp;10,&nbsp;2015&nbsp;at&nbsp;10:07&nbsp;PM,&nbsp;Alex&nbsp;Rousskov&nbsp;wrote:&lt;br&gt;<br>
&gt;&gt;&nbsp;On&nbsp;12/10/2015&nbsp;11:25&nbsp;AM,&nbsp;Francesco&nbsp;Chemolli&nbsp;wrote:&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;And&nbsp;it&nbsp;is&nbsp;actually&nbsp;pretty&nbsp;detectable:&nbsp;let’s&nbsp;choose&nbsp;an&nbsp;arbitrary&nbsp;size&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;of&nbsp;the&nbsp;shared&nbsp;segment&nbsp;and&nbsp;output&nbsp;a&nbsp;warning&nbsp;message&nbsp;to&nbsp;cache.log.&nbsp;This&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;won’t&nbsp;help&nbsp;with&nbsp;the&nbsp;speed,&nbsp;but&nbsp;it&nbsp;might&nbsp;help&nbsp;with&nbsp;the&nbsp;confusion..&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&gt;&nbsp;2015/12/09&nbsp;11:24:51|&nbsp;Total&nbsp;mlock()&nbsp;delay&nbsp;exceeded&nbsp;5.3&nbsp;seconds.&nbsp;See&lt;br&gt;<br>
&gt;&gt;&nbsp;shared_memory_locking&nbsp;in&nbsp;squid.conf.documented.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;was&nbsp;thinking&nbsp;more&nbsp;of&nbsp;something&nbsp;_before_&nbsp;the&nbsp;delay:&lt;br&gt;<br>
&gt;&nbsp;e.g.&nbsp;if&nbsp;shared&nbsp;memory&nbsp;is&nbsp;&gt;&nbsp;100mb,&nbsp;then&lt;br&gt;<br>
&gt;&nbsp;&quot;locking&nbsp;XXX&nbsp;mbytes&nbsp;of&nbsp;shared&nbsp;memory.&nbsp;On&nbsp;some&nbsp;systems&nbsp;this&nbsp;may&nbsp;require&lt;br&gt;<br>
&gt;&nbsp;a&nbsp;long&nbsp;time.&nbsp;Squid&nbsp;is&nbsp;not&nbsp;dead,&nbsp;it&#39;s&nbsp;just&nbsp;thinking&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;think&nbsp;the&nbsp;post-event&nbsp;warning&nbsp;is&nbsp;better:&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;It&nbsp;is&nbsp;difficult&nbsp;to&nbsp;guess&nbsp;which&nbsp;segment&nbsp;sizes&nbsp;will&nbsp;cause&nbsp;significant&lt;br&gt;<br>
delays&nbsp;in&nbsp;a&nbsp;given&nbsp;environment.&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;Squid&nbsp;allocates&nbsp;many&nbsp;segments&nbsp;and&nbsp;a&nbsp;few&nbsp;large&nbsp;segments.&nbsp;Warning&nbsp;the&lt;br&gt;<br>
admin&nbsp;before&nbsp;each&nbsp;large&nbsp;allocation&nbsp;would&nbsp;create&nbsp;a&nbsp;lot&nbsp;of&nbsp;noise.&nbsp;Not&lt;br&gt;<br>
warning&nbsp;the&nbsp;admin&nbsp;before&nbsp;some&nbsp;large&nbsp;allocations&nbsp;would&nbsp;kind&nbsp;of&nbsp;defeat&nbsp;the&lt;br&gt;<br>
idea&nbsp;of&nbsp;the&nbsp;preemptive&nbsp;warning&nbsp;itself.&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;There&nbsp;is&nbsp;a&nbsp;possibility&nbsp;that&nbsp;the&nbsp;significant&nbsp;(from&nbsp;admin&nbsp;point&nbsp;of&nbsp;view)&lt;br&gt;<br>
startup&nbsp;delay&nbsp;is&nbsp;caused&nbsp;by&nbsp;the&nbsp;_cumulative_&nbsp;effect&nbsp;of&nbsp;locking&nbsp;various&lt;br&gt;<br>
shared&nbsp;memory&nbsp;segments&nbsp;and&nbsp;not&nbsp;by&nbsp;any&nbsp;single&nbsp;segment.&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;Warning&nbsp;folks&nbsp;about&nbsp;something&nbsp;that&nbsp;has&nbsp;not&nbsp;happened&nbsp;yet&nbsp;and&nbsp;may&nbsp;never&lt;br&gt;<br>
happen&nbsp;increases&nbsp;log&nbsp;noise.&nbsp;In&nbsp;this&nbsp;particular&nbsp;case,&nbsp;we&nbsp;_can_&nbsp;warn&nbsp;when&lt;br&gt;<br>
we&nbsp;know&nbsp;that&nbsp;startup&nbsp;was&nbsp;significantly&nbsp;delayed&nbsp;because&nbsp;of&nbsp;locking,&lt;br&gt;<br>
reducing&nbsp;that&nbsp;noise.&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;There&nbsp;is&nbsp;a&nbsp;good&nbsp;chance&nbsp;that&nbsp;somebody&nbsp;concerned&nbsp;about&nbsp;startup&nbsp;delays&lt;br&gt;<br>
will&nbsp;notice&nbsp;the&nbsp;first&nbsp;line&nbsp;printed&nbsp;_after_&nbsp;the&nbsp;delay.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Are&nbsp;you&nbsp;sure&nbsp;that&nbsp;preemptive&nbsp;per-segment&nbsp;warnings&nbsp;are&nbsp;better&nbsp;than&nbsp;an&lt;br&gt;<br>
acknowledgement&nbsp;of&nbsp;the&nbsp;problem&nbsp;after&nbsp;it&nbsp;happens?&nbsp;Do&nbsp;you&nbsp;think&nbsp;the&nbsp;latter&lt;br&gt;<br>
is&nbsp;likely&nbsp;to&nbsp;be&nbsp;missed&nbsp;by&nbsp;admins&nbsp;investigating&nbsp;startup&nbsp;delays?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;and&nbsp;then&nbsp;when&nbsp;it&#39;s&nbsp;done&nbsp;&quot;shared&nbsp;memory&nbsp;locking&nbsp;of&nbsp;X&nbsp;Mb&nbsp;done&nbsp;in&nbsp;Y&lt;br&gt;<br>
&gt;&nbsp;seconds.&nbsp;This&nbsp;may&nbsp;be&nbsp;normal&nbsp;depending&nbsp;on&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;shared&nbsp;memory&lt;br&gt;<br>
&gt;&nbsp;area&quot;.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;would&nbsp;rather&nbsp;put&nbsp;explanations&nbsp;in&nbsp;squid.conf.documented&nbsp;so&nbsp;that&nbsp;we&nbsp;do&lt;br&gt;<br>
not&nbsp;have&nbsp;to&nbsp;risk&nbsp;misleading&nbsp;folks&nbsp;when&nbsp;discussing&nbsp;complex&nbsp;issues&nbsp;using&nbsp;a&lt;br&gt;<br>
one-line&nbsp;statement.&nbsp;Besides,&nbsp;we&nbsp;need&nbsp;to&nbsp;point&nbsp;folks&nbsp;to&nbsp;options&lt;br&gt;<br>
controlling&nbsp;this&nbsp;behavior&nbsp;(in&nbsp;case&nbsp;they&nbsp;do&nbsp;not&nbsp;think&nbsp;that&nbsp;slow&nbsp;startup&lt;br&gt;<br>
is&nbsp;&quot;normal&quot;&nbsp;for&nbsp;them).&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Thank&nbsp;you,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
