<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Alright.&nbsp;Here&nbsp;is&nbsp;the&nbsp;patch&nbsp;as&nbsp;git&nbsp;patch.&nbsp;Hope&nbsp;that&nbsp;works.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;left&nbsp;out&nbsp;the&nbsp;&quot;flags&quot;&nbsp;variable&nbsp;from&nbsp;the&nbsp;shm_open()&nbsp;call&nbsp;that&nbsp;you&nbsp;showed,&nbsp;since&nbsp;I&nbsp;didn&#39;t&nbsp;see&nbsp;it&nbsp;being&nbsp;used&nbsp;or&nbsp;declared&nbsp;anywhere.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;commit&nbsp;message&nbsp;is&nbsp;lengthy,&nbsp;but&nbsp;I&nbsp;tried&nbsp;to&nbsp;explain&nbsp;what&#39;s&nbsp;going&nbsp;on,&nbsp;so&nbsp;others&nbsp;don&#39;t&nbsp;have&nbsp;to&nbsp;go&nbsp;digging&nbsp;for&nbsp;the&nbsp;same&nbsp;problem&nbsp;in&nbsp;the&nbsp;future.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;did&nbsp;test&nbsp;it,&nbsp;and&nbsp;it&nbsp;works&nbsp;&quot;as&nbsp;advertised&quot;.&nbsp;I&nbsp;noticed&nbsp;that&nbsp;the&nbsp;4.0&nbsp;code&nbsp;base&nbsp;of&nbsp;Squid&nbsp;does&nbsp;a&nbsp;much&nbsp;better&nbsp;job&nbsp;of&nbsp;cleaning&nbsp;up&nbsp;after&nbsp;itself&nbsp;than&nbsp;3.5&nbsp;did.&nbsp;With&nbsp;3.5,&nbsp;I&nbsp;could&nbsp;trigger&nbsp;the&nbsp;problem&nbsp;by&nbsp;starting&nbsp;Squid&nbsp;in&nbsp;the&nbsp;foreground&nbsp;(&quot;squid&nbsp;-N&quot;)&nbsp;and&nbsp;then&nbsp;hitting&nbsp;Ctrl-C&nbsp;twice&nbsp;(the&nbsp;second&nbsp;time&nbsp;would&nbsp;interrupt&nbsp;the&nbsp;cleanup&nbsp;process).&nbsp;With&nbsp;the&nbsp;4.0&nbsp;code&nbsp;base,&nbsp;I&nbsp;had&nbsp;to&nbsp;use&nbsp;&quot;kill&nbsp;-9&quot;&nbsp;to&nbsp;get&nbsp;it&nbsp;to&nbsp;leave&nbsp;the&nbsp;shared&nbsp;memory&nbsp;segments&nbsp;behind.&nbsp;My&nbsp;other&nbsp;attempts&nbsp;at&nbsp;triggering&nbsp;the&nbsp;problem&nbsp;failed,&nbsp;because&nbsp;it&nbsp;continued&nbsp;to&nbsp;clean&nbsp;up&nbsp;properly,&nbsp;despite&nbsp;being&nbsp;sent&nbsp;multiple&nbsp;signals.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;improved&nbsp;cleanup&nbsp;is&nbsp;good&nbsp;news.&nbsp;It&nbsp;means&nbsp;the&nbsp;EEXIST&nbsp;condition&nbsp;won&#39;t&nbsp;be&nbsp;hit&nbsp;nearly&nbsp;as&nbsp;much&nbsp;as&nbsp;it&nbsp;would&nbsp;otherwise.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Regards,&lt;/div&gt;&lt;div&gt;-Markus&lt;/div&gt;&lt;/div&gt;<br>

</tt>
