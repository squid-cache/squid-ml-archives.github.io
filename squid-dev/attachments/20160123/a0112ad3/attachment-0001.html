<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;23&nbsp;January&nbsp;2016&nbsp;at&nbsp;09:35,&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;span&gt;On&nbsp;01/21/2016&nbsp;08:03&nbsp;PM,&nbsp;Markus&nbsp;Mayer&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;left&nbsp;out&nbsp;the&nbsp;&quot;flags&quot;&nbsp;variable&nbsp;from&nbsp;the&nbsp;shm_open()&nbsp;call&nbsp;that&nbsp;you&lt;br&gt;<br>
&gt;&nbsp;showed,&nbsp;since&nbsp;I&nbsp;didn&#39;t&nbsp;see&nbsp;it&nbsp;being&nbsp;used&nbsp;or&nbsp;declared&nbsp;anywhere.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;Sorry&nbsp;about&nbsp;that&nbsp;leftover&nbsp;from&nbsp;a&nbsp;previous&nbsp;version&nbsp;of&nbsp;my&nbsp;sketch.&nbsp;You&nbsp;did&lt;br&gt;<br>
the&nbsp;right&nbsp;thing.&lt;br&gt;<br>
&lt;span&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;did&nbsp;test&nbsp;it,&nbsp;and&nbsp;it&nbsp;works&nbsp;&quot;as&nbsp;advertised&quot;.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;Your&nbsp;patch&nbsp;is&nbsp;solving&nbsp;two&nbsp;problems&nbsp;at&nbsp;once.&nbsp;You&nbsp;have&nbsp;described&nbsp;only&nbsp;one,&lt;br&gt;<br>
but&nbsp;the&nbsp;other&nbsp;problem[1]&nbsp;is&nbsp;arguably&nbsp;more&nbsp;severe&nbsp;because&nbsp;(a)&nbsp;it&nbsp;leads&nbsp;to&lt;br&gt;<br>
subtle&nbsp;bugs&nbsp;and&nbsp;crashes&nbsp;rather&nbsp;than&nbsp;startup&nbsp;failures&nbsp;and&nbsp;(b)&nbsp;most&nbsp;people&lt;br&gt;<br>
run&nbsp;Squid&nbsp;on&nbsp;OSes&nbsp;other&nbsp;than&nbsp;OS&nbsp;X.&lt;br&gt;<br>
&lt;span&gt;&lt;br&gt;<br>
[1]&nbsp;Item&nbsp;#1&nbsp;at&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/pipermail/squid-dev/2015-December/004112.html&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/pipermail/squid-dev/2015-December/004112.html&lt;/a&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;div&gt; &lt;/div&gt;&lt;div&gt;Right.&nbsp;I&nbsp;completely&nbsp;forgot&nbsp;about&nbsp;that.&nbsp;I&nbsp;had&nbsp;most&nbsp;of&nbsp;the&nbsp;documentation&nbsp;written&nbsp;up&nbsp;before&nbsp;I&nbsp;learned&nbsp;about&nbsp;the&nbsp;other&nbsp;problem.&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;IMO,&nbsp;we&nbsp;should&nbsp;document&nbsp;both&nbsp;problems&nbsp;in&nbsp;the&nbsp;code&nbsp;to&nbsp;minimize&nbsp;our&lt;br&gt;<br>
chances&nbsp;of&nbsp;repeating&nbsp;them&nbsp;during&nbsp;future&nbsp;refactoring.&nbsp;I&nbsp;suggest&nbsp;replacing&lt;br&gt;<br>
this&nbsp;comment&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Agreed.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;```&lt;br&gt;<br>
Why&nbsp;a&nbsp;brand&nbsp;new&nbsp;segment?&nbsp;Our&nbsp;placement-new&nbsp;code&nbsp;requires&nbsp;an&nbsp;all-0&lt;br&gt;<br>
segment.&nbsp;We&nbsp;could&nbsp;truncate&nbsp;and&nbsp;resize&nbsp;an&nbsp;old&nbsp;segment,&nbsp;but&nbsp;OS&nbsp;X&nbsp;does&nbsp;not&lt;br&gt;<br>
allow&nbsp;using&nbsp;O_TRUNC&nbsp;with&nbsp;shm_open()&nbsp;and&nbsp;does&nbsp;not&nbsp;support&nbsp;resizing&nbsp;after&lt;br&gt;<br>
ftruncate(0).```&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Maybe&nbsp;say&nbsp;&quot;doesn&#39;t&nbsp;support&nbsp;resizing&nbsp;using&nbsp;a&nbsp;second&nbsp;ftruncate()&nbsp;call&quot;&nbsp;or&nbsp;something&nbsp;along&nbsp;those&nbsp;lines,&nbsp;since&nbsp;it&nbsp;doesn&#39;t&nbsp;support&nbsp;resizing&nbsp;of&nbsp;any&nbsp;kind,&nbsp;not&nbsp;just&nbsp;after&nbsp;ftruncate(0).&nbsp;But&nbsp;I&#39;m&nbsp;not&nbsp;going&nbsp;to&nbsp;insist&nbsp;on&nbsp;you&nbsp;rewording&nbsp;the&nbsp;comment&nbsp;you&nbsp;have.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;and&nbsp;perhaps&nbsp;renaming&nbsp;createExclusive()&nbsp;to&nbsp;createFresh()&nbsp;for&nbsp;clarity.&nbsp;The&lt;br&gt;<br>
above&nbsp;can&nbsp;be&nbsp;done&nbsp;during&nbsp;commit&nbsp;--&nbsp;no&nbsp;need&nbsp;to&nbsp;repost&nbsp;IMO.&lt;br&gt;&lt;br&gt;<br>
Your&nbsp;commit&nbsp;message&nbsp;will&nbsp;explain&nbsp;the&nbsp;details.&nbsp;I&nbsp;(or&nbsp;another&nbsp;committer)&lt;br&gt;<br>
will&nbsp;add&nbsp;text&nbsp;to&nbsp;state&nbsp;that&nbsp;problem&nbsp;[1]&nbsp;is&nbsp;also&nbsp;fixed&nbsp;by&nbsp;this&nbsp;change.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;No&nbsp;objections.&nbsp;Looks&nbsp;good&nbsp;to&nbsp;me.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Regards,&lt;/div&gt;&lt;div&gt;-Markus&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
