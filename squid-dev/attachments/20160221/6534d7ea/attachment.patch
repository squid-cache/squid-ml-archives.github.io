Index: squid-3.5.13/src/icmp/pinger.cc
===================================================================
--- squid-3.5.13.orig/src/icmp/pinger.cc
+++ squid-3.5.13/src/icmp/pinger.cc
@@ -174,6 +174,30 @@ main(int argc, char *argv[])
         exit (1);
     }
 
+#if USE_LIBCAP
+    // Drop remaining capabilities (if installed as non-setuid setcap cap_net_raw=ep).
+    // If pinger binary was installed setuid root, setuid() above already dropped all
+    // capabilities, and this is no-op.
+    cap_t caps;
+    caps = cap_init();
+    if (!caps) {
+        debugs(42, DBG_CRITICAL, "FATAL: pinger: cap_init() failed: " << xstrerror());
+        icmp4.Close();
+        icmp6.Close();
+        exit (1);
+    } else {
+        if (cap_set_proc(caps) != 0) {
+            // cap_set_proc(cap_init()) is expected to never fail
+            debugs(42, DBG_CRITICAL, "FATAL: pinger: cap_set_proc(none) failed: " << xstrerror());
+            cap_free(caps);
+            icmp4.Close();
+            icmp6.Close();
+            exit (1);
+        }
+        cap_free(caps);
+    }
+#endif
+
     last_check_time = squid_curtime;
 
     for (;;) {
