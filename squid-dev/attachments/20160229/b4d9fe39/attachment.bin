Squid crashes on shutdown while cleaning up idle ICAP connections.

The global Adaptation::Icap::TheConfig object is automatically 
destroyed when Squid exits. Its destructor destroys Icap::ServiceRep
objects that, in turn, close all open connections in the idle 
connections pool. Since this happens after comm_exit has destroyed all
Comm structures associated with those connections, Squid crases.

This is a Measurement Factory project.

=== modified file 'src/main.cc'
--- src/main.cc	2016-02-01 11:52:03 +0000
+++ src/main.cc	2016-02-16 21:03:59 +0000
@@ -2001,40 +2001,43 @@
     wccp2ConnectionClose();
 #endif
 
     releaseServerSockets();
     commCloseAllSockets();
 
 #if USE_SQUID_ESI
     Esi::Clean();
 #endif
 
 #if USE_DELAY_POOLS
     DelayPools::FreePools();
 #endif
 #if USE_AUTH
     authenticateReset();
 #endif
 #if USE_WIN32_SERVICE
 
     WIN32_svcstatusupdate(SERVICE_STOP_PENDING, 10000);
 #endif
+#if ICAP_CLIENT
+    Adaptation::Icap::TheConfig.freeService();
+#endif
 
     Store::Root().sync(); /* Flush pending object writes/unlinks */
 
     unlinkdClose();   /* after sync/flush. NOP if !USE_UNLINKD */
 
     storeDirWriteCleanLogs(0);
     PrintRusage();
     dumpMallocStats();
     Store::Root().sync();       /* Flush log writes */
     storeLogClose();
     accessLogClose();
     Store::Root().sync();       /* Flush log close */
     StoreFileSystem::FreeAllFs();
     DiskIOModule::FreeAllModules();
 #if LEAK_CHECK_MODE && 0 /* doesn't work at the moment */
 
     configFreeMemory();
     storeFreeMemory();
     /*stmemFreeMemory(); */
     netdbFreeMemory();

