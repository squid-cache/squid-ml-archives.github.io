=== modified file 'src/client_side.cc'
--- src/client_side.cc	2016-03-10 06:55:17 +0000
+++ src/client_side.cc	2016-03-31 05:09:41 +0000
@@ -1012,9 +1012,7 @@
     http->uri = xstrdup(uri);
     setLogUri (http, uri);
     auto *context = new Http::Stream(clientConnection, http);
-    StoreIOBuffer tempBuffer;
-    tempBuffer.data = context->reqbuf;
-    tempBuffer.length = HTTP_REQBUF_SZ;
+    StoreIOBuffer tempBuffer = context->getStoreIOBuffer();
     clientStreamInit(&http->client_stream, clientGetMoreData, clientReplyDetach,
                      clientReplyStatus, new clientReplyContext(http), clientSocketRecipient,
                      clientSocketDetach, context, tempBuffer);
@@ -1359,9 +1357,7 @@
     http->req_sz = hp->messageHeaderSize();
     Http::Stream *result = new Http::Stream(csd->clientConnection, http);
 
-    StoreIOBuffer tempBuffer;
-    tempBuffer.data = result->reqbuf;
-    tempBuffer.length = HTTP_REQBUF_SZ;
+    StoreIOBuffer tempBuffer = result->getStoreIOBuffer();
 
     ClientStreamData newServer = new clientReplyContext(http);
     ClientStreamData newClient = result;

=== modified file 'src/defines.h'
--- src/defines.h	2016-01-01 00:12:18 +0000
+++ src/defines.h	2016-03-31 05:09:41 +0000
@@ -216,6 +216,7 @@
 #endif
 
 #define HTTP_REQBUF_SZ  4096
+#define HTTP_STREAM_REQBUF_SIZE  65536
 
 /* CygWin & Windows NT Port */
 #if _SQUID_WINDOWS_

=== modified file 'src/http/Stream.cc'
--- src/http/Stream.cc	2016-01-24 17:41:43 +0000
+++ src/http/Stream.cc	2016-03-31 05:09:41 +0000
@@ -109,12 +109,10 @@
     debugs(33, 5, reply << " written " << http->out.size << " into " << clientConnection);
 
     /* More data will be coming from the stream. */
-    StoreIOBuffer readBuffer;
+    StoreIOBuffer readBuffer = getStoreIOBuffer();
     /* XXX: Next requested byte in the range sequence */
     /* XXX: length = getmaximumrangelenfgth */
     readBuffer.offset = getNextRangeOffset();
-    readBuffer.length = HTTP_REQBUF_SZ;
-    readBuffer.data = reqbuf;
     /* we may note we have reached the end of the wanted ranges */
     clientStreamRead(getTail(), http, readBuffer);
 }

=== modified file 'src/http/Stream.h'
--- src/http/Stream.h	2016-01-31 12:05:30 +0000
+++ src/http/Stream.h	2016-03-31 05:09:41 +0000
@@ -125,7 +125,7 @@
     Comm::ConnectionPointer clientConnection; ///< details about the client connection socket
     ClientHttpRequest *http;    /* we pretend to own that Job */
     HttpReply *reply;
-    char reqbuf[HTTP_REQBUF_SZ];
+    char reqbuf[HTTP_STREAM_REQBUF_SIZE];
     struct {
         unsigned deferred:1; ///< This is a pipelined request waiting for the current object to complete
         unsigned parsed_ok:1; ///< Was this parsed correctly?
@@ -138,6 +138,13 @@
         debugs(33, 3, "This " << this << " marked " << aBool);
     }
 
+    StoreIOBuffer getStoreIOBuffer() {
+        StoreIOBuffer tempBuffer;
+        tempBuffer.data = this->reqbuf;
+        tempBuffer.length = HTTP_STREAM_REQBUF_SIZE;
+        return tempBuffer;
+    }
+
     class DeferredParams
     {
 

=== modified file 'src/servers/FtpServer.cc'
--- src/servers/FtpServer.cc	2016-01-31 12:05:30 +0000
+++ src/servers/FtpServer.cc	2016-03-31 05:09:41 +0000
@@ -751,9 +751,7 @@
     Http::Stream *const result =
         new Http::Stream(clientConnection, http);
 
-    StoreIOBuffer tempBuffer;
-    tempBuffer.data = result->reqbuf;
-    tempBuffer.length = HTTP_REQBUF_SZ;
+    StoreIOBuffer tempBuffer = result->getStoreIOBuffer();
 
     ClientStreamData newServer = new clientReplyContext(http);
     ClientStreamData newClient = result;

