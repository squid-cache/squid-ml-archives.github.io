<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Yeah,mistaken&nbsp;-&nbsp;squid&nbsp;3.5.22&lt;br&gt;&lt;br&gt;&lt;/div&gt;nfds=284,&nbsp;so&nbsp;loop&nbsp;ends&nbsp;on&nbsp;283&nbsp;and&nbsp;pfds[283]&nbsp;is&nbsp;buggy&lt;br&gt;&lt;br&gt;&lt;/div&gt;I/o&nbsp;module&nbsp;is &nbsp;src/comm/ModPoll.cc,&nbsp;method&nbsp;Comm::&lt;wbr&gt;DoSelect(int&nbsp;msec)&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;On&nbsp;stack&nbsp;we&nbsp;see&nbsp;that&nbsp;pfds[SQUID_MAXFD=256],&nbsp;so&nbsp;is&nbsp;less&nbsp;than&nbsp;nfds&nbsp;in&nbsp;loop.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;May&nbsp;be&nbsp;malloc&nbsp;nfds?&nbsp;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;2016-10-18&nbsp;8:29&nbsp;GMT+03:00&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;target=&quot;_blank&quot;&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&nbsp;class=&quot;gmail_quote&quot;&gt;FYI:&nbsp;Squid-3.5.23&nbsp;does&nbsp;not&nbsp;exist&nbsp;yet.&nbsp;What&nbsp;is&nbsp;the&nbsp;output&nbsp;of&nbsp;&quot;squid&nbsp;-v&quot;&nbsp;?&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;gmail-&quot;&gt;&lt;br&gt;<br>
On&nbsp;18/10/2016&nbsp;5:01&nbsp;a.m.,&nbsp;oleg&nbsp;gv&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;have&nbsp;big&nbsp;traffic&nbsp;(at&nbsp;least&nbsp;100&nbsp;computers)&nbsp;,&nbsp;and&nbsp;squid&nbsp;often&nbsp;crashed&nbsp;in&lt;br&gt;<br>
&gt;&nbsp;Comm::DoSelect(int&nbsp;msec)&nbsp;function.&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;have&nbsp;interception&nbsp;mode&nbsp;and&nbsp;NAT&nbsp;redirect.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;In&nbsp;coredump&nbsp;I&nbsp;saw&nbsp;then&nbsp;bug&nbsp;is&nbsp;in&nbsp;next&nbsp;fragment&nbsp;of&nbsp;code:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;446│ &nbsp; &nbsp; &nbsp; &nbsp; for&nbsp;(size_t&nbsp;loopIndex&nbsp;=&nbsp;0;&nbsp;loopIndex&nbsp;&lt;&nbsp;nfds;&nbsp;++loopIndex)&nbsp;{&lt;br&gt;<br>
&gt;&nbsp;447│ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fde&nbsp;*F;&lt;br&gt;<br>
&gt;&nbsp;448│ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int&nbsp;revents&nbsp;=&nbsp;pfds[loopIndex].revents;&lt;br&gt;<br>
&gt;&nbsp;449│ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fd&nbsp;=&nbsp;pfds[loopIndex].fd;&lt;br&gt;<br>
&gt;&nbsp;450│&lt;br&gt;<br>
&gt;&nbsp;451│ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if&nbsp;(fd&nbsp;==&nbsp;-1)&lt;br&gt;<br>
&gt;&nbsp;452│ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; continue;&lt;br&gt;<br>
&gt;&nbsp;453│&lt;br&gt;<br>
&gt;&nbsp;454├&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if&nbsp;(fd_table[fd].flags.read_&lt;wbr&gt;pending)&lt;br&gt;<br>
&gt;&nbsp;455│ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; revents&nbsp;|=&nbsp;POLLIN;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;SIGSEGV&nbsp;occured&nbsp;often&nbsp;(about&nbsp;1&nbsp;time&nbsp;in&nbsp;a&nbsp;minute)&nbsp;in&nbsp;line&nbsp;454&nbsp;:&nbsp;fd=-66012128&lt;br&gt;<br>
&gt;&nbsp;,&nbsp;loopindex=283&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;(gdb)&nbsp;p&nbsp;pfds[282]&lt;br&gt;<br>
&gt;&nbsp;$17&nbsp;=&nbsp;{fd&nbsp;=&nbsp;291,&nbsp;events&nbsp;=&nbsp;64,&nbsp;revents&nbsp;=&nbsp;0} &nbsp; --&nbsp;looks&nbsp;ok&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;(gdb)&nbsp;p&nbsp;pfds[283]&lt;br&gt;<br>
&gt;&nbsp;$18&nbsp;=&nbsp;{fd&nbsp;=&nbsp;-66012128,&nbsp;events&nbsp;=&nbsp;32595,&nbsp;revents&nbsp;=&nbsp;0} &nbsp;--&nbsp;looks&nbsp;strange&nbsp;and&lt;br&gt;<br>
&gt;&nbsp;spoiled&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;(gdb)&nbsp;p&nbsp;Biggest_FD&lt;br&gt;<br>
&gt;&nbsp;$19&nbsp;=&nbsp;292&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;What&nbsp;is&nbsp;the&nbsp;nfds&nbsp;value&nbsp;?&lt;br&gt;<br>
&lt;br&gt;<br>
It&nbsp;looks&nbsp;to&nbsp;me&nbsp;like&nbsp;only&nbsp;282&nbsp;FD&nbsp;have&nbsp;operations&nbsp;to&nbsp;perform&nbsp;on&nbsp;this&nbsp;I/O&lt;br&gt;<br>
cycle.&lt;br&gt;<br>
&lt;br&gt;<br>
What&nbsp;I/O&nbsp;module&nbsp;is&nbsp;being&nbsp;used?&lt;br&gt;<br>
&lt;br&gt;<br>
 src/comm/ModDevPoll.cc:Comm::&lt;wbr&gt;DoSelect(int&nbsp;msec)&lt;br&gt;<br>
 src/comm/ModPoll.cc:Comm::&lt;wbr&gt;DoSelect(int&nbsp;msec)&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Amos&lt;br&gt;<br>
&lt;br&gt;<br>
______________________________&lt;wbr&gt;_________________&lt;br&gt;<br>
squid-dev&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-dev@lists.squid-cache.org&quot;&gt;squid-dev@lists.squid-cache.&lt;wbr&gt;org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-dev&quot;&gt;http://lists.squid-cache.org/&lt;wbr&gt;listinfo/squid-dev&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
