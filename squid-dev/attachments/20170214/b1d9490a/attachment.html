<tt>
&lt;div&gt; &lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;div&gt;14.02.2017,&nbsp;21:50,&nbsp;&quot;Alex&nbsp;Rousskov&quot;&nbsp;&lt;rousskov@measurement-factory.com&gt;:&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;p&gt;When&nbsp;I&nbsp;am&nbsp;talking&nbsp;about&nbsp;the&nbsp;forwarding&nbsp;case,&nbsp;I&nbsp;am&nbsp;talking&nbsp;about&nbsp;a&nbsp;simple&lt;br&nbsp;/&gt;configuration&nbsp;without&nbsp;any&nbsp;redirection&nbsp;or&nbsp;other&nbsp;TCP/IP&nbsp;level&nbsp;tricks&nbsp;or&lt;br&nbsp;/&gt;even&nbsp;reverse&nbsp;proxing&nbsp;of&nbsp;any&nbsp;sort:&nbsp;The&nbsp;FTP&nbsp;client&nbsp;sends&nbsp;FTP&nbsp;requests&lt;br&nbsp;/&gt;directly&nbsp;to&nbsp;Squid's&nbsp;ftp_port&nbsp;(specifying&nbsp;the&nbsp;ultimate&nbsp;destination&nbsp;using&lt;br&nbsp;/&gt;an&nbsp;extra&nbsp;@&nbsp;sign).&nbsp;IIRC,&nbsp;that&nbsp;used&nbsp;to&nbsp;work&nbsp;with&nbsp;popular&nbsp;proxy-aware&nbsp;FTP&lt;br&nbsp;/&gt;clients&nbsp;when&nbsp;we&nbsp;added&nbsp;the&nbsp;ftp_port&nbsp;code.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;In&nbsp;that&nbsp;simple&nbsp;case,&nbsp;some&nbsp;FTP&nbsp;client&nbsp;refuse&nbsp;to&nbsp;accept&nbsp;the&nbsp;FTP&nbsp;data&lt;br&nbsp;/&gt;connection&nbsp;from&nbsp;Squid&nbsp;unless&nbsp;that&nbsp;data&nbsp;connection&nbsp;comes&nbsp;from&nbsp;the&nbsp;same&lt;br&nbsp;/&gt;source&nbsp;IP&nbsp;address&nbsp;as&nbsp;the&nbsp;destination&nbsp;address&nbsp;of&nbsp;the&nbsp;corresponding&nbsp;FTP&lt;br&nbsp;/&gt;control&nbsp;connection.&nbsp;The&nbsp;old&nbsp;&quot;Use&nbsp;local&nbsp;IP...&quot;&nbsp;code/comment&nbsp;were&nbsp;added&nbsp;to&lt;br&nbsp;/&gt;make&nbsp;such&nbsp;clients&nbsp;happy&nbsp;(the&nbsp;changes&nbsp;in&nbsp;[trunk]&nbsp;revision&nbsp;12742.1.41&nbsp;are&lt;br&nbsp;/&gt;pretty&nbsp;telling,&nbsp;especially&nbsp;in&nbsp;the&nbsp;light&nbsp;of&nbsp;your&nbsp;changes).&lt;/p&gt;&lt;/blockquote&gt;&lt;div&gt; &lt;/div&gt;&lt;div&gt;Just&nbsp;tried&nbsp;the&nbsp;following&nbsp;setup&nbsp;with&nbsp;squid&nbsp;running&nbsp;on&nbsp;localhost:21:&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;div&gt;&lt;div&gt;[alg@centos64x64&nbsp;~]$&nbsp;ftp&nbsp;127.0.0.1&lt;/div&gt;&lt;div&gt;Connected&nbsp;to&nbsp;127.0.0.1&nbsp;(127.0.0.1).&lt;/div&gt;&lt;div&gt;220&nbsp;Service&nbsp;ready&lt;/div&gt;&lt;div&gt;Name&nbsp;(127.0.0.1:alg):&nbsp;anonymous@172.17.10.30&lt;/div&gt;&lt;div&gt;331&nbsp;Anonymous&nbsp;access&nbsp;allowed,&nbsp;send&nbsp;identity&nbsp;(e-mail&nbsp;name)&nbsp;as&nbsp;password.&lt;/div&gt;&lt;div&gt;Password:&lt;/div&gt;&lt;div&gt;230&nbsp;User&nbsp;logged&nbsp;in.&lt;/div&gt;&lt;div&gt;Remote&nbsp;system&nbsp;type&nbsp;is&nbsp;Windows_NT.&lt;/div&gt;&lt;div&gt;ftp&gt;&nbsp;passive&lt;/div&gt;&lt;div&gt;Passive&nbsp;mode&nbsp;off.&lt;/div&gt;&lt;div&gt;ftp&gt;&nbsp;ls&lt;/div&gt;&lt;div&gt;200&nbsp;PORT&nbsp;successfully&nbsp;converted&nbsp;to&nbsp;PASV.&lt;/div&gt;&lt;div&gt;125&nbsp;Data&nbsp;connection&nbsp;already&nbsp;open;&nbsp;Transfer&nbsp;starting.&lt;/div&gt;&lt;div&gt;...&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;also&nbsp;tried&nbsp;to&nbsp;connect&nbsp;from&nbsp;my&nbsp;Windows&nbsp;machine&nbsp;to&nbsp;itself&nbsp;via&nbsp;squid&nbsp;on&nbsp;a&nbsp;different&nbsp;machine&nbsp;with&nbsp;FileZilla&nbsp;client&nbsp;(proxy&nbsp;server&nbsp;was&nbsp;specified&nbsp;in&nbsp;settings)&nbsp;-&nbsp;works&nbsp;like&nbsp;a&nbsp;charm.&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;div&gt;It&nbsp;seems&nbsp;that&nbsp;the&nbsp;patch&nbsp;doesn't&nbsp;make&nbsp;things&nbsp;worse&nbsp;(if&nbsp;I&nbsp;understood&nbsp;you&nbsp;correctly).&lt;/div&gt;&lt;/div&gt;
</tt>
