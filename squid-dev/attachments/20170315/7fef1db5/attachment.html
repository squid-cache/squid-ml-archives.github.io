<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;Regarding&nbsp;the&nbsp;confinement&nbsp;of&nbsp;usage&nbsp;of&nbsp;shared&nbsp;memory&nbsp;in&nbsp;snap&nbsp;world,&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; Please&nbsp;take&nbsp;a&nbsp;look&nbsp;at&nbsp;the&nbsp;bug&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &lt;a&nbsp;href=&quot;https://bugs.launchpad.net/snappy/+bug/1653955&quot;&nbsp;target=&quot;_blank&quot;&gt;https://bugs.launchpad.net/&lt;wbr&gt;snappy/+bug/1653955&lt;/a&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; And&nbsp;Jamie&#39;s&nbsp;reply&nbsp;can&nbsp;be fuond in snapcraft maillist&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &lt;a&nbsp;href=&quot;https://www.mail-archive.com/snapcraft@lists.snapcraft.io/msg02465.html&quot;&nbsp;target=&quot;_blank&quot;&gt;https://www.mail-archive.com/&lt;wbr&gt;snapcraft@lists.snapcraft.io/&lt;wbr&gt;msg02465.html&lt;/a&gt;  &nbsp; &nbsp;  &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;  &lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(0,0,0);font-family:courier,&quot;courier&nbsp;new&quot;,monospace;font-size:14px;white-space:pre-wrap&quot;&gt;&nbsp;&nbsp;&nbsp;&quot;sem_open()&nbsp;is &lt;/span&gt;&lt;a&nbsp;rel=&quot;nofollow&quot;&nbsp;href=&quot;https://bugs.launchpad.net/snappy/+bug/1653955%C2%A0and&quot;&nbsp;target=&quot;_blank&quot;&nbsp;style=&quot;color:rgb(160,30,30);font-family:courier,&quot;courier&nbsp;new&quot;,monospace;font-size:14px;white-space:pre-wrap&quot;&gt;https://bugs.launchpad.net/&lt;wbr&gt;snappy/+bug/1653955 and&lt;/a&gt;&lt;span&nbsp;style=&quot;color:rgb(0,0,0);font-family:courier,&quot;courier&nbsp;new&quot;,monospace;font-size:14px;white-space:pre-wrap&quot;&gt;&nbsp;snapd&nbsp;2.21&lt;/span&gt;&lt;/div&gt;&lt;pre&nbsp;style=&quot;font-family:courier,&quot;courier&nbsp;new&quot;,monospace;font-size:14px;white-space:pre-wrap;word-wrap:break-word;margin-top:0px;margin-bottom:0px;color:rgb(0,0,0)&quot;&gt;added&nbsp;support&nbsp;to&nbsp;allow /{dev,run}/shm/sem.snap.&lt;wbr&gt;@{SNAP_NAME}.*.&nbsp;This&nbsp;is &lt;/pre&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(0,0,0);font-family:courier,&quot;courier&nbsp;new&quot;,monospace;font-size:14px;white-space:pre-wrap&quot;&gt;sufficient&nbsp;to&nbsp;make&nbsp;use&nbsp;of&nbsp;sem_open()&nbsp;possible.&quot;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Wed,&nbsp;Mar&nbsp;15,&nbsp;2017&nbsp;at&nbsp;12:48&nbsp;PM,&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;03/14/2017&nbsp;09:52&nbsp;PM,&nbsp;Gary&nbsp;Wang&nbsp;wrote:&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;gmail-&quot;&gt;&gt;&nbsp;On&nbsp;Tue,&nbsp;Mar&nbsp;14,&nbsp;2017&nbsp;at&nbsp;11:49&nbsp;PM,&nbsp;Alex&nbsp;Rousskov&nbsp;wrote:&lt;br&gt;<br>
&gt;&gt; &nbsp; &nbsp; On&nbsp;03/14/2017&nbsp;08:44&nbsp;AM,&nbsp;Gary&nbsp;Wang&nbsp;wrote:&lt;br&gt;<br>
&gt;&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; About&nbsp;the&nbsp;DEFAULT_STATEDIR,&lt;br&gt;<br>
&gt;&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; ...&lt;br&gt;<br>
&gt;&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; DEFS&nbsp;+=&nbsp;-DDEFAULT_STATEDIR=\&quot;$(&lt;wbr&gt;localstatedir)/run/squid\&quot;&lt;br&gt;<br>
&gt;&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; ...&lt;br&gt;<br>
&gt;&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; According&nbsp;to&nbsp;the&nbsp;above&nbsp;share&nbsp;memory&nbsp;namespace&nbsp;in&nbsp;snap&nbsp;world,&nbsp;it&lt;br&gt;<br>
&gt;&gt; &nbsp; &nbsp; &gt;&nbsp;couldn&#39;t&nbsp;help&nbsp;on&nbsp;this&nbsp;either.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;gmail-&quot;&gt;&gt;&gt; &nbsp; &nbsp; Why&nbsp;not&nbsp;make&nbsp;DEFAULT_STATEDIR&nbsp;configurable&nbsp;instead?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;gmail-&quot;&gt;&gt; &nbsp; &nbsp;A:&nbsp;Actually,&nbsp;DEFAULT_IPC_PREFIX&nbsp;only&nbsp;changes&nbsp;the&nbsp;shared&nbsp;memory&nbsp;file&nbsp;name&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp;not&nbsp;the&nbsp;file&nbsp;path.&nbsp;So&nbsp;the&nbsp;usage&nbsp;of&nbsp;these&nbsp;two&nbsp;options&nbsp;are&nbsp;different.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;You&nbsp;are&nbsp;describing&nbsp;your&nbsp;implementation.&nbsp;I&nbsp;am&nbsp;asking&nbsp;why&nbsp;not&nbsp;support&nbsp;the&lt;br&gt;<br>
same&nbsp;functionality&nbsp;using&nbsp;a&nbsp;_different_&nbsp;general&nbsp;implementation&nbsp;that&lt;br&gt;<br>
avoids&nbsp;adding&nbsp;a&nbsp;yet&nbsp;another&nbsp;option&nbsp;that&nbsp;controls&nbsp;IPC-related&nbsp;file&nbsp;names.&lt;br&gt;<br>
You&nbsp;added&nbsp;an&nbsp;option&nbsp;that&nbsp;changes&nbsp;the&nbsp;&quot;middle&quot;&nbsp;part&nbsp;of&nbsp;the&nbsp;full&nbsp;file&lt;br&gt;<br>
name.&nbsp;Why&nbsp;not&nbsp;make&nbsp;the&nbsp;existing&nbsp;constant&nbsp;that&nbsp;controls&nbsp;the&nbsp;&quot;prefix&quot;&nbsp;part&lt;br&gt;<br>
of&nbsp;the&nbsp;full&nbsp;file&nbsp;name&nbsp;configurable&nbsp;instead?&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;understand&nbsp;that&nbsp;the&nbsp;two&nbsp;approaches&nbsp;result&nbsp;in&nbsp;[slightly]&nbsp;different&lt;br&gt;<br>
code,&nbsp;but&nbsp;if&nbsp;a&nbsp;single&nbsp;option&nbsp;can&nbsp;accomplish&nbsp;the&nbsp;desired&nbsp;outcome&nbsp;and&lt;br&gt;<br>
supports&nbsp;more&nbsp;use&nbsp;cases,&nbsp;then&nbsp;using&nbsp;that&nbsp;single&nbsp;option&nbsp;may&nbsp;be&nbsp;a&nbsp;better&lt;br&gt;<br>
approach.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;gmail-&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;DEFAULT_STATEDIR&nbsp;only&nbsp;helps&nbsp;the&nbsp;case&nbsp;that&nbsp;the&nbsp;segment&nbsp;name&nbsp;is&nbsp;path.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;Can&nbsp;the&nbsp;updated/renamed&nbsp;DEFAULT_STATEDIR&nbsp;be&nbsp;interpreted&nbsp;as&lt;br&gt;<br>
&lt;br&gt;<br>
 &lt;path&gt;&nbsp;/&nbsp;&lt;filename&nbsp;prefix&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
where&nbsp;the&nbsp;first&nbsp;component&nbsp;is&nbsp;used&nbsp;if&nbsp;and&nbsp;only&nbsp;when&nbsp;nameIsPath&nbsp;is&nbsp;true&lt;br&gt;<br>
and&nbsp;the&nbsp;second&nbsp;component&nbsp;is&nbsp;optional?&nbsp;AFAICT,&nbsp;such&nbsp;an&nbsp;implementation&lt;br&gt;<br>
would&nbsp;cover&nbsp;the&nbsp;already&nbsp;supported&nbsp;use&nbsp;cases&nbsp;and&nbsp;your&nbsp;new&nbsp;use&nbsp;case.&lt;br&gt;<br>
&lt;br&gt;<br>
For&nbsp;snap&nbsp;environments,&nbsp;the&nbsp;option&nbsp;could&nbsp;be&nbsp;set&nbsp;to&nbsp;something&nbsp;like:&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp;$(localstatedir)/run/squid/&lt;wbr&gt;sem.snap.squid.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;gmail-&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;div&gt; &nbsp;A:&nbsp;I&nbsp;understood&nbsp;your&nbsp;point&nbsp;that&nbsp;a&nbsp;single&nbsp;option&nbsp;can&nbsp;keep&nbsp;clean&nbsp;code&nbsp;base.&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;But&nbsp;interpreting&nbsp; DEFAULT_STATEDIR&nbsp; as&nbsp;&lt;path&gt;&nbsp;/&nbsp;&lt;filename&nbsp;prefix&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;is&nbsp;more&nbsp;like&nbsp;a&nbsp;trick.&nbsp;Wihout&nbsp;snap-related&nbsp;knowledge,&nbsp;normal&nbsp;developer&nbsp;will &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;treat&nbsp;the&nbsp;the&nbsp;option&nbsp;as&nbsp;an&nbsp;absolute&nbsp;path instead&nbsp;of&nbsp;combination &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;of&nbsp;&lt;path&gt;/&lt;filename&nbsp;prefix&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;I&nbsp;can&nbsp;make&nbsp;a&nbsp;change&nbsp;to&nbsp;fix&nbsp;it&nbsp;based&nbsp;on&nbsp;your&nbsp;comment.&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;But&nbsp;please&nbsp;double-check&nbsp;if&nbsp;it&#39;s&nbsp;the&nbsp;right&nbsp;implementation.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;Meanwhile,&nbsp;according&nbsp;to&nbsp;shared&nbsp;memory&nbsp;file&nbsp;namespace&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;span&nbsp;style=&quot;color:rgb(51,51,51);font-family:monospace;font-size:13.3333px&quot;&gt;/dev/shm/&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(51,51,51);font-family:monospace;font-size:13.3333px&quot;&gt;sem.snap.&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(51,51,51);font-family:monospace;font-size:13.3333px&quot;&gt;@{SNAP_&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(51,51,51);font-family:monospace;font-size:13.3333px&quot;&gt;NAME&lt;wbr&gt;}.*&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-size:12.8px&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;If&nbsp;we&nbsp;use&nbsp;the&nbsp;option&nbsp;in&nbsp;the&nbsp;following&nbsp;way&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$(localstatedir)/run/squid/&lt;wbr&gt;sem.snap.squid, &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;which&nbsp;means&nbsp;SNAP_NAME&nbsp;would&nbsp;be&nbsp;&quot;squid&quot;,&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; I&nbsp;have&nbsp;a&nbsp;quick&nbsp;look&nbsp;at&nbsp;ubuntu&nbsp;store&nbsp;and&nbsp;found&nbsp;that&nbsp;&quot;squid&quot;&nbsp;snap&nbsp;name&nbsp;is&nbsp;registered&nbsp;by&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; other&nbsp;developers.&nbsp;To&nbsp;avoid&nbsp;name&nbsp;disputes,&nbsp;there&#39;re&nbsp;two&nbsp;options&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; 1.&nbsp;change&nbsp; &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$(localstatedir)/run/squid/&lt;wbr&gt;sem.snap.squid.&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; to&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$(localstatedir)/run/squid/&lt;wbr&gt;sem.snap.squid-snap.&nbsp;  &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; 2.&nbsp;make&nbsp;STATEDIR configurable&nbsp;so&nbsp;developer&nbsp;can&nbsp;customize&nbsp;it.&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; I&nbsp;perfer&nbsp;the&nbsp;latter&nbsp;one.&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;gmail-&quot;&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;Another&nbsp;concern&nbsp;is&nbsp;that&nbsp;even&nbsp;though&nbsp;we&nbsp;make&nbsp;DEFAULT_STATEDIR&lt;br&gt;<br>
&gt;&nbsp;configurable&nbsp;instead&nbsp;of&nbsp;introducing&nbsp;new&nbsp;option,&nbsp;STATEDIR,&nbsp;IPCDIR&nbsp;is&nbsp;not&lt;br&gt;<br>
&gt;&nbsp;suitable&nbsp;as&nbsp;end-user&nbsp;might&nbsp;specify&nbsp;the&nbsp;dir&nbsp;path&nbsp;for&nbsp;these&nbsp;options&nbsp;however&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;purpose&nbsp;of&nbsp;DEFAULT_IPC_PREFIX&nbsp;is&nbsp;only&nbsp;add&nbsp;prefix&nbsp;to&nbsp;shared&nbsp;memory&nbsp;file&nbsp;name&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;I&nbsp;am&nbsp;not&nbsp;sure&nbsp;I&nbsp;understand&nbsp;the&nbsp;above&nbsp;concern,&nbsp;but&nbsp;perhaps&nbsp;my&nbsp;suggestion&lt;br&gt;<br>
to&nbsp;ignore&nbsp;the&nbsp;path&nbsp;component&nbsp;(as&nbsp;needed)&nbsp;would&nbsp;address&nbsp;it?&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;gmail-&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&gt; &nbsp; &nbsp; AFAICT,&nbsp;DEFAULT_STATEDIR&nbsp;is&nbsp;also&nbsp;used&nbsp;for&nbsp;IPC&nbsp;communications&nbsp;in&lt;br&gt;<br>
&gt;&gt; &nbsp; &nbsp; src/ipc/Port.cc.&nbsp;Your&nbsp;patch&nbsp;does&nbsp;not&nbsp;change&nbsp;that&nbsp;code.&nbsp;This&nbsp;means&nbsp;that&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt; &nbsp; &nbsp; *&nbsp;either&nbsp;you&nbsp;forgot&nbsp;to&nbsp;change&nbsp;src/ipc/Port.cc&nbsp;to&nbsp;honor&nbsp;the&nbsp;new&lt;br&gt;<br>
&gt;&gt; &nbsp; &nbsp; DEFAULT_IPC_PREFIX&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;A:&nbsp;I&nbsp;will&nbsp;change&nbsp;src/ipc/Port.cc&nbsp;in&nbsp;the&nbsp;next&nbsp;commit&nbsp;once&nbsp;we&nbsp;reach&nbsp;an&lt;br&gt;<br>
&gt;&nbsp;agreement&nbsp;on&nbsp;the&nbsp;usage&nbsp;of&nbsp;compiler&nbsp;option.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;For&nbsp;Squid&nbsp;to&nbsp;work&nbsp;in&nbsp;a&nbsp;snap&nbsp;world,&nbsp;will&nbsp;you&nbsp;need&nbsp;the&nbsp;same&lt;br&gt;<br>
sem.snap.@{SNAP_NAME}.&nbsp;prefix&nbsp;for&nbsp;Unix&nbsp;Domain&nbsp;Sockets&nbsp;as&nbsp;for&nbsp;shared&lt;br&gt;<br>
memory&nbsp;segments?&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;If&nbsp;yes,&nbsp;then&nbsp;using&nbsp;a&nbsp;single&nbsp;option&nbsp;for&nbsp;both&nbsp;ipc/mem/Segment.cc&nbsp;and&lt;br&gt;<br>
ipc/Port.cc&nbsp;may&nbsp;work.&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;Otherwise,&nbsp;we&nbsp;would&nbsp;have&nbsp;to&nbsp;add&nbsp;two&nbsp;different&nbsp;options,&nbsp;one&nbsp;for&nbsp;shared&lt;br&gt;<br>
memory&nbsp;segment&nbsp;names&nbsp;and&nbsp;one&nbsp;for&nbsp;UDS&nbsp;names.&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt; &nbsp; A:&nbsp;No,&nbsp;I&nbsp;don&#39;t&nbsp;need&nbsp;the&nbsp;same&nbsp;prefix&nbsp;for&nbsp;UDS&nbsp;names.&nbsp;As&nbsp;you&nbsp;said,&nbsp;we&nbsp;might&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; need&nbsp;two&nbsp;different&nbsp;options. &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
Cheers,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;span&nbsp;class=&quot;gmail-&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&gt; &nbsp; &nbsp; *&nbsp;or&nbsp;src/ipc/Port.cc&nbsp;cannot&nbsp;use&nbsp;DEFAULT_IPC_PREFIX&nbsp;for&nbsp;some&nbsp;reason&nbsp;(and,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; hence,&nbsp;DEFAULT_IPC_PREFIX&nbsp;is&nbsp;the&nbsp;wrong&nbsp;name&nbsp;because&nbsp;the&nbsp;parameter&nbsp;does&lt;br&gt;<br>
&gt; &nbsp; &nbsp; not&nbsp;apply&nbsp;to&nbsp;some&nbsp;of&nbsp;the&nbsp;IPC&nbsp;code).&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Alex.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;/span&gt;&gt; &nbsp; &nbsp; &gt;&nbsp;===&nbsp;modified&nbsp;file&nbsp;&#39;&lt;a&nbsp;href=&quot;http://configure.ac&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;configure.ac&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://configure.ac&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://configure.ac&lt;/a&gt;&gt;&#39;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;---&nbsp;&lt;a&nbsp;href=&quot;http://configure.ac&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;configure.ac&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://configure.ac&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://configure.ac&lt;/a&gt;&gt; &nbsp; &nbsp; &nbsp;2017-01-28&nbsp;03:54:15&nbsp;+0000&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;+++&nbsp;&lt;a&nbsp;href=&quot;http://configure.ac&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;configure.ac&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://configure.ac&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://configure.ac&lt;/a&gt;&gt; &nbsp; &nbsp; &nbsp;2017-03-02&nbsp;03:51:46&nbsp;+0000&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;gmail-HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;gmail-h5&quot;&gt;&gt; &nbsp; &nbsp; &gt;&nbsp;@@&nbsp;-311,6&nbsp;+311,15&nbsp;@@&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp;])&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp;AC_SUBST(DEFAULT_SWAP_DIR)&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;+DEFAULT_IPC_PREFIX=&quot;&quot;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;+AC_ARG_WITH(ipcprefix,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;+ &nbsp;AS_HELP_STRING([--with-&lt;wbr&gt;ipcprefix=NAME],&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;+ &nbsp; &nbsp;[Default&nbsp;namespace&nbsp;prefix&nbsp;for&nbsp;shared&nbsp;memory&nbsp;object&nbsp;for&nbsp;ipc&lt;br&gt;<br>
&gt; &nbsp; &nbsp; communication.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;+ &nbsp; &nbsp; Default&nbsp;is&nbsp;empty&nbsp;string&nbsp;and&nbsp;the&nbsp;share&nbsp;memory&nbsp;object&nbsp;name&lt;br&gt;<br>
&gt; &nbsp; &nbsp; will&nbsp;be&nbsp;specified&nbsp;by&nbsp;squid.&nbsp;]),&nbsp;[&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;+ &nbsp; DEFAULT_IPC_PREFIX=&quot;$withval&quot;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;+])&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;+AC_SUBST(DEFAULT_IPC_PREFIX)&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;+&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp;if&nbsp;test&nbsp;&quot;$squid_cv_compiler&quot;&nbsp;=&nbsp;&quot;gcc&quot;;&nbsp;then&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp;GCCVER=`$CC&nbsp;-v&nbsp;2&gt;&amp;1&nbsp;|&nbsp;awk&nbsp;&#39;$2&nbsp;== &nbsp;&quot;version&quot;&nbsp;{print&nbsp;$3}&#39;`&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp;GCCVER2=`echo&nbsp;$GCCVER&nbsp;|&nbsp;awk&nbsp;&#39;{print&nbsp;$1&nbsp;*&nbsp;100}&#39;`&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;===&nbsp;modified&nbsp;file&nbsp;&#39;src/ipc/Makefile.am&#39;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;---&nbsp;src/ipc/Makefile.am &nbsp; &nbsp; &nbsp; 2017-01-01&nbsp;00:16:45&nbsp;+0000&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;+++&nbsp;src/ipc/Makefile.am &nbsp; &nbsp; &nbsp; 2017-03-02&nbsp;03:51:46&nbsp;+0000&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;@@&nbsp;-68,7&nbsp;+68,7&nbsp;@@&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &nbsp; mem/Segment.cc&nbsp;\&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &nbsp; mem/Segment.h&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;-DEFS&nbsp;+=&nbsp;-DDEFAULT_STATEDIR=\&quot;$(&lt;wbr&gt;localstatedir)/run/squid\&quot;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;+DEFS&nbsp;+=&nbsp;-DDEFAULT_STATEDIR=\&quot;$(&lt;wbr&gt;localstatedir)/run/squid\&quot;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; -DDEFAULT_IPC_PREFIX=\&quot;$(&lt;wbr&gt;DEFAULT_IPC_PREFIX)\&quot;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp;install-data-local:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &nbsp; $(mkinstalldirs)&nbsp;$(DESTDIR)$(localstatedir)/&lt;wbr&gt;run/squid;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;===&nbsp;modified&nbsp;file&nbsp;&#39;src/ipc/mem/Segment.cc&#39;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;---&nbsp;src/ipc/mem/Segment.cc &nbsp; &nbsp;2017-01-01&nbsp;00:16:45&nbsp;+0000&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;+++&nbsp;src/ipc/mem/Segment.cc &nbsp; &nbsp;2017-03-02&nbsp;03:51:46&nbsp;+0000&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;@@&nbsp;-30,6&nbsp;+30,8&nbsp;@@&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp;#include&nbsp;&lt;unistd.h&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp;#endif&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;+#define&nbsp;DEFAULT_SQUID_IPC_PREFIX &nbsp;&quot;/&quot;&nbsp;DEFAULT_IPC_PREFIX&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;+&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp;//&nbsp;test&nbsp;cases&nbsp;change&nbsp;this&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp;const&nbsp;char&nbsp;*Ipc::Mem::Segment::BasePath&nbsp;=&nbsp;DEFAULT_STATEDIR;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;@@&nbsp;-229,9&nbsp;+231,9&nbsp;@@&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &nbsp;if&nbsp;(nameIsPath)&nbsp;{&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;name.append(BasePath);&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if&nbsp;(name[name.size()-1]&nbsp;!=&nbsp;&#39;/&#39;)&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;name.append(&#39;/&#39;);&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;+ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;name.append(DEFAULT_SQUID_IPC_&lt;wbr&gt;PREFIX);&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &nbsp;}&nbsp;else&nbsp;{&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;- &nbsp; &nbsp; &nbsp; &nbsp;name.append(&#39;/&#39;);&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;+ &nbsp; &nbsp; &nbsp; &nbsp;name.append(DEFAULT_SQUID_IPC_&lt;wbr&gt;PREFIX);&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;name.append(service_name.c_&lt;wbr&gt;str());&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;name.append(&#39;-&#39;);&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &nbsp;}&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Br&lt;div&gt;Gary.Wzl&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;<br>

</tt>
