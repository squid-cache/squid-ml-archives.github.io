<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;bgcolor=&quot;#FFFFFF&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Could&nbsp;you&nbsp;clarify,&nbsp;what&nbsp;are&nbsp;these&nbsp;processes&nbsp;that&nbsp;'operate&nbsp;as<br>
&nbsp;&nbsp;&nbsp;&nbsp;threads'?&nbsp;AFAIK,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Squid&nbsp;spawns&nbsp;its&nbsp;children&nbsp;by&nbsp;fork()&nbsp;and&nbsp;execlp(),&nbsp;and&nbsp;each&nbsp;new<br>
&nbsp;&nbsp;&nbsp;&nbsp;process&nbsp;is&nbsp;a&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;common&nbsp;process&nbsp;with&nbsp;its&nbsp;own&nbsp;address&nbsp;space.&nbsp;As&nbsp;for&nbsp;atomicity,&nbsp;the&nbsp;OS<br>
&nbsp;&nbsp;&nbsp;&nbsp;itself&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;guarantees&nbsp;that&nbsp;only&nbsp;one&nbsp;process&nbsp;can&nbsp;have&nbsp;an&nbsp;exclusive&nbsp;file&nbsp;lock&nbsp;at<br>
&nbsp;&nbsp;&nbsp;&nbsp;a&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;given&nbsp;time.&nbsp;Where&nbsp;do&nbsp;you&nbsp;suggest&nbsp;to&nbsp;use&nbsp;std::atomic&nbsp;then?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Eduard.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;moz-cite-prefix&quot;&gt;On&nbsp;15.05.2017&nbsp;15:04,&nbsp;Amos&nbsp;Jeffries<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wrote:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cite=&quot;mid:ba0ca3d9-646b-b3d2-3e32-336401a8cefb@treenet.co.nz&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type=&quot;cite&quot;&gt;On&nbsp;07/05/17&nbsp;09:59,&nbsp;Eduard&nbsp;Bagdasaryan&nbsp;wrote:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;color:&nbsp;#000000;&quot;&gt;This&nbsp;patch&nbsp;makes<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PID&nbsp;file&nbsp;check/creation&nbsp;atomic&nbsp;to&nbsp;avoid&nbsp;associated<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;race&nbsp;conditions.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;do&nbsp;not&nbsp;see&nbsp;any&nbsp;use&nbsp;of&nbsp;atomic's&nbsp;in&nbsp;this&nbsp;patch.&nbsp;Please&nbsp;use<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;std::atomic&nbsp;locks&nbsp;to&nbsp;ensure&nbsp;actually&nbsp;atomic&nbsp;operations&nbsp;on&nbsp;the&nbsp;file<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;locks.&nbsp;Squid&nbsp;does&nbsp;have&nbsp;some&nbsp;child&nbsp;processes&nbsp;operating&nbsp;as&nbsp;threads<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;so&nbsp;custom&nbsp;implementations&nbsp;that&nbsp;don't&nbsp;use&nbsp;real&nbsp;atomic's&nbsp;will&nbsp;fail<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;under&nbsp;some&nbsp;circumstances.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
