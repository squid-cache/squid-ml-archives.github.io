<tt>
&lt;HTML&gt;&lt;HEAD&gt;&lt;/HEAD&gt;<br>
&lt;BODY&nbsp;dir=ltr&gt;<br>
&lt;DIV&nbsp;dir=ltr&gt;<br>
&lt;DIV&nbsp;style=&quot;FONT-SIZE:&nbsp;10pt;&nbsp;FONT-FAMILY:&nbsp;'Arial';&nbsp;COLOR:&nbsp;#000000&quot;&gt;<br>
&lt;DIV&gt;Hi,&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&nbsp;&nbsp;I&nbsp;looked&nbsp;at&nbsp;memory&nbsp;leaks&nbsp;for&nbsp;the&nbsp;squid&nbsp;negotiate_kerberos&nbsp;<br>
helper&nbsp;and&nbsp;found&nbsp;issues&nbsp;with&nbsp;the&nbsp;following&nbsp;in&nbsp;the&nbsp;heimdal&nbsp;code:&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;==9424==&nbsp;16&nbsp;bytes&nbsp;in&nbsp;1&nbsp;blocks&nbsp;are&nbsp;definitely&nbsp;lost&nbsp;in&nbsp;loss&nbsp;record&nbsp;13&nbsp;of&nbsp;<br>
64&lt;/DIV&gt;<br>
&lt;DIV&gt;==9424==&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;0x4C2A110:&nbsp;malloc&nbsp;(in&nbsp;<br>
/usr/lib64/valgrind/vgpreload_memcheck-amd64-linux.so)&lt;/DIV&gt;<br>
&lt;DIV&gt;==9424==&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;0x52ACF9C:&nbsp;set_etypes&nbsp;(context.c:74)&lt;/DIV&gt;<br>
&lt;DIV&gt;==9424==&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;0x52ADE8F:&nbsp;init_context_from_config_file&nbsp;<br>
(context.c:161)&lt;/DIV&gt;<br>
&lt;DIV&gt;==9424==&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;0x52ADE8F:&nbsp;krb5_set_config_files&nbsp;<br>
(context.c:692)&lt;/DIV&gt;<br>
&lt;DIV&gt;==9424==&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;0x52AE49C:&nbsp;krb5_init_context&nbsp;<br>
(context.c:451)&lt;/DIV&gt;<br>
&lt;DIV&gt;==9424==&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;0x4023C1:&nbsp;main&nbsp;<br>
(negotiate_kerberos_auth.cc:549)&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;which&nbsp;should&nbsp;be&nbsp;fixed&nbsp;with&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;---&nbsp;lib/krb5/context.c&nbsp;&nbsp;2017-12-07&nbsp;04:11:23.000000000&nbsp;+0000&lt;/DIV&gt;<br>
&lt;DIV&gt;+++&nbsp;lib/krb5/context_new.c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2018-09-15&nbsp;<br>
18:45:40.715744342&nbsp;+0100&lt;/DIV&gt;<br>
&lt;DIV&gt;@@&nbsp;-622,6&nbsp;+622,9&nbsp;@@&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free(context-&gt;etypes);&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free(context-&gt;cfg_etypes);&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free(context-&gt;etypes_des);&lt;/DIV&gt;<br>
&lt;DIV&gt;+&nbsp;&nbsp;&nbsp;&nbsp;free(context-&gt;permitted_enctypes);&lt;/DIV&gt;<br>
&lt;DIV&gt;+&nbsp;&nbsp;&nbsp;&nbsp;free(context-&gt;tgs_etypes);&lt;/DIV&gt;<br>
&lt;DIV&gt;+&nbsp;&nbsp;&nbsp;&nbsp;free(context-&gt;as_etypes);&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;krb5_free_host_realm&nbsp;(context,&nbsp;<br>
context-&gt;default_realms);&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;krb5_config_file_free&nbsp;(context,&nbsp;<br>
context-&gt;cf);&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free_error_table&nbsp;(context-&gt;et_list);&lt;/DIV&gt;<br>
&lt;DIV&gt;&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;and&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;==9424==&nbsp;13,200&nbsp;bytes&nbsp;in&nbsp;6&nbsp;blocks&nbsp;are&nbsp;definitely&nbsp;lost&nbsp;in&nbsp;loss&nbsp;record&nbsp;63&nbsp;of&nbsp;<br>
64&lt;/DIV&gt;<br>
&lt;DIV&gt;==9424==&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;0x4C2C240:&nbsp;calloc&nbsp;(in&nbsp;<br>
/usr/lib64/valgrind/vgpreload_memcheck-amd64-linux.so)&lt;/DIV&gt;<br>
&lt;DIV&gt;==9424==&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;0x4E5E01A:&nbsp;_gss_ntlm_allocate_ctx&nbsp;<br>
(accept_sec_context.c:52)&lt;/DIV&gt;<br>
&lt;DIV&gt;==9424==&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;0x4E5E5B4:&nbsp;_gss_ntlm_acquire_cred&nbsp;<br>
(acquire_cred.c:60)&lt;/DIV&gt;<br>
&lt;DIV&gt;==9424==&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;0x4E55779:&nbsp;gss_acquire_cred&nbsp;<br>
(gss_acquire_cred.c:125)&lt;/DIV&gt;<br>
&lt;DIV&gt;==9424==&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;0x4E635AB:&nbsp;_gss_spnego_acquire_cred&nbsp;<br>
(cred_stubs.c:109)&lt;/DIV&gt;<br>
&lt;DIV&gt;==9424==&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;0x4E55779:&nbsp;gss_acquire_cred&nbsp;<br>
(gss_acquire_cred.c:125)&lt;/DIV&gt;<br>
&lt;DIV&gt;==9424==&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;0x403227:&nbsp;main&nbsp;<br>
(negotiate_kerberos_auth.cc:721)&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;Which&nbsp;could&nbsp;be&nbsp;fixed&nbsp;with&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;---&nbsp;./lib/gssapi/ntlm/acquire_cred.c&nbsp;&nbsp;&nbsp;&nbsp;2016-12-20&nbsp;<br>
14:23:06.000000000&nbsp;+0000&lt;/DIV&gt;<br>
&lt;DIV&gt;+++&nbsp;<br>
./lib/gssapi/ntlm/acquire_cred_new.c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
2018-09-15&nbsp;18:09:04.436985518&nbsp;+0100&lt;/DIV&gt;<br>
&lt;DIV&gt;@@&nbsp;-58,8&nbsp;+58,10&nbsp;@@&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(cred_usage&nbsp;==&nbsp;GSS_C_BOTH&nbsp;||&nbsp;cred_usage&nbsp;==&nbsp;<br>
GSS_C_ACCEPT)&nbsp;{&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maj_stat&nbsp;=&nbsp;<br>
_gss_ntlm_allocate_ctx(min_stat,&nbsp;&amp;ctx);&lt;/DIV&gt;<br>
&lt;DIV&gt;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(maj_stat&nbsp;!=&nbsp;GSS_S_COMPLETE)&lt;/DIV&gt;<br>
&lt;DIV&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(maj_stat&nbsp;!=&nbsp;GSS_S_COMPLETE)&nbsp;<br>
{&lt;/DIV&gt;<br>
&lt;DIV&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ctx)&nbsp;<br>
free(ctx);&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;<br>
maj_stat;&lt;/DIV&gt;<br>
&lt;DIV&gt;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;domain&nbsp;=&nbsp;name&nbsp;!=&nbsp;NULL&nbsp;?&nbsp;<br>
name-&gt;domain&nbsp;:&nbsp;NULL;&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maj_stat&nbsp;=&nbsp;<br>
(*ctx-&gt;server-&gt;nsi_probe)(min_stat,&nbsp;ctx-&gt;ictx,&nbsp;domain);&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;Markus&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;<br>
&lt;DIV&gt;&nbsp;&lt;/DIV&gt;&lt;/DIV&gt;&lt;/DIV&gt;&lt;/BODY&gt;&lt;/HTML&gt;<br>

</tt>
