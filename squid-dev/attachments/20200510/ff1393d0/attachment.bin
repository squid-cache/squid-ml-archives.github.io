diff --git a/acinclude/squid-util.m4 b/acinclude/squid-util.m4
index 7f5a72e5b..e48d2c8f9 100644
--- a/acinclude/squid-util.m4
+++ b/acinclude/squid-util.m4
@@ -190,9 +190,9 @@ AC_DEFUN([SQUID_OPTIONAL_LIB],[
   AC_ARG_WITH([$1],AS_HELP_STRING([--with-$1],[Compile with the $2 library.]),[
     AS_CASE(["$with_$1"],[yes|no],,[
       AS_IF([test ! -d "$with_$1"],AC_MSG_ERROR([--with-$1 path does not point to a directory]))
-      with_$squid_auto_lib=yes
-      AS_IF([test -d "$withval/lib64"],[$3_PATH += "-L$withval/lib64"])
-      AS_IF([test -d "$withval/lib"],[$3_PATH += "-L$withval/lib"])
+      set with_$squid_auto_lib = yes
+      AS_IF([test -d "$withval/lib64"],[$3_PATH+="-L$withval/lib64"])
+      AS_IF([test -d "$withval/lib"],[$3_PATH+="-L$withval/lib"])
       $3_CFLAGS="-I$withval/include"
     ])
   ])
diff --git a/configure.ac b/configure.ac
index 2260d09c6..49f79a499 100644
--- a/configure.ac
+++ b/configure.ac
@@ -1261,7 +1261,7 @@ dnl User may specify OpenSSL is needed from a non-standard location
 SQUID_OPTIONAL_LIB(openssl,[OpenSSL],[LIBOPENSSL])
 AH_TEMPLATE(USE_OPENSSL,[OpenSSL support is available])
 ## OpenSSL is default disable due to licensing issues on some OS
-if test "x$with_openssl" = "xyes"; then
+if test "x$with_openssl" != "xno"; then
   CPPFLAGS="$LIBOPENSSL_CFLAGS $CPPFLAGS"
   AC_CHECK_HEADERS( \
     openssl/asn1.h \
