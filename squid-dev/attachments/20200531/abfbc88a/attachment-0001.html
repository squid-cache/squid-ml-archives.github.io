<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt; &lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Sat,&nbsp;May&nbsp;30,&nbsp;2020&nbsp;at&nbsp;7:38&nbsp;PM&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;31/05/20&nbsp;5:27&nbsp;am,&nbsp;Francesco&nbsp;Chemolli&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Hi&nbsp;all,&lt;br&gt;<br>
&gt;&nbsp; &nbsp; starting&nbsp;from&nbsp;a&nbsp;PR&nbsp;in&nbsp;a&nbsp;conversation&nbsp;with&nbsp;Alex&nbsp;about&nbsp;our&nbsp;current&lt;br&gt;<br>
&gt;&nbsp;approach&nbsp;to&nbsp;unit&nbsp;testing&nbsp;being&nbsp;painful,&nbsp;I&#39;ve&nbsp;checked&nbsp;what&nbsp;alternatives&lt;br&gt;<br>
&gt;&nbsp;would&nbsp;we&nbsp;have&nbsp;and&nbsp;how&nbsp;practical&nbsp;would&nbsp;they&nbsp;be.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;An&nbsp;easy&nbsp;first&nbsp;option&nbsp;would&nbsp;be&nbsp;googletest/googlemock.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;a&nbsp;lazy&nbsp;afternoon,&nbsp;I&#39;ve&nbsp;tried&nbsp;seeing&nbsp;how&nbsp;useful/painful&nbsp;it&nbsp;would&nbsp;be&nbsp;to&lt;br&gt;<br>
&gt;&nbsp;try&nbsp;it,&nbsp;by&nbsp;porting&nbsp;one&nbsp;test&nbsp;over&nbsp;-&nbsp;it&#39;s&nbsp;quite&nbsp;trivial&nbsp;and&nbsp;doesn&#39;t&lt;br&gt;<br>
&gt;&nbsp;require&nbsp;mocking,&nbsp;so&nbsp;I&#39;ll&nbsp;try&nbsp;a&nbsp;more&nbsp;complicated&nbsp;one&nbsp;next&nbsp;-&nbsp;to&nbsp;start&nbsp;a&lt;br&gt;<br>
&gt;&nbsp;conversation&nbsp;about&nbsp;the&nbsp;topic.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;You&nbsp;can&nbsp;find&nbsp;the&nbsp;test&nbsp;branch&nbsp;at &lt;a&nbsp;href=&quot;https://github.com/kinkie/squid/tree/gtest&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/kinkie/squid/tree/gtest&lt;/a&gt; .&lt;br&gt;<br>
&gt;&nbsp;I&#39;ve&nbsp;only&nbsp;touched&nbsp;two&nbsp;files,&nbsp;a&nbsp;newly-created&nbsp;src/tests/testMemGtest&nbsp;and&lt;br&gt;<br>
&gt;&nbsp;src/Makefile.am .&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;output&nbsp;from&nbsp;the&nbsp;test&nbsp;run&nbsp;is&nbsp;at &lt;a&nbsp;href=&quot;https://paste.ubuntu.com/p/3sgTDN7rNm/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://paste.ubuntu.com/p/3sgTDN7rNm/&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;What do&nbsp;you&nbsp;think?&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;My&nbsp;initial&nbsp;thoughts:&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;it&nbsp;is&nbsp;somewhat&nbsp;simpler&nbsp;and&nbsp;more&nbsp;powerful&nbsp;than&nbsp;cppunit&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;setting&nbsp;the&nbsp;test&nbsp;environment&nbsp;up&nbsp;is&nbsp;easy&nbsp;but&nbsp;at&nbsp;this&nbsp;time&nbsp;it&nbsp;can&nbsp;only&lt;br&gt;<br>
&gt;&nbsp;be&nbsp;done&nbsp;from&nbsp;source.&nbsp;Adding&nbsp;it&nbsp;to&nbsp;the&nbsp;build&nbsp;farm&nbsp;images&nbsp;is&nbsp;straightforward&lt;br&gt;<br>
&lt;br&gt;<br>
That&nbsp;is&nbsp;a&nbsp;problem.&nbsp;The&nbsp;unit&nbsp;tests&nbsp;are&nbsp;run&nbsp;by&nbsp;pretty&nbsp;much&nbsp;everyone&lt;br&gt;<br>
building&nbsp;Squid.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;should&nbsp;be&nbsp;able&nbsp;to&nbsp;bundle&nbsp;gtest&nbsp;if&nbsp;needed;&nbsp;we&nbsp;only&nbsp;distribute&nbsp;in&nbsp;source&nbsp;form&nbsp;and&nbsp;it&nbsp;wouldn&#39;t&nbsp;be&nbsp;part&nbsp;of&nbsp;distfiles&nbsp;so&nbsp;it&nbsp;shouldn&#39;t&nbsp;be&nbsp;a&nbsp;problem&nbsp;downstream&nbsp;either,&nbsp;I&nbsp;believe &lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;<br>
It&nbsp;is&nbsp;not&nbsp;a&nbsp;complete&nbsp;blocker,&nbsp;but&nbsp;having&nbsp;a&nbsp;process&nbsp;more&nbsp;complex&nbsp;than&lt;br&gt;<br>
simple&nbsp;dependency&nbsp;install&nbsp;does&nbsp;pose&nbsp;a&nbsp;relatively&nbsp;major&nbsp;hurdle&nbsp;that&nbsp;any&lt;br&gt;<br>
framework&nbsp;has&nbsp;to&nbsp;get&nbsp;over&nbsp;to&nbsp;be&nbsp;of&nbsp;much&nbsp;utility.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;the&nbsp;license&nbsp;is&nbsp;BSD&nbsp;3-clause&nbsp;new&lt;br&gt;<br>
&gt;&nbsp;(&lt;a&nbsp;href=&quot;https://github.com/google/googletest/blob/master/LICENSE&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/google/googletest/blob/master/LICENSE&lt;/a&gt;) &lt;br&gt;<br>
&gt;&nbsp;-&nbsp;googlemock&nbsp;promises&nbsp;to&nbsp;be&nbsp;vastly&nbsp;superior&nbsp;to&nbsp;our&nbsp;current&nbsp;approach&lt;br&gt;<br>
&lt;br&gt;<br>
Where&nbsp;are&nbsp;you&nbsp;seeing&nbsp;evidence&nbsp;of&nbsp;this?&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Also&nbsp;including&nbsp;answer&nbsp;on&nbsp;Alex&#39;&nbsp;question:&lt;/div&gt;&lt;div&gt;- &lt;a&nbsp;href=&quot;https://stackoverflow.com/questions/7922289/googletest-vs-cppunit-the-facts&quot;&gt;https://stackoverflow.com/questions/7922289/googletest-vs-cppun&nbsp;it-the-facts&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&nbsp;trivial&nbsp;but&nbsp;it&nbsp;builds&nbsp;up:&nbsp;not&nbsp;generally&nbsp;necessary&nbsp;to&nbsp;have&nbsp;.h&nbsp;and&nbsp;.cc&nbsp;for&nbsp;simple&nbsp;cases&lt;/div&gt;&lt;div&gt;-&nbsp;comparison&nbsp;table: &lt;a&nbsp;href=&quot;https://socialcompare.com/en/comparison/c-unit-testing-framework&quot;&gt;https://socialcompare.com/en/comparison/c-unit-testing-framework&lt;/a&gt;&lt;/div&gt;&lt;div&gt;-&nbsp;gmock/gtest&nbsp;is&nbsp;used&nbsp;in&nbsp;broadly-used&nbsp;projects&nbsp;(e.g.&nbsp;chromium)&nbsp;-&nbsp;I&#39;m&nbsp;not&nbsp;sure &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;far&nbsp;I&#39;m&nbsp;basing&nbsp;on&nbsp;documentation,&nbsp;found&nbsp;at &lt;a&nbsp;href=&quot;https://github.com/google/googletest/blob/master/googlemock/docs/cook_book.md&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/google/googletest/blob/master/googlemock/docs/cook_book.md&lt;/a&gt; .&lt;/div&gt;&lt;div&gt;I&nbsp;see: &lt;/div&gt;&lt;div&gt;-&nbsp;a&nbsp;more&nbsp;structured&nbsp;approach&nbsp;to&nbsp;mocking,&nbsp;and&nbsp;more&nbsp;infrastructure&nbsp;to&nbsp;do&nbsp;it&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&nbsp;ON_CALL&nbsp;and&nbsp;EXPECT_CALL&nbsp;patterns&nbsp;to&nbsp;define&nbsp;actions&nbsp;and&nbsp;expectations&nbsp;on&nbsp;class&nbsp;methods&nbsp;(method&nbsp;called&nbsp;once&nbsp;/&nbsp;called&nbsp;multiple&nbsp;times).&nbsp;This&nbsp;can&nbsp;also&nbsp;allow&nbsp;to&nbsp;change&nbsp;the&nbsp;behaviour&nbsp;of&nbsp;a&nbsp;mocked&nbsp;object&nbsp;on&nbsp;different&nbsp;tests&nbsp;without&nbsp;having&nbsp;to&nbsp;remock&nbsp;it&nbsp;all&lt;/div&gt;&lt;div&gt;-&nbsp;matchers&nbsp;on&nbsp;called&nbsp;methods&lt;/div&gt;&lt;div&gt;-&nbsp;moched&nbsp;methods&nbsp;can&nbsp;different&nbsp;return&nbsp;values&nbsp;depending&nbsp;on&nbsp;arguments,&nbsp;and&nbsp;check&nbsp;for&nbsp;complex&nbsp;sequences&nbsp;of&nbsp;calls&nbsp;to&nbsp;methods&nbsp;(call&nbsp;a()&nbsp;with&nbsp;some&nbsp;arguments,&nbsp;then&nbsp;either&nbsp;b()&nbsp;or&nbsp;c(),&nbsp;if&nbsp;it&#39;s&nbsp;c()&nbsp;must&nbsp;be&nbsp;followe by&nbsp;d() &lt;/div&gt;&lt;div&gt;-&nbsp;for&nbsp;object,&nbsp;the&nbsp;concept&nbsp;of&nbsp;&quot;uninteresting&nbsp;calls&quot;&nbsp;that&nbsp;get&nbsp;ignored,&nbsp;and&nbsp;can&nbsp;be&nbsp;defaulted&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;<br>
The&nbsp;main&nbsp;issue&nbsp;we&nbsp;have&nbsp;with&nbsp;cppunit&nbsp;itself&nbsp;is&nbsp;that&nbsp;when&nbsp;a&nbsp;test&nbsp;fails&nbsp;it&lt;br&gt;<br>
is&nbsp;not&nbsp;clear&nbsp;from&nbsp;the&nbsp;output&nbsp;which&nbsp;assertion&nbsp;occurred,&nbsp;nor&nbsp;why.&nbsp;One&nbsp;is&lt;br&gt;<br>
left&nbsp;having&nbsp;to&nbsp;try&nbsp;and&nbsp;trigger&nbsp;the&nbsp;unit&nbsp;failure&nbsp;again&nbsp;manually&nbsp;and&nbsp;gdb&lt;br&gt;<br>
from&nbsp;there.&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;can&nbsp;be&nbsp;worked&nbsp;around&nbsp;by&nbsp;following&nbsp;best-practice&nbsp;in&nbsp;unit&nbsp;test&lt;br&gt;<br>
implementation.&nbsp;But&nbsp;people&nbsp;contributing&nbsp;to&nbsp;Squid&nbsp;have&nbsp;not&nbsp;been&nbsp;doing&nbsp;so&lt;br&gt;<br>
consistently,&nbsp;and&nbsp;it&nbsp;is&nbsp;just&nbsp;a&nbsp;workaround.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;do&nbsp;see&nbsp;somewhat&nbsp;more&nbsp;verbose&nbsp;output&nbsp;in&nbsp;the&nbsp;logs,&nbsp;and&nbsp;slightly&nbsp;less&lt;br&gt;<br>
code&nbsp;to&nbsp;implement&nbsp;(no&nbsp;.h&nbsp;class).&nbsp;Which&nbsp;is&nbsp;a&nbsp;nice&nbsp;gain,&nbsp;but&nbsp;not&nbsp;what&nbsp;I&lt;br&gt;<br>
would&nbsp;call&nbsp;&quot;vastly&nbsp;superior&quot;.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Right.&nbsp;A&nbsp;lot&nbsp;of&nbsp;value&nbsp;comes&nbsp;from&nbsp;the&nbsp;combination&nbsp;with&nbsp;gmock.&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;porting&nbsp;memTest&nbsp;took&nbsp;me&nbsp;about&nbsp;one&nbsp;hour,&nbsp;mostly&nbsp;caused&nbsp;by&nbsp;us&nbsp;including&lt;br&gt;<br>
&gt;&nbsp;cppunit&nbsp;headers&nbsp;from&nbsp;squid.h&nbsp;(WUT?&nbsp;A&nbsp;PR&nbsp;is&nbsp;coming&nbsp;up&nbsp;to&nbsp;unentangle that)&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
Converting&nbsp;tests&nbsp;from&nbsp;one&nbsp;framework&nbsp;to&nbsp;another&nbsp;is&nbsp;not&nbsp;a&nbsp;problem.&nbsp;We&nbsp;just&lt;br&gt;<br>
have&nbsp;nobody&nbsp;doing&nbsp;the&nbsp;legwork.&nbsp;Case&nbsp;in&nbsp;point&nbsp;being&nbsp;the&nbsp;old&nbsp;tests&nbsp;not&lt;br&gt;<br>
even&nbsp;using&nbsp;cppunit.&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;main&nbsp;problem(s)&nbsp;we&nbsp;have&nbsp;with&nbsp;testing&nbsp;of&nbsp;Squid&nbsp;is&nbsp;dev&nbsp;participation:&lt;br&gt;<br>
&lt;br&gt;<br>
 a)&nbsp;people&nbsp;are&nbsp;not&nbsp;writing&nbsp;tests&nbsp;to&nbsp;cover&nbsp;new&nbsp;code,&nbsp;and&lt;br&gt;<br>
 b)&nbsp;people&nbsp;are&nbsp;not&nbsp;writing/updating&nbsp;tests&nbsp;to&nbsp;cover&nbsp;bug&nbsp;fixes,&nbsp;and&lt;br&gt;<br>
 c)&nbsp;tests&nbsp;written&nbsp;are&nbsp;generally&nbsp;not&nbsp;following&nbsp;best&nbsp;practice&nbsp;design.&lt;br&gt;<br>
&lt;br&gt;<br>
IIRC&nbsp;Alex&nbsp;an&nbsp;I&nbsp;have&nbsp;different&nbsp;ideas&nbsp;about&nbsp;the&nbsp;ideal&nbsp;focus&nbsp;of&nbsp;testing;&lt;br&gt;<br>
 *&nbsp;I&nbsp;prefer&nbsp;the&nbsp;micro-test&nbsp;approach&nbsp;to&nbsp;demonstrate&nbsp;a&nbsp;high&nbsp;quality&nbsp;proof&lt;br&gt;<br>
of&nbsp;code&nbsp;reliability.&lt;br&gt;<br>
 *&nbsp;Alex&nbsp;has&nbsp;stated&nbsp;a&nbsp;preference&nbsp;for&nbsp;high&nbsp;level&nbsp;black-box&nbsp;testing&nbsp;of&lt;br&gt;<br>
behaviour&nbsp;vs&nbsp;design&nbsp;requirements.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;TBH&nbsp;I&nbsp;favour&nbsp;unit&nbsp;tests&nbsp;as&nbsp;well.&nbsp;But&nbsp;if&nbsp;we&nbsp;can&nbsp;have&nbsp;black&nbsp;box&nbsp;texting (and&nbsp;there&nbsp;are&nbsp;compliance&nbsp;testing&nbsp;frameworks&nbsp;to&nbsp;do&nbsp;that&nbsp;for&nbsp;us)&nbsp;that&#39;d&nbsp;really&nbsp;increase&nbsp;the&nbsp;confidence&nbsp;in&nbsp;correctness&nbsp;over&nbsp;time.&nbsp;The&nbsp;two&nbsp;do&nbsp;not&nbsp;cancel&nbsp;each&nbsp;other,&nbsp;luckily.&nbsp;The&nbsp;former&nbsp;can&nbsp;do&nbsp;fast-feedback&nbsp;return,&nbsp;the&nbsp;latter&nbsp;can&nbsp;say&nbsp;&quot;something&nbsp;is&nbsp;wrong&quot;&nbsp;and&nbsp;then&nbsp;we&nbsp;can&nbsp;-&nbsp;if&nbsp;needed&nbsp;-&nbsp;bisect&nbsp;to&nbsp;point&nbsp;to&nbsp;a&nbsp;specific&nbsp;commit&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt; &nbsp; &nbsp;Francesco&lt;/div&gt;&lt;/div&gt;<br>

</tt>
