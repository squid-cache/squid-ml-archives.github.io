<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Mon,&nbsp;May&nbsp;17,&nbsp;2021&nbsp;at&nbsp;8:32&nbsp;PM&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;5/17/21&nbsp;2:17&nbsp;AM,&nbsp;Francesco&nbsp;Chemolli&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;Our&nbsp;Linux&nbsp;environments&nbsp;are&nbsp;docker&nbsp;containers&nbsp;on&nbsp;amd64,&nbsp;armv7l&nbsp;and&nbsp;arm64.&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;a&nbsp;roughly monthly cadence,&nbsp;I&nbsp;pull&nbsp;from&nbsp;our&nbsp;dockerfiles&nbsp;repo&lt;br&gt;<br>
&gt;&nbsp;(&lt;a&nbsp;href=&quot;https://github.com/kinkie/dockerfiles&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/kinkie/dockerfiles&lt;/a&gt;)&nbsp;and&lt;br&gt;<br>
&gt;&nbsp;$&nbsp;make&nbsp;all&nbsp;push&lt;br&gt;<br>
&lt;br&gt;<br>
Does&nbsp;that&nbsp;&quot;make&nbsp;push&quot;&nbsp;command&nbsp;automatically&nbsp;switch&nbsp;Jenkins&nbsp;CI&nbsp;to&nbsp;using&lt;br&gt;<br>
the&nbsp;new/pushed&nbsp;containers?&nbsp;Or&nbsp;is&nbsp;that&nbsp;a&nbsp;separate&nbsp;manual&nbsp;step?&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Right&nbsp;now&nbsp;that&#39;s&nbsp;automatic.&lt;/div&gt;&lt;div&gt;I&#39;m&nbsp;pondering&nbsp;the&nbsp;best&nbsp;way&nbsp;to&nbsp;have&nbsp;a&nbsp;staging&nbsp;step;&nbsp;Docker&nbsp;supports&nbsp;versioning&nbsp;of&nbsp;images&nbsp;but&nbsp;we&#39;re&nbsp;using&nbsp;that&nbsp;feature&nbsp;to&nbsp;implement&nbsp;multiarch.&nbsp;In&nbsp;order&nbsp;to&nbsp;rely&nbsp;on&nbsp;that&nbsp;I&#39;ll&nbsp;need&nbsp;to&nbsp;change&nbsp;the&nbsp;naming&nbsp;conventions&nbsp;we&nbsp;rely&nbsp;on.&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;<br>
&gt;&gt;&gt;&nbsp;What&nbsp;I&nbsp;would&nbsp;place&nbsp;on&nbsp;each&nbsp;individual&nbsp;dev&nbsp;is&nbsp;the&nbsp;case&nbsp;where&nbsp;a&nbsp;PR&nbsp;breaks&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;something&nbsp;in&nbsp;the&nbsp;trunk-matrix,trunk-arm32-matrix,&nbsp;trunk-arm64-matrix,&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;trunk-openbsd-matrix,&nbsp;trunk-freebsd-matrix&nbsp;builds&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&gt;&nbsp;I&nbsp;think&nbsp;you&nbsp;are&nbsp;saying&nbsp;that&lt;br&gt;<br>
&gt;&gt;&nbsp;some&nbsp;CI&nbsp;tests&nbsp;called&nbsp;trunk-matrix,&nbsp;trunk-arm32-matrix,&lt;br&gt;<br>
&gt;&gt;&nbsp;trunk-arm64-matrix,&nbsp;trunk-openbsd-matrix,&nbsp;trunk-freebsd-matrix&nbsp;should&nbsp;be&lt;br&gt;<br>
&gt;&gt;&nbsp;classified&nbsp;as&nbsp;_required_.&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;That&nbsp;is&nbsp;how&nbsp;I&nbsp;read&nbsp;the&nbsp;statement&nbsp;too.&lt;br&gt;<br>
&lt;br&gt;<br>
...&nbsp;but&nbsp;it&nbsp;sounds&nbsp;like&nbsp;that&nbsp;is&nbsp;_not_&nbsp;what&nbsp;you&nbsp;(Francesco)&nbsp;is&nbsp;actually&lt;br&gt;<br>
proposing&nbsp;because&nbsp;you&nbsp;are&nbsp;essentialy&nbsp;saying&nbsp;&quot;that&nbsp;ideal&nbsp;would&nbsp;be&lt;br&gt;<br>
impractical&quot;&nbsp;in&nbsp;the&nbsp;paragraph&nbsp;below.&nbsp;Assuming&nbsp;that&nbsp;you&nbsp;are&nbsp;not&nbsp;attacking&lt;br&gt;<br>
your&nbsp;own&nbsp;proposal,&nbsp;that&nbsp;means&nbsp;Amos&nbsp;and&nbsp;I&nbsp;do&nbsp;not&nbsp;know&nbsp;what&nbsp;your&nbsp;proposal&lt;br&gt;<br>
is&nbsp;--&nbsp;we&nbsp;both&nbsp;guessed&nbsp;incorrectly...&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;overarching&nbsp;objectives&nbsp;are:&lt;/div&gt;&lt;div&gt;-&nbsp;focus&nbsp;on&nbsp;where&nbsp;most&nbsp;users&nbsp;probably&nbsp;are&lt;/div&gt;&lt;div&gt;-&nbsp;allow&nbsp;iterating&nbsp;quickly&nbsp;giving&nbsp;some&nbsp;signal&nbsp;on&nbsp;tracked&nbsp;branches&lt;/div&gt;&lt;div&gt;-&nbsp;allow&nbsp;landing&nbsp;quickly&nbsp;with&nbsp;more&nbsp;signal&lt;/div&gt;&lt;div&gt;-&nbsp;be&nbsp;slow&nbsp;but&nbsp;exhaustive&nbsp;on&nbsp;every&nbsp;other&nbsp;platform&nbsp;we&nbsp;can&nbsp;cover.&nbsp;Do&nbsp;not&nbsp;block&nbsp;landing&nbsp;new&nbsp;code&nbsp;on&nbsp;less&nbsp;common&nbsp;or&nbsp;harder&nbsp;to&nbsp;test&nbsp;on&nbsp;platforms,&nbsp;but&nbsp;still&nbsp;rely&nbsp;on&nbsp;devs&nbsp;to&nbsp;own&nbsp;their&nbsp;changes&nbsp;there,&nbsp;too.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;<br>
&gt;&nbsp;In&nbsp;a&nbsp;word&nbsp;of&nbsp;infinite&nbsp;resources&nbsp;and&nbsp;very&nbsp;efficient&nbsp;testing,&nbsp;sure.&lt;br&gt;<br>
&gt;&nbsp;But&nbsp;in&nbsp;a&nbsp;space&nbsp;where&nbsp;a&nbsp;single&nbsp;os/compiler&nbsp;combo&nbsp;takes&nbsp;2hrs&nbsp;on&nbsp;Linux&nbsp;and&lt;br&gt;<br>
&gt;&nbsp;4hrs&nbsp;on&nbsp;Freebsd&nbsp;or&nbsp;openbsd,&nbsp;and&nbsp;a&nbsp;full&nbsp;5-pr-test&nbsp;takes&nbsp;6&nbsp;hours&nbsp;end&nbsp;to&lt;br&gt;<br>
&gt;&nbsp;end,&nbsp;we&nbsp;need&nbsp;to&nbsp;optimize&nbsp;or&nbsp;making&nbsp;any&nbsp;of&nbsp;these&nbsp;requirements&nbsp;blocking&lt;br&gt;<br>
&gt;&nbsp;would&nbsp;make&nbsp;these&nbsp;times&nbsp;get&nbsp;4+&nbsp;times&nbsp;larger&nbsp;(a&nbsp;full&nbsp;trunk-matrix&nbsp;takes&lt;br&gt;<br>
&gt;&nbsp;just&nbsp;about&nbsp;a&nbsp;day&nbsp;on&nbsp;amd64,&nbsp;2&nbsp;days&nbsp;on&nbsp;arm64),&nbsp;and&nbsp;the&nbsp;complaint&nbsp;would&lt;br&gt;<br>
&gt;&nbsp;then&nbsp;be&nbsp;that&nbsp;development&nbsp;or&nbsp;release&nbsp;is&nbsp;slowed&nbsp;down&nbsp;by&nbsp;the&nbsp;amount&nbsp;of&lt;br&gt;<br>
&gt;&nbsp;testing&nbsp;done.&lt;br&gt;<br>
&lt;br&gt;<br>
FWIW,&nbsp;I&nbsp;think&nbsp;that&nbsp;full&nbsp;round&nbsp;of&nbsp;PR&nbsp;tests&nbsp;(i.e.&nbsp;one&nbsp;initial&nbsp;set&nbsp;plus&nbsp;one&lt;br&gt;<br>
staging&nbsp;set)&nbsp;should&nbsp;not&nbsp;exceed&nbsp;~24&nbsp;hours,&nbsp;_including_&nbsp;any&nbsp;wait/queuing&lt;br&gt;<br>
time.&nbsp;This&nbsp;kind&nbsp;of&nbsp;delay&nbsp;should&nbsp;still&nbsp;allow&nbsp;for&nbsp;reasonable&nbsp;progress&nbsp;with&lt;br&gt;<br>
PRs&nbsp;AFAICT.&nbsp;This&nbsp;includes&nbsp;any&nbsp;release&nbsp;PRs,&nbsp;of&nbsp;course.&nbsp;If&nbsp;we&nbsp;exceed&nbsp;these&lt;br&gt;<br>
limits&nbsp;(or&nbsp;whatever&nbsp;limits&nbsp;we&nbsp;can&nbsp;agree&nbsp;on),&nbsp;then&nbsp;we&nbsp;should&nbsp;add&nbsp;testing&lt;br&gt;<br>
resources&nbsp;and/or&nbsp;drop&nbsp;tests.&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Is&nbsp;everyone&nbsp;okay&nbsp;with&nbsp;such&nbsp;a&nbsp;slow&nbsp;turnaround?&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;<br>
&gt;&nbsp;My&nbsp;proposal&nbsp;aims&nbsp;to&nbsp;test/land&nbsp;the&nbsp;PR&nbsp;on&nbsp;the&nbsp;systems&nbsp;where&nbsp;we&nbsp;can&nbsp;be&lt;br&gt;<br>
&gt;&nbsp;efficient&nbsp;and&nbsp;that&nbsp;are&nbsp;relevant,&nbsp;and&nbsp;fix&nbsp;any&nbsp;remaining&nbsp;after-the-fact&lt;br&gt;<br>
&gt;&nbsp;issues&nbsp;with&nbsp;followup,&nbsp;PRs,&nbsp;that&nbsp;remain&nbsp;a&nbsp;soft&nbsp;requirement&nbsp;for&nbsp;the&nbsp;dev&lt;br&gt;<br>
&gt;&nbsp;introducing&nbsp;the&nbsp;change.&lt;br&gt;<br>
&lt;br&gt;<br>
Here,&nbsp;I&nbsp;think&nbsp;you&nbsp;are&nbsp;proposing&nbsp;to&nbsp;make&nbsp;some&nbsp;tests&nbsp;optional.&nbsp;Which&nbsp;ones?&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Not&nbsp;the&nbsp;tests,&nbsp;but&nbsp;the&nbsp;platforms.&nbsp;Things&nbsp;like&nbsp;gentoo,&nbsp;fedora&nbsp;rawhide,&nbsp;freebsd,&nbsp;openbsd.&lt;/div&gt;&lt;div&gt;Testing&nbsp;is&nbsp;slower&nbsp;there,&nbsp;so&nbsp;results&nbsp;will&nbsp;lag&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;batch,&nbsp;running&nbsp;a&nbsp;full&nbsp;test&nbsp;suite&nbsp;every&nbsp;week&nbsp;or&nbsp;so&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;<br>
&gt;&nbsp;For&nbsp;instance:&nbsp;we&nbsp;currently&nbsp;have&nbsp;a&nbsp;lot&nbsp;of&nbsp;different&nbsp;build-time&lt;br&gt;<br>
&gt;&nbsp;configurations&nbsp;meant&nbsp;to&nbsp;save&nbsp;core&nbsp;memory&nbsp;in&nbsp;runtime&nbsp;environments.&nbsp;Is&nbsp;it&lt;br&gt;<br>
&gt;&nbsp;maybe&nbsp;time&nbsp;to&nbsp;revisit&nbsp;this&nbsp;decision&nbsp;and&nbsp;move&nbsp;these&nbsp;checks&nbsp;to&nbsp;run&nbsp;time?&lt;br&gt;<br>
&lt;br&gt;<br>
Sure,&nbsp;quality&nbsp;proposals&nbsp;for&nbsp;removing&nbsp;#ifdefs&nbsp;should&nbsp;be&nbsp;welcomed,&nbsp;one&lt;br&gt;<br>
(group&nbsp;of)&nbsp;#ifdefs&nbsp;at&nbsp;a&nbsp;time.&nbsp;We&nbsp;can&nbsp;warn&nbsp;squid-users&nbsp;in&nbsp;advance&nbsp;in&nbsp;case&lt;br&gt;<br>
somebody&nbsp;wants&nbsp;to&nbsp;provide&nbsp;evidence&nbsp;of&nbsp;harm.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&#39;m&nbsp;glad&nbsp;this&nbsp;is&nbsp;having&nbsp;buy-in.&nbsp;Are&nbsp;there&nbsp;any&nbsp;other&nbsp;opinions&nbsp;(for&nbsp;or&nbsp;against)?&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;<br>
&gt;&nbsp;Unfortunately,&nbsp;one&nbsp;of&nbsp;the&nbsp;problems&nbsp;we&nbsp;have&nbsp;is&nbsp;that&nbsp;we&#39;re&nbsp;running&nbsp;blind.&lt;br&gt;<br>
&gt;&nbsp;We&nbsp;don&#39;t&nbsp;know&nbsp;what&nbsp;configurations&nbsp;our&nbsp;users&nbsp;deploy;&nbsp;we&nbsp;can&nbsp;only&nbsp;assume&lt;br&gt;<br>
&gt;&nbsp;and&nbsp;that&nbsp;makes&nbsp;this&nbsp;conversation&nbsp;much&nbsp;more&nbsp;susceptible&nbsp;to&nbsp;opinions&nbsp;and&lt;br&gt;<br>
&gt;&nbsp;harder&nbsp;to&nbsp;build&nbsp;consensus&nbsp;on&lt;br&gt;<br>
&lt;br&gt;<br>
Yes,&nbsp;we&nbsp;are&nbsp;blind,&nbsp;but&nbsp;I&nbsp;doubt&nbsp;we&nbsp;should&nbsp;care&nbsp;much&nbsp;about&nbsp;actual&lt;br&gt;<br>
configuration&nbsp;in&nbsp;this&nbsp;specific&nbsp;context.&nbsp;If&nbsp;we&nbsp;can&nbsp;remove&nbsp;an&nbsp;#ifdef&lt;br&gt;<br>
without&nbsp;serious&nbsp;negative&nbsp;consequences,&nbsp;we&nbsp;should&nbsp;remove&nbsp;it.&nbsp;We&nbsp;can&nbsp;avoid&lt;br&gt;<br>
long&nbsp;discussions&nbsp;by&nbsp;allowing&nbsp;anybody&nbsp;with&nbsp;concrete&nbsp;evidence&nbsp;of&nbsp;problems&lt;br&gt;<br>
to&nbsp;block&nbsp;any&nbsp;particular&nbsp;removal.&nbsp;I&nbsp;bet&nbsp;that&nbsp;conservative&nbsp;approach&nbsp;would&lt;br&gt;<br>
still&nbsp;allow&nbsp;for&nbsp;the&nbsp;removal&nbsp;of&nbsp;many&nbsp;#ifdefs.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Sounds&nbsp;good&nbsp;to&nbsp;me &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;<br>
FWIW,&nbsp;I&nbsp;do&nbsp;not&nbsp;think&nbsp;reducing&nbsp;the&nbsp;number&nbsp;of&nbsp;#ifdefs&nbsp;will&nbsp;solve&nbsp;our&lt;br&gt;<br>
primary&nbsp;CI&nbsp;problems.&nbsp;I&nbsp;believe&nbsp;we&nbsp;should&nbsp;reduce&nbsp;the&nbsp;number&nbsp;of&nbsp;platforms&lt;br&gt;<br>
we&nbsp;test&nbsp;on&nbsp;and&nbsp;then&nbsp;use&nbsp;Foundation&nbsp;resources&nbsp;to&nbsp;speed&nbsp;up&nbsp;and&nbsp;improve&nbsp;the&lt;br&gt;<br>
remaining&nbsp;tests.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Each&nbsp;test&nbsp;build&nbsp;is&nbsp;right&nbsp;now&nbsp;4&nbsp;full&nbsp;builds&nbsp;and&nbsp;test&nbsp;suites:&lt;/div&gt;&lt;div&gt;autodetected,&nbsp;minimal,&nbsp;maximum,&nbsp;everytthing-in-except-for-auth&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Can&nbsp;we&nbsp;reduce&nbsp;them&nbsp;to&nbsp;2?&nbsp;If&nbsp;so,&nbsp;which&nbsp;ones?&nbsp;that&nbsp;would&nbsp;be&nbsp;the&nbsp;guide&nbsp;to&nbsp;#ifdef&nbsp;removal&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;<br>
HTH,&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;does;&nbsp;thanks&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
