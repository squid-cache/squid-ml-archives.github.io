<tt>
&lt;html&gt;&lt;br&nbsp;/&gt;On&nbsp;Saturday,&nbsp;October&nbsp;30,&nbsp;2021&nbsp;01:14&nbsp;GMT,&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;rousskov@measurement-factory.com&gt;&nbsp;wrote:&lt;br&nbsp;/&gt;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;cite=&quot;03983185-b4d1-83cc-cc12-df4a9a98527d@measurement-factory.com&quot;&gt;On&nbsp;10/29/21&nbsp;8:37&nbsp;PM,&nbsp;Amos&nbsp;Jeffries&nbsp;wrote:&lt;br&nbsp;/&gt;&gt;&nbsp;On&nbsp;30/10/21&nbsp;11:09,&nbsp;Alex&nbsp;Rousskov&nbsp;wrote:&lt;br&nbsp;/&gt;&gt;&gt;&nbsp;On&nbsp;10/26/21&nbsp;5:46&nbsp;PM,&nbsp;kk@sudo-i.net&nbsp;wrote:&lt;br&nbsp;/&gt;&gt;&gt;&lt;br&nbsp;/&gt;&gt;&gt;&gt;&nbsp;-&nbsp;Squid&nbsp;enforces&nbsp;the&nbsp;Client&nbsp;to&nbsp;use&nbsp;SNI&lt;br&nbsp;/&gt;&gt;&gt;&gt;&nbsp;-&nbsp;Squid&nbsp;lookup&nbsp;IP&nbsp;for&nbsp;SNI&nbsp;(DNS&nbsp;resolution).&lt;br&nbsp;/&gt;&gt;&gt;&gt;&nbsp;-&nbsp;Squid&nbsp;forces&nbsp;the&nbsp;client&nbsp;to&nbsp;go&nbsp;to&nbsp;the&nbsp;resolved&nbsp;IP&lt;br&nbsp;/&gt;&gt;&gt;&lt;br&nbsp;/&gt;&gt;&gt;&nbsp;AFAICT,&nbsp;the&nbsp;above&nbsp;strategy&nbsp;is&nbsp;in&nbsp;conflict&nbsp;with&nbsp;the&nbsp;&quot;SECURITY&nbsp;NOTE&quot;&lt;br&nbsp;/&gt;&gt;&gt;&nbsp;paragraph&nbsp;in&nbsp;host_verify_strict&nbsp;documentation:&nbsp;If&nbsp;Squid&nbsp;strays&nbsp;from&nbsp;the&lt;br&nbsp;/&gt;&gt;&gt;&nbsp;intended&nbsp;IP&nbsp;using&nbsp;client-supplied&nbsp;destination&nbsp;info,&nbsp;then&nbsp;malicious&lt;br&nbsp;/&gt;&gt;&gt;&nbsp;applets&nbsp;will&nbsp;escape&nbsp;browser&nbsp;IP-based&nbsp;protections.&nbsp;Also,&nbsp;SNI&nbsp;obfuscation&lt;br&nbsp;/&gt;&gt;&gt;&nbsp;or&nbsp;encryption&nbsp;may&nbsp;make&nbsp;this&nbsp;strategy&nbsp;ineffective&nbsp;or&nbsp;short-lived.&lt;br&nbsp;<br>
&nbsp;/&gt;&gt;&gt;&lt;br&nbsp;/&gt;&gt;&gt;&nbsp;AFAICT,&nbsp;in&nbsp;the&nbsp;majority&nbsp;of&nbsp;deployments,&nbsp;the&nbsp;mismatch&nbsp;between&nbsp;the&lt;br&nbsp;/&gt;&gt;&gt;&nbsp;intended&nbsp;IP&nbsp;address&nbsp;and&nbsp;the&nbsp;SNI/Host&nbsp;header&nbsp;can&nbsp;be&nbsp;correctly&nbsp;handled&lt;br&nbsp;/&gt;&gt;&gt;&nbsp;automatically&nbsp;and&nbsp;without&nbsp;creating&nbsp;serious&nbsp;problems&nbsp;for&nbsp;the&nbsp;user.&nbsp;Squid&lt;br&nbsp;/&gt;&gt;&gt;&nbsp;already&nbsp;does&nbsp;the&nbsp;right&nbsp;thing&nbsp;in&nbsp;some&nbsp;cases.&nbsp;Somebody&nbsp;should&nbsp;carefully&lt;br&nbsp;/&gt;&gt;&gt;&nbsp;expand&nbsp;that&nbsp;coverage&nbsp;to&nbsp;intercepted&nbsp;traffic.&nbsp;Frankly,&nbsp;I&nbsp;am&nbsp;somewhat&lt;br&nbsp;/&gt;&gt;&gt;&nbsp;surprised&nbsp;nobody&nbsp;has&nbsp;done&nbsp;that&nbsp;yet&nbsp;given&nbsp;the&nbsp;number&nbsp;of&nbsp;complaints!&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;&gt;&nbsp;IIRC&nbsp;the&nbsp;&quot;right&nbsp;thing&quot;&nbsp;as&nbsp;defined&nbsp;by&nbsp;TLS&nbsp;for&nbsp;SNI&nbsp;verification&nbsp;is&nbsp;that&nbsp;it&lt;br&nbsp;/&gt;&gt;&nbsp;be&nbsp;the&nbsp;same&nbsp;as&nbsp;the&nbsp;host/domain&nbsp;name&nbsp;from&nbsp;the&nbsp;wrapper&nbsp;protocol&nbsp;(i.e.&nbsp;the&lt;br&nbsp;/&gt;&gt;&nbsp;Host&nbsp;header&nbsp;/&nbsp;URL&nbsp;domain&nbsp;from&nbsp;HTTPS&nbsp;messages).&nbsp;Since&nbsp;Squid&nbsp;uses&nbsp;the&nbsp;SNI&lt;br&nbsp;/&gt;&gt;&nbsp;at&nbsp;step2&nbsp;as&nbsp;Host&nbsp;value&nbsp;it&nbsp;already&nbsp;gets&nbsp;checked&nbsp;against&nbsp;the&nbsp;intercepted&nbsp;IP&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;Just&nbsp;to&nbsp;avoid&nbsp;misunderstanding,&nbsp;my&nbsp;email&nbsp;was&nbsp;_not_&nbsp;about&nbsp;SNI&lt;br&nbsp;/&gt;verification.&nbsp;I&nbsp;was&nbsp;talking&nbsp;about&nbsp;solving&nbsp;the&nbsp;problem&nbsp;this&nbsp;thread&nbsp;is&lt;br<br>
&nbsp;&nbsp;/&gt;devoted&nbsp;to&nbsp;(and&nbsp;a&nbsp;specific&nbsp;solution&nbsp;proposed&nbsp;in&nbsp;the&nbsp;opening&nbsp;email&nbsp;on&nbsp;the&lt;br&nbsp;/&gt;thread).&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;Alex.&lt;br&nbsp;/&gt;_______________________________________________&lt;br&nbsp;/&gt;squid-dev&nbsp;mailing&nbsp;list&lt;br&nbsp;/&gt;squid-dev@lists.squid-cache.org&lt;br&nbsp;/&gt;http://lists.squid-cache.org/listinfo/squid-dev&lt;/blockquote&gt;Thanks&nbsp;Alex&nbsp;&amp;&nbsp;Amos.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;Not&nbsp;sure&nbsp;what&nbsp;do&nbsp;you&nbsp;mean&nbsp;with&nbsp;&quot;Somebody&nbsp;should&nbsp;carefully&nbsp;expand&nbsp;that&nbsp;coverage&nbsp;to&nbsp;intercepted&nbsp;traffic&quot;?&lt;br&nbsp;/&gt;&gt;then&nbsp;malicious&nbsp;applets&nbsp;will&nbsp;escape&nbsp;browser&nbsp;IP-based&nbsp;protections.&lt;br&nbsp;/&gt;Browser&nbsp;should&nbsp;perform&nbsp;IP-based&nbsp;protection&nbsp;on&nbsp;browser(client)&nbsp;level&nbsp;and&nbsp;should&nbsp;therefor&nbsp;not&nbsp;traverse&nbsp;squid.&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;&lt;br&nbsp;/&gt;--&nbsp;&lt;br&nbsp;/&gt;Kevin&nbsp;Klopfenstein&lt;br&nbsp;/&gt;Bellevuestrasse&nbsp;103&lt;br&nbsp;/&gt;3095&nbsp;Spiegel,&nbsp;CH&lt;br&nbsp;/&gt;&lt;a&nbsp;href=&quot;http://sudo-i.net&quot;&gt;sudo-i.net&lt;/a&gt;&lt;/html&gt;<br>

</tt>
