digraph Protocols {

label="Protocol Transactions" fontsize="40" labelloc="t"

subgraph clusterLegend {
  label="legend" rankdir="LR" fontsize="20"
  { node [style=invis] ; a ; b ; c ; d ; e ; f ; g}
   ; a -> b [label=" switch protocol " arrowhead=vee ]
   ; b -> c [label=" nest protocol " arrowhead=box ]
   ; c -> d [label=" fetch data " arrowhead=icurve ]
   ; d -> e [label=" implemented " color=blue arrowhead=none]
   ; e -> f [label=" partial support " color=green arrowhead=none]
   ; f -> g [label=" missing " color=orange arrowhead=none]
}

subgraph map {
  label="" rankdir="TB"

{ 
 node [shape=hexagon style=filled fillcolor=orange]
  ; QUIC
  ; DTLS
  ; COAP
  ; DOH
  ; PROXY [ fillcolor=green]
  ; CONNECT [ fillcolor=white]
}

subgraph {
 # Transport protocol from client
 rank=min ; "TCP (from-client)"; "UDP (from-client)" ; "TLS (from-client)"
}

subgraph {
 # Nested transfer protocols
 rank=same ; DTLS ; QUIC ; PROXY ; COAP
}

subgraph {
 # Transfer Protocols parsed and handled by Squid
 rank=same ; HTTP ; FTP
}

subgraph {
 # URI scheme selecting HTTP message handling in FwdState
 node [shape=diamond] rank=same ; "http:" ; "https:" ; "ftp:" ; "gopher:" ; "wais:" ; "urn:"
}

subgraph {
 # Transport protocol to server
 rank=max ; "TCP (to-server)"; "UDP (to-server)" ; "TLS (to-server)"
}

; "TCP (from-client)" -> IDENT [color=blue arrowhead=icurve ]
; "TCP (from-client)" -> NAT [color=blue arrowhead=icurve ]
; "TCP (from-client)" -> TPROXY [color=blue arrowhead=icurve ]
; "TCP (from-client)" -> QoS [color=blue arrowhead=icurve ]
; "TCP (from-client)" -> HTTP [color=blue arrowhead=box]
; "TCP (from-client)" -> "TLS (from-client)" [color=blue arrowhead=box]
; "TCP (from-client)" -> FTP [color=green arrowhead=box]
; "TCP (from-client)" -> PROXY [color=orange arrowhead=box]

; PROXY -> HTTP [color=green arrowhead=vee]
; PROXY -> "TLS (from-client)" [color=orange arrowhead=vee]
; PROXY -> FTP [color=orange arrowhead=vee]
; PROXY -> DNS [color=orange arrowhead=icurve]

; HTTP -> CONNECT [color=blue arrowhead=vee]
; HTTP -> "http:" [color=blue]
; HTTP -> "https:" [color=blue]
; HTTP -> "ftp:" [color=blue]
; HTTP -> "gopher:" [color=blue]
; HTTP -> "urn:" [color=blue]
; HTTP -> "wais:" [color=blue]
; HTTP -> DOH [color=orange]
; HTTP -> ICAP [color=blue arrowhead=icurve]

; FTP -> "TCP (to-server)" [color=blue arrowhead=icurve]

; ICAP -> "TCP (to-server)" [color=blue arrowhead=icurve]
; ICAP -> "TLS (to-server)" [color=blue arrowhead=icurve]

; CONNECT -> "TCP (to-server)" [color=blue arrowhead=icurve]
; CONNECT -> "TLS (from-client)" [color=blue arrowhead=vee]
; CONNECT -> "TLS (to-server)" [color=blue arrowhead=icurve]
; CONNECT -> HTTP [color=orange arrowhead=vee]
; CONNECT -> FTP [color=orange arrowhead=vee]
; CONNECT -> DOH [color=green arrowhead=vee]

; "TLS (from-client)" -> DNS [color=orange arrowhead=icurve]
; "TLS (from-client)" -> HTTP [color=green arrowhead=vee] # SSL-Bump bump
; "TLS (from-client)" -> FTP [color=orange arrowhead=vee]
; "TLS (from-client)" -> PROXY [color=orange arrowhead=vee]
; "TLS (from-client)" -> "TCP (to-server)" [color=blue arrowhead=vee]
; "TLS (from-client)" -> "http:" [color=blue arrowhead=icurve] # HTTPS
; "TLS (from-client)" -> "TLS (to-server)" [color=blue arrowhead=icurve] # SSL-Bump splice

; "TLS (to-server)" -> DNS [color=orange arrowhead=icurve]
; "TLS (to-server)" -> HTTP [color=green arrowhead=box]
; "TLS (to-server)" -> FTP [color=orange arrowhead=box]
; "TLS (to-server)" -> PROXY [color=orange arrowhead=box]
; "TLS (to-server)" -> "TCP (to-server)" [color=blue arrowhead=vee]
; "TLS (to-server)" -> "http:" [color=blue arrowhead=icurve]

; DOH -> DNS [color=orange arrowhead=icurve]
; DOH -> "http:" [color=blue arrowhead=vee]
; DOH -> "https:" [color=blue arrowhead=vee]
; DOH -> "urn:" [color=blue arrowhead=vee]

; DNS -> "UDP (to-server)" [color=blue arrowhead=icurve]
; DNS -> "TCP (to-server)" [color=blue arrowhead=icurve]
; DNS -> "TLS (to-server)" [color=orange arrowhead=icurve]
; DNS -> HTTP [color=orange arrowhead=vee]

; "UDP (from-client)" -> SNMP [color=blue arrowhead=box]
; "UDP (from-client)" -> ICP [color=blue arrowhead=box]
; "UDP (from-client)" -> HTCP [color=blue arrowhead=box]
; "UDP (from-client)" -> WCCP [color=blue arrowhead=box]
; "UDP (from-client)" -> QUIC [color=orange arrowhead=box]
; "UDP (from-client)" -> DTLS [color=orange arrowhead=box]
; "UDP (from-client)" -> COAP [color=orange arrowhead=box]

; DTLS -> QUIC [color=orange arrowhead=box]
; DTLS -> DNS [color=orange arrowhead=icurve]
; DTLS -> COAP [color=orange arrowhead=box]
; DTLS -> "http:" [color=orange arrowhead=icurve]

; COAP -> HTTP [color=orange arrowhead=box]

; QUIC -> HTTP [color=orange arrowhead=box]

; "http:" -> "TCP (to-server)" [color=blue arrowhead=icurve]
; "https:" -> "TLS (to-server)" [color=blue arrowhead=icurve]
; "ftp:" -> "TCP (to-server)" [color=blue arrowhead=icurve]
; "gopher:" -> "TCP (to-server)" [color=blue arrowhead=icurve]
; "urn:" -> "TCP (to-server)" [color=blue arrowhead=icurve]
; "wais:" -> "TCP (to-server)" [color=blue arrowhead=icurve]

}

}
