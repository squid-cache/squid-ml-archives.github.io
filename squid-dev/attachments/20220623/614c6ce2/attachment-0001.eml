[From nobody Fri Jun 24 12:00:01 2022
X-Envelope-From: &lt;rousskov@measurement-factory.com&gt;
X-Envelope-To: &lt;squid-dev@lists.squid-cache.org&gt;
Received: from mail.measurement-factory.com (unknown)
 by lists.squid-cache.org (Postfix 3.4.13/8.13.0) with SMTP id unknown
 Thu, 23 Jun 2022 13:12:53 +0000
 (envelope-from &lt;rousskov@measurement-factory.com&gt;);
Received: from [192.168.88.182] (c-65-182-34-126.hs.gigamonster.net
 [65.182.34.126])
 (using TLSv1.3 with cipher TLS_AES_128_GCM_SHA256 (128/128 bits)
 key-exchange X25519 server-signature RSA-PSS (2048 bits))
 (No client certificate requested)
 by mail.measurement-factory.com (Postfix) with ESMTPSA id 8C904E03D
 for &lt;squid-dev@lists.squid-cache.org&gt;; Thu, 23 Jun 2022 13:12:52 +0000 (UTC)
Message-ID: &lt;3f3add8c-72a6-52e7-90d2-b46eeeb50c89@measurement-factory.com&gt;
Date: Thu, 23 Jun 2022 09:12:52 -0400
MIME-Version: 1.0
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101
 Thunderbird/91.9.1
From: Alex Rousskov &lt;rousskov@measurement-factory.com&gt;
Subject: RFC: Class section/member order
To: Squid Developers &lt;squid-dev@lists.squid-cache.org&gt;
Content-Language: en-US
Content-Type: text/plain; charset=UTF-8; format=flowed
Content-Transfer-Encoding: 7bit

Hello,

     Amos and I disagreed[1] regarding the existing guidelines for 
section/member order in C++ class declarations. To resolve that 
disagreement, this email proposes the order for future use.

-----

1. Class &quot;sections&quot; order (by member access specifiers): public, 
protected, private. Each section, if present, declared once. Omit 
sections that would be empty. Rationale: List most commonly reused, most 
important things fist. In this context, those are public class 
interfaces. The private section is the least important implementation 
detail as far as the notion of a C++ class is concerned.


2. Within each section, the recommended member order is defined below. 
Rationale: Group similar things together to facilitate searching and 
highlight differences. List things most likely to be reused (by other 
class members) and most important/influential things higher.

* friendship declarations
* type and aliases declarations; nested classes/structs/unions
* static member functions
* constructors and assignment operators
* destructors (just one until C++20)
* other/regular non-static member functions except overrides
* overrides (see item 3 below)
* static data members
* non-static data members


3. Overrides are a special case where we do not expect member 
descriptions but do expect a reference to the corresponding API as 
sketched below. Overrides are grouped by the (direct or indirect) parent 
that _introduced_ the corresponding API method(s) (i.e. the parent class 
that declared the virtual method but could _not_ use an override keyword 
in that declaration). Rationale: Provide API context and facilitate 
searching for member descriptions without chasing overrides through parents.

     /* Baz API */
     overrides for Baz-introduced methods (excluding destructors)

     /* Bar API */
     overrides for Bar-introduced methods (excluding destructors)


4. Caveats

The above rules are not meant to force authors to include any access 
specifiers or members that the code does not actually need (except the 
&quot;private&quot; specifier should be mentioned explicitly in class declarations 
that have only private members -- do not rely on the class default 
access specifier being &quot;private&quot;).

Squid has some legacy code that forces CBDATA-related declarations to be 
hoisted to the very top of the class, into the &quot;unnamed&quot; section. This 
is an exception to the above rules. Eventually, we will stop doing that, 
but we should continue doing that for consistency sake until the 
offending CBDATA macros are gone.

Like any style rules, these rules are not comprehensive. If your use 
case is not explicitly covered, then look around for similar Squid code 
and try to be consistent and/or reasonable.

-----

Most of the above rules are arbitrary but common in the industry[2,3].

[1] https://github.com/squid-cache/squid/pull/1067#discussion_r889864925
[2] https://stackoverflow.com/q/308581
[3] https://google.github.io/styleguide/cppguide.html#Declaration_Order


HTH,

Alex.
]