<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid WCCP with multiple workers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20WCCP%20with%20multiple%20workers&In-Reply-To=%3C547C3AE3.7030505%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000976.html">
   <LINK REL="Next"  HREF="000986.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid WCCP with multiple workers</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20WCCP%20with%20multiple%20workers&In-Reply-To=%3C547C3AE3.7030505%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid WCCP with multiple workers">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Dec  1 09:54:43 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000976.html">[squid-users] Squid WCCP with multiple workers
</A></li>
        <LI>Next message (by thread): <A HREF="000986.html">[squid-users] Squid WCCP with multiple workers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#984">[ date ]</a>
              <a href="thread.html#984">[ thread ]</a>
              <a href="subject.html#984">[ subject ]</a>
              <a href="author.html#984">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 1/12/2014 9:38 p.m., Henrik Nordstrom wrote:
&gt;<i> fre 2014-11-28 klockan 10:28 +0000 skrev Stephen Baynes:
</I>&gt;&gt;<i> Is WCCP supposed to work with Squid multiple workers?
</I>&gt;<i> 
</I>&gt;<i> In theory it should work.. but not sure it has been adapted for 
</I>&gt;<i> multi-worker.
</I>
Not that I am aware of.

I think each worker will be emitting separate WCCP packts to the
router. If they are all sharing http_port entries then there should be
no problem, as long as one worker is running the router will see the
proxy as alive. With differet http_port between workers they can
confuse the router and cause it to reset its traffic mappings up to
every 10 seconds.

There may also be problems with receiving back the WCCP reply from
router as no guarantee it goes to the right worker. Some may receive
multiple packets and some workers might think their router has gone
away as it dont reply often enough. This should only affect Squid
workers which have never received any router reply before receiving
HTTP, once they get one packet they cache the details until updated.

&gt;<i> 
</I>&gt;&gt;<i> It works with 1 worker. If we change the number of workers from 1
</I>&gt;&gt;<i> to 2 we see it fail. The router no longer is aware of Squid and
</I>&gt;&gt;<i> does not reroute the data to the Squid box.
</I>&gt;<i> 
</I>&gt;<i> Try making the wccp configuration conditional on worker id 1. If
</I>&gt;<i> this makes a difference then Squid needs to be extended to add a
</I>&gt;<i> internal wccp worker.
</I>&gt;<i> 
</I>
Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUfDrjAAoJELJo5wb/XPRjaE8H/2tSAA/9Yz2RDSgm/xjAqphB
Zz3jlGRSUDIlMDeVfH7p+2hhEGZ41yPQ9x0viWMDvd4NNHOY8/c+DoA5OkzjYT+9
Kl+2HyFGWy1EqY3oC3mREVxab4i/5NvXveZQg9Pf4imMPkQxzqD+hXp8RCmVsFms
RW+0RvqeW7Jb8uDZjTOGjLI+pXlTehpQOoLQmRUxy0WTT75m9xlnnTPtTo4zb1by
qxB0+PrC7Z/G7A8LYw9tFgEVF7KKHNLIkUJGibP/ojSs5PZ+Y+AS9HdphldfLEoG
EUSxafYcVyqDavm/nhMAWG//JPfcpY4ZyLsfRV2L9kbI01RaiHAep7Gf0GqUlGw=
=mO6b
-----END PGP SIGNATURE-----

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000976.html">[squid-users] Squid WCCP with multiple workers
</A></li>
	<LI>Next message (by thread): <A HREF="000986.html">[squid-users] Squid WCCP with multiple workers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#984">[ date ]</a>
              <a href="thread.html#984">[ thread ]</a>
              <a href="subject.html#984">[ subject ]</a>
              <a href="author.html#984">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
