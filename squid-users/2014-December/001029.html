<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Running SCCM through Squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Running%20SCCM%20through%20Squid&In-Reply-To=%3CCAFFsz%2BLLWkU6U15Liydc%2Ba68LrUt%2Bpo4AJCsqohWHRfzOXR6iQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001059.html">
   <LINK REL="Next"  HREF="001030.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Running SCCM through Squid</H1>
    <B>John Gardner</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Running%20SCCM%20through%20Squid&In-Reply-To=%3CCAFFsz%2BLLWkU6U15Liydc%2Ba68LrUt%2Bpo4AJCsqohWHRfzOXR6iQ%40mail.gmail.com%3E"
       TITLE="[squid-users] Running SCCM through Squid">jeg1972 at gmail.com
       </A><BR>
    <I>Sun Dec  7 19:32:25 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="001059.html">[squid-users] https issues for google
</A></li>
        <LI>Next message (by thread): <A HREF="001030.html">[squid-users] Running SCCM through Squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1029">[ date ]</a>
              <a href="thread.html#1029">[ thread ]</a>
              <a href="subject.html#1029">[ subject ]</a>
              <a href="author.html#1029">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi everyone, I'm posting this in the hope that someone will have some
experience in connecting Microsoft System Center Configuration Manager
(SCCM) through a Squid Reverse Proxy in Internet-Based Client
Management mode.  Basically, at the moment we use SCCM through an MS
TMG server in Reverse Proxy configuration and this works (probably
because Microsoft have lots documentation on this on their site), but
due to the fact that MS are phasing out TMG, we want another solution
for patching our laptops when they are off the network but on the
Internet.

What should happen is that when a laptop is off the LAN but on the
Internet, it communicates back to the SCCM server via HTTPS through
port 443. The authentication happens as there is a certificate on the
laptop which has a organisational CA in common and once authenticated,
all of the patches should roll out.

When we try to connect through Squid, the traffic does get through
from the laptop to the SCCM server, but we do have issues.

The configuration in Squid is as follows (running on Squid 3.4);


https_port xx.xx.xx.44:443 accel
cert=/usr/newrprgate/CertAuth/ibcm.ourdomain.com/ibcm.crt
key=/usr/newrprgate/CertAuth/ibcm.ourdomain.com/ibcm_key.pem
cipher=ALL:!aNULL:!ADH:!eNULL:!LOW:!EXP:RC4+RSA:+HIGH:+MEDIUM
options=NO_SSLv2,NO_SSLv3 defaultsite=server_4.btstl.co.uk
cache_peer xx.xx.xx.60 parent 443 0 no-query originserver login=PASS
connection-auth=on ssl
sslcert=/usr/newrprgate/CertAuth/ibcm.ourdomain.com/peer_keys/IBCM.pem
sslversion=1 sslflags=DONT_VERIFY_PEER front-end-https
name=server_4_https
acl sites_server_4 dstdomain ibcm.ourdomain.com
cache_peer_access server_4_https allow sites_server_4
cache_peer_access server_4_https deny all

And the log looks like this;

81.XX.XX.XX - - [05/Dec/2014:11:43:33 +0000] &quot;CCM_POST
<A HREF="https://ibcm.ourdomain.com/ccm_system/request">https://ibcm.ourdomain.com/ccm_system/request</A> HTTP/1.1&quot; 403 1560
TCP_MISS:FIRSTUP_PARENT
81.XX.XX.XX - - [05/Dec/2014:11:51:16 +0000] &quot;CCM_POST
<A HREF="https://ibcm.ourdomain.com/ccm_system/request">https://ibcm.ourdomain.com/ccm_system/request</A> HTTP/1.1&quot; 403 1560
TCP_MISS:FIRSTUP_PARENT
81.XX.XX.XX - - [05/Dec/2014:11:54:44 +0000] &quot;CCM_POST
<A HREF="https://ibcm.ourdomain.com/ccm_system/request">https://ibcm.ourdomain.com/ccm_system/request</A> HTTP/1.1&quot; 403 1560
TCP_MISS:FIRSTUP_PARENT
81.XX.XX.XX - - [05/Dec/2014:11:57:44 +0000] &quot;CCM_POST
<A HREF="https://ibcm.ourdomain.com/bgb/handler.ashx?">https://ibcm.ourdomain.com/bgb/handler.ashx?</A> HTTP/1.1&quot; 403 1560
TCP_MISS:FIRSTUP_PARENT
81.XX.XX.XX - - [05/Dec/2014:12:02:55 +0000] &quot;CCM_POST
<A HREF="https://ibcm.ourdomain.com/ccm_system/request">https://ibcm.ourdomain.com/ccm_system/request</A> HTTP/1.1&quot; 403 1560
TCP_MISS:FIRSTUP_PARENT
81.XX.XX.XX - - [05/Dec/2014:12:02:55 +0000] &quot;CCM_POST
<A HREF="https://ibcm.ourdomain.com/ccm_system/request">https://ibcm.ourdomain.com/ccm_system/request</A> HTTP/1.1&quot; 403 1560
TCP_MISS:FIRSTUP_PARENT
81.XX.XX.XX - - [05/Dec/2014:12:02:55 +0000] &quot;CCM_POST
<A HREF="https://ibcm.ourdomain.com/ccm_system/request">https://ibcm.ourdomain.com/ccm_system/request</A> HTTP/1.1&quot; 403 1560
TCP_MISS:FIRSTUP_PARENT
81.XX.XX.XX - - [05/Dec/2014:12:22:13 +0000] &quot;CCM_POST
<A HREF="https://ibcm.ourdomain.com/ccm_system/request">https://ibcm.ourdomain.com/ccm_system/request</A> HTTP/1.1&quot; 403 1560
TCP_MISS:FIRSTUP_PARENT
81.XX.XX.XX - - [05/Dec/2014:12:22:13 +0000] &quot;CCM_POST
<A HREF="https://ibcm.ourdomain.com/ccm_system/request">https://ibcm.ourdomain.com/ccm_system/request</A> HTTP/1.1&quot; 403 1560
TCP_MISS:FIRSTUP_PARENT
81.XX.XX.XX - - [05/Dec/2014:12:22:13 +0000] &quot;CCM_POST
<A HREF="https://ibcm.ourdomain.com/ccm_system/request">https://ibcm.ourdomain.com/ccm_system/request</A> HTTP/1.1&quot; 403 1560
TCP_MISS:FIRSTUP_PARENT
81.XX.XX.XX - - [05/Dec/2014:12:22:14 +0000] &quot;CCM_POST
<A HREF="https://ibcm.ourdomain.com/ccm_system/request">https://ibcm.ourdomain.com/ccm_system/request</A> HTTP/1.1&quot; 403 1560
TCP_MISS:FIRSTUP_PARENT
81.XX.XX.XX - - [05/Dec/2014:12:31:27 +0000] &quot;CCM_POST
<A HREF="https://ibcm.ourdomain.com/bgb/handler.ashx?">https://ibcm.ourdomain.com/bgb/handler.ashx?</A> HTTP/1.1&quot; 403 1560
TCP_MISS:FIRSTUP_PARENT
81.XX.XX.XX - - [05/Dec/2014:12:39:37 +0000] &quot;CCM_POST
<A HREF="https://ibcm.ourdomain.com/ccm_system/request">https://ibcm.ourdomain.com/ccm_system/request</A> HTTP/1.1&quot; 403 1560
TCP_MISS:FIRSTUP_PARENT
81.XX.XX.XX - - [05/Dec/2014:12:39:38 +0000] &quot;CCM_POST
<A HREF="https://ibcm.ourdomain.com/ccm_system/request">https://ibcm.ourdomain.com/ccm_system/request</A> HTTP/1.1&quot; 403 1560
TCP_MISS:FIRSTUP_PARENT
81.XX.XX.XX - - [05/Dec/2014:12:39:38 +0000] &quot;CCM_POST
<A HREF="https://ibcm.ourdomain.com/ccm_system/request">https://ibcm.ourdomain.com/ccm_system/request</A> HTTP/1.1&quot; 403 1560
TCP_MISS:FIRSTUP_PARENT
81.XX.XX.XX - - [05/Dec/2014:12:40:48 +0000] &quot;CCM_POST
<A HREF="https://ibcm.ourdomain.com/ccm_system/request">https://ibcm.ourdomain.com/ccm_system/request</A> HTTP/1.1&quot; 403 1560
TCP_MISS:FIRSTUP_PARENT
81.XX.XX.XX - - [05/Dec/2014:12:42:28 +0000] &quot;CCM_POST
<A HREF="https://ibcm.ourdomain.com/ccm_system/request">https://ibcm.ourdomain.com/ccm_system/request</A> HTTP/1.1&quot; 403 1560
TCP_MISS:FIRSTUP_PARENT
81.XX.XX.XX - - [05/Dec/2014:12:45:39 +0000] &quot;CCM_POST
<A HREF="https://ibcm.ourdomain.com/ccm_system/request">https://ibcm.ourdomain.com/ccm_system/request</A> HTTP/1.1&quot; 403 1560
TCP_MISS:FIRSTUP_PARENT
81.XX.XX.XX - - [05/Dec/2014:12:51:19 +0000] &quot;CCM_POST
<A HREF="https://ibcm.ourdomain.com/ccm_system/request">https://ibcm.ourdomain.com/ccm_system/request</A> HTTP/1.1&quot; 403 1560
TCP_MISS:FIRSTUP_PARENT

So obviously, we are connecting, but getting a 403 error back.  The
configuration on the SCCM server does appear to be correct, so we are
examining whether we have configured the Squid part correctly... Does
anyone have any experience of doing this?

Thanks in advance

John

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="001059.html">[squid-users] https issues for google
</A></li>
	<LI>Next message (by thread): <A HREF="001030.html">[squid-users] Running SCCM through Squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1029">[ date ]</a>
              <a href="thread.html#1029">[ thread ]</a>
              <a href="subject.html#1029">[ subject ]</a>
              <a href="author.html#1029">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
