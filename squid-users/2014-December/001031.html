<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] https issues for google
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20https%20issues%20for%20google&In-Reply-To=%3C2329B68B3D676246BA0D1149E22F509F01A6FBA4%40bneseqs20.bradnams.com.au%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001027.html">
   <LINK REL="Next"  HREF="001034.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] https issues for google</H1>
    <B>glenn.groves at bradnams.com.au</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20https%20issues%20for%20google&In-Reply-To=%3C2329B68B3D676246BA0D1149E22F509F01A6FBA4%40bneseqs20.bradnams.com.au%3E"
       TITLE="[squid-users] https issues for google">glenn.groves at bradnams.com.au
       </A><BR>
    <I>Sun Dec  7 20:46:35 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="001027.html">[squid-users] https issues for google
</A></li>
        <LI>Next message (by thread): <A HREF="001034.html">[squid-users] https issues for google
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1031">[ date ]</a>
              <a href="thread.html#1031">[ thread ]</a>
              <a href="subject.html#1031">[ subject ]</a>
              <a href="author.html#1031">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi All and Amos,

Thanks for correcting me on thinking that was an error.

Even though squid is logging TCP_200, the browser states the proxy server is not responding. This is again only with secure sites, mainly google sites. It is fairly reproducible now with google mail.

On IE, the error is :the proxy server is not responding&quot;
On Chrome: &quot;ERR_SSL_PROTOCOL_ERROR&quot;
On Firefox &quot;ssl_error_rx_record_too_long&quot;

If I bypass the proxy and go direct to the internet through our firewall, it works fine.

This suggests to me, without having any errors in squid to go by, that squid is doing something to the SSL record. What can I do to try and fix or diagnose? 

Thanks,

Glenn

-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Amos Jeffries
Sent: Sunday, 7 December 2014 7:34 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] https issues for google

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 7/12/2014 9:48 p.m., glenn.groves wrote:
&gt;<i> Hi All,
</I>&gt;<i> 
</I>&gt;<i> I have finally been able to spend time upgrading a server to a later 
</I>&gt;<i> squid version, I have tried 3.4.9.
</I>&gt;<i> 
</I>&gt;<i> I could not get authentication to work for this test, but proceeded to 
</I>&gt;<i> test without (also dismisses auth as the problem).
</I>&gt;<i> 
</I>&gt;<i> I am getting the following in the logs with secure sites now the squid 
</I>&gt;<i> is 3.4.9:
</I>&gt;<i> 
</I>&gt;<i> 192.168.9.69 TCP_MISS/200 295 CONNECT www.google.com:443 -
</I>&gt;<i> HIER_DIRECT/216.58.220.1 192.168.9.69 TCP_MISS/200 0 CONNECT
</I>&gt;<i> www.google.com:443 - HIER_DIRECT/216.58.220.132
</I>&gt;<i> 
</I>&gt;<i> Upgrading to 3.4.9 on Centos as been a pain so far, no point in 
</I>&gt;<i> proceeding with the problem persisting. Can someone advise why I am 
</I>&gt;<i> getting TCP_MISS/200 when going to secure google sites?
</I>&gt;<i> 
</I>
&quot;200&quot; because the tunnel was setup successfully.

&quot;TCP_MISS&quot; because a connection being opened does not use an existing cache object. Old Squid versions do not use the TCP_TUNNEL label.

The above appear to be successful tunnels setup through the proxy.


&gt;<i> Or more importantly, how to fix my squid 3.1 on centos 6.5 with this 
</I>&gt;<i> problem.
</I>&gt;<i> 
</I>
What browser(s) are showing the problem? and what does a tcpdump trace of the packets content show happening?

A) It could be they are trying to use SPDY or HTTP/2 inside the tunnel. CONNECT technically could be followed immediately with traffic bytes even though the tunnel/Upgrade process was not confirmed successful by the proxy. Squid does not support that behaviour until version 3.4.5 (bug 3371) but browsers using SPDY and HTTP/2 rely on it.

You may be able to backport the bug fix
(<A HREF="http://www.squid-cache.org/Versions/v3/3.4/changesets/squid-3.4-13126.patch">http://www.squid-cache.org/Versions/v3/3.4/changesets/squid-3.4-13126.patch</A>),
but this is one unlikely to be easy across so many versions. There have been numerous tunneling code updates in between.


B) It could be happy-eyeballs algorithm being used by the browser.
Settign up a connection in advance and having it timeout in the proxy before an attempt to actually use it is made. Although Squid should append _TIMEOUT to the MISS tag in those cases its not certain if that happens on tunnels.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUhB8iAAoJELJo5wb/XPRjfsIH/jFvpT7a/lHZfM8uaMxoUVu4
oGLoyjx6m1ZEg/W5Ta+TjlnfJjcyqfZdkHeIJzY9athcAWaxcT/By2sFEhuPqdtJ
hbps9UWbcae3Uu8sL71oABPnNvfH23HpU6q3PBrNRv82K8jrFjS56oEFwCQrKavP
pxfirbNk0MZg9/bLDAGnD05ItKAxo+uQ2xQU0AE/z6z3LE23WaMS4axTNLBS2icP
V9y2D90mH35nMlaFkhSPl1oL8HfQ1yOuKoNJz2YSgIsgiEmGBsF9aRQ+FS1CgiSh
HFFDyY+dAQUOFL9Qv/gJjddWhQAqH3X6kjqUCqgzqp+eHCOfrQGWzG6Wv42X7/k=
=P6Ev
-----END PGP SIGNATURE-----
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
 
This message (including any attachments) is confidential and may be legally privileged. If you are not the intended recipient, you should not disclose, copy or use any part of it - please delete all copies immediately and notify the Bradnam Group Helpdesk at <A HREF="https://lists.squid-cache.org/listinfo/squid-users">helpdesk at bradnams.com.au</A> 

Any information, statements or opinions contained in this message (including any attachments) are given by the author. They are not given on behalf of the Bradnam Group unless subsequently confirmed by an individual other than the author who is duly authorised to represent the Bradnam Group (or any of its subsidiary and associate companies).

All sent and received email from/to the Bradnam Group (or any of its subsidiary and associate companies) is automatically scanned for the presence of computer viruses, security issues and inappropriate content.

For further information on the services which the Bradnam Group provides visit our web 
site(s) at www.bradnams.com.au or www.nationalglass.com.au

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="001027.html">[squid-users] https issues for google
</A></li>
	<LI>Next message (by thread): <A HREF="001034.html">[squid-users] https issues for google
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1031">[ date ]</a>
              <a href="thread.html#1031">[ thread ]</a>
              <a href="subject.html#1031">[ subject ]</a>
              <a href="author.html#1031">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
