<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Splicing a connection if server cert cannot be	verified
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Splicing%20a%20connection%20if%20server%20cert%20cannot%20be%0A%09verified&In-Reply-To=%3CBY2PR03MB364691B2198BC6B96D0E597D56F0%40BY2PR03MB364.namprd03.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001108.html">
   <LINK REL="Next"  HREF="001115.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Splicing a connection if server cert cannot be	verified</H1>
    <B>Soren Madsen (DREIJER)</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Splicing%20a%20connection%20if%20server%20cert%20cannot%20be%0A%09verified&In-Reply-To=%3CBY2PR03MB364691B2198BC6B96D0E597D56F0%40BY2PR03MB364.namprd03.prod.outlook.com%3E"
       TITLE="[squid-users] Splicing a connection if server cert cannot be	verified">sdreijer at microsoft.com
       </A><BR>
    <I>Mon Dec 15 19:11:08 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="001108.html">[squid-users] CVS mailing list
</A></li>
        <LI>Next message (by thread): <A HREF="001115.html">[squid-users] Splicing a connection if server cert cannot be verified
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1112">[ date ]</a>
              <a href="thread.html#1112">[ thread ]</a>
              <a href="subject.html#1112">[ subject ]</a>
              <a href="author.html#1112">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

By default, I want to bump all connections through my Squid instance. However, while testing I've discovered lots of sites that use SSLv3 or self-signed certificates, in which case I'd like to fall back to TLS passthrough mode and let the client decide whether it wants to trust the server or not. In other words, if Squid cannot successfully bump a connection, I don't want to fail the connection, but rather step out of the way and let the client decide what to do.

The ideal solution, I think, would be to optimistically attempt to bump the connection, but if it fails due to e.g. a bad server cert, a new connection can be established with the original client hello.

I was hoping the new peek and splice functionality would be able to help me in this regard:
<A HREF="http://wiki.squid-cache.org/Features/SslPeekAndSplice">http://wiki.squid-cache.org/Features/SslPeekAndSplice</A>

As far as I can tell, the 'stare' action is what I'm interested in here although it appears it's not a focus of the current implementation, and the 'peek' action has the following limitation note about 'Peeking at the server often precludes bumping':
&quot;We could teach Squid to abandon the current server connection and then bump a newly open one. This is something we do not want to do as it is likely to create an even worse operational problems with Squids being auto-blocked for opening and closing connections in vein.&quot;

I'm confused about this. Couldn't Squid just cache the information about whether it has previously refrained from bumping a connection due to a bad server cert (or other errors) and only check with the server once the cache expires? That should avoid triggering any alarms on the server. 

Maybe I'm misreading the document. I was hoping somebody here on the list could explain to me if I can achieve the above behavior.

Thanks!

/ Soren

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="001108.html">[squid-users] CVS mailing list
</A></li>
	<LI>Next message (by thread): <A HREF="001115.html">[squid-users] Splicing a connection if server cert cannot be verified
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1112">[ date ]</a>
              <a href="thread.html#1112">[ thread ]</a>
              <a href="subject.html#1112">[ subject ]</a>
              <a href="author.html#1112">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
