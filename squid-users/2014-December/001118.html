<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ICAP: how to get port of X-Client-IP
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%3D%3Futf-8%3Fq%3FICAP%3D3A_how_to_get_port_of_X-Client-IP%3F%3D&In-Reply-To=%3C1418719742.490807966%40f228.i.mail.ru%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001106.html">
   <LINK REL="Next"  HREF="001121.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ICAP: how to get port of X-Client-IP</H1>
    <B>Alexander Bubnov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%3D%3Futf-8%3Fq%3FICAP%3D3A_how_to_get_port_of_X-Client-IP%3F%3D&In-Reply-To=%3C1418719742.490807966%40f228.i.mail.ru%3E"
       TITLE="[squid-users] ICAP: how to get port of X-Client-IP">alexander.bubnov at bk.ru
       </A><BR>
    <I>Tue Dec 16 08:49:02 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="001106.html">[squid-users] ICAP: how to get port of X-Client-IP
</A></li>
        <LI>Next message (by thread): <A HREF="001121.html">[squid-users] ICAP: how to get port of X-Client-IP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1118">[ date ]</a>
              <a href="thread.html#1118">[ thread ]</a>
              <a href="subject.html#1118">[ subject ]</a>
              <a href="author.html#1118">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hello Amos!
Glad to get your answer!


1. I have tried to use %&gt;p specifier for adaptation_meta directive. But it seems does not work that way I used it.
I specified it in squid.conf:

adaptation_meta X-CLIENT-SRCPORT %&gt;p

I found that specifier ony in logformat. May be you mixed it up?

2. About mapping port transparently. How does it help to get (at least) mapped port number in ICAP?

3. I would like to track any software. Especially software which use &quot;User Agent&quot; field not&#160; legitimately or event does not fill it at all.


--
/BR, Alexander

Mon, 15 Dec 2014 17:32:34 +1300 &#1086;&#1090; Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;:
&gt;<i>-----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i>Hash: SHA1
</I>&gt;<i>
</I>&gt;<i>On 13/12/2014 9:09 a.m., &#1040;&#1083;&#1077;&#1082;&#1089;&#1072;&#1085;&#1076;&#1088; &#1041;&#1091;&#1073;&#1085;&#1086;&#1074; wrote:
</I>&gt;&gt;<i> I do not need to map it back remotely. I just need to know it. One
</I>&gt;&gt;<i> of my applications collects logs about all connections on a desktop
</I>&gt;&gt;<i> PC and another (ICAP server) collects what that applications sends
</I>&gt;&gt;<i> to the Internet. And to know that traffic belongs to certain
</I>&gt;&gt;<i> application I need to know port of the application on a desktop
</I>&gt;&gt;<i> PC.
</I>&gt;<i>
</I>&gt;<i>You could try using the adaptation_meta directive to add a custom
</I>&gt;<i>header with %&gt;p as the value parameter. I'm not sure if that will send
</I>&gt;<i>a port number though.
</I>&gt;<i>&#160;&#160; <A HREF="http://www.squid-cache.org/Doc/config/adaptation_meta/">http://www.squid-cache.org/Doc/config/adaptation_meta/</A>
</I>&gt;<i>
</I>&gt;<i>There is near zero reliability that the port number outgoing from the
</I>&gt;<i>client is the same number incoming to Squid. There are numerous
</I>&gt;<i>potential layers of protocol and machinery re-numbering ports
</I>&gt;<i>transparently between any two devices.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>The name of the client application is supposed to be sent in the
</I>&gt;<i>User-Agent: HTTP header which gets delivered to ICAP already. For most
</I>&gt;<i>legitimate uses of agent-sniffing UA header + IP is sufficient
</I>&gt;<i>information.
</I>&gt;<i>
</I>&gt;<i>Amos
</I>&gt;<i>
</I>&gt;<i>-----BEGIN PGP SIGNATURE-----
</I>&gt;<i>Version: GnuPG v2.0.22 (MingW32)
</I>&gt;<i>
</I>&gt;<i>iQEcBAEBAgAGBQJUjmRiAAoJELJo5wb/XPRj9skH/i6rlp7XmNptgfn/VgKtgH+v
</I>&gt;<i>D22idQBsXyTC00LN2UQssz6Hrpk7nvK96dKObtSppJQ8Xtu1NrrPG1uSq1plRgBT
</I>&gt;<i>d5EXRYnAMttTbI5KVDdXW6IsFSjTkL2Hr1m244BEv7SRUBNaa67XPpDjucoIX2kP
</I>&gt;<i>8eIKZrB32jaW3/t2VDIl67iRKOZQh3DZfFqFrU6BgZCrLXjZXU/629+KBVnvNg/A
</I>&gt;<i>TEnYXDBOSRwRVsWuLK/o0bZFI7y6wp0jtRT1ETliUpmdbGKKPSnMWLym2FX5VI+d
</I>&gt;<i>8B1BSzbjEAP+sWex2oKE5Z7+FQ+eSf2tYLvS15fqAHe09hKqpJTMur4cumdkRM0=
</I>&gt;<i>=LgMG
</I>&gt;<i>-----END PGP SIGNATURE-----
</I>&gt;<i>_______________________________________________
</I>&gt;<i>squid-users mailing list
</I>&gt;<i><A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i><A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20141216/0b15bd7f/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20141216/0b15bd7f/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="001106.html">[squid-users] ICAP: how to get port of X-Client-IP
</A></li>
	<LI>Next message (by thread): <A HREF="001121.html">[squid-users] ICAP: how to get port of X-Client-IP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1118">[ date ]</a>
              <a href="thread.html#1118">[ thread ]</a>
              <a href="subject.html#1118">[ subject ]</a>
              <a href="author.html#1118">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
