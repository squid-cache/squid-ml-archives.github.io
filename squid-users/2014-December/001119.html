<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] 'cache' config option and rewrite
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%27cache%27%20config%20option%20and%20rewrite&In-Reply-To=%3CHKNPR04MB1935709C271DBDE86DE7BD9E86C0%40HKNPR04MB193.apcprd04.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001117.html">
   <LINK REL="Next"  HREF="001120.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] 'cache' config option and rewrite</H1>
    <B>James Harper</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%27cache%27%20config%20option%20and%20rewrite&In-Reply-To=%3CHKNPR04MB1935709C271DBDE86DE7BD9E86C0%40HKNPR04MB193.apcprd04.prod.outlook.com%3E"
       TITLE="[squid-users] 'cache' config option and rewrite">james at ejbdigital.com.au
       </A><BR>
    <I>Tue Dec 16 10:01:06 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="001117.html">[squid-users] squid_ldap_auth: WARNING,	could not bind to binddn 'Invalid credentials'
</A></li>
        <LI>Next message (by thread): <A HREF="001120.html">[squid-users] 'cache' config option and rewrite
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1119">[ date ]</a>
              <a href="thread.html#1119">[ thread ]</a>
              <a href="subject.html#1119">[ subject ]</a>
              <a href="author.html#1119">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have a rewrite rule so that any request for a list of apt repositories (acl dstdomain) are rewritten to instead go to my apt-cacher server, and then a &quot;cache deny&quot; rule to make sure squid doesn't cache files from these repositories. This seemed to be working fine but my latest attempt at a debian install kept failing because the gpg signature didn't match. It turns that that squid was actually caching these requests, which is the opposite of what I wanted as it meant that the sig and the file got out of sync (I guess apt-cacher doesn't return a proper indication of what is allowed to be cached and what isn't... so the sig was cached but the file wasn't, or something like that)

It turns out that &quot;cache deny &lt;dstdomain acl&gt;&quot; is processed after the rewrite, and against the rewritten url, so I needed to also exclude requests for my server running apt-cacher.

So for example:

acl apt_repo dstdomain ftp.au.debian.org
acl apt_cacher browser apt-cacher # apt-cacher itself

cache deny apt_repo
cache deny apt_cacher
cache allow all

but I needed to add:

acl apt_repo dstdomain my.apt.cacher.server

This is kind of obvious in retrospect, but is it described anywhere which rules apply against the url before it is rewritten and which are applied to the rewritten url?

Thanks

James

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="001117.html">[squid-users] squid_ldap_auth: WARNING,	could not bind to binddn 'Invalid credentials'
</A></li>
	<LI>Next message (by thread): <A HREF="001120.html">[squid-users] 'cache' config option and rewrite
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1119">[ date ]</a>
              <a href="thread.html#1119">[ thread ]</a>
              <a href="subject.html#1119">[ subject ]</a>
              <a href="author.html#1119">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
