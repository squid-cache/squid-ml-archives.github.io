<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3.4.10 incorrectly configured on Solaris 10
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.4.10%20incorrectly%20configured%20on%20Solaris%2010&In-Reply-To=%3C54942BFF.1080608%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001153.html">
   <LINK REL="Next"  HREF="001165.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3.4.10 incorrectly configured on Solaris 10</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.4.10%20incorrectly%20configured%20on%20Solaris%2010&In-Reply-To=%3C54942BFF.1080608%40gmail.com%3E"
       TITLE="[squid-users] Squid 3.4.10 incorrectly configured on Solaris 10">yvoinov at gmail.com
       </A><BR>
    <I>Fri Dec 19 13:45:35 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="001153.html">[squid-users] Squid 3.4.10 incorrectly configured on Solaris 10
</A></li>
        <LI>Next message (by thread): <A HREF="001165.html">[squid-users] Squid 3.4.10 incorrectly configured on Solaris 10
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1162">[ date ]</a>
              <a href="thread.html#1162">[ thread ]</a>
              <a href="subject.html#1162">[ subject ]</a>
              <a href="author.html#1162">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
If i do durty hack with editing these includes (ip_compat.h or
ip_nat.h), configuration went ok,
but build interceptor has errors and squid cannot be build.

Also, squid 3.4.8 in OpenCSW repository (built with ipf transparent
option) also cannot work in transparent mode.

So, need help - I need transparent proxy, not forwarding.

2.7 is too obsolete and contains strange bug (sometimes dies with fatal
error when high load).

Change OS is not an option.

WBR, Yuri

18.12.2014 20:11, Kinkie ?????:
&gt;<i> Hello Yuri,
</I>&gt;<i>   this is probably a system header dependency.
</I>&gt;<i> Could you check if the manuals mention anything about ipfmutex_t ? If
</I>&gt;<i> they do, at the beginning of the page they should include a list of
</I>&gt;<i> #include &lt;...&gt; lines. Could you copy-paste these lines here?
</I>&gt;<i>
</I>&gt;<i> Thanks
</I>&gt;<i>
</I>&gt;<i> On Thu, Dec 18, 2014 at 3:01 PM, Yuri Voinov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;<i> Hi there,
</I>&gt;<i>
</I>&gt;<i> yesterday (and during last four day) I've try to build transparent
</I>&gt;<i> caching proxy on Solaris 10 (x86_64) testing environment.
</I>&gt;<i>
</I>&gt;<i> Configuration options are:
</I>&gt;<i>
</I>&gt;<i> # Without SSL 64 bit GCC
</I>&gt;<i> ./configure '--prefix=/usr/local/squid' '--enable-translation'
</I>&gt;<i> '--enable-external-acl-helpers=file_userip,unix_group'
</I>&gt;<i> '--enable-icap-client' '--enable-ipf-transparent'
</I>&gt;<i> '--enable-storeio=diskd' '--enable-removal-policies=lru,heap'
</I>&gt;<i> '--enable-devpoll' '--disable-wccp' '--enable-wccpv2'
</I>&gt;<i> '--enable-http-violations' '--enable-follow-x-forwarded-for'
</I>&gt;<i> '--enable-arp-acl' '--enable-htcp' '--enable-cache-digests' '--with-dl'
</I>&gt;<i> '--enable-auth-negotiate=none' '--disable-auth-digest'
</I>&gt;<i> '--disable-auth-ntlm' '--disable-auth-basic'
</I>&gt;<i> '--enable-storeid-rewrite-helpers=file'
</I>&gt;<i> '--enable-log-daemon-helpers=file' '--with-filedescriptors=131072'
</I>&gt;<i> '--with-build-environment=POSIX_V6_LP64_OFF64' 'CFLAGS=-O3 -m64 -fPIE
</I>&gt;<i> -fstack-protector -mtune=core2 --param=ssp-buffer-size=4 -pipe'
</I>&gt;<i> 'CXXFLAGS=-O3 -m64 -fPIE -fstack-protector -mtune=core2
</I>&gt;<i> --param=ssp-buffer-size=4 -pipe' 'CPPFLAGS=-I/usr/include
</I>&gt;<i> -I/opt/csw/include' 'LDFLAGS=-fPIE -pie -Wl,-z,now'
</I>&gt;<i>
</I>&gt;<i> But binaries built without interceptor support.
</I>&gt;<i>
</I>&gt;<i> Some investigation:
</I>&gt;<i>
</I>&gt;<i> Config.log has errors with ip_nat.h compilation:
</I>&gt;<i>
</I>&gt;<i> configure:27435: checking for netinet/ip_nat.h
</I>&gt;<i> configure:27435: g++ -c -m64 -O3 -m64 -fPIE -fstack-protector
</I>&gt;<i> -mtune=core2 --param=ssp-buffer-size=4 -pipe -march=native -std=c++11
</I>&gt;<i> -I/usr/include -I/opt/csw/include -I/usr/include/gssapi
</I>&gt;<i> -I/usr/include/kerberosv5 conftest.cpp &gt;&amp;5
</I>&gt;<i> In file included from conftest.cpp:266:0:
</I>&gt;<i>
</I>/opt/csw/lib/gcc/i386-pc-solaris2.10/4.9.2/include-fixed/netinet/ip_nat.h:98:2:
&gt;<i> error: 'ipfmutex_t' does not name a type
</I>&gt;<i>   ipfmutex_t nat_lock;
</I>&gt;<i>   ^
</I>&gt;<i>
</I>/opt/csw/lib/gcc/i386-pc-solaris2.10/4.9.2/include-fixed/netinet/ip_nat.h:108:2:
&gt;<i> error: 'frentry_t' does not name a type
</I>&gt;<i>   frentry_t *nat_fr; /* filter rule ptr if appropriate */
</I>&gt;<i>   ^
</I>&gt;<i>
</I>/opt/csw/lib/gcc/i386-pc-solaris2.10/4.9.2/include-fixed/netinet/ip_nat.h:112:2:
&gt;<i> error: 'ipftqent_t' does not name a type
</I>&gt;<i>   ipftqent_t nat_tqe;
</I>&gt;<i>   ^
</I>&gt;<i>
</I>/opt/csw/lib/gcc/i386-pc-solaris2.10/4.9.2/include-fixed/netinet/ip_nat.h:113:2:
&gt;<i> error: 'u_32_t' does not name a type
</I>&gt;<i>   u_32_t  nat_flags;
</I>&gt;<i>   ^
</I>&gt;<i>
</I>/opt/csw/lib/gcc/i386-pc-solaris2.10/4.9.2/include-fixed/netinet/ip_nat.h:114:2:
&gt;<i> error: 'u_32_t' does not name a type
</I>&gt;<i>   u_32_t  nat_sumd[2]; /* ip checksum delta for data segment */
</I>&gt;<i>   ^
</I>&gt;<i>
</I>/opt/csw/lib/gcc/i386-pc-solaris2.10/4.9.2/include-fixed/netinet/ip_nat.h:115:2:
&gt;<i> error: 'u_32_t' does not name a type
</I>&gt;<i>   u_32_t  nat_ipsumd; /* ip checksum delta for ip header */
</I>&gt;<i>   ^
</I>&gt;<i>
</I>/opt/csw/lib/gcc/i386-pc-solaris2.10/4.9.2/include-fixed/netinet/ip_nat.h:116:2:
&gt;<i> error: 'u_32_t' does not name a type
</I>&gt;<i>   u_32_t  nat_mssclamp; /* if != zero clamp MSS to this */
</I>&gt;<i>   ^
</I>&gt;<i>
</I>/opt/csw/lib/gcc/i386-pc-solaris2.10/4.9.2/include-fixed/netinet/ip_nat.h:117:2:
&gt;<i> error: 'i6addr_t' does not name a type
</I>&gt;<i>   i6addr_t nat_inip6;
</I>&gt;<i>
</I>&gt;<i> and so, configure does not see IP Filter finally, ergo cannot build
</I>&gt;<i> interceptor.
</I>&gt;<i>
</I>&gt;<i> Yes, IP Filter installed in system. Yes, I've try to build 32 bit also.
</I>&gt;<i> Yes, I've try to build on another system. Yes, I've try to play with
</I>&gt;<i> configure option. Yes, I've try also development version 3.5.x - with
</I>&gt;<i> the same result.
</I>&gt;<i>
</I>&gt;<i> Amos, need your help.
</I>&gt;<i>
</I>&gt;<i> Thanks in advance,
</I>&gt;<i>
</I>&gt;<i> WBR, Yuri
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUlCv/AAoJENNXIZxhPexGyYUH/jl6MeJZcF/Krw+nYL/okEO6
YAH0k+zk/p2uhXARenFNXpoTJkUwi1yoOFrmCgo2sgw9wmEk418OGKTii+JgDh2L
ZpI0pvGhmkX84bbFuyU4SkXRi+NZAcR0gJRfCra7itibeDvJ7DlOm2pxuteLXqdz
EduGcMI8l2jmVf6Ib3CVKfYNXPMhJiPmIkXuPCfms+T2CLFuGRvrwoM44SjKra8e
vADuIBJkUF6kg0psz3GmNQLm2NLqusB8yt7kF0/WecK5OkeIGXI5JY+jJrGkrnI1
UtRau1AsxqVz9gWsptArUwWVfBazxYZNk73/4PI5MqQTtVJ8ilOAjn1WxnImTaQ=
=PGXC
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20141219/3015aa7f/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20141219/3015aa7f/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="001153.html">[squid-users] Squid 3.4.10 incorrectly configured on Solaris 10
</A></li>
	<LI>Next message (by thread): <A HREF="001165.html">[squid-users] Squid 3.4.10 incorrectly configured on Solaris 10
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1162">[ date ]</a>
              <a href="thread.html#1162">[ thread ]</a>
              <a href="subject.html#1162">[ subject ]</a>
              <a href="author.html#1162">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
