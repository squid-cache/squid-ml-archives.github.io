<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid with ldp authentication and with squidguard	based on ldp group
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20with%20ldp%20authentication%20and%20with%20squidguard%0A%09based%20on%20ldp%20group&In-Reply-To=%3C001d01d01d4e%248caa9af0%24a5ffd0d0%24%40netstream.ps%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001201.html">
   <LINK REL="Next"  HREF="001204.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid with ldp authentication and with squidguard	based on ldp group</H1>
    <B>Ahmed Allzaeem</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20with%20ldp%20authentication%20and%20with%20squidguard%0A%09based%20on%20ldp%20group&In-Reply-To=%3C001d01d01d4e%248caa9af0%24a5ffd0d0%24%40netstream.ps%3E"
       TITLE="[squid-users] squid with ldp authentication and with squidguard	based on ldp group">ahmed.zaeem at netstream.ps
       </A><BR>
    <I>Sun Dec 21 18:47:18 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="001201.html">[squid-users] [squid-announce] Squid 3.5.0.4 beta is available
</A></li>
        <LI>Next message (by thread): <A HREF="001204.html">[squid-users] what are people using nowadays (icap, a/v, etc)?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1199">[ date ]</a>
              <a href="thread.html#1199">[ thread ]</a>
              <a href="subject.html#1199">[ subject ]</a>
              <a href="author.html#1199">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The problem is that squidguard is not filtering anything!!!

 

The ldp work for suthentication , I mean I can login from users in the DC ,
but all users has full permsions !!

 

I created group called &quot;level2&quot; and gave it to some users , but that users
still has full permission and not being filtered from anything !!

This is os is pfsense on freebsd

 

 

I will post config below :

===========================

 

Here is config

# This file is automatically generated by pfSense

# Do not edit manually !

http_port 10.0.0.1:3128

icp_port 7

dns_v4_first off

pid_filename /var/run/squid.pid

cache_effective_user proxy

cache_effective_group proxy

error_default_language en

icon_directory /usr/pbi/squid-i386/etc/squid/icons

visible_hostname pfsense

cache_mgr <A HREF="https://lists.squid-cache.org/listinfo/squid-users">admin at localhost</A>

access_log /var/squid/logs/access.log

cache_log /var/squid/logs/cache.log

cache_store_log none

sslcrtd_children 0

logfile_rotate 0

shutdown_lifetime 3 seconds

# Allow local network(s) on interface(s)

acl localnet src  10.0.0.0/24

forwarded_for off

uri_whitespace strip

 

acl dynamic urlpath_regex cgi-bin ?

cache deny dynamic

cache_mem 8 MB

maximum_object_size_in_memory 32 KB

memory_replacement_policy heap GDSF

cache_replacement_policy heap LFUDA

 

minimum_object_size 0 KB

maximum_object_size 10 KB

offline_mode off

# No redirector configured

 

 

#Remote proxies

 

 

# Setup some default acls

acl allsrc src all

acl localhost src 127.0.0.1/32

acl safeports port 21 70 80 210 280 443 488 563 591 631 777 901  3128
1025-65535 

acl sslports port 443 563  

acl manager proto cache_object

acl purge method PURGE

acl connect method CONNECT

 

# Define protocols used for redirects

acl HTTP proto HTTP

acl HTTPS proto HTTPS

 

http_access allow manager localhost

  

http_access deny manager

http_access allow purge localhost

http_access deny purge

http_access deny !safeports

http_access deny CONNECT !sslports

 

# Always allow localhost connections

http_access allow localhost

 

request_body_max_size 0 KB

delay_pools 1

delay_class 1 2

delay_parameters 1 -1/-1 -1/-1

delay_initial_bucket_level 100

delay_access 1 allow allsrc

 

# Reverse Proxy settings

 

 

# Package Integration

auth_param basic program /usr/pbi/squid-i386/libexec/squid/squid_ldap_auth
-P -R -b 'dc=smart,dc=ps' -D 'cn=administrator,cn=Users,dc=smart,dc=ps' -w
'<A HREF="https://lists.squid-cache.org/listinfo/squid-users">admin at 123</A>' -f sAMAccountName=%s -h 192.168.1.242

auth_param basic children 100

auth_param basic realm heyyyyy

auth_param basic credentialsttl 1 hour

acl password proxy_auth REQUIRED

redirect_program /usr/pbi/squidguard-i386/bin/squidGuard -c
/usr/pbi/squidguard-i386/etc/squidGuard/squidGuard.conf

redirector_bypass off

url_rewrite_children 5

 

# Custom options

http_access allow password

 

# Setup allowed acls

# Allow local network(s) on interface(s)

http_access allow localnet

# Default block all to be sure

http_access deny allsrc

 

 

 

 

# ============================================================

# SquidGuard configuration file

# This file generated automaticly with SquidGuard configurator

# (C)2006 Serg Dvoriancev

# email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">dv_serg at mail.ru</A>

# ============================================================

 

logdir /var/squidGuard/log

dbhome /var/db/squidGuard

ldapbinddn cn=administrator,cn=Users,dc=smart,dc=ps

ldapbindpass <A HREF="https://lists.squid-cache.org/listinfo/squid-users">admin at 123</A>

ldapprotover 2

stripntdomain true

 

# 

src zozo {

                ldapusersearch
<A HREF="ldap://192.168.1.242/DC=smart,DC=ps?sAMAccountName?sub?(&amp;(sAMAccountName=%s">ldap://192.168.1.242/DC=smart,DC=ps?sAMAccountName?sub?(&amp;(sAMAccountName=%s</A>)
(memberOf=CN=level2%2cCN=Users%2cDC=smart%2cDC=ps))

                log block.log

}

 

 

# 

rew safesearch {

                s@(google..*/search?.*q=.*)@&amp;safe=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">active at i</A>

                s@(google..*/images.*q=.*)@&amp;safe=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">active at i</A>

                s@(google..*/groups.*q=.*)@&amp;safe=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">active at i</A>

                s@(google..*/news.*q=.*)@&amp;safe=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">active at i</A>

                s@(yandex..*/yandsearch?.*text=.*)@&amp;fyandex=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">1 at i</A>

                s@(search.yahoo..*/search.*p=.*)@&amp;vm=r&amp;v=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">1 at i</A>

                s@(search.live..*/.*q=.*)@&amp;adlt=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">strict at i</A>

                s@(search.msn..*/.*q=.*)@&amp;adlt=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">strict at i</A>

                s@(.bing..*/.*q=.*)@&amp;adlt=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">strict at i</A>

                log block.log

}

 

# 

acl  {

                # 

                zozo  {

                                pass !in-addr !blk_BL_adv !blk_BL_aggressive
!blk_BL_alcohol !blk_BL_anonvpn !blk_BL_automobile_bikes
!blk_BL_automobile_boats !blk_BL_automobile_cars !blk_BL_downloads
!blk_BL_movies !blk_BL_porn !blk_BL_sex_education !blk_BL_sex_lingerie none

                                redirect
<A HREF="http://10.0.0.1:80/sgerror.php?url=403%20&amp;a=%a&amp;n=%n&amp;i=%i&amp;s=%s&amp;t=%t&amp;u=%u">http://10.0.0.1:80/sgerror.php?url=403%20&amp;a=%a&amp;n=%n&amp;i=%i&amp;s=%s&amp;t=%t&amp;u=%u</A>

                                log block.log

                }

                # 

                default  {

                                pass !blk_BL_porn !blk_BL_searchengines
!blk_BL_sex_education !blk_BL_sex_lingerie !blk_BL_shopping none

                                redirect
<A HREF="http://10.0.0.1:80/sgerror.php?url=403%20KKKK&amp;a=%a&amp;n=%n&amp;i=%i&amp;s=%s&amp;t=%t&amp;u=%u">http://10.0.0.1:80/sgerror.php?url=403%20KKKK&amp;a=%a&amp;n=%n&amp;i=%i&amp;s=%s&amp;t=%t&amp;u=%u</A>

                                rewrite safesearch

                                log block.log

                }

}

 

 

 

 

 

Any idea why suqidguard is not blocking anything ??? 

 

cheers

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20141221/dd9fe918/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20141221/dd9fe918/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="001201.html">[squid-users] [squid-announce] Squid 3.5.0.4 beta is available
</A></li>
	<LI>Next message (by thread): <A HREF="001204.html">[squid-users] what are people using nowadays (icap, a/v, etc)?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1199">[ date ]</a>
              <a href="thread.html#1199">[ thread ]</a>
              <a href="subject.html#1199">[ subject ]</a>
              <a href="author.html#1199">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
