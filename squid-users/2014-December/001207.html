<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3.4.10 startup/shutdown core dumps
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.4.10%20startup/shutdown%20core%20dumps&In-Reply-To=%3C54982BEA.4080703%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001209.html">
   <LINK REL="Next"  HREF="001208.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3.4.10 startup/shutdown core dumps</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.4.10%20startup/shutdown%20core%20dumps&In-Reply-To=%3C54982BEA.4080703%40gmail.com%3E"
       TITLE="[squid-users] Squid 3.4.10 startup/shutdown core dumps">yvoinov at gmail.com
       </A><BR>
    <I>Mon Dec 22 14:34:18 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="001209.html">[squid-users] Question
</A></li>
        <LI>Next message (by thread): <A HREF="001208.html">[squid-users] Squid 3.4.10 startup/shutdown core dumps
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1207">[ date ]</a>
              <a href="thread.html#1207">[ thread ]</a>
              <a href="subject.html#1207">[ subject ]</a>
              <a href="author.html#1207">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Hi gents,

I run subj on testing environment in transparent mode under Solaris 10
and have a bit questions. ;)

1. Squid 3 must absolutely run from root (and drops privilegies to user
squid createrd first) under Solaris 10. It absolutely can't work in
transparent when run from squid with NAT permission denied error. That
is ok, no problem.

2. When it run as root, all works like charm, but:

when startup/shutdown it write in system log (/var/adm/messages):

ec 22 20:22:24 fhtagn genunix: [ID 603404 kern.notice] NOTICE: core_log:
squid[53415] core dumped: /var/core/core.squid.53415
Dec 22 20:22:31 fhtagn genunix: [ID 603404 kern.notice] NOTICE:
core_log: squid[53377] core dumped: /var/core/core.squid.53377
Dec 22 20:22:33 fhtagn genunix: [ID 603404 kern.notice] NOTICE:
core_log: squid[53375] core dumped: /var/core/core.squid.53375
Dec 22 20:22:35 fhtagn genunix: [ID 603404 kern.notice] NOTICE:
core_log: squid[53450] core dumped: /var/core/core.squid.53450

four times on every startup/shutdown (counted by my cache_dir's - I have
four).

In core dump I see next stack:

mdb core.squid.53450
Loading modules: [ ld.so.1 libc.so.1 libuutil.so.1 ]
&gt;<i> ::stack
</I>_ZN10Adaptation10AccessRuleD1Ev+0x15()
_ZN10Adaptation6Config10FreeAccessEv+0x52()
_ZN10Adaptation6Config11freeServiceEv+0x11()
_ZN10Adaptation6ConfigD1Ev+0x1f()
0x7e9280()
0x517327()
_fini+9()
libc.so.1`_exithandle+0x3b()
libc.so.1`exit+0x11()
_Z9SquidMainiPPc+0x991()
main+0xc()
_start+0x6c()
&gt;<i>
</I>
This dump is produced when Squid runs by own user. I don't know, what
thie means ;)

When runs as root, the dump is not produced with next messages in system
log:

Dec 22 20:16:07 fhtagn genunix: [ID 603404 kern.notice] NOTICE:
core_log: squid[52387] setid process, core not dumped:
/var/core/core.squid.52387
Dec 22 20:16:13 fhtagn genunix: [ID 603404 kern.notice] NOTICE:
core_log: squid[48867] setid process, core not dumped:
/var/core/core.squid.48867
Dec 22 20:16:13 fhtagn genunix: [ID 603404 kern.notice] NOTICE:
core_log: squid[48865] setid process, core not dumped:
/var/core/core.squid.48865
Dec 22 20:16:14 fhtagn genunix: [ID 603404 kern.notice] NOTICE:
core_log: squid[52419] setid process, core not dumped:
/var/core/core.squid.52419

In cache.log the same time I've got fatal error AFTER shutdown:

2014/12/22 20:22:28 kid1| Open FD UNSTARTED     6 devpoll ctl
2014/12/22 20:22:28 kid1| Open FD UNSTARTED     7 DNS Socket IPv6
2014/12/22 20:22:28 kid1| Open FD UNSTARTED     8 DNS Socket IPv4
2014/12/22 20:22:28 kid1| Open FD UNSTARTED    11 IPC UNIX STREAM Parent
2014/12/22 20:22:28 kid1| Open FD UNSTARTED    17 squid -&gt; diskd
2014/12/22 20:22:28 kid1| Open FD UNSTARTED    21 squid -&gt; diskd
2014/12/22 20:22:28 kid1| Open FD UNSTARTED    25 squid -&gt; diskd
2014/12/22 20:22:28 kid1| Open FD UNSTARTED    29 squid -&gt; diskd
2014/12/22 20:22:28 kid1| Squid Cache (Version 3.4.10): Exiting normally.
FATAL: Received Segment Violation...dying.
2014/12/22 20:22:28 kid1| storeDirWriteCleanLogs: Starting...
2014/12/22 20:22:33 kid1| Set Current Directory to /var/core
2014/12/22 20:22:33 kid1| Starting Squid Cache version 3.4.10 for
i386-pc-solaris2.10...

BTW, squid works itself. All ok, interception working, helpers works
like charm.

But this errors in system log are annoying and badly looking on server
console. :)

What I'm doing wrong?

WBR, Yuri
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEbBAEBAgAGBQJUmCvqAAoJENNXIZxhPexGpR0H90AhbqPFbwS+++QC4MNRilEl
vGE+6rL2LHe8fvlutdlKKmovcocg8ODpb6eBCpWCk+KAmSTuJIii8LcORYpIVppa
wy1LIrz3kwL8p3vFV+DvxpYtOLQjU2D0pmiJE2b3UHlm3jHsbAhcjAn9KbdDhjOr
uDtsesej0NUzN2LXBFeo20uD5GDYTsZSipwE0/DFYEy+uJ08quJQk9IQTcfs1vFr
Mkx+ooBko/CA2Yy0s/4jS/W6s1tF3C/79VnKK88JOalXlm6M39T7DDQHD667diit
Qd8Cmv7ceEmWky2wfxJWeLpCJdHK7HGL4tYFXEzCAy3Oj1u/mjJjW123Oe+kBg==
=xwzb
-----END PGP SIGNATURE-----



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="001209.html">[squid-users] Question
</A></li>
	<LI>Next message (by thread): <A HREF="001208.html">[squid-users] Squid 3.4.10 startup/shutdown core dumps
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1207">[ date ]</a>
              <a href="thread.html#1207">[ thread ]</a>
              <a href="subject.html#1207">[ subject ]</a>
              <a href="author.html#1207">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
