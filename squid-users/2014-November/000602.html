<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Correctly implementing peak-splice
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Correctly%20implementing%20peak-splice&In-Reply-To=%3C5458AB2E.9060905%40chtsanti.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000593.html">
   <LINK REL="Next"  HREF="000603.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Correctly implementing peak-splice</H1>
    <B>Christos Tsantilas</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Correctly%20implementing%20peak-splice&In-Reply-To=%3C5458AB2E.9060905%40chtsanti.net%3E"
       TITLE="[squid-users] Correctly implementing peak-splice">christos at chtsanti.net
       </A><BR>
    <I>Tue Nov  4 10:32:14 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000593.html">[squid-users] Correctly implementing peak-splice
</A></li>
        <LI>Next message (by thread): <A HREF="000603.html">[squid-users] Correctly implementing peak-splice
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#602">[ date ]</a>
              <a href="thread.html#602">[ thread ]</a>
              <a href="subject.html#602">[ subject ]</a>
              <a href="author.html#602">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/03/2014 03:00 PM, James Lay wrote:
&gt;<i>
</I>&gt;<i> Thanks Christos,
</I>&gt;<i>
</I>&gt;<i> So here's where I'm at...my full test config below:
</I>&gt;<i> ......
</I>&gt;<i>......
</I>&gt;<i>
</I>&gt;<i> logformat common %&gt;a %[ui %[un [%tl] &quot;%rm %ru HTTP/%rv&quot; %&gt;Hs %&lt;st %Ss:%
</I>&gt;<i> Sh %ssl::&gt;cert_subject
</I>
The %ssl::&gt;cert_subject will print the subject of the client 
certificate, if there is any. In most cases the client does not sent any 
certificate.
Logging the server certificate subject is not yet implemented.

&gt;<i>
</I>&gt;<i> The above works, but allows all sites regardless of what's in url.txt.
</I>
If you want to use a list of urls to restrict sites which should bumped 
you should use an external_acl helper.
You can send to the external_acl helpers the client SNI informations (on 
at_step SslBump2) and/OR the server certificate subject (on at_step 
SslBump3).

&gt;<i> Additionally, there's no logging of any kind.  The allow part makes
</I>&gt;<i> sense as this is the last ACL, the no logging part is confusing.  If I
</I>&gt;<i> add:
</I>&gt;<i>
</I>&gt;<i> acl broken_sites dst 69.25.139.128/25
</I>&gt;<i> acl .....
</I> &gt; .....
&gt;<i> and change to
</I>&gt;<i> ssl_bump peek step1 broken_sites
</I>&gt;<i> ssl_bump peek step2 broken_sites
</I>&gt;<i> ssl_bump splice step3 broken_sites
</I>
This is will splice any connection to broken_sites and will not bump any 
other request.

&gt;<i>
</I>&gt;<i> that works, but again...I get no logging, which is worse then &quot;ssl_bump
</I>&gt;<i> splice broken_sites&quot;, and defeats the purpose of trying to avoid having
</I>&gt;<i> to create the broken_sites ACL in the first place.  Lastly, if I try and
</I>&gt;<i> change splice to peek or bump it's broken with odd log entries such as:
</I>
Will help if you describe what are you trying to do.
The acl broken_sites includes only IP addresses. Looks that the 
peek-and-splice is not needed in your application.
You can just use &quot;ssl_bump none broken_sites&quot;

&gt;<i>
</I>&gt;<i> Nov  3 05:45:23 gateway (squid-1): 192.168.1.110 - -
</I>&gt;<i> [03/Nov/2014:05:45:23 -0700] &quot;GET <A HREF="https://www.google.com/">https://www.google.com/</A> HTTP/1.1&quot; 503
</I>&gt;<i> 3854 TAG_NONE:HIER_NONE -
</I>&gt;<i> Nov  3 05:45:31 gateway (squid-1): 192.168.1.110 - -
</I>&gt;<i> [03/Nov/2014:05:45:31 -0700] &quot;CONNECT 206.190.36.45:443 HTTP/1.1&quot; 403
</I>&gt;<i> 3402 TCP_DENIED:HIER_NONE -
</I>&gt;<i> Nov  3 05:45:31 gateway (squid-1): 192.168.1.110 - -
</I>&gt;<i> [03/Nov/2014:05:45:31 -0700] &quot;#026#003#001 %BB/%CESsJ%B3%C2%BC%CC%BD%90
</I>&gt;<i> HTTP/1.1&quot; 400 3577 TAG_NONE:HIER_NONE -
</I>&gt;<i>
</I>&gt;<i> Is there something I am missing?  I've been really reading through the
</I>&gt;<i> squid site, but I can't find any examples of peek splice.  Thank you.
</I>&gt;<i>
</I>&gt;<i> James
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000593.html">[squid-users] Correctly implementing peak-splice
</A></li>
	<LI>Next message (by thread): <A HREF="000603.html">[squid-users] Correctly implementing peak-splice
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#602">[ date ]</a>
              <a href="thread.html#602">[ thread ]</a>
              <a href="subject.html#602">[ subject ]</a>
              <a href="author.html#602">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
