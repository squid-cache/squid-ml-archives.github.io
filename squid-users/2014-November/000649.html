<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid ACL, SSL-BUMP and authentication questions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20ACL%2C%20SSL-BUMP%20and%20authentication%20questions&In-Reply-To=%3C004d01cffa5f%24aae5d5a0%2400b180e0%24%40icshk.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000648.html">
   <LINK REL="Next"  HREF="000650.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid ACL, SSL-BUMP and authentication questions</H1>
    <B>squid at icshk.com</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20ACL%2C%20SSL-BUMP%20and%20authentication%20questions&In-Reply-To=%3C004d01cffa5f%24aae5d5a0%2400b180e0%24%40icshk.com%3E"
       TITLE="[squid-users] Squid ACL, SSL-BUMP and authentication questions">squid at icshk.com
       </A><BR>
    <I>Fri Nov  7 07:51:41 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000648.html">[squid-users] Squid ACL, SSL-BUMP and authentication questions
</A></li>
        <LI>Next message (by thread): <A HREF="000650.html">[squid-users] Squid ACL, SSL-BUMP and authentication questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#649">[ date ]</a>
              <a href="thread.html#649">[ thread ]</a>
              <a href="subject.html#649">[ subject ]</a>
              <a href="author.html#649">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

 

Sorry for my poor English. I think maybe I have figure out how to do this. Seems I need to explicitly specific allow &#8220;google&#8221; for &#8220;my_auth&#8221; users.

 

Add this:

http_access     allow   google                 my_auth

before

http_access     allow   my_auth                all

 

auth_param basic children 5

auth_param basic realm Welcome to Our Website!

auth_param basic program /usr/lib64/squid/basic_ncsa_auth /etc/squid/squid_user

auth_param basic credentialsttl 2 hours

auth_param basic casesensitive off

 

acl my_auth proxy_auth REQUIRED

 

acl SSL_ports port 443

acl Safe_ports port 443         # https

acl CONNECT method CONNECT

 

acl     GoogleMaps           url_regex -i    ^<A HREF="https://www.google.com/maps*.">https://www.google.com/maps*.</A>

acl     test_net                 src             192.168.1.253/32

acl     google                    dstdomain    www.google.com &lt;<A HREF="http://www.google.com">http://www.google.com</A>&gt; 

http_access deny CONNECT !SSL_ports

 

http_access     allow                           GoogleMaps

 

http_access     allow   CONNECT                 google

http_access     deny    CONNECT                 google                 my_auth

#http_access    allow   CONNECT                 test_net                 google

 

http_access     allow   google                 my_auth

http_access     allow   my_auth                all

 

http_access     deny                            all

 

 

From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of squid-list
Sent: Friday, November 07, 2014 3:36 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Squid ACL, SSL-BUMP and authentication questions

 

Hi,

&quot;Access to google maps(<A HREF="https://www.google.com/maps">https://www.google.com/maps</A>) should prevent any authentication need&quot;

I could understand that all users should be able to access the google maps link without any authentication. For this you could add the site acl before the authentication part in the squid conf. So that users will not prompt for the authentication when the user try to access the google map site. But when they try to access any other site authentication will be prompted.

(i.e)
        acl     GoogleMaps           url_regex -i    ^<A HREF="https://www.google.com/maps*.">https://www.google.com/maps*.</A>
        acl allow GoogleMaps all

        auth_param basic children 5

        auth_param basic realm Welcome to Our Website!

        auth_param basic program /usr/lib64/squid/basic_ncsa_auth /etc/squid/squid_user

        auth_param basic credentialsttl 2 hours

        auth_param basic casesensitive off    

        ....
        ....

I am not clear about the remaining part of the content.

Regards,
ViSolve Squid

On 11/07/2014 08:55 AM, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid at icshk.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid at icshk.com</A>&gt;  wrote:

Hello all,

 

As our company policy only allow some machines to access to some SSL website URL(eg. <A HREF="https://www.google.com/maps">https://www.google.com/maps</A>). However, they do not have access to <A HREF="https://www.google.com/">https://www.google.com/</A> Before, we tried to implement authentication, everything works fine. We try to allow https access to <A HREF="https://www.google.com/maps">https://www.google.com/maps</A> and &#8220;CONNECT&#8221; request to www.google.com &lt;<A HREF="http://www.google.com">http://www.google.com</A>&gt;  using SSL bump. Now, I want to preserve this config, and let user to authenicate to access to any website. Access to google maps(<A HREF="https://www.google.com/maps">https://www.google.com/maps</A>) should prevent any authentication need. However, I am not success to figure this out. I have tried different kinds of configuration, some will prompt for authentication. Some will not allow the authenticated users to access to <A HREF="https://www.google.com.">https://www.google.com.</A> From the access log, after I authenticate and try to access to <A HREF="https://www.google.com,">https://www.google.com,</A> the authentication information is not displayed. Seems squid do not use the authentication information when matching the this rule: &#8220;http_access     allow   CONNECT                 google&#8221;.

The &#8220;CONNECT&#8221; method is success. Then, the squid will continue use no authentication information to process the &#8220;GET&#8221; command, causing the authenticated user to denied access to <A HREF="https://www.google.com.">https://www.google.com.</A>

Can I make squid always use the authentication information if already authenticate ? Or any suggestion to implement this policy.

Thanks.

 

Here is an extracted version of config which should state the related configuration:

 

auth_param basic children 5

auth_param basic realm Welcome to Our Website!

auth_param basic program /usr/lib64/squid/basic_ncsa_auth /etc/squid/squid_user

auth_param basic credentialsttl 2 hours

auth_param basic casesensitive off

 

acl my_auth proxy_auth REQUIRED

 

acl SSL_ports port 443

acl Safe_ports port 443         # https

acl CONNECT method CONNECT

 

acl     GoogleMaps           url_regex -i    ^<A HREF="https://www.google.com/maps*.">https://www.google.com/maps*.</A>

acl     test_net                 src             192.168.1.253/32

acl     google                    dstdomain    www.google.com &lt;<A HREF="http://www.google.com">http://www.google.com</A>&gt; 

http_access deny CONNECT !SSL_ports

 

http_access     allow                           GoogleMaps

 

http_access     allow   CONNECT                 google

http_access     deny    CONNECT                 google                 my_auth

#http_access    allow   CONNECT                 test_net                 google

 

http_access     allow   my_auth                all

 

http_access     deny                            all

 





_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt; 
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20141107/98c4be01/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20141107/98c4be01/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000648.html">[squid-users] Squid ACL, SSL-BUMP and authentication questions
</A></li>
	<LI>Next message (by thread): <A HREF="000650.html">[squid-users] Squid ACL, SSL-BUMP and authentication questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#649">[ date ]</a>
              <a href="thread.html#649">[ thread ]</a>
              <a href="subject.html#649">[ subject ]</a>
              <a href="author.html#649">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
