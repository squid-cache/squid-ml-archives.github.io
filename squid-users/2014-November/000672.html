<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] [squid-dev] When i redirected to more traffic to squid box for testing goal via web-polygraph . find error info &quot;OS probably ran out of ephemeral ports at 192.168.2.1:0&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5Bsquid-dev%5D%20When%20i%20redirected%20to%20more%20traffic%20to%0A%20squid%20box%20for%20testing%20goal%20via%20web-polygraph%20.%20find%20error%20info%20%22OS%20probably%0A%20ran%20out%20of%20ephemeral%20ports%20at%20192.168.2.1%3A0%22&In-Reply-To=%3CCA%2BY8hcNMY68LDMWR3NFmh-7TsA3gvFTNzNjtEJTmwORc_taUgg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000673.html">
   <LINK REL="Next"  HREF="000675.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] [squid-dev] When i redirected to more traffic to squid box for testing goal via web-polygraph . find error info &quot;OS probably ran out of ephemeral ports at 192.168.2.1:0&quot;</H1>
    <B>Kinkie</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5Bsquid-dev%5D%20When%20i%20redirected%20to%20more%20traffic%20to%0A%20squid%20box%20for%20testing%20goal%20via%20web-polygraph%20.%20find%20error%20info%20%22OS%20probably%0A%20ran%20out%20of%20ephemeral%20ports%20at%20192.168.2.1%3A0%22&In-Reply-To=%3CCA%2BY8hcNMY68LDMWR3NFmh-7TsA3gvFTNzNjtEJTmwORc_taUgg%40mail.gmail.com%3E"
       TITLE="[squid-users] [squid-dev] When i redirected to more traffic to squid box for testing goal via web-polygraph . find error info &quot;OS probably ran out of ephemeral ports at 192.168.2.1:0&quot;">gkinkie at gmail.com
       </A><BR>
    <I>Sun Nov  9 16:04:55 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000673.html">[squid-users] Proposal for deny_info
</A></li>
        <LI>Next message (by thread): <A HREF="000675.html">[squid-users] 3.3.x -&gt; 3.4.x: huge performance regression
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#672">[ date ]</a>
              <a href="thread.html#672">[ thread ]</a>
              <a href="subject.html#672">[ subject ]</a>
              <a href="author.html#672">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>You want to ask this question to the polygraph authors; squid users
and developers are not really the right place to ask.
I don't know about the details, but that error message probably means
that your bots are overwhelming the TCP stack, which can't free
ephemeral ports quickly enough due to TCP timeouts.

On Thu, Nov 6, 2014 at 8:36 AM, johnzeng &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">johnzeng2013 at yahoo.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> Hello :
</I>&gt;<i>
</I>&gt;<i> i meet a problem , When i redirected to more traffic to squid box for
</I>&gt;<i> testing goal via web-polygraph .
</I>&gt;<i>
</I>&gt;<i> squidbox ip is 192.168.2.2 web-polygraph_box ip is 192.168.2.3
</I>&gt;<i>
</I>&gt;<i> /polygraph-client --config
</I>&gt;<i> /accerater/testtool/share/polygraph/workloads/simple.pg --proxy
</I>&gt;<i> 192.168.2.2:80 --verb_lvl 10
</I>&gt;<i>
</I>&gt;<i> ./polygraph-server --config
</I>&gt;<i> /accerater/testtool/share/polygraph/workloads/simple.pg --verb_lvl 10
</I>&gt;<i>
</I>&gt;<i> When testing traffic is 1500request/sec , i found more error info ,
</I>&gt;<i>
</I>&gt;<i> but my os setting is net.ipv4.ip_local_port_range = 1024 65535
</I>&gt;<i> open files (-n) 65536
</I>&gt;<i> max user processes (-u) 10000
</I>&gt;<i> /proc/sys/fs/file-max 6815744
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> and i found these error info still , how will i do ? if possible , give
</I>&gt;<i> me some help or advisement please .
</I>&gt;<i>
</I>&gt;<i> ******************************
</I>&gt;<i> error info
</I>&gt;<i> ******************************
</I>&gt;<i>
</I>&gt;<i> EphPortMgr.cc:23: error: 34920/69877 (s98) Address already in use
</I>&gt;<i> 005.28| OS probably ran out of ephemeral ports at 192.168.2.3:0
</I>&gt;<i> 005.28| Client.cc:347: error: 34920/69878 (c63) failed to establish a
</I>&gt;<i> connection
</I>&gt;<i> 005.28| 192.168.2.3 failed to connect to 192.168.2.2:80
</I>&gt;<i> 005.31| i-dflt 104811 0.00 -1 -1.00 3904 32336
</I>&gt;<i> 005.59| PolyApp.cc:189: error: 39/75599 (c58) internal timers may be
</I>&gt;<i> getting beh
</I>&gt;<i>
</I>&gt;<i> 005.90| EphPortMgr.cc:23: error: 64/129 (s98) Address already in use
</I>&gt;<i> 005.90| OS probably ran out of ephemeral ports at 192.168.2.1:0
</I>&gt;<i> 005.90| Client.cc:347: error: 64/130 (c63) failed to establish a connection
</I>&gt;<i> 005.90| 192.168.2.1 failed to connect to 192.168.2.2:80
</I>&gt;<i> 005.90| PolyApp.cc:189: error: 4/180 (c58) internal timers may be
</I>&gt;<i> getting behind
</I>&gt;<i> 005.90| record level of timing drift: 179msec; last check was 3msec ago
</I>&gt;<i> 005.90| EphPortMgr.cc:23: error: 128/260 (s98) Address already in use
</I>&gt;<i> 005.90| OS probably ran out of ephemeral ports at 192.168.2.1:0
</I>&gt;<i> 005.90| Client.cc:347: error: 128/261 (c63) failed to establish a connection
</I>&gt;<i> 005.90| 192.168.2.1 failed to connect to 192.168.2.2:80
</I>&gt;<i> 005.91| PolyApp.cc:189: error: 8/460 (c58) internal timers may be
</I>&gt;<i> getting behind
</I>&gt;<i> 005.91| record level of timing drift: 383msec; last check was 3msec ago
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ***********************************
</I>&gt;<i> Web-polygraph configration
</I>&gt;<i> ***********************************
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Content SimpleContent = {
</I>&gt;<i> size = exp(13KB); // response sizes distributed exponentially
</I>&gt;<i> cachable = 80%; // 20% of content is uncachable
</I>&gt;<i> };
</I>&gt;<i>
</I>&gt;<i> // a primitive server cleverly labeled &quot;S101&quot;
</I>&gt;<i> // normally, you would specify more properties,
</I>&gt;<i> // but we will mostly rely on defaults for now
</I>&gt;<i> Server S = {
</I>&gt;<i> kind = &quot;S101&quot;;
</I>&gt;<i> contents = [ SimpleContent ];
</I>&gt;<i> direct_access = contents;
</I>&gt;<i>
</I>&gt;<i> addresses = ['192.168.2.1:9090']; // where to create these server agents
</I>&gt;<i> };
</I>&gt;<i>
</I>&gt;<i> // a primitive robot
</I>&gt;<i> Robot R = {
</I>&gt;<i> kind = &quot;R101&quot;;
</I>&gt;<i> pop_model = { pop_distr = popUnif(); };
</I>&gt;<i> recurrence = 55% / SimpleContent.cachable; // adjusted to get 55% DHR
</I>&gt;<i> req_rate = 1600/sec;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> origins = S.addresses; // where the origin servers are
</I>&gt;<i> addresses = ['192.168.2.1']; // where these robot agents will be created
</I>&gt;<i> };
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> **************************************
</I>&gt;<i> sysctl.conf
</I>&gt;<i> **************************************
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> fs.file-max = 6815744
</I>&gt;<i> fs.aio-max-nr = 1048576
</I>&gt;<i> kernel.shmmax = 4294967295
</I>&gt;<i> kernel.threads-max = 212992
</I>&gt;<i> kernel.sem = 250 256000 100 1024
</I>&gt;<i> net.core.rmem_max=5165824
</I>&gt;<i> net.core.wmem_max=262144
</I>&gt;<i> net.ipv4.tcp_rmem=5165824 5165824 5165824
</I>&gt;<i> net.ipv4.tcp_wmem=262144 262144 262144
</I>&gt;<i> net.core.rmem_default = 5165824
</I>&gt;<i> net.core.wmem_default = 262144
</I>&gt;<i> net.core.optmem_max = 25165824
</I>&gt;<i> net.ipv4.ip_local_port_range = 1024 65535
</I>&gt;<i> net.nf_conntrack_max = 6553600
</I>&gt;<i> net.netfilter.nf_conntrack_tcp_timeout_established = 1200
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> net.ipv4.tcp_tw_recycle = 1
</I>&gt;<i> net.ipv4.tcp_tw_reuse = 1
</I>&gt;<i> net.ipv4.tcp_fin_timeout = 10
</I>&gt;<i> net.ipv4.tcp_orphan_retries = 3
</I>&gt;<i> net.ipv4.tcp_retries2 = 5
</I>&gt;<i> net.ipv4.tcp_keepalive_intvl = 15
</I>&gt;<i> net.ipv4.tcp_syn_retries = 5
</I>&gt;<i> net.ipv4.tcp_synack_retries = 2
</I>&gt;<i> net.ipv4.tcp_keepalive_time = 1800
</I>&gt;<i> net.core.netdev_max_backlog = 3000000
</I>&gt;<i> net.ipv4.tcp_max_syn_backlog = 262144000
</I>&gt;<i> net.ipv4.tcp_max_tw_buckets = 500000000
</I>&gt;<i> net.core.somaxconn = 262144000
</I>&gt;<i> net.ipv4.tcp_sack = 1
</I>&gt;<i> net.ipv4.tcp_fack = 1
</I>&gt;<i>
</I>&gt;<i> net.ipv4.tcp_timestamps = 0
</I>&gt;<i> net.ipv4.tcp_window_scaling = 1
</I>&gt;<i> net.ipv4.tcp_syncookies = 1
</I>&gt;<i> net.ipv4.tcp_no_metrics_save=1
</I>&gt;<i> net.ipv4.tcp_max_orphans = 26214400
</I>&gt;<i> net.ipv4.tcp_synack_retries = 2
</I>&gt;<i> net.ipv4.tcp_low_latency = 1
</I>&gt;<i> net.ipv4.tcp_rfc1337 = 1
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-dev mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-dev at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-dev">http://lists.squid-cache.org/listinfo/squid-dev</A>
</I>


-- 
    Francesco

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000673.html">[squid-users] Proposal for deny_info
</A></li>
	<LI>Next message (by thread): <A HREF="000675.html">[squid-users] 3.3.x -&gt; 3.4.x: huge performance regression
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#672">[ date ]</a>
              <a href="thread.html#672">[ thread ]</a>
              <a href="subject.html#672">[ subject ]</a>
              <a href="author.html#672">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
