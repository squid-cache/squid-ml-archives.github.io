<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid3 config on Ubuntu remains even after uninstall and ignore the new config
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid3%20config%20on%20Ubuntu%20remains%20even%20after%0A%20uninstall%20and%20ignore%20the%20new%20config&In-Reply-To=%3CCA%2B-XJgUDPErO67zo_CwpCeS5jGamer6HJHKdWSRXZq%2Bo_H2juA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000697.html">
   <LINK REL="Next"  HREF="000706.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid3 config on Ubuntu remains even after uninstall and ignore the new config</H1>
    <B>Efe</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid3%20config%20on%20Ubuntu%20remains%20even%20after%0A%20uninstall%20and%20ignore%20the%20new%20config&In-Reply-To=%3CCA%2B-XJgUDPErO67zo_CwpCeS5jGamer6HJHKdWSRXZq%2Bo_H2juA%40mail.gmail.com%3E"
       TITLE="[squid-users] Squid3 config on Ubuntu remains even after uninstall and ignore the new config">merhabakendim at gmail.com
       </A><BR>
    <I>Mon Nov 10 13:58:42 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000697.html">[squid-users] Squid3 config on Ubuntu remains even after uninstall and ignore the new config
</A></li>
        <LI>Next message (by thread): <A HREF="000706.html">[squid-users] Squid3 config on Ubuntu remains even after uninstall and ignore the new config
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#699">[ date ]</a>
              <a href="thread.html#699">[ thread ]</a>
              <a href="subject.html#699">[ subject ]</a>
              <a href="author.html#699">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thank you for your reply. I've managed to retrieve uncommented config lines:

$ grep -P '^\s*\w' /etc/squid3/squid.conf

acl localnet src 192.168.0.101  # RFC1918 possible internal network
acl SSL_ports port 443
acl Safe_ports port 80      # http
acl Safe_ports port 21      # ftp
acl Safe_ports port 443     # https
acl Safe_ports port 70      # gopher
acl Safe_ports port 210     # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280     # http-mgmt
acl Safe_ports port 488     # gss-http
acl Safe_ports port 591     # filemaker
acl Safe_ports port 777     # multiling http
acl CONNECT method CONNECT
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
acl myrule dstdom_regex &quot;/etc/squid3/domainblock.txt&quot;
http_access allow myrule
cache deny all
http_access allow localhost manager
http_access deny manager
acl Purge method PURGE
http_access deny Purge
http_access allow localhost
http_port 3128
coredump_dir /var/spool/squid3
refresh_pattern ^ftp:       1440    20% 10080
refresh_pattern ^gopher:    1440    0%  1440
refresh_pattern -i (/cgi-bin/|\?) 0 0%  0
refresh_pattern (Release|Packages(.gz)*)$      0       20%     2880
refresh_pattern .       0   20% 4320

If helps, iptables is empty and netstat status is
$ sudo netstat -nltp | grep squid
tcp6       0      0 :::3128                 :::*
LISTEN      20292/(squid-1)

Version info:
$ sudo apt-cache policy squid3
squid3:
  Installed: 3.3.8-1ubuntu6.1
  Candidate: 3.3.8-1ubuntu6.1
  Version table:
 *** 3.3.8-1ubuntu6.1 0
        500 <A HREF="http://archive.ubuntu.com/ubuntu/">http://archive.ubuntu.com/ubuntu/</A> trusty-updates/main i386
Packages
        500 <A HREF="http://archive.ubuntu.com/ubuntu/">http://archive.ubuntu.com/ubuntu/</A> trusty-security/main i386
Packages
        100 /var/lib/dpkg/status
     3.3.8-1ubuntu6 0
        500 <A HREF="http://archive.ubuntu.com/ubuntu/">http://archive.ubuntu.com/ubuntu/</A> trusty/main i386 Packages

Proof that squid is running:
$ ps ax | grep squid
20290 ?        Ss     0:00 squid3
20292 ?        S      0:06 (squid-1)
31535 ?        S      0:00 (logfile-daemon) /var/log/squid3/access.log
31720 pts/28   S+     0:00 grep --color=auto squid

Maybe i used the wrong terminology as &quot;redirect&quot;. B/c whenever the website
in the blocklist is called, localhost page of my LAMP shows up.

So, what i want to achieve in the end is blocking and sometimes unblocking
a list of websites based on their domain name. Problem is even the config
is changed to &quot;http_access allow myrule&quot; it doesnt reflect allow/deny
options accordingly anymore. At this moment, the websites in the list are
still non-accessible.

On Mon, Nov 10, 2014 at 3:32 PM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:

&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i> Hash: SHA1
</I>&gt;<i>
</I>&gt;<i> On 11/11/2014 12:22 a.m., Efe wrote:
</I>&gt;<i> &gt; OS: Ubuntu 14.04 LTS
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; After i installed the squid3 package for the 1st time, i've add a
</I>&gt;<i> &gt; list of domains to be blocked in squid.conf:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl myrule dstdom_regex &quot;/etc/squid3/domainblock.txt&quot; http_access
</I>&gt;<i> &gt; deny myrule
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; where domainblock.txt is
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; someaddress.com blockthis.net
</I>&gt;<i>
</I>&gt;<i> For domain names like this you should be using &quot;dstdomain&quot; ACL type
</I>&gt;<i> instead of a regex.
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Which worked fine and redirect them to localhost running on my
</I>&gt;<i> &gt; LAMP
</I>&gt;<i>
</I>&gt;<i> ?? there is nothing about a &quot;redirect&quot; in that squid.conf snippet you
</I>&gt;<i> showed.
</I>&gt;<i>
</I>&gt;<i> Can you please display the whole squid.conf. Without all the
</I>&gt;<i> documentation #comment or empty lines though.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Index of /
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Name   Last modified   Size   Description
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; html   2014/04/10 ------------------------------
</I>&gt;<i> &gt; ---------------------- Apache/2.4.7 (Ubuntu) Server at
</I>&gt;<i> &gt; google-analytics.com Port 80
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Later i purged it by:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; sudo apt-get remove --purge squid3*
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; and removed every file&amp;folder the command &quot;locate squid&quot; gave,
</I>&gt;<i> &gt; including the &quot;/etc/squid3&quot; folder then reboot. But i still couldnt
</I>&gt;<i> &gt; access the websites in &quot;domainblock.txt&quot; even though it doesnt
</I>&gt;<i> &gt; exist anymore.
</I>&gt;<i>
</I>&gt;<i> &quot;it&quot; being squid I assume?
</I>&gt;<i>
</I>&gt;<i> There is almost always other configuration you had to add in the
</I>&gt;<i> network or browser causing the browser to use the proxy. This will
</I>&gt;<i> have probably broken your test result.
</I>&gt;<i>
</I>&gt;<i> If you did actually not have any of that, then you just proved that
</I>&gt;<i> Squid was not involved with the problem.
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Then i re-installed with sudo apt-get install squid3 this time with
</I>&gt;<i> &gt; the config to allow those websites in the list:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl myrule dstdom_regex &quot;/etc/squid3/domainblock.txt&quot; http_access
</I>&gt;<i> &gt; allow myrule
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; But still no luck. I guess some configurations remain even after
</I>&gt;<i> &gt; removing the squid in the system. So what should i do now?
</I>&gt;<i>
</I>&gt;<i> What do you want to achieve exactly?
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i> -----BEGIN PGP SIGNATURE-----
</I>&gt;<i> Version: GnuPG v2.0.22 (MingW32)
</I>&gt;<i>
</I>&gt;<i> iQEcBAEBAgAGBQJUYL6CAAoJELJo5wb/XPRjF/sIANt7v8/BpcZ4taHWpRZyXbul
</I>&gt;<i> mdr6Cq7rfNb8VRiR41GYnEi0qDuSsSb31ciCpVAVoaeIBF48FufleqQ+QH3kn8M3
</I>&gt;<i> ETvNuUHis2Wd8gNXKd3pWtqBx+AbVyPzgKpJebBma0KeOw1eE3Jwevsqbjh/yMBq
</I>&gt;<i> KLNfDH0CgL63wYkbNquP3AjDkQggv/w/YvD9bFQY1JfMsaTb64CEdP6NdtEbgnhi
</I>&gt;<i> PBo9p9/T1HBkfBf2kg+uElR+TMur1OoHaztxx8g+iiqfBHSocaXhWRCtayhqg35X
</I>&gt;<i> 8DCmysOYNjY9FyQHZAKFaSeb4WyD02On/KOchH3/5ZHCA1P4HG9zF8V4KYmlgfc=
</I>&gt;<i> =iena
</I>&gt;<i> -----END PGP SIGNATURE-----
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20141110/81d3a185/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20141110/81d3a185/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000697.html">[squid-users] Squid3 config on Ubuntu remains even after uninstall and ignore the new config
</A></li>
	<LI>Next message (by thread): <A HREF="000706.html">[squid-users] Squid3 config on Ubuntu remains even after uninstall and ignore the new config
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#699">[ date ]</a>
              <a href="thread.html#699">[ thread ]</a>
              <a href="subject.html#699">[ subject ]</a>
              <a href="author.html#699">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
