<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] High CPU-Usage with squid 3.4.9 (and/or 3.4.4)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20High%20CPU-Usage%20with%20squid%203.4.9%20%28and/or%203.4.4%29&In-Reply-To=%3C5460E0D1.6000303%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000704.html">
   <LINK REL="Next"  HREF="000712.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] High CPU-Usage with squid 3.4.9 (and/or 3.4.4)</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20High%20CPU-Usage%20with%20squid%203.4.9%20%28and/or%203.4.4%29&In-Reply-To=%3C5460E0D1.6000303%40treenet.co.nz%3E"
       TITLE="[squid-users] High CPU-Usage with squid 3.4.9 (and/or 3.4.4)">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Nov 10 15:59:13 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000704.html">[squid-users] High CPU-Usage with squid 3.4.9 (and/or 3.4.4)
</A></li>
        <LI>Next message (by thread): <A HREF="000712.html">[squid-users] High CPU-Usage with squid 3.4.9 (and/or 3.4.4)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#707">[ date ]</a>
              <a href="thread.html#707">[ thread ]</a>
              <a href="subject.html#707">[ subject ]</a>
              <a href="author.html#707">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 11/11/2014 4:12 a.m., Rietzler, Markus (RZF, SG 324 /
&lt;RIETZLER_SOFTWARE&gt;) wrote:
&gt;&gt;<i> -----Urspr&#252;ngliche Nachricht----- Von: squid-users 
</I>&gt;&gt;<i> [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] Im Auftrag
</I>&gt;&gt;<i> von Amos Jeffries Gesendet: Montag, 10. November 2014 14:36 An: 
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> Betreff: Re: [squid-users]
</I>&gt;&gt;<i> High CPU-Usage with squid 3.4.9 (and/or 3.4.4)
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> On 7/11/2014 2:50 a.m., Tom Tom wrote:
</I>&gt;&gt;&gt;<i> Hi
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> After migration from squid 3.3.13 to 3.4.4, I recognized a 
</I>&gt;&gt;&gt;<i> performance-issue. Squid is configured with 4 workers. They 
</I>&gt;&gt;&gt;<i> often have a CPU-Utilization between 50%-90% (each worker).
</I>&gt;&gt;&gt;<i> With squid 3.3.13 (same configuration), the CPU-Utilization was
</I>&gt;&gt;&gt;<i> never a problem. I installed squid 3.4.9 and had the same
</I>&gt;&gt;&gt;<i> issue. No warnings/errors in the cache.log
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> I saw, that someone other reported a similar issue: 
</I>&gt;&gt;&gt;<i> <A HREF="http://www.squid-cache.org/mail-archive/squid-users/201407/0500.html">http://www.squid-cache.org/mail-archive/squid-users/201407/0500.html</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 
</I>Concerning the post above: Yes, we have external_auth-helpers
&gt;&gt;&gt;<i> (ext_kerberos_ldap_group_acl) and no, we do not use
</I>&gt;&gt;&gt;<i> delay_pools. The high cpu-usage comes not from the auth-helper
</I>&gt;&gt;&gt;<i> - it comes from the 4 squid-worker-processes. Any hints? Is
</I>&gt;&gt;&gt;<i> this a known problem? Probably solved in 3.5?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Are you able to find out any specific details about what the 
</I>&gt;&gt;<i> workers are doing that uses so much extra CPU?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Amos
</I>&gt;&gt;<i> 
</I>&gt;<i> during our last tests (with 3.4.x) we also tried the worker
</I>&gt;<i> option. it does not matter if workers are enabled or not. with more
</I>&gt;<i> workers the cpu rise seems to be somewhat slower. so it is not
</I>&gt;<i> connected to (smp)workers. it is the external auth helper -
</I>&gt;<i> although the squid process and not the helper does consume all the
</I>&gt;<i> cpu...
</I>
The only difference between SMP and non-SMP mode here is that non-SMP
has 1 worker doing all the work with one CPU core, whereas SMP mode
has several workers. They can all hit the same issues independently
for the same reason(s).


I am of the understanding that the code associated with the helper
processe is using a lot of CPU doing *something* that consumes a lot
of cycles.

There is a bunch of code doing cache lookups on previous helper
queries, queueing new lookups, generating and parsing strings in the
I/O, and even sometimes running whole trees of ACL logics when the
helper(s) respond.
 So to get anywhere on this complaint it is important to know what
(from the above set of things) exactly the CPU is doing.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUYODRAAoJELJo5wb/XPRjvrkH/RBEitKpvLcWypNPCCrMTtw6
tKftf9gz4og6GOkUiipE0qNLTMgWvV7Fk9/By3vhEGNL+WpQG5UEWCbfpc2h2RdL
H5tIWJGnXcsV1PGwYI1cuyDpanNs6EnSvKnSGTZ2DdWabiFEOPr9FR/8QtVqpUdS
EK3uMpnmZ0mbo7auDIPxwa7CYh44tC/C3VMZSto+peB1ikiDonU9B0tXVEFCheeE
B0IWs8FaoYByVd54lL6cYPz7HcOtyt2Hb6uyPJyQVrrEJs2JuI4ZQh0X7B2mbzAi
HK8wBbDcyC4ZKagq4ABQIYHsxwqxiNFD6v9ntXBjZpORG1opXLMSBAh9K0Ycq5s=
=5pNQ
-----END PGP SIGNATURE-----

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000704.html">[squid-users] High CPU-Usage with squid 3.4.9 (and/or 3.4.4)
</A></li>
	<LI>Next message (by thread): <A HREF="000712.html">[squid-users] High CPU-Usage with squid 3.4.9 (and/or 3.4.4)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#707">[ date ]</a>
              <a href="thread.html#707">[ thread ]</a>
              <a href="subject.html#707">[ subject ]</a>
              <a href="author.html#707">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
