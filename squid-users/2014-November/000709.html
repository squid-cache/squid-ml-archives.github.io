<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid3 config on Ubuntu remains even after uninstall and ignore the new config
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid3%20config%20on%20Ubuntu%20remains%20even%20after%0A%20uninstall%20and%20ignore%20the%20new%20config&In-Reply-To=%3CCA%2B-XJgU0g9CDFrweoG5hd9E9WeRnNqmWOocxv3n7ouiTeE_TUw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000706.html">
   <LINK REL="Next"  HREF="000711.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid3 config on Ubuntu remains even after uninstall and ignore the new config</H1>
    <B>Efe</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid3%20config%20on%20Ubuntu%20remains%20even%20after%0A%20uninstall%20and%20ignore%20the%20new%20config&In-Reply-To=%3CCA%2B-XJgU0g9CDFrweoG5hd9E9WeRnNqmWOocxv3n7ouiTeE_TUw%40mail.gmail.com%3E"
       TITLE="[squid-users] Squid3 config on Ubuntu remains even after uninstall and ignore the new config">merhabakendim at gmail.com
       </A><BR>
    <I>Mon Nov 10 16:12:23 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000706.html">[squid-users] Squid3 config on Ubuntu remains even after uninstall and ignore the new config
</A></li>
        <LI>Next message (by thread): <A HREF="000711.html">[squid-users] Squid3 config on Ubuntu remains even after	uninstall and ignore the new config
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#709">[ date ]</a>
              <a href="thread.html#709">[ thread ]</a>
              <a href="subject.html#709">[ subject ]</a>
              <a href="author.html#709">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>It's the websites i want to block &amp; unblock occasionaly as in:
squid.conf:
    acl myrule dstdom_regex &quot;/etc/squid3/domainblock.txt&quot;
    http_access deny myrule

where domainblock.txt is

    someaddress.com
    blockthis.net

Now whenever i enter someaddress.com url &amp; hit enter, it (squid or
something on the network level) redirects to the localhost page. That's
fine as long as i want to restrict access to that website.

Problem is, changing config &quot;http_access allow myrule&quot; and reconfiguring,
parsing and restarting squid and then the computer does not change
anything, i.e i still cant access someaddress.com. Removed the settings
from config, no luck again.

As i said, iptables is empty. So what might be the reason then?



On Mon, Nov 10, 2014 at 5:45 PM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:

&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i> Hash: SHA1
</I>&gt;<i>
</I>&gt;<i> On 11/11/2014 2:58 a.m., Efe wrote:
</I>&gt;<i> &gt; Thank you for your reply. I've managed to retrieve uncommented
</I>&gt;<i> &gt; config lines:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; $ grep -P '^\s*\w' /etc/squid3/squid.conf
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl localnet src 192.168.0.101  # RFC1918 possible internal
</I>&gt;<i> &gt; network acl SSL_ports port 443 acl Safe_ports port 80      # http
</I>&gt;<i> &gt; acl Safe_ports port 21      # ftp acl Safe_ports port 443     #
</I>&gt;<i> &gt; https acl Safe_ports port 70      # gopher acl Safe_ports port 210
</I>&gt;<i> &gt; # wais acl Safe_ports port 1025-65535  # unregistered ports acl
</I>&gt;<i> &gt; Safe_ports port 280     # http-mgmt acl Safe_ports port 488     #
</I>&gt;<i> &gt; gss-http acl Safe_ports port 591     # filemaker acl Safe_ports
</I>&gt;<i> &gt; port 777     # multiling http acl CONNECT method CONNECT
</I>&gt;<i> &gt; http_access deny !Safe_ports http_access deny CONNECT !SSL_ports
</I>&gt;<i> &gt; acl myrule dstdom_regex &quot;/etc/squid3/domainblock.txt&quot; http_access
</I>&gt;<i> &gt; allow myrule cache deny all http_access allow localhost manager
</I>&gt;<i> &gt; http_access deny manager acl Purge method PURGE http_access deny
</I>&gt;<i> &gt; Purge http_access allow localhost http_port 3128 coredump_dir
</I>&gt;<i> &gt; /var/spool/squid3 refresh_pattern ^ftp:       1440    20% 10080
</I>&gt;<i> &gt; refresh_pattern ^gopher:    1440    0%  1440 refresh_pattern -i
</I>&gt;<i> &gt; (/cgi-bin/|\?) 0 0%  0 refresh_pattern (Release|Packages(.gz)*)$
</I>&gt;<i> &gt; 0       20%     2880 refresh_pattern .       0   20% 4320
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; If helps, iptables is empty and netstat status is $ sudo netstat
</I>&gt;<i> &gt; -nltp | grep squid tcp6       0      0 :::3128
</I>&gt;<i> &gt; :::* LISTEN      20292/(squid-1)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Version info: $ sudo apt-cache policy squid3 squid3: Installed:
</I>&gt;<i> &gt; 3.3.8-1ubuntu6.1 Candidate: 3.3.8-1ubuntu6.1 Version table: ***
</I>&gt;<i> &gt; 3.3.8-1ubuntu6.1 0 500 <A HREF="http://archive.ubuntu.com/ubuntu/">http://archive.ubuntu.com/ubuntu/</A>
</I>&gt;<i> &gt; trusty-updates/main i386 Packages 500
</I>&gt;<i> &gt; <A HREF="http://archive.ubuntu.com/ubuntu/">http://archive.ubuntu.com/ubuntu/</A> trusty-security/main i386
</I>&gt;<i> &gt; Packages 100 /var/lib/dpkg/status 3.3.8-1ubuntu6 0 500
</I>&gt;<i> &gt; <A HREF="http://archive.ubuntu.com/ubuntu/">http://archive.ubuntu.com/ubuntu/</A> trusty/main i386 Packages
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Proof that squid is running: $ ps ax | grep squid 20290 ?        Ss
</I>&gt;<i> &gt; 0:00 squid3 20292 ?        S      0:06 (squid-1) 31535 ?        S
</I>&gt;<i> &gt; 0:00 (logfile-daemon) /var/log/squid3/access.log 31720 pts/28   S+
</I>&gt;<i> &gt; 0:00 grep --color=auto squid
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Maybe i used the wrong terminology as &quot;redirect&quot;. B/c whenever the
</I>&gt;<i> &gt; website in the blocklist is called, localhost page of my LAMP shows
</I>&gt;<i> &gt; up.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; So, what i want to achieve in the end is blocking and sometimes
</I>&gt;<i> &gt; unblocking a list of websites based on their domain name. Problem
</I>&gt;<i> &gt; is even the config is changed to &quot;http_access allow myrule&quot; it
</I>&gt;<i> &gt; doesnt reflect allow/deny options accordingly anymore. At this
</I>&gt;<i> &gt; moment, the websites in the list are still non-accessible.
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> Let me guess,  you are testing this with a browser URL
</I>&gt;<i> <A HREF="http://192.168.whatever:3128/">http://192.168.whatever:3128/</A> or even just <A HREF="http://192.168.whatever/">http://192.168.whatever/</A>
</I>&gt;<i> and it shows your LAMP server page?
</I>&gt;<i>
</I>&gt;<i> You seem to have missed out all the bits of the setup which make the
</I>&gt;<i> browser use the proxy rather than just connecting directly to Apache
</I>&gt;<i> in the LAMP stack.
</I>&gt;<i> You may need to read through this:
</I>&gt;<i>  <A HREF="http://wiki.squid-cache.org/SquidFaq/ConfiguringBrowsers">http://wiki.squid-cache.org/SquidFaq/ConfiguringBrowsers</A>
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i> -----BEGIN PGP SIGNATURE-----
</I>&gt;<i> Version: GnuPG v2.0.22 (MingW32)
</I>&gt;<i>
</I>&gt;<i> iQEcBAEBAgAGBQJUYN2bAAoJELJo5wb/XPRj5VMIANLLVIb8kjqk5BiycDBAH1MR
</I>&gt;<i> 5qA896B3hhcoVEgFIH2lxSzFVBXJBFSwcjXnZN9nkqf5b7/t6k58hY3+56+UfZSF
</I>&gt;<i> xO7tHOy/mvtCNA+ol7JlyVz+MvgaKMRqzXdAnJdP3OrhQ4g75WfGKCxoCBBwPNgU
</I>&gt;<i> 5gD7rSSQq8PpD0uBNuHV8SDwwKkYaoYtoqAs1OWD5p+WbyAylYZB7cJKKgex1+d9
</I>&gt;<i> nPqGIlaRLaWRJzcTDFUW0C3B0zIggIv5GRNsO50gqqQZ0Xb9F3Iy5aDOwyiyiCYn
</I>&gt;<i> LmlRADaoqf4MWfBh+nmmufcwUcfsAGknI7tStk3dXCzNQNA9O2gy3e7s+H+7Poo=
</I>&gt;<i> =A5vS
</I>&gt;<i> -----END PGP SIGNATURE-----
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20141110/ac9f8f4e/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20141110/ac9f8f4e/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000706.html">[squid-users] Squid3 config on Ubuntu remains even after uninstall and ignore the new config
</A></li>
	<LI>Next message (by thread): <A HREF="000711.html">[squid-users] Squid3 config on Ubuntu remains even after	uninstall and ignore the new config
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#709">[ date ]</a>
              <a href="thread.html#709">[ thread ]</a>
              <a href="subject.html#709">[ subject ]</a>
              <a href="author.html#709">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
