<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users]  Problem with Squid 3.4 and transparent SSL proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%20Problem%20with%20Squid%203.4%20and%20transparent%20SSL%20proxy&In-Reply-To=%3C88EF58F000EC4B4684700C2AA3A73D7A04F5323FBEE7%40W2008DC01.ColliniConsulting.lan%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000723.html">
   <LINK REL="Next"  HREF="000726.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users]  Problem with Squid 3.4 and transparent SSL proxy</H1>
    <B>Job</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%20Problem%20with%20Squid%203.4%20and%20transparent%20SSL%20proxy&In-Reply-To=%3C88EF58F000EC4B4684700C2AA3A73D7A04F5323FBEE7%40W2008DC01.ColliniConsulting.lan%3E"
       TITLE="[squid-users]  Problem with Squid 3.4 and transparent SSL proxy">Job at colliniconsulting.it
       </A><BR>
    <I>Tue Nov 11 15:06:57 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000723.html">[squid-users] Problem with Squid 3.4 and transparent SSL proxy
</A></li>
        <LI>Next message (by thread): <A HREF="000726.html">[squid-users] Problem with Squid 3.4 and transparent SSL proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#724">[ date ]</a>
              <a href="thread.html#724">[ thread ]</a>
              <a href="subject.html#724">[ subject ]</a>
              <a href="author.html#724">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Elizier,

first of all thank you for your patience and help!
I use this directives in iptables:

iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 3128 (for http)
iptables -t nat -A PREROUTING -p tcp --dport 443 -j REDIRECT --to-port 3129 (for https)

In a normal http-only transparent proxy everything works fine, but i would like to implement ssl bump for proxying transparently https connection.

When telnetting 3128 or 3129 mode, from Linux machine shell, it seems that connection fails.
When telnetting 3128 port not in interception mode (for standard http transparent proxying), the socket opens and stay connected!

The squid.conf seciont regarding SSL:

http_port 3128
https_port 3129 intercept ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=16MB cert=/etc/squid/ssl/squid.pem key=/etc/squid/ssl/squid.key
sslcrtd_program /usr/lib/squid/ssl_crtd -s /var/lib/squid_ssl_db -M 16MB
sslcrtd_children 50 startup=5 idle=1
ssl_bump server-first all


Thank you again,
Francesco


________________________________________
Da: squid-users [<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] per conto di Eliezer Croitoru [<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>]
Inviato: marted&#236; 11 novembre 2014 15.31
A: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Oggetto: Re: [squid-users] Problem with Squid 3.4 and transparent SSL proxy

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hey,

Your configuration seems to not include any iptables and other
relevant details.
What is this machine details?

Eliezer

On 11/11/2014 04:20 PM, Job wrote:
&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> i initialize correctly SSL Bump with Squid 3.4.4, following some
</I>&gt;<i> guides. In iptables i redirect 80 and 443 ports to squid ports.
</I>&gt;<i>
</I>&gt;<i> Squid starts with no error, lines involving SSL bump are the
</I>&gt;<i> following:
</I>&gt;<i>
</I>&gt;<i> http_port 3128 intercept https_port 3129 intercept ssl-bump
</I>&gt;<i> generate-host-certificates=on dynamic_cert_mem_cache_size=16MB
</I>&gt;<i> cert=/etc/squid/ssl/squid.pem key=/etc/squid/ssl/squid.key
</I>&gt;<i>
</I>&gt;<i> But no request arrives to squid.
</I>&gt;<i>
</I>&gt;<i> If i telnet, from Linux machine, this:
</I>&gt;<i>
</I>&gt;<i> telnet localhost 3128 or telnet localhost 3129, even though the
</I>&gt;<i> socket is open (netstat -avn | grep 3128 and 3129), connection
</I>&gt;<i> close immediately.
</I>&gt;<i>
</I>&gt;<i> I see no errors in cache.log, access.log and messages.
</I>&gt;<i>
</I>&gt;<i> Thank you Francesco
</I>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUYh2nAAoJENxnfXtQ8ZQUoEEIAI71G38BNCtTTyeGeNB0VHu8
0r2ta5KZKcFLcI3NxcyHN6ygKatSk1zkZQu8uzFOlPIrrAQ1bvql1shpq5vhPjLw
8T8IGEeiULrhx5ms+6ErgvB8sg3wkq1Z+jyJ4Q40lgcPU07ncXzBOyWV5ODaSFXC
zYPII8hrtVH0taPgJpW35XcNb/0htyjxdtXbEs3ZCoAmXLwJQsRfHmdeSdn0Am+Y
swDybjHpMsaf90SJUVFZN3uDLVxKOcMBVLhbCpWt50g+lsJcQeNCZ4xo2QaRURxT
c2lfQD4h1k3ck52r/70dtMZzwTYnoSymyfEGp5zUh8yYSzmd2moDC2z89PEGSQI=
=2uuM
-----END PGP SIGNATURE-----
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000723.html">[squid-users] Problem with Squid 3.4 and transparent SSL proxy
</A></li>
	<LI>Next message (by thread): <A HREF="000726.html">[squid-users] Problem with Squid 3.4 and transparent SSL proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#724">[ date ]</a>
              <a href="thread.html#724">[ thread ]</a>
              <a href="subject.html#724">[ subject ]</a>
              <a href="author.html#724">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
