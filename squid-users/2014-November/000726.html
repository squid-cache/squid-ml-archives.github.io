<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Problem with Squid 3.4 and transparent SSL proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problem%20with%20Squid%203.4%20and%20transparent%20SSL%20proxy&In-Reply-To=%3C54622B9E.6010308%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000724.html">
   <LINK REL="Next"  HREF="000727.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Problem with Squid 3.4 and transparent SSL proxy</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problem%20with%20Squid%203.4%20and%20transparent%20SSL%20proxy&In-Reply-To=%3C54622B9E.6010308%40treenet.co.nz%3E"
       TITLE="[squid-users] Problem with Squid 3.4 and transparent SSL proxy">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Nov 11 15:30:38 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000724.html">[squid-users]  Problem with Squid 3.4 and transparent SSL proxy
</A></li>
        <LI>Next message (by thread): <A HREF="000727.html">[squid-users] R: Problem with Squid 3.4 and transparent SSL proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#726">[ date ]</a>
              <a href="thread.html#726">[ thread ]</a>
              <a href="subject.html#726">[ subject ]</a>
              <a href="author.html#726">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 12/11/2014 4:06 a.m., Job wrote:
&gt;<i> Hello Elizier,
</I>&gt;<i> 
</I>&gt;<i> first of all thank you for your patience and help! I use this
</I>&gt;<i> directives in iptables:
</I>&gt;<i> 
</I>&gt;<i> iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT
</I>&gt;<i> --to-port 3128 (for http) iptables -t nat -A PREROUTING -p tcp
</I>&gt;<i> --dport 443 -j REDIRECT --to-port 3129 (for https)
</I>&gt;<i> 
</I>&gt;<i> In a normal http-only transparent proxy everything works fine, but
</I>&gt;<i> i would like to implement ssl bump for proxying transparently https
</I>&gt;<i> connection.
</I>&gt;<i> 
</I>&gt;<i> When telnetting 3128 or 3129 mode, from Linux machine shell, it
</I>&gt;<i> seems that connection fails. When telnetting 3128 port not in
</I>&gt;<i> interception mode (for standard http transparent proxying), the
</I>&gt;<i> socket opens and stay connected!
</I>
Do you mean you are telnet'ing *directly* to a port which is expecting
to receive NAT'd traffic and is also configured to use the NAT packet
details to contact some server?

With proxy of all types you MUST test them from the same
context/perspective the real clients traffic would be using.

That means in your case avoid directly connecting to the intercepting
port. Connect to port 80/443 on some Internet server instead and see
if the packets are properly delivered through Squid.
 Also, avoid telnet for the 443 tests. Use an HTTPS client.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUYiueAAoJELJo5wb/XPRj3V8H/3w8d6ahHFfiXIxIa8Y9MyJJ
BziDhnD7CAWnrfuiVWq05Ubr3ZASLh9vJQze0gq7jaJ/sptm92jjF6gkxRWhKNM+
sBDYIA5zyfr9BhYolIus39BeHaQGAu0640gAGd4SeGV4zp5ZugZMa0BV+dNlACIW
m+qe+SvXX8Uz9aiPLCvOdDKykAD7PP9FrqQCzJ0veYqOlVq0inXMf3Jt3hlN5djp
fAu7n7WdG/E5SRki+BaG2RAZ9MQr3uf0WhyNfKLfcvFAyOTCTTLQOeONFDsaMO9C
r2PEk7pfwMss5Q8tu9hBIKoJWEx411Z7wMZsWcoEuXS5a7VrXBoLy2lmMUr6cPw=
=nnfH
-----END PGP SIGNATURE-----

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000724.html">[squid-users]  Problem with Squid 3.4 and transparent SSL proxy
</A></li>
	<LI>Next message (by thread): <A HREF="000727.html">[squid-users] R: Problem with Squid 3.4 and transparent SSL proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#726">[ date ]</a>
              <a href="thread.html#726">[ thread ]</a>
              <a href="subject.html#726">[ subject ]</a>
              <a href="author.html#726">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
