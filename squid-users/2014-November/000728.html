<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Problem with https://www.google.com and squid	interception
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problem%20with%20https%3A//www.google.com%20and%20squid%0A%09interception&In-Reply-To=%3C546259B7.3020103%40nanosec.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000791.html">
   <LINK REL="Next"  HREF="000731.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Problem with https://www.google.com and squid	interception</H1>
    <B>Peter Gross</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problem%20with%20https%3A//www.google.com%20and%20squid%0A%09interception&In-Reply-To=%3C546259B7.3020103%40nanosec.com%3E"
       TITLE="[squid-users] Problem with https://www.google.com and squid	interception">pag at nanosec.com
       </A><BR>
    <I>Tue Nov 11 18:47:19 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000791.html">[squid-users] R: R: R: Problem with Squid 3.4 and transparent SSL proxy
</A></li>
        <LI>Next message (by thread): <A HREF="000731.html">[squid-users] Problem with https://www.google.com and squid	interception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#728">[ date ]</a>
              <a href="thread.html#728">[ thread ]</a>
              <a href="subject.html#728">[ subject ]</a>
              <a href="author.html#728">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,
I am a new user of Squid and would first like to thank the developers 
for this excellent software. This is my first post to the mailing list 
... I have been tasked with setting up quite restrictive web access 
control at work. I plan to use an intercepting squid proxy with SSL 
bump. There will also be WCCPv2 to/from a Cisco IOS router. Since this 
is quite a bit of complexity, I though it prudent to start slowly, in 
steps. So first -- to get my feet wet -- I set up squid (version 3.4.8, 
built using rpmbuild from the src rpm from ngtech) on a home linux 
server (Centos 5.11 -- no Cisco at home) which is also the firewall 
router for my home network. I also decided to start out with plain 
vanilla proxying (no interception -- use browser setting). This worked 
fine. I then tested HTTP interception by changing squid.conf from:
http_port 3128
   -to-
http_port 3128 intercept

and adding the following rule to my shorewall firewall:
REDIRECT:info   loc:192.168.101.9       3128    tcp     http

I wanted to test intercepting just one host before turning it on for all 
hosts and wireless devices in my network.

192.168.101.9 is another Centos PC on my network. Squid is running on 
192.168.101.253.

The interception seemed to work fine ... access.log showed lots of 
successful proxy activity. Then came the problem: going to 
<A HREF="https://www.google.com">https://www.google.com</A> failed (not every time, but frequently). If I 
turned off the REDIRECT line in the shorewall rules file and restarted 
shorewall, no problem. This seemed very peculiar because no HTTPS 
traffic should be redirected to the proxy. Here are the errors that 
showed up in cache.log when redirection (NAT-ing) was on:

2014/11/11 11:03:42 kid1| ERROR: NF getsockopt(ORIGINAL_DST) failed on 
local=192.168.101.253:3128 remote=192.168.101.9:34165 FD 11 flags=33: 
(92) Protocol not available

Note that other HTTPS sites worked fine! It appears to be confined to a 
google specific issue.

Thanks for any comments/suggestions you might have,
--peter




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000791.html">[squid-users] R: R: R: Problem with Squid 3.4 and transparent SSL proxy
</A></li>
	<LI>Next message (by thread): <A HREF="000731.html">[squid-users] Problem with https://www.google.com and squid	interception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#728">[ date ]</a>
              <a href="thread.html#728">[ thread ]</a>
              <a href="subject.html#728">[ subject ]</a>
              <a href="author.html#728">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
