<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Problem with https://www.google.com and squid	interception
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problem%20with%20https%3A//www.google.com%20and%20squid%0A%09interception&In-Reply-To=%3C5462D4AF.6060700%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000728.html">
   <LINK REL="Next"  HREF="000732.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Problem with https://www.google.com and squid	interception</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problem%20with%20https%3A//www.google.com%20and%20squid%0A%09interception&In-Reply-To=%3C5462D4AF.6060700%40treenet.co.nz%3E"
       TITLE="[squid-users] Problem with https://www.google.com and squid	interception">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Nov 12 03:31:59 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000728.html">[squid-users] Problem with https://www.google.com and squid	interception
</A></li>
        <LI>Next message (by thread): <A HREF="000732.html">[squid-users] Problem with https://www.google.com and	squid	interception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#731">[ date ]</a>
              <a href="thread.html#731">[ thread ]</a>
              <a href="subject.html#731">[ subject ]</a>
              <a href="author.html#731">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 12/11/2014 7:47 a.m., Peter Gross wrote:
&gt;<i> Hi, I am a new user of Squid and would first like to thank the
</I>&gt;<i> developers for this excellent software. This is my first post to
</I>&gt;<i> the mailing list ... I have been tasked with setting up quite
</I>&gt;<i> restrictive web access control at work. I plan to use an
</I>&gt;<i> intercepting squid proxy with SSL bump. There will also be WCCPv2
</I>&gt;<i> to/from a Cisco IOS router. Since this is quite a bit of
</I>&gt;<i> complexity, I though it prudent to start slowly, in steps. So first
</I>&gt;<i> -- to get my feet wet -- I set up squid (version 3.4.8, built using
</I>&gt;<i> rpmbuild from the src rpm from ngtech) on a home linux server
</I>&gt;<i> (Centos 5.11 -- no Cisco at home) which is also the firewall router
</I>&gt;<i> for my home network. I also decided to start out with plain vanilla
</I>&gt;<i> proxying (no interception -- use browser setting). This worked 
</I>&gt;<i> fine. I then tested HTTP interception by changing squid.conf from: 
</I>&gt;<i> http_port 3128 -to- http_port 3128 intercept
</I>
Please use a second http_port with a different number for each input
&quot;mode&quot;. Squid needs at least one forward-proxy port for things like
icons URLs in error pages - 3128 is the port number W3C allocated for
that.

&gt;<i> 
</I>&gt;<i> and adding the following rule to my shorewall firewall: 
</I>&gt;<i> REDIRECT:info   loc:192.168.101.9       3128    tcp     http
</I>&gt;<i> 
</I>&gt;<i> I wanted to test intercepting just one host before turning it on
</I>&gt;<i> for all hosts and wireless devices in my network.
</I>&gt;<i> 
</I>&gt;<i> 192.168.101.9 is another Centos PC on my network. Squid is running
</I>&gt;<i> on 192.168.101.253.
</I>&gt;<i> 
</I>&gt;<i> The interception seemed to work fine ... access.log showed lots of 
</I>&gt;<i> successful proxy activity. Then came the problem: going to 
</I>&gt;<i> <A HREF="https://www.google.com">https://www.google.com</A> failed (not every time, but frequently). If
</I>&gt;<i> I turned off the REDIRECT line in the shorewall rules file and
</I>&gt;<i> restarted shorewall, no problem. This seemed very peculiar because
</I>&gt;<i> no HTTPS traffic should be redirected to the proxy.
</I>
Correct. Very perculiar.

&gt;<i> Here are the errors that showed up in cache.log when redirection
</I>&gt;<i> (NAT-ing) was on:
</I>&gt;<i> 
</I>&gt;<i> 2014/11/11 11:03:42 kid1| ERROR: NF getsockopt(ORIGINAL_DST) failed
</I>&gt;<i> on local=192.168.101.253:3128 remote=192.168.101.9:34165 FD 11
</I>&gt;<i> flags=33: (92) Protocol not available
</I>
That is forward-proxy traffic going to the port with intercept on it.
Separating the ports should help you identify if this is error pages
embeded objects or not.


Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUYtSvAAoJELJo5wb/XPRjcJ0H/jeEbRpFJYp0v5nfTWlwdOTV
ajA2SpQ+3GY0s8iPX0FJnl2mFSfNVs5V+515/iOSGfEUhIS/+qGyWCqIjA79tTHy
dTx9eKOc1boF/7nadgfFl/60rpJprNfuosh9iIhkDShC3bNzz3y5lcPVyPi4bhKD
wkG/dT5GdUdVTVn1aA1cojebrJ2SUMe/NMyFdEADIyOLSNsDT000MMB4Mr3VnVBA
68nq6wdGdnK0/ydm/OvErruVgPqQGP/IvpdLaHw0+2ck2fYRlzgB9+6P1an24rDA
hgsn0sZ/MfIxJd/biC5Pk0gnNzapVI+n4E2NIx+F0aN/y2Bgn0+AncvEqKnSS3U=
=tp1A
-----END PGP SIGNATURE-----

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000728.html">[squid-users] Problem with https://www.google.com and squid	interception
</A></li>
	<LI>Next message (by thread): <A HREF="000732.html">[squid-users] Problem with https://www.google.com and	squid	interception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#731">[ date ]</a>
              <a href="thread.html#731">[ thread ]</a>
              <a href="subject.html#731">[ subject ]</a>
              <a href="author.html#731">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
