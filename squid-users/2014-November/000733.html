<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] connecting directly to ssl-bump intercept port causes	runaway CPU
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20connecting%20directly%20to%20ssl-bump%20intercept%20port%20causes%0A%09runaway%20CPU&In-Reply-To=%3C5462E6CE.7040506%40trimble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000751.html">
   <LINK REL="Next"  HREF="000734.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] connecting directly to ssl-bump intercept port causes	runaway CPU</H1>
    <B>Jason Haar</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20connecting%20directly%20to%20ssl-bump%20intercept%20port%20causes%0A%09runaway%20CPU&In-Reply-To=%3C5462E6CE.7040506%40trimble.com%3E"
       TITLE="[squid-users] connecting directly to ssl-bump intercept port causes	runaway CPU">Jason_Haar at trimble.com
       </A><BR>
    <I>Wed Nov 12 04:49:18 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000751.html">[squid-users] Problem with https://www.google.com and squid	interception
</A></li>
        <LI>Next message (by thread): <A HREF="000734.html">[squid-users] connecting directly to ssl-bump intercept port causes runaway CPU
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#733">[ date ]</a>
              <a href="thread.html#733">[ thread ]</a>
              <a href="subject.html#733">[ subject ]</a>
              <a href="author.html#733">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi there

I was reading this list about the issue with google.com and was playing
around - and I used telnet to connect directly to the intercept ssl-bump
port. End result was squid immediately went to 99% CPU, and the
cache.log started reporting

WARNING! Your cache is running out of filedescriptors
WARNING! Your cache is running out of filedescriptors
WARNING! Your cache is running out of filedescriptors

The box staggered to it's knees, so I had to kill squid. Restarted it
and everything is fine - until I do that again. If I let the network
redirecting work (ie make outbound port 443 connections), this doesn't
happen - it's only if I directly connect to the intercept port

I have my &quot;http_port intercept&quot; and &quot;https_port intercept&quot; set
identically (except for the ssl stuff of course), and yet if I telnet to
the http_port set to intercept, this does NOT happen - it works fine...

Any ideas where I should look to see what's causing the grief? This is
squid-3.4.9. &quot;127.0.0.1&quot; is in /etc/squid/SSL_noIntercept_sites.txt, but
not the ethernet IP nor hostname of the proxy if that matters.

#egrep '^(https?_port|ssl)|SSL_nonHTTPS|SSL_noInter' /etc/squid/squid.conf
http_port 3128
http_port 3126 ssl-bump cert=/etc/squid/squid-CA.cert 
capath=/etc/ssl/certs/ generate-host-certificates=on
dynamic_cert_mem_cache_size=256MB options=ALL
http_port 3129 intercept
https_port 3127 intercept ssl-bump cert=/etc/squid/squid-CA.cert 
capath=/etc/ssl/certs/ generate-host-certificates=on
dynamic_cert_mem_cache_size=256MB options=ALL
sslcrtd_program /usr/lib64/squid/ssl_crtd -s /var/lib/ssl_db -M 4MB
sslcrtd_children 32 startup=5 idle=1
acl SSL_nonHTTPS_sites dstdom_regex &quot;/etc/squid/SSL_nonHTTPS_sites.txt&quot;
acl SSL_noIntercept_sites dstdom_regex
&quot;/etc/squid/SSL_noIntercept_sites.txt&quot;
ssl_bump none SSL_nonHTTPS_sites
ssl_bump none SSL_noIntercept_sites
ssl_bump server-first all
sslproxy_cert_error allow SSL_nonHTTPS_sites
sslproxy_cert_error allow all

-- 
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000751.html">[squid-users] Problem with https://www.google.com and squid	interception
</A></li>
	<LI>Next message (by thread): <A HREF="000734.html">[squid-users] connecting directly to ssl-bump intercept port causes runaway CPU
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#733">[ date ]</a>
              <a href="thread.html#733">[ thread ]</a>
              <a href="subject.html#733">[ subject ]</a>
              <a href="author.html#733">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
