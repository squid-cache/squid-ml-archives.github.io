<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Troubles compiling latest Squid 3.5 on Windows 7 with Cygwin
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Troubles%20compiling%20latest%20Squid%203.5%20on%20Windows%207%0A%20with%20Cygwin&In-Reply-To=%3C54634FE0.1020907%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000736.html">
   <LINK REL="Next"  HREF="000737.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Troubles compiling latest Squid 3.5 on Windows 7 with Cygwin</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Troubles%20compiling%20latest%20Squid%203.5%20on%20Windows%207%0A%20with%20Cygwin&In-Reply-To=%3C54634FE0.1020907%40treenet.co.nz%3E"
       TITLE="[squid-users] Troubles compiling latest Squid 3.5 on Windows 7 with Cygwin">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Nov 12 12:17:36 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000736.html">[squid-users] Troubles compiling latest Squid 3.5 on Windows 7 with	Cygwin
</A></li>
        <LI>Next message (by thread): <A HREF="000737.html">[squid-users] Cannot purge items that are not upstream anymore
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#738">[ date ]</a>
              <a href="thread.html#738">[ thread ]</a>
              <a href="subject.html#738">[ subject ]</a>
              <a href="author.html#738">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 12/11/2014 10:36 p.m., Rafael Akchurin wrote:
&gt;<i> Hello all,
</I>&gt;<i> 
</I>&gt;<i> I am struggling to compile Squid 3.5 on windows 7 x64 using latest
</I>&gt;<i> Cygwin.
</I>&gt;<i> 
</I>&gt;<i> During configuration (./configure --disable-wccp --disable-wccpv2)
</I>
NP: the current 3.5 should need NO special options to build on Windows.


&gt;<i> The following error occurs:
</I>&gt;<i> 
</I>&gt;<i> checking for ldap.h... (cached) yes checking winldap.h usability...
</I>&gt;<i> no checking winldap.h presence... yes configure: WARNING:
</I>&gt;<i> winldap.h: present but cannot be compiled configure: WARNING:
</I>&gt;<i> winldap.h: check for missing prerequisite headers? configure:
</I>&gt;<i> WARNING: winldap.h: see the Autoconf documentation configure:
</I>&gt;<i> WARNING: winldap.h: section &quot;Present But Cannot Be Compiled&quot; 
</I>&gt;<i> configure: WARNING: winldap.h: proceeding with the compiler's
</I>&gt;<i> result configure: WARNING: ##
</I>&gt;<i> ------------------------------------------- ## configure: WARNING:
</I>&gt;<i> ## Report this to <A HREF="http://bugs.squid-cache.org/">http://bugs.squid-cache.org/</A> ## configure:
</I>&gt;<i> WARNING: ## ------------------------------------------- ## checking
</I>&gt;<i> for winldap.h... no checking w32api/windows.h usability... yes
</I>&gt;<i> 
</I>&gt;<i> Similar with mswsock:
</I>&gt;<i> 
</I>&gt;<i> checking mswsock.h usability... no checking mswsock.h presence...
</I>&gt;<i> yes configure: WARNING: mswsock.h: present but cannot be compiled 
</I>&gt;<i> configure: WARNING: mswsock.h: check for missing prerequisite
</I>&gt;<i> headers? configure: WARNING: mswsock.h: see the Autoconf
</I>&gt;<i> documentation configure: WARNING: mswsock.h: section &quot;Present But
</I>&gt;<i> Cannot Be Compiled&quot; configure: WARNING: mswsock.h: proceeding with
</I>&gt;<i> the compiler's result configure: WARNING: ##
</I>&gt;<i> ------------------------------------------- ## configure: WARNING:
</I>&gt;<i> ## Report this to <A HREF="http://bugs.squid-cache.org/">http://bugs.squid-cache.org/</A> ## configure:
</I>&gt;<i> WARNING: ## ------------------------------------------- ## checking
</I>&gt;<i> for mswsock.h... no
</I>&gt;<i> 
</I>
Sigh. OS headers not including their own basic dependencies. Evil
practice even in C.

The winldap.h not being found usable should only prevent the LDAP
helpers being built, not a big issue perhapse.

The absence of mswsock.h is probably involved with those later build
errors. It usually contains a lot of definitions needed for the FD and
socket API. If you can find out what it requires to be icluded before
it in the .cc file, please let me know.


&gt;<i> If I run &quot;make&quot; after that it fails at start:
</I>&gt;<i> 
</I>&gt;<i> Making all in compat make[1]: Entering directory
</I>&gt;<i> '/usr/src/squid-3.5.0.1/compat' /bin/sh ../libtool  --tag=CXX
</I>&gt;<i> --mode=compile g++ -DHAVE_CONFIG_H   -I.. -I../include -I../lib
</I>&gt;<i> -I../src -I../include     -Wall -Wpointer-arith -Wwrite-strings
</I>&gt;<i> -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -g -O2 -march=native
</I>&gt;<i> -std=c++11 -MT assert.lo -MD -MP -MF .deps/assert.Tpo -c -o
</I>&gt;<i> assert.lo assert.cc libtool: compile:  g++ -DHAVE_CONFIG_H -I..
</I>&gt;<i> -I../include -I../lib -I../src -I../include -Wall -Wpointer-arith
</I>&gt;<i> -Wwrite-strings -Wcomments -Wshadow -Werror -pipe -D_REENTRANT -g
</I>&gt;<i> -O2 -march=native -std=c++11 -MT assert.lo -MD -MP -MF
</I>&gt;<i> .deps/assert.Tpo -c assert.cc  -DDLL_EXPORT -DPIC -o
</I>&gt;<i> .libs/assert.o In file included from
</I>&gt;<i> /usr/include/w32api/winsock2.h:56:0, from
</I>&gt;<i> /usr/include/w32api/ws2spi.h:13, from
</I>&gt;<i> ../compat/os/mswindows.h:306, from ../compat/compat.h:73, from
</I>&gt;<i> ../include/squid.h:43, from assert.cc:9: 
</I>&gt;<i> /usr/include/w32api/psdk_inc/_fd_types.h:100:2: error: #warning
</I>&gt;<i> &quot;fd_set and associated macros have been defined in sys/types.
</I>&gt;<i> This can cause runtime problems with W32 sockets&quot; [-Werror=cpp] 
</I>&gt;<i> #warning &quot;fd_set and associated macros have been defined in
</I>&gt;<i> sys/types.  \ ^
</I>
No idea at this point what the correct fix is here. There is a bit of
a catch-22 situation going on with fd_set. With any luck is and the
below might disappear once mswsock.h is found.


&gt;<i> In file included from ../compat/compat.h:73:0, from
</I>&gt;<i> ../include/squid.h:43, from assert.cc:9: 
</I>&gt;<i> ../compat/os/mswindows.h:417:0: error: &quot;FOPEN&quot; redefined [-Werror] 
</I>&gt;<i> #define FOPEN           0x01    /* file handle open */
</I>
Fixed this one.

&gt;<i> ^ In file included from /usr/include/w32api/ws2spi.h:13:0, from
</I>&gt;<i> ../compat/os/mswindows.h:306, from ../compat/compat.h:73, from
</I>&gt;<i> ../include/squid.h:43, from assert.cc:9: 
</I>&gt;<i> /usr/include/w32api/winsock2.h:995:123: error: declaration of C
</I>&gt;<i> function 'int select(int, _types_fd_set*, _types_fd_set*,
</I>&gt;<i> _types_fd_set*, PTIMEVAL)' conflicts with WINSOCK_API_LINKAGE int
</I>&gt;<i> WSAAPI select(int nfds,fd_set *readfds,fd_set *writefds,fd_set
</I>&gt;<i> *exceptfds,const PTIMEVAL timeout); ^ In file included from
</I>&gt;<i> ../compat/types.h:41:0, from ../compat/compat.h:59, from
</I>&gt;<i> ../include/squid.h:43, from assert.cc:9: 
</I>&gt;<i> /usr/include/sys/select.h:31:5: error: previous declaration 'int
</I>&gt;<i> select(int, _types_fd_set*, _types_fd_set*, _types_fd_set*,
</I>&gt;<i> timeval*)' here int select __P ((int __n, fd_set *__readfds, fd_set
</I>&gt;<i> *__writefds, ^ In file included from ../compat/compat.h:73:0, from
</I>&gt;<i> ../include/squid.h:43, from assert.cc:9:
</I>&gt;<i> 
</I>&gt;<i> Is this a known issue or am I doing something wrong? Please note
</I>&gt;<i> the same commands compile Squid 3.3.8 (from Cygwin) without any
</I>&gt;<i> problems.
</I>&gt;<i> 
</I>
No to both questions.

A lot has changed in the Windows support since 3.3. The
Windows-specific code has had a lot of shuffling around and testing
under MinGW. You are the first Cygwin person to report anything about
issues in the post-3.3 versions.

The Cygwin situation is kind of being tracked in
<A HREF="http://bugs.squid-cache.org/show_bug.cgi?id=4073.">http://bugs.squid-cache.org/show_bug.cgi?id=4073.</A> If you can update
the bug report it would be a help.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUY0/fAAoJELJo5wb/XPRjyf8H/jTYfUq1b9LDgJmDtAGsuyVA
4l7i3Tn6sZEfIny6iS7rPIT55cdB6ku/7A81f85tcY2nzfYbRcH00ccLtPhtvEb0
WcwYrxMYOWXOGy9lT5SO0h+aT4a5eoaxcgGR34+Ekiphji2Hs8INYtcXVo0tnlap
GZ8wV3WNNyqXhTkzdqZO8S98LcBDGYxBp1qeRtcsk9+syW9mapC5vJcqzEf2rwCr
FbU0sE+yNvA67pVGxTqxokcRX0bU3VZtwgNCdtmNGXZ+6UFtDrUe5ewNJeW0I34B
rAcoAoZ1grI4iA0TN9evGBM4XtAIlKZTV82Qtz5WGm5bfopzCtXIAKNd9Q9IkJo=
=S5SL
-----END PGP SIGNATURE-----

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000736.html">[squid-users] Troubles compiling latest Squid 3.5 on Windows 7 with	Cygwin
</A></li>
	<LI>Next message (by thread): <A HREF="000737.html">[squid-users] Cannot purge items that are not upstream anymore
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#738">[ date ]</a>
              <a href="thread.html#738">[ thread ]</a>
              <a href="subject.html#738">[ subject ]</a>
              <a href="author.html#738">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
