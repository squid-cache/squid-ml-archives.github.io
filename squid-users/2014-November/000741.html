<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Cannot purge items that are not upstream anymore
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Cannot%20purge%20items%20that%20are%20not%20upstream%20anymore&In-Reply-To=%3C8429980.HusbksOlJk%40hades%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000740.html">
   <LINK REL="Next"  HREF="000743.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Cannot purge items that are not upstream anymore</H1>
    <B>Hussam Al-Tayeb</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Cannot%20purge%20items%20that%20are%20not%20upstream%20anymore&In-Reply-To=%3C8429980.HusbksOlJk%40hades%3E"
       TITLE="[squid-users] Cannot purge items that are not upstream anymore">hussam at visp.net.lb
       </A><BR>
    <I>Wed Nov 12 12:55:24 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000740.html">[squid-users] Cannot purge items that are not upstream anymore
</A></li>
        <LI>Next message (by thread): <A HREF="000743.html">[squid-users] Cannot purge items that are not upstream anymore
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#741">[ date ]</a>
              <a href="thread.html#741">[ thread ]</a>
              <a href="subject.html#741">[ subject ]</a>
              <a href="author.html#741">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thursday 13 November 2014 01:39:27 Amos Jeffries wrote:
&gt;<i> On 13/11/2014 12:17 a.m., Hussam Al-Tayeb wrote:
</I>&gt;<i> &gt; Hello. I have a problem with 'squidclient -m PURGE' and also the
</I>&gt;<i> &gt; purge command. They won't purge urls from disk that are not
</I>&gt;<i> &gt; available online anymore or redirect to other links.
</I>&gt;<i> 
</I>&gt;<i> PURGE was designed for use in HTTP/1.0. It does not handle HTTP/1.1
</I>&gt;<i> negotiated content / variants at all well.
</I>&gt;<i> 
</I>&gt;<i> &gt; For example,
</I>&gt;<i> &gt; <A HREF="http://static.firedrive.com/dynamic/previews/75/27577be2d6d86af20265734b64">http://static.firedrive.com/dynamic/previews/75/27577be2d6d86af20265734b64</A>
</I>&gt;<i> &gt; e8d563.jpg
</I>&gt;<i> which corresponds to /home/squid/00/BB/0000BBC0
</I>&gt;<i> 
</I>&gt;<i> &gt; Even &quot;purge -e &quot;static.firedrive.com&quot; -c /etc/squid/squid.conf -P
</I>&gt;<i> &gt; 0x01&quot; reads it but will not really remove it from disk. Are such
</I>&gt;<i> &gt; files stuck on disk forever?
</I>&gt;<i> 
</I>&gt;<i> No. Cache is a temporary storage location. Think of it as a buffer in
</I>&gt;<i> the network.
</I>&gt;<i> 
</I>&gt;<i> They will exist only until a) the storage space is needed for
</I>&gt;<i> something else, or b) the timestamp in their Expires: header, or c) an
</I>&gt;<i> origin server informs Squid they are no longer existing.
</I>&gt;<i> 
</I>&gt;<i> PURGE method was a way to fake (c).
</I>&gt;<i> 
</I>&gt;<i> &gt; What would the correct way to clear them?
</I>&gt;<i> 
</I>&gt;<i> By obeying HTTP protocol. HTTP has built-in mechanisms for doing that
</I>&gt;<i> automatically.
</I>&gt;<i> 
</I>&gt;<i> Or you can just delete the disk file. Squid will auto-detect the
</I>&gt;<i> removal at some point when it needs to use or delete the object. Until
</I>&gt;<i> then it will just under-count the amount of used disk.
</I>&gt;<i> 
</I>&gt;<i> Amos
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

head /home/squid/00/BB/0000BBC0 -n20

&#65533;u&#65533;&#65533;(&#9618;&#65533;&#65533;,&#65533;|&#65533;S&#65533;|
&#65533;S&#65533;&#65533;f7&#65533;P`<A HREF="Uhttp://static.firedrive.com/dynamic/previews/75/27577be2d6d86af20265734b64e8d563.jpg">Uhttp://static.firedrive.com/dynamic/previews/75/27577be2d6d86af20265734b64e8d563.jpg</A>
R&quot;accept-encoding=&quot;gzip,%20deflate&quot;HTTP/1.1 200 OK
Date: Tue, 26 Aug 2014 12:25:13 GMT
Content-Type: image/jpeg
Last-Modified: Wed, 31 Oct 2012 06:12:07 GMT
ETag: &quot;5090c137-2efb&quot;
Expires: Fri, 23 Aug 2024 12:25:13 GMT
Cache-Control: public, max-age=315360000
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST, OPTIONS
Access-Control-Allow-Headers: Origin,Referer,Accept-Encoding,Accept-
Language,Accept,DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-
Modified-Since,Cache-Control,Content-Type,X-Forwarded-For,X-Forwarded-Proto
CF-Cache-Status: HIT
Vary: Accept-Encoding
Accept-Ranges: bytes
Server: cloudflare-nginx
CF-RAY: 160002c2e4730887-FRA
Content-Length: 12027
Connection: Keep-Alive
Set-Cookie: __cfduid=dfcf568ed46ef827243b3d6c342b3bdc41409055913424; 
expires=Mon, 23-Dec-2019 23:50:00 GMT; path=/; domain=.firedrive.com; HttpOnly


The Expires header is in the past.  
&quot;<A HREF="http://static.firedrive.com/dynamic/previews/75/27577be2d6d86af20265734b64e8d563.jpg">http://static.firedrive.com/dynamic/previews/75/27577be2d6d86af20265734b64e8d563.jpg</A>&quot;
Sending HTTP request ... done.
HTTP/1.1 404 Not Found
Server: squid
Mime-Version: 1.0
Date: Wed, 12 Nov 2014 12:54:13 GMT
Content-Length: 0
X-Cache: MISS from SERV1
X-Cache-Lookup: NONE from SERV1:3129
Via: 1.1 SERV1 (squid)
Connection: close

Is that why  squidclient -m PURGE -h 127.0.0.1 -p 3129 says not found in 
cache?


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000740.html">[squid-users] Cannot purge items that are not upstream anymore
</A></li>
	<LI>Next message (by thread): <A HREF="000743.html">[squid-users] Cannot purge items that are not upstream anymore
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#741">[ date ]</a>
              <a href="thread.html#741">[ thread ]</a>
              <a href="subject.html#741">[ subject ]</a>
              <a href="author.html#741">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
