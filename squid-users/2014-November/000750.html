<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Problem with https://www.google.com and	squid	interception
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problem%20with%20https%3A//www.google.com%20and%0A%09squid%09interception&In-Reply-To=%3C5463952C.3010001%40nanosec.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000732.html">
   <LINK REL="Next"  HREF="000751.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Problem with https://www.google.com and	squid	interception</H1>
    <B>Peter Gross</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problem%20with%20https%3A//www.google.com%20and%0A%09squid%09interception&In-Reply-To=%3C5463952C.3010001%40nanosec.com%3E"
       TITLE="[squid-users] Problem with https://www.google.com and	squid	interception">pag at nanosec.com
       </A><BR>
    <I>Wed Nov 12 17:13:16 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000732.html">[squid-users] Problem with https://www.google.com and	squid	interception
</A></li>
        <LI>Next message (by thread): <A HREF="000751.html">[squid-users] Problem with https://www.google.com and squid	interception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#750">[ date ]</a>
              <a href="thread.html#750">[ thread ]</a>
              <a href="subject.html#750">[ subject ]</a>
              <a href="author.html#750">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/11/2014 9:05 PM, Yogesh Gawankar wrote:
&gt;<i> hello peter
</I>&gt;<i>
</I>&gt;<i> can you check if your squid does gre return?
</I>
Yohesh -- there are no Cisco routers in my home network, so no GRE. I 
will be using GRE when/if I configure squid at work since we have Cisco 
routers/switches in that network.

&gt;<i> It is unrelated to your issue though :)
</I>&gt;<i> *Thanks and regards
</I>&gt;<i>
</I>&gt;<i> Yogesh Gawankar*
</I>&gt;<i>
</I>&gt;<i> **
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Wednesday, November 12, 2014 9:02 AM, Amos Jeffries
</I>&gt;<i> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i> Hash: SHA1
</I>&gt;<i>
</I>&gt;<i> On 12/11/2014 7:47 a.m., Peter Gross wrote:
</I>&gt;<i>  &gt; Hi, I am a new user of Squid and would first like to thank the
</I>&gt;<i>  &gt; developers for this excellent software. This is my first post to
</I>&gt;<i>  &gt; the mailing list ... I have been tasked with setting up quite
</I>&gt;<i>  &gt; restrictive web access control at work. I plan to use an
</I>&gt;<i>  &gt; intercepting squid proxy with SSL bump. There will also be WCCPv2
</I>&gt;<i>  &gt; to/from a Cisco IOS router. Since this is quite a bit of
</I>&gt;<i>  &gt; complexity, I though it prudent to start slowly, in steps. So first
</I>&gt;<i>  &gt; -- to get my feet wet -- I set up squid (version 3.4.8, built using
</I>&gt;<i>  &gt; rpmbuild from the src rpm from ngtech) on a home linux server
</I>&gt;<i>  &gt; (Centos 5.11 -- no Cisco at home) which is also the firewall router
</I>&gt;<i>  &gt; for my home network. I also decided to start out with plain vanilla
</I>&gt;<i>  &gt; proxying (no interception -- use browser setting). This worked
</I>&gt;<i>  &gt; fine. I then tested HTTP interception by changing squid.conf from:
</I>&gt;<i>  &gt; http_port 3128 -to- http_port 3128 intercept
</I>&gt;<i>
</I>&gt;<i> Please use a second http_port with a different number for each input
</I>&gt;<i> &quot;mode&quot;. Squid needs at least one forward-proxy port for things like
</I>&gt;<i> icons URLs in error pages - 3128 is the port number W3C allocated for
</I>&gt;<i> that.
</I>&gt;<i>
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; and adding the following rule to my shorewall firewall:
</I>&gt;<i>  &gt; REDIRECT:info  loc:192.168.101.9      3128    tcp    http
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; I wanted to test intercepting just one host before turning it on
</I>&gt;<i>  &gt; for all hosts and wireless devices in my network.
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; 192.168.101.9 is another Centos PC on my network. Squid is running
</I>&gt;<i>  &gt; on 192.168.101.253.
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; The interception seemed to work fine ... access.log showed lots of
</I>&gt;<i>  &gt; successful proxy activity. Then came the problem: going to
</I>&gt;<i>  &gt; <A HREF="https://www.google.com">https://www.google.com</A> &lt;<A HREF="https://www.google.com/">https://www.google.com/</A>&gt;failed (not every
</I>&gt;<i> time, but frequently). If
</I>&gt;<i>  &gt; I turned off the REDIRECT line in the shorewall rules file and
</I>&gt;<i>  &gt; restarted shorewall, no problem. This seemed very peculiar because
</I>&gt;<i>  &gt; no HTTPS traffic should be redirected to the proxy.
</I>&gt;<i>
</I>&gt;<i> Correct. Very perculiar.
</I>&gt;<i>
</I>&gt;<i>  &gt; Here are the errors that showed up in cache.log when redirection
</I>&gt;<i>  &gt; (NAT-ing) was on:
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; 2014/11/11 11:03:42 kid1| ERROR: NF getsockopt(ORIGINAL_DST) failed
</I>&gt;<i>  &gt; on local=192.168.101.253:3128 remote=192.168.101.9:34165 FD 11
</I>&gt;<i>  &gt; flags=33: (92) Protocol not available
</I>&gt;<i>
</I>&gt;<i> That is forward-proxy traffic going to the port with intercept on it.
</I>&gt;<i> Separating the ports should help you identify if this is error pages
</I>&gt;<i> embeded objects or not.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i> -----BEGIN PGP SIGNATURE-----
</I>&gt;<i> Version: GnuPG v2.0.22 (MingW32)
</I>&gt;<i>
</I>&gt;<i> iQEcBAEBAgAGBQJUYtSvAAoJELJo5wb/XPRjcJ0H/jeEbRpFJYp0v5nfTWlwdOTV
</I>&gt;<i> ajA2SpQ+3GY0s8iPX0FJnl2mFSfNVs5V+515/iOSGfEUhIS/+qGyWCqIjA79tTHy
</I>&gt;<i> dTx9eKOc1boF/7nadgfFl/60rpJprNfuosh9iIhkDShC3bNzz3y5lcPVyPi4bhKD
</I>&gt;<i> wkG/dT5GdUdVTVn1aA1cojebrJ2SUMe/NMyFdEADIyOLSNsDT000MMB4Mr3VnVBA
</I>&gt;<i> 68nq6wdGdnK0/ydm/OvErruVgPqQGP/IvpdLaHw0+2ck2fYRlzgB9+6P1an24rDA
</I>&gt;<i> hgsn0sZ/MfIxJd/biC5Pk0gnNzapVI+n4E2NIx+F0aN/y2Bgn0+AncvEqKnSS3U=
</I>&gt;<i> =tp1A
</I>&gt;<i> -----END PGP SIGNATURE-----
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000732.html">[squid-users] Problem with https://www.google.com and	squid	interception
</A></li>
	<LI>Next message (by thread): <A HREF="000751.html">[squid-users] Problem with https://www.google.com and squid	interception
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#750">[ date ]</a>
              <a href="thread.html#750">[ thread ]</a>
              <a href="subject.html#750">[ subject ]</a>
              <a href="author.html#750">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
