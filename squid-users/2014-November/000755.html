<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] cache peer problem with two squid one Tproxy	---&gt;normal Porxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20cache%20peer%20problem%20with%20two%20squid%20one%20Tproxy%0A%09---%3Enormal%20Porxy&In-Reply-To=%3C001201cfff0c%248a09eb30%249e1dc190%24%40netstream.ps%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000747.html">
   <LINK REL="Next"  HREF="000764.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] cache peer problem with two squid one Tproxy	---&gt;normal Porxy</H1>
    <B>Ahmed Allzaeem</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20cache%20peer%20problem%20with%20two%20squid%20one%20Tproxy%0A%09---%3Enormal%20Porxy&In-Reply-To=%3C001201cfff0c%248a09eb30%249e1dc190%24%40netstream.ps%3E"
       TITLE="[squid-users] cache peer problem with two squid one Tproxy	---&gt;normal Porxy">ahmed.zaeem at netstream.ps
       </A><BR>
    <I>Thu Nov 13 06:39:11 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000747.html">[squid-users] cache peer problem with two squid one Tproxy ---&gt;normal Porxy
</A></li>
        <LI>Next message (by thread): <A HREF="000764.html">[squid-users] cache peer problem with two squid one Tproxy ---&gt;normal Porxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#755">[ date ]</a>
              <a href="thread.html#755">[ thread ]</a>
              <a href="subject.html#755">[ subject ]</a>
              <a href="author.html#755">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi amos 

I have changed the both hostnames on two servers :

[<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at tproxy</A> ~]# hostname
tproxy.com


[<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at parent</A> ~]# hostname
parent.com


but , as I told u last time
I can see traffic &quot;miss&quot; on the normal proxy , and &quot;miss&quot; on the tproxy server.

But it says access denied  from normal proxy 

I mean on the normal proxy &quot;parent&quot; there is only miss and no Denied hits , but it give me error access denid.

Also I made sure that the ip of tproxy is allowed by acl on the normal proxy&quot;parent&quot;


Again , here is the  cache log @ the parent proxy , still says a loop occurring :

2014/11/12 23:33:24 kid1| WARNING: Forwarding loop detected for:
GET / HTTP/1.1
Host: abc.com
User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:33.0) Gecko/20100101 Firefox/33.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Via: 1.1 squid (squid/3.4.3)
X-Forwarded-For: 176.58.79.248
Cache-Control: max-age=259200
Connection: keep-alive


2014/11/12 23:33:24 kid1| WARNING: Forwarding loop detected for:
GET /Artwork/SN.png HTTP/1.1
Host: www.squid-cache.org
User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:33.0) Gecko/20100101 Firefox/33.0
Accept: image/png,image/*;q=0.8,*/*;q=0.5
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: <A HREF="http://abc.com/">http://abc.com/</A>
Via: 1.1 squid (squid/3.4.3)
X-Forwarded-For: 176.58.79.248
Cache-Control: max-age=259200
Connection: keep-alive


Why there is a loop still ???








-----Original Message-----
From: Amos Jeffries [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>] 
Sent: Wednesday, November 12, 2014 6:37 AM
To: Ahmed Allzaeem; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] cache peer problem with two squid one Tproxy ---&gt;normal Porxy

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 13/11/2014 1:02 p.m., Ahmed Allzaeem wrote:
&gt;<i> Thanks amos
</I>&gt;<i> 
</I>&gt;<i> I have added option notproxy on the tproxy one It became : 
</I>&gt;<i> cache_peer 77.221.104.97  parent 3127 0 no-tproxy
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> also I changed hostnames in /etc.hosts for both servers and added 
</I>&gt;<i> visible hostname  squid for both
</I>
/etc/hosts is for resolving *other* machines IPs/names.

/etc/hostname is where the server host name is configured. Or if you are using a GUI it may need to be done via one of the control panels to ensure it gets set properly.


&gt;<i> 
</I>&gt;<i> now on the normal proxy I can see the logs access
</I>&gt;<i> 
</I>&gt;<i> but still not traffic it give me access denied from the parent proxy 
</I>&gt;<i> ?!! any help ?
</I>
Find out why the denial. It could be the hostname still, or the first proxies outbound IP vs. your second proxies http_access rules, or it could even be coming from the origin server out on the Internet.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUY3BzAAoJELJo5wb/XPRjhvYH/1T5cl+N8CSRzFTvcDyW7gmZ
mIohmmQJUOS1seudbO0NrMjOuwHkaWZKNz2Obrwyk3vLTeV2OYPaM9CB4XlYOuDM
XrwyPAdSexKvtimrSVO2sGjpYy4tx2vZ58cTIgkS0LPqVDCY4+QTCRgX1UbDrUQ+
SALieUD1JTJDcE9L7l/xA/oRndINTeT3/J3aeNRvx32l5gOsMRmreGgmHiCLZo/1
N2Dfl2xDxzD+1Z1OMY5DaV/zh7kA5jpKUgOz3W7kMSq6kdKtmZSzcXz8tlyoKsP8
/WjQqr/eIfV4kFuLj2Ymw4euAZPUJfL926uFoEqhBdz24RgS/g9T1KW7mp0deeI=
=IJ+G
-----END PGP SIGNATURE-----


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000747.html">[squid-users] cache peer problem with two squid one Tproxy ---&gt;normal Porxy
</A></li>
	<LI>Next message (by thread): <A HREF="000764.html">[squid-users] cache peer problem with two squid one Tproxy ---&gt;normal Porxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#755">[ date ]</a>
              <a href="thread.html#755">[ thread ]</a>
              <a href="subject.html#755">[ subject ]</a>
              <a href="author.html#755">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
