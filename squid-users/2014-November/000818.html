<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ssl callout helper
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ssl%20callout%20helper&In-Reply-To=%3C07a61e8144ec4e75888e8ce16dcc8c2e%40HKNPR04MB0388.apcprd04.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000815.html">
   <LINK REL="Next"  HREF="000829.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ssl callout helper</H1>
    <B>James Harper</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ssl%20callout%20helper&In-Reply-To=%3C07a61e8144ec4e75888e8ce16dcc8c2e%40HKNPR04MB0388.apcprd04.prod.outlook.com%3E"
       TITLE="[squid-users] ssl callout helper">james at ejbdigital.com.au
       </A><BR>
    <I>Sun Nov 16 01:12:02 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000815.html">[squid-users] Question on setting up squid with Parent that is off-site?
</A></li>
        <LI>Next message (by thread): <A HREF="000829.html">[squid-users] ssl callout helper
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#818">[ date ]</a>
              <a href="thread.html#818">[ thread ]</a>
              <a href="subject.html#818">[ subject ]</a>
              <a href="author.html#818">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've written a little helper to do ssl callouts to determine if the server is running ssl at all (eg not tunnelling over ssl), and also to be able to do limited ACL on CN/SAN. The main limitation is the way larger organisations will often have one SSL cert that covers many URLS (eg google cert also covers google.com, youtube.com etc).

Currently I need to do it like:

external_acl_type cert_callout %DST %PORT /usr/local/squid/libexec/ext_cert_callout_acl

acl banks dstdomain .bigbank.com
acl banks dstdomain .otherbank.com

acl is_ssl external cert_callout IS_SSL
acl banks_callout external cert_callout SAN .bigbank.com
acl banks_callout external cert_callout SAN .otherbank.com

ssl_bump splice !is_ssl
ssl_bump splice banks
ssl_bump splice banks_callout
ssl_bump bump all

But I'd rather not have to maintain the banks and the banks_callout lists separately when they are identical. Apart from sticking them in a separate file, are there any shortcuts I can take?

Also, it would be good if squid could make use of the CN from the certificate for logging, so instead of &quot;CONNECT &lt;IP&gt;:&lt;PORT&gt;&quot;, I could log &quot;CONNECT &lt;CN&gt;:&lt;PORT&gt;&quot;, which would really clean up the logs (apart from the cases mentioned above). I think I can use tag= or log=, but that would preclude me from using them for anything else (I'm not using them for anything else at the moment but still...)

Thanks

James

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000815.html">[squid-users] Question on setting up squid with Parent that is off-site?
</A></li>
	<LI>Next message (by thread): <A HREF="000829.html">[squid-users] ssl callout helper
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#818">[ date ]</a>
              <a href="thread.html#818">[ thread ]</a>
              <a href="subject.html#818">[ subject ]</a>
              <a href="author.html#818">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
