<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid cache Large rock with aufs optimization for	bandwidth saving
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20cache%20Large%20rock%20with%20aufs%20optimization%20for%0A%09bandwidth%20saving&In-Reply-To=%3C002d01d001fd%2426473960%2472d5ac20%24%40netstream.ps%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000820.html">
   <LINK REL="Next"  HREF="000828.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid cache Large rock with aufs optimization for	bandwidth saving</H1>
    <B>Ahmed Allzaeem</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20cache%20Large%20rock%20with%20aufs%20optimization%20for%0A%09bandwidth%20saving&In-Reply-To=%3C002d01d001fd%2426473960%2472d5ac20%24%40netstream.ps%3E"
       TITLE="[squid-users] squid cache Large rock with aufs optimization for	bandwidth saving">ahmed.zaeem at netstream.ps
       </A><BR>
    <I>Mon Nov 17 00:26:35 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000820.html">[squid-users] squid cache Large rock with aufs optimization for bandwidth saving
</A></li>
        <LI>Next message (by thread): <A HREF="000828.html">[squid-users] squid cache Large rock with aufs optimization for bandwidth saving
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#821">[ date ]</a>
              <a href="thread.html#821">[ thread ]</a>
              <a href="subject.html#821">[ subject ]</a>
              <a href="author.html#821">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Amos , thanks for reply.

But I think using large rock will let the memory cache size be &gt;32 ??? am  I correct ?

I mean although im not using rock store , but I was thinking will have memory size &gt;32Kb

So , I keep the aufs size which I assume will help me and will let me break the 32kB limitation .. but it seems not like I was planning !!!!

So m my previous config was using aufs with large rock needed in memory size which is not what I was planning ?!!!! can you plz explain me why my previous config don&#8217;t have luck with memory &gt;&gt; 32KB??




So for now , as u told me I removed all aufs drivers and added only rock dir as below :

cache_dir rock /ssd1 90000 max-size=32768 swap-timeout=350 max-swap-rate=350
cache_dir rock /ssd2 90000 max-size=32768 swap-timeout=350 max-swap-rate=350
cache_dir rock /ssd3 90000 max-size=32768 swap-timeout=350 max-swap-rate=350 
cache_dir rock /ssd4 30000 max-size=32768 swap-timeout=350 max-swap-rate=350  


And only mean size I can see now is 18 Kb ??!!!!

Why ???



I had tried another trial , I put memory_cache_shared off , squid cant be started all all kids is being killed and stared again  and so on !

Sample of logs :
FATAL: Received Segment Violation...dying.
2014/11/16 09:18:28 kid1| Closing HTTP port xxxx
2014/11/16 09:18:28 kid1| Closing HTTP port xxxxxx
2014/11/16 09:18:28 kid1| storeDirWriteCleanLogs: Starting...
2014/11/16 09:18:28 kid1|   Finished.  Wrote 0 entries.
2014/11/16 09:18:28 kid1| storeDirWriteCleanLogs: Starting...
2014/11/16 09:18:28 kid1|   Finished.  Wrote 0 entries.
2014/11/16 09:18:28 kid1|   Took 0.00 seconds (  0.00 entries/sec).
CPU Usage: 8.235 seconds = 8.049 user + 0.186 sys
Maximum Resident Size: 381440 KB
Page faults with physical i/o: 1
2014/11/16 09:18:30 kid5| Current Directory is /root
2014/11/16 09:18:30 kid5| Starting Squid Cache version 3.HEAD-20141105-r13687 for x86_64-unknown-linux-gnu...
2014/11/16 09:18:30 kid5| Service Name: squid
2014/11/16 09:18:30 kid5| Process ID 2925
2014/11/16 09:18:30 kid5| Process Roles: worker
2014/11/16 09:18:30 kid5| Process Roles: worker
2014/11/16 09:18:30 kid5| With 131072 file descriptors available
2014/11/16 09:18:30 kid5| With 131072 file descriptors available
2014/11/16 09:18:30 kid5| Initializing IP Cache...
2014/11/16 09:18:30 kid5| Initializing IP Cache...
2014/11/16 09:18:30 kid5| DNS Socket created at [::], FD 10
2014/11/16 09:18:30 kid5| DNS Socket created at 0.0.0.0, FD 11



I wish you help me with a good squid.conf file that can help me in saving bw as I can !

regards


-----Original Message-----
From: Amos Jeffries [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>] 
Sent: Saturday, November 15, 2014 10:07 PM
To: Ahmed Allzaeem
Cc: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] squid cache Large rock with aufs optimization for bandwidth saving

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 17/11/2014 2:24 a.m., Ahmed Allzaeem wrote:
&gt;<i> Hi Amos , thank you
</I>&gt;<i> 
</I>&gt;<i> Really sorry to ask you  , wts needed to be done to use largerock 
</I>&gt;<i> support ?
</I>
Example 5GB rock cache;

 cache_dir rock /ssd1 5000

&gt;<i> 
</I>&gt;<i> I mean wt wring im doing ?
</I>&gt;<i> 
</I>&gt;<i> Also about the cace_mem directive , as I understood this value  per 
</I>&gt;<i> worker or per process. And here im not using rock , so its not shared 
</I>&gt;<i> , I have about 32 Gram total.
</I>
<A HREF="http://www.squid-cache.org/Doc/config/memory_cache_shared/">http://www.squid-cache.org/Doc/config/memory_cache_shared/</A>

You are using workers, so it is shared unless you configure:
  memory_cache_shared off

Note this: &quot;Currently, entities exceeding 32KB in size cannot be shared.&quot;.
 I am not sure if that was fixed when large-rock support was added.
Should have been, but maybe not.


For most of the per-worker settings you have are undone by the global settings at the end of the config between http_port and WCCP config.


&gt;<i> 
</I>&gt;<i> Can you correct nme about setting cache_mem  directive ? also guide me 
</I>&gt;<i> wts needed to enable caching large object size like 512k - 1 M or even 
</I>&gt;<i> 2 M
</I>&gt;<i> 
</I>
Try &quot;memory_cache_shared off&quot; at the top of your config.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUaD7vAAoJELJo5wb/XPRjDfYH/1SsTIG4RUrU5NXB7C4Vojva
iZdt9hPLW7QTkUWjjB3tr6Y84I4DRCd9/N6h1LBlDY3lNmjhsYQEwCEUmm6Dm2Uo
hj1P1Nvn6cBMOjDZswFrz3imo37UAnvIUAqqwMC2SJF3uglvgtrd8IdeFVPRIoSR
bgjsiZB1yAx+SBCEOPs2sEhpqdi0215FeiF/ujTS5A7JeEPS+jPVcZoYT/xRoe9L
oDXkITcfBlOa/0bY1lo5LAqPHmVDh5BZxVn8ToMMvki21J9UscRdvT04JVoc6iqP
Uouo9VxZJDJfxF0BtK4wJSG1nKtcTiFYrBqK862L2c7zwYPB9WIPpUflKRx/aFQ=
=82cL
-----END PGP SIGNATURE-----


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000820.html">[squid-users] squid cache Large rock with aufs optimization for bandwidth saving
</A></li>
	<LI>Next message (by thread): <A HREF="000828.html">[squid-users] squid cache Large rock with aufs optimization for bandwidth saving
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#821">[ date ]</a>
              <a href="thread.html#821">[ thread ]</a>
              <a href="subject.html#821">[ subject ]</a>
              <a href="author.html#821">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
