<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Centralized Squid - design and implementation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Centralized%20Squid%20-%20design%20and%20implementation&In-Reply-To=%3CCA%2BY8hcOwYY%2Bx0Q%3DM16GJo-Y7BekJgGBfkojeVucZ1O3G5zuEng%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000822.html">
   <LINK REL="Next"  HREF="000824.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Centralized Squid - design and implementation</H1>
    <B>Kinkie</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Centralized%20Squid%20-%20design%20and%20implementation&In-Reply-To=%3CCA%2BY8hcOwYY%2Bx0Q%3DM16GJo-Y7BekJgGBfkojeVucZ1O3G5zuEng%40mail.gmail.com%3E"
       TITLE="[squid-users] Centralized Squid - design and implementation">gkinkie at gmail.com
       </A><BR>
    <I>Sun Nov 16 16:22:43 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000822.html">[squid-users] Centralized Squid - design and implementation
</A></li>
        <LI>Next message (by thread): <A HREF="000824.html">[squid-users] Centralized Squid - design and implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#823">[ date ]</a>
              <a href="thread.html#823">[ thread ]</a>
              <a href="subject.html#823">[ subject ]</a>
              <a href="author.html#823">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sun, Nov 16, 2014 at 4:54 PM, alberto &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">alberto.furia at gmail.com</A>&gt; wrote:
&gt;<i> Hello everyone,
</I>&gt;<i> first of all thanks to the community of squid for such a great job.
</I>
Hello Alberto,

[...]

&gt;<i> I have some questions that I would like to share with you:
</I>&gt;<i>
</I>&gt;<i> 1. I would like to leave the solution we are using now (wpad balancing). In
</I>&gt;<i> a situation like the one I have described, centralized squid serving the
</I>&gt;<i> spokes/branches, which is the best solution for clustering/HA? If one of the
</I>&gt;<i> centralized nodes had to &quot;die&quot; I would like client machines not to remain
</I>&gt;<i> &quot;hanging&quot; but to continue working on an active node without disruption. A
</I>&gt;<i> hierarchy of proxy would be the solution?
</I>
If you want to maximize the efficiency of your balancing solution, you
probably want a slightly different approach: instead of using the
client-ip as hashing mechanism, you want to hash on the destination
host.
e.g. have a pac-file like (untested, and to be adjusted):

function FindProxyForURL(url, host) {
   var dest_ip = dnsResolve(host);
   var dest_hash= dest_ip.slice(-1) % 2;
   if (dest_hash)
     return &quot;PROXY local_proxy1:port; PROXY local_proxy2:port; DIRECT&quot;;
   return &quot;PROXY local_proxy2:port; PROXY local_proxy1:port; DIRECT&quot;
}
This will balance by the final digit of the destination IP of the
service. The downside is that it requires DNS lookups by the clients,
and that if the primary local proxy fails, it takes a few seconds (up
to 30) for clients to give up and fail over to secondary.

local_proxies can then either go direct to the origin server (if
intranet) or use a balancing mechanism such as carp (see the
documentation for the cache_peer directive in squid) to maximize
efficiency, especially for Internet destinations.

The only single-point-of-failure at the HTTP level in this design is
the PACfile server, it'll be up to you to make that reliable.

&gt;<i> 2. Bearing in mind that all users will be AD authenticated, which url
</I>&gt;<i> filtering/blacklist solution do you suggest?
</I>&gt;<i> In the past I have worked a lot with squidguard and dansguardian but now
</I>&gt;<i> they don't seem to be the state of the art anymore.
</I>&gt;<i> I've been thinking about two different solutions:
</I>&gt;<i>   2a. To use the native acl squid with the squidblacklist.org lists
</I>&gt;<i> (<A HREF="http://www.squidblacklist.org/">http://www.squidblacklist.org/</A>)
</I>&gt;<i>   2b. To use urlfilterdb (<A HREF="http://www.urlfilterdb.com/products/overview.html">http://www.urlfilterdb.com/products/overview.html</A>)
</I>
I don't know, sorry.

&gt;<i> 3. Which GNU/Linux distro do you suggest me? I was thinking about Debian
</I>&gt;<i> Jessie (just frozen) or CentOS7.
</I>
<A HREF="http://wiki.squid-cache.org/BestOsForSquid">http://wiki.squid-cache.org/BestOsForSquid</A>

-- 
    Francesco

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000822.html">[squid-users] Centralized Squid - design and implementation
</A></li>
	<LI>Next message (by thread): <A HREF="000824.html">[squid-users] Centralized Squid - design and implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#823">[ date ]</a>
              <a href="thread.html#823">[ thread ]</a>
              <a href="subject.html#823">[ subject ]</a>
              <a href="author.html#823">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
