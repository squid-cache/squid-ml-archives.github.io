<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid-3.4.8  intercept
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid-3.4.8%20%20intercept&In-Reply-To=%3C546BB70A.1010906%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000862.html">
   <LINK REL="Next"  HREF="000868.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid-3.4.8  intercept</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid-3.4.8%20%20intercept&In-Reply-To=%3C546BB70A.1010906%40ngtech.co.il%3E"
       TITLE="[squid-users] squid-3.4.8  intercept">eliezer at ngtech.co.il
       </A><BR>
    <I>Tue Nov 18 21:15:54 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000862.html">[squid-users] squid-3.4.8 intercept
</A></li>
        <LI>Next message (by thread): <A HREF="000868.html">[squid-users] squid-3.4.8  intercept
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#864">[ date ]</a>
              <a href="thread.html#864">[ thread ]</a>
              <a href="subject.html#864">[ subject ]</a>
              <a href="author.html#864">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hey Frank,

To understand the issue better I am missing couple things.
I filtered the squid.conf (which is a basic thing to do) and the
content can be seen here:
<A HREF="http://www1.ngtech.co.il/paste/1216/">http://www1.ngtech.co.il/paste/1216/</A>

It seems like you do not understand what and how.
the localnet you are using is kind of illegal and probably the reason
it's not working for you.
What you should do is to remove or comment the line &quot;acl localnet src all&quot;
and then remove\comment all http_access lines and add only one line:
http_access allow all
##END

when you have used this and only this config line you should be able
to use the proxy from anywhere on the ipv4 planet and if you have ipv6
also from there.
So use it with at least a basic firewall to not make this proxy public
and to black list your server.

This test is one of the biggest binary search while troubleshooting
with squid.

As I have mentioned before you should also provide your OS.
If you are using CentOS for example there is a nice RPM that will
might reduce your self compilation efforts.

All The Bests,
Eliezer

On 11/18/2014 07:59 PM, Frank wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> Since upgrading from 3.1.22 to 3.4.8 I have been unable to get the 
</I>&gt;<i> transparent mode to accept my IP.  I am seeing permission denied in
</I>&gt;<i> the transaction when I do a packet dump. I have read the
</I>&gt;<i> documentation making changes for 3.4.8. I even allowed everything
</I>&gt;<i> and no go.
</I>&gt;<i> 
</I>&gt;<i> I also compiled squid and here is my configure script:
</I>&gt;<i> 
</I>&gt;<i> ./configure \ --prefix=/usr/share/squid-3.4.8  \ 
</I>&gt;<i> --libdir=/usr/lib${LIBDIRSUFFIX} \ --sysconfdir=/etc/squid \ 
</I>&gt;<i> --localstatedir=/var/log/squid \ --datadir=/usr/share/squid-3.4.8
</I>&gt;<i> \ --with-pidfile=/var/run/squid/squid.pid \ --mandir=/usr/man \ 
</I>&gt;<i> --with-logdir=/var/log/squid \ --enable-snmp \ 
</I>&gt;<i> --enable-ipf-transparent \ --enable-ipfw-transparent #
</I>&gt;<i> --enable-auth=&quot;basic&quot; \ #  --enable-basic-auth-helpers=&quot;NCSA&quot; \ #
</I>&gt;<i> --enable-linux-netfilter \ #  --enable-async-io \ #
</I>&gt;<i> --disable-strict-error-checking
</I>&gt;<i> 
</I>&gt;<i> My machine the browser is on:
</I>&gt;<i> 
</I>&gt;<i> 66.159.32.31
</I>&gt;<i> 
</I>&gt;<i> The machine that is running squid:
</I>&gt;<i> 
</I>&gt;<i> 66.159.47.22
</I>&gt;<i> 
</I>&gt;<i> Here is my squid.conf
</I>&gt;<i> 
</I>&gt;<i> ===================================================================================
</I>&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> # # Recommended minimum configuration: #
</I>&gt;<i> 
</I>&gt;<i> cache_effective_user  squid cache_effective_group  squid
</I>&gt;<i> 
</I>&gt;<i> # Example rule allowing access from your local networks. # Adapt to
</I>&gt;<i> list your (internal) IP networks from where browsing # should be
</I>&gt;<i> allowed acl localnet src all    # RFC1918 possible internal
</I>&gt;<i> network #acl localnet src 66.159.32.0/24        # RFC1918 possible
</I>&gt;<i> internal network #acl localnet src 108.161.167.0/24      # RFC1918
</I>&gt;<i> possible internal network #acl localnet src 66.159.47.0/24        #
</I>&gt;<i> RFC1918 possible internal network #acl localnet src 127.0.0.0/24  #
</I>&gt;<i> RFC1918 possible internal network
</I>&gt;<i> 
</I>&gt;<i> acl SSL_ports port 443 acl Safe_ports port 80          # http acl
</I>&gt;<i> Safe_ports port 21          # ftp acl Safe_ports port 443         #
</I>&gt;<i> https acl Safe_ports port 70          # gopher acl Safe_ports port
</I>&gt;<i> 210         # wais acl Safe_ports port 1025-65535  # unregistered
</I>&gt;<i> ports acl Safe_ports port 280         # http-mgmt acl Safe_ports
</I>&gt;<i> port 488         # gss-http acl Safe_ports port 591         #
</I>&gt;<i> filemaker acl Safe_ports port 777         # multiling http acl
</I>&gt;<i> CONNECT method CONNECT
</I>&gt;<i> 
</I>&gt;<i> # # Recommended minimum Access Permission configuration: # # Deny
</I>&gt;<i> requests to certain unsafe ports ########http_access deny
</I>&gt;<i> !Safe_ports
</I>&gt;<i> 
</I>&gt;<i> # Deny CONNECT to other than secure SSL ports 
</I>&gt;<i> ###########http_access deny CONNECT !SSL_ports
</I>&gt;<i> 
</I>&gt;<i> # Only allow cachemgr access from localhost 
</I>&gt;<i> ###############http_access allow localhost manager
</I>&gt;<i> 
</I>&gt;<i> ###############http_access deny manager
</I>&gt;<i> 
</I>&gt;<i> # We strongly recommend the following be uncommented to protect
</I>&gt;<i> innocent # web applications running on the proxy server who think
</I>&gt;<i> the only # one who can access services on &quot;localhost&quot; is a local
</I>&gt;<i> user ############http_access deny to_localhost
</I>&gt;<i> 
</I>&gt;<i> # # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS 
</I>&gt;<i> # # Example rule allowing access from your local networks. # Adapt
</I>&gt;<i> localnet in the ACL section to list your (internal) IP networks #
</I>&gt;<i> from where browsing should be allowed
</I>&gt;<i> 
</I>&gt;<i> http_access allow localnet http_access allow localhost
</I>&gt;<i> 
</I>&gt;<i> # And finally deny all other access to this proxy #http_access deny
</I>&gt;<i> all http_access allow all
</I>&gt;<i> 
</I>&gt;<i> # Squid normally listens to port 3128 http_port 3128 http_port 3129
</I>&gt;<i> intercept
</I>&gt;<i> 
</I>&gt;<i> always_direct allow all
</I>&gt;<i> 
</I>&gt;<i> # Uncomment and adjust the following to add a disk cache
</I>&gt;<i> directory. cache_dir ufs /usr/share/squid/cache 100 32 512
</I>&gt;<i> 
</I>&gt;<i> # Leave coredumps in the first cache dir coredump_dir
</I>&gt;<i> /var/log/squid/cache/squid
</I>&gt;<i> 
</I>&gt;<i> # # Add any of your own refresh_pattern entries above these. # 
</I>&gt;<i> refresh_pattern ^ftp:           1440    20%     10080 
</I>&gt;<i> refresh_pattern ^gopher:        1440    0%      1440 
</I>&gt;<i> refresh_pattern -i (/cgi-bin/|\?) 0     0%      0 refresh_pattern .
</I>&gt;<i> 0       20%     4320
</I>&gt;<i> 
</I>&gt;<i> ==================================================================================
</I>&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> And I have configured my browser to use HTTP Proxy 66.159.47.22
</I>&gt;<i> Port 3129
</I>&gt;<i> 
</I>&gt;<i> I also setup iptables on my machine as follows and that didn't
</I>&gt;<i> work either. Same permission denied.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> /sbin/iptables -t nat -A OUTPUT -p tcp -s 66.159.32.31 --dport 80
</I>&gt;<i> -j DNAT --to 66.159.47.22:3129
</I>&gt;<i> 
</I>&gt;<i> Let me know if further info is needed.   Any help would be greatly 
</I>&gt;<i> appreciated.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________ squid-users mailing
</I>&gt;<i> list <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> 
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUa7cKAAoJENxnfXtQ8ZQU1vgH+wRtttwPLpxAgF0+wma0u7w4
iqwcZgHG2+996qpFOpI8tzDPo+xKQFPkJX3SthDU2AUnOkDYMT1JplT4vmCik6d5
4lfNlC9kAqMVTq2iF1WGbujgfbFeceImOxP0gfuS3ox5XjXeWUmdmGi57kzNGLMn
cZ0Ct+YYzyvMWebi7bpDerkEYD+5Qr4zAk1n16Xw3d5OCBOclFsvTZlI3ivZ/9Y6
kFVBKFI3q7/Ae8tpmi7jtN6uvebM9QZttyBwHgF/qtfY/QiloFilnEbZQQNRde1V
OZMxUF2rDRDCR+iOBJMIKFmNzn7YbPjF/g02V1/h2hZMF4OY3nTA1BbGO7BVhRw=
=Lpd/
-----END PGP SIGNATURE-----

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000862.html">[squid-users] squid-3.4.8 intercept
</A></li>
	<LI>Next message (by thread): <A HREF="000868.html">[squid-users] squid-3.4.8  intercept
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#864">[ date ]</a>
              <a href="thread.html#864">[ thread ]</a>
              <a href="subject.html#864">[ subject ]</a>
              <a href="author.html#864">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
