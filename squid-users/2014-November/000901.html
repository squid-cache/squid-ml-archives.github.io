<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid going through another forward proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20going%20through%20another%20forward%20proxy&In-Reply-To=%3CCAEhCwUwvNo39me%2BrHsODv4-iisoEXpNuhECFoJDhA2zixud%3DjA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000900.html">
   <LINK REL="Next"  HREF="000798.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid going through another forward proxy</H1>
    <B>Hector Chan</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20going%20through%20another%20forward%20proxy&In-Reply-To=%3CCAEhCwUwvNo39me%2BrHsODv4-iisoEXpNuhECFoJDhA2zixud%3DjA%40mail.gmail.com%3E"
       TITLE="[squid-users] Squid going through another forward proxy">hectorchan at gmail.com
       </A><BR>
    <I>Sat Nov 22 00:49:38 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000900.html">[squid-users] Squid going through another forward proxy
</A></li>
        <LI>Next message (by thread): <A HREF="000798.html">[squid-users] Is it safe to set number of sslcrtd_children to 50?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#901">[ date ]</a>
              <a href="thread.html#901">[ thread ]</a>
              <a href="subject.html#901">[ subject ]</a>
              <a href="author.html#901">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>And if doesn't do the proper HTTP CONNECT, is there any way I can make
squid to use HTTP CONNECT and establish a proxy channel?  The reason I ask
is because we use HTTP BasicAuth with the origin server and it needs to be
encrypted end-to-end.

Thanks again,
Hector


On Fri, Nov 21, 2014 at 4:15 PM, Hector Chan &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">hectorchan at gmail.com</A>&gt; wrote:

&gt;<i> Hi Amos,
</I>&gt;<i>
</I>&gt;<i> For the following cache_peer:
</I>&gt;<i>
</I>&gt;<i> &gt; cache_peer forward-proxy.example.com parent 3128 0 name=C
</I>&gt;<i>
</I>&gt;<i> Would squid do the proper HTTP CONNECT before forwarding the request there
</I>&gt;<i> ?
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> Hector
</I>&gt;<i>
</I>&gt;<i> On Thu, Nov 13, 2014 at 10:35 PM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;&gt;<i> Hash: SHA1
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 14/11/2014 6:22 p.m., Hector Chan wrote:
</I>&gt;&gt;<i> &gt; Hi Amos,
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;&gt; those lines you specify above go in (C). *if* they are needed at
</I>&gt;&gt;<i> &gt;&gt; all.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; But I don't have control over (C).  It's off limits.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Then you have to trust that the admin in charge of it set it up right.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;&gt; In (B) goes:
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; cache_peer forward-proxy.example.com parent 3128 0 name=C
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; acl sendToC dstdomain origin-x.example.com origin-y.example.com
</I>&gt;&gt;<i> &gt; origin-z.example.com
</I>&gt;&gt;<i> &gt;&gt; cache_peer_access C sendToC
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; The requests reaching (B) (reverse-proxy.example.com) are in the
</I>&gt;&gt;<i> &gt; form: <A HREF="http://reverse-proxy.example.com/goto-origin-x">http://reverse-proxy.example.com/goto-origin-x</A>
</I>&gt;&gt;<i> &gt; <A HREF="http://reverse-proxy.example.com/goto-origin-y">http://reverse-proxy.example.com/goto-origin-y</A>
</I>&gt;&gt;<i> &gt; <A HREF="http://reverse-proxy.example.com/goto-origin-z">http://reverse-proxy.example.com/goto-origin-z</A>
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; and I have a couple of cache_peer_access acls (urlpath regex) to
</I>&gt;&gt;<i> &gt; send them to origin-x, origin-y, and origin-z.  How would the above
</I>&gt;&gt;<i> &gt; dstdomain acl work with these rules?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> You have now stopped using HTTP and started using some strange
</I>&gt;&gt;<i> URL-embeded protocol.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> An HTTP proxy cannot help you there. You require a proxy that
</I>&gt;&gt;<i> understands and acts on the URL-embeded protocol messages.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It is possible to extend Squid with URL-rewrite helpers that can
</I>&gt;&gt;<i> translate it into different HTTP URL for passing to (C). BUT, there is
</I>&gt;&gt;<i> no guarantee of what origin (C) will use to fetch that resource. You
</I>&gt;&gt;<i> have to *trust* that (C) uses the origin best suited to any request
</I>&gt;&gt;<i> that it is given, according to the criteria its own admin has set for
</I>&gt;&gt;<i> &quot;best&quot;.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Amos
</I>&gt;&gt;<i> -----BEGIN PGP SIGNATURE-----
</I>&gt;&gt;<i> Version: GnuPG v2.0.22 (MingW32)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> iQEcBAEBAgAGBQJUZaKVAAoJELJo5wb/XPRjdpQH/iBh1HQcAZQr0gqK7FS8nZ9x
</I>&gt;&gt;<i> v0fzAOx/L0HCG5MTT7drwvvEVltxMRYoVniM8VJSqUw3cFAlI+2VEScIr3oOFjcr
</I>&gt;&gt;<i> qAdjxyjer7sxVgmQM80Oa+n40RK7mvZejvhEV9/0Gc0XTmAjL3PrBptKpumslhVh
</I>&gt;&gt;<i> rq40LUX50rg5xaAfA02WCy4mYS99uH7qBABWIXeeESVdvGLVRTaTlthqaKW8JTFh
</I>&gt;&gt;<i> pjmS9OKVnk5CeEi6cyJ8VV7edBOgv2rpgUH8Wjap66mmIjVHq8alNU53obRAMk7p
</I>&gt;&gt;<i> Pd/bPfPFERnoBymbYmYfFBd3Mfddgc49Wpz9gggAWgXE8bq6CbXQHpj5GvUayaE=
</I>&gt;&gt;<i> =mS+q
</I>&gt;&gt;<i> -----END PGP SIGNATURE-----
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20141121/287687fb/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20141121/287687fb/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000900.html">[squid-users] Squid going through another forward proxy
</A></li>
	<LI>Next message (by thread): <A HREF="000798.html">[squid-users] Is it safe to set number of sslcrtd_children to 50?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#901">[ date ]</a>
              <a href="thread.html#901">[ thread ]</a>
              <a href="subject.html#901">[ subject ]</a>
              <a href="author.html#901">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
