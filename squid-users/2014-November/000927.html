<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Transparent proxy with Peek and Splice feature.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Transparent%20proxy%20with%20Peek%20and%20Splice%20feature.&In-Reply-To=%3C54759E6C.5080404%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000924.html">
   <LINK REL="Next"  HREF="000946.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Transparent proxy with Peek and Splice feature.</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Transparent%20proxy%20with%20Peek%20and%20Splice%20feature.&In-Reply-To=%3C54759E6C.5080404%40treenet.co.nz%3E"
       TITLE="[squid-users] Transparent proxy with Peek and Splice feature.">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Nov 26 09:33:32 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000924.html">[squid-users] Transparent proxy with Peek and Splice feature.
</A></li>
        <LI>Next message (by thread): <A HREF="000946.html">[squid-users] Transparent proxy with Peek and Splice feature.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#927">[ date ]</a>
              <a href="thread.html#927">[ thread ]</a>
              <a href="subject.html#927">[ subject ]</a>
              <a href="author.html#927">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 26/11/2014 7:22 a.m., Vadim Rogoziansky wrote:
&gt;<i> Hello All.
</I>&gt;<i> 
</I>&gt;<i> My goal is to do ssl bumping in transparent proxy mode with domain 
</I>&gt;<i> exclude possibility. Let me tell you about squid's strange
</I>&gt;<i> behaviour when I'm trying to do it.
</I>&gt;<i> 
</I>&gt;<i> In browsers it says something like this: /This server could not
</I>&gt;<i> prove that it is www.ukr.net; its security certificate is
</I>&gt;<i> from212.42.76.253. This may be caused by a misconfiguration or an
</I>&gt;<i> attacker intercepting your connection.// 
</I>&gt;<i> //NET::ERR_CERT_COMMON_NAME_INVALID// //Subject: 212.42.76.253// / 
</I>&gt;<i> Looks like squid takes the CN from the certificate as IP address of
</I>&gt;<i> the destination domain.
</I>
Squid takes the IP address from the TCP packet. Which is all that is
available in NAT intercepted traffic at bumping step #1.

The ACLs you have therefore determine that &quot;bump&quot; action is to happen.
Correct?

The cert details are therefore mimic'ed from what gets delivered by
the server.

It may be that the server is depending on SNI to generate its own
cert, but since Squid deos not have that domain name already an
IP-based cert comes back.

It may also be that some ISP upstream of you is bumping the encryption
with client-first method.



&gt;<i> But, everything works smoothly when I use proxy in non transparent
</I>&gt;<i> mode and put it to the browser directly .
</I>
In which case the browser sends domain name to the proxy in its
CONNECT message starting the HTTPS. The possible results are very
different.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUdZ5sAAoJELJo5wb/XPRj0qIIANBjuFvq45hPmcaj/NYL6bza
7ttt5Gn+tn8E5KH7T4wfQhUXr91UIsYWfOswfnVAAlBevIO/iFVoDN5hAOveuhIl
ra/0eGti1EpZ3LHJiAqmo0mHsrz3v9+PAduVrXgUJLyYDiM0xctg0nRhj2u166VX
j0IL3g8CKEw+KiWVJM9HdLaDEz9fYtHBO8UHhKDDE94O9yxScIvB+GAhN4YlTtrE
z65VJkSCEw+3vH6XcrrkF2aEnB20jeEGiV5puO2cPoJpgcg3ic8sMVEfa/Z1qwqa
KCkj2XI28wBCIovCV+AfBhpvW0o8eVFbt4ESodLTmwjUvU+m8zxky/9cjO5kyLE=
=kgug
-----END PGP SIGNATURE-----

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000924.html">[squid-users] Transparent proxy with Peek and Splice feature.
</A></li>
	<LI>Next message (by thread): <A HREF="000946.html">[squid-users] Transparent proxy with Peek and Splice feature.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#927">[ date ]</a>
              <a href="thread.html#927">[ thread ]</a>
              <a href="subject.html#927">[ subject ]</a>
              <a href="author.html#927">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
