<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Problem with access.log and when using SMP
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problem%20with%20access.log%20and%20when%20using%20SMP&In-Reply-To=%3C5475C6BA.5000008%40mia.gov.ge%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000959.html">
   <LINK REL="Next"  HREF="000962.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Problem with access.log and when using SMP</H1>
    <B>Giorgi Tepnadze</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problem%20with%20access.log%20and%20when%20using%20SMP&In-Reply-To=%3C5475C6BA.5000008%40mia.gov.ge%3E"
       TITLE="[squid-users] Problem with access.log and when using SMP">giorgi at mia.gov.ge
       </A><BR>
    <I>Wed Nov 26 12:25:30 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000959.html">[squid-users] Transparent proxy with Peek and Splice feature.
</A></li>
        <LI>Next message (by thread): <A HREF="000962.html">[squid-users] Problem with access.log and when using SMP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#932">[ date ]</a>
              <a href="thread.html#932">[ thread ]</a>
              <a href="subject.html#932">[ subject ]</a>
              <a href="author.html#932">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I have own squid log parsing software which worked flawlessly before we 
moved to squid 3.3.8 (old was 2.7). Log parser stopped working. This is 
the problem I found.

Problem lines:
1416971036.802 184393 10.xx.xx.xx TCP_MISS/200 10963 CONNECT 
pixel.facebook.com:1416971036.390      0 10.yy.yy.yy TCP_DENIED/407 3751 
CONNECT clients4.google.com:443 - HIER_NONE/- text/html
1416971036.645   7164 10.zz.zz.zz TCP_MISS/200 55438 GET 
<A HREF="http://s40.radikal.ru/i089/1107/9b/2fbf1779ead9.jpg">http://s40.radikal.ru/i089/1107/9b/2fbf1779ead9.jpg</A> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">user at domain.com</A> 
HIER_DIRECT/81.176.238.141 image/jpeg
443 <A HREF="https://lists.squid-cache.org/listinfo/squid-users">user2 at domainc.com</A> HIER_DIRECT/31.13.93.3 -

As it should be:
1416971036.390      0 10.yy.yy.yy TCP_DENIED/407 3751 CONNECT 
clients4.google.com:443 - HIER_NONE/- text/html
1416971036.802 184393 10.xx.xx.xx TCP_MISS/200 10963 CONNECT 
pixel.facebook.com:443 <A HREF="https://lists.squid-cache.org/listinfo/squid-users">user2 at domainc.com</A> HIER_DIRECT/31.13.93.3 -
1416971036.645   7164 10.zz.zz.zz TCP_MISS/200 55438 GET 
<A HREF="http://s40.radikal.ru/i089/1107/9b/2fbf1779ead9.jpg">http://s40.radikal.ru/i089/1107/9b/2fbf1779ead9.jpg</A> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">user at domain.com</A> 
HIER_DIRECT/81.176.238.141 image/jpeg

I think that's because of SMP as I have 4 squid kids running and they 
all write to same access.log file and there is concurrency problem. 
Sometimes one is writing log line when previous log line is not finished 
yet or something like this. Such errors are rare but enough to stop my 
parser with  error.

Is it a bug? Is there any workaround or solution?

-- George Tepnadze

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000959.html">[squid-users] Transparent proxy with Peek and Splice feature.
</A></li>
	<LI>Next message (by thread): <A HREF="000962.html">[squid-users] Problem with access.log and when using SMP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#932">[ date ]</a>
              <a href="thread.html#932">[ thread ]</a>
              <a href="subject.html#932">[ subject ]</a>
              <a href="author.html#932">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
