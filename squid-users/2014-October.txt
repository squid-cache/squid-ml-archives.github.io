From ajm.martinez at gmail.com  Wed Oct  1 02:02:09 2014
From: ajm.martinez at gmail.com (Alejandro Martinez)
Date: Tue, 30 Sep 2014 23:02:09 -0300
Subject: [squid-users] ERROR: URL-rewrite
In-Reply-To: <542A9055.9090207@ngtech.co.il>
References: <CAFEXmxiArT4zHR3qorfopPN6r5s08cYdctok-zvMsEyt+sXLKA@mail.gmail.com>
 <542A9055.9090207@ngtech.co.il>
Message-ID: <CAFEXmxhzUdEEeH+OYMFqqUr_D7aVYupQQubPnKaSfK7dQESB9A@mail.gmail.com>

Thanks for your answers.

I think the url was (
http://wiki.squid-cache.org/ConfigExamples/PhpRedirectors) but now the site
is down for maintenance, so I can't validate that.

You're right about the version, my mistake.

I'm going to use another language and change the redirector output
according to the version.

Thanks again
Alejandro


2014-09-30 8:13 GMT-03:00 Eliezer Croitoru <eliezer at ngtech.co.il>:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Hey Alejandro,
>
> Can I ask where in the site have you taken this code from?
> Using php as a helper is not such a good choice due to couple issues
> it has with squid "stdin\stdout" emulation.
>
> You'd better use perl\python\ruby\other then php unless you found a
> solution to a bug that php developers consider a feature.
>
> Also only squid 3.4 uses the "OK rewrite-url=XYZ" format and "ERR"
> in squid 3.3 you use either a "http://xyz" as it is or
> "302:http://xyz" for a redirection and a blank line "" for no change.
>
> All The Bests,
> Eliezer
>
> On 09/29/2014 12:39 PM, Alejandro Martinez wrote:
> > the redirector code is this (code taken from squid site):
> >
> > $temp = array(); stream_set_timeout(STDIN, 86400);
> >
> > while ( $input = fgets(STDIN) ) { $temp = split(' ', $input); $url
> > = $temp[0]; if ( $url == "http://www.google.com" ) { echo "OK
> > rewrite-url=http://192.168.1.10/block.php \n"; } else { echo "ERR
> > \n"; } }
> >
> > Thanks
>
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1
>
> iQEcBAEBAgAGBQJUKpBVAAoJENxnfXtQ8ZQUqu8H/ifHq2l8BrrSb5JIo7xf4ijw
> 1jRbFt37ApmrEFMmaiZVErEvAyi8miHqjmlgeLLA+efXydCIISbBZHOsDdOima+3
> gshG9gaceJ54zP0dGiPL1pCRioGY16R2JQh7nhWz/scSEVcmB1UQ4bHmrkpsJ9Y2
> OHwf/cuSGbYXtgzHsavDmNYdUp+UpJ0KtoealP35UmqizRW5OSA4YqusEPwxG1oj
> HRqHocPE9Lb0BMIkBjZDbWs9DMRYAvx6p5JJaCB0VpwpXBa8oIMB5Fke6AjoAwBn
> 5k9nWo2myvQ+raa1WHldJF7xaUbFNVB2VFDt3Rw48PEVP+YJKIjlAZWpXzuZcnI=
> =XWQb
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20140930/dcac4bb6/attachment.htm>

From sudakov at sibptus.tomsk.ru  Wed Oct  1 07:45:18 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Wed, 1 Oct 2014 14:45:18 +0700
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <542AC521.2040006@treenet.co.nz>
References: <5427C7E6.3070600@zhegan.in>
 <20140928091835.GA37229@admin.sibptus.tomsk.ru>
 <5427E97A.1020309@ngtech.co.il>
 <20140928124159.GA38727@admin.sibptus.tomsk.ru>
 <5428AA6B.1010201@treenet.co.nz>
 <20140929071652.GA60398@admin.sibptus.tomsk.ru>
 <54291BB8.5020904@treenet.co.nz>
 <20140930022859.GA83414@admin.sibptus.tomsk.ru>
 <20140930053326.GA90693@admin.sibptus.tomsk.ru>
 <542AC521.2040006@treenet.co.nz>
Message-ID: <20141001074518.GA29967@admin.sibptus.tomsk.ru>

Amos Jeffries wrote:
> >>> 
> >>> You have 200 MB of RAM locked up in IDENT lookups.
> >>> 
> >>> Probably http://bugs.squid-cache.org/show_bug.cgi?id=3803
> >> 
> >> I have temporarily disabled IDENT-related acls. Squid still grows
> >> in memory, but more slowly. So IDENT was certainly one of the
> >> major causes of the leak.
> >> 
> >> Could we make another iteration of looking at the cachemgr.cgi
> >> memory counters?
> >> 
> > 
> > Attaching two cachemgr reports: right after squid restart and
> > several hours later (grown to 816M in SIZE).
> > 
> 
> These are still showing over 47K IDENT lookups.
> 
> Probably you did not disable all the uses of IDENT. You need to both
> set "ident_access deny all" and remove use of ident type ACLs.

Bingo! After setting "ident_access deny all" squid does not grow
infinitely any more. However, it remains a major CPU hog. 

I am attaching the output of mgr:info, mgr:mem and top as requested.

===

last pid: 81001;  load averages:  1.49,  1.48,  1.32  up 12+14:20:21    12:58:39
180 processes: 2 running, 178 sleeping

Mem: 478M Active, 244M Inact, 189M Wired, 43M Cache, 107M Buf, 2640K Free
Swap: 2548M Total, 67M Used, 2481M Free, 2% Inuse


  PID USERNAME       THR PRI NICE   SIZE    RES STATE   C   TIME   WCPU COMMAND
39322 squid            1 117    0   352M   323M CPU0    0 150:05 95.36% squid
84342 squid            1  44    0  5700K  4140K sbwait  1   0:09  0.00% ntlm_auth
84529 squid            1  44    0  4676K  2272K sbwait  1   0:03  0.00% ntlm_auth
39325 squid            1  44    0  4508K  1452K piperd  1   0:03  0.00% unlinkd
84724 squid            1  44    0  3652K  1892K sbwait  1   0:02  0.00% ntlm_auth
84725 squid            1  44    0  3652K  1740K sbwait  1   0:01  0.00% ntlm_auth
84726 squid            1  44    0  3652K  1632K sbwait  1   0:01  0.00% ntlm_auth
93981 squid            1  44    0  3652K  1556K sbwait  0   0:01  0.00% ntlm_auth
12271 squid            1  44    0  3652K  1500K sbwait  0   0:01  0.00% ntlm_auth
12272 squid            1  44    0  3652K  1464K sbwait  1   0:00  0.00% ntlm_auth
12273 squid            1  44    0  3652K  1436K sbwait  0   0:00  0.00% ntlm_auth
12274 squid            1  44    0  3652K  1408K sbwait  1   0:00  0.00% ntlm_auth
13032 squid            1  44    0  3652K  1392K sbwait  1   0:00  0.00% ntlm_auth
13033 squid            1  44    0  3652K  1384K sbwait  1   0:00  0.00% ntlm_auth
14750 squid            1  44    0  3652K  1376K sbwait  1   0:00  0.00% ntlm_auth
14751 squid            1  44    0  3652K  1364K sbwait  0   0:00  0.00% ntlm_auth
14752 squid            1  44    0  3652K  1356K sbwait  1   0:00  0.00% ntlm_auth
18076 squid            1  44    0  3652K  1344K sbwait  1   0:00  0.00% ntlm_auth

HTTP/1.1 200 OK
Server: squid/3.4.8
Mime-Version: 1.0
Date: Wed, 01 Oct 2014 06:00:28 GMT
Content-Type: text/plain
Expires: Wed, 01 Oct 2014 06:00:28 GMT
Last-Modified: Wed, 01 Oct 2014 06:00:28 GMT
X-Cache: MISS from proxy.sibptus.transneft.ru
X-Cache-Lookup: MISS from proxy.sibptus.transneft.ru:3128
Via: 1.1 proxy.sibptus.transneft.ru (squid/3.4.8)
Connection: close

Squid Object Cache: Version 3.4.8
Build Info: 
Start Time:	Tue, 30 Sep 2014 15:56:38 GMT
Current Time:	Wed, 01 Oct 2014 06:00:28 GMT
Connection information for squid:
	Number of clients accessing cache:	170
	Number of HTTP requests received:	375550
	Number of ICP messages received:	0
	Number of ICP messages sent:	0
	Number of queued ICP replies:	0
	Number of HTCP messages received:	0
	Number of HTCP messages sent:	0
	Request failure ratio:	 0.00
	Average HTTP requests per minute since start:	445.1
	Average ICP messages per minute since start:	0.0
	Select loop called: 32559927 times, 1.555 ms avg
Cache information for squid:
	Hits as % of all requests:	5min: 3.2%, 60min: 4.1%
	Hits as % of bytes sent:	5min: 22.1%, 60min: 11.3%
	Memory hits as % of hit requests:	5min: 7.6%, 60min: 20.8%
	Disk hits as % of hit requests:	5min: 18.8%, 60min: 20.1%
	Storage Swap size:	471890 KB
	Storage Swap capacity:	90.0% used, 10.0% free
	Storage Mem size:	130484 KB
	Storage Mem capacity:	99.6% used,  0.4% free
	Mean Object Size:	23.64 KB
	Requests given to unlinkd:	65340
Median Service Times (seconds)  5 min    60 min:
	HTTP Requests (All):   1.00114  0.44492
	Cache Misses:          2.13280  1.00114
	Cache Hits:            0.94847  0.05951
	Near Hits:             1.11539  0.68577
	Not-Modified Replies:  0.52331  0.08265
	DNS Lookups:           0.30421  0.12472
	ICP Queries:           0.00000  0.00000
Resource usage for squid:
	UP Time:	50629.945 seconds
	CPU Time:	9112.184 seconds
	CPU Usage:	18.00%
	CPU Usage, 5 minute avg:	97.13%
	CPU Usage, 60 minute avg:	75.39%
	Maximum Resident Size: 1369760 KB
	Page faults with physical i/o: 483
Memory accounted for:
	Total accounted:       164823 KB
	memPoolAlloc calls:        39
	memPoolFree calls:  463653713
File descriptor usage for squid:
	Maximum number of file descriptors:   16384
	Largest file desc currently in use:    709
	Number of file desc currently in use:  433
	Files queued for open:                   0
	Available number of file descriptors: 15951
	Reserved number of file descriptors:   100
	Store Disk files open:                   6
Internal Data Structures:
	 20041 StoreEntries
	  6627 StoreEntries with MemObjects
	  6597 Hot Object Cache Items
	 19964 on-disk objects



HTTP/1.1 200 OK
Server: squid/3.4.8
Mime-Version: 1.0
Date: Wed, 01 Oct 2014 06:00:35 GMT
Content-Type: text/plain
Expires: Wed, 01 Oct 2014 06:00:35 GMT
Last-Modified: Wed, 01 Oct 2014 06:00:35 GMT
X-Cache: MISS from proxy.sibptus.transneft.ru
X-Cache-Lookup: MISS from proxy.sibptus.transneft.ru:3128
Via: 1.1 proxy.sibptus.transneft.ru (squid/3.4.8)
Connection: close

Current memory usage:
Pool	 Obj Size	Chunks							Allocated					In Use					Idle			Allocations Saved			Rate	
 	 (bytes)	KB/ch	 obj/ch	(#)	 used	 free	 part	 %Frag	 (#)	 (KB)	 high (KB)	 high (hrs)	 %Tot	(#)	 (KB)	 high (KB)	 high (hrs)	 %alloc	(#)	 (KB)	 high (KB)	(#)	 %cnt	 %vol	(#)/sec	
mem_node            	 4120	 	 	 	 	 	 	 	 32586	 131108	 132665	 4.19	 79.209	 32586	 131108	 132665	 4.19	 100.000	 0	 0	 0	 0	 0.000	 0.000	 43.406
Medium Strings      	  128	 	 	 	 	 	 	 	 110027	 13754	 23103	 0.52	 8.309	 110027	 13754	 23103	 0.52	 100.000	 0	 0	 0	 0	 0.000	 0.000	 8433.202
Short Strings       	   36	 	 	 	 	 	 	 	 248037	 8721	 12456	 0.52	 5.268	 248037	 8721	 12456	 0.52	 100.000	 0	 0	 0	 0	 0.000	 0.000	 9548.156
NotePairs::Entry    	   24	 	 	 	 	 	 	 	 108787	 2550	 4292	 0.52	 1.540	 108787	 2550	 4292	 0.52	 100.000	 0	 0	 0	 0	 0.000	 0.000	 8299.001
HttpHeaderEntry     	   28	 	 	 	 	 	 	 	 62727	 1716	 2381	 2.42	 1.036	 62727	 1716	 2381	 2.42	 100.000	 0	 0	 0	 0	 0.000	 0.000	 418.636
4K Buffer           	 4096	 	 	 	 	 	 	 	 308	 1232	 2152	 0.41	 0.744	 308	 1232	 2152	 0.41	 100.000	 0	 0	 0	 0	 0.000	 0.000	 14.047
StoreEntry          	   60	 	 	 	 	 	 	 	 20030	 1174	 1311	 2.54	 0.709	 20030	 1174	 1311	 2.54	 100.000	 0	 0	 0	 0	 0.000	 0.000	 12.050
HttpReply           	  172	 	 	 	 	 	 	 	 6647	 1117	 1601	 2.42	 0.675	 6647	 1117	 1601	 2.42	 100.000	 0	 0	 0	 0	 0.000	 0.000	 36.288
MemObject           	  136	 	 	 	 	 	 	 	 6625	 880	 1264	 2.42	 0.532	 6625	 880	 1264	 2.42	 100.000	 0	 0	 0	 0	 0.000	 0.000	 12.138
cbdata clientReplyContext (20)	 4224	 	 	 	 	 	 	 	 109	 450	 933	 4.00	 0.272	 109	 450	 933	 4.00	 100.000	 0	 0	 0	 0	 0.000	 0.000	 12.833
cbdata ClientSocketContext (19)	 4188	 	 	 	 	 	 	 	 109	 446	 925	 4.00	 0.269	 109	 446	 925	 4.00	 100.000	 0	 0	 0	 0	 0.000	 0.000	 12.833
HttpRequest         	 1400	 	 	 	 	 	 	 	 247	 338	 468	 0.44	 0.204	 247	 338	 468	 0.44	 100.000	 0	 0	 0	 0	 0.000	 0.000	 12.833
MD5 digest          	   16	 	 	 	 	 	 	 	 20030	 313	 350	 2.54	 0.189	 20030	 313	 350	 2.54	 100.000	 0	 0	 0	 0	 0.000	 0.000	 15.109
LRU policy node     	   12	 	 	 	 	 	 	 	 26505	 311	 369	 2.54	 0.188	 26505	 311	 369	 2.54	 100.000	 0	 0	 0	 0	 0.000	 0.000	 4.109
HttpHdrCc           	   60	 	 	 	 	 	 	 	 4456	 262	 347	 2.44	 0.158	 4456	 262	 347	 2.44	 100.000	 0	 0	 0	 0	 0.000	 0.000	 13.567
16K Buffer          	 16384	 	 	 	 	 	 	 	 16	 256	 1040	 1.31	 0.155	 16	 256	 1040	 1.31	 100.000	 0	 0	 0	 0	 0.000	 0.000	 6.651
cbdata MemBuf (13)  	   36	 	 	 	 	 	 	 	 6662	 235	 336	 2.42	 0.141	 6662	 235	 336	 2.42	 100.000	 0	 0	 0	 0	 0.000	 0.000	 60.437
cbdata IdleConnList (38)	 4136	 	 	 	 	 	 	 	 28	 114	 598	 4.34	 0.068	 28	 114	 598	 4.34	 100.000	 0	 0	 0	 0	 0.000	 0.000	 1.871
Comm::Connection    	  156	 	 	 	 	 	 	 	 734	 112	 236	 0.44	 0.068	 734	 112	 236	 0.44	 100.000	 0	 0	 0	 0	 0.000	 0.000	 27.589
cbdata ConnStateData (17)	  220	 	 	 	 	 	 	 	 376	 81	 131	 0.41	 0.049	 376	 81	 131	 0.41	 100.000	 0	 0	 0	 0	 0.000	 0.000	 5.702
ipcache_entry       	   64	 	 	 	 	 	 	 	 1199	 75	 79	 0.53	 0.045	 1199	 75	 79	 0.53	 100.000	 0	 0	 0	 0	 0.000	 0.000	 1.353
ClientInfo          	  340	 	 	 	 	 	 	 	 170	 57	 57	 0.02	 0.034	 170	 57	 57	 0.02	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata ACLFilledChecklist (23)	  296	 	 	 	 	 	 	 	 145	 42	 60	 0.53	 0.025	 145	 42	 60	 0.53	 100.000	 0	 0	 0	 0	 0.000	 0.000	 12.833
Long Strings        	  512	 	 	 	 	 	 	 	 64	 32	 108	 1.53	 0.019	 64	 32	 108	 1.53	 100.000	 0	 0	 0	 0	 0.000	 0.000	 17.954
cbdata ClientHttpRequest (18)	  172	 	 	 	 	 	 	 	 109	 19	 38	 4.00	 0.011	 109	 19	 38	 4.00	 100.000	 0	 0	 0	 0	 0.000	 0.000	 12.833
8K Buffer           	 8192	 	 	 	 	 	 	 	 2	 16	 584	 4.35	 0.010	 2	 16	 584	 4.35	 100.000	 0	 0	 0	 0	 0.000	 0.000	 14.123
cbdata clientStreamNode (21)	   72	 	 	 	 	 	 	 	 218	 16	 32	 4.00	 0.009	 218	 16	 32	 4.00	 100.000	 0	 0	 0	 0	 0.000	 0.000	 25.667
2K Buffer           	 2048	 	 	 	 	 	 	 	 7	 14	 124	 4.49	 0.008	 7	 14	 124	 4.49	 100.000	 0	 0	 4	 19	 0.000	 0.000	 99.532
1KB Strings         	 1024	 	 	 	 	 	 	 	 11	 11	 57	 4.28	 0.007	 11	 11	 57	 4.28	 100.000	 0	 0	 0	 0	 0.000	 0.000	 9.698
cbdata helper_stateful_server (26)	  156	 	 	 	 	 	 	 	 68	 11	 11	 1.53	 0.006	 68	 11	 11	 1.53	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata ClientRequestContext (22)	   64	 	 	 	 	 	 	 	 148	 10	 14	 0.53	 0.006	 148	 10	 14	 0.53	 100.000	 0	 0	 0	 0	 0.000	 0.000	 12.833
cbdata TunnelStateData (30)	  116	 	 	 	 	 	 	 	 74	 9	 17	 2.87	 0.005	 74	 9	 17	 2.87	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.746
MimeEntry           	   48	 	 	 	 	 	 	 	 177	 9	 9	 14.07	 0.005	 177	 9	 9	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
Auth::Ntlm::User    	   92	 	 	 	 	 	 	 	 88	 8	 19	 3.12	 0.005	 88	 8	 19	 3.12	 100.000	 0	 0	 0	 0	 0.000	 0.000	 2.592
Auth::Ntlm::UserRequest	   44	 	 	 	 	 	 	 	 174	 8	 17	 0.41	 0.005	 174	 8	 17	 0.41	 100.000	 0	 0	 0	 0	 0.000	 0.000	 2.592
cbdata AuthUserIP (33)	   60	 	 	 	 	 	 	 	 78	 5	 12	 3.09	 0.003	 78	 5	 12	 3.09	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata store_client (28)	   96	 	 	 	 	 	 	 	 29	 3	 13	 4.50	 0.002	 29	 3	 13	 4.50	 100.000	 0	 0	 0	 0	 0.000	 0.000	 12.378
acl_proxy_auth_match_cache	   20	 	 	 	 	 	 	 	 125	 3	 5	 3.09	 0.001	 125	 3	 5	 3.09	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.139
fqdncache_entry     	   80	 	 	 	 	 	 	 	 28	 3	 3	 0.69	 0.001	 28	 3	 3	 0.69	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata HttpStateData (35)	  144	 	 	 	 	 	 	 	 15	 3	 9	 1.31	 0.001	 15	 3	 9	 1.31	 100.000	 0	 0	 0	 0	 0.000	 0.000	 6.423
Acl::AndNode        	  104	 	 	 	 	 	 	 	 17	 2	 2	 14.07	 0.001	 17	 2	 2	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata FwdState (34)	   88	 	 	 	 	 	 	 	 16	 2	 8	 4.49	 0.001	 16	 2	 8	 4.49	 100.000	 0	 0	 0	 0	 0.000	 0.000	 6.183
acl_ip_data         	   88	 	 	 	 	 	 	 	 13	 2	 2	 14.07	 0.001	 13	 2	 2	 14.07	 100.000	 0	 0	 1	 6	 0.000	 0.000	 0.000
cbdata Logfile (11) 	 1080	 	 	 	 	 	 	 	 1	 2	 2	 14.07	 0.001	 1	 2	 2	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
AuthUserHashPointer 	   12	 	 	 	 	 	 	 	 77	 1	 3	 3.09	 0.001	 77	 1	 3	 3.09	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata Tree (3)     	  136	 	 	 	 	 	 	 	 5	 1	 1	 14.07	 0.000	 5	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata UFSStoreState (39)	  104	 	 	 	 	 	 	 	 6	 1	 4	 0.48	 0.000	 6	 1	 4	 0.48	 100.000	 0	 0	 0	 0	 0.000	 0.000	 3.085
ACLStrategised      	  104	 	 	 	 	 	 	 	 5	 1	 1	 14.07	 0.000	 5	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata CbDataList (1)	   28	 	 	 	 	 	 	 	 18	 1	 1	 14.07	 0.000	 18	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLStrategised      	  104	 	 	 	 	 	 	 	 4	 1	 1	 14.07	 0.000	 4	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ev_entry            	   32	 	 	 	 	 	 	 	 12	 1	 1	 3.73	 0.000	 12	 1	 1	 3.73	 100.000	 0	 0	 0	 0	 0.000	 0.000	 1.770
ACLSourceIP         	   96	 	 	 	 	 	 	 	 4	 1	 1	 14.07	 0.000	 4	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata BlockingFile (40)	   52	 	 	 	 	 	 	 	 6	 1	 2	 0.48	 0.000	 6	 1	 2	 0.48	 100.000	 0	 0	 0	 0	 0.000	 0.000	 3.085
Acl::NotNode        	  104	 	 	 	 	 	 	 	 3	 1	 1	 14.07	 0.000	 3	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
RegexList           	   28	 	 	 	 	 	 	 	 8	 1	 1	 14.07	 0.000	 8	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata PortCfg (4)  	  100	 	 	 	 	 	 	 	 2	 1	 1	 14.07	 0.000	 2	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLProxyAuth        	  100	 	 	 	 	 	 	 	 2	 1	 1	 14.07	 0.000	 2	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLDestinationIP    	   96	 	 	 	 	 	 	 	 2	 1	 1	 14.07	 0.000	 2	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata BodyPipe (29)	   92	 	 	 	 	 	 	 	 2	 1	 2	 4.24	 0.000	 2	 1	 2	 4.24	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.202
cbdata StateData (25)	   28	 	 	 	 	 	 	 	 6	 1	 2	 4.41	 0.000	 6	 1	 2	 4.41	 100.000	 0	 0	 0	 0	 0.000	 0.000	 5.058
cbdata CbDataList (36)	   52	 	 	 	 	 	 	 	 3	 1	 3	 1.31	 0.000	 3	 1	 3	 1.31	 100.000	 0	 0	 0	 0	 0.000	 0.000	 24.428
ACLRegexData        	    8	 	 	 	 	 	 	 	 18	 1	 1	 14.07	 0.000	 18	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata statefulhelper (9)	  136	 	 	 	 	 	 	 	 1	 1	 1	 14.07	 0.000	 1	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata generic_cbdata (24)	   20	 	 	 	 	 	 	 	 6	 1	 2	 0.53	 0.000	 6	 1	 2	 0.53	 100.000	 0	 0	 0	 0	 0.000	 0.000	 4.337
cbdata RemovalPolicy (6)	   56	 	 	 	 	 	 	 	 2	 1	 1	 14.07	 0.000	 2	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata TcpAcceptor (15)	   56	 	 	 	 	 	 	 	 2	 1	 1	 14.07	 0.000	 2	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLStrategised      	  104	 	 	 	 	 	 	 	 1	 1	 1	 14.07	 0.000	 1	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLTimeData         	   20	 	 	 	 	 	 	 	 5	 1	 1	 14.07	 0.000	 5	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
helper_stateful_request	   16	 	 	 	 	 	 	 	 6	 1	 1	 4.41	 0.000	 6	 1	 1	 4.41	 100.000	 0	 0	 0	 0	 0.000	 0.000	 5.058
cbdata ConnOpener (32)	   76	 	 	 	 	 	 	 	 1	 1	 4	 4.25	 0.000	 1	 1	 4	 4.25	 100.000	 0	 0	 0	 0	 0.000	 0.000	 5.677
cbdata StoreSearchHashIndex (16)	   60	 	 	 	 	 	 	 	 1	 1	 1	 14.07	 0.000	 1	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata AclAddress (5)	   52	 	 	 	 	 	 	 	 1	 1	 1	 14.07	 0.000	 1	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLUserData         	   12	 	 	 	 	 	 	 	 4	 1	 1	 14.07	 0.000	 4	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLHTTPHeaderData   	   24	 	 	 	 	 	 	 	 2	 1	 1	 14.07	 0.000	 2	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLDomainData       	    8	 	 	 	 	 	 	 	 5	 1	 1	 14.07	 0.000	 5	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata CbDataList (2)	   36	 	 	 	 	 	 	 	 1	 1	 1	 14.07	 0.000	 1	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLStringData       	    8	 	 	 	 	 	 	 	 4	 1	 1	 14.07	 0.000	 4	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLHierCodeData     	   28	 	 	 	 	 	 	 	 1	 1	 1	 14.07	 0.000	 1	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
CacheDigest         	   24	 	 	 	 	 	 	 	 1	 1	 1	 14.07	 0.000	 1	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
wordlist            	    8	 	 	 	 	 	 	 	 3	 1	 2	 14.07	 0.000	 3	 1	 2	 14.07	 100.000	 0	 0	 2	 14	 0.000	 0.000	 0.000
ACLNoteData         	   20	 	 	 	 	 	 	 	 1	 1	 1	 14.07	 0.000	 1	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLASN              	    8	 	 	 	 	 	 	 	 2	 1	 1	 14.07	 0.000	 2	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLMethodData       	    8	 	 	 	 	 	 	 	 2	 1	 1	 14.07	 0.000	 2	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLProtocolData     	    8	 	 	 	 	 	 	 	 1	 1	 1	 14.07	 0.000	 1	 1	 1	 14.07	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
UFSStoreState::_queued_write	   20	 	 	 	 	 	 	 	 0	 0	 1	 14.06	 0.000	 0	 0	 1	 14.06	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 24.731
cbdata WriteRequest (41)	   48	 	 	 	 	 	 	 	 0	 0	 1	 14.06	 0.000	 0	 0	 1	 14.06	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 24.731
cbdata ReadRequest (42)	   44	 	 	 	 	 	 	 	 0	 0	 1	 14.03	 0.000	 0	 0	 1	 14.03	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 0.215
StoreMetaVary       	   16	 	 	 	 	 	 	 	 0	 0	 1	 14.04	 0.000	 0	 0	 1	 14.04	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 0.101
HttpHdrRange        	   20	 	 	 	 	 	 	 	 0	 0	 1	 1.47	 0.000	 0	 0	 1	 1.47	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
HttpHdrRangeSpec    	   16	 	 	 	 	 	 	 	 0	 0	 1	 1.47	 0.000	 0	 0	 1	 1.47	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata RemovalPolicyWalker (43)	   32	 	 	 	 	 	 	 	 0	 0	 1	 9.57	 0.000	 0	 0	 1	 9.57	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
HttpHdrSc           	    8	 	 	 	 	 	 	 	 0	 0	 1	 3.52	 0.000	 0	 0	 1	 3.52	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
4KB Strings         	 4096	 	 	 	 	 	 	 	 0	 0	 136	 2.22	 0.000	 0	 0	 136	 2.22	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 0.164
HttpHdrScTarget     	   48	 	 	 	 	 	 	 	 0	 0	 1	 3.52	 0.000	 0	 0	 1	 3.52	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
HttpHdrContRange    	   24	 	 	 	 	 	 	 	 0	 0	 1	 1.31	 0.000	 0	 0	 1	 1.31	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
FwdServer           	   12	 	 	 	 	 	 	 	 0	 0	 1	 5.03	 0.000	 0	 0	 1	 5.03	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 6.929
StoreSwapLogData    	   68	 	 	 	 	 	 	 	 0	 0	 1	 14.07	 0.000	 0	 0	 1	 14.07	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 5.803
dwrite_q            	   28	 	 	 	 	 	 	 	 0	 0	 1	 14.07	 0.000	 0	 0	 1	 14.07	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 30.535
dread_ctrl          	   32	 	 	 	 	 	 	 	 0	 0	 1	 14.03	 0.000	 0	 0	 1	 14.03	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 0.215
dlink_node          	   12	 	 	 	 	 	 	 	 0	 0	 1	 14.07	 0.000	 0	 0	 1	 14.07	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
link_list           	    8	 	 	 	 	 	 	 	 0	 0	 1	 14.06	 0.000	 0	 0	 1	 14.06	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 24.731
64K Buffer          	 65536	 	 	 	 	 	 	 	 0	 0	 320	 1.44	 0.000	 0	 0	 320	 1.44	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
32K Buffer          	 32768	 	 	 	 	 	 	 	 0	 0	 64	 3.77	 0.000	 0	 0	 64	 3.77	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
16KB Strings        	 16384	 	 	 	 	 	 	 	 0	 0	 64	 6.04	 0.000	 0	 0	 64	 6.04	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata ErrorState (27)	  140	 	 	 	 	 	 	 	 0	 0	 2	 4.27	 0.000	 0	 0	 2	 4.27	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 5.968
cbdata RebuildState (12)	  636	 	 	 	 	 	 	 	 0	 0	 1	 14.07	 0.000	 0	 0	 1	 14.07	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata ps_state (31)	  176	 	 	 	 	 	 	 	 0	 0	 1	 5.03	 0.000	 0	 0	 1	 5.03	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 6.929
cbdata idns_query (8)	 8604	 	 	 	 	 	 	 	 0	 0	 622	 0.53	 0.000	 0	 0	 622	 0.53	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 1.353
cbdata RemovalPurgeWalker (37)	   44	 	 	 	 	 	 	 	 0	 0	 1	 14.07	 0.000	 0	 0	 1	 14.07	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 0.923
StoreMetaMD5        	   16	 	 	 	 	 	 	 	 0	 0	 1	 14.06	 0.000	 0	 0	 1	 14.06	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 3.072
StoreMetaSTDLFS     	   16	 	 	 	 	 	 	 	 0	 0	 1	 14.06	 0.000	 0	 0	 1	 14.06	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 3.072
StoreMetaURL        	   16	 	 	 	 	 	 	 	 0	 0	 1	 14.06	 0.000	 0	 0	 1	 14.06	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 3.072
StoreMetaObjSize    	   16	 	 	 	 	 	 	 	 0	 0	 1	 14.06	 0.000	 0	 0	 1	 14.06	 -1.000	 0	 0	 0	 0	 0.000	 0.000	 3.072
Total               	    1	 	 	 	 	 	 	 	 658258	 165521	 178358	 0.53	 100.000	 658258	 165521	 178358	 0.53	 100.000	 0	 0	 2	 39	 0.000	 0.000	 5872366.497
Cumulative allocated volume: 55.251 GB
Current overhead: 20695 bytes (0.012%)
Idle pool limit: 0.00 MB
Total Pools created: 122
Pools ever used:     113 (shown above)
Currently in use:    84
String Pool	 Impact		
 	 (%strings)	 (%volume)
Short Strings       	 69	 39
Medium Strings      	 31	 61
Long Strings        	 0	 0
1KB Strings         	 0	 0
4KB Strings         	 0	 0
16KB Strings        	 0	 0
Other Strings       	 0	 0

Large buffers: 0 (0 KB)
-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru


From squid3 at treenet.co.nz  Wed Oct  1 08:12:28 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 01 Oct 2014 21:12:28 +1300
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <20141001074518.GA29967@admin.sibptus.tomsk.ru>
References: <5427C7E6.3070600@zhegan.in>
 <20140928091835.GA37229@admin.sibptus.tomsk.ru>
 <5427E97A.1020309@ngtech.co.il>
 <20140928124159.GA38727@admin.sibptus.tomsk.ru>
 <5428AA6B.1010201@treenet.co.nz>
 <20140929071652.GA60398@admin.sibptus.tomsk.ru>
 <54291BB8.5020904@treenet.co.nz>
 <20140930022859.GA83414@admin.sibptus.tomsk.ru>
 <20140930053326.GA90693@admin.sibptus.tomsk.ru>
 <542AC521.2040006@treenet.co.nz>
 <20141001074518.GA29967@admin.sibptus.tomsk.ru>
Message-ID: <542BB76C.1010809@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 1/10/2014 8:45 p.m., Victor Sudakov wrote:
> Amos Jeffries wrote:
>>>>> 
>>>>> You have 200 MB of RAM locked up in IDENT lookups.
>>>>> 
>>>>> Probably http://bugs.squid-cache.org/show_bug.cgi?id=3803
>>>> 
>>>> I have temporarily disabled IDENT-related acls. Squid still
>>>> grows in memory, but more slowly. So IDENT was certainly one
>>>> of the major causes of the leak.
>>>> 
>>>> Could we make another iteration of looking at the
>>>> cachemgr.cgi memory counters?
>>>> 
>>> 
>>> Attaching two cachemgr reports: right after squid restart and 
>>> several hours later (grown to 816M in SIZE).
>>> 
>> 
>> These are still showing over 47K IDENT lookups.
>> 
>> Probably you did not disable all the uses of IDENT. You need to
>> both set "ident_access deny all" and remove use of ident type
>> ACLs.
> 
> Bingo! After setting "ident_access deny all" squid does not grow 
> infinitely any more. However, it remains a major CPU hog.
> 

Yay. Any news on the bug patch?


Note that from the same "CPU hog" cycles you are now getting around 2x
the HTTP traffic throughput.

> 
> Start Time:	Mon, 29 Sep 2014 15:24:54 GMT Current Time:	Tue, 30 Sep
> 2014 02:09:51 GMT Connection information for squid: Number of
> clients accessing cache:	161 Number of HTTP requests received:
> 152054 Average HTTP requests per minute since start:	235.8 Select
> loop called: 4664551 times, 8.296 ms avg



> Start Time:	Tue, 30 Sep 2014 15:56:38 GMT Current Time:	Wed, 01 Oct
> 2014 06:00:28 GMT Connection information for squid: Number of
> clients accessing cache:	170 Number of HTTP requests received:
> 375550 Average HTTP requests per minute since start:	445.1 Select
> loop called: 32559927 times, 1.555 ms avg

You have the delay pools feature configured. It is a wasteful consumer
of CPU cycles. Also NTLM authentication is used, that doubles the HTTP
request overheads on each new TCP connection.


There are two things you can do to further improve performance:
 1) converting from NTLM to Kerberos authentication.
 2) moving the delay pools limitation into kernel QoS systems.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUK7dsAAoJELJo5wb/XPRjJqQIAICPcvQbP+pMvmZk5SnqHUvU
vrHLXcK1+WHhw+29UvYTZUQaTf8f7r3oWSfQS4mm56YrekMiFFJSeb+QMTh3nRdK
ij3dcgdk/cT1ziQJgyh7i2AyzpC8iAofC5I8MTP247qzV14s0ZdmtRpyCbPYeRL5
JqCsMW+X/7dWbVvNhSjb0J57Po2M4Fo0RWFuPIhU/gOP6jLyesbqgm1CaGXSYvyh
kVjwZuaNKjCL1bV18vPPMJXW6Kgl6p4cK+X/v8aw00Eb2EcYsu8ieaLXvAehlsuB
xViLWe1KPuJOawJ6uaGULkoGF+a6hc+3DbJ+iLHRFNdW1OHvKWJGgOs8M5jiIHw=
=Z7vQ
-----END PGP SIGNATURE-----


From ric.castellani at alice.it  Wed Oct  1 08:10:04 2014
From: ric.castellani at alice.it (Riccardo Castellani)
Date: Wed, 1 Oct 2014 10:10:04 +0200 (CEST)
Subject: [squid-users] detect 'youtube.com' url
Message-ID: <148cac24bca.ric.castellani@alice.it>

I need to detect every client request (http/s) which contains the url
'youtube.
com' so i thought to use acl url_regex expression.
What do you think about it ?


acl url_regex -i ^(http|https):\/\/*.youtube\.com*.



From esr+squid at g.jct.ac.il  Wed Oct  1 08:22:16 2014
From: esr+squid at g.jct.ac.il (E.S. Rosenberg)
Date: Wed, 1 Oct 2014 11:22:16 +0300
Subject: [squid-users] detect 'youtube.com' url
In-Reply-To: <148cac24bca.ric.castellani@alice.it>
References: <148cac24bca.ric.castellani@alice.it>
Message-ID: <CAHTx_BM_ttUb7PR0agKNPkT62F2Lik7ycxmf3rs0MprP-maVLA@mail.gmail.com>

acl dstdomain .youtube.com
will match all visits to youtube, it will not detect youtube in the path
but your regex won't either.

2014-10-01 11:10 GMT+03:00 Riccardo Castellani <ric.castellani at alice.it>:

> I need to detect every client request (http/s) which contains the url
> 'youtube.
> com' so i thought to use acl url_regex expression.
> What do you think about it ?
>
>
> acl url_regex -i ^(http|https):\/\/*.youtube\.com*.
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141001/e0a571f6/attachment.htm>

From squid at visolve.com  Wed Oct  1 09:14:56 2014
From: squid at visolve.com (Visolve Squid)
Date: Wed, 01 Oct 2014 14:44:56 +0530
Subject: [squid-users] detect 'youtube.com' url
In-Reply-To: <148cac24bca.ric.castellani@alice.it>
References: <148cac24bca.ric.castellani@alice.it>
Message-ID: <542BC610.5050907@visolve.com>

Spam detection software, running on the system "master.squid-cache.org",
has identified this incoming email as possible spam.  The original
message has been attached to this so you can view it or label
similar future email.  If you have any questions, see
@@CONTACT_ADDRESS@@ for details.

Content preview:  Hi Team, We have go with following commands in the squid configuration
   for blocking particular sites(www.youtube.com) and also blocking keywords.
   Blocking both the website and keyword. [...] 

Content analysis details:   (5.9 points, 5.0 required)

 pts rule name              description
---- ---------------------- --------------------------------------------------
 0.0 URIBL_BLOCKED          ADMINISTRATOR NOTICE: The query to URIBL was blocked.
                            See
                            http://wiki.apache.org/spamassassin/DnsBlocklists#dnsbl-block
                             for more information.
                            [URIs: squid-cache.org]
 1.6 RCVD_IN_BRBL_LASTEXT   RBL: No description available.
                            [182.73.50.82 listed in bb.barracudacentral.org]
 0.7 RCVD_IN_XBL            RBL: Received via a relay in Spamhaus XBL
                            [182.73.50.82 listed in zen.spamhaus.org]
 3.6 RCVD_IN_PBL            RBL: Received via a relay in Spamhaus PBL
 0.0 UNPARSEABLE_RELAY      Informational: message has unparseable relay lines


-------------- next part --------------
An embedded message was scrubbed...
From: Visolve Squid <squid at visolve.com>
Subject: Re: [squid-users] detect 'youtube.com' url
Date: Wed, 01 Oct 2014 14:44:56 +0530
Size: 2008
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141001/cff1cf1b/attachment.eml>

From squid at visolve.com  Wed Oct  1 09:17:12 2014
From: squid at visolve.com (Squid)
Date: Wed, 01 Oct 2014 14:47:12 +0530
Subject: [squid-users] detect 'youtube.com' url
In-Reply-To: <148cac24bca.ric.castellani@alice.it>
References: <148cac24bca.ric.castellani@alice.it>
Message-ID: <542BC698.8070909@visolve.com>

Spam detection software, running on the system "master.squid-cache.org",
has identified this incoming email as possible spam.  The original
message has been attached to this so you can view it or label
similar future email.  If you have any questions, see
@@CONTACT_ADDRESS@@ for details.

Content preview:  Hi Team, We have go with following commands in the squid configuration
   for blocking particular sites(youtube.com) and also blocking keywords. Blocking
   both the website and keyword. [...] 

Content analysis details:   (5.9 points, 5.0 required)

 pts rule name              description
---- ---------------------- --------------------------------------------------
 0.0 URIBL_BLOCKED          ADMINISTRATOR NOTICE: The query to URIBL was blocked.
                            See
                            http://wiki.apache.org/spamassassin/DnsBlocklists#dnsbl-block
                             for more information.
                            [URIs: squid-cache.org]
 1.6 RCVD_IN_BRBL_LASTEXT   RBL: No description available.
                            [182.73.50.82 listed in bb.barracudacentral.org]
 3.6 RCVD_IN_PBL            RBL: Received via a relay in Spamhaus PBL
                            [182.73.50.82 listed in zen.spamhaus.org]
 0.7 RCVD_IN_XBL            RBL: Received via a relay in Spamhaus XBL
 0.0 UNPARSEABLE_RELAY      Informational: message has unparseable relay lines


-------------- next part --------------
An embedded message was scrubbed...
From: Squid <squid at visolve.com>
Subject: Re: [squid-users] detect 'youtube.com' url
Date: Wed, 01 Oct 2014 14:47:12 +0530
Size: 1996
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141001/0d2fc6c1/attachment.eml>

From ric.castellani at alice.it  Wed Oct  1 09:34:56 2014
From: ric.castellani at alice.it (Riccardo Castellani)
Date: Wed, 1 Oct 2014 11:34:56 +0200 (CEST)
Subject: [squid-users] R: Re:  detect 'youtube.com' url
Message-ID: <148cb1000bc.ric.castellani@alice.it>

By this ACL I can see only https streaming video but not http, that is I open 
page but video is black (no audio, no video), saying loading
How can I debug 
this problem?
My scope is to see video streming for specific users

Why my acl 
will not work ?!

>----Messaggio originale----
>Da: esr+squid at g.jct.ac.il

>Data: 1-ott-2014 10.22
>A: 
>Cc: "squid-users at squid-cache.org"
>Ogg: Re: 
[squid-users] detect &#39;youtube.com&#39; url
>
>acl dstdomain .youtube.com

>will match all visits to youtube, it will not detect youtube in the path
>but 
your regex won't either.
>
>2014-10-01 11:10 GMT+03:00 Riccardo Castellani :
>

>> I need to detect every client request (http/s) which contains the url
>> 
'youtube.
>> com' so i thought to use acl url_regex expression.
>> What do you 
think about it ?
>>
>>
>> acl url_regex -i ^(http|https):\/\/*.youtube\.com*.

>>
>> _______________________________________________
>> squid-users mailing 
list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users>>
>




From ric.castellani at alice.it  Wed Oct  1 09:50:56 2014
From: ric.castellani at alice.it (Riccardo Castellani)
Date: Wed, 1 Oct 2014 11:50:56 +0200 (CEST)
Subject: [squid-users] R: Re: Re:  detect 'youtube.com' url
Message-ID: <148cb1ea7d6.ric.castellani@alice.it>

I'm visiting http://www.youtu....comand I can see the page but video is not 
able to start while if I'm visiting https://www.youtu....Ican see video.

My 
squid.conf 'head' :

http_access allow myip
http_access allow CONNECT myip

I 
don't know how to find out if it's Squid which is blocking my video


>----
Messaggio originale----
>Da: esr+squid at g.jct.ac.il
>Data: 1-ott-2014 11.35
>A: 
"Raspone Favilndia"
>Ogg: Re: Re: [squid-users] detect &#39;youtube.com&#39; 
url
>
>I don't understand hat you want, you have to be more specific.
>
>2014-
10-01 12:33 GMT+03:00 Riccardo Castellani :
>
>>
>> By this ACL I can see only 
https streaming video but not http, that is I
>> open
>> page but video is 
black (no audio, no video), saying loading
>> How can I debug
>> this problem?

>> My scope is to see video streming for specific users
>>
>>
>>
>> thanks
>>

>>
>> >----Messaggio originale----
>> >Da: esr+squid at g.jct.ac.il
>> >Data: 1-
ott-2014 10.22
>>
>> >A:
>> >Cc: "squid-users at squid-cache.org"
>> >Ogg: Re: 
[squid-users] detect &#39;
>> youtube.com&#39; url
>> >
>> >acl dstdomain .
youtube.com
>> >will match all visits to
>> youtube, it will not detect youtube 
in the path
>> >but your regex won't either.
>> >
>>
>> >2014-10-01 11:10 
GMT+03:00 Riccardo Castellani :
>> >
>> >> I need to detect every
>> client 
request (http/s) which contains the url
>> >> 'youtube.
>> >> com' so i
>> 
thought to use acl url_regex expression.
>> >> What do you think about it ?
>> 
>>
>> >>
>>
>> >> acl url_regex -i ^(http|https):\/\/*.youtube\.com*.
>> >>
>> 
>>
>> _______________________________________________
>> >> squid-users mailing 
list
>> >>
>> squid-users at lists.squid-cache.org
>> >> http://lists.squid-cache.org/listinfo/squid-users>>>> >
>>
>>
>>
>




From "darrenjbreeze" at netvigator.com  Wed Oct  1 10:23:46 2014
From: "darrenjbreeze" at netvigator.com (Darren B.)
Date: Wed, 01 Oct 2014 18:23:46 +0800
Subject: [squid-users] Transparent proxy with squid and Dansguardian
In-Reply-To: <148cb1ea7d6.ric.castellani@alice.it>
References: <148cb1ea7d6.ric.castellani@alice.it>
Message-ID: <mailman.0.1736411231.1101126.squid-users@lists.squid-cache.org>


HI

I am trying to set up a router that allows a group of devices on a 
network to access the internet via Dansguardian and squid.

I am setting it up as a transparent proxy and locking down the ports 
with IPtables.

I am using IPtables to redirect connections on port 80 from the client 
and remap them to 8080 for dansguardian, dans is then set up to talk to 
squid on 127.0.0.1:3128

the iptables rules are

iptables -A PREROUTING -p tcp -m tcp -i eth1 --dport 80 -j REDIRECT 
--to-ports 8080
iptables -A POSTROUTING -j MASQUERADE

if I set the rule above to REDIRECT to 3128, the cache works as 
expected. If I set it above, I can see traffic in DG and in the cache 
log of squid but the target IF address is stripped out and I seem to be 
getting a forwarding loop.

I am not sure what is going on but it seems that Dansguardian is 
rewriting the target address and getting squid to loop back on itself.

All the various versions are current to ubuntu 14.04 although the 
dansguardian is a little old in this distro.

Any pointers would be greatly appreciated.


Darren B.




Currently the processes running and listening are

root at dnsmasq:~# netstat -ntlp | grep LISTEN
tcp        0      0 0.0.0.0:53              0.0.0.0:* LISTEN      
1068/dnsmasq
tcp        0      0 0.0.0.0:22              0.0.0.0:* LISTEN      1022/sshd
tcp        0      0 0.0.0.0:3128            0.0.0.0:* LISTEN      
1610/squid3
tcp        0      0 0.0.0.0:8080            0.0.0.0:* LISTEN      
4202/dansguardian
tcp        0      0 0.0.0.0:10000           0.0.0.0:* LISTEN      1149/perl
tcp6       0      0 :::53                   :::* LISTEN      1068/dnsmasq
tcp6       0      0 :::22                   :::* LISTEN      1022/sshd
tcp6       0      0 :::3129                 :::* LISTEN      1610/squid3


Squid config is currently this

acl localnet1 src 172.25.101.0/24       # RFC1918 possible internal network
acl localnet2 src 172.25.102.0/24       # RFC1918 possible internal network
acl localnet3 src 172.25.103.0/24       # RFC1918 possible internal network

acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl CONNECT method CONNECT

http_access allow localhost
http_access allow localnet1
http_access allow localnet2
http_access allow localnet3

http_access deny !Safe_ports

always_direct allow all

http_access deny CONNECT !SSL_ports

cache_effective_user proxy
cache_effective_group proxy

# http_access deny manager

http_port 3128 intercept
http_port 3129

debug_options All,2 78,5

cache_dir ufs /mnt/ksn/squid/cache 100 16 256

coredump_dir /var/spool/squid3

refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern (Release|Packages(.gz)*)$      0       20%     2880
refresh_pattern .               0       20%     4320

#Performance Tuning Options
hosts_file /etc/hosts
dns_nameservers 127.0.0.1
cache_replacement_policy heap LFUDA
cache_swap_low 90
cache_swap_high 95
#cache_mem 200MB
logfile_rotate 10
memory_pools off
maximum_object_size 50 MB
maximum_object_size_in_memory 50 KB
quick_abort_min 0 KB
quick_abort_max 0 KB
log_icp_queries off
client_db off
buffered_logs on
half_closed_clients off









From squid3 at treenet.co.nz  Wed Oct  1 10:58:52 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 01 Oct 2014 23:58:52 +1300
Subject: [squid-users] R: Re:  detect 'youtube.com' url
In-Reply-To: <148cb1000bc.ric.castellani@alice.it>
References: <148cb1000bc.ric.castellani@alice.it>
Message-ID: <542BDE6C.3020704@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 1/10/2014 10:34 p.m., Riccardo Castellani wrote:
> By this ACL I can see only https streaming video but not http, that
> is I open page but video is black (no audio, no video), saying
> loading How can I debug this problem? My scope is to see video
> streming for specific users
> 
> Why my acl will not work ?!

It is working.

_The problem_ is that you asked only about matching youtube.com.

youtube.com is just the public HTML face of the service.

The images come from *.ytimg.com and the videos from
*.googlevideo.com. There is also *.ggpht.com, *.youtube-nocookie.com
involved with the user accounts.

You need all these domains in the ACL to manage access to the YouTube
service.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUK95sAAoJELJo5wb/XPRjZq8IANxj7T4igccZdvxb+1zzM9P7
n7Gv6AsJ3GhkSbGX+zJSPnI+8cVy88ZASYjV1dxEOaoqAkw5taFmxxrE39a+4D9O
JWh8uIekIjx+mZPnMBzm+H3z3AHInVXUAMDNQclFlH1kUdV06fRNQXS7YIN8TaoG
75e6q+i+aIIjqRJxMR2mo9KVmWca1jD/BZt5O273Oddi4+xl8Af4OOwYV4oF1pNr
ONAtHYcyyNyuOsgqB9vpObmmvNROtcK/Kw2z3p6xQFvg7SOaWwnUkjC+zSM1xkdX
wMmBhqQBkfRVTGj9jyyNXCbB4aAt6F3s2I9wbxBQN0n2S2NYS6dNSrN64StZKb0=
=GEEQ
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Wed Oct  1 11:10:32 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 02 Oct 2014 00:10:32 +1300
Subject: [squid-users] Transparent proxy with squid and Dansguardian
In-Reply-To: <20141001102357.04B5FE2433@lists.squid-cache.org>
References: <148cb1ea7d6.ric.castellani@alice.it>
 <20141001102357.04B5FE2433@lists.squid-cache.org>
Message-ID: <542BE128.5030903@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Please post a new thread email to the list instead of replying to an
existing topic. This has nothing to do with YouTube access control.


On 1/10/2014 11:23 p.m., Darren B. wrote:
> 
> HI
> 
> I am trying to set up a router that allows a group of devices on a 
> network to access the internet via Dansguardian and squid.
> 
> I am setting it up as a transparent proxy and locking down the
> ports with IPtables.
> 
> I am using IPtables to redirect connections on port 80 from the
> client and remap them to 8080 for dansguardian, dans is then set up
> to talk to squid on 127.0.0.1:3128
> 
> the iptables rules are
> 
> iptables -A PREROUTING -p tcp -m tcp -i eth1 --dport 80 -j
> REDIRECT --to-ports 8080 iptables -A POSTROUTING -j MASQUERADE
> 
> if I set the rule above to REDIRECT to 3128, the cache works as 
> expected. If I set it above, I can see traffic in DG and in the
> cache log of squid but the target IF address is stripped out and I
> seem to be getting a forwarding loop.
> 
> I am not sure what is going on but it seems that Dansguardian is 
> rewriting the target address and getting squid to loop back on
> itself.

DG is opening a regular TCP connection from itself (127.0.0.1:*) to
Squid (127.0.0.1:3128). Nothing Special.

> 
> All the various versions are current to ubuntu 14.04 although the 
> dansguardian is a little old in this distro.
> 
> Any pointers would be greatly appreciated.

Okay, some pointers...

 * REDIRECT is NAT interception.

 * You have DG configured to use Squid port 3128 *without* NAT between
them.

 * You configured Squid to receive NAT traffic on port 3128.

 * You configured Squid to receive expicitly configured clients (like
DG) on port 3129.

 * you must only send the configured type of traffic to a Squid port.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUK+EoAAoJELJo5wb/XPRjFWcH/1v6l48h2TuDydVuk9p87BMs
NZ8IrbcMtkqmNaIoWJ8KapvpFERBDyZVVQ54TX1iVPOUh4nHPskzzc7iZFXK1P5h
F+oIqecgaQ+KwbdIRn0YJF5w0XppSiH1aRX3dmbwIHI3ghH7cca7Nj6txHdhyaq0
udlEp+1mteyy+7gbGJTNVR4XCqDPwVfgBzuvMtQFI2C6yqf7OcxqibAW/J9SYp5z
XM/Ap8tw7Q2xNC9a8BI/AURb4RkcelMX/iQ1G41oMCKcKEW2BjfOe6AVe0UbT8AD
jNDkhsmLqgOHfubiMhRiZHkayy1qcJLapNuyi5XkYcASD1rTtuqKoBhumqiJFrE=
=w4j+
-----END PGP SIGNATURE-----


From ric.castellani at alice.it  Wed Oct  1 11:40:19 2014
From: ric.castellani at alice.it (Riccardo Castellani)
Date: Wed, 1 Oct 2014 13:40:19 +0200 (CEST)
Subject: [squid-users] R: Re:  R: Re:  detect 'youtube.com' url
Message-ID: <148cb82cc4d.ric.castellani@alice.it>

That's all right! 
Few minutes ago infact I found out my problems:

Youtube 
content is coming from several site, as you told me, so my Squid denies access 
to these one and other times my redirect program (jesres) redirects these url.

It's possible to know exactly what sites are involved into show youtube video 
please so I can permit access it to my squid

thanks 



>----Messaggio 
originale----
>Da: squid3 at treenet.co.nz
>Data: 1-ott-2014 12.58
>A: 
>Ogg: Re: 
[squid-users] R: Re:  detect &#39;youtube.com&#39; url
>
>-----BEGIN PGP SIGNED 
MESSAGE-----
>Hash: SHA1
>
>On 1/10/2014 10:34 p.m., Riccardo Castellani wrote:

>> By this ACL I can see only https streaming video but not http, that
>> is I 
open page but video is black (no audio, no video), saying
>> loading How can I 
debug this problem? My scope is to see video
>> streming for specific users
>> 

>> Why my acl will not work ?!
>
>It is working.
>
>_The problem_ is that you 
asked only about matching youtube.com.
>
>youtube.com is just the public HTML 
face of the service.
>
>The images come from *.ytimg.com and the videos from
>*.
googlevideo.com. There is also *.ggpht.com, *.youtube-nocookie.com
>involved 
with the user accounts.
>
>You need all these domains in the ACL to manage 
access to the YouTube
>service.
>
>Amos
>
>-----BEGIN PGP SIGNATURE-----

>Version: GnuPG v2.0.22 (MingW32)
>

>iQEcBAEBAgAGBQJUK95sAAoJELJo5wb/XPRjZq8IANxj7T4igccZdvxb+1zzM9P7

>n7Gv6AsJ3GhkSbGX+zJSPnI+8cVy88ZASYjV1dxEOaoqAkw5taFmxxrE39a+4D9O

>JWh8uIekIjx+mZPnMBzm+H3z3AHInVXUAMDNQclFlH1kUdV06fRNQXS7YIN8TaoG

>75e6q+i+aIIjqRJxMR2mo9KVmWca1jD/BZt5O273Oddi4+xl8Af4OOwYV4oF1pNr

>ONAtHYcyyNyuOsgqB9vpObmmvNROtcK/Kw2z3p6xQFvg7SOaWwnUkjC+zSM1xkdX

>wMmBhqQBkfRVTGj9jyyNXCbB4aAt6F3s2I9wbxBQN0n2S2NYS6dNSrN64StZKb0=
>=GEEQ
>-----
END PGP SIGNATURE-----
>_______________________________________________
>squid-
users mailing list
>squid-users at lists.squid-cache.org
>http://lists.squid-cache.org/listinfo/squid-users>




From steve at opendium.com  Wed Oct  1 12:02:58 2014
From: steve at opendium.com (Steve Hill)
Date: Wed, 01 Oct 2014 13:02:58 +0100
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <5429209D.1050909@opendium.com>
References: <20140928062806.GA34166@admin.sibptus.tomsk.ru>
 <5427B9EC.6060500@ngtech.co.il> <5429209D.1050909@opendium.com>
Message-ID: <542BED72.7080305@opendium.com>

On 29.09.14 10:04, Steve Hill wrote:

> I _think_ I have narrowed it down to something ICAP related

Looks like I was wrong - it actually seems to be external ACL related.

I have an external ACL defined as:
external_acl_type preauth cache=0 children-max=1 concurrency=100 ttl=0 
negative_ttl=0 %SRC %>{User-Agent} %URI %METHOD /usr/sbin/squid-preauth

The inclusion of %URI means that it's going to be called a lot, even 
with caching, but in this case I've turned caching off.  As far as I can 
see in the code, if cache=0 or (ttl=0 and negative_ttl=0), it doesn't 
touch the cache at all so my guess is that this isn't a problem with the 
caching code.

I'm testing this with Siege and consistently seeing "Total size" 
increasing by about 51MB and "memPool unaccounted" increasing by about 
14MB after 20,000 requests from a fresh start (so, 2.6K per request and 
0.7K/request respectively).  If I disable the external ACL then I see 
growths of about 10MB and 1MB respectively.

Although this isn't especially consistent with the stats from a 
production system that I tested yesterday, which showed about 
5.5K/request (total) and 5K/request (unaccounted) over 926815 requests.

-- 
  - Steve


From bergonz at labs.it  Wed Oct  1 12:19:16 2014
From: bergonz at labs.it (Michele Bergonzoni)
Date: Wed, 01 Oct 2014 14:19:16 +0200
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <542BED72.7080305@opendium.com>
References: <20140928062806.GA34166@admin.sibptus.tomsk.ru>
 <5427B9EC.6060500@ngtech.co.il> <5429209D.1050909@opendium.com>
 <542BED72.7080305@opendium.com>
Message-ID: <542BF144.3010702@labs.it>

> I have an external ACL defined as:
> external_acl_type preauth cache=0 children-max=1 concurrency=100 ttl=0
> negative_ttl=0 %SRC %>{User-Agent} %URI %METHOD /usr/sbin/squid-preauth

It is well known that external ACLs with ttl=0 and cache=0 leak RAM: I 
had this problem and discovered the reason only recently, but Amos knows 
it since 2011:

https://www.mail-archive.com/squid-dev at squid-cache.org/msg14809.html

I recently opened a bug about this, that I will update now:

http://bugs.squid-cache.org/show_bug.cgi?id=4088

A workaround that we use and may be applicable in your case is to use 
ttl=1 cache=1.

Regards,
                      Bergonz



-- 
Ing. Michele Bergonzoni - Laboratori Guglielmo Marconi S.p.a.
Phone:+39-051-6781926 e-mail: bergonz at labs.it
alt.advanced.networks.design.configure.operate


From squid3 at treenet.co.nz  Wed Oct  1 12:54:58 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 02 Oct 2014 01:54:58 +1300
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <542BF144.3010702@labs.it>
References: <20140928062806.GA34166@admin.sibptus.tomsk.ru>
 <5427B9EC.6060500@ngtech.co.il> <5429209D.1050909@opendium.com>
 <542BED72.7080305@opendium.com> <542BF144.3010702@labs.it>
Message-ID: <542BF9A2.4070208@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 2/10/2014 1:19 a.m., Michele Bergonzoni wrote:
>> I have an external ACL defined as: external_acl_type preauth
>> cache=0 children-max=1 concurrency=100 ttl=0 negative_ttl=0 %SRC
>> %>{User-Agent} %URI %METHOD /usr/sbin/squid-preauth
> 
> It is well known that external ACLs with ttl=0 and cache=0 leak
> RAM: I had this problem and discovered the reason only recently,
> but Amos knows it since 2011:
> 
> https://www.mail-archive.com/squid-dev at squid-cache.org/msg14809.html
>
> 
If you read the next post in that thread you will see the referenced
patch was dropped. IIRC it always produced a non-match result in some
configs.

An updated variant is present in 3.4 which still produces a useful
result in all cases. The leak is probably from that.

> I recently opened a bug about this, that I will update now:
> 
> http://bugs.squid-cache.org/show_bug.cgi?id=4088
> 
> A workaround that we use and may be applicable in your case is to
> use ttl=1 cache=1.
> 

Thank you for the reminder. I will start work on this next.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUK/miAAoJELJo5wb/XPRjTeMH/jxUyS/7Bn14nYC3zkR6O4Oi
LPjCSKVxsOpjyr0577bmvYwmCEC6KEOO5cwoPUXNPys4OuZ8w4nQjo98Jsh1yF4n
/atpPWS+qOFXwHgvgU1SPlxbl3hB44jQCuOQPqgtX7ZQff4c4z7EbH03Ieq2Y9pq
6S8jo+jtAN4p9kRgnhgLy1uMM4mP3uM4mFKimkY3f5seQynL02+xzFamqEpxzoUU
87cieyHRy4okicC2VvAg33/ErpXJLAfYswF+pbZcOqxnerbI08mXK9HeCkXuATUB
v1z4HEJKlZijJFUr9DfZ4d9ara/abQUiVs8gr+kDBRDF51i3F235VxWDdGSHjxU=
=DPXu
-----END PGP SIGNATURE-----


From steve at opendium.com  Wed Oct  1 13:44:25 2014
From: steve at opendium.com (Steve Hill)
Date: Wed, 01 Oct 2014 14:44:25 +0100
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <542BF144.3010702@labs.it>
References: <20140928062806.GA34166@admin.sibptus.tomsk.ru>
 <5427B9EC.6060500@ngtech.co.il> <5429209D.1050909@opendium.com>
 <542BED72.7080305@opendium.com> <542BF144.3010702@labs.it>
Message-ID: <542C0539.6000002@opendium.com>

On 01.10.14 13:19, Michele Bergonzoni wrote:
>> I have an external ACL defined as:
>> external_acl_type preauth cache=0 children-max=1 concurrency=100 ttl=0
>> negative_ttl=0 %SRC %>{User-Agent} %URI %METHOD /usr/sbin/squid-preauth
>
> It is well known that external ACLs with ttl=0 and cache=0 leak RAM: I
> had this problem and discovered the reason only recently, but Amos knows
> it since 2011:

Hmm, I've changed my ttl, negative_ttl and cache to 1 and Squid nolonger 
seems to grow under test conditions... Unfortunately it looks like its 
still growing on the production system.  I guess my tests aren't 
reproducing the same issue - back to the drawing board. :(



-- 
-- 
  - Steve Hill
    Technical Director
    Opendium Limited     http://www.opendium.com

Direct contacts:
    Instant messager: xmpp:steve at opendium.com
    Email:            steve at opendium.com
    Phone:            sip:steve at opendium.com

Sales / enquiries contacts:
    Email:            sales at opendium.com
    Phone:            +44-844-9791439 / sip:sales at opendium.com

Support contacts:
    Email:            support at opendium.com
    Phone:            +44-844-4844916 / sip:support at opendium.com


From squid at visolve.com  Wed Oct  1 13:47:50 2014
From: squid at visolve.com (Squid)
Date: Wed, 01 Oct 2014 19:17:50 +0530
Subject: [squid-users] detect 'youtube.com' url
In-Reply-To: <148cac24bca.ric.castellani@alice.it>
References: <148cac24bca.ric.castellani@alice.it>
Message-ID: <542C0606.3030706@visolve.com>

Hi Team,

We have go with following commands in the squid configuration for 
blocking particular sites(youtube.com) and also blocking keywords.

Blocking both the website and keyword.

# ACL block sites
acl blocksites dstdomain  .youtube.com

# ACL block keywords
acl blockkeywords url_regex -i .youtube.com

#Deny access to block keywords ACL  &  block sites ACL's
http_access deny blockkeywords
http_access deny blocksites


Regards,
ViSolve Squid

On 10/1/2014 1:40 PM, Riccardo Castellani wrote:
> I need to detect every client request (http/s) which contains the url
> 'youtube.
> com' so i thought to use acl url_regex expression.
> What do you think about it ?
>
>
> acl url_regex -i ^(http|https):\/\/*.youtube\.com*.
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From vdoctor at neuf.fr  Thu Oct  2 07:27:42 2014
From: vdoctor at neuf.fr (Stakres)
Date: Thu, 2 Oct 2014 00:27:42 -0700 (PDT)
Subject: [squid-users] Squid 3.4.x Videos/Music Booster
In-Reply-To: <1402558228027-4666310.post@n4.nabble.com>
References: <1401445017211-4666154.post@n4.nabble.com>
 <1402342920545-4666272.post@n4.nabble.com>
 <CAOoxthOFdUyjpPcyNYx6maQ=8EJuX8LCm6EjFRQ6ySt4fUaRXQ@mail.gmail.com>
 <CAOoxthNhLP26KUWVy+OpPobQgb6oeU-Y7cQ+dMvghXXWfNrz=w@mail.gmail.com>
 <1402470426333-4666302.post@n4.nabble.com>
 <1402558228027-4666310.post@n4.nabble.com>
Message-ID: <1412234862102-4667630.post@n4.nabble.com>

Hi All,

New  version 1.06 <https://sourceforge.net/projects/squidvideosbooster/>  .
Ruby script removed due to incoherences in the code
Perl script improved with detection of empty lines
Perl and Python scripts with "porn=0/1" option to de-duplicate porn websites

Bye Fred



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-3-4-x-Videos-Music-Booster-tp4666154p4667630.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From squid3 at treenet.co.nz  Thu Oct  2 09:08:18 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 02 Oct 2014 22:08:18 +1300
Subject: [squid-users] Squid 3.4.8 is available
Message-ID: <542D1602.1020701@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

The Squid HTTP Proxy team is very pleased to announce the availability
of the Squid-3.4.8 release!


This release is a security release resolving several vulnerability
issues found in the prior Squid releases.


The major changes to be aware of:


* CVE-2014-6270 : SQUID-2014:3 Buffer overflow in SNMP processing

  http://www.squid-cache.org/Advisories/SQUID-2014_3.txt

This vulnerability allows any client who is allowed to send SNMP
packets to the proxy to perform a denial of service attack on Squid.

The issue came to light as the result of active 0-day attacks. Since
publication several other attack sightings have been reported.


* CVE-2014-7141 and CVE-2014-7142 : SQUID-2014:4

  http://www.squid-cache.org/Advisories/SQUID-2014_4.txt

These vulnerabilities allow a remote attack server to trigger DoS or
information leakage by sending various malformed ICMP and ICMPv6
packets to the Squid pinger helper.
The worst-case DoS scenario is a rarity, a more common impact will be
general service degradation for high-performance systems relying on
the pinger for realtime network measurement.


 All users of Squid are urged to upgrade to this release as soon as
possible.



 See the ChangeLog for the full list of changes in this and earlier
 releases.

Please refer to the release notes at
http://www.squid-cache.org/Versions/v3/3.4/RELEASENOTES.html
when you are ready to make the switch to Squid-3.4

Upgrade tip:
  "squid -k parse" is starting to display even more
   useful hints about squid.conf changes.

This new release can be downloaded from our HTTP or FTP servers

 http://www.squid-cache.org/Versions/v3/3.4/
 ftp://ftp.squid-cache.org/pub/squid/
 ftp://ftp.squid-cache.org/pub/archive/3.4/

or the mirrors. For a list of mirror sites see

 http://www.squid-cache.org/Download/http-mirrors.html
 http://www.squid-cache.org/Download/mirrors.html

If you encounter any issues with this release please file a bug report.
http://bugs.squid-cache.org/


Amos Jeffries

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJULRYCAAoJELJo5wb/XPRjvlAH/RX9L3EZn4PKJlUnkrx5XZ4e
cnjnS//yU7CD0w1epYxlHsrxoEBuQ4QrBO00+85inGLM1ucA9znjz408Y/e64fAU
kyYGHrDyW+iHouY97+CJSoP1rXtBBlaGgcUDm1WS6UXkKBFQWtguhST2hPa68QVr
297uxVyE5y4mObD4Ch9AY20geBbTBd6Eorq+NYd5XePlfZzRtoaE3aE30h144hQd
JIgTifDnyH1Kwrez4k+hX/qdYtEW/r6P7YXLJk7QPMEv0Jg9eMHiS64+eYvAh6Yb
DueYIu1rps3tMhndOB87v40D0KPXoDWTPOLMkrIIUSOtbTT8FNUjyk1+KpxPwIc=
=Qop2
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Thu Oct  2 09:08:59 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 02 Oct 2014 22:08:59 +1300
Subject: [squid-users] [ADVISORY] SQUID-2014:3 Buffer overflow in SNMP
	processing
Message-ID: <542D162B.2040509@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

__________________________________________________________________

    Squid Proxy Cache Security Update Advisory SQUID-2014:3
__________________________________________________________________

Advisory ID:            SQUID-2014:3
Date:                   September 15, 2014
Summary:                Buffer overflow in SNMP processing
Affected versions:      Squid 3.x -> 3.4.7
Fixed in version:       Squid 3.4.8
__________________________________________________________________

    http://www.squid-cache.org/Advisories/SQUID-2014_3.txt
    http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-6270
__________________________________________________________________

Problem Description:

 Due to incorrect buffer management Squid can be caused by an
 attacker to write outside its allocated SNMP buffer.

__________________________________________________________________

Severity:

 The bug is important because it allows remote attackers to crash
 Squid, causing a disruption in service.  However, the bug is
 exploitable only if you have configured Squid to receive SNMP
 messages.

 Sites that do not use SNMP are not vulnerable.

__________________________________________________________________

Updated Packages:

 This bug is fixed by Squid version 3.4.8

 In addition, patches addressing this problem for stable releases
 can be found in our patch archives:

Squid 3.0:
http://www.squid-cache.org/Versions/v3/3.0/changesets/squid-3.0-9202.patch

Squid 3.1:
http://www.squid-cache.org/Versions/v3/3.1/changesets/squid-3.1-10489.patch

Squid 3.2:
http://www.squid-cache.org/Versions/v3/3.2/changesets/squid-3.2-11829.patch

Squid 3.3:
http://www.squid-cache.org/Versions/v3/3.3/changesets/squid-3.3-12682.patch

Squid 3.4:
http://www.squid-cache.org/Versions/v3/3.4/changesets/squid-3.4-13172.patch


 If you are using a prepackaged version of Squid then please refer
 to the package vendor for availability information on updated
 packages.

__________________________________________________________________

Determining if your version is vulnerable:

 All Squid built with --disable-snmp are not vulnerable to the
 problem.

 All Squid operating with "snmp_port 0" in squid.conf are not
 vulnerable to the problem.

 All Squid-3.x operating with snmp_port omitted from squid.conf
 are not vulnerable to the problem.

 All Squid-2.x operating with snmp_port omitted from squid.conf
 are vulnerable to the problem.

 All unpatched Squid versions up to and including 3.4.7 with
 snmp_port configured to a non-0 value are vulnerable to the
 problem.

__________________________________________________________________

Workaround:

Either,

 Configure the firewall controlling access to Squid service such
 that only specific trusted sources can deliver SNMP packets to
 the Squid SNMP listening port.

Or,

 Disable SNMP. Which may be done in any of the following ways:

 * Build Squid with ./configure --disable-snmp

 * For Squid-2.x add the following directive to squid.conf file:
    snmp_port 0

 * For Squid-3.x remove from squid.conf (and include'd files) any of
   the following directives which are present:

     snmp_port
     snmp_access
     snmp_incoming_address
     snmp_outgoing_address

__________________________________________________________________

Contact details for the Squid project:

 For installation / upgrade support on binary packaged versions
 of Squid: Your first point of contact should be your binary
 package vendor.

 If you install and build Squid from the original Squid sources
 then the squid-users at squid-cache.org mailing list is your primary
 support point. For subscription details see
 http://www.squid-cache.org/Support/mailing-lists.html.

 For reporting of non-security bugs in the latest release
 the squid bugzilla database should be used
 http://bugs.squid-cache.org/.

 For reporting of security sensitive bugs send an email to the
 squid-bugs at squid-cache.org mailing list. It's a closed list
 (though anyone can post) and security related bug reports are
 treated in confidence until the impact has been established.

__________________________________________________________________

Credits:

 The vulnerability was discovered and fixed by Sebastian Krahmer
 of the OpenSUSE Project.

__________________________________________________________________

Revision history:

 2014-09-09 12:01 GMT Initial Report
 2014-09-10 06:12 GMT CVE Assignment
 2014-09-15 08:15 GMT Patches and Packages Released
__________________________________________________________________
END

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJULRYrAAoJELJo5wb/XPRj9YcH/jmHJnJlG6AIegTlLwVD2Btm
B1fVieeBcAZhRfrh3wOOQ8KyXgQcYwRcz4UyIfbp8W/2QNqXWmG0Zvdpp1lh+Z/R
09eoBuJ2asEsWvufvaeYGr8QHr8ZcgpVpjGCRWmTmeUH052x3HmRNmyZraZYyl4f
bzh2ksrZHtiCz8cT8uV599G6co7wu6Y1GEF3yCiLWQ667dh/47vGWfBP50yrjtPq
9lls0r8Ku2Z1Ea4JESC1VIKN6mgfGtrKc4+UuDYfySRi9M0VhpRbpKNq1ig3BxjQ
LKZgsNA8jr1ZglYhT30z442dOiwU3CU4ymL1B8IiMyWcVUmJBEXhDqHyHZEs7r8=
=yYll
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Thu Oct  2 09:09:26 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 02 Oct 2014 22:09:26 +1300
Subject: [squid-users] [ADVISORY] SQUID-2014:4 Multiple issues in pinger
	ICMP processing.
Message-ID: <542D1646.1000807@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

__________________________________________________________________

      Squid Proxy Cache Security Update Advisory SQUID-2014:4
__________________________________________________________________

Advisory ID:            SQUID-2014:4
Date:                   September 15, 2014
Summary:                Multiple issues in pinger ICMP processing.
Affected versions:      Squid 3.x -> 3.4.7
Fixed in version:       Squid 3.4.8
__________________________________________________________________

    http://www.squid-cache.org/Advisories/SQUID-2014_4.txt
    http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-7141
    http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-7142
__________________________________________________________________

Problem Description:

 Due to incorrect bounds checking Squid pinger binary is
 vulnerable to denial of service or information leak attack when
 processing larger than normal ICMP or ICMPv6 packets.

 Due to incorrect input validation Squid pinger binary is
 vulnerable to denial of service or information leak attacks when
 processing ICMP or ICMPv6 packets.

__________________________________________________________________

Severity:

 Several bugs allow any remote server to perform a denial of
 service attack on the Squid service by crashing the pinger.

 Some of these bugs allow attackers to leak arbitrary amounts of
 information from the heap into Squid log files. This is of higher
 importance than usual because the pinger process operates with
 root priviliges.

__________________________________________________________________

Updated Packages:

 This bug is fixed by Squid version 3.4.8

 In addition, patches addressing this problem for stable releases
 can be found in our patch archives:

Squid 3.1:
http://www.squid-cache.org/Versions/v3/3.1/changesets/squid-3.1-10490.patch

Squid 3.2:
http://www.squid-cache.org/Versions/v3/3.2/changesets/squid-3.2-11830.patch

Squid 3.3:
http://www.squid-cache.org/Versions/v3/3.3/changesets/squid-3.3-12683.patch

Squid 3.4:
http://www.squid-cache.org/Versions/v3/3.4/changesets/squid-3.4-13173.patch


 If you are using a prepackaged version of Squid then please refer
 to the package vendor for availability information on updated
 packages.

__________________________________________________________________

Determining if your version is vulnerable:

 All Squid built with --disable-icmp are not vulnerable to these
 problems.

 Check the server running processes list to determine if the Squid
 service is running a "pinger" child process.

 All unpatched Squid-2.x and Squid-3.x versions up to and
 including 3.4.7 running the pinger process are vulnerable to
 these problems.

__________________________________________________________________

Workaround:

 Configuring the firewall controlling access to Squid service such
 that only ICMP ECHO packets are allowed delivery to the Squid
 pinger process will limit the denial of service vulnerability.

__________________________________________________________________

Contact details for the Squid project:

 For installation / upgrade support on binary packaged versions
 of Squid: Your first point of contact should be your binary
 package vendor.

 If you install and build Squid from the original Squid sources
 then the squid-users at squid-cache.org mailing list is your primary
 support point. For subscription details see
 http://www.squid-cache.org/Support/mailing-lists.html.

 For reporting of non-security bugs in the latest release
 the squid bugzilla database should be used
 http://bugs.squid-cache.org/.

 For reporting of security sensitive bugs send an email to the
 squid-bugs at squid-cache.org mailing list. It's a closed list
 (though anyone can post) and security related bug reports are
 treated in confidence until the impact has been established.

__________________________________________________________________

Credits:

 Several of the vulnerabilities were discovered and fixed by
 Sebastian Krahmer of the OpenSUSE Project.

 Some of the vulnerabilities were discovered and fixed by Amos
 Jeffries of Treehouse Networks Ltd.

__________________________________________________________________

Revision history:

 2014-09-09 08:39 GMT Initial Report
 2014-09-15 08:15 GMT Patches and Packages Released
 2014-09-22 06:08 GMT CVE assignment
__________________________________________________________________
END

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJULRZGAAoJELJo5wb/XPRjTsUIAN5kJRs7H0DDJKCuSdTgHOZJ
NhYoFKMyP9vHcYBSMKG9AHD++xdp5vuJNMSlDgfSptrdb2nT7dMlke8x3pXFvCxQ
6FeaJHZ3/zbc4Pg9wxmPHIRXzGCs1ic7/qNRLkaZsyGPkQRgSMABYhxsxAIGzolF
SbXJWsx+7zck2BwB84yPDGg1VPflTAE3sSz1XoG7mjATgydqrH9jTUZsOfUV4O4+
A2ByEbmGgaxd8mWtxnTU8Rk17CWHKQRsC0p30gZkOFP39QtYfx4LANS0vnkhsE+S
gfKWyA92mPG2Nocl9PnTsUQJqr8oOpGB/loioGzjRgvxe3ezaycKgr3fHuMy6kg=
=i0Am
-----END PGP SIGNATURE-----


From gecom at tubosider.it  Thu Oct  2 15:34:05 2014
From: gecom at tubosider.it (masterx81)
Date: Thu, 2 Oct 2014 08:34:05 -0700 (PDT)
Subject: [squid-users] squid 3.4. uses 100% cpu with ntlm_auth
In-Reply-To: <1FCF9DA5B29068478ECF15896F19F084FFDC4CEA@Y011007.bk.fin.local>
References: <1FCF9DA5B29068478ECF15896F19F084FFDC4CEA@Y011007.bk.fin.local>
Message-ID: <1412264045523-4667634.post@n4.nabble.com>

Same problem here... 3.4.7 with NTLM and i have huge cpu utilization....



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/squid-3-4-uses-100-cpu-with-ntlm-auth-tp4664169p4667634.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From Jason_Haar at trimble.com  Thu Oct  2 23:09:24 2014
From: Jason_Haar at trimble.com (Jason Haar)
Date: Fri, 3 Oct 2014 12:09:24 +1300
Subject: [squid-users] getting sslbump cert errors on major sites
Message-ID: <542DDB24.9010701@trimble.com>

Hi there

I'm using sslbump and I just got blocked logging into hotmail for the
first time (yeah, slumming it ;-)

The cert is for bay181.mail.live.com, and squid is generating a "CN=Not
trusted by xxxxx" type cert, as I assume it wasn't signed by a CA that
squid knew about?

I whitelisted live.com (ie don't bump it any more) and the problem goes
away for Firefox

I'm running Ubuntu 14.04, so does this mean that the db of CA's Ubuntu
trusts does not include the same CA-chain that browsers do?

ie, I have

http_port 3128 ssl-bump cert=/usr/local/squid/etc/squidCA.cert 
capath=/etc/ssl/certs/

so this means the CA's Ubuntu lists in /etc/ssl/certs/  is "out of date"
compared with Firefox?

Really a rhetorical question, just kinda wanting to know about where
sslbump will run into trouble, etc :-)

-- 
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1



From thom.j.harris at gmail.com  Fri Oct  3 03:14:36 2014
From: thom.j.harris at gmail.com (Tom Harris)
Date: Thu, 2 Oct 2014 20:14:36 -0700
Subject: [squid-users] getting sslbump cert errors on major sites
In-Reply-To: <542DDB24.9010701@trimble.com>
References: <542DDB24.9010701@trimble.com>
Message-ID: <CAAme0ObHyT3o8+RvKavWG61Y-Z0YV+HSaF0-uki-uroTH_7dvg@mail.gmail.com>

I set up an ssl-bump squid recently and noticed some bump issues too.

Most sites work fine (e.g. google and twitter using https).  But, I get
errors with Facebook.com.  But, it only happens in Mac OS X Chrome, Windows
Chrome works fine.

Chrome refuses to load the site, and in certificate details it says "This
certificate cannot be used (unrecognized critical extension)"

In the detail view, the critical extensions are:

Key Usage.   Data = A8
Basic Constraints.  Certificate Authority = No

In the Windows certificate details, the same extensions are present, but
don't cause any issue.
Has anyone else seen this?


On Thu, Oct 2, 2014 at 4:09 PM, Jason Haar <Jason_Haar at trimble.com> wrote:

> Hi there
>
> I'm using sslbump and I just got blocked logging into hotmail for the
> first time (yeah, slumming it ;-)
>
> The cert is for bay181.mail.live.com, and squid is generating a "CN=Not
> trusted by xxxxx" type cert, as I assume it wasn't signed by a CA that
> squid knew about?
>
> I whitelisted live.com (ie don't bump it any more) and the problem goes
> away for Firefox
>
> I'm running Ubuntu 14.04, so does this mean that the db of CA's Ubuntu
> trusts does not include the same CA-chain that browsers do?
>
> ie, I have
>
> http_port 3128 ssl-bump cert=/usr/local/squid/etc/squidCA.cert
> capath=/etc/ssl/certs/
>
> so this means the CA's Ubuntu lists in /etc/ssl/certs/  is "out of date"
> compared with Firefox?
>
> Really a rhetorical question, just kinda wanting to know about where
> sslbump will run into trouble, etc :-)
>
> --
> Cheers
>
> Jason Haar
> Corporate Information Security Manager, Trimble Navigation Ltd.
> Phone: +1 408 481 8171
> PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141002/8d585fcb/attachment.htm>

From sudakov at sibptus.tomsk.ru  Fri Oct  3 09:00:24 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Fri, 3 Oct 2014 16:00:24 +0700
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <542BB76C.1010809@treenet.co.nz>
References: <5427E97A.1020309@ngtech.co.il>
 <20140928124159.GA38727@admin.sibptus.tomsk.ru>
 <5428AA6B.1010201@treenet.co.nz>
 <20140929071652.GA60398@admin.sibptus.tomsk.ru>
 <54291BB8.5020904@treenet.co.nz>
 <20140930022859.GA83414@admin.sibptus.tomsk.ru>
 <20140930053326.GA90693@admin.sibptus.tomsk.ru>
 <542AC521.2040006@treenet.co.nz>
 <20141001074518.GA29967@admin.sibptus.tomsk.ru>
 <542BB76C.1010809@treenet.co.nz>
Message-ID: <20141003090023.GA87923@admin.sibptus.tomsk.ru>

Amos Jeffries wrote:

[dd]

> > Bingo! After setting "ident_access deny all" squid does not grow 
> > infinitely any more. However, it remains a major CPU hog.
> > 
> 
> Yay. Any news on the bug patch?

Will try during the weekend. I can live without IDENT lookups for a
while, they are not very important, just convenient.

> 
> Note that from the same "CPU hog" cycles you are now getting around 2x
> the HTTP traffic throughput.

I have found out that the major CPU hog is the NTLM authenticator.
After I disabled the NTLM helper, there is no high CPU utilization.
Which brings the next question, please see below :)

> 
> You have the delay pools feature configured. It is a wasteful consumer
> of CPU cycles. 
>  2) moving the delay pools limitation into kernel QoS systems.

1. I am planning to use the delay pool to restrict bandwidth differently
to different users. The kernerl QoS system (ipfw pipes in my case)
cannot do that for non-local users.

2. Delay pools worked fine in squid27, never a problem. I don't see a
reason why they should become a problem in squid3.

> Also NTLM authentication is used, that doubles the HTTP
> request overheads on each new TCP connection.
>  1) converting from NTLM to Kerberos authentication.

I have tried to setup Kerberos (negotiate) authentication, but all I
see is Internet Explorer asking users for their login/password.

I am pretty sure that I have setup the server part correctly. At least
when I do the following:

kinit -t /usr/local/etc/squid/squid.keytab HTTP/proxy.sibptus.transneft.ru

I obtain the TGT issued to HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU

My squid.keytab contains:

Vno  Type              Principal
  0  arcfour-hmac-md5 HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU


To me, this means the Kerberos server part is correct. I don't know for
the present how to debug it further. Any Kerberos gurus?

Below is a bit of debug from negotiate_kerberos_auth

negotiate_kerberos_auth.cc(212): pid=96295 :2014/10/03 15:45:53 kid1|   Took 0.41 seconds (80933.38 objects/sec).
2014/10/03 15:45:53| negotiate_kerberos_auth: INFO: Starting version 3.0.4sq
2014/10/03 15:45:53 kid1| Beginning Validation Procedure
2014/10/03 15:45:53 kid1|   Completed Validation Procedure
2014/10/03 15:45:53 kid1|   Validated 33380 Entries
2014/10/03 15:45:53 kid1|   store_swap_size = 878994.00 KB
negotiate_kerberos_auth.cc(258): pid=96289 :2014/10/03 15:45:53| negotiate_kerberos_auth: DEBUG: Got 'YR TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' from squid (length: 59).
negotiate_kerberos_auth.cc(311): pid=96289 :2014/10/03 15:45:53| negotiate_kerberos_auth: DEBUG: Decode 'TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' (decoded length: 40).
negotiate_kerberos_auth.cc(321): pid=96289 :2014/10/03 15:45:53| negotiate_kerberos_auth: WARNING: received type 1 NTLM token
negotiate_kerberos_auth.cc(258): pid=96290 :2014/10/03 15:45:53| negotiate_kerberos_auth: DEBUG: Got 'YR TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' from squid (length: 59).
negotiate_kerberos_auth.cc(311): pid=96290 :2014/10/03 15:45:53| negotiate_kerberos_auth: DEBUG: Decode 'TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' (decoded length: 40).
negotiate_kerberos_auth.cc(321): pid=96290 :2014/10/03 15:45:53| negotiate_kerberos_auth: WARNING: received type 1 NTLM token
negotiate_kerberos_auth.cc(258): pid=96292 :2014/10/03 15:45:53| negotiate_kerberos_auth: DEBUG: Got 'YR TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' from squid (length: 59).
negotiate_kerberos_auth.cc(311): pid=96292 :2014/10/03 15:45:53| negotiate_kerberos_auth: DEBUG: Decode 'TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' (decoded length: 40).
negotiate_kerberos_auth.cc(321): pid=96292 :2014/10/03 15:45:53| negotiate_kerberos_auth: WARNING: received type 1 NTLM token
negotiate_kerberos_auth.cc(258): pid=96287 :2014/10/03 15:45:53| negotiate_kerberos_auth: DEBUG: Got 'YR TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' from squid (length: 59).
negotiate_kerberos_auth.cc(311): pid=96287 :2014/10/03 15:45:53| negotiate_kerberos_auth: DEBUG: Decode 'TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' (decoded length: 40).
negotiate_kerberos_auth.cc(321): pid=96287 :2014/10/03 15:45:53| negotiate_kerberos_auth: WARNING: received type 1 NTLM token
negotiate_kerberos_auth.cc(258): pid=96293 :2014/10/03 15:45:53| negotiate_kerberos_auth: DEBUG: Got 'YR TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' from squid (length: 59).
negotiate_kerberos_auth.cc(311): pid=96293 :2014/10/03 15:45:53| negotiate_kerberos_auth: DEBUG: Decode 'TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' (decoded length: 40).
negotiate_kerberos_auth.cc(321): pid=96293 :2014/10/03 15:45:53| negotiate_kerberos_auth: WARNING: received type 1 NTLM token
negotiate_kerberos_auth.cc(258): pid=96294 :2014/10/03 15:45:53| negotiate_kerberos_auth: DEBUG: Got 'YR TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' from squid (length: 59).
negotiate_kerberos_auth.cc(311): pid=96294 :2014/10/03 15:45:53| negotiate_kerberos_auth: DEBUG: Decode 'TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' (decoded length: 40).
negotiate_kerberos_auth.cc(321): pid=96294 :2014/10/03 15:45:53| negotiate_kerberos_auth: WARNING: received type 1 NTLM token
negotiate_kerberos_auth.cc(258): pid=96295 :2014/10/03 15:45:53| negotiate_kerberos_auth: DEBUG: Got 'YR TlRMTVNTUAABAAAAB4IIogAAAAAAAAAAAAAAAAAAAAAFASgKAAAADw==' from squid (length: 59).
negotiate_kerberos_auth.cc(311): pid=96295 :2014/10/03 15:45:53| negotiate_kerberos_auth: DEBUG: Decode 'TlRMTVNTUAABAAAAB4IIogAAAAAAAAAAAAAAAAAAAAAFASgKAAAADw==' (decoded length: 40).
negotiate_kerberos_auth.cc(321): pid=96295 :2014/10/03 15:45:53| negotiate_kerberos_auth: WARNING: received type 1 NTLM token
negotiate_kerberos_auth.cc(258): pid=96291 :2014/10/03 15:45:53| negotiate_kerberos_auth: DEBUG: Got 'YR TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' from squid (length: 59).
negotiate_kerberos_auth.cc(311): pid=96291 :2014/10/03 15:45:53| negotiate_kerberos_auth: DEBUG: Decode 'TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' (decoded length: 40).
negotiate_kerberos_auth.cc(321): pid=96291 :2014/10/03 15:45:53| negotiate_kerberos_auth: WARNING: received type 1 NTLM token
2014/10/03 15:45:53 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: received type 1 NTLM token; }}
2014/10/03 15:45:53 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: received type 1 NTLM token; }}
2014/10/03 15:45:53 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: received type 1 NTLM token; }}
2014/10/03 15:45:53 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: received type 1 NTLM token; }}
2014/10/03 15:45:53 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: received type 1 NTLM token; }}
2014/10/03 15:45:53 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: received type 1 NTLM token; }}
2014/10/03 15:45:53 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: received type 1 NTLM token; }}
2014/10/03 15:45:53 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: received type 1 NTLM token; }}
negotiate_kerberos_auth.cc(258): pid=96287 :2014/10/03 15:45:53| negotiate_kerberos_auth: DEBUG: Got 'YR TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' from squid (length: 59).
negotiate_kerberos_auth.cc(311): pid=96287 :2014/10/03 15:45:53| negotiate_kerberos_auth: DEBUG: Decode 'TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' (decoded length: 40).
negotiate_kerberos_auth.cc(321): pid=96287 :2014/10/03 15:45:53| negotiate_kerberos_auth: WARNING: received type 1 NTLM token
2014/10/03 15:45:53 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: received type 1 NTLM token; }}
negotiate_kerberos_auth.cc(258): pid=96287 :2014/10/03 15:45:53| negotiate_kerberos_auth: DEBUG: Got 'YR TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' from squid (length: 59).
negotiate_kerberos_auth.cc(311): pid=96287 :2014/10/03 15:45:53| negotiate_kerberos_auth: DEBUG: Decode 'TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' (decoded length: 40).
negotiate_kerberos_auth.cc(321): pid=96287 :2014/10/03 15:45:53| negotiate_kerberos_auth: WARNING: received type 1 NTLM token
2014/10/03 15:45:53 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: received type 1 NTLM token; }}
negotiate_kerberos_auth.cc(258): pid=96287 :2014/10/03 15:45:53| negotiate_kerberos_auth: DEBUG: Got 'YR TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' from squid (length: 59).
negotiate_kerberos_auth.cc(311): pid=96287 :2014/10/03 15:45:53| negotiate_kerberos_auth: DEBUG: Decode 'TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' (decoded length: 40).
negotiate_kerberos_auth.cc(321): pid=96287 :2014/10/03 15:45:53| negotiate_kerberos_auth: WARNING: received type 1 NTLM token
2014/10/03 15:45:53 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: received type 1 NTLM token; }}
negotiate_kerberos_auth.cc(258): pid=96287 :2014/10/03 15:45:53| negotiate_kerberos_auth: DEBUG: Got 'YR TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' from squid (length: 59).
negotiate_kerberos_auth.cc(311): pid=96287 :2014/10/03 15:45:53| negotiate_kerberos_auth: DEBUG: Decode 'TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' (decoded length: 40).
negotiate_kerberos_auth.cc(321): pid=96287 :2014/10/03 15:45:53| negotiate_kerberos_auth: WARNING: received type 1 NTLM token
2014/10/03 15:45:53 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: received type 1 NTLM token; }}
negotiate_kerberos_auth.cc(258): pid=96287 :2014/10/03 15:45:53| negotiate_kerberos_auth: DEBUG: Got 'YR TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' from squid (length: 59).
negotiate_kerberos_auth.cc(311): pid=96287 :2014/10/03 15:45:53| negotiate_kerberos_auth: DEBUG: Decode 'TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' (decoded length: 40).
negotiate_kerberos_auth.cc(321): pid=96287 :2014/10/03 15:45:53| negotiate_kerberos_auth: WARNING: received type 1 NTLM token
2014/10/03 15:45:53 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: received type 1 NTLM token; }}
negotiate_kerberos_auth.cc(258): pid=96287 :2014/10/03 15:45:53| negotiate_kerberos_auth: DEBUG: Got 'YR TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' from squid (length: 59).

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru


From sudakov at sibptus.tomsk.ru  Fri Oct  3 11:51:10 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Fri, 3 Oct 2014 18:51:10 +0700
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <542BB76C.1010809@treenet.co.nz>
References: <5427E97A.1020309@ngtech.co.il>
 <20140928124159.GA38727@admin.sibptus.tomsk.ru>
 <5428AA6B.1010201@treenet.co.nz>
 <20140929071652.GA60398@admin.sibptus.tomsk.ru>
 <54291BB8.5020904@treenet.co.nz>
 <20140930022859.GA83414@admin.sibptus.tomsk.ru>
 <20140930053326.GA90693@admin.sibptus.tomsk.ru>
 <542AC521.2040006@treenet.co.nz>
 <20141001074518.GA29967@admin.sibptus.tomsk.ru>
 <542BB76C.1010809@treenet.co.nz>
Message-ID: <20141003115110.GA94743@admin.sibptus.tomsk.ru>

Amos Jeffries wrote:
> There are two things you can do to further improve performance:
>  1) converting from NTLM to Kerberos authentication.

Does Kerberos proxy authentication work with Firefox (Windows) at all?

Success stories and recipes, anyone?

NTLM did work both with Firefox and MSIE and even Chrome.

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru


From stephen.baynes at smoothwall.net  Fri Oct  3 12:47:26 2014
From: stephen.baynes at smoothwall.net (Stephen Baynes)
Date: Fri, 3 Oct 2014 13:47:26 +0100
Subject: [squid-users] How to tell when Squid has finished setting up disk
	cache directories?
Message-ID: <CABrJVoz+c8eACFb5H9k6umPCKo=AOQsQwSFL6iJ9_mDdELLo_A@mail.gmail.com>

At times we automatically start Squid from a clean setup. We run squid
-z to create the cache directories and then start Squid for normal
operation. The question is how to know when squid -z has finished and
it is safe to start Squid for normal operation.

This is not a problem when one has one squid worker, one uses the -N
(don't background) option as well and just waits for the process to
finish.

However we want to use Squid with multiple workers and the problem is
the -N option overrides the number of workers and it sets up only one
cache directory. (Squid has one cache directory per worker.) If one
does not wait then when Squid starts for normal operation the cache
directories are not ready and it fails.

One can't even use the PID file to find out a process to wait for, as
it seems that it does not even write a PID file when the -z option is
used.

Any ideas on how to find out when it is finished creating the cache directories?

Thanks

Stephen Baynes


From rafael.akchurin at diladele.com  Fri Oct  3 13:47:14 2014
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Fri, 3 Oct 2014 13:47:14 +0000
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <20141003115110.GA94743@admin.sibptus.tomsk.ru>
References: <5427E97A.1020309@ngtech.co.il>
 <20140928124159.GA38727@admin.sibptus.tomsk.ru>
 <5428AA6B.1010201@treenet.co.nz>
 <20140929071652.GA60398@admin.sibptus.tomsk.ru>
 <54291BB8.5020904@treenet.co.nz>
 <20140930022859.GA83414@admin.sibptus.tomsk.ru>
 <20140930053326.GA90693@admin.sibptus.tomsk.ru>
 <542AC521.2040006@treenet.co.nz>
 <20141001074518.GA29967@admin.sibptus.tomsk.ru>
 <542BB76C.1010809@treenet.co.nz>,
 <20141003115110.GA94743@admin.sibptus.tomsk.ru>
Message-ID: <1412344037293.806@diladele.com>

Hello Victor,

If you see 'received type 1 NTLM token' message it means your IE was not able to use the Kerberos auth and have chosen NTLM instead. Please ensure you are browsing from *domain joined* machine and using NTLM/Kerberos authentication wrapper as described in http://wiki.squid-cache.org/ConfigExamples/Authenticate/WindowsActiveDirectory#Install_negotiate_wrapper.

If you do not want to use NTLM then probably our humble guide will be of any use - http://docs.diladele.com/administrator_guide_3_4/installation_and_removal/active_directory/index.html

Best regards,
Rafael
________________________________________
From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Victor Sudakov <sudakov at sibptus.tomsk.ru>
Sent: Friday, October 3, 2014 1:51 PM
To: Amos Jeffries
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.

Amos Jeffries wrote:
> There are two things you can do to further improve performance:
>  1) converting from NTLM to Kerberos authentication.

Does Kerberos proxy authentication work with Firefox (Windows) at all?

Success stories and recipes, anyone?

NTLM did work both with Firefox and MSIE and even Chrome.

--
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users


From sudakov at sibptus.tomsk.ru  Fri Oct  3 14:46:16 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Fri, 3 Oct 2014 21:46:16 +0700
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <1412344037293.806@diladele.com>
References: <5428AA6B.1010201@treenet.co.nz>
 <20140929071652.GA60398@admin.sibptus.tomsk.ru>
 <54291BB8.5020904@treenet.co.nz>
 <20140930022859.GA83414@admin.sibptus.tomsk.ru>
 <20140930053326.GA90693@admin.sibptus.tomsk.ru>
 <542AC521.2040006@treenet.co.nz>
 <20141001074518.GA29967@admin.sibptus.tomsk.ru>
 <542BB76C.1010809@treenet.co.nz>
 <20141003115110.GA94743@admin.sibptus.tomsk.ru>
 <1412344037293.806@diladele.com>
Message-ID: <20141003144616.GA96091@admin.sibptus.tomsk.ru>

Rafael Akchurin wrote:
> > Does Kerberos proxy authentication work with Firefox (Windows) at all?
> > Success stories and recipes, anyone?
> 
> If you see 'received type 1 NTLM token' message it means your IE was
> not able to use the Kerberos auth and have chosen NTLM instead.

Any ideas how I can figure out the cause thereof?

I understand that the browser should be requesting a ticket for the 
HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU service from the
domain controller.

How can I find out why it is not requesting it or not receiving it?

> Please ensure you are browsing from *domain joined* machine 

I certainly am.

> and
> using NTLM/Kerberos authentication wrapper as described in
> http://wiki.squid-cache.org/ConfigExamples/Authenticate/WindowsActiveDirectory#Install_negotiate_wrapper.

My objective is to enable Kerberos proxy authentication from domain joined
Windows machines in MSIE, Firefox and possible Chrome.

Why and when do I need this wrapper? Is squid's own
negotiate_kerberos_auth plugin not good enough for my purpose?

> 
> If you do not want to use NTLM 

I most certainly don't want to use NTLM. I want to use Kerberos with
MSIE and Firefox. It is possible at all, especially with the latter?

> then probably our humble guide will
> be of any use -
> http://docs.diladele.com/administrator_guide_3_4/installation_and_removal/active_directory/index.html

I have basically done all that already, except the Basic auth and LDAP
groups stuff. I don't want those for the present.

Tell me please, after implementing your guide, do you enjoy Kerberos
proxy authentication in Firefox, or does it fall back to Basic auth?

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru


From rafael.akchurin at diladele.com  Fri Oct  3 14:50:28 2014
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Fri, 3 Oct 2014 14:50:28 +0000
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <20141003144616.GA96091@admin.sibptus.tomsk.ru>
References: <5428AA6B.1010201@treenet.co.nz>
 <20140929071652.GA60398@admin.sibptus.tomsk.ru>
 <54291BB8.5020904@treenet.co.nz>
 <20140930022859.GA83414@admin.sibptus.tomsk.ru>
 <20140930053326.GA90693@admin.sibptus.tomsk.ru>
 <542AC521.2040006@treenet.co.nz>
 <20141001074518.GA29967@admin.sibptus.tomsk.ru>
 <542BB76C.1010809@treenet.co.nz>
 <20141003115110.GA94743@admin.sibptus.tomsk.ru>
 <1412344037293.806@diladele.com>,
 <20141003144616.GA96091@admin.sibptus.tomsk.ru>
Message-ID: <1412347831564.46294@diladele.com>

I believe I do (but you made me doubt:)

Can you please check if your browser is set to use FQDN of proxy not proxy's IP address.
Raf

________________________________________
From: Victor Sudakov <sudakov at sibptus.tomsk.ru>
Sent: Friday, October 3, 2014 4:46 PM
To: Rafael Akchurin
Cc: Amos Jeffries; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.

Rafael Akchurin wrote:
> > Does Kerberos proxy authentication work with Firefox (Windows) at all?
> > Success stories and recipes, anyone?
>
> If you see 'received type 1 NTLM token' message it means your IE was
> not able to use the Kerberos auth and have chosen NTLM instead.

Any ideas how I can figure out the cause thereof?

I understand that the browser should be requesting a ticket for the
HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU service from the
domain controller.

How can I find out why it is not requesting it or not receiving it?

> Please ensure you are browsing from *domain joined* machine

I certainly am.

> and
> using NTLM/Kerberos authentication wrapper as described in
> http://wiki.squid-cache.org/ConfigExamples/Authenticate/WindowsActiveDirectory#Install_negotiate_wrapper.

My objective is to enable Kerberos proxy authentication from domain joined
Windows machines in MSIE, Firefox and possible Chrome.

Why and when do I need this wrapper? Is squid's own
negotiate_kerberos_auth plugin not good enough for my purpose?

>
> If you do not want to use NTLM

I most certainly don't want to use NTLM. I want to use Kerberos with
MSIE and Firefox. It is possible at all, especially with the latter?

> then probably our humble guide will
> be of any use -
> http://docs.diladele.com/administrator_guide_3_4/installation_and_removal/active_directory/index.html

I have basically done all that already, except the Basic auth and LDAP
groups stuff. I don't want those for the present.

Tell me please, after implementing your guide, do you enjoy Kerberos
proxy authentication in Firefox, or does it fall back to Basic auth?

--
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru


From gecom at tubosider.it  Fri Oct  3 15:18:28 2014
From: gecom at tubosider.it (masterx81)
Date: Fri, 3 Oct 2014 08:18:28 -0700 (PDT)
Subject: [squid-users] squid 3.4. uses 100% cpu with ntlm_auth
In-Reply-To: <1412264045523-4667634.post@n4.nabble.com>
References: <1FCF9DA5B29068478ECF15896F19F084FFDC4CEA@Y011007.bk.fin.local>
 <1412264045523-4667634.post@n4.nabble.com>
Message-ID: <1412349508959-4667645.post@n4.nabble.com>

I can confirm that on 3.3.13 all is working correctly, the cpu usage is
really low.



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/squid-3-4-uses-100-cpu-with-ntlm-auth-tp4664169p4667645.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From gecom at tubosider.it  Fri Oct  3 15:34:29 2014
From: gecom at tubosider.it (masterx81)
Date: Fri, 3 Oct 2014 08:34:29 -0700 (PDT)
Subject: [squid-users] Kerberos auth not working
Message-ID: <1412350469245-4667646.post@n4.nabble.com>

Hi to all! I've a 'little' problem....
I've followed the instruction of this guide:
http://wiki.squid-cache.org/ConfigExamples/Authenticate/WindowsActiveDirectory
And i've setup successfully the ntlm and basic authentication. browser and
application works well, most of them use ntlm...
But now i've a throuble with kerberos auth, as one win7 client seem to use
kerberos instead of ntlm. 
I get the following error on cache.log

2014/10/03 17:05:35| negotiate_wrapper: Got '...cut...' from squid (length:
219).
2014/10/03 17:05:35| negotiate_wrapper: Decode '...cut...' (decoded length:
161).
2014/10/03 17:05:35| negotiate_wrapper: received Kerberos token
2014/10/03 17:05:35| squid_kerb_auth: Got '...cut...' from squid (length:
219).
2014/10/03 17:05:35| squid_kerb_auth: Decode '...cut...' (decoded length:
161).
2014/10/03 17:05:35| squid_kerb_auth: gss_accept_sec_context() failed: An
unsupported mechanism was requested.
2014/10/03 17:05:35| negotiate_wrapper: Return 'BH gss_accept_sec_context()
failed: An unsupported mechanism was requested.
'
2014/10/03 17:05:35 kid1| ERROR: Negotiate Authentication validating user.
Error returned 'BH gss_accept_sec_context() failed: An unsupported mechanism
was requested. '

Kerberos seem to work as if i do:
msktutil --auto-update --verbose --computer-name serv07-K

I get:
 -- init_password: Wiping the computer password structure
 -- generate_new_password: Generating a new, random password for the
computer account
 -- generate_new_password:  Characters read from /dev/udandom = 82
 -- get_dc_host: Attempting to find a Domain Controller to use (DNS SRV RR
TCP)
 -- get_dc_host: Found DC: srv-dc1.domain.local
 -- get_dc_host: Canonicalizing DC through forward/reverse lookup...
 -- get_dc_host: Found Domain Controller: srv-dc1.domain.local
 -- get_default_keytab: Obtaining the default keytab name:
/etc/squid/PROXY.keytab
 -- create_fake_krb5_conf: Created a fake krb5.conf file:
/tmp/.msktkrb5.conf-eMR9yQ
 -- reload: Reloading Kerberos Context
 -- finalize_exec: SAM Account Name is: serv07-K$
 -- try_machine_keytab_princ: Trying to authenticate for serv07-K$ from
local keytab...
 -- switch_default_ccache: Using the local credential cache:
FILE:/tmp/.mskt_krb5_ccache-lY6luY
 -- finalize_exec: Authenticated using method 1

 -- ldap_connect: Connecting to LDAP server: srv-dc1.domain.local
try_tls=YES
 -- ldap_connect: Connecting to LDAP server: srv-dc1.domain.local try_tls=NO
SASL/GSSAPI authentication started
SASL username: serv07-K$@DOMAIN.LOCAL
SASL SSF: 56
SASL data security layer installed.
 -- ldap_connect: LDAP_OPT_X_SASL_SSF=56

 -- ldap_get_base_dn: Determining default LDAP base: dc=DOMAIN,dc=LOCAL
 -- get_default_ou: Determining default OU: CN=Computers,DC=domain,DC=local
 -- ldap_get_pwdLastSet: pwdLastSet is ...cut...
 -- execute: Password last set 0 days ago.
 -- execute: Exiting because password was changed recently.
 -- ~msktutil_exec: Destroying msktutil_exec
 -- ldap_cleanup: Disconnecting from LDAP server
 -- init_password: Wiping the computer password structure
 -- ~KRB5Context: Destroying Kerberos Context

and doing klist i get:
10/03/14 16:38:47  10/04/14 02:38:47  krbtgt/DOMAIN.LOCAL at DOMAIN.LOCAL
        renew until 10/10/14 16:38:47

and a klist -k of the keytab file:
  13 serv07-K$@DOMAIN.LOCAL
  13 serv07-K$@DOMAIN.LOCAL
  13 serv07-K$@DOMAIN.LOCAL
  13 host/serv07 at DOMAIN.LOCAL
  13 host/serv07 at DOMAIN.LOCAL
  13 host/serv07 at DOMAIN.LOCAL
  13 HTTP/serv07.domain.local at DOMAIN.LOCAL
  13 HTTP/serv07.domain.local at DOMAIN.LOCAL
  13 HTTP/serv07.domain.local at DOMAIN.LOCAL



So all seem to work correclty.
The kerberos part of the squid.conf is:
auth_param negotiate program /usr/local/bin/negotiate_wrapper -d --ntlm
/usr/bin/ntlm_auth --diagnostics --helper-protocol=squid-2.5-ntlmssp
--domain=TUBOSIDER --kerberos /usr/local/bin/squid_kerb_auth -d -s
GSS_C_NO_NAME
auth_param negotiate children 10 startup=0 idle=1
auth_param negotiate keep_alive on


Please help as i've already searched everywhere a solution that i can't find
and i'm not so expert on squid!
Thanks!!!



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Kerberos-auth-not-working-tp4667646.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From sudakov at sibptus.tomsk.ru  Fri Oct  3 17:02:12 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Sat, 4 Oct 2014 00:02:12 +0700
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <1412347831564.46294@diladele.com>
References: <54291BB8.5020904@treenet.co.nz>
 <20140930022859.GA83414@admin.sibptus.tomsk.ru>
 <20140930053326.GA90693@admin.sibptus.tomsk.ru>
 <542AC521.2040006@treenet.co.nz>
 <20141001074518.GA29967@admin.sibptus.tomsk.ru>
 <542BB76C.1010809@treenet.co.nz>
 <20141003115110.GA94743@admin.sibptus.tomsk.ru>
 <1412344037293.806@diladele.com>
 <20141003144616.GA96091@admin.sibptus.tomsk.ru>
 <1412347831564.46294@diladele.com>
Message-ID: <20141003170212.GA97064@admin.sibptus.tomsk.ru>

Rafael Akchurin wrote:
> > Tell me please, after implementing your guide, do you enjoy Kerberos
> > proxy authentication in Firefox, or does it fall back to Basic auth?

> I believe I do (but you made me doubt:)

Can you please doublecheck which method your Firefox is using?

All the howtos I have seen so far suggest a fallback method of basic
authentication. I suppose that is what is actually being used in many
cases.

> 
> Can you please check if your browser is set to use FQDN of proxy not
> proxy's IP address.

I am absolutely sure of that.

I am not new to Kerberos in general. I have experience in setting up a
Heimdal realm and trust relations between a Heimdal realm and a MS
Windows 2000 domain (yes, we still have a Windows 2000 AD). I have
configured Kerberos authentication in POP3, IMAP, CVS, SVN, SSH (Unix
and Centrify PuTTY). So the chances of me making some trivial mistake
like DNS misconfiguration or an unsynchronized clock are rather small.
Though of course we all make mistakes sometimes.

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru


From gecom at tubosider.it  Fri Oct  3 18:25:33 2014
From: gecom at tubosider.it (masterx81)
Date: Fri, 3 Oct 2014 11:25:33 -0700 (PDT)
Subject: [squid-users] Kerberos auth not working
In-Reply-To: <1412350469245-4667646.post@n4.nabble.com>
References: <1412350469245-4667646.post@n4.nabble.com>
Message-ID: <1412360733691-4667648.post@n4.nabble.com>

All solved!
Seem that kerberos is ALWAYS not working only on a specific worstation.
If i use kerberos from any other pc it works as excepted.
What can cause the error on that specific workstation? I've reinstalled the
os due to this problem, and it's still there (os preinstalled, so i've used
the recovery procedure from hp, maybe the problem is in the recovery os
image)



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Kerberos-auth-not-working-tp4667646p4667648.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From squid3 at treenet.co.nz  Fri Oct  3 19:09:35 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 04 Oct 2014 08:09:35 +1300
Subject: [squid-users] How to tell when Squid has finished setting up
 disk cache directories?
In-Reply-To: <CABrJVoz+c8eACFb5H9k6umPCKo=AOQsQwSFL6iJ9_mDdELLo_A@mail.gmail.com>
References: <CABrJVoz+c8eACFb5H9k6umPCKo=AOQsQwSFL6iJ9_mDdELLo_A@mail.gmail.com>
Message-ID: <542EF46F.3070604@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 4/10/2014 1:47 a.m., Stephen Baynes wrote:
> At times we automatically start Squid from a clean setup. We run
> squid -z to create the cache directories and then start Squid for
> normal operation. The question is how to know when squid -z has
> finished and it is safe to start Squid for normal operation.
> 
> This is not a problem when one has one squid worker, one uses the
> -N (don't background) option as well and just waits for the process
> to finish.
> 
> However we want to use Squid with multiple workers and the problem
> is the -N option overrides the number of workers and it sets up
> only one cache directory. (Squid has one cache directory per
> worker.) If one does not wait then when Squid starts for normal
> operation the cache directories are not ready and it fails.
> 
> One can't even use the PID file to find out a process to wait for,
> as it seems that it does not even write a PID file when the -z
> option is used.
> 
> Any ideas on how to find out when it is finished creating the cache
> directories?


This appears to be one of the little details that have not been
polished yet with SMP.

What I have been doing for this type of check is looking in /dev/shm
(on Linux, may not be there on other OS) to see if the SMP sockets are
still active. Squid removes the SHM device "files" when its done.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJULvRvAAoJELJo5wb/XPRj7/8H/iNVD3ND5TmZIhk2MtzX3Vg/
fhfeYEQnAGBAcKgtVwVNPihI6EsVktZt9OcNWajQkkv8hPLSQ4IQBVSI4NgXzAa9
6tYhEtSydoYjWevjKcwf0Wyea6TXIcULUFEz5dVsu8ISflHisDdqYAgQZM691RCD
p8P+W0wdPeF7KIqX214aADHr1m/t0hfjkEHW5M5KRIN6O1IN4wOg38H5u3qhJM/z
j5qgcoNL+8pKGA4dasurQRe8yVCgeNVQp9ipFZw7U0oQ3+oVXH2n+9MWYP+QaZMi
nLipoGEkj5BNd1bEvklArWUyQBcbUb64bCbTXQl8Dhse8qthWQX7LhHWXNZbOoI=
=eEx1
-----END PGP SIGNATURE-----


From huaraz at moeller.plus.com  Fri Oct  3 19:06:39 2014
From: huaraz at moeller.plus.com (Markus Moeller)
Date: Fri, 3 Oct 2014 20:06:39 +0100
Subject: [squid-users] Kerberos auth not working
In-Reply-To: <1412360733691-4667648.post@n4.nabble.com>
References: <1412350469245-4667646.post@n4.nabble.com>
 <1412360733691-4667648.post@n4.nabble.com>
Message-ID: <m0ms43$8or$1@ger.gmane.org>

Can you capture the traffic on port 88 from the PC to AD after a clean boot 
and when you access squid ?

Markus


"masterx81"  wrote in message 
news:1412360733691-4667648.post at n4.nabble.com...

All solved!
Seem that kerberos is ALWAYS not working only on a specific worstation.
If i use kerberos from any other pc it works as excepted.
What can cause the error on that specific workstation? I've reinstalled the
os due to this problem, and it's still there (os preinstalled, so i've used
the recovery procedure from hp, maybe the problem is in the recovery os
image)



--
View this message in context: 
http://squid-web-proxy-cache.1019090.n4.nabble.com/Kerberos-auth-not-working-tp4667646p4667648.html
Sent from the Squid - Users mailing list archive at Nabble.com.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users 




From squid at visolve.com  Sat Oct  4 11:08:18 2014
From: squid at visolve.com (Visolve Squid)
Date: Sat, 04 Oct 2014 16:38:18 +0530
Subject: [squid-users] redirect all ports to squid
In-Reply-To: <DUB123-DS15337FBB7B90E43B736C7EB3BB0@phx.gbl>
References: <DUB123-DS15337FBB7B90E43B736C7EB3BB0@phx.gbl>
Message-ID: <542FD522.3030003@visolve.com>

Spam detection software, running on the system "master.squid-cache.org",
has identified this incoming email as possible spam.  The original
message has been attached to this so you can view it or label
similar future email.  If you have any questions, see
@@CONTACT_ADDRESS@@ for details.

Content preview:  Hi, Yes, we can redirect the ports to squid through our firewall
   rules. Check below lines to redirect the ports. We have some different methods
   to do. 1. In first Method: First, we need to machine that squid will be running
   on, You do not need iptables or any special kernel options on this machine,
   just squid. You *will*, however, need the 'http_accel' options as described
   above. [...] 

Content analysis details:   (5.9 points, 5.0 required)

 pts rule name              description
---- ---------------------- --------------------------------------------------
 0.0 URIBL_BLOCKED          ADMINISTRATOR NOTICE: The query to URIBL was blocked.
                            See
                            http://wiki.apache.org/spamassassin/DnsBlocklists#dnsbl-block
                             for more information.
                            [URIs: squid-cache.org]
 0.0 HTML_MESSAGE           BODY: HTML included in message
 1.6 RCVD_IN_BRBL_LASTEXT   RBL: No description available.
                            [182.73.50.82 listed in bb.barracudacentral.org]
 0.7 RCVD_IN_XBL            RBL: Received via a relay in Spamhaus XBL
                            [182.73.50.82 listed in zen.spamhaus.org]
 3.6 RCVD_IN_PBL            RBL: Received via a relay in Spamhaus PBL
 0.0 UNPARSEABLE_RELAY      Informational: message has unparseable relay lines

The original message was not completely plain text, and may be unsafe to
open with some email clients; in particular, it may contain a virus,
or confirm that your address can receive spam.  If you wish to view
it, it may be safer to save it to a file and open it with an editor.

-------------- next part --------------
An embedded message was scrubbed...
From: Visolve Squid <squid at visolve.com>
Subject: Re: [squid-users] redirect all ports to squid
Date: Sat, 04 Oct 2014 16:38:18 +0530
Size: 5669
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141004/da08dbf2/attachment.eml>

From squid at visolve.com  Sat Oct  4 11:10:16 2014
From: squid at visolve.com (Squid)
Date: Sat, 04 Oct 2014 16:40:16 +0530
Subject: [squid-users] redirect all ports to squid
In-Reply-To: <DUB123-DS15337FBB7B90E43B736C7EB3BB0@phx.gbl>
References: <DUB123-DS15337FBB7B90E43B736C7EB3BB0@phx.gbl>
Message-ID: <542FD598.7050508@visolve.com>

Spam detection software, running on the system "master.squid-cache.org",
has identified this incoming email as possible spam.  The original
message has been attached to this so you can view it or label
similar future email.  If you have any questions, see
@@CONTACT_ADDRESS@@ for details.

Content preview:  Hi, Yes, we can redirect the ports to squid through our firewall
   rules. Check below lines to redirect the ports. We have some different methods
   to do. 1. In first Method: First, we need to machine that squid will be running
   on, You do not need iptables or any special kernel options on this machine,
   just squid. You will, however, need the 'http_accel' options as described
   above. [...] 

Content analysis details:   (5.9 points, 5.0 required)

 pts rule name              description
---- ---------------------- --------------------------------------------------
 0.0 URIBL_BLOCKED          ADMINISTRATOR NOTICE: The query to URIBL was blocked.
                            See
                            http://wiki.apache.org/spamassassin/DnsBlocklists#dnsbl-block
                             for more information.
                            [URIs: squid-cache.org]
 3.6 RCVD_IN_PBL            RBL: Received via a relay in Spamhaus PBL
                            [182.73.50.82 listed in zen.spamhaus.org]
 0.7 RCVD_IN_XBL            RBL: Received via a relay in Spamhaus XBL
 1.6 RCVD_IN_BRBL_LASTEXT   RBL: No description available.
                            [182.73.50.82 listed in bb.barracudacentral.org]
 0.0 HTML_MESSAGE           BODY: HTML included in message
 0.0 UNPARSEABLE_RELAY      Informational: message has unparseable relay lines

The original message was not completely plain text, and may be unsafe to
open with some email clients; in particular, it may contain a virus,
or confirm that your address can receive spam.  If you wish to view
it, it may be safer to save it to a file and open it with an editor.

-------------- next part --------------
An embedded message was scrubbed...
From: Squid <squid at visolve.com>
Subject: Re: [squid-users] redirect all ports to squid
Date: Sat, 04 Oct 2014 16:40:16 +0530
Size: 5657
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141004/869e9a81/attachment.eml>

From squid at visolve.com  Sat Oct  4 11:50:37 2014
From: squid at visolve.com (Squid)
Date: Sat, 04 Oct 2014 17:20:37 +0530
Subject: [squid-users] redirect all ports to squid
In-Reply-To: <DUB123-DS15337FBB7B90E43B736C7EB3BB0@phx.gbl>
References: <DUB123-DS15337FBB7B90E43B736C7EB3BB0@phx.gbl>
Message-ID: <542FDF0D.5090804@visolve.com>

Spam detection software, running on the system "master.squid-cache.org",
has identified this incoming email as possible spam.  The original
message has been attached to this so you can view it or label
similar future email.  If you have any questions, see
@@CONTACT_ADDRESS@@ for details.

Content preview:  Hi, Yes, we can redirect the ports to squid through our firewall
   rules. Check below lines to redirect the ports. We have some different methods
   to do. 1. In first Method: First, we need to machine that squid will be running
   on, You do not need iptables or any special kernel options on this machine,
   just squid. You will, however, need the 'http_accel' options as described
   above. [...] 

Content analysis details:   (5.9 points, 5.0 required)

 pts rule name              description
---- ---------------------- --------------------------------------------------
 0.0 HTML_MESSAGE           BODY: HTML included in message
 1.6 RCVD_IN_BRBL_LASTEXT   RBL: No description available.
                            [182.73.50.82 listed in bb.barracudacentral.org]
 3.6 RCVD_IN_PBL            RBL: Received via a relay in Spamhaus PBL
                            [182.73.50.82 listed in zen.spamhaus.org]
 0.7 RCVD_IN_XBL            RBL: Received via a relay in Spamhaus XBL
 0.0 UNPARSEABLE_RELAY      Informational: message has unparseable relay lines

The original message was not completely plain text, and may be unsafe to
open with some email clients; in particular, it may contain a virus,
or confirm that your address can receive spam.  If you wish to view
it, it may be safer to save it to a file and open it with an editor.

-------------- next part --------------
An embedded message was scrubbed...
From: Squid <squid at visolve.com>
Subject: Re: [squid-users] redirect all ports to squid
Date: Sat, 04 Oct 2014 17:20:37 +0530
Size: 4962
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141004/ca0c05b9/attachment.eml>

From omidkosari at yahoo.com  Sat Oct  4 12:04:58 2014
From: omidkosari at yahoo.com (Omid Kosari)
Date: Sat, 4 Oct 2014 05:04:58 -0700 (PDT)
Subject: [squid-users] High cpu usage by re_search_internal
In-Reply-To: <1411987273071-4667550.post@n4.nabble.com>
References: <1411987273071-4667550.post@n4.nabble.com>
Message-ID: <1412424298423-4667655.post@n4.nabble.com>

Hi,

I have 2 squid boxes . Same version,OS and almost same config,hardware .
Both have same problem also . normally cpu usage by squid is very high . I
have tried this guide http://wiki.squid-cache.org/SquidFaq/SquidProfiling 
and found more than 85% of cpu usage is by re_search_internal symbol name .
Please help me to solve this problem

samples  %        image name               app name                 symbol
name
3297480  89.3408  libc-2.15.so             squid3                  
re_search_internal


 squid3 -v
Squid Cache: Version 3.1.20
configure options:  '--build=x86_64-linux-gnu' '--prefix=/usr'
'--includedir=${prefix}/include' '--mandir=${prefix}/share/man'
'--infodir=${prefix}/share/info' '--sysconfdir=/etc' '--localstatedir=/var'
'--libexecdir=${prefix}/lib/squid3' '--srcdir=.' '--disable-maintainer-mode'
'--disable-dependency-tracking' '--disable-silent-rules'
'--datadir=/usr/share/squid3' '--sysconfdir=/etc/squid3'
'--mandir=/usr/share/man' '--with-cppunit-basedir=/usr' '--enable-inline'
'--enable-async-io=8' '--enable-storeio=ufs,aufs,diskd'
'--enable-removal-policies=lru,heap' '--enable-delay-pools'
'--enable-cache-digests' '--enable-underscores' '--enable-icap-client'
'--enable-follow-x-forwarded-for'
'--enable-auth=basic,digest,ntlm,negotiate'
'--enable-basic-auth-helpers=LDAP,MSNT,NCSA,PAM,SASL,SMB,YP,DB,POP3,getpwnam,squid_radius_auth,multi-domain-NTLM'
'--enable-ntlm-auth-helpers=smb_lm,'
'--enable-digest-auth-helpers=ldap,password'
'--enable-negotiate-auth-helpers=squid_kerb_auth'
'--enable-external-acl-helpers=ip_user,ldap_group,session,unix_group,wbinfo_group'
'--enable-arp-acl' '--enable-esi' '--enable-zph-qos' '--enable-wccpv2'
'--disable-translation' '--with-logdir=/var/log/squid3'
'--with-pidfile=/var/run/squid3.pid' '--with-filedescriptors=65536'
'--with-large-files' '--with-default-user=proxy' '--enable-linux-netfilter'
'build_alias=x86_64-linux-gnu' 'CFLAGS=-g -O2 -fPIE -fstack-protector
--param=ssp-buffer-size=4 -Wformat -Werror=format-security -Wall'
'LDFLAGS=-Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now'
'CPPFLAGS=-D_FORTIFY_SOURCE=2' 'CXXFLAGS=-g -O2 -fPIE -fstack-protector
--param=ssp-buffer-size=4 -Wformat -Werror=format-security'
--with-squid=/build/buildd/squid3-3.1.20



Linux 3.5.0-51-generic #76-Ubuntu SMP Thu May 15 21:19:10 UTC 2014 x86_64
x86_64 x86_64 GNU/Linux






--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/High-cpu-usage-by-re-search-internal-tp4667550p4667655.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From squid3 at treenet.co.nz  Sat Oct  4 13:27:12 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 05 Oct 2014 02:27:12 +1300
Subject: [squid-users] High cpu usage by re_search_internal
In-Reply-To: <1412424298423-4667655.post@n4.nabble.com>
References: <1411987273071-4667550.post@n4.nabble.com>
 <1412424298423-4667655.post@n4.nabble.com>
Message-ID: <542FF5B0.1050802@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 5/10/2014 1:04 a.m., Omid Kosari wrote:
> Hi,
> 
> I have 2 squid boxes . Same version,OS and almost same
> config,hardware . Both have same problem also . normally cpu usage
> by squid is very high . I have tried this guide
> http://wiki.squid-cache.org/SquidFaq/SquidProfiling and found more
> than 85% of cpu usage is by re_search_internal symbol name . Please
> help me to solve this problem

Ah. regex bites again.

re_search_internal is a regex pattern match being scanned on some data.

Go through your squid.conf and minimize the amount of regex ACLs and
other directives you are using. If you want some assistance with that
post it here and us chickens can peck at it.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUL/WwAAoJELJo5wb/XPRjaPQIAM/nO1afdt8nUr8jXY+zlBuf
qO0t8ODr+Bg58kbiV1s3J2yntFpQncEcttVPsN/h6tqVkdEfhjruU+IdnEU7caRi
bQM0EPmAXs1FAfFWy+KfeIVFqSPKp0Bh8cV0wxgM39084002PQopQoZ/iHzEyuBg
S1H8jF2/2iqL2MKDEN4e6HwfUuBy9unuJLikD5h1lNwriW31avEtoicnI/w/r8qd
be0TmrOWeKkRe5gcIl5D/lFUghKWcgyDGePEwnM2LUrm/oOufEPD59THP/j8GNur
5/BvxmYzo/ojOl843HMbCtcaNzyoUKXO/1M1GfDclCN/7pIJ4t86mbVmk5d5R7M=
=pIdC
-----END PGP SIGNATURE-----


From omidkosari at yahoo.com  Sat Oct  4 14:04:54 2014
From: omidkosari at yahoo.com (Omid Kosari)
Date: Sat, 4 Oct 2014 07:04:54 -0700 (PDT)
Subject: [squid-users] High cpu usage by re_search_internal
In-Reply-To: <542FF5B0.1050802@treenet.co.nz>
References: <1411987273071-4667550.post@n4.nabble.com>
 <1412424298423-4667655.post@n4.nabble.com> <542FF5B0.1050802@treenet.co.nz>
Message-ID: <1412431494708-4667657.post@n4.nabble.com>

Thanks .

I did it . When all refresh_pattern lines commented except following default
ones

refresh_pattern ^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
refresh_pattern .		0	20%	4320

squid uses 40~60% cpu usage . Adding just following 2 lines increases more
than 20% to squid cpu usage ! 

refresh_pattern -i
(.+\.)?(microsoft|windowsupdate)\.com/.*?\.(cab|exe|dll|ms[i|u|f]|asf|wm[v|a]|dat|zip|iso|psf)$
10080 100% 172800 ignore-no-store ignore-reload ignore-private
ignore-must-revalidate override-expire override-lastmod
refresh_pattern -i (.+\.)?apple\.com/.*?\.(pkg|dmg|tar|pkm|ipsw|exe)$ 10080
100% 172800 ignore-no-store ignore-reload ignore-private


And here is my complete refresh_pattern http://pastebin.com/UtG7Gdv1   . I
hope you provide some tips to solve it .
Here is my cachemgr info  http://pastebin.com/Ewcmwyvw

Thanks in advance




--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/High-cpu-usage-by-re-search-internal-tp4667550p4667657.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From omidkosari at yahoo.com  Sat Oct  4 14:34:12 2014
From: omidkosari at yahoo.com (Omid Kosari)
Date: Sat, 4 Oct 2014 07:34:12 -0700 (PDT)
Subject: [squid-users] High cpu usage by re_search_internal
In-Reply-To: <1412431494708-4667657.post@n4.nabble.com>
References: <1411987273071-4667550.post@n4.nabble.com>
 <1412424298423-4667655.post@n4.nabble.com> <542FF5B0.1050802@treenet.co.nz>
 <1412431494708-4667657.post@n4.nabble.com>
Message-ID: <1412433252992-4667658.post@n4.nabble.com>

Mehdi Sarmadi wrote
> Hey
> 
> Alright. About refresh pattern you have a very excessive list IMHO. I
> don't know about your hardware but generally for a typical general purpose
> SMB server hardware, that's too much. If you want to stick with it and
> can't reduce the list. 
> Check, how many core's you machine have. You should know squid naturally
> sticks . A solution is to start multiple squid instances, that way you can
> have squid(refresh_pattern) load distributed on more than one CPU core,
> thus you'll get better performance.
> 
> Hope it helps
> Cheers

Thanks for the tip . It has a core i3 cpu so it has 4 cores . Unfortunately
squid does not load fine across all cores specially in older versions like
mine v 3.1 . Multi instance has its  own complexity and headaches . i am
trying to have clean design to be away from those problems . It was very
useful if squid could do the refresh_pattern jobs by other cores . or some
trick like that .



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/High-cpu-usage-by-re-search-internal-tp4667550p4667658.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From squid3 at treenet.co.nz  Sat Oct  4 15:12:15 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 05 Oct 2014 04:12:15 +1300
Subject: [squid-users] High cpu usage by re_search_internal
In-Reply-To: <1412433252992-4667658.post@n4.nabble.com>
References: <1411987273071-4667550.post@n4.nabble.com>
 <1412424298423-4667655.post@n4.nabble.com> <542FF5B0.1050802@treenet.co.nz>
 <1412431494708-4667657.post@n4.nabble.com>
 <1412433252992-4667658.post@n4.nabble.com>
Message-ID: <54300E4F.3050203@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 5/10/2014 3:34 a.m., Omid Kosari wrote:
> Mehdi Sarmadi wrote
>> Hey
>> 
>> Alright. About refresh pattern you have a very excessive list
>> IMHO. I don't know about your hardware but generally for a
>> typical general purpose SMB server hardware, that's too much. If
>> you want to stick with it and can't reduce the list. Check, how
>> many core's you machine have. You should know squid naturally 
>> sticks . A solution is to start multiple squid instances, that
>> way you can have squid(refresh_pattern) load distributed on more
>> than one CPU core, thus you'll get better performance.
>> 
>> Hope it helps Cheers
> 
> Thanks for the tip . It has a core i3 cpu so it has 4 cores .
> Unfortunately squid does not load fine across all cores specially
> in older versions like mine v 3.1 . Multi instance has its  own
> complexity and headaches . i am trying to have clean design to be
> away from those problems . It was very useful if squid could do the
> refresh_pattern jobs by other cores . or some trick like that .
> 

Here are some tips for your patterns:

* all the (.+\.)? at the begining are useless complication. Remove.

* so are the .*?$ at the end of some patterns. This bit is also
probably doing more harm than good. Because the $ hints to regex that
it should scan right-to-left and the path and query portions of the
URL is the largest pieces to scan over. Remove.

* the following two lines are redundant. The first will match
everything the second would have caught. Drop the second one.

  refresh_pattern -i \.htm 120 50% 10080 reload-into-ims
  refresh_pattern -i \.html 120 50% 10080 reload-into-ims

* the pattern below the comment "#Very aggressive 120 Days" contains
duplicates.


there are probably some smaller fixes, but those are the biggest I can
see without suggesting you drop those patterns entirely.

You would do well from an upgrade of Squid. The later versions have
eliminated the need for ignore-no-cache, ignore-private, ignore-auth
(the latter two there do really, really bad things).

I am also curios why you are ignoring must-revalidate? it is a
bandwidth reduction mechanism.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUMA5PAAoJELJo5wb/XPRjkbwIAJtwCUvi1NYfg6dkggRth902
MG/x9mzhEVGE7Js7EyctD01Rgte/DUO3WIkbEBAkVK1t3Qlb1D8r60axtKBZzbd1
TsJ+kiJP4MB6C48yPwZlTe3/XwacgrF62UtocGNfJEHjm+9ZnyQL6EhAMJFJAHdM
6kJg35/AuThbEKrfTOG0u4BuMd0bnvNb1VHAOiRoaBAWDcW0N3uK3vrMM0XT5teA
J5ht0GaLQoum/YesgwEf84emqD0Ukv4SZSj73w1fO4B4lEEC6aQ2IkOHycYp/fCh
tLPeMekwZa4aQxLjgVJNEZHhcen91ttZPyLQUByZFhMShAJCJsRpQwpVpiHt/ug=
=SEQ1
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Sat Oct  4 15:23:49 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 05 Oct 2014 04:23:49 +1300
Subject: [squid-users] High cpu usage by re_search_internal
In-Reply-To: <54300E4F.3050203@treenet.co.nz>
References: <1411987273071-4667550.post@n4.nabble.com>
 <1412424298423-4667655.post@n4.nabble.com> <542FF5B0.1050802@treenet.co.nz>
 <1412431494708-4667657.post@n4.nabble.com>
 <1412433252992-4667658.post@n4.nabble.com> <54300E4F.3050203@treenet.co.nz>
Message-ID: <54301105.5040304@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 5/10/2014 4:12 a.m., Amos Jeffries wrote:
> On 5/10/2014 3:34 a.m., Omid Kosari wrote:
>> Mehdi Sarmadi wrote
>>> Hey
>>> 
>>> Alright. About refresh pattern you have a very excessive list 
>>> IMHO. I don't know about your hardware but generally for a 
>>> typical general purpose SMB server hardware, that's too much.
>>> If you want to stick with it and can't reduce the list. Check,
>>> how many core's you machine have. You should know squid
>>> naturally sticks . A solution is to start multiple squid
>>> instances, that way you can have squid(refresh_pattern) load
>>> distributed on more than one CPU core, thus you'll get better
>>> performance.
>>> 
>>> Hope it helps Cheers
> 
>> Thanks for the tip . It has a core i3 cpu so it has 4 cores . 
>> Unfortunately squid does not load fine across all cores
>> specially in older versions like mine v 3.1 . Multi instance has
>> its  own complexity and headaches . i am trying to have clean
>> design to be away from those problems . It was very useful if
>> squid could do the refresh_pattern jobs by other cores . or some
>> trick like that .
> 
> 
> Here are some tips for your patterns:
> 
> * all the (.+\.)? at the begining are useless complication.
> Remove.
> 
> * so are the .*?$ at the end of some patterns. This bit is also 
> probably doing more harm than good. Because the $ hints to regex
> that it should scan right-to-left and the path and query portions
> of the URL is the largest pieces to scan over. Remove.
> 
> * the following two lines are redundant. The first will match 
> everything the second would have caught. Drop the second one.
> 
> refresh_pattern -i \.htm 120 50% 10080 reload-into-ims 
> refresh_pattern -i \.html 120 50% 10080 reload-into-ims
> 
> * the pattern below the comment "#Very aggressive 120 Days"
> contains duplicates.
> 
> 
> there are probably some smaller fixes, but those are the biggest I
> can see without suggesting you drop those patterns entirely.
> 
> You would do well from an upgrade of Squid. The later versions
> have eliminated the need for ignore-no-cache, ignore-private,
> ignore-auth (the latter two there do really, really bad things).
> 
> I am also curios why you are ignoring must-revalidate? it is a 
> bandwidth reduction mechanism.
> 

I'm finding some more the more I look.

Things like (10\.10\.34\.34|peyvandha\.ir) being in the pattern set at
the top means that the section of pattern later
(10\.10\.34\.34|peyvandha\.ir|  in the 120 day set is useless.

Similar things in the "All files" set.
 *  rar for example is listed twice,
 *  (jp(e?g|e|2)|jpg  matches jpg ... or jpg.

Also when matching one character from multiple use square bracket
syntax. Instead of things like ms(i|u|p)   ... make it:  ms[iup]


Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUMBEEAAoJELJo5wb/XPRjjxoH/RcYxK+rRSwdUqbetPJOdtMf
e0ApMl2N6pc+dD8HpY5ZcAB5rSOSEepinETVgpeOI33mDT7H4m7NlUvLStHBTzan
SFWpoGWICUDiDwh0I/nMJTBByz8la073Rw7uKwl0AL2j3P9WtJoPyd4J8pSbs+BD
5YcQyJU0nWxlx05qbayl7Fe1R3wCWwA3xWtLTXnxEqnfQ+u69g4o+0XWSh7A0tC9
WVcl1BE4GaBXjSFKdkx1waR6ZIXeaEuI0GRSe57MCVk2e5P/nkLGwBvepw/dr7YN
nHbeC4LI/vOKhS0yZVsa5z6y10Ov2vLTnAf2kXgpA2Ud7lZY72MAGYbhJNnWNiU=
=y94q
-----END PGP SIGNATURE-----


From omidkosari at yahoo.com  Sat Oct  4 16:17:02 2014
From: omidkosari at yahoo.com (Omid Kosari)
Date: Sat, 4 Oct 2014 09:17:02 -0700 (PDT)
Subject: [squid-users] High cpu usage by re_search_internal
In-Reply-To: <54301105.5040304@treenet.co.nz>
References: <1411987273071-4667550.post@n4.nabble.com>
 <1412424298423-4667655.post@n4.nabble.com> <542FF5B0.1050802@treenet.co.nz>
 <1412431494708-4667657.post@n4.nabble.com>
 <1412433252992-4667658.post@n4.nabble.com> <54300E4F.3050203@treenet.co.nz>
 <54301105.5040304@treenet.co.nz>
Message-ID: <1412439422025-4667661.post@n4.nabble.com>

Thanks a lot . The latest file with your helps is here
http://pastebin.com/8yytTWqA  
Any other tricks appreciated .



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/High-cpu-usage-by-re-search-internal-tp4667550p4667661.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From motienko at gmail.com  Sat Oct  4 19:26:23 2014
From: motienko at gmail.com (Oleg Motienko)
Date: Sat, 4 Oct 2014 23:26:23 +0400
Subject: [squid-users] redirect all ports to squid
In-Reply-To: <2207092051854955ae5ff49b9e9b25e9@SIXPR04MB304.apcprd04.prod.outlook.com>
References: <DUB123-DS15337FBB7B90E43B736C7EB3BB0@phx.gbl>
 <2207092051854955ae5ff49b9e9b25e9@SIXPR04MB304.apcprd04.prod.outlook.com>
Message-ID: <CAAtQP1ziqJ4bwg3pQAiJtt4gy5aXxA-7pqWPt4kTXRds0DzkMw@mail.gmail.com>

Hello,

AFAIK it is possible to use redocks software (
http://darkk.net.ru/redsocks/ ) with squid.

On Wed, Oct 1, 2014 at 1:49 AM, James Harper <james at ejbdigital.com.au> wrote:
>>
>> It's possible to redirect all ports to squid ? thru iptables ?
>> For example port 25 smtp,143 imap, etc...
>> Can squid handle that. In transparent mode.
>
> Yes. Kind of. You need:
> . An appropriate rule in iptables nat table that ends with -j REDIRECT --to-ports 3129 (or whatever port you are listening on for this traffic)
> . A https_port definition in squid.conf on that port with ssl-bump and a certificate (certificate doesn't get used unless you are doing actual https but the syntax requires it) and a port name
> . an acl attached to the name of the listeners myportname
> . an ssl_bump none that matches the traffic you are interested in (all if you aren't doing https interception)
>
> Now that you know you can do it, consider:
> . I've asked this question on the list and the response from people who really do know what they are talking about is that squid is not designed as a general tcp proxy and there are probably other solutions that work better
> . squid currently doesn't allow a sensible termination of the connection if it isn't allowed, or if there is nothing listening at the other end. Your smtp/pop3/imap/etc application won't like that.
> . you have to do authentication out-of-band (eg ident), but that's the same with transparent http anyway
>
> To do this really nicely, squid would need:
> . a "tcp_port" instead of "http_port" designed for exactly this sort of thing
> . a way to call out to the destination before accepting the connection so that a 'connection refused' could be given if there is nothing listening
> . a way to simply drop the connection if it doesn't succeed rather than the default response squid gives
> . a way to redirect traffic to a helper (eg SMTP/IMAP/POP3 filter to scan for viruses, etc) (maybe this already exists already via other means?)
>
> So in short it works, but not as well as it could, and you might be better of finding another solution. The main reason I was interested is that Squid already has a very nice acl implementation, and there are already a number of good log analysis tools for it.


From marcus.kool at urlfilterdb.com  Sat Oct  4 20:13:39 2014
From: marcus.kool at urlfilterdb.com (Marcus Kool)
Date: Sat, 4 Oct 2014 22:13:39 +0200
Subject: [squid-users] High cpu usage by re_search_internal
In-Reply-To: <1412424298423-4667655.post@n4.nabble.com>
References: <1411987273071-4667550.post@n4.nabble.com>
 <1412424298423-4667655.post@n4.nabble.com>
Message-ID: <e9064d2d6775d22315f166c9a418d3da.squirrel@wm.familiakool.net>

I suspect that the language setting is causing it.
If $LANG is different from "C" it may have a huge impact on the
performance of regular expression evaluation (not only in Squid but also
awk, sed etc.)
Try this:
   LANG=C /etc/init.d/squid start
and see if Squid improves.

Marcus

> Hi,
>
> I have 2 squid boxes . Same version,OS and almost same config,hardware .
> Both have same problem also . normally cpu usage by squid is very high . I
> have tried this guide http://wiki.squid-cache.org/SquidFaq/SquidProfiling
> and found more than 85% of cpu usage is by re_search_internal symbol name
> .
> Please help me to solve this problem
>
> samples  %        image name               app name                 symbol
> name
> 3297480  89.3408  libc-2.15.so             squid3
> re_search_internal
>
>
>  squid3 -v
> Squid Cache: Version 3.1.20
> configure options:  '--build=x86_64-linux-gnu' '--prefix=/usr'
> '--includedir=${prefix}/include' '--mandir=${prefix}/share/man'
> '--infodir=${prefix}/share/info' '--sysconfdir=/etc'
> '--localstatedir=/var'
> '--libexecdir=${prefix}/lib/squid3' '--srcdir=.'
> '--disable-maintainer-mode'
> '--disable-dependency-tracking' '--disable-silent-rules'
> '--datadir=/usr/share/squid3' '--sysconfdir=/etc/squid3'
> '--mandir=/usr/share/man' '--with-cppunit-basedir=/usr' '--enable-inline'
> '--enable-async-io=8' '--enable-storeio=ufs,aufs,diskd'
> '--enable-removal-policies=lru,heap' '--enable-delay-pools'
> '--enable-cache-digests' '--enable-underscores' '--enable-icap-client'
> '--enable-follow-x-forwarded-for'
> '--enable-auth=basic,digest,ntlm,negotiate'
> '--enable-basic-auth-helpers=LDAP,MSNT,NCSA,PAM,SASL,SMB,YP,DB,POP3,getpwnam,squid_radius_auth,multi-domain-NTLM'
> '--enable-ntlm-auth-helpers=smb_lm,'
> '--enable-digest-auth-helpers=ldap,password'
> '--enable-negotiate-auth-helpers=squid_kerb_auth'
> '--enable-external-acl-helpers=ip_user,ldap_group,session,unix_group,wbinfo_group'
> '--enable-arp-acl' '--enable-esi' '--enable-zph-qos' '--enable-wccpv2'
> '--disable-translation' '--with-logdir=/var/log/squid3'
> '--with-pidfile=/var/run/squid3.pid' '--with-filedescriptors=65536'
> '--with-large-files' '--with-default-user=proxy'
> '--enable-linux-netfilter'
> 'build_alias=x86_64-linux-gnu' 'CFLAGS=-g -O2 -fPIE -fstack-protector
> --param=ssp-buffer-size=4 -Wformat -Werror=format-security -Wall'
> 'LDFLAGS=-Wl,-Bsymbolic-functions -fPIE -pie -Wl,-z,relro -Wl,-z,now'
> 'CPPFLAGS=-D_FORTIFY_SOURCE=2' 'CXXFLAGS=-g -O2 -fPIE -fstack-protector
> --param=ssp-buffer-size=4 -Wformat -Werror=format-security'
> --with-squid=/build/buildd/squid3-3.1.20
>
>
>
> Linux 3.5.0-51-generic #76-Ubuntu SMP Thu May 15 21:19:10 UTC 2014 x86_64
> x86_64 x86_64 GNU/Linux
>
>
>
>
>
>
> --
> View this message in context:
> http://squid-web-proxy-cache.1019090.n4.nabble.com/High-cpu-usage-by-re-search-internal-tp4667550p4667655.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>




From robert at gillecaluim.com  Sun Oct  5 00:29:01 2014
From: robert at gillecaluim.com (Robert Watson)
Date: Sat, 4 Oct 2014 17:29:01 -0700
Subject: [squid-users] transparent proxy https and self signed certificate
	error
Message-ID: <CADoG9xk43M6+ROrbhA6kL2TrC9_zrcOjUznz+zhLS7xphrZC_Q@mail.gmail.com>

using squid 3.4.8, compiled from source with ./configure flags
--enable-icap-client --enable-ssl --enable-ssl-crtd
configured iptables for transparent proxy (redirect 80 to 3128) and
everything works fine

configured iptables for transparent proxy (redirect 443 to 3127) but can't
get transparent proxy for https to work
my squid.conf
...
# Squid https port
https_port 3127 intercept ssl-bump generate-host-certificates=on
dynamic_cert_mem_cache_size=4MB cert=/etc/squid/ssl_cert/XXX.pem
acl broken_sites dstdomain .example.com
ssl_bump none localhost
ssl_bump none broken_sites
ssl_bump server-first all
sslproxy_cert_error allow all
sslproxy_flags DONT_VERIFY_PEER
sslcrtd_program /usr/lib/squid/ssl_crtd -s /var/lib/squid/ssl_db -M 4MB
sslcrtd_children 32 startup=5 idle=1

when visiting google (or any other https site) chrome complains
NET::ERR_CERT_AUTHORITY_INVALID
I tried using internet explorer as admin and imported the self signed
certificate but that hasn't helped

can anyone please with how to debug this
thanks, Robert
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141004/8076704b/attachment.htm>

From doug1234 at digcorp.net  Sun Oct  5 03:49:27 2014
From: doug1234 at digcorp.net (Douglas Davenport)
Date: Sat, 4 Oct 2014 23:49:27 -0400
Subject: [squid-users] Best OS for latest squid
Message-ID: <CAOsHgttQvOwWML+5W-sSoYR23iBg9PZwCwH3d7NPQZOwM=CpJQ@mail.gmail.com>

I'm starting from scratch with an AWS based squid setup, I would like to be
able stay up to date with the latest squid releases to have all the sslbump
fixes. Can someone suggest what is best to use, Centos 6, Ubuntu 14 or
another distro? I see a lot of the binary releases lag behind, does squid
build easily on a particular platform?
Sorry if this question has been covered, I searched but only found
discussion about hardware specs.
Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141004/4d1c5e60/attachment.htm>

From squid3 at treenet.co.nz  Sun Oct  5 04:31:46 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 05 Oct 2014 17:31:46 +1300
Subject: [squid-users] Best OS for latest squid
In-Reply-To: <CAOsHgttQvOwWML+5W-sSoYR23iBg9PZwCwH3d7NPQZOwM=CpJQ@mail.gmail.com>
References: <CAOsHgttQvOwWML+5W-sSoYR23iBg9PZwCwH3d7NPQZOwM=CpJQ@mail.gmail.com>
Message-ID: <5430C9B2.4070907@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 5/10/2014 4:49 p.m., Douglas Davenport wrote:
> I'm starting from scratch with an AWS based squid setup, I would
> like to be able stay up to date with the latest squid releases to
> have all the sslbump fixes. Can someone suggest what is best to
> use, Centos 6, Ubuntu 14 or another distro? I see a lot of the
> binary releases lag behind, does squid build easily on a particular
> platform? Sorry if this question has been covered, I searched but
> only found discussion about hardware specs. Thanks!
> 

We currently do regular integration testing with successful results on
Debian Sid, Ubuntu Precise & Saucy & Trusty, CentOS 6 & 7, FreeBSD 9.1
& 10, OpenBSD 5.4, Fedora 19.

Using GCC, clang, and ICC compilers where available.

Other OS usually have good results as well with the exception of
Windows and MacOS where SMP functionality used by Squid is missing or
broken.

FWIW: Old OS releases with older compilers generally work best with
old Squid releases with matching level of compiler support. Not that
such a situation is desirabe for use in todays Internet.

NOTE: For tracking latest Squid in future you will want GCC 4.9+ or
clang 3.4+ compilers. The Squid-3.4+ series build best performance
optimizations with them and 3.6 series about to begin development will
probably require C++11 at some point soon.

Amos

PS. personally I am a Debian "fanboi", with Ubuntu a close second.
That comes down to package management tools and their multi-arch
support though.

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUMMmyAAoJELJo5wb/XPRjl6YIAKj+8puStnRkYgi9CkIxV8Kg
xJbnVTuD2yKKbNr090KcDJ6IbJ1dxtZlc7PIZVu3l/pkQ01lACSo75Q6wdgo2+FS
mydorgDOB9aDY9CZj24xvBlyZCUoLq/3mGf4ttMKp+QJ6lU5pKwrElw7dkKdmNs5
djjF8/w8/tUEdWI+FBMJBsT9m+Wl1eLPZyFULU0hTRhAmMPV1Ms6sYXT8myjYvUR
Ha20lSeQWNshSjHfKlkgX1BycpgSTOYvQ9BUK9U5beMHBWVvQUxI+A1WNcWINqXN
f84ryIi+tyWHexweg3eKRWzh0+O/NVBtqIbXOJjGqVZxqzLuYjUoI4hNM23bAEc=
=lbBe
-----END PGP SIGNATURE-----


From jeg1972 at gmail.com  Sun Oct  5 05:38:24 2014
From: jeg1972 at gmail.com (John Gardner)
Date: Sun, 5 Oct 2014 06:38:24 +0100
Subject: [squid-users] RPM Packages
Message-ID: <CAFFsz++iJvF22-Y1NEAJKyn2g6gYyD-mhswA-a2LfGYT9JRpVQ@mail.gmail.com>

This question is probably specifically for Eliezer.

My question is this, On the RPM repository at
http://www1.ngtech.co.il/rpm/ There is an RPM package for version
3.4.5 for Oracle Linux 6.  I installed this a few months ago when I
was preparing to go live with a new Squid instance and now after all
of the testing is complete, I'd like to update to the latest RPM which
is only for CentOS 6.  Eliezer, can you tell me how much different is
the CentOS 6 build from the OEL 6 please?

Thanks and Regards

John


From squid3 at treenet.co.nz  Sun Oct  5 05:44:37 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 05 Oct 2014 18:44:37 +1300
Subject: [squid-users] transparent proxy https and self signed
 certificate error
In-Reply-To: <CADoG9xk43M6+ROrbhA6kL2TrC9_zrcOjUznz+zhLS7xphrZC_Q@mail.gmail.com>
References: <CADoG9xk43M6+ROrbhA6kL2TrC9_zrcOjUznz+zhLS7xphrZC_Q@mail.gmail.com>
Message-ID: <5430DAC5.8030802@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 5/10/2014 1:29 p.m., Robert Watson wrote:
> using squid 3.4.8, compiled from source with ./configure flags 
> --enable-icap-client --enable-ssl --enable-ssl-crtd configured
> iptables for transparent proxy (redirect 80 to 3128) and everything
> works fine
> 
> configured iptables for transparent proxy (redirect 443 to 3127)
> but can't get transparent proxy for https to work my squid.conf 
> ... # Squid https port https_port 3127 intercept ssl-bump
> generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
> cert=/etc/squid/ssl_cert/XXX.pem acl broken_sites dstdomain
> .example.com ssl_bump none localhost ssl_bump none broken_sites 
> ssl_bump server-first all sslproxy_cert_error allow all 
> sslproxy_flags DONT_VERIFY_PEER sslcrtd_program
> /usr/lib/squid/ssl_crtd -s /var/lib/squid/ssl_db -M 4MB 
> sslcrtd_children 32 startup=5 idle=1
> 
> when visiting google (or any other https site) chrome complains 
> NET::ERR_CERT_AUTHORITY_INVALID I tried using internet explorer as
> admin and imported the self signed certificate but that hasn't
> helped
> 
> can anyone please with how to debug this thanks, Robert

To debug you will need a packet capture with full packet bodies
(tcpdump -s 0) of the TCP connection between browser and Squid, and
the connection between Squid and server.
Wireshark should be able to decrypt the TLS/SSL handshakes to see what
differences or corruption is happening.


FYI: When testing be sure to clear/empty the ssl_crtd database if any
changes are made to CA keys.



PS. Google with Chrome appear these days to be the champions of
unbreakable TLS, their software is continually being updated to
use/invent new TLS features that close loopholes in TLS design which
allow ssl-bump to take place. What worked last month has no guarantee
of working today, same again next month.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUMNrEAAoJELJo5wb/XPRj7QAIAMVZ5SOc+X8vWlMdbgyNhNJR
k//TmLRMdwZ1qxFBHTF3t+I7JVua2b+DDp0fU6Ubq6WvoARNBQGPQdI0XfOtrnLQ
3lsBCkU8NZuXt2LeoKG6eNPaNyuhom7HeFzmwELgM4SuASxbO4mpBxET8Tg1XYwQ
VdSruqwx0hwhb5g4yeXWEIflkILc1A5cTAAbNGXIHpWbqMmwvnav5KWCfDhesHEU
CdxuyZJnUZwv/uRYSaiiYebUECTS/Zl8JkGvCXe5zheLwT2Wcor3urUXIK3gPToz
dy8FJ7lRGSSIJNkiQO4iNwI28vYkJHP2u3yFMFOdu4r/jN7WRgaY2LSpaQF+pqc=
=teuE
-----END PGP SIGNATURE-----


From Jason_Haar at trimble.com  Sun Oct  5 06:30:20 2014
From: Jason_Haar at trimble.com (Jason Haar)
Date: Sun, 5 Oct 2014 19:30:20 +1300
Subject: [squid-users] transparent proxy https and self signed
 certificate error
In-Reply-To: <5430DAC5.8030802@treenet.co.nz>
References: <CADoG9xk43M6+ROrbhA6kL2TrC9_zrcOjUznz+zhLS7xphrZC_Q@mail.gmail.com>
 <5430DAC5.8030802@treenet.co.nz>
Message-ID: <5430E57C.4030709@trimble.com>

On 05/10/14 18:44, Amos Jeffries wrote:
> PS. Google with Chrome appear these days to be the champions of
> unbreakable TLS, their software is continually being updated to
> use/invent new TLS features that close loopholes in TLS design which
> allow ssl-bump to take place. What worked last month has no guarantee
> of working today, same again next month.
That can't be right? I mean, sslbump doesn't rely on any "bugs" - it is
simply a CA and so any browser that thinks it's a CA should be happy
going to any https website using appropriate certs signed by that CA?

I know Chrome has *cert pinning* (ie they hardwired the CAs that Google
knows *.google.com uses into  Chrome), but that isn't a "loophole".

sslbump seems to work as well as can be expected. But pinning also
appears to be growing in stature (Firefox now does it too), so there are
less and less sites that sslbump can work on. I wanted to use sslbump so
that we could run AV and filtering on https links, but pinning means our
"exclude list" of https sites is getting larger and larger - and
includes Cloud providers the badguys are housing their malware on -
which means our AV still can't catch it  :-(


-- 
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1




From squid3 at treenet.co.nz  Sun Oct  5 10:22:15 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 05 Oct 2014 23:22:15 +1300
Subject: [squid-users] transparent proxy https and self signed
 certificate error
In-Reply-To: <5430E57C.4030709@trimble.com>
References: <CADoG9xk43M6+ROrbhA6kL2TrC9_zrcOjUznz+zhLS7xphrZC_Q@mail.gmail.com>
 <5430DAC5.8030802@treenet.co.nz> <5430E57C.4030709@trimble.com>
Message-ID: <54311BD7.2030605@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 5/10/2014 7:30 p.m., Jason Haar wrote:
> On 05/10/14 18:44, Amos Jeffries wrote:
>> PS. Google with Chrome appear these days to be the champions of 
>> unbreakable TLS, their software is continually being updated to 
>> use/invent new TLS features that close loopholes in TLS design
>> which allow ssl-bump to take place. What worked last month has no
>> guarantee of working today, same again next month.
> That can't be right? I mean, sslbump doesn't rely on any "bugs" -
> it is simply a CA and so any browser that thinks it's a CA should
> be happy going to any https website using appropriate certs signed
> by that CA?

The CA system itself is the design flaw. No I would not go so far as
to say "bug" (thats code) but "loophole" and "flaw" are more
appropriate for a system design problem.

The intention and design of TLS/SSL is to prevent third-party
intermediaries (is Squid) inntercepting communications (is ssl-bump)
and looking at what the traffic inside is. Anything that lets a third
party access is by definintion a flaw in the TLS protocol design.


> 
> I know Chrome has *cert pinning* (ie they hardwired the CAs that
> Google knows *.google.com uses into  Chrome), but that isn't a
> "loophole".
> 

Yes, cert pinning, HSTS, hard coded google.com CA certificates ...
whatever they can think of next.

> sslbump seems to work as well as can be expected. But pinning also 
> appears to be growing in stature (Firefox now does it too), so
> there are less and less sites that sslbump can work on. I wanted to
> use sslbump so that we could run AV and filtering on https links,
> but pinning means our "exclude list" of https sites is getting
> larger and larger - and includes Cloud providers the badguys are
> housing their malware on - which means our AV still can't catch it
> :-(
> 

MSIE 11 seems to be growing in popularity for some reason ;-)

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUMRvXAAoJELJo5wb/XPRjJIYIAJHx4z+EVNklXjSIqdmOuqeu
6ZHajLCDm/yGt6+JyLvJARNkVtfL2buiw4PbgLqJ+mHWpTFiU0Jvat3JX1vVPmMx
IgpgmMVTV185Rv12V3CrFFVNAfAgqVjgCgP5tYiJ6idAzOpLUaWfEHNzMtrCmg+s
/yNr9may7zbi8HxUw22Egjj565Dfp0eB3zGGGNiUunrQ9CkI/hBHtWAoMTKk6oFE
I923uzi6Kmmuidmw+9WFM38VsKHslspu3/celZT7uVj2QrqDYzrh7Li5dLbL42W3
/WcJu90PJngUkY9E2RFcJoq7cppFR6stnO9sytuSS1lhOCY4MRTUCrYrCy1y2YU=
=d/33
-----END PGP SIGNATURE-----


From rafael.akchurin at diladele.com  Sun Oct  5 10:49:28 2014
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Sun, 5 Oct 2014 10:49:28 +0000
Subject: [squid-users] transparent proxy https and self signed
 certificate error
In-Reply-To: <CADoG9xk43M6+ROrbhA6kL2TrC9_zrcOjUznz+zhLS7xphrZC_Q@mail.gmail.com>
Message-ID: <D056EE6D.7C5A%rafael.akchurin@diladele.com>

Hello Robert,

Just my two cents - if you remove or comment out the
  sslproxy_cert_error allow all
  sslproxy_flags DONT_VERIFY_PEER

from squid config - may it be that squid starts complaining - "cannot get cert issues locally" on the google sites?

Rafael.

From: Robert Watson <robert at gillecaluim.com<mailto:robert at gillecaluim.com>>
Date: Sunday 5 October 2014 02:29
To: "squid-users at lists.squid-cache.org<mailto:squid-users at lists.squid-cache.org>" <squid-users at lists.squid-cache.org<mailto:squid-users at lists.squid-cache.org>>
Subject: [squid-users] transparent proxy https and self signed certificate error

using squid 3.4.8, compiled from source with ./configure flags --enable-icap-client --enable-ssl --enable-ssl-crtd
configured iptables for transparent proxy (redirect 80 to 3128) and everything works fine

configured iptables for transparent proxy (redirect 443 to 3127) but can't get transparent proxy for https to work
my squid.conf
...
# Squid https port
https_port 3127 intercept ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB cert=/etc/squid/ssl_cert/XXX.pem
acl broken_sites dstdomain .example.com<http://example.com>
ssl_bump none localhost
ssl_bump none broken_sites
ssl_bump server-first all
sslproxy_cert_error allow all
sslproxy_flags DONT_VERIFY_PEER
sslcrtd_program /usr/lib/squid/ssl_crtd -s /var/lib/squid/ssl_db -M 4MB
sslcrtd_children 32 startup=5 idle=1

when visiting google (or any other https site) chrome complains
NET::ERR_CERT_AUTHORITY_INVALID
I tried using internet explorer as admin and imported the self signed certificate but that hasn't helped

can anyone please with how to debug this
thanks, Robert

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141005/3cb55eab/attachment.htm>

From doug1234 at digcorp.net  Sun Oct  5 14:11:24 2014
From: doug1234 at digcorp.net (Douglas Davenport)
Date: Sun, 5 Oct 2014 10:11:24 -0400
Subject: [squid-users] Best OS for latest squid
In-Reply-To: <5430C9B2.4070907@treenet.co.nz>
References: <CAOsHgttQvOwWML+5W-sSoYR23iBg9PZwCwH3d7NPQZOwM=CpJQ@mail.gmail.com>
 <5430C9B2.4070907@treenet.co.nz>
Message-ID: <CAOsHgttmw_mJOf+aZn_=v6h_UecasjCiGzJ53PMfn1315k6myA@mail.gmail.com>

Thanks! What is the recommendation on packages vs building from source?

On Sun, Oct 5, 2014 at 12:31 AM, Amos Jeffries <squid3 at treenet.co.nz> wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 5/10/2014 4:49 p.m., Douglas Davenport wrote:
> > I'm starting from scratch with an AWS based squid setup, I would
> > like to be able stay up to date with the latest squid releases to
> > have all the sslbump fixes. Can someone suggest what is best to
> > use, Centos 6, Ubuntu 14 or another distro? I see a lot of the
> > binary releases lag behind, does squid build easily on a particular
> > platform? Sorry if this question has been covered, I searched but
> > only found discussion about hardware specs. Thanks!
> >
>
> We currently do regular integration testing with successful results on
> Debian Sid, Ubuntu Precise & Saucy & Trusty, CentOS 6 & 7, FreeBSD 9.1
> & 10, OpenBSD 5.4, Fedora 19.
>
> Using GCC, clang, and ICC compilers where available.
>
> Other OS usually have good results as well with the exception of
> Windows and MacOS where SMP functionality used by Squid is missing or
> broken.
>
> FWIW: Old OS releases with older compilers generally work best with
> old Squid releases with matching level of compiler support. Not that
> such a situation is desirabe for use in todays Internet.
>
> NOTE: For tracking latest Squid in future you will want GCC 4.9+ or
> clang 3.4+ compilers. The Squid-3.4+ series build best performance
> optimizations with them and 3.6 series about to begin development will
> probably require C++11 at some point soon.
>
> Amos
>
> PS. personally I am a Debian "fanboi", with Ubuntu a close second.
> That comes down to package management tools and their multi-arch
> support though.
>
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2.0.22 (MingW32)
>
> iQEcBAEBAgAGBQJUMMmyAAoJELJo5wb/XPRjl6YIAKj+8puStnRkYgi9CkIxV8Kg
> xJbnVTuD2yKKbNr090KcDJ6IbJ1dxtZlc7PIZVu3l/pkQ01lACSo75Q6wdgo2+FS
> mydorgDOB9aDY9CZj24xvBlyZCUoLq/3mGf4ttMKp+QJ6lU5pKwrElw7dkKdmNs5
> djjF8/w8/tUEdWI+FBMJBsT9m+Wl1eLPZyFULU0hTRhAmMPV1Ms6sYXT8myjYvUR
> Ha20lSeQWNshSjHfKlkgX1BycpgSTOYvQ9BUK9U5beMHBWVvQUxI+A1WNcWINqXN
> f84ryIi+tyWHexweg3eKRWzh0+O/NVBtqIbXOJjGqVZxqzLuYjUoI4hNM23bAEc=
> =lbBe
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141005/9cab5c06/attachment.htm>

From eliezer at ngtech.co.il  Sun Oct  5 15:11:01 2014
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Sun, 05 Oct 2014 18:11:01 +0300
Subject: [squid-users] Best OS for latest squid
In-Reply-To: <CAOsHgttQvOwWML+5W-sSoYR23iBg9PZwCwH3d7NPQZOwM=CpJQ@mail.gmail.com>
References: <CAOsHgttQvOwWML+5W-sSoYR23iBg9PZwCwH3d7NPQZOwM=CpJQ@mail.gmail.com>
Message-ID: <54315F85.4000308@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hey Douglas,

CentOS 6 is a nice OS and I am releasing RPMs for it(now 3.4.8 out).
If you are using AWS they have a modified version of CentOS\RH which
they update and kind of support.

Self compiled for a cloud based machine to me seems a bit weird but
maybe sometimes can be effective.

The main issue is that no even one official release of ubuntu or
centos (maybe even debian) do not support\supply ssl-bump build.

I prefer ubutnu\debian for many things.
I was also working on a deb based build (for ubuntu) and now it's on
the alpha stages(not released yet)

I added a bug report for a specific issue with ssl-bump at:
http://bugs.squid-cache.org/show_bug.cgi?id=4115

There was also a recent memory-leak report for 3.4 which is being
investigated as we write.

Before you decide on a version I recommend you to plan the whole setup
and see how it should be better implemented and also test it deeply to
match your criteria.

All The Bests,
Eliezer

On 10/05/2014 06:49 AM, Douglas Davenport wrote:
> I'm starting from scratch with an AWS based squid setup, I would
> like to be able stay up to date with the latest squid releases to
> have all the sslbump fixes. Can someone suggest what is best to
> use, Centos 6, Ubuntu 14 or another distro? I see a lot of the
> binary releases lag behind, does squid build easily on a particular
> platform? Sorry if this question has been covered, I searched but
> only found discussion about hardware specs. Thanks!
> 
> 
> 
> _______________________________________________ squid-users mailing
> list squid-users at lists.squid-cache.org 
> http://lists.squid-cache.org/listinfo/squid-users
> 

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUMV+FAAoJENxnfXtQ8ZQUaeoH/R5tKdT3480W1ggRXHxXGA9N
PRRCLuMk0CwVVp8dBdqzvUdHcedvpGuEJIM7Wj11IglFVjtwhqnKlXztb9Ksn+J1
3n0wk4OrhjFhDIoHS8tK2Wa8vnGnQj0/0fq00vtROGQcdzsaQqeR0lXigxJ0OtB3
L1atMRc2pxfyrOBdXOHNAtAPCH/r1S3zK6fhTC12mxcsf/P8CM3h9CXwNLiSZlLZ
ejlDefPUF5J5zm1qFtW5+6jGvjLoFs7JYNI5Md/fRinFHTC8/vt2in4/W85isSg+
K4U3oTjEn1xIvuGes8UvitAUD+WitVDd4gpsFsO7Udwow2BpBmgWGtYTFFQbO44=
=3690
-----END PGP SIGNATURE-----


From jeg1972 at gmail.com  Sun Oct  5 15:35:56 2014
From: jeg1972 at gmail.com (John Gardner)
Date: Sun, 5 Oct 2014 16:35:56 +0100
Subject: [squid-users] RPM Packages
Message-ID: <CAFFsz+Lk7mS6oWphmcqTeQAg9ApXkY=XZAhM+9-PHDHUV_McfA@mail.gmail.com>

This question is probably specifically for Eliezer.

My question is this, On the RPM repository at
http://www1.ngtech.co.il/rpm/ There is an RPM package for version
3.4.5 for Oracle Linux 6.  I installed this a few months ago when I
was preparing to go live with a new Squid instance and now after all
of the testing is complete, I'd like to update to the latest RPM which
is only for CentOS 6.  Eliezer, can you tell me how much different is
the CentOS 6 build from the OEL 6 please?

Thanks and Regards

John
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141005/d4269abb/attachment.htm>

From eliezer at ngtech.co.il  Sun Oct  5 15:52:24 2014
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Sun, 05 Oct 2014 18:52:24 +0300
Subject: [squid-users] transparent proxy https and self signed
	certificate error
In-Reply-To: <54311BD7.2030605@treenet.co.nz>
References: <CADoG9xk43M6+ROrbhA6kL2TrC9_zrcOjUznz+zhLS7xphrZC_Q@mail.gmail.com>
 <5430DAC5.8030802@treenet.co.nz> <5430E57C.4030709@trimble.com>
 <54311BD7.2030605@treenet.co.nz>
Message-ID: <54316938.4050606@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 10/05/2014 01:22 PM, Amos Jeffries wrote:
> MSIE 11 seems to be growing in popularity for some reason ;-)
> 
> Amos

And Still there is:
http://bugs.squid-cache.org/show_bug.cgi?id=4115

For now I am using ssl_crtd of 3.4.5 for google ssl bump to work.

Eliezer
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUMWk4AAoJENxnfXtQ8ZQUWq4H/3f7taU+CyIxIMf9/itYdcF8
IxFyaYalAtEMsiqpslabtLOSKx1Mao9188JBSdt/6A2T+LhWFCZ1hrRHcOPRwMl6
sR5ZqBVBj0kxJc1wP/XfICcCv7OUZvYj7f0QLSLaOWcQfCO5YqdiIuZX6Pvo+zDT
EvJTpNd3NVDiss18UB1RL/hlGMidKLsq5WxgooFo8AXpyGI1aqzw9LMAWFYmY2x6
M19c/hR/dT0U0b+9JZMaqg6doOzx21UeZq+JVqqn06LV/WDUuoLKrI72A3gJlrGq
VHDcmIKNXGW+0zpihiNful+vUwYxS5lHVy3obgtsMeBFy8UgWaAr+C0/3oOoimA=
=wD9N
-----END PGP SIGNATURE-----


From eliezer at ngtech.co.il  Sun Oct  5 15:55:39 2014
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Sun, 05 Oct 2014 18:55:39 +0300
Subject: [squid-users] RPM Packages
In-Reply-To: <CAFFsz+Lk7mS6oWphmcqTeQAg9ApXkY=XZAhM+9-PHDHUV_McfA@mail.gmail.com>
References: <CAFFsz+Lk7mS6oWphmcqTeQAg9ApXkY=XZAhM+9-PHDHUV_McfA@mail.gmail.com>
Message-ID: <543169FB.7030205@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hey John,

OEL 6 and CentOS 6 are different enough to not be 100% compatible.
I cannot compare their DataBase but they are very similar so much that
almost none of their users will see the differences.

I would not recommend using 3.4.8 RPM for CentOS to be installed on OEL.

If you need an OEL build for 64 bit I might be able to kick a build
next week for the current version and if it will run smoothly I will
publish it.

Another option is that you can use the latest SRPM from the OEL or
CentOS and try to build squid from 0.

The options for changes are at the kernel and some basic packages such
as libltdl and maybe others.

It's also differ between the version of OEL which gets extra updates
using a paid account.

Eliezer


On 10/05/2014 06:35 PM, John Gardner wrote:
> This question is probably specifically for Eliezer.
> 
> My question is this, On the RPM repository at 
> http://www1.ngtech.co.il/rpm/ There is an RPM package for version 
> 3.4.5 for Oracle Linux 6.  I installed this a few months ago when
> I was preparing to go live with a new Squid instance and now after
> all of the testing is complete, I'd like to update to the latest
> RPM which is only for CentOS 6.  Eliezer, can you tell me how much
> different is the CentOS 6 build from the OEL 6 please?
> 
> Thanks and Regards
> 
> John
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUMWn7AAoJENxnfXtQ8ZQU2X4H/1WySubtM1joTry9ESBNNL2A
Zn7yyzT9l0GekM/hQAfjhz25AlgX+N+xako+Io9fXaHVRGL+TzyHI2MwSPd44sdT
1ydNT4KXkVPhwVGkRxKpG7QWuuvHBu51AXrbEFX2za1tHk2tvZ04i3kbowoUd8FS
ffMfiYkpNbRjeAfFJgiuLM7+IsJC8uJBF/eMGiv1zmf2hHkoIU3+qwQ2R7zLipI6
g5dEsqQtic3XjZNX5+daipBsjXkjaDlZ2BJnisBJnV46/FC2ajb1R/5/QrbXhmVS
R8t5HWWp+P9HsmL7cPKE7ZBBPJSgtYrb8TOgbpASUQ/EyDE6U/+37pMjut9aBiE=
=0txX
-----END PGP SIGNATURE-----


From rafael.akchurin at diladele.com  Sun Oct  5 16:23:14 2014
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Sun, 5 Oct 2014 16:23:14 +0000
Subject: [squid-users] Best OS for latest squid
In-Reply-To: <54315F85.4000308@ngtech.co.il>
References: <CAOsHgttQvOwWML+5W-sSoYR23iBg9PZwCwH3d7NPQZOwM=CpJQ@mail.gmail.com>
 <54315F85.4000308@ngtech.co.il>
Message-ID: <88c994945c0f40bd866f338198aa0737@AM3PR04MB450.eurprd04.prod.outlook.com>

Spam detection software, running on the system "master.squid-cache.org",
has identified this incoming email as possible spam.  The original
message has been attached to this so you can view it or label
similar future email.  If you have any questions, see
@@CONTACT_ADDRESS@@ for details.

Content preview:  Hello Eliezer and Douglas, I think the latest CentOS/RedHat
   7 has Squid 3.3.8 with SSL Bump options compiled. Unfortunately these are
   not good enough for Firefox but for IE, Safary and Chrome it works nicely
   out of the box. [...] 

Content analysis details:   (6.1 points, 5.0 required)

 pts rule name              description
---- ---------------------- --------------------------------------------------
 1.3 RCVD_IN_RP_RNBL        RBL: Relay in RNBL,
                            https://senderscore.org/blacklistlookup/
                            [83.81.36.147 listed in bl.score.senderscore.com]
 0.0 RCVD_IN_DNSWL_BLOCKED  RBL: ADMINISTRATOR NOTICE: The query to DNSWL
                            was blocked.  See
                            http://wiki.apache.org/spamassassin/DnsBlocklists#dnsbl-block
                             for more information.
                            [83.81.36.147 listed in list.dnswl.org]
 0.0 URIBL_BLOCKED          ADMINISTRATOR NOTICE: The query to URIBL was blocked.
                            See
                            http://wiki.apache.org/spamassassin/DnsBlocklists#dnsbl-block
                             for more information.
                            [URIs: squid-cache.org]
 3.6 RCVD_IN_PBL            RBL: Received via a relay in Spamhaus PBL
                            [83.81.36.147 listed in zen.spamhaus.org]
 1.3 RDNS_NONE              Delivered to internal network by a host with no rDNS
 0.0 UNPARSEABLE_RELAY      Informational: message has unparseable relay lines


-------------- next part --------------
An embedded message was scrubbed...
From: Rafael Akchurin <rafael.akchurin at diladele.com>
Subject: RE: [squid-users] Best OS for latest squid
Date: Sun, 5 Oct 2014 16:23:14 +0000
Size: 6794
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141005/f282a636/attachment.eml>

From jeg1972 at gmail.com  Sun Oct  5 16:36:28 2014
From: jeg1972 at gmail.com (John Gardner)
Date: Sun, 5 Oct 2014 17:36:28 +0100
Subject: [squid-users] RPM Packages
In-Reply-To: <543169FB.7030205@ngtech.co.il>
References: <CAFFsz+Lk7mS6oWphmcqTeQAg9ApXkY=XZAhM+9-PHDHUV_McfA@mail.gmail.com>
 <543169FB.7030205@ngtech.co.il>
Message-ID: <CAFFsz+LqgrPnTW77SaUF15bLd4aOjcfUxPyq7f_fWH3YVeGNVA@mail.gmail.com>

Eliezer

It would be be great if you could manage to do a build 64bit OEL 6 build
this week, but I understand you will be under great time pressure, so I
will also try and perform a build from the SRPM this week also... However I
don't think I've ever successfully made a build from an SRPM before, so
wish me luck!

Also, I've just contributed to the fund to help you all get back up and
running from the server issues you guys have been having.

Thanks again!

John
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hey John,

OEL 6 and CentOS 6 are different enough to not be 100% compatible.
I cannot compare their DataBase but they are very similar so much that
almost none of their users will see the differences.

I would not recommend using 3.4.8 RPM for CentOS to be installed on OEL.

If you need an OEL build for 64 bit I might be able to kick a build
next week for the current version and if it will run smoothly I will
publish it.

Another option is that you can use the latest SRPM from the OEL or
CentOS and try to build squid from 0.

The options for changes are at the kernel and some basic packages such
as libltdl and maybe others.

It's also differ between the version of OEL which gets extra updates
using a paid account.

Eliezer


On 10/05/2014 06:35 PM, John Gardner wrote:
> This question is probably specifically for Eliezer.
>
> My question is this, On the RPM repository at
> http://www1.ngtech.co.il/rpm/ There is an RPM package for version
> 3.4.5 for Oracle Linux 6.  I installed this a few months ago when
> I was preparing to go live with a new Squid instance and now after
> all of the testing is complete, I'd like to update to the latest
> RPM which is only for CentOS 6.  Eliezer, can you tell me how much
> different is the CentOS 6 build from the OEL 6 please?
>
> Thanks and Regards
>
> John
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUMWn7AAoJENxnfXtQ8ZQU2X4H/1WySubtM1joTry9ESBNNL2A
Zn7yyzT9l0GekM/hQAfjhz25AlgX+N+xako+Io9fXaHVRGL+TzyHI2MwSPd44sdT
1ydNT4KXkVPhwVGkRxKpG7QWuuvHBu51AXrbEFX2za1tHk2tvZ04i3kbowoUd8FS
ffMfiYkpNbRjeAfFJgiuLM7+IsJC8uJBF/eMGiv1zmf2hHkoIU3+qwQ2R7zLipI6
g5dEsqQtic3XjZNX5+daipBsjXkjaDlZ2BJnisBJnV46/FC2ajb1R/5/QrbXhmVS
R8t5HWWp+P9HsmL7cPKE7ZBBPJSgtYrb8TOgbpASUQ/EyDE6U/+37pMjut9aBiE=
=0txX
-----END PGP SIGNATURE-----
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141005/ee94c463/attachment.htm>

From ricardo.carrillo.cruz at gmail.com  Sun Oct  5 17:00:46 2014
From: ricardo.carrillo.cruz at gmail.com (Ricardo Carrillo Cruz)
Date: Sun, 5 Oct 2014 19:00:46 +0200
Subject: [squid-users] Encapsulating proxy requests thru a proxy
Message-ID: <CADe0dKD4NXPcj6AQqpCB5739fDPPOrp7d5zJnTJ-fS7FvgUC3A@mail.gmail.com>

Hi guys

I have a need to encapsulate proxy requests thru a proxy, like the
ProxyRemote directive in Apache mod_proxy:

http://httpd.apache.org/docs/2.4/mod/mod_proxy.html#proxyremote
http://www.xinotes.net/notes/note/980/

As I'm familiar with Squid, I'd like to have that same Apache functionality
on my Squid proxy.

Can anyone please give me any pointers?

Regards
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141005/a14e9acd/attachment.htm>

From squid3 at treenet.co.nz  Sun Oct  5 19:24:39 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 06 Oct 2014 08:24:39 +1300
Subject: [squid-users] Encapsulating proxy requests thru a proxy
In-Reply-To: <CADe0dKD4NXPcj6AQqpCB5739fDPPOrp7d5zJnTJ-fS7FvgUC3A@mail.gmail.com>
References: <CADe0dKD4NXPcj6AQqpCB5739fDPPOrp7d5zJnTJ-fS7FvgUC3A@mail.gmail.com>
Message-ID: <54319AF7.3050108@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 6/10/2014 6:00 a.m., Ricardo Carrillo Cruz wrote:
> Hi guys
> 
> I have a need to encapsulate proxy requests thru a proxy, like the
>  ProxyRemote directive in Apache mod_proxy:
> 
> http://httpd.apache.org/docs/2.4/mod/mod_proxy.html#proxyremote 
> http://www.xinotes.net/notes/note/980/
> 
> As I'm familiar with Squid, I'd like to have that same Apache 
> functionality on my Squid proxy.
> 
> Can anyone please give me any pointers?

That Apache directive is a copy of Squid's cache_peer directive.

You configure cache_peer with the domain name or IP address of the
peer proxy and its HTTP receiving port. Then use cache_peer_access to
control what traffic gets sent there.


 http://www.squid-cache.org/Doc/config/cache_peer/
 http://www.squid-cache.org/Doc/config/cache_peer_access/

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.13 (MingW32)

iQEcBAEBAgAGBQJUMZr3AAoJELJo5wb/XPRj+NsIAMUxT+pJt4SCBGkpP0ywRFIK
wcIefGvUmpdtZJAjF6m7u5VCD3fJkpEhMnh2yM5MNmdM7IjWxy9taLmyLNt8ODe2
T++17+XWHxxulIQoyPelnpq8vEYdZ93JfB7h5fx+Q/bMtq3wmc8PVuJSd4sMLOMw
w5XOdobvF8Q5MfoKORMXrtzlyEzJTWcBfh05jU25BiqUeSTvAhHek/nCkDd81w6R
8aTeJHg+RUac/UpyzmQ4qS9LQZ978vcBSMp9yS+ex8FYArIcEe35hIZPjuQKB8If
S3YqpbGx4TSy80T1LL1skReibpPWPURP3zmGtJtVYa1mJEXHmgKau076v+GSSKU=
=JONK
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Sun Oct  5 19:26:17 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 06 Oct 2014 08:26:17 +1300
Subject: [squid-users] RPM Packages
In-Reply-To: <CAFFsz+LqgrPnTW77SaUF15bLd4aOjcfUxPyq7f_fWH3YVeGNVA@mail.gmail.com>
References: <CAFFsz+Lk7mS6oWphmcqTeQAg9ApXkY=XZAhM+9-PHDHUV_McfA@mail.gmail.com>
 <543169FB.7030205@ngtech.co.il>
 <CAFFsz+LqgrPnTW77SaUF15bLd4aOjcfUxPyq7f_fWH3YVeGNVA@mail.gmail.com>
Message-ID: <54319B59.6090205@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 6/10/2014 5:36 a.m., John Gardner wrote:
> Eliezer
> 
> It would be be great if you could manage to do a build 64bit OEL 6
> build this week, but I understand you will be under great time
> pressure, so I will also try and perform a build from the SRPM this
> week also... However I don't think I've ever successfully made a
> build from an SRPM before, so wish me luck!
> 
> Also, I've just contributed to the fund to help you all get back up
> and running from the server issues you guys have been having.
> 

Thank you very much. It is greatly appreciated.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.13 (MingW32)

iQEcBAEBAgAGBQJUMZtZAAoJELJo5wb/XPRj0REH/2FmlEwcJqUKNT2FxTUo1AdU
ikSilZ/ujc8N94UTWqLesdxAlGyAgiYFPZgaq635356FfVbrh1Ycuna7Oa+dc6fT
WJlCTeVmALGBzd5bz0VvEvF9URrX2cKuO18hN1nZeQiQvRlJVxvgXpkkQSHtn2FU
nWwwkWDEoIfnc7S0oTywo3pODq9QcEg8Iov9KmSV/KyawxQUMhyMXgD8Gw7TMdFc
LDcuesoZdhlFvXz1mHAy3/yjoKQrCOWvPECvkwZc7ggVHJwCbKXYJBRfqFXVvZmz
udsEtdvyLRPXML68u9Ywf30PlA+oNXKErCCrjSU+6g/sz3fgAwLHUQLl8E9IIEU=
=UzwL
-----END PGP SIGNATURE-----


From eliezer at ngtech.co.il  Sun Oct  5 19:38:25 2014
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Sun, 05 Oct 2014 22:38:25 +0300
Subject: [squid-users] Best OS for latest squid
In-Reply-To: <88c994945c0f40bd866f338198aa0737@AM3PR04MB450.eurprd04.prod.outlook.com>
References: <CAOsHgttQvOwWML+5W-sSoYR23iBg9PZwCwH3d7NPQZOwM=CpJQ@mail.gmail.com>
 <54315F85.4000308@ngtech.co.il>
 <88c994945c0f40bd866f338198aa0737@AM3PR04MB450.eurprd04.prod.outlook.com>
Message-ID: <54319E31.6040207@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hey Rafael,

You can install it from epel but the core+sslbump doesn't require that.
Only the helpers package.

Take a look in the wiki about centos it has the information about it.

Eliezer

On 10/05/2014 07:23 PM, Rafael Akchurin wrote:
> Hello Eliezer and Douglas,
> 
> I think the latest CentOS/RedHat 7 has Squid 3.3.8 with SSL Bump
> options compiled. Unfortunately these are not good enough for
> Firefox but for IE, Safary and Chrome it works nicely out of the
> box.
> 
> @ Eliezer - the CentOS 6 minimal installation does not allow to
> install your RPMs - says the Perl module for
> perl-Crypt-OpenSSL-X509 is required and it is *not available* in
> the default CentOS repos. Could you please help with where I can
> install this perl module from?
> 
> Best regards, Rafael

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUMZ4xAAoJENxnfXtQ8ZQU+LUH/j06CFcUIQIAic7Ve3OMQw4p
QRNVLssDu5fmuVFFsRX3sRIsxJ0usVfRXwP6l7kCNbcF2AjL5MCFWQ0vPpjQsJMG
88EYsod6wJYL2JWTq2KfgYPvnzj6FImhVVzkbAmQJfRlisk7+xr9yPdrGw9ddf9Z
Y30dIxauayxWgF0VGMo+2vElO5vo7cvxvUFI2sbGhW1DotFfryDaMf8Cher+7NFw
XrusHD5XaFm8hNgDyOTzdyoSeudKCBgVHJDIT9Bybe2fUE6hGitjiE0YdLtMJMzO
Sf3jCcDMZ3vwkGyyDwXW912AC2+fjtacvZuWJ5yBPx94LhGmVJ6R83fRp9xpCcM=
=kswc
-----END PGP SIGNATURE-----


From robert at gillecaluim.com  Mon Oct  6 03:24:27 2014
From: robert at gillecaluim.com (Robert Watson)
Date: Sun, 5 Oct 2014 20:24:27 -0700
Subject: [squid-users] transparent proxy https and self signed
	certificate error
In-Reply-To: <54316938.4050606@ngtech.co.il>
References: <CADoG9xk43M6+ROrbhA6kL2TrC9_zrcOjUznz+zhLS7xphrZC_Q@mail.gmail.com>
 <5430DAC5.8030802@treenet.co.nz> <5430E57C.4030709@trimble.com>
 <54311BD7.2030605@treenet.co.nz> <54316938.4050606@ngtech.co.il>
Message-ID: <CADoG9xngTuun9wZj2DuuVvVC_kwW=-FWHj2EZat3G497JLeFWA@mail.gmail.com>

still trying to get this working.  To eliminate the self signed certificate
issue, I got a official signed certificate from Starfield Tech. LLC.
They've sent two certifcates but I'm unsure how to use these certificates
since the ssl_bump parameters only have one certificate as a parameter

On Sun, Oct 5, 2014 at 8:52 AM, Eliezer Croitoru <eliezer at ngtech.co.il>
wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 10/05/2014 01:22 PM, Amos Jeffries wrote:
> > MSIE 11 seems to be growing in popularity for some reason ;-)
> >
> > Amos
>
> And Still there is:
> http://bugs.squid-cache.org/show_bug.cgi?id=4115
>
> For now I am using ssl_crtd of 3.4.5 for google ssl bump to work.
>
> Eliezer
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1
>
> iQEcBAEBAgAGBQJUMWk4AAoJENxnfXtQ8ZQUWq4H/3f7taU+CyIxIMf9/itYdcF8
> IxFyaYalAtEMsiqpslabtLOSKx1Mao9188JBSdt/6A2T+LhWFCZ1hrRHcOPRwMl6
> sR5ZqBVBj0kxJc1wP/XfICcCv7OUZvYj7f0QLSLaOWcQfCO5YqdiIuZX6Pvo+zDT
> EvJTpNd3NVDiss18UB1RL/hlGMidKLsq5WxgooFo8AXpyGI1aqzw9LMAWFYmY2x6
> M19c/hR/dT0U0b+9JZMaqg6doOzx21UeZq+JVqqn06LV/WDUuoLKrI72A3gJlrGq
> VHDcmIKNXGW+0zpihiNful+vUwYxS5lHVy3obgtsMeBFy8UgWaAr+C0/3oOoimA=
> =wD9N
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141005/cfb08848/attachment.htm>

From sudakov at sibptus.tomsk.ru  Mon Oct  6 04:07:25 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Mon, 6 Oct 2014 11:07:25 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
Message-ID: <20141006040725.GA31642@admin.sibptus.tomsk.ru>

Rafael Akchurin wrote:
> I believe I do (but you made me doubt:)
> 

Well, I have tried negotiate_kerberos_auth with Firefox (Windows) and
they don't work together. I am attaching a packet dump which boils
down basically to the following:

1. proxy.sibptus.transneft.ru:3131 is configured in Firefox (new clean
profile) as a proxy server for all protocols.

2. Firefox receives an "HTTP/1.1 407 Proxy Authentication Required"
with the "Proxy-Authenticate: Negotiate" header.

3. A Kerberos ticket is requested by the Windows host from the domain
controller for 'df at SIBPTUS' or some such odd principal instead of
something like 'HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU'. 

4. The domain controller predictably responds with 'PRINCIPAL UNKNOWN'
and proxy authentication fails.

WTF is 'df at SIBPTUS' I have not the slightest idea.

Any suggestions are welcome.

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-------------- next part --------------
A non-text attachment was scrubbed...
Name: r.pcap.gz
Type: application/gzip
Size: 16426 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141006/70904567/attachment.gz>

From sudakov at sibptus.tomsk.ru  Mon Oct  6 04:09:01 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Mon, 6 Oct 2014 11:09:01 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <20141006025233.GA29293@admin.sibptus.tomsk.ru>
References: <20141006025233.GA29293@admin.sibptus.tomsk.ru>
Message-ID: <20141006040901.GB31642@admin.sibptus.tomsk.ru>

And before I forget and before somebody asks. In Firefox:

network.negotiate-auth.allow-proxies=true
network.negotiate-auth.gsslib=""
network.negotiate-auth.using-native-gsslib=true

Victor Sudakov wrote:
> Rafael Akchurin wrote:
> > I believe I do (but you made me doubt:)
> > 
> 
> Well, I have tried negotiate_kerberos_auth with Firefox (Windows) and
> they don't work together. I am attaching a packet dump which boils
> down basically to the following:
> 
> 1. proxy.sibptus.transneft.ru:3131 is configured in Firefox (new clean
> profile) as a proxy server for all protocols.
> 
> 2. Firefox receives an "HTTP/1.1 407 Proxy Authentication Required"
> with the "Proxy-Authenticate: Negotiate" header.
> 
> 3. A Kerberos ticket is requested by the Windows host from the domain
> controller for 'df at SIBPTUS' or some such odd principal instead of
> something like 'HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU'. 
> 
> 4. The domain controller predictably responds with 'PRINCIPAL UNKNOWN'
> and proxy authentication fails.
> 
> WTF is 'df at SIBPTUS' I have not the slightest idea.
> 
> Any suggestions are welcome.
> 
> -- 
> Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
> sip:sudakov at sibptus.tomsk.ru



-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru


From sudakov at sibptus.tomsk.ru  Mon Oct  6 05:23:46 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Mon, 6 Oct 2014 12:23:46 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <20141006040725.GA31642@admin.sibptus.tomsk.ru>
References: <20141006040725.GA31642@admin.sibptus.tomsk.ru>
Message-ID: <20141006052346.GA32369@admin.sibptus.tomsk.ru>

Victor Sudakov wrote:
> Rafael Akchurin wrote:
> > I believe I do (but you made me doubt:)
> > 
> 
> Well, I have tried negotiate_kerberos_auth with Firefox (Windows) 

I have tried the same with MSIE 8 (Windows).

It's obviously trying to do NTLM instead of Kerberos (see below). How
do I enable Kerberos proxy auth in MSIE? Is there a registry setting
or what?

Log:

negotiate_kerberos_auth.cc(258): pid=81563 :2014/10/06 11:46:33| negotiate_kerberos_auth: DEBUG: Got 'YR TlRMTVNTUAABAAAAB4IIogAAAAAAAAAAAAAAAAAAAAAFASgKAAAADw==' from squid (length: 59).
negotiate_kerberos_auth.cc(311): pid=81563 :2014/10/06 11:46:33| negotiate_kerberos_auth: DEBUG: Decode 'TlRMTVNTUAABAAAAB4IIogAAAAAAAAAAAAAAAAAAAAAFASgKAAAADw==' (decoded length: 40).
negotiate_kerberos_auth.cc(321): pid=81563 :2014/10/06 11:46:33| negotiate_kerberos_auth: WARNING: received type 1 NTLM token
2014/10/06 11:46:33 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: received type 1 NTLM token; }}

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru


From squid3 at treenet.co.nz  Mon Oct  6 07:39:50 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 06 Oct 2014 20:39:50 +1300
Subject: [squid-users] transparent proxy https and self signed
 certificate error
In-Reply-To: <CADoG9xngTuun9wZj2DuuVvVC_kwW=-FWHj2EZat3G497JLeFWA@mail.gmail.com>
References: <CADoG9xk43M6+ROrbhA6kL2TrC9_zrcOjUznz+zhLS7xphrZC_Q@mail.gmail.com>
 <5430DAC5.8030802@treenet.co.nz> <5430E57C.4030709@trimble.com>
 <54311BD7.2030605@treenet.co.nz> <54316938.4050606@ngtech.co.il>
 <CADoG9xngTuun9wZj2DuuVvVC_kwW=-FWHj2EZat3G497JLeFWA@mail.gmail.com>
Message-ID: <54324746.50306@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 6/10/2014 4:24 p.m., Robert Watson wrote:
> still trying to get this working.  To eliminate the self signed
> certificate issue, I got a official signed certificate from
> Starfield Tech. LLC. They've sent two certifcates but I'm unsure
> how to use these certificates since the ssl_bump parameters only
> have one certificate as a parameter

The CA is very unlikely to be issuing you certificates capable of use
in Squid in the way intended. It is illegal for a trusted root CA to
do so in the country they are registered. Besides that it is downright
foolish for them to give up their trust reputation. Look at what
happened to DigiNotar.

The point of self-signed is that _your Squid_ is the root CA signer.

The ssl-bump feature in current Squid makes parameter cert= take the
self-signed CA certificate in PEM format. Squid generates the rest of
the certificte chain as necessary.

> 
> On Sun, Oct 5, 2014 at 8:52 AM, Eliezer Croitoru wrote:
> 
> On 10/05/2014 01:22 PM, Amos Jeffries wrote:
>>>> MSIE 11 seems to be growing in popularity for some reason
>>>> ;-)
>>>> 
>>>> Amos
> 
> And Still there is: 
> http://bugs.squid-cache.org/show_bug.cgi?id=4115
> 
> For now I am using ssl_crtd of 3.4.5 for google ssl bump to work.
> 
> Eliezer

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUMkdGAAoJELJo5wb/XPRjygMH/Rk0EYwCgluL1YCWNa8cTZHN
RkPNY1fTbe7U0ioB7J69KTJ07XH8sy0w9bChB5s/siodi3WD8ogZ3VdtEYxcqjf1
9yhb771Il3IiVaAiuF62FHWTEHjwHwTcBVR7/cDxigPW2VuSyyhZsdA8ayl1ZUXO
jW44IH5g0Sja7KVJAfS67AANG4Sp4vMh1rGdXpbP8Bq8QGposL3viGh51z3k6/OP
Dok8oVIsIluICLc8sLAKJbJwaBYSh0SLBrnNUv0Yl6+MtAFNfViXJGa3OfRG5ucQ
aTS9Be4vzJthVdV1+tTtqubCvjrYB7PqQcfL9VzA4UlvQovgPDAnVMO074Kyjug=
=k3K8
-----END PGP SIGNATURE-----


From omidkosari at yahoo.com  Mon Oct  6 08:01:04 2014
From: omidkosari at yahoo.com (Omid Kosari)
Date: Mon, 6 Oct 2014 01:01:04 -0700 (PDT)
Subject: [squid-users] High cpu usage by re_search_internal
In-Reply-To: <54301105.5040304@treenet.co.nz>
References: <1411987273071-4667550.post@n4.nabble.com>
 <1412424298423-4667655.post@n4.nabble.com> <542FF5B0.1050802@treenet.co.nz>
 <1412431494708-4667657.post@n4.nabble.com>
 <1412433252992-4667658.post@n4.nabble.com> <54300E4F.3050203@treenet.co.nz>
 <54301105.5040304@treenet.co.nz>
Message-ID: <1412582464232-4667689.post@n4.nabble.com>

Dear Amos

What's your idea about Marcus comment ?



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/High-cpu-usage-by-re-search-internal-tp4667550p4667689.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From omidkosari at yahoo.com  Mon Oct  6 08:10:32 2014
From: omidkosari at yahoo.com (Omid Kosari)
Date: Mon, 6 Oct 2014 01:10:32 -0700 (PDT)
Subject: [squid-users] Best OS for latest squid
In-Reply-To: <54315F85.4000308@ngtech.co.il>
References: <CAOsHgttQvOwWML+5W-sSoYR23iBg9PZwCwH3d7NPQZOwM=CpJQ@mail.gmail.com>
 <54315F85.4000308@ngtech.co.il>
Message-ID: <1412583032851-4667690.post@n4.nabble.com>

Eliezer Croitoru-2 wrote
> I was also working on a deb based build (for ubuntu) and now it's on
> the alpha stages(not released yet)

I am really happy and excited to find that . You will be added to my HEROs
list ;)



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Best-OS-for-latest-squid-tp4667666p4667690.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From ahmed.zaeem at netstream.ps  Mon Oct  6 08:22:33 2014
From: ahmed.zaeem at netstream.ps (Ahmed Allzaeem)
Date: Mon, 6 Oct 2014 01:22:33 -0700
Subject: [squid-users] need to implement Large rock on squid ,
	but i need a squid3.head version dont hang !
Message-ID: <000001cfe13e$af4a5560$0ddf0020$@netstream.ps>

Hi Guys , 

Im trying to use squid3.head  to get benefit of large rock.

I tried many times but I find that squid get hang after sometime.

 

I just need someone who tried large rock on smp and want from him the squid
3.head version and squid.conf he used if possible.

 

Appreciate ur help

regards

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141006/cd1bbc56/attachment.htm>

From sudakov at sibptus.tomsk.ru  Mon Oct  6 08:24:52 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Mon, 6 Oct 2014 15:24:52 +0700
Subject: [squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth
	broken?)
Message-ID: <20141006082452.GA36136@admin.sibptus.tomsk.ru>

Colleagues,

The NTLM (LM) plugin in squid27 worked perfectly while the NTLM plugin in
squid34 is obviously broken.

I am attaching two log files, one of the old plugin and the other of
the new one. Could someone please have a look at bad-ntlm.log to see
why ntlm_smb_lm_auth does not work any more after upgrading to 34? 

What does this failure 

ntlmssp: bad ascii: ffffffab
No auth at all. Returning no-auth
ntlm_smb_lm_auth.cc(531): pid=16346 :sending 'NA Logon Failure' to squid

actually mean?

I know that LM is bad and insecure, but I cannot give it up for the
present in the production environment until I make Kerberos
(negotiate) work.

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ntlm_log.zip
Type: application/zip
Size: 4464 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141006/f760dc13/attachment.zip>

From gkinkie at gmail.com  Mon Oct  6 08:30:15 2014
From: gkinkie at gmail.com (Kinkie)
Date: Mon, 6 Oct 2014 10:30:15 +0200
Subject: [squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth
	broken?)
In-Reply-To: <20141006082452.GA36136@admin.sibptus.tomsk.ru>
References: <20141006082452.GA36136@admin.sibptus.tomsk.ru>
Message-ID: <CA+Y8hcOzqQS0Aynctc_FgZDtrN+1XKYZG9FSGM0Qw2XSKYuucA@mail.gmail.com>

Hi,


On Mon, Oct 6, 2014 at 10:24 AM, Victor Sudakov
<sudakov at sibptus.tomsk.ru> wrote:
> Colleagues,
>
> The NTLM (LM) plugin in squid27 worked perfectly while the NTLM plugin in
> squid34 is obviously broken.
>
> I am attaching two log files, one of the old plugin and the other of
> the new one. Could someone please have a look at bad-ntlm.log to see
> why ntlm_smb_lm_auth does not work any more after upgrading to 34?
>
> What does this failure
>
> ntlmssp: bad ascii: ffffffab
> No auth at all. Returning no-auth
> ntlm_smb_lm_auth.cc(531): pid=16346 :sending 'NA Logon Failure' to squid
>
> actually mean?
>
> I know that LM is bad and insecure, but I cannot give it up for the
> present in the production environment until I make Kerberos
> (negotiate) work.
>
> --
> Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
> sip:sudakov at sibptus.tomsk.ru
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>



-- 
    Francesco


From gkinkie at gmail.com  Mon Oct  6 08:30:47 2014
From: gkinkie at gmail.com (Kinkie)
Date: Mon, 6 Oct 2014 10:30:47 +0200
Subject: [squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth
	broken?)
In-Reply-To: <20141006082452.GA36136@admin.sibptus.tomsk.ru>
References: <20141006082452.GA36136@admin.sibptus.tomsk.ru>
Message-ID: <CA+Y8hcNA9Pp02GTi24JYxuhvfTpDXPmWdx5nOawBwxgo56BKxg@mail.gmail.com>

Whoops, sorry for the empty message.
This seems like a broken client. Can you check whether the client
sending that was a legitimate one?

On Mon, Oct 6, 2014 at 10:24 AM, Victor Sudakov
<sudakov at sibptus.tomsk.ru> wrote:
> Colleagues,
>
> The NTLM (LM) plugin in squid27 worked perfectly while the NTLM plugin in
> squid34 is obviously broken.
>
> I am attaching two log files, one of the old plugin and the other of
> the new one. Could someone please have a look at bad-ntlm.log to see
> why ntlm_smb_lm_auth does not work any more after upgrading to 34?
>
> What does this failure
>
> ntlmssp: bad ascii: ffffffab
> No auth at all. Returning no-auth
> ntlm_smb_lm_auth.cc(531): pid=16346 :sending 'NA Logon Failure' to squid
>
> actually mean?
>
> I know that LM is bad and insecure, but I cannot give it up for the
> present in the production environment until I make Kerberos
> (negotiate) work.
>
> --
> Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
> sip:sudakov at sibptus.tomsk.ru
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>



-- 
    Francesco


From squid3 at treenet.co.nz  Mon Oct  6 08:34:01 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 06 Oct 2014 21:34:01 +1300
Subject: [squid-users] High cpu usage by re_search_internal
In-Reply-To: <1412582464232-4667689.post@n4.nabble.com>
References: <1411987273071-4667550.post@n4.nabble.com>
 <1412424298423-4667655.post@n4.nabble.com> <542FF5B0.1050802@treenet.co.nz>
 <1412431494708-4667657.post@n4.nabble.com>
 <1412433252992-4667658.post@n4.nabble.com> <54300E4F.3050203@treenet.co.nz>
 <54301105.5040304@treenet.co.nz> <1412582464232-4667689.post@n4.nabble.com>
Message-ID: <543253F9.8040708@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 6/10/2014 9:01 p.m., Omid Kosari wrote:
> Dear Amos
> 
> What's your idea about Marcus comment ?
> 

It was a new solution to me.

I think I understand the details behind it (unicode charset size) and
agree it is worth doing if you can.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUMlP4AAoJELJo5wb/XPRjIfUIALTGITEnaUP1jV1rbaO8yEO0
5au2RccQaF+ObU/ptTrVmBS1ejMpSJP2AAIcOzh1rEs5V1Nz7tby9Xededvkq0re
ozId+UvBcxBViVOKqDOX+sCGgEN59Et8Ycl2VQ78aGYTD1o5At6qAialdUFhQUV3
+jKu1GNQS9/cZiDmgBpqC4SEhycTxsCffBkQx7PaoZTzkR4cZXrOffL9XL81foCf
KdVPvB6YWi0s8Bu0WtTvEjcYAmoZzwtNJDjuPIhUtxJtoCr9ybfAduYB8Pdt9X1K
NDmzXIpVn7zBBDLE4h/jFx32+SYzLX0FTl5TNPObT1qf5iQ8UQ8SUReVPmEsE/A=
=BkSi
-----END PGP SIGNATURE-----


From steve at opendium.com  Mon Oct  6 08:42:24 2014
From: steve at opendium.com (Steve Hill)
Date: Mon, 06 Oct 2014 09:42:24 +0100
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <542BF9A2.4070208@treenet.co.nz>
References: <20140928062806.GA34166@admin.sibptus.tomsk.ru>
 <5427B9EC.6060500@ngtech.co.il> <5429209D.1050909@opendium.com>
 <542BED72.7080305@opendium.com> <542BF144.3010702@labs.it>
 <542BF9A2.4070208@treenet.co.nz>
Message-ID: <543255F0.8030708@opendium.com>

On 01.10.14 13:54, Amos Jeffries wrote:

>> I recently opened a bug about this, that I will update now:
>>
>> http://bugs.squid-cache.org/show_bug.cgi?id=4088
>
> Thank you for the reminder. I will start work on this next.

I'm afraid the patch you added to that bug report doesn't work for me 
(in fact, it makes things worse).  I've updated the ticket with details.


-- 
  - Steve


From sudakov at sibptus.tomsk.ru  Mon Oct  6 09:08:44 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Mon, 6 Oct 2014 16:08:44 +0700
Subject: [squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth
 broken?)
In-Reply-To: <CA+Y8hcNA9Pp02GTi24JYxuhvfTpDXPmWdx5nOawBwxgo56BKxg@mail.gmail.com>
References: <20141006082452.GA36136@admin.sibptus.tomsk.ru>
 <CA+Y8hcNA9Pp02GTi24JYxuhvfTpDXPmWdx5nOawBwxgo56BKxg@mail.gmail.com>
Message-ID: <20141006090844.GA36954@admin.sibptus.tomsk.ru>

Francesco,

What do you mean by "client"? Absolutely everything in this lab setup
is the same, including the browser.

The only difference is the ntlm plugin binary (ntlm_auth taken from
the old squid and ntlm_smb_lm_auth from the new one).

In fact, I replaced the binary and restarted squid.

Kinkie wrote:
> Whoops, sorry for the empty message.
> This seems like a broken client. Can you check whether the client
> sending that was a legitimate one?
> 
> On Mon, Oct 6, 2014 at 10:24 AM, Victor Sudakov
> <sudakov at sibptus.tomsk.ru> wrote:
> > Colleagues,
> >
> > The NTLM (LM) plugin in squid27 worked perfectly while the NTLM plugin in
> > squid34 is obviously broken.
> >
> > I am attaching two log files, one of the old plugin and the other of
> > the new one. Could someone please have a look at bad-ntlm.log to see
> > why ntlm_smb_lm_auth does not work any more after upgrading to 34?
> >
> > What does this failure
> >
> > ntlmssp: bad ascii: ffffffab
> > No auth at all. Returning no-auth
> > ntlm_smb_lm_auth.cc(531): pid=16346 :sending 'NA Logon Failure' to squid
> >
> > actually mean?
> >
> > I know that LM is bad and insecure, but I cannot give it up for the
> > present in the production environment until I make Kerberos
> > (negotiate) work.
> >
> > --
> > Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
> > sip:sudakov at sibptus.tomsk.ru
> >
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
> >
> 
> 
> 
> -- 
>     Francesco

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru


From tomtux007 at gmail.com  Mon Oct  6 09:59:14 2014
From: tomtux007 at gmail.com (Tom Tom)
Date: Mon, 6 Oct 2014 11:59:14 +0200
Subject: [squid-users] TCP_DENIED/403 after Upgrading from 3.4.4 to 3.4.7
	(ssl_bump enabled)
Message-ID: <CACLJR+M4J_zUyQM-i_1jQ-MknxSTz8ZsjadLAyNOpjbTdUCJbg@mail.gmail.com>

Hi

After upgrading squid 3.4.4 to 3.4.7 (64Bit, self-compiled, the same
configure-options, the same config-file, ssl_bump with "ssl_bump
server-first all" enabled), I'm no more able to access bumped
https-sites because of a TCP_DENIED/403.


#---------------------- relevant parts of squid.conf ----------------------#
auth_param negotiate program /usr/local/squid/libexec/
negotiate_kerberos_auth
auth_param negotiate children 50 startup=10 idle=5
auth_param negotiate keep_alive on
acl AUTHENTICATED proxy_auth REQUIRED

external_acl_type SQUID_KERB_LDAP ttl=7200 children-max=50
children-startup=20 children-idle=5 negative_ttl=7200 %LOGIN
/usr/local/squid/libexec/ext_kerberos_ldap_group_acl -g "Internet
Users"
acl INTERNET_ACCESS external SQUID_KERB_LDAP
acl DENY_USERS_LOCAL proxy_auth_regex -i "/etc/squid/DENY_USERS_LOCAL"
...
...
http_access deny DENY_USERS_LOCAL all
http_access deny !INTERNET_ACCESS all
http_access deny !AUTHENTICATED all
http_access allow INTERNET_ACCESS AUTHENTICATED
http_access deny all
#---------------------- relevant parts of squid.conf ----------------------#

The meaning of the "DENY_USERS_LOCAL"-file is to insert all users (by
AD-username), which shouldn't have internet-access. In squid 3.4.4, I
had no restrictions with this directive. After upgrading to 3.4.7 (the
same config as in 3.4.4), I always catch a TCP_DENIED/403. The
cache.log with debug actived looks like this:

#---------------------- cache.log ----------------------#
2014/09/09 14:35:24.539 kid2| Acl.cc(177) matches: checked: http_access#4 = 0
2014/09/09 14:35:24.540 kid2| Acl.cc(157) matches: checking http_access#5
2014/09/09 14:35:24.540 kid2| Acl.cc(157) matches: checking DENY_USERS_LOCAL
2014/09/09 14:35:24.540 kid2| Acl.cc(28) AuthenticateAcl: SslBumped
request: It is an  encapsulated request do not authenticate
2014/09/09 14:35:24.540 kid2| Acl.cc(177) matches: checked: DENY_USERS_LOCAL = 1
2014/09/09 14:35:24.540 kid2| Acl.cc(177) matches: checked: http_access#5 = 1
2014/09/09 14:35:24.540 kid2| Acl.cc(177) matches: checked: http_access = 1
2014/09/09 14:35:24.540 kid2| Checklist.cc(55) markFinished: 0x27cfb98
answer DENIED for match
2014/09/09 14:35:24.540 kid2| Checklist.cc(155) checkCallback:
ACLChecklist::checkCallback: 0x27cfb98 answer=DENIED
#---------------------- cache.log ----------------------#


The file "DENY_USERS_LOCAL" is actual empty. Why does squid in the
3.4.7er version blocks me with the "http_access deny DENY_USERS_LOCAL"?
What changed hereby in the current version? How can I enforce the "old
behaviour" (like 3.4.4)?

Many thanks.

Kind regards,
Tom


From gkinkie at gmail.com  Mon Oct  6 11:04:54 2014
From: gkinkie at gmail.com (Kinkie)
Date: Mon, 6 Oct 2014 13:04:54 +0200
Subject: [squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth
	broken?)
In-Reply-To: <20141006090844.GA36954@admin.sibptus.tomsk.ru>
References: <20141006082452.GA36136@admin.sibptus.tomsk.ru>
 <CA+Y8hcNA9Pp02GTi24JYxuhvfTpDXPmWdx5nOawBwxgo56BKxg@mail.gmail.com>
 <20141006090844.GA36954@admin.sibptus.tomsk.ru>
Message-ID: <CA+Y8hcNeG8tk1MLHzeuG8ERFDfZdrfYZZ5ArgkMXZRtWArnvtw@mail.gmail.com>

er.. are you not using the helper provided by Samba? That is the most
reliable way to do NTLM authentication in squid (and most other Linux
software)

On Mon, Oct 6, 2014 at 11:08 AM, Victor Sudakov
<sudakov at sibptus.tomsk.ru> wrote:
> Francesco,
>
> What do you mean by "client"? Absolutely everything in this lab setup
> is the same, including the browser.
>
> The only difference is the ntlm plugin binary (ntlm_auth taken from
> the old squid and ntlm_smb_lm_auth from the new one).
>
> In fact, I replaced the binary and restarted squid.
>
> Kinkie wrote:
>> Whoops, sorry for the empty message.
>> This seems like a broken client. Can you check whether the client
>> sending that was a legitimate one?
>>
>> On Mon, Oct 6, 2014 at 10:24 AM, Victor Sudakov
>> <sudakov at sibptus.tomsk.ru> wrote:
>> > Colleagues,
>> >
>> > The NTLM (LM) plugin in squid27 worked perfectly while the NTLM plugin in
>> > squid34 is obviously broken.
>> >
>> > I am attaching two log files, one of the old plugin and the other of
>> > the new one. Could someone please have a look at bad-ntlm.log to see
>> > why ntlm_smb_lm_auth does not work any more after upgrading to 34?
>> >
>> > What does this failure
>> >
>> > ntlmssp: bad ascii: ffffffab
>> > No auth at all. Returning no-auth
>> > ntlm_smb_lm_auth.cc(531): pid=16346 :sending 'NA Logon Failure' to squid
>> >
>> > actually mean?
>> >
>> > I know that LM is bad and insecure, but I cannot give it up for the
>> > present in the production environment until I make Kerberos
>> > (negotiate) work.
>> >
>> > --
>> > Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
>> > sip:sudakov at sibptus.tomsk.ru
>> >
>> > _______________________________________________
>> > squid-users mailing list
>> > squid-users at lists.squid-cache.org
>> > http://lists.squid-cache.org/listinfo/squid-users
>> >
>>
>>
>>
>> --
>>     Francesco
>
> --
> Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
> sip:sudakov at sibptus.tomsk.ru



-- 
    Francesco


From omidkosari at yahoo.com  Mon Oct  6 11:51:44 2014
From: omidkosari at yahoo.com (Omid Kosari)
Date: Mon, 6 Oct 2014 04:51:44 -0700 (PDT)
Subject: [squid-users] High cpu usage by re_search_internal
In-Reply-To: <e9064d2d6775d22315f166c9a418d3da.squirrel@wm.familiakool.net>
References: <1411987273071-4667550.post@n4.nabble.com>
 <1412424298423-4667655.post@n4.nabble.com>
 <e9064d2d6775d22315f166c9a418d3da.squirrel@wm.familiakool.net>
Message-ID: <1412596304782-4667700.post@n4.nabble.com>

Thanks for the tip .
1. Is there any way to detect that what is current LANG without need to
restart squid ?
2. Is there any way to put that string inside /etc/init/squid.conf ? how ?

Thanks again .



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/High-cpu-usage-by-re-search-internal-tp4667550p4667700.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From omidkosari at yahoo.com  Mon Oct  6 12:24:27 2014
From: omidkosari at yahoo.com (Omid Kosari)
Date: Mon, 6 Oct 2014 05:24:27 -0700 (PDT)
Subject: [squid-users] High cpu usage by re_search_internal
In-Reply-To: <1412596304782-4667700.post@n4.nabble.com>
References: <1411987273071-4667550.post@n4.nabble.com>
 <1412424298423-4667655.post@n4.nabble.com>
 <e9064d2d6775d22315f166c9a418d3da.squirrel@wm.familiakool.net>
 <1412596304782-4667700.post@n4.nabble.com>
Message-ID: <1412598267576-4667701.post@n4.nabble.com>

I don't know i am correct or not but in /etc/init/squid3.conf i see following
lines
env CONFIG="/etc/squid3/squid.conf"
env SQUID_ARGS="-YC"

so i have added following line
env LANG=C

correct ? does not need double qotation mark ?



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/High-cpu-usage-by-re-search-internal-tp4667550p4667701.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From marcus.kool at urlfilterdb.com  Mon Oct  6 13:25:01 2014
From: marcus.kool at urlfilterdb.com (Marcus Kool)
Date: Mon, 6 Oct 2014 15:25:01 +0200
Subject: [squid-users] High cpu usage by re_search_internal
In-Reply-To: <1412598267576-4667701.post@n4.nabble.com>
References: <1411987273071-4667550.post@n4.nabble.com>
 <1412424298423-4667655.post@n4.nabble.com>
 <e9064d2d6775d22315f166c9a418d3da.squirrel@wm.familiakool.net>
 <1412596304782-4667700.post@n4.nabble.com>
 <1412598267576-4667701.post@n4.nabble.com>
Message-ID: <aa378c3054eb2cbd8f9343d81db46a00.squirrel@wm.familiakool.net>

> I don't know i am correct or not but in /etc/init/squid3.conf i see
> following
> lines
> env CONFIG="/etc/squid3/squid.conf"
> env SQUID_ARGS="-YC"
>
> so i have added following line
> env LANG=C
>
> correct ? does not need double qotation mark ?

That should do it.

Marcus

>
>
> --
> View this message in context:
> http://squid-web-proxy-cache.1019090.n4.nabble.com/High-cpu-usage-by-re-search-internal-tp4667550p4667701.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>




From sudakov at sibptus.tomsk.ru  Mon Oct  6 15:39:26 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Mon, 6 Oct 2014 22:39:26 +0700
Subject: [squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth
 broken?)
In-Reply-To: <CA+Y8hcNeG8tk1MLHzeuG8ERFDfZdrfYZZ5ArgkMXZRtWArnvtw@mail.gmail.com>
References: <20141006082452.GA36136@admin.sibptus.tomsk.ru>
 <CA+Y8hcNA9Pp02GTi24JYxuhvfTpDXPmWdx5nOawBwxgo56BKxg@mail.gmail.com>
 <20141006090844.GA36954@admin.sibptus.tomsk.ru>
 <CA+Y8hcNeG8tk1MLHzeuG8ERFDfZdrfYZZ5ArgkMXZRtWArnvtw@mail.gmail.com>
Message-ID: <20141006153925.GA41918@admin.sibptus.tomsk.ru>

Dear Francesco,

I have never used the helper provided by Samba, and I am not willing
to start using it. 

I don't want to install Samba on a proxy server, maintain a smb.conf
and TDB databases there, join a domain, see hundreds of winbindd
processes etc.

The ntlm_auth plugin has always been sufficient for my needs. I hoped
it would continue to be usable, but something is broken in it.

I would be glad to migrate to Kerberos though, if I can only make
browsers use it. No success so far. If anybody can help with it, I
would greatly appreciate.


Kinkie wrote:
> er.. are you not using the helper provided by Samba? That is the most
> reliable way to do NTLM authentication in squid (and most other Linux
> software)
> 
> On Mon, Oct 6, 2014 at 11:08 AM, Victor Sudakov
> <sudakov at sibptus.tomsk.ru> wrote:
> > Francesco,
> >
> > What do you mean by "client"? Absolutely everything in this lab setup
> > is the same, including the browser.
> >
> > The only difference is the ntlm plugin binary (ntlm_auth taken from
> > the old squid and ntlm_smb_lm_auth from the new one).
> >
> > In fact, I replaced the binary and restarted squid.
> >
> > Kinkie wrote:
> >> Whoops, sorry for the empty message.
> >> This seems like a broken client. Can you check whether the client
> >> sending that was a legitimate one?
> >>
> >> On Mon, Oct 6, 2014 at 10:24 AM, Victor Sudakov
> >> <sudakov at sibptus.tomsk.ru> wrote:
> >> > Colleagues,
> >> >
> >> > The NTLM (LM) plugin in squid27 worked perfectly while the NTLM plugin in
> >> > squid34 is obviously broken.
> >> >
> >> > I am attaching two log files, one of the old plugin and the other of
> >> > the new one. Could someone please have a look at bad-ntlm.log to see
> >> > why ntlm_smb_lm_auth does not work any more after upgrading to 34?
> >> >
> >> > What does this failure
> >> >
> >> > ntlmssp: bad ascii: ffffffab
> >> > No auth at all. Returning no-auth
> >> > ntlm_smb_lm_auth.cc(531): pid=16346 :sending 'NA Logon Failure' to squid
> >> >
> >> > actually mean?
> >> >
> >> > I know that LM is bad and insecure, but I cannot give it up for the
> >> > present in the production environment until I make Kerberos
> >> > (negotiate) work.
> >> >
> >> > --
> >> > Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
> >> > sip:sudakov at sibptus.tomsk.ru
> >> >
> >> > _______________________________________________
> >> > squid-users mailing list
> >> > squid-users at lists.squid-cache.org
> >> > http://lists.squid-cache.org/listinfo/squid-users
> >> >
> >>
> >>
> >>
> >> --
> >>     Francesco
> >
> > --
> > Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
> > sip:sudakov at sibptus.tomsk.ru
> 
> 
> 
> -- 
>     Francesco

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru


From sudakov at sibptus.tomsk.ru  Mon Oct  6 15:54:15 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Mon, 6 Oct 2014 22:54:15 +0700
Subject: [squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth
 broken?)
In-Reply-To: <20141006153925.GA41918@admin.sibptus.tomsk.ru>
References: <20141006082452.GA36136@admin.sibptus.tomsk.ru>
 <CA+Y8hcNA9Pp02GTi24JYxuhvfTpDXPmWdx5nOawBwxgo56BKxg@mail.gmail.com>
 <20141006090844.GA36954@admin.sibptus.tomsk.ru>
 <CA+Y8hcNeG8tk1MLHzeuG8ERFDfZdrfYZZ5ArgkMXZRtWArnvtw@mail.gmail.com>
 <20141006153925.GA41918@admin.sibptus.tomsk.ru>
Message-ID: <20141006155415.GA42309@admin.sibptus.tomsk.ru>

Dear Francesco,

You are the author of
squid-2.7.STABLE9/helpers/ntlm_auth/SMB/ntlm_auth.c and
squid-3.4.8/helpers/ntlm_auth/smb_lm/ntlm_smb_lm_auth.cc !

I am so glad to meet you!

I have tried to diff the above sources. Why are they so different? Why
all the change? The first works while the second does not. Where did
ntlm_smb_lm_auth.cc get broken?

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru


From squid3 at treenet.co.nz  Mon Oct  6 16:20:34 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 07 Oct 2014 05:20:34 +1300
Subject: [squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth
 broken?)
In-Reply-To: <20141006153925.GA41918@admin.sibptus.tomsk.ru>
References: <20141006082452.GA36136@admin.sibptus.tomsk.ru>
 <CA+Y8hcNA9Pp02GTi24JYxuhvfTpDXPmWdx5nOawBwxgo56BKxg@mail.gmail.com>
 <20141006090844.GA36954@admin.sibptus.tomsk.ru>
 <CA+Y8hcNeG8tk1MLHzeuG8ERFDfZdrfYZZ5ArgkMXZRtWArnvtw@mail.gmail.com>
 <20141006153925.GA41918@admin.sibptus.tomsk.ru>
Message-ID: <5432C152.6000505@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 7/10/2014 4:39 a.m., Victor Sudakov wrote:
> Dear Francesco,
> 
> I have never used the helper provided by Samba, and I am not
> willing to start using it.
> 
> I don't want to install Samba on a proxy server, maintain a
> smb.conf and TDB databases there, join a domain, see hundreds of
> winbindd processes etc.

Thats the price of NTLM.

> 
> The ntlm_auth plugin has always been sufficient for my needs. I
> hoped it would continue to be usable, but something is broken in
> it.
> 

The Squid "ntlm_auth" helper (now ntlm_smb_lm_auth) does not, and
never has, performed NTLM in any way.

What it does is this http://en.wikipedia.org/wiki/LM_hash.

Note how it says the protocol was obsoleted by ... *Windows 3.1*

The *Basic* authentication provided in HTTP is actually a superior
form of authentication.

If you convert your proxy to requesting Basic auth you will find your
system just as secure as before, has a far wider range of software
support, and greater performance.


> I would be glad to migrate to Kerberos though, if I can only make 
> browsers use it. No success so far. If anybody can help with it, I 
> would greatly appreciate.


Since your environment was accepting the old versions of
ntlm_smb_lm_auth helper I predict that most of that software will
attempt to use the Negotiate/NTLM form of Negotiate authentication
over HTTP.

To prevent that you will have to disable NTLM use on the machine(s)
you are trying to convert to Kerberos. Adding Basic as a fallback
offering you can test the Kerberos is working without cutting the
service or /user off completely.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUMsFSAAoJELJo5wb/XPRjr6cH/iMaFrWhroq6pOZCVW+gTWwI
BL8sT6xd45vp1jSeIofD4MpkDSeInmjpjD6nT0ZPaanhVq24Wxi7s+h6p4eGccts
5G5GV8ST0tXW03vtOaYTDfuKy4rcmwaf/8ncyKU4gCo4KwMXvGDUxgI5HSSoSkqT
9xe5pLrJMnZzqHB+862zZZqTyu5Sttxu2ACn/lI5WeZMv85YV6EhrZFRQDRc8WNS
ay/iD4VghEdKBQ41f8nt4Ecnghz25oHCU/VsDDptdPXnE5XJc2HD6Je7348uqK3+
yrSscF90qGBd/Tg8BXL7+u5cM9uzx80EPqxax71WD4KOiC6+3uSCO+vBUc7PvNo=
=Nqfn
-----END PGP SIGNATURE-----


From ahmed.zaeem at netstream.ps  Tue Oct  7 08:53:54 2014
From: ahmed.zaeem at netstream.ps (Ahmed Allzaeem)
Date: Tue, 7 Oct 2014 01:53:54 -0700
Subject: [squid-users] squid ipv6 outgoing addresses from ipv4 incoming
	traffic
Message-ID: <000001cfe20c$3a4159c0$aec40d40$@netstream.ps>

Hi ,

I have 1 single ipv4 ip and have many ipv6 ips

I need to listen on the ipv4 on many ports

As an example

1.1.1.1:40000

1.1.1.1:40001

1.1.1.1:40002

 

In corresponding I need each ipv4:port to be tcp_outgoing to different ipv6
address

I have about 3 ips.

 

Can I know why the config below is wrong ???

=============

 

http_port 241.xxx.xxx.101:40001 

http_port 241.xxx.xxx.101:40002

http_port 241.xxx.xxx.101:40003 

 

## designate acl based on inbound connection name

acl user1 myportname 40001

acl user2 myportname 40002

acl user3 myportname 40003

 

## define outgoing IPv6 per user

tcp_outgoing_address [2001::Xxxxx] user1

tcp_outgoing_address [2001::xxxxx] user2

tcp_outgoing_address [2001::xxxxx] user3

 

 

=======================

 

 

The config above map many ipv4 ports to many ipv6 addresses , wt wrong I
have above ???

 

 

regards

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141007/101121b4/attachment.htm>

From ajm.martinez at gmail.com  Tue Oct  7 01:02:24 2014
From: ajm.martinez at gmail.com (Alejandro Martinez)
Date: Mon, 6 Oct 2014 23:02:24 -0200
Subject: [squid-users] SSL BUMP, https interception, etc
Message-ID: <CAFEXmxhsOuESzJYOPqke0h-wXXVReKr6O3UjU8mO9ie_mHhgCA@mail.gmail.com>

I have been trying with different versions of squid doing https
interception.

With some brosers versions work, with others doesn't.

Does it have sense to keep trying to do https interception with the arrive
of pinning and all that things that prevent this kind of activities ?

Maybe it's a good thing to search other alternative, maybe something like
phpproxy, etc.

What do all of you think about this ?

Alejandro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141006/f3ea5eed/attachment.htm>

From james at ejbdigital.com.au  Tue Oct  7 01:36:42 2014
From: james at ejbdigital.com.au (James Harper)
Date: Tue, 7 Oct 2014 01:36:42 +0000
Subject: [squid-users] SSL BUMP, https interception, etc
In-Reply-To: <CAFEXmxhsOuESzJYOPqke0h-wXXVReKr6O3UjU8mO9ie_mHhgCA@mail.gmail.com>
References: <CAFEXmxhsOuESzJYOPqke0h-wXXVReKr6O3UjU8mO9ie_mHhgCA@mail.gmail.com>
Message-ID: <e7f89916980c4c9fbe0f719b43026c35@SIXPR04MB304.apcprd04.prod.outlook.com>

> 
> Does it have sense to keep trying to do https interception with the arrive of
> pinning and all that things that prevent this kind of activities ?
> 

I think if you give it some time there will be commercial pressure to allow override of pinning.

I mean, you are only ever going to do SSL interception on devices you have full control over anyway (who else would trust you to install your CA? I wouldn't), so it makes sense to have a feature that allows you to override pinning for certain CA's in a controlled network.

James

From squid3 at treenet.co.nz  Tue Oct  7 02:40:24 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 07 Oct 2014 15:40:24 +1300
Subject: [squid-users] squid ipv6 outgoing addresses from ipv4 incoming
 traffic
In-Reply-To: <000001cfe20c$3a4159c0$aec40d40$@netstream.ps>
References: <000001cfe20c$3a4159c0$aec40d40$@netstream.ps>
Message-ID: <54335298.7020905@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 7/10/2014 9:53 p.m., Ahmed Allzaeem wrote:
> Hi ,
> 
> I have 1 single ipv4 ip and have many ipv6 ips
> 
> I need to listen on the ipv4 on many ports
> 
> As an example
> 
> 1.1.1.1:40000
> 
> 1.1.1.1:40001
> 
> 1.1.1.1:40002
> 
> 
> 
> In corresponding I need each ipv4:port to be tcp_outgoing to
> different ipv6 address
> 
> I have about 3 ips.
> 
> 
> 
> Can I know why the config below is wrong ???

The myportname is the string value of the http_port first parameter by
default.

> 
> http_port 241.xxx.xxx.101:40001

default name: 241.xxx.xxx.101:40001


> http_port 241.xxx.xxx.101:40002
> 
> http_port 241.xxx.xxx.101:40003
> 
> 


So you need:

acl user1 myportname 241.xxx.xxx.101:40001

acl user2 myportname 241.xxx.xxx.101:40002

acl user3 myportname 241.xxx.xxx.101:40003


Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUM1KXAAoJELJo5wb/XPRjOKYIAMPO5rrXnhkrQXS6yi8hX2eX
3RPxOAPal6cdXq3H0+c1EUXanO5gr6rbGl+fXOtx1hypl52eLKORHf+Ct+UyVK2x
BRtKi9pkDzXwqnK8WbEUVEuCyV1mBg40jjcwsCUFOzukile8R6cRG3ytHMzjXTjI
b+SDgW+4y2BszCUMSdnu39TsaEgxxnWCHSdA46F2S2H6xYDHjJJokuXjqM6Bo4lg
X5ySficDEv2dFSrOjehw7As7uj0pX/e+2G3qI9RciNCH+rJrPJ0xd2m38/FZ/wdV
pHOhm/osmrHApWTpTFHBU9onUwPiKg3HO9yDbprteZ7KyLFu5hh2UDNFveAABn4=
=gWb4
-----END PGP SIGNATURE-----


From sudakov at sibptus.tomsk.ru  Tue Oct  7 02:52:14 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Tue, 7 Oct 2014 09:52:14 +0700
Subject: [squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth
 broken?)
In-Reply-To: <5432C152.6000505@treenet.co.nz>
References: <20141006082452.GA36136@admin.sibptus.tomsk.ru>
 <CA+Y8hcNA9Pp02GTi24JYxuhvfTpDXPmWdx5nOawBwxgo56BKxg@mail.gmail.com>
 <20141006090844.GA36954@admin.sibptus.tomsk.ru>
 <CA+Y8hcNeG8tk1MLHzeuG8ERFDfZdrfYZZ5ArgkMXZRtWArnvtw@mail.gmail.com>
 <20141006153925.GA41918@admin.sibptus.tomsk.ru>
 <5432C152.6000505@treenet.co.nz>
Message-ID: <20141007025214.GA51120@admin.sibptus.tomsk.ru>

Amos Jeffries wrote:
> > 
> > I have never used the helper provided by Samba, and I am not
> > willing to start using it.
> > 
> > I don't want to install Samba on a proxy server, maintain a
> > smb.conf and TDB databases there, join a domain, see hundreds of
> > winbindd processes etc.
> 
> Thats the price of NTLM.

This price is too high for my objectives.

> > The ntlm_auth plugin has always been sufficient for my needs. I
> > hoped it would continue to be usable, but something is broken in
> > it.
> 
> The Squid "ntlm_auth" helper (now ntlm_smb_lm_auth) does not, and
> never has, performed NTLM in any way.
> 
> What it does is this http://en.wikipedia.org/wiki/LM_hash.

I am perfectly aware of that. The problem is that this LM
authentication did work with the squid27 ntlm_auth helper and does not
work with the squid34 newer ntlm_smb_lm_auth helper. There was no need
to break what was working.

> The *Basic* authentication provided in HTTP is actually a superior
> form of authentication.
> If you convert your proxy to requesting Basic auth you will find your

I am afraid you are mistaken. If I convert my proxy to Basic, it
will start asking users for their login/password for proxy access,
instead of authenticating them transparently with their Windows
credentials.

> 
> > I would be glad to migrate to Kerberos though, if I can only make 
> > browsers use it. No success so far. If anybody can help with it, I 
> > would greatly appreciate.
> 
> 
> Since your environment was accepting the old versions of
> ntlm_smb_lm_auth helper I predict that most of that software will
> attempt to use the Negotiate/NTLM form of Negotiate authentication
> over HTTP.
> 
> To prevent that you will have to disable NTLM use on the machine(s)
> you are trying to convert to Kerberos. 

Yes, I have special provisions in the domain policies to allow the old
NTLM.  Do you mean to say if I disable NTLM, the browsers will start
talking Negotiate/Kerberos? 

Thanks for the hint, I will try that out and report here.

> Adding Basic as a fallback
> offering you can test the Kerberos is working without cutting the
> service or /user off completely.

No, adding Basic is not an option because I will have to provide
special "proxy passwords" to the users, or make them enter their
Windows passwords by hand. This is highly undesirable. Once they
logon into Windows, they must have (or not have) Web access
transparently.

If you know how to achieve SSO with Basic auth, please share.

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru


From james at ejbdigital.com.au  Tue Oct  7 03:13:38 2014
From: james at ejbdigital.com.au (James Harper)
Date: Tue, 7 Oct 2014 03:13:38 +0000
Subject: [squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth
 broken?)
In-Reply-To: <20141007025214.GA51120@admin.sibptus.tomsk.ru>
References: <20141006082452.GA36136@admin.sibptus.tomsk.ru>
 <CA+Y8hcNA9Pp02GTi24JYxuhvfTpDXPmWdx5nOawBwxgo56BKxg@mail.gmail.com>
 <20141006090844.GA36954@admin.sibptus.tomsk.ru>
 <CA+Y8hcNeG8tk1MLHzeuG8ERFDfZdrfYZZ5ArgkMXZRtWArnvtw@mail.gmail.com>
 <20141006153925.GA41918@admin.sibptus.tomsk.ru>
 <5432C152.6000505@treenet.co.nz>
 <20141007025214.GA51120@admin.sibptus.tomsk.ru>
Message-ID: <30cd755eae1c431cb2ff622ed06ae795@SIXPR04MB304.apcprd04.prod.outlook.com>

> No, adding Basic is not an option because I will have to provide
> special "proxy passwords" to the users, or make them enter their
> Windows passwords by hand. This is highly undesirable. Once they
> logon into Windows, they must have (or not have) Web access
> transparently.
> 
> If you know how to achieve SSO with Basic auth, please share.
> 

I have a few idea's for out-of-band SSO, some of which I have experimented with...

1. agent running on AD server(s) looking at event logs for login events. I've done this from Linux using a wmi client but too much load.  The proposed agent would run on the windows server, collect IP<->username mappings, and squid would ask "which username is this IP address". Obviously there are shortcomings with this - it only works for domain joined devices, and assumes 1:1 username:IP, which is not true on a multiuser device (terminal server)

2. as above but also an agent looking at Exchange logs (or imap or pop3 etc), which would allow authentication of mobile devices etc as long as they check their email via Exchange. This still has similar shortcomings to #1.

3. some bastardisation of identd. I've posted before about this. Identd assumes that the destination server is asking "who owns this connection" and so only gives port numbers because the IP is assumed from the ident connection (I have patched squid to fake the source address of the destination server so it works in transparent mode). Ident also has some serious security shortcomings, but they wouldn't be hard to solve. This new ident protocol would need:
  . to access the full details of the connection so a third party (eg squid) could ask who owns the connection)
  . to provide two-way authentication so that the endpoint would know that squid was authorised to ask about the connection, and so that squid would trust the endpoint to give a proper answer and not fake it
  . make a single connection between squid and the endpoint, rather than a new ident connection for every tcp connection which is a huge drain on resources.
This still has the drawback that it isn't going to work on mobile devices, requires an agent installed on each endpoint, and requires that squid knows enough details about the connection to be able to give the details to the endpoint (a router NAT-ing connections to squid would break this, you'd need to use WCCP), but it would solve the multiuser terminal problem.

Some combination of all three of the above would cover pretty much everything, and you could use a captive portal for whatever is left.

Apart from the ident fake-the-source-ip-address hack (works quite well!), and the wmi callout from Linux (works but too slow), the rest is just theory, but should be possible.

James


From squid3 at treenet.co.nz  Tue Oct  7 03:29:05 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 07 Oct 2014 16:29:05 +1300
Subject: [squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth
 broken?)
In-Reply-To: <20141007025214.GA51120@admin.sibptus.tomsk.ru>
References: <20141006082452.GA36136@admin.sibptus.tomsk.ru>
 <CA+Y8hcNA9Pp02GTi24JYxuhvfTpDXPmWdx5nOawBwxgo56BKxg@mail.gmail.com>
 <20141006090844.GA36954@admin.sibptus.tomsk.ru>
 <CA+Y8hcNeG8tk1MLHzeuG8ERFDfZdrfYZZ5ArgkMXZRtWArnvtw@mail.gmail.com>
 <20141006153925.GA41918@admin.sibptus.tomsk.ru>
 <5432C152.6000505@treenet.co.nz>
 <20141007025214.GA51120@admin.sibptus.tomsk.ru>
Message-ID: <54335E01.2070904@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 7/10/2014 3:52 p.m., Victor Sudakov wrote:
> Amos Jeffries wrote:
>>> 
>>> I have never used the helper provided by Samba, and I am not 
>>> willing to start using it.
>>> 
>>> I don't want to install Samba on a proxy server, maintain a 
>>> smb.conf and TDB databases there, join a domain, see hundreds
>>> of winbindd processes etc.
>> 
>> Thats the price of NTLM.
> 
> This price is too high for my objectives.
> 
>>> The ntlm_auth plugin has always been sufficient for my needs.
>>> I hoped it would continue to be usable, but something is broken
>>> in it.
>> 
>> The Squid "ntlm_auth" helper (now ntlm_smb_lm_auth) does not,
>> and never has, performed NTLM in any way.
>> 
>> What it does is this http://en.wikipedia.org/wiki/LM_hash.
> 
> I am perfectly aware of that. The problem is that this LM 
> authentication did work with the squid27 ntlm_auth helper and does
> not work with the squid34 newer ntlm_smb_lm_auth helper. There was
> no need to break what was working.

SMB LM supports both ASCII and UNICODE. Each packet is explicitly
flagged as one or other. Apparently your client software wants to
authenticate using a character 171 out of an array of length 127.


> 
>> The *Basic* authentication provided in HTTP is actually a
>> superior form of authentication. If you convert your proxy to
>> requesting Basic auth you will find your
> 
> I am afraid you are mistaken. If I convert my proxy to Basic, it 
> will start asking users for their login/password for proxy access, 
> instead of authenticating them transparently with their Windows 
> credentials.

That is a limitation of your software. Basic itself is superior to SMB
LM. You are just given no access to use it for SSO by the tools
currently in use.


>> 
>>> I would be glad to migrate to Kerberos though, if I can only
>>> make browsers use it. No success so far. If anybody can help
>>> with it, I would greatly appreciate.
>> 
>> 
>> Since your environment was accepting the old versions of 
>> ntlm_smb_lm_auth helper I predict that most of that software
>> will attempt to use the Negotiate/NTLM form of Negotiate
>> authentication over HTTP.
>> 
>> To prevent that you will have to disable NTLM use on the
>> machine(s) you are trying to convert to Kerberos.
> 
> Yes, I have special provisions in the domain policies to allow the
> old NTLM.  Do you mean to say if I disable NTLM, the browsers will
> start talking Negotiate/Kerberos?

I mean turn off NTLM for the specific machines being checked so you
can identify the ones that have broken Kerberos and concentrate on
resolving that. Otherwise they will "work" and continue to use NTLM
invisibly. You hit a major emergency if you think all are using
Kerberos and NTLM can be turned off completely.


> 
> Thanks for the hint, I will try that out and report here.
> 
>> Adding Basic as a fallback offering you can test the Kerberos is
>> working without cutting the service or /user off completely.
> 
> No, adding Basic is not an option because I will have to provide 
> special "proxy passwords" to the users, or make them enter their 
> Windows passwords by hand. This is highly undesirable. Once they 
> logon into Windows, they must have (or not have) Web access 
> transparently.
> 
> If you know how to achieve SSO with Basic auth, please share.
> 

This is what password managers in the browser are for IME. Someone
else might know how to get Windows itself providing them to the browser.

On the AD end of things the LDAP interface I think is required for
non-NTLM/Kerberos SSO.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUM14BAAoJELJo5wb/XPRjJD4H/10GqG12nApeSchd70Oc/sMn
RGGdYJYALv5jPfA6/Zu1IW/Vdbnz7pEQwUmNEBnKxzMHm+/4ZFd6qGiL6xYiS2AE
Tzhkgsu8Jm1JTE3NbK06qb0lE8KbuRHzcmjUihjD+0DoY0Bbm9Om/4PHv9q4KaC2
aVq08AhrBaiYT0tbli+FmMTHYmrKjyKaiwPo5U//Rpotv2J4oZsPWRfxyN2yeIpH
qZMUMUzEcKR6HRlKlOyG1UhXdciwgk0QgR1wfgFHBTbmxsB62PMU9nqpKc+RUkdu
ZBBBigOrhsSrz9FWZhJOZMwta6UCdpRJjS/zx6VMb8bu93nXwb0pA2qffXFYcHU=
=uZCV
-----END PGP SIGNATURE-----


From glenn.groves at bradnams.com.au  Tue Oct  7 03:51:49 2014
From: glenn.groves at bradnams.com.au (glenn.groves at bradnams.com.au)
Date: Tue, 7 Oct 2014 13:51:49 +1000
Subject: [squid-users] https issues for google
Message-ID: <2329B68B3D676246BA0D1149E22F509F01A02886@bneseqs20.bradnams.com.au>

Hi All,

We have a weird issue where https sites apparently don't respond (get message "this page can't be displayed"). This mainly affects google websites and to a lesser affect youtube. It has been reported it may have affected some banking sites but this is unconfirmed. We are running centos 6.5 with up to date squid from the centos repositories. 

Here is the version of squid: 
yum list installed | grep squid
squid.x86_64?? ??????????????????????7:3.1.10-20.el6_5.3

The https sites work fine if I put a direct hole in the firewall to allow internet traffic directly out - but this is not a solution.

Thanks, Glenn

Below is the conf file:

### /etc/squid/squid.conf Configuration File ####

### cache manager
cache_mgr somone at email.com

### negotiate kerberos and ntlm authentication
auth_param negotiate program /usr/local/bin/negotiate_wrapper -d --ntlm /usr/bin/ntlm_auth --diagnostics --helper-protocol=squid-2.5-ntlmssp --domain=DOMAIN --kerberos /usr/lib64/squid/squid_kerb_auth -i -d -s HTTP/proxycen.email.com
auth_param negotiate children 50
auth_param negotiate keep_alive off

### pure ntlm authentication
auth_param ntlm program /usr/bin/ntlm_auth --diagnostics --helper-protocol=squid-2.5-ntlmssp --domain=DOMAIN
auth_param ntlm children 200
# auth_param ntlm max_challenge_lifetime 5 minutes
auth_param ntlm keep_alive off

### provide basic authentication via ldap for clients not authenticated via kerberos/ntlm
auth_param basic program /usr/lib64/squid/squid_ldap_auth -R -b "dc=DOMAIN,dc=com " -D squid at email.com -W /etc/squid/ldappass.txt -f sAMAccountName=%s -h SERVER.email.com
auth_param basic children 100
auth_param basic realm Internet Proxy
auth_param basic credentialsttl 1 minute

### ldap authorisation
# external_acl_type memberof children=300 %LOGIN /usr/lib64/squid/squid_ldap_group -R -K -b "dc=DOMAIN,dc=com,dc=au" -D squid at email.com -W /etc/squid/ldappass.txt -f "(&(objectclass=person)(sAMAccountName=%v)(memberof=cn=%g, ou=Internet,ou=DOMAIN Groups,ou=DOMAIN,dc=DOMAIN,dc=com,dc=au))" -h SERVER.email.com

### Squid Cache Manager
cachemgr_passwd none info

cache_dir aufs /var/spool/squid 30000 16 256
minimum_object_size 2 KB
maximum_object_size 10 MB
cache_swap_low 95
cache_swap_high 97

### acl for proxy auth and ldap authorizations
acl SSL method CONNECT
acl allowedsites???? ???dstdomain "/etc/squid/allowedsites.txt"
acl auth proxy_auth REQUIRED
#?? aclname???????????? acltype? typename activedirectorygroup
# acl BlockedAccess?????? external memberof "/etc/squid/blocked_access.txt"
# acl RestrictedAccess??? external memberof "/etc/squid/restricted_access.txt"
# acl StandardAccess????? external memberof "/etc/squid/standard_access.txt"
# acl ExceptionAccess???? external memberof "/etc/squid/exception_access.txt"
# acl FullAccess????????? external memberof "/etc/squid/full_access.txt"
# acl AnonymousAccess???? external memberof "/etc/squid/anonymous_access.txt"
# acl allowedsites??????? dstdomain "/etc/squid/allowedsites.txt"
# acl blockedsites??????? dstdomain "/etc/squid/blockedsites.txt"
# acl exceptedsites?????? dstdomain "/etc/squid/exceptedsites.txt"
acl prioritysites?????? dstdomain "/etc/squid/prioritysites.txt"

### squid defaults
acl manager proto cache_object
acl localhost src 127.0.0.1/32 ::1
acl allowedsite124 src 192.168.124.0/24
acl to_localhost dst 127.0.0.0/8 0.0.0.0/32 ::1
acl SSL_ports port 443
acl Safe_ports port 80????????? # http
acl Safe_ports port 21????????? # ftp
acl Safe_ports port 443???????? # https
acl Safe_ports port 70????????? # gopher
acl Safe_ports port 210???????? # wais
acl Safe_ports port 1025-65535? # unregistered ports
acl Safe_ports port 280???????? # http-mgmt
acl Safe_ports port 488???????? # gss-http
acl Safe_ports port 591???????? # filemaker
acl Safe_ports port 777??????? ?# multiling http
acl Safe_ports port 17500?????? # dropbox
#http_access deny CONNECT !SSL_ports
#http_access allow SSL_ports
http_access allow allowedsites
acl CONNECT method CONNECT
acl cacheadmin src 192.168.11.221 192.168.8.175
http_access allow manager localhost
http_access allow manager cacheadmin
http_access deny manager
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost

### http_access rules
# allow unrestricted access to prioritysites
http_access allow prioritysites
# enforce authentication, order of rules is important for authorization levels
http_access allow allowedsite124
http_access deny !auth
# prevent access to basic auth prompt for BlockedAccess users
# http_access deny BlockedAccess all
# http_access allow allowedsites
# http_access deny RestrictedAccess all
# http_access allow AnonymousAccess auth
# http_access allow FullAccess auth
# http_access allow exceptedsites ExceptionAccess auth
# http_access deny blockedsites
# http_access allow StandardAccess auth
http_access allow auth
# http_access deny !auth
# DO NOT REMOVE THE FOLLOWING LINE
http_access deny all

### logging
access_log /var/log/squid/access.log squid

### Set memory manually, to allow it to use more of the system
cache_mem 1024 MB

### squid Debian defaults
http_port 8080
hierarchy_stoplist cgi-bin ?
coredump_dir /var/spool/squid
refresh_pattern ^ftp:?????????? 1440??? 20%???? 10080
refresh_pattern ^gopher:??????? 1440??? 0%????? 1440
refresh_pattern -i (/cgi-bin/|\?) 0???? 0%????? 0
refresh_pattern .?????????????? 0?????? 20%???? 4320
[root at proxycen squid]#



From sudakov at sibptus.tomsk.ru  Tue Oct  7 04:08:32 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Tue, 7 Oct 2014 11:08:32 +0700
Subject: [squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth
 broken?)
In-Reply-To: <30cd755eae1c431cb2ff622ed06ae795@SIXPR04MB304.apcprd04.prod.outlook.com>
References: <20141006082452.GA36136@admin.sibptus.tomsk.ru>
 <CA+Y8hcNA9Pp02GTi24JYxuhvfTpDXPmWdx5nOawBwxgo56BKxg@mail.gmail.com>
 <20141006090844.GA36954@admin.sibptus.tomsk.ru>
 <CA+Y8hcNeG8tk1MLHzeuG8ERFDfZdrfYZZ5ArgkMXZRtWArnvtw@mail.gmail.com>
 <20141006153925.GA41918@admin.sibptus.tomsk.ru>
 <5432C152.6000505@treenet.co.nz>
 <20141007025214.GA51120@admin.sibptus.tomsk.ru>
 <30cd755eae1c431cb2ff622ed06ae795@SIXPR04MB304.apcprd04.prod.outlook.com>
Message-ID: <20141007040832.GA51918@admin.sibptus.tomsk.ru>

James Harper wrote:
> > No, adding Basic is not an option because I will have to provide
> > special "proxy passwords" to the users, or make them enter their
> > Windows passwords by hand. This is highly undesirable. Once they
> > logon into Windows, they must have (or not have) Web access
> > transparently.
> > 
> > If you know how to achieve SSO with Basic auth, please share.
> > 
> 
> I have a few idea's for out-of-band SSO, some of which I have experimented with...

[dd]

> 
> 3. some bastardisation of identd. I've posted before about this.
> Identd assumes that the destination server is asking "who owns this
> connection" and so only gives port numbers because the IP is assumed
> from the ident connection (I have patched squid to fake the source
> address of the destination server so it works in transparent mode).
> Ident also has some serious security shortcomings, but they wouldn't
> be hard to solve. This new ident protocol would need:

I even know/use a couple of identd services for Windows,
http://sourceforge.net/projects/retinascan/ is a good one.

The sad irony is that ident lookups are also broken in squid34 (the
ident code leaks memory).

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru


From sudakov at sibptus.tomsk.ru  Tue Oct  7 04:16:59 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Tue, 7 Oct 2014 11:16:59 +0700
Subject: [squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth
 broken?)
In-Reply-To: <54335E01.2070904@treenet.co.nz>
References: <20141006082452.GA36136@admin.sibptus.tomsk.ru>
 <CA+Y8hcNA9Pp02GTi24JYxuhvfTpDXPmWdx5nOawBwxgo56BKxg@mail.gmail.com>
 <20141006090844.GA36954@admin.sibptus.tomsk.ru>
 <CA+Y8hcNeG8tk1MLHzeuG8ERFDfZdrfYZZ5ArgkMXZRtWArnvtw@mail.gmail.com>
 <20141006153925.GA41918@admin.sibptus.tomsk.ru>
 <5432C152.6000505@treenet.co.nz>
 <20141007025214.GA51120@admin.sibptus.tomsk.ru>
 <54335E01.2070904@treenet.co.nz>
Message-ID: <20141007041659.GB51918@admin.sibptus.tomsk.ru>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Amos Jeffries wrote:
> >>> 
> >>> I have never used the helper provided by Samba, and I am not 
> >>> willing to start using it.
> >>> 
> >>> I don't want to install Samba on a proxy server, maintain a 
> >>> smb.conf and TDB databases there, join a domain, see hundreds
> >>> of winbindd processes etc.
> >> 
> >> Thats the price of NTLM.
> > 
> > This price is too high for my objectives.
> > 
> >>> The ntlm_auth plugin has always been sufficient for my needs.
> >>> I hoped it would continue to be usable, but something is broken
> >>> in it.
> >> 
> >> The Squid "ntlm_auth" helper (now ntlm_smb_lm_auth) does not,
> >> and never has, performed NTLM in any way.
> >> 
> >> What it does is this http://en.wikipedia.org/wiki/LM_hash.
> > 
> > I am perfectly aware of that. The problem is that this LM 
> > authentication did work with the squid27 ntlm_auth helper and does
> > not work with the squid34 newer ntlm_smb_lm_auth helper. There was
> > no need to break what was working.
> 
> SMB LM supports both ASCII and UNICODE. Each packet is explicitly
> flagged as one or other. Apparently your client software wants to
> authenticate using a character 171 out of an array of length 127.

Apparently so, but as I said, the very same client software does work
with the old "ntlm_auth" helper and does not work with the new
ntlm_smb_lm_auth one.

That's why I am saying that the problem is on the authenticator side
and not on the client side.


> >> The *Basic* authentication provided in HTTP is actually a
> >> superior form of authentication. If you convert your proxy to
> >> requesting Basic auth you will find your
> > 
> > I am afraid you are mistaken. If I convert my proxy to Basic, it 
> > will start asking users for their login/password for proxy access, 
> > instead of authenticating them transparently with their Windows 
> > credentials.
> 
> That is a limitation of your software. Basic itself is superior to SMB
> LM. 

I am not so sure about it. In Basic, you just base64 decode the
relevant HTTP header to obtain a plain text password. In LM,
it is a bit more difficult.

> You are just given no access to use it for SSO by the tools
> currently in use.

All right, what tools are there for proxy SSO with Windows
credentials? Please specify.

[dd]

I will reply to the rest of the mail after I experiment if disabling
LM actutlly does enable Negotiate/Kerberos.


- -- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUM2k6AAoJEA2k8lmbXsY0Y4IH/1KE7zea2njCKWCHp5wY0bsz
9QIW3ds0T+JCj9Fvfsdt+4cRAzGMu1ILnlC5FtosRz5Bi1sPBva3BRcBQRdilxfc
dmlL/XVmfs/F39iGKJnIM7Xy9gs2D5a7pBfvo+J6Ph3lxhbKEvDLQTET3IO9eF99
BH2La23Rk1+3rFyrL6eapt9/F3q2ndwspzqiKUcHeJFGRzfcuEzYto9YxJXWy1t1
eRi0Y9yVw+QiVlz6NxTShLg/TRGS+CPPhLFRTwSwqmeC+rtUzBNKyB7UqCUe/cM1
rkoGoaNzYPNkbJda8RW64pl2EYHDZANjAoAb+LoZBFfW7T3JBfNpzj1zEBSqDq4=
=7PmE
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Tue Oct  7 04:43:59 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 07 Oct 2014 17:43:59 +1300
Subject: [squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth
 broken?)
In-Reply-To: <20141007041659.GB51918@admin.sibptus.tomsk.ru>
References: <20141006082452.GA36136@admin.sibptus.tomsk.ru>
 <CA+Y8hcNA9Pp02GTi24JYxuhvfTpDXPmWdx5nOawBwxgo56BKxg@mail.gmail.com>
 <20141006090844.GA36954@admin.sibptus.tomsk.ru>
 <CA+Y8hcNeG8tk1MLHzeuG8ERFDfZdrfYZZ5ArgkMXZRtWArnvtw@mail.gmail.com>
 <20141006153925.GA41918@admin.sibptus.tomsk.ru>
 <5432C152.6000505@treenet.co.nz>
 <20141007025214.GA51120@admin.sibptus.tomsk.ru>
 <54335E01.2070904@treenet.co.nz>
 <20141007041659.GB51918@admin.sibptus.tomsk.ru>
Message-ID: <54336F8F.7020209@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 7/10/2014 5:16 p.m., Victor Sudakov wrote:
> Amos Jeffries wrote:
>>>>> 
>>>>> I have never used the helper provided by Samba, and I am
>>>>> not willing to start using it.
>>>>> 
>>>>> I don't want to install Samba on a proxy server, maintain a
>>>>>  smb.conf and TDB databases there, join a domain, see
>>>>> hundreds of winbindd processes etc.
>>>> 
>>>> Thats the price of NTLM.
>>> 
>>> This price is too high for my objectives.
>>> 
>>>>> The ntlm_auth plugin has always been sufficient for my
>>>>> needs. I hoped it would continue to be usable, but
>>>>> something is broken in it.
>>>> 
>>>> The Squid "ntlm_auth" helper (now ntlm_smb_lm_auth) does
>>>> not, and never has, performed NTLM in any way.
>>>> 
>>>> What it does is this http://en.wikipedia.org/wiki/LM_hash.
>>> 
>>> I am perfectly aware of that. The problem is that this LM 
>>> authentication did work with the squid27 ntlm_auth helper and
>>> does not work with the squid34 newer ntlm_smb_lm_auth helper.
>>> There was no need to break what was working.
> 
>> SMB LM supports both ASCII and UNICODE. Each packet is
>> explicitly flagged as one or other. Apparently your client
>> software wants to authenticate using a character 171 out of an
>> array of length 127.
> 
> Apparently so, but as I said, the very same client software does
> work with the old "ntlm_auth" helper and does not work with the
> new ntlm_smb_lm_auth one.
> 
> That's why I am saying that the problem is on the authenticator
> side and not on the client side.

The client is sending corrupt packets.

Old authenticator did not check for the corruption. New one does.

Client is still sending corrupt packets, which is why both the
developers have said the problem is in the client.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUM2+PAAoJELJo5wb/XPRjLbkH/09mdnl6r5Q2ZlPv3uwSjHZf
CAce2sHQYpKM3m7F3V8f4rLxhLz65Ive+nIXTFIkrdf+YWbCr8KRYnHIxWYpsbdz
oIEixxl1lFDnQJmiS8qQXDBDlwoXMNBU+ey3C2TarJt6R62oX+5ZBztVNZHGXycS
aA+I+2K4MHVZXKAS0g8tMecNcSgqB91Qfd3BA4+hybeHXPRbJr8gvZZ6v9vChWZq
BYCyGNDA4r7lEXqQx+YcZ/9BWsQaWBm/Smh4xlR1PD3YiIrLZ8WvK9o+Ldjz+nEC
iZG2VM9OHb9Nf52ZNU8Ofw+6CoM4reiQPydswFjqwnwWze7UEZQ0DUjiFvantm8=
=Uosz
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Tue Oct  7 04:48:07 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 07 Oct 2014 17:48:07 +1300
Subject: [squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth
 broken?)
In-Reply-To: <20141007040832.GA51918@admin.sibptus.tomsk.ru>
References: <20141006082452.GA36136@admin.sibptus.tomsk.ru>
 <CA+Y8hcNA9Pp02GTi24JYxuhvfTpDXPmWdx5nOawBwxgo56BKxg@mail.gmail.com>
 <20141006090844.GA36954@admin.sibptus.tomsk.ru>
 <CA+Y8hcNeG8tk1MLHzeuG8ERFDfZdrfYZZ5ArgkMXZRtWArnvtw@mail.gmail.com>
 <20141006153925.GA41918@admin.sibptus.tomsk.ru>
 <5432C152.6000505@treenet.co.nz>
 <20141007025214.GA51120@admin.sibptus.tomsk.ru>
 <30cd755eae1c431cb2ff622ed06ae795@SIXPR04MB304.apcprd04.prod.outlook.com>
 <20141007040832.GA51918@admin.sibptus.tomsk.ru>
Message-ID: <54337087.2050201@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 7/10/2014 5:08 p.m., Victor Sudakov wrote:
> James Harper wrote:
>>> No, adding Basic is not an option because I will have to
>>> provide special "proxy passwords" to the users, or make them
>>> enter their Windows passwords by hand. This is highly
>>> undesirable. Once they logon into Windows, they must have (or
>>> not have) Web access transparently.
>>> 
>>> If you know how to achieve SSO with Basic auth, please share.
>>> 
>> 
>> I have a few idea's for out-of-band SSO, some of which I have
>> experimented with...
> 
> [dd]
> 
>> 
>> 3. some bastardisation of identd. I've posted before about this. 
>> Identd assumes that the destination server is asking "who owns
>> this connection" and so only gives port numbers because the IP is
>> assumed from the ident connection (I have patched squid to fake
>> the source address of the destination server so it works in
>> transparent mode). Ident also has some serious security
>> shortcomings, but they wouldn't be hard to solve. This new ident
>> protocol would need:
> 
> I even know/use a couple of identd services for Windows, 
> http://sourceforge.net/projects/retinascan/ is a good one.
> 
> The sad irony is that ident lookups are also broken in squid34
> (the ident code leaks memory).
> 

With a patch. http://bugs.squid-cache.org/show_bug.cgi?id=3803.
The upstream version is also in there awaiting feedback on whether it
works before being applied to stables.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUM3CHAAoJELJo5wb/XPRjMfIIAIXasQD+Y7WA6ldfsa7bEFTX
2L6nXtxREvNdQsAn3upELguGL4iiN9q79TNlzcM8mRdVft0KujUUsos6B63KXEMA
8N60hwEIWL6XKBwtX8eVZfGWrLnkClnIOeyi/bSqVxzgCxjeySMlnY5ROYreWpH7
YFk8WxPUZocksVwk60mgxcSI2qolJoLV8p/PT0Z6ZX9pDl+V3VkGEjAw+i2XlRLM
nJgumYUO2BwCq5QPoFnM6UuFVBS51TEWXraQ9o/Iq+3vmaka3RAFtV1ech3s6RsP
ZJQwuaEcz61O6qisyru5I2V6qbuhbsAyrMyE0r9Jmb+xyioz6xJsddEEG6m2scQ=
=X9cz
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Tue Oct  7 04:53:44 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 07 Oct 2014 17:53:44 +1300
Subject: [squid-users] need to implement Large rock on squid ,
 but i need a squid3.head version dont hang !
In-Reply-To: <000001cfe13e$af4a5560$0ddf0020$@netstream.ps>
References: <000001cfe13e$af4a5560$0ddf0020$@netstream.ps>
Message-ID: <543371D8.7000508@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 6/10/2014 9:22 p.m., Ahmed Allzaeem wrote:
> Hi Guys ,
> 
> Im trying to use squid3.head  to get benefit of large rock.
> 
> I tried many times but I find that squid get hang after sometime.
> 

Since HEAD is "alpha" code version please try to debug why the hang is
happening and then report the problem found.
http://wiki.squid-cache.org/SquidFaq/BugReporting

Amose
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUM3HYAAoJELJo5wb/XPRjIKcIAIKqKtUI8p+JpsZvx2JFs904
X70STjSJ/EbhNSuwGK42o6HdFBfjU/DDLC/RF/FOZQAyVhb/fpa3gE2RXPDrNiCr
k97HmJ0/TOBgj1Vm0lH5RE/EQs3m2Grb5uIeFkgbus9nkhHf/DPjll4qMtDgSpCM
WpxVZ4OiJm+la1d8LivmaW2WpCyOwAcpT62cnSi661JzXDm7lO8g4PqjYfe3jQmW
7NcoQwKUGIcSvhrJ+96kR9HJx1OBNC7/sQRDF2IavypI8m/UHpKDhGGD/PHHkcHa
p7f+qJ7L3Pag4Xw5AdmFfa6/sZUf3NgzJoiHuVggfWrtDBtxy1w76rw8mxl3IeA=
=7chV
-----END PGP SIGNATURE-----


From sudakov at sibptus.tomsk.ru  Tue Oct  7 05:07:30 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Tue, 7 Oct 2014 12:07:30 +0700
Subject: [squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth
 broken?)
In-Reply-To: <54336F8F.7020209@treenet.co.nz>
References: <20141006082452.GA36136@admin.sibptus.tomsk.ru>
 <CA+Y8hcNA9Pp02GTi24JYxuhvfTpDXPmWdx5nOawBwxgo56BKxg@mail.gmail.com>
 <20141006090844.GA36954@admin.sibptus.tomsk.ru>
 <CA+Y8hcNeG8tk1MLHzeuG8ERFDfZdrfYZZ5ArgkMXZRtWArnvtw@mail.gmail.com>
 <20141006153925.GA41918@admin.sibptus.tomsk.ru>
 <5432C152.6000505@treenet.co.nz>
 <20141007025214.GA51120@admin.sibptus.tomsk.ru>
 <54335E01.2070904@treenet.co.nz>
 <20141007041659.GB51918@admin.sibptus.tomsk.ru>
 <54336F8F.7020209@treenet.co.nz>
Message-ID: <20141007050730.GA54394@admin.sibptus.tomsk.ru>

Amos Jeffries wrote:

[dd]

> > Apparently so, but as I said, the very same client software does
> > work with the old "ntlm_auth" helper and does not work with the
> > new ntlm_smb_lm_auth one.
> > 
> > That's why I am saying that the problem is on the authenticator
> > side and not on the client side.
> 
> The client is sending corrupt packets.
> Old authenticator did not check for the corruption. New one does.

Which renders the new authenticator useless, at least for me.

> 
> Client is still sending corrupt packets, which is why both the
> developers have said the problem is in the client.

The developers could have at least provided the option of
compatibility with the old bugs :) There is the old good programming
creed "be conservative about what you send and liberal about what you
receive".

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru


From squid3 at treenet.co.nz  Tue Oct  7 06:04:39 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 07 Oct 2014 19:04:39 +1300
Subject: [squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth
 broken?)
In-Reply-To: <20141007050730.GA54394@admin.sibptus.tomsk.ru>
References: <20141006082452.GA36136@admin.sibptus.tomsk.ru>
 <CA+Y8hcNA9Pp02GTi24JYxuhvfTpDXPmWdx5nOawBwxgo56BKxg@mail.gmail.com>
 <20141006090844.GA36954@admin.sibptus.tomsk.ru>
 <CA+Y8hcNeG8tk1MLHzeuG8ERFDfZdrfYZZ5ArgkMXZRtWArnvtw@mail.gmail.com>
 <20141006153925.GA41918@admin.sibptus.tomsk.ru>
 <5432C152.6000505@treenet.co.nz>
 <20141007025214.GA51120@admin.sibptus.tomsk.ru>
 <54335E01.2070904@treenet.co.nz>
 <20141007041659.GB51918@admin.sibptus.tomsk.ru>
 <54336F8F.7020209@treenet.co.nz>
 <20141007050730.GA54394@admin.sibptus.tomsk.ru>
Message-ID: <54338277.9000804@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 7/10/2014 6:07 p.m., Victor Sudakov wrote:
> Amos Jeffries wrote:
> 
> [dd]
> 
>>> Apparently so, but as I said, the very same client software
>>> does work with the old "ntlm_auth" helper and does not work
>>> with the new ntlm_smb_lm_auth one.
>>> 
>>> That's why I am saying that the problem is on the
>>> authenticator side and not on the client side.
>> 
>> The client is sending corrupt packets. Old authenticator did not
>> check for the corruption. New one does.
> 
> Which renders the new authenticator useless, at least for me.
> 
>> 
>> Client is still sending corrupt packets, which is why both the 
>> developers have said the problem is in the client.
> 
> The developers could have at least provided the option of 
> compatibility with the old bugs :) There is the old good
> programming creed "be conservative about what you send and liberal
> about what you receive".
> 

The packet *is* accepted. Its the security privileges which are denied.

If you want to accept anything the client sends regardless of the
credentials accuracy there is ntlm_fake_auth.


Using ntlm_fake_auth to retrieve the Windows user account name you can
use an external_acl_type helper to take that name and other
fixed-point details about the client machine (IP, port, ident? etc)
and assign access privileges for them more securely than SMB LM.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUM4J3AAoJELJo5wb/XPRj+jgH/0SiOGfD9aQoZKfHWXqQDZqo
0c0Mxx1jp3yyl4sJXYypNatUnSdJrH8KqVe49jPbjubbF+mwWxTvMBSDMlP1DXCa
mqt7DMn8dV2ZvC4L96mwj4UUbtMOEkEBgEkgmVOqg9gehawgBfsjgHvFlVz6zkwm
Fzo8WPSjcRLUW/4zD0CljS/wY3YhHqvfb+hkNZ+7He+z0OTFdsH+N4cVqRwwFSjF
78hUCGhPncISPL45szY3tAgUQtQmH+Aw7P3sDwuG8uNuED9NWVRf8iUBzfQL0PUK
nfHY/A+3qRTG3PQgke+Kmviktn2e9XNSI46Ivl8rqj2N9TXNJoBzChyCbN5bJOQ=
=o4ph
-----END PGP SIGNATURE-----


From sudakov at sibptus.tomsk.ru  Tue Oct  7 06:40:38 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Tue, 7 Oct 2014 13:40:38 +0700
Subject: [squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth
 broken?)
In-Reply-To: <54338277.9000804@treenet.co.nz>
References: <20141006090844.GA36954@admin.sibptus.tomsk.ru>
 <CA+Y8hcNeG8tk1MLHzeuG8ERFDfZdrfYZZ5ArgkMXZRtWArnvtw@mail.gmail.com>
 <20141006153925.GA41918@admin.sibptus.tomsk.ru>
 <5432C152.6000505@treenet.co.nz>
 <20141007025214.GA51120@admin.sibptus.tomsk.ru>
 <54335E01.2070904@treenet.co.nz>
 <20141007041659.GB51918@admin.sibptus.tomsk.ru>
 <54336F8F.7020209@treenet.co.nz>
 <20141007050730.GA54394@admin.sibptus.tomsk.ru>
 <54338277.9000804@treenet.co.nz>
Message-ID: <20141007064038.GA56722@admin.sibptus.tomsk.ru>

Amos Jeffries wrote:
> > 
> >>> Apparently so, but as I said, the very same client software
> >>> does work with the old "ntlm_auth" helper and does not work
> >>> with the new ntlm_smb_lm_auth one.
> >>> 
> >>> That's why I am saying that the problem is on the
> >>> authenticator side and not on the client side.
> >> 
> >> The client is sending corrupt packets. Old authenticator did not
> >> check for the corruption. New one does.
> > 
> > Which renders the new authenticator useless, at least for me.
> > 
> >> 
> >> Client is still sending corrupt packets, which is why both the 
> >> developers have said the problem is in the client.
> > 
> > The developers could have at least provided the option of 
> > compatibility with the old bugs :) There is the old good
> > programming creed "be conservative about what you send and liberal
> > about what you receive".
> > 
> 
> The packet *is* accepted. Its the security privileges which are denied.
> 
> If you want to accept anything the client sends regardless of the
> credentials accuracy there is ntlm_fake_auth.

No, ntlm_fake_auth does not work either. It keeps giving 

"HTTP/1.1 407 Proxy Authentication Required" 
Proxy-Authenticate: NTLM

and the browser keeps asking for user credentials. 
Authentication is never successful/complete with this plugin.

I'm attaching the debug log.


> Using ntlm_fake_auth to retrieve the Windows user account name you can
> use an external_acl_type helper to take that name and other
> fixed-point details about the client machine (IP, port, ident? etc)
> and assign access privileges for them more securely than SMB LM.

It would be a good idea if only ntlm_fake_auth worked.

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-------------- next part --------------
ntlm_fake_auth.cc(176): pid=44500 :(ntlm_fake_auth) build Sep 21 2014, 12:04:04 starting up...
ntlm_fake_auth.cc(195): pid=44500 :Got 'YR' from Squid with data:
[0000]   4E 54 4C 4D 53 53 50 00   01 00 00 00 07 82 08 A2   NTLMSSP. ........
[0010]   00 00 00 00 00 00 00 00   00 00 00 00 00 00 00 00   ........ ........
[0020]   05 01 28 0A 00 00 00 0F   00 00                     ........ ..
ntlm_fake_auth.cc(217): pid=44500 :sending 'TT' to squid with data:
[0000]   4E 54 4C 4D 53 53 50 00   02 00 00 00 09 00 09 00   NTLMSSP. ........
[0010]   28 00 00 00 07 82 08 A2   4E 9D 7A A4 CD 3E F1 0D   ........ N.z.....
[0020]   00 00 00 00 00 00 3A 00   57 4F 52 4B 47 52 4F 55   ........ WORKGROU
[0030]   50                                                  P
ntlm_fake_auth.cc(195): pid=44500 :Got 'YR' from Squid with data:
[0000]   4E 54 4C 4D 53 53 50 00   01 00 00 00 07 82 08 A2   NTLMSSP. ........
[0010]   00 00 00 00 00 00 00 00   00 00 00 00 00 00 00 00   ........ ........
[0020]   06 01 B1 1D 00 00 00 0F   00 00                     ........ ..
ntlm_fake_auth.cc(217): pid=44500 :sending 'TT' to squid with data:
[0000]   4E 54 4C 4D 53 53 50 00   02 00 00 00 09 00 09 00   NTLMSSP. ........
[0010]   28 00 00 00 07 82 08 A2   B0 9C FB 05 44 55 C0 B0   ........ ....DU..
[0020]   00 00 00 00 00 00 3A 00   57 4F 52 4B 47 52 4F 55   ........ WORKGROU
[0030]   50                                                  P
ntlm_fake_auth.cc(195): pid=44500 :Got 'YR' from Squid with data:
[0000]   4E 54 4C 4D 53 53 50 00   01 00 00 00 07 82 08 A2   NTLMSSP. ........
[0010]   00 00 00 00 00 00 00 00   00 00 00 00 00 00 00 00   ........ ........
[0020]   06 01 B1 1D 00 00 00 0F   00 00                     ........ ..
ntlm_fake_auth.cc(217): pid=44500 :sending 'TT' to squid with data:
[0000]   4E 54 4C 4D 53 53 50 00   02 00 00 00 09 00 09 00   NTLMSSP. ........
[0010]   28 00 00 00 07 82 08 A2   9E 39 F7 CA B8 D6 E3 5B   ........ .9......
[0020]   00 00 00 00 00 00 3A 00   57 4F 52 4B 47 52 4F 55   ........ WORKGROU
[0030]   50                                                  P
ntlm_fake_auth.cc(195): pid=44500 :Got 'YR' from Squid with data:
[0000]   4E 54 4C 4D 53 53 50 00   01 00 00 00 07 82 08 A2   NTLMSSP. ........
[0010]   00 00 00 00 00 00 00 00   00 00 00 00 00 00 00 00   ........ ........
[0020]   06 01 B1 1D 00 00 00 0F   00 00                     ........ ..
ntlm_fake_auth.cc(217): pid=44500 :sending 'TT' to squid with data:
[0000]   4E 54 4C 4D 53 53 50 00   02 00 00 00 09 00 09 00   NTLMSSP. ........
[0010]   28 00 00 00 07 82 08 A2   91 75 E8 52 06 47 96 B3   ........ .u.R.G..
[0020]   00 00 00 00 00 00 3A 00   57 4F 52 4B 47 52 4F 55   ........ WORKGROU
[0030]   50                                                  P
2014/10/07 13:33:26 kid1| Starting new ntlmauthenticator helpers...
2014/10/07 13:33:26 kid1| helperOpenServers: Starting 1/100 'ntlm_fake_auth' processes
ntlm_fake_auth.cc(176): pid=44513 :(ntlm_fake_auth) build Sep 21 2014, 12:04:04 starting up...
ntlm_fake_auth.cc(195): pid=44513 :Got 'YR' from Squid with data:
[0000]   4E 54 4C 4D 53 53 50 00   01 00 00 00 07 82 08 A2   NTLMSSP. ........
[0010]   00 00 00 00 00 00 00 00   00 00 00 00 00 00 00 00   ........ ........
[0020]   06 01 B1 1D 00 00 00 0F   00 00                     ........ ..
ntlm_fake_auth.cc(217): pid=44513 :sending 'TT' to squid with data:
[0000]   4E 54 4C 4D 53 53 50 00   02 00 00 00 09 00 09 00   NTLMSSP. ........
[0010]   28 00 00 00 07 82 08 A2   4E 9D 7A A4 CD 3E F1 0D   ........ N.z.....
[0020]   00 00 00 00 00 00 3A 00   57 4F 52 4B 47 52 4F 55   ........ WORKGROU
[0030]   50                                                  P
ntlm_fake_auth.cc(195): pid=44513 :Got 'KK' from Squid with data:
[0000]   4E 54 4C 4D 53 53 50 00   01 00 00 00 07 82 08 A2   NTLMSSP. ........
[0010]   00 00 00 00 00 00 00 00   00 00 00 00 00 00 00 00   ........ ........
[0020]   06 01 B1 1D 00 00 00 0F   00 00                     ........ ..
ntlmauth.cc(96): pid=44513 :ntlm_validate_packet: type is 1, wanted 3
ntlm_fake_auth.cc(237): pid=44513 :sending 'BH wrong packet type! user=' to squid
2014/10/07 13:34:28 kid1| ERROR: NTLM Authentication validating user. Result: {result=BH, notes={message: wrong packet type! user=; }}
ntlm_fake_auth.cc(195): pid=44500 :Got 'YR' from Squid with data:
[0000]   4E 54 4C 4D 53 53 50 00   01 00 00 00 07 82 08 A2   NTLMSSP. ........
[0010]   00 00 00 00 00 00 00 00   00 00 00 00 00 00 00 00   ........ ........
[0020]   06 01 B1 1D 00 00 00 0F   00 00                     ........ ..
ntlm_fake_auth.cc(217): pid=44500 :sending 'TT' to squid with data:
[0000]   4E 54 4C 4D 53 53 50 00   02 00 00 00 09 00 09 00   NTLMSSP. ........
[0010]   28 00 00 00 07 82 08 A2   DF 68 B2 DE A9 83 E3 DB   ........ .h......
[0020]   00 00 00 00 00 00 3A 00   57 4F 52 4B 47 52 4F 55   ........ WORKGROU
[0030]   50                                                  P

From alenchev at gmail.com  Fri Oct  3 08:12:36 2014
From: alenchev at gmail.com (Tiarasu)
Date: Fri, 3 Oct 2014 01:12:36 -0700 (PDT)
Subject: [squid-users] Assertion failed: forward.cc:784: "peer->use_ssl"
 when using an Squid parent.
Message-ID: <1412323956122-4667637.post@n4.nabble.com>

Hi all 

i Have this kind of network: 

1) A Squid "client" 3.3.13 with ssl-bump enabled transparent method. 
2) A Squid Proxy 3.3.13  act has "parent" that listens 3128 but not in 
transparent mode. It is just designed to retreive content directly from 
Internet. 

Browser ?> SSL ?>  Squid client + IPFW?>https_port 3128  intercept ?> Squid
parent + 3128 http_port 

When surfing to an SSL website the Squid client sends assertion failed: 
forward.cc:784: "peer->use_ssl". 

Why the the Squid Client did not want to perform just a "connect" method to 
the Squid Parent ? 


Best regards 



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Assertion-failed-forward-cc-784-peer-use-ssl-when-using-an-Squid-parent-tp4667637.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From sudakov at sibptus.tomsk.ru  Tue Oct  7 07:04:03 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Tue, 7 Oct 2014 14:04:03 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <20141006052346.GA32369@admin.sibptus.tomsk.ru>
References: <20141006040725.GA31642@admin.sibptus.tomsk.ru>
 <20141006052346.GA32369@admin.sibptus.tomsk.ru>
Message-ID: <20141007070403.GA57384@admin.sibptus.tomsk.ru>

Victor Sudakov wrote:
> > Well, I have tried negotiate_kerberos_auth with Firefox (Windows) 
> 
> I have tried the same with MSIE 8 (Windows).

After some adjustment to domain group policies, the Windows host is
at last requesting and successfully receiving the ticket for the proxy
service.  Wireshark output:

User Datagram Protocol, Src Port: kerberos (88), Dst Port: dellpwrappks (1266)
Kerberos TGS-REP
    Pvno: 5
    MSG Type: TGS-REP (13)
    Client Realm: SIBPTUS.TRANSNEFT.RU
    Client Name (Principal): vas-adm
    Ticket
        Tkt-vno: 5
        Realm: SIBPTUS.TRANSNEFT.RU
        Server Name (Service and Instance): HTTP/proxy.sibptus.transneft.ru
        enc-part rc4-hmac
            Encryption type: rc4-hmac (23)
            enc-part: 3e0fc357a26db7dcdb0a5b6436b56f9c96d15ad7626eea08...
    enc-part rc4-hmac
        Encryption type: rc4-hmac (23)
        Kvno: 1
        enc-part: db8c9ea1bf85c4bb5005103765767b692ed3c0f247c23d48...

The corresponding Kerberos principal is put into the keytab:
/usr/local/etc/squid/squid.keytab:

Vno  Type                     Principal
  1  des-cbc-crc              HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  des-cbc-md5              HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  arcfour-hmac-md5         HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  aes256-cts-hmac-sha1-96  HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  aes128-cts-hmac-sha1-96  HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU

The permissions on the keytab are correct. Squid receives it via the
environment:

env KRB5_KTNAME=/usr/local/etc/squid/squid.keytab \
        KRB5_CONFIG=/usr/local/etc/squid/krb5.conf \
        squid -f /usr/local/etc/squid/squid-test.conf

However, then actual autthentication begins, it fails with the:
"ERROR: gss_acquire_cred() failed:  No credentials were
supplied, or the credentials were unavailable or inaccessible..
unknown mech-code 0 for mech unknown"

If someone finds something familiar in the below debug output, or can
low-level debug actual kerberos, could you please let me know. Thanks
a lot in advance for any help.

negotiate_kerberos_auth.cc(212): pid=40984 :2014/10/07 13:12:08| negotiate_kerberos_auth: INFO: Starting version 3.0.4sq
negotiate_kerberos_auth.cc(258): pid=40980 :2014/10/07 13:12:37| negotiate_kerberos_auth: DEBUG: Got 'YR YIIFGAYGKwYBBQUCoIIFDDCCBQigJDAiBgkqhkiC9xIBAgIGCSqGSIb3EgECAgYKKwYBBAGCNwICCqKCBN4EggTaYIIE1gYJKoZIhvcSAQICAQBuggTFMIIEwaADAgEFoQMCAQ6iBwMFACAAAACjggPpYYID5TCCA+GgAwIBBaEWGxRTSUJQVFVTLlRSQU5TTkVGVC5SVaItMCugAwIBAqEkMCIbBEhUVFAbGnByb3h5LnNpYnB0dXMudHJhbnNuZWZ0LnJ1o4IDkTCCA42gAwIBA6KCA4QEggOAB8tiAa54xI00BfngMyI8cwFHbNKRZPVn1c/HKYPi4Dppq0fIjp2e5br7rHG51+1/w6zaDwHKqdtnpWh/OplOkn6tDNq0H2fi/jFeT0XKICrLxdpmDHRqNmiyxvtczdkcSyxXJ2254oM9VwuE39D8hqU58NmijTB+WQupz2hw4d+5euIFFwSSO8nD3CMaBVGgyNfp9YvUUy860L+KKEqb0LVXZ+/OsnlsyrEc3AaaXwSwS30+ZRv0jCLh1h7kc84XFPrjGqRPp7JmO5gUCF8k/GXNF3FAMBAaT4r/iAs8LFIixQiRUWJPtjcWAtH0Q3JumqB9Enm+JPNvGBvE83YvbBZtDJQ0uc5lOMVLavBh2Xgj86BmKlCsrOCiMoQ8SgsEAX6o110EeMI1Tef8t+2/WhzP39l5BGuXmdDA1zEmqzA83vvTy5JcKUXZ3IdwwJ4I+kW62qIMsceZ/hfdj/Iy+RjCNrum5FHXMDszMVacKHp9kJTMofuMhhOKD2o+Z91TWTkEwD3NNWGjTWdgECpJT/F7I1x35iQaLGvgLebpalPJEXY8A8od1HhXZaCkIPXcDoPUR1LTTk8bHYKan17EnOBf0CbjOkU8/ib2mLUL81RQHrt6vdTcXzxsAgoZYigptd/ilsXq0dbwjTuZP8ZcFFY+levmSPIn5TF5xZtmtymditNO28hSqDjxC2Lpoy65kqwXglxpijuicSXC4cC/O1TBbksyH/aw/7MbNTKupFpovZTensu/A6zYG3HCjKW9QBsgU4tBXRC6rTP0RAeuASUHpvHv4WhbS5AWNYmX1TNQ8QpfurM2tAzuFzYQN8LL3VT38o4SVK+visE9q1IGez70q9g6Naowvpp6g/h3FuCzUks2ydXchKNPe3KzuSJqzmkLlyjKMlVW8sYUwgKXqNsgi7aRArEfu0L3UqYG/7lao+QLDOBf5+uSzWarZ9IIS7ClIRBejXU7erVJrLBDlGZRbMu+hXacsGwv/1Ls+S8xCxnlRjQngHjLg8vvQBYslgvkMh77eyP+HjiUDOXqDYoDR5bIc/w5UX/Dvb4ECGiqhGd9UHHQkYn6NQnbO/2r+iVBdy1fvXhXE2LKgAFoQtf2tIqsTUZWv12O82X2KzcZJ7IEVMxbGtSj9cdncc16c5Y6DL9AzQryNIhSGxghZ7zyWwp4DBS19ru4l+dVQ4ikgb4wgbugAwIBA6KBswSBsGrVgYewQbJlk43Aw0ujMajwCinYuDDsW9b7I1gCa41ShWl0xSQ6MfkhuPDbcJO6TK6nTYyxSbWMtxo2eiMOehg+bHo5HUUCGyvRCNRnJFcJLP3GAqh8Ogjx9zY4/YcVb8c/eFM/BiBKHw41T4a0fR6scB9GKDjT8vDa4ysgGeEjeiPh+PjDSTS/y/CWrin97xXwrdUbsWbhuxHQ66HZ9rEJoZFb8oxtHgnqyEgMbwdO' from squid (length: 1747).
negotiate_kerberos_auth.cc(311): pid=40980 :2014/10/07 13:12:37| negotiate_kerberos_auth: DEBUG: Decode 'YIIFGAYGKwYBBQUCoIIFDDCCBQigJDAiBgkqhkiC9xIBAgIGCSqGSIb3EgECAgYKKwYBBAGCNwICCqKCBN4EggTaYIIE1gYJKoZIhvcSAQICAQBuggTFMIIEwaADAgEFoQMCAQ6iBwMFACAAAACjggPpYYID5TCCA+GgAwIBBaEWGxRTSUJQVFVTLlRSQU5TTkVGVC5SVaItMCugAwIBAqEkMCIbBEhUVFAbGnByb3h5LnNpYnB0dXMudHJhbnNuZWZ0LnJ1o4IDkTCCA42gAwIBA6KCA4QEggOAB8tiAa54xI00BfngMyI8cwFHbNKRZPVn1c/HKYPi4Dppq0fIjp2e5br7rHG51+1/w6zaDwHKqdtnpWh/OplOkn6tDNq0H2fi/jFeT0XKICrLxdpmDHRqNmiyxvtczdkcSyxXJ2254oM9VwuE39D8hqU58NmijTB+WQupz2hw4d+5euIFFwSSO8nD3CMaBVGgyNfp9YvUUy860L+KKEqb0LVXZ+/OsnlsyrEc3AaaXwSwS30+ZRv0jCLh1h7kc84XFPrjGqRPp7JmO5gUCF8k/GXNF3FAMBAaT4r/iAs8LFIixQiRUWJPtjcWAtH0Q3JumqB9Enm+JPNvGBvE83YvbBZtDJQ0uc5lOMVLavBh2Xgj86BmKlCsrOCiMoQ8SgsEAX6o110EeMI1Tef8t+2/WhzP39l5BGuXmdDA1zEmqzA83vvTy5JcKUXZ3IdwwJ4I+kW62qIMsceZ/hfdj/Iy+RjCNrum5FHXMDszMVacKHp9kJTMofuMhhOKD2o+Z91TWTkEwD3NNWGjTWdgECpJT/F7I1x35iQaLGvgLebpalPJEXY8A8od1HhXZaCkIPXcDoPUR1LTTk8bHYKan17EnOBf0CbjOkU8/ib2mLUL81RQHrt6vdTcXzxsAgoZYigptd/ilsXq0dbwjTuZP8ZcFFY+levmSPIn5TF5xZtmtymditNO28hSqDjxC2Lpoy65kqwXglxpijuicSXC4cC/O1TBbksyH/aw/7MbNTKupFpovZTensu/A6zYG3HCjKW9QBsgU4tBXRC6rTP0RAeuASUHpvHv4WhbS5AWNYmX1TNQ8QpfurM2tAzuFzYQN8LL3VT38o4SVK+visE9q1IGez70q9g6Naowvpp6g/h3FuCzUks2ydXchKNPe3KzuSJqzmkLlyjKMlVW8sYUwgKXqNsgi7aRArEfu0L3UqYG/7lao+QLDOBf5+uSzWarZ9IIS7ClIRBejXU7erVJrLBDlGZRbMu+hXacsGwv/1Ls+S8xCxnlRjQngHjLg8vvQBYslgvkMh77eyP+HjiUDOXqDYoDR5bIc/w5UX/Dvb4ECGiqhGd9UHHQkYn6NQnbO/2r+iVBdy1fvXhXE2LKgAFoQtf2tIqsTUZWv12O82X2KzcZJ7IEVMxbGtSj9cdncc16c5Y6DL9AzQryNIhSGxghZ7zyWwp4DBS19ru4l+dVQ4ikgb4wgbugAwIBA6KBswSBsGrVgYewQbJlk43Aw0ujMajwCinYuDDsW9b7I1gCa41ShWl0xSQ6MfkhuPDbcJO6TK6nTYyxSbWMtxo2eiMOehg+bHo5HUUCGyvRCNRnJFcJLP3GAqh8Ogjx9zY4/YcVb8c/eFM/BiBKHw41T4a0fR6scB9GKDjT8vDa4ysgGeEjeiPh+PjDSTS/y/CWrin97xXwrdUbsWbhuxHQ66HZ9rEJoZFb8oxtHgnqyEgMbwdO' (decoded length: 1308).
negotiate_kerberos_auth.cc(128): pid=40980 :2014/10/07 13:12:37| negotiate_kerberos_auth: ERROR: gss_acquire_cred() failed:  No credentials were supplied, or the credentials were unavailable or inaccessible.. unknown mech-code 0 for mech unknown
2014/10/07 13:12:37 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: gss_acquire_cred() failed:  No credentials were supplied, or the credentials were unavailable or inaccessible.. unknown mech-code 0 for mech unknown; }}

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-------------- next part --------------
negotiate_kerberos_auth.cc(212): pid=40984 :2014/10/07 13:12:08| negotiate_kerberos_auth: INFO: Starting version 3.0.4sq
negotiate_kerberos_auth.cc(258): pid=40980 :2014/10/07 13:12:37| negotiate_kerberos_auth: DEBUG: Got 'YR YIIFGAYGKwYBBQUCoIIFDDCCBQigJDAiBgkqhkiC9xIBAgIGCSqGSIb3EgECAgYKKwYBBAGCNwICCqKCBN4EggTaYIIE1gYJKoZIhvcSAQICAQBuggTFMIIEwaADAgEFoQMCAQ6iBwMFACAAAACjggPpYYID5TCCA+GgAwIBBaEWGxRTSUJQVFVTLlRSQU5TTkVGVC5SVaItMCugAwIBAqEkMCIbBEhUVFAbGnByb3h5LnNpYnB0dXMudHJhbnNuZWZ0LnJ1o4IDkTCCA42gAwIBA6KCA4QEggOAB8tiAa54xI00BfngMyI8cwFHbNKRZPVn1c/HKYPi4Dppq0fIjp2e5br7rHG51+1/w6zaDwHKqdtnpWh/OplOkn6tDNq0H2fi/jFeT0XKICrLxdpmDHRqNmiyxvtczdkcSyxXJ2254oM9VwuE39D8hqU58NmijTB+WQupz2hw4d+5euIFFwSSO8nD3CMaBVGgyNfp9YvUUy860L+KKEqb0LVXZ+/OsnlsyrEc3AaaXwSwS30+ZRv0jCLh1h7kc84XFPrjGqRPp7JmO5gUCF8k/GXNF3FAMBAaT4r/iAs8LFIixQiRUWJPtjcWAtH0Q3JumqB9Enm+JPNvGBvE83YvbBZtDJQ0uc5lOMVLavBh2Xgj86BmKlCsrOCiMoQ8SgsEAX6o110EeMI1Tef8t+2/WhzP39l5BGuXmdDA1zEmqzA83vvTy5JcKUXZ3IdwwJ4I+kW62qIMsceZ/hfdj/Iy+RjCNrum5FHXMDszMVacKHp9kJTMofuMhhOKD2o+Z91TWTkEwD3NNWGjTWdgECpJT/F7I1x35iQaLGvgLebpalPJEXY8A8od1HhXZaCkIPXcDoPUR1LTTk8bHYKan17EnOBf0CbjOkU8/ib2mLUL81RQHrt6vdTcXzxsAgoZYigptd/ilsXq0dbwjTuZP8ZcFFY+levmSPIn5TF5xZtmtymditNO28hSqDjxC2Lpoy65kqwXglxpijuicSXC4cC/O1TBbksyH/aw/7MbNTKupFpovZTensu/A6zYG3HCjKW9QBsgU4tBXRC6rTP0RAeuASUHpvHv4WhbS5AWNYmX1TNQ8QpfurM2tAzuFzYQN8LL3VT38o4SVK+visE9q1IGez70q9g6Naowvpp6g/h3FuCzUks2ydXchKNPe3KzuSJqzmkLlyjKMlVW8sYUwgKXqNsgi7aRArEfu0L3UqYG/7lao+QLDOBf5+uSzWarZ9IIS7ClIRBejXU7erVJrLBDlGZRbMu+hXacsGwv/1Ls+S8xCxnlRjQngHjLg8vvQBYslgvkMh77eyP+HjiUDOXqDYoDR5bIc/w5UX/Dvb4ECGiqhGd9UHHQkYn6NQnbO/2r+iVBdy1fvXhXE2LKgAFoQtf2tIqsTUZWv12O82X2KzcZJ7IEVMxbGtSj9cdncc16c5Y6DL9AzQryNIhSGxghZ7zyWwp4DBS19ru4l+dVQ4ikgb4wgbugAwIBA6KBswSBsGrVgYewQbJlk43Aw0ujMajwCinYuDDsW9b7I1gCa41ShWl0xSQ6MfkhuPDbcJO6TK6nTYyxSbWMtxo2eiMOehg+bHo5HUUCGyvRCNRnJFcJLP3GAqh8Ogjx9zY4/YcVb8c/eFM/BiBKHw41T4a0fR6scB9GKDjT8vDa4ysgGeEjeiPh+PjDSTS/y/CWrin97xXwrdUbsWbhuxHQ66HZ9rEJoZFb8oxtHgnqyEgMbwdO' from squid (length: 1747).
negotiate_kerberos_auth.cc(311): pid=40980 :2014/10/07 13:12:37| negotiate_kerberos_auth: DEBUG: Decode 'YIIFGAYGKwYBBQUCoIIFDDCCBQigJDAiBgkqhkiC9xIBAgIGCSqGSIb3EgECAgYKKwYBBAGCNwICCqKCBN4EggTaYIIE1gYJKoZIhvcSAQICAQBuggTFMIIEwaADAgEFoQMCAQ6iBwMFACAAAACjggPpYYID5TCCA+GgAwIBBaEWGxRTSUJQVFVTLlRSQU5TTkVGVC5SVaItMCugAwIBAqEkMCIbBEhUVFAbGnByb3h5LnNpYnB0dXMudHJhbnNuZWZ0LnJ1o4IDkTCCA42gAwIBA6KCA4QEggOAB8tiAa54xI00BfngMyI8cwFHbNKRZPVn1c/HKYPi4Dppq0fIjp2e5br7rHG51+1/w6zaDwHKqdtnpWh/OplOkn6tDNq0H2fi/jFeT0XKICrLxdpmDHRqNmiyxvtczdkcSyxXJ2254oM9VwuE39D8hqU58NmijTB+WQupz2hw4d+5euIFFwSSO8nD3CMaBVGgyNfp9YvUUy860L+KKEqb0LVXZ+/OsnlsyrEc3AaaXwSwS30+ZRv0jCLh1h7kc84XFPrjGqRPp7JmO5gUCF8k/GXNF3FAMBAaT4r/iAs8LFIixQiRUWJPtjcWAtH0Q3JumqB9Enm+JPNvGBvE83YvbBZtDJQ0uc5lOMVLavBh2Xgj86BmKlCsrOCiMoQ8SgsEAX6o110EeMI1Tef8t+2/WhzP39l5BGuXmdDA1zEmqzA83vvTy5JcKUXZ3IdwwJ4I+kW62qIMsceZ/hfdj/Iy+RjCNrum5FHXMDszMVacKHp9kJTMofuMhhOKD2o+Z91TWTkEwD3NNWGjTWdgECpJT/F7I1x35iQaLGvgLebpalPJEXY8A8od1HhXZaCkIPXcDoPUR1LTTk8bHYKan17EnOBf0CbjOkU8/ib2mLUL81RQHrt6vdTcXzxsAgoZYigptd/ilsXq0dbwjTuZP8ZcFFY+levmSPIn5TF5xZtmtymditNO28hSqDjxC2Lpoy65kqwXglxpijuicSXC4cC/O1TBbksyH/aw/7MbNTKupFpovZTensu/A6zYG3HCjKW9QBsgU4tBXRC6rTP0RAeuASUHpvHv4WhbS5AWNYmX1TNQ8QpfurM2tAzuFzYQN8LL3VT38o4SVK+visE9q1IGez70q9g6Naowvpp6g/h3FuCzUks2ydXchKNPe3KzuSJqzmkLlyjKMlVW8sYUwgKXqNsgi7aRArEfu0L3UqYG/7lao+QLDOBf5+uSzWarZ9IIS7ClIRBejXU7erVJrLBDlGZRbMu+hXacsGwv/1Ls+S8xCxnlRjQngHjLg8vvQBYslgvkMh77eyP+HjiUDOXqDYoDR5bIc/w5UX/Dvb4ECGiqhGd9UHHQkYn6NQnbO/2r+iVBdy1fvXhXE2LKgAFoQtf2tIqsTUZWv12O82X2KzcZJ7IEVMxbGtSj9cdncc16c5Y6DL9AzQryNIhSGxghZ7zyWwp4DBS19ru4l+dVQ4ikgb4wgbugAwIBA6KBswSBsGrVgYewQbJlk43Aw0ujMajwCinYuDDsW9b7I1gCa41ShWl0xSQ6MfkhuPDbcJO6TK6nTYyxSbWMtxo2eiMOehg+bHo5HUUCGyvRCNRnJFcJLP3GAqh8Ogjx9zY4/YcVb8c/eFM/BiBKHw41T4a0fR6scB9GKDjT8vDa4ysgGeEjeiPh+PjDSTS/y/CWrin97xXwrdUbsWbhuxHQ66HZ9rEJoZFb8oxtHgnqyEgMbwdO' (decoded length: 1308).
negotiate_kerberos_auth.cc(128): pid=40980 :2014/10/07 13:12:37| negotiate_kerberos_auth: ERROR: gss_acquire_cred() failed:  No credentials were supplied, or the credentials were unavailable or inaccessible.. unknown mech-code 0 for mech unknown
2014/10/07 13:12:37 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: gss_acquire_cred() failed:  No credentials were supplied, or the credentials were unavailable or inaccessible.. unknown mech-code 0 for mech unknown; }}

From squid3 at treenet.co.nz  Tue Oct  7 07:31:36 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 07 Oct 2014 20:31:36 +1300
Subject: [squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth
 broken?)
In-Reply-To: <20141007064038.GA56722@admin.sibptus.tomsk.ru>
References: <20141006090844.GA36954@admin.sibptus.tomsk.ru>
 <CA+Y8hcNeG8tk1MLHzeuG8ERFDfZdrfYZZ5ArgkMXZRtWArnvtw@mail.gmail.com>
 <20141006153925.GA41918@admin.sibptus.tomsk.ru>
 <5432C152.6000505@treenet.co.nz>
 <20141007025214.GA51120@admin.sibptus.tomsk.ru>
 <54335E01.2070904@treenet.co.nz>
 <20141007041659.GB51918@admin.sibptus.tomsk.ru>
 <54336F8F.7020209@treenet.co.nz>
 <20141007050730.GA54394@admin.sibptus.tomsk.ru>
 <54338277.9000804@treenet.co.nz>
 <20141007064038.GA56722@admin.sibptus.tomsk.ru>
Message-ID: <543396D8.4080101@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 7/10/2014 7:40 p.m., Victor Sudakov wrote:
> Amos Jeffries wrote:
>>> 
>>>>> Apparently so, but as I said, the very same client
>>>>> software does work with the old "ntlm_auth" helper and does
>>>>> not work with the new ntlm_smb_lm_auth one.
>>>>> 
>>>>> That's why I am saying that the problem is on the 
>>>>> authenticator side and not on the client side.
>>>> 
>>>> The client is sending corrupt packets. Old authenticator did
>>>> not check for the corruption. New one does.
>>> 
>>> Which renders the new authenticator useless, at least for me.
>>> 
>>>> 
>>>> Client is still sending corrupt packets, which is why both
>>>> the developers have said the problem is in the client.
>>> 
>>> The developers could have at least provided the option of 
>>> compatibility with the old bugs :) There is the old good 
>>> programming creed "be conservative about what you send and
>>> liberal about what you receive".
>>> 
>> 
>> The packet *is* accepted. Its the security privileges which are
>> denied.
>> 
>> If you want to accept anything the client sends regardless of
>> the credentials accuracy there is ntlm_fake_auth.
> 
> No, ntlm_fake_auth does not work either. It keeps giving
> 
> "HTTP/1.1 407 Proxy Authentication Required" Proxy-Authenticate:
> NTLM
> 
> and the browser keeps asking for user credentials. Authentication
> is never successful/complete with this plugin.
> 
> I'm attaching the debug log.
> 

Interesting log. Can you get a full-body packet trace to me privately?
That is captured by using tcpdump -s 0 or -s 65535 option.

And if possible the full cache.log contents?

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUM5bYAAoJELJo5wb/XPRjfi0H/i3V2R1edHKPnHJLKYMFIZuE
xgxK/bmX4HB7N8/KAKEsUXMzcWu5sNVzrFAJUwUQpeNvwQ206uocwM0DzPAIJSox
bbCFJsWzKQ5b5JcQKHlVhny8UCLRY5Bb/fqI5QUHEn1py6mK1Y6fErkLkuX2Jb+l
MXx5UVE3wnHVpA/vUL5LmUAgJcPalfxiO6jKzY0SU8hycGkb8PNOLff1ew1Yagmc
obKOw3GcLSR3FhpcNCL0ocCfI8UbGff24RpouH8B7NoGzmSDU1LfZuQ+TwXc5oDv
2xXWMmscfUMG5o0tUJuOVSuCEnPqpvbHjHP+o/E6cJtDmDn9BggZYqKn0eGwjAo=
=w656
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Tue Oct  7 07:45:50 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 07 Oct 2014 20:45:50 +1300
Subject: [squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth
 broken?)
In-Reply-To: <543396D8.4080101@treenet.co.nz>
References: <20141006090844.GA36954@admin.sibptus.tomsk.ru>
 <CA+Y8hcNeG8tk1MLHzeuG8ERFDfZdrfYZZ5ArgkMXZRtWArnvtw@mail.gmail.com>
 <20141006153925.GA41918@admin.sibptus.tomsk.ru>
 <5432C152.6000505@treenet.co.nz>
 <20141007025214.GA51120@admin.sibptus.tomsk.ru>
 <54335E01.2070904@treenet.co.nz>
 <20141007041659.GB51918@admin.sibptus.tomsk.ru>
 <54336F8F.7020209@treenet.co.nz>
 <20141007050730.GA54394@admin.sibptus.tomsk.ru>
 <54338277.9000804@treenet.co.nz>
 <20141007064038.GA56722@admin.sibptus.tomsk.ru>
 <543396D8.4080101@treenet.co.nz>
Message-ID: <54339A2E.4080808@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 7/10/2014 8:31 p.m., Amos Jeffries wrote:
> On 7/10/2014 7:40 p.m., Victor Sudakov wrote:
>> Amos Jeffries wrote:
>>>> 
>>>>>> Apparently so, but as I said, the very same client 
>>>>>> software does work with the old "ntlm_auth" helper and
>>>>>> does not work with the new ntlm_smb_lm_auth one.
>>>>>> 
>>>>>> That's why I am saying that the problem is on the 
>>>>>> authenticator side and not on the client side.
>>>>> 
>>>>> The client is sending corrupt packets. Old authenticator
>>>>> did not check for the corruption. New one does.
>>>> 
>>>> Which renders the new authenticator useless, at least for
>>>> me.
>>>> 
>>>>> 
>>>>> Client is still sending corrupt packets, which is why both 
>>>>> the developers have said the problem is in the client.
>>>> 
>>>> The developers could have at least provided the option of 
>>>> compatibility with the old bugs :) There is the old good 
>>>> programming creed "be conservative about what you send and 
>>>> liberal about what you receive".
>>>> 
>>> 
>>> The packet *is* accepted. Its the security privileges which
>>> are denied.
>>> 
>>> If you want to accept anything the client sends regardless of 
>>> the credentials accuracy there is ntlm_fake_auth.
> 
>> No, ntlm_fake_auth does not work either. It keeps giving
> 
>> "HTTP/1.1 407 Proxy Authentication Required" Proxy-Authenticate: 
>> NTLM
> 
>> and the browser keeps asking for user credentials.
>> Authentication is never successful/complete with this plugin.
> 
>> I'm attaching the debug log.
> 
> 
> Interesting log. Can you get a full-body packet trace to me
> privately? That is captured by using tcpdump -s 0 or -s 65535
> option.
> 
> And if possible the full cache.log contents?

Actually please run the fake-auth helper from 3.4.* with parameter -dv
when doing that. It will dump the relevant NTLM details to cache.log.


If you can also get a similar pair of traces from the SMB LM helper
with option -d it might help investigation that issue as well.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUM5ouAAoJELJo5wb/XPRjJewIANMi9E9qlv6k5zdDSf+w14T9
AZtC/QEYKXl8cJU37BBy+bBqtAkXfd3XWJb7CNgDPc3UPFw6WS7caayybG+Eo5A4
bW1dT2hslViPN1Pt9GwFm1y8Xnoqm6+Fg0R8T7fTXBfQHyjxb7g4t5fo8lOqYUp1
r/9HQvJFaFjUPRQAp2lZJY/zLKpt3Vvz/Ch8t0ic6DMMtl3cA2QTLOGvy4bbHVLl
NyRW0NuKYeU+Ek4DemlM/7y1eAZGaDCD8RwXGx9T01BpN5QI1dSQCbmuHhbtQsmH
cXyxrd8m95qZ3ThB+Cnegk2ptQBemWXnZgvVsACzcZmca56W7rsiWGD8D7KZW2c=
=4dfw
-----END PGP SIGNATURE-----


From sudakov at sibptus.tomsk.ru  Tue Oct  7 07:49:40 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Tue, 7 Oct 2014 14:49:40 +0700
Subject: [squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth
 broken?)
In-Reply-To: <543396D8.4080101@treenet.co.nz>
References: <20141006153925.GA41918@admin.sibptus.tomsk.ru>
 <5432C152.6000505@treenet.co.nz>
 <20141007025214.GA51120@admin.sibptus.tomsk.ru>
 <54335E01.2070904@treenet.co.nz>
 <20141007041659.GB51918@admin.sibptus.tomsk.ru>
 <54336F8F.7020209@treenet.co.nz>
 <20141007050730.GA54394@admin.sibptus.tomsk.ru>
 <54338277.9000804@treenet.co.nz>
 <20141007064038.GA56722@admin.sibptus.tomsk.ru>
 <543396D8.4080101@treenet.co.nz>
Message-ID: <20141007074940.GA58673@admin.sibptus.tomsk.ru>

Amos Jeffries wrote:
> Interesting log. Can you get a full-body packet trace to me privately?
> That is captured by using tcpdump -s 0 or -s 65535 option.
> 
> And if possible the full cache.log contents?
> 

With pleasure. 

Can I have your PGP key please?

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru


From crazyworld at outlook.com  Tue Oct  7 07:55:52 2014
From: crazyworld at outlook.com (CW)
Date: Tue, 7 Oct 2014 15:55:52 +0800
Subject: [squid-users] https issues for google
In-Reply-To: <2329B68B3D676246BA0D1149E22F509F01A02886@bneseqs20.bradnams.com.au>
References: <2329B68B3D676246BA0D1149E22F509F01A02886@bneseqs20.bradnams.com.au>
Message-ID: <BLU436-SMTP422B3B37D21D8B91465952CDA20@phx.gbl>

Either find the error from the log file or run tcpdump to capture the 
traffic to start with.

- CW
On 10/7/2014 11:51 AM, glenn.groves at bradnams.com.au wrote:
> Hi All,
>
> We have a weird issue where https sites apparently don't respond (get message "this page can't be displayed"). This mainly affects google websites and to a lesser affect youtube. It has been reported it may have affected some banking sites but this is unconfirmed. We are running centos 6.5 with up to date squid from the centos repositories.
>
> Here is the version of squid:
> yum list installed | grep squid
> squid.x86_64                         7:3.1.10-20.el6_5.3
>
> The https sites work fine if I put a direct hole in the firewall to allow internet traffic directly out - but this is not a solution.
>
> Thanks, Glenn
>
> Below is the conf file:
>
> ### /etc/squid/squid.conf Configuration File ####
>
> ### cache manager
> cache_mgr somone at email.com
>
> ### negotiate kerberos and ntlm authentication
> auth_param negotiate program /usr/local/bin/negotiate_wrapper -d --ntlm /usr/bin/ntlm_auth --diagnostics --helper-protocol=squid-2.5-ntlmssp --domain=DOMAIN --kerberos /usr/lib64/squid/squid_kerb_auth -i -d -s HTTP/proxycen.email.com
> auth_param negotiate children 50
> auth_param negotiate keep_alive off
>
> ### pure ntlm authentication
> auth_param ntlm program /usr/bin/ntlm_auth --diagnostics --helper-protocol=squid-2.5-ntlmssp --domain=DOMAIN
> auth_param ntlm children 200
> # auth_param ntlm max_challenge_lifetime 5 minutes
> auth_param ntlm keep_alive off
>
> ### provide basic authentication via ldap for clients not authenticated via kerberos/ntlm
> auth_param basic program /usr/lib64/squid/squid_ldap_auth -R -b "dc=DOMAIN,dc=com " -D squid at email.com -W /etc/squid/ldappass.txt -f sAMAccountName=%s -h SERVER.email.com
> auth_param basic children 100
> auth_param basic realm Internet Proxy
> auth_param basic credentialsttl 1 minute
>
> ### ldap authorisation
> # external_acl_type memberof children=300 %LOGIN /usr/lib64/squid/squid_ldap_group -R -K -b "dc=DOMAIN,dc=com,dc=au" -D squid at email.com -W /etc/squid/ldappass.txt -f "(&(objectclass=person)(sAMAccountName=%v)(memberof=cn=%g, ou=Internet,ou=DOMAIN Groups,ou=DOMAIN,dc=DOMAIN,dc=com,dc=au))" -h SERVER.email.com
>
> ### Squid Cache Manager
> cachemgr_passwd none info
>
> cache_dir aufs /var/spool/squid 30000 16 256
> minimum_object_size 2 KB
> maximum_object_size 10 MB
> cache_swap_low 95
> cache_swap_high 97
>
> ### acl for proxy auth and ldap authorizations
> acl SSL method CONNECT
> acl allowedsites        dstdomain "/etc/squid/allowedsites.txt"
> acl auth proxy_auth REQUIRED
> #   aclname             acltype  typename activedirectorygroup
> # acl BlockedAccess       external memberof "/etc/squid/blocked_access.txt"
> # acl RestrictedAccess    external memberof "/etc/squid/restricted_access.txt"
> # acl StandardAccess      external memberof "/etc/squid/standard_access.txt"
> # acl ExceptionAccess     external memberof "/etc/squid/exception_access.txt"
> # acl FullAccess          external memberof "/etc/squid/full_access.txt"
> # acl AnonymousAccess     external memberof "/etc/squid/anonymous_access.txt"
> # acl allowedsites        dstdomain "/etc/squid/allowedsites.txt"
> # acl blockedsites        dstdomain "/etc/squid/blockedsites.txt"
> # acl exceptedsites       dstdomain "/etc/squid/exceptedsites.txt"
> acl prioritysites       dstdomain "/etc/squid/prioritysites.txt"
>
> ### squid defaults
> acl manager proto cache_object
> acl localhost src 127.0.0.1/32 ::1
> acl allowedsite124 src 192.168.124.0/24
> acl to_localhost dst 127.0.0.0/8 0.0.0.0/32 ::1
> acl SSL_ports port 443
> acl Safe_ports port 80          # http
> acl Safe_ports port 21          # ftp
> acl Safe_ports port 443         # https
> acl Safe_ports port 70          # gopher
> acl Safe_ports port 210         # wais
> acl Safe_ports port 1025-65535  # unregistered ports
> acl Safe_ports port 280         # http-mgmt
> acl Safe_ports port 488         # gss-http
> acl Safe_ports port 591         # filemaker
> acl Safe_ports port 777         # multiling http
> acl Safe_ports port 17500       # dropbox
> #http_access deny CONNECT !SSL_ports
> #http_access allow SSL_ports
> http_access allow allowedsites
> acl CONNECT method CONNECT
> acl cacheadmin src 192.168.11.221 192.168.8.175
> http_access allow manager localhost
> http_access allow manager cacheadmin
> http_access deny manager
> http_access deny !Safe_ports
> http_access deny CONNECT !SSL_ports
> http_access allow localhost
>
> ### http_access rules
> # allow unrestricted access to prioritysites
> http_access allow prioritysites
> # enforce authentication, order of rules is important for authorization levels
> http_access allow allowedsite124
> http_access deny !auth
> # prevent access to basic auth prompt for BlockedAccess users
> # http_access deny BlockedAccess all
> # http_access allow allowedsites
> # http_access deny RestrictedAccess all
> # http_access allow AnonymousAccess auth
> # http_access allow FullAccess auth
> # http_access allow exceptedsites ExceptionAccess auth
> # http_access deny blockedsites
> # http_access allow StandardAccess auth
> http_access allow auth
> # http_access deny !auth
> # DO NOT REMOVE THE FOLLOWING LINE
> http_access deny all
>
> ### logging
> access_log /var/log/squid/access.log squid
>
> ### Set memory manually, to allow it to use more of the system
> cache_mem 1024 MB
>
> ### squid Debian defaults
> http_port 8080
> hierarchy_stoplist cgi-bin ?
> coredump_dir /var/spool/squid
> refresh_pattern ^ftp:           1440    20%     10080
> refresh_pattern ^gopher:        1440    0%      1440
> refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
> refresh_pattern .               0       20%     4320
> [root at proxycen squid]#
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From omidkosari at yahoo.com  Tue Oct  7 07:56:41 2014
From: omidkosari at yahoo.com (Omid Kosari)
Date: Tue, 7 Oct 2014 00:56:41 -0700 (PDT)
Subject: [squid-users] Best OS for latest squid
In-Reply-To: <54319E31.6040207@ngtech.co.il>
References: <CAOsHgttQvOwWML+5W-sSoYR23iBg9PZwCwH3d7NPQZOwM=CpJQ@mail.gmail.com>
 <54315F85.4000308@ngtech.co.il>
 <88c994945c0f40bd866f338198aa0737@AM3PR04MB450.eurprd04.prod.outlook.com>
 <54319E31.6040207@ngtech.co.il>
Message-ID: <1412668601056-4667727.post@n4.nabble.com>

Dear Eliezer,

Is there any way to inform me by mail the release of UBUNTU package ?

Thanks and waiting 



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Best-OS-for-latest-squid-tp4667666p4667727.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From squid3 at treenet.co.nz  Tue Oct  7 08:03:32 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 07 Oct 2014 21:03:32 +1300
Subject: [squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth
 broken?)
In-Reply-To: <20141007074940.GA58673@admin.sibptus.tomsk.ru>
References: <20141006153925.GA41918@admin.sibptus.tomsk.ru>
 <5432C152.6000505@treenet.co.nz>
 <20141007025214.GA51120@admin.sibptus.tomsk.ru>
 <54335E01.2070904@treenet.co.nz>
 <20141007041659.GB51918@admin.sibptus.tomsk.ru>
 <54336F8F.7020209@treenet.co.nz>
 <20141007050730.GA54394@admin.sibptus.tomsk.ru>
 <54338277.9000804@treenet.co.nz>
 <20141007064038.GA56722@admin.sibptus.tomsk.ru>
 <543396D8.4080101@treenet.co.nz>
 <20141007074940.GA58673@admin.sibptus.tomsk.ru>
Message-ID: <54339E54.60402@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 7/10/2014 8:49 p.m., Victor Sudakov wrote:
> Amos Jeffries wrote:
>> Interesting log. Can you get a full-body packet trace to me
>> privately? That is captured by using tcpdump -s 0 or -s 65535
>> option.
>> 
>> And if possible the full cache.log contents?
>> 
> 
> With pleasure.
> 
> Can I have your PGP key please?
> 

Key : 0xFF5CF463 <squid3 at treenet.co.nz>
      fingerprint = EA31 CC5E 9488 E516 8D2D  CC5E B268 E706 FF5C F463
      keyring = http://www.squid-cache.org/pgp.asc
      keyserver = subkeys.pgp.net


Cheers
Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUM55UAAoJELJo5wb/XPRjILoH/3JD3OqA3xC36PMrBqymPFv8
ARpMTw/puDpVlEM3sTBcAcvePXjXO1InzdDDgyBJZz2w9lyJyAd/xALH1i5ZLXK0
5osauALgG6wGcAr76lIWfUvBJUS/1UamslX8wKAlgleJulWXWPq6+Y8baEFnimgJ
G/edwPapzkHe7jLUr00K1WAUp11DqYw9GmRF/EnTi3LlU/wXvsnhCLcigaxMypqO
4AhbpbMGnZiEc2GgoDyAHF0h4sNB6GUY586atI8OeI0GU3dQmLW7ePhWS90SBSAW
yZfqn/kHEWWZokBBT4e1g6EuAqjPYEDrIyIYjckE6T39Y6oP+B+ySe4t0haJR1U=
=xThM
-----END PGP SIGNATURE-----


From sudakov at sibptus.tomsk.ru  Tue Oct  7 08:21:39 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Tue, 7 Oct 2014 15:21:39 +0700
Subject: [squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth
 broken?)
In-Reply-To: <54339A2E.4080808@treenet.co.nz>
References: <5432C152.6000505@treenet.co.nz>
 <20141007025214.GA51120@admin.sibptus.tomsk.ru>
 <54335E01.2070904@treenet.co.nz>
 <20141007041659.GB51918@admin.sibptus.tomsk.ru>
 <54336F8F.7020209@treenet.co.nz>
 <20141007050730.GA54394@admin.sibptus.tomsk.ru>
 <54338277.9000804@treenet.co.nz>
 <20141007064038.GA56722@admin.sibptus.tomsk.ru>
 <543396D8.4080101@treenet.co.nz> <54339A2E.4080808@treenet.co.nz>
Message-ID: <20141007082139.GA60223@admin.sibptus.tomsk.ru>

A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-encrypted
Size: 11 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141007/4ca10143/attachment.pgp>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: msg.asc
Type: application/octet-stream
Size: 7359 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141007/4ca10143/attachment.obj>

From sudakov at sibptus.tomsk.ru  Tue Oct  7 08:35:42 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Tue, 7 Oct 2014 15:35:42 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <20141007070403.GA57384@admin.sibptus.tomsk.ru>
References: <20141006040725.GA31642@admin.sibptus.tomsk.ru>
 <20141006052346.GA32369@admin.sibptus.tomsk.ru>
 <20141007070403.GA57384@admin.sibptus.tomsk.ru>
Message-ID: <20141007083542.GA60425@admin.sibptus.tomsk.ru>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

And my Kerberos server setup seems valid:

$ setenv KRB5_KTNAME /usr/local/etc/squid/squid.keytab
$ setenv KRB5_CONFIG /usr/local/etc/squid/krb5.conf
$ kdestroy
$ kinit -t $KRB5_KTNAME  HTTP/proxy.sibptus.transneft.ru
$ klist
Credentials cache: FILE:/tmp/krb5cc_Ld5uU9
        Principal:
HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU

  Issued           Expires          Principal
Oct  7 15:33:42  Oct  8 01:33:42
krbtgt/SIBPTUS.TRANSNEFT.RU at SIBPTUS.TRANSNEFT.RU
$



Victor Sudakov wrote:
> Victor Sudakov wrote:
> > > Well, I have tried negotiate_kerberos_auth with Firefox (Windows) 
> > 
> > I have tried the same with MSIE 8 (Windows).
> 
> After some adjustment to domain group policies, the Windows host is
> at last requesting and successfully receiving the ticket for the proxy
> service.  Wireshark output:
> 
> User Datagram Protocol, Src Port: kerberos (88), Dst Port: dellpwrappks (1266)
> Kerberos TGS-REP
>     Pvno: 5
>     MSG Type: TGS-REP (13)
>     Client Realm: SIBPTUS.TRANSNEFT.RU
>     Client Name (Principal): vas-adm
>     Ticket
>         Tkt-vno: 5
>         Realm: SIBPTUS.TRANSNEFT.RU
>         Server Name (Service and Instance): HTTP/proxy.sibptus.transneft.ru
>         enc-part rc4-hmac
>             Encryption type: rc4-hmac (23)
>             enc-part: 3e0fc357a26db7dcdb0a5b6436b56f9c96d15ad7626eea08...
>     enc-part rc4-hmac
>         Encryption type: rc4-hmac (23)
>         Kvno: 1
>         enc-part: db8c9ea1bf85c4bb5005103765767b692ed3c0f247c23d48...
> 
> The corresponding Kerberos principal is put into the keytab:
> /usr/local/etc/squid/squid.keytab:
> 
> Vno  Type                     Principal
>   1  des-cbc-crc              HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
>   1  des-cbc-md5              HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
>   1  arcfour-hmac-md5         HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
>   1  aes256-cts-hmac-sha1-96  HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
>   1  aes128-cts-hmac-sha1-96  HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
> 
> The permissions on the keytab are correct. Squid receives it via the
> environment:
> 
> env KRB5_KTNAME=/usr/local/etc/squid/squid.keytab \
>         KRB5_CONFIG=/usr/local/etc/squid/krb5.conf \
>         squid -f /usr/local/etc/squid/squid-test.conf
> 
> However, then actual autthentication begins, it fails with the:
> "ERROR: gss_acquire_cred() failed:  No credentials were
> supplied, or the credentials were unavailable or inaccessible..
> unknown mech-code 0 for mech unknown"
> 
> If someone finds something familiar in the below debug output, or can
> low-level debug actual kerberos, could you please let me know. Thanks
> a lot in advance for any help.
> 
> negotiate_kerberos_auth.cc(212): pid=40984 :2014/10/07 13:12:08| negotiate_kerberos_auth: INFO: Starting version 3.0.4sq
> negotiate_kerberos_auth.cc(258): pid=40980 :2014/10/07 13:12:37| negotiate_kerberos_auth: DEBUG: Got 'YR YIIFGAYGKwYBBQUCoIIFDDCCBQigJDAiBgkqhkiC9xIBAgIGCSqGSIb3EgECAgYKKwYBBAGCNwICCqKCBN4EggTaYIIE1gYJKoZIhvcSAQICAQBuggTFMIIEwaADAgEFoQMCAQ6iBwMFACAAAACjggPpYYID5TCCA+GgAwIBBaEWGxRTSUJQVFVTLlRSQU5TTkVGVC5SVaItMCugAwIBAqEkMCIbBEhUVFAbGnByb3h5LnNpYnB0dXMudHJhbnNuZWZ0LnJ1o4IDkTCCA42gAwIBA6KCA4QEggOAB8tiAa54xI00BfngMyI8cwFHbNKRZPVn1c/HKYPi4Dppq0fIjp2e5br7rHG51+1/w6zaDwHKqdtnpWh/OplOkn6tDNq0H2fi/jFeT0XKICrLxdpmDHRqNmiyxvtczdkcSyxXJ2254oM9VwuE39D8hqU58NmijTB+WQupz2hw4d+5euIFFwSSO8nD3CMaBVGgyNfp9YvUUy860L+KKEqb0LVXZ+/OsnlsyrEc3AaaXwSwS30+ZRv0jCLh1h7kc84XFPrjGqRPp7JmO5gUCF8k/GXNF3FAMBAaT4r/iAs8LFIixQiRUWJPtjcWAtH0Q3JumqB9Enm+JPNvGBvE83YvbBZtDJQ0uc5lOMVLavBh2Xgj86BmKlCsrOCiMoQ8SgsEAX6o110EeMI1Tef8t+2/WhzP39l5BGuXmdDA1zEmqzA83vvTy5JcKUXZ3IdwwJ4I+kW62qIMsceZ/hfdj/Iy+RjCNrum5FHXMDszMVacKHp9kJTMofuMhhOKD2o+Z91TWTkEwD3NNWGjTWdgECpJT/F7I1x35iQaLGvgLebpalPJEXY8A8od1HhXZaCkIPXcDoPUR1LTTk8bHYKan17EnOBf0CbjOkU8/ib2mLUL81RQHrt6vdTcXzxsAgoZYigptd/ilsXq0dbwjTuZP8ZcFFY+levmSPIn5TF5xZtmtymditNO28hSqDjxC2Lpoy65kqwXglxpijuicSXC4cC/O1TBbksyH/aw/7MbNTKupFpovZTensu/A6zYG3HCjKW9QBsgU4tBXRC6rTP0RAeuASUHpvHv4WhbS5AWNYmX1TNQ8QpfurM2tAzuFzYQN8LL3VT38o4SVK+visE9q1IGez70q9g6Naowvpp6g/h3FuCzUks2ydXchKNPe3KzuSJqzmkLlyjKMlVW8sYUwgKXqNsgi7aRArEfu0L3UqYG/7lao+QLDOBf5+uSzWarZ9IIS7ClIRBejXU7erVJrLBDlGZRbMu+hXacsGwv/1Ls+S8xCxnlRjQngHjLg8vvQBYslgvkMh77eyP+HjiUDOXqDYoDR5bIc/w5UX/Dvb4ECGiqhGd9UHHQkYn6NQnbO/2r+iVBdy1fvXhXE2LKgAFoQtf2tIqsTUZWv12O82X2KzcZJ7IEVMxbGtSj9cdncc16c5Y6DL9AzQryNIhSGxghZ7zyWwp4DBS19ru4l+dVQ4ikgb4wgbugAwIBA6KBswSBsGrVgYewQbJlk43Aw0ujMajwCinYuDDsW9b7I1gCa41ShWl0xSQ6MfkhuPDbcJO6TK6nTYyxSbWMtxo2eiMOehg+bHo5HUUCGyvRCNRnJFcJLP3GAqh8Ogjx9zY4/YcVb8c/eFM/BiBKHw41T4a0fR6scB9GKDjT8vDa4ysgGeEjeiPh+PjDSTS/y/CWrin97xXwrdUbsWbhuxHQ66HZ9rEJoZFb8oxtHgnqyEgMbwdO' from squid (length: 1747).
> negotiate_kerberos_auth.cc(311): pid=40980 :2014/10/07 13:12:37| negotiate_kerberos_auth: DEBUG: Decode 'YIIFGAYGKwYBBQUCoIIFDDCCBQigJDAiBgkqhkiC9xIBAgIGCSqGSIb3EgECAgYKKwYBBAGCNwICCqKCBN4EggTaYIIE1gYJKoZIhvcSAQICAQBuggTFMIIEwaADAgEFoQMCAQ6iBwMFACAAAACjggPpYYID5TCCA+GgAwIBBaEWGxRTSUJQVFVTLlRSQU5TTkVGVC5SVaItMCugAwIBAqEkMCIbBEhUVFAbGnByb3h5LnNpYnB0dXMudHJhbnNuZWZ0LnJ1o4IDkTCCA42gAwIBA6KCA4QEggOAB8tiAa54xI00BfngMyI8cwFHbNKRZPVn1c/HKYPi4Dppq0fIjp2e5br7rHG51+1/w6zaDwHKqdtnpWh/OplOkn6tDNq0H2fi/jFeT0XKICrLxdpmDHRqNmiyxvtczdkcSyxXJ2254oM9VwuE39D8hqU58NmijTB+WQupz2hw4d+5euIFFwSSO8nD3CMaBVGgyNfp9YvUUy860L+KKEqb0LVXZ+/OsnlsyrEc3AaaXwSwS30+ZRv0jCLh1h7kc84XFPrjGqRPp7JmO5gUCF8k/GXNF3FAMBAaT4r/iAs8LFIixQiRUWJPtjcWAtH0Q3JumqB9Enm+JPNvGBvE83YvbBZtDJQ0uc5lOMVLavBh2Xgj86BmKlCsrOCiMoQ8SgsEAX6o110EeMI1Tef8t+2/WhzP39l5BGuXmdDA1zEmqzA83vvTy5JcKUXZ3IdwwJ4I+kW62qIMsceZ/hfdj/Iy+RjCNrum5FHXMDszMVacKHp9kJTMofuMhhOKD2o+Z91TWTkEwD3NNWGjTWdgECpJT/F7I1x35iQaLGvgLebpalPJEXY8A8od1HhXZaCkIPXcDoPUR1LTTk8bHYKan17EnOBf0CbjOkU8/ib2mLUL81RQHrt6vdTcXzxsAgoZYigptd/ilsXq0dbwjTuZP8ZcFFY+levmSPIn5TF5xZtmtymditNO28hSqDjxC2Lpoy65kqwXglxpijuicSXC4cC/O1TBbksyH/aw/7MbNTKupFpovZTensu/A6zYG3HCjKW9QBsgU4tBXRC6rTP0RAeuASUHpvHv4WhbS5AWNYmX1TNQ8QpfurM2tAzuFzYQN8LL3VT38o4SVK+visE9q1IGez70q9g6Naowvpp6g/h3FuCzUks2ydXchKNPe3KzuSJqzmkLlyjKMlVW8sYUwgKXqNsgi7aRArEfu0L3UqYG/7lao+QLDOBf5+uSzWarZ9IIS7ClIRBejXU7erVJrLBDlGZRbMu+hXacsGwv/1Ls+S8xCxnlRjQngHjLg8vvQBYslgvkMh77eyP+HjiUDOXqDYoDR5bIc/w5UX/Dvb4ECGiqhGd9UHHQkYn6NQnbO/2r+iVBdy1fvXhXE2LKgAFoQtf2tIqsTUZWv12O82X2KzcZJ7IEVMxbGtSj9cdncc16c5Y6DL9AzQryNIhSGxghZ7zyWwp4DBS19ru4l+dVQ4ikgb4wgbugAwIBA6KBswSBsGrVgYewQbJlk43Aw0ujMajwCinYuDDsW9b7I1gCa41ShWl0xSQ6MfkhuPDbcJO6TK6nTYyxSbWMtxo2eiMOehg+bHo5HUUCGyvRCNRnJFcJLP3GAqh8Ogjx9zY4/YcVb8c/eFM/BiBKHw41T4a0fR6scB9GKDjT8vDa4ysgGeEjeiPh+PjDSTS/y/CWrin97xXwrdUbsWbhuxHQ66HZ9rEJoZFb8oxtHgnqyEgMbwdO' (decoded length: 1308).
> negotiate_kerberos_auth.cc(128): pid=40980 :2014/10/07 13:12:37| negotiate_kerberos_auth: ERROR: gss_acquire_cred() failed:  No credentials were supplied, or the credentials were unavailable or inaccessible.. unknown mech-code 0 for mech unknown
> 2014/10/07 13:12:37 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: gss_acquire_cred() failed:  No credentials were supplied, or the credentials were unavailable or inaccessible.. unknown mech-code 0 for mech unknown; }}
> 
> -- 
> Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
> sip:sudakov at sibptus.tomsk.ru

> negotiate_kerberos_auth.cc(212): pid=40984 :2014/10/07 13:12:08| negotiate_kerberos_auth: INFO: Starting version 3.0.4sq
> negotiate_kerberos_auth.cc(258): pid=40980 :2014/10/07 13:12:37| negotiate_kerberos_auth: DEBUG: Got 'YR YIIFGAYGKwYBBQUCoIIFDDCCBQigJDAiBgkqhkiC9xIBAgIGCSqGSIb3EgECAgYKKwYBBAGCNwICCqKCBN4EggTaYIIE1gYJKoZIhvcSAQICAQBuggTFMIIEwaADAgEFoQMCAQ6iBwMFACAAAACjggPpYYID5TCCA+GgAwIBBaEWGxRTSUJQVFVTLlRSQU5TTkVGVC5SVaItMCugAwIBAqEkMCIbBEhUVFAbGnByb3h5LnNpYnB0dXMudHJhbnNuZWZ0LnJ1o4IDkTCCA42gAwIBA6KCA4QEggOAB8tiAa54xI00BfngMyI8cwFHbNKRZPVn1c/HKYPi4Dppq0fIjp2e5br7rHG51+1/w6zaDwHKqdtnpWh/OplOkn6tDNq0H2fi/jFeT0XKICrLxdpmDHRqNmiyxvtczdkcSyxXJ2254oM9VwuE39D8hqU58NmijTB+WQupz2hw4d+5euIFFwSSO8nD3CMaBVGgyNfp9YvUUy860L+KKEqb0LVXZ+/OsnlsyrEc3AaaXwSwS30+ZRv0jCLh1h7kc84XFPrjGqRPp7JmO5gUCF8k/GXNF3FAMBAaT4r/iAs8LFIixQiRUWJPtjcWAtH0Q3JumqB9Enm+JPNvGBvE83YvbBZtDJQ0uc5lOMVLavBh2Xgj86BmKlCsrOCiMoQ8SgsEAX6o110EeMI1Tef8t+2/WhzP39l5BGuXmdDA1zEmqzA83vvTy5JcKUXZ3IdwwJ4I+kW62qIMsceZ/hfdj/Iy+RjCNrum5FHXMDszMVacKHp9kJTMofuMhhOKD2o+Z91TWTkEwD3NNWGjTWdgECpJT/F7I1x35iQaLGvgLebpalPJEXY8A8od1HhXZaCkIPXcDoPUR1LTTk8bHYKan17EnOBf0CbjOkU8/ib2mLUL81RQHrt6vdTcXzxsAgoZYigptd/ilsXq0dbwjTuZP8ZcFFY+levmSPIn5TF5xZtmtymditNO28hSqDjxC2Lpoy65kqwXglxpijuicSXC4cC/O1TBbksyH/aw/7MbNTKupFpovZTensu/A6zYG3HCjKW9QBsgU4tBXRC6rTP0RAeuASUHpvHv4WhbS5AWNYmX1TNQ8QpfurM2tAzuFzYQN8LL3VT38o4SVK+visE9q1IGez70q9g6Naowvpp6g/h3FuCzUks2ydXchKNPe3KzuSJqzmkLlyjKMlVW8sYUwgKXqNsgi7aRArEfu0L3UqYG/7lao+QLDOBf5+uSzWarZ9IIS7ClIRBejXU7erVJrLBDlGZRbMu+hXacsGwv/1Ls+S8xCxnlRjQngHjLg8vvQBYslgvkMh77eyP+HjiUDOXqDYoDR5bIc/w5UX/Dvb4ECGiqhGd9UHHQkYn6NQnbO/2r+iVBdy1fvXhXE2LKgAFoQtf2tIqsTUZWv12O82X2KzcZJ7IEVMxbGtSj9cdncc16c5Y6DL9AzQryNIhSGxghZ7zyWwp4DBS19ru4l+dVQ4ikgb4wgbugAwIBA6KBswSBsGrVgYewQbJlk43Aw0ujMajwCinYuDDsW9b7I1gCa41ShWl0xSQ6MfkhuPDbcJO6TK6nTYyxSbWMtxo2eiMOehg+bHo5HUUCGyvRCNRnJFcJLP3GAqh8Ogjx9zY4/YcVb8c/eFM/BiBKHw41T4a0fR6scB9GKDjT8vDa4ysgGeEjeiPh+PjDSTS/y/CWrin97xXwrdUbsWbhuxHQ66HZ9rEJoZFb8oxtHgnqyEgMbwdO' from squid (length: 1747).
> negotiate_kerberos_auth.cc(311): pid=40980 :2014/10/07 13:12:37| negotiate_kerberos_auth: DEBUG: Decode 'YIIFGAYGKwYBBQUCoIIFDDCCBQigJDAiBgkqhkiC9xIBAgIGCSqGSIb3EgECAgYKKwYBBAGCNwICCqKCBN4EggTaYIIE1gYJKoZIhvcSAQICAQBuggTFMIIEwaADAgEFoQMCAQ6iBwMFACAAAACjggPpYYID5TCCA+GgAwIBBaEWGxRTSUJQVFVTLlRSQU5TTkVGVC5SVaItMCugAwIBAqEkMCIbBEhUVFAbGnByb3h5LnNpYnB0dXMudHJhbnNuZWZ0LnJ1o4IDkTCCA42gAwIBA6KCA4QEggOAB8tiAa54xI00BfngMyI8cwFHbNKRZPVn1c/HKYPi4Dppq0fIjp2e5br7rHG51+1/w6zaDwHKqdtnpWh/OplOkn6tDNq0H2fi/jFeT0XKICrLxdpmDHRqNmiyxvtczdkcSyxXJ2254oM9VwuE39D8hqU58NmijTB+WQupz2hw4d+5euIFFwSSO8nD3CMaBVGgyNfp9YvUUy860L+KKEqb0LVXZ+/OsnlsyrEc3AaaXwSwS30+ZRv0jCLh1h7kc84XFPrjGqRPp7JmO5gUCF8k/GXNF3FAMBAaT4r/iAs8LFIixQiRUWJPtjcWAtH0Q3JumqB9Enm+JPNvGBvE83YvbBZtDJQ0uc5lOMVLavBh2Xgj86BmKlCsrOCiMoQ8SgsEAX6o110EeMI1Tef8t+2/WhzP39l5BGuXmdDA1zEmqzA83vvTy5JcKUXZ3IdwwJ4I+kW62qIMsceZ/hfdj/Iy+RjCNrum5FHXMDszMVacKHp9kJTMofuMhhOKD2o+Z91TWTkEwD3NNWGjTWdgECpJT/F7I1x35iQaLGvgLebpalPJEXY8A8od1HhXZaCkIPXcDoPUR1LTTk8bHYKan17EnOBf0CbjOkU8/ib2mLUL81RQHrt6vdTcXzxsAgoZYigptd/ilsXq0dbwjTuZP8ZcFFY+levmSPIn5TF5xZtmtymditNO28hSqDjxC2Lpoy65kqwXglxpijuicSXC4cC/O1TBbksyH/aw/7MbNTKupFpovZTensu/A6zYG3HCjKW9QBsgU4tBXRC6rTP0RAeuASUHpvHv4WhbS5AWNYmX1TNQ8QpfurM2tAzuFzYQN8LL3VT38o4SVK+visE9q1IGez70q9g6Naowvpp6g/h3FuCzUks2ydXchKNPe3KzuSJqzmkLlyjKMlVW8sYUwgKXqNsgi7aRArEfu0L3UqYG/7lao+QLDOBf5+uSzWarZ9IIS7ClIRBejXU7erVJrLBDlGZRbMu+hXacsGwv/1Ls+S8xCxnlRjQngHjLg8vvQBYslgvkMh77eyP+HjiUDOXqDYoDR5bIc/w5UX/Dvb4ECGiqhGd9UHHQkYn6NQnbO/2r+iVBdy1fvXhXE2LKgAFoQtf2tIqsTUZWv12O82X2KzcZJ7IEVMxbGtSj9cdncc16c5Y6DL9AzQryNIhSGxghZ7zyWwp4DBS19ru4l+dVQ4ikgb4wgbugAwIBA6KBswSBsGrVgYewQbJlk43Aw0ujMajwCinYuDDsW9b7I1gCa41ShWl0xSQ6MfkhuPDbcJO6TK6nTYyxSbWMtxo2eiMOehg+bHo5HUUCGyvRCNRnJFcJLP3GAqh8Ogjx9zY4/YcVb8c/eFM/BiBKHw41T4a0fR6scB9GKDjT8vDa4ysgGeEjeiPh+PjDSTS/y/CWrin97xXwrdUbsWbhuxHQ66HZ9rEJoZFb8oxtHgnqyEgMbwdO' (decoded length: 1308).
> negotiate_kerberos_auth.cc(128): pid=40980 :2014/10/07 13:12:37| negotiate_kerberos_auth: ERROR: gss_acquire_cred() failed:  No credentials were supplied, or the credentials were unavailable or inaccessible.. unknown mech-code 0 for mech unknown
> 2014/10/07 13:12:37 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: gss_acquire_cred() failed:  No credentials were supplied, or the credentials were unavailable or inaccessible.. unknown mech-code 0 for mech unknown; }}

> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


- -- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUM6XeAAoJEA2k8lmbXsY0shEH/3k0EU+0PGD1iSx2OLqbkhGv
Z38OUous3LXoxpvOTSTP5mp+jVzutKBUlzqZbo5M0qNPg+WovNtDF2bqPK09scy8
Wuf+zfZv8YXQIvMemLXsnWZkIivLQ8Tgi6nAhX5fewP6zIfjRPMgqr86+ihHYZs4
HfO1IceZkitgeJx+9VvWDrRRDYIikTkXDLssfjFH+2J++tJikDWLqxoXykXTRRR3
xWNHomrRCxHw0q4KixCgefEnUDThvAK6MRnQA57t6xnTXiSTbqMSvkagLFgTLo87
OKI3ex+nVgyax1JZHJy1oOqXYJIeex+KxcLKkEzvXL9mdEUPgiJLg8FJD7rSDHE=
=hOY8
-----END PGP SIGNATURE-----


From sudakov at sibptus.tomsk.ru  Tue Oct  7 09:13:39 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Tue, 7 Oct 2014 16:13:39 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <20141007070403.GA57384@admin.sibptus.tomsk.ru>
References: <20141006040725.GA31642@admin.sibptus.tomsk.ru>
 <20141006052346.GA32369@admin.sibptus.tomsk.ru>
 <20141007070403.GA57384@admin.sibptus.tomsk.ru>
Message-ID: <20141007091338.GA62111@admin.sibptus.tomsk.ru>

And my Kerberos server setup seems valid:

$ setenv KRB5_KTNAME /usr/local/etc/squid/squid.keytab
$ setenv KRB5_CONFIG /usr/local/etc/squid/krb5.conf
$ kdestroy
$ kinit -t $KRB5_KTNAME  HTTP/proxy.sibptus.transneft.ru
$ klist
Credentials cache: FILE:/tmp/krb5cc_Ld5uU9
        Principal:
HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU

  Issued           Expires          Principal
Oct  7 15:33:42  Oct  8 01:33:42
krbtgt/SIBPTUS.TRANSNEFT.RU at SIBPTUS.TRANSNEFT.RU
$



Victor Sudakov wrote:
> Victor Sudakov wrote:
> > > Well, I have tried negotiate_kerberos_auth with Firefox (Windows) 
> > 
> > I have tried the same with MSIE 8 (Windows).
> 
> After some adjustment to domain group policies, the Windows host is
> at last requesting and successfully receiving the ticket for the proxy
> service.  Wireshark output:
> 
> User Datagram Protocol, Src Port: kerberos (88), Dst Port: dellpwrappks (1266)
> Kerberos TGS-REP
>     Pvno: 5
>     MSG Type: TGS-REP (13)
>     Client Realm: SIBPTUS.TRANSNEFT.RU
>     Client Name (Principal): vas-adm
>     Ticket
>         Tkt-vno: 5
>         Realm: SIBPTUS.TRANSNEFT.RU
>         Server Name (Service and Instance): HTTP/proxy.sibptus.transneft.ru
>         enc-part rc4-hmac
>             Encryption type: rc4-hmac (23)
>             enc-part: 3e0fc357a26db7dcdb0a5b6436b56f9c96d15ad7626eea08...
>     enc-part rc4-hmac
>         Encryption type: rc4-hmac (23)
>         Kvno: 1
>         enc-part: db8c9ea1bf85c4bb5005103765767b692ed3c0f247c23d48...
> 
> The corresponding Kerberos principal is put into the keytab:
> /usr/local/etc/squid/squid.keytab:
> 
> Vno  Type                     Principal
>   1  des-cbc-crc              HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
>   1  des-cbc-md5              HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
>   1  arcfour-hmac-md5         HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
>   1  aes256-cts-hmac-sha1-96  HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
>   1  aes128-cts-hmac-sha1-96  HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
> 
> The permissions on the keytab are correct. Squid receives it via the
> environment:
> 
> env KRB5_KTNAME=/usr/local/etc/squid/squid.keytab \
>         KRB5_CONFIG=/usr/local/etc/squid/krb5.conf \
>         squid -f /usr/local/etc/squid/squid-test.conf
> 
> However, then actual autthentication begins, it fails with the:
> "ERROR: gss_acquire_cred() failed:  No credentials were
> supplied, or the credentials were unavailable or inaccessible..
> unknown mech-code 0 for mech unknown"
> 
> If someone finds something familiar in the below debug output, or can
> low-level debug actual kerberos, could you please let me know. Thanks
> a lot in advance for any help.
> 
> negotiate_kerberos_auth.cc(212): pid=40984 :2014/10/07 13:12:08| negotiate_kerberos_auth: INFO: Starting version 3.0.4sq
> negotiate_kerberos_auth.cc(258): pid=40980 :2014/10/07 13:12:37| negotiate_kerberos_auth: DEBUG: Got 'YR YIIFGAYGKwYBBQUCoIIFDDCCBQigJDAiBgkqhkiC9xIBAgIGCSqGSIb3EgECAgYKKwYBBAGCNwICCqKCBN4EggTaYIIE1gYJKoZIhvcSAQICAQBuggTFMIIEwaADAgEFoQMCAQ6iBwMFACAAAACjggPpYYID5TCCA+GgAwIBBaEWGxRTSUJQVFVTLlRSQU5TTkVGVC5SVaItMCugAwIBAqEkMCIbBEhUVFAbGnByb3h5LnNpYnB0dXMudHJhbnNuZWZ0LnJ1o4IDkTCCA42gAwIBA6KCA4QEggOAB8tiAa54xI00BfngMyI8cwFHbNKRZPVn1c/HKYPi4Dppq0fIjp2e5br7rHG51+1/w6zaDwHKqdtnpWh/OplOkn6tDNq0H2fi/jFeT0XKICrLxdpmDHRqNmiyxvtczdkcSyxXJ2254oM9VwuE39D8hqU58NmijTB+WQupz2hw4d+5euIFFwSSO8nD3CMaBVGgyNfp9YvUUy860L+KKEqb0LVXZ+/OsnlsyrEc3AaaXwSwS30+ZRv0jCLh1h7kc84XFPrjGqRPp7JmO5gUCF8k/GXNF3FAMBAaT4r/iAs8LFIixQiRUWJPtjcWAtH0Q3JumqB9Enm+JPNvGBvE83YvbBZtDJQ0uc5lOMVLavBh2Xgj86BmKlCsrOCiMoQ8SgsEAX6o110EeMI1Tef8t+2/WhzP39l5BGuXmdDA1zEmqzA83vvTy5JcKUXZ3IdwwJ4I+kW62qIMsceZ/hfdj/Iy+RjCNrum5FHXMDszMVacKHp9kJTMofuMhhOKD2o+Z91TWTkEwD3NNWGjTWdgECpJT/F7I1x35iQaLGvgLebpalPJEXY8A8od1HhXZaCkIPXcDoPUR1LTTk8bHYKan17EnOBf0CbjOkU8/ib2mLUL81RQHrt6vdTcXzxsAgoZYigptd/ilsXq0dbwjTuZP8ZcFFY+levmSPIn5TF5xZtmtymditNO28hSqDjxC2Lpoy65kqwXglxpijuicSXC4cC/O1TBbksyH/aw/7MbNTKupFpovZTensu/A6zYG3HCjKW9QBsgU4tBXRC6rTP0RAeuASUHpvHv4WhbS5AWNYmX1TNQ8QpfurM2tAzuFzYQN8LL3VT38o4SVK+visE9q1IGez70q9g6Naowvpp6g/h3FuCzUks2ydXchKNPe3KzuSJqzmkLlyjKMlVW8sYUwgKXqNsgi7aRArEfu0L3UqYG/7lao+QLDOBf5+uSzWarZ9IIS7ClIRBejXU7erVJrLBDlGZRbMu+hXacsGwv/1Ls+S8xCxnlRjQngHjLg8vvQBYslgvkMh77eyP+HjiUDOXqDYoDR5bIc/w5UX/Dvb4ECGiqhGd9UHHQkYn6NQnbO/2r+iVBdy1fvXhXE2LKgAFoQtf2tIqsTUZWv12O82X2KzcZJ7IEVMxbGtSj9cdncc16c5Y6DL9AzQryNIhSGxghZ7zyWwp4DBS19ru4l+dVQ4ikgb4wgbugAwIBA6KBswSBsGrVgYewQbJlk43Aw0ujMajwCinYuDDsW9b7I1gCa41ShWl0xSQ6MfkhuPDbcJO6TK6nTYyxSbWMtxo2eiMOehg+bHo5HUUCGyvRCNRnJFcJLP3GAqh8Ogjx9zY4/YcVb8c/eFM/BiBKHw41T4a0fR6scB9GKDjT8vDa4ysgGeEjeiPh+PjDSTS/y/CWrin97xXwrdUbsWbhuxHQ66HZ9rEJoZFb8oxtHgnqyEgMbwdO' from squid (length: 1747).
> negotiate_kerberos_auth.cc(311): pid=40980 :2014/10/07 13:12:37| negotiate_kerberos_auth: DEBUG: Decode 'YIIFGAYGKwYBBQUCoIIFDDCCBQigJDAiBgkqhkiC9xIBAgIGCSqGSIb3EgECAgYKKwYBBAGCNwICCqKCBN4EggTaYIIE1gYJKoZIhvcSAQICAQBuggTFMIIEwaADAgEFoQMCAQ6iBwMFACAAAACjggPpYYID5TCCA+GgAwIBBaEWGxRTSUJQVFVTLlRSQU5TTkVGVC5SVaItMCugAwIBAqEkMCIbBEhUVFAbGnByb3h5LnNpYnB0dXMudHJhbnNuZWZ0LnJ1o4IDkTCCA42gAwIBA6KCA4QEggOAB8tiAa54xI00BfngMyI8cwFHbNKRZPVn1c/HKYPi4Dppq0fIjp2e5br7rHG51+1/w6zaDwHKqdtnpWh/OplOkn6tDNq0H2fi/jFeT0XKICrLxdpmDHRqNmiyxvtczdkcSyxXJ2254oM9VwuE39D8hqU58NmijTB+WQupz2hw4d+5euIFFwSSO8nD3CMaBVGgyNfp9YvUUy860L+KKEqb0LVXZ+/OsnlsyrEc3AaaXwSwS30+ZRv0jCLh1h7kc84XFPrjGqRPp7JmO5gUCF8k/GXNF3FAMBAaT4r/iAs8LFIixQiRUWJPtjcWAtH0Q3JumqB9Enm+JPNvGBvE83YvbBZtDJQ0uc5lOMVLavBh2Xgj86BmKlCsrOCiMoQ8SgsEAX6o110EeMI1Tef8t+2/WhzP39l5BGuXmdDA1zEmqzA83vvTy5JcKUXZ3IdwwJ4I+kW62qIMsceZ/hfdj/Iy+RjCNrum5FHXMDszMVacKHp9kJTMofuMhhOKD2o+Z91TWTkEwD3NNWGjTWdgECpJT/F7I1x35iQaLGvgLebpalPJEXY8A8od1HhXZaCkIPXcDoPUR1LTTk8bHYKan17EnOBf0CbjOkU8/ib2mLUL81RQHrt6vdTcXzxsAgoZYigptd/ilsXq0dbwjTuZP8ZcFFY+levmSPIn5TF5xZtmtymditNO28hSqDjxC2Lpoy65kqwXglxpijuicSXC4cC/O1TBbksyH/aw/7MbNTKupFpovZTensu/A6zYG3HCjKW9QBsgU4tBXRC6rTP0RAeuASUHpvHv4WhbS5AWNYmX1TNQ8QpfurM2tAzuFzYQN8LL3VT38o4SVK+visE9q1IGez70q9g6Naowvpp6g/h3FuCzUks2ydXchKNPe3KzuSJqzmkLlyjKMlVW8sYUwgKXqNsgi7aRArEfu0L3UqYG/7lao+QLDOBf5+uSzWarZ9IIS7ClIRBejXU7erVJrLBDlGZRbMu+hXacsGwv/1Ls+S8xCxnlRjQngHjLg8vvQBYslgvkMh77eyP+HjiUDOXqDYoDR5bIc/w5UX/Dvb4ECGiqhGd9UHHQkYn6NQnbO/2r+iVBdy1fvXhXE2LKgAFoQtf2tIqsTUZWv12O82X2KzcZJ7IEVMxbGtSj9cdncc16c5Y6DL9AzQryNIhSGxghZ7zyWwp4DBS19ru4l+dVQ4ikgb4wgbugAwIBA6KBswSBsGrVgYewQbJlk43Aw0ujMajwCinYuDDsW9b7I1gCa41ShWl0xSQ6MfkhuPDbcJO6TK6nTYyxSbWMtxo2eiMOehg+bHo5HUUCGyvRCNRnJFcJLP3GAqh8Ogjx9zY4/YcVb8c/eFM/BiBKHw41T4a0fR6scB9GKDjT8vDa4ysgGeEjeiPh+PjDSTS/y/CWrin97xXwrdUbsWbhuxHQ66HZ9rEJoZFb8oxtHgnqyEgMbwdO' (decoded length: 1308).
> negotiate_kerberos_auth.cc(128): pid=40980 :2014/10/07 13:12:37| negotiate_kerberos_auth: ERROR: gss_acquire_cred() failed:  No credentials were supplied, or the credentials were unavailable or inaccessible.. unknown mech-code 0 for mech unknown
> 2014/10/07 13:12:37 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: gss_acquire_cred() failed:  No credentials were supplied, or the credentials were unavailable or inaccessible.. unknown mech-code 0 for mech unknown; }}
> 
> -- 
> Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
> sip:sudakov at sibptus.tomsk.ru

> negotiate_kerberos_auth.cc(212): pid=40984 :2014/10/07 13:12:08| negotiate_kerberos_auth: INFO: Starting version 3.0.4sq
> negotiate_kerberos_auth.cc(258): pid=40980 :2014/10/07 13:12:37| negotiate_kerberos_auth: DEBUG: Got 'YR YIIFGAYGKwYBBQUCoIIFDDCCBQigJDAiBgkqhkiC9xIBAgIGCSqGSIb3EgECAgYKKwYBBAGCNwICCqKCBN4EggTaYIIE1gYJKoZIhvcSAQICAQBuggTFMIIEwaADAgEFoQMCAQ6iBwMFACAAAACjggPpYYID5TCCA+GgAwIBBaEWGxRTSUJQVFVTLlRSQU5TTkVGVC5SVaItMCugAwIBAqEkMCIbBEhUVFAbGnByb3h5LnNpYnB0dXMudHJhbnNuZWZ0LnJ1o4IDkTCCA42gAwIBA6KCA4QEggOAB8tiAa54xI00BfngMyI8cwFHbNKRZPVn1c/HKYPi4Dppq0fIjp2e5br7rHG51+1/w6zaDwHKqdtnpWh/OplOkn6tDNq0H2fi/jFeT0XKICrLxdpmDHRqNmiyxvtczdkcSyxXJ2254oM9VwuE39D8hqU58NmijTB+WQupz2hw4d+5euIFFwSSO8nD3CMaBVGgyNfp9YvUUy860L+KKEqb0LVXZ+/OsnlsyrEc3AaaXwSwS30+ZRv0jCLh1h7kc84XFPrjGqRPp7JmO5gUCF8k/GXNF3FAMBAaT4r/iAs8LFIixQiRUWJPtjcWAtH0Q3JumqB9Enm+JPNvGBvE83YvbBZtDJQ0uc5lOMVLavBh2Xgj86BmKlCsrOCiMoQ8SgsEAX6o110EeMI1Tef8t+2/WhzP39l5BGuXmdDA1zEmqzA83vvTy5JcKUXZ3IdwwJ4I+kW62qIMsceZ/hfdj/Iy+RjCNrum5FHXMDszMVacKHp9kJTMofuMhhOKD2o+Z91TWTkEwD3NNWGjTWdgECpJT/F7I1x35iQaLGvgLebpalPJEXY8A8od1HhXZaCkIPXcDoPUR1LTTk8bHYKan17EnOBf0CbjOkU8/ib2mLUL81RQHrt6vdTcXzxsAgoZYigptd/ilsXq0dbwjTuZP8ZcFFY+levmSPIn5TF5xZtmtymditNO28hSqDjxC2Lpoy65kqwXglxpijuicSXC4cC/O1TBbksyH/aw/7MbNTKupFpovZTensu/A6zYG3HCjKW9QBsgU4tBXRC6rTP0RAeuASUHpvHv4WhbS5AWNYmX1TNQ8QpfurM2tAzuFzYQN8LL3VT38o4SVK+visE9q1IGez70q9g6Naowvpp6g/h3FuCzUks2ydXchKNPe3KzuSJqzmkLlyjKMlVW8sYUwgKXqNsgi7aRArEfu0L3UqYG/7lao+QLDOBf5+uSzWarZ9IIS7ClIRBejXU7erVJrLBDlGZRbMu+hXacsGwv/1Ls+S8xCxnlRjQngHjLg8vvQBYslgvkMh77eyP+HjiUDOXqDYoDR5bIc/w5UX/Dvb4ECGiqhGd9UHHQkYn6NQnbO/2r+iVBdy1fvXhXE2LKgAFoQtf2tIqsTUZWv12O82X2KzcZJ7IEVMxbGtSj9cdncc16c5Y6DL9AzQryNIhSGxghZ7zyWwp4DBS19ru4l+dVQ4ikgb4wgbugAwIBA6KBswSBsGrVgYewQbJlk43Aw0ujMajwCinYuDDsW9b7I1gCa41ShWl0xSQ6MfkhuPDbcJO6TK6nTYyxSbWMtxo2eiMOehg+bHo5HUUCGyvRCNRnJFcJLP3GAqh8Ogjx9zY4/YcVb8c/eFM/BiBKHw41T4a0fR6scB9GKDjT8vDa4ysgGeEjeiPh+PjDSTS/y/CWrin97xXwrdUbsWbhuxHQ66HZ9rEJoZFb8oxtHgnqyEgMbwdO' from squid (length: 1747).
> negotiate_kerberos_auth.cc(311): pid=40980 :2014/10/07 13:12:37| negotiate_kerberos_auth: DEBUG: Decode 'YIIFGAYGKwYBBQUCoIIFDDCCBQigJDAiBgkqhkiC9xIBAgIGCSqGSIb3EgECAgYKKwYBBAGCNwICCqKCBN4EggTaYIIE1gYJKoZIhvcSAQICAQBuggTFMIIEwaADAgEFoQMCAQ6iBwMFACAAAACjggPpYYID5TCCA+GgAwIBBaEWGxRTSUJQVFVTLlRSQU5TTkVGVC5SVaItMCugAwIBAqEkMCIbBEhUVFAbGnByb3h5LnNpYnB0dXMudHJhbnNuZWZ0LnJ1o4IDkTCCA42gAwIBA6KCA4QEggOAB8tiAa54xI00BfngMyI8cwFHbNKRZPVn1c/HKYPi4Dppq0fIjp2e5br7rHG51+1/w6zaDwHKqdtnpWh/OplOkn6tDNq0H2fi/jFeT0XKICrLxdpmDHRqNmiyxvtczdkcSyxXJ2254oM9VwuE39D8hqU58NmijTB+WQupz2hw4d+5euIFFwSSO8nD3CMaBVGgyNfp9YvUUy860L+KKEqb0LVXZ+/OsnlsyrEc3AaaXwSwS30+ZRv0jCLh1h7kc84XFPrjGqRPp7JmO5gUCF8k/GXNF3FAMBAaT4r/iAs8LFIixQiRUWJPtjcWAtH0Q3JumqB9Enm+JPNvGBvE83YvbBZtDJQ0uc5lOMVLavBh2Xgj86BmKlCsrOCiMoQ8SgsEAX6o110EeMI1Tef8t+2/WhzP39l5BGuXmdDA1zEmqzA83vvTy5JcKUXZ3IdwwJ4I+kW62qIMsceZ/hfdj/Iy+RjCNrum5FHXMDszMVacKHp9kJTMofuMhhOKD2o+Z91TWTkEwD3NNWGjTWdgECpJT/F7I1x35iQaLGvgLebpalPJEXY8A8od1HhXZaCkIPXcDoPUR1LTTk8bHYKan17EnOBf0CbjOkU8/ib2mLUL81RQHrt6vdTcXzxsAgoZYigptd/ilsXq0dbwjTuZP8ZcFFY+levmSPIn5TF5xZtmtymditNO28hSqDjxC2Lpoy65kqwXglxpijuicSXC4cC/O1TBbksyH/aw/7MbNTKupFpovZTensu/A6zYG3HCjKW9QBsgU4tBXRC6rTP0RAeuASUHpvHv4WhbS5AWNYmX1TNQ8QpfurM2tAzuFzYQN8LL3VT38o4SVK+visE9q1IGez70q9g6Naowvpp6g/h3FuCzUks2ydXchKNPe3KzuSJqzmkLlyjKMlVW8sYUwgKXqNsgi7aRArEfu0L3UqYG/7lao+QLDOBf5+uSzWarZ9IIS7ClIRBejXU7erVJrLBDlGZRbMu+hXacsGwv/1Ls+S8xCxnlRjQngHjLg8vvQBYslgvkMh77eyP+HjiUDOXqDYoDR5bIc/w5UX/Dvb4ECGiqhGd9UHHQkYn6NQnbO/2r+iVBdy1fvXhXE2LKgAFoQtf2tIqsTUZWv12O82X2KzcZJ7IEVMxbGtSj9cdncc16c5Y6DL9AzQryNIhSGxghZ7zyWwp4DBS19ru4l+dVQ4ikgb4wgbugAwIBA6KBswSBsGrVgYewQbJlk43Aw0ujMajwCinYuDDsW9b7I1gCa41ShWl0xSQ6MfkhuPDbcJO6TK6nTYyxSbWMtxo2eiMOehg+bHo5HUUCGyvRCNRnJFcJLP3GAqh8Ogjx9zY4/YcVb8c/eFM/BiBKHw41T4a0fR6scB9GKDjT8vDa4ysgGeEjeiPh+PjDSTS/y/CWrin97xXwrdUbsWbhuxHQ66HZ9rEJoZFb8oxtHgnqyEgMbwdO' (decoded length: 1308).
> negotiate_kerberos_auth.cc(128): pid=40980 :2014/10/07 13:12:37| negotiate_kerberos_auth: ERROR: gss_acquire_cred() failed:  No credentials were supplied, or the credentials were unavailable or inaccessible.. unknown mech-code 0 for mech unknown
> 2014/10/07 13:12:37 kid1| ERROR: Negotiate Authentication validating user. Result: {result=BH, notes={message: gss_acquire_cred() failed:  No credentials were supplied, or the credentials were unavailable or inaccessible.. unknown mech-code 0 for mech unknown; }}

> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru


From ahmed.zaeem at netstream.ps  Tue Oct  7 19:14:54 2014
From: ahmed.zaeem at netstream.ps (Ahmed Allzaeem)
Date: Tue, 7 Oct 2014 12:14:54 -0700
Subject: [squid-users] squid ipv6 outgoing addresses from ipv4 incoming
	traffic
In-Reply-To: <54335298.7020905@treenet.co.nz>
References: <000001cfe20c$3a4159c0$aec40d40$@netstream.ps>
 <54335298.7020905@treenet.co.nz>
Message-ID: <001201cfe262$faf13d60$f0d3b820$@netstream.ps>

Hi Amos , 
Thanks a lot.
But I still have an errros !!!

Here is my squid.conf 
=======================
# Squid normally listens to port 3128
http_port 64000

# Uncomment and adjust th;e following to add a disk cache directory.
#cache_dir ufs /var/cache/squid 100 16 256

# Leave coredumps in the first cache dir
coredump_dir /var/cache/squid

#
# Add any of your own refresh_pattern entries above these.
#
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320
########################################
acl user1 myportname 212.111.xx:40001
acl user2 myportname 212.111.xx:40002
tcp_outgoing_address [2a01:7e00:e000:eb::aaaa] user1
tcp_outgoing_address [2a01:7e00:e000:eb::bbbb] user2
==========================================

I have an errros below :
2014/10/07 09:14:03| Processing: acl user1 myportname xxx111.41.9:40001
2014/10/07 09:14:03| Processing: acl user2 myportname xxx111.41.9:40002
2014/10/07 09:14:03| Processing: tcp_outgoing_address [2a01:7e00:e000:eb::aaaa] user1
2014/10/07 09:14:03| FATAL: invalid IP address or domain name '[2a01:7e00:e000:eb::aaaa]'
FATAL: Bungled /etc/squid/squid.conf line 77: tcp_outgoing_address [2a01:7e00:e000:eb::aaaa] user1
Squid Cache (Version 3.4.3): Terminated abnormally.
CPU Usage: 0.007 seconds = 0.003 user + 0.003 sys
Maximum Resident Size: 33120 KB
Page faults with physical i/o: 0
[root at localhost ~]#



I have already those two ipv6 addresses on the server !

-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Amos Jeffries
Sent: Monday, October 6, 2014 7:40 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] squid ipv6 outgoing addresses from ipv4 incoming traffic

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 7/10/2014 9:53 p.m., Ahmed Allzaeem wrote:
> Hi ,
> 
> I have 1 single ipv4 ip and have many ipv6 ips
> 
> I need to listen on the ipv4 on many ports
> 
> As an example
> 
> 1.1.1.1:40000
> 
> 1.1.1.1:40001
> 
> 1.1.1.1:40002
> 
> 
> 
> In corresponding I need each ipv4:port to be tcp_outgoing to different 
> ipv6 address
> 
> I have about 3 ips.
> 
> 
> 
> Can I know why the config below is wrong ???

The myportname is the string value of the http_port first parameter by default.

> 
> http_port 241.xxx.xxx.101:40001

default name: 241.xxx.xxx.101:40001


> http_port 241.xxx.xxx.101:40002
> 
> http_port 241.xxx.xxx.101:40003
> 
> 


So you need:

acl user1 myportname 241.xxx.xxx.101:40001

acl user2 myportname 241.xxx.xxx.101:40002

acl user3 myportname 241.xxx.xxx.101:40003


Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUM1KXAAoJELJo5wb/XPRjOKYIAMPO5rrXnhkrQXS6yi8hX2eX
3RPxOAPal6cdXq3H0+c1EUXanO5gr6rbGl+fXOtx1hypl52eLKORHf+Ct+UyVK2x
BRtKi9pkDzXwqnK8WbEUVEuCyV1mBg40jjcwsCUFOzukile8R6cRG3ytHMzjXTjI
b+SDgW+4y2BszCUMSdnu39TsaEgxxnWCHSdA46F2S2H6xYDHjJJokuXjqM6Bo4lg
X5ySficDEv2dFSrOjehw7As7uj0pX/e+2G3qI9RciNCH+rJrPJ0xd2m38/FZ/wdV
pHOhm/osmrHApWTpTFHBU9onUwPiKg3HO9yDbprteZ7KyLFu5hh2UDNFveAABn4=
=gWb4
-----END PGP SIGNATURE-----
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From ahmed.zaeem at netstream.ps  Tue Oct  7 19:28:59 2014
From: ahmed.zaeem at netstream.ps (Ahmed Allzaeem)
Date: Tue, 7 Oct 2014 12:28:59 -0700
Subject: [squid-users] squid ipv6 outgoing addresses from ipv4
	incoming	traffic
In-Reply-To: <001201cfe262$faf13d60$f0d3b820$@netstream.ps>
References: <000001cfe20c$3a4159c0$aec40d40$@netstream.ps>
 <54335298.7020905@treenet.co.nz>
 <001201cfe262$faf13d60$f0d3b820$@netstream.ps>
Message-ID: <001301cfe264$f2f9ae10$d8ed0a30$@netstream.ps>

Hi AMOS , I think there were an issue with brackets of ipv6 and I removed it.
The squid.conf file is as :
======================================
http_port 64000
http_port 40001
http_port 40002
acl user1 myportname xxx.41.9:40001
acl user2 myportname xxxx.41.9:40002
tcp_outgoing_address 2a01:7e00:e000:eb::aaaa user1
tcp_outgoing_address 2a01:7e00:e000:eb::bbbb user2
============================================



But I still cant access the ipv6 with the correct tcp_out addfresss ??

Here is wt is my ipaddress show :
This page shows your IPv6 and/or IPv4 address
You are connecting with an IPv6 Address of:
2a01:7e00:e000:eb::dddd
IPv4 only Test 	Normal Test 	IPv6 only Test


But I was supposed to be as  2a01:7e00:e000:eb::aaaa or 2a01:7e00:e000:eb::bbbb  not with 2a01:7e00:e000:eb::dddd
!!!!????

-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Ahmed Allzaeem
Sent: Tuesday, October 7, 2014 12:15 PM
To: 'Amos Jeffries'; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] squid ipv6 outgoing addresses from ipv4 incoming traffic

Hi Amos ,
Thanks a lot.
But I still have an errros !!!

Here is my squid.conf
=======================
# Squid normally listens to port 3128
http_port 64000

# Uncomment and adjust th;e following to add a disk cache directory.
#cache_dir ufs /var/cache/squid 100 16 256

# Leave coredumps in the first cache dir coredump_dir /var/cache/squid

#
# Add any of your own refresh_pattern entries above these.
#
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320
########################################
acl user1 myportname 212.111.xx:40001
acl user2 myportname 212.111.xx:40002
tcp_outgoing_address [2a01:7e00:e000:eb::aaaa] user1 tcp_outgoing_address [2a01:7e00:e000:eb::bbbb] user2 ==========================================

I have an errros below :
2014/10/07 09:14:03| Processing: acl user1 myportname xxx111.41.9:40001
2014/10/07 09:14:03| Processing: acl user2 myportname xxx111.41.9:40002
2014/10/07 09:14:03| Processing: tcp_outgoing_address [2a01:7e00:e000:eb::aaaa] user1
2014/10/07 09:14:03| FATAL: invalid IP address or domain name '[2a01:7e00:e000:eb::aaaa]'
FATAL: Bungled /etc/squid/squid.conf line 77: tcp_outgoing_address [2a01:7e00:e000:eb::aaaa] user1 Squid Cache (Version 3.4.3): Terminated abnormally.
CPU Usage: 0.007 seconds = 0.003 user + 0.003 sys Maximum Resident Size: 33120 KB Page faults with physical i/o: 0 [root at localhost ~]#



I have already those two ipv6 addresses on the server !

-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Amos Jeffries
Sent: Monday, October 6, 2014 7:40 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] squid ipv6 outgoing addresses from ipv4 incoming traffic

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 7/10/2014 9:53 p.m., Ahmed Allzaeem wrote:
> Hi ,
> 
> I have 1 single ipv4 ip and have many ipv6 ips
> 
> I need to listen on the ipv4 on many ports
> 
> As an example
> 
> 1.1.1.1:40000
> 
> 1.1.1.1:40001
> 
> 1.1.1.1:40002
> 
> 
> 
> In corresponding I need each ipv4:port to be tcp_outgoing to different
> ipv6 address
> 
> I have about 3 ips.
> 
> 
> 
> Can I know why the config below is wrong ???

The myportname is the string value of the http_port first parameter by default.

> 
> http_port 241.xxx.xxx.101:40001

default name: 241.xxx.xxx.101:40001


> http_port 241.xxx.xxx.101:40002
> 
> http_port 241.xxx.xxx.101:40003
> 
> 


So you need:

acl user1 myportname 241.xxx.xxx.101:40001

acl user2 myportname 241.xxx.xxx.101:40002

acl user3 myportname 241.xxx.xxx.101:40003


Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUM1KXAAoJELJo5wb/XPRjOKYIAMPO5rrXnhkrQXS6yi8hX2eX
3RPxOAPal6cdXq3H0+c1EUXanO5gr6rbGl+fXOtx1hypl52eLKORHf+Ct+UyVK2x
BRtKi9pkDzXwqnK8WbEUVEuCyV1mBg40jjcwsCUFOzukile8R6cRG3ytHMzjXTjI
b+SDgW+4y2BszCUMSdnu39TsaEgxxnWCHSdA46F2S2H6xYDHjJJokuXjqM6Bo4lg
X5ySficDEv2dFSrOjehw7As7uj0pX/e+2G3qI9RciNCH+rJrPJ0xd2m38/FZ/wdV
pHOhm/osmrHApWTpTFHBU9onUwPiKg3HO9yDbprteZ7KyLFu5hh2UDNFveAABn4=
=gWb4
-----END PGP SIGNATURE-----
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From sudakov at sibptus.tomsk.ru  Tue Oct  7 09:47:12 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Tue, 7 Oct 2014 16:47:12 +0700
Subject: [squid-users] https issues for google
In-Reply-To: <2329B68B3D676246BA0D1149E22F509F01A02886@bneseqs20.bradnams.com.au>
References: <2329B68B3D676246BA0D1149E22F509F01A02886@bneseqs20.bradnams.com.au>
Message-ID: <20141007094712.GA63356@admin.sibptus.tomsk.ru>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

glenn.groves at bradnams.com.au wrote:

> 
> We have a weird issue where https sites apparently don't respond
> (get message "this page can't be displayed"). This mainly affects
> google websites and to a lesser affect youtube. 

But if you switch off proxy authentication, https sites start working,
right?

- -- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUM7agAAoJEA2k8lmbXsY0SswIAKaYLybj92jJULi16lVfrZgm
hrizPJrpJAmLUwh5jtpQETGfc5owS9eyrwczh3dD1BZiLDQp2BUAMdlpG4bpmcFD
pLCQhjLZur63/DD/C3hWcch59wceAXFsJa4O2YKC9kFkijnJK+o5K/ixUl2Xbsoy
2VkHYpimXTvEJcRG6P3tpvkUmjl1IzrFtkUdmV7DmJVdacGOFeVu7UCPnXRD97K0
fdtLGH7tTw04PfBJIr985i+Tht+C6uqTQo4W1l41JRIGdSGOxTedYj4dIpvHh9YW
KtC4zxrDj+H4H9doOZwPo9sa3vY+HyT2oO2vHur1mPgt1RVmPsO+mo35h7CQj4I=
=ZAyn
-----END PGP SIGNATURE-----


From gecom at tubosider.it  Tue Oct  7 10:17:42 2014
From: gecom at tubosider.it (masterx81)
Date: Tue, 7 Oct 2014 03:17:42 -0700 (PDT)
Subject: [squid-users] Kerberos auth not working
In-Reply-To: <m0ms43$8or$1@ger.gmane.org>
References: <1412350469245-4667646.post@n4.nabble.com>
 <1412360733691-4667648.post@n4.nabble.com> <m0ms43$8or$1@ger.gmane.org>
Message-ID: <1412677062891-4667735.post@n4.nabble.com>

Thanks for the answer, i'll try that when i have some time :)



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Kerberos-auth-not-working-tp4667646p4667735.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From gecom at tubosider.it  Tue Oct  7 10:33:43 2014
From: gecom at tubosider.it (masterx81)
Date: Tue, 7 Oct 2014 03:33:43 -0700 (PDT)
Subject: [squid-users] problem with basic_ldap_auth
Message-ID: <1412678023114-4667736.post@n4.nabble.com>

Hi to all!
I'm having an issue on squid 3.3.13 using basic_ldap_auth.
I'm using the following helpers:
auth_param negotiate program /usr/local/bin/negotiate_wrapper --ntlm
/usr/bin/ntlm_auth --helper-protocol=squid-2.5-ntlmssp --domain=DOMAIN
--kerberos /usr/local/bin/squid_kerb_auth -s GSS_C_NO_NAME
auth_param negotiate children 10
auth_param negotiate keep_alive on

auth_param ntlm program /usr/bin/ntlm_auth
--helper-protocol=squid-2.5-ntlmssp --domain=DOMAIN
auth_param ntlm children 10
auth_param ntlm keep_alive on

auth_param basic program /usr/local/squid/libexec/basic_ldap_auth -v 3 -R -b
"dc=domain,dc=local" -D squid at domain.local -W /etc/squid/ldappass.txt -d -f
sAMAccountName=%s -h srv-dc1.domain.local
auth_param basic children 10
auth_param basic realm Proxy DOMAIN
auth_param basic credentialsttl 1 minute

NTLM and kerberos are working correctly, but the basic helper seem to not
work well. The browser ask me 3 times the password, then give me the cache
error. After this, windows save the credentials in it's cache (seen in
account manager) and if i close and reopen the browser it work but seem to
use NTLM as i get the ticket in the cache.log.
In che cache.log i not see any line of the basic helper also with the -d
switch.
If i call the helper manually from command line it works and give me "OK" if
i pass correct user/pass and "ERR Success" if i pass wrong credentials.

Before the 3.3.13 i was using a 3.4.x version, and all was working ok, but
i've had the need to go back as on 3.4 i have huge cpu utilization using
NTLM. On the 3.3.13 cpu usage is really low but seen that there is this
throuble with basic helpers....
Some have a suggestion for me?

Really thank for any help!



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/problem-with-basic-ldap-auth-tp4667736.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From squid3 at treenet.co.nz  Tue Oct  7 10:45:57 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 07 Oct 2014 23:45:57 +1300
Subject: [squid-users] squid ipv6 outgoing addresses from ipv4 incoming
 traffic
In-Reply-To: <001301cfe264$f2f9ae10$d8ed0a30$@netstream.ps>
References: <000001cfe20c$3a4159c0$aec40d40$@netstream.ps>
 <54335298.7020905@treenet.co.nz>
 <001201cfe262$faf13d60$f0d3b820$@netstream.ps>
 <001301cfe264$f2f9ae10$d8ed0a30$@netstream.ps>
Message-ID: <5433C465.7090309@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 8/10/2014 8:28 a.m., Ahmed Allzaeem wrote:
> Hi AMOS , I think there were an issue with brackets of ipv6 and I
> removed it.

Good. Yes, brackets are only valid if it is potentially an ip:port pair.

(When I get time I will look into why squid is not accepting them anyway.)


> The squid.conf file is as : ====================================== 
> http_port 64000 http_port 40001 http_port 40002 acl user1
> myportname xxx.41.9:40001 acl user2 myportname xxxx.41.9:40002 
> tcp_outgoing_address 2a01:7e00:e000:eb::aaaa user1 
> tcp_outgoing_address 2a01:7e00:e000:eb::bbbb user2 
> ============================================
> 
> 
> 
> But I still cant access the ipv6 with the correct tcp_out addfresss
> ??


Look back at what I said.

> The myportname is the string value of the http_port first
> parameter
by default.
> 


Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUM8RkAAoJELJo5wb/XPRjkwkIAJ6IeFn+xs9O1run4Rd63aSO
buQW9JwZmW+JwbcuF4RnPXihvUfBm4ZxiYFAuvaixJmexR6pcI5oCuHGROGnLMvQ
E6i7WFiDMhJZreqi5AoRfZfxFyyeAVMbET4FXKnSpctfm9LlvoIRB4v0J/fXg8dT
xI1MWw7yqOopwebEza8K/ci7VZ+EuQFyLHsKUF3gm1yJeNL0X0qoUH6vlZLXq9HE
bNmKIveIeZontNcxiKiSH7Oo0m+4MJAMDkOOuEUFESS6meZi21ZkokepR6nr17KS
y2LF0we7yH87q60o12SGWSASM/TzLLRqja50F0Gv7MRQl2SAAOgRa1TOf9zfO3M=
=6WS4
-----END PGP SIGNATURE-----


From ahmed.zaeem at netstream.ps  Tue Oct  7 20:48:26 2014
From: ahmed.zaeem at netstream.ps (Ahmed Allzaeem)
Date: Tue, 7 Oct 2014 13:48:26 -0700
Subject: [squid-users] squid ipv6 outgoing addresses from ipv4 incoming
	traffic
In-Reply-To: <5433C465.7090309@treenet.co.nz>
References: <000001cfe20c$3a4159c0$aec40d40$@netstream.ps>
 <54335298.7020905@treenet.co.nz>
 <001201cfe262$faf13d60$f0d3b820$@netstream.ps>
 <001301cfe264$f2f9ae10$d8ed0a30$@netstream.ps>
 <5433C465.7090309@treenet.co.nz>
Message-ID: <000001cfe270$0c4385c0$24ca9140$@netstream.ps>

Hi Amos , thank you so much for help ......its working with me now !!!

I just added http_port directive for the other ports and its okay now 

Thanks a lot for your time
regards
:)


regards

-----Original Message-----
From: Amos Jeffries [mailto:squid3 at treenet.co.nz] 
Sent: Tuesday, October 7, 2014 3:46 AM
To: Ahmed Allzaeem; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] squid ipv6 outgoing addresses from ipv4 incoming traffic

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 8/10/2014 8:28 a.m., Ahmed Allzaeem wrote:
> Hi AMOS , I think there were an issue with brackets of ipv6 and I 
> removed it.

Good. Yes, brackets are only valid if it is potentially an ip:port pair.

(When I get time I will look into why squid is not accepting them anyway.)


> The squid.conf file is as : ======================================
> http_port 64000 http_port 40001 http_port 40002 acl user1 myportname 
> xxx.41.9:40001 acl user2 myportname xxxx.41.9:40002 
> tcp_outgoing_address 2a01:7e00:e000:eb::aaaa user1 
> tcp_outgoing_address 2a01:7e00:e000:eb::bbbb user2 
> ============================================
> 
> 
> 
> But I still cant access the ipv6 with the correct tcp_out addfresss ??


Look back at what I said.

> The myportname is the string value of the http_port first parameter
by default.
> 


Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUM8RkAAoJELJo5wb/XPRjkwkIAJ6IeFn+xs9O1run4Rd63aSO
buQW9JwZmW+JwbcuF4RnPXihvUfBm4ZxiYFAuvaixJmexR6pcI5oCuHGROGnLMvQ
E6i7WFiDMhJZreqi5AoRfZfxFyyeAVMbET4FXKnSpctfm9LlvoIRB4v0J/fXg8dT
xI1MWw7yqOopwebEza8K/ci7VZ+EuQFyLHsKUF3gm1yJeNL0X0qoUH6vlZLXq9HE
bNmKIveIeZontNcxiKiSH7Oo0m+4MJAMDkOOuEUFESS6meZi21ZkokepR6nr17KS
y2LF0we7yH87q60o12SGWSASM/TzLLRqja50F0Gv7MRQl2SAAOgRa1TOf9zfO3M=
=6WS4
-----END PGP SIGNATURE-----



From ahmed.zaeem at netstream.ps  Tue Oct  7 20:53:54 2014
From: ahmed.zaeem at netstream.ps (Ahmed Allzaeem)
Date: Tue, 7 Oct 2014 13:53:54 -0700
Subject: [squid-users] squid ipv6 outgoing addresses from ipv4
	incoming	traffic
In-Reply-To: <000001cfe270$0c4385c0$24ca9140$@netstream.ps>
References: <000001cfe20c$3a4159c0$aec40d40$@netstream.ps>
 <54335298.7020905@treenet.co.nz>
 <001201cfe262$faf13d60$f0d3b820$@netstream.ps>
 <001301cfe264$f2f9ae10$d8ed0a30$@netstream.ps>
 <5433C465.7090309@treenet.co.nz>
 <000001cfe270$0c4385c0$24ca9140$@netstream.ps>
Message-ID: <000101cfe270$cfb3df00$6f1b9d00$@netstream.ps>

I just have one final question , I want to use tcp outgoing ipv6 based on user authentication
I mean if user A ==>ipv61
If user B ==<ipv62

And so on ,
Actually I had treid but no luck , I have two users (Drvirus) & (drx) all the time they go  out from 

I have configured ACL user access but not sure if im wrong !

Thos user are stored in etc/squid/squid_user I created two of them here !

So now I use port 64000 and enter users drvirusx & drx but both go out from 2a01:7e00:e000:eb::dddd
I belkive they dhould go out from 
2a01:7e00:e000:eb::1111 & 2a01:7e00:e000:eb::2222

Can u have a look when u have time ???

Here is my last config
=============


auth_param basic children 20
auth_param basic realm Linux Class
auth_param basic program /lib/squid/basic_ncsa_auth /etc/squid/squid_user
auth_param basic credentialsttl 2 hours
auth_param basic casesensitive off
###
acl classx proxy_auth REQUIRED

http_access allow classx
# Recommended minimum configurat

# Squid normally listens to port 3128
http_port xxx:64000
#######################users acls###########
acl drvirus note user drvirus
acl drx note user drx
# Uncomment and adjust th;e following to add a disk cache directory.
#cache_dir ufs /var/cache/squid 100 16 256

# Leave coredumps in the first cache dir
tcp_outgoing_address 2a01:7e00:e000:eb::1111 drvirus
tcp_outgoing_address 2a01:7e00:e000:eb::2222 drx
===============================

-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Ahmed Allzaeem
Sent: Tuesday, October 7, 2014 1:48 PM
To: 'Amos Jeffries'
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] squid ipv6 outgoing addresses from ipv4 incoming traffic

Hi Amos , thank you so much for help ......its working with me now !!!

I just added http_port directive for the other ports and its okay now 

Thanks a lot for your time
regards
:)


regards

-----Original Message-----
From: Amos Jeffries [mailto:squid3 at treenet.co.nz]
Sent: Tuesday, October 7, 2014 3:46 AM
To: Ahmed Allzaeem; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] squid ipv6 outgoing addresses from ipv4 incoming traffic

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 8/10/2014 8:28 a.m., Ahmed Allzaeem wrote:
> Hi AMOS , I think there were an issue with brackets of ipv6 and I 
> removed it.

Good. Yes, brackets are only valid if it is potentially an ip:port pair.

(When I get time I will look into why squid is not accepting them anyway.)


> The squid.conf file is as : ======================================
> http_port 64000 http_port 40001 http_port 40002 acl user1 myportname
> xxx.41.9:40001 acl user2 myportname xxxx.41.9:40002 
> tcp_outgoing_address 2a01:7e00:e000:eb::aaaa user1 
> tcp_outgoing_address 2a01:7e00:e000:eb::bbbb user2 
> ============================================
> 
> 
> 
> But I still cant access the ipv6 with the correct tcp_out addfresss ??


Look back at what I said.

> The myportname is the string value of the http_port first parameter
by default.
> 


Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUM8RkAAoJELJo5wb/XPRjkwkIAJ6IeFn+xs9O1run4Rd63aSO
buQW9JwZmW+JwbcuF4RnPXihvUfBm4ZxiYFAuvaixJmexR6pcI5oCuHGROGnLMvQ
E6i7WFiDMhJZreqi5AoRfZfxFyyeAVMbET4FXKnSpctfm9LlvoIRB4v0J/fXg8dT
xI1MWw7yqOopwebEza8K/ci7VZ+EuQFyLHsKUF3gm1yJeNL0X0qoUH6vlZLXq9HE
bNmKIveIeZontNcxiKiSH7Oo0m+4MJAMDkOOuEUFESS6meZi21ZkokepR6nr17KS
y2LF0we7yH87q60o12SGWSASM/TzLLRqja50F0Gv7MRQl2SAAOgRa1TOf9zfO3M=
=6WS4
-----END PGP SIGNATURE-----

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From steve at opendium.com  Tue Oct  7 15:40:08 2014
From: steve at opendium.com (Steve Hill)
Date: Tue, 07 Oct 2014 16:40:08 +0100
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <542AC87D.7040806@treenet.co.nz>
References: <20140928062806.GA34166@admin.sibptus.tomsk.ru>
 <5427B9EC.6060500@ngtech.co.il> <5429209D.1050909@opendium.com>
 <542ABA7F.6010401@treenet.co.nz> <542AC54C.408@opendium.com>
 <542AC87D.7040806@treenet.co.nz>
Message-ID: <54340958.6070601@opendium.com>

On 30.09.14 16:13, Amos Jeffries wrote:

>> I'm trying to figure out if there's a way of convincing valgrind to
>> dump info about all the currently allocated memory while the
>> program is still running - there would be a lot of legitimate stuff
>> in the report, but hopefully a few hundred MB of memory that
>> shouldn't be there would stick out like a sore thumb.
>
> That would be lovely. If you can find it I'd like to know too :-)

su -s /bin/bash squid
valgrind --vgdb=full --error-limit=no --tool=memcheck --leak-check=full 
--show-reachable=yes --leak-resolution=high --num-callers=40 squid -f 
/etc/squid/squid.conf -N

Do whatever you need to do to trigger a leak, then in another window:
su -s /bin/bash squid
gdb squid

At the gdb prompt:
target remote | vgdb
set logging file /tmp/leaks.txt
set logging on
monitor leak_check full reachable any

This will dump out all the currently allocated memory to the console 
(and to /tmp/leaks.txt).

-- 
  - Steve


From lord.tek at gmail.com  Tue Oct  7 16:10:07 2014
From: lord.tek at gmail.com (foggle)
Date: Tue, 7 Oct 2014 09:10:07 -0700 (PDT)
Subject: [squid-users] Problems with NTLM authentication
Message-ID: <1412698207586-4667742.post@n4.nabble.com>

Hello,

I have set up a squid Proxy that uses samba/ntlm/krb5 to do SSO AD
authentication in the Company.


This works fine.

My problem is that external Websites on the Internet that use NTLM
authentication of their own do not work. My users enter their Details
(DOMAIN\user and Password) and receive authentication failures Messages.

Interestingly enough, this (almost) only occurs in Internet Explorer. The
same sites work fine with Firefox.

Thank you in advance for your much needed help.



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Problems-with-NTLM-authentication-tp4667742.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From sudakov at sibptus.tomsk.ru  Tue Oct  7 16:15:46 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Tue, 7 Oct 2014 23:15:46 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <20141007091338.GA62111@admin.sibptus.tomsk.ru>
References: <20141006040725.GA31642@admin.sibptus.tomsk.ru>
 <20141006052346.GA32369@admin.sibptus.tomsk.ru>
 <20141007070403.GA57384@admin.sibptus.tomsk.ru>
 <20141007091338.GA62111@admin.sibptus.tomsk.ru>
Message-ID: <20141007161546.GA68739@admin.sibptus.tomsk.ru>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Colleagues,

I am posting below the contents of an HTTP request (especially the
"Proxy-Authorization:" header the browser is sending) to which squid's 
negotiate_kerberos_auth replies:

"ERROR: Negotiate Authentication validating user. Result: {result=BH,
notes={message: gss_acquire_cred() failed:  No credentials were
supplied, or the credentials were unavailable or inaccessible..
unknown mech-code 0 for mech unknown; } 

What's wrong with the contents of the header? Why does
negotiate_kerberos_auth not like it?


No.     Time        Source                Destination           Protocol Length Info
    101 50.565800   10.14.143.228         10.14.140.9           HTTP     897    GET http://www.nasa.gov/ HTTP/1.1 

Frame 101: 897 bytes on wire (7176 bits), 897 bytes captured (7176 bits)
Ethernet II, Src: Cisco_ce:9a:60 (00:17:5a:ce:9a:60), Dst: AsustekC_d9:90:67 (00:22:15:d9:90:67)
Internet Protocol Version 4, Src: 10.14.143.228 (10.14.143.228), Dst: 10.14.140.9 (10.14.140.9)
Transmission Control Protocol, Src Port: 2103 (2103), Dst Port: 3131 (3131), Seq: 7389, Ack: 24813, Len: 843
[2 Reassembled TCP Segments (2303 bytes): #100(1460), #101(843)]
Hypertext Transfer Protocol
    GET http://www.nasa.gov/ HTTP/1.1\r\n
    Accept: */*\r\n
    Accept-Language: ru\r\n
    User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; .NET CLR 2.0.50727; .NET CLR 3.0.04506.648; .NET CLR 1.1.4322; .NET4.0C; .NET4.0E; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729)\r\n
    Accept-Encoding: gzip, deflate\r\n
    Proxy-Connection: Keep-Alive\r\n
    Host: www.nasa.gov\r\n
    Pragma: no-cache\r\n
    Cookie: __utma=259910805.2084310783.1412579533.1412579533.1412579533.1; __utmz=259910805.1412579533.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)\r\n
    [truncated] Proxy-Authorization: Negotiate YIIFGAYGKwYBBQUCoIIFDDCCBQigJDAiBgkqhkiC9xIBAgIGCSqGSIb3EgECAgYKKwYBBAGCNwICCqKCBN4EggTaYIIE1gYJKoZIhvcSAQICAQBuggTFMIIEwaADAgEFoQMCAQ6iBwMFACAAAACjggPpYYID5TCCA+GgAwIBBaEWGxRTSUJQVFVTLlRSQU5TTkVG
        GSS-API Generic Security Service Application Program Interface
            OID: 1.3.6.1.5.5.2 (SPNEGO - Simple Protected Negotiation)
            Simple Protected Negotiation
                negTokenInit
                    mechTypes: 3 items
                        MechType: 1.2.840.48018.1.2.2 (MS KRB5 - Microsoft Kerberos 5)
                        MechType: 1.2.840.113554.1.2.2 (KRB5 - Kerberos 5)
                        MechType: 1.3.6.1.4.1.311.2.2.10 (NTLMSSP - Microsoft NTLM Security Support Provider)
                    mechToken: 608204d606092a864886f71201020201006e8204c5308204...
                    krb5_blob: 608204d606092a864886f71201020201006e8204c5308204...
                        KRB5 OID: 1.2.840.113554.1.2.2 (KRB5 - Kerberos 5)
                        krb5_tok_id: KRB5_AP_REQ (0x0001)
                        Kerberos AP-REQ
                            Pvno: 5
                            MSG Type: AP-REQ (14)
                            Padding: 0
                            APOptions: 20000000 (Mutual required)
                                0... .... .... .... .... .... .... .... = reserved: RESERVED bit off
                                .0.. .... .... .... .... .... .... .... = Use Session Key: Do NOT use the session key to encrypt the ticket
                                ..1. .... .... .... .... .... .... .... = Mutual required: MUTUAL authentication is REQUIRED
                            Ticket
                                Tkt-vno: 5
                                Realm: SIBPTUS.TRANSNEFT.RU
                                Server Name (Service and Instance): HTTP/proxy.sibptus.transneft.ru
                                    Name-type: Service and Instance (2)
                                    Name: HTTP
                                    Name: proxy.sibptus.transneft.ru
                                enc-part des-cbc-md5
                                    Encryption type: des-cbc-md5 (3)
                                    enc-part: 6f43ba385aad8624bea2e0e2d9d1b4ad394a2330fa322d2a...
                            Authenticator des-cbc-md5
                                Encryption type: des-cbc-md5 (3)
                                Authenticator data: 55452dc45cbb32cd7ceafa12a3c4eeb28bb5a7d6fc0a37ca...
    \r\n
    [Full request URI: http://www.nasa.govhttp://www.nasa.gov/]
- -- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUNBGyAAoJEA2k8lmbXsY0W+kIAIvnTkXHrhuE8kKRNqPuDEEL
XP5F6fMif31XdcOWbIDmt+JQPUjQXHk6xuT6S0MuSsSSrFxg6LOcSmthZipxkNWy
fejPIiQe2sbpBLqdYqyuERbPtlLakASa0XeBf9iQYZ3AO9HbY21mOjBIWFrJ1tX8
sy9s5myhYVRQyIA03FUoT87nDMjJVZHie62iiHLEDwv4wARNEJ0pGjct904aam3a
JrUDfeyTCWeLoOCioEwCF8wAVnfuXbN5H/O1laefLPIFsb7zRtnRQMPxcGprvO29
bTyow2cQch4m8NjErgHDfeP2C6qqtV+dOBnapuIHuQHetdnw4ddRbClVYXalGqQ=
=gBRs
-----END PGP SIGNATURE-----


From Jason_Haar at trimble.com  Tue Oct  7 17:03:22 2014
From: Jason_Haar at trimble.com (Jason Haar)
Date: Wed, 8 Oct 2014 06:03:22 +1300
Subject: [squid-users] squid not liking dnscache for some hosts?
Message-ID: <54341CDA.7060507@trimble.com>

Hi there

We have CentOS-6 servers running the default squid-3.1.10 with dnscache
on 127.0.0.1 as the local dns server. It's been working fine but we've
just had reports that people couldn't reach urls on
dl.dropboxusercontent.com

On the proxy itself, "nslookup dl.dropboxusercontent.com" worked fine -
returning several IP addresses (just like google and all other Cloud
service providers do), but squid returns a 404 on any page in it
(X-Squid-Error: ERR_DNS_FAIL 0). It hangs and sniffing made me think it
was hanging on the DNS lookup part. I then edited /etc/resolv.conf and
pointed at some Microsoft DNS servers we have (which our dnscache just
forwards to anyway) and the problem was solved.

So it looks like dnscache doesn't like dl.dropboxusercontent.com, or
squid doesn't like how dnscache returns that data to it? All I know is
that this all works fine for everything else (ie we haven't had
complaints about any other sites with multiple IP addresses), and works
fine for dig/nslookup, but I can't for the life of me figure out what's
so different about this

Even the cachemgr cgi  "IP Cache" contains dl.dropboxusercontent.com
with only "OK" IP addresses  - even though squid returns "X-Squid-Error:
ERR_DNS_FAIL 0". The only difference between it and other cached hosts
is that it hasn't got a "H" flag like the other hosts do? I even cranked
up debugging, but all that shows up is matching dropboxusercontent.com
against acl lists and NOT getting a match (as expected) - it doesn't
seem to show DNS debugging?

Any ideas? Thanks

-- 
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1



From squid3 at treenet.co.nz  Tue Oct  7 17:54:34 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 08 Oct 2014 06:54:34 +1300
Subject: [squid-users] squid not liking dnscache for some hosts?
In-Reply-To: <54341CDA.7060507@trimble.com>
References: <54341CDA.7060507@trimble.com>
Message-ID: <543428DA.3010607@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 8/10/2014 6:03 a.m., Jason Haar wrote:
> Hi there
> 
> We have CentOS-6 servers running the default squid-3.1.10 with
> dnscache on 127.0.0.1 as the local dns server. It's been working
> fine but we've just had reports that people couldn't reach urls on 
> dl.dropboxusercontent.com
> 
> On the proxy itself, "nslookup dl.dropboxusercontent.com" worked
> fine - returning several IP addresses (just like google and all
> other Cloud service providers do), but squid returns a 404 on any
> page in it (X-Squid-Error: ERR_DNS_FAIL 0). It hangs and sniffing
> made me think it was hanging on the DNS lookup part. I then edited
> /etc/resolv.conf and pointed at some Microsoft DNS servers we have
> (which our dnscache just forwards to anyway) and the problem was
> solved.

Squid 3.1+ are IPv6 enabled. Unfortunately AAAA lookup for
dl.dropboxusercontent.com returns a positive CNAME result with
indication that there are no IP addresses.

This problem should be resolved by Squid-3.2 or later. Please upgrade,
preferrbley to the latest stable, which today is 3.4.8.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.13 (MingW32)

iQEcBAEBAgAGBQJUNCjaAAoJELJo5wb/XPRjY1YH/jrqBYgmf4am7g6us66pM5fA
c1d+GAisy5L9lQzFEmObroo7bQNbo2SyiafqAprmvw6gvPx4AAfsnsA3hsSZTEh3
IAk0gAAAeaLycBHPlH69oJ7BSeCqKePQ3GV8iMu6MU/c5S3X+V7RBoCSasvhPK0r
MA0jC38BFTBAKDsUJj1cwPVw0ZreWK+hD7Uqf+HAHtgpY+OZguEurzklTlronjui
9nOJTK7OOwajqGfOaDEbsjing1m9RL+QKu+aPbTW2Vo06VMPGW/CGx14xYzkA5sn
u0KBoEQtZTXENhhD06D3r5QYDwyzIBJPzGPn7LQGt5AH79hxYG/R/h4uBBC0a4E=
=WV73
-----END PGP SIGNATURE-----


From Jason_Haar at trimble.com  Tue Oct  7 18:36:14 2014
From: Jason_Haar at trimble.com (Jason Haar)
Date: Wed, 8 Oct 2014 07:36:14 +1300
Subject: [squid-users] squid not liking dnscache for some hosts?
In-Reply-To: <543428DA.3010607@treenet.co.nz>
References: <54341CDA.7060507@trimble.com> <543428DA.3010607@treenet.co.nz>
Message-ID: <5434329E.90700@trimble.com>

On 08/10/14 06:54, Amos Jeffries wrote:
>
> Squid 3.1+ are IPv6 enabled. Unfortunately AAAA lookup for
> dl.dropboxusercontent.com returns a positive CNAME result with
> indication that there are no IP addresses.
>
Argh. So they have a borked IPv6 address - they're in the wrong - well
that's a start :-)


> This problem should be resolved by Squid-3.2 or later. Please upgrade,
> preferrbley to the latest stable, which today is 3.4.8.
>

So newer versions did more sanity checking? Sigh, we're now getting
burnt by ipv6 - even though we don't use it - great...

Strangely enough, I just checked and now it's all working (AAA resolves
to CNAME which resolves to A records). I wonder if there's a Dropbox
engineer on this mailing-list...? ;-)

-- 
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1




From lord.tek at gmail.com  Tue Oct  7 18:50:46 2014
From: lord.tek at gmail.com (Marcel)
Date: Tue, 7 Oct 2014 20:50:46 +0200
Subject: [squid-users] Fwd:  Problems with NTLM authentication
In-Reply-To: <1412698207586-4667742.post@n4.nabble.com>
References: <1412698207586-4667742.post@n4.nabble.com>
Message-ID: <CABE8HShZ6JuocAOnNo++ijE+A=NqxqPdXj0vZOUyTTRkfG0YGQ@mail.gmail.com>

Hello,

I have some more information.
The problem seems to have nothing to do with samba, krb5 or anything else.
I set up a new squid that isn't in the AD and doesn't use any kind of
authentication at all.

I have the exact same problem. Here is my POC squid.conf:

acl localnet src all
http_access allow all
http_port 3128


That is the entire configuration in my tests. As you can see, it is
absolutely impossible for it to be a configuration issue.

Why can't I log on to a NTLM protected website with Internet Explorer when
going over a squid proxy?

It works fine in Firefox.



---------- Forwarded message ----------
From: foggle <lord.tek at gmail.com>
Date: 7 October 2014 18:10
Subject: [squid-users] Problems with NTLM authentication
To: squid-users at lists.squid-cache.org


Hello,

I have set up a squid Proxy that uses samba/ntlm/krb5 to do SSO AD
authentication in the Company.


This works fine.

My problem is that external Websites on the Internet that use NTLM
authentication of their own do not work. My users enter their Details
(DOMAIN\user and Password) and receive authentication failures Messages.

Interestingly enough, this (almost) only occurs in Internet Explorer. The
same sites work fine with Firefox.

Thank you in advance for your much needed help.



--
View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/Problems-with-NTLM-authentication-tp4667742.html
Sent from the Squid - Users mailing list archive at Nabble.com.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141007/aff39bcc/attachment.htm>

From bpk678 at gmail.com  Tue Oct  7 19:19:54 2014
From: bpk678 at gmail.com (Brendan Kearney)
Date: Tue, 07 Oct 2014 15:19:54 -0400
Subject: [squid-users] Fwd:  Problems with NTLM authentication
In-Reply-To: <CABE8HShZ6JuocAOnNo++ijE+A=NqxqPdXj0vZOUyTTRkfG0YGQ@mail.gmail.com>
References: <1412698207586-4667742.post@n4.nabble.com>
 <CABE8HShZ6JuocAOnNo++ijE+A=NqxqPdXj0vZOUyTTRkfG0YGQ@mail.gmail.com>
Message-ID: <1412709594.3894.3.camel@desktop.bpk2.com>

On Tue, 2014-10-07 at 20:50 +0200, Marcel wrote:
> Hello,
> 
> I have some more information.
> 
> The problem seems to have nothing to do with samba, krb5 or anything
> else. I set up a new squid that isn't in the AD and doesn't use any
> kind of authentication at all.
> 
> 
> I have the exact same problem. Here is my POC squid.conf:
> 
> acl localnet src all
> http_access allow all
> http_port 3128
> 
> 
> 
> That is the entire configuration in my tests. As you can see, it is
> absolutely impossible for it to be a configuration issue.
> 
> Why can't I log on to a NTLM protected website with Internet Explorer
> when going over a squid proxy?
> 
> 
> It works fine in Firefox.
> 
> 
> 
> ---------- Forwarded message ----------
> From: foggle <lord.tek at gmail.com>
> Date: 7 October 2014 18:10
> Subject: [squid-users] Problems with NTLM authentication
> To: squid-users at lists.squid-cache.org
> 
> 
> Hello,
> 
> I have set up a squid Proxy that uses samba/ntlm/krb5 to do SSO AD
> authentication in the Company.
> 
> 
> This works fine.
> 
> My problem is that external Websites on the Internet that use NTLM
> authentication of their own do not work. My users enter their Details
> (DOMAIN\user and Password) and receive authentication failures
> Messages.
> 
> Interestingly enough, this (almost) only occurs in Internet Explorer.
> The
> same sites work fine with Firefox.
> 
> Thank you in advance for your much needed help.
> 
> 
> 
> --
> View this message in context:
> http://squid-web-proxy-cache.1019090.n4.nabble.com/Problems-with-NTLM-authentication-tp4667742.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

not something that squid would be affecting, as squid has nothing to do
with the auth to the website.

Tools -> Internet Options -> Advanced tab: scroll down until you
Security.  Under Security, check the "Enable Integrated Windows
Authentication*" check box, and restart your browser.



From lord.tek at gmail.com  Tue Oct  7 19:25:01 2014
From: lord.tek at gmail.com (Marcel)
Date: Tue, 7 Oct 2014 21:25:01 +0200
Subject: [squid-users] Fwd: Problems with NTLM authentication
In-Reply-To: <1412709594.3894.3.camel@desktop.bpk2.com>
References: <1412698207586-4667742.post@n4.nabble.com>
 <CABE8HShZ6JuocAOnNo++ijE+A=NqxqPdXj0vZOUyTTRkfG0YGQ@mail.gmail.com>
 <1412709594.3894.3.camel@desktop.bpk2.com>
Message-ID: <CABE8HSjtE-JB08EFPta-jKGA-SFhr-d5tqiOWTZnqDX2tv2+bw@mail.gmail.com>

Hello,

thank you for your input. Unfortunately I have to disagree with you because
of two reasons:

1. That option is already enabled
2. The NTLM authentication works fine in Internet Explorer without Squid.
It only breaks when going through Squid.

I'd be very happy for further suggestions.



On 7 October 2014 21:19, Brendan Kearney <bpk678 at gmail.com> wrote:

> On Tue, 2014-10-07 at 20:50 +0200, Marcel wrote:
> > Hello,
> >
> > I have some more information.
> >
> > The problem seems to have nothing to do with samba, krb5 or anything
> > else. I set up a new squid that isn't in the AD and doesn't use any
> > kind of authentication at all.
> >
> >
> > I have the exact same problem. Here is my POC squid.conf:
> >
> > acl localnet src all
> > http_access allow all
> > http_port 3128
> >
> >
> >
> > That is the entire configuration in my tests. As you can see, it is
> > absolutely impossible for it to be a configuration issue.
> >
> > Why can't I log on to a NTLM protected website with Internet Explorer
> > when going over a squid proxy?
> >
> >
> > It works fine in Firefox.
> >
> >
> >
> > ---------- Forwarded message ----------
> > From: foggle <lord.tek at gmail.com>
> > Date: 7 October 2014 18:10
> > Subject: [squid-users] Problems with NTLM authentication
> > To: squid-users at lists.squid-cache.org
> >
> >
> > Hello,
> >
> > I have set up a squid Proxy that uses samba/ntlm/krb5 to do SSO AD
> > authentication in the Company.
> >
> >
> > This works fine.
> >
> > My problem is that external Websites on the Internet that use NTLM
> > authentication of their own do not work. My users enter their Details
> > (DOMAIN\user and Password) and receive authentication failures
> > Messages.
> >
> > Interestingly enough, this (almost) only occurs in Internet Explorer.
> > The
> > same sites work fine with Firefox.
> >
> > Thank you in advance for your much needed help.
> >
> >
> >
> > --
> > View this message in context:
> >
> http://squid-web-proxy-cache.1019090.n4.nabble.com/Problems-with-NTLM-authentication-tp4667742.html
> > Sent from the Squid - Users mailing list archive at Nabble.com.
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
> >
> >
> >
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
>
> not something that squid would be affecting, as squid has nothing to do
> with the auth to the website.
>
> Tools -> Internet Options -> Advanced tab: scroll down until you
> Security.  Under Security, check the "Enable Integrated Windows
> Authentication*" check box, and restart your browser.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141007/6945778a/attachment.htm>

From silblackw at gmail.com  Tue Oct  7 20:32:26 2014
From: silblackw at gmail.com (silblackw)
Date: Tue, 7 Oct 2014 13:32:26 -0700 (PDT)
Subject: [squid-users] Error page for failed authentication
Message-ID: <1412713946439-4667750.post@n4.nabble.com>

Hello,

I am setting up my squid to require user authentication with a digest. I
have noticed that if authentication fails, it prompts the user again, and if
the user clicks "cancel" then squid just refuses the connection. I am
wondering if it is possible to change the behavior so that if authentication
fails or the user clicks "cancel" squid instead redirects the user to an
authentication failure page. Is this possible using the squid config file?
What would be the best way of approaching this problem?

Thanks in advance.



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Error-page-for-failed-authentication-tp4667750.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From glenn.groves at bradnams.com.au  Tue Oct  7 21:24:02 2014
From: glenn.groves at bradnams.com.au (glenn.groves at bradnams.com.au)
Date: Wed, 8 Oct 2014 07:24:02 +1000
Subject: [squid-users] https issues for google
In-Reply-To: <20141007094712.GA63356@admin.sibptus.tomsk.ru>
References: <2329B68B3D676246BA0D1149E22F509F01A02886@bneseqs20.bradnams.com.au>
 <20141007094712.GA63356@admin.sibptus.tomsk.ru>
Message-ID: <2329B68B3D676246BA0D1149E22F509F01A02897@bneseqs20.bradnams.com.au>

Not sure about turning off the proxy authentication, this would be hard
to test as the issue is intermittent. The same with logging as I need to
capture the issue.

Thanks,

Glenn

-----Original Message-----
From: Victor Sudakov [mailto:sudakov at sibptus.tomsk.ru] 
Sent: Tuesday, 7 October 2014 7:47 PM
To: Glenn Groves
Cc: squid-users at squid-cache.org
Subject: Re: [squid-users] https issues for google

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

glenn.groves at bradnams.com.au wrote:

> 
> We have a weird issue where https sites apparently don't respond (get 
> message "this page can't be displayed"). This mainly affects google 
> websites and to a lesser affect youtube.

But if you switch off proxy authentication, https sites start working,
right?

- --
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUM7agAAoJEA2k8lmbXsY0SswIAKaYLybj92jJULi16lVfrZgm
hrizPJrpJAmLUwh5jtpQETGfc5owS9eyrwczh3dD1BZiLDQp2BUAMdlpG4bpmcFD
pLCQhjLZur63/DD/C3hWcch59wceAXFsJa4O2YKC9kFkijnJK+o5K/ixUl2Xbsoy
2VkHYpimXTvEJcRG6P3tpvkUmjl1IzrFtkUdmV7DmJVdacGOFeVu7UCPnXRD97K0
fdtLGH7tTw04PfBJIr985i+Tht+C6uqTQo4W1l41JRIGdSGOxTedYj4dIpvHh9YW
KtC4zxrDj+H4H9doOZwPo9sa3vY+HyT2oO2vHur1mPgt1RVmPsO+mo35h7CQj4I=
=ZAyn
-----END PGP SIGNATURE-----


From mirza.dedic at outlook.com  Tue Oct  7 21:37:45 2014
From: mirza.dedic at outlook.com (Mirza Dedic)
Date: Tue, 7 Oct 2014 14:37:45 -0700
Subject: [squid-users] Squid 2.7 STABLE8 (Win2008) can't get my MS Lync 2013
	to work?
Message-ID: <BAY181-W940DC82E91699617FA5A9F0A20@phx.gbl>

We are using SQUID 2.7 STABLE8 on a Windows 2008 box, it is working except when a user tries to access Microsoft Lync 2013 they get a password prompt.
I've searched the web and spent countless hours on this with no luck, anyone able to shed some light?
When i start my Microsoft Lync 2013 client, on access.log I see the following hit when the proxy dialog box shows up within the Lync application.
1412717278.341    516 172.16.12.110 TCP_MISS/200 11695 CONNECT login.microsoftonline.com:443 - DIRECT/65.52.244.66 -
Here is my squid.conf file:
I've tried to add all of the published URLs and IPs that Microsoft lists for Office 365 and related products, but I still have no luck.. anyone able to assist?

# Port on which Squid will lisen onhttp_port 8080
# Authenticationauth_param ntlm program c:/squid/libexec/mswin_ntlm_auth.exe --helper-protocol=squid-2.5-ntlmsspauth_param ntlm children 5auth_param ntlm keep_alive onauth_param basic program c:/squid/libexec/mswin_ntlm_auth.exe --helper-protocol=squid-2.5-basicauth_param basic children 5auth_param basic realm Proxy Serverauth_param basic credentialsttl 2 hoursauth_param basic casesensitive offauthenticate_cache_garbage_interval 10 seconds
# Squid Defaultsacl all src allacl manager proto cache_objectacl localhost src 127.0.0.1
# Class C Internal Subnet - Defaultsacl localnet src 10.0.0.0/8acl localnet src 172.16.0.0/12acl localnet src 192.168.0.0/16
# ACLs# for destination machineacl lan_dst dst 172.16.0.0/16# for source machineacl lan_src src 172.16.0.0/16# for destination domainacl lan_domain dstdomain .contoso.com
# SSL Portsacl SSL_ports port 443 8180 8443 563 1494 2598 8531
# Standard Portsacl Safe_ports port 80						# httpacl Safe_ports port 81          			# http for Pacific Brokerageacl Safe_ports port 21						# ftpacl Safe_ports port 443 563					# httpacl Safe_ports port 70						# gopheracl Safe_ports port 210						# waisacl Safe_ports port 280						# http-mgmtacl Safe_ports port 488						# gss-httpacl Safe_ports port 591						# filemakeracl Safe_ports port 777						# multiling httpacl Safe_ports port 8080 8081 8082 8088 8180acl Safe_ports port 3128        			# Squid http serveracl Safe_ports port 1494 2598   			# ICA - Citrixacl Safe_ports port 7000 8000   			# Oracleacl Safe_ports port 9000        			# Oracleacl Safe_ports port 8530					# WSUSacl Safe_ports port 55905					# WSUSacl Safe_ports port 1025-65535				# unregistered ports
external_acl_type AD_group %LOGIN c:/squid/libexec/mswin_check_ad_group.exe -Gacl AuthorizedUsers proxy_auth REQUIRED
# ACL - Microsoftacl msdomains dstdomain .windowsupdate.com acl msdomains dstdomain .microsoft.comacl msdomains dstdomain .windows.comacl msdomains dstdomain .live.comacl msdomains dstdomain .msecnd.netacl msdomains dstdomain .microsoftonline.comacl msdomains dstdomain .office365.comacl msdomains dstdomain .lync.comacl msdomains dstdomain .office.comacl msdomains dstdomain .onmicrosoft.comacl msdomains dstdomain .microsoftonline-p.comacl msdomains dstdomain .microsoftonline-p.netacl msdomains dstdomain .microsoftonlineimages.comacl msdomains dstdomain .microsoftonlinesupport.netacl msdomains dstdomain .msocdn.comacl msdomains dstdomain .msn.comacl msdomains dstdomain .msn.co.jpacl msdomains dstdomain .msn.co.ukacl msdomains dstdomain .office.netacl msdomains dstdomain .aadrm.comacl msdomains dstdomain .cloudapp.netacl msdomains dstdomain .windowsazure.comacl msdomains dstdomain .phonefactor.netacl msdomains dstdomain .symcb.com
# ACL - SSL Providersacl registars dstdomain .verisign.comacl registars dstdomain .godaddy.com
# LYNCacl lync2013 dst 65.54.54.128/25acl lync2013 dst 65.55.121.128/27acl lync2013 dst 65.55.127.0/24acl lync2013 dst 111.221.17.128/27acl lync2013 dst 111.221.22.64/26acl lync2013 dst 111.221.76.96/27acl lync2013 dst 111.221.76.128/25acl lync2013 dst 111.221.77.0/26acl lync2013 dst 134.170.0.0/25acl lync2013 dst 157.55.40.128/25acl lync2013 dst 157.55.46.0/27acl lync2013 dst 157.55.46.64/26acl lync2013 dst 157.55.104.96/27acl lync2013 dst 157.55.229.128/27acl lync2013 dst 157.55.232.128/26acl lync2013 dst 157.55.238.0/25acl lync2013 dst 207.46.5.0/24acl lync2013 dst 207.46.7.128/27acl lync2013 dst 207.46.57.0/25
# OFFICE 365 PORTAL AND IDENTITYacl 365portal dst 23.96.208.238acl 365portal dst 23.97.64.252acl 365portal dst 23.97.68.113acl 365portal dst 23.97.70.147acl 365portal dst 23.97.72.158acl 365portal dst 23.97.72.161acl 365portal dst 23.97.72.165acl 365portal dst 23.97.98.128acl 365portal dst 23.97.99.4acl 365portal dst 23.97.99.164acl 365portal dst 23.97.100.76acl 365portal dst 23.97.100.92acl 365portal dst 23.97.100.105acl 365portal dst 23.97.100.152acl 365portal dst 23.97.102.90acl 365portal dst 23.97.148.36acl 365portal dst 23.97.148.228acl 365portal dst 23.98.66.168acl 365portal dst 23.98.69.116acl 365portal dst 23.98.70.90acl 365portal dst 23.99.129.26acl 365portal dst 23.99.129.173acl 365portal dst 23.99.194.77acl 365portal dst 23.99.196.232acl 365portal dst 23.99.226.167acl 365portal dst 23.99.227.124acl 365portal dst 23.102.64.16acl 365portal dst 23.102.64.255acl 365portal dst 23.102.65.171acl 365portal dst 23.102.65.203acl 365portal dst 23.102.65.221acl 365portal dst 65.52.64.61acl 365portal dst 65.52.64.230acl 365portal dst 65.52.136.224acl 365portal dst 65.52.144.125acl 365portal dst 65.52.148.27acl 365portal dst 65.52.184.75acl 365portal dst 65.52.196.64acl 365portal dst 65.52.228.75acl 365portal dst 65.52.228.100acl 365portal dst 65.52.236.160acl 365portal dst 65.52.244.66acl 365portal dst 65.54.54.32/27acl 365portal dst 65.54.55.201acl 365portal dst 65.54.74.0/23acl 365portal dst 65.54.80.0/20acl 365portal dst 65.54.165.0/25acl 365portal dst 65.55.86.0/23acl 365portal dst 65.55.233.0/27acl 365portal dst 65.55.239.168acl 365portal dst 70.37.56.152acl 365portal dst 70.37.97.234acl 365portal dst 70.37.128.0/23acl 365portal dst 70.37.142.0/23acl 365portal dst 70.37.150.128/25acl 365portal dst 70.37.159.0/24acl 365portal dst 70.37.160.72acl 365portal dst 70.37.160.202acl 365portal dst 94.245.68.0/22acl 365portal dst 94.245.82.0/23acl 365portal dst 94.245.84.0/24acl 365portal dst 94.245.86.0/24acl 365portal dst 94.245.88.223acl 365portal dst 94.245.88.194acl 365portal dst 94.245.117.53acl 365portal dst 94.245.108.85acl 365portal dst 111.221.16.0/21acl 365portal dst 111.221.24.0/21acl 365portal dst 111.221.70.0/25acl 365portal dst 111.221.71.0/25acl 365portal dst 111.221.111.196acl 365portal dst 111.221.127.112/28acl 365portal dst 132.245.0.0/16acl 365portal dst 134.170.0.0/16acl 365portal dst 137.135.47.6acl 365portal dst 137.135.47.4acl 365portal dst 137.135.47.28acl 365portal dst 137.116.32.43acl 365portal dst 137.116.32.61acl 365portal dst 137.116.48.66acl 365portal dst 137.116.48.69acl 365portal dst 137.116.64.162acl 365portal dst 137.116.129.62/32acl 365portal dst 137.117.99.175acl 365portal dst 137.117.103.21acl 365portal dst 137.135.41.12/32acl 365portal dst 137.135.42.195/32acl 365portal dst 137.135.43.100/32acl 365portal dst 137.135.44.5/32acl 365portal dst 137.135.44.73/32acl 365portal dst 137.135.48.128/32acl 365portal dst 138.91.17.43acl 365portal dst 138.91.17.108acl 365portal dst 138.91.18.52acl 365portal dst 138.91.2.208acl 365portal dst 138.91.2.210acl 365portal dst 138.91.2.212acl 365portal dst 157.55.45.128/25acl 365portal dst 157.55.59.128/25acl 365portal dst 157.55.80.175acl 365portal dst 157.55.80.182acl 365portal dst 157.55.84.13/32acl 365portal dst 157.55.84.19/32acl 365portal dst 157.55.84.80/32acl 365portal dst 157.55.84.237/32acl 365portal dst 157.55.130.0/25acl 365portal dst 157.55.145.0/25acl 365portal dst 157.55.155.0/25acl 365portal dst 157.55.168.18acl 365portal dst 157.55.176.63acl 365portal dst 157.55.185.100acl 365portal dst 157.55.194.46acl 365portal dst 157.55.208.198acl 365portal dst 157.55.227.192/26acl 365portal dst 157.55.252.101acl 365portal dst 157.56.0.0/16acl 365portal dst 168.61.33.178/32acl 365portal dst 168.61.35.252/32acl 365portal dst 168.61.36.121acl 365portal dst 168.61.37.63/32acl 365portal dst 168.61.38.105acl 365portal dst 168.61.39.14/32acl 365portal dst 168.61.82.81/32acl 365portal dst 168.61.83.48/32acl 365portal dst 168.61.85.180/32acl 365portal dst 168.61.85.193/32acl 365portal dst 168.61.144.76acl 365portal dst 168.61.208.197acl 365portal dst 168.62.4.28acl 365portal dst 168.62.11.24acl 365portal dst 168.62.11.117acl 365portal dst 168.62.16.112acl 365portal dst 168.62.16.140acl 365portal dst 168.62.16.149acl 365portal dst 168.62.24.104acl 365portal dst 168.62.24.114acl 365portal dst 168.62.24.150acl 365portal dst 168.62.41.25acl 365portal dst 168.62.42.89acl 365portal dst 168.62.52.198acl 365portal dst 168.62.52.203acl 365portal dst 168.62.60.71acl 365portal dst 168.62.60.80acl 365portal dst 168.62.104.146acl 365portal dst 168.62.176.34acl 365portal dst 168.62.179.4acl 365portal dst 168.62.180.151acl 365portal dst 168.63.16.66/32acl 365portal dst 168.63.16.112/32acl 365portal dst 168.63.16.114/32acl 365portal dst 168.63.16.141acl 365portal dst 168.63.17.221/32acl 365portal dst 168.63.25.227acl 365portal dst 168.63.27.2acl 365portal dst 168.63.166.200acl 365portal dst 168.63.165.67acl 365portal dst 168.63.164.177acl 365portal dst 168.63.208.73/32acl 365portal dst 168.63.213.203/32acl 365portal dst 168.63.214.35/32acl 365portal dst 168.63.216.117/32acl 365portal dst 168.63.250.173/32acl 365portal dst 168.63.252.39/32acl 365portal dst 168.63.252.71/32acl 365portal dst 191.232.2.128/25acl 365portal dst 191.233.32.111acl 365portal dst 191.233.32.201acl 365portal dst 191.234.6.0/24acl 365portal dst 191.235.135.139acl 365portal dst 191.235.135.222acl 365portal dst 191.236.192.179acl 365portal dst 191.237.128.159acl 365portal dst 191.238.80.160acl 365portal dst 191.238.81.69acl 365portal dst 191.238.83.220acl 365portal dst 207.46.57.128/25acl 365portal dst 207.46.70.0/24acl 365portal dst 207.46.73.250acl 365portal dst 207.46.198.0/25acl 365portal dst 207.46.206.0/23acl 365portal dst 207.46.216.54acl 365portal dst 213.199.128.58acl 365portal dst 213.199.128.91acl 365portal dst 213.199.148.0/23acl 365portal dst 213.199.182.128/25
# OFFICE ONLINEacl office365 dst 134.170.27.64/26acl office365 dst 134.170.48.0/26acl office365 dst 134.170.65.64/26acl office365 dst 134.170.128.192/26acl office365 dst 134.170.170.64/26acl office365 dst 191.232.2.64/26
acl dropbox dstdomain .dropbox.comacl icloud dstdomain .icloud.com
# Squid Cacheacl PURGE method PURGE
http_access deny manager !localhosthttp_access allow PURGE localhosthttp_access deny PURGE
# The method ACL type allows you to restrict access based on the request HTTP method, i.e. GET (used for downloading), POST (used for uploading) and CONNECT (used for SSL data transfers)# It is very important that you stop CONNECT type requests to non-SSL ports. The CONNECT method allows data transfer in any direction at any time, regardless of the transport protocol used.acl CONNECT method CONNECThttp_access deny CONNECT !SSL_ports
# Deny access to all ports except the ones definedhttp_access deny !Safe_ports# This blocks attempts to request http://localhost on the proxy server via the proxy. http_access deny localhost# Deny caching for everyone so that there is not caching at allcache deny all
http_access allow msdomainshttp_access allow lync2013http_access allow 365portalhttp_access allow office365http_access allow registarshttp_access allow dropboxhttp_access allow icloud
http_access allow CONNECT msdomainshttp_access allow CONNECT lync2013http_access allow CONNECT 365portalhttp_access allow CONNECT office365http_access allow CONNECT registarshttp_access allow CONNECT dropboxhttp_access allow CONNECT icloud
# Deny access to proxy to everyone except Authorized Users group in ADhttp_access deny !AuthorizedUsers
# Disable cachingalways_direct allow msdomains allalways_direct allow registars allalways_direct allow lync2013 allalways_direct allow 365portal allalways_direct allow office365 all
# Allow direct connection if the destination machine is on LANalways_direct allow lan_dst# Allow http access from machines on LANhttp_access allow lan_src# Default denyhttp_access deny allhttp_reply_access allow allicp_access allow all
# Squid should not check with neighbours'/parents' cache and should go to target web-server.hierarchy_stoplist cgi-bin ?
# Loggingcache_dir ufs c:/squid/var/cache 100 16 256access_log c:/squid/var/logs/access.log squidcache_log c:/squid/var/logs/cache.logcache_store_log nonelogfile_rotate 4log_ip_on_direct ondebug_options ALL,1log_fqdn off
# SquidGuardredirect_program c:/squidguard/squidguard.exe -c c:/squidguard/conf/squidguard.confredirect_children 5
# Cachingcache_mgr ittechs at oppy.comrefresh_pattern ^ftp:		1440	20%	10080refresh_pattern ^gopher:	1440	0%	1440refresh_pattern -i (/cgi-bin/|\?) 0	0%	0refresh_pattern .		0	20%	4320
# Dont cache these pagesacl DYNAMIC_CONTENT urlpath_regex cgi-bin \.cgi \.pl \.php3 \.asp \.phpno_cache deny DYNAMIC_CONTENT 
# Other stuff?acl shoutcast rep_header X-HTTP09-First-Line ^ICY.[0-9]upgrade_http0.9 deny shoutcastacl apache rep_header Server ^Apachebroken_vary_encoding allow apacheerror_directory c:/squid/share/errors/English
# Various features turned off.snmp_port 0icp_port 0htcp_port 0
coredump_dir c:/squid/var/cachepid_filename c:/squid/var/squid.pidmime_table c:/squid/etc/mime.confunlinkd_program c:/squid/libexec/unlinkd.exe
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141007/45b92be1/attachment.htm>

From eliezer at ngtech.co.il  Tue Oct  7 21:38:54 2014
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Wed, 08 Oct 2014 00:38:54 +0300
Subject: [squid-users] https issues for google
In-Reply-To: <2329B68B3D676246BA0D1149E22F509F01A02886@bneseqs20.bradnams.com.au>
References: <2329B68B3D676246BA0D1149E22F509F01A02886@bneseqs20.bradnams.com.au>
Message-ID: <54345D6E.3090403@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hey Glenn,

Since you are not using intercept or tproxy the basic place to look at
is the access.log.
You can see there if the proxy is trying for example to reach an IPV6
address (by mistake).

Also to make sure there is an issue you can use specific exception
like the cacheadmin acl you are using to allow the cacheadmin access
without authentication for the basic test.

Also you are indeed using the latest CentOS 6.5 squid but since the
current stable version is 3.4.8 you should try to upgrade(to something
else then 3.1) due to other issues.

The issue can be a network or dns related issue which was not detected
until now.

Please first make sure that the access.log and cache.log files are
clean for errors or issues.

What dns servers are you using?

Eliezer

On 10/07/2014 06:51 AM, glenn.groves at bradnams.com.au wrote:
> Hi All,
> 
> We have a weird issue where https sites apparently don't respond
> (get message "this page can't be displayed"). This mainly affects
> google websites and to a lesser affect youtube. It has been
> reported it may have affected some banking sites but this is
> unconfirmed. We are running centos 6.5 with up to date squid from
> the centos repositories.
> 
> Here is the version of squid: yum list installed | grep squid 
> squid.x86_64                         7:3.1.10-20.el6_5.3
> 
> The https sites work fine if I put a direct hole in the firewall to
> allow internet traffic directly out - but this is not a solution.
> 
> Thanks, Glenn

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUNF1uAAoJENxnfXtQ8ZQUlfYH/i0o9MQDTt8g5aINRljVSMZc
btC8mcYn/JYn4WUPIoOc4/MhvuYg0JO6hXsSoPxjI1khMrq9fTV2c8eaLItWqYCf
hjioWPJs2hPwfw6WDi0I6kF0Is+hD/MGsJci7s+jg593lHnm+ZjoDIHj0aCpcdgy
u95961yZWXINbYsjTirFftnX5UC5MWbwZjaah6zW84RKZl/pa1vJM/tdgqiLdE5V
GDNhS01mbKPfin8oc/RQk4nYAK39vncSebvSHJwkvPJIKlb54Yti64j6qUfPsav3
uUvIVKSpxZjFFJoLtw1zjn1MwyynoHNGT1lP+HptsGkDoeGJ6YWU/IwB1sFKcVk=
=GKmE
-----END PGP SIGNATURE-----


From eliezer at ngtech.co.il  Tue Oct  7 21:45:33 2014
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Wed, 08 Oct 2014 00:45:33 +0300
Subject: [squid-users] Squid 2.7 STABLE8 (Win2008) can't get my MS Lync
	2013 to work?
In-Reply-To: <BAY181-W940DC82E91699617FA5A9F0A20@phx.gbl>
References: <BAY181-W940DC82E91699617FA5A9F0A20@phx.gbl>
Message-ID: <54345EFD.7040202@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 10/08/2014 12:37 AM, Mirza Dedic wrote:
> We are using SQUID 2.7 STABLE8 on a Windows 2008 box, it is working
> except when a user tries to access Microsoft Lync 2013 they get a
> password prompt. I've searched the web and spent countless hours on
> this with no luck, anyone able to shed some light? When i start my
> Microsoft Lync 2013 client, on access.log I see the following hit
> when the proxy dialog box shows up within the Lync application. 
> 1412717278.341    516 172.16.12.110 TCP_MISS/200 11695 CONNECT
> login.microsoftonline.com:443 - DIRECT/65.52.244.66 - Here is my
> squid.conf file: I've tried to add all of the published URLs and
> IPs that Microsoft lists for Office 365 and related products, but I
> still have no luck.. anyone able to assist?

Hey,

First note that 2.7 is very old and do not support HTTP 1.1 which lync
might require.
How do you configure you Lync client?
Also note that the client uses a CONNECT method which is a very
special one that in your case is allowed.

The issue you are probably having is not related 100% to squid since
the basic logs shows that it allows the connection to be forwarded
towards the destination server.

The squid.conf you just pasted inside the email was distorted please do:
- - Clean the file from comments before reposting it.
- - Attach the file to the email instead of pasting it inside the email
or alternatively use some paste site such as:
http://fpaste.org/
http://pastie.org/
http://paste.ubuntu.com/
http://paste.debian.net/

All The Bests,
Eliezer
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUNF78AAoJENxnfXtQ8ZQUPFAH/2r/ymz6ADcBJIxK2Pe5sp8W
CbPMxr8gFHmD0p4z79qsyef2UYXMtES1YzO68ZGq12YZ7Dxm0ibPQxZ2DEbqrwJq
MRNghrw4wP5LfXywRowO339TGkAWXkAAaG3mixzBDxp8Rf+V/4Z5rDrAVchKweLo
Ri0DVZD6u3F9czJgVsZrIQzB9SuhMIXPAOmLZI5yd0416Pn5fEYAkY83vL/q1Xb4
SR96O/ZT3E3FpEcOSk/bla+adScwpa8T5Bp9cauvnwVUuNcvsWAJQZS5+EvZFHEj
Xc91KA02qfBuG5zDpX4StVKTFC3az8ZEaRpwS6nY3qI4XbpdagPXTsqibSF/oo4=
=lpsQ
-----END PGP SIGNATURE-----


From ahmed.zaeem at netstream.ps  Wed Oct  8 07:54:02 2014
From: ahmed.zaeem at netstream.ps (Ahmed Allzaeem)
Date: Wed, 8 Oct 2014 00:54:02 -0700
Subject: [squid-users] can i disable ipv4 for tcp_outgoing ???? and allow
	only ipv6 ?
Message-ID: <001101cfe2cd$075b9810$1612c830$@netstream.ps>

Hi Guys

I have 1 ipv4 and many ipv6

 

 

The ipv4 will be only to reach the server

I want the tcp_outgoing traffic only to be ipv6

 

Can I do that ???

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141008/d83064fc/attachment.htm>

From mirza.dedic at outlook.com  Tue Oct  7 22:00:22 2014
From: mirza.dedic at outlook.com (Mirza Dedic)
Date: Tue, 7 Oct 2014 15:00:22 -0700
Subject: [squid-users] Squid 2.7 STABLE8 (Win2008) can't get my MS Lync
 2013 to work?
In-Reply-To: <54345EFD.7040202@ngtech.co.il>
References: <BAY181-W940DC82E91699617FA5A9F0A20@phx.gbl>,
 <54345EFD.7040202@ngtech.co.il>
Message-ID: <BAY181-W61EF839967043531882833F0A20@phx.gbl>

Hi Elizabeth,
Thanks, I totally forgot I could use a paste like service, here is the link to my squid.conf file:
http://pastie.org/9629651
I have stripped out the comments from the paste.
It seems it could be HTTP 1.1 according to http://blog.schertz.name/2012/12/http-utilized-lync-server/ 
Does this mean I am out of luck with getting this to work on Squid 2.7 STABLE8?
I would upgrade to a higher version, however 2.7 STABLE8 is the latest available version for Windows it appears.

> Date: Wed, 8 Oct 2014 00:45:33 +0300
> From: eliezer at ngtech.co.il
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] Squid 2.7 STABLE8 (Win2008) can't get my MS Lync	2013 to work?
> 
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> On 10/08/2014 12:37 AM, Mirza Dedic wrote:
> > We are using SQUID 2.7 STABLE8 on a Windows 2008 box, it is working
> > except when a user tries to access Microsoft Lync 2013 they get a
> > password prompt. I've searched the web and spent countless hours on
> > this with no luck, anyone able to shed some light? When i start my
> > Microsoft Lync 2013 client, on access.log I see the following hit
> > when the proxy dialog box shows up within the Lync application. 
> > 1412717278.341    516 172.16.12.110 TCP_MISS/200 11695 CONNECT
> > login.microsoftonline.com:443 - DIRECT/65.52.244.66 - Here is my
> > squid.conf file: I've tried to add all of the published URLs and
> > IPs that Microsoft lists for Office 365 and related products, but I
> > still have no luck.. anyone able to assist?
> 
> Hey,
> 
> First note that 2.7 is very old and do not support HTTP 1.1 which lync
> might require.
> How do you configure you Lync client?
> Also note that the client uses a CONNECT method which is a very
> special one that in your case is allowed.
> 
> The issue you are probably having is not related 100% to squid since
> the basic logs shows that it allows the connection to be forwarded
> towards the destination server.
> 
> The squid.conf you just pasted inside the email was distorted please do:
> - - Clean the file from comments before reposting it.
> - - Attach the file to the email instead of pasting it inside the email
> or alternatively use some paste site such as:
> http://fpaste.org/
> http://pastie.org/
> http://paste.ubuntu.com/
> http://paste.debian.net/
> 
> All The Bests,
> Eliezer
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1
> 
> iQEcBAEBAgAGBQJUNF78AAoJENxnfXtQ8ZQUPFAH/2r/ymz6ADcBJIxK2Pe5sp8W
> CbPMxr8gFHmD0p4z79qsyef2UYXMtES1YzO68ZGq12YZ7Dxm0ibPQxZ2DEbqrwJq
> MRNghrw4wP5LfXywRowO339TGkAWXkAAaG3mixzBDxp8Rf+V/4Z5rDrAVchKweLo
> Ri0DVZD6u3F9czJgVsZrIQzB9SuhMIXPAOmLZI5yd0416Pn5fEYAkY83vL/q1Xb4
> SR96O/ZT3E3FpEcOSk/bla+adScwpa8T5Bp9cauvnwVUuNcvsWAJQZS5+EvZFHEj
> Xc91KA02qfBuG5zDpX4StVKTFC3az8ZEaRpwS6nY3qI4XbpdagPXTsqibSF/oo4=
> =lpsQ
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141007/a8d69c4b/attachment.htm>

From huaraz at moeller.plus.com  Tue Oct  7 22:03:11 2014
From: huaraz at moeller.plus.com (Markus Moeller)
Date: Tue, 7 Oct 2014 23:03:11 +0100
Subject: [squid-users] Squid,
	Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
	3.4.7.)
In-Reply-To: <20141007083542.GA60425@admin.sibptus.tomsk.ru>
References: <20141006040725.GA31642@admin.sibptus.tomsk.ru>
 <20141006052346.GA32369@admin.sibptus.tomsk.ru>
 <20141007070403.GA57384@admin.sibptus.tomsk.ru>
 <20141007083542.GA60425@admin.sibptus.tomsk.ru>
Message-ID: <m11nv3$nk8$1@ger.gmane.org>

Hi Victor,

  In the helpers/negotiate_auth/kerberos directory is a script 
test_negotiate_auth.sh to test authentication outside of squid. Change dir 
to your binary directory and do the following ( please adapt to your 
environment):

> export KRB5_KTNAME=squid-win.keytab
> kinit mm at WIN2003R2.HOME
Password for mm at WIN2003R2.HOME:
markus at opensuse12:/tmp> ./test_negotiate_auth.sh opensuse12.suse.home
negotiate_kerberos_auth.cc(218): pid=29699 :2014/10/07 22:59:56| 
negotiate_kerberos_auth: INFO: Starting version 3.0.4sq
negotiate_kerberos_auth.cc(264): pid=29699 :2014/10/07 22:59:57| 
negotiate_kerberos_auth: DEBUG: Got 'YR 
YIIE6AYGKwYBBQUCoIIE3DCCBNigJzAlBgkqhkiG9xIBAgIGBSsFAQUCBgkqhkiC9xIBAgIGBisGAQUCBaKCBKsEggSnYIIEowYJKoZIhvcSAQICAQBuggSSMIIEjqADAgEFoQMCAQ6iBwMFAAAAAACjggO7YYIDtzCCA7OgAwIBBaEQGw5XSU4yMDAzUjIuSE9NRaInMCWgAwIBA6EeMBwbBEhUVFAbFG9wZW5zdXNlMTIuc3VzZS5ob21lo4IDbzCCA2ugAwIBF6EDAgEDooIDXQSCA1k1EItBaBy6N/KyNZuvhQrc7lHb3jDM8f64MM2ejDNLkD2lKZ2t3ApsQerwT37e4X+5OPu+QiEMNLIzdWQfkS/bBsF4KCelM4GDFDNIbf8d6hHj1lWN7aiOmJ3uyBvCUAZR6iAIcgOdqselmz9I7uMPA3bT/Dj0IMIkTfYogQ2hUWQ6jwgCmVnUDHlkvIc/4gk5csbCoozwX+T/IOLIrLPSzdi07vJ5psA+YYIvd14DXbx2XWXC+fqOZwoI2hdEaWdglVJaxywKKFpLned3c3ZyJnYX9njHOAC7HWm5/mqyhLUuXyIflLvCDUQmM+VXYg6xn2AbWZHfjaGYbRtVgcJuE3kIZxr9YP1kopEM0HlqpRagkdOQ4HTu0G4VVUphAVO/DJ7LuJkwrfRuRM4MXQX86eMvKvGRenwFp2fx7L2tsI+jJLaUnc9+U2GnpFS7PAmE6WMRLA9j41qFKpNlegKkY1CCWH1h6YjF/csuhoAfKZreOT5uBtODCP+Xgvb0JqbgAyJVaA14MUPXrt3+F8bWy0urZy5FMZVOC1GJcIQbDehfIAR9HJ9El+Nd2fAB36nbVnHK3hxKwLP6XR93PhR+p5gYUpYcksK+74ruJrmsje6KYTi/Y3uX+11CP6pXBwQZ7vLakMPRCcumsJvasaqWktcpeE/ZXh7ZE6rmTmiR4HIfsOBgL8AEnm0vKY5Lr1jZ26cvtsp8d0z7WfC/hu1JnzBKVQnVxxByL51DMazpLIaa1XNrcVQKNmkwcTXSafjRUS40KBYL0SnuDlf/TLNzJb33tbnLm6zkmTDgA4GZTWhnxhKFYef7TQbRV3AXVbMeZ7v+isJPit0c0TEr7vDUyp2BerhHIK+Qq6MtM3bLbRG3SFr0y5rZcT3wda4qh01q2H7saz42iP+MSBZHgBBGRod8CnTXtt51yq7NT0rGagIlI5EHkEcQmvC000dIaZFfhpvfmiFklN6GQUwNA3Sjf7ralzEb3I6U3i8AnS5f/z2aFe/r4nQB40lZeOdvKBBoQI6NzOpPxf8I3622OMGLLpUIDo2HbY3wSraSrvZtKxq+4Bdy6uUO7j1T2kuFZmBOUdO1YF5yHF5/L4qda8OcUZzno/f/toxYAY/tyLmbPjMVKG+KbyZFeaSBuTCBtqADAgEXooGuBIGrqzxRGRSf3s5RXG3bFyOyUGa2LO7tN19ZzgdtcyxL7b82GPCOCKB1pVoai2HdhAXkxvEYyfXAZCeOhaZNMmgnMk5r1QjFM1mJf6CcLrtPxBN4tcuN6hsXyEUrDzVbF0eLeKDtXMcy6061mNITHcHp0j5L9tE78ikwOFHggK4UQMiaRH+wFfYBjELAHShgzvVswafPJy1bDUGb3uzTC1w/ZnnngJ2y9kJG5aQ/' 
from squid (length: 1683).
negotiate_kerberos_auth.cc(317): pid=29699 :2014/10/07 22:59:57| 
negotiate_kerberos_auth: DEBUG: Decode 
'YIIE6AYGKwYBBQUCoIIE3DCCBNigJzAlBgkqhkiG9xIBAgIGBSsFAQUCBgkqhkiC9xIBAgIGBisGAQUCBaKCBKsEggSnYIIEowYJKoZIhvcSAQICAQBuggSSMIIEjqADAgEFoQMCAQ6iBwMFAAAAAACjggO7YYIDtzCCA7OgAwIBBaEQGw5XSU4yMDAzUjIuSE9NRaInMCWgAwIBA6EeMBwbBEhUVFAbFG9wZW5zdXNlMTIuc3VzZS5ob21lo4IDbzCCA2ugAwIBF6EDAgEDooIDXQSCA1k1EItBaBy6N/KyNZuvhQrc7lHb3jDM8f64MM2ejDNLkD2lKZ2t3ApsQerwT37e4X+5OPu+QiEMNLIzdWQfkS/bBsF4KCelM4GDFDNIbf8d6hHj1lWN7aiOmJ3uyBvCUAZR6iAIcgOdqselmz9I7uMPA3bT/Dj0IMIkTfYogQ2hUWQ6jwgCmVnUDHlkvIc/4gk5csbCoozwX+T/IOLIrLPSzdi07vJ5psA+YYIvd14DXbx2XWXC+fqOZwoI2hdEaWdglVJaxywKKFpLned3c3ZyJnYX9njHOAC7HWm5/mqyhLUuXyIflLvCDUQmM+VXYg6xn2AbWZHfjaGYbRtVgcJuE3kIZxr9YP1kopEM0HlqpRagkdOQ4HTu0G4VVUphAVO/DJ7LuJkwrfRuRM4MXQX86eMvKvGRenwFp2fx7L2tsI+jJLaUnc9+U2GnpFS7PAmE6WMRLA9j41qFKpNlegKkY1CCWH1h6YjF/csuhoAfKZreOT5uBtODCP+Xgvb0JqbgAyJVaA14MUPXrt3+F8bWy0urZy5FMZVOC1GJcIQbDehfIAR9HJ9El+Nd2fAB36nbVnHK3hxKwLP6XR93PhR+p5gYUpYcksK+74ruJrmsje6KYTi/Y3uX+11CP6pXBwQZ7vLakMPRCcumsJvasaqWktcpeE/ZXh7ZE6rmTmiR4HIfsOBgL8AEnm0vKY5Lr1jZ26cvtsp8d0z7WfC/hu1JnzBKVQnVxxByL51DMazpLIaa1XNrcVQKNmkwcTXSafjRUS40KBYL0SnuDlf/TLNzJb33tbnLm6zkmTDgA4GZTWhnxhKFYef7TQbRV3AXVbMeZ7v+isJPit0c0TEr7vDUyp2BerhHIK+Qq6MtM3bLbRG3SFr0y5rZcT3wda4qh01q2H7saz42iP+MSBZHgBBGRod8CnTXtt51yq7NT0rGagIlI5EHkEcQmvC000dIaZFfhpvfmiFklN6GQUwNA3Sjf7ralzEb3I6U3i8AnS5f/z2aFe/r4nQB40lZeOdvKBBoQI6NzOpPxf8I3622OMGLLpUIDo2HbY3wSraSrvZtKxq+4Bdy6uUO7j1T2kuFZmBOUdO1YF5yHF5/L4qda8OcUZzno/f/toxYAY/tyLmbPjMVKG+KbyZFeaSBuTCBtqADAgEXooGuBIGrqzxRGRSf3s5RXG3bFyOyUGa2LO7tN19ZzgdtcyxL7b82GPCOCKB1pVoai2HdhAXkxvEYyfXAZCeOhaZNMmgnMk5r1QjFM1mJf6CcLrtPxBN4tcuN6hsXyEUrDzVbF0eLeKDtXMcy6061mNITHcHp0j5L9tE78ikwOFHggK4UQMiaRH+wFfYBjELAHShgzvVswafPJy1bDUGb3uzTC1w/ZnnngJ2y9kJG5aQ/' 
(decoded length: 1260).
negotiate_kerberos_pac.cc(382): pid=29699 :2014/10/07 22:59:57| 
negotiate_kerberos_auth: INFO: Got PAC data of lengh 480
negotiate_kerberos_pac.cc(200): pid=29699 :2014/10/07 22:59:57| 
negotiate_kerberos_auth: INFO: Found 4 rids
negotiate_kerberos_pac.cc(207): pid=29699 :2014/10/07 22:59:57| 
negotiate_kerberos_auth: Info: Got rid: 1108
negotiate_kerberos_pac.cc(207): pid=29699 :2014/10/07 22:59:57| 
negotiate_kerberos_auth: Info: Got rid: 513
negotiate_kerberos_pac.cc(207): pid=29699 :2014/10/07 22:59:57| 
negotiate_kerberos_auth: Info: Got rid: 1132
negotiate_kerberos_pac.cc(207): pid=29699 :2014/10/07 22:59:57| 
negotiate_kerberos_auth: Info: Got rid: 1209
negotiate_kerberos_pac.cc(269): pid=29699 :2014/10/07 22:59:57| 
negotiate_kerberos_auth: INFO: Got DomainLogonId 
S-1-5-21-1828870822-1098772068-2592627279
negotiate_kerberos_pac.cc(291): pid=29699 :2014/10/07 22:59:57| 
negotiate_kerberos_auth: INFO: Found 1 ExtraSIDs
negotiate_kerberos_pac.cc(339): pid=29699 :2014/10/07 22:59:57| 
negotiate_kerberos_auth: INFO: Got ExtraSid 
S-1-5-21-1828870822-1098772068-2592627279-1107
negotiate_kerberos_pac.cc(462): pid=29699 :2014/10/07 22:59:57| 
negotiate_kerberos_auth: INFO: Read 480 of 480 bytes
negotiate_kerberos_auth.cc(432): pid=29699 :2014/10/07 22:59:57| 
negotiate_kerberos_auth: DEBUG: Groups 
group=AQUAAAAAAAUVAAAAploCbWTufUFPWoiaVAQAAA== 
group=AQUAAAAAAAUVAAAAploCbWTufUFPWoiaAQIAAA== 
group=AQUAAAAAAAUVAAAAploCbWTufUFPWoiabAQAAA== 
group=AQUAAAAAAAUVAAAAploCbWTufUFPWoiauQQAAA== 
group=AQUAAAAAAAUVAAAAploCbWTufUFPWoiaUwQAAA==
AF oRQwEqADCgEAoQsGCSqGSIb3EgECAg== mm at WIN2003R2.HOME 
group=AQUAAAAAAAUVAAAAploCbWTufUFPWoiaVAQAAA== 
group=AQUAAAAAAAUVAAAAploCbWTufUFPWoiaAQIAAA== 
group=AQUAAAAAAAUVAAAAploCbWTufUFPWoiabAQAAA== 
group=AQUAAAAAAAUVAAAAploCbWTufUFPWoiauQQAAA== 
group=AQUAAAAAAAUVAAAAploCbWTufUFPWoiaUwQAAA==
negotiate_kerberos_auth.cc(437): pid=29699 :2014/10/07 22:59:57| 
negotiate_kerberos_auth: DEBUG: AF oRQwEqADCgEAoQsGCSqGSIb3EgECAg== 
mm at WIN2003R2.HOME
negotiate_kerberos_auth.cc(264): pid=29699 :2014/10/07 22:59:57| 
negotiate_kerberos_auth: DEBUG: Got 'QQ' from squid (length: 2).
BH quit command

Let me know what you get. BTW on which platform with which Kerberos 
library( MIT or Heimdal)  is this ?

Markus



"Victor Sudakov"  wrote in message 
news:20141007083542.GA60425 at admin.sibptus.tomsk.ru...

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

And my Kerberos server setup seems valid:

$ setenv KRB5_KTNAME /usr/local/etc/squid/squid.keytab
$ setenv KRB5_CONFIG /usr/local/etc/squid/krb5.conf
$ kdestroy
$ kinit -t $KRB5_KTNAME  HTTP/proxy.sibptus.transneft.ru
$ klist
Credentials cache: FILE:/tmp/krb5cc_Ld5uU9
        Principal:
HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU

  Issued           Expires          Principal
Oct  7 15:33:42  Oct  8 01:33:42
krbtgt/SIBPTUS.TRANSNEFT.RU at SIBPTUS.TRANSNEFT.RU
$



Victor Sudakov wrote:
> Victor Sudakov wrote:
> > > Well, I have tried negotiate_kerberos_auth with Firefox (Windows)
> >
> > I have tried the same with MSIE 8 (Windows).
>
> After some adjustment to domain group policies, the Windows host is
> at last requesting and successfully receiving the ticket for the proxy
> service.  Wireshark output:
>
> User Datagram Protocol, Src Port: kerberos (88), Dst Port: dellpwrappks 
> (1266)
> Kerberos TGS-REP
>     Pvno: 5
>     MSG Type: TGS-REP (13)
>     Client Realm: SIBPTUS.TRANSNEFT.RU
>     Client Name (Principal): vas-adm
>     Ticket
>         Tkt-vno: 5
>         Realm: SIBPTUS.TRANSNEFT.RU
>         Server Name (Service and Instance): 
> HTTP/proxy.sibptus.transneft.ru
>         enc-part rc4-hmac
>             Encryption type: rc4-hmac (23)
>             enc-part: 3e0fc357a26db7dcdb0a5b6436b56f9c96d15ad7626eea08...
>     enc-part rc4-hmac
>         Encryption type: rc4-hmac (23)
>         Kvno: 1
>         enc-part: db8c9ea1bf85c4bb5005103765767b692ed3c0f247c23d48...
>
> The corresponding Kerberos principal is put into the keytab:
> /usr/local/etc/squid/squid.keytab:
>
> Vno  Type                     Principal
>   1  des-cbc-crc 
> HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
>   1  des-cbc-md5 
> HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
>   1  arcfour-hmac-md5 
> HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
>   1  aes256-cts-hmac-sha1-96 
> HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
>   1  aes128-cts-hmac-sha1-96 
> HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
>
> The permissions on the keytab are correct. Squid receives it via the
> environment:
>
> env KRB5_KTNAME=/usr/local/etc/squid/squid.keytab \
>         KRB5_CONFIG=/usr/local/etc/squid/krb5.conf \
>         squid -f /usr/local/etc/squid/squid-test.conf
>
> However, then actual autthentication begins, it fails with the:
> "ERROR: gss_acquire_cred() failed:  No credentials were
> supplied, or the credentials were unavailable or inaccessible..
> unknown mech-code 0 for mech unknown"
>
> If someone finds something familiar in the below debug output, or can
> low-level debug actual kerberos, could you please let me know. Thanks
> a lot in advance for any help.
>
> negotiate_kerberos_auth.cc(212): pid=40984 :2014/10/07 13:12:08| 
> negotiate_kerberos_auth: INFO: Starting version 3.0.4sq
> negotiate_kerberos_auth.cc(258): pid=40980 :2014/10/07 13:12:37| 
> negotiate_kerberos_auth: DEBUG: Got 'YR 
> YIIFGAYGKwYBBQUCoIIFDDCCBQigJDAiBgkqhkiC9xIBAgIGCSqGSIb3EgECAgYKKwYBBAGCNwICCqKCBN4EggTaYIIE1gYJKoZIhvcSAQICAQBuggTFMIIEwaADAgEFoQMCAQ6iBwMFACAAAACjggPpYYID5TCCA+GgAwIBBaEWGxRTSUJQVFVTLlRSQU5TTkVGVC5SVaItMCugAwIBAqEkMCIbBEhUVFAbGnByb3h5LnNpYnB0dXMudHJhbnNuZWZ0LnJ1o4IDkTCCA42gAwIBA6KCA4QEggOAB8tiAa54xI00BfngMyI8cwFHbNKRZPVn1c/HKYPi4Dppq0fIjp2e5br7rHG51+1/w6zaDwHKqdtnpWh/OplOkn6tDNq0H2fi/jFeT0XKICrLxdpmDHRqNmiyxvtczdkcSyxXJ2254oM9VwuE39D8hqU58NmijTB+WQupz2hw4d+5euIFFwSSO8nD3CMaBVGgyNfp9YvUUy860L+KKEqb0LVXZ+/OsnlsyrEc3AaaXwSwS30+ZRv0jCLh1h7kc84XFPrjGqRPp7JmO5gUCF8k/GXNF3FAMBAaT4r/iAs8LFIixQiRUWJPtjcWAtH0Q3JumqB9Enm+JPNvGBvE83YvbBZtDJQ0uc5lOMVLavBh2Xgj86BmKlCsrOCiMoQ8SgsEAX6o110EeMI1Tef8t+2/WhzP39l5BGuXmdDA1zEmqzA83vvTy5JcKUXZ3IdwwJ4I+kW62qIMsceZ/hfdj/Iy+RjCNrum5FHXMDszMVacKHp9kJTMofuMhhOKD2o+Z91TWTkEwD3NNWGjTWdgECpJT/F7I1x35iQaLGvgLebpalPJEXY8A8od1HhXZaCkIPXcDoPUR1LTTk8bHYKan17EnOBf0CbjOkU8/ib2mLUL81RQHrt6vdTcXzxsAgoZYigptd/ilsXq0dbwjTuZP8ZcFFY+levmSPIn5TF5xZtmtymditNO28hSqDjxC2Lpoy65kqwXglxpijuicSXC4cC/O1TBbksyH/aw/7MbNTKupFpovZTensu/A6zYG3HCjKW9QBsgU4tBXRC6rTP0RAeuASUHpvHv4WhbS5AWNYmX1TNQ8QpfurM2tAzuFzYQN8LL3VT38o4SVK+visE9q1IGez70q9g6Naowvpp6g/h3FuCzUks2ydXchKNPe3KzuSJqzmkLlyjKMlVW8sYUwgKXqNsgi7aRArEfu0L3UqYG/7lao+QLDOBf5+uSzWarZ9IIS7ClIRBejXU7erVJrLBDlGZRbMu+hXacsGwv/1Ls+S8xCxnlRjQngHjLg8vvQBYslgvkMh77eyP+HjiUDOXqDYoDR5bIc/w5UX/Dvb4ECGiqhGd9UHHQkYn6NQnbO/2r+iVBdy1fvXhXE2LKgAFoQtf2tIqsTUZWv12O82X2KzcZJ7IEVMxbGtSj9cdncc16c5Y6DL9AzQryNIhSGxghZ7zyWwp4DBS19ru4l+dVQ4ikgb4wgbugAwIBA6KBswSBsGrVgYewQbJlk43Aw0ujMajwCinYuDDsW9b7I1gCa41ShWl0xSQ6MfkhuPDbcJO6TK6nTYyxSbWMtxo2eiMOehg+bHo5HUUCGyvRCNRnJFcJLP3GAqh8Ogjx9zY4/YcVb8c/eFM/BiBKHw41T4a0fR6scB9GKDjT8vDa4ysgGeEjeiPh+PjDSTS/y/CWrin97xXwrdUbsWbhuxHQ66HZ9rEJoZFb8oxtHgnqyEgMbwdO' 
> from squid (length: 1747).
> negotiate_kerberos_auth.cc(311): pid=40980 :2014/10/07 13:12:37| 
> negotiate_kerberos_auth: DEBUG: Decode 
> 'YIIFGAYGKwYBBQUCoIIFDDCCBQigJDAiBgkqhkiC9xIBAgIGCSqGSIb3EgECAgYKKwYBBAGCNwICCqKCBN4EggTaYIIE1gYJKoZIhvcSAQICAQBuggTFMIIEwaADAgEFoQMCAQ6iBwMFACAAAACjggPpYYID5TCCA+GgAwIBBaEWGxRTSUJQVFVTLlRSQU5TTkVGVC5SVaItMCugAwIBAqEkMCIbBEhUVFAbGnByb3h5LnNpYnB0dXMudHJhbnNuZWZ0LnJ1o4IDkTCCA42gAwIBA6KCA4QEggOAB8tiAa54xI00BfngMyI8cwFHbNKRZPVn1c/HKYPi4Dppq0fIjp2e5br7rHG51+1/w6zaDwHKqdtnpWh/OplOkn6tDNq0H2fi/jFeT0XKICrLxdpmDHRqNmiyxvtczdkcSyxXJ2254oM9VwuE39D8hqU58NmijTB+WQupz2hw4d+5euIFFwSSO8nD3CMaBVGgyNfp9YvUUy860L+KKEqb0LVXZ+/OsnlsyrEc3AaaXwSwS30+ZRv0jCLh1h7kc84XFPrjGqRPp7JmO5gUCF8k/GXNF3FAMBAaT4r/iAs8LFIixQiRUWJPtjcWAtH0Q3JumqB9Enm+JPNvGBvE83YvbBZtDJQ0uc5lOMVLavBh2Xgj86BmKlCsrOCiMoQ8SgsEAX6o110EeMI1Tef8t+2/WhzP39l5BGuXmdDA1zEmqzA83vvTy5JcKUXZ3IdwwJ4I+kW62qIMsceZ/hfdj/Iy+RjCNrum5FHXMDszMVacKHp9kJTMofuMhhOKD2o+Z91TWTkEwD3NNWGjTWdgECpJT/F7I1x35iQaLGvgLebpalPJEXY8A8od1HhXZaCkIPXcDoPUR1LTTk8bHYKan17EnOBf0CbjOkU8/ib2mLUL81RQHrt6vdTcXzxsAgoZYigptd/ilsXq0dbwjTuZP8ZcFFY+levmSPIn5TF5xZtmtymditNO28hSqDjxC2Lpoy65kqwXglxpijuicSXC4cC/O1TBbksyH/aw/7MbNTKupFpovZTensu/A6zYG3HCjKW9QBsgU4tBXRC6rTP0RAeuASUHpvHv4WhbS5AWNYmX1TNQ8QpfurM2tAzuFzYQN8LL3VT38o4SVK+visE9q1IGez70q9g6Naowvpp6g/h3FuCzUks2ydXchKNPe3KzuSJqzmkLlyjKMlVW8sYUwgKXqNsgi7aRArEfu0L3UqYG/7lao+QLDOBf5+uSzWarZ9IIS7ClIRBejXU7erVJrLBDlGZRbMu+hXacsGwv/1Ls+S8xCxnlRjQngHjLg8vvQBYslgvkMh77eyP+HjiUDOXqDYoDR5bIc/w5UX/Dvb4ECGiqhGd9UHHQkYn6NQnbO/2r+iVBdy1fvXhXE2LKgAFoQtf2tIqsTUZWv12O82X2KzcZJ7IEVMxbGtSj9cdncc16c5Y6DL9AzQryNIhSGxghZ7zyWwp4DBS19ru4l+dVQ4ikgb4wgbugAwIBA6KBswSBsGrVgYewQbJlk43Aw0ujMajwCinYuDDsW9b7I1gCa41ShWl0xSQ6MfkhuPDbcJO6TK6nTYyxSbWMtxo2eiMOehg+bHo5HUUCGyvRCNRnJFcJLP3GAqh8Ogjx9zY4/YcVb8c/eFM/BiBKHw41T4a0fR6scB9GKDjT8vDa4ysgGeEjeiPh+PjDSTS/y/CWrin97xXwrdUbsWbhuxHQ66HZ9rEJoZFb8oxtHgnqyEgMbwdO' 
> (decoded length: 1308).
> negotiate_kerberos_auth.cc(128): pid=40980 :2014/10/07 13:12:37| 
> negotiate_kerberos_auth: ERROR: gss_acquire_cred() failed:  No credentials 
> were supplied, or the credentials were unavailable or inaccessible.. 
> unknown mech-code 0 for mech unknown
> 2014/10/07 13:12:37 kid1| ERROR: Negotiate Authentication validating user. 
> Result: {result=BH, notes={message: gss_acquire_cred() failed:  No 
> credentials were supplied, or the credentials were unavailable or 
> inaccessible.. unknown mech-code 0 for mech unknown; }}
>
> -- 
> Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
> sip:sudakov at sibptus.tomsk.ru

> negotiate_kerberos_auth.cc(212): pid=40984 :2014/10/07 13:12:08| 
> negotiate_kerberos_auth: INFO: Starting version 3.0.4sq
> negotiate_kerberos_auth.cc(258): pid=40980 :2014/10/07 13:12:37| 
> negotiate_kerberos_auth: DEBUG: Got 'YR 
> YIIFGAYGKwYBBQUCoIIFDDCCBQigJDAiBgkqhkiC9xIBAgIGCSqGSIb3EgECAgYKKwYBBAGCNwICCqKCBN4EggTaYIIE1gYJKoZIhvcSAQICAQBuggTFMIIEwaADAgEFoQMCAQ6iBwMFACAAAACjggPpYYID5TCCA+GgAwIBBaEWGxRTSUJQVFVTLlRSQU5TTkVGVC5SVaItMCugAwIBAqEkMCIbBEhUVFAbGnByb3h5LnNpYnB0dXMudHJhbnNuZWZ0LnJ1o4IDkTCCA42gAwIBA6KCA4QEggOAB8tiAa54xI00BfngMyI8cwFHbNKRZPVn1c/HKYPi4Dppq0fIjp2e5br7rHG51+1/w6zaDwHKqdtnpWh/OplOkn6tDNq0H2fi/jFeT0XKICrLxdpmDHRqNmiyxvtczdkcSyxXJ2254oM9VwuE39D8hqU58NmijTB+WQupz2hw4d+5euIFFwSSO8nD3CMaBVGgyNfp9YvUUy860L+KKEqb0LVXZ+/OsnlsyrEc3AaaXwSwS30+ZRv0jCLh1h7kc84XFPrjGqRPp7JmO5gUCF8k/GXNF3FAMBAaT4r/iAs8LFIixQiRUWJPtjcWAtH0Q3JumqB9Enm+JPNvGBvE83YvbBZtDJQ0uc5lOMVLavBh2Xgj86BmKlCsrOCiMoQ8SgsEAX6o110EeMI1Tef8t+2/WhzP39l5BGuXmdDA1zEmqzA83vvTy5JcKUXZ3IdwwJ4I+kW62qIMsceZ/hfdj/Iy+RjCNrum5FHXMDszMVacKHp9kJTMofuMhhOKD2o+Z91TWTkEwD3NNWGjTWdgECpJT/F7I1x35iQaLGvgLebpalPJEXY8A8od1HhXZaCkIPXcDoPUR1LTTk8bHYKan17EnOBf0CbjOkU8/ib2mLUL81RQHrt6vdTcXzxsAgoZYigptd/ilsXq0dbwjTuZP8ZcFFY+levmSPIn5TF5xZtmtymditNO28hSqDjxC2Lpoy65kqwXglxpijuicSXC4cC/O1TBbksyH/aw/7MbNTKupFpovZTensu/A6zYG3HCjKW9QBsgU4tBXRC6rTP0RAeuASUHpvHv4WhbS5AWNYmX1TNQ8QpfurM2tAzuFzYQN8LL3VT38o4SVK+visE9q1IGez70q9g6Naowvpp6g/h3FuCzUks2ydXchKNPe3KzuSJqzmkLlyjKMlVW8sYUwgKXqNsgi7aRArEfu0L3UqYG/7lao+QLDOBf5+uSzWarZ9IIS7ClIRBejXU7erVJrLBDlGZRbMu+hXacsGwv/1Ls+S8xCxnlRjQngHjLg8vvQBYslgvkMh77eyP+HjiUDOXqDYoDR5bIc/w5UX/Dvb4ECGiqhGd9UHHQkYn6NQnbO/2r+iVBdy1fvXhXE2LKgAFoQtf2tIqsTUZWv12O82X2KzcZJ7IEVMxbGtSj9cdncc16c5Y6DL9AzQryNIhSGxghZ7zyWwp4DBS19ru4l+dVQ4ikgb4wgbugAwIBA6KBswSBsGrVgYewQbJlk43Aw0ujMajwCinYuDDsW9b7I1gCa41ShWl0xSQ6MfkhuPDbcJO6TK6nTYyxSbWMtxo2eiMOehg+bHo5HUUCGyvRCNRnJFcJLP3GAqh8Ogjx9zY4/YcVb8c/eFM/BiBKHw41T4a0fR6scB9GKDjT8vDa4ysgGeEjeiPh+PjDSTS/y/CWrin97xXwrdUbsWbhuxHQ66HZ9rEJoZFb8oxtHgnqyEgMbwdO' 
> from squid (length: 1747).
> negotiate_kerberos_auth.cc(311): pid=40980 :2014/10/07 13:12:37| 
> negotiate_kerberos_auth: DEBUG: Decode 
> 'YIIFGAYGKwYBBQUCoIIFDDCCBQigJDAiBgkqhkiC9xIBAgIGCSqGSIb3EgECAgYKKwYBBAGCNwICCqKCBN4EggTaYIIE1gYJKoZIhvcSAQICAQBuggTFMIIEwaADAgEFoQMCAQ6iBwMFACAAAACjggPpYYID5TCCA+GgAwIBBaEWGxRTSUJQVFVTLlRSQU5TTkVGVC5SVaItMCugAwIBAqEkMCIbBEhUVFAbGnByb3h5LnNpYnB0dXMudHJhbnNuZWZ0LnJ1o4IDkTCCA42gAwIBA6KCA4QEggOAB8tiAa54xI00BfngMyI8cwFHbNKRZPVn1c/HKYPi4Dppq0fIjp2e5br7rHG51+1/w6zaDwHKqdtnpWh/OplOkn6tDNq0H2fi/jFeT0XKICrLxdpmDHRqNmiyxvtczdkcSyxXJ2254oM9VwuE39D8hqU58NmijTB+WQupz2hw4d+5euIFFwSSO8nD3CMaBVGgyNfp9YvUUy860L+KKEqb0LVXZ+/OsnlsyrEc3AaaXwSwS30+ZRv0jCLh1h7kc84XFPrjGqRPp7JmO5gUCF8k/GXNF3FAMBAaT4r/iAs8LFIixQiRUWJPtjcWAtH0Q3JumqB9Enm+JPNvGBvE83YvbBZtDJQ0uc5lOMVLavBh2Xgj86BmKlCsrOCiMoQ8SgsEAX6o110EeMI1Tef8t+2/WhzP39l5BGuXmdDA1zEmqzA83vvTy5JcKUXZ3IdwwJ4I+kW62qIMsceZ/hfdj/Iy+RjCNrum5FHXMDszMVacKHp9kJTMofuMhhOKD2o+Z91TWTkEwD3NNWGjTWdgECpJT/F7I1x35iQaLGvgLebpalPJEXY8A8od1HhXZaCkIPXcDoPUR1LTTk8bHYKan17EnOBf0CbjOkU8/ib2mLUL81RQHrt6vdTcXzxsAgoZYigptd/ilsXq0dbwjTuZP8ZcFFY+levmSPIn5TF5xZtmtymditNO28hSqDjxC2Lpoy65kqwXglxpijuicSXC4cC/O1TBbksyH/aw/7MbNTKupFpovZTensu/A6zYG3HCjKW9QBsgU4tBXRC6rTP0RAeuASUHpvHv4WhbS5AWNYmX1TNQ8QpfurM2tAzuFzYQN8LL3VT38o4SVK+visE9q1IGez70q9g6Naowvpp6g/h3FuCzUks2ydXchKNPe3KzuSJqzmkLlyjKMlVW8sYUwgKXqNsgi7aRArEfu0L3UqYG/7lao+QLDOBf5+uSzWarZ9IIS7ClIRBejXU7erVJrLBDlGZRbMu+hXacsGwv/1Ls+S8xCxnlRjQngHjLg8vvQBYslgvkMh77eyP+HjiUDOXqDYoDR5bIc/w5UX/Dvb4ECGiqhGd9UHHQkYn6NQnbO/2r+iVBdy1fvXhXE2LKgAFoQtf2tIqsTUZWv12O82X2KzcZJ7IEVMxbGtSj9cdncc16c5Y6DL9AzQryNIhSGxghZ7zyWwp4DBS19ru4l+dVQ4ikgb4wgbugAwIBA6KBswSBsGrVgYewQbJlk43Aw0ujMajwCinYuDDsW9b7I1gCa41ShWl0xSQ6MfkhuPDbcJO6TK6nTYyxSbWMtxo2eiMOehg+bHo5HUUCGyvRCNRnJFcJLP3GAqh8Ogjx9zY4/YcVb8c/eFM/BiBKHw41T4a0fR6scB9GKDjT8vDa4ysgGeEjeiPh+PjDSTS/y/CWrin97xXwrdUbsWbhuxHQ66HZ9rEJoZFb8oxtHgnqyEgMbwdO' 
> (decoded length: 1308).
> negotiate_kerberos_auth.cc(128): pid=40980 :2014/10/07 13:12:37| 
> negotiate_kerberos_auth: ERROR: gss_acquire_cred() failed:  No credentials 
> were supplied, or the credentials were unavailable or inaccessible.. 
> unknown mech-code 0 for mech unknown
> 2014/10/07 13:12:37 kid1| ERROR: Negotiate Authentication validating user. 
> Result: {result=BH, notes={message: gss_acquire_cred() failed:  No 
> credentials were supplied, or the credentials were unavailable or 
> inaccessible.. unknown mech-code 0 for mech unknown; }}

> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


- -- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUM6XeAAoJEA2k8lmbXsY0shEH/3k0EU+0PGD1iSx2OLqbkhGv
Z38OUous3LXoxpvOTSTP5mp+jVzutKBUlzqZbo5M0qNPg+WovNtDF2bqPK09scy8
Wuf+zfZv8YXQIvMemLXsnWZkIivLQ8Tgi6nAhX5fewP6zIfjRPMgqr86+ihHYZs4
HfO1IceZkitgeJx+9VvWDrRRDYIikTkXDLssfjFH+2J++tJikDWLqxoXykXTRRR3
xWNHomrRCxHw0q4KixCgefEnUDThvAK6MRnQA57t6xnTXiSTbqMSvkagLFgTLo87
OKI3ex+nVgyax1JZHJy1oOqXYJIeex+KxcLKkEzvXL9mdEUPgiJLg8FJD7rSDHE=
=hOY8
-----END PGP SIGNATURE-----
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users 




From eliezer at ngtech.co.il  Tue Oct  7 22:46:50 2014
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Wed, 08 Oct 2014 01:46:50 +0300
Subject: [squid-users] Squid 2.7 STABLE8 (Win2008) can't get my MS Lync
	2013 to work?
In-Reply-To: <BAY181-W61EF839967043531882833F0A20@phx.gbl>
References: <BAY181-W940DC82E91699617FA5A9F0A20@phx.gbl>
 <54345EFD.7040202@ngtech.co.il> <BAY181-W61EF839967043531882833F0A20@phx.gbl>
Message-ID: <54346D5A.5050809@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

It's Eliezer..

Since you are using squidguard and ntlm first try to disable them both
for a specific src IP and\or dst domain\ip for the testing period.

For the specific domains of ms and specific dst ip addresses it can be
disabled since they most likely will not host facebook\youtube\other
stuff.
(if and only if this is what you are looking to use squidguard for..)

If you can run a newer version of squid even as a VM it would at least
give you the option to minimize the search since 2.7 will not get an
update.

There is a work in progress to build squid for windows but I would
recommend you to run a newer version on a liunx machine.
If you do not like cli you can use webmin for most of your basic tasks
as a proxy\cache admin.

If you have wireshark installed on the windows machine we might be
able to see what's in the packets but I cannot guarantee that I will
find the issue in the capture.

All The Bests,
Eliezer

On 10/08/2014 01:00 AM, Mirza Dedic wrote:
> Hi Elizabeth, Thanks, I totally forgot I could use a paste like
> service, here is the link to my squid.conf file: 
> http://pastie.org/9629651 I have stripped out the comments from the
> paste. It seems it could be HTTP 1.1 according to
> http://blog.schertz.name/2012/12/http-utilized-lync-server/ Does
> this mean I am out of luck with getting this to work on Squid 2.7
> STABLE8? I would upgrade to a higher version, however 2.7 STABLE8
> is the latest available version for Windows it appears.

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUNG1aAAoJENxnfXtQ8ZQUfQgH/1zjzDX9ZHRWx7UOpGz1/Ai8
KWdB3fzM0HwnCo/xh7lyOY4VRLaX4knfnsIS2rP3u7QyNOy2Z2x91um2PhQXbFbE
sPA+tIeetA1zv2EeETqvu8lYVxd6BVHMdinMQqafgAlH/Ybx2QMC7hHJemgUiaZS
rBEMT1vc8De9GHfHjDQWcqUrOd8pno2xuObLmF1fFyxGwBNrWeuebxq6KZP0L9fU
/UHfpFuFc782N9TRHDzoJz+pqpHp/Y4juP5KAKfs77Bw11f/udKXCCxPC7nVTlxU
PznuRfwh8mRYzMjjvpZhh8iVlyi4EQLy5ck3b8wjVf5yBt/gMI5W5hw2Gz+BP7M=
=bE7/
-----END PGP SIGNATURE-----


From mirza.dedic at outlook.com  Tue Oct  7 23:17:47 2014
From: mirza.dedic at outlook.com (Mirza Dedic)
Date: Tue, 7 Oct 2014 16:17:47 -0700
Subject: [squid-users] Squid 2.7 STABLE8 (Win2008) can't get my MS Lync
	2013 to work?
In-Reply-To: <54346D5A.5050809@ngtech.co.il>
References: <BAY181-W940DC82E91699617FA5A9F0A20@phx.gbl>
 <54345EFD.7040202@ngtech.co.il> <BAY181-W61EF839967043531882833F0A20@phx.gbl>
 <54346D5A.5050809@ngtech.co.il>
Message-ID: <BAY405-EAS241813461A14B5D530D6897F0A20@phx.gbl>

Hi Eliezer,

After I commented out the SquidGuard part of the config and restarted squid
I restart my Lync 2013 client and it connects without a proxy prompt, in the
log I still see the " 1412723608.354    485 172.16.12.110 TCP_MISS/200 11695
CONNECT login.microsoftonline.com:443 - DIRECT/65.52.244.66 -" but no proxy
on the client's side.

So, something in SquidGuard must be causing this??

I did not want to uncomment the NTLM because we use this to provide seamless
authentication for the clients, if we only allow basic it will prompt for
user/pass won't it?

We use SquidGuard as it has a pre-defined list of blocked sites, so it was a
quick way to add a set of blocked sites.. but this whole setup is old I
don't even know where the win32 binaries came from for squidguard.. 

You mentioned a 3.x being developed for Windows, is this internal only or
somewhere I can follow the progress?

Thank you for your help on this !

-----Original Message-----
From: Eliezer Croitoru [mailto:eliezer at ngtech.co.il] 
Sent: October 7, 2014 3:47 PM
To: squid-users at lists.squid-cache.org
Cc: Mirza Dedic
Subject: Re: [squid-users] Squid 2.7 STABLE8 (Win2008) can't get my MS Lync
2013 to work?

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

It's Eliezer..

Since you are using squidguard and ntlm first try to disable them both for a
specific src IP and\or dst domain\ip for the testing period.

For the specific domains of ms and specific dst ip addresses it can be
disabled since they most likely will not host facebook\youtube\other stuff.
(if and only if this is what you are looking to use squidguard for..)

If you can run a newer version of squid even as a VM it would at least give
you the option to minimize the search since 2.7 will not get an update.

There is a work in progress to build squid for windows but I would recommend
you to run a newer version on a liunx machine.
If you do not like cli you can use webmin for most of your basic tasks as a
proxy\cache admin.

If you have wireshark installed on the windows machine we might be able to
see what's in the packets but I cannot guarantee that I will find the issue
in the capture.

All The Bests,
Eliezer

On 10/08/2014 01:00 AM, Mirza Dedic wrote:
> Hi Elizabeth, Thanks, I totally forgot I could use a paste like 
> service, here is the link to my squid.conf file:
> http://pastie.org/9629651 I have stripped out the comments from the 
> paste. It seems it could be HTTP 1.1 according to 
> http://blog.schertz.name/2012/12/http-utilized-lync-server/ Does this 
> mean I am out of luck with getting this to work on Squid 2.7 STABLE8? 
> I would upgrade to a higher version, however 2.7 STABLE8 is the latest 
> available version for Windows it appears.

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUNG1aAAoJENxnfXtQ8ZQUfQgH/1zjzDX9ZHRWx7UOpGz1/Ai8
KWdB3fzM0HwnCo/xh7lyOY4VRLaX4knfnsIS2rP3u7QyNOy2Z2x91um2PhQXbFbE
sPA+tIeetA1zv2EeETqvu8lYVxd6BVHMdinMQqafgAlH/Ybx2QMC7hHJemgUiaZS
rBEMT1vc8De9GHfHjDQWcqUrOd8pno2xuObLmF1fFyxGwBNrWeuebxq6KZP0L9fU
/UHfpFuFc782N9TRHDzoJz+pqpHp/Y4juP5KAKfs77Bw11f/udKXCCxPC7nVTlxU
PznuRfwh8mRYzMjjvpZhh8iVlyi4EQLy5ck3b8wjVf5yBt/gMI5W5hw2Gz+BP7M=
=bE7/
-----END PGP SIGNATURE-----


From Jason_Haar at trimble.com  Wed Oct  8 00:26:42 2014
From: Jason_Haar at trimble.com (Jason Haar)
Date: Wed, 8 Oct 2014 13:26:42 +1300
Subject: [squid-users] Squid 2.7 STABLE8 (Win2008) can't get my MS Lync
 2013 to work?
In-Reply-To: <BAY405-EAS241813461A14B5D530D6897F0A20@phx.gbl>
References: <BAY181-W940DC82E91699617FA5A9F0A20@phx.gbl>
 <54345EFD.7040202@ngtech.co.il> <BAY181-W61EF839967043531882833F0A20@phx.gbl>
 <54346D5A.5050809@ngtech.co.il>
 <BAY405-EAS241813461A14B5D530D6897F0A20@phx.gbl>
Message-ID: <543484C2.5080909@trimble.com>

On 08/10/14 12:17, Mirza Dedic wrote:
> 
> I did not want to uncomment the NTLM because we use this to provide
seamless
> authentication for the clients, if we only allow basic it will prompt for
> user/pass won't it?

The dodgy "invisibly tracking users without them knowing it" feature
that NTLM auth gives you only works for MSIE (all other browsers prompt
I think?) and is much slower than Basic. Yes Basic does prompt, but the
user can "save" the password (ie they only do it once) and is much
cleaner and more reliable (try running multi-domain NTLM where one of
the domains is a continent away). Basic is quicker because it's embedded
in the HTTP transaction on a 1-for-1 basis, whereas NTLM is 1-for-4 (I
think?). ie you have to make 4 HTTP requests before you get the webpage
when you use NTLM (ignoring keepalive)

The only downside (besides your users knowing you're tracking them...)
is that Basic is cleartext - so sniffers can see the passwords. However,
if it's on a corporate network, that shouldn't be a problem (else you're
doing it wrong ;-)

I prefer Basic specifically because it *does* mean the users know you're
tracking them: that means they're less likely to go to dodgy sites/etc
on company time :-)


-- 
Cheers

Jason Haar

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141008/bad7e184/attachment.htm>

From sudakov at sibptus.tomsk.ru  Wed Oct  8 03:29:25 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Wed, 8 Oct 2014 10:29:25 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <m11nv3$nk8$1@ger.gmane.org>
References: <20141006040725.GA31642@admin.sibptus.tomsk.ru>
 <20141006052346.GA32369@admin.sibptus.tomsk.ru>
 <20141007070403.GA57384@admin.sibptus.tomsk.ru>
 <20141007083542.GA60425@admin.sibptus.tomsk.ru>
 <m11nv3$nk8$1@ger.gmane.org>
Message-ID: <20141008032925.GA77544@admin.sibptus.tomsk.ru>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Markus Moeller wrote:
> 
>   In the helpers/negotiate_auth/kerberos directory is a script 
> test_negotiate_auth.sh to test authentication outside of squid. 

Markus,

I could find the said script neither in the source nor in the binary
package. However I think I can guess what could be inside.  Could you
look below if that makes sense?

===========================
$ setenv KRB5_KTNAME /usr/local/etc/squid/squid.keytab
$ setenv KRB5_CONFIG /usr/local/etc/squid/krb5.conf
$ kdestroy
$ kinit sudakovva
sudakovva at SIBPTUS.TRANSNEFT.RU's Password:
$
$ klist
Credentials cache: FILE:/tmp/krb5cc_XZ1GPU
        Principal: sudakovva at SIBPTUS.TRANSNEFT.RU

  Issued           Expires          Principal
Oct  8 09:31:45  Oct  8 19:31:45  krbtgt/SIBPTUS.TRANSNEFT.RU at SIBPTUS.TRANSNEFT.RU

$ ./negotiate_kerberos_auth_test proxy.sibptus.transneft.ru | awk '{sub(/Token:/,"YR"); print $0}END{print "QQ"}' | ./negotiate_kerberos_auth -d

negotiate_kerberos_auth.cc(212): pid=52357 :2014/10/08 10:03:34| negotiate_kerberos_auth: INFO: Starting version 3.0.4sq
negotiate_kerberos_auth.cc(258): pid=52357 :2014/10/08 10:03:34| negotiate_kerberos_auth: DEBUG: Got 'YR YIIGFAYGKwYBBQUCoIIGCDCCBgSgDTALBgkqhkiG9xIBAgKiggXxBIIF7WCCBekGCSqGSIb3EgECAgEAboIF2DCCBdSgAwIBBaEDAgEOogcDBQAAAAAAo4IEvGGCBLgwggS0oAMCAQWhFhsUU0lCUFRVUy5UUkFOU05FRlQuUlWiLTAroAMCAQGhJDAiGwRIVFRQGxpwcm94eS5zaWJwdHVzLnRyYW5zbmVmdC5ydaOCBGQwggRgoAMCAReiggRXBIIEUxpOgFWeZoAcatE6l3MyfDxMoDMjcgYUQzenTLAlEvD3/c0pyRiitZwNMIHvnacXcUSTzLDNjDw75iwfNxZHYjZgvOLHSKQm+rmoWtLIC+3KZoeWCB+pxwcpK8RzXvs8dPCprH1h5OdCn8EB1ZZxl35IhLgg07N72yvnXNiBmW/PmLW6PeVB0U3SLjWiT0ZJ3kXukg5ViYGOMKypeHebHPB0FQ2dgNQy8S00CRIU4ZuoHPVWFNl6mzp9CoIy7Ytwhu3NRb42f49nuQpqBVcsMK/ckgLYvsoz2lYxe7AO4MMOvcGqnEBB/jaSfrGGXpw+ciMNbBtCHH7bN36uGHj+VWOUFL5vR3xclnOWwdUH2OtXqMMcDDnI4v7vNR1U80BS7SdXUpx0D+O1B3ihipaTpSkXtII5UTI4qxmZjXSQGYY0adbG/N6NpMF7HpmGb1Zondp571l4ZV0mZ0pZ7IcIAmvQOmcud/sN0am4z9Oe3lCe7L1RVKBr0Tu30Pz7ySibeCpY/OVR2GJ+ILfov/3o95ozW8W4d+UCHfywAHOioGB+QWSC2NO5VtcjsBYVkhKnBkcG8KOBhJ+qi1qvhGXD3tUgDZnb0pCQAVNyjiDIKZre8KcB23Hu5a2YCM9y0GiBCbfJIbD60LJLVOxozZiRqJfdOCvBhfCvh7R9y5EuNmMswSRgQJwhkh7rCgMPWvFsAWDae9yxN966E85nE+xuUtwtl20NhOjotjG3NgwsRYDg1kQvfJnz7IcPSnSevKiPHU7uvBxSZvR6j6J0BZRgTQg7loUzkOsSRPDefXMt4wFfoHEqaWTtKw3yR0dZkr1W5g6WDn0d0o4uLZRdZteMOtxjsXFTQA3MIQrf/BpVk0NdEQ0EpXo2SZtr+ciy2jNXI40s6rUQakV/vfLG5aGOQY1Ck1gynORrG6Bt/eDMVJF7gf8iEvSDPiZhaHNqfAwfuYDNcO6Sgvl21tkEUfC9YxzkZq2vb0J1gJnkoq3oay+B7GElpgBABZpf22eGTOHakz7m8z9jdPUuIGFf1Jgn1B4i2vFsYRV6tbn3gF/wpnBdPmmG0ZVT2ZnqPDf2Om3kh1cd/THIWDVeuvNGRHbzGYxFJcJ+NIgwr5yfijltcKyynGqHvW2arUQwHzX0UM/dg6iI8+o2IkKmihBL9WQ+04SwHYeMk+D1hJx2rfrIl9RgpQdkrhrjPacqGfKd7NrtEweeSn7MOwFjaVYlT4ruboQHt94BcJKQ1qhuJVsH+rhZaM6XBt6F2NtM5Z+0OmwsLb0sQkdVbnbyEku7McPN0vvOC7tuDL1pT0UuAanSO6IQahXj5X3W/MVNf27rJUmcUQkGbTvCK6nJMuZYNsuKaB9Izs10T/i88V5IOgafwAHgLCxnpwptY551gJwj/0cvv6mpIZSrE8XjMWMUDmeTkeUyU8t2Dz5Vjbb8l1cFCIETgvc5CK9mV+SG0F6soQqf1xs+r6SB/jCB+6ADAgEXooHzBIHwxdPbAIs5nPD2d3wOYONkgkc1qb9krxSlo4FRMoPPIl+80A1OZOlv/SRc9B4VpP8xJJvk1YwY70twgMlOJd/zbXH0lEnyGdGi9mUuN4XdfeNzFwqvjxOrx1e8oPXJPJLIZCGhUik3nY7X4Nb4EMXmfEckzSsuBbVKkVwu7/0xPKbXL4KPs/e3ANJI8Lvkh7AM7iIXrhI2S4/ZKWo4f73R1sjgtt+nw8e1Ga7EeMlQvbejo/i9UBEFldNR2B8GM0DD6449mRrbXE1K5Pij+bHoHl9oZng97DGGnM4ritsN+ts2Rcev1IuSzm6QFaADBwRU' from squid (length: 2083).
negotiate_kerberos_auth.cc(311): pid=52357 :2014/10/08 10:03:34| negotiate_kerberos_auth: DEBUG: Decode 'YIIGFAYGKwYBBQUCoIIGCDCCBgSgDTALBgkqhkiG9xIBAgKiggXxBIIF7WCCBekGCSqGSIb3EgECAgEAboIF2DCCBdSgAwIBBaEDAgEOogcDBQAAAAAAo4IEvGGCBLgwggS0oAMCAQWhFhsUU0lCUFRVUy5UUkFOU05FRlQuUlWiLTAroAMCAQGhJDAiGwRIVFRQGxpwcm94eS5zaWJwdHVzLnRyYW5zbmVmdC5ydaOCBGQwggRgoAMCAReiggRXBIIEUxpOgFWeZoAcatE6l3MyfDxMoDMjcgYUQzenTLAlEvD3/c0pyRiitZwNMIHvnacXcUSTzLDNjDw75iwfNxZHYjZgvOLHSKQm+rmoWtLIC+3KZoeWCB+pxwcpK8RzXvs8dPCprH1h5OdCn8EB1ZZxl35IhLgg07N72yvnXNiBmW/PmLW6PeVB0U3SLjWiT0ZJ3kXukg5ViYGOMKypeHebHPB0FQ2dgNQy8S00CRIU4ZuoHPVWFNl6mzp9CoIy7Ytwhu3NRb42f49nuQpqBVcsMK/ckgLYvsoz2lYxe7AO4MMOvcGqnEBB/jaSfrGGXpw+ciMNbBtCHH7bN36uGHj+VWOUFL5vR3xclnOWwdUH2OtXqMMcDDnI4v7vNR1U80BS7SdXUpx0D+O1B3ihipaTpSkXtII5UTI4qxmZjXSQGYY0adbG/N6NpMF7HpmGb1Zondp571l4ZV0mZ0pZ7IcIAmvQOmcud/sN0am4z9Oe3lCe7L1RVKBr0Tu30Pz7ySibeCpY/OVR2GJ+ILfov/3o95ozW8W4d+UCHfywAHOioGB+QWSC2NO5VtcjsBYVkhKnBkcG8KOBhJ+qi1qvhGXD3tUgDZnb0pCQAVNyjiDIKZre8KcB23Hu5a2YCM9y0GiBCbfJIbD60LJLVOxozZiRqJfdOCvBhfCvh7R9y5EuNmMswSRgQJwhkh7rCgMPWvFsAWDae9yxN966E85nE+xuUtwtl20NhOjotjG3NgwsRYDg1kQvfJnz7IcPSnSevKiPHU7uvBxSZvR6j6J0BZRgTQg7loUzkOsSRPDefXMt4wFfoHEqaWTtKw3yR0dZkr1W5g6WDn0d0o4uLZRdZteMOtxjsXFTQA3MIQrf/BpVk0NdEQ0EpXo2SZtr+ciy2jNXI40s6rUQakV/vfLG5aGOQY1Ck1gynORrG6Bt/eDMVJF7gf8iEvSDPiZhaHNqfAwfuYDNcO6Sgvl21tkEUfC9YxzkZq2vb0J1gJnkoq3oay+B7GElpgBABZpf22eGTOHakz7m8z9jdPUuIGFf1Jgn1B4i2vFsYRV6tbn3gF/wpnBdPmmG0ZVT2ZnqPDf2Om3kh1cd/THIWDVeuvNGRHbzGYxFJcJ+NIgwr5yfijltcKyynGqHvW2arUQwHzX0UM/dg6iI8+o2IkKmihBL9WQ+04SwHYeMk+D1hJx2rfrIl9RgpQdkrhrjPacqGfKd7NrtEweeSn7MOwFjaVYlT4ruboQHt94BcJKQ1qhuJVsH+rhZaM6XBt6F2NtM5Z+0OmwsLb0sQkdVbnbyEku7McPN0vvOC7tuDL1pT0UuAanSO6IQahXj5X3W/MVNf27rJUmcUQkGbTvCK6nJMuZYNsuKaB9Izs10T/i88V5IOgafwAHgLCxnpwptY551gJwj/0cvv6mpIZSrE8XjMWMUDmeTkeUyU8t2Dz5Vjbb8l1cFCIETgvc5CK9mV+SG0F6soQqf1xs+r6SB/jCB+6ADAgEXooHzBIHwxdPbAIs5nPD2d3wOYONkgkc1qb9krxSlo4FRMoPPIl+80A1OZOlv/SRc9B4VpP8xJJvk1YwY70twgMlOJd/zbXH0lEnyGdGi9mUuN4XdfeNzFwqvjxOrx1e8oPXJPJLIZCGhUik3nY7X4Nb4EMXmfEckzSsuBbVKkVwu7/0xPKbXL4KPs/e3ANJI8Lvkh7AM7iIXrhI2S4/ZKWo4f73R1sjgtt+nw8e1Ga7EeMlQvbejo/i9UBEFldNR2B8GM0DD6449mRrbXE1K5Pij+bHoHl9oZng97DGGnM4ritsN+ts2Rcev1IuSzm6QFaADBwRU' (decoded length: 1560).
negotiate_kerberos_auth.cc(128): pid=52357 :2014/10/08 10:03:34| negotiate_kerberos_auth: ERROR: gss_acquire_cred() failed:  No credentials were supplied, or the credentials were unavailable or inaccessible.. unknown mech-code 0 for mech unknown
BH gss_acquire_cred() failed:  No credentials were supplied, or the credentials were unavailable or inaccessible.. unknown mech-code 0 for mech unknown
negotiate_kerberos_auth.cc(258): pid=52357 :2014/10/08 10:03:34| negotiate_kerberos_auth: DEBUG: Got 'QQ' from squid (length: 2).
BH quit command

$ klist -v
Credentials cache: FILE:/tmp/krb5cc_XZ1GPU
        Principal: sudakovva at SIBPTUS.TRANSNEFT.RU
    Cache version: 4

Server: krbtgt/SIBPTUS.TRANSNEFT.RU at SIBPTUS.TRANSNEFT.RU
Client: sudakovva at SIBPTUS.TRANSNEFT.RU
Ticket etype: arcfour-hmac-md5
Ticket length: 1128
Auth time:  Oct  8 10:00:12 2014
End time:   Oct  8 20:00:12 2014
Ticket flags: initial, pre-authenticated
Addresses: addressless

Server: HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
Client: sudakovva at SIBPTUS.TRANSNEFT.RU
Ticket etype: arcfour-hmac-md5
Ticket length: 1212
Auth time:  Oct  8 10:00:12 2014
Start time: Oct  8 10:00:16 2014
End time:   Oct  8 20:00:12 2014
Ticket flags: pre-authenticated
Addresses: addressless

$
$  ktutil list
/usr/local/etc/squid/squid.keytab:

Vno  Type                     Principal
  1  des-cbc-crc              HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  des-cbc-md5              HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  arcfour-hmac-md5         HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  aes256-cts-hmac-sha1-96  HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  aes128-cts-hmac-sha1-96  HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
===========================

> 
> Let me know what you get. 

You can see that I obtain a ticket for the HTTP/proxy.sibptus.transneft.ru 
service, but somehow the authentication fails.

> BTW on which platform with which Kerberos 
> library( MIT or Heimdal)  is this ?

On the squid host: FreeBSD 8.4-RELEASE-p16 i386, Heimdal 1.1.0.

w2k AD as KDC for SIBPTUS.TRANSNEFT.RU.

- -- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUNK+VAAoJEA2k8lmbXsY0JeUIAItkImiYwviy4IEgOepwiamE
NpodTm4bvdhy+bFrchezXjx8vSPSz0mKgM5IdwNxdRaH9qRl5obC5lXQWu9K6d8S
J3e3fxlKY9t7rUcnJYHWXwlClHd0qz7cN9Actp4OOs01RcD1bEHzfnR9yeQnWfNw
vTE+C9IbFpVQnVQyQCsnrS/jwIsGbvXTTWywgeQ9p6hTQsR5Cw/u6pqtUQjIZ6Rq
0elGZ21JY4hzfILNjcKxflU5q7HKULRBtBHWUC8JowZmBUKBBxX5Cci4atFHVd/e
dSg4fPYDqHYoz0H4mu3IzRbPSurjGQZ9g3cUFrClqgX3Fyr8lrWAGbAQVRxABZw=
=Nikr
-----END PGP SIGNATURE-----


From eliezer at ngtech.co.il  Wed Oct  8 05:38:02 2014
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Wed, 08 Oct 2014 08:38:02 +0300
Subject: [squid-users] Squid,
	Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
	3.4.7.)
In-Reply-To: <20141008032925.GA77544@admin.sibptus.tomsk.ru>
References: <20141006040725.GA31642@admin.sibptus.tomsk.ru>
 <20141006052346.GA32369@admin.sibptus.tomsk.ru>
 <20141007070403.GA57384@admin.sibptus.tomsk.ru>
 <20141007083542.GA60425@admin.sibptus.tomsk.ru> <m11nv3$nk8$1@ger.gmane.org>
 <20141008032925.GA77544@admin.sibptus.tomsk.ru>
Message-ID: <5434CDBA.40004@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 10/08/2014 06:29 AM, Victor Sudakov wrote:
> Markus,
> 
> I could find the said script neither in the source nor in the
> binary package. However I think I can guess what could be inside.
> Could you look below if that makes sense?

Or you can just look at the source code:
http://bazaar.launchpad.net/~squid/squid/3.4/view/head:/helpers/negotiate_auth/kerberos/test_negotiate_auth.sh

Eliezer
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUNM26AAoJENxnfXtQ8ZQUcjQH+wdS/uXIyuQfmy3fqB++6mMO
zXcJxJqJA59uAHIVMQav4FLEC9XbbWB7uFigR/IZIqMMYFysR0n13wZRYEBmLn/w
K1jP8Rak+1zoxQSXxS7tvt5n9Z+om0CZIYkVidEqC4FuEaUcSV5PS3FyjAotq7se
gOhemfPTJvmvvFMLLRm/dwkBNE+bFiYLdICBFypzeJ3IQVoMCbMr7KYcYe0JnIt2
aKYcl2uIQLAu+MUt56J0nOJnAI8ynkYwRDUUPjA1nuAC2h9U5hMdpa901b1hRzsU
o+Vui/vb4ggtsxtD/PEv9lTkxXR+jwtYLPJIrEBPW3j9r5WiLOK/pO/PrWsceIY=
=ukZN
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Wed Oct  8 05:51:16 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 08 Oct 2014 18:51:16 +1300
Subject: [squid-users] squid ipv6 outgoing addresses from ipv4 incoming
 traffic
In-Reply-To: <000101cfe270$cfb3df00$6f1b9d00$@netstream.ps>
References: <000001cfe20c$3a4159c0$aec40d40$@netstream.ps>
 <54335298.7020905@treenet.co.nz>
 <001201cfe262$faf13d60$f0d3b820$@netstream.ps>
 <001301cfe264$f2f9ae10$d8ed0a30$@netstream.ps>
 <5433C465.7090309@treenet.co.nz>
 <000001cfe270$0c4385c0$24ca9140$@netstream.ps>
 <000101cfe270$cfb3df00$6f1b9d00$@netstream.ps>
Message-ID: <5434D0D4.9020601@treenet.co.nz>

I should work, I recently used exactly that type of config with a client.

Can you try to use the latest stable (3.4.8) please, and add
"debug_options, 28,3" to your squid.conf for a trace of what ACLs are
being checked.

Amos

On 8/10/2014 9:53 a.m., Ahmed Allzaeem wrote:
> I just have one final question , I want to use tcp outgoing ipv6 based on user authentication
> I mean if user A ==>ipv61
> If user B ==<ipv62
> 
> And so on ,
> Actually I had treid but no luck , I have two users (Drvirus) & (drx) all the time they go  out from 
> 
> I have configured ACL user access but not sure if im wrong !
> 
> Thos user are stored in etc/squid/squid_user I created two of them here !
> 
> So now I use port 64000 and enter users drvirusx & drx but both go out from 2a01:7e00:e000:eb::dddd
> I belkive they dhould go out from 
> 2a01:7e00:e000:eb::1111 & 2a01:7e00:e000:eb::2222
> 
> Can u have a look when u have time ???
> 
> Here is my last config
> =============
> 
> 
> auth_param basic children 20
> auth_param basic realm Linux Class
> auth_param basic program /lib/squid/basic_ncsa_auth /etc/squid/squid_user
> auth_param basic credentialsttl 2 hours
> auth_param basic casesensitive off
> ###
> acl classx proxy_auth REQUIRED
> 
> http_access allow classx
> # Recommended minimum configurat
> 
> # Squid normally listens to port 3128
> http_port xxx:64000
> #######################users acls###########
> acl drvirus note user drvirus
> acl drx note user drx
> # Uncomment and adjust th;e following to add a disk cache directory.
> #cache_dir ufs /var/cache/squid 100 16 256
> 
> # Leave coredumps in the first cache dir
> tcp_outgoing_address 2a01:7e00:e000:eb::1111 drvirus
> tcp_outgoing_address 2a01:7e00:e000:eb::2222 drx
> ===============================
> 


From ahmed.zaeem at netstream.ps  Wed Oct  8 16:14:22 2014
From: ahmed.zaeem at netstream.ps (Ahmed Allzaeem)
Date: Wed, 8 Oct 2014 09:14:22 -0700
Subject: [squid-users] squid ipv6 outgoing addresses from ipv4 incoming
	traffic
In-Reply-To: <5434D0D4.9020601@treenet.co.nz>
References: <000001cfe20c$3a4159c0$aec40d40$@netstream.ps>
 <54335298.7020905@treenet.co.nz>
 <001201cfe262$faf13d60$f0d3b820$@netstream.ps>
 <001301cfe264$f2f9ae10$d8ed0a30$@netstream.ps>
 <5433C465.7090309@treenet.co.nz>
 <000001cfe270$0c4385c0$24ca9140$@netstream.ps>
 <000101cfe270$cfb3df00$6f1b9d00$@netstream.ps>
 <5434D0D4.9020601@treenet.co.nz>
Message-ID: <001401cfe312$ece01a60$c6a04f20$@netstream.ps>

Hi Amos ,
Im using 3.4.3

The below config with me didn?t work.
The config that worked was using the directive :

acl drx proxy_auth [-i] drx


this directive could match the user name with acl that I need,

then I can use the acl drx in the outgoing address.

All other solutins has failed.

Again , thanks you for helping

regards

-----Original Message-----
From: Amos Jeffries [mailto:squid3 at treenet.co.nz] 
Sent: Tuesday, October 7, 2014 10:51 PM
To: Ahmed Allzaeem; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] squid ipv6 outgoing addresses from ipv4 incoming traffic

I should work, I recently used exactly that type of config with a client.

Can you try to use the latest stable (3.4.8) please, and add "debug_options, 28,3" to your squid.conf for a trace of what ACLs are being checked.

Amos

On 8/10/2014 9:53 a.m., Ahmed Allzaeem wrote:
> I just have one final question , I want to use tcp outgoing ipv6 based 
> on user authentication I mean if user A ==>ipv61 If user B ==<ipv62
> 
> And so on ,
> Actually I had treid but no luck , I have two users (Drvirus) & (drx) 
> all the time they go  out from
> 
> I have configured ACL user access but not sure if im wrong !
> 
> Thos user are stored in etc/squid/squid_user I created two of them here !
> 
> So now I use port 64000 and enter users drvirusx & drx but both go out 
> from 2a01:7e00:e000:eb::dddd I belkive they dhould go out from
> 2a01:7e00:e000:eb::1111 & 2a01:7e00:e000:eb::2222
> 
> Can u have a look when u have time ???
> 
> Here is my last config
> =============
> 
> 
> auth_param basic children 20
> auth_param basic realm Linux Class
> auth_param basic program /lib/squid/basic_ncsa_auth 
> /etc/squid/squid_user auth_param basic credentialsttl 2 hours 
> auth_param basic casesensitive off ### acl classx proxy_auth REQUIRED
> 
> http_access allow classx
> # Recommended minimum configurat
> 
> # Squid normally listens to port 3128
> http_port xxx:64000
> #######################users acls########### acl drvirus note user 
> drvirus acl drx note user drx # Uncomment and adjust th;e following to 
> add a disk cache directory.
> #cache_dir ufs /var/cache/squid 100 16 256
> 
> # Leave coredumps in the first cache dir tcp_outgoing_address 
> 2a01:7e00:e000:eb::1111 drvirus tcp_outgoing_address 
> 2a01:7e00:e000:eb::2222 drx ===============================
> 



From squid3 at treenet.co.nz  Wed Oct  8 06:35:25 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 08 Oct 2014 19:35:25 +1300
Subject: [squid-users] Squid 2.7 STABLE8 (Win2008) can't get my MS Lync
 2013 to work?
In-Reply-To: <BAY405-EAS241813461A14B5D530D6897F0A20@phx.gbl>
References: <BAY181-W940DC82E91699617FA5A9F0A20@phx.gbl>
 <54345EFD.7040202@ngtech.co.il> <BAY181-W61EF839967043531882833F0A20@phx.gbl>
 <54346D5A.5050809@ngtech.co.il>
 <BAY405-EAS241813461A14B5D530D6897F0A20@phx.gbl>
Message-ID: <5434DB2D.6080705@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 8/10/2014 12:17 p.m., Mirza Dedic wrote:
> Hi Eliezer,
> 
> After I commented out the SquidGuard part of the config and
> restarted squid I restart my Lync 2013 client and it connects
> without a proxy prompt, in the log I still see the " 1412723608.354
> 485 172.16.12.110 TCP_MISS/200 11695 CONNECT
> login.microsoftonline.com:443 - DIRECT/65.52.244.66 -" but no
> proxy on the client's side.
> 
> So, something in SquidGuard must be causing this??

Yes several things. Basically SG does not contain all of the hacks and
disablings necessary to cope with demands NTLM places on HTTP proxies.
Which is reasonable since its design goal is to filter HTTP traffic.

> 
> I did not want to uncomment the NTLM because we use this to provide
> seamless authentication for the clients, if we only allow basic it
> will prompt for user/pass won't it?
> 
> We use SquidGuard as it has a pre-defined list of blocked sites, so
> it was a quick way to add a set of blocked sites.. but this whole
> setup is old I don't even know where the win32 binaries came from
> for squidguard..

In which case there should be no need for you to have SG at all.

The popular blocklist/blacklist sources for SG also provide Squid
format downloads of the same lists, or converters are easily written.
https://www.google.com/search?q=squid+blacklist


> 
> You mentioned a 3.x being developed for Windows, is this internal
> only or somewhere I can follow the progress?

I am the one driving that effort at present. It is a side hobby on my
overall goal of feature parity between Squid-2 and Squid-3 - keeping
Squid building and running on any OS Squid-2 was useful for.

The official state of Squid on Windows is documented in here:
http://wiki.squid-cache.org/KnowledgeBase/Windows
the newest bits are down under "Porting Efforts" for now.

Changes as they are found are being applied directly on the mainstream
3.HEAD version. So the regular 3.HEAD ChangeLog and bugzilla are used
to track minor changes and issues.

Summary:
So far I have MinGW-w64 executables of Squid-3.5 that produce "Error
127". yay!. Any assistance figuring out what I have done wrong to get
that is welcome. So far I think its a missing DLL or wrong .exe
settings going into the compiler.

Visual Studio 2012 builds are also ongoing, but will not be available
until the Foundation provides an upstream git repository (being planned).

Personal donations welcome (<http://treenet.co.nz/projects/squid/>),
but due to the above error 127 I am disinclined to accept contracts
with anything like a deadline.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUNNstAAoJELJo5wb/XPRjN6IH/AhZf3+k0YizpxjmoyYh0E4/
AgbJ+fCtA/tvObKPN862xKQ/TCLnV9uOT/SFClf9Occ8fqJZex0ViNnIJiSrLaS7
7SP4/C58D4T8FV1331HZmh36q38ui+bHTVvRWDjz4J0CC9/pmKCI5nVvLW8KbjYC
T0ZhOBU2L7VZ3zUhwTsKKD0UfroMzRyzcipmRMysNXpfG/5unZb4XLfk/AQdWRqo
zpXV6vA7uJGQnZO9fnuMOOysG7UqmyydlFWAkwM9XL+7SJC9bCKmPk/T9+CIvRN7
31gbNdi3ZfyWSkgI9lp1UmNu1tV/G9CrnsCgDWGCswmEoy14fhvgy1cmYGZ2Wu8=
=vAWZ
-----END PGP SIGNATURE-----


From sudakov at sibptus.tomsk.ru  Wed Oct  8 08:15:56 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Wed, 8 Oct 2014 15:15:56 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <5434CDBA.40004@ngtech.co.il>
References: <20141006040725.GA31642@admin.sibptus.tomsk.ru>
 <20141006052346.GA32369@admin.sibptus.tomsk.ru>
 <20141007070403.GA57384@admin.sibptus.tomsk.ru>
 <20141007083542.GA60425@admin.sibptus.tomsk.ru>
 <m11nv3$nk8$1@ger.gmane.org>
 <20141008032925.GA77544@admin.sibptus.tomsk.ru>
 <5434CDBA.40004@ngtech.co.il>
Message-ID: <20141008081555.GA86719@admin.sibptus.tomsk.ru>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Eliezer Croitoru wrote:
> > 
> > I could find the said script neither in the source nor in the
> > binary package. However I think I can guess what could be inside.
> > Could you look below if that makes sense?
> 
> Or you can just look at the source code:
> http://bazaar.launchpad.net/~squid/squid/3.4/view/head:/helpers/negotiate_auth/kerberos/test_negotiate_auth.sh

So I was correct about the script contents. My command line 
$ ./negotiate_kerberos_auth_test proxy.sibptus.transneft.ru | awk '{sub(/Token:/,"YR"); print $0}END{print "QQ"}' | ./negotiate_kerberos_auth -d
does exactly the same.

Do you have any ideas about the cause of the kerberos error?

=====================
$ setenv KRB5_KTNAME /usr/local/etc/squid/squid.keytab
$ setenv KRB5_CONFIG /usr/local/etc/squid/krb5.conf
$ kdestroy
$ kinit sudakovva
sudakovva at SIBPTUS.TRANSNEFT.RU's Password:
$
$ klist
Credentials cache: FILE:/tmp/krb5cc_XZ1GPU
        Principal: sudakovva at SIBPTUS.TRANSNEFT.RU

  Issued           Expires          Principal
Oct  8 09:31:45  Oct  8 19:31:45  krbtgt/SIBPTUS.TRANSNEFT.RU at SIBPTUS.TRANSNEFT.RU

$ ./negotiate_kerberos_auth_test proxy.sibptus.transneft.ru | awk '{sub(/Token:/,"YR"); print $0}END{print "QQ"}' | ./negotiate_kerberos_auth -d

negotiate_kerberos_auth.cc(212): pid=52357 :2014/10/08 10:03:34| negotiate_kerberos_auth: INFO: Starting version 3.0.4sq
negotiate_kerberos_auth.cc(258): pid=52357 :2014/10/08 10:03:34| negotiate_kerberos_auth: DEBUG: Got 'YR YIIGFAYGKwYBBQUCoIIGCDCCBgSgDTALBgkqhkiG9xIBAgKiggXxBIIF7WCCBekGCSqGSIb3EgECAgEAboIF2DCCBdSgAwIBBaEDAgEOogcDBQAAAAAAo4IEvGGCBLgwggS0oAMCAQWhFhsUU0lCUFRVUy5UUkFOU05FRlQuUlWiLTAroAMCAQGhJDAiGwRIVFRQGxpwcm94eS5zaWJwdHVzLnRyYW5zbmVmdC5ydaOCBGQwggRgoAMCAReiggRXBIIEUxpOgFWeZoAcatE6l3MyfDxMoDMjcgYUQzenTLAlEvD3/c0pyRiitZwNMIHvnacXcUSTzLDNjDw75iwfNxZHYjZgvOLHSKQm+rmoWtLIC+3KZoeWCB+pxwcpK8RzXvs8dPCprH1h5OdCn8EB1ZZxl35IhLgg07N72yvnXNiBmW/PmLW6PeVB0U3SLjWiT0ZJ3kXukg5ViYGOMKypeHebHPB0FQ2dgNQy8S00CRIU4ZuoHPVWFNl6mzp9CoIy7Ytwhu3NRb42f49nuQpqBVcsMK/ckgLYvsoz2lYxe7AO4MMOvcGqnEBB/jaSfrGGXpw+ciMNbBtCHH7bN36uGHj+VWOUFL5vR3xclnOWwdUH2OtXqMMcDDnI4v7vNR1U80BS7SdXUpx0D+O1B3ihipaTpSkXtII5UTI4qxmZjXSQGYY0adbG/N6NpMF7HpmGb1Zondp571l4ZV0mZ0pZ7IcIAmvQOmcud/sN0am4z9Oe3lCe7L1RVKBr0Tu30Pz7ySibeCpY/OVR2GJ+ILfov/3o95ozW8W4d+UCHfywAHOioGB+QWSC2NO5VtcjsBYVkhKnBkcG8KOBhJ+qi1qvhGXD3tUgDZnb0pCQAVNyjiDIKZre8KcB23Hu5a2YCM9y0GiBCbfJIbD60LJLVOxozZiRqJfdOCvBhfCvh7R9y5EuNmMswSRgQJwhkh7rCgMPWvFsAWDae9yxN966E85nE+xuUtwtl20NhOjotjG3NgwsRYDg1kQvfJnz7IcPSnSevKiPHU7uvBxSZvR6j6J0BZRgTQg7loUzkOsSRPDefXMt4wFfoHEqaWTtKw3yR0dZkr1W5g6WDn0d0o4uLZRdZteMOtxjsXFTQA3MIQrf/BpVk0NdEQ0EpXo2SZtr+ciy2jNXI40s6rUQakV/vfLG5aGOQY1Ck1gynORrG6Bt/eDMVJF7gf8iEvSDPiZhaHNqfAwfuYDNcO6Sgvl21tkEUfC9YxzkZq2vb0J1gJnkoq3oay+B7GElpgBABZpf22eGTOHakz7m8z9jdPUuIGFf1Jgn1B4i2vFsYRV6tbn3gF/wpnBdPmmG0ZVT2ZnqPDf2Om3kh1cd/THIWDVeuvNGRHbzGYxFJcJ+NIgwr5yfijltcKyynGqHvW2arUQwHzX0UM/dg6iI8+o2IkKmihBL9WQ+04SwHYeMk+D1hJx2rfrIl9RgpQdkrhrjPacqGfKd7NrtEweeSn7MOwFjaVYlT4ruboQHt94BcJKQ1qhuJVsH+rhZaM6XBt6F2NtM5Z+0OmwsLb0sQkdVbnbyEku7McPN0vvOC7tuDL1pT0UuAanSO6IQahXj5X3W/MVNf27rJUmcUQkGbTvCK6nJMuZYNsuKaB9Izs10T/i88V5IOgafwAHgLCxnpwptY551gJwj/0cvv6mpIZSrE8XjMWMUDmeTkeUyU8t2Dz5Vjbb8l1cFCIETgvc5CK9mV+SG0F6soQqf1xs+r6SB/jCB+6ADAgEXooHzBIHwxdPbAIs5nPD2d3wOYONkgkc1qb9krxSlo4FRMoPPIl+80A1OZOlv/SRc9B4VpP8xJJvk1YwY70twgMlOJd/zbXH0lEnyGdGi9mUuN4XdfeNzFwqvjxOrx1e8oPXJPJLIZCGhUik3nY7X4Nb4EMXmfEckzSsuBbVKkVwu7/0xPKbXL4KPs/e3ANJI8Lvkh7AM7iIXrhI2S4/ZKWo4f73R1sjgtt+nw8e1Ga7EeMlQvbejo/i9UBEFldNR2B8GM0DD6449mRrbXE1K5Pij+bHoHl9oZng97DGGnM4ritsN+ts2Rcev1IuSzm6QFaADBwRU' from squid (length: 2083).
negotiate_kerberos_auth.cc(311): pid=52357 :2014/10/08 10:03:34| negotiate_kerberos_auth: DEBUG: Decode 'YIIGFAYGKwYBBQUCoIIGCDCCBgSgDTALBgkqhkiG9xIBAgKiggXxBIIF7WCCBekGCSqGSIb3EgECAgEAboIF2DCCBdSgAwIBBaEDAgEOogcDBQAAAAAAo4IEvGGCBLgwggS0oAMCAQWhFhsUU0lCUFRVUy5UUkFOU05FRlQuUlWiLTAroAMCAQGhJDAiGwRIVFRQGxpwcm94eS5zaWJwdHVzLnRyYW5zbmVmdC5ydaOCBGQwggRgoAMCAReiggRXBIIEUxpOgFWeZoAcatE6l3MyfDxMoDMjcgYUQzenTLAlEvD3/c0pyRiitZwNMIHvnacXcUSTzLDNjDw75iwfNxZHYjZgvOLHSKQm+rmoWtLIC+3KZoeWCB+pxwcpK8RzXvs8dPCprH1h5OdCn8EB1ZZxl35IhLgg07N72yvnXNiBmW/PmLW6PeVB0U3SLjWiT0ZJ3kXukg5ViYGOMKypeHebHPB0FQ2dgNQy8S00CRIU4ZuoHPVWFNl6mzp9CoIy7Ytwhu3NRb42f49nuQpqBVcsMK/ckgLYvsoz2lYxe7AO4MMOvcGqnEBB/jaSfrGGXpw+ciMNbBtCHH7bN36uGHj+VWOUFL5vR3xclnOWwdUH2OtXqMMcDDnI4v7vNR1U80BS7SdXUpx0D+O1B3ihipaTpSkXtII5UTI4qxmZjXSQGYY0adbG/N6NpMF7HpmGb1Zondp571l4ZV0mZ0pZ7IcIAmvQOmcud/sN0am4z9Oe3lCe7L1RVKBr0Tu30Pz7ySibeCpY/OVR2GJ+ILfov/3o95ozW8W4d+UCHfywAHOioGB+QWSC2NO5VtcjsBYVkhKnBkcG8KOBhJ+qi1qvhGXD3tUgDZnb0pCQAVNyjiDIKZre8KcB23Hu5a2YCM9y0GiBCbfJIbD60LJLVOxozZiRqJfdOCvBhfCvh7R9y5EuNmMswSRgQJwhkh7rCgMPWvFsAWDae9yxN966E85nE+xuUtwtl20NhOjotjG3NgwsRYDg1kQvfJnz7IcPSnSevKiPHU7uvBxSZvR6j6J0BZRgTQg7loUzkOsSRPDefXMt4wFfoHEqaWTtKw3yR0dZkr1W5g6WDn0d0o4uLZRdZteMOtxjsXFTQA3MIQrf/BpVk0NdEQ0EpXo2SZtr+ciy2jNXI40s6rUQakV/vfLG5aGOQY1Ck1gynORrG6Bt/eDMVJF7gf8iEvSDPiZhaHNqfAwfuYDNcO6Sgvl21tkEUfC9YxzkZq2vb0J1gJnkoq3oay+B7GElpgBABZpf22eGTOHakz7m8z9jdPUuIGFf1Jgn1B4i2vFsYRV6tbn3gF/wpnBdPmmG0ZVT2ZnqPDf2Om3kh1cd/THIWDVeuvNGRHbzGYxFJcJ+NIgwr5yfijltcKyynGqHvW2arUQwHzX0UM/dg6iI8+o2IkKmihBL9WQ+04SwHYeMk+D1hJx2rfrIl9RgpQdkrhrjPacqGfKd7NrtEweeSn7MOwFjaVYlT4ruboQHt94BcJKQ1qhuJVsH+rhZaM6XBt6F2NtM5Z+0OmwsLb0sQkdVbnbyEku7McPN0vvOC7tuDL1pT0UuAanSO6IQahXj5X3W/MVNf27rJUmcUQkGbTvCK6nJMuZYNsuKaB9Izs10T/i88V5IOgafwAHgLCxnpwptY551gJwj/0cvv6mpIZSrE8XjMWMUDmeTkeUyU8t2Dz5Vjbb8l1cFCIETgvc5CK9mV+SG0F6soQqf1xs+r6SB/jCB+6ADAgEXooHzBIHwxdPbAIs5nPD2d3wOYONkgkc1qb9krxSlo4FRMoPPIl+80A1OZOlv/SRc9B4VpP8xJJvk1YwY70twgMlOJd/zbXH0lEnyGdGi9mUuN4XdfeNzFwqvjxOrx1e8oPXJPJLIZCGhUik3nY7X4Nb4EMXmfEckzSsuBbVKkVwu7/0xPKbXL4KPs/e3ANJI8Lvkh7AM7iIXrhI2S4/ZKWo4f73R1sjgtt+nw8e1Ga7EeMlQvbejo/i9UBEFldNR2B8GM0DD6449mRrbXE1K5Pij+bHoHl9oZng97DGGnM4ritsN+ts2Rcev1IuSzm6QFaADBwRU' (decoded length: 1560).
negotiate_kerberos_auth.cc(128): pid=52357 :2014/10/08 10:03:34| negotiate_kerberos_auth: ERROR: gss_acquire_cred() failed:  No credentials were supplied, or the credentials were unavailable or inaccessible.. unknown mech-code 0 for mech unknown
BH gss_acquire_cred() failed:  No credentials were supplied, or the credentials were unavailable or inaccessible.. unknown mech-code 0 for mech unknown
negotiate_kerberos_auth.cc(258): pid=52357 :2014/10/08 10:03:34| negotiate_kerberos_auth: DEBUG: Got 'QQ' from squid (length: 2).
BH quit command

$ klist -v
Credentials cache: FILE:/tmp/krb5cc_XZ1GPU
        Principal: sudakovva at SIBPTUS.TRANSNEFT.RU
    Cache version: 4

Server: krbtgt/SIBPTUS.TRANSNEFT.RU at SIBPTUS.TRANSNEFT.RU
Client: sudakovva at SIBPTUS.TRANSNEFT.RU
Ticket etype: arcfour-hmac-md5
Ticket length: 1128
Auth time:  Oct  8 10:00:12 2014
End time:   Oct  8 20:00:12 2014
Ticket flags: initial, pre-authenticated
Addresses: addressless

Server: HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
Client: sudakovva at SIBPTUS.TRANSNEFT.RU
Ticket etype: arcfour-hmac-md5
Ticket length: 1212
Auth time:  Oct  8 10:00:12 2014
Start time: Oct  8 10:00:16 2014
End time:   Oct  8 20:00:12 2014
Ticket flags: pre-authenticated
Addresses: addressless

$
$  ktutil list
/usr/local/etc/squid/squid.keytab:

Vno  Type                     Principal
  1  des-cbc-crc              HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  des-cbc-md5              HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  arcfour-hmac-md5         HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  aes256-cts-hmac-sha1-96  HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  aes128-cts-hmac-sha1-96  HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU

=====================

- -- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUNPK7AAoJEA2k8lmbXsY05yUH/jduGAOfE5WXp36+F+U7/kbI
NUxYgj/tKPFUHWLiC7WCAfmCpVzXhFGL9vTLzCupZsYTe0N/h1BFLpV0yTcmgFbs
JkwuiCb3q5orcKAbWs6T2xEr9hLM7twRA8ksPWgdm1dXOw8FsrkuUnloDUi8Ikil
L5sWPRiRCJlDvwiGjM/CH1fDkLHaM5k0INnqk4VukGjXYKhg70alwq1ZWF+jnPEy
IsGfxuVtIrUG+d+7KEv6bQ+Ts5JJ1LSxp9i7eSb0LvTp5mKPIEpffkAGvqEcxW9u
ZyENqikgLxnpUJTkMvSeJkXHPbSorzvkDXYzgs9LgwNGlSbQc7p/x8rSUQypNuk=
=+oGT
-----END PGP SIGNATURE-----


From tomtux007 at gmail.com  Wed Oct  8 13:09:59 2014
From: tomtux007 at gmail.com (Tom Tom)
Date: Wed, 8 Oct 2014 15:09:59 +0200
Subject: [squid-users] TCP_DENIED/403 after Upgrading from 3.4.4 to
	3.4.7 (ssl_bump enabled)
In-Reply-To: <CACLJR+M4J_zUyQM-i_1jQ-MknxSTz8ZsjadLAyNOpjbTdUCJbg@mail.gmail.com>
References: <CACLJR+M4J_zUyQM-i_1jQ-MknxSTz8ZsjadLAyNOpjbTdUCJbg@mail.gmail.com>
Message-ID: <CACLJR+MGYogR-vJArRHVwHe=-XozFJs=4J6U5FdtaiCOUao0PQ@mail.gmail.com>

I think, this behaviour was introduced with squid 3.4.4.1
(http://www.squid-cache.org/Versions/v3/3.4/changesets/squid-3.4-13113.patch).

I don't exactly understand this behaviour.
Any hints for this?

Thanks a lot.
Kind regards,
Tom

On Mon, Oct 6, 2014 at 11:59 AM, Tom Tom <tomtux007 at gmail.com> wrote:
> Hi
>
> After upgrading squid 3.4.4 to 3.4.7 (64Bit, self-compiled, the same
> configure-options, the same config-file, ssl_bump with "ssl_bump
> server-first all" enabled), I'm no more able to access bumped
> https-sites because of a TCP_DENIED/403.
>
>
> #---------------------- relevant parts of squid.conf ----------------------#
> auth_param negotiate program /usr/local/squid/libexec/
> negotiate_kerberos_auth
> auth_param negotiate children 50 startup=10 idle=5
> auth_param negotiate keep_alive on
> acl AUTHENTICATED proxy_auth REQUIRED
>
> external_acl_type SQUID_KERB_LDAP ttl=7200 children-max=50
> children-startup=20 children-idle=5 negative_ttl=7200 %LOGIN
> /usr/local/squid/libexec/ext_kerberos_ldap_group_acl -g "Internet
> Users"
> acl INTERNET_ACCESS external SQUID_KERB_LDAP
> acl DENY_USERS_LOCAL proxy_auth_regex -i "/etc/squid/DENY_USERS_LOCAL"
> ...
> ...
> http_access deny DENY_USERS_LOCAL all
> http_access deny !INTERNET_ACCESS all
> http_access deny !AUTHENTICATED all
> http_access allow INTERNET_ACCESS AUTHENTICATED
> http_access deny all
> #---------------------- relevant parts of squid.conf ----------------------#
>
> The meaning of the "DENY_USERS_LOCAL"-file is to insert all users (by
> AD-username), which shouldn't have internet-access. In squid 3.4.4, I
> had no restrictions with this directive. After upgrading to 3.4.7 (the
> same config as in 3.4.4), I always catch a TCP_DENIED/403. The
> cache.log with debug actived looks like this:
>
> #---------------------- cache.log ----------------------#
> 2014/09/09 14:35:24.539 kid2| Acl.cc(177) matches: checked: http_access#4 = 0
> 2014/09/09 14:35:24.540 kid2| Acl.cc(157) matches: checking http_access#5
> 2014/09/09 14:35:24.540 kid2| Acl.cc(157) matches: checking DENY_USERS_LOCAL
> 2014/09/09 14:35:24.540 kid2| Acl.cc(28) AuthenticateAcl: SslBumped
> request: It is an  encapsulated request do not authenticate
> 2014/09/09 14:35:24.540 kid2| Acl.cc(177) matches: checked: DENY_USERS_LOCAL = 1
> 2014/09/09 14:35:24.540 kid2| Acl.cc(177) matches: checked: http_access#5 = 1
> 2014/09/09 14:35:24.540 kid2| Acl.cc(177) matches: checked: http_access = 1
> 2014/09/09 14:35:24.540 kid2| Checklist.cc(55) markFinished: 0x27cfb98
> answer DENIED for match
> 2014/09/09 14:35:24.540 kid2| Checklist.cc(155) checkCallback:
> ACLChecklist::checkCallback: 0x27cfb98 answer=DENIED
> #---------------------- cache.log ----------------------#
>
>
> The file "DENY_USERS_LOCAL" is actual empty. Why does squid in the
> 3.4.7er version blocks me with the "http_access deny DENY_USERS_LOCAL"?
> What changed hereby in the current version? How can I enforce the "old
> behaviour" (like 3.4.4)?
>
> Many thanks.
>
> Kind regards,
> Tom


From squid3 at treenet.co.nz  Wed Oct  8 14:05:20 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 09 Oct 2014 03:05:20 +1300
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <54340958.6070601@opendium.com>
References: <20140928062806.GA34166@admin.sibptus.tomsk.ru>
 <5427B9EC.6060500@ngtech.co.il> <5429209D.1050909@opendium.com>
 <542ABA7F.6010401@treenet.co.nz> <542AC54C.408@opendium.com>
 <542AC87D.7040806@treenet.co.nz> <54340958.6070601@opendium.com>
Message-ID: <543544A0.1080301@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 8/10/2014 4:40 a.m., Steve Hill wrote:
> On 30.09.14 16:13, Amos Jeffries wrote:
> 
>>> I'm trying to figure out if there's a way of convincing
>>> valgrind to dump info about all the currently allocated memory
>>> while the program is still running - there would be a lot of
>>> legitimate stuff in the report, but hopefully a few hundred MB
>>> of memory that shouldn't be there would stick out like a sore
>>> thumb.
>> 
>> That would be lovely. If you can find it I'd like to know too
>> :-)
> 
> su -s /bin/bash squid valgrind --vgdb=full --error-limit=no
> --tool=memcheck --leak-check=full --show-reachable=yes
> --leak-resolution=high --num-callers=40 squid -f 
> /etc/squid/squid.conf -N
> 
> Do whatever you need to do to trigger a leak, then in another
> window: su -s /bin/bash squid gdb squid
> 
> At the gdb prompt: target remote | vgdb set logging file
> /tmp/leaks.txt set logging on monitor leak_check full reachable
> any
> 
> This will dump out all the currently allocated memory to the
> console (and to /tmp/leaks.txt).
> 

Thanks.

New patch added to bug 4088. Please see if it resolves the
external_acl_type leak.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUNUSgAAoJELJo5wb/XPRjUTEH/A95Za6+QjzMwn2kSIkmHF2E
FzEOPmC0t73lsHmVJptFnblsA2sKWgDokg+NRM1LISdLtx7EZ9aRN+8cQBBdCBnN
AXuSz0nWUkI2ugPw6A5YOX70YEwwmkXiG52honyvmUsC0wyj5aBiAeNRZLfy5ZVo
V1uSccJTeavrGPKgB5xrFVVEyF5oSMwxeM3Zu+lukgWKWHcIeSyFV2IJkvpG/Q/E
U4JdLcWu3PjoZGQzHPIVGn0t+EaN9qVRDyq+p6E/weLvUhQqSi33qGJIoiZz7dbv
9zSEKegDv6+OGw4P8uEVzxebWSTCcr7NbYk/cUzMfg7fCp9zYed3MZL235O8JcM=
=SlNr
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Wed Oct  8 14:21:46 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 09 Oct 2014 03:21:46 +1300
Subject: [squid-users] TCP_DENIED/403 after Upgrading from 3.4.4 to
 3.4.7 (ssl_bump enabled)
In-Reply-To: <CACLJR+MGYogR-vJArRHVwHe=-XozFJs=4J6U5FdtaiCOUao0PQ@mail.gmail.com>
References: <CACLJR+M4J_zUyQM-i_1jQ-MknxSTz8ZsjadLAyNOpjbTdUCJbg@mail.gmail.com>
 <CACLJR+MGYogR-vJArRHVwHe=-XozFJs=4J6U5FdtaiCOUao0PQ@mail.gmail.com>
Message-ID: <5435487A.5090302@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 9/10/2014 2:09 a.m., Tom Tom wrote:
> I think, this behaviour was introduced with squid 3.4.4.1 
> (http://www.squid-cache.org/Versions/v3/3.4/changesets/squid-3.4-13113.patch).
>
>  I don't exactly understand this behaviour. Any hints for this?

Aha. I am guessing it is a combination of:
 * the previous ssl-bumped traffic was brokenly finding "invalid"
credentials
 * an "empty" regex actually contains .* (is matching anything valid).

Meaning previously the "invalid" credentials would prevent the regex
being even attempted. Now that the credentials validity is fixed the
regex tests out and matches.

Try putting a single entry of "-" in /etc/squid/DENY_USERS_LOCAL.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUNUh6AAoJELJo5wb/XPRjiB8H/25Xb0JN+C2cSUCr09giKZxq
TdjprcHDeTYbJ9/MyRXsN1ZOmGyBP5XF3629+9fblhoqvCgutO2jb0kHbsrV1v9m
CDfs6MhsSF2AEN5tR/4H6ZIKeajBfHZMMsCOhM7BJmajXyhF89T5K2ir4GDuKI2U
9B+6lhuvFxqae8GyGGS2X5//LHpOmej4+Ny8GpY+6F1lLaen/X3prH6qP+2aipNx
jIOiN3kRrGbOACU+KJXyRJpzoCvz0xt9KtBsbQNA5z6W6fs6MhunuLhYve0r1f7n
UxTBTu0OcbI8RrdA9R8fCHgKxRkBwHyT6G/domxIZrGwe8b5r2Xl8F0zzdsSN1I=
=ojpT
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Wed Oct  8 14:26:41 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 09 Oct 2014 03:26:41 +1300
Subject: [squid-users] TCP_DENIED/403 after Upgrading from 3.4.4 to
 3.4.7 (ssl_bump enabled)
In-Reply-To: <5435487A.5090302@treenet.co.nz>
References: <CACLJR+M4J_zUyQM-i_1jQ-MknxSTz8ZsjadLAyNOpjbTdUCJbg@mail.gmail.com>
 <CACLJR+MGYogR-vJArRHVwHe=-XozFJs=4J6U5FdtaiCOUao0PQ@mail.gmail.com>
 <5435487A.5090302@treenet.co.nz>
Message-ID: <543549A1.1070700@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 9/10/2014 3:21 a.m., Amos Jeffries wrote:
> On 9/10/2014 2:09 a.m., Tom Tom wrote:
>> I think, this behaviour was introduced with squid 3.4.4.1 
>> (http://www.squid-cache.org/Versions/v3/3.4/changesets/squid-3.4-13113.patch).
>
>>  I don't exactly understand this behaviour. Any hints for this?
> 
> Aha. I am guessing it is a combination of: * the previous
> ssl-bumped traffic was brokenly finding "invalid" credentials * an
> "empty" regex actually contains .* (is matching anything valid).
> 
> Meaning previously the "invalid" credentials would prevent the
> regex being even attempted. Now that the credentials validity is
> fixed the regex tests out and matches.
> 
> Try putting a single entry of "-" in /etc/squid/DENY_USERS_LOCAL.

Actually that would match any users with hyphen in their username.

For production use, if the experiment above actually works, use ^root$
or another username shich will never be assigned with explicit start
and end anchors.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUNUmhAAoJELJo5wb/XPRjxUwH/3Y3gDn7Cbt4ikAFyhAq+BlJ
tnvu2lC/WK5et8aWSsGGUtxDcOZtJoW9hYGWVIJs7wukqMlldvH7oWdGpJ/pS4tQ
KVpABF55n0Kt1ayRTpHzoE6eNDgVZt5lMcUk1OJnjW/wbibC5n6+BpBwyjg+Hf1X
StvV6y99kMvqWkHNgBYcwLXblV83GdtnX5xmCV6CnPZSry50bMc+m/4fiLSJojvG
unCMccmkw09697sPzJvZRe0CZbq8r3TRLfGJQEYqVem2FumpCoPQVDHIk82Q0B/y
nyMHOndz5PVnYr9VpuYy7pVokA74jJ5HstLVQsIW/i1TMjarUP/1dFYpG8sEDL4=
=/mvM
-----END PGP SIGNATURE-----


From mirza.dedic at outlook.com  Wed Oct  8 15:19:29 2014
From: mirza.dedic at outlook.com (Mirza Dedic)
Date: Wed, 8 Oct 2014 08:19:29 -0700
Subject: [squid-users] Squid 2.7 STABLE8 (Win2008) can't get my MS Lync
 2013 to work?
In-Reply-To: <5434DB2D.6080705@treenet.co.nz>
References: <BAY181-W940DC82E91699617FA5A9F0A20@phx.gbl>,
 <54345EFD.7040202@ngtech.co.il>
 <BAY181-W61EF839967043531882833F0A20@phx.gbl>, <54346D5A.5050809@ngtech.co.il>,
 <BAY405-EAS241813461A14B5D530D6897F0A20@phx.gbl>,
 <5434DB2D.6080705@treenet.co.nz>
Message-ID: <BAY181-W10622B73CAF28702B792D1F0A30@phx.gbl>

Thanks Amos,
It seems I spoke too fast, the proxy prompt is back, so disabling SG didn't do the trick.
Two two hits I see in access.log are:
1412778349.755    141 172.16.12.110 TCP_MISS/200 462 POST http://sqm.microsoft.com/sqm/wm/sqmserver.dll - DIRECT/65.55.7.141 -1412778349.911    515 172.16.12.110 TCP_MISS/200 11695 CONNECT login.microsoftonline.com:443 - DIRECT/157.55.208.198 -
These happen when I restart the Lync program and at the time of the proxy prompt.
My config file is here: http://pastebin.com/MSsTWum2
I spent last night trying to mess with cygwin + squid to try and tackle this issue by upgrading to a more supported squid, I see there is a 3.3.3 published in their repository; I got this working at home (squid starts) on Windows 7 machine however getting errors trying to start the same cygwin setup on my win2003 remote server, getting..
2014/10/08 08:12:56| aclIpParseIpData: Bad host/IP: '::1' in '::1', flags=0 : (8) Name or service not knownFATAL: Bungled Default Configuration line 11: acl localhost src 127.0.0.1/32 ::1Squid Cache (Version 3.3.3): Terminated abnormally.
My cygwin squid.conf is similar to 2.7, except a few changes.. http://pastebin.com/BrCG8yHL
I am confused because no where is acl loclahost src defined in my config, and I tried starting squid with -f to make sure I am reading in the correct squid.conf file.
Figured i'd try the cygwin+squid route to get a more supported version going, but I am having issues starting it in my Win2003 box (the box has multiple network cards, so don't know if that has anything to do with it?).
> Date: Wed, 8 Oct 2014 19:35:25 +1300
> From: squid3 at treenet.co.nz
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] Squid 2.7 STABLE8 (Win2008) can't get my MS Lync 2013 to work?
> 
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> On 8/10/2014 12:17 p.m., Mirza Dedic wrote:
> > Hi Eliezer,
> > 
> > After I commented out the SquidGuard part of the config and
> > restarted squid I restart my Lync 2013 client and it connects
> > without a proxy prompt, in the log I still see the " 1412723608.354
> > 485 172.16.12.110 TCP_MISS/200 11695 CONNECT
> > login.microsoftonline.com:443 - DIRECT/65.52.244.66 -" but no
> > proxy on the client's side.
> > 
> > So, something in SquidGuard must be causing this??
> 
> Yes several things. Basically SG does not contain all of the hacks and
> disablings necessary to cope with demands NTLM places on HTTP proxies.
> Which is reasonable since its design goal is to filter HTTP traffic.
> 
> > 
> > I did not want to uncomment the NTLM because we use this to provide
> > seamless authentication for the clients, if we only allow basic it
> > will prompt for user/pass won't it?
> > 
> > We use SquidGuard as it has a pre-defined list of blocked sites, so
> > it was a quick way to add a set of blocked sites.. but this whole
> > setup is old I don't even know where the win32 binaries came from
> > for squidguard..
> 
> In which case there should be no need for you to have SG at all.
> 
> The popular blocklist/blacklist sources for SG also provide Squid
> format downloads of the same lists, or converters are easily written.
> https://www.google.com/search?q=squid+blacklist
> 
> 
> > 
> > You mentioned a 3.x being developed for Windows, is this internal
> > only or somewhere I can follow the progress?
> 
> I am the one driving that effort at present. It is a side hobby on my
> overall goal of feature parity between Squid-2 and Squid-3 - keeping
> Squid building and running on any OS Squid-2 was useful for.
> 
> The official state of Squid on Windows is documented in here:
> http://wiki.squid-cache.org/KnowledgeBase/Windows
> the newest bits are down under "Porting Efforts" for now.
> 
> Changes as they are found are being applied directly on the mainstream
> 3.HEAD version. So the regular 3.HEAD ChangeLog and bugzilla are used
> to track minor changes and issues.
> 
> Summary:
> So far I have MinGW-w64 executables of Squid-3.5 that produce "Error
> 127". yay!. Any assistance figuring out what I have done wrong to get
> that is welcome. So far I think its a missing DLL or wrong .exe
> settings going into the compiler.
> 
> Visual Studio 2012 builds are also ongoing, but will not be available
> until the Foundation provides an upstream git repository (being planned).
> 
> Personal donations welcome (<http://treenet.co.nz/projects/squid/>),
> but due to the above error 127 I am disinclined to accept contracts
> with anything like a deadline.
> 
> Amos
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2.0.22 (MingW32)
> 
> iQEcBAEBAgAGBQJUNNstAAoJELJo5wb/XPRjN6IH/AhZf3+k0YizpxjmoyYh0E4/
> AgbJ+fCtA/tvObKPN862xKQ/TCLnV9uOT/SFClf9Occ8fqJZex0ViNnIJiSrLaS7
> 7SP4/C58D4T8FV1331HZmh36q38ui+bHTVvRWDjz4J0CC9/pmKCI5nVvLW8KbjYC
> T0ZhOBU2L7VZ3zUhwTsKKD0UfroMzRyzcipmRMysNXpfG/5unZb4XLfk/AQdWRqo
> zpXV6vA7uJGQnZO9fnuMOOysG7UqmyydlFWAkwM9XL+7SJC9bCKmPk/T9+CIvRN7
> 31gbNdi3ZfyWSkgI9lp1UmNu1tV/G9CrnsCgDWGCswmEoy14fhvgy1cmYGZ2Wu8=
> =vAWZ
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141008/b63c8d8d/attachment.htm>

From mirza.dedic at outlook.com  Wed Oct  8 15:25:30 2014
From: mirza.dedic at outlook.com (Mirza Dedic)
Date: Wed, 8 Oct 2014 08:25:30 -0700
Subject: [squid-users] Squid 2.7 STABLE8 (Win2008) can't get my MS Lync
 2013 to work?
In-Reply-To: <BAY181-W10622B73CAF28702B792D1F0A30@phx.gbl>
References: <BAY181-W940DC82E91699617FA5A9F0A20@phx.gbl>, ,
 <54345EFD.7040202@ngtech.co.il>, <BAY181-W61EF839967043531882833F0A20@phx.gbl>,
 <54346D5A.5050809@ngtech.co.il>, ,
 <BAY405-EAS241813461A14B5D530D6897F0A20@phx.gbl>, ,
 <5434DB2D.6080705@treenet.co.nz>,
 <BAY181-W10622B73CAF28702B792D1F0A30@phx.gbl>
Message-ID: <BAY181-W43FB3A553E875044412C93F0A30@phx.gbl>

Squid Cache v3.3.3 included in cygwin was ./configured with:
$ ./squid -vSquid Cache: Version 3.3.3 '--srcdir=/usr/src/ports/squid/squid-3.3.3-2.i686/src/squid-3.3.3' '--prefix=/usr' '--exec-prefix=/usr' '--bindir=/usr/bin' '--sbindir=/usr/sbin' '--libexecdir=/usr/libexec' '--datadir=/usr/share' '--localstatedir=/var' '--sysconfdir=/etc' '--libdir=/usr/lib' '--datarootdir=/usr/share' '--docdir=/usr/share/doc/squid' '--htmldir=/usr/share/doc/squid/html' '-C' '--sysconfdir=/etc/squid' '--datadir=/usr/share/squid' '--libexecdir=/usr/lib/squid' '--disable-strict-error-checking' '--with-logdir=/var/log/squid' '--with-swapdir=/var/cache/squid' '--with-pidfile=/var/run/squid.pid' '--enable-ssl' '--enable-esi' '--enable-disk-io=AIO,Blocking,DiskThreads,IpcIo,Mmapped' '--enable-auth-basic=DB,LDAP,MSNT,MSNT-multi-domain,NCSA,POP3,RADIUS,SASL,SMB,fake,getpwnam' '--enable-auth-ntlm=fake,smb_lm' '--enable-auth-negotiate=kerberos,wrapper' '--enable-external-acl-helpers=LDAP_group,SQL_session,eDirectory_userip,file_userip,kerberos_ldap_group,session,time_quota,unix_group,wbinfo_group' '--with-filedescriptors=3072' 'CC=gcc' 'CFLAGS=-ggdb -O2 -pipe -Wimplicit-function-declaration -fdebug-prefix-map=/usr/src/ports/squid/squid-3.3.3-2.i686/build=/usr/src/debug/squid-3.3.3-2 -fdebug-prefix-map=/usr/src/ports/squid/squid-3.3.3-2.i686/src/squid-3.3.3=/usr/src/debug/squid-3.3.3-2' 'LDFLAGS=' 'LIBS=''CPPFLAGS=''CXX=g++''CXXFLAGS=-ggdb -O2 -pipe -fdebug-prefix-map=/usr/src/ports/squid/squid-3.3.3-2.i686/build=/usr/src/debug/squid-3.3.3-2 -fdebug-prefix-map=/usr/src/ports/squid/squid-3.3.3-2.i686/src/squid-3.3.3=/usr/src/debug/squid-3.3.3-2'
Running squid -X log is here: http://pastebin.com/7f5U4k9W
From: mirza.dedic at outlook.com
To: squid3 at treenet.co.nz; squid-users at lists.squid-cache.org
Date: Wed, 8 Oct 2014 08:19:29 -0700
Subject: Re: [squid-users] Squid 2.7 STABLE8 (Win2008) can't get my MS Lync 2013 to work?




Thanks Amos,
It seems I spoke too fast, the proxy prompt is back, so disabling SG didn't do the trick.
Two two hits I see in access.log are:
1412778349.755    141 172.16.12.110 TCP_MISS/200 462 POST http://sqm.microsoft.com/sqm/wm/sqmserver.dll - DIRECT/65.55.7.141 -1412778349.911    515 172.16.12.110 TCP_MISS/200 11695 CONNECT login.microsoftonline.com:443 - DIRECT/157.55.208.198 -
These happen when I restart the Lync program and at the time of the proxy prompt.
My config file is here: http://pastebin.com/MSsTWum2
I spent last night trying to mess with cygwin + squid to try and tackle this issue by upgrading to a more supported squid, I see there is a 3.3.3 published in their repository; I got this working at home (squid starts) on Windows 7 machine however getting errors trying to start the same cygwin setup on my win2003 remote server, getting..
2014/10/08 08:12:56| aclIpParseIpData: Bad host/IP: '::1' in '::1', flags=0 : (8) Name or service not knownFATAL: Bungled Default Configuration line 11: acl localhost src 127.0.0.1/32 ::1Squid Cache (Version 3.3.3): Terminated abnormally.
My cygwin squid.conf is similar to 2.7, except a few changes.. http://pastebin.com/BrCG8yHL
I am confused because no where is acl loclahost src defined in my config, and I tried starting squid with -f to make sure I am reading in the correct squid.conf file.
Figured i'd try the cygwin+squid route to get a more supported version going, but I am having issues starting it in my Win2003 box (the box has multiple network cards, so don't know if that has anything to do with it?).
> Date: Wed, 8 Oct 2014 19:35:25 +1300
> From: squid3 at treenet.co.nz
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] Squid 2.7 STABLE8 (Win2008) can't get my MS Lync 2013 to work?
> 
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> On 8/10/2014 12:17 p.m., Mirza Dedic wrote:
> > Hi Eliezer,
> > 
> > After I commented out the SquidGuard part of the config and
> > restarted squid I restart my Lync 2013 client and it connects
> > without a proxy prompt, in the log I still see the " 1412723608.354
> > 485 172.16.12.110 TCP_MISS/200 11695 CONNECT
> > login.microsoftonline.com:443 - DIRECT/65.52.244.66 -" but no
> > proxy on the client's side.
> > 
> > So, something in SquidGuard must be causing this??
> 
> Yes several things. Basically SG does not contain all of the hacks and
> disablings necessary to cope with demands NTLM places on HTTP proxies.
> Which is reasonable since its design goal is to filter HTTP traffic.
> 
> > 
> > I did not want to uncomment the NTLM because we use this to provide
> > seamless authentication for the clients, if we only allow basic it
> > will prompt for user/pass won't it?
> > 
> > We use SquidGuard as it has a pre-defined list of blocked sites, so
> > it was a quick way to add a set of blocked sites.. but this whole
> > setup is old I don't even know where the win32 binaries came from
> > for squidguard..
> 
> In which case there should be no need for you to have SG at all.
> 
> The popular blocklist/blacklist sources for SG also provide Squid
> format downloads of the same lists, or converters are easily written.
> https://www.google.com/search?q=squid+blacklist
> 
> 
> > 
> > You mentioned a 3.x being developed for Windows, is this internal
> > only or somewhere I can follow the progress?
> 
> I am the one driving that effort at present. It is a side hobby on my
> overall goal of feature parity between Squid-2 and Squid-3 - keeping
> Squid building and running on any OS Squid-2 was useful for.
> 
> The official state of Squid on Windows is documented in here:
> http://wiki.squid-cache.org/KnowledgeBase/Windows
> the newest bits are down under "Porting Efforts" for now.
> 
> Changes as they are found are being applied directly on the mainstream
> 3.HEAD version. So the regular 3.HEAD ChangeLog and bugzilla are used
> to track minor changes and issues.
> 
> Summary:
> So far I have MinGW-w64 executables of Squid-3.5 that produce "Error
> 127". yay!. Any assistance figuring out what I have done wrong to get
> that is welcome. So far I think its a missing DLL or wrong .exe
> settings going into the compiler.
> 
> Visual Studio 2012 builds are also ongoing, but will not be available
> until the Foundation provides an upstream git repository (being planned).
> 
> Personal donations welcome (<http://treenet.co.nz/projects/squid/>),
> but due to the above error 127 I am disinclined to accept contracts
> with anything like a deadline.
> 
> Amos
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2.0.22 (MingW32)
> 
> iQEcBAEBAgAGBQJUNNstAAoJELJo5wb/XPRjN6IH/AhZf3+k0YizpxjmoyYh0E4/
> AgbJ+fCtA/tvObKPN862xKQ/TCLnV9uOT/SFClf9Occ8fqJZex0ViNnIJiSrLaS7
> 7SP4/C58D4T8FV1331HZmh36q38ui+bHTVvRWDjz4J0CC9/pmKCI5nVvLW8KbjYC
> T0ZhOBU2L7VZ3zUhwTsKKD0UfroMzRyzcipmRMysNXpfG/5unZb4XLfk/AQdWRqo
> zpXV6vA7uJGQnZO9fnuMOOysG7UqmyydlFWAkwM9XL+7SJC9bCKmPk/T9+CIvRN7
> 31gbNdi3ZfyWSkgI9lp1UmNu1tV/G9CrnsCgDWGCswmEoy14fhvgy1cmYGZ2Wu8=
> =vAWZ
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
 		 	   		  

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141008/23d5b5d8/attachment.htm>

From steve at opendium.com  Wed Oct  8 15:40:58 2014
From: steve at opendium.com (Steve Hill)
Date: Wed, 08 Oct 2014 16:40:58 +0100
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <543544A0.1080301@treenet.co.nz>
References: <20140928062806.GA34166@admin.sibptus.tomsk.ru>
 <5427B9EC.6060500@ngtech.co.il> <5429209D.1050909@opendium.com>
 <542ABA7F.6010401@treenet.co.nz> <542AC54C.408@opendium.com>
 <542AC87D.7040806@treenet.co.nz> <54340958.6070601@opendium.com>
 <543544A0.1080301@treenet.co.nz>
Message-ID: <54355B0A.20407@opendium.com>

On 08.10.14 15:05, Amos Jeffries wrote:

> New patch added to bug 4088. Please see if it resolves the
> external_acl_type leak.

Seems to fix the problem - thank you!

-- 
  - Steve Hill
    Technical Director
    Opendium Limited     http://www.opendium.com

Direct contacts:
    Instant messager: xmpp:steve at opendium.com
    Email:            steve at opendium.com
    Phone:            sip:steve at opendium.com

Sales / enquiries contacts:
    Email:            sales at opendium.com
    Phone:            +44-1792-824568 / sip:sales at opendium.com

Support contacts:
    Email:            support at opendium.com
    Phone:            +44-1792-825748 / sip:support at opendium.com


From paullus325 at gmail.com  Wed Oct  8 17:13:19 2014
From: paullus325 at gmail.com (Paull M)
Date: Wed, 8 Oct 2014 20:13:19 +0300
Subject: [squid-users] Check is parent available does not work
Message-ID: <CAP4H7C_8rTxS-Ab-=eu_SCJouxt1QV2jsQYpacSKJ-XvQ2fDnQ@mail.gmail.com>

Hello,
I have squid configured to forward requests to two parents, like following:
cache_peer host1 XXX YYY proxy-only weighted-round-robin weight=1
cache_peer host2 ZZZ BBB  proxy-only weighted-round-robin weight=1
But when one of parents is not available squid can't determine that it's
down and still redirect to down host.
In cache.log i see:
neighbourUp: neighbourUp: UP host2:BBB
But squid service is stoped on host2.
I was trying different configuration directives for cache_peer but without
any luck. After that I started debuger and after hours I really cant
understand in which case squid will check parent for arability...

--
Squid Cache: Version 3.3.13
OpenSUSE 13.1
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141008/72f909fe/attachment.htm>

From tomtux007 at gmail.com  Wed Oct  8 18:16:47 2014
From: tomtux007 at gmail.com (Tom Tom)
Date: Wed, 8 Oct 2014 20:16:47 +0200
Subject: [squid-users] TCP_DENIED/403 after Upgrading from 3.4.4 to
 3.4.7 (ssl_bump enabled)
In-Reply-To: <543549A1.1070700@treenet.co.nz>
References: <CACLJR+M4J_zUyQM-i_1jQ-MknxSTz8ZsjadLAyNOpjbTdUCJbg@mail.gmail.com>
 <CACLJR+MGYogR-vJArRHVwHe=-XozFJs=4J6U5FdtaiCOUao0PQ@mail.gmail.com>
 <5435487A.5090302@treenet.co.nz> <543549A1.1070700@treenet.co.nz>
Message-ID: <CACLJR+ONhco_QRz+7jk=LXUdL0DA3BpPA5gzSyq3cJ5NGJH7wg@mail.gmail.com>

I still get a TCP_DENIED/403 while accessing a bumped https-site after
putting a "-" or even "^root$" in /etc/squid/DENY_USERS_LOCAL. The
cache.log with "debug_options 29,3 28,9" activated looks like this:

014/10/08 20:03:00.539 kid2| Acl.cc(157) matches: checking DENY_USERS_LOCAL
2014/10/08 20:03:00.539 kid2| Acl.cc(28) AuthenticateAcl: SslBumped
request: It is an encapsulated request do not authenticate
2014/10/08 20:03:00.539 kid2| Acl.cc(177) matches: checked: DENY_USERS_LOCAL = 1
2014/10/08 20:03:00.539 kid2| Acl.cc(177) matches: checked: http_access#2 = 1
2014/10/08 20:03:00.540 kid2| Acl.cc(177) matches: checked: http_access = 1
2014/10/08 20:03:00.540 kid2| Checklist.cc(55) markFinished: 0x2905728
answer DENIED for match
2014/10/08 20:03:00.540 kid2| Checklist.cc(155) checkCallback:
ACLChecklist::checkCallback: 0x2905728 answer=DENIED
2014/10/08 20:03:00.540 kid2| Gadgets.cc(103) aclIsProxyAuth:
aclIsProxyAuth: called for DENY_USERS_LOCAL
2014/10/08 20:03:00.540 kid2| Acl.cc(118) FindByName: ACL::FindByName
'DENY_USERS_LOCAL'
2014/10/08 20:03:00.540 kid2| Gadgets.cc(108) aclIsProxyAuth:
aclIsProxyAuth: returning 1
2014/10/08 20:03:00.540 kid2| Gadgets.cc(71) aclGetDenyInfoPage: got
called for DENY_USERS_LOCAL


The concerning entries in squid.conf looks like this:
acl DENY_USERS_LOCAL proxy_auth_regex -i "/etc/squid/DENY_USERS_LOCAL"
...
http_access deny DENY_USERS_LOCAL
...


The meaning of the entries in the file DENY_USERS_LOCAL is denying
kerberos-authenticated AD-users. With squid 3.4.4, this worked fine.

Kind regards,
Tom


On Wed, Oct 8, 2014 at 4:26 PM, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 9/10/2014 3:21 a.m., Amos Jeffries wrote:
>> On 9/10/2014 2:09 a.m., Tom Tom wrote:
>>> I think, this behaviour was introduced with squid 3.4.4.1
>>> (http://www.squid-cache.org/Versions/v3/3.4/changesets/squid-3.4-13113.patch).
>>
>>>  I don't exactly understand this behaviour. Any hints for this?
>>
>> Aha. I am guessing it is a combination of: * the previous
>> ssl-bumped traffic was brokenly finding "invalid" credentials * an
>> "empty" regex actually contains .* (is matching anything valid).
>>
>> Meaning previously the "invalid" credentials would prevent the
>> regex being even attempted. Now that the credentials validity is
>> fixed the regex tests out and matches.
>>
>> Try putting a single entry of "-" in /etc/squid/DENY_USERS_LOCAL.
>
> Actually that would match any users with hyphen in their username.
>
> For production use, if the experiment above actually works, use ^root$
> or another username shich will never be assigned with explicit start
> and end anchors.
>
> Amos
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2.0.22 (MingW32)
>
> iQEcBAEBAgAGBQJUNUmhAAoJELJo5wb/XPRjxUwH/3Y3gDn7Cbt4ikAFyhAq+BlJ
> tnvu2lC/WK5et8aWSsGGUtxDcOZtJoW9hYGWVIJs7wukqMlldvH7oWdGpJ/pS4tQ
> KVpABF55n0Kt1ayRTpHzoE6eNDgVZt5lMcUk1OJnjW/wbibC5n6+BpBwyjg+Hf1X
> StvV6y99kMvqWkHNgBYcwLXblV83GdtnX5xmCV6CnPZSry50bMc+m/4fiLSJojvG
> unCMccmkw09697sPzJvZRe0CZbq8r3TRLfGJQEYqVem2FumpCoPQVDHIk82Q0B/y
> nyMHOndz5PVnYr9VpuYy7pVokA74jJ5HstLVQsIW/i1TMjarUP/1dFYpG8sEDL4=
> =/mvM
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From glenn.groves at bradnams.com.au  Wed Oct  8 23:04:27 2014
From: glenn.groves at bradnams.com.au (glenn.groves at bradnams.com.au)
Date: Thu, 9 Oct 2014 09:04:27 +1000
Subject: [squid-users] https issues for google
In-Reply-To: <54345D6E.3090403@ngtech.co.il>
References: <2329B68B3D676246BA0D1149E22F509F01A02886@bneseqs20.bradnams.com.au>
 <54345D6E.3090403@ngtech.co.il>
Message-ID: <2329B68B3D676246BA0D1149E22F509F01A028F4@bneseqs20.bradnams.com.au>

Hi Eliezer,

The DNS we are using is the ISP default for external, our internal domain DNS for internal. Nslookup works for all tests.

I would like to update to the latest stable, but I am concerned of breaking the current setup. It took a little work to get it working correctly particularity on the multiple authentication methods working with our domain and trust.

I support what has been said - to check the logs. This will likely take time as I cannot reproduce this issue on demand - and I think users are starting to not report the issue and just living with it (or it is not getting all the way to me at least). I will have to get lucky at some point on my computer and look into it then.

Could squid be getting mixed up when mulipule https requests are to the same address (e.g. https://google.com.au)?

Thanks,

Glenn 

-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Eliezer Croitoru
Sent: Wednesday, 8 October 2014 7:39 AM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] https issues for google

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hey Glenn,

Since you are not using intercept or tproxy the basic place to look at is the access.log.
You can see there if the proxy is trying for example to reach an IPV6 address (by mistake).

Also to make sure there is an issue you can use specific exception like the cacheadmin acl you are using to allow the cacheadmin access without authentication for the basic test.

Also you are indeed using the latest CentOS 6.5 squid but since the current stable version is 3.4.8 you should try to upgrade(to something else then 3.1) due to other issues.

The issue can be a network or dns related issue which was not detected until now.

Please first make sure that the access.log and cache.log files are clean for errors or issues.

What dns servers are you using?

Eliezer

On 10/07/2014 06:51 AM, glenn.groves at bradnams.com.au wrote:
> Hi All,
> 
> We have a weird issue where https sites apparently don't respond (get 
> message "this page can't be displayed"). This mainly affects google 
> websites and to a lesser affect youtube. It has been reported it may 
> have affected some banking sites but this is unconfirmed. We are 
> running centos 6.5 with up to date squid from the centos repositories.
> 
> Here is the version of squid: yum list installed | grep squid 
> squid.x86_64                         7:3.1.10-20.el6_5.3
> 
> The https sites work fine if I put a direct hole in the firewall to 
> allow internet traffic directly out - but this is not a solution.
> 
> Thanks, Glenn

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUNF1uAAoJENxnfXtQ8ZQUlfYH/i0o9MQDTt8g5aINRljVSMZc
btC8mcYn/JYn4WUPIoOc4/MhvuYg0JO6hXsSoPxjI1khMrq9fTV2c8eaLItWqYCf
hjioWPJs2hPwfw6WDi0I6kF0Is+hD/MGsJci7s+jg593lHnm+ZjoDIHj0aCpcdgy
u95961yZWXINbYsjTirFftnX5UC5MWbwZjaah6zW84RKZl/pa1vJM/tdgqiLdE5V
GDNhS01mbKPfin8oc/RQk4nYAK39vncSebvSHJwkvPJIKlb54Yti64j6qUfPsav3
uUvIVKSpxZjFFJoLtw1zjn1MwyynoHNGT1lP+HptsGkDoeGJ6YWU/IwB1sFKcVk=
=GKmE
-----END PGP SIGNATURE-----
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
 
This message (including any attachments) is confidential and may be legally privileged. If you are not the intended recipient, you should not disclose, copy or use any part of it - please delete all copies immediately and notify the Bradnam Group Helpdesk at helpdesk at bradnams.com.au 

Any information, statements or opinions contained in this message (including any attachments) are given by the author. They are not given on behalf of the Bradnam Group unless subsequently confirmed by an individual other than the author who is duly authorised to represent the Bradnam Group (or any of its subsidiary and associate companies).

All sent and received email from/to the Bradnam Group (or any of its subsidiary and associate companies) is automatically scanned for the presence of computer viruses, security issues and inappropriate content.

For further information on the services which the Bradnam Group provides visit our web 
site(s) at www.bradnams.com.au or www.nationalglass.com.au


From huaraz at moeller.plus.com  Wed Oct  8 23:43:41 2014
From: huaraz at moeller.plus.com (Markus Moeller)
Date: Thu, 9 Oct 2014 00:43:41 +0100
Subject: [squid-users] Squid,
	Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
	3.4.7.)
In-Reply-To: <20141008032925.GA77544@admin.sibptus.tomsk.ru>
References: <20141006040725.GA31642@admin.sibptus.tomsk.ru>
 <20141006052346.GA32369@admin.sibptus.tomsk.ru>
 <20141007070403.GA57384@admin.sibptus.tomsk.ru>
 <20141007083542.GA60425@admin.sibptus.tomsk.ru> <m11nv3$nk8$1@ger.gmane.org>
 <20141008032925.GA77544@admin.sibptus.tomsk.ru>
Message-ID: <m14if2$1ul$1@ger.gmane.org>


Hi Victor,

   I only found the following explanation:

This error will happen if you didn't write the key into the keytab file, or 
the permission setting of keytab file reject the read access, or the key 
file is not the one you should access (for example, you want 
/opt/somedir/conf/krb5.conf, but actually read /etc/krb5.conf, which has no 
that key).

  Is there something like strace/truss on freebsd to see which files are 
opened (with and without error) during running negotiate_kerberos_auth ? On 
Linux I would run:

./negotiate_kerberos_auth_test proxy.sibptus.transneft.ru | awk 
'{sub(/Token:/,"YR"); print $0}END{print "QQ"}' | strace -f -F -o 
negotiate_kerberos_auth.strace ./negotiate_kerberos_auth -d

Markus

"Victor Sudakov"  wrote in message 
news:20141008032925.GA77544 at admin.sibptus.tomsk.ru...

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Markus Moeller wrote:
>
>   In the helpers/negotiate_auth/kerberos directory is a script
> test_negotiate_auth.sh to test authentication outside of squid.

Markus,

I could find the said script neither in the source nor in the binary
package. However I think I can guess what could be inside.  Could you
look below if that makes sense?

===========================
$ setenv KRB5_KTNAME /usr/local/etc/squid/squid.keytab
$ setenv KRB5_CONFIG /usr/local/etc/squid/krb5.conf
$ kdestroy
$ kinit sudakovva
sudakovva at SIBPTUS.TRANSNEFT.RU's Password:
$
$ klist
Credentials cache: FILE:/tmp/krb5cc_XZ1GPU
        Principal: sudakovva at SIBPTUS.TRANSNEFT.RU

  Issued           Expires          Principal
Oct  8 09:31:45  Oct  8 19:31:45 
krbtgt/SIBPTUS.TRANSNEFT.RU at SIBPTUS.TRANSNEFT.RU

$ ./negotiate_kerberos_auth_test proxy.sibptus.transneft.ru | awk 
'{sub(/Token:/,"YR"); print $0}END{print "QQ"}' | 
./negotiate_kerberos_auth -d

negotiate_kerberos_auth.cc(212): pid=52357 :2014/10/08 10:03:34| 
negotiate_kerberos_auth: INFO: Starting version 3.0.4sq
negotiate_kerberos_auth.cc(258): pid=52357 :2014/10/08 10:03:34| 
negotiate_kerberos_auth: DEBUG: Got 'YR 
YIIGFAYGKwYBBQUCoIIGCDCCBgSgDTALBgkqhkiG9xIBAgKiggXxBIIF7WCCBekGCSqGSIb3EgECAgEAboIF2DCCBdSgAwIBBaEDAgEOogcDBQAAAAAAo4IEvGGCBLgwggS0oAMCAQWhFhsUU0lCUFRVUy5UUkFOU05FRlQuUlWiLTAroAMCAQGhJDAiGwRIVFRQGxpwcm94eS5zaWJwdHVzLnRyYW5zbmVmdC5ydaOCBGQwggRgoAMCAReiggRXBIIEUxpOgFWeZoAcatE6l3MyfDxMoDMjcgYUQzenTLAlEvD3/c0pyRiitZwNMIHvnacXcUSTzLDNjDw75iwfNxZHYjZgvOLHSKQm+rmoWtLIC+3KZoeWCB+pxwcpK8RzXvs8dPCprH1h5OdCn8EB1ZZxl35IhLgg07N72yvnXNiBmW/PmLW6PeVB0U3SLjWiT0ZJ3kXukg5ViYGOMKypeHebHPB0FQ2dgNQy8S00CRIU4ZuoHPVWFNl6mzp9CoIy7Ytwhu3NRb42f49nuQpqBVcsMK/ckgLYvsoz2lYxe7AO4MMOvcGqnEBB/jaSfrGGXpw+ciMNbBtCHH7bN36uGHj+VWOUFL5vR3xclnOWwdUH2OtXqMMcDDnI4v7vNR1U80BS7SdXUpx0D+O1B3ihipaTpSkXtII5UTI4qxmZjXSQGYY0adbG/N6NpMF7HpmGb1Zondp571l4ZV0mZ0pZ7IcIAmvQOmcud/sN0am4z9Oe3lCe7L1RVKBr0Tu30Pz7ySibeCpY/OVR2GJ+ILfov/3o95ozW8W4d+UCHfywAHOioGB+QWSC2NO5VtcjsBYVkhKnBkcG8KOBhJ+qi1qvhGXD3tUgDZnb0pCQAVNyjiDIKZre8KcB23Hu5a2YCM9y0GiBCbfJIbD60LJLVOxozZiRqJfdOCvBhfCvh7R9y5EuNmMswSRgQJwhkh7rCgMPWvFsAWDae9yxN966E85nE+xuUtwtl20NhOjotjG3NgwsRYDg1kQvfJnz7IcPSnSevKiPHU7uvBxSZvR6j6J0BZRgTQg7loUzkOsSRPDefXMt4wFfoHEqaWTtKw3yR0dZkr1W5g6WDn0d0o4uLZRdZteMOtxjsXFTQA3MIQrf/BpVk0NdEQ0EpXo2SZtr+ciy2jNXI40s6rUQakV/vfLG5aGOQY1Ck1gynORrG6Bt/eDMVJF7gf8iEvSDPiZhaHNqfAwfuYDNcO6Sgvl21tkEUfC9YxzkZq2vb0J1gJnkoq3oay+B7GElpgBABZpf22eGTOHakz7m8z9jdPUuIGFf1Jgn1B4i2vFsYRV6tbn3gF/wpnBdPmmG0ZVT2ZnqPDf2Om3kh1cd/THIWDVeuvNGRHbzGYxFJcJ+NIgwr5yfijltcKyynGqHvW2arUQwHzX0UM/dg6iI8+o2IkKmihBL9WQ+04SwHYeMk+D1hJx2rfrIl9RgpQdkrhrjPacqGfKd7NrtEweeSn7MOwFjaVYlT4ruboQHt94BcJKQ1qhuJVsH+rhZaM6XBt6F2NtM5Z+0OmwsLb0sQkdVbnbyEku7McPN0vvOC7tuDL1pT0UuAanSO6IQahXj5X3W/MVNf27rJUmcUQkGbTvCK6nJMuZYNsuKaB9Izs10T/i88V5IOgafwAHgLCxnpwptY551gJwj/0cvv6mpIZSrE8XjMWMUDmeTkeUyU8t2Dz5Vjbb8l1cFCIETgvc5CK9mV+SG0F6soQqf1xs+r6SB/jCB+6ADAgEXooHzBIHwxdPbAIs5nPD2d3wOYONkgkc1qb9krxSlo4FRMoPPIl+80A1OZOlv/SRc9B4VpP8xJJvk1YwY70twgMlOJd/zbXH0lEnyGdGi9mUuN4XdfeNzFwqvjxOrx1e8oPXJPJLIZCGhUik3nY7X4Nb4EMXmfEckzSsuBbVKkVwu7/0xPKbXL4KPs/e3ANJI8Lvkh7AM7iIXrhI2S4/ZKWo4f73R1sjgtt+nw8e1Ga7EeMlQvbejo/i9UBEFldNR2B8GM0DD6449mRrbXE1K5Pij+bHoHl9oZng97DGGnM4ritsN+ts2Rcev1IuSzm6QFaADBwRU' 
from squid (length: 2083).
negotiate_kerberos_auth.cc(311): pid=52357 :2014/10/08 10:03:34| 
negotiate_kerberos_auth: DEBUG: Decode 
'YIIGFAYGKwYBBQUCoIIGCDCCBgSgDTALBgkqhkiG9xIBAgKiggXxBIIF7WCCBekGCSqGSIb3EgECAgEAboIF2DCCBdSgAwIBBaEDAgEOogcDBQAAAAAAo4IEvGGCBLgwggS0oAMCAQWhFhsUU0lCUFRVUy5UUkFOU05FRlQuUlWiLTAroAMCAQGhJDAiGwRIVFRQGxpwcm94eS5zaWJwdHVzLnRyYW5zbmVmdC5ydaOCBGQwggRgoAMCAReiggRXBIIEUxpOgFWeZoAcatE6l3MyfDxMoDMjcgYUQzenTLAlEvD3/c0pyRiitZwNMIHvnacXcUSTzLDNjDw75iwfNxZHYjZgvOLHSKQm+rmoWtLIC+3KZoeWCB+pxwcpK8RzXvs8dPCprH1h5OdCn8EB1ZZxl35IhLgg07N72yvnXNiBmW/PmLW6PeVB0U3SLjWiT0ZJ3kXukg5ViYGOMKypeHebHPB0FQ2dgNQy8S00CRIU4ZuoHPVWFNl6mzp9CoIy7Ytwhu3NRb42f49nuQpqBVcsMK/ckgLYvsoz2lYxe7AO4MMOvcGqnEBB/jaSfrGGXpw+ciMNbBtCHH7bN36uGHj+VWOUFL5vR3xclnOWwdUH2OtXqMMcDDnI4v7vNR1U80BS7SdXUpx0D+O1B3ihipaTpSkXtII5UTI4qxmZjXSQGYY0adbG/N6NpMF7HpmGb1Zondp571l4ZV0mZ0pZ7IcIAmvQOmcud/sN0am4z9Oe3lCe7L1RVKBr0Tu30Pz7ySibeCpY/OVR2GJ+ILfov/3o95ozW8W4d+UCHfywAHOioGB+QWSC2NO5VtcjsBYVkhKnBkcG8KOBhJ+qi1qvhGXD3tUgDZnb0pCQAVNyjiDIKZre8KcB23Hu5a2YCM9y0GiBCbfJIbD60LJLVOxozZiRqJfdOCvBhfCvh7R9y5EuNmMswSRgQJwhkh7rCgMPWvFsAWDae9yxN966E85nE+xuUtwtl20NhOjotjG3NgwsRYDg1kQvfJnz7IcPSnSevKiPHU7uvBxSZvR6j6J0BZRgTQg7loUzkOsSRPDefXMt4wFfoHEqaWTtKw3yR0dZkr1W5g6WDn0d0o4uLZRdZteMOtxjsXFTQA3MIQrf/BpVk0NdEQ0EpXo2SZtr+ciy2jNXI40s6rUQakV/vfLG5aGOQY1Ck1gynORrG6Bt/eDMVJF7gf8iEvSDPiZhaHNqfAwfuYDNcO6Sgvl21tkEUfC9YxzkZq2vb0J1gJnkoq3oay+B7GElpgBABZpf22eGTOHakz7m8z9jdPUuIGFf1Jgn1B4i2vFsYRV6tbn3gF/wpnBdPmmG0ZVT2ZnqPDf2Om3kh1cd/THIWDVeuvNGRHbzGYxFJcJ+NIgwr5yfijltcKyynGqHvW2arUQwHzX0UM/dg6iI8+o2IkKmihBL9WQ+04SwHYeMk+D1hJx2rfrIl9RgpQdkrhrjPacqGfKd7NrtEweeSn7MOwFjaVYlT4ruboQHt94BcJKQ1qhuJVsH+rhZaM6XBt6F2NtM5Z+0OmwsLb0sQkdVbnbyEku7McPN0vvOC7tuDL1pT0UuAanSO6IQahXj5X3W/MVNf27rJUmcUQkGbTvCK6nJMuZYNsuKaB9Izs10T/i88V5IOgafwAHgLCxnpwptY551gJwj/0cvv6mpIZSrE8XjMWMUDmeTkeUyU8t2Dz5Vjbb8l1cFCIETgvc5CK9mV+SG0F6soQqf1xs+r6SB/jCB+6ADAgEXooHzBIHwxdPbAIs5nPD2d3wOYONkgkc1qb9krxSlo4FRMoPPIl+80A1OZOlv/SRc9B4VpP8xJJvk1YwY70twgMlOJd/zbXH0lEnyGdGi9mUuN4XdfeNzFwqvjxOrx1e8oPXJPJLIZCGhUik3nY7X4Nb4EMXmfEckzSsuBbVKkVwu7/0xPKbXL4KPs/e3ANJI8Lvkh7AM7iIXrhI2S4/ZKWo4f73R1sjgtt+nw8e1Ga7EeMlQvbejo/i9UBEFldNR2B8GM0DD6449mRrbXE1K5Pij+bHoHl9oZng97DGGnM4ritsN+ts2Rcev1IuSzm6QFaADBwRU' 
(decoded length: 1560).
negotiate_kerberos_auth.cc(128): pid=52357 :2014/10/08 10:03:34| 
negotiate_kerberos_auth: ERROR: gss_acquire_cred() failed:  No credentials 
were supplied, or the credentials were unavailable or inaccessible.. unknown 
mech-code 0 for mech unknown
BH gss_acquire_cred() failed:  No credentials were supplied, or the 
credentials were unavailable or inaccessible.. unknown mech-code 0 for mech 
unknown
negotiate_kerberos_auth.cc(258): pid=52357 :2014/10/08 10:03:34| 
negotiate_kerberos_auth: DEBUG: Got 'QQ' from squid (length: 2).
BH quit command

$ klist -v
Credentials cache: FILE:/tmp/krb5cc_XZ1GPU
        Principal: sudakovva at SIBPTUS.TRANSNEFT.RU
    Cache version: 4

Server: krbtgt/SIBPTUS.TRANSNEFT.RU at SIBPTUS.TRANSNEFT.RU
Client: sudakovva at SIBPTUS.TRANSNEFT.RU
Ticket etype: arcfour-hmac-md5
Ticket length: 1128
Auth time:  Oct  8 10:00:12 2014
End time:   Oct  8 20:00:12 2014
Ticket flags: initial, pre-authenticated
Addresses: addressless

Server: HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
Client: sudakovva at SIBPTUS.TRANSNEFT.RU
Ticket etype: arcfour-hmac-md5
Ticket length: 1212
Auth time:  Oct  8 10:00:12 2014
Start time: Oct  8 10:00:16 2014
End time:   Oct  8 20:00:12 2014
Ticket flags: pre-authenticated
Addresses: addressless

$
$  ktutil list
/usr/local/etc/squid/squid.keytab:

Vno  Type                     Principal
  1  des-cbc-crc 
HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  des-cbc-md5 
HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  arcfour-hmac-md5 
HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  aes256-cts-hmac-sha1-96 
HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  aes128-cts-hmac-sha1-96 
HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
===========================

>
> Let me know what you get.

You can see that I obtain a ticket for the HTTP/proxy.sibptus.transneft.ru
service, but somehow the authentication fails.

> BTW on which platform with which Kerberos
> library( MIT or Heimdal)  is this ?

On the squid host: FreeBSD 8.4-RELEASE-p16 i386, Heimdal 1.1.0.

w2k AD as KDC for SIBPTUS.TRANSNEFT.RU.

- -- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUNK+VAAoJEA2k8lmbXsY0JeUIAItkImiYwviy4IEgOepwiamE
NpodTm4bvdhy+bFrchezXjx8vSPSz0mKgM5IdwNxdRaH9qRl5obC5lXQWu9K6d8S
J3e3fxlKY9t7rUcnJYHWXwlClHd0qz7cN9Actp4OOs01RcD1bEHzfnR9yeQnWfNw
vTE+C9IbFpVQnVQyQCsnrS/jwIsGbvXTTWywgeQ9p6hTQsR5Cw/u6pqtUQjIZ6Rq
0elGZ21JY4hzfILNjcKxflU5q7HKULRBtBHWUC8JowZmBUKBBxX5Cci4atFHVd/e
dSg4fPYDqHYoz0H4mu3IzRbPSurjGQZ9g3cUFrClqgX3Fyr8lrWAGbAQVRxABZw=
=Nikr
-----END PGP SIGNATURE-----
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users 




From huaraz at moeller.plus.com  Wed Oct  8 23:47:41 2014
From: huaraz at moeller.plus.com (Markus Moeller)
Date: Thu, 9 Oct 2014 00:47:41 +0100
Subject: [squid-users] Squid,
	Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
	3.4.7.)
In-Reply-To: <20141008032925.GA77544@admin.sibptus.tomsk.ru>
References: <20141006040725.GA31642@admin.sibptus.tomsk.ru>
 <20141006052346.GA32369@admin.sibptus.tomsk.ru>
 <20141007070403.GA57384@admin.sibptus.tomsk.ru>
 <20141007083542.GA60425@admin.sibptus.tomsk.ru> <m11nv3$nk8$1@ger.gmane.org>
 <20141008032925.GA77544@admin.sibptus.tomsk.ru>
Message-ID: <m14if3$1ul$2@ger.gmane.org>

Hi Victor,

   I only found the following explanation:

This error will happen if you didn't write the key into the keytab file, or
the permission setting of keytab file reject the read access, or the key
file is not the one you should access (for example, you want
/opt/somedir/conf/krb5.conf, but actually read /etc/krb5.conf, which has no
that key).

  Is there something like strace/truss on freebsd to see which files are
opened (with and without error) during running negotiate_kerberos_auth ? On
Linux I would run:

./negotiate_kerberos_auth_test proxy.sibptus.transneft.ru | awk
'{sub(/Token:/,"YR"); print $0}END{print "QQ"}' | strace -f -F -o
negotiate_kerberos_auth.strace ./negotiate_kerberos_auth -d

Markus


"Victor Sudakov"  wrote in message 
news:20141008032925.GA77544 at admin.sibptus.tomsk.ru...

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Markus Moeller wrote:
>
>   In the helpers/negotiate_auth/kerberos directory is a script
> test_negotiate_auth.sh to test authentication outside of squid.

Markus,

I could find the said script neither in the source nor in the binary
package. However I think I can guess what could be inside.  Could you
look below if that makes sense?

===========================
$ setenv KRB5_KTNAME /usr/local/etc/squid/squid.keytab
$ setenv KRB5_CONFIG /usr/local/etc/squid/krb5.conf
$ kdestroy
$ kinit sudakovva
sudakovva at SIBPTUS.TRANSNEFT.RU's Password:
$
$ klist
Credentials cache: FILE:/tmp/krb5cc_XZ1GPU
        Principal: sudakovva at SIBPTUS.TRANSNEFT.RU

  Issued           Expires          Principal
Oct  8 09:31:45  Oct  8 19:31:45 
krbtgt/SIBPTUS.TRANSNEFT.RU at SIBPTUS.TRANSNEFT.RU

$ ./negotiate_kerberos_auth_test proxy.sibptus.transneft.ru | awk 
'{sub(/Token:/,"YR"); print $0}END{print "QQ"}' | 
./negotiate_kerberos_auth -d

negotiate_kerberos_auth.cc(212): pid=52357 :2014/10/08 10:03:34| 
negotiate_kerberos_auth: INFO: Starting version 3.0.4sq
negotiate_kerberos_auth.cc(258): pid=52357 :2014/10/08 10:03:34| 
negotiate_kerberos_auth: DEBUG: Got 'YR 
YIIGFAYGKwYBBQUCoIIGCDCCBgSgDTALBgkqhkiG9xIBAgKiggXxBIIF7WCCBekGCSqGSIb3EgECAgEAboIF2DCCBdSgAwIBBaEDAgEOogcDBQAAAAAAo4IEvGGCBLgwggS0oAMCAQWhFhsUU0lCUFRVUy5UUkFOU05FRlQuUlWiLTAroAMCAQGhJDAiGwRIVFRQGxpwcm94eS5zaWJwdHVzLnRyYW5zbmVmdC5ydaOCBGQwggRgoAMCAReiggRXBIIEUxpOgFWeZoAcatE6l3MyfDxMoDMjcgYUQzenTLAlEvD3/c0pyRiitZwNMIHvnacXcUSTzLDNjDw75iwfNxZHYjZgvOLHSKQm+rmoWtLIC+3KZoeWCB+pxwcpK8RzXvs8dPCprH1h5OdCn8EB1ZZxl35IhLgg07N72yvnXNiBmW/PmLW6PeVB0U3SLjWiT0ZJ3kXukg5ViYGOMKypeHebHPB0FQ2dgNQy8S00CRIU4ZuoHPVWFNl6mzp9CoIy7Ytwhu3NRb42f49nuQpqBVcsMK/ckgLYvsoz2lYxe7AO4MMOvcGqnEBB/jaSfrGGXpw+ciMNbBtCHH7bN36uGHj+VWOUFL5vR3xclnOWwdUH2OtXqMMcDDnI4v7vNR1U80BS7SdXUpx0D+O1B3ihipaTpSkXtII5UTI4qxmZjXSQGYY0adbG/N6NpMF7HpmGb1Zondp571l4ZV0mZ0pZ7IcIAmvQOmcud/sN0am4z9Oe3lCe7L1RVKBr0Tu30Pz7ySibeCpY/OVR2GJ+ILfov/3o95ozW8W4d+UCHfywAHOioGB+QWSC2NO5VtcjsBYVkhKnBkcG8KOBhJ+qi1qvhGXD3tUgDZnb0pCQAVNyjiDIKZre8KcB23Hu5a2YCM9y0GiBCbfJIbD60LJLVOxozZiRqJfdOCvBhfCvh7R9y5EuNmMswSRgQJwhkh7rCgMPWvFsAWDae9yxN966E85nE+xuUtwtl20NhOjotjG3NgwsRYDg1kQvfJnz7IcPSnSevKiPHU7uvBxSZvR6j6J0BZRgTQg7loUzkOsSRPDefXMt4wFfoHEqaWTtKw3yR0dZkr1W5g6WDn0d0o4uLZRdZteMOtxjsXFTQA3MIQrf/BpVk0NdEQ0EpXo2SZtr+ciy2jNXI40s6rUQakV/vfLG5aGOQY1Ck1gynORrG6Bt/eDMVJF7gf8iEvSDPiZhaHNqfAwfuYDNcO6Sgvl21tkEUfC9YxzkZq2vb0J1gJnkoq3oay+B7GElpgBABZpf22eGTOHakz7m8z9jdPUuIGFf1Jgn1B4i2vFsYRV6tbn3gF/wpnBdPmmG0ZVT2ZnqPDf2Om3kh1cd/THIWDVeuvNGRHbzGYxFJcJ+NIgwr5yfijltcKyynGqHvW2arUQwHzX0UM/dg6iI8+o2IkKmihBL9WQ+04SwHYeMk+D1hJx2rfrIl9RgpQdkrhrjPacqGfKd7NrtEweeSn7MOwFjaVYlT4ruboQHt94BcJKQ1qhuJVsH+rhZaM6XBt6F2NtM5Z+0OmwsLb0sQkdVbnbyEku7McPN0vvOC7tuDL1pT0UuAanSO6IQahXj5X3W/MVNf27rJUmcUQkGbTvCK6nJMuZYNsuKaB9Izs10T/i88V5IOgafwAHgLCxnpwptY551gJwj/0cvv6mpIZSrE8XjMWMUDmeTkeUyU8t2Dz5Vjbb8l1cFCIETgvc5CK9mV+SG0F6soQqf1xs+r6SB/jCB+6ADAgEXooHzBIHwxdPbAIs5nPD2d3wOYONkgkc1qb9krxSlo4FRMoPPIl+80A1OZOlv/SRc9B4VpP8xJJvk1YwY70twgMlOJd/zbXH0lEnyGdGi9mUuN4XdfeNzFwqvjxOrx1e8oPXJPJLIZCGhUik3nY7X4Nb4EMXmfEckzSsuBbVKkVwu7/0xPKbXL4KPs/e3ANJI8Lvkh7AM7iIXrhI2S4/ZKWo4f73R1sjgtt+nw8e1Ga7EeMlQvbejo/i9UBEFldNR2B8GM0DD6449mRrbXE1K5Pij+bHoHl9oZng97DGGnM4ritsN+ts2Rcev1IuSzm6QFaADBwRU' 
from squid (length: 2083).
negotiate_kerberos_auth.cc(311): pid=52357 :2014/10/08 10:03:34| 
negotiate_kerberos_auth: DEBUG: Decode 
'YIIGFAYGKwYBBQUCoIIGCDCCBgSgDTALBgkqhkiG9xIBAgKiggXxBIIF7WCCBekGCSqGSIb3EgECAgEAboIF2DCCBdSgAwIBBaEDAgEOogcDBQAAAAAAo4IEvGGCBLgwggS0oAMCAQWhFhsUU0lCUFRVUy5UUkFOU05FRlQuUlWiLTAroAMCAQGhJDAiGwRIVFRQGxpwcm94eS5zaWJwdHVzLnRyYW5zbmVmdC5ydaOCBGQwggRgoAMCAReiggRXBIIEUxpOgFWeZoAcatE6l3MyfDxMoDMjcgYUQzenTLAlEvD3/c0pyRiitZwNMIHvnacXcUSTzLDNjDw75iwfNxZHYjZgvOLHSKQm+rmoWtLIC+3KZoeWCB+pxwcpK8RzXvs8dPCprH1h5OdCn8EB1ZZxl35IhLgg07N72yvnXNiBmW/PmLW6PeVB0U3SLjWiT0ZJ3kXukg5ViYGOMKypeHebHPB0FQ2dgNQy8S00CRIU4ZuoHPVWFNl6mzp9CoIy7Ytwhu3NRb42f49nuQpqBVcsMK/ckgLYvsoz2lYxe7AO4MMOvcGqnEBB/jaSfrGGXpw+ciMNbBtCHH7bN36uGHj+VWOUFL5vR3xclnOWwdUH2OtXqMMcDDnI4v7vNR1U80BS7SdXUpx0D+O1B3ihipaTpSkXtII5UTI4qxmZjXSQGYY0adbG/N6NpMF7HpmGb1Zondp571l4ZV0mZ0pZ7IcIAmvQOmcud/sN0am4z9Oe3lCe7L1RVKBr0Tu30Pz7ySibeCpY/OVR2GJ+ILfov/3o95ozW8W4d+UCHfywAHOioGB+QWSC2NO5VtcjsBYVkhKnBkcG8KOBhJ+qi1qvhGXD3tUgDZnb0pCQAVNyjiDIKZre8KcB23Hu5a2YCM9y0GiBCbfJIbD60LJLVOxozZiRqJfdOCvBhfCvh7R9y5EuNmMswSRgQJwhkh7rCgMPWvFsAWDae9yxN966E85nE+xuUtwtl20NhOjotjG3NgwsRYDg1kQvfJnz7IcPSnSevKiPHU7uvBxSZvR6j6J0BZRgTQg7loUzkOsSRPDefXMt4wFfoHEqaWTtKw3yR0dZkr1W5g6WDn0d0o4uLZRdZteMOtxjsXFTQA3MIQrf/BpVk0NdEQ0EpXo2SZtr+ciy2jNXI40s6rUQakV/vfLG5aGOQY1Ck1gynORrG6Bt/eDMVJF7gf8iEvSDPiZhaHNqfAwfuYDNcO6Sgvl21tkEUfC9YxzkZq2vb0J1gJnkoq3oay+B7GElpgBABZpf22eGTOHakz7m8z9jdPUuIGFf1Jgn1B4i2vFsYRV6tbn3gF/wpnBdPmmG0ZVT2ZnqPDf2Om3kh1cd/THIWDVeuvNGRHbzGYxFJcJ+NIgwr5yfijltcKyynGqHvW2arUQwHzX0UM/dg6iI8+o2IkKmihBL9WQ+04SwHYeMk+D1hJx2rfrIl9RgpQdkrhrjPacqGfKd7NrtEweeSn7MOwFjaVYlT4ruboQHt94BcJKQ1qhuJVsH+rhZaM6XBt6F2NtM5Z+0OmwsLb0sQkdVbnbyEku7McPN0vvOC7tuDL1pT0UuAanSO6IQahXj5X3W/MVNf27rJUmcUQkGbTvCK6nJMuZYNsuKaB9Izs10T/i88V5IOgafwAHgLCxnpwptY551gJwj/0cvv6mpIZSrE8XjMWMUDmeTkeUyU8t2Dz5Vjbb8l1cFCIETgvc5CK9mV+SG0F6soQqf1xs+r6SB/jCB+6ADAgEXooHzBIHwxdPbAIs5nPD2d3wOYONkgkc1qb9krxSlo4FRMoPPIl+80A1OZOlv/SRc9B4VpP8xJJvk1YwY70twgMlOJd/zbXH0lEnyGdGi9mUuN4XdfeNzFwqvjxOrx1e8oPXJPJLIZCGhUik3nY7X4Nb4EMXmfEckzSsuBbVKkVwu7/0xPKbXL4KPs/e3ANJI8Lvkh7AM7iIXrhI2S4/ZKWo4f73R1sjgtt+nw8e1Ga7EeMlQvbejo/i9UBEFldNR2B8GM0DD6449mRrbXE1K5Pij+bHoHl9oZng97DGGnM4ritsN+ts2Rcev1IuSzm6QFaADBwRU' 
(decoded length: 1560).
negotiate_kerberos_auth.cc(128): pid=52357 :2014/10/08 10:03:34| 
negotiate_kerberos_auth: ERROR: gss_acquire_cred() failed:  No credentials 
were supplied, or the credentials were unavailable or inaccessible.. unknown 
mech-code 0 for mech unknown
BH gss_acquire_cred() failed:  No credentials were supplied, or the 
credentials were unavailable or inaccessible.. unknown mech-code 0 for mech 
unknown
negotiate_kerberos_auth.cc(258): pid=52357 :2014/10/08 10:03:34| 
negotiate_kerberos_auth: DEBUG: Got 'QQ' from squid (length: 2).
BH quit command

$ klist -v
Credentials cache: FILE:/tmp/krb5cc_XZ1GPU
        Principal: sudakovva at SIBPTUS.TRANSNEFT.RU
    Cache version: 4

Server: krbtgt/SIBPTUS.TRANSNEFT.RU at SIBPTUS.TRANSNEFT.RU
Client: sudakovva at SIBPTUS.TRANSNEFT.RU
Ticket etype: arcfour-hmac-md5
Ticket length: 1128
Auth time:  Oct  8 10:00:12 2014
End time:   Oct  8 20:00:12 2014
Ticket flags: initial, pre-authenticated
Addresses: addressless

Server: HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
Client: sudakovva at SIBPTUS.TRANSNEFT.RU
Ticket etype: arcfour-hmac-md5
Ticket length: 1212
Auth time:  Oct  8 10:00:12 2014
Start time: Oct  8 10:00:16 2014
End time:   Oct  8 20:00:12 2014
Ticket flags: pre-authenticated
Addresses: addressless

$
$  ktutil list
/usr/local/etc/squid/squid.keytab:

Vno  Type                     Principal
  1  des-cbc-crc 
HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  des-cbc-md5 
HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  arcfour-hmac-md5 
HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  aes256-cts-hmac-sha1-96 
HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  aes128-cts-hmac-sha1-96 
HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
===========================

>
> Let me know what you get.

You can see that I obtain a ticket for the HTTP/proxy.sibptus.transneft.ru
service, but somehow the authentication fails.

> BTW on which platform with which Kerberos
> library( MIT or Heimdal)  is this ?

On the squid host: FreeBSD 8.4-RELEASE-p16 i386, Heimdal 1.1.0.

w2k AD as KDC for SIBPTUS.TRANSNEFT.RU.

- -- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUNK+VAAoJEA2k8lmbXsY0JeUIAItkImiYwviy4IEgOepwiamE
NpodTm4bvdhy+bFrchezXjx8vSPSz0mKgM5IdwNxdRaH9qRl5obC5lXQWu9K6d8S
J3e3fxlKY9t7rUcnJYHWXwlClHd0qz7cN9Actp4OOs01RcD1bEHzfnR9yeQnWfNw
vTE+C9IbFpVQnVQyQCsnrS/jwIsGbvXTTWywgeQ9p6hTQsR5Cw/u6pqtUQjIZ6Rq
0elGZ21JY4hzfILNjcKxflU5q7HKULRBtBHWUC8JowZmBUKBBxX5Cci4atFHVd/e
dSg4fPYDqHYoz0H4mu3IzRbPSurjGQZ9g3cUFrClqgX3Fyr8lrWAGbAQVRxABZw=
=Nikr
-----END PGP SIGNATURE-----
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users 




From sudakov at sibptus.tomsk.ru  Thu Oct  9 03:16:01 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Thu, 9 Oct 2014 10:16:01 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <m14if3$1ul$2@ger.gmane.org>
References: <20141006040725.GA31642@admin.sibptus.tomsk.ru>
 <20141006052346.GA32369@admin.sibptus.tomsk.ru>
 <20141007070403.GA57384@admin.sibptus.tomsk.ru>
 <20141007083542.GA60425@admin.sibptus.tomsk.ru>
 <m11nv3$nk8$1@ger.gmane.org>
 <20141008032925.GA77544@admin.sibptus.tomsk.ru>
 <m14if3$1ul$2@ger.gmane.org>
Message-ID: <20141009031601.GA4827@admin.sibptus.tomsk.ru>

Markus Moeller wrote:
> 
>    I only found the following explanation:
> 
> This error will happen if you didn't write the key into the keytab file, or
> the permission setting of keytab file reject the read access, or the key
> file is not the one you should access (for example, you want
> /opt/somedir/conf/krb5.conf, but actually read /etc/krb5.conf, which has no
> that key).

I thought about this. I have checked the paths and permissions several
times and found no faults. Maybe you could look at my ktrace output
and notice something therein which I don't notice.

> 
>   Is there something like strace/truss on freebsd to see which files are
> opened (with and without error) during running negotiate_kerberos_auth ? On
> Linux I would run:

Sure, I usually use ktrace. This list server doest not allow to post
large files, so here is a link:
https://drive.google.com/file/d/0B6fElyRl5MUDSkdIMnFla1RyTjQ/view?usp=sharing

There are also truss and dtrace but I have never used them. If you
give me the exact command line, I can run them on
negotiate_kerberos_auth and publish the result.

And please Markus could you whitelist my relay mail.sibptus.tomsk.ru
(212.73.124.5), you are rejecting CC's to you for some reason.

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru


From squid3 at treenet.co.nz  Thu Oct  9 03:41:18 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 09 Oct 2014 16:41:18 +1300
Subject: [squid-users] problem with basic_ldap_auth
In-Reply-To: <1412678023114-4667736.post@n4.nabble.com>
References: <1412678023114-4667736.post@n4.nabble.com>
Message-ID: <543603DE.706@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 7/10/2014 11:33 p.m., masterx81 wrote:
> Hi to all! I'm having an issue on squid 3.3.13 using
> basic_ldap_auth. I'm using the following helpers: auth_param
> negotiate program /usr/local/bin/negotiate_wrapper --ntlm 
> /usr/bin/ntlm_auth --helper-protocol=squid-2.5-ntlmssp
> --domain=DOMAIN --kerberos /usr/local/bin/squid_kerb_auth -s
> GSS_C_NO_NAME auth_param negotiate children 10 auth_param negotiate
> keep_alive on
> 
> auth_param ntlm program /usr/bin/ntlm_auth 
> --helper-protocol=squid-2.5-ntlmssp --domain=DOMAIN auth_param ntlm
> children 10 auth_param ntlm keep_alive on
> 
> auth_param basic program /usr/local/squid/libexec/basic_ldap_auth
> -v 3 -R -b "dc=domain,dc=local" -D squid at domain.local -W
> /etc/squid/ldappass.txt -d -f sAMAccountName=%s -h
> srv-dc1.domain.local auth_param basic children 10 auth_param basic
> realm Proxy DOMAIN auth_param basic credentialsttl 1 minute
> 
> NTLM and kerberos are working correctly, but the basic helper seem
> to not work well. The browser ask me 3 times the password, then
> give me the cache error. After this, windows save the credentials
> in it's cache (seen in account manager) and if i close and reopen
> the browser it work but seem to use NTLM as i get the ticket in the
> cache.log. In che cache.log i not see any line of the basic helper
> also with the -d switch. If i call the helper manually from command
> line it works and give me "OK" if i pass correct user/pass and "ERR
> Success" if i pass wrong credentials.
> 
> Before the 3.3.13 i was using a 3.4.x version, and all was working
> ok, but i've had the need to go back as on 3.4 i have huge cpu
> utilization using NTLM. On the 3.3.13 cpu usage is really low but
> seen that there is this throuble with basic helpers.... Some have a
> suggestion for me?

Firstly the popup does not mean Basic. It only means the browser is
not able to automatically find any credentials that work.

If it is "saving" the NTLM credentials in password manager it means
those are the credentials which eventually worked after the user input.

The way auth is supposed to work is that the browser tries the most
secure method it is offered then falls back to ever less secure methods.

So what *should* be happening is the following. The first one to
succeed is used:

 1. automatic attempt to use Negotiate/Kerberos
 2. automatic attempt to use Negotiate/NTLM
 3. automatic attempt to use NTLM
 4. automatic attempt to use Basic
 5. popup request for Negotiate/Kerberos credentials
 6. popup request for Negotiate/NTLM credentials
 7. popup request for NTLM credentials
       --> the one you say is working.
 8. popup request for Basic credentials
 9. display error page sent in last received 401/407/403 message.

* The password manager or system API lacking any of the credentials
may skip the HTTP transaction part of 'automatic' steps.
* User clicking cancel may skip the HTTP part of the popup steps.
* 403 response skips from any point to step 9.

You can test this a bit better by placing some strange text in the
Basic auth "Realm" parameter. Only if that text appears in the popup
box is Basic auth being requested.

debug_options 11,2 can be used to get a trace of teh HTTP traffic.
Which can be used to see the auth types being attempted by the client.

Also, the helpers should all provide -d parameter to print debug info
about their actions.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUNgPeAAoJELJo5wb/XPRj164IAOKM/YeG6AKdaxMAT6kPELPG
TEbxLOZyZ13eFIZpY5kR1u0Wx6jZL/nsmSk7vs7UmEOdVc4YQSYktTjxf8cfpbrP
NF2fc2+6IPrnSzyoJ7aNatqDSMBnwPneo0AG6xj9/jFsSeCN/HAqELf5ngIOZFXQ
eMSodljKBWzp4epXyB/J8BvQL4Ng0hCy1yisAR1fsQupo8SLgCwVaMrZ10ZJxrsR
ourgX57M/qvOmEknSHDGO3PZAa1iFBY2iwEyDMa31P2oLZxJ/SiXUoeDSs3zkXJb
hzgFUxTzsyoQTr8g9ZekMlmAa3+QAw0NwST/Y6s2AZcbOKKBVcH3evO2FKyvvjg=
=aiaz
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Thu Oct  9 03:51:29 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 09 Oct 2014 16:51:29 +1300
Subject: [squid-users] Error page for failed authentication
In-Reply-To: <1412713946439-4667750.post@n4.nabble.com>
References: <1412713946439-4667750.post@n4.nabble.com>
Message-ID: <54360641.2040500@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 8/10/2014 9:32 a.m., silblackw wrote:
> Hello,
> 
> I am setting up my squid to require user authentication with a
> digest. I have noticed that if authentication fails, it prompts the
> user again, and if the user clicks "cancel" then squid just refuses
> the connection. I am wondering if it is possible to change the
> behavior so that if authentication fails or the user clicks
> "cancel" squid instead redirects the user to an authentication
> failure page. Is this possible using the squid config file? What
> would be the best way of approaching this problem?

The page being displayed after cancel is suposed to be the payload of
the previous 407 message from the proxy. You can set it to any page
content you like using deny_info directive. But, be aware that the
popup is a browser features *designed* to hide that page whether they
actually display the payload or some "friendy" error of their own
choosing (hello MSIE) we can't control.

As for redirect. You can also do that with deny_info in the latest
Squid. However it is kind of a bad idea. Sending any 300-399 status
code tells the client that authentication has *succeeded*, and that
the URL it was requesting is found at the indicated new location. Some
redirect codes permanently change the browser history an bookmark
references, etc.
 Take great care.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUNgZBAAoJELJo5wb/XPRj7i4H/0GMQqEE5CfRg8nxyTF8VfX5
SCrUFEXeBEi1qaMxjIzKPDjUxVgh/6PS0YrX66ZJhJPdLg1Q7/qclA7n2wsXFpvr
w7eYhupHuZqxv+HTQ8x/y1t/mtloMJqAUgICbe8EHWATVU30wrNeNYkmiqyqYaaC
zKEh06+O3xKHLzNIJ7kZEOsQmQHwbjktx7MWmEQ2sqihanWQK6mEpb3w8JtPA1AJ
K9Dx5kCzqhj1Rwau/vN3LOa7QCpj/2rlK0CloBM36II1PLauB2Uco9xyySwsxxRs
b07eeuIxPDVE82iGMLNQlptEQ1qk+KKfe8W9vzDk6NP5VhjTa06CSRnschIu2wc=
=7n5D
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Thu Oct  9 04:06:24 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 09 Oct 2014 17:06:24 +1300
Subject: [squid-users] Squid 2.7 STABLE8 (Win2008) can't get my MS Lync
 2013 to work?
In-Reply-To: <BAY181-W10622B73CAF28702B792D1F0A30@phx.gbl>
References: <BAY181-W940DC82E91699617FA5A9F0A20@phx.gbl>,
 <54345EFD.7040202@ngtech.co.il>
 <BAY181-W61EF839967043531882833F0A20@phx.gbl>, <54346D5A.5050809@ngtech.co.il>,
 <BAY405-EAS241813461A14B5D530D6897F0A20@phx.gbl>,
 <5434DB2D.6080705@treenet.co.nz> <BAY181-W10622B73CAF28702B792D1F0A30@phx.gbl>
Message-ID: <543609C0.50703@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 9/10/2014 4:19 a.m., Mirza Dedic wrote:
> Thanks Amos, It seems I spoke too fast, the proxy prompt is back,
> so disabling SG didn't do the trick. Two two hits I see in
> access.log are: 1412778349.755    141 172.16.12.110 TCP_MISS/200
> 462 POST http://sqm.microsoft.com/sqm/wm/sqmserver.dll -
> DIRECT/65.55.7.141 -1412778349.911    515 172.16.12.110
> TCP_MISS/200 11695 CONNECT login.microsoftonline.com:443 -
> DIRECT/157.55.208.198 - These happen when I restart the Lync
> program and at the time of the proxy prompt.

If you notice the status code on both of those is 200. Meaning they
were successfully accepted by your proxy and completely serviced.

There is no way those could produce a proxy login popup. The POST also
cannot produce a www-auth popup since it is not 401 status. The
CONNECT could if there were some encrypted 401 message unseen by Squid.

> My config file is here: http://pastebin.com/MSsTWum2 I spent last 
> night trying to mess with cygwin + squid to try and tackle this
> issue by upgrading to a more supported squid, I see there is a
> 3.3.3 published in their repository; I got this working at home
> (squid starts) on Windows 7 machine however getting errors trying
> to start the same cygwin setup on my win2003 remote server,
> getting.. 2014/10/08 08:12:56| aclIpParseIpData: Bad host/IP: '::1'
> in '::1', flags=0 : (8) Name or service not knownFATAL: Bungled
> Default Configuration line 11: acl localhost src 127.0.0.1/32
> ::1Squid Cache (Version 3.3.3): Terminated abnormally.

These are default definitions for Squid-3.

At a minimum your systems built-in DNS resolver needs ability to
convert IPv6 addresses to numeric values. HTTP routinely sends
raw-IPv6 addresses in some headers. That minimum ability is mandatory
in order to reject/skip attempts to use IPv6 when it is configured
disabled.

I believe the Windows Server 2008 or later are needed for Squid-3
builds. Several of the Squid-3 features need advanced networking
functionality. That IP conversion ability may be one of them.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUNgnAAAoJELJo5wb/XPRjPAUIAKmz5qxM5fRVIU8sU2rdWj9Z
+qtTOIqRrkSMjJ47Jc3yUozUAVLCOE69OyMoLEuEC6mqB61tYnSOuq2Ig1bT61hf
AJXWCHOp1qDr9Xoa4nld/onkd4gHokKzuV+SRGIYEDwF6HxFM454ctb9YpSgBmr3
79kCOzy6OPRgdHALFc0rBAP6BGz8pN+kvDd9X6vMyFSlnvyERRwwbuzp4tzzfcAf
A9akRaHpDk/N4OLkJSGKj6V6uyKMStgJEu1SP8dzKKnuoo3uPYPseJKlyzikFPb2
h9VzKazytcTpMKEQQtNioRo9poJ8sZCzSlZQh6pb8U1rZcJ1rRp2QA5h7TvB8Bk=
=rsNN
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Thu Oct  9 04:40:32 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 09 Oct 2014 17:40:32 +1300
Subject: [squid-users] Squid 2.7 STABLE8 (Win2008) can't get my MS Lync
 2013 to work?
In-Reply-To: <BAY181-W10622B73CAF28702B792D1F0A30@phx.gbl>
References: <BAY181-W940DC82E91699617FA5A9F0A20@phx.gbl>,
 <54345EFD.7040202@ngtech.co.il>
 <BAY181-W61EF839967043531882833F0A20@phx.gbl>, <54346D5A.5050809@ngtech.co.il>,
 <BAY405-EAS241813461A14B5D530D6897F0A20@phx.gbl>,
 <5434DB2D.6080705@treenet.co.nz> <BAY181-W10622B73CAF28702B792D1F0A30@phx.gbl>
Message-ID: <543611C0.9090002@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 9/10/2014 4:19 a.m., Mirza Dedic wrote:
> Thanks Amos, It seems I spoke too fast, the proxy prompt is back,
> so disabling SG didn't do the trick.


Replying with a config file audit separately so it does not get lost
in the technical details of running on Windows. All of these are
general points relevant to 2.7 regardless of who is running it or where.


> # Port on which Squid will lisen on http_port 8080
> 
> # Authentication auth_param ntlm program
> c:/squid/libexec/mswin_ntlm_auth.exe
> --helper-protocol=squid-2.5-ntlmssp auth_param ntlm children 5 
> auth_param ntlm keep_alive on auth_param basic program
> c:/squid/libexec/mswin_ntlm_auth.exe
> --helper-protocol=squid-2.5-basic auth_param basic children 5 
> auth_param basic realm Visalia Proxy Server 10072014 auth_param
> basic credentialsttl 2 hours auth_param basic casesensitive off 
> authenticate_cache_garbage_interval 10 seconds
> 
> # Squid Defaults acl all src all acl manager proto cache_object acl
> localhost src 127.0.0.1
> 
> # Class C Internal Subnet - Defaults acl localnet src 10.0.0.0/8 
> acl localnet src 172.16.0.0/12 acl localnet src 192.168.0.0/16
> 
> # ACLs # for destination machine acl lan_dst dst 172.16.0.0/16 #
> for source machine acl lan_src src 172.16.0.0/16 # for destination
> domain acl lan_domain dstdomain .oppy.com
> 
> # SSL Ports acl SSL_ports port 443 8180 8443 563 1494 2598 8531
> 
> # Standard Ports acl Safe_ports port 80						# http acl Safe_ports
> port 81          			# http for Pacific Brokerage acl Safe_ports
> port 21						# ftp acl Safe_ports port 443 563					# http acl
> Safe_ports port 70						# gopher acl Safe_ports port 210						#
> wais acl Safe_ports port 280						# http-mgmt acl Safe_ports port
> 488						# gss-http acl Safe_ports port 591						# filemaker acl
> Safe_ports port 777						# multiling http acl Safe_ports port 8080
> 8081 8082 8088 8180 acl Safe_ports port 3128        			# Squid http
> server acl Safe_ports port 1494 2598   			# ICA - Citrix acl
> Safe_ports port 7000 8000   			# Oracle acl Safe_ports port 9000
> # Oracle acl Safe_ports port 8530					# WSUS acl Safe_ports port
> 55905					# WSUS acl Safe_ports port 1025-65535				# unregistered
> ports
> 
> external_acl_type AD_group %LOGIN
> c:/squid/libexec/mswin_check_ad_group.exe -G acl AuthorizedUsers
> proxy_auth REQUIRED
> 
> # ACL - Microsoft acl msdomains dstdomain .windowsupdate.com acl
> msdomains dstdomain .microsoft.com acl msdomains dstdomain ... acl
> msdomains dstdomain .microsoftonline.com acl msdomains dstdomain
> ...
> 
> # ACL - SSL Providers acl registars dstdomain ...
> 
> # LYNC acl lync2013 dst ...
> 
> # OFFICE 365 PORTAL AND IDENTITY acl 365portal dst ...
> 
> # OFFICE ONLINE acl office365 dst ...
> 
> acl dropbox dstdomain .dropbox.com acl icloud dstdomain
> .icloud.com
> 
> # Squid Cache acl PURGE method PURGE
> 
> http_access deny manager !localhost http_access allow PURGE
> localhost http_access deny PURGE
> 
> # The method ACL type allows you to restrict access based on the
> request HTTP method, i.e. GET (used for downloading), POST (used
> for uploading) and CONNECT (used for SSL data transfers) # It is
> very important that you stop CONNECT type requests to non-SSL
> ports. The CONNECT method allows data transfer in any direction at
> any time, regardless of the transport protocol used. acl CONNECT
> method CONNECT http_access deny CONNECT !SSL_ports
> 
> # Deny access to all ports except the ones defined http_access deny
> !Safe_ports # This blocks attempts to request http://localhost on
> the proxy server via the proxy. http_access deny localhost # Deny
> caching for everyone so that there is not caching at all cache deny
> all
> 
<snip default security checks>


> http_access allow msdomains

 ... the transaction "POST
http://sqm.microsoft.com/sqm/wm/sqmserver.dll" is permitted here.
Authentication is neither required nor used.

 ... the transaction "CONNECT login.microsoftonline.com:443" is
permitted here. Everythign inside that tunnel is then strictly between
the client software and login.microsoftonline.com server.
Authentication is neither required nor used to setup the tunnel itself.


> http_access allow lync2013 http_access allow 365portal http_access
> allow office365 http_access allow registars http_access allow
> dropbox http_access allow icloud http_access allow lan_domain
> 
> http_access allow CONNECT msdomains http_access allow CONNECT
> lync2013 http_access allow CONNECT 365portal http_access allow
> CONNECT office365 http_access allow CONNECT registars http_access
> allow CONNECT dropbox http_access allow CONNECT icloud http_access
> allow CONNECT lan_domain

All transactions which might match these CONNECT+something ACL checks
are already permitted by the "allow something" set directly above.

The CONNECT part of teh ACL check is unnecessary.

> 
> # Deny access to proxy to everyone except Authorized Users group in
> AD http_access deny !AuthorizedUsers
> 

> # Disable caching always_direct allow msdomains all always_direct
> allow registars all always_direct allow lync2013 all always_direct
> allow 365portal all always_direct allow office365 all
> 
> # Allow direct connection if the destination machine is on LAN 
> always_direct allow lan_dst

always_direct prevents configured cache_peer being used to fetch the
traffic. That is all.

You do not have any cache_peer, so these always_direct lines are not
useful and just slow the proxy down.

FWIW: 'DIRECT' in HTTP means using DNS records to locate an
appropriate server. Instead of peer configuration or WPAD algorithms.


> # Caching cache_mgr ittechs at oppy.com refresh_pattern ^ftp:		1440
> 20%	10080 refresh_pattern ^gopher:	1440	0%	1440 refresh_pattern -i
> (/cgi-bin/|\?) 0	0%	0 refresh_pattern .		0	20%	4320
> 
> # Dont cache these pages acl DYNAMIC_CONTENT urlpath_regex cgi-bin
> \.cgi \.pl \.php3 \.asp \.php no_cache deny DYNAMIC_CONTENT

Squid-2.7 and later are just fine caching dynamic content provided you
use correct refresh_patterns.

Also, you have two earlier config settings which make this useless.
First is the "cache deny all" above, which makes this useless. Second
is the refresh_pattern on (/cgi-bin/|\?), which discards dynamic
content strictly according to protocol requirements.

I suggest you erase the above DYNAMIC_CONTENT bits.

Cheers
Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUNhHAAAoJELJo5wb/XPRj5QcH/imDm2RLbJnia4rqWamC3UTo
uQlM6Mha0/boL+L7VOHu/1MsBlq4pN22EEBUBWyfUYWFRT+0M6onQ6lb4sDSKgnu
hHvhaI3D0a6c/bXOYTv+19TXb4kzaXq1c4/ph9gEZFslymw457adIJjU/jZuSg7D
OsOKjvP3i7Bi1DoNsZwiuYXyN1e1zNjYGEFN5Vo+WlK4Ola2mno9mdzIhQGodibM
+x52uqmUGeKKsllkZ1CrLWsnbzNbHAY4x8F6m85yGUk7ZBQ1dASGmiBalYTN/cT+
LF2KTijgL/hnAFlAnejopxuUCRcb7sXElQQfPYcAA4LR0eHRb+G+jU1PduoY390=
=IDPH
-----END PGP SIGNATURE-----


From gecom at tubosider.it  Thu Oct  9 08:45:26 2014
From: gecom at tubosider.it (masterx81)
Date: Thu, 9 Oct 2014 01:45:26 -0700 (PDT)
Subject: [squid-users] problem with basic_ldap_auth
In-Reply-To: <543603DE.706@treenet.co.nz>
References: <1412678023114-4667736.post@n4.nabble.com>
 <543603DE.706@treenet.co.nz>
Message-ID: <1412844326572-4667784.post@n4.nabble.com>

hi! thanks for the answer!
I've already added the -d option on all helpers, i get kerberos and ntlm
tickets but never basic auth... Most of them came from the negotiate
wrapper.
I've noticed as you say that the realm part isn't displayed in the password
prompt box, so the prompt doesn't came form the basic auth...

For the config i've used as reference this:
http://wiki.squid-cache.org/ConfigExamples/Authenticate/WindowsActiveDirectory




--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/problem-with-basic-ldap-auth-tp4667736p4667784.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From Andreas.Reschke at mahle.com  Thu Oct  9 09:09:05 2014
From: Andreas.Reschke at mahle.com (Andreas.Reschke at mahle.com)
Date: Thu, 9 Oct 2014 11:09:05 +0200
Subject: [squid-users] squid 3.4. uses 100% cpu with ntlm_auth
In-Reply-To: <1412349508959-4667645.post@n4.nabble.com>
References: <1412349508959-4667645.post@n4.nabble.com>,
 <1FCF9DA5B29068478ECF15896F19F084FFDC4CEA@Y011007.bk.fin.local>
 <1412264045523-4667634.post@n4.nabble.com>
Message-ID: <OF99973CD0.6667CF1E-ONC1257D6C.00324526-C1257D6C.0032452B@mahle.com>

An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141009/837a5cdd/attachment.htm>

From steve at opendium.com  Thu Oct  9 09:38:51 2014
From: steve at opendium.com (Steve Hill)
Date: Thu, 09 Oct 2014 10:38:51 +0100
Subject: [squid-users] leaking memory In Squid 3.4.6
In-Reply-To: <543544A0.1080301@treenet.co.nz>
References: <20140928062806.GA34166@admin.sibptus.tomsk.ru>
 <5427B9EC.6060500@ngtech.co.il> <5429209D.1050909@opendium.com>
 <542ABA7F.6010401@treenet.co.nz> <542AC54C.408@opendium.com>
 <542AC87D.7040806@treenet.co.nz> <54340958.6070601@opendium.com>
 <543544A0.1080301@treenet.co.nz>
Message-ID: <543657AB.7030407@opendium.com>

On 08.10.14 15:05, Amos Jeffries wrote:

> New patch added to bug 4088. Please see if it resolves the
> external_acl_type leak.

Despite the external ACL cache leak being plugged, I'm still getting a 
serious memory leak.  This data was captured over night on a production 
server, graphing memory usage against requests:
   http://persephone.opendium.net/~steve/squid-memory.png

The graph starts at around 18:00 yesterday evening, ending at around 
09:00 this morning.  I've included the yellow "requests per minute" line 
so you can see how busy the server is - it starts off pretty quiet in 
the evening and gets quieter through the night, but then traffic picks 
up this morning.

The accounted memory increases slightly through the run, but not 
significantly enough for me to worry about for the time being.  My 
concern is the unaccounted memory rapidly increasing.  From the graph, 
it is clear that it is not leaking a fixed amount per request, but I 
can't figure out what correlates with the leak.

Here's an overview of what this Squid is doing:
	- Single process - no SMP workers
	- External ACLs
	- TPROXY
	- Kerberos and Basic auth.
	- SSL Bump
	- ICAP
	- No memory caching (cache_mem 0)
	- No disk caching (cache_dir isn't set)
	- Almost all non-HTTPS traffic is sent to a parent proxy.
	- HTTPS traffic is sent direct

Config file:

auth_param negotiate program /usr/lib64/squid/negotiate_wrapper_auth 
--ntlm /usr/bin/ntlm_auth --helper-protocol=squid-2.5-ntlmssp --kerberos 
/usr/lib64/squid/negotiate_kerberos_auth -s HTTP/proxy.example.com
auth_param negotiate children 50
auth_param negotiate keep_alive off

auth_param basic program /usr/lib64/squid/basic_pam_auth -r
auth_param basic children 50
auth_param basic realm "Iceni Web Proxy"
auth_param basic credentialsttl 2 hours


shutdown_lifetime 3 seconds
forward_max_tries 40
icap_service_failure_limit -1
host_verify_strict off
spoof_client_ip deny all

logformat iceni %tg.%03tu %6tr %>a %Ss/%03>Hs %<st %rm %ru %[un %Sh/%<a 
%mt "%{User-Agent}>h" %lp
access_log stdio:/var/log/squid-nocache/access.log iceni
cache_log /var/log/squid-nocache/cache.log
cache_store_log none
pid_filename /var/run/squid-nocache.pid
coredump_dir /var/spool/squid-nocache
state_dir /var/run/squid-nocache


######
# ACL definitions
######

external_acl_type preauth cache=0 children-max=1 concurrency=100 ttl=60 
negative_ttl=0 %SRC %>{User-Agent} %URI %METHOD /usr/sbin/squid-preauth 
/etc/iceni/authcached/authcached.psk
acl preauth		external preauth
acl preauth_tproxy	external preauth transparent
acl preauth_ok		note auth_tag preauth_ok
acl preauth_done	note auth_tag preauth_done
acl need_http_auth	note auth_tag http_auth
acl need_cp_auth	note auth_tag cp_auth
acl need_postauth_sync	note auth_tag postauth_sync
acl need_postauth_async	note auth_tag postauth_async

external_acl_type postauth_async cache=0 children-max=1 concurrency=100 
ttl=0 grace=100 %SRC %>{User-Agent} %LOGIN %EXT_USER 
/usr/sbin/squid-postauth /etc/iceni/authcached/authcached.psk
external_acl_type postauth_sync cache=0 children-max=1 concurrency=100 
ttl=0 grace=0 %SRC %>{User-Agent} %LOGIN %EXT_USER 
/usr/sbin/squid-postauth /etc/iceni/authcached/authcached.psk
#external_acl_type postauth_async cache=1 children-max=1 concurrency=100 
ttl=1 negative_ttl=1 grace=100 %SRC %>{User-Agent} %LOGIN %EXT_USER 
/usr/sbin/squid-postauth /etc/iceni/authcached/authcached.psk
#external_acl_type postauth_sync cache=1 children-max=1 concurrency=100 
ttl=1 negative_ttl=1 grace=0 %SRC %>{User-Agent} %LOGIN %EXT_USER 
/usr/sbin/squid-postauth /etc/iceni/authcached/authcached.psk
acl postauth_async	external postauth_async
acl postauth_sync	external postauth_sync

# Show the captive portal login page (use with "http_access deny")
acl show_login_page	src all
deny_info 
302:https://%h/webproxy/captive_portal/captive_portal_login?c=%o 
show_login_page

# A bodge to ensure accesses to this machine aren't authenticated or 
filtered.
# /etc/squid/local_ips is automatically updated by the init script when 
Squid
# starts or reloads, so Squid should be reloaded whenever the machine's IPs
# change (yuck!).
acl local_ips		dst "/etc/squid/local_ips"

acl SSL_ports		port 443

acl Safe_ports		port 80		# http
acl Safe_ports		port 21		# ftp
acl Safe_ports		port 443	# https
acl Safe_ports		port 70		# gopher
acl Safe_ports		port 210	# wais
acl Safe_ports		port 1025-65535	# unregistered ports
acl Safe_ports		port 280	# http-mgmt
acl Safe_ports		port 488	# gss-http
acl Safe_ports		port 591	# filemaker
acl Safe_ports		port 777	# multiling http

# CONNECT matches the encrypted tunnel, https matches the decrypted requests
# inside it when it is bumped.
acl CONNECT		method CONNECT
acl https		proto https

acl proxy_auth		proxy_auth REQUIRED
acl tproxy		myportname tproxy
acl tproxy_ssl		myportname tproxy_ssl

# The "you have been blocked" page comes from the web server on 
localhost and
# needs to be excluded from filtering and being forwarded to the 
upstream proxy.
acl dstdomain_localhost	dstdomain localhost


######
# Start of http_access access control.
######

http_access allow manager localhost
http_access deny manager
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access deny to_localhost

# Unauthenticated access to the local server
http_access allow local_ips

http_access allow !tproxy !tproxy_ssl !https preauth
http_access allow !preauth_done preauth_tproxy
http_access allow need_http_auth need_postauth_sync proxy_auth postauth_sync
http_access allow need_http_auth need_postauth_async proxy_auth 
postauth_async
http_access allow need_http_auth proxy_auth

http_access deny preauth_ok show_login_page

http_access deny all


######
# Other services
######

icp_access deny all
htcp_access deny all


######
# SSL bumping - 
http://www.squid-cache.org/mail-archive/squid-dev/201206/0089.html
# When the web filter wants a CONNECT request to be bumped it sets the
# icap_says_bump header on it, which we trap for here.  Transparently
# proxied SSL connections are always bumped.
######

acl icap_says_bump req_header X-SSL-Bump -i Yes
ssl_bump server-first icap_says_bump
ssl_bump server-first tproxy_ssl
sslproxy_cert_error allow all


######
# Listening ports
######

http_port 3128 ssl-bump generate-host-certificates=on 
cert=/etc/pki/tls/certs/squid-sslbump.crt 
key=/etc/pki/tls/private/squid-sslbump.key
http_port 8080 ssl-bump generate-host-certificates=on 
cert=/etc/pki/tls/certs/squid-sslbump.crt 
key=/etc/pki/tls/private/squid-sslbump.key
http_port 3130 tproxy name=tproxy
https_port 3131 ssl-bump generate-host-certificates=on 
cert=/etc/pki/tls/certs/squid-sslbump.crt 
key=/etc/pki/tls/private/squid-sslbump.key tproxy name=tproxy_ssl


######
# Set a Netfilter mark on transparently proxied connections so they can have
# special routing
######

tcp_outgoing_mark 0x2 tproxy
tcp_outgoing_mark 0x2 tproxy_ssl


######
# Since we do no caching in this instance of Squid, we use a second 
instance as
# an upstream caching proxy.  For efficiency reasons we try to send 
uncachable
# traffic directly to the web server rather than via the upstream proxy.
######

cache_peer [::1] parent 3129 0 proxy-only no-query no-digest no-tproxy 
name=caching
cache_peer_access caching deny CONNECT
cache_peer_access caching deny https
cache_peer_access caching deny tproxy_ssl
cache_peer_access caching deny to_localhost
cache_peer_access caching deny dstdomain_localhost
cache_peer_access caching allow all

cache_mem 0
cache deny all
never_direct deny CONNECT
never_direct deny https
never_direct deny tproxy_ssl
never_direct deny to_localhost
never_direct deny dstdomain_localhost
never_direct allow all


######
# Interface with the web filter
######
icap_enable on
icap_service_revival_delay 30
icap_preview_enable on
icap_preview_size 50000
icap_send_client_ip on
icap_send_client_username on

icap_service iceni_reqmod_precache reqmod_precache 0 
icap://localhost6:1344/reqmod_precache
icap_service iceni_respmod_postcache respmod_precache 0 
icap://localhost6:1344/respmod_postcache

adaptation_service_set iceni_reqmod_precache iceni_reqmod_precache
adaptation_service_set iceni_respmod_postcache iceni_respmod_postcache

adaptation_access iceni_reqmod_precache deny local_ips
adaptation_access iceni_reqmod_precache deny to_localhost
adaptation_access iceni_reqmod_precache deny dstdomain_localhost
adaptation_access iceni_reqmod_precache allow all

adaptation_access iceni_respmod_postcache deny local_ips
adaptation_access iceni_respmod_postcache deny to_localhost
adaptation_access iceni_respmod_postcache deny dstdomain_localhost
adaptation_access iceni_respmod_postcache allow all



-- 
  - Steve Hill
    Technical Director
    Opendium Limited     http://www.opendium.com

Direct contacts:
    Instant messager: xmpp:steve at opendium.com
    Email:            steve at opendium.com
    Phone:            sip:steve at opendium.com

Sales / enquiries contacts:
    Email:            sales at opendium.com
    Phone:            +44-1792-824568 / sip:sales at opendium.com

Support contacts:
    Email:            support at opendium.com
    Phone:            +44-1792-825748 / sip:support at opendium.com


From jmperrote at policia.rionegro.gov.ar  Thu Oct  9 13:28:02 2014
From: jmperrote at policia.rionegro.gov.ar (Juan Manuel Perrote)
Date: Thu, 09 Oct 2014 10:28:02 -0300
Subject: [squid-users] I need a help with user permissions credentials
Message-ID: <54368D62.70800@policia.rionegro.gov.ar>


I have a Squid Cache: Version 3.1.19, on Ubuntu 12.04.2 LTS.

We use external authentification on ldap repository on a remote machine

#********************************#********************************#********************************

#********************************

#REGLA VALIDACION LDAP

#********************************

#Esto indica el numero de procesos de autentificacion 
(notienevalorpredeterminado).

auth_param basic children 5

#Especifica el numero de procesos redirector para desovar

redirect_children 5

#Valido el usuario

auth_param basic program /usr/lib/squid3/squid_ldap_auth -b 
"ou=Users,dc=vs-zmaster,dc=policia,dc=rionegro,dc=gov,dc=ar" -f "uid=%s" 
-h 10.11.37.2 -v 3

auth_param basic realm Policia de Rio Negro

#Validar grupos

external_acl_type ldap_group %LOGIN /usr/lib/squid3/squid_ldap_group -b 
"ou=Groups,dc=vs-zmaster,dc=policia,dc=rionegro,dc=gov,dc=ar" -f 
"(&(memberUid=%u)(cn=%g)(objectClass=posixGroup))" -h 10.11.37.2 -v 3

#especifica el tiempo de usuario y contrasenia valido externamente.

auth_param basic casesensitive on

auth_param basic credentialsttl 280 minutes

authenticate_ttl 60 minutes

#********************************#********************************#********************************

The problem is that when I change the user group on ldap to other user 
group (with differents permission) squid not refresh the change so until 
1hs or more, the change are not reflect on real time. The same goes if 
change the password user, the user still navigating for a while.

The changes are not reflected immediately.

But if a reload the squid service, the change take effect

Regards.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141009/d94c72f1/attachment.htm>

From squid3 at treenet.co.nz  Thu Oct  9 13:55:29 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 10 Oct 2014 02:55:29 +1300
Subject: [squid-users] I need a help with user permissions credentials
In-Reply-To: <54368D62.70800@policia.rionegro.gov.ar>
References: <54368D62.70800@policia.rionegro.gov.ar>
Message-ID: <543693D1.8080402@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 10/10/2014 2:28 a.m., Juan Manuel Perrote wrote:
> 
> I have a Squid Cache: Version 3.1.19, on Ubuntu 12.04.2 LTS.
> 
> We use external authentification on ldap repository on a remote
> machine
> 
> #********************************#********************************#********************************
>
> 
> 
> #********************************
> 
> #REGLA VALIDACION LDAP
> 
> #********************************
> 
> #Esto indica el numero de procesos de autentificacion 
> (notienevalorpredeterminado).
> 
> auth_param basic children 5
> 
> #Especifica el numero de procesos redirector para desovar
> 
> redirect_children 5
> 
> #Valido el usuario
> 
> auth_param basic program /usr/lib/squid3/squid_ldap_auth -b 
> "ou=Users,dc=vs-zmaster,dc=policia,dc=rionegro,dc=gov,dc=ar" -f
> "uid=%s" -h 10.11.37.2 -v 3
> 
> auth_param basic realm Policia de Rio Negro
> 
> #Validar grupos
> 
> external_acl_type ldap_group %LOGIN
> /usr/lib/squid3/squid_ldap_group -b 
> "ou=Groups,dc=vs-zmaster,dc=policia,dc=rionegro,dc=gov,dc=ar" -f 
> "(&(memberUid=%u)(cn=%g)(objectClass=posixGroup))" -h 10.11.37.2 -v
> 3
> 
> #especifica el tiempo de usuario y contrasenia valido
> externamente.
> 
> auth_param basic casesensitive on
> 
> auth_param basic credentialsttl 280 minutes
> 
> authenticate_ttl 60 minutes
> 
> #********************************#********************************#********************************
>
> 
> 
> The problem is that when I change the user group on ldap to other
> user group (with differents permission) squid not refresh the
> change so until 1hs or more, the change are not reflect on real
> time. The same goes if change the password user, the user still
> navigating for a while.

Your configuration says "credentialsttl 280 minutes". That means Squid
only checks for username/password changes once every 4hrs 40min.

There is no TTL configured for external_acl_type helper. Meaning Squid
uses the default TTL and groups are only checked every 1hr.

> 
> The changes are not reflected immediately.
> 
> But if a reload the squid service, the change take effect

That depends on what you mean by "reload".

 * If you are restarting the service it completely shuts down and then
starts again. The credentials cache is stored only in volatile memory
and gets erased on shutdown or restart.

* If you are reconfiguring (reload the config), the memory and thus
credentials cache is retained.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUNpPRAAoJELJo5wb/XPRjZMwIAIAp1WdNCnjVvxuuEcemR2k8
yXKrMUkQ5uFKUbqQfVCsg5YdorgC/gkBatk06KqyMiBYbksAYvG45kUNtUVnKUkU
+5gRgQR+Gmx59V1+BYqVZu8qLaWWg0NNX7C2iOP70SsD7IYECfi5uxbUUz3yLCia
19c6Y2iSqu0f4iWUGJEArVLvpJgoblhcgtVan9aOK77uzYVIpma/MFdl/lQZ8QST
/wclWIOlIVU3j7Dw3cBZr/tHuzhFKt2WnYKFcb+8elUaL5OQzsTEpkxvnB2n25Ci
pmtfBDQXvzbiThPbBWHaZ1oPMPVSIn6iLrmaxukgqxk48w5H3mjta34uP1p28NY=
=R+0F
-----END PGP SIGNATURE-----


From jmperrote at policia.rionegro.gov.ar  Thu Oct  9 14:10:11 2014
From: jmperrote at policia.rionegro.gov.ar (Juan Manuel Perrote)
Date: Thu, 09 Oct 2014 11:10:11 -0300
Subject: [squid-users] I need a help with user permissions credentials
In-Reply-To: <543693D1.8080402@treenet.co.nz>
References: <54368D62.70800@policia.rionegro.gov.ar>
 <543693D1.8080402@treenet.co.nz>
Message-ID: <54369743.4060408@policia.rionegro.gov.ar>

El 09/10/2014 10:55, Amos Jeffries escribi?:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 10/10/2014 2:28 a.m., Juan Manuel Perrote wrote:
>> I have a Squid Cache: Version 3.1.19, on Ubuntu 12.04.2 LTS.
>>
>> We use external authentification on ldap repository on a remote
>> machine
>>
>> #********************************#********************************#********************************
>>
>>
>>
>> #********************************
>>
>> #REGLA VALIDACION LDAP
>>
>> #********************************
>>
>> #Esto indica el numero de procesos de autentificacion
>> (notienevalorpredeterminado).
>>
>> auth_param basic children 5
>>
>> #Especifica el numero de procesos redirector para desovar
>>
>> redirect_children 5
>>
>> #Valido el usuario
>>
>> auth_param basic program /usr/lib/squid3/squid_ldap_auth -b
>> "ou=Users,dc=vs-zmaster,dc=policia,dc=rionegro,dc=gov,dc=ar" -f
>> "uid=%s" -h 10.11.37.2 -v 3
>>
>> auth_param basic realm Policia de Rio Negro
>>
>> #Validar grupos
>>
>> external_acl_type ldap_group %LOGIN
>> /usr/lib/squid3/squid_ldap_group -b
>> "ou=Groups,dc=vs-zmaster,dc=policia,dc=rionegro,dc=gov,dc=ar" -f
>> "(&(memberUid=%u)(cn=%g)(objectClass=posixGroup))" -h 10.11.37.2 -v
>> 3
>>
>> #especifica el tiempo de usuario y contrasenia valido
>> externamente.
>>
>> auth_param basic casesensitive on
>>
>> auth_param basic credentialsttl 280 minutes
>>
>> authenticate_ttl 60 minutes
>>
>> #********************************#********************************#********************************
>>
>>
>>
>> The problem is that when I change the user group on ldap to other
>> user group (with differents permission) squid not refresh the
>> change so until 1hs or more, the change are not reflect on real
>> time. The same goes if change the password user, the user still
>> navigating for a while.
> Your configuration says "credentialsttl 280 minutes". That means Squid
> only checks for username/password changes once every 4hrs 40min.
>
> There is no TTL configured for external_acl_type helper. Meaning Squid
> uses the default TTL and groups are only checked every 1hr.
>
>> The changes are not reflected immediately.
>>
>> But if a reload the squid service, the change take effect
> That depends on what you mean by "reload".
>
>   * If you are restarting the service it completely shuts down and then
> starts again. The credentials cache is stored only in volatile memory
> and gets erased on shutdown or restart.
>
> * If you are reconfiguring (reload the config), the memory and thus
> credentials cache is retained.
>
> Amos
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2.0.22 (MingW32)
>
> iQEcBAEBAgAGBQJUNpPRAAoJELJo5wb/XPRjZMwIAIAp1WdNCnjVvxuuEcemR2k8
> yXKrMUkQ5uFKUbqQfVCsg5YdorgC/gkBatk06KqyMiBYbksAYvG45kUNtUVnKUkU
> +5gRgQR+Gmx59V1+BYqVZu8qLaWWg0NNX7C2iOP70SsD7IYECfi5uxbUUz3yLCia
> 19c6Y2iSqu0f4iWUGJEArVLvpJgoblhcgtVan9aOK77uzYVIpma/MFdl/lQZ8QST
> /wclWIOlIVU3j7Dw3cBZr/tHuzhFKt2WnYKFcb+8elUaL5OQzsTEpkxvnB2n25Ci
> pmtfBDQXvzbiThPbBWHaZ1oPMPVSIn6iLrmaxukgqxk48w5H3mjta34uP1p28NY=
> =R+0F
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

Hello Amos I do "service squid reload"

It is correct, that I need do that for refresh the change made on ldap 
repository ?

Because we have a callcenter that made the change on users permissions 
or groups on a ldap application interface, but they can't restart the 
proxy before make the changes. We do that.


regards,
Juan Manuel.




From jmperrote at policia.rionegro.gov.ar  Thu Oct  9 14:40:48 2014
From: jmperrote at policia.rionegro.gov.ar (Juan Manuel Perrote)
Date: Thu, 09 Oct 2014 11:40:48 -0300
Subject: [squid-users] I need a help with user permissions credentials
In-Reply-To: <543693D1.8080402@treenet.co.nz>
References: <54368D62.70800@policia.rionegro.gov.ar>
 <543693D1.8080402@treenet.co.nz>
Message-ID: <54369E70.70405@policia.rionegro.gov.ar>

El 09/10/2014 10:55, Amos Jeffries escribi?:
> There is no TTL configured for external_acl_type helper. Meaning Squid
> uses the default TTL and groups are only checked every 1hr.


If I set ttl on external_acl_type like this :

external_acl_type ldap_group ttl=60  %LOGIN 
/usr/lib/squid3/squid_ldap_group -b 
"ou=Groups,dc=vs-zmaster,dc=policia,dc=rionegro,dc=gov,dc=ar" -f 
"(&(memberUid=%u)(cn=%g)(objectClass=posixGroup))" -h 10.11.37.2 -v 3

the proxy required to user autenticate again every 1 minutes, not 
retained the credentials

regards ?





From glenn.groves at bradnams.com.au  Thu Oct  9 23:02:01 2014
From: glenn.groves at bradnams.com.au (glenn.groves at bradnams.com.au)
Date: Fri, 10 Oct 2014 09:02:01 +1000
Subject: [squid-users] https issues for google
In-Reply-To: <2329B68B3D676246BA0D1149E22F509F01A028F4@bneseqs20.bradnams.com.au>
References: <2329B68B3D676246BA0D1149E22F509F01A02886@bneseqs20.bradnams.com.au>
 <54345D6E.3090403@ngtech.co.il>
 <2329B68B3D676246BA0D1149E22F509F01A028F4@bneseqs20.bradnams.com.au>
Message-ID: <2329B68B3D676246BA0D1149E22F509F01A0293D@bneseqs20.bradnams.com.au>

I was able to capture the log at the time this happened to me, I got the following in the access.log:

1412895309.389     84 10.10.10.69 TCP_MISS/200 0 CONNECT www.youtube.com:443 <MYADUSER> DIRECT/74.125.237.160 -
1412895311.770      0 10.10.10.69 TCP_DENIED/407 3983 CONNECT www.youtube.com:443 - NONE/- text/html
1412895311.852     77 10.10.10.69 TCP_MISS/200 0 CONNECT www.youtube.com:443 <MYADUSER> DIRECT/74.125.237.160 -
1412895311.855      0 10.10.10.69 TCP_DENIED/407 3983 CONNECT www.youtube.com:443 - NONE/- text/html
1412895311.937     77 10.10.10.69 TCP_MISS/200 0 CONNECT www.youtube.com:443 <MYADUSER> DIRECT/74.125.237.160 -
1412895311.941      0 10.10.10.69 TCP_DENIED/407 3983 CONNECT www.youtube.com:443 - NONE/- text/html
1412895312.053    107 10.10.10.69 TCP_MISS/200 0 CONNECT www.youtube.com:443 <MYADUSER> DIRECT/74.125.237.160 -
1412895312.056      0 10.10.10.69 TCP_DENIED/407 3983 CONNECT www.youtube.com:443 - NONE/- text/html
1412895312.124     65 10.10.10.69 TCP_MISS/200 0 CONNECT www.youtube.com:443 <MYADUSER> DIRECT/74.125.237.160 -
1412895312.680      0 10.10.10.69 TCP_DENIED/407 3983 CONNECT www.youtube.com:443 - NONE/- text/html
1412895312.765     79 10.10.10.69 TCP_MISS/200 0 CONNECT www.youtube.com:443 <MYADUSER> DIRECT/74.125.237.160 -
1412895312.768      0 10.10.10.69 TCP_DENIED/407 3983 CONNECT www.youtube.com:443 - NONE/- text/html
1412895312.846     74 10.10.10.69 TCP_MISS/200 0 CONNECT www.youtube.com:443 <MYADUSER> DIRECT/74.125.237.160 -
1412895312.851      0 10.10.10.69 TCP_DENIED/407 3983 CONNECT www.youtube.com:443 - NONE/- text/html
1412895312.927     73 10.10.10.69 TCP_MISS/200 0 CONNECT www.youtube.com:443 <MYADUSER> DIRECT/74.125.237.160 -
1412895312.931      0 10.10.10.69 TCP_DENIED/407 3983 CONNECT www.youtube.com:443 - NONE/- text/html

Not sure why it would be saying TCP_MISS, I assume the TCP_DENIED is expected as it happens after the TCP_MISS and has no authentication information.


-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of glenn.groves at bradnams.com.au
Sent: Thursday, 9 October 2014 9:04 AM
To: eliezer at ngtech.co.il; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] https issues for google

Hi Eliezer,

The DNS we are using is the ISP default for external, our internal domain DNS for internal. Nslookup works for all tests.

I would like to update to the latest stable, but I am concerned of breaking the current setup. It took a little work to get it working correctly particularity on the multiple authentication methods working with our domain and trust.

I support what has been said - to check the logs. This will likely take time as I cannot reproduce this issue on demand - and I think users are starting to not report the issue and just living with it (or it is not getting all the way to me at least). I will have to get lucky at some point on my computer and look into it then.

Could squid be getting mixed up when mulipule https requests are to the same address (e.g. https://google.com.au)?

Thanks,

Glenn 

-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Eliezer Croitoru
Sent: Wednesday, 8 October 2014 7:39 AM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] https issues for google

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hey Glenn,

Since you are not using intercept or tproxy the basic place to look at is the access.log.
You can see there if the proxy is trying for example to reach an IPV6 address (by mistake).

Also to make sure there is an issue you can use specific exception like the cacheadmin acl you are using to allow the cacheadmin access without authentication for the basic test.

Also you are indeed using the latest CentOS 6.5 squid but since the current stable version is 3.4.8 you should try to upgrade(to something else then 3.1) due to other issues.

The issue can be a network or dns related issue which was not detected until now.

Please first make sure that the access.log and cache.log files are clean for errors or issues.

What dns servers are you using?

Eliezer

On 10/07/2014 06:51 AM, glenn.groves at bradnams.com.au wrote:
> Hi All,
> 
> We have a weird issue where https sites apparently don't respond (get 
> message "this page can't be displayed"). This mainly affects google 
> websites and to a lesser affect youtube. It has been reported it may 
> have affected some banking sites but this is unconfirmed. We are 
> running centos 6.5 with up to date squid from the centos repositories.
> 
> Here is the version of squid: yum list installed | grep squid 
> squid.x86_64                         7:3.1.10-20.el6_5.3
> 
> The https sites work fine if I put a direct hole in the firewall to 
> allow internet traffic directly out - but this is not a solution.
> 
> Thanks, Glenn

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUNF1uAAoJENxnfXtQ8ZQUlfYH/i0o9MQDTt8g5aINRljVSMZc
btC8mcYn/JYn4WUPIoOc4/MhvuYg0JO6hXsSoPxjI1khMrq9fTV2c8eaLItWqYCf
hjioWPJs2hPwfw6WDi0I6kF0Is+hD/MGsJci7s+jg593lHnm+ZjoDIHj0aCpcdgy
u95961yZWXINbYsjTirFftnX5UC5MWbwZjaah6zW84RKZl/pa1vJM/tdgqiLdE5V
GDNhS01mbKPfin8oc/RQk4nYAK39vncSebvSHJwkvPJIKlb54Yti64j6qUfPsav3
uUvIVKSpxZjFFJoLtw1zjn1MwyynoHNGT1lP+HptsGkDoeGJ6YWU/IwB1sFKcVk=
=GKmE
-----END PGP SIGNATURE-----
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
 
This message (including any attachments) is confidential and may be legally privileged. If you are not the intended recipient, you should not disclose, copy or use any part of it - please delete all copies immediately and notify the Bradnam Group Helpdesk at helpdesk at bradnams.com.au 

Any information, statements or opinions contained in this message (including any attachments) are given by the author. They are not given on behalf of the Bradnam Group unless subsequently confirmed by an individual other than the author who is duly authorised to represent the Bradnam Group (or any of its subsidiary and associate companies).

All sent and received email from/to the Bradnam Group (or any of its subsidiary and associate companies) is automatically scanned for the presence of computer viruses, security issues and inappropriate content.

For further information on the services which the Bradnam Group provides visit our web
site(s) at www.bradnams.com.au or www.nationalglass.com.au _______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

From squid at visolve.com  Fri Oct 10 04:57:39 2014
From: squid at visolve.com (Visolve Squid)
Date: Fri, 10 Oct 2014 10:27:39 +0530
Subject: [squid-users] https issues for google
In-Reply-To: <2329B68B3D676246BA0D1149E22F509F01A0293D@bneseqs20.bradnams.com.au>
References: <2329B68B3D676246BA0D1149E22F509F01A02886@bneseqs20.bradnams.com.au>
 <54345D6E.3090403@ngtech.co.il>
 <2329B68B3D676246BA0D1149E22F509F01A028F4@bneseqs20.bradnams.com.au>
 <2329B68B3D676246BA0D1149E22F509F01A0293D@bneseqs20.bradnams.com.au>
Message-ID: <54376743.7000406@visolve.com>

Hi,

Check the below acl rule in your squid configuration file to Block the 
particular Domain URLs and also block keywords itself.

# ACL block sites
acl blocksites dstdomain  .youtube.com

# ACL block keywords
acl blockkeywords url_regex -i .youtube.com

#Deny access to block keywords ACL  &  block sites ACL's
http_access deny blockkeywords
http_access deny blocksites

And check the access.log file in the squid.

Regards,
ViSolve Squid
On 10/10/2014 4:32 AM, glenn.groves at bradnams.com.au wrote:
> I was able to capture the log at the time this happened to me, I got the following in the access.log:
>
> 1412895309.389     84 10.10.10.69 TCP_MISS/200 0 CONNECT www.youtube.com:443 <MYADUSER> DIRECT/74.125.237.160 -
> 1412895311.770      0 10.10.10.69 TCP_DENIED/407 3983 CONNECT www.youtube.com:443 - NONE/- text/html
> 1412895311.852     77 10.10.10.69 TCP_MISS/200 0 CONNECT www.youtube.com:443 <MYADUSER> DIRECT/74.125.237.160 -
> 1412895311.855      0 10.10.10.69 TCP_DENIED/407 3983 CONNECT www.youtube.com:443 - NONE/- text/html
> 1412895311.937     77 10.10.10.69 TCP_MISS/200 0 CONNECT www.youtube.com:443 <MYADUSER> DIRECT/74.125.237.160 -
> 1412895311.941      0 10.10.10.69 TCP_DENIED/407 3983 CONNECT www.youtube.com:443 - NONE/- text/html
> 1412895312.053    107 10.10.10.69 TCP_MISS/200 0 CONNECT www.youtube.com:443 <MYADUSER> DIRECT/74.125.237.160 -
> 1412895312.056      0 10.10.10.69 TCP_DENIED/407 3983 CONNECT www.youtube.com:443 - NONE/- text/html
> 1412895312.124     65 10.10.10.69 TCP_MISS/200 0 CONNECT www.youtube.com:443 <MYADUSER> DIRECT/74.125.237.160 -
> 1412895312.680      0 10.10.10.69 TCP_DENIED/407 3983 CONNECT www.youtube.com:443 - NONE/- text/html
> 1412895312.765     79 10.10.10.69 TCP_MISS/200 0 CONNECT www.youtube.com:443 <MYADUSER> DIRECT/74.125.237.160 -
> 1412895312.768      0 10.10.10.69 TCP_DENIED/407 3983 CONNECT www.youtube.com:443 - NONE/- text/html
> 1412895312.846     74 10.10.10.69 TCP_MISS/200 0 CONNECT www.youtube.com:443 <MYADUSER> DIRECT/74.125.237.160 -
> 1412895312.851      0 10.10.10.69 TCP_DENIED/407 3983 CONNECT www.youtube.com:443 - NONE/- text/html
> 1412895312.927     73 10.10.10.69 TCP_MISS/200 0 CONNECT www.youtube.com:443 <MYADUSER> DIRECT/74.125.237.160 -
> 1412895312.931      0 10.10.10.69 TCP_DENIED/407 3983 CONNECT www.youtube.com:443 - NONE/- text/html
>
> Not sure why it would be saying TCP_MISS, I assume the TCP_DENIED is expected as it happens after the TCP_MISS and has no authentication information.
>
>
> -----Original Message-----
> From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of glenn.groves at bradnams.com.au
> Sent: Thursday, 9 October 2014 9:04 AM
> To: eliezer at ngtech.co.il; squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] https issues for google
>
> Hi Eliezer,
>
> The DNS we are using is the ISP default for external, our internal domain DNS for internal. Nslookup works for all tests.
>
> I would like to update to the latest stable, but I am concerned of breaking the current setup. It took a little work to get it working correctly particularity on the multiple authentication methods working with our domain and trust.
>
> I support what has been said - to check the logs. This will likely take time as I cannot reproduce this issue on demand - and I think users are starting to not report the issue and just living with it (or it is not getting all the way to me at least). I will have to get lucky at some point on my computer and look into it then.
>
> Could squid be getting mixed up when mulipule https requests are to the same address (e.g. https://google.com.au)?
>
> Thanks,
>
> Glenn
>
> -----Original Message-----
> From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Eliezer Croitoru
> Sent: Wednesday, 8 October 2014 7:39 AM
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] https issues for google
>
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Hey Glenn,
>
> Since you are not using intercept or tproxy the basic place to look at is the access.log.
> You can see there if the proxy is trying for example to reach an IPV6 address (by mistake).
>
> Also to make sure there is an issue you can use specific exception like the cacheadmin acl you are using to allow the cacheadmin access without authentication for the basic test.
>
> Also you are indeed using the latest CentOS 6.5 squid but since the current stable version is 3.4.8 you should try to upgrade(to something else then 3.1) due to other issues.
>
> The issue can be a network or dns related issue which was not detected until now.
>
> Please first make sure that the access.log and cache.log files are clean for errors or issues.
>
> What dns servers are you using?
>
> Eliezer
>
> On 10/07/2014 06:51 AM, glenn.groves at bradnams.com.au wrote:
>> Hi All,
>>
>> We have a weird issue where https sites apparently don't respond (get
>> message "this page can't be displayed"). This mainly affects google
>> websites and to a lesser affect youtube. It has been reported it may
>> have affected some banking sites but this is unconfirmed. We are
>> running centos 6.5 with up to date squid from the centos repositories.
>>
>> Here is the version of squid: yum list installed | grep squid
>> squid.x86_64                         7:3.1.10-20.el6_5.3
>>
>> The https sites work fine if I put a direct hole in the firewall to
>> allow internet traffic directly out - but this is not a solution.
>>
>> Thanks, Glenn
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1
>
> iQEcBAEBAgAGBQJUNF1uAAoJENxnfXtQ8ZQUlfYH/i0o9MQDTt8g5aINRljVSMZc
> btC8mcYn/JYn4WUPIoOc4/MhvuYg0JO6hXsSoPxjI1khMrq9fTV2c8eaLItWqYCf
> hjioWPJs2hPwfw6WDi0I6kF0Is+hD/MGsJci7s+jg593lHnm+ZjoDIHj0aCpcdgy
> u95961yZWXINbYsjTirFftnX5UC5MWbwZjaah6zW84RKZl/pa1vJM/tdgqiLdE5V
> GDNhS01mbKPfin8oc/RQk4nYAK39vncSebvSHJwkvPJIKlb54Yti64j6qUfPsav3
> uUvIVKSpxZjFFJoLtw1zjn1MwyynoHNGT1lP+HptsGkDoeGJ6YWU/IwB1sFKcVk=
> =GKmE
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>   
> This message (including any attachments) is confidential and may be legally privileged. If you are not the intended recipient, you should not disclose, copy or use any part of it - please delete all copies immediately and notify the Bradnam Group Helpdesk at helpdesk at bradnams.com.au
>
> Any information, statements or opinions contained in this message (including any attachments) are given by the author. They are not given on behalf of the Bradnam Group unless subsequently confirmed by an individual other than the author who is duly authorised to represent the Bradnam Group (or any of its subsidiary and associate companies).
>
> All sent and received email from/to the Bradnam Group (or any of its subsidiary and associate companies) is automatically scanned for the presence of computer viruses, security issues and inappropriate content.
>
> For further information on the services which the Bradnam Group provides visit our web
> site(s) at www.bradnams.com.au or www.nationalglass.com.au _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From squid3 at treenet.co.nz  Fri Oct 10 05:08:08 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 10 Oct 2014 18:08:08 +1300
Subject: [squid-users] https issues for google
In-Reply-To: <2329B68B3D676246BA0D1149E22F509F01A0293D@bneseqs20.bradnams.com.au>
References: <2329B68B3D676246BA0D1149E22F509F01A02886@bneseqs20.bradnams.com.au>
 <54345D6E.3090403@ngtech.co.il>
 <2329B68B3D676246BA0D1149E22F509F01A028F4@bneseqs20.bradnams.com.au>
 <2329B68B3D676246BA0D1149E22F509F01A0293D@bneseqs20.bradnams.com.au>
Message-ID: <543769B8.0@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 10/10/2014 12:02 p.m., glenn.groves at bradnams.com.au wrote:
> I was able to capture the log at the time this happened to me, I
> got the following in the access.log:
> 
> 1412895309.389     84 10.10.10.69 TCP_MISS/200 0 CONNECT
> www.youtube.com:443 <MYADUSER> DIRECT/74.125.237.160 - 
> 1412895311.770      0 10.10.10.69 TCP_DENIED/407 3983 CONNECT
> www.youtube.com:443 - NONE/- text/html 1412895311.852     77
> 10.10.10.69 TCP_MISS/200 0 CONNECT www.youtube.com:443 <MYADUSER>
> DIRECT/74.125.237.160 - 1412895311.855      0 10.10.10.69
> TCP_DENIED/407 3983 CONNECT www.youtube.com:443 - NONE/- text/html 
> 1412895311.937     77 10.10.10.69 TCP_MISS/200 0 CONNECT
> www.youtube.com:443 <MYADUSER> DIRECT/74.125.237.160 - 
> 1412895311.941      0 10.10.10.69 TCP_DENIED/407 3983 CONNECT
> www.youtube.com:443 - NONE/- text/html 1412895312.053    107
> 10.10.10.69 TCP_MISS/200 0 CONNECT www.youtube.com:443 <MYADUSER>
> DIRECT/74.125.237.160 - 1412895312.056      0 10.10.10.69
> TCP_DENIED/407 3983 CONNECT www.youtube.com:443 - NONE/- text/html 
> 1412895312.124     65 10.10.10.69 TCP_MISS/200 0 CONNECT
> www.youtube.com:443 <MYADUSER> DIRECT/74.125.237.160 - 
> 1412895312.680      0 10.10.10.69 TCP_DENIED/407 3983 CONNECT
> www.youtube.com:443 - NONE/- text/html 1412895312.765     79
> 10.10.10.69 TCP_MISS/200 0 CONNECT www.youtube.com:443 <MYADUSER>
> DIRECT/74.125.237.160 - 1412895312.768      0 10.10.10.69
> TCP_DENIED/407 3983 CONNECT www.youtube.com:443 - NONE/- text/html 
> 1412895312.846     74 10.10.10.69 TCP_MISS/200 0 CONNECT
> www.youtube.com:443 <MYADUSER> DIRECT/74.125.237.160 - 
> 1412895312.851      0 10.10.10.69 TCP_DENIED/407 3983 CONNECT
> www.youtube.com:443 - NONE/- text/html 1412895312.927     73
> 10.10.10.69 TCP_MISS/200 0 CONNECT www.youtube.com:443 <MYADUSER>
> DIRECT/74.125.237.160 - 1412895312.931      0 10.10.10.69
> TCP_DENIED/407 3983 CONNECT www.youtube.com:443 - NONE/- text/html
> 
> Not sure why it would be saying TCP_MISS, I assume the TCP_DENIED
> is expected as it happens after the TCP_MISS and has no
> authentication information.
> 


This looks like perfectly normal authentication working exactly as it
was designed to work.

Privacy and security requires that client/browsers only send users
credentials if they have to. So the client/browser is doing this:

 * open TCP connection
 * HTTP request (no authentication , hiding user credentials) -> 407
challenge
 * retry HTTP request with authentication

The whole auth handshake sequence is happening in 50-100ms.


Being CONNECT tunnels the TCP connection is always closed after the
tunnel is done. Causing a new auth handshake for each CONNECT.

The MISS just means no cached object was used in the reply (CONNECT
not being cacheable). Thats is also normal, we only recently added the
TCP_TUNNEL label to separate tunnelled vs ssl-bumped CONNECT.
 The "0" in bytes column is result of logging bug on CONNECT byte
counting.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUN2m4AAoJELJo5wb/XPRjx0QH/02x2sHyh3O/S3RuEuyye9Bf
XKHWxwwhYdOa97wZ+dgRPBhl3ge1wqRYxBwDaFbnhh/R652w5j+sJtnXoS0OhD6Z
H0GxuXy7kiekBFEcTDpISKSwKgAmoGjNSEuFVT5vnchf6v3o7eaCTX1fgbpOBd+R
x0mp+HJew76eEOC2tihMpVkRLD6TGg76r3jDOe0y2rbhOqH7Hh1h/7SSST4jNZVw
pz3oflnnMR7h+pk2QIHdDn8Jy4Dmm5waGZHQ1NIyco3wbsm7nmbFMbt+hmf3EGfu
UQCYEuiqx5xh5cgBIrvG+C+lkYdh+CMVLb1xnu0hYGnS0ZikwbaKBnWVkF/I/ZM=
=F5F0
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Fri Oct 10 05:15:46 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 10 Oct 2014 18:15:46 +1300
Subject: [squid-users] https issues for google
In-Reply-To: <2329B68B3D676246BA0D1149E22F509F01A0293D@bneseqs20.bradnams.com.au>
References: <2329B68B3D676246BA0D1149E22F509F01A02886@bneseqs20.bradnams.com.au>
 <54345D6E.3090403@ngtech.co.il>
 <2329B68B3D676246BA0D1149E22F509F01A028F4@bneseqs20.bradnams.com.au>
 <2329B68B3D676246BA0D1149E22F509F01A0293D@bneseqs20.bradnams.com.au>
Message-ID: <54376B82.3050005@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Glenn, I just had a brainstorm.

Your version is 3.1 so you are probably suffering from
http://bugs.squid-cache.org/show_bug.cgi?id=3371

This bug shows up particularly badly when SPDY, WebSockets or HTTP/2
is being attempted by the browser.

If so you can resolve it by upgrading to the current stable squid-3.4.8.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUN2uCAAoJELJo5wb/XPRjh6oH/iSWtqy5WJ9k2Qsex2eTic4R
9S9YyaLmoZSw1gLucn8nj7ZBpYEQCUxzYJfkm43AXYSVmUlUes1deAZrbkn3Bukn
oLmWkGBc92TlwtSuzmvByge6G/C6Elbe9UkXNDsH7+4039zVGZou53hfJlmZOyaf
xRMVw//shhDSDt2Ie+gZC/lChrhFNgGPGX7EP7lJGg4hm9q/ykkobom4K7ZuqieK
UG5jUpQR/l6cbjHjNko0C19GYc5R+5CH2X82orc9DxVQX4nJr3FrbTVwv4SmGDIa
ICMormLQy0QhQLJ0ninqyG17dJh9cPKmBHDX3kzZYbyA6CTCVtXSW/5P240ZRD0=
=Pgg4
-----END PGP SIGNATURE-----


From jbhasin83 at gmail.com  Fri Oct 10 05:57:47 2014
From: jbhasin83 at gmail.com (Jatin Bhasin)
Date: Fri, 10 Oct 2014 16:57:47 +1100
Subject: [squid-users] blockVirgin Works for CONNECT but Custom Response
 does not work
In-Reply-To: <53F7DF54.9020505@measurement-factory.com>
References: <CAGRJihXzGpw7dr-2B_s=oajK97BcG7QzC5OLAPWgpuvtsC0nWg@mail.gmail.com>
 <1408620949946.22246@diladele.com>
 <CAGRJihV0jMFTy5qw66Pq8z+6khujho6hbTM8K1tqycYMBNKjZg@mail.gmail.com>
 <CAGRJihUq0dsinws7ZH7n1P=u5NDGSB08+rCKz6MqLsUm8V=h+g@mail.gmail.com>
 <53F7DF54.9020505@measurement-factory.com>
Message-ID: <CAGRJihX7xqTWJA4RHa99jUmd1k-gtCyE-hq=MzRK4XTHXtgfwA@mail.gmail.com>

Hi Alex,

I used the annotation mechanism as you had suggested. My squid
configuration files looks as below: (For now I am using X-Virus-ID to
see if the concept works for my case)

adaptation_masterx_shared_names X-Virus-ID
acl toBump note X-Virus-ID yes
ssl_bump client-first toBump


My eCap adapter functions which returns yes for the X-Virus-ID are:
=================================================================
const libecap::Area Adapter::Xaction::option(const libecap::Name &name) const
{
std::string str = "yes";
return libecap::Area(str.data(), str.size());
}
--------------------------------------------------------------------------------------------------------------------
void Adapter::Xaction::visitEachOption(libecap::NamedValueVisitor
&visitor) const
{
std::string str = "yes";
    visitor.visit(libecap::metaVirusId, libecap::Area(str.data(), str.size()));
}
=================================================================

Now looking at the log file I see the following. Also, from cache.log
toBump does not seem to be getting matched probably because X-Virus-ID
is not set to yes.
2014/10/10 14:51:21.431 kid1| client_side_request.cc(1551)
sslBumpNeed: sslBump required: none

I have placed debug statements in my eCap adapter function to confirm
if I am seeing CONNECT requests for a URL and also that I am setting
X-Virus-ID to yes. But I am not to understand that what I could be
missing.

Can you please suggest me what I could be missing.



Thanks,
Jatin

On Sat, Aug 23, 2014 at 10:24 AM, Alex Rousskov
<rousskov at measurement-factory.com> wrote:
> On 08/21/2014 07:06 PM, Jatin Bhasin wrote:
>
>> So, can somebody suggest me if there is a way to pass a flag to squid
>> from ecap adapter to decrypt a site regardless of what ACL says. For
>> example if I have an acl as below which says do not decrypt
>> www.888.com but If my ecap adapter could pass a message to squid
>> asking it to decrypt www.888.com (for that session only) and ignore
>> the below acl.
>> Is it possible?
>
>
> Given a recent-enough Squid version, an adaptation service can control
> Squid behavior via the annotations mechanism and the "note" ACL
> associated with it. For example, your eCAP adapter can return an
> X-Bump:yes annotation(**) that Squid can then match using the note ACL.
> Something along these untested lines:
>
>   acl note toBump X-Bump yes
>   ssl_bump server-first toBump
>   ssl_bump server-first ...
>   ssl_bump none all
>
> This mechanism should be supported for ssl_bump ACLs but I have not
> tested that claim myself.
>
>
> HTH,
>
> Alex.
> (**) In eCAP terminology, an X-Bump:yes annotation is an adapter
> transaction option named X-Bump with a "yes" value. See
> libecap::Options, which is a parent of libecap::adapter::Xaction.
>


From gecom at tubosider.it  Fri Oct 10 08:44:30 2014
From: gecom at tubosider.it (masterx81)
Date: Fri, 10 Oct 2014 01:44:30 -0700 (PDT)
Subject: [squid-users] problem with basic_ldap_auth
In-Reply-To: <543603DE.706@treenet.co.nz>
References: <1412678023114-4667736.post@n4.nabble.com>
 <543603DE.706@treenet.co.nz>
Message-ID: <1412930670275-4667796.post@n4.nabble.com>

Nothing to do, seem that if squid fails one of the negotiate_wrapper methods
doesn't use any other method, asking that password (that as you say isn't a
basic auth, as the realm part isn't displayed).
In the logs i get only negotiate_wrapper events. I've also tried to comment
out the pure ntlm and basic auth methods, confirming that aren't actually
used.
This same config was working on 3.4.x, so i think that is a 3.3.13 bug...
Later in the morning (when the users are at launch) i'll try to disable the
negotiate wrapper and leave only basic to see if it work.
If i can't get it work i'll try previous versions, as on the 3.4.x versions
i have a too high cpu usage (most of the time at 100%), while on the 3.3 i
get only around 5%.... With the same config!



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/problem-with-basic-ldap-auth-tp4667736p4667796.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From squid at visolve.com  Fri Oct 10 09:51:55 2014
From: squid at visolve.com (Squid)
Date: Fri, 10 Oct 2014 15:21:55 +0530
Subject: [squid-users] redirect all ports to squid
In-Reply-To: <DUB123-DS15337FBB7B90E43B736C7EB3BB0@phx.gbl>
References: <DUB123-DS15337FBB7B90E43B736C7EB3BB0@phx.gbl>
Message-ID: <5437AC3B.5030402@visolve.com>

Hi,

Yes, we can redirect the ports to squid through our firewall rules.

Check below lines to redirect the ports.
We have some different methods to do.
1. In first Method:
     First, we need to machine that squid will be running on, You do not 
need iptables or any special kernel options on this machine, just squid. 
You *will*, however, need the 'http_accel' options as described above.

     You'll want to use the following set of commands on iptables-box:

  * iptables -t nat -A PREROUTING -i eth0 -s ! *squid-box* -p tcp
    --dport 80 -j DNAT --to *squid-box*:3128
  * iptables -t nat -A POSTROUTING -o eth0 -s *local-network* -d
    *squid-box* -j SNAT --to *iptables-box*
  * iptables -A FORWARD -s *local-network* -d *squid-box* -i eth0 -o
    eth0 -p tcp --dport 3128 -j ACCEPT

2. And have another method:

  * iptables -t mangle -A PREROUTING -j ACCEPT -p tcp --dport 80 -s
    *squid-box*
  * iptables -t mangle -A PREROUTING -j MARK --set-mark 3 -p tcp --dport 80
  * ip rule add fwmark 3 table 2
  * ip route add default via *squid-box* dev eth1 table 2

         (OR)

     iptables -A PREROUTING -t nat -i eth0 -p tcp --dport 80 -j REDIRECT 
--to-port 3128

Regards,
Visolve Squid

On 9/30/2014 10:11 PM, hadi wrote:
> It's possible to redirect all ports to squid ? thru iptables ?
> For example port 25 smtp,143 imap, etc...
> Can squid handle that. In transparent mode.
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141010/b35db325/attachment.htm>

From john.haswell at atlascloud.co.uk  Fri Oct 10 09:56:56 2014
From: john.haswell at atlascloud.co.uk (Haza1981)
Date: Fri, 10 Oct 2014 02:56:56 -0700 (PDT)
Subject: [squid-users] 501 error within a webpage
Message-ID: <1412935016640-4667798.post@n4.nabble.com>

We are having issues with users using a webpage they require
(ondemand.bond.co.uk). They can log in and see most of what they use but
certain sections of the page just say error 501. 

I have checked the access log and see the following information in some
lines. 

TCP_MISS/501 295 DELETE (website and user info)HIER_DIRECT/212.87.94.182
text/html

Is this related and how can I get around this?

Thanks

Also another issue I have is that on this website
http://www.uksuds.com/surfacewaterstorage_js.htm it should show a map on the
front page but does not. Can anyone help with this one? If I specify a
different proxy it pulls the map down and will then work with squid until I
clear cache and cookies.



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/501-error-within-a-webpage-tp4667798.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From gecom at tubosider.it  Fri Oct 10 11:16:40 2014
From: gecom at tubosider.it (masterx81)
Date: Fri, 10 Oct 2014 04:16:40 -0700 (PDT)
Subject: [squid-users] problem with basic_ldap_auth
In-Reply-To: <543603DE.706@treenet.co.nz>
References: <1412678023114-4667736.post@n4.nabble.com>
 <543603DE.706@treenet.co.nz>
Message-ID: <1412939800679-4667799.post@n4.nabble.com>

Ok, i've tried to comment out and leave only one helper at time, and i can
get work only one helper.
If i have only basic helper, and other commented out, it work (asking the
password with the correct realm text), but if i enable other helpers, only
work the one that is first in order on the conf file, the others doesn't
work, and ask me that strange logon request.

Strange thing is that also with the -d option on all helpers i get in the
cache.log file only the negotiate wrapper debug info.

Any help or suggestion before i try to downgrade to a different version?

Thanks!



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/problem-with-basic-ldap-auth-tp4667736p4667799.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From sudakov at sibptus.tomsk.ru  Fri Oct 10 11:36:30 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Fri, 10 Oct 2014 18:36:30 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <m14if3$1ul$2@ger.gmane.org>
References: <20141006040725.GA31642@admin.sibptus.tomsk.ru>
 <20141006052346.GA32369@admin.sibptus.tomsk.ru>
 <20141007070403.GA57384@admin.sibptus.tomsk.ru>
 <20141007083542.GA60425@admin.sibptus.tomsk.ru>
 <m11nv3$nk8$1@ger.gmane.org>
 <20141008032925.GA77544@admin.sibptus.tomsk.ru>
 <m14if3$1ul$2@ger.gmane.org>
Message-ID: <20141010113630.GA39334@admin.sibptus.tomsk.ru>

Colleagues,

What if the service principal's name in squid's keytab does not
coincide with the host's primary FQDN (AKA `hostname`)?

E.g. the squid's keytab contains keys for HTTP/proxy.my.domain while
the server's actual FQDN is fw.my.domain? 

Should it cause the obscure error I have stumbled upon?

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru


From jbhasin83 at gmail.com  Fri Oct 10 11:56:25 2014
From: jbhasin83 at gmail.com (Jatin Bhasin)
Date: Fri, 10 Oct 2014 22:56:25 +1100
Subject: [squid-users] blockVirgin Works for CONNECT but Custom Response
 does not work
In-Reply-To: <CAGRJihX7xqTWJA4RHa99jUmd1k-gtCyE-hq=MzRK4XTHXtgfwA@mail.gmail.com>
References: <CAGRJihXzGpw7dr-2B_s=oajK97BcG7QzC5OLAPWgpuvtsC0nWg@mail.gmail.com>
 <1408620949946.22246@diladele.com>
 <CAGRJihV0jMFTy5qw66Pq8z+6khujho6hbTM8K1tqycYMBNKjZg@mail.gmail.com>
 <CAGRJihUq0dsinws7ZH7n1P=u5NDGSB08+rCKz6MqLsUm8V=h+g@mail.gmail.com>
 <53F7DF54.9020505@measurement-factory.com>
 <CAGRJihX7xqTWJA4RHa99jUmd1k-gtCyE-hq=MzRK4XTHXtgfwA@mail.gmail.com>
Message-ID: <CAGRJihUdL99qd5Sc3AvgpJ2CGMPB_Fja6AN9t=TxfzHJ+aQcQw@mail.gmail.com>

Hi Alex,

Looking at cache.log I see that X-Virus-ID is set to yes but the eCap
adapter functions. But I do not know that how it will be picked up
note acl. Please suggest.


2014/10/10 22:50:55.341 kid1| HttpHeader.cc(1272) putExt:
0x7fff1d656f80 adds ext entry X-Virus-ID : yes
2014/10/10 22:50:55.341 kid1| HttpHeader.cc(1525) HttpHeaderEntry:
created HttpHeaderEntry 0x1722650: 'X-Virus-ID : yes
2014/10/10 22:50:55.341 kid1| HttpHeader.cc(907) addEntry:
0x7fff1d656f80 adding entry: 77 at 0
2014/10/10 22:50:55.341 kid1| HttpHeader.cc(442) clean: cleaning hdr:
0x1722538 owner: 3
2014/10/10 22:50:55.341 kid1| HttpHeader.cc(818) delByName: deleting
'X-Virus-ID' fields in hdr 0x1722538
2014/10/10 22:50:55.341 kid1| HttpHeader.cc(533) update: Updating
header 'Other:' in cached entry
2014/10/10 22:50:55.341 kid1| HttpHeader.cc(1525) HttpHeaderEntry:
created HttpHeaderEntry 0x1722720: 'X-Virus-ID : yes
2014/10/10 22:50:55.341 kid1| HttpHeader.cc(907) addEntry: 0x1722538
adding entry: 77 at 0
2014/10/10 22:50:55.341 kid1| HttpHeader.cc(818) delByName: deleting
'X-Virus-ID' fields in hdr 0x1722568
2014/10/10 22:50:55.341 kid1| HttpHeader.cc(533) update: Updating
header 'Other:' in cached entry
2014/10/10 22:50:55.341 kid1| HttpHeader.cc(1525) HttpHeaderEntry:
created HttpHeaderEntry 0x17227f0: 'X-Virus-ID : yes
2014/10/10 22:50:55.341 kid1| HttpHeader.cc(907) addEntry: 0x1722568
adding entry: 77 at 0
2014/10/10 22:50:55.341 kid1| HttpHeader.cc(442) clean: cleaning hdr:
0x7fff1d656f80 owner: 3
2014/10/10 22:50:55.341 kid1| HttpHeader.cc(1531) ~HttpHeaderEntry:
destroying entry 0x1722650: 'X-Virus-ID: yes'

On Fri, Oct 10, 2014 at 4:57 PM, Jatin Bhasin <jbhasin83 at gmail.com> wrote:
> Hi Alex,
>
> I used the annotation mechanism as you had suggested. My squid
> configuration files looks as below: (For now I am using X-Virus-ID to
> see if the concept works for my case)
>
> adaptation_masterx_shared_names X-Virus-ID
> acl toBump note X-Virus-ID yes
> ssl_bump client-first toBump
>
>
> My eCap adapter functions which returns yes for the X-Virus-ID are:
> =================================================================
> const libecap::Area Adapter::Xaction::option(const libecap::Name &name) const
> {
> std::string str = "yes";
> return libecap::Area(str.data(), str.size());
> }
> --------------------------------------------------------------------------------------------------------------------
> void Adapter::Xaction::visitEachOption(libecap::NamedValueVisitor
> &visitor) const
> {
> std::string str = "yes";
>     visitor.visit(libecap::metaVirusId, libecap::Area(str.data(), str.size()));
> }
> =================================================================
>
> Now looking at the log file I see the following. Also, from cache.log
> toBump does not seem to be getting matched probably because X-Virus-ID
> is not set to yes.
> 2014/10/10 14:51:21.431 kid1| client_side_request.cc(1551)
> sslBumpNeed: sslBump required: none
>
> I have placed debug statements in my eCap adapter function to confirm
> if I am seeing CONNECT requests for a URL and also that I am setting
> X-Virus-ID to yes. But I am not to understand that what I could be
> missing.
>
> Can you please suggest me what I could be missing.
>
>
>
> Thanks,
> Jatin
>
> On Sat, Aug 23, 2014 at 10:24 AM, Alex Rousskov
> <rousskov at measurement-factory.com> wrote:
>> On 08/21/2014 07:06 PM, Jatin Bhasin wrote:
>>
>>> So, can somebody suggest me if there is a way to pass a flag to squid
>>> from ecap adapter to decrypt a site regardless of what ACL says. For
>>> example if I have an acl as below which says do not decrypt
>>> www.888.com but If my ecap adapter could pass a message to squid
>>> asking it to decrypt www.888.com (for that session only) and ignore
>>> the below acl.
>>> Is it possible?
>>
>>
>> Given a recent-enough Squid version, an adaptation service can control
>> Squid behavior via the annotations mechanism and the "note" ACL
>> associated with it. For example, your eCAP adapter can return an
>> X-Bump:yes annotation(**) that Squid can then match using the note ACL.
>> Something along these untested lines:
>>
>>   acl note toBump X-Bump yes
>>   ssl_bump server-first toBump
>>   ssl_bump server-first ...
>>   ssl_bump none all
>>
>> This mechanism should be supported for ssl_bump ACLs but I have not
>> tested that claim myself.
>>
>>
>> HTH,
>>
>> Alex.
>> (**) In eCAP terminology, an X-Bump:yes annotation is an adapter
>> transaction option named X-Bump with a "yes" value. See
>> libecap::Options, which is a parent of libecap::adapter::Xaction.
>>


From squid3 at treenet.co.nz  Fri Oct 10 15:15:54 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 11 Oct 2014 04:15:54 +1300
Subject: [squid-users] 501 error within a webpage
In-Reply-To: <1412935016640-4667798.post@n4.nabble.com>
References: <1412935016640-4667798.post@n4.nabble.com>
Message-ID: <5437F82A.8080308@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 10/10/2014 10:56 p.m., Haza1981 wrote:
> We are having issues with users using a webpage they require 
> (ondemand.bond.co.uk). They can log in and see most of what they
> use but certain sections of the page just say error 501.
> 
> I have checked the access log and see the following information in
> some lines.
> 
> TCP_MISS/501 295 DELETE (website and user
> info)HIER_DIRECT/212.87.94.182 text/html

The web server 212.87.94.182 does not support users DELETE/erase for
content at that URL.

status code 501 "Not Implemented":
http://tools.ietf.org/html/rfc7231#section-6.6.2

... and the DELETE metods which is being rejected:
http://tools.ietf.org/html/rfc7231#section-4.3.5

> 
> Is this related and how can I get around this?

Stop trying to delete things on public website?

Seriously though, I agree those DELETE+501 records in Squid access log
is probably the record of how the 501 appeared to the users. What
started it though will be something in the client browser or some
script in the page itself. Squid is just relaying the messages between
client browser and web server.

Squid is not part of the problem, but is one of the tools you can use
to get information about the transaction to find out wher ethe problem
actually is.

If you have a recent Squid build, you can set debug_options 11,2 and
get a full traffic trace.
Other alternatives are "tcpdump -s 65535" traces, or the browser
development tools if you can replicate it yourself.

> 
> Thanks
> 
> Also another issue I have is that on this website 
> http://www.uksuds.com/surfacewaterstorage_js.htm it should show a
> map on the front page but does not. Can anyone help with this one?
> If I specify a different proxy it pulls the map down and will then
> work with squid until I clear cache and cookies.
> 

Theres not enough details in that description to answer. Using the
same methods/tools as mentioned above you can find out whats going on
there too.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUN/gqAAoJELJo5wb/XPRja7QH/105bq1YXhnVKZy53m7SDDH8
T5dEUZ8E25/5UwPopXn+C14dIgcBEa5Qvg1KMmZnGn3MaRTn1kzFN8ngf0gZOz7N
l05N+1o8o4PjGjrWNd+71jorb/0og1XrgidTXipGpbm/+UfsrCDartfwkiE9NLqj
nlsVLjP4ZPvhi2J/7tpzxltveQ3okgjZ52g3ztFqgOjzde2aIs11HuUSptj5UPi9
6MaKPiw+NSOytq0f365RH40hSPAFeiXeKX1Ah1aDW//Z35wTHbCDbczSwPMAboE+
UVxO+MEGd2xbKNL4dV99CAdHNRk2Ybx9IrTDraPNHDR0tTpv0wgP7LDpoYJ8kWk=
=3yNu
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Fri Oct 10 15:18:34 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 11 Oct 2014 04:18:34 +1300
Subject: [squid-users] problem with basic_ldap_auth
In-Reply-To: <1412930670275-4667796.post@n4.nabble.com>
References: <1412678023114-4667736.post@n4.nabble.com>
 <543603DE.706@treenet.co.nz> <1412930670275-4667796.post@n4.nabble.com>
Message-ID: <5437F8CA.2040503@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 10/10/2014 9:44 p.m., masterx81 wrote:
> Nothing to do, seem that if squid fails one of the
> negotiate_wrapper methods doesn't use any other method, asking that
> password (that as you say isn't a basic auth, as the realm part
> isn't displayed). In the logs i get only negotiate_wrapper events.
> I've also tried to comment out the pure ntlm and basic auth
> methods, confirming that aren't actually used. This same config was
> working on 3.4.x, so i think that is a 3.3.13 bug... Later in the
> morning (when the users are at launch) i'll try to disable the 
> negotiate wrapper and leave only basic to see if it work. If i
> can't get it work i'll try previous versions, as on the 3.4.x
> versions i have a too high cpu usage (most of the time at 100%),
> while on the 3.3 i get only around 5%.... With the same config!
> 

Perhapse we should try to debug that 34 CPU usage a bit more?
Then you and everyone else suffering from it can benefit from the
other 3.4 fixes.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUN/jKAAoJELJo5wb/XPRjAIIIAKmGgrcZFYkK2KLnYcQpkSK6
BOQUiaFPDmqINW2uvVT/fLei5DfEr75Y7Q5obc0/nYxeKA/39jSTaBhzWFqkwRjT
xOTKo7jGeTeprzG8F5J4k30D6qe8m6myFWbKEq1TlaZLMYjZpUgy31FPSTZ9C8/5
3b0NC5mkZ0Z0xJjXJYgMLWqIDJZ2EMF9SnMDg8ndLf7rETyq+JUOgWMGXHkDDBPt
q8c8YVin5VauOhwvoO7JoEJ5xkDIJ4IxPa72b0vS5vi91NdH+rgeU878TZ/Y7xeO
zoqyZnNt6LgNJcMdsczTKqx4IsTO+AMn0+fG3DZGvAqmVd+aHWcWNmtiBBa7uIs=
=MVwt
-----END PGP SIGNATURE-----


From rousskov at measurement-factory.com  Fri Oct 10 15:18:36 2014
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 10 Oct 2014 09:18:36 -0600
Subject: [squid-users] blockVirgin Works for CONNECT but Custom Response
 does not work
In-Reply-To: <CAGRJihX7xqTWJA4RHa99jUmd1k-gtCyE-hq=MzRK4XTHXtgfwA@mail.gmail.com>
References: <CAGRJihXzGpw7dr-2B_s=oajK97BcG7QzC5OLAPWgpuvtsC0nWg@mail.gmail.com>	<1408620949946.22246@diladele.com>	<CAGRJihV0jMFTy5qw66Pq8z+6khujho6hbTM8K1tqycYMBNKjZg@mail.gmail.com>	<CAGRJihUq0dsinws7ZH7n1P=u5NDGSB08+rCKz6MqLsUm8V=h+g@mail.gmail.com>	<53F7DF54.9020505@measurement-factory.com>
 <CAGRJihX7xqTWJA4RHa99jUmd1k-gtCyE-hq=MzRK4XTHXtgfwA@mail.gmail.com>
Message-ID: <5437F8CC.1050305@measurement-factory.com>

On 10/09/2014 11:57 PM, Jatin Bhasin wrote:

> adaptation_masterx_shared_names X-Virus-ID
> acl toBump note X-Virus-ID yes
> ssl_bump client-first toBump

OK.


> My eCap adapter functions which returns yes for the X-Virus-ID are:
> =================================================================
> const libecap::Area Adapter::Xaction::option(const libecap::Name &name) const
> {
> std::string str = "yes";
> return libecap::Area(str.data(), str.size());
> }

Two bugs here:

* You are returning a pointer to str, which is a temporary, on-stack
storage. Use libecap::Area::FromTempString() instead.

* You are returning "yes" value for all option names. The return value
should be conditional on name parameter being lequal to
libecap::metaVirusId ("X-Virus-ID").

These two bugs may not actually affect you (for several reasons), but
you should fix them anyway.


> --------------------------------------------------------------------------------------------------------------------
> void Adapter::Xaction::visitEachOption(libecap::NamedValueVisitor
> &visitor) const
> {
> std::string str = "yes";
>     visitor.visit(libecap::metaVirusId, libecap::Area(str.data(), str.size()));
> }

There is no need for std::string in this case, but the above code is not
buggy, just inefficient.


> Looking at cache.log I see that X-Virus-ID is set to yes but the eCap
> adapter functions. But I do not know that how it will be picked up
> note acl. Please suggest.

I agree that Squid seems to receive the X-Virus-ID:yes metaheader from
the eCAP adapter, but your toBump ACL still does not match. I cannot
tell why that is [not] happening by looking at the cache log, unfortunately.

You may want to add debugging to ACLNoteData::match and
ACLNoteData::matchNotes in src/acl/NoteData.cc to see if the ACL code
has access to the eCAP history with X-Virus-ID metaheader.

The only theory I can offer right now is that the code handling
annotations for CONNECT requests is broken and does not store or does
not preserve annotations received from eCAP adapters. CONNECT requests
are treated specially in Squid. You can try to test that theory by
annotating GET requests, for example.

Another good test is to log your annotation to access.log using %note
logformat code. If it is not logged, Squid probably lost it. If it is
logged, then the ACL code does not have access to the information for
some reason. This test can be done for both CONNECT and GET requests.


HTH,

Alex.



> On Sat, Aug 23, 2014 at 10:24 AM, Alex Rousskov wrote:
>> On 08/21/2014 07:06 PM, Jatin Bhasin wrote:
>>
>>> So, can somebody suggest me if there is a way to pass a flag to squid
>>> from ecap adapter to decrypt a site regardless of what ACL says. For
>>> example if I have an acl as below which says do not decrypt
>>> www.888.com but If my ecap adapter could pass a message to squid
>>> asking it to decrypt www.888.com (for that session only) and ignore
>>> the below acl.
>>> Is it possible?
>>
>>
>> Given a recent-enough Squid version, an adaptation service can control
>> Squid behavior via the annotations mechanism and the "note" ACL
>> associated with it. For example, your eCAP adapter can return an
>> X-Bump:yes annotation(**) that Squid can then match using the note ACL.
>> Something along these untested lines:
>>
>>   acl note toBump X-Bump yes
>>   ssl_bump server-first toBump
>>   ssl_bump server-first ...
>>   ssl_bump none all
>>
>> This mechanism should be supported for ssl_bump ACLs but I have not
>> tested that claim myself.
>>
>>
>> HTH,
>>
>> Alex.
>> (**) In eCAP terminology, an X-Bump:yes annotation is an adapter
>> transaction option named X-Bump with a "yes" value. See
>> libecap::Options, which is a parent of libecap::adapter::Xaction.
>>



From john.haswell at atlascloud.co.uk  Fri Oct 10 15:33:45 2014
From: john.haswell at atlascloud.co.uk (Haza1981)
Date: Fri, 10 Oct 2014 08:33:45 -0700 (PDT)
Subject: [squid-users] 501 error within a webpage
In-Reply-To: <5437F82A.8080308@treenet.co.nz>
References: <1412935016640-4667798.post@n4.nabble.com>
 <5437F82A.8080308@treenet.co.nz>
Message-ID: <1412955225274-4667805.post@n4.nabble.com>

If I specify our tmg proxy instead the 500 error does not appear. Instead
they have clickable links there. 



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/500-internal-error-within-a-webpage-tp4667798p4667805.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From jborrell at central.aplitec.com  Fri Oct 10 16:00:56 2014
From: jborrell at central.aplitec.com (Josep Borrell)
Date: Fri, 10 Oct 2014 16:00:56 +0000
Subject: [squid-users] unexplained MISSes
Message-ID: <42DE25A255671C44A93A7B58470DC09C48246F63@Michelle.aplitec.local>

Hi,

I'm trying build a squid server that can cache youtube request for a school.
I'm using squid 3.4.7 compiled from source on Ubuntu server 14.04
I have a lot of request that are cached, but not served from cache and generate a TCP_MISS/200
I'm trying to figure why this requests are not served from cache.
Please find attached squid.conf and cache.log sample with debug enabled.

I hope someone can help me.

Thanks

Josep

*************************************************** access.log *******************************************************************

1412953551.775    167 192.168.1.112 TCP_MISS/200 4344 GET http://i1.ytimg.com/vi/9_iANxI-Mrc/default.jpg - ORIGINAL_DST/74.125.230.3 image/jpeg

****************************** cache.log ******************************************************************************************
----------
2014/10/10 17:05:51.772| ctx: enter level  0: 'http://ytimg.com.squid.internal/vi/9_iANxI-Mrc/default.jpg'
2014/10/10 17:05:51.773| http.cc(705) processReplyHeader: processReplyHeader: key '9F1BB8D27BED16A8B74F8995105B2941'
2014/10/10 17:05:51.773| http.cc(749) processReplyHeader: HTTP Server local=192.168.111.10:59210 remote=74.125.230.3:80 FD 65 flags=1
2014/10/10 17:05:51.773| http.cc(750) processReplyHeader: HTTP Server REPLY:
---------
HTTP/1.1 200 OK
Content-Type: image/jpeg
Last-Modified: Thu, 01 Jan 1970 00:23:21 GMT
Date: Fri, 10 Oct 2014 10:45:51 GMT
Expires: Fri, 10 Oct 2014 16:45:51 GMT
X-Content-Type-Options: nosniff
Server: sffe
Content-Length: 3861
X-XSS-Protection: 1; mode=block
Age: 15619
Cache-Control: public, max-age=21600
Alternate-Protocol: 80:quic,p=0.01

????????????
----------
2014/10/10 17:05:51.773| ctx: exit level  0
2014/10/10 17:05:51.773| ctx: enter level  0: 'http://ytimg.com.squid.internal/vi/9_iANxI-Mrc/default.jpg'
2014/10/10 17:05:51.773| http.cc(919) haveParsedReplyHeaders: HTTP CODE: 200
2014/10/10 17:05:51.773| refresh.cc(247) refreshCheck: refreshCheck: 'http://ytimg.com.squid.internal/vi/9_iANxI-Mrc/default.jpg'
2014/10/10 17:05:51.773| refresh.cc(262) refreshCheck: refreshCheck: Matched '^http:\/\/ytimg\.com\.squid\.internal.* 604800 80%% 4794000'
2014/10/10 17:05:51.773| refresh.cc(264) refreshCheck:  age:    15679
2014/10/10 17:05:51.773| refresh.cc(266) refreshCheck:  check_time:     Fri, 10 Oct 2014 15:06:51 GMT
2014/10/10 17:05:51.773| refresh.cc(268) refreshCheck:  entry->timestamp:       Fri, 10 Oct 2014 10:45:32 GMT
2014/10/10 17:05:51.773| refresh.cc(171) refreshStaleness: FRESH: expires 1412959532 >= check_time 1412953611
2014/10/10 17:05:51.773| refresh.cc(288) refreshCheck: Staleness = -1
2014/10/10 17:05:51.773| refresh.cc(373) refreshCheck: refreshCheck: object isn't stale..
2014/10/10 17:05:51.773| refresh.cc(375) refreshCheck: refreshCheck: returning FRESH_EXPIRES
2014/10/10 17:05:51.773| http.cc(482) cacheableReply: YES because HTTP status 200
2014/10/10 17:05:51.774| ctx: exit level  0
2014/10/10 17:05:51.774| client_side.cc(1459) sendStartOfMessage: HTTP Client local=74.125.230.3:80 remote=192.168.1.112:50084 FD 62 flags=33
2014/10/10 17:05:51.774| client_side.cc(1460) sendStartOfMessage: HTTP Client REPLY:
---------
HTTP/1.1 200 OK
Content-Type: image/jpeg
Last-Modified: Thu, 01 Jan 1970 00:23:21 GMT
Date: Fri, 10 Oct 2014 10:45:51 GMT
Expires: Fri, 10 Oct 2014 16:45:51 GMT
X-Content-Type-Options: nosniff
Server: sffe
Content-Length: 3861
X-XSS-Protection: 1; mode=block
Age: 15619
Cache-Control: public, max-age=21600
Alternate-Protocol: 80:quic,p=0.01
X-Cache: MISS from squid-v2
X-Cache-Lookup: MISS from squid-v2:3128
Via: 1.1 squid-v2 (squid/3.4.7)
Connection: keep-alive


----------


********************************************************************** squid.conf *******************************************************

# debug helper
#debug_options 84,3
#debug Refresh Calculation
#debug_options 22,3
# HTTP
#debug_options 11,3

debug_options 11,3 22,3 84,3


acl customernet src 172.16.212.154/32
acl customernet src 192.168.1.0/24


acl SSL_ports port 443
acl SSL_ports port 873  # rsync

acl Safe_ports port 80         # http
acl Safe_ports port 21         # ftp
acl Safe_ports port 443        # https
acl Safe_ports port 70         # gopher
acl Safe_ports port 210        # wais
acl Safe_ports port 1025-65535 # unregistered ports
acl Safe_ports port 280        # http-mgmt
acl Safe_ports port 488        # gss-http
acl Safe_ports port 591        # filemaker
acl Safe_ports port 777        # multiling http
acl CONNECT method CONNECT

http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
http_access allow localhost
http_access allow customernet
http_access deny all
# http_access allow all

#HTTPS (SSL) trafic interception options
always_direct allow SSL_ports
ssl_bump server-first SSL_ports
#sslproxy_cert_error deny all
#sslproxy_flags DONT_VERIFY_PEER
sslcrtd_program /usr/lib/squid3/ssl_crtd -s /var/spool/squid3_ssldb -M 4MB
sslcrtd_children 8 startup=1 idle=1

acl rewritedoms dstdomain .c.youtube.com .googlevideo.com .ytimg.com
store_id_program /usr/lib/squid3/storeid_file_rewrite /etc/squid3/storeid_rewrite
store_id_children 40 startup=10 idle=5 concurrency=0
store_id_access allow rewritedoms
store_id_access deny all


http_port 3128
http_port 8080 intercept
https_port 8081 intercept ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB cert=/etc/squid3/ssl_cert/squidcert.pem


forward_max_tries 25
cache_mem 2 GB
maximum_object_size_in_memory 25 MB
maximum_object_size 1 GB

visible_hostname squid-v2
dns_v4_first on


coredump_dir /var/spool/squid3
cache_replacement_policy heap LFUDA
cache_dir aufs /var/spool/squid3 14000 16 256

refresh_pattern ^http:\/\/video-srv\.(googlevideo|youtube)\.com\.squid\.internal.*  10080 80%  79900 override-lastmod override-expire ignore-reload ignore-must-revalidate ignore-private
refresh_pattern ^http:\/\/ytimg\.com\.squid\.internal.*  10080 80%  79900 override-lastmod override-expire ignore-reload ignore-must-revalidate ignore-private
refresh_pattern ^ftp:          1440    20%     10080
refresh_pattern ^gopher:       1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0    0%      0
refresh_pattern (Release|Packages(.gz)*)$      0       20%     2880
refresh_pattern .              0       20%     4320


# FortiGate interface of wccp
wccp2_router 192.168.111.1
# wccp version 2 configuration
wccp2_service standard 90
# tunneling method GRE for forward traffic
wccp2_forwarding_method gre
# tunneling method GRE for return traffic
wccp2_return_method gre
# which interface to use for WCCP (0.0.0.0 determines the interface from routing)
wccp2_address 0.0.0.0



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141010/6899287f/attachment.htm>

From steve at opendium.com  Fri Oct 10 16:26:39 2014
From: steve at opendium.com (Steve Hill)
Date: Fri, 10 Oct 2014 17:26:39 +0100
Subject: [squid-users] SSL bump , high memory usage
Message-ID: <543808BF.70704@opendium.com>


I think I've identified the bulk of the memory "leak" I've been tracking
down for the past few days.  As it turns out, it doesn't seem to be a
leak, but a problem with the SSL certificate caching.

The certificate cache is set by dynamic_cert_mem_cache_size and defaults
to 4MB.  Squid assumes an SSL context is 1KB, so we can cache up to 4096
certificates:

/// TODO: Replace on real size.
#define SSL_CTX_SIZE 1024

Unfortunately the assumed size isn't even close - it looks like an SSL
context usually weighs in at about 900KB!  So the default limit means
the cache can actually grow to around 3.6GB.  To make matters worse,
each worker gets its own cache, so in an 8-way SMP configuration, the
default "4MB" cache size limit actually ends up as around 30GB.


Possible fixes:
1. Stick with a static SSL_CTX_SIZE but use a more accurate estimate (I
suggest 1MB / context, based on my observations).
2. Calculate the context sizes correctly.
3. In the config, specify the maximum number of certificates to be
cached, rather than their total size.


In any case, as it stands the defaults are pretty much guaranteed to
cause a server to run out of memory.

How "heavy weight" is SSL context generation anyway?  i.e. if we expect
to generate 20 certificates a minute (which is what I see on a
production system in the first 5 minutes after startup), is that going
to place a significant load on the system, or is that ok?

the 900KB context size that I've observed seems pretty big to me.  Does
it sound reasonable, or is there some extra data being cached along with
the context that could have been freed earlier?


The instrumentation isn't good enough to be able to spot where this
memory usage originates without extensive debugging.  The memory isn't
allocated to memory pools, so mgr:mem doesn't show it, and
mgr:cached_ssl_cert relies on the incorrect estimate, so appears small
and inconsequential.  The processes can clearly be seen to grow rapidly,
but it all just shows up as unaccounted memory in mgr:info.  Secondly,
mgr:cached_ssl_cert doesn't appear to work with SMP workers.


My Squid process sizes are still larger than I would expect, so I'll
need to do more investigation, but reducing dynamic_cert_mem_cache_size
has stopped the rapid unbounded growth I have been seeing.

-- 

 - Steve Hill
   Technical Director
   Opendium Limited     http://www.opendium.com

Direct contacts:
   Instant messager: xmpp:steve at opendium.com
   Email:            steve at opendium.com
   Phone:            sip:steve at opendium.com

Sales / enquiries contacts:
   Email:            sales at opendium.com
   Phone:            +44-1792-825748 / sip:sales at opendium.com

Support contacts:
   Email:            support at opendium.com
   Phone:            +44-1792-824568 / sip:support at opendium.com


From gecom at tubosider.it  Fri Oct 10 16:30:09 2014
From: gecom at tubosider.it (masterx81)
Date: Fri, 10 Oct 2014 09:30:09 -0700 (PDT)
Subject: [squid-users] problem with basic_ldap_auth
In-Reply-To: <5437F8CA.2040503@treenet.co.nz>
References: <1412678023114-4667736.post@n4.nabble.com>
 <543603DE.706@treenet.co.nz> <1412930670275-4667796.post@n4.nabble.com>
 <5437F8CA.2040503@treenet.co.nz>
Message-ID: <1412958609034-4667808.post@n4.nabble.com>

I've noticed that also others had problems on 3.4.x with high cpu usage using
ntlm auth, and i would be happy to help and support the project. But i don't
know too much about linux (are only few month that i play with it) and know
squid only a bit. I not know if i can be much useful. And the system is of a
customer of mine, but i can connect via vpn, so i can access to it at any
time.
Let me know if and how i can help!



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/problem-with-basic-ldap-auth-tp4667736p4667808.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From jmperrote at policia.rionegro.gov.ar  Fri Oct 10 16:31:33 2014
From: jmperrote at policia.rionegro.gov.ar (Juan Manuel Perrote)
Date: Fri, 10 Oct 2014 13:31:33 -0300
Subject: [squid-users] I need a help with user permissions credentials
In-Reply-To: <54369E70.70405@policia.rionegro.gov.ar>
References: <54368D62.70800@policia.rionegro.gov.ar>
 <543693D1.8080402@treenet.co.nz> <54369E70.70405@policia.rionegro.gov.ar>
Message-ID: <543809E5.6080200@policia.rionegro.gov.ar>


Any body can help me ?

We use external authentification on ldap repository on a remote machine, 
and have a problem when use a ttl time, the proxy require to validate 
very frequently to all users.

external_acl_type ldap_group %LOGIN /usr/lib/squid3/squid_ldap_group -b "ou=Groups,dc=vs-zmaster,dc=policia,dc=rionegro,dc=gov,dc=ar" -f "(&(memberUid=%u)(cn=%g)(objectClass=posixGroup))" -h 10.11.37.2 -v


When try to set ttl=60 for a TTL and groups for check the user 
permissions, the squid proxy require over 60 seconds to all of users 
revalidate their username/password.

external_acl_type ldap_group ttl=60 %LOGIN /usr/lib/squid3/squid_ldap_group -b "ou=Groups,dc=vs-zmaster,dc=policia,dc=rionegro,dc=gov,dc=ar" -f "(&(memberUid=%u)(cn=%g)(objectClass=posixGroup))" -h 10.11.37.2 -v


Regards.




From squid3 at treenet.co.nz  Fri Oct 10 17:05:26 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 11 Oct 2014 06:05:26 +1300
Subject: [squid-users] unexplained MISSes
In-Reply-To: <42DE25A255671C44A93A7B58470DC09C48246F63@Michelle.aplitec.local>
References: <42DE25A255671C44A93A7B58470DC09C48246F63@Michelle.aplitec.local>
Message-ID: <543811D6.7070303@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 11/10/2014 5:00 a.m., Josep Borrell wrote:
> Hi,
> 
> I'm trying build a squid server that can cache youtube request for
> a school. I'm using squid 3.4.7 compiled from source on Ubuntu
> server 14.04 I have a lot of request that are cached, but not
> served from cache and generate a TCP_MISS/200 I'm trying to figure
> why this requests are not served from cache. Please find attached
> squid.conf and cache.log sample with debug enabled.
> 
> I hope someone can help me.
> 
> Thanks
> 
> Josep
> 
> *************************************************** access.log
> *******************************************************************
>
>  1412953551.775    167 192.168.1.112 TCP_MISS/200 4344 GET
> http://i1.ytimg.com/vi/9_iANxI-Mrc/default.jpg -
> ORIGINAL_DST/74.125.230.3 image/jpeg
> 

I see ORIGINAL_DST, meaning you are intercepting users traffic. This
interception action naturally imposes some big problems which Squid
has to deal with.

IF the domain name does not specifically resolve for Squid to the same
IP the user/client was contacting the object is NOT safely cacheable.
Squid will therefore not cache it, so as to prevent one smart-alec
student causing http://i1.ytimg.com/vi/9_iANxI-Mrc/default.jpg to be
fetched from a malware host - thus infecting anyone else loading the
"image" they get back.

That required decision by Squid may be part of your problem, or not.
Check the log file for mentions of "Host header forgery" by this
clients connection or the previous one(s) fetching that same URL.

NP: if there is *none* previously fetching the URL, there is your
answer. For it to have become cached someone has to fetch it - the
first fetch is *always* a MISS.


> ****************************** cache.log
> ******************************************************************************************
>
> 
- ----------
> 2014/10/10 17:05:51.772| ctx: enter level  0:
> 'http://ytimg.com.squid.internal/vi/9_iANxI-Mrc/default.jpg' 
> 2014/10/10 17:05:51.773| http.cc(705) processReplyHeader:
> processReplyHeader: key '9F1BB8D27BED16A8B74F8995105B2941' 
> 2014/10/10 17:05:51.773| http.cc(749) processReplyHeader: HTTP
> Server local=192.168.111.10:59210 remote=74.125.230.3:80 FD 65
> flags=1 2014/10/10 17:05:51.773| http.cc(750) processReplyHeader:
> HTTP Server REPLY: --------- HTTP/1.1 200 OK Content-Type:
> image/jpeg Last-Modified: Thu, 01 Jan 1970 00:23:21 GMT Date: Fri,
> 10 Oct 2014 10:45:51 GMT Expires: Fri, 10 Oct 2014 16:45:51 GMT 
> X-Content-Type-Options: nosniff Server: sffe Content-Length: 3861 
> X-XSS-Protection: 1; mode=block Age: 15619 Cache-Control: public,
> max-age=21600 Alternate-Protocol: 80:quic,p=0.01
> 
> ???????????? ---------- 2014/10/10 17:05:51.773| ctx: exit level
> 0 2014/10/10 17:05:51.773| ctx: enter level  0:
> 'http://ytimg.com.squid.internal/vi/9_iANxI-Mrc/default.jpg' 
> 2014/10/10 17:05:51.773| http.cc(919) haveParsedReplyHeaders: HTTP
> CODE: 200 2014/10/10 17:05:51.773| refresh.cc(247) refreshCheck:
> refreshCheck:
> 'http://ytimg.com.squid.internal/vi/9_iANxI-Mrc/default.jpg' 
> 2014/10/10 17:05:51.773| refresh.cc(262) refreshCheck:
> refreshCheck: Matched '^http:\/\/ytimg\.com\.squid\.internal.*
> 604800 80%% 4794000' 2014/10/10 17:05:51.773| refresh.cc(264)
> refreshCheck:  age:    15679 2014/10/10 17:05:51.773|
> refresh.cc(266) refreshCheck:  check_time:     Fri, 10 Oct 2014
> 15:06:51 GMT 2014/10/10 17:05:51.773| refresh.cc(268) refreshCheck:
> entry->timestamp:       Fri, 10 Oct 2014 10:45:32 GMT 2014/10/10
> 17:05:51.773| refresh.cc(171) refreshStaleness: FRESH: expires
> 1412959532 >= check_time 1412953611 2014/10/10 17:05:51.773|
> refresh.cc(288) refreshCheck: Staleness = -1 2014/10/10
> 17:05:51.773| refresh.cc(373) refreshCheck: refreshCheck: object
> isn't stale.. 2014/10/10 17:05:51.773| refresh.cc(375)
> refreshCheck: refreshCheck: returning FRESH_EXPIRES 2014/10/10
> 17:05:51.773| http.cc(482) cacheableReply: YES because HTTP status
> 200


That image is cacheable according to its headers. Provided the next
client fetches it again within the next 99mins, and the interception
limits do not prevent storage.

Check for mentions of "Host header forgery" by this same user/client
or the previous one fetching this URL.


> 
> **********************************************************************
> squid.conf *******************************************************
> 
> # debug helper #debug_options 84,3 #debug Refresh Calculation 
> #debug_options 22,3 # HTTP #debug_options 11,3
> 
> debug_options 11,3 22,3 84,3
> 
> 
> acl customernet src 172.16.212.154/32 acl customernet src
> 192.168.1.0/24
> 
> 
> acl SSL_ports port 443 acl SSL_ports port 873  # rsync
> 
> acl Safe_ports port 80         # http acl Safe_ports port 21
> # ftp acl Safe_ports port 443        # https acl Safe_ports port 70
> # gopher acl Safe_ports port 210        # wais acl Safe_ports port
> 1025-65535 # unregistered ports acl Safe_ports port 280        #
> http-mgmt acl Safe_ports port 488        # gss-http acl Safe_ports
> port 591        # filemaker acl Safe_ports port 777        #
> multiling http acl CONNECT method CONNECT
> 
> http_access deny !Safe_ports http_access deny CONNECT !SSL_ports 
> http_access allow localhost manager http_access deny manager 
> http_access allow localhost http_access allow customernet 
> http_access deny all # http_access allow all
> 
> #HTTPS (SSL) trafic interception options always_direct allow
> SSL_ports ssl_bump server-first SSL_ports #sslproxy_cert_error deny
> all #sslproxy_flags DONT_VERIFY_PEER sslcrtd_program
> /usr/lib/squid3/ssl_crtd -s /var/spool/squid3_ssldb -M 4MB 
> sslcrtd_children 8 startup=1 idle=1
> 
> acl rewritedoms dstdomain .c.youtube.com .googlevideo.com
> .ytimg.com store_id_program /usr/lib/squid3/storeid_file_rewrite
> /etc/squid3/storeid_rewrite store_id_children 40 startup=10 idle=5
> concurrency=0 store_id_access allow rewritedoms store_id_access
> deny all
> 
> 
> http_port 3128 http_port 8080 intercept https_port 8081 intercept
> ssl-bump generate-host-certificates=on
> dynamic_cert_mem_cache_size=4MB
> cert=/etc/squid3/ssl_cert/squidcert.pem
> 
> 
> forward_max_tries 25 cache_mem 2 GB maximum_object_size_in_memory
> 25 MB maximum_object_size 1 GB
> 
> visible_hostname squid-v2 dns_v4_first on
> 
> 
> coredump_dir /var/spool/squid3 cache_replacement_policy heap LFUDA 
> cache_dir aufs /var/spool/squid3 14000 16 256

14GB of disk trying to cache YT videos may not be enough space.

If the objects being fetched above were legitimately discarded to make
room for newer content then MISS is entirely to be expected.

> 
> refresh_pattern
> ^http:\/\/video-srv\.(googlevideo|youtube)\.com\.squid\.internal.*
> 10080 80%  79900 override-lastmod override-expire ignore-reload
> ignore-must-revalidate ignore-private refresh_pattern
> ^http:\/\/ytimg\.com\.squid\.internal.*  10080 80%  79900
> override-lastmod override-expire ignore-reload
> ignore-must-revalidate ignore-private


If you look at those server reply headers you can see the
Cache-Control explicitly says the reply is "public". This means that
the "ignore-private" setting is useless on these images.
 * ignoring privacy controls is a highly nasty thing to do to start
with. I suggest strongly that you remove it from the ytimg pattern
options as unnecessary.

Also, here is an artifact of the override options which you may not be
aware:

 The Expires header coming from YT indicates that the reply is
cacheable for 6hrs from the time it was generated. That is 21600
seconds, no less.
 Your override-expires is actively *reducing* the storage time to
10800 seconds (the 'min' field of the pattern options).

 Therefore to maximise caching you should *drop* the override-expires
option on the ytimg pattern.


NP: override-lastmod is usually also a bad thing to do, but I see you
are actually hitting THE use-case for which it legitimately exist...
server emitting incorrect Last-Modified value (1970? sure).



Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUOBHWAAoJELJo5wb/XPRjGv4H/iKpL4UUBOXVsy7BixBeM5xp
JoyRtwRcfH8ksI/G622KANQ2XzOMLyYr9BX5X8ofBGjT8WRRxEbQDzp/EVADB7+6
xO/OwW2413YiYSmgszOTx0joAdUFB4R4ShnCEjDHQ6RJFKIquQql58hDN+6eGHFZ
AkzrlL+V+CzkpOGWmu51kBLlaSMQJ2SaWOJMw0ykn4giuL87XYeRyQ9seFR9Q5Ll
7cKi0QZflcCvDnwa87vPfnvsQfBF/cFjuv7/NigGsO8IklgQ/T3xPf+A6WVXmURj
USLjOmFFsA6xaLZMBeUnmWo4kjX5iYXT1S14yQokpf+DUPfaM0+bt/hUFNLnkuk=
=1TqK
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Fri Oct 10 17:11:35 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 11 Oct 2014 06:11:35 +1300
Subject: [squid-users] SSL bump , high memory usage
In-Reply-To: <543808BF.70704@opendium.com>
References: <543808BF.70704@opendium.com>
Message-ID: <54381347.1060508@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 11/10/2014 5:26 a.m., Steve Hill wrote:
> 
> I think I've identified the bulk of the memory "leak" I've been
> tracking down for the past few days.  As it turns out, it doesn't
> seem to be a leak, but a problem with the SSL certificate caching.
> 
> The certificate cache is set by dynamic_cert_mem_cache_size and
> defaults to 4MB.  Squid assumes an SSL context is 1KB, so we can
> cache up to 4096 certificates:
> 
> /// TODO: Replace on real size. #define SSL_CTX_SIZE 1024
> 
> Unfortunately the assumed size isn't even close - it looks like an
> SSL context usually weighs in at about 900KB!  So the default limit
> means the cache can actually grow to around 3.6GB.  To make matters
> worse, each worker gets its own cache, so in an 8-way SMP
> configuration, the default "4MB" cache size limit actually ends up
> as around 30GB.

Aha, yes. That is http://bugs.squid-cache.org/show_bug.cgi?id=4005

If I'm understanding the discussions so far the "leak" is data stored
internally by OpenSSL when allocating certificate contexts. In this
case the generated cert chain and additional data. Squid has no way to
know how big that all is (varies between just a few KB and your MB),
so only accounts for what it can see.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUOBNHAAoJELJo5wb/XPRjgV0IANZpG56V3WrgjLPuLIDcOaJa
vqGXUbjZNzFVl6IMxXSdgxjZrjTwMzlYzYig3JQ0HUTwxSF8akXaNSLrGrZEW2mp
35w5ks9G3fh897P25prScyhWIuEV6KJOvWYxyseWNvRdth/EJRrTGLUJsv59US1E
b/W2251VOPJqCcEDovxBV2hvXMtBhJKQ0re+xhy5ot6EHs2TzSAdLqJlei5XypWg
FOwhHpwmcqPFyc3JlklSakTNcri0tNgswebNmp6Xbcs1Js4r0PRH7uNohr76wDJC
YmX1VfYX64aQxkkl1l4rlRW+PKEm7UHXZjlOnAxqKqiq+89VApw93pKkE6DoePc=
=fGD9
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Fri Oct 10 17:21:16 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 11 Oct 2014 06:21:16 +1300
Subject: [squid-users] problem with basic_ldap_auth
In-Reply-To: <1412958609034-4667808.post@n4.nabble.com>
References: <1412678023114-4667736.post@n4.nabble.com>
 <543603DE.706@treenet.co.nz> <1412930670275-4667796.post@n4.nabble.com>
 <5437F8CA.2040503@treenet.co.nz> <1412958609034-4667808.post@n4.nabble.com>
Message-ID: <5438158C.5080704@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 11/10/2014 5:30 a.m., masterx81 wrote:
> I've noticed that also others had problems on 3.4.x with high cpu
> usage using ntlm auth, and i would be happy to help and support the
> project. But i don't know too much about linux (are only few month
> that i play with it) and know squid only a bit. I not know if i can
> be much useful. And the system is of a customer of mine, but i can
> connect via vpn, so i can access to it at any time. Let me know if
> and how i can help!
> 

If possible the best thing we can get is a ALL,9 cache.log covering at
least some of the time when CPU is extremely high.

If you (or anyone affected) can do that it would be a great help.

NOTE: that amount of debug will slow the proxy down somewhat more, and
generate a huge amount of output. To get that info from a production
machine:

1) Make a copy of your squid.conf with "debug_options ALL,9" added to it.

2) run: squid -k reconfigure -f squid.conf.copy

... wait until sufficient data is logged.

3) run: squid -k reconfigure

4) move the cache.log elsewhere

5) run: squid -k rotate

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUOBWLAAoJELJo5wb/XPRj2SkIAMA8eL9+IDfnA++hRgGPAFzl
ey3M4+fQIjF97ZfiCTs6VEMW7yDE3XgzBISHe8mcyfMEJPHJv3Mkduavt2i3vSu8
NYToliYssUGtdUVgvNe96W6b/1Ak4ScvtBhpmjpnyt+nOetQjJ1r1R83jYk8tQIc
oILe4qn6aHPWlA/kx5tMkcSuiHLV+adAAhA1aAKCMrKFzQBiZT3LBLxPHA0k9VRc
H7oQnJPlOLEsRMgie0HrDb+VjYbjCQq8PUqM3SsFdLgF8B20PMUSV2/G0PIuP19L
m9FQbR/Vbh3RT4CPBz4auifRs1BJ25Ouyxo0Kag11G5ElULbJGvUEcF0FpNjI7M=
=ADP/
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Fri Oct 10 17:23:31 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 11 Oct 2014 06:23:31 +1300
Subject: [squid-users] I need a help with user permissions credentials
In-Reply-To: <543809E5.6080200@policia.rionegro.gov.ar>
References: <54368D62.70800@policia.rionegro.gov.ar>
 <543693D1.8080402@treenet.co.nz> <54369E70.70405@policia.rionegro.gov.ar>
 <543809E5.6080200@policia.rionegro.gov.ar>
Message-ID: <54381613.30304@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 11/10/2014 5:31 a.m., Juan Manuel Perrote wrote:
> 
> Any body can help me ?

See my previous answer.

When you configure Squid to do something *it happens*.

Please do not complain that Squid is doing *exactly* what you
configured it to do.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUOBYTAAoJELJo5wb/XPRj+y0IAMyVM5ZZQp/8WnjgIAeZuOp4
O683UShOmsIAIALR+/UJPMryXv0MAmc0/v5nZ3S4YfC8Gg3b12SKE9kWJ4UkDxIo
+bGbdW1JNIC0htUdrs5RNc2vAOkeGl7uXhVVMCduO403xHG/gf14HVRbVF+WqIYL
iBrgaMlc3ZSt9dhjjoVyCTGaICASit4fBhMeISid8hdllfa6/LWN+B1YAnr6XjIb
BtxjMEy57wLDx9v+ZFKXeW49ByiftE+LO4ybMkiHw12i0qF9wyrEzt47hWvK/bYE
dSl6l2VoeSUK48qhk7Och/KFy7/ULfw5DjkLipr383huzvn/IMhRj+AnchuB60w=
=/A8K
-----END PGP SIGNATURE-----


From huaraz at moeller.plus.com  Fri Oct 10 18:01:23 2014
From: huaraz at moeller.plus.com (Markus Moeller)
Date: Fri, 10 Oct 2014 19:01:23 +0100
Subject: [squid-users] Squid,
	Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
	3.4.7.)
In-Reply-To: <20141010113630.GA39334@admin.sibptus.tomsk.ru>
References: <20141006040725.GA31642@admin.sibptus.tomsk.ru>
 <20141006052346.GA32369@admin.sibptus.tomsk.ru>
 <20141007070403.GA57384@admin.sibptus.tomsk.ru>
 <20141007083542.GA60425@admin.sibptus.tomsk.ru> <m11nv3$nk8$1@ger.gmane.org>
 <20141008032925.GA77544@admin.sibptus.tomsk.ru> <m14if3$1ul$2@ger.gmane.org>
 <20141010113630.GA39334@admin.sibptus.tomsk.ru>
Message-ID: <m196tm$nb2$1@ger.gmane.org>

I think it could. Can you try the option -s GSS_C_NO_NAME ?

Markus

"Victor Sudakov"  wrote in message 
news:20141010113630.GA39334 at admin.sibptus.tomsk.ru...

Colleagues,

What if the service principal's name in squid's keytab does not
coincide with the host's primary FQDN (AKA `hostname`)?

E.g. the squid's keytab contains keys for HTTP/proxy.my.domain while
the server's actual FQDN is fw.my.domain?

Should it cause the obscure error I have stumbled upon?

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users 




From jbhasin83 at gmail.com  Sat Oct 11 03:03:41 2014
From: jbhasin83 at gmail.com (Jatin Bhasin)
Date: Sat, 11 Oct 2014 14:03:41 +1100
Subject: [squid-users] blockVirgin Works for CONNECT but Custom Response
 does not work
In-Reply-To: <5437F8CC.1050305@measurement-factory.com>
References: <CAGRJihXzGpw7dr-2B_s=oajK97BcG7QzC5OLAPWgpuvtsC0nWg@mail.gmail.com>
 <1408620949946.22246@diladele.com>
 <CAGRJihV0jMFTy5qw66Pq8z+6khujho6hbTM8K1tqycYMBNKjZg@mail.gmail.com>
 <CAGRJihUq0dsinws7ZH7n1P=u5NDGSB08+rCKz6MqLsUm8V=h+g@mail.gmail.com>
 <53F7DF54.9020505@measurement-factory.com>
 <CAGRJihX7xqTWJA4RHa99jUmd1k-gtCyE-hq=MzRK4XTHXtgfwA@mail.gmail.com>
 <5437F8CC.1050305@measurement-factory.com>
Message-ID: <CAGRJihXWNenmX3iff34v0AqHodsb+NyEJFnF6E+MteA3LqKpBA@mail.gmail.com>

Hi Alex,

I changed my ACL's a bit to see annotations in access.log file. My web
browser is point to squid port 3127.

So squid.conf is as below:  (first two lines are for note logging as
you suggested.)
---------------------------------------------
logformat with_note %ts.%03tu %6tr %>a %Ss/%03>Hs %<st %rm %ru %[un
%Sh/%<a %mt %note
access_log /var/log/squid/access.log with_note
adaptation_masterx_shared_names X-Virus-ID
acl toBump note X-Virus-ID yes
acl p3127 myportname 3127
ssl_bump client-first p3127          (Hence all requests will be bumped.)

I made changes to the eCap adapter as you had suggested. But I do not
see any annotations in access.log file.


1412995864.045      7 10.100.249.11 TAG_NONE/200 0 CONNECT
www.bwin.com:443 - HIER_NONE/- - -
1412995867.108   2573 10.100.249.11 TCP_MISS/200 10122 GET
https://www.bwin.com/ - HIER_DIRECT/195.72.134.135 text/html -


Now i I introduce another paramter in the squid.conf file as below:

note X-Virus-ID yes p3127

And I get following in access.log  (so this is definitely not coming
from my eCap adapter but because of the note directive above)

1412996265.992      7 10.100.249.11 TAG_NONE/200 0 CONNECT
www.bwin.com:443 - HIER_NONE/- - X-Virus-ID:%20yes%0D%0A
1412996266.159     87 10.100.249.11 TAG_NONE/200 1400 GET
https://www.bwin.com/ - HIER_NONE/- - X-Virus-ID:%20yes%0D%0A



Now, this makes me feel that annotations from my eCap adapter are not
travelling to squid for both CONNECT and GET.

So, would my eCap adapter has to do something else to let squid know
that the annotations its providing is a note.

Thanks,
Jatin


On Sat, Oct 11, 2014 at 2:18 AM, Alex Rousskov
<rousskov at measurement-factory.com> wrote:
> On 10/09/2014 11:57 PM, Jatin Bhasin wrote:
>
>> adaptation_masterx_shared_names X-Virus-ID
>> acl toBump note X-Virus-ID yes
>> ssl_bump client-first toBump
>
> OK.
>
>
>> My eCap adapter functions which returns yes for the X-Virus-ID are:
>> =================================================================
>> const libecap::Area Adapter::Xaction::option(const libecap::Name &name) const
>> {
>> std::string str = "yes";
>> return libecap::Area(str.data(), str.size());
>> }
>
> Two bugs here:
>
> * You are returning a pointer to str, which is a temporary, on-stack
> storage. Use libecap::Area::FromTempString() instead.
>
> * You are returning "yes" value for all option names. The return value
> should be conditional on name parameter being lequal to
> libecap::metaVirusId ("X-Virus-ID").
>
> These two bugs may not actually affect you (for several reasons), but
> you should fix them anyway.
>
>
>> --------------------------------------------------------------------------------------------------------------------
>> void Adapter::Xaction::visitEachOption(libecap::NamedValueVisitor
>> &visitor) const
>> {
>> std::string str = "yes";
>>     visitor.visit(libecap::metaVirusId, libecap::Area(str.data(), str.size()));
>> }
>
> There is no need for std::string in this case, but the above code is not
> buggy, just inefficient.
>
>
>> Looking at cache.log I see that X-Virus-ID is set to yes but the eCap
>> adapter functions. But I do not know that how it will be picked up
>> note acl. Please suggest.
>
> I agree that Squid seems to receive the X-Virus-ID:yes metaheader from
> the eCAP adapter, but your toBump ACL still does not match. I cannot
> tell why that is [not] happening by looking at the cache log, unfortunately.
>
> You may want to add debugging to ACLNoteData::match and
> ACLNoteData::matchNotes in src/acl/NoteData.cc to see if the ACL code
> has access to the eCAP history with X-Virus-ID metaheader.
>
> The only theory I can offer right now is that the code handling
> annotations for CONNECT requests is broken and does not store or does
> not preserve annotations received from eCAP adapters. CONNECT requests
> are treated specially in Squid. You can try to test that theory by
> annotating GET requests, for example.
>
> Another good test is to log your annotation to access.log using %note
> logformat code. If it is not logged, Squid probably lost it. If it is
> logged, then the ACL code does not have access to the information for
> some reason. This test can be done for both CONNECT and GET requests.
>
>
> HTH,
>
> Alex.
>
>
>
>> On Sat, Aug 23, 2014 at 10:24 AM, Alex Rousskov wrote:
>>> On 08/21/2014 07:06 PM, Jatin Bhasin wrote:
>>>
>>>> So, can somebody suggest me if there is a way to pass a flag to squid
>>>> from ecap adapter to decrypt a site regardless of what ACL says. For
>>>> example if I have an acl as below which says do not decrypt
>>>> www.888.com but If my ecap adapter could pass a message to squid
>>>> asking it to decrypt www.888.com (for that session only) and ignore
>>>> the below acl.
>>>> Is it possible?
>>>
>>>
>>> Given a recent-enough Squid version, an adaptation service can control
>>> Squid behavior via the annotations mechanism and the "note" ACL
>>> associated with it. For example, your eCAP adapter can return an
>>> X-Bump:yes annotation(**) that Squid can then match using the note ACL.
>>> Something along these untested lines:
>>>
>>>   acl note toBump X-Bump yes
>>>   ssl_bump server-first toBump
>>>   ssl_bump server-first ...
>>>   ssl_bump none all
>>>
>>> This mechanism should be supported for ssl_bump ACLs but I have not
>>> tested that claim myself.
>>>
>>>
>>> HTH,
>>>
>>> Alex.
>>> (**) In eCAP terminology, an X-Bump:yes annotation is an adapter
>>> transaction option named X-Bump with a "yes" value. See
>>> libecap::Options, which is a parent of libecap::adapter::Xaction.
>>>
>


From sudakov at sibptus.tomsk.ru  Sat Oct 11 04:46:26 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Sat, 11 Oct 2014 11:46:26 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <m196tm$nb2$1@ger.gmane.org>
References: <20141006040725.GA31642@admin.sibptus.tomsk.ru>
 <20141006052346.GA32369@admin.sibptus.tomsk.ru>
 <20141007070403.GA57384@admin.sibptus.tomsk.ru>
 <20141007083542.GA60425@admin.sibptus.tomsk.ru>
 <m11nv3$nk8$1@ger.gmane.org>
 <20141008032925.GA77544@admin.sibptus.tomsk.ru>
 <m14if3$1ul$2@ger.gmane.org>
 <20141010113630.GA39334@admin.sibptus.tomsk.ru>
 <m196tm$nb2$1@ger.gmane.org>
Message-ID: <20141011044626.GB49506@admin.sibptus.tomsk.ru>

Markus Moeller wrote:
> 
> > What if the service principal's name in squid's keytab does not
> > coincide with the host's primary FQDN (AKA `hostname`)?
> > 
> > E.g. the squid's keytab contains keys for HTTP/proxy.my.domain while
> > the server's actual FQDN is fw.my.domain?
> > 
> > Should it cause the obscure error I have stumbled upon?

> I think it could. Can you try the option -s GSS_C_NO_NAME ?

Thank you, Markus! With "-s GSS_C_NO_NAME" it works, at least with the
negotiate_kerberos_auth_test client. I will try later with real hosts
and browsers, though.

I should have guessed this before. The server's `hostname` is
"big.sibptus.transneft.ru", while "proxy.sibptus.transneft.ru" is an A
record pointing to another IP alias of the same server.

If only the Kerberos error message was more informative, something
like "principal not found in the keytab" instead of "mech unknown", I
would have guessed this long ago and would have spared myself a week
of tribulation.

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru


From lizhi at iie.ac.cn  Sat Oct 11 08:14:35 2014
From: lizhi at iie.ac.cn (=?GB2312?Q?=C0=EE=D6=BE-iie?=)
Date: Sat, 11 Oct 2014 16:14:35 +0800
Subject: [squid-users] open socket: (13) Permission denied
Message-ID: <BB9B0EC6-993A-4E0A-A363-57EEB5A9B3B5@iie.ac.cn>

Hi,

I?m trying to set up Squid on a ARM platform. After compiling, I run Squid with command ?/opt/squid/sbin/squid -N -d1? , and then configure the iptables.
Unfortunately, when I browse a url, Squid reports an error: 
        Attempt to open socket for EUI retrieval failed: (13) Permission denied.

Please do you have an idea?

I find that this error is report by Eui48.cc. The coding is as following:

// return binary representation of the EUI
bool
Eui::Eui48::lookup(const Ip::Address &c)
{
    Ip::Address ipAddr = c;
    ipAddr.port(0);

#if _SQUID_LINUX_

    unsigned char ifbuffer[sizeof(struct ifreq) * 64];
    struct ifconf ifc;

    struct ifreq *ifr;
    int offset;

    /* IPv6 builds do not provide the first http_port as an IPv4 socket for ARP */
    int tmpSocket = socket(AF_INET,SOCK_STREAM,0);
	
    if (tmpSocket < 0) {
        debugs(28, DBG_IMPORTANT, "Attempt to open socket for EUI retrieval failed: " << xstrerror());
        clear();
        return false;
    }

Best regards,
Lizhi





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141011/c8abf726/attachment.htm>

From squid3 at treenet.co.nz  Sat Oct 11 08:52:20 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 11 Oct 2014 21:52:20 +1300
Subject: [squid-users] open socket: (13) Permission denied
In-Reply-To: <BB9B0EC6-993A-4E0A-A363-57EEB5A9B3B5@iie.ac.cn>
References: <BB9B0EC6-993A-4E0A-A363-57EEB5A9B3B5@iie.ac.cn>
Message-ID: <5438EFC4.9020807@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 11/10/2014 9:14 p.m., ??-iie wrote:
> Hi,
> 
> I?m trying to set up Squid on a ARM platform. After compiling, I
> run Squid with command ?/opt/squid/sbin/squid -N -d1? , and then
> configure the iptables. Unfortunately, when I browse a url, Squid
> reports an error: Attempt to open socket for EUI retrieval failed:
> (13) Permission denied.
> 
> Please do you have an idea?
> 

This error should only show up there if your machine runs out of TCP
ports or hits the FD limits.

How did you configure iptables?
How many FD is Squid finding available? (see startup log message about
"FD available").

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUOO/EAAoJELJo5wb/XPRjI3sH/R+hm/KgyOgzZVldL77cGmlR
PHW/wVZ4NrBP5hPHRavpd7U0k7EgVUs1b2ZpjE9MVWv6HJxKk29qfqtXsgpelM9N
OxaocWwTdayoGVL5eTElZerS29MGoC8TuD0NPT202UMxQ5WwAyqpr++GXFFNxfA9
uSMPlqCgwfg3XZDYlDwGNVuXppLDCE+UvVeMDIa5RtWP7x8ztU9rau0GSWKHQeRR
kw1PvVwUatZF7R3N/3KKZ5QxYRCdxyHTySSed845HmyUnjbQPnuTHvKcvpa59pco
6awyA8sDp+IKDogEM15SmiS1n+ktsTdvN498nk7O2e+bdP5sLFQUmhO19V4qwFE=
=ktMv
-----END PGP SIGNATURE-----


From huaraz at moeller.plus.com  Sat Oct 11 12:18:23 2014
From: huaraz at moeller.plus.com (Markus Moeller)
Date: Sat, 11 Oct 2014 13:18:23 +0100
Subject: [squid-users] Squid,
	Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
	3.4.7.)
In-Reply-To: <20141011044626.GB49506@admin.sibptus.tomsk.ru>
References: <20141006040725.GA31642@admin.sibptus.tomsk.ru>
 <20141006052346.GA32369@admin.sibptus.tomsk.ru>
 <20141007070403.GA57384@admin.sibptus.tomsk.ru>
 <20141007083542.GA60425@admin.sibptus.tomsk.ru> <m11nv3$nk8$1@ger.gmane.org>
 <20141008032925.GA77544@admin.sibptus.tomsk.ru> <m14if3$1ul$2@ger.gmane.org>
 <20141010113630.GA39334@admin.sibptus.tomsk.ru> <m196tm$nb2$1@ger.gmane.org>
 <20141011044626.GB49506@admin.sibptus.tomsk.ru>
Message-ID: <m1b82j$6ee$1@ger.gmane.org>

Good to see it works now. As far as I recall the MIT message is clearer in 
this case.

Regards
Markus

"Victor Sudakov"  wrote in message 
news:20141011044626.GB49506 at admin.sibptus.tomsk.ru...

Markus Moeller wrote:
>
> > What if the service principal's name in squid's keytab does not
> > coincide with the host's primary FQDN (AKA `hostname`)?
> >
> > E.g. the squid's keytab contains keys for HTTP/proxy.my.domain while
> > the server's actual FQDN is fw.my.domain?
> >
> > Should it cause the obscure error I have stumbled upon?

> I think it could. Can you try the option -s GSS_C_NO_NAME ?

Thank you, Markus! With "-s GSS_C_NO_NAME" it works, at least with the
negotiate_kerberos_auth_test client. I will try later with real hosts
and browsers, though.

I should have guessed this before. The server's `hostname` is
"big.sibptus.transneft.ru", while "proxy.sibptus.transneft.ru" is an A
record pointing to another IP alias of the same server.

If only the Kerberos error message was more informative, something
like "principal not found in the keytab" instead of "mech unknown", I
would have guessed this long ago and would have spared myself a week
of tribulation.

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users 




From huaraz at moeller.plus.com  Sat Oct 11 12:33:21 2014
From: huaraz at moeller.plus.com (Markus Moeller)
Date: Sat, 11 Oct 2014 13:33:21 +0100
Subject: [squid-users] Squid,
	Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
	3.4.7.)
In-Reply-To: <20141011044626.GB49506@admin.sibptus.tomsk.ru>
References: <20141006040725.GA31642@admin.sibptus.tomsk.ru>
 <20141006052346.GA32369@admin.sibptus.tomsk.ru>
 <20141007070403.GA57384@admin.sibptus.tomsk.ru>
 <20141007083542.GA60425@admin.sibptus.tomsk.ru> <m11nv3$nk8$1@ger.gmane.org>
 <20141008032925.GA77544@admin.sibptus.tomsk.ru> <m14if3$1ul$2@ger.gmane.org>
 <20141010113630.GA39334@admin.sibptus.tomsk.ru> <m196tm$nb2$1@ger.gmane.org>
 <20141011044626.GB49506@admin.sibptus.tomsk.ru>
Message-ID: <m1b82j$6ee$2@ger.gmane.org>

Hi Viktor,

   These sections of code do the selection in squid:


char *service_name = (char *) "HTTP", *host_name = NULL;


if (service_principal && strcasecmp(service_principal, "GSS_C_NO_NAME")) {
    service.value = service_principal;
    service.length = strlen((char *) service.value);
} else {
    host_name = gethost_name();
    if (!host_name) {
        fprintf(stderr,
                "%s| %s: FATAL: Local hostname could not be determined. 
Please specify the service principal\n",
                LogTime(), PROGRAM);
        fprintf(stdout, "BH hostname error\n");
        exit(-1);
    }
    service.value = xmalloc(strlen(service_name) + strlen(host_name) + 2);
    snprintf((char *) service.value, strlen(service_name) + 
strlen(host_name) + 2,
             "%s@%s", service_name, host_name);
    service.length = strlen((char *) service.value);
    xfree(host_name);
}

.......

if (service_principal) {
    if (strcasecmp(service_principal, "GSS_C_NO_NAME")) {
        major_status = gss_import_name(&minor_status, &service,
                                       (gss_OID) GSS_C_NULL_OID, 
&server_name);

    } else {
        server_name = GSS_C_NO_NAME;
        major_status = GSS_S_COMPLETE;
        minor_status = 0;
    }
} else {
    major_status = gss_import_name(&minor_status, &service,
                                   gss_nt_service_name, &server_name);
}


Regards
Markus

"Victor Sudakov"  wrote in message 
news:20141011044626.GB49506 at admin.sibptus.tomsk.ru...

Markus Moeller wrote:
>
> > What if the service principal's name in squid's keytab does not
> > coincide with the host's primary FQDN (AKA `hostname`)?
> >
> > E.g. the squid's keytab contains keys for HTTP/proxy.my.domain while
> > the server's actual FQDN is fw.my.domain?
> >
> > Should it cause the obscure error I have stumbled upon?

> I think it could. Can you try the option -s GSS_C_NO_NAME ?

Thank you, Markus! With "-s GSS_C_NO_NAME" it works, at least with the
negotiate_kerberos_auth_test client. I will try later with real hosts
and browsers, though.

I should have guessed this before. The server's `hostname` is
"big.sibptus.transneft.ru", while "proxy.sibptus.transneft.ru" is an A
record pointing to another IP alias of the same server.

If only the Kerberos error message was more informative, something
like "principal not found in the keytab" instead of "mech unknown", I
would have guessed this long ago and would have spared myself a week
of tribulation.

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users 




From sudakov at sibptus.tomsk.ru  Sat Oct 11 13:17:47 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Sat, 11 Oct 2014 20:17:47 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <m1b82j$6ee$2@ger.gmane.org>
References: <20141006052346.GA32369@admin.sibptus.tomsk.ru>
 <20141007070403.GA57384@admin.sibptus.tomsk.ru>
 <20141007083542.GA60425@admin.sibptus.tomsk.ru>
 <m11nv3$nk8$1@ger.gmane.org>
 <20141008032925.GA77544@admin.sibptus.tomsk.ru>
 <m14if3$1ul$2@ger.gmane.org>
 <20141010113630.GA39334@admin.sibptus.tomsk.ru>
 <m196tm$nb2$1@ger.gmane.org>
 <20141011044626.GB49506@admin.sibptus.tomsk.ru>
 <m1b82j$6ee$2@ger.gmane.org>
Message-ID: <20141011131747.GA56184@admin.sibptus.tomsk.ru>

Markus Moeller wrote:
> Hi Viktor,
> 
>    These sections of code do the selection in squid:
> 
> 
> char *service_name = (char *) "HTTP", *host_name = NULL;

Thanks for posting this. BTW does it mean that the service name "HTTP"
is hardcoded, and if I wanted to use a principal with a different
service name ort without "/" at all, I have no way of doing it other
than patching the source?

I have come across a strange issue with the w2k AD. When requested for
a ticket to "HTTP/proxy.sibptus.transneft.ru", it instead gives the
ticket to "PROXY01-SIBPTUS$" (this is the name of the AD account to
which the SPN "HTTP/proxy.sibptus.transneft.ru" is bound). I seem to
have no way of using this "HTTP"-less name in a keytab.


-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru


From ronald.bloss at nortonrosefulbright.com  Sat Oct 11 13:38:20 2014
From: ronald.bloss at nortonrosefulbright.com (Bloss, Ronald)
Date: Sat, 11 Oct 2014 13:38:20 +0000
Subject: [squid-users] leaking memory In Squid 3.4.6
In-Reply-To: <543657AB.7030407@opendium.com>
References: <20140928062806.GA34166@admin.sibptus.tomsk.ru>
 <5427B9EC.6060500@ngtech.co.il> <5429209D.1050909@opendium.com>
 <542ABA7F.6010401@treenet.co.nz> <542AC54C.408@opendium.com>
 <542AC87D.7040806@treenet.co.nz> <54340958.6070601@opendium.com>
 <543544A0.1080301@treenet.co.nz>,<543657AB.7030407@opendium.com>
Message-ID: <28B6EB438ECC044BB232A80C459157CD20EBA073@HOEXM01.fulbright.com>



This email message and any attachments are for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure, copying or distribution is prohibited. If you are not the intended recipient, please contact the sender by reply email and destroy all copies of the original message and any attachments.

To reply to our email administrator directly, send an email to nrfus.postmaster at nortonrosefulbright.com.

Fulbright & Jaworski LLP, Norton Rose Fulbright LLP, Norton Rose Fulbright Australia, Norton Rose Fulbright Canada LLP, and Norton Rose Fulbright South Africa (incorporated as Deneys Reitz Inc), each of which is a separate legal entity, are members of Norton Rose Fulbright Verein, a Swiss Verein. Details of each entity, with certain regulatory information, are at nortonrosefulbright.com. Norton Rose Fulbright Verein helps coordinate the activities of the members but does not itself provide legal services to clients.



From huaraz at moeller.plus.com  Sat Oct 11 14:13:32 2014
From: huaraz at moeller.plus.com (Markus Moeller)
Date: Sat, 11 Oct 2014 15:13:32 +0100
Subject: [squid-users] Squid,
	Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
	3.4.7.)
In-Reply-To: <20141011131747.GA56184@admin.sibptus.tomsk.ru>
References: <20141006052346.GA32369@admin.sibptus.tomsk.ru>
 <20141007070403.GA57384@admin.sibptus.tomsk.ru>
 <20141007083542.GA60425@admin.sibptus.tomsk.ru> <m11nv3$nk8$1@ger.gmane.org>
 <20141008032925.GA77544@admin.sibptus.tomsk.ru> <m14if3$1ul$2@ger.gmane.org>
 <20141010113630.GA39334@admin.sibptus.tomsk.ru> <m196tm$nb2$1@ger.gmane.org>
 <20141011044626.GB49506@admin.sibptus.tomsk.ru> <m1b82j$6ee$2@ger.gmane.org>
 <20141011131747.GA56184@admin.sibptus.tomsk.ru>
Message-ID: <m1bduf$5ar$1@ger.gmane.org>

HTTP is the standard service for HTTP authentication (web and proxy)

Markus

"Victor Sudakov"  wrote in message 
news:20141011131747.GA56184 at admin.sibptus.tomsk.ru...

Markus Moeller wrote:
> Hi Viktor,
>
>    These sections of code do the selection in squid:
>
>
> char *service_name = (char *) "HTTP", *host_name = NULL;

Thanks for posting this. BTW does it mean that the service name "HTTP"
is hardcoded, and if I wanted to use a principal with a different
service name ort without "/" at all, I have no way of doing it other
than patching the source?

I have come across a strange issue with the w2k AD. When requested for
a ticket to "HTTP/proxy.sibptus.transneft.ru", it instead gives the
ticket to "PROXY01-SIBPTUS$" (this is the name of the AD account to
which the SPN "HTTP/proxy.sibptus.transneft.ru" is bound). I seem to
have no way of using this "HTTP"-less name in a keytab.


-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users 




From huaraz at moeller.plus.com  Sat Oct 11 14:16:18 2014
From: huaraz at moeller.plus.com (Markus Moeller)
Date: Sat, 11 Oct 2014 15:16:18 +0100
Subject: [squid-users] Squid,
	Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
	3.4.7.)
In-Reply-To: <20141011131747.GA56184@admin.sibptus.tomsk.ru>
References: <20141006052346.GA32369@admin.sibptus.tomsk.ru>
 <20141007070403.GA57384@admin.sibptus.tomsk.ru>
 <20141007083542.GA60425@admin.sibptus.tomsk.ru> <m11nv3$nk8$1@ger.gmane.org>
 <20141008032925.GA77544@admin.sibptus.tomsk.ru> <m14if3$1ul$2@ger.gmane.org>
 <20141010113630.GA39334@admin.sibptus.tomsk.ru> <m196tm$nb2$1@ger.gmane.org>
 <20141011044626.GB49506@admin.sibptus.tomsk.ru> <m1b82j$6ee$2@ger.gmane.org>
 <20141011131747.GA56184@admin.sibptus.tomsk.ru>
Message-ID: <m1be3k$71m$1@ger.gmane.org>

Also you can overwrite it with the -s option if you really need to.

Markus

"Victor Sudakov"  wrote in message 
news:20141011131747.GA56184 at admin.sibptus.tomsk.ru...

Markus Moeller wrote:
> Hi Viktor,
>
>    These sections of code do the selection in squid:
>
>
> char *service_name = (char *) "HTTP", *host_name = NULL;

Thanks for posting this. BTW does it mean that the service name "HTTP"
is hardcoded, and if I wanted to use a principal with a different
service name ort without "/" at all, I have no way of doing it other
than patching the source?

I have come across a strange issue with the w2k AD. When requested for
a ticket to "HTTP/proxy.sibptus.transneft.ru", it instead gives the
ticket to "PROXY01-SIBPTUS$" (this is the name of the AD account to
which the SPN "HTTP/proxy.sibptus.transneft.ru" is bound). I seem to
have no way of using this "HTTP"-less name in a keytab.


-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users 




From jborrell at central.aplitec.com  Sat Oct 11 14:36:18 2014
From: jborrell at central.aplitec.com (Josep Borrell)
Date: Sat, 11 Oct 2014 14:36:18 +0000
Subject: [squid-users] unexplained MISSes
In-Reply-To: <543811D6.7070303@treenet.co.nz>
References: <42DE25A255671C44A93A7B58470DC09C48246F63@Michelle.aplitec.local>
 <543811D6.7070303@treenet.co.nz>
Message-ID: <42DE25A255671C44A93A7B58470DC09C482473A6@Michelle.aplitec.local>

Hi Amos,

I know that the first request is always a miss.
I'm reproducing the same v?deo from the same PC, and same browser erasing the cache between tests.

Are there any doc that explain the meaning of all responses like ORIGINAL_DST ?
And are there any way to know the reason of a MISS or a HIT ?
I tried with the debug options, but the reason of a MISS isn't there.

Thanks

Josep


-----Mensaje original-----
De: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] En nombre de Amos Jeffries
Enviado el: viernes, 10 de octubre de 2014 19:05
Para: squid-users at lists.squid-cache.org
Asunto: Re: [squid-users] unexplained MISSes

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 11/10/2014 5:00 a.m., Josep Borrell wrote:
> Hi,
> 
> I'm trying build a squid server that can cache youtube request for a 
> school. I'm using squid 3.4.7 compiled from source on Ubuntu server 
> 14.04 I have a lot of request that are cached, but not served from 
> cache and generate a TCP_MISS/200 I'm trying to figure why this 
> requests are not served from cache. Please find attached squid.conf 
> and cache.log sample with debug enabled.
> 
> I hope someone can help me.
> 
> Thanks
> 
> Josep
> 
> *************************************************** access.log
> *******************************************************************
>
>  1412953551.775    167 192.168.1.112 TCP_MISS/200 4344 GET
> http://i1.ytimg.com/vi/9_iANxI-Mrc/default.jpg -
> ORIGINAL_DST/74.125.230.3 image/jpeg
> 

I see ORIGINAL_DST, meaning you are intercepting users traffic. This interception action naturally imposes some big problems which Squid has to deal with.

IF the domain name does not specifically resolve for Squid to the same IP the user/client was contacting the object is NOT safely cacheable.
Squid will therefore not cache it, so as to prevent one smart-alec student causing http://i1.ytimg.com/vi/9_iANxI-Mrc/default.jpg to be fetched from a malware host - thus infecting anyone else loading the "image" they get back.

That required decision by Squid may be part of your problem, or not.
Check the log file for mentions of "Host header forgery" by this clients connection or the previous one(s) fetching that same URL.

NP: if there is *none* previously fetching the URL, there is your answer. For it to have become cached someone has to fetch it - the first fetch is *always* a MISS.


> ****************************** cache.log
> **********************************************************************
> ********************
>
> 
- ----------
> 2014/10/10 17:05:51.772| ctx: enter level  0:
> 'http://ytimg.com.squid.internal/vi/9_iANxI-Mrc/default.jpg' 
> 2014/10/10 17:05:51.773| http.cc(705) processReplyHeader:
> processReplyHeader: key '9F1BB8D27BED16A8B74F8995105B2941' 
> 2014/10/10 17:05:51.773| http.cc(749) processReplyHeader: HTTP Server 
> local=192.168.111.10:59210 remote=74.125.230.3:80 FD 65
> flags=1 2014/10/10 17:05:51.773| http.cc(750) processReplyHeader:
> HTTP Server REPLY: --------- HTTP/1.1 200 OK Content-Type:
> image/jpeg Last-Modified: Thu, 01 Jan 1970 00:23:21 GMT Date: Fri,
> 10 Oct 2014 10:45:51 GMT Expires: Fri, 10 Oct 2014 16:45:51 GMT
> X-Content-Type-Options: nosniff Server: sffe Content-Length: 3861
> X-XSS-Protection: 1; mode=block Age: 15619 Cache-Control: public,
> max-age=21600 Alternate-Protocol: 80:quic,p=0.01
> 
> ???????????? ---------- 2014/10/10 17:05:51.773| ctx: exit level
> 0 2014/10/10 17:05:51.773| ctx: enter level  0:
> 'http://ytimg.com.squid.internal/vi/9_iANxI-Mrc/default.jpg' 
> 2014/10/10 17:05:51.773| http.cc(919) haveParsedReplyHeaders: HTTP
> CODE: 200 2014/10/10 17:05:51.773| refresh.cc(247) refreshCheck:
> refreshCheck:
> 'http://ytimg.com.squid.internal/vi/9_iANxI-Mrc/default.jpg' 
> 2014/10/10 17:05:51.773| refresh.cc(262) refreshCheck:
> refreshCheck: Matched '^http:\/\/ytimg\.com\.squid\.internal.*
> 604800 80%% 4794000' 2014/10/10 17:05:51.773| refresh.cc(264)
> refreshCheck:  age:    15679 2014/10/10 17:05:51.773|
> refresh.cc(266) refreshCheck:  check_time:     Fri, 10 Oct 2014
> 15:06:51 GMT 2014/10/10 17:05:51.773| refresh.cc(268) refreshCheck:
> entry->timestamp:       Fri, 10 Oct 2014 10:45:32 GMT 2014/10/10
> 17:05:51.773| refresh.cc(171) refreshStaleness: FRESH: expires
> 1412959532 >= check_time 1412953611 2014/10/10 17:05:51.773|
> refresh.cc(288) refreshCheck: Staleness = -1 2014/10/10 17:05:51.773| 
> refresh.cc(373) refreshCheck: refreshCheck: object isn't stale.. 
> 2014/10/10 17:05:51.773| refresh.cc(375)
> refreshCheck: refreshCheck: returning FRESH_EXPIRES 2014/10/10 
> 17:05:51.773| http.cc(482) cacheableReply: YES because HTTP status
> 200


That image is cacheable according to its headers. Provided the next client fetches it again within the next 99mins, and the interception limits do not prevent storage.

Check for mentions of "Host header forgery" by this same user/client or the previous one fetching this URL.


> 
> **********************************************************************
> squid.conf *******************************************************
> 
> # debug helper #debug_options 84,3 #debug Refresh Calculation 
> #debug_options 22,3 # HTTP #debug_options 11,3
> 
> debug_options 11,3 22,3 84,3
> 
> 
> acl customernet src 172.16.212.154/32 acl customernet src
> 192.168.1.0/24
> 
> 
> acl SSL_ports port 443 acl SSL_ports port 873  # rsync
> 
> acl Safe_ports port 80         # http acl Safe_ports port 21
> # ftp acl Safe_ports port 443        # https acl Safe_ports port 70
> # gopher acl Safe_ports port 210        # wais acl Safe_ports port
> 1025-65535 # unregistered ports acl Safe_ports port 280        #
> http-mgmt acl Safe_ports port 488        # gss-http acl Safe_ports
> port 591        # filemaker acl Safe_ports port 777        #
> multiling http acl CONNECT method CONNECT
> 
> http_access deny !Safe_ports http_access deny CONNECT !SSL_ports 
> http_access allow localhost manager http_access deny manager 
> http_access allow localhost http_access allow customernet http_access 
> deny all # http_access allow all
> 
> #HTTPS (SSL) trafic interception options always_direct allow SSL_ports 
> ssl_bump server-first SSL_ports #sslproxy_cert_error deny all 
> #sslproxy_flags DONT_VERIFY_PEER sslcrtd_program 
> /usr/lib/squid3/ssl_crtd -s /var/spool/squid3_ssldb -M 4MB 
> sslcrtd_children 8 startup=1 idle=1
> 
> acl rewritedoms dstdomain .c.youtube.com .googlevideo.com .ytimg.com 
> store_id_program /usr/lib/squid3/storeid_file_rewrite
> /etc/squid3/storeid_rewrite store_id_children 40 startup=10 idle=5
> concurrency=0 store_id_access allow rewritedoms store_id_access deny 
> all
> 
> 
> http_port 3128 http_port 8080 intercept https_port 8081 intercept 
> ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB 
> cert=/etc/squid3/ssl_cert/squidcert.pem
> 
> 
> forward_max_tries 25 cache_mem 2 GB maximum_object_size_in_memory
> 25 MB maximum_object_size 1 GB
> 
> visible_hostname squid-v2 dns_v4_first on
> 
> 
> coredump_dir /var/spool/squid3 cache_replacement_policy heap LFUDA 
> cache_dir aufs /var/spool/squid3 14000 16 256

14GB of disk trying to cache YT videos may not be enough space.

If the objects being fetched above were legitimately discarded to make room for newer content then MISS is entirely to be expected.

> 
> refresh_pattern
> ^http:\/\/video-srv\.(googlevideo|youtube)\.com\.squid\.internal.*
> 10080 80%  79900 override-lastmod override-expire ignore-reload 
> ignore-must-revalidate ignore-private refresh_pattern
> ^http:\/\/ytimg\.com\.squid\.internal.*  10080 80%  79900 
> override-lastmod override-expire ignore-reload ignore-must-revalidate 
> ignore-private


If you look at those server reply headers you can see the Cache-Control explicitly says the reply is "public". This means that the "ignore-private" setting is useless on these images.
 * ignoring privacy controls is a highly nasty thing to do to start with. I suggest strongly that you remove it from the ytimg pattern options as unnecessary.

Also, here is an artifact of the override options which you may not be
aware:

 The Expires header coming from YT indicates that the reply is cacheable for 6hrs from the time it was generated. That is 21600 seconds, no less.
 Your override-expires is actively *reducing* the storage time to
10800 seconds (the 'min' field of the pattern options).

 Therefore to maximise caching you should *drop* the override-expires option on the ytimg pattern.


NP: override-lastmod is usually also a bad thing to do, but I see you are actually hitting THE use-case for which it legitimately exist...
server emitting incorrect Last-Modified value (1970? sure).



Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUOBHWAAoJELJo5wb/XPRjGv4H/iKpL4UUBOXVsy7BixBeM5xp
JoyRtwRcfH8ksI/G622KANQ2XzOMLyYr9BX5X8ofBGjT8WRRxEbQDzp/EVADB7+6
xO/OwW2413YiYSmgszOTx0joAdUFB4R4ShnCEjDHQ6RJFKIquQql58hDN+6eGHFZ
AkzrlL+V+CzkpOGWmu51kBLlaSMQJ2SaWOJMw0ykn4giuL87XYeRyQ9seFR9Q5Ll
7cKi0QZflcCvDnwa87vPfnvsQfBF/cFjuv7/NigGsO8IklgQ/T3xPf+A6WVXmURj
USLjOmFFsA6xaLZMBeUnmWo4kjX5iYXT1S14yQokpf+DUPfaM0+bt/hUFNLnkuk=
=1TqK
-----END PGP SIGNATURE-----
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

From n614cd at gmail.com  Sat Oct 11 23:48:34 2014
From: n614cd at gmail.com (Timothy Spear)
Date: Sat, 11 Oct 2014 19:48:34 -0400
Subject: [squid-users] SSL/SSH/SFTP/FTPS to alternate ports
Message-ID: <19B1C111-165B-4A69-8EB7-6CDCE8C27875@gmail.com>

Hello,

Here is the issue:
I can proxy through Squid just fine to HTTP and HTTPS. I can also run SSH via Corkscrew to a SSH server running on port 443 and it works fine.
What I cannot do, is access HTTPS or SSH on any other port except 443. I have lost track of the number of things I have tried so any help will be appreciated and I feel like I am missing something simple. 
OS: Ubuntu 14.04.1 LTS
Squid: 3.3.8-1ubuntu6.1

Here is my current Squid 3 configuration:


debug_options all,3

# local network we proxy for
acl localnet src 10.110.98.0/24

# what ports can be the desitnation
acl allowedPorts port 21
acl allowedPorts port 22
acl allowedPorts port 2222
acl allowedPorts port 80
acl allowedPorts port 443
acl allowedPorts port 8443

acl CONNECT method CONNECT

# determine the available sites
acl allowedSites dstdomain "/etc/squid3/allowed-sites.squid"

# now block anything not on the localnet or ports
http_access deny !localnet

# allow connect only for approved ports
http_access deny CONNECT !allowedPorts

# now only allow to the specific sites
http_access allow localnet allowedSites allowedPorts

http_port 3128
access_log /var/log/squid3/access.log squid
hosts_file /etc/hosts


Background (just FYI):
I am trying to setup Squid to control network access from a local subnet to a select number of domains. I do not need to bump the encrypted traffic and play man in the middle, I just need to prevent the servers on the local network from accessing unauthorized networks. Yes, I know I can do this in the Firewall, but that is IP based and I am dealing with enough other companies that maintaining the IP list has become a major pain. Instead I want to use domains, which I can do in Squid.

Thanks,

Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141011/09298cda/attachment.htm>

From ammdispose-squid at yahoo.com  Sun Oct 12 02:17:49 2014
From: ammdispose-squid at yahoo.com (Amm)
Date: Sun, 12 Oct 2014 07:47:49 +0530
Subject: [squid-users] SSL/SSH/SFTP/FTPS to alternate ports
In-Reply-To: <19B1C111-165B-4A69-8EB7-6CDCE8C27875@gmail.com>
References: <19B1C111-165B-4A69-8EB7-6CDCE8C27875@gmail.com>
Message-ID: <5439E4CD.9050801@yahoo.com>


On 10/12/2014 05:18 AM, Timothy Spear wrote:
> Hello,
>
> Here is the issue:
> I can proxy through Squid just fine to HTTP and HTTPS. I can also run 
> SSH via Corkscrew to a SSH server running on port 443 and it works fine.
> What I cannot do, is access HTTPS or SSH on any other port except 443.

Look at SSL_ports and Safe_ports in your squid.conf (unless you rewrote 
it completely)

Amm.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141012/50625d11/attachment.htm>

From crazyworld at outlook.com  Sun Oct 12 03:37:13 2014
From: crazyworld at outlook.com (B)
Date: Sun, 12 Oct 2014 11:37:13 +0800
Subject: [squid-users] SSL/SSH/SFTP/FTPS to alternate ports
In-Reply-To: <19B1C111-165B-4A69-8EB7-6CDCE8C27875@gmail.com>
References: <19B1C111-165B-4A69-8EB7-6CDCE8C27875@gmail.com>
Message-ID: <BLU436-SMTP106B639CBABAB56039B29BACDAF0@phx.gbl>

check out your access log seeing what it says. Sounds like you are 
looking for an AFW from squid. The ports themselves are defined. You 
need to make sure the other ports are opened.

Your rule tells squid to block the non-allowed sites to the non-allowed 
ports. Still sounds like FW function, but with the domain feature only.

-B
On 10/12/2014 7:48 AM, Timothy Spear wrote:
> Hello,
>
> Here is the issue:
> I can proxy through Squid just fine to HTTP and HTTPS. I can also run 
> SSH via Corkscrew to a SSH server running on port 443 and it works fine.
> What I cannot do, is access HTTPS or SSH on any other port except 443. 
> I have lost track of the number of things I have tried so any help 
> will be appreciated and I feel like I am missing something simple.
> OS: Ubuntu 14.04.1 LTS
> Squid: 3.3.8-1ubuntu6.1
>
> Here is my current Squid 3 configuration:
>
>
> debug_optionsall,3
>
> # local network we proxy for
> acllocalnet src10.110.98.0/24
>
> # what ports can be the desitnation
> acl allowedPorts port 21
> acl allowedPorts port 22
> acl allowedPorts port 2222
> acl allowedPorts port 80
> acl allowedPorts port 443
> acl allowedPorts port 8443
>
> acl CONNECT method CONNECT
>
> # determine the available sites
> acl allowedSites dstdomain "/etc/squid3/allowed-sites.squid"
>
> # now block anything not on the localnet or ports
> http_access deny !localnet
>
> # allow connect only for approved ports
> http_access deny CONNECT !allowedPorts
>
> # now only allow to the specific sites
> http_access allow localnet allowedSites allowedPorts
>
> http_port3128
> access_log /var/log/squid3/access.log squid
> hosts_file /etc/hosts
>
>
> Background (just FYI):
> I am trying to setup Squid to control network access from a local 
> subnet to a select number of domains. I do not need to bump the 
> encrypted traffic and play man in the middle, I just need to prevent 
> the servers on the local network from accessing unauthorized networks. 
> Yes, I know I can do this in the Firewall, but that is IP based and I 
> am dealing with enough other companies that maintaining the IP list 
> has become a major pain. Instead I want to use domains, which I can do 
> in Squid.
>
> Thanks,
>
> Tim
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141012/18386913/attachment.htm>

From sergios at greeklug.gr  Sun Oct 12 12:08:22 2014
From: sergios at greeklug.gr (Sergey Tsabolov ( aka linuxman ))
Date: Sun, 12 Oct 2014 15:08:22 +0300
Subject: [squid-users] SSL/SSH/SFTP/FTPS to alternate ports
In-Reply-To: <19B1C111-165B-4A69-8EB7-6CDCE8C27875@gmail.com>
References: <19B1C111-165B-4A69-8EB7-6CDCE8C27875@gmail.com>
Message-ID: <543A6F36.9020500@greeklug.gr>

Hello,
About ports for SSH I think the best way add SSH server running on 2222 
or 4444 ports and not need to change the https 443 ports with ssh ports.
Is the simple way and not need the change the https way.

On 12/10/2014 02:48 ??, Timothy Spear wrote:
> Hello,
>
> Here is the issue:
> I can proxy through Squid just fine to HTTP and HTTPS. I can also run 
> SSH via Corkscrew to a SSH server running on port 443 and it works fine.
> What I cannot do, is access HTTPS or SSH on any other port except 443. 
> I have lost track of the number of things I have tried so any help 
> will be appreciated and I feel like I am missing something simple.
> OS: Ubuntu 14.04.1 LTS
> Squid: 3.3.8-1ubuntu6.1
>
> Here is my current Squid 3 configuration:
>
>
> debug_optionsall,3
>
> # local network we proxy for
> acllocalnet src10.110.98.0/24
>
> # what ports can be the desitnation
> acl allowedPorts port 21
> acl allowedPorts port 22
> acl allowedPorts port 2222
> acl allowedPorts port 80
> acl allowedPorts port 443
> acl allowedPorts port 8443
>
> acl CONNECT method CONNECT
>
> # determine the available sites
> acl allowedSites dstdomain "/etc/squid3/allowed-sites.squid"
>
> # now block anything not on the localnet or ports
> http_access deny !localnet
>
> # allow connect only for approved ports
> http_access deny CONNECT !allowedPorts
>
> # now only allow to the specific sites
> http_access allow localnet allowedSites allowedPorts
>
> http_port3128
> access_log /var/log/squid3/access.log squid
> hosts_file /etc/hosts
>
>
> Background (just FYI):
> I am trying to setup Squid to control network access from a local 
> subnet to a select number of domains. I do not need to bump the 
> encrypted traffic and play man in the middle, I just need to prevent 
> the servers on the local network from accessing unauthorized networks. 
> Yes, I know I can do this in the Firewall, but that is IP based and I 
> am dealing with enough other companies that maintaining the IP list 
> has become a major pain. Instead I want to use domains, which I can do 
> in Squid.
>
> Thanks,
>
> Tim
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
--------------------------------------------------------------------------------------
Don't send me documents in .doc , .docx, .xls, .ppt . , .pptx
Send it with ODF format : .odt , .odp , .ods or .pdf .
Try to use Open Document Format : http://el.libreoffice.org/
Save you money   &  use GNU/Linux Distro http://distrowatch.com/
-----------------------------------------------------------------------------------------
First they ignore you, then they ridicule you, then they fight you, then you win!!!

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141012/78559e3a/attachment.htm>

From n614cd at gmail.com  Sun Oct 12 14:49:05 2014
From: n614cd at gmail.com (Timothy Spear)
Date: Sun, 12 Oct 2014 10:49:05 -0400
Subject: [squid-users] SSL/SSH/SFTP/FTPS to alternate ports
In-Reply-To: <BLU436-SMTP106B639CBABAB56039B29BACDAF0@phx.gbl>
References: <19B1C111-165B-4A69-8EB7-6CDCE8C27875@gmail.com>
 <BLU436-SMTP106B639CBABAB56039B29BACDAF0@phx.gbl>
Message-ID: <A26D68A9-86B3-4349-B5C2-53E02C430A8C@gmail.com>

Here is the access log. I should have included it in the original post. This is accessing a test machine I setup to hit SSH on 22 and 443. I can also hit HTTPS on multiple other ports.

1413125068.706     87 10.110.98.21 TCP_MISS/503 0 CONNECT XXX.XXXX.com:22 - HIER_NONE/- -
1413125086.496   8061 10.110.98.21 TCP_MISS/200 3657 CONNECT XXX.XXXX.com:443 - HIER_DIRECT/54.68.15.208 -

Yes, my intent in the rule set is to provide a list of allowed ports and sites. 

Tim

On Oct 11, 2014, at 11:37 PM, B <crazyworld at outlook.com> wrote:

> check out your access log seeing what it says. Sounds like you are looking for an AFW from squid. The ports themselves are defined. You need to make sure the other ports are opened.
> 
> Your rule tells squid to block the non-allowed sites to the non-allowed ports. Still sounds like FW function, but with the domain feature only.
> 
> -B
> On 10/12/2014 7:48 AM, Timothy Spear wrote:
>> Hello,
>> 
>> Here is the issue:
>> I can proxy through Squid just fine to HTTP and HTTPS. I can also run SSH via Corkscrew to a SSH server running on port 443 and it works fine.
>> What I cannot do, is access HTTPS or SSH on any other port except 443. I have lost track of the number of things I have tried so any help will be appreciated and I feel like I am missing something simple. 
>> OS: Ubuntu 14.04.1 LTS
>> Squid: 3.3.8-1ubuntu6.1
>> 
>> Here is my current Squid 3 configuration:
>> 
>> 
>> debug_options all,3
>> 
>> # local network we proxy for
>> acl localnet src 10.110.98.0/24
>> 
>> # what ports can be the desitnation
>> acl allowedPorts port 21
>> acl allowedPorts port 22
>> acl allowedPorts port 2222
>> acl allowedPorts port 80
>> acl allowedPorts port 443
>> acl allowedPorts port 8443
>> 
>> acl CONNECT method CONNECT
>> 
>> # determine the available sites
>> acl allowedSites dstdomain "/etc/squid3/allowed-sites.squid"
>> 
>> # now block anything not on the localnet or ports
>> http_access deny !localnet
>> 
>> # allow connect only for approved ports
>> http_access deny CONNECT !allowedPorts
>> 
>> # now only allow to the specific sites
>> http_access allow localnet allowedSites allowedPorts
>> 
>> http_port 3128
>> access_log /var/log/squid3/access.log squid
>> hosts_file /etc/hosts
>> 
>> 
>> Background (just FYI):
>> I am trying to setup Squid to control network access from a local subnet to a select number of domains. I do not need to bump the encrypted traffic and play man in the middle, I just need to prevent the servers on the local network from accessing unauthorized networks. Yes, I know I can do this in the Firewall, but that is IP based and I am dealing with enough other companies that maintaining the IP list has become a major pain. Instead I want to use domains, which I can do in Squid.
>> 
>> Thanks,
>> 
>> Tim
>> 
>> 
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141012/ecf66eb1/attachment.htm>

From n614cd at gmail.com  Sun Oct 12 14:50:25 2014
From: n614cd at gmail.com (Timothy Spear)
Date: Sun, 12 Oct 2014 10:50:25 -0400
Subject: [squid-users] SSL/SSH/SFTP/FTPS to alternate ports
In-Reply-To: <543A6F36.9020500@greeklug.gr>
References: <19B1C111-165B-4A69-8EB7-6CDCE8C27875@gmail.com>
 <543A6F36.9020500@greeklug.gr>
Message-ID: <604D8497-B52A-455B-917E-E9DF6E4DE9B7@gmail.com>

Sergey,

I do not control the destination ports, my servers communicate to servers at other companies. In some cases, there are SFTP communications I must perform on 443.

Tim

On Oct 12, 2014, at 8:08 AM, Sergey Tsabolov ( aka linuxman ) <sergios at greeklug.gr> wrote:

> Hello,
> About ports for SSH I think the best way add SSH server running on 2222 or 4444 ports and not need to change the https 443 ports with ssh ports.
> Is the simple way and not need the change the https way.
> 
> On 12/10/2014 02:48 ??, Timothy Spear wrote:
>> Hello,
>> 
>> Here is the issue:
>> I can proxy through Squid just fine to HTTP and HTTPS. I can also run SSH via Corkscrew to a SSH server running on port 443 and it works fine.
>> What I cannot do, is access HTTPS or SSH on any other port except 443. I have lost track of the number of things I have tried so any help will be appreciated and I feel like I am missing something simple. 
>> OS: Ubuntu 14.04.1 LTS
>> Squid: 3.3.8-1ubuntu6.1
>> 
>> Here is my current Squid 3 configuration:
>> 
>> 
>> debug_options all,3
>> 
>> # local network we proxy for
>> acl localnet src 10.110.98.0/24
>> 
>> # what ports can be the desitnation
>> acl allowedPorts port 21
>> acl allowedPorts port 22
>> acl allowedPorts port 2222
>> acl allowedPorts port 80
>> acl allowedPorts port 443
>> acl allowedPorts port 8443
>> 
>> acl CONNECT method CONNECT
>> 
>> # determine the available sites
>> acl allowedSites dstdomain "/etc/squid3/allowed-sites.squid"
>> 
>> # now block anything not on the localnet or ports
>> http_access deny !localnet
>> 
>> # allow connect only for approved ports
>> http_access deny CONNECT !allowedPorts
>> 
>> # now only allow to the specific sites
>> http_access allow localnet allowedSites allowedPorts
>> 
>> http_port 3128
>> access_log /var/log/squid3/access.log squid
>> hosts_file /etc/hosts
>> 
>> 
>> Background (just FYI):
>> I am trying to setup Squid to control network access from a local subnet to a select number of domains. I do not need to bump the encrypted traffic and play man in the middle, I just need to prevent the servers on the local network from accessing unauthorized networks. Yes, I know I can do this in the Firewall, but that is IP based and I am dealing with enough other companies that maintaining the IP list has become a major pain. Instead I want to use domains, which I can do in Squid.
>> 
>> Thanks,
>> 
>> Tim
>> 
>> 
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
> 
> -- 
> --------------------------------------------------------------------------------------
> Don't send me documents in .doc , .docx, .xls, .ppt . , .pptx
> Send it with ODF format : .odt , .odp , .ods or .pdf .
> Try to use Open Document Format : http://el.libreoffice.org/
> Save you money   &  use GNU/Linux Distro http://distrowatch.com/ 
> -----------------------------------------------------------------------------------------
> First they ignore you, then they ridicule you, then they fight you, then you win!!! 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141012/af56ca7d/attachment.htm>

From crazyworld at outlook.com  Sun Oct 12 15:11:43 2014
From: crazyworld at outlook.com (crazy world)
Date: Sun, 12 Oct 2014 15:11:43 +0000
Subject: [squid-users] SSL/SSH/SFTP/FTPS to alternate ports
In-Reply-To: <A26D68A9-86B3-4349-B5C2-53E02C430A8C@gmail.com>
References: <19B1C111-165B-4A69-8EB7-6CDCE8C27875@gmail.com>
 <BLU436-SMTP106B639CBABAB56039B29BACDAF0@phx.gbl>,
 <A26D68A9-86B3-4349-B5C2-53E02C430A8C@gmail.com>
Message-ID: <BLU168-W99CA7227698814D9DC7600CDAF0@phx.gbl>

Do you have the log for the connection when you can't access? Other than 22 and 443 as you said.

Thanks,

-B

Subject: Re: [squid-users] SSL/SSH/SFTP/FTPS to alternate ports
From: n614cd at gmail.com
Date: Sun, 12 Oct 2014 10:49:05 -0400
CC: n614cd at gmail.com; squid-users at lists.squid-cache.org
To: crazyworld at outlook.com

Here is the access log. I should have included it in the original post. This is accessing a test machine I setup to hit SSH on 22 and 443. I can also hit HTTPS on multiple other ports.
1413125068.706     87 10.110.98.21 TCP_MISS/503 0 CONNECT XXX.XXXX.com:22 - HIER_NONE/- -1413125086.496   8061 10.110.98.21 TCP_MISS/200 3657 CONNECT XXX.XXXX.com:443 - HIER_DIRECT/54.68.15.208 -
Yes, my intent in the rule set is to provide a list of allowed ports and sites. 
Tim
On Oct 11, 2014, at 11:37 PM, B <crazyworld at outlook.com> wrote:
  
    
  
  
    check out your access log seeing what
      it says. Sounds like you are looking for an AFW from squid. The
      ports themselves are defined. You need to make sure the other
      ports are opened.

      

      Your rule tells squid to block the non-allowed sites to the
      non-allowed ports. Still sounds like FW function, but with the
      domain feature only.

      

      -B
      On 10/12/2014 7:48 AM, Timothy Spear wrote:

    
    
      
      Hello,
      

      
      Here is the issue:
      I can proxy through Squid just fine to HTTP and HTTPS. I can
        also run SSH via Corkscrew to a SSH server running on port 443
        and it works fine.
      What I cannot do, is access HTTPS or SSH on any other port
        except 443. I have lost track of the number of things I have
        tried so any help will be appreciated and I feel like I am
        missing something simple. 
      OS: Ubuntu 14.04.1 LTS
      Squid: 3.3.8-1ubuntu6.1
      

      
      Here is my current Squid 3 configuration:
      

      
      

      
      
        debug_options all,3
        

        
        # local network we proxy for
        acl localnet src 10.110.98.0/24
        

        
        # what ports can be the desitnation
        acl allowedPorts port 21
        acl allowedPorts port 22
        acl allowedPorts port 2222
        acl allowedPorts port 80
        acl allowedPorts port 443
        acl allowedPorts port 8443
        

        
        acl CONNECT method CONNECT
        

        
        # determine the available sites
        acl allowedSites dstdomain
          "/etc/squid3/allowed-sites.squid"
        

        
        # now block anything not on the
          localnet or ports
        http_access deny !localnet
        

        
        
          # allow
            connect only for approved ports
          http_access deny CONNECT !allowedPorts
          

          
        
        # now only allow to the specific
          sites
        http_access allow localnet
          allowedSites allowedPorts
        

        
        http_port 3128
        access_log /var/log/squid3/access.log squid
        hosts_file
          /etc/hosts
      
      

      
      

      
      Background (just FYI):
      I am trying to setup Squid to control network access from a
        local subnet to a select number of domains. I do not need to
        bump the encrypted traffic and play man in the middle, I just
        need to prevent the servers on the local network from accessing
        unauthorized networks. Yes, I know I can do this in the
        Firewall, but that is IP based and I am dealing with enough
        other companies that maintaining the IP list has become a major
        pain. Instead I want to use domains, which I can do in Squid.
      

      
      Thanks,
      

      
      Tim
      

      
      

      _______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

    
    

  


 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141012/9fea35f4/attachment.htm>

From n614cd at gmail.com  Sun Oct 12 15:33:43 2014
From: n614cd at gmail.com (Timothy Spear)
Date: Sun, 12 Oct 2014 11:33:43 -0400
Subject: [squid-users] SSL/SSH/SFTP/FTPS to alternate ports
In-Reply-To: <BLU168-W99CA7227698814D9DC7600CDAF0@phx.gbl>
References: <19B1C111-165B-4A69-8EB7-6CDCE8C27875@gmail.com>
 <BLU436-SMTP106B639CBABAB56039B29BACDAF0@phx.gbl>,
 <A26D68A9-86B3-4349-B5C2-53E02C430A8C@gmail.com>
 <BLU168-W99CA7227698814D9DC7600CDAF0@phx.gbl>
Message-ID: <674CE95A-8326-4B1C-A63D-50D678BFF440@gmail.com>

B,

I was going to attach the logs, but I now feel like an idiot. :D
The jump box I am running Squid on, currently only allows 80 and 443 outbound. I recalled this when I went to scp the log files and the connection was refused....
I detest overlooking things like this. Sometimes, you really need question any assumptions.

Tim

On Oct 12, 2014, at 11:11 AM, crazy world <crazyworld at outlook.com> wrote:

> Do you have the log for the connection when you can't access? Other than 22 and 443 as you said.
> 
> Thanks,
> 
> -B
> 
> Subject: Re: [squid-users] SSL/SSH/SFTP/FTPS to alternate ports
> From: n614cd at gmail.com
> Date: Sun, 12 Oct 2014 10:49:05 -0400
> CC: n614cd at gmail.com; squid-users at lists.squid-cache.org
> To: crazyworld at outlook.com
> 
> Here is the access log. I should have included it in the original post. This is accessing a test machine I setup to hit SSH on 22 and 443. I can also hit HTTPS on multiple other ports.
> 
> 1413125068.706     87 10.110.98.21 TCP_MISS/503 0 CONNECT XXX.XXXX.com:22 - HIER_NONE/- -
> 1413125086.496   8061 10.110.98.21 TCP_MISS/200 3657 CONNECT XXX.XXXX.com:443 - HIER_DIRECT/54.68.15.208 -
> 
> Yes, my intent in the rule set is to provide a list of allowed ports and sites. 
> 
> Tim
> 
> On Oct 11, 2014, at 11:37 PM, B <crazyworld at outlook.com> wrote:
> 
> check out your access log seeing what it says. Sounds like you are looking for an AFW from squid. The ports themselves are defined. You need to make sure the other ports are opened.
> 
> Your rule tells squid to block the non-allowed sites to the non-allowed ports. Still sounds like FW function, but with the domain feature only.
> 
> -B
> On 10/12/2014 7:48 AM, Timothy Spear wrote:
> Hello,
> 
> Here is the issue:
> I can proxy through Squid just fine to HTTP and HTTPS. I can also run SSH via Corkscrew to a SSH server running on port 443 and it works fine.
> What I cannot do, is access HTTPS or SSH on any other port except 443. I have lost track of the number of things I have tried so any help will be appreciated and I feel like I am missing something simple. 
> OS: Ubuntu 14.04.1 LTS
> Squid: 3.3.8-1ubuntu6.1
> 
> Here is my current Squid 3 configuration:
> 
> 
> debug_options all,3
> 
> # local network we proxy for
> acl localnet src 10.110.98.0/24
> 
> # what ports can be the desitnation
> acl allowedPorts port 21
> acl allowedPorts port 22
> acl allowedPorts port 2222
> acl allowedPorts port 80
> acl allowedPorts port 443
> acl allowedPorts port 8443
> 
> acl CONNECT method CONNECT
> 
> # determine the available sites
> acl allowedSites dstdomain "/etc/squid3/allowed-sites.squid"
> 
> # now block anything not on the localnet or ports
> http_access deny !localnet
> 
> # allow connect only for approved ports
> http_access deny CONNECT !allowedPorts
> 
> # now only allow to the specific sites
> http_access allow localnet allowedSites allowedPorts
> 
> http_port 3128
> access_log /var/log/squid3/access.log squid
> hosts_file /etc/hosts
> 
> 
> Background (just FYI):
> I am trying to setup Squid to control network access from a local subnet to a select number of domains. I do not need to bump the encrypted traffic and play man in the middle, I just need to prevent the servers on the local network from accessing unauthorized networks. Yes, I know I can do this in the Firewall, but that is IP based and I am dealing with enough other companies that maintaining the IP list has become a major pain. Instead I want to use domains, which I can do in Squid.
> 
> Thanks,
> 
> Tim
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141012/2ed9c5dd/attachment.htm>

From rwheeler at artifact-software.com  Sun Oct 12 16:18:12 2014
From: rwheeler at artifact-software.com (Ron Wheeler)
Date: Sun, 12 Oct 2014 12:18:12 -0400
Subject: [squid-users] SSL/SSH/SFTP/FTPS to alternate ports
In-Reply-To: <674CE95A-8326-4B1C-A63D-50D678BFF440@gmail.com>
References: <19B1C111-165B-4A69-8EB7-6CDCE8C27875@gmail.com>
 <BLU436-SMTP106B639CBABAB56039B29BACDAF0@phx.gbl>,
 <A26D68A9-86B3-4349-B5C2-53E02C430A8C@gmail.com>
 <BLU168-W99CA7227698814D9DC7600CDAF0@phx.gbl>
 <674CE95A-8326-4B1C-A63D-50D678BFF440@gmail.com>
Message-ID: <543AA9C4.6030106@artifact-software.com>

On 12/10/2014 11:33 AM, Timothy Spear wrote:
> B,
>
> I was going to attach the logs, but I now feel like an idiot. :D
> The jump box I am running Squid on, currently only allows 80 and 443 
> outbound. I recalled this when I went to scp the log files and the 
> connection was refused....
> I detest overlooking things like this. Sometimes, you really need 
> question any assumptions.

You are not alone! "Sometimes"->"Always"

>
> Tim
>
> On Oct 12, 2014, at 11:11 AM, crazy world <crazyworld at outlook.com 
> <mailto:crazyworld at outlook.com>> wrote:
>
>> Do you have the log for the connection when you can't access? Other 
>> than 22 and 443 as you said.
>>
>> Thanks,
>>
>> -B
>>
>> ------------------------------------------------------------------------
>> Subject: Re: [squid-users] SSL/SSH/SFTP/FTPS to alternate ports
>> From: n614cd at gmail.com <mailto:n614cd at gmail.com>
>> Date: Sun, 12 Oct 2014 10:49:05 -0400
>> CC: n614cd at gmail.com <mailto:n614cd at gmail.com>; 
>> squid-users at lists.squid-cache.org 
>> <mailto:squid-users at lists.squid-cache.org>
>> To: crazyworld at outlook.com <mailto:crazyworld at outlook.com>
>>
>> Here is the access log. I should have included it in the original 
>> post. This is accessing a test machine I setup to hit SSH on 22 and 
>> 443. I can also hit HTTPS on multiple other ports.
>>
>> 1413125068.706     87 10.110.98.21 TCP_MISS/503 0 CONNECTXXX.XXXX.com 
>> <http://xxx.xxxx.com/>:22 - HIER_NONE/- -
>> 1413125086.496   8061 10.110.98.21 TCP_MISS/200 3657 
>> CONNECTXXX.XXXX.com <http://xxx.xxxx.com/>:443 - 
>> HIER_DIRECT/54.68.15.208 -
>>
>> Yes, my intent in the rule set is to provide a list of allowed ports 
>> and sites.
>>
>> Tim
>>
>> On Oct 11, 2014, at 11:37 PM, B <crazyworld at outlook.com 
>> <mailto:crazyworld at outlook.com>> wrote:
>>
>>     check out your access log seeing what it says. Sounds like you
>>     are looking for an AFW from squid. The ports themselves are
>>     defined. You need to make sure the other ports are opened.
>>
>>     Your rule tells squid to block the non-allowed sites to the
>>     non-allowed ports. Still sounds like FW function, but with the
>>     domain feature only.
>>
>>     -B
>>     On 10/12/2014 7:48 AM, Timothy Spear wrote:
>>
>>         Hello,
>>
>>         Here is the issue:
>>         I can proxy through Squid just fine to HTTP and HTTPS. I can
>>         also run SSH via Corkscrew to a SSH server running on port
>>         443 and it works fine.
>>         What I cannot do, is access HTTPS or SSH on any other port
>>         except 443. I have lost track of the number of things I have
>>         tried so any help will be appreciated and I feel like I am
>>         missing something simple.
>>         OS: Ubuntu 14.04.1 LTS
>>         Squid: 3.3.8-1ubuntu6.1
>>
>>         Here is my current Squid 3 configuration:
>>
>>
>>         debug_optionsall,3
>>
>>         # local network we proxy for
>>         acllocalnetsrc10.110.98.0/24
>>
>>         # what ports can be the desitnation
>>         aclallowedPortsport21
>>         aclallowedPortsport22
>>         acl allowedPorts port 2222
>>         aclallowedPortsport80
>>         acl allowedPorts port 443
>>         acl allowedPorts port 8443
>>
>>         aclCONNECTmethodCONNECT
>>
>>         # determine the available sites
>>         aclallowedSitesdstdomain"/etc/squid3/allowed-sites.squid"
>>
>>         # now block anything not on the localnet or ports
>>         http_accessdeny!localnet
>>
>>         # allow connect only for approved ports
>>         http_access deny CONNECT !allowedPorts
>>
>>         # now only allow to the specific sites
>>         http_accessallowlocalnet allowedSites allowedPorts
>>
>>         http_port3128
>>         access_log/var/log/squid3/access.logsquid
>>         hosts_file /etc/hosts
>>
>>
>>         Background (just FYI):
>>         I am trying to setup Squid to control network access from a
>>         local subnet to a select number of domains. I do not need to
>>         bump the encrypted traffic and play man in the middle, I just
>>         need to prevent the servers on the local network from
>>         accessing unauthorized networks. Yes, I know I can do this in
>>         the Firewall, but that is IP based and I am dealing with
>>         enough other companies that maintaining the IP list has
>>         become a major pain. Instead I want to use domains, which I
>>         can do in Squid.
>>
>>         Thanks,
>>
>>         Tim
>>
>>
>>         _______________________________________________
>>         squid-users mailing list
>>         squid-users at lists.squid-cache.org  <mailto:squid-users at lists.squid-cache.org>
>>         http://lists.squid-cache.org/listinfo/squid-users
>>
>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


-- 
Ron Wheeler
President
Artifact Software Inc
email: rwheeler at artifact-software.com
skype: ronaldmwheeler
phone: 866-970-2435, ext 102

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141012/4d72b5f2/attachment.htm>

From oriental.sniper at gmail.com  Sun Oct 12 22:28:29 2014
From: oriental.sniper at gmail.com (orientalsniper)
Date: Sun, 12 Oct 2014 17:28:29 -0500
Subject: [squid-users] Forwarding loop again
Message-ID: <CAKdv9+uBEcy4npmD5kr8RoimZY7=YouwWcZgXumUC+hQAena=Q@mail.gmail.com>

Hello all, I'm having forwarding loops again, this time however it's
different. With Squid alone it works, however if I use it with
Dansguardian, I'm getting forwarding loops.

This is the most relevant message from the logs:
X-Forwarded-For: 10.1.0.3, 10.2.0.4
10.1.0.3 is the client requesting the website.
10.2.0.4 is an alias for the host. nginx is listening in this address.
And I don't know how 10.2.0.4 ended up there.

I have some aliases set in /etc/rc.conf, starting from 10.2.0.4 to
10.2.0.9, this is for nginx.

HTTP traffic are redirected with pfSense (10.0.0.1, 10.1.0.1), with a
FW rule using 10.2.0.2 (FreeBSD) as gateway.

Dansguardian is listening in 8081, Squid is listening in 3129.

This is my ipfw.rules:
cmd="ipfw -q add"
$cmd 01 allow tcp from any to 10.2.0.1{4-9}

$cmd 02 allow tcp from 10.2.0.1{4-9} to any
$cmd 03 allow tcp from 10.2.0.2 to any 80 out uid squid
$cmd 09 fwd 10.2.0.2,8081 tcp from 10.1.0.3 to any 80
$cmd 20 allow all from any to any (this is temporary)

Most relevant parts of squid.conf:
http_port 10.2.0.2:3129 intercept
follow_x_forwarded_for allow localnet
cache_effective_user squid
cache_effective_group squid
check_hostnames on
unique_hostname squid

Most relevant parts of dansguardian.conf:
filterip = 10.2.0.2
filterports = 8081
proxyip = 10.2.0.2
proxyport = 3129
daemonuser = 'dansguardian'
daemongroup = 'dansguardian'


From mirza.dedic at outlook.com  Mon Oct 13 00:47:06 2014
From: mirza.dedic at outlook.com (Mirza Dedic)
Date: Sun, 12 Oct 2014 17:47:06 -0700
Subject: [squid-users] cygwin (running on Win2K3 and 2K8) + squid 3.3.3 +
	negotiate_kerberos_auth
Message-ID: <BAY405-EAS2475687DA0E25380AEC4CAEF0AC0@phx.gbl>

I've got a Squid 3.3.3 running on Windows 2003 (and 2008) box via CYGWIN,
works with the basic config.

 

My next step is to put in some authentication in place, in this case
Kerberos using..

 

auth_param negotiate program /usr/lib/squid/negotiate_kerberos_auth -d -s
HTTP/vis-squid.VAND1.OPPY.COM

auth_param negotiate children 10

auth_param negotiate keep_alive on

 

Before I can do this, I need to get a keytab file and setup the proper SPNs,
on CYGWIN we don't have Samba so I am using  msktutil to create the computer
account and keytab/SPNs; specifically one that works under CYGWIN
(https://github.com/fd00/yacp/tree/master/msktutil).

 

When I try to create the keytab as per
http://wiki.squid-cache.org/ConfigExamples/Authenticate/Kerberos by
running...



msktutil -c -b "CN=computers" -s HTTP/xxx-squid.MY.DOMAIN.COM -k
/etc/squid/PROXY.keytab --computer-name xxx-squid --upn HTTP/
xxx-squid.MY.DOMAIN.COM--server DCSRV02 --enctypes 28 -verbose

 

It runs but dies at..

 

-- ldap_get_pwdLastSet: pwdLastSet is 130576191605205669

-- set_password: Successfully set password, waiting for it to be reflected
in LDAP.

-- ldap_get_pwdLastSet: pwdLastSet is 130576191607895789

-- set_password: Successfully reset computer's password

-- set_password: Setting samba machine trust account password

The syntax of this command is:

 

 

NET [ ACCOUNTS | COMPUTER | CONFIG | CONTINUE | FILE | GROUP | HELP |

      HELPMSG | LOCALGROUP | NAME | PAUSE | PRINT | SEND | SESSION |

      SHARE | START | STATISTICS | STOP | TIME | USE | USER | VIEW ]

 

Setting samba secret failed with error code 256

Error: set_password failed

Hint: Does your password policy allow to change vis-squid's password?

      For example, there could be a "Minimum password age" policy preventing

      passwords from being changed too frequently. If so, you can reset the

      password instead of changing it using the --user-creds-only option.

      Be aware that you need a ticket of a user with administrative
privileges

      for that.

-- ~msktutil_exec: Destroying msktutil_exec

-- ldap_cleanup: Disconnecting from LDAP server

-- init_password: Wiping the password structure

-- ~KRB5Context: Destroying Kerberos Context

 

Looks like it is trying to use Samba's "net" command which is different than
the net command above (windows). So I edited
http://repo.or.cz/w/msktutil.git/blob/9f22f3ec6efa0a6f8bb122fb14095a1ab50d3d
6c:/msktpass.cpp and commented out the block of code that tries to run "net
changesecretpw" samba cmd (I thought the whole purpose of msktutil was an
alternative way to perform net ads keytab create so why is it  running that
cmdlet.) then re-compiled msktutil and re-ran it..

 

It went through this time with..

 

-- ldap_get_pwdLastSet: pwdLastSet is 130576324675479078

-- set_password: Successfully reset computer's password

-- set_password: Setting samba machine trust account password

-- set_password: Successfully set samba machine trust account password

-- ldap_add_principal: Checking that adding principal
HTTP/xxx-squid.MY.DOMAIN.COM to vis-squid won't cause a conflict

-- ldap_add_principal: Adding principal HTTP/xxx-squid.MY.DOMAIN.COM to LDAP
entry

-- execute: Updating all entries for rmt-server01.MY.DOMAIN.COM in the
keytab WRFILE:/etc/squid/PROXY.keytab

 

-- update_keytab: Updating all entires for vis-squid

-- ldap_get_kvno: KVNO is 4

-- add_principal_keytab: Adding principal to keytab: vis-squid

-- add_principal_keytab:     Using salt of
MY.DOMAIN.COMHTTPxxx-squid.MY.DOMAIN.COM

-- add_principal_keytab:   Adding entry of enctype 0x17

-- add_principal_keytab:     Using salt of
MY.DOMAIN.COMHTTPxxx-squid.MY.DOMAIN.COM

-- add_principal_keytab:   Adding entry of enctype 0x11

-- add_principal_keytab:     Using salt of
MY.DOMAIN.COMHTTPxxx-squid.MY.DOMAIN.COM

-- add_principal_keytab:   Adding entry of enctype 0x12

-- add_principal_keytab: Adding principal to keytab:
HTTP/xxx-squid.MY.DOMAIN.COM

-- add_principal_keytab: Removing entries with kvno < 0

-- add_principal_keytab:     Using salt of
MY.DOMAIN.COMHTTPxxx-squid.MY.DOMAIN.COM

-- add_principal_keytab:   Adding entry of enctype 0x17

-- add_principal_keytab:     Using salt of
MY.DOMAIN.COMHTTPxxx-squid.MY.DOMAIN.COM

-- add_principal_keytab:   Adding entry of enctype 0x11

-- add_principal_keytab:     Using salt of
MY.DOMAIN.COMHTTPxxx-squid.MY.DOMAIN.COM

-- add_principal_keytab:   Adding entry of enctype 0x12

-- ~msktutil_exec: Destroying msktutil_exec

-- ldap_cleanup: Disconnecting from LDAP server

-- init_password: Wiping the password structure

-- ~KRB5Context: Destroying Kerberos Context

 

In AD I can see a new user account named "xxx-squid" (should this not be a
computer object instead of a user object?), so now back to Squid
(stop/start) and try hitting google.com via IE9/IE10/IE11 I get..

 

2014/10/12 17:37:14 kid1| ERROR: Negotiate Authentication validating user.
Error returned 'BH gss_accept_sec_context() failed: Unspecified GSS failure.
Minor code may provide more information. Key version number for principal in
key table is incorrect'

 

So.. something is still not right with my setup.. any suggestions? Can I
create the keytab file on my Active Directory server and copy the file and
use it instead?

 

With the recent release of SQUID 3.3.3 to CYGWIN
(http://sourceware.mirrors.tds.net/pub/sourceware.org/cygwin/x86/release/squ
id/) I've been at it for a few days trying to make it work but stuck at
getting SSO with negotiate_kerberos_auth..

 

Any ideas?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141012/6ca78cd3/attachment.htm>

From jbhasin83 at gmail.com  Mon Oct 13 01:42:07 2014
From: jbhasin83 at gmail.com (Jatin Bhasin)
Date: Mon, 13 Oct 2014 12:42:07 +1100
Subject: [squid-users] blockVirgin Works for CONNECT but Custom Response
 does not work
In-Reply-To: <CAGRJihXWNenmX3iff34v0AqHodsb+NyEJFnF6E+MteA3LqKpBA@mail.gmail.com>
References: <CAGRJihXzGpw7dr-2B_s=oajK97BcG7QzC5OLAPWgpuvtsC0nWg@mail.gmail.com>
 <1408620949946.22246@diladele.com>
 <CAGRJihV0jMFTy5qw66Pq8z+6khujho6hbTM8K1tqycYMBNKjZg@mail.gmail.com>
 <CAGRJihUq0dsinws7ZH7n1P=u5NDGSB08+rCKz6MqLsUm8V=h+g@mail.gmail.com>
 <53F7DF54.9020505@measurement-factory.com>
 <CAGRJihX7xqTWJA4RHa99jUmd1k-gtCyE-hq=MzRK4XTHXtgfwA@mail.gmail.com>
 <5437F8CC.1050305@measurement-factory.com>
 <CAGRJihXWNenmX3iff34v0AqHodsb+NyEJFnF6E+MteA3LqKpBA@mail.gmail.com>
Message-ID: <CAGRJihXc6s-bQZq01J7wjihJBmuvWQSvQNFLUtbm6OQ1iJp=Eg@mail.gmail.com>

Hi Alex,

I think I have found the reason that why the annotation from eCap
adapter NOT being passed to NoteData.cc. But I still need your
suggestion to fix this.

So here is my analysis:

1) In src/acl/NoteData.cc function ACLNoteData::match(HttpRequest *request)

    if (request->notes != NULL && matchNotes(request->notes.getRaw()))
               (This is used when there is note directive in
squid.conf file)
        return true;


    if (ah != NULL && ah->metaHeaders != NULL &&
matchNotes(ah->metaHeaders.getRaw()))                   (This is used
when there is adaptation_meta in squid.conf file)
        return true;

2) In src/adaptation/ecap/XactionRep.cc function
Adaptation::Ecap::XactionRep::start()

    if (ah != NULL) {
        // retrying=false because ecap never retries transactions
        adaptHistoryId = ah->recordXactStart(service().cfg().key,
current_time, false);
        typedef Notes::iterator ACAMLI;
        for (ACAMLI i = Adaptation::Config::metaHeaders.begin(); i !=
Adaptation::Config::metaHeaders.end(); ++i) {
            const char *v = (*i)->match(request, reply);
            if (v) {
                if (ah->metaHeaders == NULL)
                    ah->metaHeaders = new NotePairs();
                if (!ah->metaHeaders->hasPair((*i)->key.termedBuf(), v))
                    ah->metaHeaders->add((*i)->key.termedBuf(), v);
            }
        }
    }


As per the above code ah->metaHeaders will only be populated if
adaptation_meta option is present in squid.conf file.

So in my case ah->metaHeaders is NULL  (And when I added
adaptation_meta X-Virus-ID yes all in squid.conf then I could get a
match on my toBump acl and hence my CONNECT transaction was bumped.
But I want to achieve the same behavior using eCap adapter)


Also I changed the squid.conf file for access.log as below:
logformat with_note %ts.%03tu %6tr %>a %Ss/%03>Hs %<st %rm %ru %[un
%Sh/%<a %mt %note %adapt::<last_h


And I could see that eCap adapter X-Virus-ID:yes in the access.log
(%adapt::<last_h)

So, I think I am very close to pass X-Virus-ID:yes as a meta header.
Can you suggest me how I can do it. (I think it may require a code
change in XactionRep.cc but I am not sure.) Please suggest.

Thanks,
Jatin




On Sat, Oct 11, 2014 at 2:03 PM, Jatin Bhasin <jbhasin83 at gmail.com> wrote:
> Hi Alex,
>
> I changed my ACL's a bit to see annotations in access.log file. My web
> browser is point to squid port 3127.
>
> So squid.conf is as below:  (first two lines are for note logging as
> you suggested.)
> ---------------------------------------------
> logformat with_note %ts.%03tu %6tr %>a %Ss/%03>Hs %<st %rm %ru %[un
> %Sh/%<a %mt %note
> access_log /var/log/squid/access.log with_note
> adaptation_masterx_shared_names X-Virus-ID
> acl toBump note X-Virus-ID yes
> acl p3127 myportname 3127
> ssl_bump client-first p3127          (Hence all requests will be bumped.)
>
> I made changes to the eCap adapter as you had suggested. But I do not
> see any annotations in access.log file.
>
>
> 1412995864.045      7 10.100.249.11 TAG_NONE/200 0 CONNECT
> www.bwin.com:443 - HIER_NONE/- - -
> 1412995867.108   2573 10.100.249.11 TCP_MISS/200 10122 GET
> https://www.bwin.com/ - HIER_DIRECT/195.72.134.135 text/html -
>
>
> Now i I introduce another paramter in the squid.conf file as below:
>
> note X-Virus-ID yes p3127
>
> And I get following in access.log  (so this is definitely not coming
> from my eCap adapter but because of the note directive above)
>
> 1412996265.992      7 10.100.249.11 TAG_NONE/200 0 CONNECT
> www.bwin.com:443 - HIER_NONE/- - X-Virus-ID:%20yes%0D%0A
> 1412996266.159     87 10.100.249.11 TAG_NONE/200 1400 GET
> https://www.bwin.com/ - HIER_NONE/- - X-Virus-ID:%20yes%0D%0A
>
>
>
> Now, this makes me feel that annotations from my eCap adapter are not
> travelling to squid for both CONNECT and GET.
>
> So, would my eCap adapter has to do something else to let squid know
> that the annotations its providing is a note.
>
> Thanks,
> Jatin
>
>
> On Sat, Oct 11, 2014 at 2:18 AM, Alex Rousskov
> <rousskov at measurement-factory.com> wrote:
>> On 10/09/2014 11:57 PM, Jatin Bhasin wrote:
>>
>>> adaptation_masterx_shared_names X-Virus-ID
>>> acl toBump note X-Virus-ID yes
>>> ssl_bump client-first toBump
>>
>> OK.
>>
>>
>>> My eCap adapter functions which returns yes for the X-Virus-ID are:
>>> =================================================================
>>> const libecap::Area Adapter::Xaction::option(const libecap::Name &name) const
>>> {
>>> std::string str = "yes";
>>> return libecap::Area(str.data(), str.size());
>>> }
>>
>> Two bugs here:
>>
>> * You are returning a pointer to str, which is a temporary, on-stack
>> storage. Use libecap::Area::FromTempString() instead.
>>
>> * You are returning "yes" value for all option names. The return value
>> should be conditional on name parameter being lequal to
>> libecap::metaVirusId ("X-Virus-ID").
>>
>> These two bugs may not actually affect you (for several reasons), but
>> you should fix them anyway.
>>
>>
>>> --------------------------------------------------------------------------------------------------------------------
>>> void Adapter::Xaction::visitEachOption(libecap::NamedValueVisitor
>>> &visitor) const
>>> {
>>> std::string str = "yes";
>>>     visitor.visit(libecap::metaVirusId, libecap::Area(str.data(), str.size()));
>>> }
>>
>> There is no need for std::string in this case, but the above code is not
>> buggy, just inefficient.
>>
>>
>>> Looking at cache.log I see that X-Virus-ID is set to yes but the eCap
>>> adapter functions. But I do not know that how it will be picked up
>>> note acl. Please suggest.
>>
>> I agree that Squid seems to receive the X-Virus-ID:yes metaheader from
>> the eCAP adapter, but your toBump ACL still does not match. I cannot
>> tell why that is [not] happening by looking at the cache log, unfortunately.
>>
>> You may want to add debugging to ACLNoteData::match and
>> ACLNoteData::matchNotes in src/acl/NoteData.cc to see if the ACL code
>> has access to the eCAP history with X-Virus-ID metaheader.
>>
>> The only theory I can offer right now is that the code handling
>> annotations for CONNECT requests is broken and does not store or does
>> not preserve annotations received from eCAP adapters. CONNECT requests
>> are treated specially in Squid. You can try to test that theory by
>> annotating GET requests, for example.
>>
>> Another good test is to log your annotation to access.log using %note
>> logformat code. If it is not logged, Squid probably lost it. If it is
>> logged, then the ACL code does not have access to the information for
>> some reason. This test can be done for both CONNECT and GET requests.
>>
>>
>> HTH,
>>
>> Alex.
>>
>>
>>
>>> On Sat, Aug 23, 2014 at 10:24 AM, Alex Rousskov wrote:
>>>> On 08/21/2014 07:06 PM, Jatin Bhasin wrote:
>>>>
>>>>> So, can somebody suggest me if there is a way to pass a flag to squid
>>>>> from ecap adapter to decrypt a site regardless of what ACL says. For
>>>>> example if I have an acl as below which says do not decrypt
>>>>> www.888.com but If my ecap adapter could pass a message to squid
>>>>> asking it to decrypt www.888.com (for that session only) and ignore
>>>>> the below acl.
>>>>> Is it possible?
>>>>
>>>>
>>>> Given a recent-enough Squid version, an adaptation service can control
>>>> Squid behavior via the annotations mechanism and the "note" ACL
>>>> associated with it. For example, your eCAP adapter can return an
>>>> X-Bump:yes annotation(**) that Squid can then match using the note ACL.
>>>> Something along these untested lines:
>>>>
>>>>   acl note toBump X-Bump yes
>>>>   ssl_bump server-first toBump
>>>>   ssl_bump server-first ...
>>>>   ssl_bump none all
>>>>
>>>> This mechanism should be supported for ssl_bump ACLs but I have not
>>>> tested that claim myself.
>>>>
>>>>
>>>> HTH,
>>>>
>>>> Alex.
>>>> (**) In eCAP terminology, an X-Bump:yes annotation is an adapter
>>>> transaction option named X-Bump with a "yes" value. See
>>>> libecap::Options, which is a parent of libecap::adapter::Xaction.
>>>>
>>


From squid3 at treenet.co.nz  Mon Oct 13 04:30:14 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 13 Oct 2014 17:30:14 +1300
Subject: [squid-users] Forwarding loop again
In-Reply-To: <CAKdv9+uBEcy4npmD5kr8RoimZY7=YouwWcZgXumUC+hQAena=Q@mail.gmail.com>
References: <CAKdv9+uBEcy4npmD5kr8RoimZY7=YouwWcZgXumUC+hQAena=Q@mail.gmail.com>
Message-ID: <543B5556.5080105@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 13/10/2014 11:28 a.m., orientalsniper wrote:
> Hello all, I'm having forwarding loops again, this time however
> it's different. With Squid alone it works, however if I use it
> with Dansguardian, I'm getting forwarding loops.
> 

You seem to have forgotten the key lesson in what I was trying to get
through to you in the laster conversation. So you are making the same
mistake again.

* Squid listening ports are flagged with the *type* of traffic
arriving there.

* You MUST NOT mix types with Squid-3.

What type of traffic is your Squid port receiving?

> Most relevant parts of squid.conf: http_port 10.2.0.2:3129
> intercept follow_x_forwarded_for allow localnet 
> cache_effective_user squid cache_effective_group squid 
> check_hostnames on unique_hostname squid
> 

What type of traffic is coming out of DansGuardian?

> Most relevant parts of dansguardian.conf: filterip = 10.2.0.2 
> filterports = 8081 proxyip = 10.2.0.2 proxyport = 3129 daemonuser =
> 'dansguardian' daemongroup = 'dansguardian'

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUO1VWAAoJELJo5wb/XPRj1OoH/RIJAE16SGqeZ7kM1DW7IkCB
xIHwmJPC0YNFJm7q7oorMkLNp9KD8kk55Sb2wQ8tUmX8a3K3TOhnb97AYbZcfDOk
FtxLvzxyHyTYtbUUS8OWOMYVovxtQ2ZVQEsOSYHMcenAw1Cs/pAmMRswKFN9/uXg
AVn0GbXkavPXW9OMYKStUO/S1d0vESULXwSU2SBhUm5Zo2zAqbOIUdJ+pfFieNDH
q/mFrRazIdeBOqDgGn9eB/PuP+LRx9bc5vmrOuXB4O3j1D0JjLSW82wNC9KFsT8o
gMuRhWAphgSuGeNNWry1yRTIlM5X0rXEDcw/iTaAUPotr4jotxMKl0HLmVZG1vs=
=xzEh
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Mon Oct 13 05:23:09 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 13 Oct 2014 18:23:09 +1300
Subject: [squid-users] cygwin (running on Win2K3 and 2K8) + squid 3.3.3
 + negotiate_kerberos_auth
In-Reply-To: <BAY405-EAS2475687DA0E25380AEC4CAEF0AC0@phx.gbl>
References: <BAY405-EAS2475687DA0E25380AEC4CAEF0AC0@phx.gbl>
Message-ID: <543B61BD.6020400@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Thanks for the details on where to find Cygwin builds of Squid. I have
updated our wiki entry for Windows to include that.

As for the mskutil problems, you should not have to be patching at
all. Please contact the mskutil developers / support about that problem.

Once you have a working tool, using it to setup for Squid is on topic
here. But we are not the appropriate audience for debugging OS tools
intended for purposes unrelated to Squid. Even debugging Squid is
off-topic relly, but we make some exceptions there.

Cheers, and good luck resolving this.
Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUO2G9AAoJELJo5wb/XPRjOkMH/jJ+gtrexsfUv9FYEx5hzBxA
GkJRY7B4JKPL/XogKvMBz8NVOo2h7+2kYMYsZL9wTl4JcIHfPf1ysPC5nMQ/re9+
KIGqqInrd6XSf4N2K+evrmtHbg/+iG6vlNXeA+fUb21zl0HMOxb8x+uuYiiPBbtA
9EpEKNSc+Q4HXZJPiL2EPUq4b0HWRUUwoZD8+403eRHpozeEg0yEiSCTVTEJTUuO
41ho73VZehBchBLSRDWCUcuCqM5SFAOc+OJrVxfuqDp47pVtFzhzi+UqOypy4KHT
sxtZIYo6vy7CqMv+9tO9QsAQawJA1Z0a0YFll0jIXlgqobwZPyE9LFyKRSx25e0=
=zUj/
-----END PGP SIGNATURE-----


From tomtux007 at gmail.com  Mon Oct 13 05:26:11 2014
From: tomtux007 at gmail.com (Tom Tom)
Date: Mon, 13 Oct 2014 07:26:11 +0200
Subject: [squid-users] TCP_DENIED/403 after Upgrading from 3.4.4 to
 3.4.7 (ssl_bump enabled)
In-Reply-To: <CACLJR+ONhco_QRz+7jk=LXUdL0DA3BpPA5gzSyq3cJ5NGJH7wg@mail.gmail.com>
References: <CACLJR+M4J_zUyQM-i_1jQ-MknxSTz8ZsjadLAyNOpjbTdUCJbg@mail.gmail.com>
 <CACLJR+MGYogR-vJArRHVwHe=-XozFJs=4J6U5FdtaiCOUao0PQ@mail.gmail.com>
 <5435487A.5090302@treenet.co.nz> <543549A1.1070700@treenet.co.nz>
 <CACLJR+ONhco_QRz+7jk=LXUdL0DA3BpPA5gzSyq3cJ5NGJH7wg@mail.gmail.com>
Message-ID: <CACLJR+MNEVmx_ZrmXdYhCKV3RpZrN+PPDAc3R3Ep9-nkc+FWqg@mail.gmail.com>

Hi

Does anyone have some ideas/hints concerning this problem?

Many thanks.
Tom

On Wed, Oct 8, 2014 at 8:16 PM, Tom Tom <tomtux007 at gmail.com> wrote:
> I still get a TCP_DENIED/403 while accessing a bumped https-site after
> putting a "-" or even "^root$" in /etc/squid/DENY_USERS_LOCAL. The
> cache.log with "debug_options 29,3 28,9" activated looks like this:
>
> 014/10/08 20:03:00.539 kid2| Acl.cc(157) matches: checking DENY_USERS_LOCAL
> 2014/10/08 20:03:00.539 kid2| Acl.cc(28) AuthenticateAcl: SslBumped
> request: It is an encapsulated request do not authenticate
> 2014/10/08 20:03:00.539 kid2| Acl.cc(177) matches: checked: DENY_USERS_LOCAL = 1
> 2014/10/08 20:03:00.539 kid2| Acl.cc(177) matches: checked: http_access#2 = 1
> 2014/10/08 20:03:00.540 kid2| Acl.cc(177) matches: checked: http_access = 1
> 2014/10/08 20:03:00.540 kid2| Checklist.cc(55) markFinished: 0x2905728
> answer DENIED for match
> 2014/10/08 20:03:00.540 kid2| Checklist.cc(155) checkCallback:
> ACLChecklist::checkCallback: 0x2905728 answer=DENIED
> 2014/10/08 20:03:00.540 kid2| Gadgets.cc(103) aclIsProxyAuth:
> aclIsProxyAuth: called for DENY_USERS_LOCAL
> 2014/10/08 20:03:00.540 kid2| Acl.cc(118) FindByName: ACL::FindByName
> 'DENY_USERS_LOCAL'
> 2014/10/08 20:03:00.540 kid2| Gadgets.cc(108) aclIsProxyAuth:
> aclIsProxyAuth: returning 1
> 2014/10/08 20:03:00.540 kid2| Gadgets.cc(71) aclGetDenyInfoPage: got
> called for DENY_USERS_LOCAL
>
>
> The concerning entries in squid.conf looks like this:
> acl DENY_USERS_LOCAL proxy_auth_regex -i "/etc/squid/DENY_USERS_LOCAL"
> ...
> http_access deny DENY_USERS_LOCAL
> ...
>
>
> The meaning of the entries in the file DENY_USERS_LOCAL is denying
> kerberos-authenticated AD-users. With squid 3.4.4, this worked fine.
>
> Kind regards,
> Tom
>
>
> On Wed, Oct 8, 2014 at 4:26 PM, Amos Jeffries <squid3 at treenet.co.nz> wrote:
>> -----BEGIN PGP SIGNED MESSAGE-----
>> Hash: SHA1
>>
>> On 9/10/2014 3:21 a.m., Amos Jeffries wrote:
>>> On 9/10/2014 2:09 a.m., Tom Tom wrote:
>>>> I think, this behaviour was introduced with squid 3.4.4.1
>>>> (http://www.squid-cache.org/Versions/v3/3.4/changesets/squid-3.4-13113.patch).
>>>
>>>>  I don't exactly understand this behaviour. Any hints for this?
>>>
>>> Aha. I am guessing it is a combination of: * the previous
>>> ssl-bumped traffic was brokenly finding "invalid" credentials * an
>>> "empty" regex actually contains .* (is matching anything valid).
>>>
>>> Meaning previously the "invalid" credentials would prevent the
>>> regex being even attempted. Now that the credentials validity is
>>> fixed the regex tests out and matches.
>>>
>>> Try putting a single entry of "-" in /etc/squid/DENY_USERS_LOCAL.
>>
>> Actually that would match any users with hyphen in their username.
>>
>> For production use, if the experiment above actually works, use ^root$
>> or another username shich will never be assigned with explicit start
>> and end anchors.
>>
>> Amos
>> -----BEGIN PGP SIGNATURE-----
>> Version: GnuPG v2.0.22 (MingW32)
>>
>> iQEcBAEBAgAGBQJUNUmhAAoJELJo5wb/XPRjxUwH/3Y3gDn7Cbt4ikAFyhAq+BlJ
>> tnvu2lC/WK5et8aWSsGGUtxDcOZtJoW9hYGWVIJs7wukqMlldvH7oWdGpJ/pS4tQ
>> KVpABF55n0Kt1ayRTpHzoE6eNDgVZt5lMcUk1OJnjW/wbibC5n6+BpBwyjg+Hf1X
>> StvV6y99kMvqWkHNgBYcwLXblV83GdtnX5xmCV6CnPZSry50bMc+m/4fiLSJojvG
>> unCMccmkw09697sPzJvZRe0CZbq8r3TRLfGJQEYqVem2FumpCoPQVDHIk82Q0B/y
>> nyMHOndz5PVnYr9VpuYy7pVokA74jJ5HstLVQsIW/i1TMjarUP/1dFYpG8sEDL4=
>> =/mvM
>> -----END PGP SIGNATURE-----
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users


From squid3 at treenet.co.nz  Mon Oct 13 06:16:36 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 13 Oct 2014 19:16:36 +1300
Subject: [squid-users] TCP_DENIED/403 after Upgrading from 3.4.4 to
 3.4.7 (ssl_bump enabled)
In-Reply-To: <CACLJR+MNEVmx_ZrmXdYhCKV3RpZrN+PPDAc3R3Ep9-nkc+FWqg@mail.gmail.com>
References: <CACLJR+M4J_zUyQM-i_1jQ-MknxSTz8ZsjadLAyNOpjbTdUCJbg@mail.gmail.com>
 <CACLJR+MGYogR-vJArRHVwHe=-XozFJs=4J6U5FdtaiCOUao0PQ@mail.gmail.com>
 <5435487A.5090302@treenet.co.nz> <543549A1.1070700@treenet.co.nz>
 <CACLJR+ONhco_QRz+7jk=LXUdL0DA3BpPA5gzSyq3cJ5NGJH7wg@mail.gmail.com>
 <CACLJR+MNEVmx_ZrmXdYhCKV3RpZrN+PPDAc3R3Ep9-nkc+FWqg@mail.gmail.com>
Message-ID: <543B6E44.4090801@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 13/10/2014 6:26 p.m., Tom Tom wrote:
> Hi
> 
> Does anyone have some ideas/hints concerning this problem?

I am looking into it and fairly sure its a bug in how the ACL result
is returning 1 == ALLOWED. But that was done to solve another bug in
auth ACLs re-authenticating credentials from outside the encryption,
using the encrypted channel.

Am still trying to figure out what the appropriate fix might look like.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUO25CAAoJELJo5wb/XPRjjH0IAM2OK8MGRgkaxqBpXo+wKXiQ
szuQfM3xSSUqXx6uFmD1IPssGRSy3ZxA5UBu5nVZB6X++nVGEkMwgjwo/dkymaw/
9egyKHGBBbVE1HjVi8/zktN01x1Tdrqo3fw6VpkzqQfsJAp5zt+/H4PjZvoRW11F
NrCAIFlAx5eymYPZVunVOgejBb3G0zINn76MY5SnIRFUOtJurooTKcQx8fPppo4r
yWYNLSrCxAq6ZKEqyHV0koiNp0ezjblwu53M8aZX1oXXdHjdcHwMKBBJ+x7CXhyj
/rHYScUsn1B16SsQ4azA3mnlmP7AZgxjiv0MRiGfsrB9sWLQFydzneQppPfvxVo=
=/B6U
-----END PGP SIGNATURE-----


From jborrell at central.aplitec.com  Mon Oct 13 15:58:39 2014
From: jborrell at central.aplitec.com (Josep Borrell)
Date: Mon, 13 Oct 2014 15:58:39 +0000
Subject: [squid-users] unexplained MISSes
In-Reply-To: <543811D6.7070303@treenet.co.nz>
References: <42DE25A255671C44A93A7B58470DC09C48246F63@Michelle.aplitec.local>
 <543811D6.7070303@treenet.co.nz>
Message-ID: <42DE25A255671C44A93A7B58470DC09C4825B5E3@Michelle.aplitec.local>

Hi,

I have a lot of ORIGINAL_DST in access.log, but no "host header forgery" in cache.log (with log level ALL,6)
What are another reasons for an ORIGINAL_DST ?

Thanks

Josep



-----Mensaje original-----
De: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] En nombre de Amos Jeffries
Enviado el: viernes, 10 de octubre de 2014 19:05
Para: squid-users at lists.squid-cache.org
Asunto: Re: [squid-users] unexplained MISSes

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 11/10/2014 5:00 a.m., Josep Borrell wrote:
> Hi,
> 
> I'm trying build a squid server that can cache youtube request for a 
> school. I'm using squid 3.4.7 compiled from source on Ubuntu server 
> 14.04 I have a lot of request that are cached, but not served from 
> cache and generate a TCP_MISS/200 I'm trying to figure why this 
> requests are not served from cache. Please find attached squid.conf 
> and cache.log sample with debug enabled.
> 
> I hope someone can help me.
> 
> Thanks
> 
> Josep
> 
> *************************************************** access.log
> *******************************************************************
>
>  1412953551.775    167 192.168.1.112 TCP_MISS/200 4344 GET
> http://i1.ytimg.com/vi/9_iANxI-Mrc/default.jpg -
> ORIGINAL_DST/74.125.230.3 image/jpeg
> 

I see ORIGINAL_DST, meaning you are intercepting users traffic. This interception action naturally imposes some big problems which Squid has to deal with.

IF the domain name does not specifically resolve for Squid to the same IP the user/client was contacting the object is NOT safely cacheable.
Squid will therefore not cache it, so as to prevent one smart-alec student causing http://i1.ytimg.com/vi/9_iANxI-Mrc/default.jpg to be fetched from a malware host - thus infecting anyone else loading the "image" they get back.

That required decision by Squid may be part of your problem, or not.
Check the log file for mentions of "Host header forgery" by this clients connection or the previous one(s) fetching that same URL.

NP: if there is *none* previously fetching the URL, there is your answer. For it to have become cached someone has to fetch it - the first fetch is *always* a MISS.


> ****************************** cache.log
> **********************************************************************
> ********************
>
> 
- ----------
> 2014/10/10 17:05:51.772| ctx: enter level  0:
> 'http://ytimg.com.squid.internal/vi/9_iANxI-Mrc/default.jpg' 
> 2014/10/10 17:05:51.773| http.cc(705) processReplyHeader:
> processReplyHeader: key '9F1BB8D27BED16A8B74F8995105B2941' 
> 2014/10/10 17:05:51.773| http.cc(749) processReplyHeader: HTTP Server 
> local=192.168.111.10:59210 remote=74.125.230.3:80 FD 65
> flags=1 2014/10/10 17:05:51.773| http.cc(750) processReplyHeader:
> HTTP Server REPLY: --------- HTTP/1.1 200 OK Content-Type:
> image/jpeg Last-Modified: Thu, 01 Jan 1970 00:23:21 GMT Date: Fri,
> 10 Oct 2014 10:45:51 GMT Expires: Fri, 10 Oct 2014 16:45:51 GMT
> X-Content-Type-Options: nosniff Server: sffe Content-Length: 3861
> X-XSS-Protection: 1; mode=block Age: 15619 Cache-Control: public,
> max-age=21600 Alternate-Protocol: 80:quic,p=0.01
> 
> ???????????? ---------- 2014/10/10 17:05:51.773| ctx: exit level
> 0 2014/10/10 17:05:51.773| ctx: enter level  0:
> 'http://ytimg.com.squid.internal/vi/9_iANxI-Mrc/default.jpg' 
> 2014/10/10 17:05:51.773| http.cc(919) haveParsedReplyHeaders: HTTP
> CODE: 200 2014/10/10 17:05:51.773| refresh.cc(247) refreshCheck:
> refreshCheck:
> 'http://ytimg.com.squid.internal/vi/9_iANxI-Mrc/default.jpg' 
> 2014/10/10 17:05:51.773| refresh.cc(262) refreshCheck:
> refreshCheck: Matched '^http:\/\/ytimg\.com\.squid\.internal.*
> 604800 80%% 4794000' 2014/10/10 17:05:51.773| refresh.cc(264)
> refreshCheck:  age:    15679 2014/10/10 17:05:51.773|
> refresh.cc(266) refreshCheck:  check_time:     Fri, 10 Oct 2014
> 15:06:51 GMT 2014/10/10 17:05:51.773| refresh.cc(268) refreshCheck:
> entry->timestamp:       Fri, 10 Oct 2014 10:45:32 GMT 2014/10/10
> 17:05:51.773| refresh.cc(171) refreshStaleness: FRESH: expires
> 1412959532 >= check_time 1412953611 2014/10/10 17:05:51.773|
> refresh.cc(288) refreshCheck: Staleness = -1 2014/10/10 17:05:51.773| 
> refresh.cc(373) refreshCheck: refreshCheck: object isn't stale.. 
> 2014/10/10 17:05:51.773| refresh.cc(375)
> refreshCheck: refreshCheck: returning FRESH_EXPIRES 2014/10/10 
> 17:05:51.773| http.cc(482) cacheableReply: YES because HTTP status
> 200


That image is cacheable according to its headers. Provided the next client fetches it again within the next 99mins, and the interception limits do not prevent storage.

Check for mentions of "Host header forgery" by this same user/client or the previous one fetching this URL.


> 
> **********************************************************************
> squid.conf *******************************************************
> 
> # debug helper #debug_options 84,3 #debug Refresh Calculation 
> #debug_options 22,3 # HTTP #debug_options 11,3
> 
> debug_options 11,3 22,3 84,3
> 
> 
> acl customernet src 172.16.212.154/32 acl customernet src
> 192.168.1.0/24
> 
> 
> acl SSL_ports port 443 acl SSL_ports port 873  # rsync
> 
> acl Safe_ports port 80         # http acl Safe_ports port 21
> # ftp acl Safe_ports port 443        # https acl Safe_ports port 70
> # gopher acl Safe_ports port 210        # wais acl Safe_ports port
> 1025-65535 # unregistered ports acl Safe_ports port 280        #
> http-mgmt acl Safe_ports port 488        # gss-http acl Safe_ports
> port 591        # filemaker acl Safe_ports port 777        #
> multiling http acl CONNECT method CONNECT
> 
> http_access deny !Safe_ports http_access deny CONNECT !SSL_ports 
> http_access allow localhost manager http_access deny manager 
> http_access allow localhost http_access allow customernet http_access 
> deny all # http_access allow all
> 
> #HTTPS (SSL) trafic interception options always_direct allow SSL_ports 
> ssl_bump server-first SSL_ports #sslproxy_cert_error deny all 
> #sslproxy_flags DONT_VERIFY_PEER sslcrtd_program 
> /usr/lib/squid3/ssl_crtd -s /var/spool/squid3_ssldb -M 4MB 
> sslcrtd_children 8 startup=1 idle=1
> 
> acl rewritedoms dstdomain .c.youtube.com .googlevideo.com .ytimg.com 
> store_id_program /usr/lib/squid3/storeid_file_rewrite
> /etc/squid3/storeid_rewrite store_id_children 40 startup=10 idle=5
> concurrency=0 store_id_access allow rewritedoms store_id_access deny 
> all
> 
> 
> http_port 3128 http_port 8080 intercept https_port 8081 intercept 
> ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB 
> cert=/etc/squid3/ssl_cert/squidcert.pem
> 
> 
> forward_max_tries 25 cache_mem 2 GB maximum_object_size_in_memory
> 25 MB maximum_object_size 1 GB
> 
> visible_hostname squid-v2 dns_v4_first on
> 
> 
> coredump_dir /var/spool/squid3 cache_replacement_policy heap LFUDA 
> cache_dir aufs /var/spool/squid3 14000 16 256

14GB of disk trying to cache YT videos may not be enough space.

If the objects being fetched above were legitimately discarded to make room for newer content then MISS is entirely to be expected.

> 
> refresh_pattern
> ^http:\/\/video-srv\.(googlevideo|youtube)\.com\.squid\.internal.*
> 10080 80%  79900 override-lastmod override-expire ignore-reload 
> ignore-must-revalidate ignore-private refresh_pattern
> ^http:\/\/ytimg\.com\.squid\.internal.*  10080 80%  79900 
> override-lastmod override-expire ignore-reload ignore-must-revalidate 
> ignore-private


If you look at those server reply headers you can see the Cache-Control explicitly says the reply is "public". This means that the "ignore-private" setting is useless on these images.
 * ignoring privacy controls is a highly nasty thing to do to start with. I suggest strongly that you remove it from the ytimg pattern options as unnecessary.

Also, here is an artifact of the override options which you may not be
aware:

 The Expires header coming from YT indicates that the reply is cacheable for 6hrs from the time it was generated. That is 21600 seconds, no less.
 Your override-expires is actively *reducing* the storage time to
10800 seconds (the 'min' field of the pattern options).

 Therefore to maximise caching you should *drop* the override-expires option on the ytimg pattern.


NP: override-lastmod is usually also a bad thing to do, but I see you are actually hitting THE use-case for which it legitimately exist...
server emitting incorrect Last-Modified value (1970? sure).



Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUOBHWAAoJELJo5wb/XPRjGv4H/iKpL4UUBOXVsy7BixBeM5xp
JoyRtwRcfH8ksI/G622KANQ2XzOMLyYr9BX5X8ofBGjT8WRRxEbQDzp/EVADB7+6
xO/OwW2413YiYSmgszOTx0joAdUFB4R4ShnCEjDHQ6RJFKIquQql58hDN+6eGHFZ
AkzrlL+V+CzkpOGWmu51kBLlaSMQJ2SaWOJMw0ykn4giuL87XYeRyQ9seFR9Q5Ll
7cKi0QZflcCvDnwa87vPfnvsQfBF/cFjuv7/NigGsO8IklgQ/T3xPf+A6WVXmURj
USLjOmFFsA6xaLZMBeUnmWo4kjX5iYXT1S14yQokpf+DUPfaM0+bt/hUFNLnkuk=
=1TqK
-----END PGP SIGNATURE-----
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

From robert at gillecaluim.com  Mon Oct 13 16:23:44 2014
From: robert at gillecaluim.com (Robert Watson)
Date: Mon, 13 Oct 2014 09:23:44 -0700
Subject: [squid-users] transparent proxy https and self signed
	certificate error
In-Reply-To: <CADoG9x=YTgA4k1Hy8fNvqnp=SgZE8mT8zZozpw29r1gL8Ld1DA@mail.gmail.com>
References: <CADoG9xk43M6+ROrbhA6kL2TrC9_zrcOjUznz+zhLS7xphrZC_Q@mail.gmail.com>
 <5430DAC5.8030802@treenet.co.nz> <5430E57C.4030709@trimble.com>
 <54311BD7.2030605@treenet.co.nz> <54316938.4050606@ngtech.co.il>
 <CADoG9xngTuun9wZj2DuuVvVC_kwW=-FWHj2EZat3G497JLeFWA@mail.gmail.com>
 <54324746.50306@treenet.co.nz>
 <CADoG9x=YTgA4k1Hy8fNvqnp=SgZE8mT8zZozpw29r1gL8Ld1DA@mail.gmail.com>
Message-ID: <CADoG9xnzBPof146nG-zexkziMRx+2CLQSw+vbf8v==si_1EH1g@mail.gmail.com>

Ok, finally got the certificate installed properly and can proxy some https
sites (gmail, google) but I get an error when going to a bank website.....
NET::ERR_CERT_COMMON_NAME_INVALID
when I created the certificate, I purposefully left the common name blank
as per several articles on ssl_bump.  So I'm assuming it's complaining
about the CN generated by squid/ssl_bump?

On Mon, Oct 13, 2014 at 9:22 AM, Robert Watson <robert at gillecaluim.com>
wrote:

> Ok, finally got the certificate installed properly and can proxy some
> https sites (gmail, google) but I get an error when going to a bank
> website.....
> NET::ERR_CERT_COMMON_NAME_INVALID
> when I created the certificate, I purposefully left the common name blank
> as per several articles on ssl_bump.  So I'm assuming it's complaining
> about the CN generated by squid/ssl_bump?
>
>
>
> On Mon, Oct 6, 2014 at 12:39 AM, Amos Jeffries <squid3 at treenet.co.nz>
> wrote:
>
>> -----BEGIN PGP SIGNED MESSAGE-----
>> Hash: SHA1
>>
>> On 6/10/2014 4:24 p.m., Robert Watson wrote:
>> > still trying to get this working.  To eliminate the self signed
>> > certificate issue, I got a official signed certificate from
>> > Starfield Tech. LLC. They've sent two certifcates but I'm unsure
>> > how to use these certificates since the ssl_bump parameters only
>> > have one certificate as a parameter
>>
>> The CA is very unlikely to be issuing you certificates capable of use
>> in Squid in the way intended. It is illegal for a trusted root CA to
>> do so in the country they are registered. Besides that it is downright
>> foolish for them to give up their trust reputation. Look at what
>> happened to DigiNotar.
>>
>> The point of self-signed is that _your Squid_ is the root CA signer.
>>
>> The ssl-bump feature in current Squid makes parameter cert= take the
>> self-signed CA certificate in PEM format. Squid generates the rest of
>> the certificte chain as necessary.
>>
>> >
>> > On Sun, Oct 5, 2014 at 8:52 AM, Eliezer Croitoru wrote:
>> >
>> > On 10/05/2014 01:22 PM, Amos Jeffries wrote:
>> >>>> MSIE 11 seems to be growing in popularity for some reason
>> >>>> ;-)
>> >>>>
>> >>>> Amos
>> >
>> > And Still there is:
>> > http://bugs.squid-cache.org/show_bug.cgi?id=4115
>> >
>> > For now I am using ssl_crtd of 3.4.5 for google ssl bump to work.
>> >
>> > Eliezer
>>
>> Amos
>> -----BEGIN PGP SIGNATURE-----
>> Version: GnuPG v2.0.22 (MingW32)
>>
>> iQEcBAEBAgAGBQJUMkdGAAoJELJo5wb/XPRjygMH/Rk0EYwCgluL1YCWNa8cTZHN
>> RkPNY1fTbe7U0ioB7J69KTJ07XH8sy0w9bChB5s/siodi3WD8ogZ3VdtEYxcqjf1
>> 9yhb771Il3IiVaAiuF62FHWTEHjwHwTcBVR7/cDxigPW2VuSyyhZsdA8ayl1ZUXO
>> jW44IH5g0Sja7KVJAfS67AANG4Sp4vMh1rGdXpbP8Bq8QGposL3viGh51z3k6/OP
>> Dok8oVIsIluICLc8sLAKJbJwaBYSh0SLBrnNUv0Yl6+MtAFNfViXJGa3OfRG5ucQ
>> aTS9Be4vzJthVdV1+tTtqubCvjrYB7PqQcfL9VzA4UlvQovgPDAnVMO074Kyjug=
>> =k3K8
>> -----END PGP SIGNATURE-----
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141013/7da49094/attachment.htm>

From geekguy at geek-guy.com  Wed Oct  8 14:23:22 2014
From: geekguy at geek-guy.com (Lawrence Pingree)
Date: Wed, 8 Oct 2014 07:23:22 -0700
Subject: [squid-users] Squid website malware?
Message-ID: <03d701cfe303$6bda9d50$438fd7f0$@geek-guy.com>



 

 

 

"Convert your dreams to achievable and realistic goals, this way the journey
is satisfying and progressive." - LP

 

Best regards,

The Geek Guy



Lawrence Pingree

 <http://www.lawrencepingree.com/resume/>
http://www.lawrencepingree.com/resume/

 

Author of "The Manager's Guide to Becoming Great"

 <http://www.management-book.com/> http://www.Management-Book.com

 

 
<https://webportal.isc2.org/custom/CertificationVerificationResults.aspx?FN=
Lawrence&LN=Pingree&CN=76042> 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141008/825fa890/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 139232 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141008/825fa890/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.gif
Type: image/gif
Size: 2852 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141008/825fa890/attachment.gif>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 3024 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141008/825fa890/attachment-0001.png>

From sudakov at sibptus.tomsk.ru  Thu Oct  9 02:18:21 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Thu, 9 Oct 2014 09:18:21 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <m14if3$1ul$2@ger.gmane.org>
References: <20141006040725.GA31642@admin.sibptus.tomsk.ru>
 <20141006052346.GA32369@admin.sibptus.tomsk.ru>
 <20141007070403.GA57384@admin.sibptus.tomsk.ru>
 <20141007083542.GA60425@admin.sibptus.tomsk.ru>
 <m11nv3$nk8$1@ger.gmane.org>
 <20141008032925.GA77544@admin.sibptus.tomsk.ru>
 <m14if3$1ul$2@ger.gmane.org>
Message-ID: <20141009021821.GA3372@admin.sibptus.tomsk.ru>

Markus Moeller wrote:
> 
>    I only found the following explanation:
> 
> This error will happen if you didn't write the key into the keytab file, or
> the permission setting of keytab file reject the read access, or the key
> file is not the one you should access (for example, you want
> /opt/somedir/conf/krb5.conf, but actually read /etc/krb5.conf, which has no
> that key).

I thought about this. I have checked the paths and permissions several
times and found no faults. Maybe you could look at my ktrace output
and notice something therein which I don't notice.

> 
>   Is there something like strace/truss on freebsd to see which files are
> opened (with and without error) during running negotiate_kerberos_auth ? On
> Linux I would run:

Sure, I usually use ktrace. I am attaching ktrace output to the message.

There are also truss and dtrace but I have never used them. If you
give me the exact command line, I can run them on
negotiate_kerberos_auth and publish the result.

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ktrace.zip
Type: application/zip
Size: 156197 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141009/fec180c3/attachment.zip>

From robert at gillecaluim.com  Mon Oct 13 16:33:00 2014
From: robert at gillecaluim.com (Robert Watson)
Date: Mon, 13 Oct 2014 09:33:00 -0700
Subject: [squid-users] NET::ERR_CERT_COMMON_NAME_INVALID
Message-ID: <CADoG9xnxpR4BzXVpF6osag-cmRznd3GZYLiuyM0Q8NauE0gUuQ@mail.gmail.com>

an addendum to my previous post.
I get NET::ERR_CERT_COMMON_NAME_INVALID when using chrome
I get a squid error page when using IE

The following error was encountered while trying to retrieve the URL:
://204.44.2.199:443 <https://www.bankofthewest.com/://204.44.2.199:443>

*Failed to establish a secure connection to 204.44.2.199*

The system returned:

(71) Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)

Handshake with SSL server failed: [No Error]

This proxy and the remote host failed to negotiate a mutually acceptable
security settings for handling your request. It is possible that the remote
host does not support secure connections, or the proxy is not satisfied
with the host security credentials.

Not sure if this helps, but I could sure use some help.  Thanks,

Robert
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141013/731a406f/attachment.htm>

From lord.tek at gmail.com  Mon Oct 13 17:50:35 2014
From: lord.tek at gmail.com (Marcel)
Date: Mon, 13 Oct 2014 19:50:35 +0200
Subject: [squid-users] Fwd: Problems with NTLM authentication
In-Reply-To: <CABE8HSjtE-JB08EFPta-jKGA-SFhr-d5tqiOWTZnqDX2tv2+bw@mail.gmail.com>
References: <1412698207586-4667742.post@n4.nabble.com>
 <CABE8HShZ6JuocAOnNo++ijE+A=NqxqPdXj0vZOUyTTRkfG0YGQ@mail.gmail.com>
 <1412709594.3894.3.camel@desktop.bpk2.com>
 <CABE8HSjtE-JB08EFPta-jKGA-SFhr-d5tqiOWTZnqDX2tv2+bw@mail.gmail.com>
Message-ID: <CABE8HSg+pK-wbkUCsObPKU9XUoKbsbAouk=8ct8_ZDRcfwRYnw@mail.gmail.com>

Hello,

I unfortunately got no further response. Through experimentation I
discovered that this issue is magically gone in the more current versions
of Squid, for example in 3.4.8.

So far, so good. Now I have discovered that CPU usage (when using
ntlm_auth) is pegged at 100%, rendering the server useless.

Rock : hard place.

On 7 October 2014 21:25, Marcel <lord.tek at gmail.com> wrote:

> Hello,
>
> thank you for your input. Unfortunately I have to disagree with you
> because of two reasons:
>
> 1. That option is already enabled
> 2. The NTLM authentication works fine in Internet Explorer without Squid.
> It only breaks when going through Squid.
>
> I'd be very happy for further suggestions.
>
>
>
> On 7 October 2014 21:19, Brendan Kearney <bpk678 at gmail.com> wrote:
>
>> On Tue, 2014-10-07 at 20:50 +0200, Marcel wrote:
>> > Hello,
>> >
>> > I have some more information.
>> >
>> > The problem seems to have nothing to do with samba, krb5 or anything
>> > else. I set up a new squid that isn't in the AD and doesn't use any
>> > kind of authentication at all.
>> >
>> >
>> > I have the exact same problem. Here is my POC squid.conf:
>> >
>> > acl localnet src all
>> > http_access allow all
>> > http_port 3128
>> >
>> >
>> >
>> > That is the entire configuration in my tests. As you can see, it is
>> > absolutely impossible for it to be a configuration issue.
>> >
>> > Why can't I log on to a NTLM protected website with Internet Explorer
>> > when going over a squid proxy?
>> >
>> >
>> > It works fine in Firefox.
>> >
>> >
>> >
>> > ---------- Forwarded message ----------
>> > From: foggle <lord.tek at gmail.com>
>> > Date: 7 October 2014 18:10
>> > Subject: [squid-users] Problems with NTLM authentication
>> > To: squid-users at lists.squid-cache.org
>> >
>> >
>> > Hello,
>> >
>> > I have set up a squid Proxy that uses samba/ntlm/krb5 to do SSO AD
>> > authentication in the Company.
>> >
>> >
>> > This works fine.
>> >
>> > My problem is that external Websites on the Internet that use NTLM
>> > authentication of their own do not work. My users enter their Details
>> > (DOMAIN\user and Password) and receive authentication failures
>> > Messages.
>> >
>> > Interestingly enough, this (almost) only occurs in Internet Explorer.
>> > The
>> > same sites work fine with Firefox.
>> >
>> > Thank you in advance for your much needed help.
>> >
>> >
>> >
>> > --
>> > View this message in context:
>> >
>> http://squid-web-proxy-cache.1019090.n4.nabble.com/Problems-with-NTLM-authentication-tp4667742.html
>> > Sent from the Squid - Users mailing list archive at Nabble.com.
>> > _______________________________________________
>> > squid-users mailing list
>> > squid-users at lists.squid-cache.org
>> > http://lists.squid-cache.org/listinfo/squid-users
>> >
>> >
>> >
>> > _______________________________________________
>> > squid-users mailing list
>> > squid-users at lists.squid-cache.org
>> > http://lists.squid-cache.org/listinfo/squid-users
>>
>> not something that squid would be affecting, as squid has nothing to do
>> with the auth to the website.
>>
>> Tools -> Internet Options -> Advanced tab: scroll down until you
>> Security.  Under Security, check the "Enable Integrated Windows
>> Authentication*" check box, and restart your browser.
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141013/49b45be3/attachment.htm>

From eliezer at ngtech.co.il  Mon Oct 13 20:46:14 2014
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Mon, 13 Oct 2014 23:46:14 +0300
Subject: [squid-users] Fwd:  Problems with NTLM authentication
In-Reply-To: <CABE8HShZ6JuocAOnNo++ijE+A=NqxqPdXj0vZOUyTTRkfG0YGQ@mail.gmail.com>
References: <1412698207586-4667742.post@n4.nabble.com>
 <CABE8HShZ6JuocAOnNo++ijE+A=NqxqPdXj0vZOUyTTRkfG0YGQ@mail.gmail.com>
Message-ID: <543C3A16.7030209@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 10/07/2014 09:50 PM, Marcel wrote:
> Hello,
> 
> I have some more information. The problem seems to have nothing to
> do with samba, krb5 or anything else. I set up a new squid that
> isn't in the AD and doesn't use any kind of authentication at all.
> 
> I have the exact same problem. Here is my POC squid.conf:
> 
> acl localnet src all http_access allow all http_port 3128
> 
> 
> That is the entire configuration in my tests. As you can see, it
> is absolutely impossible for it to be a configuration issue.
> 
> Why can't I log on to a NTLM protected website with Internet
> Explorer when going over a squid proxy?
> 
> It works fine in Firefox.

Hey Marcel,

Since it works on 3.4.8 and it doesn't work on 3.3 or 3.2 the basic
step would be to take a look at the packets\sessions to see what is
different between firefox and ie while only then compare newer
versions of squid to older.

NTLM should work in a the basic path:
1 - request
2 - 407 response
3 - negotiation
4 - new request with auth details

What have verified until now in the session\packets level?

Eliezer
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUPDoWAAoJENxnfXtQ8ZQU/BYH/0iEE/+lDd+SiubNNcavmvXz
bPRAMtXSK64OehMYZwH1mnCIvUylPW3Vjv3cMjrh4uJIPIn7/WdwudniuNoxzSk7
PZEtkZYD9ZL68ns55yU7mDdDoudzRkkveplNvvmhB42Pq1OX9Nq1trPJUnfhvGJZ
iuVvE25ZIKqVNMJN+Dp9e0M6FZZ85ZVwyz2AlGI4GAnD/sIqJOKLSp/aQYgyGvYt
rE+cNQb0nypyMjc1c5uoDVB2AFh3nN5H9HMiG+S6vRdRxXMEm6d0hO6x54ZzvEYy
WBpU+CDMjcA/6aCUwx4irFEuFBKpy9ni7a01es3B1Tn5NoDyJW8bJz2F5WGbhVw=
=nyav
-----END PGP SIGNATURE-----


From gkinkie at gmail.com  Mon Oct 13 21:04:18 2014
From: gkinkie at gmail.com (Kinkie)
Date: Mon, 13 Oct 2014 23:04:18 +0200
Subject: [squid-users] Squid website malware?
In-Reply-To: <03d701cfe303$6bda9d50$438fd7f0$@geek-guy.com>
References: <03d701cfe303$6bda9d50$438fd7f0$@geek-guy.com>
Message-ID: <CA+Y8hcM_ekLR9LZB7rK9Kzkr7r2NiZF9qJQKpY-u14Fbsh31Ag@mail.gmail.com>

Hi,
  could you please check again?
The sysadmins have verified, and they can't confirm what you reported.

Thanks,
  Francesco

On Wed, Oct 8, 2014 at 4:23 PM, Lawrence Pingree <geekguy at geek-guy.com>
wrote:

>
>
>
>
>
>
>
> "Convert your dreams to achievable and realistic goals, this way the
> journey is satisfying and progressive." - LP
>
>
>
> Best regards,
>
> The Geek Guy
>
> [image: geek-logo-small-crop2]
>
> Lawrence Pingree
>
> http://www.lawrencepingree.com/resume/
>
>
>
> Author of "The Manager's Guide to Becoming Great"
>
> http://www.Management-Book.com <http://www.management-book.com/>
>
>
>
> [image: cissp]
> <https://webportal.isc2.org/custom/CertificationVerificationResults.aspx?FN=Lawrence&LN=Pingree&CN=76042>
>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>


-- 
    Francesco
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141013/97938f48/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 3024 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141013/97938f48/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.gif
Type: image/gif
Size: 2852 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141013/97938f48/attachment.gif>

From ambrose.li at gmail.com  Mon Oct 13 21:11:46 2014
From: ambrose.li at gmail.com (Ambrose LI)
Date: Mon, 13 Oct 2014 17:11:46 -0400
Subject: [squid-users] Squid website malware?
In-Reply-To: <03d701cfe303$6bda9d50$438fd7f0$@geek-guy.com>
References: <03d701cfe303$6bda9d50$438fd7f0$@geek-guy.com>
Message-ID: <CADJvFOUtLZgbYzFa9KdLTHYSQA=JL+oRTv4sFkZfrxBTy-ikgA@mail.gmail.com>

What does the "detailed report" actually say?

Virus scanners (if I remember correctly it was actually Norton) have been
known to lack a basic understanding about the Internet, such as what
certain well-known domains even mean. I wouldn't trust this until I see the
"detailed report".


-- 
cheers,
-ambrose <http://gniw.ca>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141013/a6bd8b36/attachment.htm>

From crazyworld at outlook.com  Tue Oct 14 01:42:51 2014
From: crazyworld at outlook.com (B)
Date: Tue, 14 Oct 2014 09:42:51 +0800
Subject: [squid-users] Squid website malware?
In-Reply-To: <CADJvFOUtLZgbYzFa9KdLTHYSQA=JL+oRTv4sFkZfrxBTy-ikgA@mail.gmail.com>
References: <03d701cfe303$6bda9d50$438fd7f0$@geek-guy.com>
 <CADJvFOUtLZgbYzFa9KdLTHYSQA=JL+oRTv4sFkZfrxBTy-ikgA@mail.gmail.com>
Message-ID: <BLU436-SMTP205F5328671B195D49C6C96CDAD0@phx.gbl>

Can't reproduce it. They should direct you to ask page and flag it with 
a norton logo.

-B
On 10/14/2014 5:11 AM, Ambrose LI wrote:
> What does the "detailed report" actually say?
>
> Virus scanners (if I remember correctly it was actually Norton) have 
> been known to lack a basic understanding about the Internet, such as 
> what certain well-known domains even mean. I wouldn't trust this until 
> I see the "detailed report".
>
>
> -- 
> cheers,
> -ambrose <http://gniw.ca>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141014/1a7374db/attachment.htm>

From glenn.groves at bradnams.com.au  Tue Oct 14 03:03:54 2014
From: glenn.groves at bradnams.com.au (glenn.groves at bradnams.com.au)
Date: Tue, 14 Oct 2014 13:03:54 +1000
Subject: [squid-users] https issues for google
In-Reply-To: <54376B82.3050005@treenet.co.nz>
References: <2329B68B3D676246BA0D1149E22F509F01A02886@bneseqs20.bradnams.com.au>
 <54345D6E.3090403@ngtech.co.il>
 <2329B68B3D676246BA0D1149E22F509F01A028F4@bneseqs20.bradnams.com.au>
 <2329B68B3D676246BA0D1149E22F509F01A0293D@bneseqs20.bradnams.com.au>
 <54376B82.3050005@treenet.co.nz>
Message-ID: <2329B68B3D676246BA0D1149E22F509F01A02A2C@bneseqs20.bradnams.com.au>

Thanks Amos, does seem like a bug of some sort, just had another site start to do this too (a SSL certificate authority of all places).

I will have to see about upgrading - concerned about breaking the system though - whole company depends on this server.

-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Amos Jeffries
Sent: Friday, 10 October 2014 3:16 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] https issues for google

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Glenn, I just had a brainstorm.

Your version is 3.1 so you are probably suffering from
http://bugs.squid-cache.org/show_bug.cgi?id=3371

This bug shows up particularly badly when SPDY, WebSockets or HTTP/2 is being attempted by the browser.

If so you can resolve it by upgrading to the current stable squid-3.4.8.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUN2uCAAoJELJo5wb/XPRjh6oH/iSWtqy5WJ9k2Qsex2eTic4R
9S9YyaLmoZSw1gLucn8nj7ZBpYEQCUxzYJfkm43AXYSVmUlUes1deAZrbkn3Bukn
oLmWkGBc92TlwtSuzmvByge6G/C6Elbe9UkXNDsH7+4039zVGZou53hfJlmZOyaf
xRMVw//shhDSDt2Ie+gZC/lChrhFNgGPGX7EP7lJGg4hm9q/ykkobom4K7ZuqieK
UG5jUpQR/l6cbjHjNko0C19GYc5R+5CH2X82orc9DxVQX4nJr3FrbTVwv4SmGDIa
ICMormLQy0QhQLJ0ninqyG17dJh9cPKmBHDX3kzZYbyA6CTCVtXSW/5P240ZRD0=
=Pgg4
-----END PGP SIGNATURE-----
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
 
This message (including any attachments) is confidential and may be legally privileged. If you are not the intended recipient, you should not disclose, copy or use any part of it - please delete all copies immediately and notify the Bradnam Group Helpdesk at helpdesk at bradnams.com.au 

Any information, statements or opinions contained in this message (including any attachments) are given by the author. They are not given on behalf of the Bradnam Group unless subsequently confirmed by an individual other than the author who is duly authorised to represent the Bradnam Group (or any of its subsidiary and associate companies).

All sent and received email from/to the Bradnam Group (or any of its subsidiary and associate companies) is automatically scanned for the presence of computer viruses, security issues and inappropriate content.

For further information on the services which the Bradnam Group provides visit our web 
site(s) at www.bradnams.com.au or www.nationalglass.com.au


From nam.nh at nd24.net  Tue Oct 14 03:14:21 2014
From: nam.nh at nd24.net (Neddy, NH. Nam)
Date: Tue, 14 Oct 2014 10:14:21 +0700
Subject: [squid-users] Squid website malware?
In-Reply-To: <BLU436-SMTP205F5328671B195D49C6C96CDAD0@phx.gbl>
References: <03d701cfe303$6bda9d50$438fd7f0$@geek-guy.com>
 <CADJvFOUtLZgbYzFa9KdLTHYSQA=JL+oRTv4sFkZfrxBTy-ikgA@mail.gmail.com>
 <BLU436-SMTP205F5328671B195D49C6C96CDAD0@phx.gbl>
Message-ID: <CAA44a75uFxPc7-+n_1=gmee1PAb-PYq93jaoD3-M8vfcw-NDNw@mail.gmail.com>

I don't see any problem with Google or Bing.
Assumed Norton is the root problem.

On Tue, Oct 14, 2014 at 8:42 AM, B <crazyworld at outlook.com> wrote:
> Can't reproduce it. They should direct you to ask page and flag it with a
> norton logo.
>
> -B
> On 10/14/2014 5:11 AM, Ambrose LI wrote:
>
> What does the "detailed report" actually say?
>
> Virus scanners (if I remember correctly it was actually Norton) have been
> known to lack a basic understanding about the Internet, such as what certain
> well-known domains even mean. I wouldn't trust this until I see the
> "detailed report".
>
>
> --
> cheers,
> -ambrose <http://gniw.ca>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


From squid3 at treenet.co.nz  Tue Oct 14 04:07:23 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 14 Oct 2014 17:07:23 +1300
Subject: [squid-users] Squid website malware?
In-Reply-To: <03d701cfe303$6bda9d50$438fd7f0$@geek-guy.com>
References: <03d701cfe303$6bda9d50$438fd7f0$@geek-guy.com>
Message-ID: <543CA17B.2010205@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

May be related to a similar listing we got in their SafeWeb product
about a month ago.

That was due to one of the developer pages on the site being used to
host downloadable Squid management scripts. For some unknown reason
Norton flagged them as malware for a few days.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUPKF6AAoJELJo5wb/XPRjfkcH/2XQ6n/VY1rmOUm/fDm663c9
TMOnoJxP7fhOBL4V3ONdT1P7R/dH7Yuakmws2EzvfgTBEOfabOs9Z31YZjRIBFH4
K1mGtTmCyLHN71CYVORdYCRYeGltksH6vxKGr8A6NS33hlKWhiNlOFEKYFSNHmJi
vSAzKK/dzV4bUmuj2o/qIb2v2P8bNcmMWy8PnAIcg+sA+JweLiDoAhYgCSmtLAKg
8H08AWWoCD9pe9268h89YUgRGkLGeNdVlH42nCq53eYOPwrVoPElQj6PZEooUhLL
NwIoBIqUikO3739mTTYqc/N9yBoQuNnHQBsiE/EVoajd3YefPc60q9bmSxeNvW8=
=67XM
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Tue Oct 14 04:13:05 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 14 Oct 2014 17:13:05 +1300
Subject: [squid-users] unexplained MISSes
In-Reply-To: <42DE25A255671C44A93A7B58470DC09C482473A6@Michelle.aplitec.local>
References: <42DE25A255671C44A93A7B58470DC09C48246F63@Michelle.aplitec.local>
 <543811D6.7070303@treenet.co.nz>
 <42DE25A255671C44A93A7B58470DC09C482473A6@Michelle.aplitec.local>
Message-ID: <543CA2D1.3070506@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 12/10/2014 3:36 a.m., Josep Borrell wrote:
> Hi Amos,
> 
> I know that the first request is always a miss. I'm reproducing the
> same v?deo from the same PC, and same browser erasing the cache
> between tests.
> 
> Are there any doc that explain the meaning of all responses like
> ORIGINAL_DST ?

http://wiki.squid-cache.org/SquidFaq/SquidLogs#Hierarchy_Codes

ORIGINAL_DST is when interception is used. It is like DIRECT, but with
transparency in regards to server IP the client is contacting.

Since so many people have confused "interception proxy" with
"transparent proxy" we have enabled transparent request handling by
default whenever interception is performed. You can use the
client_dst_passthru option to turn off server-IP transparency.


> And are there any way to know the reason of a MISS or a HIT ? I
> tried with the debug options, but the reason of a MISS isn't
> there.

The reasons for HIT/MISS are simple; a HIT can only happen if there is
a matching object in cache, REFRESH if there is a stale object in
cache, and MISS if there is no object in cache.

The reasons why (or not) an object is available gets more complicated
and occurs on the *previous* transaction for the same URL. That gets
logic in many different areas having a veto on caching. The main areas
are the store logic and refresh logics. But in particular with
interception the Host security checks also have a large say.

With both interception and store-id acting on the transaction the
story gets even more complicated.
 - you found no mention of forgery detection in your log, so we can
ignore that bit of potential complication.
 - store-id means that not just any previous transaction, but also any
previous transaction(s) sharing the same store-ID will affect the
cache state for this URL.

Amos


> 
> Thanks
> 
> Josep
> 
> 
> -----Mensaje original----- De: squid-users En nombre de Amos
> Jeffries
> 
> On 11/10/2014 5:00 a.m., Josep Borrell wrote:
>> Hi,
> 
>> I'm trying build a squid server that can cache youtube request
>> for a school. I'm using squid 3.4.7 compiled from source on
>> Ubuntu server 14.04 I have a lot of request that are cached, but
>> not served from cache and generate a TCP_MISS/200 I'm trying to
>> figure why this requests are not served from cache. Please find
>> attached squid.conf and cache.log sample with debug enabled.
> 
>> I hope someone can help me.
> 
>> Thanks
> 
>> Josep
> 
>> *************************************************** access.log 
>> *******************************************************************
>
>>  1412953551.775    167 192.168.1.112 TCP_MISS/200 4344 GET 
>> http://i1.ytimg.com/vi/9_iANxI-Mrc/default.jpg - 
>> ORIGINAL_DST/74.125.230.3 image/jpeg
> 
> 
> I see ORIGINAL_DST, meaning you are intercepting users traffic.
> This interception action naturally imposes some big problems which
> Squid has to deal with.
> 
> IF the domain name does not specifically resolve for Squid to the
> same IP the user/client was contacting the object is NOT safely
> cacheable. Squid will therefore not cache it, so as to prevent one
> smart-alec student causing
> http://i1.ytimg.com/vi/9_iANxI-Mrc/default.jpg to be fetched from a
> malware host - thus infecting anyone else loading the "image" they
> get back.
> 
> That required decision by Squid may be part of your problem, or
> not. Check the log file for mentions of "Host header forgery" by
> this clients connection or the previous one(s) fetching that same
> URL.
> 
> NP: if there is *none* previously fetching the URL, there is your
> answer. For it to have become cached someone has to fetch it - the
> first fetch is *always* a MISS.
> 
> 
>> ****************************** cache.log 
>> **********************************************************************
>>
>> 
********************
> 
> 
> ----------
>> 2014/10/10 17:05:51.772| ctx: enter level  0: 
>> 'http://ytimg.com.squid.internal/vi/9_iANxI-Mrc/default.jpg' 
>> 2014/10/10 17:05:51.773| http.cc(705) processReplyHeader: 
>> processReplyHeader: key '9F1BB8D27BED16A8B74F8995105B2941' 
>> 2014/10/10 17:05:51.773| http.cc(749) processReplyHeader: HTTP
>> Server local=192.168.111.10:59210 remote=74.125.230.3:80 FD 65 
>> flags=1 2014/10/10 17:05:51.773| http.cc(750)
>> processReplyHeader: HTTP Server REPLY: --------- HTTP/1.1 200 OK
>> Content-Type: image/jpeg Last-Modified: Thu, 01 Jan 1970 00:23:21
>> GMT Date: Fri, 10 Oct 2014 10:45:51 GMT Expires: Fri, 10 Oct 2014
>> 16:45:51 GMT X-Content-Type-Options: nosniff Server: sffe
>> Content-Length: 3861 X-XSS-Protection: 1; mode=block Age: 15619
>> Cache-Control: public, max-age=21600 Alternate-Protocol:
>> 80:quic,p=0.01
> 
>> ???????????? ---------- 2014/10/10 17:05:51.773| ctx: exit level 
>> 0 2014/10/10 17:05:51.773| ctx: enter level  0: 
>> 'http://ytimg.com.squid.internal/vi/9_iANxI-Mrc/default.jpg' 
>> 2014/10/10 17:05:51.773| http.cc(919) haveParsedReplyHeaders:
>> HTTP CODE: 200 2014/10/10 17:05:51.773| refresh.cc(247)
>> refreshCheck: refreshCheck: 
>> 'http://ytimg.com.squid.internal/vi/9_iANxI-Mrc/default.jpg' 
>> 2014/10/10 17:05:51.773| refresh.cc(262) refreshCheck: 
>> refreshCheck: Matched '^http:\/\/ytimg\.com\.squid\.internal.* 
>> 604800 80%% 4794000' 2014/10/10 17:05:51.773| refresh.cc(264) 
>> refreshCheck:  age:    15679 2014/10/10 17:05:51.773| 
>> refresh.cc(266) refreshCheck:  check_time:     Fri, 10 Oct 2014 
>> 15:06:51 GMT 2014/10/10 17:05:51.773| refresh.cc(268)
>> refreshCheck: entry->timestamp:       Fri, 10 Oct 2014 10:45:32
>> GMT 2014/10/10 17:05:51.773| refresh.cc(171) refreshStaleness:
>> FRESH: expires 1412959532 >= check_time 1412953611 2014/10/10
>> 17:05:51.773| refresh.cc(288) refreshCheck: Staleness = -1
>> 2014/10/10 17:05:51.773| refresh.cc(373) refreshCheck:
>> refreshCheck: object isn't stale.. 2014/10/10 17:05:51.773|
>> refresh.cc(375) refreshCheck: refreshCheck: returning
>> FRESH_EXPIRES 2014/10/10 17:05:51.773| http.cc(482)
>> cacheableReply: YES because HTTP status 200
> 
> 
> That image is cacheable according to its headers. Provided the next
> client fetches it again within the next 99mins, and the
> interception limits do not prevent storage.
> 
> Check for mentions of "Host header forgery" by this same
> user/client or the previous one fetching this URL.
> 
> 
> 
>> **********************************************************************
>>
>> 
squid.conf *******************************************************
> 
>> # debug helper #debug_options 84,3 #debug Refresh Calculation 
>> #debug_options 22,3 # HTTP #debug_options 11,3
> 
>> debug_options 11,3 22,3 84,3
> 
> 
>> acl customernet src 172.16.212.154/32 acl customernet src 
>> 192.168.1.0/24
> 
> 
>> acl SSL_ports port 443 acl SSL_ports port 873  # rsync
> 
>> acl Safe_ports port 80         # http acl Safe_ports port 21 #
>> ftp acl Safe_ports port 443        # https acl Safe_ports port
>> 70 # gopher acl Safe_ports port 210        # wais acl Safe_ports
>> port 1025-65535 # unregistered ports acl Safe_ports port 280
>> # http-mgmt acl Safe_ports port 488        # gss-http acl
>> Safe_ports port 591        # filemaker acl Safe_ports port 777
>> # multiling http acl CONNECT method CONNECT
> 
>> http_access deny !Safe_ports http_access deny CONNECT !SSL_ports
>>  http_access allow localhost manager http_access deny manager 
>> http_access allow localhost http_access allow customernet
>> http_access deny all # http_access allow all
> 
>> #HTTPS (SSL) trafic interception options always_direct allow
>> SSL_ports ssl_bump server-first SSL_ports #sslproxy_cert_error
>> deny all #sslproxy_flags DONT_VERIFY_PEER sslcrtd_program 
>> /usr/lib/squid3/ssl_crtd -s /var/spool/squid3_ssldb -M 4MB 
>> sslcrtd_children 8 startup=1 idle=1
> 
>> acl rewritedoms dstdomain .c.youtube.com .googlevideo.com
>> .ytimg.com store_id_program /usr/lib/squid3/storeid_file_rewrite 
>> /etc/squid3/storeid_rewrite store_id_children 40 startup=10
>> idle=5 concurrency=0 store_id_access allow rewritedoms
>> store_id_access deny all
> 
> 
>> http_port 3128 http_port 8080 intercept https_port 8081 intercept
>>  ssl-bump generate-host-certificates=on
>> dynamic_cert_mem_cache_size=4MB 
>> cert=/etc/squid3/ssl_cert/squidcert.pem
> 
> 
>> forward_max_tries 25 cache_mem 2 GB
>> maximum_object_size_in_memory 25 MB maximum_object_size 1 GB
> 
>> visible_hostname squid-v2 dns_v4_first on
> 
> 
>> coredump_dir /var/spool/squid3 cache_replacement_policy heap
>> LFUDA cache_dir aufs /var/spool/squid3 14000 16 256
> 
> 14GB of disk trying to cache YT videos may not be enough space.
> 
> If the objects being fetched above were legitimately discarded to
> make room for newer content then MISS is entirely to be expected.
> 
> 
>> refresh_pattern 
>> ^http:\/\/video-srv\.(googlevideo|youtube)\.com\.squid\.internal.*
>>
>> 
10080 80%  79900 override-lastmod override-expire ignore-reload
>> ignore-must-revalidate ignore-private refresh_pattern 
>> ^http:\/\/ytimg\.com\.squid\.internal.*  10080 80%  79900 
>> override-lastmod override-expire ignore-reload
>> ignore-must-revalidate ignore-private
> 
> 
> If you look at those server reply headers you can see the
> Cache-Control explicitly says the reply is "public". This means
> that the "ignore-private" setting is useless on these images. *
> ignoring privacy controls is a highly nasty thing to do to start
> with. I suggest strongly that you remove it from the ytimg pattern
> options as unnecessary.
> 
> Also, here is an artifact of the override options which you may not
> be aware:
> 
> The Expires header coming from YT indicates that the reply is
> cacheable for 6hrs from the time it was generated. That is 21600
> seconds, no less. Your override-expires is actively *reducing* the
> storage time to 10800 seconds (the 'min' field of the pattern
> options).
> 
> Therefore to maximise caching you should *drop* the
> override-expires option on the ytimg pattern.
> 
> 
> NP: override-lastmod is usually also a bad thing to do, but I see
> you are actually hitting THE use-case for which it legitimately
> exist... server emitting incorrect Last-Modified value (1970?
> sure).
> 
> 
> 
> Amos
> 
> _______________________________________________ squid-users mailing
> list squid-users at lists.squid-cache.org 
> http://lists.squid-cache.org/listinfo/squid-users 
> _______________________________________________ squid-users mailing
> list squid-users at lists.squid-cache.org 
> http://lists.squid-cache.org/listinfo/squid-users
> 

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUPKLRAAoJELJo5wb/XPRjvSIIAKLTnKZa/Vnde559Z+LsXaCP
I50ewcN6yejWKBQECTPbATwnyyyvnhvM0OIj5KoHDOYbAZQZpoEgzf3ID0VppFKn
PLl/2xe3Frs+fxZJxgbUzvgCxvvmk7O5xd5w4Uuks0Rx3dYMo76DFyamKo5hnGXH
4594zS7tWVwhYfsrtw6WeVRifmiw68NjHGsRPve9v0rKTttUGS6WxF+aHK7ZcKQ0
n+eyDdm5bGv1kHqMkhNvmJ4fBk8LoROChpQnQIwp0lm7IJzvi1XwPOk90a/kll4u
lOYRXIeogv7B1DmTNwxThzAi6FknlMZYx3PGdUSU7QTEEQW5kJ1TCdyB9y7Iebo=
=SfGo
-----END PGP SIGNATURE-----


From sudakov at sibptus.tomsk.ru  Tue Oct 14 05:24:01 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Tue, 14 Oct 2014 12:24:01 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <20141009021821.GA3372@admin.sibptus.tomsk.ru>
References: <20141006040725.GA31642@admin.sibptus.tomsk.ru>
 <20141006052346.GA32369@admin.sibptus.tomsk.ru>
 <20141007070403.GA57384@admin.sibptus.tomsk.ru>
 <20141007083542.GA60425@admin.sibptus.tomsk.ru>
 <m11nv3$nk8$1@ger.gmane.org>
 <20141008032925.GA77544@admin.sibptus.tomsk.ru>
 <m14if3$1ul$2@ger.gmane.org>
 <20141009021821.GA3372@admin.sibptus.tomsk.ru>
Message-ID: <20141014052401.GA8411@admin.sibptus.tomsk.ru>

Now as I run the test authenticator, what's the 
"INFO: continuation needed" 
message from the squid Kerberos helper? How do I interperet it? Is it
success or fail?

See output below:

$ bin/test_negotiate_auth.sh
/home/sudakov/squid.keytab:

Vno  Type                     Principal
  1  des-cbc-crc              HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  des-cbc-md5              HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  arcfour-hmac-md5         HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  aes256-cts-hmac-sha1-96  HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  aes128-cts-hmac-sha1-96  HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
Credentials cache: FILE:/home/sudakov/tmp/KKK
        Principal: sudakovva at SIBPTUS.TRANSNEFT.RU
    Cache version: 4

Server: krbtgt/SIBPTUS.TRANSNEFT.RU at SIBPTUS.TRANSNEFT.RU
Client: sudakovva at SIBPTUS.TRANSNEFT.RU
Ticket etype: arcfour-hmac-md5
Ticket length: 1120
Auth time:  Oct 14 12:09:10 2014
End time:   Oct 14 22:09:10 2014
Ticket flags: initial, pre-authenticated
Addresses: addressless

Server: HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
Client: sudakovva at SIBPTUS.TRANSNEFT.RU
Ticket etype: arcfour-hmac-md5
Ticket length: 1204
Auth time:  Oct 14 12:09:10 2014
Start time: Oct 14 12:09:13 2014
End time:   Oct 14 22:09:10 2014
Ticket flags: pre-authenticated
Addresses: addressless

negotiate_kerberos_auth.cc(212): pid=33822 :2014/10/14 12:09:17| negotiate_kerberos_auth: INFO: Starting version 3.0.4sq
negotiate_kerberos_auth.cc(258): pid=33822 :2014/10/14 12:09:17| negotiate_kerberos_auth: DEBUG: Got 'YR YIIGDQYGKwYBBQUCoIIGATCCBf2gDTALBgkqhkiG9xIBAgKiggXqBIIF5mCCBeIGCSqGSIb3EgECAgEAboIF0TCCBc2gAwIBBaEDAgEOogcDBQAAAAAAo4IEtGGCBLAwggSsoAMCAQWhFhsUU0lCUFRVUy5UUkFOU05FRlQuUlWiLTAroAMCAQGhJDAiGwRIVFRQGxpwcm94eS5zaWJwdHVzLnRyYW5zbmVmdC5ydaOCBFwwggRYoAMCAReiggRPBIIES/tAzA94ZoZDS5uRFohOogD2BbSP4cemuY1qiwRBouKsLODgd/ALMHc9gtPPxqrVGEf4q+6gCF+jZYgBuFgnEG38eTIW3fWa80yPD5MM9W9EJshvgifhq1jnZ3eGdC90RdQxeB0KcM9ytGtz6gWPPuoy9PhZy8lmF86cKVxdIfWK6Jp08UM6DRZ22M6lHdopi6LcTgnHBnefFdPsnKThV7kQlw5kiOLM5skdwxt2BvS5vnfIf4P7APRGCQhhJOt/0dC9xSfglrOGlh718oQ7A0w1kpJ8tDcZPR/hrZhBcITu6VcK90cbEznlN/RBwC5KYEEOnjSeXOWy+ctxLu2BcIBUvcEcYrjFgfiiLZFngi/bqQmxsRsV9gFm2Ow2lKnHtvNaJ1XOxjVkM8nC546UU4Ywc6eM+Xu1kywiuyn1q1DrL6Q77DmbPh7G0qNc4SPAYTqMvEbEv2emq7sv7VsJUzkd2PcbryAxvzVNLfsLBegh6DDkdey/UaTEX66YlhrNLlIN+RN35Lww1qQv9wUVIV+DZ3kmwdgpJlClIjwH6+PWI19hS0ePs2Uipy0jJRl8G3P88bw29QV1y8rMOuLU2clI6UC/lmQepxDDw5Te+qTcgx96Ry4+J/FjhnPzo1yVUBG3UXlao0arSZmGEXldW9H5uZJXvxYLU8hYenBrPhpXB1neK+bxlOk6A/bfJ1pW3z/0Et6EP6w1Y7r4BfpE56Ecuf87VbDlwusUpY1yPD9/zYGrgSgnGMF8DdArr1Z67fpc3JmhJep6wL7REohPsFi8jhDhnheFSLYbWshAkqzcesNSy8ZAfc+TIUIHBwFT6hbMBqguo1UzDvRk6cLsKa/WHkwa52tOhUpacfHmBjHT8xb0Zj81RbQbtV+PIfB0+EnLdT1T34zcLLl3PKAsr9d6Dp72QclxdAfVCKwhFMJht0k2MEZtgCJZwZ6Wa3gh9FDGa/mEcawB0he0+yLd/NIaoO3uLQ6dKLa2dPc7z3qeXg/fhwG5YR7NFoY+0b8UI4ANH1yCOZVDBrmC3q1tCVx5bGd/qOFLA6zAipRHpH+znqWPLqkyA9t27SgikivFEGEv2JNHZkU1Xa56zf2IPo4b3Fo2JO6FVe/qYz4u1hoKOi3DmwRPojdh6dHBvSEDguM3Nk00poYj5az1cLkQGHpYPmdinVXtZd0fS97Il/GAovcSnjV7T+1NZBlBkohci0R3XvxFwCGyXQ7JwlXcLIXhvf7FrS9FW4tY1n4cR0PM1MMWhJp0R5jKJEKR2bN3uEOq0dvLraRFaFnoV/iNhLG4p6SjBs8guzkZRhugUJnPX75xTZpb0+pTdGRpOQ+BDE9rFAoQ9fMZ2js1Q63SHb9rbP7AF+qt3jE+g5pJUW1IofOkl97rUZjBu0LfCNb05Giql6mj6V8XjiAPIwgmlYQlCsa7YzzWjhzg5cg5rAgX3D6paeh3uJmRs3ikgf8wgfygAwIBF6KB9ASB8Vp/bmgivaLEVnnZ/9n6gwfFLjHYHBIP06HjeyA1Jyb3pzUTRFvkpoZ+TVpwbLLIt1l0Nr33Q9HA286P15VmwUP8gAasQWE6l5mLFNIl4I9jnk6ewqblnec1MYCtg36Qy7ybgoOFDIcOESHyS3OsET379m6cwXpC4EOQzG8yTxW9hNuuIkz7NkmyAeQup3uPvw0YoLWj61f4yaNlKOWJnr1MpnMu6ZrJNM3mv9/ATXQAlNaJdrv8Vr7JUCNcD+SwyLb901woRjb4XBrWpJBpZAWiIfzMjKYJhGTjwvESiTnnwARYdLDhEEZyr1dQJjkU87c=' from squid (length: 2075).
negotiate_kerberos_auth.cc(311): pid=33822 :2014/10/14 12:09:17| negotiate_kerberos_auth: DEBUG: Decode 'YIIGDQYGKwYBBQUCoIIGATCCBf2gDTALBgkqhkiG9xIBAgKiggXqBIIF5mCCBeIGCSqGSIb3EgECAgEAboIF0TCCBc2gAwIBBaEDAgEOogcDBQAAAAAAo4IEtGGCBLAwggSsoAMCAQWhFhsUU0lCUFRVUy5UUkFOU05FRlQuUlWiLTAroAMCAQGhJDAiGwRIVFRQGxpwcm94eS5zaWJwdHVzLnRyYW5zbmVmdC5ydaOCBFwwggRYoAMCAReiggRPBIIES/tAzA94ZoZDS5uRFohOogD2BbSP4cemuY1qiwRBouKsLODgd/ALMHc9gtPPxqrVGEf4q+6gCF+jZYgBuFgnEG38eTIW3fWa80yPD5MM9W9EJshvgifhq1jnZ3eGdC90RdQxeB0KcM9ytGtz6gWPPuoy9PhZy8lmF86cKVxdIfWK6Jp08UM6DRZ22M6lHdopi6LcTgnHBnefFdPsnKThV7kQlw5kiOLM5skdwxt2BvS5vnfIf4P7APRGCQhhJOt/0dC9xSfglrOGlh718oQ7A0w1kpJ8tDcZPR/hrZhBcITu6VcK90cbEznlN/RBwC5KYEEOnjSeXOWy+ctxLu2BcIBUvcEcYrjFgfiiLZFngi/bqQmxsRsV9gFm2Ow2lKnHtvNaJ1XOxjVkM8nC546UU4Ywc6eM+Xu1kywiuyn1q1DrL6Q77DmbPh7G0qNc4SPAYTqMvEbEv2emq7sv7VsJUzkd2PcbryAxvzVNLfsLBegh6DDkdey/UaTEX66YlhrNLlIN+RN35Lww1qQv9wUVIV+DZ3kmwdgpJlClIjwH6+PWI19hS0ePs2Uipy0jJRl8G3P88bw29QV1y8rMOuLU2clI6UC/lmQepxDDw5Te+qTcgx96Ry4+J/FjhnPzo1yVUBG3UXlao0arSZmGEXldW9H5uZJXvxYLU8hYenBrPhpXB1neK+bxlOk6A/bfJ1pW3z/0Et6EP6w1Y7r4BfpE56Ecuf87VbDlwusUpY1yPD9/zYGrgSgnGMF8DdArr1Z67fpc3JmhJep6wL7REohPsFi8jhDhnheFSLYbWshAkqzcesNSy8ZAfc+TIUIHBwFT6hbMBqguo1UzDvRk6cLsKa/WHkwa52tOhUpacfHmBjHT8xb0Zj81RbQbtV+PIfB0+EnLdT1T34zcLLl3PKAsr9d6Dp72QclxdAfVCKwhFMJht0k2MEZtgCJZwZ6Wa3gh9FDGa/mEcawB0he0+yLd/NIaoO3uLQ6dKLa2dPc7z3qeXg/fhwG5YR7NFoY+0b8UI4ANH1yCOZVDBrmC3q1tCVx5bGd/qOFLA6zAipRHpH+znqWPLqkyA9t27SgikivFEGEv2JNHZkU1Xa56zf2IPo4b3Fo2JO6FVe/qYz4u1hoKOi3DmwRPojdh6dHBvSEDguM3Nk00poYj5az1cLkQGHpYPmdinVXtZd0fS97Il/GAovcSnjV7T+1NZBlBkohci0R3XvxFwCGyXQ7JwlXcLIXhvf7FrS9FW4tY1n4cR0PM1MMWhJp0R5jKJEKR2bN3uEOq0dvLraRFaFnoV/iNhLG4p6SjBs8guzkZRhugUJnPX75xTZpb0+pTdGRpOQ+BDE9rFAoQ9fMZ2js1Q63SHb9rbP7AF+qt3jE+g5pJUW1IofOkl97rUZjBu0LfCNb05Giql6mj6V8XjiAPIwgmlYQlCsa7YzzWjhzg5cg5rAgX3D6paeh3uJmRs3ikgf8wgfygAwIBF6KB9ASB8Vp/bmgivaLEVnnZ/9n6gwfFLjHYHBIP06HjeyA1Jyb3pzUTRFvkpoZ+TVpwbLLIt1l0Nr33Q9HA286P15VmwUP8gAasQWE6l5mLFNIl4I9jnk6ewqblnec1MYCtg36Qy7ybgoOFDIcOESHyS3OsET379m6cwXpC4EOQzG8yTxW9hNuuIkz7NkmyAeQup3uPvw0YoLWj61f4yaNlKOWJnr1MpnMu6ZrJNM3mv9/ATXQAlNaJdrv8Vr7JUCNcD+SwyLb901woRjb4XBrWpJBpZAWiIfzMjKYJhGTjwvESiTnnwARYdLDhEEZyr1dQJjkU87c=' (decoded length: 1553).
negotiate_kerberos_auth.cc(373): pid=33822 :2014/10/14 12:09:17| negotiate_kerberos_auth: INFO: continuation needed
TT oRQwEqADCgEBoQsGCSqGSIb3EgECAg==
negotiate_kerberos_auth.cc(258): pid=33822 :2014/10/14 12:09:17| negotiate_kerberos_auth: DEBUG: Got 'QQ' from squid (length: 2).
BH quit command
$ 


-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru


From lionxyes at gmail.com  Tue Oct 14 06:17:30 2014
From: lionxyes at gmail.com (lionxyes at gmail.com)
Date: Tue, 14 Oct 2014 14:17:30 +0800
Subject: [squid-users] some question about compiling squid with Cygwin
Message-ID: <2014101414172276501150@gmail.com>

Hello, everybody!

Recently i need run squid 3.x(x >= 1) on windows, and i found related wiki from this url:

    http://wiki.squid-cache.org/KnowledgeBase/Windows 

From this i know there are two methods of running squid on windows.
    1. Compiling with Cygwin
    2. Compiling with MinGW
and squid series 3 has major build issues on all Windows compiler systems. And there is no 
solution of the issues about compiling with MinGw.

but then i readed that there have been unconfirmed reports from some users of building up 
to squid-3.3 successfully and producing a usable executable. Cygwin project provide version 
3.3.3 packages.

I was excited. I tried it immediately, but i failed when i make it. I had sucessfully compiled suqid-2.7 
in the same environmnent.

so, are there people of compiling squid 3.3.3 with Cygwin successfully. and can give me some help?


lionxyes at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141014/6c1ddec0/attachment.htm>

From squid3 at treenet.co.nz  Tue Oct 14 07:55:51 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 14 Oct 2014 20:55:51 +1300
Subject: [squid-users] some question about compiling squid with Cygwin
In-Reply-To: <2014101414172276501150@gmail.com>
References: <2014101414172276501150@gmail.com>
Message-ID: <543CD707.7020902@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 14/10/2014 7:17 p.m., lionxyes at gmail.com wrote:
> Hello, everybody!
> 
> Recently i need run squid 3.x(x >= 1) on windows, and i found
> related wiki from this url:
> 
> http://wiki.squid-cache.org/KnowledgeBase/Windows
> 
> From this i know there are two methods of running squid on
> windows. 1. Compiling with Cygwin 2. Compiling with MinGW and squid
> series 3 has major build issues on all Windows compiler systems.
> And there is no solution of the issues about compiling with MinGw.
> 
> but then i readed that there have been unconfirmed reports from
> some users of building up to squid-3.3 successfully and producing a
> usable executable. Cygwin project provide version 3.3.3 packages.
> 
> I was excited. I tried it immediately, but i failed when i make it.
> I had sucessfully compiled suqid-2.7 in the same environmnent.
> 
> so, are there people of compiling squid 3.3.3 with Cygwin
> successfully. and can give me some help?

The download URLs referenced under
<http://wiki.squid-cache.org/KnowledgeBase/Windows#Pre-Built_Binary_Packages>
includes both binary and source packages which are being used to build.

Please check if you are using that src package rather than the
upstream release tarball. There may be cygwin specific patches applied
to it.

Also, if you need to build any features not included in the provided
binary package then you may consider the feature untested possibly
either not building or working. There may be some support from Cygwin
regarding those situations, but the upstream target for resuming
Windows support is 3.5 series.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUPNcGAAoJELJo5wb/XPRj75kIAOSp5KgTJVLNjiVqzQnwBKGP
/w8thp52qhpLwoiTQQ8vouyuuElbwMihJ6SWH51xOiCFyCtG5n1iTenEb26xcCGf
g49UaeehlKihnElkLmFUJmDsnHHD+tkjr6gfg5pAKwtVzMdU30bmpF2ga7TnBwSe
KZvGcWSfOD6xCEysuYMokgRPYmWcZd4ySX+r32lrWW+c28Tyz1KTJlcuvpq8TAzN
twyjubjLCRSh7s91eFnhf0/woY7dn2dr0jnflA3ZPPcIqgOqw4Y7wnA7GTVFLviC
JnA8qVT5k4VK4xurUoYyOMfKmVIh3W+Q4M8gfDyjjcwr89d/xFf0C2pjTMEkcsA=
=QROG
-----END PGP SIGNATURE-----


From robert.hundley at ResourceGroup.co.uk  Tue Oct 14 09:26:32 2014
From: robert.hundley at ResourceGroup.co.uk (Robert Hundley)
Date: Tue, 14 Oct 2014 09:26:32 +0000
Subject: [squid-users] Problems with filtering when using chrome
Message-ID: <bd42a2ea83b644c2ac87818788e0280b@thmx4.ResourceGroup.co.uk>

Hi,
I'm trying to use squid to do some basic filtering. I have added an ACL to filtering based on regular expressions, and added in a few strings I'd like not to load.
These work correctly on IE and firefox, but in chrome the page loads.
It correctly records TCP_DENIED/403 3674 CONNECT www.dropbox.com:443 - NONE/- text/html, but the site then loads regardless.

Chrome also seems to struggle with internal hosts; they refuse to load even though I have added the nodes to the hosts file, which seems to have worked for other browsers.

This originally occurred on 3.1, though I have since updated to 3.4.8 and am still experiencing this

Has anyone come across the same / any similar issues?

Robert Hundley HND (Computing)
IT Support Engineer

Resource Group
Tel: +44 (0) 1905 368 550       Fax: +44 (0) 1905 353 271     Web: http://www.resourcegroup.co.uk<http://www.resourcegroup.co.uk/>

Keep In Touch...
For regular updates on marketing news, events and activities,
follow us on Facebook<https://www.facebook.com/resource.group.ltd> and LinkedIn.<http://www.linkedin.com/company/291569>

expert solutions, adding value

The information contained in this e-mail is intended only for the person or entity to which it is addressed and may contain confidential and / or privileged material. If you are not the intended recipient of this e-mail, the use of this information or any disclosure, copying or distribution is prohibited and may be unlawful. If you received this in error, please contact the sender and delete the material from any computer. Only Resource Group Ltd employees with Director status have authority to bind the company. Resource Group Ltd. Registered office: 4th Floor, Horton House, Exchange Flags, Liverpool, L2 3YL, England. Company registration number: 02667200. Registered in England.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141014/2860b705/attachment.htm>

From huaraz at moeller.plus.com  Tue Oct 14 09:28:33 2014
From: huaraz at moeller.plus.com (Markus Moeller)
Date: Tue, 14 Oct 2014 10:28:33 +0100
Subject: [squid-users] Squid,
	Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
	3.4.7.)
In-Reply-To: <20141014052401.GA8411@admin.sibptus.tomsk.ru>
References: <20141006040725.GA31642@admin.sibptus.tomsk.ru>
 <20141006052346.GA32369@admin.sibptus.tomsk.ru>
 <20141007070403.GA57384@admin.sibptus.tomsk.ru>
 <20141007083542.GA60425@admin.sibptus.tomsk.ru> <m11nv3$nk8$1@ger.gmane.org>
 <20141008032925.GA77544@admin.sibptus.tomsk.ru> <m14if3$1ul$2@ger.gmane.org>
 <20141009021821.GA3372@admin.sibptus.tomsk.ru>
 <20141014052401.GA8411@admin.sibptus.tomsk.ru>
Message-ID: <m1iqc6$m3g$1@ger.gmane.org>

Hi Victor,

  That just means that the server requires more information from the client. 
This could happen if mutual authentication is required or the dataset is too 
large and had to be split. If you run it in squid the client would send new 
data until the server says the exchange is complete ( I have not programmed 
this into the simple test tool).

Markus


"Victor Sudakov"  wrote in message 
news:20141014052401.GA8411 at admin.sibptus.tomsk.ru...

Now as I run the test authenticator, what's the
"INFO: continuation needed"
message from the squid Kerberos helper? How do I interperet it? Is it
success or fail?

See output below:

$ bin/test_negotiate_auth.sh
/home/sudakov/squid.keytab:

Vno  Type                     Principal
  1  des-cbc-crc 
HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  des-cbc-md5 
HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  arcfour-hmac-md5 
HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  aes256-cts-hmac-sha1-96 
HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
  1  aes128-cts-hmac-sha1-96 
HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
Credentials cache: FILE:/home/sudakov/tmp/KKK
        Principal: sudakovva at SIBPTUS.TRANSNEFT.RU
    Cache version: 4

Server: krbtgt/SIBPTUS.TRANSNEFT.RU at SIBPTUS.TRANSNEFT.RU
Client: sudakovva at SIBPTUS.TRANSNEFT.RU
Ticket etype: arcfour-hmac-md5
Ticket length: 1120
Auth time:  Oct 14 12:09:10 2014
End time:   Oct 14 22:09:10 2014
Ticket flags: initial, pre-authenticated
Addresses: addressless

Server: HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
Client: sudakovva at SIBPTUS.TRANSNEFT.RU
Ticket etype: arcfour-hmac-md5
Ticket length: 1204
Auth time:  Oct 14 12:09:10 2014
Start time: Oct 14 12:09:13 2014
End time:   Oct 14 22:09:10 2014
Ticket flags: pre-authenticated
Addresses: addressless

negotiate_kerberos_auth.cc(212): pid=33822 :2014/10/14 12:09:17| 
negotiate_kerberos_auth: INFO: Starting version 3.0.4sq
negotiate_kerberos_auth.cc(258): pid=33822 :2014/10/14 12:09:17| 
negotiate_kerberos_auth: DEBUG: Got 'YR 
YIIGDQYGKwYBBQUCoIIGATCCBf2gDTALBgkqhkiG9xIBAgKiggXqBIIF5mCCBeIGCSqGSIb3EgECAgEAboIF0TCCBc2gAwIBBaEDAgEOogcDBQAAAAAAo4IEtGGCBLAwggSsoAMCAQWhFhsUU0lCUFRVUy5UUkFOU05FRlQuUlWiLTAroAMCAQGhJDAiGwRIVFRQGxpwcm94eS5zaWJwdHVzLnRyYW5zbmVmdC5ydaOCBFwwggRYoAMCAReiggRPBIIES/tAzA94ZoZDS5uRFohOogD2BbSP4cemuY1qiwRBouKsLODgd/ALMHc9gtPPxqrVGEf4q+6gCF+jZYgBuFgnEG38eTIW3fWa80yPD5MM9W9EJshvgifhq1jnZ3eGdC90RdQxeB0KcM9ytGtz6gWPPuoy9PhZy8lmF86cKVxdIfWK6Jp08UM6DRZ22M6lHdopi6LcTgnHBnefFdPsnKThV7kQlw5kiOLM5skdwxt2BvS5vnfIf4P7APRGCQhhJOt/0dC9xSfglrOGlh718oQ7A0w1kpJ8tDcZPR/hrZhBcITu6VcK90cbEznlN/RBwC5KYEEOnjSeXOWy+ctxLu2BcIBUvcEcYrjFgfiiLZFngi/bqQmxsRsV9gFm2Ow2lKnHtvNaJ1XOxjVkM8nC546UU4Ywc6eM+Xu1kywiuyn1q1DrL6Q77DmbPh7G0qNc4SPAYTqMvEbEv2emq7sv7VsJUzkd2PcbryAxvzVNLfsLBegh6DDkdey/UaTEX66YlhrNLlIN+RN35Lww1qQv9wUVIV+DZ3kmwdgpJlClIjwH6+PWI19hS0ePs2Uipy0jJRl8G3P88bw29QV1y8rMOuLU2clI6UC/lmQepxDDw5Te+qTcgx96Ry4+J/FjhnPzo1yVUBG3UXlao0arSZmGEXldW9H5uZJXvxYLU8hYenBrPhpXB1neK+bxlOk6A/bfJ1pW3z/0Et6EP6w1Y7r4BfpE56Ecuf87VbDlwusUpY1yPD9/zYGrgSgnGMF8DdArr1Z67fpc3JmhJep6wL7REohPsFi8jhDhnheFSLYbWshAkqzcesNSy8ZAfc+TIUIHBwFT6hbMBqguo1UzDvRk6cLsKa/WHkwa52tOhUpacfHmBjHT8xb0Zj81RbQbtV+PIfB0+EnLdT1T34zcLLl3PKAsr9d6Dp72QclxdAfVCKwhFMJht0k2MEZtgCJZwZ6Wa3gh9FDGa/mEcawB0he0+yLd/NIaoO3uLQ6dKLa2dPc7z3qeXg/fhwG5YR7NFoY+0b8UI4ANH1yCOZVDBrmC3q1tCVx5bGd/qOFLA6zAipRHpH+znqWPLqkyA9t27SgikivFEGEv2JNHZkU1Xa56zf2IPo4b3Fo2JO6FVe/qYz4u1hoKOi3DmwRPojdh6dHBvSEDguM3Nk00poYj5az1cLkQGHpYPmdinVXtZd0fS97Il/GAovcSnjV7T+1NZBlBkohci0R3XvxFwCGyXQ7JwlXcLIXhvf7FrS9FW4tY1n4cR0PM1MMWhJp0R5jKJEKR2bN3uEOq0dvLraRFaFnoV/iNhLG4p6SjBs8guzkZRhugUJnPX75xTZpb0+pTdGRpOQ+BDE9rFAoQ9fMZ2js1Q63SHb9rbP7AF+qt3jE+g5pJUW1IofOkl97rUZjBu0LfCNb05Giql6mj6V8XjiAPIwgmlYQlCsa7YzzWjhzg5cg5rAgX3D6paeh3uJmRs3ikgf8wgfygAwIBF6KB9ASB8Vp/bmgivaLEVnnZ/9n6gwfFLjHYHBIP06HjeyA1Jyb3pzUTRFvkpoZ+TVpwbLLIt1l0Nr33Q9HA286P15VmwUP8gAasQWE6l5mLFNIl4I9jnk6ewqblnec1MYCtg36Qy7ybgoOFDIcOESHyS3OsET379m6cwXpC4EOQzG8yTxW9hNuuIkz7NkmyAeQup3uPvw0YoLWj61f4yaNlKOWJnr1MpnMu6ZrJNM3mv9/ATXQAlNaJdrv8Vr7JUCNcD+SwyLb901woRjb4XBrWpJBpZAWiIfzMjKYJhGTjwvESiTnnwARYdLDhEEZyr1dQJjkU87c=' 
from squid (length: 2075).
negotiate_kerberos_auth.cc(311): pid=33822 :2014/10/14 12:09:17| 
negotiate_kerberos_auth: DEBUG: Decode 
'YIIGDQYGKwYBBQUCoIIGATCCBf2gDTALBgkqhkiG9xIBAgKiggXqBIIF5mCCBeIGCSqGSIb3EgECAgEAboIF0TCCBc2gAwIBBaEDAgEOogcDBQAAAAAAo4IEtGGCBLAwggSsoAMCAQWhFhsUU0lCUFRVUy5UUkFOU05FRlQuUlWiLTAroAMCAQGhJDAiGwRIVFRQGxpwcm94eS5zaWJwdHVzLnRyYW5zbmVmdC5ydaOCBFwwggRYoAMCAReiggRPBIIES/tAzA94ZoZDS5uRFohOogD2BbSP4cemuY1qiwRBouKsLODgd/ALMHc9gtPPxqrVGEf4q+6gCF+jZYgBuFgnEG38eTIW3fWa80yPD5MM9W9EJshvgifhq1jnZ3eGdC90RdQxeB0KcM9ytGtz6gWPPuoy9PhZy8lmF86cKVxdIfWK6Jp08UM6DRZ22M6lHdopi6LcTgnHBnefFdPsnKThV7kQlw5kiOLM5skdwxt2BvS5vnfIf4P7APRGCQhhJOt/0dC9xSfglrOGlh718oQ7A0w1kpJ8tDcZPR/hrZhBcITu6VcK90cbEznlN/RBwC5KYEEOnjSeXOWy+ctxLu2BcIBUvcEcYrjFgfiiLZFngi/bqQmxsRsV9gFm2Ow2lKnHtvNaJ1XOxjVkM8nC546UU4Ywc6eM+Xu1kywiuyn1q1DrL6Q77DmbPh7G0qNc4SPAYTqMvEbEv2emq7sv7VsJUzkd2PcbryAxvzVNLfsLBegh6DDkdey/UaTEX66YlhrNLlIN+RN35Lww1qQv9wUVIV+DZ3kmwdgpJlClIjwH6+PWI19hS0ePs2Uipy0jJRl8G3P88bw29QV1y8rMOuLU2clI6UC/lmQepxDDw5Te+qTcgx96Ry4+J/FjhnPzo1yVUBG3UXlao0arSZmGEXldW9H5uZJXvxYLU8hYenBrPhpXB1neK+bxlOk6A/bfJ1pW3z/0Et6EP6w1Y7r4BfpE56Ecuf87VbDlwusUpY1yPD9/zYGrgSgnGMF8DdArr1Z67fpc3JmhJep6wL7REohPsFi8jhDhnheFSLYbWshAkqzcesNSy8ZAfc+TIUIHBwFT6hbMBqguo1UzDvRk6cLsKa/WHkwa52tOhUpacfHmBjHT8xb0Zj81RbQbtV+PIfB0+EnLdT1T34zcLLl3PKAsr9d6Dp72QclxdAfVCKwhFMJht0k2MEZtgCJZwZ6Wa3gh9FDGa/mEcawB0he0+yLd/NIaoO3uLQ6dKLa2dPc7z3qeXg/fhwG5YR7NFoY+0b8UI4ANH1yCOZVDBrmC3q1tCVx5bGd/qOFLA6zAipRHpH+znqWPLqkyA9t27SgikivFEGEv2JNHZkU1Xa56zf2IPo4b3Fo2JO6FVe/qYz4u1hoKOi3DmwRPojdh6dHBvSEDguM3Nk00poYj5az1cLkQGHpYPmdinVXtZd0fS97Il/GAovcSnjV7T+1NZBlBkohci0R3XvxFwCGyXQ7JwlXcLIXhvf7FrS9FW4tY1n4cR0PM1MMWhJp0R5jKJEKR2bN3uEOq0dvLraRFaFnoV/iNhLG4p6SjBs8guzkZRhugUJnPX75xTZpb0+pTdGRpOQ+BDE9rFAoQ9fMZ2js1Q63SHb9rbP7AF+qt3jE+g5pJUW1IofOkl97rUZjBu0LfCNb05Giql6mj6V8XjiAPIwgmlYQlCsa7YzzWjhzg5cg5rAgX3D6paeh3uJmRs3ikgf8wgfygAwIBF6KB9ASB8Vp/bmgivaLEVnnZ/9n6gwfFLjHYHBIP06HjeyA1Jyb3pzUTRFvkpoZ+TVpwbLLIt1l0Nr33Q9HA286P15VmwUP8gAasQWE6l5mLFNIl4I9jnk6ewqblnec1MYCtg36Qy7ybgoOFDIcOESHyS3OsET379m6cwXpC4EOQzG8yTxW9hNuuIkz7NkmyAeQup3uPvw0YoLWj61f4yaNlKOWJnr1MpnMu6ZrJNM3mv9/ATXQAlNaJdrv8Vr7JUCNcD+SwyLb901woRjb4XBrWpJBpZAWiIfzMjKYJhGTjwvESiTnnwARYdLDhEEZyr1dQJjkU87c=' 
(decoded length: 1553).
negotiate_kerberos_auth.cc(373): pid=33822 :2014/10/14 12:09:17| 
negotiate_kerberos_auth: INFO: continuation needed
TT oRQwEqADCgEBoQsGCSqGSIb3EgECAg==
negotiate_kerberos_auth.cc(258): pid=33822 :2014/10/14 12:09:17| 
negotiate_kerberos_auth: DEBUG: Got 'QQ' from squid (length: 2).
BH quit command
$


-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users 




From squid3 at treenet.co.nz  Tue Oct 14 10:37:17 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 14 Oct 2014 23:37:17 +1300
Subject: [squid-users] Problems with filtering when using chrome
In-Reply-To: <bd42a2ea83b644c2ac87818788e0280b@thmx4.ResourceGroup.co.uk>
References: <bd42a2ea83b644c2ac87818788e0280b@thmx4.ResourceGroup.co.uk>
Message-ID: <543CFCDD.6010908@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 14/10/2014 10:26 p.m., Robert Hundley wrote:
> Hi, I'm trying to use squid to do some basic filtering. I have
> added an ACL to filtering based on regular expressions, and added
> in a few strings I'd like not to load. These work correctly on IE
> and firefox, but in chrome the page loads. It correctly records
> TCP_DENIED/403 3674 CONNECT www.dropbox.com:443 - NONE/- text/html,
> but the site then loads regardless.

Not as part of that transaction. Squid emitted a 403 (Forbidden) page.

Do you have a record of that following transaction going through Squid?

> 
> Chrome also seems to struggle with internal hosts; they refuse to
> load even though I have added the nodes to the hosts file, which
> seems to have worked for other browsers.
> 

Hosts file on Squid machine?
 and did you run "squid -k reconfigure" since changing it?

> This originally occurred on 3.1, though I have since updated to
> 3.4.8 and am still experiencing this
> 
> Has anyone come across the same / any similar issues?

It sounds very much like Chrome bypassing the proxy. I have heard of a
few instances where Chrome tried to use a configured proxy then if
that was unsuccessful, went and setup direct TCP connections on its own.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUPPzdAAoJELJo5wb/XPRj5e0H/36R9c+NVnyHewauuOlY1rn0
QRfkFUewjTAu5HWxX6Fkz9y7jpqrAWZj3IqA2nxwCHRmjUtLaeICYDz371S6FUB/
BmZzF6Mf/9R7sAeqXyj8Kw8E+omvDUenyOg/YDK54Sk7b7AlmpHY23LrCtggDatu
11LB4fg0SygusniQxolsXXQIogAMkyvRiTmQjkLst15uMBY0cAKwdIEkmarKba/a
++HvUKU6aWH6d/rup0kh1N00d9+HWxnvtkFaaT/jw4JNGnnFfcITqRE+wI1T28L1
/RU16cERnQk8IP0JVlzMGDE5NY5wHM6Fl1NR7tjthnEIOaBC8AeZV9lrNNLRUy0=
=XYYf
-----END PGP SIGNATURE-----


From satishthareja at gmail.com  Tue Oct 14 11:20:34 2014
From: satishthareja at gmail.com (Satish Thareja)
Date: Tue, 14 Oct 2014 16:50:34 +0530
Subject: [squid-users] Squid not accounting server response
Message-ID: <CAN5Kk2qZNbP9xR56J2wE2Z88edMBPwL1NiekZJOhz3datc0HpA@mail.gmail.com>

Hi,

I trying to get a video cached wherein the client sends a range
request for the video object(Range: bytes=36798-103701442) which gets
converted to request without range(range_offset_limit set to 10MB).

What I see, is after squid serves the client request and gets about
103262382 bytes of data, there is no further reads on the server side
file descriptor and the server side connection times out after 15
minutes(timeout limit).

But the packet capture on the squid machine suggest that the whole
object is being sent by the server and squid is seeing upto 103262382
bytes only.
Is this a known issue with squid?

Thanks,
Satish


From squid3 at treenet.co.nz  Tue Oct 14 11:53:26 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 15 Oct 2014 00:53:26 +1300
Subject: [squid-users] Squid not accounting server response
In-Reply-To: <CAN5Kk2qZNbP9xR56J2wE2Z88edMBPwL1NiekZJOhz3datc0HpA@mail.gmail.com>
References: <CAN5Kk2qZNbP9xR56J2wE2Z88edMBPwL1NiekZJOhz3datc0HpA@mail.gmail.com>
Message-ID: <543D0EB6.30608@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 15/10/2014 12:20 a.m., Satish Thareja wrote:
> Hi,
> 
> I trying to get a video cached wherein the client sends a range 
> request for the video object(Range: bytes=36798-103701442) which
> gets converted to request without range(range_offset_limit set to
> 10MB).
> 
> What I see, is after squid serves the client request and gets
> about 103262382 bytes of data, there is no further reads on the
> server side file descriptor and the server side connection times
> out after 15 minutes(timeout limit).
> 
> But the packet capture on the squid machine suggest that the whole 
> object is being sent by the server and squid is seeing upto
> 103262382 bytes only. Is this a known issue with squid?

What else is going on?
for example, how much was delivered to the client?
is the object cacheable?
is the transaction being adapted?

If the object cannot be cached, and the client (or ICAP/eCAP adapters)
stops receiving there is nothing Squid can do but wait. If the server
times out first while it and Squid are both waiting there is nothing
Squid can do.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUPQ61AAoJELJo5wb/XPRjX5MIAMEVz2+vMnnwlRcdgGT0jc0c
rI6J1iisP9nsOf6d61MwYllRqexC8AtTMxs0juXAvY1nhC+HLjZeRYNLBukupsE5
QWMJCMb2nH3EsLV7wpY2Sjw0CprMCYoNN4GffppFZiAhxL1i7k3cjkVwMIObv5PM
tkjHZPTkSj68EpGwEC+X2RK8/h738JRjq2fPJl2BXKSlD209iP4XJN0MLcRgS6UT
pnQYp2FNQOqLoZTa9y3F8oGClon0ymOiEyVfbpx0s0+Ze6AaPYMzF/Y2ktc5VLJm
xvdVrQHiJ2JBNSrr6RSoTVELgDjEv+WcXB0Tp5YOwGd1VOwtf189DiIkdOKjVR0=
=HkUn
-----END PGP SIGNATURE-----


From satishthareja at gmail.com  Tue Oct 14 12:16:08 2014
From: satishthareja at gmail.com (Satish Thareja)
Date: Tue, 14 Oct 2014 17:46:08 +0530
Subject: [squid-users] Squid not accounting server response
In-Reply-To: <543D0EB6.30608@treenet.co.nz>
References: <CAN5Kk2qZNbP9xR56J2wE2Z88edMBPwL1NiekZJOhz3datc0HpA@mail.gmail.com>
 <543D0EB6.30608@treenet.co.nz>
Message-ID: <CAN5Kk2qWUxs2mXQxAfgpMpvWLE8Npb31b1n5PqHbYvKs3Gejpg@mail.gmail.com>

Hi Amos,

The client is being served the content as per the range in the request headers.
The object is cacheable and there are no other caches involved.

The client requested range : 36798-103216128 (incorrect value in the last email)
Object length : 103701442
Squid seen bytes(from server): 103262382
Server Bytes seen in packet capture : 103701442

Playback using browser fails but curl requests(with same range) are
somehow being cached.

Thanks,
Satish




On Tue, Oct 14, 2014 at 5:23 PM, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 15/10/2014 12:20 a.m., Satish Thareja wrote:
>> Hi,
>>
>> I trying to get a video cached wherein the client sends a range
>> request for the video object(Range: bytes=36798-103701442) which
>> gets converted to request without range(range_offset_limit set to
>> 10MB).
>>
>> What I see, is after squid serves the client request and gets
>> about 103262382 bytes of data, there is no further reads on the
>> server side file descriptor and the server side connection times
>> out after 15 minutes(timeout limit).
>>
>> But the packet capture on the squid machine suggest that the whole
>> object is being sent by the server and squid is seeing upto
>> 103262382 bytes only. Is this a known issue with squid?
>
> What else is going on?
> for example, how much was delivered to the client?
> is the object cacheable?
> is the transaction being adapted?
>
> If the object cannot be cached, and the client (or ICAP/eCAP adapters)
> stops receiving there is nothing Squid can do but wait. If the server
> times out first while it and Squid are both waiting there is nothing
> Squid can do.
>
> Amos
>
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2.0.22 (MingW32)
>
> iQEcBAEBAgAGBQJUPQ61AAoJELJo5wb/XPRjX5MIAMEVz2+vMnnwlRcdgGT0jc0c
> rI6J1iisP9nsOf6d61MwYllRqexC8AtTMxs0juXAvY1nhC+HLjZeRYNLBukupsE5
> QWMJCMb2nH3EsLV7wpY2Sjw0CprMCYoNN4GffppFZiAhxL1i7k3cjkVwMIObv5PM
> tkjHZPTkSj68EpGwEC+X2RK8/h738JRjq2fPJl2BXKSlD209iP4XJN0MLcRgS6UT
> pnQYp2FNQOqLoZTa9y3F8oGClon0ymOiEyVfbpx0s0+Ze6AaPYMzF/Y2ktc5VLJm
> xvdVrQHiJ2JBNSrr6RSoTVELgDjEv+WcXB0Tp5YOwGd1VOwtf189DiIkdOKjVR0=
> =HkUn
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From squid3 at treenet.co.nz  Tue Oct 14 12:57:32 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 15 Oct 2014 01:57:32 +1300
Subject: [squid-users] Squid not accounting server response
In-Reply-To: <CAN5Kk2qWUxs2mXQxAfgpMpvWLE8Npb31b1n5PqHbYvKs3Gejpg@mail.gmail.com>
References: <CAN5Kk2qZNbP9xR56J2wE2Z88edMBPwL1NiekZJOhz3datc0HpA@mail.gmail.com>
 <543D0EB6.30608@treenet.co.nz>
 <CAN5Kk2qWUxs2mXQxAfgpMpvWLE8Npb31b1n5PqHbYvKs3Gejpg@mail.gmail.com>
Message-ID: <543D1DBC.8030607@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 15/10/2014 1:16 a.m., Satish Thareja wrote:
> Hi Amos,
> 
> The client is being served the content as per the range in the
> request headers. The object is cacheable and there are no other
> caches involved.
> 
> The client requested range : 36798-103216128 (incorrect value in
> the last email) Object length : 103701442

How is the above number known?
 Content-Length: header or some other way?
 is Transfer-Encoding: header in use? if so, what is its value?

> Squid seen bytes(from server): 103262382 Server Bytes seen in
> packet capture : 103701442

How much of those numbers is reply headers and how much object data?

Since Squid has received in full the range the client requested, is it
fully delivered to the client?
 How does the timing of that last client write relate to the timing of
Squids' last read from the server?

> 
> Playback using browser fails but curl requests(with same range)
> are somehow being cached.

What are the quick_abort_max and quick_abort_min directives set to in
your squid.conf? (or not set?)

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUPR28AAoJELJo5wb/XPRjc0EIAJ/eWt+FgB48Nas7bYuben7m
OvQ6BjyJGjSdLtWHZENMyvqYuUgpoOgCq0VQWC8NPHfWRc+Ukxpn3Lykv4GmJvMh
io9a1fDD4KcmSATv6GYJ0lhjpMVCPTlBRrfUaN8RFC42gACfrzVHnDn6JlM9IScn
8uYkR6t8AKp3LtBzSKtNvZ6RFjozL7C2XgB7zh6blNlif3R4T4eY9ztJ5JV2hzlH
pvRk7gRycFaa0+ai+yhKDZ2tCfcMIPdrz0+y5PJFsidmR+YjIEoTZgd2es+6dSvW
LNMgOwM/9dFownTCygvBTUX6N83fD8aHctOGOiIy4zPtPre+BwM4kGDkF9x85qs=
=MsIe
-----END PGP SIGNATURE-----


From satishthareja at gmail.com  Tue Oct 14 15:16:28 2014
From: satishthareja at gmail.com (Satish Thareja)
Date: Tue, 14 Oct 2014 20:46:28 +0530
Subject: [squid-users] Squid not accounting server response
In-Reply-To: <543D1DBC.8030607@treenet.co.nz>
References: <CAN5Kk2qZNbP9xR56J2wE2Z88edMBPwL1NiekZJOhz3datc0HpA@mail.gmail.com>
 <543D0EB6.30608@treenet.co.nz>
 <CAN5Kk2qWUxs2mXQxAfgpMpvWLE8Npb31b1n5PqHbYvKs3Gejpg@mail.gmail.com>
 <543D1DBC.8030607@treenet.co.nz>
Message-ID: <CAN5Kk2ozcSnoVGn5OiBr7_3mhUOLcVptRVqoGk91hZ6+KB9r7A@mail.gmail.com>

Hi Amos,

Transfer encoding is being used in the HTTp transaction.
The client range request and the content length were known form the headers.
Store log also confirms the content-length to be the same.

Out of 103262382 bytes sent from the server, the header size is 462
bytes, remaining is the object data.

The values for quick_abort_min and quick_abort_max are 512 KB and 2048
KB respectively.


The client gets the content as per its request.
I will let you know the timings of client last write and server last
read after checking the logs.

Thanks,
Satish


On Tue, Oct 14, 2014 at 6:27 PM, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> 103262382


From mirza.dedic at outlook.com  Tue Oct 14 16:01:31 2014
From: mirza.dedic at outlook.com (Mirza Dedic)
Date: Tue, 14 Oct 2014 09:01:31 -0700
Subject: [squid-users] some question about compiling squid with Cygwin
In-Reply-To: <543CD707.7020902@treenet.co.nz>
References: <2014101414172276501150@gmail.com>,
 <543CD707.7020902@treenet.co.nz>
Message-ID: <BAY181-W1780DC28D823D82E0187F6F0AD0@phx.gbl>

You should be able to grab SQUID 3.3.3 from Cygwin and compile it there without issues.
When working within cygwin get the "cygport" program as there is a specific squid.cygport install file that extracts the squid source, applies cygwin specific patches and compiles it for you.
If you are running this on a Win2003 box (x86) and no ipv6, you'll need a small patch that fixes the built in ACL that causes the executable to crash (https://bugs.freebsd.org/bugzilla/attachment.cgi?id=132625&action=diff).
I've been testing this the last few days to replace our outdated SQUID 2.7 on Windows and it looks promising so far... got it in PROD at a small site with about 20 people and its running fine.
> Date: Tue, 14 Oct 2014 20:55:51 +1300
> From: squid3 at treenet.co.nz
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] some question about compiling squid with Cygwin
> 
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> On 14/10/2014 7:17 p.m., lionxyes at gmail.com wrote:
> > Hello, everybody!
> > 
> > Recently i need run squid 3.x(x >= 1) on windows, and i found
> > related wiki from this url:
> > 
> > http://wiki.squid-cache.org/KnowledgeBase/Windows
> > 
> > From this i know there are two methods of running squid on
> > windows. 1. Compiling with Cygwin 2. Compiling with MinGW and squid
> > series 3 has major build issues on all Windows compiler systems.
> > And there is no solution of the issues about compiling with MinGw.
> > 
> > but then i readed that there have been unconfirmed reports from
> > some users of building up to squid-3.3 successfully and producing a
> > usable executable. Cygwin project provide version 3.3.3 packages.
> > 
> > I was excited. I tried it immediately, but i failed when i make it.
> > I had sucessfully compiled suqid-2.7 in the same environmnent.
> > 
> > so, are there people of compiling squid 3.3.3 with Cygwin
> > successfully. and can give me some help?
> 
> The download URLs referenced under
> <http://wiki.squid-cache.org/KnowledgeBase/Windows#Pre-Built_Binary_Packages>
> includes both binary and source packages which are being used to build.
> 
> Please check if you are using that src package rather than the
> upstream release tarball. There may be cygwin specific patches applied
> to it.
> 
> Also, if you need to build any features not included in the provided
> binary package then you may consider the feature untested possibly
> either not building or working. There may be some support from Cygwin
> regarding those situations, but the upstream target for resuming
> Windows support is 3.5 series.
> 
> Amos
> 
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2.0.22 (MingW32)
> 
> iQEcBAEBAgAGBQJUPNcGAAoJELJo5wb/XPRj75kIAOSp5KgTJVLNjiVqzQnwBKGP
> /w8thp52qhpLwoiTQQ8vouyuuElbwMihJ6SWH51xOiCFyCtG5n1iTenEb26xcCGf
> g49UaeehlKihnElkLmFUJmDsnHHD+tkjr6gfg5pAKwtVzMdU30bmpF2ga7TnBwSe
> KZvGcWSfOD6xCEysuYMokgRPYmWcZd4ySX+r32lrWW+c28Tyz1KTJlcuvpq8TAzN
> twyjubjLCRSh7s91eFnhf0/woY7dn2dr0jnflA3ZPPcIqgOqw4Y7wnA7GTVFLviC
> JnA8qVT5k4VK4xurUoYyOMfKmVIh3W+Q4M8gfDyjjcwr89d/xFf0C2pjTMEkcsA=
> =QROG
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141014/d860c7f5/attachment.htm>

From satishthareja at gmail.com  Tue Oct 14 16:12:20 2014
From: satishthareja at gmail.com (Satish Thareja)
Date: Tue, 14 Oct 2014 21:42:20 +0530
Subject: [squid-users] Squid not accounting server response
In-Reply-To: <CAN5Kk2ozcSnoVGn5OiBr7_3mhUOLcVptRVqoGk91hZ6+KB9r7A@mail.gmail.com>
References: <CAN5Kk2qZNbP9xR56J2wE2Z88edMBPwL1NiekZJOhz3datc0HpA@mail.gmail.com>
 <543D0EB6.30608@treenet.co.nz>
 <CAN5Kk2qWUxs2mXQxAfgpMpvWLE8Npb31b1n5PqHbYvKs3Gejpg@mail.gmail.com>
 <543D1DBC.8030607@treenet.co.nz>
 <CAN5Kk2ozcSnoVGn5OiBr7_3mhUOLcVptRVqoGk91hZ6+KB9r7A@mail.gmail.com>
Message-ID: <CAN5Kk2pnyUbJ_K8xOPYawLb-F+Jq6wXg8vye3m5dQ_GxpQBvjg@mail.gmail.com>

Amos,

The last client write and server read both happen at timestamp of
2014/10/08 21:58:17.
But client writes take place multiple time after the last server read
has been done, until the client range has been fulfilled.

Thanks,
Satish

On Tue, Oct 14, 2014 at 8:46 PM, Satish Thareja <satishthareja at gmail.com> wrote:
> Hi Amos,
>
> Transfer encoding is being used in the HTTp transaction.
> The client range request and the content length were known form the headers.
> Store log also confirms the content-length to be the same.
>
> Out of 103262382 bytes sent from the server, the header size is 462
> bytes, remaining is the object data.
>
> The values for quick_abort_min and quick_abort_max are 512 KB and 2048
> KB respectively.
>
>
> The client gets the content as per its request.
> I will let you know the timings of client last write and server last
> read after checking the logs.
>
> Thanks,
> Satish
>
>
> On Tue, Oct 14, 2014 at 6:27 PM, Amos Jeffries <squid3 at treenet.co.nz> wrote:
>> 103262382


From mattdepass at weacceptyou.com  Tue Oct 14 16:17:30 2014
From: mattdepass at weacceptyou.com (Matt de Pass)
Date: Tue, 14 Oct 2014 17:17:30 +0100
Subject: [squid-users] basic_ldap_auth and 389 Directory Server
	configuration help
Message-ID: <64EDE427-58F6-489A-A0EF-60E4F9312A52@weacceptyou.com>

Greetings,

I've been trying to configure LDAP authentication to our proxy (CentOS 6.5) but have been unable to establish a connection with basic_ldap_auth. Following various online guides, I've configured Squid with the following options and it appears to be working as expected, with the exception of authentication.

Squid Cache: Version 3.4.8
configure options:  '--program-prefix=' '--prefix=/usr' '--exec-prefix=/usr' '--bindir=/usr/bin' '--sbindir=/usr/sbin' '--sysconfdir=/etc' '--datadir=/usr/share' '--includedir=/usr/include' '--libdir=/usr/lib64' '--libexecdir=/usr/lib/squid' '--sharedstatedir=/var/lib' '--mandir=/usr/share/man' '--infodir=/usr/share/info' '--exec_prefix=/usr' '--libexecdir=/usr/lib64/squid' '--localstatedir=/var' '--datadir=/usr/share/squid' '--sysconfdir=/etc/squid' '--with-logdir=$(localstatedir)/log/squid' '--with-pidfile=$(localstatedir)/run/squid.pid' '--disable-dependency-tracking' '--enable-follow-x-forwarded-for' '--enable-auth' '--enable-auth-basic=DB,LDAP,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB,getpwnam' '--enable-auth-ntlm=smb_lm,fake' '--enable-auth-digest=file,LDAP,eDirectory' '--enable-auth-negotiate=kerberos,wrapper' '--enable-external-acl-helpers=wbinfo_group,kerberos_ldap_group,AD_group' '--enable-cache-digests' '--enable-cachemgr-hostname=localhost' '--enable-delay-pools' '--enable-epoll' '--enable-icap-client' '--enable-ident-lookups' '--enable-linux-netfilter' '--enable-removal-policies=heap,lru' '--enable-snmp' '--enable-storeio=aufs,diskd,ufs,rock' '--enable-wccpv2' '--enable-esi' '--enable-ssl' '--enable-ssl-crtd' '--enable-icmp' '--with-aio' '--with-default-user=squid' '--with-filedescriptors=16384' '--with-dl' '--with-openssl' '--with-pthreads' '--with-included-ltdl' '--disable-arch-native' 'CFLAGS=-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -m64 -mtune=generic' 'CXXFLAGS=-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -m64 -mtune=generic -fPIC' 'PKG_CONFIG_PATH=/usr/lib64/pkgconfig:/usr/share/pkgconfig' '--enable-ltdlconvenience' '--with-ldap=yes' '--enable-debug-cbdata' --enable-ltdl-convenience

We have a 389 Directory Server (CentOS 6.5) with a very basic configuration, which also appears to work correctly. From the proxy host, we can successfully query the directory.

ldapsearch -LLLx -h ldap01 -p 389 -D 'cn=directory manager' -w {password} -b "ou=People,dc=ourdomain,dc=com"

results in

dn: uid=myusername,ou=People,dc=ourdomain,dc=com
objectClass: top
objectClass: person
objectClass: posixAccount
objectClass: shadowAccount
objectClass: organizationalPerson
objectClass: inetorgperson
sn: Name
givenName: First
uid: myusername
uidNumber: 556
gidNumber: 660
cn: First Name
homeDirectory: /home/myusername
mail: myusername at ourdomain.com
loginShell: /bin/tcsh
gecos: First Name
shadowLastChange: -1
shadowMin: -1
shadowMax: -1
shadowWarning: 7
userPassword:: e1NTBOR42203QmNGayx2VjcydAycFdminZNQk5YlNqYhxRGc9PQ=
 =

However, testing connectivity using the authentication module and the following arguments appears to yield a hang necessitating a ctrl-c exit.

/usr/lib64/squid/basic_ldap_auth -v 3 -b ou=People,dc=ourdomain,dc=com -D 'cn=directory manager' -w {password} -h ldap01 -Z

attempting the same with digest_ldap_auth doesn?t cause a hang but instead displays the usage instructions.

/usr/lib64/squid/digest_ldap_auth -v 3 -b ou=People,dc=ourdomain,dc=com -D 'cn=directory manager' -w {password}  -h ldap01 -Z

Modifying the arguments as below causes a hang

/usr/lib64/squid/digest_ldap_auth -b ou=People,dc=ourdomain,dc=com -A "cn=userPassword" -F "%s=uid" -D 'cn=directory manager' -w {password}  -h ldap01 -Z

Can somebody point me in the direction of the logs to be looking at to determine what could be wrong, or suggest some troubleshooting steps. The access log on the directory server suggests the authentication module isn?t able to to communicate when ldapsearch can, so I suspect my arguments are incorrect. I?d appreciate any tips.

Thanks.





From mirza.dedic at outlook.com  Tue Oct 14 17:37:47 2014
From: mirza.dedic at outlook.com (Mirza Dedic)
Date: Tue, 14 Oct 2014 10:37:47 -0700
Subject: [squid-users] Best way to deny access to URLs in Squid 3.3.x?
Message-ID: <BAY181-W74A0085867394B1608E8A2F0AD0@phx.gbl>

Just curious, what are some of you doing in your Squid environment as far as URL filtering goes? It seems there are a few options out there.. squidguard... dansguardian.. plain block lists.
What is the best practice to implement some sort of block list into squid? I've found urlblacklist.com that has a pretty good broken down URL block list by category, what would be the best way to go.. use dansguardian with this list or set it up in squid.conf as an "acl dstdomain" and feed in the block list file without calling an external helper application?
Thanks. 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141014/869d9837/attachment.htm>

From rafael.akchurin at diladele.com  Tue Oct 14 17:46:11 2014
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Tue, 14 Oct 2014 17:46:11 +0000
Subject: [squid-users] Best way to deny access to URLs in Squid 3.3.x?
In-Reply-To: <BAY181-W74A0085867394B1608E8A2F0AD0@phx.gbl>
Message-ID: <D0632D4C.7F86%rafael.akchurin@diladele.com>

Hello Mirza,

I would humbly propose taking a look at any of the ICAP servers listed on http://www.squid-cache.org/Misc/icap.html.
BTW we are now preparing a native Windows ICAP build of qlproxy and would be glad if you could take a look.

Best regards,
Raf

From: Mirza Dedic <mirza.dedic at outlook.com<mailto:mirza.dedic at outlook.com>>
Date: Tuesday 14 October 2014 19:37
To: "squid-users at lists.squid-cache.org<mailto:squid-users at lists.squid-cache.org>" <squid-users at lists.squid-cache.org<mailto:squid-users at lists.squid-cache.org>>
Subject: [squid-users] Best way to deny access to URLs in Squid 3.3.x?

Just curious, what are some of you doing in your Squid environment as far as URL filtering goes? It seems there are a few options out there.. squidguard... dansguardian.. plain block lists.

What is the best practice to implement some sort of block list into squid? I've found urlblacklist.com that has a pretty good broken down URL block list by category, what would be the best way to go.. use dansguardian with this list or set it up in squid.conf as an "acl dstdomain" and feed in the block list file without calling an external helper application?

Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141014/8ab780df/attachment.htm>

From tfransosi at gmail.com  Tue Oct 14 18:14:02 2014
From: tfransosi at gmail.com (Thiago Farina)
Date: Tue, 14 Oct 2014 15:14:02 -0300
Subject: [squid-users] cache-control
Message-ID: <CACnwZYcbeHVDdP5EhR0hCqfMUw8SM375HPkAty3V1Ar=d+WAPw@mail.gmail.com>

Hi squiders,

We want to move the following Go code into squid, as we already have
squid in front of our Go server.

The code is:

func makeResourceHandler() func(http.ResponseWriter, *http.Request) {
  fileServer := http.FileServer(http.Dir("./"))
  return func(w http.ResponseWriter, r *http.Request) {
  w.Header().Add("Cache-Control", string(300))
    fileServer.ServeHTTP(w, r)
  }
}

and in the main() function we have:

http.HandleFunc("/res/", autogzip.HandleFunc(makeResourceHandler()))

The only thing close to this I found was 'header_access Cache-Control
allow all'.

What is the proper way to do this?

Thanks all (for reading) in advance, for any reply.

Any hint/point is appreciate.

Best regards,

-- 
Thiago Farina


From squid3 at treenet.co.nz  Tue Oct 14 18:34:25 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 15 Oct 2014 07:34:25 +1300
Subject: [squid-users] cache-control
In-Reply-To: <CACnwZYcbeHVDdP5EhR0hCqfMUw8SM375HPkAty3V1Ar=d+WAPw@mail.gmail.com>
References: <CACnwZYcbeHVDdP5EhR0hCqfMUw8SM375HPkAty3V1Ar=d+WAPw@mail.gmail.com>
Message-ID: <543D6CB1.9010907@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 15/10/2014 7:14 a.m., Thiago Farina wrote:
> Hi squiders,
> 
> We want to move the following Go code into squid, as we already
> have squid in front of our Go server.
> 
> The code is:
> 
> func makeResourceHandler() func(http.ResponseWriter, *http.Request)
> { fileServer := http.FileServer(http.Dir("./")) return func(w
> http.ResponseWriter, r *http.Request) { 
> w.Header().Add("Cache-Control", string(300)) 
> fileServer.ServeHTTP(w, r) } }
> 
> and in the main() function we have:
> 
> http.HandleFunc("/res/",
> autogzip.HandleFunc(makeResourceHandler()))
> 
> The only thing close to this I found was 'header_access
> Cache-Control allow all'.
> 
> What is the proper way to do this?

Perhapse you could explain what the code does?

If I'm reading that right these are web server actions performed on
the origin resource (adding resource lifetime control header, and gzip
content encoding).

Squid however is a proxy which operates *using* the message
representation and headers which are produced by that code.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUPWywAAoJELJo5wb/XPRjSRUIAOQN9/crBxFSApRDjDvKKqsH
0+4Bp9ty7rT854wWXCA2bKYyxnyXm3oTQ/toNji4tP930Bx8OWufqrVEQ8vVI0lw
MAqD7odM3GhoopKfAlBoPeSY/z9cdiA4aAX+t653iZ/VGxktWBbpD4bXpUiQ0mGF
eh+UpJ6wFyhFvim3UFSvkPgnoE8Wj41LRZsb5WaHEQe7boj1njrmGpkWBIGIHL4m
mkpVLol4ZFf7uXP2BN6xSu400yUv2Xtw8SQv7ydOeflKThipKzv0UaYwc7T+IOzx
ymYMevumO9CwfMb5FJVnwmAgQKKYpQGQucJXuYLq239E2j4KJ6v56LNRU9bIlbQ=
=C8+D
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Tue Oct 14 18:34:49 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 15 Oct 2014 07:34:49 +1300
Subject: [squid-users] some question about compiling squid with Cygwin
In-Reply-To: <BAY181-W1780DC28D823D82E0187F6F0AD0@phx.gbl>
References: <2014101414172276501150@gmail.com>,
 <543CD707.7020902@treenet.co.nz>
 <BAY181-W1780DC28D823D82E0187F6F0AD0@phx.gbl>
Message-ID: <543D6CC9.60707@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 15/10/2014 5:01 a.m., Mirza Dedic wrote:
> You should be able to grab SQUID 3.3.3 from Cygwin and compile it
> there without issues. When working within cygwin get the "cygport"
> program as there is a specific squid.cygport install file that
> extracts the squid source, applies cygwin specific patches and
> compiles it for you. If you are running this on a Win2003 box (x86)
> and no ipv6, you'll need a small patch that fixes the built in ACL
> that causes the executable to crash
> (https://bugs.freebsd.org/bugzilla/attachment.cgi?id=132625&action=diff).
>
> 
I've been testing this the last few days to replace our outdated SQUID
2.7 on Windows and it looks promising so far... got it in PROD at a
small site with about 20 people and its running fine.

Would you mind putting together the basic sequence of commands to do
that install process for the wiki page?

(just the basic install, assuming no patching required).

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUPWzJAAoJELJo5wb/XPRj2agH/iveovFMfJ8noNLvPMEEgdgk
7esTNI3GpuaqiNgYaNQaSA9if40sZqmIWMWmIP+jkjUrAUe1G/eTCnz0WeeAEHXT
gpi0aQo/jxwRZzNeOcJwYKXtyLqy/301vD1xFPfu/TFxRNxuwER1CGO9LPgdiLsu
vNrrT29uJUhnw1Y2rdrs9jVSfi/wdIGGLI8H6xeyr3BnEpTIeCdPekpP1WErW5O9
8G4jPBmSYWCp7CfC7rZ89qdYpi7XEWU3wyQlOxHWx6DnzTRaoOySEYzkXYNLsUqk
Xw49K7Cyp63mtP4B5iQVvtL50b8IA5RI05YmyZdpZwgSBBsNHHYBXrzxTvRzpGA=
=VjaZ
-----END PGP SIGNATURE-----


From tfransosi at gmail.com  Tue Oct 14 18:38:44 2014
From: tfransosi at gmail.com (Thiago Farina)
Date: Tue, 14 Oct 2014 15:38:44 -0300
Subject: [squid-users] cache-control
In-Reply-To: <543D6CB1.9010907@treenet.co.nz>
References: <CACnwZYcbeHVDdP5EhR0hCqfMUw8SM375HPkAty3V1Ar=d+WAPw@mail.gmail.com>
 <543D6CB1.9010907@treenet.co.nz>
Message-ID: <CACnwZYecOMeX+2KeP3gPKytae2XVQRkPbcRoxgv=grPY7sOxwQ@mail.gmail.com>

On Tue, Oct 14, 2014 at 3:34 PM, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 15/10/2014 7:14 a.m., Thiago Farina wrote:
>> Hi squiders,
>>
>> We want to move the following Go code into squid, as we already
>> have squid in front of our Go server.
>>
>> The code is:
>>
>> func makeResourceHandler() func(http.ResponseWriter, *http.Request)
>> { fileServer := http.FileServer(http.Dir("./")) return func(w
>> http.ResponseWriter, r *http.Request) {
>> w.Header().Add("Cache-Control", string(300))
>> fileServer.ServeHTTP(w, r) } }
>>
>> and in the main() function we have:
>>
>> http.HandleFunc("/res/",
>> autogzip.HandleFunc(makeResourceHandler()))
>>
>> The only thing close to this I found was 'header_access
>> Cache-Control allow all'.
>>
>> What is the proper way to do this?
>
> Perhapse you could explain what the code does?
>
> If I'm reading that right these are web server actions performed on
> the origin resource (adding resource lifetime control header, and gzip
> content encoding).
>
I think that is true. This res/ directory contains only css, html and js files.

-- 
Thiago Farina


From marcus.kool at urlfilterdb.com  Tue Oct 14 18:43:57 2014
From: marcus.kool at urlfilterdb.com (Marcus Kool)
Date: Tue, 14 Oct 2014 15:43:57 -0300
Subject: [squid-users] Best way to deny access to URLs in Squid 3.3.x?
In-Reply-To: <BAY181-W74A0085867394B1608E8A2F0AD0@phx.gbl>
References: <BAY181-W74A0085867394B1608E8A2F0AD0@phx.gbl>
Message-ID: <543D6EED.2090806@urlfilterdb.com>

With every set of requirements, there is an other "best way".

To selectively block websites and also block SSH tunnels, VPNs, proxies and remote software (some of which are detected on the fly) you can also use ufdbGuard.
Your mileage varies with which URL database you use.

Marcus


On 10/14/2014 02:37 PM, Mirza Dedic wrote:
> Just curious, what are some of you doing in your Squid environment as far as URL filtering goes? It seems there are a few options out there.. squidguard... dansguardian.. plain block lists.
>
> What is the best practice to implement some sort of block list into squid? I've found urlblacklist.com that has a pretty good broken down URL block list by category, what would be the best way to go..
> use dansguardian with this list or set it up in squid.conf as an "acl dstdomain" and feed in the block list file without calling an external helper application?
>
> Thanks.
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


From squid3 at treenet.co.nz  Tue Oct 14 18:53:03 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 15 Oct 2014 07:53:03 +1300
Subject: [squid-users] basic_ldap_auth and 389 Directory Server
 configuration help
In-Reply-To: <64EDE427-58F6-489A-A0EF-60E4F9312A52@weacceptyou.com>
References: <64EDE427-58F6-489A-A0EF-60E4F9312A52@weacceptyou.com>
Message-ID: <543D710F.5030504@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Please add -d to your parameters. That will output debug info into
cache.log for the lookups that may help you narrow down the problem.

For the record the helper manual is here:
http://www.squid-cache.org/Versions/v3/3.4/manuals/basic_ldap_auth.html

I suspect (just a guess) that the issue is probably the whitespace in
the -D parameters value.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUPXEPAAoJELJo5wb/XPRjE8cIAIoAPJmMmRhKD4n3DaAeUe30
G+lvjtjlJEdVeRFGpi+Dl+cZHTmaXnpXSGelCHDzJ1Pou1hjz5KVKYnVqQeLX2C5
Acbi6O+br+UYkN54Mp+adIBEwZt8VzmazFKM8hKwd1ScoMUn5gOe4GqOT+pZlSA6
vuQcBLV073SsIx/iQ8k+8T0H4z1uWsfnCHmXg5Bup+EtCTi2GhVg6U0Mnu/kMj7O
4+0kD1wjWsf2f2LTldyC08Mn2FsDiChAq8zX9jk+BPHMqqsFFzxwAdv1XHl3Pw1F
hRuLhnbE4V4m9lcqeBa7UkmcUjjXUcpXhaybxlEUjJeTI/tvFaO8sD0OslWbXDo=
=nYcA
-----END PGP SIGNATURE-----


From mcsnv96 at afo.net  Tue Oct 14 19:03:32 2014
From: mcsnv96 at afo.net (Mike)
Date: Tue, 14 Oct 2014 14:03:32 -0500
Subject: [squid-users] Best way to deny access to URLs in Squid 3.3.x?
In-Reply-To: <BAY181-W74A0085867394B1608E8A2F0AD0@phx.gbl>
References: <BAY181-W74A0085867394B1608E8A2F0AD0@phx.gbl>
Message-ID: <543D7384.8080208@afo.net>

On 10/14/2014 12:37 PM, Mirza Dedic wrote:
> Just curious, what are some of you doing in your Squid environment as 
> far as URL filtering goes? It seems there are a few options out 
> there.. squidguard... dansguardian.. plain block lists.
>
> What is the best practice to implement some sort of block list into 
> squid? I've found urlblacklist.com that has a pretty good broken down 
> URL block list by category, what would be the best way to go.. use 
> dansguardian with this list or set it up in squid.conf as an "acl 
> dstdomain" and feed in the block list file without calling an external 
> helper application?
>
> Thanks.
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

We have used dansguardian before, but there is a newer updated "fork" by 
some of the original crew called "e2guardian" that can also handle some 
SSL urls via blacklisting (as long as squid is also setup with ssl-bump 
in 3.4.x).
Otherwise within squid itself, the dstdomain and regex_dstdomain acls 
are an option, but that does not provide much for filtering content of 
the websites themselves.


Mike
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141014/48f31c0a/attachment.htm>

From mattdepass at weacceptyou.com  Tue Oct 14 19:23:24 2014
From: mattdepass at weacceptyou.com (matt de pass)
Date: Tue, 14 Oct 2014 20:23:24 +0100
Subject: [squid-users] basic_ldap_auth and 389 Directory Server
	configuration help
In-Reply-To: <543D710F.5030504@treenet.co.nz>
References: <64EDE427-58F6-489A-A0EF-60E4F9312A52@weacceptyou.com>
 <543D710F.5030504@treenet.co.nz>
Message-ID: <8f938c43940f95c19ec11750d37884@ip-10-0-3-57>

An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141014/e4205aa8/attachment.htm>

From mirza.dedic at outlook.com  Wed Oct 15 00:05:59 2014
From: mirza.dedic at outlook.com (Mirza Dedic)
Date: Tue, 14 Oct 2014 17:05:59 -0700
Subject: [squid-users] http_access deny for dstdomain acl not denying access
 to url.. what am I doing wrong?
Message-ID: <BAY181-W19CC619B2AFE9F23C165CF0AA0@phx.gbl>

Trying to understand what I am doing wrong with my ACLs (yes I've read the ACL guide on squid site.. but still confused).. My client is 172.16.10.101, trying to block access to facebook (and other dstdomain file lists), but it is not working from the client I can still access fb.
Is this because I have this rule below..?
acl localnet src 172.16.0.0/12http_access allow localnet
Instead of denying everything access and manually maintaining rules, I want to allow http/https access for everything except explicitly defined ACLs (in this case the facebook acl as a test).
I've tried to set debugging to debug_options ALL,1 33,2 to see more info on ACLs (read on some site this is the debug flags to set) but I don't see any ACL details in my access.log file.
my squid.conf (for SQUID 3.3.3) file is below..
acl localnet src 10.0.0.0/8     # RFC1918 possible internal networkacl localnet src 172.16.0.0/12  # RFC1918 possible internal networkacl localnet src 192.168.0.0/16 # RFC1918 possible internal network
acl SSL_ports port 443 8180 8443 563 1494 2598 8531acl Safe_ports port 80						# httpacl Safe_ports port 81          			# http for Pacific Brokerageacl Safe_ports port 21						# ftpacl Safe_ports port 443 563					# httpacl Safe_ports port 70						# gopheracl Safe_ports port 210						# waisacl Safe_ports port 280						# http-mgmtacl Safe_ports port 488						# gss-httpacl Safe_ports port 591						# filemakeracl Safe_ports port 777						# multiling httpacl Safe_ports port 8080 8081 8082 8088 8180acl Safe_ports port 3128        			# Squid http serveracl Safe_ports port 1494 2598   			# ICA - Citrixacl Safe_ports port 7000 8000   			# Oracleacl Safe_ports port 9000        			# Oracleacl Safe_ports port 8530					# WSUSacl Safe_ports port 55905					# WSUSacl Safe_ports port 1025-65535				# unregistered portsacl CONNECT method CONNECT
http_access allow localhost managerhttp_access deny managerhttp_access deny !Safe_portshttp_access deny CONNECT !SSL_portshttp_access deny to_localhost
acl ads dstdomain "/etc/squid/blacklists/ads/domains"acl adult dstdomain "/etc/squid/blacklists/adult/domains"acl gambling dstdomain "/etc/squid/blacklists/gambling/domains"acl fb dstdomain .facebook.com
http_access allow localnethttp_access allow localhost
http_access deny ads adult gambling fb
http_access deny all
http_port 8080dns_nameservers 172.16.11.3 172.16.11.2 172.16.11.1visible_hostname www-proxy
hierarchy_stoplist cgi-bin ?
logformat oppy %ts.%03tu %6tr %>a %>A %Ss/%03>Hs %<st %rm %ru %[un %Sh/%<a %mtaccess_log daemon:/var/log/squid/access.log oppycache_store_log daemon:/var/log/squid/store.logcache_log /var/log/squid/cache.logcache_mem 64 MBlogfile_rotate 4debug_options ALL,1# ACL Debug Options# debug_options ALL,1 33,2# debug_options ALL,1 33,2 28,9coredump_dir /var/log/squid/squid
shutdown_lifetime 3 secondsdns_v4_first onretry_on_error onforward_max_tries 25forward_timeout 30 secondsconnect_timeout 30 secondsread_timeout 30 secondsrequest_timeout 30 secondspersistent_request_timeout 1 minute
cache_dir ufs /var/cache/squid 100 16 256cache_mgr ittechs at domain.com
snmp_port 0icp_port 0htcp_port 0
refresh_pattern ^ftp:		1440	20%	10080refresh_pattern ^gopher:	1440	0%	1440refresh_pattern -i (/cgi-bin/|\?) 0	0%	0refresh_pattern .		0	20%	4320 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141014/74072102/attachment.htm>

From squid3 at treenet.co.nz  Wed Oct 15 04:35:07 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 15 Oct 2014 17:35:07 +1300
Subject: [squid-users] http_access deny for dstdomain acl not denying
 access to url.. what am I doing wrong?
In-Reply-To: <BAY181-W19CC619B2AFE9F23C165CF0AA0@phx.gbl>
References: <BAY181-W19CC619B2AFE9F23C165CF0AA0@phx.gbl>
Message-ID: <543DF97B.3040108@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi Mirza,
 take a read through these FAQ
http://wiki.squid-cache.org/SquidFaq/OrderIsImportant


PS. all your posts seem to be getting badly mangled by wrapping isues.
Can you please check your mailer is sending plain text, in UTF-8 or
ASCII and applying 72-80 character wrapping on the text as it sends.

Cheers
Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUPfl7AAoJELJo5wb/XPRjO6AH/1bf2vtN6uWB/6KlUHzfCaEY
5EigJGgsf4YXg86ByfPeGQFGjuKRhRrxodFB//0oOuO7nk0V1DYwJdEspP4JRh7i
9P60Faf/byhpU3UFVXa5H+DH3wGHLoP9Nqsd0k8jr99qy0w4wKS1NWimL/AJL4rb
TLqzpaXFSRQRzXqPCvUGIxKavY/cBpv9ZPQVhwexUuj3h3kIzy5jjLp/seS4kTyq
L74Ozo0bL9EVwDEGK95dIZrwQlAnbqyqBxd1rIQQ6X21mdxkjXsGmHzky/Ng1/oM
iyrC4Kl+aXH+9BTTWiTxbUz3q+dFL3C7durWs6sgpLLTNSDOXHpkDe2tw/NLffE=
=2Jtm
-----END PGP SIGNATURE-----


From Walter.H at mathemainzel.info  Wed Oct 15 05:56:06 2014
From: Walter.H at mathemainzel.info (Walter H.)
Date: Wed, 15 Oct 2014 07:56:06 +0200
Subject: [squid-users] http_access deny for dstdomain acl not denying
 access to url.. what am I doing wrong?
In-Reply-To: <BAY181-W19CC619B2AFE9F23C165CF0AA0@phx.gbl>
References: <BAY181-W19CC619B2AFE9F23C165CF0AA0@phx.gbl>
Message-ID: <543E0C76.8090906@mathemainzel.info>

acl allow_urls url_regex -i "/etc/squid/allowurls-regex-acl.squid" (a)
acl block_urls url_regex -i "/etc/squid/blockurls-regex-acl.squid" (b)
acl allow_urlpaths urlpath_regex -i 
"/etc/squid/allowurlpaths-regex-acl.squid" (c)
acl block_urlpaths urlpath_regex -i 
"/etc/squid/blockurlpaths-regex-acl.squid" (d)
acl allow_domains_list dstdomain 
"/etc/squid/allowdomains-list-acl.squid" (e)
acl block_domains_list dstdomain 
"/etc/squid/blockdomains-list-acl.squid" (f)
acl block_domains_listex dstdomain 
"/etc/squid/blockdomains-listex-acl.squid" (g)
acl allow_domains_regex dstdom_regex -i 
"/etc/squid/allowdomains-regex-acl.squid" (h)
acl block_domains_regex dstdom_regex -i 
"/etc/squid/blockdomains-regex-acl.squid" (i)
acl block_hosts_list dst "/etc/squid/blockhosts-list-acl.squid" (j)
deny_info ERR_URL_BLOCKED block_urls
deny_info ERR_URL_BLOCKED block_urlpaths
deny_info ERR_DOMAIN_BLOCKED block_domains_list
deny_info ERR_DOMAIN_BLOCKED block_domains_listex
deny_info ERR_DOMAIN_BLOCKED block_domains_regex
deny_info ERR_HOST_BLOCKED block_hosts_list
http_access allow allow_urls
http_access allow allow_urlpaths
http_access allow allow_domains_list
http_access allow allow_domains_regex
http_access deny block_urls
http_access deny block_urlpaths
http_access deny block_domains_list
http_access deny block_domains_listex
http_access deny block_domains_regex
http_access deny block_hosts_list

(a), (b) look like this: 
"^http:\/\/websupport\.wdc\.com\/sfclickcount.asp\?"
(c), (d) look like this: "^\/cgi-bin\/"
(e), (f), (g) look like this: "www.googletagmanager.com"
(h), (i) look like this: "^banner(s)?[0-9]*\."
(j) looks like this: "85.17.30.143"

(g) comes from a source like: e.g. http://winhelp2002.mvps.org/hosts.htm

On 15.10.2014 02:05, Mirza Dedic wrote:
> Trying to understand what I am doing wrong with my ACLs (yes I've read 
> the ACL guide on squid site.. but still confused).. My client is 
> 172.16.10.101, trying to block access to facebook (and other dstdomain 
> file lists), but it is not working from the client I can still access fb.
>
> Is this because I have this rule below..?
>
> acl localnet src 172.16.0.0/12
> http_access allow localnet
>
yes

> Instead of denying everything access and manually maintaining rules, I 
> want to allow http/https access for everything except explicitly 
> defined ACLs (in this case the facebook acl as a test).
>
> I've tried to set debugging to debug_options ALL,1 33,2 to see more 
> info on ACLs (read on some site this is the debug flags to set) but I 
> don't see any ACL details in my access.log file.
>
> my squid.conf (for SQUID 3.3.3) file is below..
>
> acl localnet src 10.0.0.0/8     # RFC1918 possible internal network
> acl localnet src 172.16.0.0/12  # RFC1918 possible internal network
> acl localnet src 192.168.0.0/16 # RFC1918 possible internal network
>
> acl SSL_ports port 443 8180 8443 563 1494 2598 8531
> acl Safe_ports port 80# http
> acl Safe_ports port 81 # http for Pacific Brokerage
> acl Safe_ports port 21# ftp
> acl Safe_ports port 443 563# http
> acl Safe_ports port 70# gopher
> acl Safe_ports port 210# wais
> acl Safe_ports port 280# http-mgmt
> acl Safe_ports port 488# gss-http
> acl Safe_ports port 591# filemaker
> acl Safe_ports port 777# multiling http
> acl Safe_ports port 8080 8081 8082 8088 8180
> acl Safe_ports port 3128 # Squid http server
> acl Safe_ports port 1494 2598 # ICA - Citrix
> acl Safe_ports port 7000 8000 # Oracle
> acl Safe_ports port 9000 # Oracle
> acl Safe_ports port 8530# WSUS
> acl Safe_ports port 55905# WSUS
> acl Safe_ports port 1025-65535# unregistered ports
> acl CONNECT method CONNECT
>
> http_access allow localhost manager
> http_access deny manager
> http_access deny !Safe_ports
> http_access deny CONNECT !SSL_ports
> http_access deny to_localhost
>
> *acl ads dstdomain "/etc/squid/blacklists/ads/domains"*
> *acl adult dstdomain "/etc/squid/blacklists/adult/domains"*
> *acl gambling dstdomain "/etc/squid/blacklists/gambling/domains"*
> *acl fb dstdomain .facebook.com*
>
> http_access allow localnet
> http_access allow localhost
>
> *http_access deny ads adult gambling fb*
>
> http_access deny all
>
> http_port 8080
> dns_nameservers 172.16.11.3 172.16.11.2 172.16.11.1
> visible_hostname www-proxy
>
> hierarchy_stoplist cgi-bin ?
>
> logformat oppy %ts.%03tu %6tr %>a %>A %Ss/%03>Hs %<st %rm %ru %[un 
> %Sh/%<a %mt
> access_log daemon:/var/log/squid/access.log oppy
> cache_store_log daemon:/var/log/squid/store.log
> cache_log /var/log/squid/cache.log
> cache_mem 64 MB
> logfile_rotate 4
> debug_options ALL,1
> # ACL Debug Options
> # debug_options ALL,1 33,2
> # debug_options ALL,1 33,2 28,9
> coredump_dir /var/log/squid/squid
>
> shutdown_lifetime 3 seconds
> dns_v4_first on
> retry_on_error on
> forward_max_tries 25
> forward_timeout 30 seconds
> connect_timeout 30 seconds
> read_timeout 30 seconds
> request_timeout 30 seconds
> persistent_request_timeout 1 minute
>
> cache_dir ufs /var/cache/squid 100 16 256
> cache_mgr ittechs at domain.com
>
> snmp_port 0
> icp_port 0
> htcp_port 0
>
> refresh_pattern ^ftp:144020%10080
> refresh_pattern ^gopher:14400%1440
> refresh_pattern -i (/cgi-bin/|\?) 00%0
> refresh_pattern .020%4320
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141015/be85a5a9/attachment.htm>

From squid3 at treenet.co.nz  Wed Oct 15 06:13:04 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 15 Oct 2014 19:13:04 +1300
Subject: [squid-users] http_access deny for dstdomain acl not denying
 access to url.. what am I doing wrong?
In-Reply-To: <543E0C76.8090906@mathemainzel.info>
References: <BAY181-W19CC619B2AFE9F23C165CF0AA0@phx.gbl>
 <543E0C76.8090906@mathemainzel.info>
Message-ID: <543E1070.4050100@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1


And the key difference in these configs is not the ACL contents, but
the ordering in which they are matched.

Mirzas' config starts by telling Squid everything on the LAN/localnet
is allowed. Ok, fine, Squid will do that.

Walters' config will tell Squid a limited set of things to allow, then
some things to deny, then implicitly allow everything else [1][2].
Whichever rule actually matches the FB requests will be applied by
Squid, with a limited set of initial allow/bypass the likelihood that
a deny following will match is higher.


[1] this is not a great situation, because any remote attack which can
figure out a way past your regex ACLs can use the proxy for whatever
they please[2].

[2] I hope you just omitted the localnet ACL checks which should
follow the ones you showed.

Amos



On 15/10/2014 6:56 p.m., Walter H. wrote:
> acl allow_urls url_regex -i "/etc/squid/allowurls-regex-acl.squid"
> (a) acl block_urls url_regex -i
> "/etc/squid/blockurls-regex-acl.squid" (b) acl allow_urlpaths
> urlpath_regex -i "/etc/squid/allowurlpaths-regex-acl.squid" (c) acl
> block_urlpaths urlpath_regex -i 
> "/etc/squid/blockurlpaths-regex-acl.squid" (d) acl
> allow_domains_list dstdomain 
> "/etc/squid/allowdomains-list-acl.squid" (e) acl block_domains_list
> dstdomain "/etc/squid/blockdomains-list-acl.squid" (f) acl
> block_domains_listex dstdomain 
> "/etc/squid/blockdomains-listex-acl.squid" (g) acl
> allow_domains_regex dstdom_regex -i 
> "/etc/squid/allowdomains-regex-acl.squid" (h) acl
> block_domains_regex dstdom_regex -i 
> "/etc/squid/blockdomains-regex-acl.squid" (i) acl block_hosts_list
> dst "/etc/squid/blockhosts-list-acl.squid" (j) deny_info
> ERR_URL_BLOCKED block_urls deny_info ERR_URL_BLOCKED
> block_urlpaths deny_info ERR_DOMAIN_BLOCKED block_domains_list 
> deny_info ERR_DOMAIN_BLOCKED block_domains_listex deny_info
> ERR_DOMAIN_BLOCKED block_domains_regex deny_info ERR_HOST_BLOCKED
> block_hosts_list http_access allow allow_urls http_access allow
> allow_urlpaths http_access allow allow_domains_list http_access
> allow allow_domains_regex http_access deny block_urls http_access
> deny block_urlpaths http_access deny block_domains_list http_access
> deny block_domains_listex http_access deny block_domains_regex 
> http_access deny block_hosts_list
> 
> (a), (b) look like this: 
> "^http:\/\/websupport\.wdc\.com\/sfclickcount.asp\?" (c), (d) look
> like this: "^\/cgi-bin\/" (e), (f), (g) look like this:
> "www.googletagmanager.com" (h), (i) look like this:
> "^banner(s)?[0-9]*\." (j) looks like this: "85.17.30.143"
> 
> (g) comes from a source like: e.g.
> http://winhelp2002.mvps.org/hosts.htm
> 
> On 15.10.2014 02:05, Mirza Dedic wrote:
>> Trying to understand what I am doing wrong with my ACLs (yes I've
>> read the ACL guide on squid site.. but still confused).. My
>> client is 172.16.10.101, trying to block access to facebook (and
>> other dstdomain file lists), but it is not working from the
>> client I can still access fb.
>> 
>> Is this because I have this rule below..?
>> 
>> acl localnet src 172.16.0.0/12 http_access allow localnet
>> 
> yes
> 
>> Instead of denying everything access and manually maintaining
>> rules, I want to allow http/https access for everything except
>> explicitly defined ACLs (in this case the facebook acl as a
>> test).
>> 
>> I've tried to set debugging to debug_options ALL,1 33,2 to see
>> more info on ACLs (read on some site this is the debug flags to
>> set) but I don't see any ACL details in my access.log file.
>> 
>> my squid.conf (for SQUID 3.3.3) file is below..
>> 
>> acl localnet src 10.0.0.0/8     # RFC1918 possible internal
>> network acl localnet src 172.16.0.0/12  # RFC1918 possible
>> internal network acl localnet src 192.168.0.0/16 # RFC1918
>> possible internal network
>> 
>> acl SSL_ports port 443 8180 8443 563 1494 2598 8531 acl
>> Safe_ports port 80# http acl Safe_ports port 81 # http for
>> Pacific Brokerage acl Safe_ports port 21# ftp acl Safe_ports port
>> 443 563# http acl Safe_ports port 70# gopher acl Safe_ports port
>> 210# wais acl Safe_ports port 280# http-mgmt acl Safe_ports port
>> 488# gss-http acl Safe_ports port 591# filemaker acl Safe_ports
>> port 777# multiling http acl Safe_ports port 8080 8081 8082 8088
>> 8180 acl Safe_ports port 3128 # Squid http server acl Safe_ports
>> port 1494 2598 # ICA - Citrix acl Safe_ports port 7000 8000 #
>> Oracle acl Safe_ports port 9000 # Oracle acl Safe_ports port
>> 8530# WSUS acl Safe_ports port 55905# WSUS acl Safe_ports port
>> 1025-65535# unregistered ports acl CONNECT method CONNECT
>> 
>> http_access allow localhost manager http_access deny manager 
>> http_access deny !Safe_ports http_access deny CONNECT !SSL_ports 
>> http_access deny to_localhost
>> 
>> *acl ads dstdomain "/etc/squid/blacklists/ads/domains"* *acl
>> adult dstdomain "/etc/squid/blacklists/adult/domains"* *acl
>> gambling dstdomain "/etc/squid/blacklists/gambling/domains"* *acl
>> fb dstdomain .facebook.com*
>> 
>> http_access allow localnet http_access allow localhost
>> 
>> *http_access deny ads adult gambling fb*
>> 
>> http_access deny all
>> 
>> http_port 8080 dns_nameservers 172.16.11.3 172.16.11.2
>> 172.16.11.1 visible_hostname www-proxy
>> 
>> hierarchy_stoplist cgi-bin ?
>> 
>> logformat oppy %ts.%03tu %6tr %>a %>A %Ss/%03>Hs %<st %rm %ru
>> %[un %Sh/%<a %mt access_log daemon:/var/log/squid/access.log
>> oppy cache_store_log daemon:/var/log/squid/store.log cache_log
>> /var/log/squid/cache.log cache_mem 64 MB logfile_rotate 4 
>> debug_options ALL,1 # ACL Debug Options # debug_options ALL,1
>> 33,2 # debug_options ALL,1 33,2 28,9 coredump_dir
>> /var/log/squid/squid
>> 
>> shutdown_lifetime 3 seconds dns_v4_first on retry_on_error on 
>> forward_max_tries 25 forward_timeout 30 seconds connect_timeout
>> 30 seconds read_timeout 30 seconds request_timeout 30 seconds 
>> persistent_request_timeout 1 minute
>> 
>> cache_dir ufs /var/cache/squid 100 16 256 cache_mgr
>> ittechs at domain.com
>> 
>> snmp_port 0 icp_port 0 htcp_port 0
>> 
>> refresh_pattern ^ftp:144020%10080 refresh_pattern
>> ^gopher:14400%1440 refresh_pattern -i (/cgi-bin/|\?) 00%0 
>> refresh_pattern .020%4320
>> 
>> 
>> _______________________________________________ squid-users
>> mailing list squid-users at lists.squid-cache.org 
>> http://lists.squid-cache.org/listinfo/squid-users
> 
> 
> 
> 
> _______________________________________________ squid-users mailing
> list squid-users at lists.squid-cache.org 
> http://lists.squid-cache.org/listinfo/squid-users
> 

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUPhBwAAoJELJo5wb/XPRjFLsH/3EJAnFmG1ClS+eK4kxViyBK
XzDLC3baYIGThunpiTMnX/rrrG9pi3HAouikeXbnfl+iGIovOrKsHA7oxZUXJbdG
Fs9sdfN8FDbQK8fJePR0TzP0EtbwNWn86LcP3CDt2U9C7yldORtu8jCR72hyvO6H
S1FWh3G6NUzuFLU+7UIxWVBUwMNCkT8knhXpfZ0G8gELFyXgoIJKoZXJob73nV0+
xfLQqJ4alYSvNYmAIdmS+zozgCS/vwDexk9uMJgywE15axSGUKPOgHXpxiTuI3hu
oEDfHW2I7VrGIFd8963LB5sR50HJoZFSkDUkthAFp2Gj+sjsj7+gv1B/DKz79W8=
=2aeX
-----END PGP SIGNATURE-----


From Walter.H at mathemainzel.info  Wed Oct 15 06:46:44 2014
From: Walter.H at mathemainzel.info (Walter H.)
Date: Wed, 15 Oct 2014 08:46:44 +0200
Subject: [squid-users] http_access deny for dstdomain acl not denying
 access to url.. what am I doing wrong?
In-Reply-To: <543E1070.4050100@treenet.co.nz>
References: <BAY181-W19CC619B2AFE9F23C165CF0AA0@phx.gbl>
 <543E0C76.8090906@mathemainzel.info> <543E1070.4050100@treenet.co.nz>
Message-ID: <543E1854.5060906@mathemainzel.info>

On 15.10.2014 08:13, Amos Jeffries wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
>
> And the key difference in these configs is not the ACL contents, but
> the ordering in which they are matched.
>
> Mirzas' config starts by telling Squid everything on the LAN/localnet
> is allowed. Ok, fine, Squid will do that.
>
> Walters' config will tell Squid a limited set of things to allow, then
> some things to deny, then implicitly allow everything else [1][2].
> Whichever rule actually matches the FB requests will be applied by
> Squid, with a limited set of initial allow/bypass the likelihood that
> a deny following will match is higher.
>
>
> [1] this is not a great situation, because any remote attack which can
> figure out a way past your regex ACLs can use the proxy for whatever
> they please[2].
>
> [2] I hope you just omitted the localnet ACL checks which should
> follow the ones you showed.
>
> Amos
Yes I omitted this:

acl localnet src 192.168.0.0/16

on top of squid.conf and

http_access allow localnet
http_access allow localhost

below the listed ACL rules;

Walter

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 5971 bytes
Desc: S/MIME Cryptographic Signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141015/50976789/attachment.bin>

From santosh.pai at vigyanlabs.com  Wed Oct 15 07:31:20 2014
From: santosh.pai at vigyanlabs.com (santosh)
Date: Wed, 15 Oct 2014 00:31:20 -0700 (PDT)
Subject: [squid-users] Unable to display splash page on inactive timeout
Message-ID: <1413358280087-4667887.post@n4.nabble.com>

Hello Team,

I have set-up a squid proxy server and have implemented the URL blocking and
authentication through ldap successfully . Now i have a requirement that the
squid proxy has to timeout inactive authenticated sessions informing the
user to re-login. I followed up the below links as below 

http://wiki.squid-cache.org/ConfigExamples/Portal/Splash
http://thejimmahknows.com/squid-proxy-splash-page-2/

have tried different combinations and i'm not able to make it to work , i
Have posted the acl as below please let me know wherei'm going wrong 

# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
#

external_acl_type splash_page ttl=60 concurrency=100 %SRC
/usr/lib/squid3/ext_session_acl -t 80 -b /usr/lib/squid3/session.db

acl existing_users external splash_page

auth_param basic program /usr/lib/squid3/basic_ldap_auth -b
"dc=example,dc=com" -f "(|(uid=%s)(mail=%s))" -h proxy.example.com

acl ldapauth proxy_auth REQUIRED
acl bad_url url_regex "/etc/squid3/badsites.conf"

http_access deny bad_url
http_access allow ldapauth
http_access deny !existing_users
deny_info 511:/var/www/html/info.php existing_users




--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Unable-to-display-splash-page-on-inactive-timeout-tp4667887.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From Jacques.Kruger at pupkewitz.com  Wed Oct 15 08:41:46 2014
From: Jacques.Kruger at pupkewitz.com (Jacques Kruger)
Date: Wed, 15 Oct 2014 10:41:46 +0200
Subject: [squid-users] Question on throughput
Message-ID: <5E4AD97D32C7664091A5ECC812FFBD7CF82094036F@MAIL02.99eight.com>

Hi,

I've implemented my fair share of squid proxies over the past couple of years and I've always been able to find a solution in the mail archive, but this time around I'm stumped. This is the first time I've used squid with a fast (in our context) internet connection, specifically a 4G connection that the provider claims can run up to 100Mbps. Claims aside, my real-world testing is not what I'm expecting. I've used two squid instances, one on PFsence (2.7.9) and one on Windows (2.7Stable8) and compared the throughput to a connection without squid and what I've found is, when testing with www.speedtest.net<http://www.speedtest.net> the throughput is roughly half with squid compared to a direct connection. I've left to configuration pretty much default and have tried to tweak, both without success.

What are the directives that have the most effect on throughput?

Regards,

Jacques Kruger
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141015/adba4d50/attachment.htm>

From lionxyes at gmail.com  Wed Oct 15 08:57:04 2014
From: lionxyes at gmail.com (lionxyes at gmail.com)
Date: Wed, 15 Oct 2014 16:57:04 +0800
Subject: [squid-users] some question about compiling squid with Cygwin
References: <2014101414172276501150@gmail.com>, 
 <543CD707.7020902@treenet.co.nz>, 
 <BAY181-W1780DC28D823D82E0187F6F0AD0@phx.gbl>
Message-ID: <2014101516565608614330@gmail.com>

Thank you all.

I have compiled squid 3.3.3 successfully followed what you said.

Firstly?I grab squid 3.3.3 from Cygwin.

https://onedrive.live.com/?cid=d6d15dd582a99400&id=D6D15DD582A99400%211078&v=3&ithint=photo,jpg&authkey=!AJIKkMnxNhr_KzY 

Secondly?I use cygport to compile it.

https://onedrive.live.com/?cid=d6d15dd582a99400&id=D6D15DD582A99400%211079&v=3&ithint=photo,jpg&authkey=!AEKCGBF1lDigTUM 

Next, i will do my best to understand it, and then try to add eCap to squid, recompile squid 3.3.3 with --enable-ecap option.

That my ultimate aim.


lionxyes at gmail.com
 
From: Mirza Dedic
Date: 2014-10-15 00:01
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] some question about compiling squid with Cygwin
You should be able to grab SQUID 3.3.3 from Cygwin and compile it there without issues.

When working within cygwin get the "cygport" program as there is a specific squid.cygport install file that extracts the squid source, applies cygwin specific patches and compiles it for you.

If you are running this on a Win2003 box (x86) and no ipv6, you'll need a small patch that fixes the built in ACL that causes the executable to crash (https://bugs.freebsd.org/bugzilla/attachment.cgi?id=132625&action=diff).

I've been testing this the last few days to replace our outdated SQUID 2.7 on Windows and it looks promising so far... got it in PROD at a small site with about 20 people and its running fine.

> Date: Tue, 14 Oct 2014 20:55:51 +1300
> From: squid3 at treenet.co.nz
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] some question about compiling squid with Cygwin
> 
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> On 14/10/2014 7:17 p.m., lionxyes at gmail.com wrote:
> > Hello, everybody!
> > 
> > Recently i need run squid 3.x(x >= 1) on windows, and i found
> > related wiki from this url:
> > 
> > http://wiki.squid-cache.org/KnowledgeBase/Windows
> > 
> > From this i know there are two methods of running squid on
> > windows. 1. Compiling with Cygwin 2. Compiling with MinGW and squid
> > series 3 has major build issues on all Windows compiler systems.
> > And there is no solution of the issues about compiling with MinGw.
> > 
> > but then i readed that there have been unconfirmed reports from
> > some users of building up to squid-3.3 successfully and producing a
> > usable executable. Cygwin project provide version 3.3.3 packages.
> > 
> > I was excited. I tried it immediately, but i failed when i make it.
> > I had sucessfully compiled suqid-2.7 in the same environmnent.
> > 
> > so, are there people of compiling squid 3.3.3 with Cygwin
> > successfully. and can give me some help?
> 
> The download URLs referenced under
> <http://wiki.squid-cache.org/KnowledgeBase/Windows#Pre-Built_Binary_Packages>
> includes both binary and source packages which are being used to build.
> 
> Please check if you are using that src package rather than the
> upstream release tarball. There may be cygwin specific patches applied
> to it.
> 
> Also, if you need to build any features not included in the provided
> binary package then you may consider the feature untested possibly
> either not building or working. There may be some support from Cygwin
> regarding those situations, but the upstream target for resuming
> Windows support is 3.5 series.
> 
> Amos
> 
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2.0.22 (MingW32)
> 
> iQEcBAEBAgAGBQJUPNcGAAoJELJo5wb/XPRj75kIAOSp5KgTJVLNjiVqzQnwBKGP
> /w8thp52qhpLwoiTQQ8vouyuuElbwMihJ6SWH51xOiCFyCtG5n1iTenEb26xcCGf
> g49UaeehlKihnElkLmFUJmDsnHHD+tkjr6gfg5pAKwtVzMdU30bmpF2ga7TnBwSe
> KZvGcWSfOD6xCEysuYMokgRPYmWcZd4ySX+r32lrWW+c28Tyz1KTJlcuvpq8TAzN
> twyjubjLCRSh7s91eFnhf0/woY7dn2dr0jnflA3ZPPcIqgOqw4Y7wnA7GTVFLviC
> JnA8qVT5k4VK4xurUoYyOMfKmVIh3W+Q4M8gfDyjjcwr89d/xFf0C2pjTMEkcsA=
> =QROG
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141015/96478690/attachment.htm>

From squid3 at treenet.co.nz  Wed Oct 15 09:18:04 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 15 Oct 2014 22:18:04 +1300
Subject: [squid-users] Unable to display splash page on inactive timeout
In-Reply-To: <1413358280087-4667887.post@n4.nabble.com>
References: <1413358280087-4667887.post@n4.nabble.com>
Message-ID: <543E3BCC.8020002@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 15/10/2014 8:31 p.m., santosh wrote:
> Hello Team,
> 
> I have set-up a squid proxy server and have implemented the URL
> blocking and authentication through ldap successfully . Now i have
> a requirement that the squid proxy has to timeout inactive
> authenticated sessions informing the user to re-login. I followed
> up the below links as below
> 
> http://wiki.squid-cache.org/ConfigExamples/Portal/Splash 
> http://thejimmahknows.com/squid-proxy-splash-page-2/
> 
> have tried different combinations and i'm not able to make it to
> work , i Have posted the acl as below please let me know wherei'm
> going wrong
> 

You started going wrong with the assumption that there *are*
authentication sessions in HTTP.  Once you realise there are no
sessions, then its clear there is no way for then to become "inactive".

HTTP is stateless at the protocol messaging level. Every request
involving authentication MUST have the relevant credentials sent
explicitly so as to re-authenticate them per-request.

So, Squid is always getting "fresh" credentials from the client. The
TTL relavant to Squid (helper TTL value) is just how often it has to
re-validate that constant incoming stream with the backend for
changes, versus comparing against its prevously cached auth result.
 - this happens during "allow ldapauth" so Squid never gets to any
not-logged-in state for valid users at the "deny !existing_users"
check. So move your existing_users check above the auth check.
 - even if you get this 511 result back to the client, bad things will
happen.


Basic auth has a binary respone to the client. Which states only
OK/allowed or 407-DENIED/invalid credentials.

Digest auth offers something closer to a session mechanism where Squid
can explicitly send the client a nonce-expired/stale marker to the
client instead of just rejecting the credentials as invalid.

Both of these are handled automatically behind the scenery in the
authentication logics. The human user should never be bothered more
than once per connection for credentials.


Additional to that...

Your requirement is a bit of a nasty idea due to the fact that web
"pages" do not actually exist as objects being requested. What *will*
happen is that some random object used to create a page will be
replaced by the session re-login "page" you are sending.

That is not necessarily going to be visible to the user. If it does
happen by chance to replace an HTML object or image, maybe. But a
large proportion of web content is actually scripts, CSS, or data
objects parsed and processed by scripts in the browser to display some
other visible content. Replacing any one of those with an arbitrary
HTML object is potentially dangerous or at best screwing up the client
experience badly without the re-login info actually being made visible.
 - once it has been sent and done its damage the very next client
request continues on with the same old credentials in the new session
period.


> # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS #
> 
> external_acl_type splash_page ttl=60 concurrency=100 %SRC 
> /usr/lib/squid3/ext_session_acl -t 80 -b
> /usr/lib/squid3/session.db
> 
> acl existing_users external splash_page
> 
> auth_param basic program /usr/lib/squid3/basic_ldap_auth -b 
> "dc=example,dc=com" -f "(|(uid=%s)(mail=%s))" -h proxy.example.com
> 
> acl ldapauth proxy_auth REQUIRED acl bad_url url_regex
> "/etc/squid3/badsites.conf"
> 
> http_access deny bad_url http_access allow ldapauth http_access
> deny !existing_users deny_info 511:/var/www/html/info.php
> existing_users
> 

Regarding the 511 usage. It is intended for situations where
407/proxy-auth is not possible. When authentication has to be done
*entirely* by an external_acl_type helper, (eg  when intercepting
traffic).

The 407 message itself has essentially the same meaning as 511, but
triggers the client software to use proxy-auth headers in future
requests. Whereas 511 implies that something else (like cookies) are
being used to convey the credentials - but no HTTP level information
is contained about what that mechanism might actually be.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUPjvMAAoJELJo5wb/XPRjhj0H/jz9sSy2d9EQB4uQyy+7d6Rt
cGeZAo8MsgAuvT0V1p3H1a9HZrp5lmiIevs7dn3bpIXC22wMgjd0Tq0lp4coGw6R
a4ufSZrGdwEMB/9BNqsXW3rSncIQ2Dr4JfgPeM/dCkS2hDxo4XKWM8nOxDq9MEEX
7y3Q8t99Y7fV1VLnGeq1R1Dk6oZzku5veouLVxFaiiKWsQH3FKm7pbi8+5ridr4E
M4XPEUk9kMAqZ5Un9bpEEarbLYjD/xA5Cz1l7NPPZXr+sTK+brsi4ET7uo02Lh8+
B4K0BOHwt/Xu57zmjJhxJSIPw+PcFDdWKwghLc0z1X1DycPI59cBiidS0/sYgUk=
=kMPD
-----END PGP SIGNATURE-----


From stephen.baynes at smoothwall.net  Wed Oct 15 09:23:03 2014
From: stephen.baynes at smoothwall.net (Stephen Baynes)
Date: Wed, 15 Oct 2014 10:23:03 +0100
Subject: [squid-users] Question on throughput
In-Reply-To: <5E4AD97D32C7664091A5ECC812FFBD7CF82094036F@MAIL02.99eight.com>
References: <5E4AD97D32C7664091A5ECC812FFBD7CF82094036F@MAIL02.99eight.com>
Message-ID: <CABrJVozpPbYV9enRVgpQqROAuT28pRP+ZkWN6OxkztWvUjU-JA@mail.gmail.com>

On a multi CPU box - the number of Squid workers has a very big effect
of the throughput.

Stephen

On 15 October 2014 09:41, Jacques Kruger <Jacques.Kruger at pupkewitz.com> wrote:
> Hi,
>
>
>
> I?ve implemented my fair share of squid proxies over the past couple of
> years and I?ve always been able to find a solution in the mail archive, but
> this time around I?m stumped. This is the first time I?ve used squid with a
> fast (in our context) internet connection, specifically a 4G connection that
> the provider claims can run up to 100Mbps. Claims aside, my real-world
> testing is not what I?m expecting. I?ve used two squid instances, one on
> PFsence (2.7.9) and one on Windows (2.7Stable8) and compared the throughput
> to a connection without squid and what I?ve found is, when testing with
> www.speedtest.net the throughput is roughly half with squid compared to a
> direct connection. I?ve left to configuration pretty much default and have
> tried to tweak, both without success.
>
>
>
> What are the directives that have the most effect on throughput?
>
>
>
> Regards,
>
>
>
> Jacques Kruger
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>



-- 
Stephen Baynes CEng MBCS CITP


From squid3 at treenet.co.nz  Wed Oct 15 09:31:10 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 15 Oct 2014 22:31:10 +1300
Subject: [squid-users] Question on throughput
In-Reply-To: <5E4AD97D32C7664091A5ECC812FFBD7CF82094036F@MAIL02.99eight.com>
References: <5E4AD97D32C7664091A5ECC812FFBD7CF82094036F@MAIL02.99eight.com>
Message-ID: <543E3EDE.6060506@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 15/10/2014 9:41 p.m., Jacques Kruger wrote:
> Hi,
> 
> I've implemented my fair share of squid proxies over the past
> couple of years and I've always been able to find a solution in the
> mail archive, but this time around I'm stumped. This is the first
> time I've used squid with a fast (in our context) internet
> connection, specifically a 4G connection that the provider claims
> can run up to 100Mbps. Claims aside, my real-world testing is not
> what I'm expecting. I've used two squid instances, one on PFsence
> (2.7.9) and one on Windows (2.7Stable8) and compared the throughput
> to a connection without squid and what I've found is, when testing
> with www.speedtest.net<http://www.speedtest.net> the throughput is
> roughly half with squid compared to a direct connection. I've left
> to configuration pretty much default and have tried to tweak, both 
> without success.
> 
> What are the directives that have the most effect on throughput?

Not directives particularly, but on Windows the FD limit is fixed at an
absolute 2048, whereas non-Windows can exceed that by a few hundred
thousand or millions if needed.

It also depends on the NIC of the Squid  machine. If that Windows box is
using a single NIC, then you will be maxing out the NIC capacity with
traffic going over it twice (client->Squid and Squid->Internet).

Then also the CPU gets a say. If the Squid is not doing much and the
CPU is very fast, Squid can end up running a lot of work cycles
transferring just one or a few bytes. Which impacts the TCP overheads
by decreasing bytes-per-packet.

It also depends on the protocol being used by the tests. In the modern
web there are HTTP/1.0, HTTP/1.1, WebSockets, HTTP/2, and SPDY capable
of being used for the test itself - the latter two of those involve
bandwidth comoression that can greatly enhance throughput. But only
HTTP/1.0 through default Squid-2.7 (HTTP/1.1 with tweaking).


PS. I would be interested to see what your results are with the
squid-3.3.3 now available for Windows via Cygwin.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUPj7eAAoJELJo5wb/XPRj0WgH/iBxr/0CK+MMnL5PB/ZyANqx
uxazgxCsp+EDyxl2MR+iccsaerN/gdTM7Rzms1/PBlExk2yNQb8/6EUC8XQlJs8m
EEDI0lmd13jeVIWmXP2vYy1vQATuS7OMI0bvkfCDSI/bYVaHKMKCtssCPdQRKxul
akGgY7LhX7lLlkzgzrnrU8HUNN/PjFI7tg3y0xKihwEaDckYHcqg260cHJdjeI6C
2kZfFeJFMV0D0Y7N1HO38OKkJpHBIJoWDWWWlmI8j01UpsBSuxRqw51r1372jkne
Ka5m9vlQfGXWvI5Zg7uL3CxlBRTe6oe7T0n3dmHGy4KnvDbT09MXYMkS3ShTfzU=
=7UJb
-----END PGP SIGNATURE-----


From Jacques.Kruger at pupkewitz.com  Wed Oct 15 11:36:41 2014
From: Jacques.Kruger at pupkewitz.com (Jacques Kruger)
Date: Wed, 15 Oct 2014 13:36:41 +0200
Subject: [squid-users] Question on throughput
In-Reply-To: <543E3EDE.6060506@treenet.co.nz>
References: <5E4AD97D32C7664091A5ECC812FFBD7CF82094036F@MAIL02.99eight.com>
 <543E3EDE.6060506@treenet.co.nz>
Message-ID: <5E4AD97D32C7664091A5ECC812FFBD7CF82094074B@MAIL02.99eight.com>

Thanks for the information.

I'll do some further testing and confirm that the CPU isn't the bottleneck in this case. The machine is a bit long in the tooth but with the faster connection this could easily be the issue.

As a general rule, am I correct in sticking with 2.7 for performance or is the current focus on squid3? 

Regards,

Jacques

-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Amos Jeffries
Sent: 15 October 2014 11:31 AM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Question on throughput

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 15/10/2014 9:41 p.m., Jacques Kruger wrote:
> Hi,
> 
> I've implemented my fair share of squid proxies over the past couple 
> of years and I've always been able to find a solution in the mail 
> archive, but this time around I'm stumped. This is the first time I've 
> used squid with a fast (in our context) internet connection, 
> specifically a 4G connection that the provider claims can run up to 
> 100Mbps. Claims aside, my real-world testing is not what I'm 
> expecting. I've used two squid instances, one on PFsence
> (2.7.9) and one on Windows (2.7Stable8) and compared the throughput to 
> a connection without squid and what I've found is, when testing with 
> www.speedtest.net<http://www.speedtest.net> the throughput is roughly 
> half with squid compared to a direct connection. I've left to 
> configuration pretty much default and have tried to tweak, both 
> without success.
> 
> What are the directives that have the most effect on throughput?

Not directives particularly, but on Windows the FD limit is fixed at an absolute 2048, whereas non-Windows can exceed that by a few hundred thousand or millions if needed.

It also depends on the NIC of the Squid  machine. If that Windows box is using a single NIC, then you will be maxing out the NIC capacity with traffic going over it twice (client->Squid and Squid->Internet).

Then also the CPU gets a say. If the Squid is not doing much and the CPU is very fast, Squid can end up running a lot of work cycles transferring just one or a few bytes. Which impacts the TCP overheads by decreasing bytes-per-packet.

It also depends on the protocol being used by the tests. In the modern web there are HTTP/1.0, HTTP/1.1, WebSockets, HTTP/2, and SPDY capable of being used for the test itself - the latter two of those involve bandwidth comoression that can greatly enhance throughput. But only
HTTP/1.0 through default Squid-2.7 (HTTP/1.1 with tweaking).


PS. I would be interested to see what your results are with the
squid-3.3.3 now available for Windows via Cygwin.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUPj7eAAoJELJo5wb/XPRj0WgH/iBxr/0CK+MMnL5PB/ZyANqx
uxazgxCsp+EDyxl2MR+iccsaerN/gdTM7Rzms1/PBlExk2yNQb8/6EUC8XQlJs8m
EEDI0lmd13jeVIWmXP2vYy1vQATuS7OMI0bvkfCDSI/bYVaHKMKCtssCPdQRKxul
akGgY7LhX7lLlkzgzrnrU8HUNN/PjFI7tg3y0xKihwEaDckYHcqg260cHJdjeI6C
2kZfFeJFMV0D0Y7N1HO38OKkJpHBIJoWDWWWlmI8j01UpsBSuxRqw51r1372jkne
Ka5m9vlQfGXWvI5Zg7uL3CxlBRTe6oe7T0n3dmHGy4KnvDbT09MXYMkS3ShTfzU=
=7UJb
-----END PGP SIGNATURE-----
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

From Jacques.Kruger at pupkewitz.com  Wed Oct 15 11:39:52 2014
From: Jacques.Kruger at pupkewitz.com (Jacques Kruger)
Date: Wed, 15 Oct 2014 13:39:52 +0200
Subject: [squid-users] Question on throughput
In-Reply-To: <CABrJVozpPbYV9enRVgpQqROAuT28pRP+ZkWN6OxkztWvUjU-JA@mail.gmail.com>
References: <5E4AD97D32C7664091A5ECC812FFBD7CF82094036F@MAIL02.99eight.com>
 <CABrJVozpPbYV9enRVgpQqROAuT28pRP+ZkWN6OxkztWvUjU-JA@mail.gmail.com>
Message-ID: <5E4AD97D32C7664091A5ECC812FFBD7CF820940754@MAIL02.99eight.com>

Thanks Stephen.

If I'm correct I can only adjust the number of workers in Squid3, not in 2.7. I'll check if I've misread the documentation and adjust it if I can.

Regards,

Jacques
-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Stephen Baynes
Sent: 15 October 2014 11:23 AM
To: squid-users at squid-cache.org
Subject: Re: [squid-users] Question on throughput

On a multi CPU box - the number of Squid workers has a very big effect of the throughput.

Stephen

On 15 October 2014 09:41, Jacques Kruger <Jacques.Kruger at pupkewitz.com> wrote:
> Hi,
>
>
>
> I?ve implemented my fair share of squid proxies over the past couple 
> of years and I?ve always been able to find a solution in the mail 
> archive, but this time around I?m stumped. This is the first time I?ve 
> used squid with a fast (in our context) internet connection, 
> specifically a 4G connection that the provider claims can run up to 
> 100Mbps. Claims aside, my real-world testing is not what I?m 
> expecting. I?ve used two squid instances, one on PFsence (2.7.9) and 
> one on Windows (2.7Stable8) and compared the throughput to a 
> connection without squid and what I?ve found is, when testing with 
> www.speedtest.net the throughput is roughly half with squid compared 
> to a direct connection. I?ve left to configuration pretty much default and have tried to tweak, both without success.
>
>
>
> What are the directives that have the most effect on throughput?
>
>
>
> Regards,
>
>
>
> Jacques Kruger
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>



--
Stephen Baynes CEng MBCS CITP
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

From squid3 at treenet.co.nz  Wed Oct 15 11:48:21 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 16 Oct 2014 00:48:21 +1300
Subject: [squid-users] Question on throughput
In-Reply-To: <5E4AD97D32C7664091A5ECC812FFBD7CF82094074B@MAIL02.99eight.com>
References: <5E4AD97D32C7664091A5ECC812FFBD7CF82094036F@MAIL02.99eight.com>
 <543E3EDE.6060506@treenet.co.nz>
 <5E4AD97D32C7664091A5ECC812FFBD7CF82094074B@MAIL02.99eight.com>
Message-ID: <543E5F05.6010100@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 16/10/2014 12:36 a.m., Jacques Kruger wrote:
> Thanks for the information.
> 
> I'll do some further testing and confirm that the CPU isn't the
> bottleneck in this case. The machine is a bit long in the tooth but
> with the faster connection this could easily be the issue.
> 
> As a general rule, am I correct in sticking with 2.7 for
> performance or is the current focus on squid3?


2.7 was officially deprecated by 3.2. In both features and
performance. Improvements will only be done on 3.x versions.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUPl8FAAoJELJo5wb/XPRjagEH/1kRT7+n2Cnoq33QXnytbuMM
QkHRBaXZzeNrMQ8Jz+ofktjAo1H3fXn2Gp8yZ/uU1T8nHoJ1NfB2PfFH7ZDm1cc4
aWGkMH8xA2YfURWsdDCufGuqElfYTJjrgxhg68aq6XXeXBIWq5y+M4GbLlI0zq5C
VI5HFjao2nm2qz+mf1Ba0XwHjR/JfNRDI/fSwpgVw8hLRFFhaHCL2ydHvWoDdeNk
I58AdgCC/Aea4NYN/B08YaNDffjMlNZ12/PrS4/e2zPi9yPwN5ijv4Xn27woEOk7
Cwu3fQNST6tRPdXFE3c/k7Ty6eebcUK84btDiJOClz7rZiiqYYkIHdx+sl7KOwc=
=xzIe
-----END PGP SIGNATURE-----


From Jacques.Kruger at pupkewitz.com  Wed Oct 15 11:52:47 2014
From: Jacques.Kruger at pupkewitz.com (Jacques Kruger)
Date: Wed, 15 Oct 2014 13:52:47 +0200
Subject: [squid-users] Question on throughput
In-Reply-To: <543E5F05.6010100@treenet.co.nz>
References: <5E4AD97D32C7664091A5ECC812FFBD7CF82094036F@MAIL02.99eight.com>
 <543E3EDE.6060506@treenet.co.nz>
 <5E4AD97D32C7664091A5ECC812FFBD7CF82094074B@MAIL02.99eight.com>
 <543E5F05.6010100@treenet.co.nz>
Message-ID: <5E4AD97D32C7664091A5ECC812FFBD7CF82094077F@MAIL02.99eight.com>

Thanks - at least I can now start to plan for the future.

Regards,

Jacques

-----Original Message-----
From: Amos Jeffries [mailto:squid3 at treenet.co.nz] 
Sent: 15 October 2014 01:48 PM
To: Jacques Kruger; squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Question on throughput

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 16/10/2014 12:36 a.m., Jacques Kruger wrote:
> Thanks for the information.
> 
> I'll do some further testing and confirm that the CPU isn't the 
> bottleneck in this case. The machine is a bit long in the tooth but 
> with the faster connection this could easily be the issue.
> 
> As a general rule, am I correct in sticking with 2.7 for performance 
> or is the current focus on squid3?


2.7 was officially deprecated by 3.2. In both features and performance. Improvements will only be done on 3.x versions.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUPl8FAAoJELJo5wb/XPRjagEH/1kRT7+n2Cnoq33QXnytbuMM
QkHRBaXZzeNrMQ8Jz+ofktjAo1H3fXn2Gp8yZ/uU1T8nHoJ1NfB2PfFH7ZDm1cc4
aWGkMH8xA2YfURWsdDCufGuqElfYTJjrgxhg68aq6XXeXBIWq5y+M4GbLlI0zq5C
VI5HFjao2nm2qz+mf1Ba0XwHjR/JfNRDI/fSwpgVw8hLRFFhaHCL2ydHvWoDdeNk
I58AdgCC/Aea4NYN/B08YaNDffjMlNZ12/PrS4/e2zPi9yPwN5ijv4Xn27woEOk7
Cwu3fQNST6tRPdXFE3c/k7Ty6eebcUK84btDiJOClz7rZiiqYYkIHdx+sl7KOwc=
=xzIe
-----END PGP SIGNATURE-----

From tfransosi at gmail.com  Wed Oct 15 14:23:39 2014
From: tfransosi at gmail.com (Thiago Farina)
Date: Wed, 15 Oct 2014 11:23:39 -0300
Subject: [squid-users] cache-control
In-Reply-To: <CACnwZYecOMeX+2KeP3gPKytae2XVQRkPbcRoxgv=grPY7sOxwQ@mail.gmail.com>
References: <CACnwZYcbeHVDdP5EhR0hCqfMUw8SM375HPkAty3V1Ar=d+WAPw@mail.gmail.com>
 <543D6CB1.9010907@treenet.co.nz>
 <CACnwZYecOMeX+2KeP3gPKytae2XVQRkPbcRoxgv=grPY7sOxwQ@mail.gmail.com>
Message-ID: <CACnwZYdUVgpZNuMnQhjdN4P-8bSMB+EYofCv-p3LjKQUmmfGqw@mail.gmail.com>

Amos, can this be 'acl static_content'?

-- 
Thiago Farina


From mcsnv96 at afo.net  Wed Oct 15 14:39:42 2014
From: mcsnv96 at afo.net (Mike)
Date: Wed, 15 Oct 2014 09:39:42 -0500
Subject: [squid-users] Question on throughput
In-Reply-To: <5E4AD97D32C7664091A5ECC812FFBD7CF82094036F@MAIL02.99eight.com>
References: <5E4AD97D32C7664091A5ECC812FFBD7CF82094036F@MAIL02.99eight.com>
Message-ID: <543E872E.6000003@afo.net>

On 10/15/2014 3:41 AM, Jacques Kruger wrote:
>
> Hi,
>
> I?ve implemented my fair share of squid proxies over the past couple 
> of years and I?ve always been able to find a solution in the mail 
> archive, but this time around I?m stumped. This is the first time I?ve 
> used squid with a fast (in our context) internet connection, 
> specifically a 4G connection that the provider claims can run up to 
> 100Mbps. Claims aside, my real-world testing is not what I?m 
> expecting. I?ve used two squid instances, one on PFsence (2.7.9) and 
> one on Windows (2.7Stable8) and compared the throughput to a 
> connection without squid and what I?ve found is, when testing with 
> www.speedtest.net <http://www.speedtest.net> the throughput is roughly 
> half with squid compared to a direct connection. I?ve left to 
> configuration pretty much default and have tried to tweak, both 
> without success.
>
> What are the directives that have the most effect on throughput?
>
> Regards,
>
> Jacques Kruger
>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

Throughput on squid 2.x (plus the linux kernel from that timeframe) is 
limited as we recently found out on one of our servers. In the past with 
my testing, Windows with cygwin is even further limited. In our case 
with a small ISP level 200Mbps connection, the best our customers could 
get with their systems was 20Mbps through linux 2.0.x kernel and squid 2.3.
Same server with updated OS (Scientific Linux 6.5 with latest updates), 
same connection using compiled squid 3.4.7, typically up to 4000 
customers connecting to it at any given moment, and customers with 
50Mbps connections (some of the fastest home connection) were seeing 
less than 20% drop, even spanning across the entire US.


Mike

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141015/c49f25e0/attachment.htm>

From mirza.dedic at outlook.com  Wed Oct 15 18:23:00 2014
From: mirza.dedic at outlook.com (Mirza Dedic)
Date: Wed, 15 Oct 2014 11:23:00 -0700
Subject: [squid-users] http_access deny for dstdomain acl not denying
 access to url.. what am I doing wrong?
In-Reply-To: <543E1854.5060906@mathemainzel.info>
References: <BAY181-W19CC619B2AFE9F23C165CF0AA0@phx.gbl>,
 <543E0C76.8090906@mathemainzel.info>
 <543E1070.4050100@treenet.co.nz>,<543E1854.5060906@mathemainzel.info>
Message-ID: <BAY181-W565C4C65E553F96C0E602F0AA0@phx.gbl>

Thanks Walter and Amos, i've taken your advice and now I got the blocking to partially work.?I've re-organized how my ACLs are setup (order) and using your examples Walter to implement my ACLs.

Working on the facebook example, I have..

acl block_domains_regex dstdom_regex -i "/etc/squid/block-domains-regex-list-acl.squid"
deny_info ERR_URL_BLOCKED block_domains_regex
http_access deny block_domains_regex

In the acl file, I have..

.*\.facebook\.com.*

According to?http://www.regexr.com?this blocks:

https://www.facebook.com
https://www.facebook.com/something
https://something.facebook.com
www.facebook.com??
http://www.facebook.com??

However, it will not block..

https://facebook.com
http://facebook.com

I can't seem to get this right to block the bottom 2, any ideas?
----------------------------------------
Date: Wed, 15 Oct 2014 08:46:44 +0200
From: Walter.H at mathemainzel.info
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] http_access deny for dstdomain acl not denying access to url.. what am I doing wrong?


On 15.10.2014 08:13, Amos Jeffries wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
>
> And the key difference in these configs is not the ACL contents, but
> the ordering in which they are matched.
>
> Mirzas' config starts by telling Squid everything on the LAN/localnet
> is allowed. Ok, fine, Squid will do that.
>
> Walters' config will tell Squid a limited set of things to allow, then
> some things to deny, then implicitly allow everything else [1][2].
> Whichever rule actually matches the FB requests will be applied by
> Squid, with a limited set of initial allow/bypass the likelihood that
> a deny following will match is higher.
>
>
> [1] this is not a great situation, because any remote attack which can
> figure out a way past your regex ACLs can use the proxy for whatever
> they please[2].
>
> [2] I hope you just omitted the localnet ACL checks which should
> follow the ones you showed.
>
> Amos
Yes I omitted this:

acl localnet src 192.168.0.0/16

on top of squid.conf and

http_access allow localnet
http_access allow localhost

below the listed ACL rules;

Walter


_______________________________________________ squid-users mailing list squid-users at lists.squid-cache.org http://lists.squid-cache.org/listinfo/squid-users
 		 	   		  

From squid3 at treenet.co.nz  Wed Oct 15 18:31:06 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 16 Oct 2014 07:31:06 +1300
Subject: [squid-users] http_access deny for dstdomain acl not denying
 access to url.. what am I doing wrong?
In-Reply-To: <BAY181-W565C4C65E553F96C0E602F0AA0@phx.gbl>
References: <BAY181-W19CC619B2AFE9F23C165CF0AA0@phx.gbl>,
 <543E0C76.8090906@mathemainzel.info>
 <543E1070.4050100@treenet.co.nz>,
 <543E1854.5060906@mathemainzel.info>
 <BAY181-W565C4C65E553F96C0E602F0AA0@phx.gbl>
Message-ID: <543EBD6A.7070801@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 16/10/2014 7:23 a.m., Mirza Dedic wrote:
> Thanks Walter and Amos, i've taken your advice and now I got the
> blocking to partially work. I've re-organized how my ACLs are setup
> (order) and using your examples Walter to implement my ACLs.
> 
> Working on the facebook example, I have..
> 
> acl block_domains_regex dstdom_regex -i
> "/etc/squid/block-domains-regex-list-acl.squid" deny_info
> ERR_URL_BLOCKED block_domains_regex http_access deny
> block_domains_regex
> 
> In the acl file, I have..
> 
> .*\.facebook\.com.*

1)  .* prefix and suffix are not useful.

2) dstdomain ACL type is faster than regex

> 
> According to http://www.regexr.com this blocks:
> 
> https://www.facebook.com https://www.facebook.com/something 
> https://something.facebook.com www.facebook.com 
> http://www.facebook.com
> 
> However, it will not block..
> 
> https://facebook.com http://facebook.com
> 
> I can't seem to get this right to block the bottom 2, any ideas?

For that set of domains use:
  acl block_domains dstdomain .facebook.com

NP: the '.' at the beginnign means wildcard any sub-domain as well as
the matching domain.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUPr1qAAoJELJo5wb/XPRjEWQH/0N13Zc6StASsDocqoyHh2+z
luqgM5mtBAeKA2uOsDY5Ojt9I4Ew2ypQOx/8rJtILnUwu7XWURkdIEzDQ5eYTufj
ThFIRwMSdNPRktoW+JifjK2Xk68BPQJ3s9IKVX41ODB8W20PQpLpW1TUhYNa/vKi
E3vKsLn/QGj50ynGiBjaOg1A95doGMLO3PvkuAD2OX4W/CJSJ19vxPiOlUwKkX64
w8mfw3OaNikkFdfBanLsaMIxgJ7vhgxc8OVr0FErJe1wvHaSs4EsVqAIZX7J0OQH
FN3QQUnW2l+GJJhuQPz+o0gzn0MAN6yEaZXpy7LCwOc4ne9Q4MjBVaqJNlFsyiY=
=AWrq
-----END PGP SIGNATURE-----


From robert at gillecaluim.com  Wed Oct 15 20:43:08 2014
From: robert at gillecaluim.com (Robert Watson)
Date: Wed, 15 Oct 2014 13:43:08 -0700
Subject: [squid-users] NET::ERR_CERT_COMMON_NAME_INVALID
Message-ID: <CADoG9x=L97xZVmaDGpwKehVHJKETY6Ex15VYwL9k+cZvu0jamA@mail.gmail.com>

Has anyone got this error when performing https proxy? I only receive it on
a couple of https websites.  How to fix?
Robert
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141015/1225cbba/attachment.htm>

From squid-user at tlinx.org  Wed Oct 15 21:18:26 2014
From: squid-user at tlinx.org (Linda W)
Date: Wed, 15 Oct 2014 14:18:26 -0700
Subject: [squid-users] Question on throughput
In-Reply-To: <CABrJVozpPbYV9enRVgpQqROAuT28pRP+ZkWN6OxkztWvUjU-JA@mail.gmail.com>
References: <5E4AD97D32C7664091A5ECC812FFBD7CF82094036F@MAIL02.99eight.com>
 <CABrJVozpPbYV9enRVgpQqROAuT28pRP+ZkWN6OxkztWvUjU-JA@mail.gmail.com>
Message-ID: <543EE4A2.5020806@tlinx.org>

Stephen Baynes wrote:
> On a multi CPU box - the number of Squid workers has a very big effect
> of the throughput.
---
Last I heard that option was only available for requests
32KB or smaller.  Has it increased?

Dunno about your use case, but looking
at my cache right now, I see 505049 files using
86G of space.  That's an average of 182836 bytes/file
or about 6x the maximum allowed for parallel use.



From squid3 at treenet.co.nz  Thu Oct 16 04:34:36 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 16 Oct 2014 17:34:36 +1300
Subject: [squid-users] NET::ERR_CERT_COMMON_NAME_INVALID
In-Reply-To: <CADoG9x=L97xZVmaDGpwKehVHJKETY6Ex15VYwL9k+cZvu0jamA@mail.gmail.com>
References: <CADoG9x=L97xZVmaDGpwKehVHJKETY6Ex15VYwL9k+cZvu0jamA@mail.gmail.com>
Message-ID: <543F4ADC.8000900@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 16/10/2014 9:43 a.m., Robert Watson wrote:
> Has anyone got this error when performing https proxy? I only
> receive it on a couple of https websites.  How to fix? Robert
> 

Just seems to be you so far.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUP0rcAAoJELJo5wb/XPRjGo0IALqfcBm7+q5e1+SfoqdSPXm5
JS2BKNj6fXAvtjGdJkcyb5s8hGdaaUD/zAdzDcvTft+w+XYkCJC721tUrRRqTY8m
TcSIv+zh7kNstiyFjUjOL9U8eCnB/EKwDikHBTzpx0pk3Yy1n1By2PZtdrC2CX4r
kJQpWac6bRnJxvo7E0rbD5uc6xUINbhTLmTRjWq/dkY5hVWg33Omrdi8E1cLHa6V
4WeeC6Upl6oOmNG+dlWrJAxgDbp+FJLUMKcc+4H8th34MOOxt9S4p7e9RERUE+vl
bLm+L9NzuPQ6K2j9FTQy5QmRjiGiOcJZUsAQeGEiG8lVc2wQMGGhbu1D39l2XTw=
=D2kl
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Thu Oct 16 04:43:23 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 16 Oct 2014 17:43:23 +1300
Subject: [squid-users] Question on throughput
In-Reply-To: <543EE4A2.5020806@tlinx.org>
References: <5E4AD97D32C7664091A5ECC812FFBD7CF82094036F@MAIL02.99eight.com>
 <CABrJVozpPbYV9enRVgpQqROAuT28pRP+ZkWN6OxkztWvUjU-JA@mail.gmail.com>
 <543EE4A2.5020806@tlinx.org>
Message-ID: <543F4CEB.9060903@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 16/10/2014 10:18 a.m., Linda W wrote:
> Stephen Baynes wrote:
>> On a multi CPU box - the number of Squid workers has a very big
>> effect of the throughput.
> --- Last I heard that option was only available for requests 32KB
> or smaller.  Has it increased?

?? the 32KB limit is on objects stored to early versions of cache_dir
rock storage. This has been removed in squid-3.5.


Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUP0zrAAoJELJo5wb/XPRjktcH/R+Dtxqu0VApip9TDciIIUut
neYwt0YwcIt7uVYQ3McIXHXz79wKN6gwmuJ7pJsGg1cNuI+1apFuFhDD2N7bnsgm
ObO6A4oIBf03eGq3w9o3p9qfw2bBr87W/LCC4sZE+MWuIYiJL7SrgMf0l1LY1AVY
wVoxRkRkG+oVA1dlTUPC/Et2XSqZqPS/bud+x5YkqUOcWfGrmvApbadOWM6sqW+R
ckKaPNtQURvV8h5sO697hoq1aIJnnP33vf0WL7hhP30QzjuSuhD+i0/Jy3NHFTRL
zGDgdx7n6kMnhdiuiVy5cSDiKV5FQIZe8IkmymCTxCazIf6N9TOWBYsL+KV5uoQ=
=4s1x
-----END PGP SIGNATURE-----


From santosh.pai at vigyanlabs.com  Thu Oct 16 05:03:02 2014
From: santosh.pai at vigyanlabs.com (santosh)
Date: Wed, 15 Oct 2014 22:03:02 -0700 (PDT)
Subject: [squid-users] Unable to display splash page on inactive timeout
In-Reply-To: <1413358280087-4667887.post@n4.nabble.com>
References: <1413358280087-4667887.post@n4.nabble.com>
Message-ID: <1413435782721-4667905.post@n4.nabble.com>

Hello Amos,

Thanks for your reply , is there a way to prompt for reauthentication if an
browsing session is inactive by setting the TTL value ? .



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Unable-to-display-splash-page-on-inactive-timeout-tp4667887p4667905.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From squid3 at treenet.co.nz  Thu Oct 16 05:10:05 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 16 Oct 2014 18:10:05 +1300
Subject: [squid-users] Best way to deny access to URLs in Squid 3.3.x?
In-Reply-To: <543D7384.8080208@afo.net>
References: <BAY181-W74A0085867394B1608E8A2F0AD0@phx.gbl>
 <543D7384.8080208@afo.net>
Message-ID: <543F532D.20203@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 15/10/2014 8:03 a.m., Mike wrote:
> On 10/14/2014 12:37 PM, Mirza Dedic wrote:
>> Just curious, what are some of you doing in your Squid
>> environment as far as URL filtering goes? It seems there are a
>> few options out there.. squidguard... dansguardian.. plain block
>> lists.
>> 
>> What is the best practice to implement some sort of block list
>> into squid? I've found urlblacklist.com that has a pretty good
>> broken down URL block list by category, what would be the best
>> way to go.. use dansguardian with this list or set it up in
>> squid.conf as an "acl dstdomain" and feed in the block list file
>> without calling an external helper application?
>> 
>> Thanks.
>> 
> 
> We have used dansguardian before, but there is a newer updated
> "fork" by some of the original crew called "e2guardian" that can
> also handle some SSL urls via blacklisting (as long as squid is
> also setup with ssl-bump in 3.4.x). Otherwise within squid itself,
> the dstdomain and regex_dstdomain acls are an option, but that does
> not provide much for filtering content of the websites themselves.

Content filtering is a nasty field (both content complexity and legal
minefields). We have explicitly designed the Squid proxy just to proxy
traffic around, not to perform cuch filtering itself.

Squid instead provides ICAP and eCAP adaptation interfaces for
third-party services or plugins to use for content filtering and many
other things:

 http://www.squid-cache.org/Misc/icap.html
 http://www.icap-forum.org/icap?do=products

Even a NoSQL cache plugin
 http://www.squid-cache.org/Misc/ecap.html

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUP1MtAAoJELJo5wb/XPRj4e8IAIS8GiLCTdjIPwkR8DCr1Id/
S9PlXJ1l74kGBVJ2l8zOcZS6WQ6lwRjzHDw1zlnXWHNoBsagfHkasX1KNtO7ih1u
tkkBtRlrlmXf3zleWoD2isxy58DmoVFfNbJxhy9UM7jB4HrRn7V4kQYjWRxtX8F+
ZQs/igD4UPAZOkGY8nuyNKVZuMLRr9+ZsOn+qmm5KFFG1xYAOYErzcUiQfhku0d2
Vnt/pMooeYJfAOd3uttfRWWClF1KrbOYebb+jfo5DvMBvLnvjLaLF7WaOa0Ljba6
607NBlyB33dqpW4qIk4503N8P0LMXrSRdrr9NwiJ3AB7xGJzSZb5zG5LUyr3v98=
=WUcV
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Thu Oct 16 05:48:12 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 16 Oct 2014 18:48:12 +1300
Subject: [squid-users] Unable to display splash page on inactive timeout
In-Reply-To: <1413435782721-4667905.post@n4.nabble.com>
References: <1413358280087-4667887.post@n4.nabble.com>
 <1413435782721-4667905.post@n4.nabble.com>
Message-ID: <543F5C1C.1010005@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 16/10/2014 6:03 p.m., santosh wrote:
> Hello Amos,
> 
> Thanks for your reply , is there a way to prompt for
> reauthentication if an browsing session is inactive by setting the
> TTL value ? .

You are getting yourself into trouble by confusing the concept of
authentication and concept of browsing session.

Authentication is at its core a yes/no binary value about whether the
client is who they say they are.
 eg. are you actually "santosh"? yes/no.

What you are asking is only doable by changing the users credentials,
so the browser cannot use the old ones any more AND in such a way that
the browser cannot automatically find out what the new ones are.

eg. offering users one-time logins which get erased or marked invalid
in the authentication backend system. With the 407 page delivered
containing instructions to get a new one-time password. So if they
press cancel on the browser popup they can follow that process, then
login again.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUP1wcAAoJELJo5wb/XPRjaq8IAJDcVPti4fyMPAMadDf0lE/W
bvj4OCjk/pvCAaa4l3kiHQWyJVWVVIGotKutcByPRIIDgi0inwpwa7bzkLQdhxPA
d2j4MWdYTnTP8xKwMXXdEs5b58liwQlGJm+wzg7Ecdmntgviqbrv4hh4qV8fEIEf
dUzB0F5O8x6SL0eTistdtNq4SDXOKrGfQ7YqaQfCiFcHV6AAU15k0cYqxcH8W0Xl
S9Sm/HzEZS5LZt+tJy2aE0Uu5KKElJS/0zpN2s9G4mNR+ThIBUq0lUFFRWXg92by
HZrdSLfBauPUFvOSR/P/Cs/XWzFuh05qqyw/QzjSvBAO2ghq0pMG6rkCTvbQvMw=
=buJ1
-----END PGP SIGNATURE-----


From Jason_Haar at trimble.com  Thu Oct 16 07:54:57 2014
From: Jason_Haar at trimble.com (Jason Haar)
Date: Thu, 16 Oct 2014 20:54:57 +1300
Subject: [squid-users] squid-3.4.8 sslbump breaks facebook
Message-ID: <543F79D1.8080705@trimble.com>

Hi there

Weird. sslbump seems to be working well, even intercepts twitter.com
fine under FF-33 (with it's pinning support, due to
security.cert_pinning.enforcement_level=1)

However, facebook.com generates a "sec_error_inadequate_key_usage"
error. I cranked up debugging and see this. As you can see, the proxy
has ipv6 support and is actually intercepting google.com over ipv6
successfully, so I don't think it has anything to do with networking. I
can use "curl -v" to confirm it successfully downloaded the frontpage
over the same IPv6 address too. I also checked the ssl_db/certs dir and
removed the facebook certs and restarted - didn't help

If I look at the real  www.facebook.com cert, I see

            X509v3 Subject Alternative Name:
                DNS:*.facebook.com, DNS:facebook.com, DNS:*.fbsbx.com,
DNS:*.fbcdn.net, DNS:*.xx.fbcdn.net, DNS:*.xy.fbcdn.net, DNS:fb.com,
DNS:*.fb.com
            X509v3 Key Usage: critical
                Digital Signature, Key Agreement
            X509v3 Extended Key Usage:
                TLS Web Server Authentication, TLS Web Client Authentication

however, the squid-created cert, shows

            X509v3 Subject Alternative Name:
                DNS:*.facebook.com, DNS:facebook.com, DNS:*.fbsbx.com,
DNS:*.fbcdn.net, DNS:*.xx.fbcdn.net, DNS:*.xy.fbcdn.net, DNS:fb.com,
DNS:*.fb.com
            X509v3 Key Usage: critical
                .
            X509v3 Extended Key Usage:
                TLS Web Server Authentication, TLS Web Client Authentication

So squid is failing to set "X509v3 Key Usage" correctly?

Jason

1413438531.233   2192 127.0.0.1 TAG_NONE/200 0 CONNECT
www.facebook.com:443 - HIER_DIRECT/2a03:2880:20:4f06:face:b00c:0:1 -
[User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:33.0)
Gecko/20100101 Firefox/33.0\r\nProxy-Connection:
keep-alive\r\nConnection: keep-alive\r\nHost: www.facebook.com:443\r\n] []

generates the following...

2014/10/16 18:40:16.194 kid1| dns_internal.cc(1092) idnsCallback:
Merging DNS results www.facebook.com A has 2 RR, AAAA has 2 RR
2014/10/16 18:40:16.194 kid1| ipcache.cc(498) ipcacheParse:
ipcacheParse: 4 answers for 'www.facebook.com'
2014/10/16 18:40:16.194 kid1| ipcache.cc(567) ipcacheParse:
ipcacheParse: www.facebook.com #0 [2a03:2880:20:4f06:face:b00c:0:1]
2014/10/16 18:40:16.194 kid1| ipcache.cc(556) ipcacheParse:
ipcacheParse: www.facebook.com #1 173.252.74.22
2014/10/16 18:40:16.194 kid1| peer_select.cc(286) peerSelectDnsPaths:
Found sources for 'www.facebook.com:443'
2014/10/16 18:40:16.194 kid1| FwdState.cc(373) startConnectionOrFail:
www.facebook.com:443
2014/10/16 18:40:16.194 kid1| FwdState.cc(1082) connectStart:
fwdConnectStart: www.facebook.com:443
2014/10/16 18:40:16.194 kid1| pconn.cc(340) key:
PconnPool::key(local=[::] remote=[2a03:2880:20:4f06:face:b00c:0:1]:443
flags=1, www.facebook.com) is
{[2a03:2880:20:4f06:face:b00c:0:1]:443/www.facebook.com}
2014/10/16 18:40:16.194 kid1| pconn.cc(436) pop: lookup for key
{[2a03:2880:20:4f06:face:b00c:0:1]:443/www.facebook.com} failed.
2014/10/16 18:40:16.194 kid1| peer_select.cc(94) ~ps_state:
www.facebook.com:443
2014/10/16 18:40:16.194 kid1| fd.cc(221) fd_open: fd_open() FD 33
www.facebook.com
2014/10/16 18:40:16.426 kid1| FwdState.cc(1029) connectDone:
local=[2001:470:828b:0:c460:6ed8:7e00:e8f4]:52765
remote=[2a03:2880:20:4f06:face:b00c:0:1]:443 FD 33 flags=1:
'www.facebook.com:443'
2014/10/16 18:40:17.698 kid1| support.cc(260) ssl_verify_cb: SSL
Certificate signature OK: /C=US/ST=CA/L=Menlo Park/O=Facebook,
Inc./CN=*.facebook.com
2014/10/16 18:40:17.698 kid1| support.cc(260) ssl_verify_cb: SSL
Certificate signature OK: /C=US/ST=CA/L=Menlo Park/O=Facebook,
Inc./CN=*.facebook.com
2014/10/16 18:40:17.698 kid1| support.cc(260) ssl_verify_cb: SSL
Certificate signature OK: /C=US/ST=CA/L=Menlo Park/O=Facebook,
Inc./CN=*.facebook.com
2014/10/16 18:40:17.698 kid1| support.cc(214) check_domain: Verifying
server domain www.facebook.com to certificate name/subjectAltName
*.facebook.com
2014/10/16 18:40:17.950 kid1| FwdState.cc(1218) dispatch:
local=127.0.0.1:3128 remote=127.0.0.1:49230 FD 24 flags=1: Fetching
'CONNECT www.facebook.com:443'
2014/10/16 18:40:17.950 kid1| FwdState.cc(433) unregister:
www.facebook.com:443
2014/10/16 18:40:17.950 kid1| FwdState.cc(458) complete:
www.facebook.com:443
2014/10/16 18:40:17.950 kid1| FwdState.cc(1355) reforward:
www.facebook.com:443?
2014/10/16 18:40:17.950 kid1| client_side.cc(4045) httpsPeeked: HTTPS
server CN: *.facebook.com bumped:
local=[2001:470:828b:0:c460:6ed8:7e00:e8f4]:52765
remote=[2a03:2880:20:4f06:face:b00c:0:1]:443 FD 33 flags=1
2014/10/16 18:40:17.951 kid1| client_side.cc(4049) httpsPeeked: bumped
HTTPS server: www.facebook.com
2014/10/16 18:40:17.951 kid1| client_side_request.cc(265)
~ClientHttpRequest: httpRequestFree: www.facebook.com:443
2014/10/16 18:40:17.951 kid1| client_side.cc(617) logRequest: logging
half-baked transaction: www.facebook.com:443
2014/10/16 18:40:17.951 kid1| client_side.cc(621) logRequest:
clientLogRequest: al.url='www.facebook.com:443'
2014/10/16 18:40:17.951 kid1| HttpHeader.cc(1531) ~HttpHeaderEntry:
destroying entry 0x30c5fd0: 'Host: www.facebook.com:443'
2014/10/16 18:40:17.951 kid1| client_side.cc(3899) getSslContextStart:
Finding SSL certificate for /C=US/ST=CA/L=Menlo Park/O=Facebook,
Inc./CN=*.facebook.com+Sign=signTrusted in cache
2014/10/16 18:40:17.951 kid1| client_side.cc(3904) getSslContextStart:
SSL certificate for /C=US/ST=CA/L=Menlo Park/O=Facebook,
Inc./CN=*.facebook.com+Sign=signTrusted have found in cache
2014/10/16 18:40:17.952 kid1| client_side.cc(3906) getSslContextStart:
Cached SSL certificate for /C=US/ST=CA/L=Menlo Park/O=Facebook,
Inc./CN=*.facebook.com+Sign=signTrusted is valid
2014/10/16 18:40:17.956 kid1| ctx: enter level  0: 'www.facebook.com:443'
2014/10/16 18:40:17.956 kid1| HttpHeader.cc(1531) ~HttpHeaderEntry:
destroying entry 0x30c0810: 'Host: www.facebook.com:443'

-- 
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1



From apfelstrudel at op.pl  Thu Oct 16 08:13:24 2014
From: apfelstrudel at op.pl (apfelstrudel)
Date: Thu, 16 Oct 2014 10:13:24 +0200
Subject: [squid-users] ssl-bump doesn't decrypt https traffic - please help
Message-ID: <29852333-e6e8a806df4128b1fd29b5f8b8b68ea9@pmq4v.m5r2.onet>

Hello.
I am trying to get ssl-bump to decrypt https traffic transparently so that I could filter out adult videos from youtube and to globally enforce google safesearch on my network with diladele web safety. I also want to run dansguardian to filter http. I managed to pass https traffic transparently to squid but ssl-bump doesn't decrypt it. In logs I can see the https websites but in an encrypted form of website's.ip.address:port (45.231.21.56:443 for example) instead of https url (like https://youtube.com). That means that traffic is still encrypted and because of that, diladele can't filter https. The squid is installed on an eee pc netbook with fedora 20 installed. This machine is also my router and a network gateway. 172.16.34.254 is the ip on which the netbook "sees" the internal network, which consists of: 1 tp-link router directly connected to the eee. Thas router is connected wirelessly (Wi-Fi antenna) to the second TP-Link router (bridge) in my house. The bridge router is then connected by an ethernet cable to another router to which my devices finally (phone, tablet, pc, printer) connect. So in summary: ?My device (PC, tablet, phone) ----> Router (Netgear) ?----> TP-Link Bridge Router ------> Router (TP-Link) ----> Network gateway/router (eee pc running fedora 20) with squid installed. With the current configuration dansguardian works (http), diladele web safety works (only http) and the https traffic is passed transparently through squid, but not decrypted:
?
172.16.34.253 TCP_MISS/301 848 GET http://pl-pl.facebook.com/ - HIER_DIRECT/31.13.93.97 text/html
172.16.34.254 TCP_MISS/200 50622 CONNECT 2.22.52.26:443 - HIER_DIRECT/2.22.52.26 - ?<----- this should be https://pl-pl.facebook.com but ssl-bump doesn't decrypt traffic.
?
The IP addresses on the beginning of each line are different because http requests go from dansguardian internally. The https requests go directly from my internal network.
?
Here's my squid.conf:
acl localnet src 10.0.0.0/8 # RFC1918 possible internal network
acl localnet src 172.16.0.0/12 # RFC1918 possible internal network
acl localnet src 192.168.0.0/16 # RFC1918 possible internal network
acl localnet src fc00::/7 # RFC 4193 local private network range
acl localnet src fe80::/10 # RFC 4291 link-local (directly plugged) machines
acl to_localhost dst 127.0.0.1/8
acl SSL_ports port 443
acl Safe_ports port 80 # http
acl Safe_ports port 21 # ftp
acl Safe_ports port 443 # https
acl Safe_ports port 70 # gopher
acl Safe_ports port 210 # wais
acl Safe_ports port 1025-65535 # unregistered ports
acl Safe_ports port 280 # http-mgmt
acl Safe_ports port 488 # gss-http
acl Safe_ports port 591 # filemaker
acl Safe_ports port 777 # multiling http
acl CONNECT method CONNECT
# Deny requests to certain unsafe ports
http_access deny !Safe_ports
# Deny CONNECT to other than secure SSL ports
http_access deny CONNECT !SSL_ports
# Only allow cachemgr access from localhost
http_access allow localhost manager
http_access deny manager
http_access allow localnet
http_access allow localhost
# And finally deny all other access to this proxy
http_access allow all
http_access allow CONNECT
http_access allow to_localhost
include "/opt/qlproxy/etc/squid/squid.acl"
# Squid normally listens to port 3128
# Dansguardian's port:
http_port 3125
# HTTPS ports, required by diladele web safety:
http_port 3126 intercept
https_port 3127 transparent ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB cert=/opt/qlproxy/etc/myca.pem
http_port 3128 ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB cert=/opt/qlproxy/etc/myca.pem
always_direct allow all
ssl_bump client-first all
#ceritiface storage manager
sslcrtd_program /usr/lib/squid/ssl_crtd -s /var/spool/squid_ssldb -M 4MB
# Uncomment and adjust the following to add a disk cache directory.
#cache_dir ufs /var/spool/squid 100 16 256
# Leave coredumps in the first cache dir
coredump_dir /var/spool/squid
refresh_pattern ^ftp: 1440 20% 1008
refresh_pattern ^gopher: 1440 0% 1440
refresh_pattern -i (/cgi-bin/|\?) 0 0% 0
refresh_pattern . 0 20% 4320
# Squid-Diladele integration:
icap_enable on
icap_preview_enable on
icap_preview_size 4096
icap_persistent_connections on
icap_send_client_ip on
icap_send_client_username on
icap_client_username_header X-Client-Username
icap_service qlproxy1 reqmod_precache bypass=0 icap://127.0.0.1:1344/reqmod
icap_service qlproxy2 respmod_precache bypass=0 icap://127.0.0.1:1344/respmod
acl qlproxy_icap_edomains dstdomain "/opt/qlproxy/etc/squid/icap_exclusions_domains.conf"
acl qlproxy_icap_etypes rep_mime_type "/opt/qlproxy/etc/squid/icap_exclusions_contenttypes.conf"
adaptation_access qlproxy1 deny qlproxy_icap_edomains
adaptation_access qlproxy2 deny qlproxy_icap_edomains
adaptation_access qlproxy2 deny qlproxy_icap_etypes
adaptation_access qlproxy1 allow all
adaptation_access qlproxy2 allow all
#squid shutdown faster
shutdown_lifetime 3 seconds
--------------------------------------------------
And here are my iptables:
?
*filter
:INPUT DROP [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
-A INPUT -p icmp -j ACCEPT
-A INPUT -i lo -j ACCEPT
# ssh
-A INPUT -p tcp -m tcp --dport 22 -j ACCEPT
# dansguardian
-A INPUT -i p33p1 -p tcp --dport 8080 -j ACCEPT
# squid https
-A INPUT -i p33p1 -p tcp --dport 3128 -j ACCEPT
# 3127 - for intercepted https traffic for Squid
-A INPUT -i p33p1 -p tcp --dport 3127 -j ACCEPT
# squid - allow the redirected trafiic from port 443 to 3128
-A INPUT -m mark --mark 1 -j DROP
# squid - block direct connections to port 3128
-A INPUT -i p33p1 -p tcp --dport 3128 -j REJECT
# connected streams
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
#-A INPUT -j LOG --log-prefix "DROPPED_INPUT: "
COMMIT
*nat
:OUTPUT ACCEPT [0:0]
:PREROUTING ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
# all queries go to opendsns familyshield:
-A PREROUTING -p udp -i p33p1 --dport 53 -j DNAT --to-destination 208.67.222.123:53
# redirection of internal network's http traffic to dansguardian:
-A PREROUTING -p tcp -m tcp -i p33p1 -s 172.16.34.254/32 --dport 80 -j REDIRECT --to-ports 8080
# https redirection to squid
-A PREROUTING -p tcp -m tcp -i p33p1 -s 172.16.34.254/32 --dport 443 -j REDIRECT --to-ports 3127
#NAT
-A POSTROUTING -s 172.16.34.252/30 -j MASQUERADE
COMMIT
*mangle
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
:PREROUTING ACCEPT [0:0]
-A PREROUTING -p tcp -m tcp -i p33p1 --dport 3128 -j MARK --set-mark 1
-A PREROUTING -p tcp --dport 80 -s 127.0.0.1 -j ACCEPT
-A PREROUTING -p tcp --dport 80 -s 172.16.34.253 -j ACCEPT
COMMIT
# Completed
I also tried running squid with the squid -d 10 command but no errors were found:
?
2014/10/16 10:08:46 kid1| HTCP Disabled.
2014/10/16 10:08:46 kid1| Squid plugin modules loaded: 0
2014/10/16 10:08:46 kid1| Adaptation support is on
2014/10/16 10:08:46 kid1| Accepting HTTP Socket connections at local=[::]:3125 remote=[::] FD 21 flags=9
2014/10/16 10:08:46 kid1| Accepting NAT intercepted HTTP Socket connections at local=0.0.0.0:3126 remote=[::] FD 22 flags=41
2014/10/16 10:08:46 kid1| Accepting SSL bumped HTTP Socket connections at local=[::]:3128 remote=[::] FD 23 flags=9
2014/10/16 10:08:46 kid1| Accepting NAT intercepted SSL bumped HTTPS Socket connections at local=0.0.0.0:3127 remote=[::] FD 24 flags=41
2014/10/16 10:08:47 kid1| storeLateRelease: released 0 objects
How can I get squid to decrypt https traffic with this configuration? Any help will be much appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141016/e84255b3/attachment.htm>

From santosh.pai at vigyanlabs.com  Thu Oct 16 08:29:07 2014
From: santosh.pai at vigyanlabs.com (santosh)
Date: Thu, 16 Oct 2014 01:29:07 -0700 (PDT)
Subject: [squid-users] Unable to display splash page on inactive timeout
In-Reply-To: <1413358280087-4667887.post@n4.nabble.com>
References: <1413358280087-4667887.post@n4.nabble.com>
Message-ID: <1413448147812-4667910.post@n4.nabble.com>

Hello Amos,

I'm just trying to create forceful re-authentication , this is just for
curiosity to see how things works by changing the credentialsttl value in
the conf file .I have set it as 2 mnutes and below is what it looks in conf
file , but i dont get any reprompting for username and password after two
minutes , is the configuration correct ?

auth_param basic program /usr/lib/squid3/basic_ldap_auth
auth_param basic children 5 startup=5 idle=1
auth_param basic realm Squid proxy-caching web server
auth_param basic credentialsttl 2 minutes



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Unable-to-display-splash-page-on-inactive-timeout-tp4667887p4667910.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From Jason_Haar at trimble.com  Thu Oct 16 09:05:43 2014
From: Jason_Haar at trimble.com (Jason Haar)
Date: Thu, 16 Oct 2014 22:05:43 +1300
Subject: [squid-users] squid-3.4.8 sslbump breaks facebook
In-Reply-To: <543F79D1.8080705@trimble.com>
References: <543F79D1.8080705@trimble.com>
Message-ID: <543F8A67.8070003@trimble.com>

On 16/10/14 20:54, Jason Haar wrote:
> I also checked the ssl_db/certs dir and
> removed the facebook certs and restarted - didn't help
let me rephrase that. I deleted the dirtree and re-ran "ssl_crtd -s
/usr/local/squid/var/lib/ssl_db -c" - ie restarted with an empty cache.
It didn't help. It created a new fake facebook cert - but the cert
doesn't fully match the characteristics of the "real" cert

-- 
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1



From ammdispose-squid at yahoo.com  Thu Oct 16 09:14:26 2014
From: ammdispose-squid at yahoo.com (Amm)
Date: Thu, 16 Oct 2014 14:44:26 +0530
Subject: [squid-users] squid-3.4.8 sslbump breaks facebook
In-Reply-To: <543F8A67.8070003@trimble.com>
References: <543F79D1.8080705@trimble.com> <543F8A67.8070003@trimble.com>
Message-ID: <543F8C72.80204@yahoo.com>


On 10/16/2014 02:35 PM, Jason Haar wrote:
> On 16/10/14 20:54, Jason Haar wrote:
>> I also checked the ssl_db/certs dir and
>> removed the facebook certs and restarted - didn't help
> let me rephrase that. I deleted the dirtree and re-ran "ssl_crtd -s
> /usr/local/squid/var/lib/ssl_db -c" - ie restarted with an empty cache.
> It didn't help. It created a new fake facebook cert - but the cert
> doesn't fully match the characteristics of the "real" cert

http://bugs.squid-cache.org/show_bug.cgi?id=4102

Please add weight to bug report :)

Amm.



From squid3 at treenet.co.nz  Thu Oct 16 10:05:59 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 16 Oct 2014 23:05:59 +1300
Subject: [squid-users] Unable to display splash page on inactive timeout
In-Reply-To: <1413448147812-4667910.post@n4.nabble.com>
References: <1413358280087-4667887.post@n4.nabble.com>
 <1413448147812-4667910.post@n4.nabble.com>
Message-ID: <543F9887.2000800@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 16/10/2014 9:29 p.m., santosh wrote:
> Hello Amos,
> 
> I'm just trying to create forceful re-authentication , this is just
> for curiosity to see how things works by changing the
> credentialsttl value in the conf file .I have set it as 2 mnutes
> and below is what it looks in conf file , but i dont get any
> reprompting for username and password after two minutes , is the
> configuration correct ?

If it is just for investigation of credentialsttl then you definitaly
are going about it all wrong.

credentialsttl is how often Squid sends a helper lookup to the backend
authentication server. Nothing more.


> 
> auth_param basic program /usr/lib/squid3/basic_ldap_auth auth_param
> basic children 5 startup=5 idle=1 auth_param basic realm Squid
> proxy-caching web server auth_param basic credentialsttl 2 minutes

Expected behaviour with this:

 * client sends credentials on every request, which moves the auth
through two basic states

[state A - DUNNO]

 *  When client sends a request, credentials from that request gets
sent to a helper for validation,

[state B - AUTHENTICATED/INVALID]

 * all requests which use the *same* credentials, will be allowed or
denied as per helper OK/ERR result,

 * if less than 120 seconds have passed stay in state B.

 * when 120 seconds have passed, the helper result for those
credentials is expired, move back to state A.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUP5iHAAoJELJo5wb/XPRjNr4H/RQBcHvNqBJ0lrWjElLt4PQv
JIBw+k0O6WNkQ18oouiUO9G6C2pBKxfjxsV2D3bxP6Y5e3F4zypFhTBFdnA5ccsp
2ipQ9FFKBS8fvks+rnZtYiHSzDgIK58RGXl6qgARJvBrrnWP9/l58VG53o3bqEUR
0I3Rw5F4p7AC3Zjrp3fo80Th9uOuYigesk33dyTnIsRr806fGrue12kLQwG44sl/
QxHht8OafSfEgA7scATDfhQAfmsDcndrY/UF9NsDp5XBZXaZAkGBwo4eYGD7wLZ9
+GHzn13jtHNVwYvjOjBkf1ac3iPgB6RTWMsOsbFWJPc0oSRT6YesAuTqVYDmy+g=
=56NS
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Thu Oct 16 10:20:33 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 16 Oct 2014 23:20:33 +1300
Subject: [squid-users] ssl-bump doesn't decrypt https traffic - please
 help
In-Reply-To: <29852333-e6e8a806df4128b1fd29b5f8b8b68ea9@pmq4v.m5r2.onet>
References: <29852333-e6e8a806df4128b1fd29b5f8b8b68ea9@pmq4v.m5r2.onet>
Message-ID: <543F9BF1.80300@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 16/10/2014 9:13 p.m., apfelstrudel wrote:
> Hello. I am trying to get ssl-bump to decrypt https traffic
> transparently so that I could filter out adult videos from youtube
> and to globally enforce google safesearch on my network with
> diladele web safety. I also want to run dansguardian to filter
> http. I managed to pass https traffic transparently to squid but
> ssl-bump doesn't decrypt it. In logs I can see the https websites
> but in an encrypted form of website's.ip.address:port
> (45.231.21.56:443 for example) instead of https url (like
> https://youtube.com). That means that traffic is still encrypted
> and because of that, diladele can't filter https. The squid is
> installed on an eee pc netbook with fedora 20 installed. This
> machine is also my router and a network gateway. 172.16.34.254 is
> the ip on which the netbook "sees" the internal network, which
> consists of: 1 tp-link router directly connected to the eee. Thas
> router is connected wirelessly (Wi-Fi antenna) to the second
> TP-Link router (bridge) in my house. The bridge router is then
> connected by an ethernet cable to another router to which my
> devices finally (phone, tablet, pc, printer) connect. So in
> summary:  My device (PC, tablet, phone) ----> Router (Netgear)
> ----> TP-Link Bridge Router ------> Router (TP-Link) ----> Network
> gateway/router (eee pc running fedora 20) with squid installed.
> With the current configuration dansguardian works (http), diladele
> web safety works (only http) and the https traffic is passed
> transparently through squid, but not decrypted:
> 
> 172.16.34.253 TCP_MISS/301 848 GET http://pl-pl.facebook.com/ -
> HIER_DIRECT/31.13.93.97 text/html 172.16.34.254 TCP_MISS/200 50622
> CONNECT 2.22.52.26:443 - HIER_DIRECT/2.22.52.26 -  <----- this
> should be https://pl-pl.facebook.com but ssl-bump doesn't decrypt
> traffic.
> 

Nope, the log line is correct. It simply states that a tunnel
CONNECT-ion was requested by the client to some server on port 443,
Squid permitted it.

Please read http://tools.ietf.org/html/rfc7230#section-5.3.3 for
details of the URL syntax. The surrounding section 5.3.* contain
details of other URL types you may also spot in your logs.

What it demonstrates is that your test client software is explicitly
configured to use Squid as a proxy on port 3125 with no interception
happening (and thus none of the ssl-bump ports being used).

Or, that the client software is configured to use some other proxy
elsewhere which has its explicit proxy port on 80.



> The IP addresses on the beginning of each line are different
> because http requests go from dansguardian internally. The https
> requests go directly from my internal network.
> 
> Here's my squid.conf: acl localnet src 10.0.0.0/8 # RFC1918
> possible internal network acl localnet src 172.16.0.0/12 # RFC1918
> possible internal network acl localnet src 192.168.0.0/16 # RFC1918
> possible internal network acl localnet src fc00::/7 # RFC 4193
> local private network range acl localnet src fe80::/10 # RFC 4291
> link-local (directly plugged) machines acl to_localhost dst
> 127.0.0.1/8

 NP: to_localhost is pre-defined to be the specific IP addresses which
is dangerous to receive general traffic on. That includes the 127.*
ranges.

> acl SSL_ports port 443 acl Safe_ports port 80 # http acl Safe_ports
> port 21 # ftp acl Safe_ports port 443 # https acl Safe_ports port
> 70 # gopher acl Safe_ports port 210 # wais acl Safe_ports port
> 1025-65535 # unregistered ports acl Safe_ports port 280 #
> http-mgmt acl Safe_ports port 488 # gss-http acl Safe_ports port
> 591 # filemaker acl Safe_ports port 777 # multiling http acl
> CONNECT method CONNECT # Deny requests to certain unsafe ports 
> http_access deny !Safe_ports # Deny CONNECT to other than secure
> SSL ports http_access deny CONNECT !SSL_ports # Only allow cachemgr
> access from localhost http_access allow localhost manager 
> http_access deny manager http_access allow localnet http_access
> allow localhost

Since DG is operating on the same machine you would do well to:
 a) ensure DG is configured to pass proxy traffic to Squid via 127.0.0.1
 b) configure DG to send X-Forwarded-For header
 c) add the following to squid.conf:

  follow_x_forwarded_for allow localhost
  follow_x_forwarded_for deny all

that will let Squid log the details of clients connecting to DG.


> # And finally deny all other access to this proxy http_access allow
> all

... pretty funny way to configure "deny all".

BTW: the clients IP is part of "localnet" definition. So legitimate
traffic should not be getting to that "allow all". Only remote
(attackers?) will be benefit from that rule.

ALso, all http_access lines after this one are useless garbage. They
will never match.

> http_access allow CONNECT http_access allow to_localhost include
> "/opt/qlproxy/etc/squid/squid.acl" # Squid normally listens to port
> 3128 # Dansguardian's port: http_port 3125

Just use 3128 for DansGuardian.

The existence of ssl-bump options does not matter for DG output HTTP
traffic going through there.

Whereas, if CONNECT tunnels are being passed to DG (or created by DG
to relay HTTPS traffic) then you need them to be bumped.


> # HTTPS ports, required by diladele web safety: http_port 3126
> intercept

... this 3126 is not an HTTPS port as documented. It is fine as
configured. Just saying your comment above it is misleading.

> https_port 3127 transparent ssl-bump generate-host-certificates=on
> dynamic_cert_mem_cache_size=4MB cert=/opt/qlproxy/etc/myca.pem 
> http_port 3128 ssl-bump generate-host-certificates=on
> dynamic_cert_mem_cache_size=4MB cert=/opt/qlproxy/etc/myca.pem 
> always_direct allow all ssl_bump client-first all

client-first bumping does not work much anymore. Use server-first instead.

If you are not using the test squid versions for bumping, you need to
upgrade. ssl-bump functionality is part of an arms race between
browsers and websites trying to increase security & privacy and admin
like you trying to break it. Like any arms race the technology changes
fast.

<snip remainder of the config>

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUP5vxAAoJELJo5wb/XPRjbdgH/Rw/THpi0hMDt9zzyLQCOty/
fm9Ija0r83V8sfTpBzlRj35S4ZpQT2hf4+94OJNIZIueW75nAvMUYfRnvn1r6C6w
j+hXumdo2PxhQ+TQhuqgbSUNpXEm2x93CQETKKf3dlWlDAXxtNBSoKClNpHOHWcZ
FZxPb/fyEBd6s26wt3Q49qbJ1Sg7o0D7aVRh7rPlnC4MS4jmkDamDIgQ7ouW62I6
5eI1sLgYkLpdcM0P/nhNy+JSH3NgayHledrFPYHdBgjn+Co4G72M7XGS4dUfwM4t
mQKg6QtTUPma9mR7iNkXTFIw0lJLrbQz98d9Mt78PwqEmJrcAywhqB9qbU1rQLE=
=UaVG
-----END PGP SIGNATURE-----


From rafael.akchurin at diladele.com  Thu Oct 16 10:21:56 2014
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Thu, 16 Oct 2014 10:21:56 +0000
Subject: [squid-users] ssl-bump doesn't decrypt https traffic - please
 help
In-Reply-To: <29852333-e6e8a806df4128b1fd29b5f8b8b68ea9@pmq4v.m5r2.onet>
References: <29852333-e6e8a806df4128b1fd29b5f8b8b68ea9@pmq4v.m5r2.onet>
Message-ID: <1413454915975.71780@diladele.com>

Hello Strudel,


Please remove the 'ssl_bump client-first all' directive from your squid.conf because the 'include "/opt/qlproxy/etc/squid/squid.acl"' already contains 'ssl_bump server-first all' (or should contain).


This file is generated from Web UI of Diladele when you click the "enable ssh filteiring for all sites" settings. By default though it is set to 'off' to comply with legal regulations in some countries.


It would also be nice if you could post the contents of it either here or in private e-mail to me not to pollute the overall discussion.


Best regards,

Rafael Akchurin

Diladele B.V.



________________________________
From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of apfelstrudel <apfelstrudel at op.pl>
Sent: Thursday, October 16, 2014 10:13 AM
To: squid-users at squid-cache.org
Subject: [squid-users] ssl-bump doesn't decrypt https traffic - please help

Hello.
I am trying to get ssl-bump to decrypt https traffic transparently so that I could filter out adult videos from youtube and to globally enforce google safesearch on my network with diladele web safety. I also want to run dansguardian to filter http. I managed to pass https traffic transparently to squid but ssl-bump doesn't decrypt it. In logs I can see the https websites but in an encrypted form of website's.ip.address:port (45.231.21.56:443 for example) instead of https url (like https://youtube.com). That means that traffic is still encrypted and because of that, diladele can't filter https. The squid is installed on an eee pc netbook with fedora 20 installed. This machine is also my router and a network gateway. 172.16.34.254 is the ip on which the netbook "sees" the internal network, which consists of: 1 tp-link router directly connected to the eee. Thas router is connected wirelessly (Wi-Fi antenna) to the second TP-Link router (bridge) in my house. The bridge router is then connected by an ethernet cable to another router to which my devices finally (phone, tablet, pc, printer) connect. So in summary:  My device (PC, tablet, phone) ----> Router (Netgear)  ----> TP-Link Bridge Router ------> Router (TP-Link) ----> Network gateway/router (eee pc running fedora 20) with squid installed. With the current configuration dansguardian works (http), diladele web safety works (only http) and the https traffic is passed transparently through squid, but not decrypted:

172.16.34.253 TCP_MISS/301 848 GET http://pl-pl.facebook.com/ - HIER_DIRECT/31.13.93.97 text/html
172.16.34.254 TCP_MISS/200 50622 CONNECT 2.22.52.26:443 - HIER_DIRECT/2.22.52.26 -  <----- this should be https://pl-pl.facebook.com but ssl-bump doesn't decrypt traffic.

The IP addresses on the beginning of each line are different because http requests go from dansguardian internally. The https requests go directly from my internal network.

Here's my squid.conf:

acl localnet src 10.0.0.0/8 # RFC1918 possible internal network
acl localnet src 172.16.0.0/12 # RFC1918 possible internal network
acl localnet src 192.168.0.0/16 # RFC1918 possible internal network
acl localnet src fc00::/7 # RFC 4193 local private network range
acl localnet src fe80::/10 # RFC 4291 link-local (directly plugged) machines
acl to_localhost dst 127.0.0.1/8

acl SSL_ports port 443
acl Safe_ports port 80 # http
acl Safe_ports port 21 # ftp
acl Safe_ports port 443 # https
acl Safe_ports port 70 # gopher
acl Safe_ports port 210 # wais
acl Safe_ports port 1025-65535 # unregistered ports
acl Safe_ports port 280 # http-mgmt
acl Safe_ports port 488 # gss-http
acl Safe_ports port 591 # filemaker
acl Safe_ports port 777 # multiling http
acl CONNECT method CONNECT

# Deny requests to certain unsafe ports
http_access deny !Safe_ports

# Deny CONNECT to other than secure SSL ports
http_access deny CONNECT !SSL_ports

# Only allow cachemgr access from localhost
http_access allow localhost manager
http_access deny manager

http_access allow localnet
http_access allow localhost

# And finally deny all other access to this proxy
http_access allow all
http_access allow CONNECT
http_access allow to_localhost

include "/opt/qlproxy/etc/squid/squid.acl"

# Squid normally listens to port 3128
# Dansguardian's port:
http_port 3125
# HTTPS ports, required by diladele web safety:
http_port 3126 intercept
https_port 3127 transparent ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB cert=/opt/qlproxy/etc/myca.pem
http_port 3128 ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB cert=/opt/qlproxy/etc/myca.pem
always_direct allow all
ssl_bump client-first all

#ceritiface storage manager
sslcrtd_program /usr/lib/squid/ssl_crtd -s /var/spool/squid_ssldb -M 4MB

# Uncomment and adjust the following to add a disk cache directory.
#cache_dir ufs /var/spool/squid 100 16 256

# Leave coredumps in the first cache dir
coredump_dir /var/spool/squid

refresh_pattern ^ftp: 1440 20% 1008
refresh_pattern ^gopher: 1440 0% 1440
refresh_pattern -i (/cgi-bin/|\?) 0 0% 0
refresh_pattern . 0 20% 4320

# Squid-Diladele integration:
icap_enable on
icap_preview_enable on
icap_preview_size 4096
icap_persistent_connections on
icap_send_client_ip on
icap_send_client_username on
icap_client_username_header X-Client-Username
icap_service qlproxy1 reqmod_precache bypass=0 icap://127.0.0.1:1344/reqmod
icap_service qlproxy2 respmod_precache bypass=0 icap://127.0.0.1:1344/respmod
acl qlproxy_icap_edomains dstdomain "/opt/qlproxy/etc/squid/icap_exclusions_domains.conf"
acl qlproxy_icap_etypes rep_mime_type "/opt/qlproxy/etc/squid/icap_exclusions_contenttypes.conf"
adaptation_access qlproxy1 deny qlproxy_icap_edomains
adaptation_access qlproxy2 deny qlproxy_icap_edomains
adaptation_access qlproxy2 deny qlproxy_icap_etypes
adaptation_access qlproxy1 allow all
adaptation_access qlproxy2 allow all
#squid shutdown faster
shutdown_lifetime 3 seconds
--------------------------------------------------
And here are my iptables:

*filter
:INPUT DROP [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
-A INPUT -p icmp -j ACCEPT
-A INPUT -i lo -j ACCEPT
# ssh
-A INPUT -p tcp -m tcp --dport 22 -j ACCEPT
# dansguardian
-A INPUT -i p33p1 -p tcp --dport 8080 -j ACCEPT
# squid https
-A INPUT -i p33p1 -p tcp --dport 3128 -j ACCEPT
# 3127 - for intercepted https traffic for Squid
-A INPUT -i p33p1 -p tcp --dport 3127 -j ACCEPT
# squid - allow the redirected trafiic from port 443 to 3128
-A INPUT -m mark --mark 1 -j DROP
# squid - block direct connections to port 3128
-A INPUT -i p33p1 -p tcp --dport 3128 -j REJECT
# connected streams
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
#-A INPUT -j LOG --log-prefix "DROPPED_INPUT: "
COMMIT
*nat
:OUTPUT ACCEPT [0:0]
:PREROUTING ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
# all queries go to opendsns familyshield:
-A PREROUTING -p udp -i p33p1 --dport 53 -j DNAT --to-destination 208.67.222.123:53
# redirection of internal network's http traffic to dansguardian:
-A PREROUTING -p tcp -m tcp -i p33p1 -s 172.16.34.254/32 --dport 80 -j REDIRECT --to-ports 8080
# https redirection to squid
-A PREROUTING -p tcp -m tcp -i p33p1 -s 172.16.34.254/32 --dport 443 -j REDIRECT --to-ports 3127
#NAT
-A POSTROUTING -s 172.16.34.252/30 -j MASQUERADE
COMMIT
*mangle
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
:PREROUTING ACCEPT [0:0]
-A PREROUTING -p tcp -m tcp -i p33p1 --dport 3128 -j MARK --set-mark 1
-A PREROUTING -p tcp --dport 80 -s 127.0.0.1 -j ACCEPT
-A PREROUTING -p tcp --dport 80 -s 172.16.34.253 -j ACCEPT
COMMIT
# Completed
I also tried running squid with the squid -d 10 command but no errors were found:

2014/10/16 10:08:46 kid1| HTCP Disabled.
2014/10/16 10:08:46 kid1| Squid plugin modules loaded: 0
2014/10/16 10:08:46 kid1| Adaptation support is on
2014/10/16 10:08:46 kid1| Accepting HTTP Socket connections at local=[::]:3125 remote=[::] FD 21 flags=9
2014/10/16 10:08:46 kid1| Accepting NAT intercepted HTTP Socket connections at local=0.0.0.0:3126 remote=[::] FD 22 flags=41
2014/10/16 10:08:46 kid1| Accepting SSL bumped HTTP Socket connections at local=[::]:3128 remote=[::] FD 23 flags=9
2014/10/16 10:08:46 kid1| Accepting NAT intercepted SSL bumped HTTPS Socket connections at local=0.0.0.0:3127 remote=[::] FD 24 flags=41
2014/10/16 10:08:47 kid1| storeLateRelease: released 0 objects
How can I get squid to decrypt https traffic with this configuration? Any help will be much appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141016/217caa06/attachment.htm>

From daniel.rieken at gmx.net  Thu Oct 16 14:35:04 2014
From: daniel.rieken at gmx.net (daniel.rieken at gmx.net)
Date: Thu, 16 Oct 2014 16:35:04 +0200
Subject: [squid-users] DEAD Parent detection
Message-ID: <trinity-3d22841b-ce8b-449f-869c-7b354aa54b85-1413470104094@3capp-gmx-bs62>

Hi guys,

I got a problem with DEAD Parent detection.
I've configured 2 parents in squid.conf:

cache_peer 10.0.0.101 parent 3128 0 default name=TEST1
cache_peer 10.0.0.102 parent 3128 0 name=TEST2

So when the first parent isn't reachable, squid detects this (Detected DEAD Parent: TEST1) and is using the second parent.
This works fine for HTTP-Traffic. But for HTTPS-Traffic the DEAD Parent detection doesn't work. Squid is trying to send all requests to the first parent and is not switching to the second one.


What am I doing wrong? is there anything I missed? Or is it a bug?
I'm using  squid 3.1 (Debian wheezy)

Thanks for your help,
Daniel


From sudakov at sibptus.tomsk.ru  Thu Oct 16 16:19:28 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Thu, 16 Oct 2014 23:19:28 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <m1iqc6$m3g$1@ger.gmane.org>
References: <20141006040725.GA31642@admin.sibptus.tomsk.ru>
 <20141006052346.GA32369@admin.sibptus.tomsk.ru>
 <20141007070403.GA57384@admin.sibptus.tomsk.ru>
 <20141007083542.GA60425@admin.sibptus.tomsk.ru>
 <m11nv3$nk8$1@ger.gmane.org>
 <20141008032925.GA77544@admin.sibptus.tomsk.ru>
 <m14if3$1ul$2@ger.gmane.org>
 <20141009021821.GA3372@admin.sibptus.tomsk.ru>
 <20141014052401.GA8411@admin.sibptus.tomsk.ru>
 <m1iqc6$m3g$1@ger.gmane.org>
Message-ID: <20141016161928.GA49304@admin.sibptus.tomsk.ru>

This question is neither exactly squid-related nor Heimdal-related, but
maybe someone guru could shed some light.

I configure MSIE to use the proxy server "proxy.sibptus.transneft.ru".
On starting MSIE, some Windows hosts request a ticket for the
principal  HTTP/proxy.sibptus.transneft.ru" and receive it from the DC
and get authenticated successfully by squid. So far so good.

However, some other Windows hosts when requesting a ticket for
HTTP/proxy.sibptus.transneft.ru, in fact receive a ticket for
squiduser at SIBPTUS.TRANSNEFT.RU (kerbtray.exe shows this) and therefore
fail to get authenticated by squid.

"squiduser at SIBPTUS.TRANSNEFT.RU" is the AD account to which the SPN
"HTTP/proxy.sibptus.transneft.ru" is bound. But why do they receive a
ticket for a different name than requested, is beyond me.

Has anyone seen anything like this?

The KDC involved is the w2k AD.

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru


From christos at chtsanti.net  Thu Oct 16 16:59:21 2014
From: christos at chtsanti.net (Christos Tsantilas)
Date: Thu, 16 Oct 2014 19:59:21 +0300
Subject: [squid-users] squid-3.4.8 sslbump breaks facebook
In-Reply-To: <543F8C72.80204@yahoo.com>
References: <543F79D1.8080705@trimble.com> <543F8A67.8070003@trimble.com>
 <543F8C72.80204@yahoo.com>
Message-ID: <543FF969.40706@chtsanti.net>


A patch for this bug attached to 4102 bug report.
Please test it and report any problem.

Regards,
   Christos



On 10/16/2014 12:14 PM, Amm wrote:
>
> On 10/16/2014 02:35 PM, Jason Haar wrote:
>> On 16/10/14 20:54, Jason Haar wrote:
>>> I also checked the ssl_db/certs dir and
>>> removed the facebook certs and restarted - didn't help
>> let me rephrase that. I deleted the dirtree and re-ran "ssl_crtd -s
>> /usr/local/squid/var/lib/ssl_db -c" - ie restarted with an empty cache.
>> It didn't help. It created a new fake facebook cert - but the cert
>> doesn't fully match the characteristics of the "real" cert
>
> http://bugs.squid-cache.org/show_bug.cgi?id=4102
>
> Please add weight to bug report :)
>
> Amm.



From huaraz at moeller.plus.com  Thu Oct 16 19:04:54 2014
From: huaraz at moeller.plus.com (Markus Moeller)
Date: Thu, 16 Oct 2014 20:04:54 +0100
Subject: [squid-users] Squid,
	Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
	3.4.7.)
In-Reply-To: <20141016161928.GA49304@admin.sibptus.tomsk.ru>
References: <20141006040725.GA31642@admin.sibptus.tomsk.ru>
 <20141006052346.GA32369@admin.sibptus.tomsk.ru>
 <20141007070403.GA57384@admin.sibptus.tomsk.ru>
 <20141007083542.GA60425@admin.sibptus.tomsk.ru> <m11nv3$nk8$1@ger.gmane.org>
 <20141008032925.GA77544@admin.sibptus.tomsk.ru> <m14if3$1ul$2@ger.gmane.org>
 <20141009021821.GA3372@admin.sibptus.tomsk.ru>
 <20141014052401.GA8411@admin.sibptus.tomsk.ru> <m1iqc6$m3g$1@ger.gmane.org>
 <20141016161928.GA49304@admin.sibptus.tomsk.ru>
Message-ID: <m1p4sp$aq3$1@ger.gmane.org>

Hi Victor,

   That sounds a bit strange. Can you capture with wireshark the traffic on 
port 88  on the system which has squiduser in the cache ( best after a clear 
the cache with kerbtray first) when accessing squid and send it to me as cap 
file ?

Markus

"Victor Sudakov"  wrote in message 
news:20141016161928.GA49304 at admin.sibptus.tomsk.ru...

This question is neither exactly squid-related nor Heimdal-related, but
maybe someone guru could shed some light.

I configure MSIE to use the proxy server "proxy.sibptus.transneft.ru".
On starting MSIE, some Windows hosts request a ticket for the
principal  HTTP/proxy.sibptus.transneft.ru" and receive it from the DC
and get authenticated successfully by squid. So far so good.

However, some other Windows hosts when requesting a ticket for
HTTP/proxy.sibptus.transneft.ru, in fact receive a ticket for
squiduser at SIBPTUS.TRANSNEFT.RU (kerbtray.exe shows this) and therefore
fail to get authenticated by squid.

"squiduser at SIBPTUS.TRANSNEFT.RU" is the AD account to which the SPN
"HTTP/proxy.sibptus.transneft.ru" is bound. But why do they receive a
ticket for a different name than requested, is beyond me.

Has anyone seen anything like this?

The KDC involved is the w2k AD.

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users 




From phatbuckett at gmail.com  Thu Oct 16 19:10:52 2014
From: phatbuckett at gmail.com (Darren Spruell)
Date: Thu, 16 Oct 2014 12:10:52 -0700
Subject: [squid-users] Supported configuration for adding origin server IP
	in response header
Message-ID: <CAKVSOJVm6MSE9LZce3-Hbzab+vsaBL_-uAwifhDnt6K67hBw5w@mail.gmail.com>

Had a use case to ask about, apologies if I missed in docs. Is there a
configuration that allows squid running as forward proxy to add a
custom response header containing the origin server IP address that
served the resource? Assuming no cache hierarchy.

In the event that the resource is served from cache, would be
interesting if squid were able to track the IP address from which the
cached resource was originally retrieved to include in responses. In
the event that's not possible, then the IP address of the cache itself
as well as an indication that the resource was served from cache
rather than an upstream origin.

Most resources seem to cover including this information in the access
log, however I'm interested in having the data in the HTTP response
for this case.

-- 
Darren Spruell
phatbuckett at gmail.com


From squid3 at treenet.co.nz  Thu Oct 16 19:40:52 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 17 Oct 2014 08:40:52 +1300
Subject: [squid-users] Supported configuration for adding origin server
 IP in response header
In-Reply-To: <CAKVSOJVm6MSE9LZce3-Hbzab+vsaBL_-uAwifhDnt6K67hBw5w@mail.gmail.com>
References: <CAKVSOJVm6MSE9LZce3-Hbzab+vsaBL_-uAwifhDnt6K67hBw5w@mail.gmail.com>
Message-ID: <54401F44.7080408@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 17/10/2014 8:10 a.m., Darren Spruell wrote:
> Had a use case to ask about, apologies if I missed in docs. Is
> there a configuration that allows squid running as forward proxy to
> add a custom response header containing the origin server IP
> address that served the resource? Assuming no cache hierarchy.
> 
> In the event that the resource is served from cache, would be 
> interesting if squid were able to track the IP address from which
> the cached resource was originally retrieved to include in
> responses. In the event that's not possible, then the IP address of
> the cache itself as well as an indication that the resource was
> served from cache rather than an upstream origin.
> 
> Most resources seem to cover including this information in the
> access log, however I'm interested in having the data in the HTTP
> response for this case.
> 

IP address is not much useful in the response - any given machine has
multiple of those and they are also shared between anycast servers or
load balancers.

It is also a mistake to think of "the" server as being one machine. It
is becomming extremely popular to use CDN services these days. CDN are
reverse-proxy services in one form or another. So "the" server may be
a chain of servers on some path through a server farm.


1) The Via header is closest to what you are seeking. In responses it
contains each servers FQDN or an unique alias. It is supposed to
contain a record of the whole chain of machines the message traversed.
 - The problem is that a lot of admin disable it or strip it out of
the traffic. So you may get a proper chain or only what your proxy is
adding, with no easy way to identify missing chain data.


2) If the respone contains an Age: header then it has been cached.


3) Squid also adds X-Cache* headers indicating HIT/MISS status. But
those contain misinformation on REFRESH'd responses.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUQB9EAAoJELJo5wb/XPRjoWsIANzZ03aSY1nHb6p9pDXGSKmu
4klFIaQSRi5VKQn2pbZljzxfoAO3Ev3sQBdbyoXzw14cv4EKXA9l5Jj+Q/XjG8Lh
ab07tcdordERsmH3iUmSpgOwRxvBoEI5HKqeKli4S37JjHOnZ+l/oU2MYZ2LTyJ7
pmnCWOJURjLlPBfEWCzh8eI6M1c5v56kS77qINapjK3qVqoc7UO5wYUTEm/S6iSX
EhmsIxrkCH4K3lZo74Krz4/sBcDViSZpfYE9SZeKlq9pakSH3uH4PU9Jw1qHYm6P
KE7clU+5DNMm6q0YR6z0GE0vw/8xFFrWkCCxXagRF0dOlbgIfE75w0nyy4k+jTg=
=s0Ul
-----END PGP SIGNATURE-----


From phatbuckett at gmail.com  Thu Oct 16 20:29:23 2014
From: phatbuckett at gmail.com (Darren Spruell)
Date: Thu, 16 Oct 2014 13:29:23 -0700
Subject: [squid-users] Supported configuration for adding origin server
 IP in response header
In-Reply-To: <54401F44.7080408@treenet.co.nz>
References: <CAKVSOJVm6MSE9LZce3-Hbzab+vsaBL_-uAwifhDnt6K67hBw5w@mail.gmail.com>
 <54401F44.7080408@treenet.co.nz>
Message-ID: <CAKVSOJU2VzEYfdr9JwY7uyNy=RMUpXrm=P5=hGc8f3DDfVth-A@mail.gmail.com>

On Thu, Oct 16, 2014 at 12:40 PM, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 17/10/2014 8:10 a.m., Darren Spruell wrote:
>> Had a use case to ask about, apologies if I missed in docs. Is
>> there a configuration that allows squid running as forward proxy to
>> add a custom response header containing the origin server IP
>> address that served the resource? Assuming no cache hierarchy.
>>
>> In the event that the resource is served from cache, would be
>> interesting if squid were able to track the IP address from which
>> the cached resource was originally retrieved to include in
>> responses. In the event that's not possible, then the IP address of
>> the cache itself as well as an indication that the resource was
>> served from cache rather than an upstream origin.
>>
>> Most resources seem to cover including this information in the
>> access log, however I'm interested in having the data in the HTTP
>> response for this case.
>>
>
> IP address is not much useful in the response - any given machine has
> multiple of those and they are also shared between anycast servers or
> load balancers.

Usefulness (utility) is in the eye of the beholder. :)

> It is also a mistake to think of "the" server as being one machine. It
> is becomming extremely popular to use CDN services these days. CDN are
> reverse-proxy services in one form or another. So "the" server may be
> a chain of servers on some path through a server farm.

In my case, those abstractions are not significant. The goal is
determining, for a client behind a forward proxy, can the proxy simply
inform the client of the IP address to which the proxy connected to
fetch the resource? The IP address is the key data element for this
case. Even with a CDN the IP address of the frontend is fine.

> 1) The Via header is closest to what you are seeking. In responses it
> contains each servers FQDN or an unique alias. It is supposed to
> contain a record of the whole chain of machines the message traversed.
>  - The problem is that a lot of admin disable it or strip it out of
> the traffic. So you may get a proper chain or only what your proxy is
> adding, with no easy way to identify missing chain data.

I view the Via header as similar to the Received header in SMTP. In
this case it's added by other proxies/caches, correct? But I have no
cache hierarchy, and simply need the IP address of the origin server.
Squid knows what it is, because it opens a socket to it. It can filter
it with ACLs. It can log it in the access log.

Can it add it into a response header?

DS


From squid3 at treenet.co.nz  Thu Oct 16 20:53:36 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 17 Oct 2014 09:53:36 +1300
Subject: [squid-users] Supported configuration for adding origin server
 IP in response header
In-Reply-To: <CAKVSOJU2VzEYfdr9JwY7uyNy=RMUpXrm=P5=hGc8f3DDfVth-A@mail.gmail.com>
References: <CAKVSOJVm6MSE9LZce3-Hbzab+vsaBL_-uAwifhDnt6K67hBw5w@mail.gmail.com>	<54401F44.7080408@treenet.co.nz>
 <CAKVSOJU2VzEYfdr9JwY7uyNy=RMUpXrm=P5=hGc8f3DDfVth-A@mail.gmail.com>
Message-ID: <54403050.6000009@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 17/10/2014 9:29 a.m., Darren Spruell wrote:
> On Thu, Oct 16, 2014 at 12:40 PM, Amos Jeffries
> <squid3 at treenet.co.nz> wrote:
>> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
>> 
>> On 17/10/2014 8:10 a.m., Darren Spruell wrote:
>>> Had a use case to ask about, apologies if I missed in docs. Is 
>>> there a configuration that allows squid running as forward
>>> proxy to add a custom response header containing the origin
>>> server IP address that served the resource? Assuming no cache
>>> hierarchy.
>>> 
>>> In the event that the resource is served from cache, would be 
>>> interesting if squid were able to track the IP address from
>>> which the cached resource was originally retrieved to include
>>> in responses. In the event that's not possible, then the IP
>>> address of the cache itself as well as an indication that the
>>> resource was served from cache rather than an upstream origin.
>>> 
>>> Most resources seem to cover including this information in the 
>>> access log, however I'm interested in having the data in the
>>> HTTP response for this case.
>>> 
>> 
>> IP address is not much useful in the response - any given machine
>> has multiple of those and they are also shared between anycast
>> servers or load balancers.
> 
> Usefulness (utility) is in the eye of the beholder. :)
> 
>> It is also a mistake to think of "the" server as being one
>> machine. It is becomming extremely popular to use CDN services
>> these days. CDN are reverse-proxy services in one form or
>> another. So "the" server may be a chain of servers on some path
>> through a server farm.
> 
> In my case, those abstractions are not significant. The goal is 
> determining, for a client behind a forward proxy, can the proxy
> simply inform the client of the IP address to which the proxy
> connected to fetch the resource? The IP address is the key data
> element for this case. Even with a CDN the IP address of the
> frontend is fine.
> 
>> 1) The Via header is closest to what you are seeking. In
>> responses it contains each servers FQDN or an unique alias. It is
>> supposed to contain a record of the whole chain of machines the
>> message traversed. - The problem is that a lot of admin disable
>> it or strip it out of the traffic. So you may get a proper chain
>> or only what your proxy is adding, with no easy way to identify
>> missing chain data.
> 
> I view the Via header as similar to the Received header in SMTP.
> In this case it's added by other proxies/caches, correct?

Thats a good analogy, but not quite. It MUST be added by all proxies
including Squid.

http://tools.ietf.org/html/rfc7230#section-5.7.1 paragraphs 3 and 5.

In squid.conf simply remove any "via off" you may have. The default is
to comply with the RFC "MUST send" criteria.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUQDBQAAoJELJo5wb/XPRjZqEH+QFbiYfRdd0t+ki+q6tN8TKQ
I5XLxJSrF+yoYjbHb1neJgu1Y2wwfU2cEUgaG5fJhAHpVrdk4/0PdmU6K5aFFs/M
8FD3mDd+Ur/Vwapc55G9GpCis9fr747Yz5mDuqgrSA7JHyHKENUxS09umCvdiB0a
VJmhxjhjOCZFc8Gj/qfvoz3orHwlNDY1ziMkCDIQW6pmwpi61yOust26faRq73yT
TnYKNHCaK9R/ZZ3bQlGQCiWMTdbYcBdD3bxnlG5TaB4xxyTIOxWj1WGmJ3l4Ho8P
gRbk2oNdMrNttXWCeGSt76XuymLY8oQ2RA4IToO1PQMO2QzsxfN1k+uE88pz+lk=
=FC/N
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Thu Oct 16 21:15:15 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 17 Oct 2014 10:15:15 +1300
Subject: [squid-users] DEAD Parent detection
In-Reply-To: <trinity-3d22841b-ce8b-449f-869c-7b354aa54b85-1413470104094@3capp-gmx-bs62>
References: <trinity-3d22841b-ce8b-449f-869c-7b354aa54b85-1413470104094@3capp-gmx-bs62>
Message-ID: <54403563.6080102@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 17/10/2014 3:35 a.m., daniel.rieken at gmx.net wrote:
> Hi guys,
> 
> I got a problem with DEAD Parent detection. I've configured 2
> parents in squid.conf:
> 
> cache_peer 10.0.0.101 parent 3128 0 default name=TEST1 cache_peer
> 10.0.0.102 parent 3128 0 name=TEST2
> 
> So when the first parent isn't reachable, squid detects this
> (Detected DEAD Parent: TEST1) and is using the second parent. This
> works fine for HTTP-Traffic. But for HTTPS-Traffic the DEAD Parent
> detection doesn't work. Squid is trying to send all requests to the
> first parent and is not switching to the second one.
> 
> 
> What am I doing wrong? is there anything I missed? Or is it a bug?

Squid should not be using either parent really, since neither one has
a secured connection. But the top parent has default set to allow its
ue as a server of last resort.

> I'm using  squid 3.1 (Debian wheezy)

Please try upgrading. There is a 3.3.8 release available in the sid or
Jesse repositories which should work a little better - there were some
outgoing server selection changes around 3.2/3.3.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUQDVjAAoJELJo5wb/XPRjS0UH/0E2OaSGpLebeveFLxLvryCS
C/acp9GqyN3ScvLSX6MyinmoOxyaV9YhfOExh97YzUIZDTaFW81/NyDek2LeyuNM
O0Axc3HVBylj2nOH9b83WOC9gfQ2wa6DOAGXr3vZR2GfxAb3aCnhqeDd2Ki0wQhs
mpzLGvkajUorBrhqUxzeUJhoIDgQgT3nHBNu3WZkjgJCqbLMJqZ2WOIjxR1DQ3Ak
8NYQBoz4lfWgsrQ1go9HoEPQQlndw+ikqUP1uSBqj0MUCEasIkFXmvjJKm0X1GJw
AnYT2hp+iQZiDH9/W4V7Vl5870lffKRhFRztwsjuU7031z3cqpmyaXBGz1DhPz8=
=Pb5g
-----END PGP SIGNATURE-----


From robert at gillecaluim.com  Thu Oct 16 21:52:04 2014
From: robert at gillecaluim.com (Robert Watson)
Date: Thu, 16 Oct 2014 14:52:04 -0700
Subject: [squid-users] NET::ERR_CERT_COMMON_NAME_INVALID
In-Reply-To: <CADoG9x=L97xZVmaDGpwKehVHJKETY6Ex15VYwL9k+cZvu0jamA@mail.gmail.com>
References: <CADoG9x=L97xZVmaDGpwKehVHJKETY6Ex15VYwL9k+cZvu0jamA@mail.gmail.com>
Message-ID: <CADoG9xmnLwYpDRYP4cMNQYgNEbD2YfQUj_8+Ssu0DJei9HNPOA@mail.gmail.com>

here is the relevent part of cache.log from a fresh restart and immediately
trying to access this https site...getting a fwdNegotiateSSL: Error
negotiating SSL connection.

*2014/10/16 14:40:07 kid1| Starting Squid Cache version
3.4.8-20140915-r13174 for x86_64-unknown-linux-gnu...*
*2014/10/16 14:40:07 kid1| Process ID 3459*
*2014/10/16 14:40:07 kid1| Process Roles: worker*
*2014/10/16 14:40:07 kid1| With 1024 file descriptors available*
*2014/10/16 14:40:07 kid1| Initializing IP Cache...*
*2014/10/16 14:40:07 kid1| DNS Socket created at [::], FD 7*
*2014/10/16 14:40:07 kid1| DNS Socket created at 0.0.0.0, FD 8*
*2014/10/16 14:40:07 kid1| Adding domain home from /etc/resolv.conf*
*2014/10/16 14:40:07 kid1| Adding domain ihomelan.net <http://ihomelan.net>
from /etc/resolv.conf*
*2014/10/16 14:40:07 kid1| Adding nameserver 192.168.1.1 from
/etc/resolv.conf*
*2014/10/16 14:40:07 kid1| helperOpenServers: Starting 5/32 'ssl_crtd'
processes*
*2014/10/16 14:40:07 kid1| Logfile: opening log /var/log/squid/access.log*
*2014/10/16 14:40:07 kid1| WARNING: log name now starts with a module name.
Use 'stdio:/var/log/squid/access.log'*
*2014/10/16 14:40:07 kid1| Local cache digest enabled; rebuild/rewrite
every 3600/3600 sec*
*2014/10/16 14:40:07 kid1| Store logging disabled*
*2014/10/16 14:40:07 kid1| Swap maxSize 163840000 + 1048576 KB, estimated
12683736 objects*
*2014/10/16 14:40:07 kid1| Target number of buckets: 634186*
*2014/10/16 14:40:07 kid1| Using 1048576 Store buckets*
*2014/10/16 14:40:07 kid1| Max Mem  size: 1048576 KB*
*2014/10/16 14:40:07 kid1| Max Swap size: 163840000 KB*
*2014/10/16 14:40:07 kid1| Rebuilding storage in /cache (clean log)*
*2014/10/16 14:40:07 kid1| Using Least Load store dir selection*
*2014/10/16 14:40:07 kid1| cannot change current directory to /cache/squid:
(2) No such file or directory*
*2014/10/16 14:40:07 kid1| Current Directory is /*
*2014/10/16 14:40:07 kid1| Finished loading MIME types and icons.*
*2014/10/16 14:40:07 kid1| Squid plugin modules loaded: 0*
*2014/10/16 14:40:07 kid1| Adaptation support is on*
*2014/10/16 14:40:07 kid1| Accepting HTTP Socket connections at
local=127.0.0.1:3128 <http://127.0.0.1:3128> remote=[::] FD 22 flags=9*
*2014/10/16 14:40:07 kid1| Accepting NAT intercepted HTTP Socket
connections at local=192.168.2.1:3128 <http://192.168.2.1:3128> remote=[::]
FD 23 flags=41*
*2014/10/16 14:40:07 kid1| Accepting NAT intercepted SSL bumped HTTPS
Socket connections at local=192.168.2.1:3127 <http://192.168.2.1:3127>
remote=[::] FD 24 flags=41*
*2014/10/16 14:40:07 kid1| Store rebuilding is 53.29% complete*
*2014/10/16 14:40:07 kid1| Done reading /cache swaplog (7505 entries)*
*2014/10/16 14:40:07 kid1| Finished rebuilding storage from disk.*
*2014/10/16 14:40:07 kid1|      7505 Entries scanned*
*2014/10/16 14:40:07 kid1|         0 Invalid entries.*
*2014/10/16 14:40:07 kid1|         0 With invalid flags.*
*2014/10/16 14:40:07 kid1|      7505 Objects loaded.*
*2014/10/16 14:40:07 kid1|         0 Objects expired.*
*2014/10/16 14:40:07 kid1|         0 Objects cancelled.*
*2014/10/16 14:40:07 kid1|         0 Duplicate URLs purged.*
*2014/10/16 14:40:07 kid1|         0 Swapfile clashes avoided.*
*2014/10/16 14:40:07 kid1|   Took 0.03 seconds (225605.72 objects/sec).*
*2014/10/16 14:40:07 kid1| Beginning Validation Procedure*
*2014/10/16 14:40:07 kid1|   Completed Validation Procedure*
*2014/10/16 14:40:07 kid1|   Validated 7505 Entries*
*2014/10/16 14:40:07 kid1|   store_swap_size = 897156.00 KB*
*2014/10/16 14:40:08 kid1| storeLateRelease: released 0 objects*
*2014/10/16 14:40:50 kid1| fwdNegotiateSSL: Error negotiating SSL
connection on FD 26: error:00000000:lib(0):func(0):reason(0) (5/0/0)*
*2014/10/16 14:40:50 kid1| fwdNegotiateSSL: Error negotiating SSL
connection on FD 28: error:00000000:lib(0):func(0):reason(0) (5/0/0)*
*2014/10/16 14:41:11 kid1| fwdNegotiateSSL: Error negotiating SSL
connection on FD 26: error:00000000:lib(0):func(0):reason(0) (5/0/0)*


On Wed, Oct 15, 2014 at 1:43 PM, Robert Watson <robert at gillecaluim.com>
wrote:

> Has anyone got this error when performing https proxy? I only receive it
> on a couple of https websites.  How to fix?
> Robert
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141016/970293f9/attachment.htm>

From robert at gillecaluim.com  Thu Oct 16 22:54:10 2014
From: robert at gillecaluim.com (Robert Watson)
Date: Thu, 16 Oct 2014 15:54:10 -0700
Subject: [squid-users] NET::ERR_CERT_COMMON_NAME_INVALID
In-Reply-To: <CADoG9x=L97xZVmaDGpwKehVHJKETY6Ex15VYwL9k+cZvu0jamA@mail.gmail.com>
References: <CADoG9x=L97xZVmaDGpwKehVHJKETY6Ex15VYwL9k+cZvu0jamA@mail.gmail.com>
Message-ID: <CADoG9x=0unZ3Lxkrf740eoPDTaNvkG2bGJUG9vqa-M_SnVu6SQ@mail.gmail.com>

And this is the error page Squid generates...

The following error was encountered while trying to retrieve the URL:
://204.44.2.199:443 <https://www.bankofthewest.com/://204.44.2.199:443>

*Failed to establish a secure connection to 204.44.2.199*

The system returned:

(71) Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)

Handshake with SSL server failed: [No Error]

This proxy and the remote host failed to negotiate a mutually acceptable
security settings for handling your request. It is possible that the remote
host does not support secure connections, or the proxy is not satisfied
with the host security credentials.

On Wed, Oct 15, 2014 at 1:43 PM, Robert Watson <robert at gillecaluim.com>
wrote:

> Has anyone got this error when performing https proxy? I only receive it
> on a couple of https websites.  How to fix?
> Robert
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141016/711617b9/attachment.htm>

From phatbuckett at gmail.com  Thu Oct 16 23:08:35 2014
From: phatbuckett at gmail.com (Darren Spruell)
Date: Thu, 16 Oct 2014 16:08:35 -0700
Subject: [squid-users] Supported configuration for adding origin server
 IP in response header
In-Reply-To: <54403050.6000009@treenet.co.nz>
References: <CAKVSOJVm6MSE9LZce3-Hbzab+vsaBL_-uAwifhDnt6K67hBw5w@mail.gmail.com>
 <54401F44.7080408@treenet.co.nz>
 <CAKVSOJU2VzEYfdr9JwY7uyNy=RMUpXrm=P5=hGc8f3DDfVth-A@mail.gmail.com>
 <54403050.6000009@treenet.co.nz>
Message-ID: <CAKVSOJU-vsjKNRzxjyvbuciQbprw=aLDB4pU0gPv5ZXU99AFiw@mail.gmail.com>

On Thu, Oct 16, 2014 at 1:53 PM, Amos Jeffries <squid3 at treenet.co.nz> wrote:
>> I view the Via header as similar to the Received header in SMTP.
>> In this case it's added by other proxies/caches, correct?
>
> Thats a good analogy, but not quite. It MUST be added by all proxies
> including Squid.
>
> http://tools.ietf.org/html/rfc7230#section-5.7.1 paragraphs 3 and 5.
>
> In squid.conf simply remove any "via off" you may have. The default is
> to comply with the RFC "MUST send" criteria.

The Via header indicates proxies/caches/gateways which have handled
the message between the requestor and the origin server. I do not
require this information; is there a way to configure squid to
indicate the IP address of the origin server in a response header?

Darren


From robert at gillecaluim.com  Fri Oct 17 00:30:45 2014
From: robert at gillecaluim.com (Robert Watson)
Date: Thu, 16 Oct 2014 17:30:45 -0700
Subject: [squid-users] NET::ERR_CERT_COMMON_NAME_INVALID
In-Reply-To: <CADoG9x=L97xZVmaDGpwKehVHJKETY6Ex15VYwL9k+cZvu0jamA@mail.gmail.com>
References: <CADoG9x=L97xZVmaDGpwKehVHJKETY6Ex15VYwL9k+cZvu0jamA@mail.gmail.com>
Message-ID: <CADoG9xnEu=7H8+twot4jyT8wC1FyxY-ZB4ujadr7k6_xsBk2bA@mail.gmail.com>

I believe my problem relates to a previous post regarding TLS fallback
<http://www.mail-archive.com/squid-users%40squid-cache.org/msg95916.html> in
the squid-users list.
Has there been any progress with sslbump and tls fallback to tls1.0 if
tls1.2/tls1.1 fails?

On Wed, Oct 15, 2014 at 1:43 PM, Robert Watson <robert at gillecaluim.com>
wrote:

> Has anyone got this error when performing https proxy? I only receive it
> on a couple of https websites.  How to fix?
> Robert
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141016/7e1e6db5/attachment.htm>

From squid3 at treenet.co.nz  Fri Oct 17 02:00:02 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 17 Oct 2014 15:00:02 +1300
Subject: [squid-users] NET::ERR_CERT_COMMON_NAME_INVALID
In-Reply-To: <CADoG9xnEu=7H8+twot4jyT8wC1FyxY-ZB4ujadr7k6_xsBk2bA@mail.gmail.com>
References: <CADoG9x=L97xZVmaDGpwKehVHJKETY6Ex15VYwL9k+cZvu0jamA@mail.gmail.com>
 <CADoG9xnEu=7H8+twot4jyT8wC1FyxY-ZB4ujadr7k6_xsBk2bA@mail.gmail.com>
Message-ID: <54407822.5060608@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 17/10/2014 1:30 p.m., Robert Watson wrote:
> I believe my problem relates to a previous post regarding TLS
> fallback 
> <http://www.mail-archive.com/squid-users%40squid-cache.org/msg95916.html>
> in the squid-users list. Has there been any progress with sslbump
> and tls fallback to tls1.0 if tls1.2/tls1.1 fails?
> 

Not specifically that I'm aware of.

With TLS version selection should be automatic - provided both
endpoints support at least one TLS version. The complications come in
when SSLv3 gets involved, since it has a different handshake syntax
and various clients/servers have some fancy failover dances perform
with various amounts of bugs.


You may want to also try 3.5.0.1 when it becomes available in ~3 hrs.
The peek-n-splice feature there should have much better TLS behaviour
than the older ssl-bump designs. No guarantees though.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUQHgiAAoJELJo5wb/XPRjah4H/jE4WxbJJeDfHjSHVccHpApY
rIXd82XRTD0wJ5aGIqCxuL/X3VMf+WPqSvLPP6KGJXVC5TmMy6edsYMY9Mr9p7+7
3l+lt6IUwE1w3r6os2jvywoyiwSDI1DPiKSJ9OKh/gMS6w+8VuOMDlkEU4NEB0qb
1vOmRj+vboha97xZ8OdbgVCimUZq1tFknlhxRl1x4Dfzaf/4Bai+Y42yWSwKl5Y3
V15ML3RE7sAqRuRj9+n8pSXAHi0G9NBghpODYVoBWvXip0rkVnDNbgdILZa7Xh1f
OQo9EFbc//xD4OlxCoe0UB1OndilUIgLFUYKWYfqruOABCUG3kL4aa0VEzQDrNc=
=anIc
-----END PGP SIGNATURE-----


From james at ejbdigital.com.au  Fri Oct 17 02:42:13 2014
From: james at ejbdigital.com.au (James Harper)
Date: Fri, 17 Oct 2014 02:42:13 +0000
Subject: [squid-users] website search broken
Message-ID: <b76b0d8cd5f34744b6adfeacfe2bd3c1@HKNPR04MB0388.apcprd04.prod.outlook.com>

Doing a search on the main squid page gives me this:

The requested URL /cgi-bin/swish-query.cgi was not found on this server.

Maybe better doing a google search anyway?

James


From squid3 at treenet.co.nz  Fri Oct 17 03:40:24 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 17 Oct 2014 16:40:24 +1300
Subject: [squid-users] website search broken
In-Reply-To: <b76b0d8cd5f34744b6adfeacfe2bd3c1@HKNPR04MB0388.apcprd04.prod.outlook.com>
References: <b76b0d8cd5f34744b6adfeacfe2bd3c1@HKNPR04MB0388.apcprd04.prod.outlook.com>
Message-ID: <54408FA8.9090603@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 17/10/2014 3:42 p.m., James Harper wrote:
> Doing a search on the main squid page gives me this:
> 
> The requested URL /cgi-bin/swish-query.cgi was not found on this
> server.
> 
> Maybe better doing a google search anyway?

Yes, swish has been down a while.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUQI+nAAoJELJo5wb/XPRjys4H/if5uOmNvDwvoj/l8FovNC9l
JKRdsPqDNPSbKLQMrmEq/hve2LOub49npGQ2VvSEauzz17koEa7pfvivgRtg3wq1
Odphmi7QOQhh9neffbep7eieLgV9ZZJONkug53Dl5l1lZ0rkxX9sSLb1W3SmOCPw
2nWsG4rR7ryw6Nc9JgNCnUV8c9NvkQoW/knemUvCTso0eKNqz4y0TP5f5r8JvNeM
Zn/aEoUbXKjl2FO/4i8wF3HKqyf3qFFmLSYku6En5joZhQUQpETVj8+DLU08rLBa
aTDbYaQWTvSAJF7gU8uD1u8y/goFpS3JKj28DoCoizwmE1VNwnnGVTfmdL0ba8c=
=z4tS
-----END PGP SIGNATURE-----


From sudakov at sibptus.tomsk.ru  Fri Oct 17 05:02:31 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Fri, 17 Oct 2014 12:02:31 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <m1p4sp$aq3$1@ger.gmane.org>
References: <20141007070403.GA57384@admin.sibptus.tomsk.ru>
 <20141007083542.GA60425@admin.sibptus.tomsk.ru>
 <m11nv3$nk8$1@ger.gmane.org>
 <20141008032925.GA77544@admin.sibptus.tomsk.ru>
 <m14if3$1ul$2@ger.gmane.org>
 <20141009021821.GA3372@admin.sibptus.tomsk.ru>
 <20141014052401.GA8411@admin.sibptus.tomsk.ru>
 <m1iqc6$m3g$1@ger.gmane.org>
 <20141016161928.GA49304@admin.sibptus.tomsk.ru>
 <m1p4sp$aq3$1@ger.gmane.org>
Message-ID: <20141017050231.GB60527@admin.sibptus.tomsk.ru>

Markus Moeller wrote:
> 
> That sounds a bit strange. Can you capture with wireshark the traffic on 
> port 88  on the system which has squiduser in the cache ( best after a clear 
> the cache with kerbtray first) when accessing squid and send it to me as cap 
> file ?

I am attaching a traffic dump.

Please look at Frame No. 36, where a ticket is requested for
"HTTP/proxy.sibptus.transneft.ru", and then at Frame No. 39, where
the ticket is granted, but for the wrong principal name.

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-------------- next part --------------
A non-text attachment was scrubbed...
Name: tgt_bad.cap
Type: application/vnd.tcpdump.pcap
Size: 10766 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141017/3c127b62/attachment.cap>

From emz at norma.perm.ru  Fri Oct 17 05:31:44 2014
From: emz at norma.perm.ru (Eugene M. Zheganin)
Date: Fri, 17 Oct 2014 11:31:44 +0600
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <20141017050231.GB60527@admin.sibptus.tomsk.ru>
References: <20141007070403.GA57384@admin.sibptus.tomsk.ru>
 <20141007083542.GA60425@admin.sibptus.tomsk.ru> <m11nv3$nk8$1@ger.gmane.org>
 <20141008032925.GA77544@admin.sibptus.tomsk.ru> <m14if3$1ul$2@ger.gmane.org>
 <20141009021821.GA3372@admin.sibptus.tomsk.ru>
 <20141014052401.GA8411@admin.sibptus.tomsk.ru> <m1iqc6$m3g$1@ger.gmane.org>
 <20141016161928.GA49304@admin.sibptus.tomsk.ru> <m1p4sp$aq3$1@ger.gmane.org>
 <20141017050231.GB60527@admin.sibptus.tomsk.ru>
Message-ID: <5440A9C0.3030503@norma.perm.ru>

Hi.

On 17.10.2014 11:02, Victor Sudakov wrote:
>
> I am attaching a traffic dump.
>
> Please look at Frame No. 36, where a ticket is requested for
> "HTTP/proxy.sibptus.transneft.ru", and then at Frame No. 39, where
> the ticket is granted, but for the wrong principal name.
>
The thing is, valid exchange should not and does not contain the
KRB5KRB_AP_ERR_MODIFIED error, and yours does. This indicates something
is wrong between these two hosts (as I understand, 10.14.134.4 is a
Windows Server, and .122 is a workstation). You need to investigate on
your DC what's happening, Probably these are the etype errors (may be
not). If your DC is really w2k (not w2k3 or w2k8) and the workstation is
of different generation, this can happen. Also, lots of howtos spread
around the Internet, make an engineer believe that he should kreate the
keytab with only one encryption type for squid, insted kreating the
keytab with all of available on the DC ciphers, This can also lead to
complicated situations.

There's also a decent article there:
http://blogs.technet.com/b/askds/archive/2008/06/11/kerberos-authentication-problems-service-principal-name-spn-issues-part-3.aspx

Could help you as it did help me one day.

Eugene.
//
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141017/f6d0a4e6/attachment.htm>

From alex at samad.com.au  Fri Oct 17 06:24:14 2014
From: alex at samad.com.au (Alexander Samad)
Date: Fri, 17 Oct 2014 17:24:14 +1100
Subject: [squid-users] Question squid on centos 6.5 and poodle
Message-ID: <CAJ+Q1PW_K4gs5gRQpd9N_QEmsh+PcPuv_TL513jcDn7H0EMUhQ@mail.gmail.com>

Hi

I am trying to reconfig the ssl setup on a reverse proxy set

https_port 2.7.3.1:443 accel cert=/etc/httpd/conf.d/office.xyz.com.crt
key=/etc/httpd/conf.d/office.xyz.com.key
dhparams=/etc/httpd/conf.d/office.xyz.com.dhparam
defaultsite=office.yieldbroker.com  options=NO_SSLv2,NO_SSLv3
cipher=ALL:!SSLv2:!SSLv3 at STRENGTH

But I only get a limited list of ciphers, completely different from
openssl ciphers 'ALL:!SSLv2:!SSLv3 at STRENGTH'

in fact it doesn't seem to look at the cipher option at all

and pointers on what I am doing wrong

right now I am left with
https_port 2.7.3.1:443 accel cert=/etc/httpd/conf.d/office.xyz.com.crt
key=/etc/httpd/conf.d/office.xyz.com.key
dhparams=/etc/httpd/conf.d/office.xyz.com.dhparam
defaultsite=office.yieldbroker.com  options=NO_SSLv2,NO_SSLv3

but https://www.ssllabs.com/ssltest/ gives me an A- .. no PFS.

thanks
Alex


From squid3 at treenet.co.nz  Fri Oct 17 07:20:37 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 17 Oct 2014 20:20:37 +1300
Subject: [squid-users] Question squid on centos 6.5 and poodle
In-Reply-To: <CAJ+Q1PW_K4gs5gRQpd9N_QEmsh+PcPuv_TL513jcDn7H0EMUhQ@mail.gmail.com>
References: <CAJ+Q1PW_K4gs5gRQpd9N_QEmsh+PcPuv_TL513jcDn7H0EMUhQ@mail.gmail.com>
Message-ID: <5440C345.6030603@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 17/10/2014 7:24 p.m., Alexander Samad wrote:
> Hi
> 
> I am trying to reconfig the ssl setup on a reverse proxy set
> 
> https_port 2.7.3.1:443 accel
> cert=/etc/httpd/conf.d/office.xyz.com.crt 
> key=/etc/httpd/conf.d/office.xyz.com.key 
> dhparams=/etc/httpd/conf.d/office.xyz.com.dhparam 
> defaultsite=office.yieldbroker.com  options=NO_SSLv2,NO_SSLv3 
> cipher=ALL:!SSLv2:!SSLv3 at STRENGTH
> 
> But I only get a limited list of ciphers, completely different
> from openssl ciphers 'ALL:!SSLv2:!SSLv3 at STRENGTH'
> 
> in fact it doesn't seem to look at the cipher option at all

There seems to be some FUD and confusion going around since POODLE was
announced. In particular people mentioning a "cipher" called SSLv3.

The cipher having problems is CBC. The SSLv3 is simply the SSL/TLS
version where that cipher is mandatory to support.

Lets be clear:  cipher != SSL/TLS version

The cipher being unusable now *also* makes the whole version unusable
and dangerous. Just like SSLv2 some years ago when the last of its
ciphers was broken, and TLSv1.0 will someday soon.


The "options=NO_SSLv2,NO_SSLv3" that you have set is sufficient to
close POODLE vulnerability.

NP: Do make sure you have a Squid 3.2 or later, the older ones enabled
some "default" options that are pretty bad these days.

> 
> and pointers on what I am doing wrong
> 
> right now I am left with https_port 2.7.3.1:443 accel
> cert=/etc/httpd/conf.d/office.xyz.com.crt 
> key=/etc/httpd/conf.d/office.xyz.com.key 
> dhparams=/etc/httpd/conf.d/office.xyz.com.dhparam 
> defaultsite=office.yieldbroker.com  options=NO_SSLv2,NO_SSLv3
> 
> but https://www.ssllabs.com/ssltest/ gives me an A- .. no PFS.

That I'm afraid depends on your OpenSSL library. Some of them have PFS
ciphers enabled by default, some you have to add options or ciphers to
get it, some dont support at all.

You do need dhparams= to enable them. But beyond that its all OpenSSL.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUQMNFAAoJELJo5wb/XPRj5QgH/2MHtjt/ZET3RjiwKfb2RL9x
MIrL/vNxxDjzJn0fnrk5iXCOd5Z7rWKjD/SO4BndqnADJh2d6pQSCe2LDYyn4/ZQ
D+giIfRJyYJdPAVpR50PsY/zNqSLWCW8g3/PDCxseRKNayyoOiOaUvU7fBkM4xZD
bdTz5YoHeGXzzeRItLcaWsFN8JZWb9yI34AHJ7AzpugMz68uV/pW9UHciWrpOuj1
hvnO3v/oE7Bu+KcTO5d36Fjmyrk00a60YcEMglZSkc7V80pigNsXA0TdKP0z8lE7
M+2kACtIIuXrzszGyTOMIWRQsxuqYxozVVa3+pwyIUn0QQpqQMJtRN7gPqvkxnM=
=axnA
-----END PGP SIGNATURE-----


From Jason_Haar at trimble.com  Fri Oct 17 07:38:57 2014
From: Jason_Haar at trimble.com (Jason Haar)
Date: Fri, 17 Oct 2014 20:38:57 +1300
Subject: [squid-users] squid-3.4.8 sslbump breaks facebook
In-Reply-To: <543FF969.40706@chtsanti.net>
References: <543F79D1.8080705@trimble.com> <543F8A67.8070003@trimble.com>
 <543F8C72.80204@yahoo.com> <543FF969.40706@chtsanti.net>
Message-ID: <5440C791.2080003@trimble.com>

I applied the patch to 3.4.8, built it and reset the cache, and now
facebook.com and youtube.com work when they caused the error before

Well done - all sorted by the looks of it :-)

Jason

On 17/10/14 05:59, Christos Tsantilas wrote:
>
> A patch for this bug attached to 4102 bug report.
> Please test it and report any problem.
>
> Regards,
>   Christos
>
>
>
> On 10/16/2014 12:14 PM, Amm wrote:
>>
>> On 10/16/2014 02:35 PM, Jason Haar wrote:
>>> On 16/10/14 20:54, Jason Haar wrote:
>>>> I also checked the ssl_db/certs dir and
>>>> removed the facebook certs and restarted - didn't help
>>> let me rephrase that. I deleted the dirtree and re-ran "ssl_crtd -s
>>> /usr/local/squid/var/lib/ssl_db -c" - ie restarted with an empty cache.
>>> It didn't help. It created a new fake facebook cert - but the cert
>>> doesn't fully match the characteristics of the "real" cert
>>
>> http://bugs.squid-cache.org/show_bug.cgi?id=4102
>>
>> Please add weight to bug report :)
>>
>> Amm.
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


-- 
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1



From james at ejbdigital.com.au  Fri Oct 17 08:47:44 2014
From: james at ejbdigital.com.au (James Harper)
Date: Fri, 17 Oct 2014 08:47:44 +0000
Subject: [squid-users] peek and splice and splice()
Message-ID: <b3e4d8ce69654684a44f6e7e3a4f6471@HKNPR04MB0388.apcprd04.prod.outlook.com>

Just reading up on this, the Feature page http://wiki.squid-cache.org/Features/SslPeekAndSplice says:

"... with Squid shoveling TCP bytes back and forth without any decryption"

I can't see that squid actually uses the splice() system call, so that would mean squid would actually read the data into userspace then write it out again, is that right? I assume once this happens it's the same code as a CONNECT.

What if there was a way to actually splice the two TCP connections at the kernel level so that Squid didn't actually need to be involved anymore, except when the connection closes to do the accounting? There appear to be a few historic attempts to implement this in the Linux kernel but I suspect they haven't been maintained.

And would this be a worthwhile optimisation anyway or is shunting data not a significant part of squid load?

Just curious.

James



From guigeng.ding at gmail.com  Fri Oct 17 09:36:57 2014
From: guigeng.ding at gmail.com (Ding Guigeng)
Date: Fri, 17 Oct 2014 02:36:57 -0700 (PDT)
Subject: [squid-users] acl time not work
Message-ID: <1413538617908-4667938.post@n4.nabble.com>

hi guys!
i had install squid 3.4.7 on centos 6.5.
i defined acls like below:
acl worktime1 MTWH 8:00-12:00
acl worktime2 F 13:00-18:00

http_access deny !worktime1
http_access deny !worktime2
http_access allow localnet
http_access deny all

it only works at Monday to Thursday 8:00-12:00
but the client cant connect internet at Friday 13:00-18:00

whats the problem?
thanks.



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/acl-time-not-work-tp4667938.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From squid3 at treenet.co.nz  Fri Oct 17 09:39:54 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 17 Oct 2014 22:39:54 +1300
Subject: [squid-users] peek and splice and splice()
In-Reply-To: <b3e4d8ce69654684a44f6e7e3a4f6471@HKNPR04MB0388.apcprd04.prod.outlook.com>
References: <b3e4d8ce69654684a44f6e7e3a4f6471@HKNPR04MB0388.apcprd04.prod.outlook.com>
Message-ID: <5440E3EA.2010804@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 17/10/2014 9:47 p.m., James Harper wrote:
> Just reading up on this, the Feature page 
> http://wiki.squid-cache.org/Features/SslPeekAndSplice says:
> 
> "... with Squid shoveling TCP bytes back and forth without any 
> decryption"
> 
> I can't see that squid actually uses the splice() system call, so 
> that would mean squid would actually read the data into userspace 
> then write it out again, is that right? I assume once this happens 
> it's the same code as a CONNECT.
> 
> What if there was a way to actually splice the two TCP connections
> at the kernel level so that Squid didn't actually need to be
> involved anymore, except when the connection closes to do the
> accounting? There appear to be a few historic attempts to implement
> this in the Linux kernel but I suspect they haven't been
> maintained.
> 
> And would this be a worthwhile optimisation anyway or is shunting 
> data not a significant part of squid load?

There is sendfile() IIUIC. Probably worthwhile, but to do it we have
to first drop the delay_pools feature which relies on each byte being
accounted as it is delivered.

For now I am working on it from a publicity standpoint, encouraging
people to go to the more efficient QoS controls outside of Squid. So
the popularity of delay pools drops down to a level we can start to
seriously consider alternatives to the current tunnel code.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUQOPpAAoJELJo5wb/XPRjJPwIAKALSISJLkEdfXA9njDMzjsC
WETJ7mDdBcRuJERk+rSGz3hYDou2Um/dAOsS9prZ/YFjTbh49XEwFflmvNh6yoOd
NjLoyNSt3S0Wh99//O0LjWBOiR7VNFVA8abIp3fFeM2jpOUx6VzJMez1XtShffoc
QkarUEZMzFdTkueh7vMpaiywmc3gN6jQvSEwuoDuvSExsW2fsj8HVSkahETfPsSl
5jgY8L4ztC7FY+/bh7oz3y3C3H925VxHkubHv1hHEd/GWqmspFN5l3qO3nBF0uuE
dRITLT/+Jg5VwLnRomUdXxu770tVzA8c8LY861KoDP3akxCWHhquu8UqAuUdBqE=
=UoPz
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Fri Oct 17 10:16:40 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 17 Oct 2014 23:16:40 +1300
Subject: [squid-users] acl time not work
In-Reply-To: <1413538617908-4667938.post@n4.nabble.com>
References: <1413538617908-4667938.post@n4.nabble.com>
Message-ID: <5440EC88.8010908@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 17/10/2014 10:36 p.m., Ding Guigeng wrote:
> hi guys! i had install squid 3.4.7 on centos 6.5. i defined acls
> like below: acl worktime1 MTWH 8:00-12:00 acl worktime2 F
> 13:00-18:00
> 
> http_access deny !worktime1 http_access deny !worktime2 http_access
> allow localnet http_access deny all
> 
> it only works at Monday to Thursday 8:00-12:00 but the client cant
> connect internet at Friday 13:00-18:00
> 
> whats the problem?

How are you defining "works at Monday to Thursday 8:00-12:00"  ??

By my reading that configuration should reject *all* traffic
regardless of day. Because...
 On Mon-Thu it will match !worktime2 -> deny
 On Fri-Sun it will match !worktime1 -> deny


The configuration should look like this:

 acl work time MTWH 8:00-12:00
 acl work time F 13:00-18:00

 http_access allow localnet work
 http_access deny all

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUQOyIAAoJELJo5wb/XPRjbx4H/1ht6FoA1gSda2IeNZgILRX1
sirW34QSze30y8i8Ud3Y8bV1ft4NtIQBY8UX04wok+KIaZCRTLxxEYTRRnXyI9jV
LFsOKG6U8fNjny3SO58Y/j7Utsyl+M8OimhHUftd0R0dH0MWbj3YToybGlJMbIVv
WwONCmkf68Z1U1GeDsI0gYCFN3OvIPYcgZZykoG78TEnyFUxTKyrbur3W1ctaf8j
dOUkbfKKAKFaqsldb2SmdWt6cdgPJohF43szxgByzrBebsCjKV8Br+If5h/UcD8+
rV+Wnhgf+y8it8jMWFaKf9lwSY+FWVN91/xeAn3s4sKaX6sUCpA+iTSIUbuiVLY=
=6+op
-----END PGP SIGNATURE-----


From james at ejbdigital.com.au  Fri Oct 17 10:27:13 2014
From: james at ejbdigital.com.au (James Harper)
Date: Fri, 17 Oct 2014 10:27:13 +0000
Subject: [squid-users] peek and splice and splice()
In-Reply-To: <5440E3EA.2010804@treenet.co.nz>
References: <b3e4d8ce69654684a44f6e7e3a4f6471@HKNPR04MB0388.apcprd04.prod.outlook.com>
 <5440E3EA.2010804@treenet.co.nz>
Message-ID: <4fe752550fe6475bb4ff55ec7c3849ae@HKNPR04MB0388.apcprd04.prod.outlook.com>

> 
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> On 17/10/2014 9:47 p.m., James Harper wrote:
> > Just reading up on this, the Feature page
> > http://wiki.squid-cache.org/Features/SslPeekAndSplice says:
> >
> > "... with Squid shoveling TCP bytes back and forth without any
> > decryption"
> >
> > I can't see that squid actually uses the splice() system call, so
> > that would mean squid would actually read the data into userspace
> > then write it out again, is that right? I assume once this happens
> > it's the same code as a CONNECT.
> >
> > What if there was a way to actually splice the two TCP connections
> > at the kernel level so that Squid didn't actually need to be
> > involved anymore, except when the connection closes to do the
> > accounting? There appear to be a few historic attempts to implement
> > this in the Linux kernel but I suspect they haven't been
> > maintained.
> >
> > And would this be a worthwhile optimisation anyway or is shunting
> > data not a significant part of squid load?
> 
> There is sendfile() IIUIC. Probably worthwhile, but to do it we have
> to first drop the delay_pools feature which relies on each byte being
> accounted as it is delivered.
> 

splice() would be a reasonable compromise then - it involves squid servicing the connection each time data is available, but avoids the read-into-userspace-buffer/write-from-userspace-buffer.

> For now I am working on it from a publicity standpoint, encouraging
> people to go to the more efficient QoS controls outside of Squid. So
> the popularity of delay pools drops down to a level we can start to
> seriously consider alternatives to the current tunnel code.
> 

Yes Linux and BSD both have very good QoS, but you can only see half the connection (client<->squid or squid<->server) at that level so you can't do it for all cases.

It would be awesome if squid could intercept connections without breaking them. You can kind of do it with the ULOG/NFQUEUE target in netfilter, but you get fed packets, not streams, so you'd have to implement your own TCP stack (so... no). Such a thing would allow better outcomes in the "can't connect to server" case though.

An ideal interface would allow you to be notified of an incoming connection, reject it (icmp port unreachable, reset, etc) if you can determine that the destination is down, accept it if you can determine that the destination is up, do what you need to do, then just give it back to the kernel if no more processing is required, then be notified when the connection has finished for accounting.

James


From daniel.rieken at gmx.net  Fri Oct 17 12:23:21 2014
From: daniel.rieken at gmx.net (daniel.rieken at gmx.net)
Date: Fri, 17 Oct 2014 14:23:21 +0200
Subject: [squid-users] DEAD Parent detection
In-Reply-To: <54403563.6080102@treenet.co.nz>
References: <trinity-3d22841b-ce8b-449f-869c-7b354aa54b85-1413470104094@3capp-gmx-bs62>, 
 <54403563.6080102@treenet.co.nz>
Message-ID: <trinity-8dcc787f-4a35-49ee-b3f1-b600467aff2e-1413548601030@3capp-gmx-bs59>

Hello,

I've testet with Squid 3.3.8 and here it is working as expected...
Thanks Amos!

squid.conf:
http_port 3128
http_access allow all
never_direct allow all
cache_peer 10.0.0.101 parent 3128 0 name=TEST1
cache_peer 10.0.0.102 parent 3128 0 name=TEST2

HTTPS Traffic is sent to first parent (10.0.0.101):
1413546716.565    299 10.0.0.50 TCP_MISS/200 434 CONNECT 10.99.99.99:443 - FIRSTUP_PARENT/10.0.0.101 -

When first parent fails, the HTTPS traffic is sent to second parent (10.0.0.102):
1413547033.502    216 10.0.0.50 TCP_MISS/200 434 CONNECT 10.99.99.99:443 - ANY_OLD_PARENT/10.0.0.102 -


But I still got a question left:
Why is there no message in the logfile? Something like "DEAD Parent detected" or "connection to 10.0.0.10:3128 failed"?

When I test with HTTP traffic, it works fine, I will see this message as soon as first parent dies:
2014/10/17 14:12:07 kid1| TCP connection to 10.0.0.101/3128 failed
2014/10/17 14:12:07 kid1| Detected DEAD Parent: TEST1


Regards,
Daniel


From dweimer at dweimer.net  Fri Oct 17 12:40:18 2014
From: dweimer at dweimer.net (dweimer)
Date: Fri, 17 Oct 2014 07:40:18 -0500
Subject: [squid-users] DEAD Parent detection
In-Reply-To: <trinity-8dcc787f-4a35-49ee-b3f1-b600467aff2e-1413548601030@3capp-gmx-bs59>
References: <trinity-3d22841b-ce8b-449f-869c-7b354aa54b85-1413470104094@3capp-gmx-bs62>, 
 <54403563.6080102@treenet.co.nz>
 <trinity-8dcc787f-4a35-49ee-b3f1-b600467aff2e-1413548601030@3capp-gmx-bs59>
Message-ID: <6a5e9ef6a54628b6f4ad1ba125cb08b6@dweimer.net>

On 10/17/2014 7:23 am, daniel.rieken at gmx.net wrote:
> Hello,
> 
> I've testet with Squid 3.3.8 and here it is working as expected...
> Thanks Amos!
> 
> squid.conf:
> http_port 3128
> http_access allow all
> never_direct allow all
> cache_peer 10.0.0.101 parent 3128 0 name=TEST1
> cache_peer 10.0.0.102 parent 3128 0 name=TEST2
> 
> HTTPS Traffic is sent to first parent (10.0.0.101):
> 1413546716.565    299 10.0.0.50 TCP_MISS/200 434 CONNECT
> 10.99.99.99:443 - FIRSTUP_PARENT/10.0.0.101 -
> 
> When first parent fails, the HTTPS traffic is sent to second parent
> (10.0.0.102):
> 1413547033.502    216 10.0.0.50 TCP_MISS/200 434 CONNECT
> 10.99.99.99:443 - ANY_OLD_PARENT/10.0.0.102 -
> 
> 
> But I still got a question left:
> Why is there no message in the logfile? Something like "DEAD Parent
> detected" or "connection to 10.0.0.10:3128 failed"?
> 
> When I test with HTTP traffic, it works fine, I will see this message
> as soon as first parent dies:
> 2014/10/17 14:12:07 kid1| TCP connection to 10.0.0.101/3128 failed
> 2014/10/17 14:12:07 kid1| Detected DEAD Parent: TEST1
> 

Each of the parents are used for both HTTP & HTTPS in this 
configuration, the dead parent detected log message isn't going to be 
repeated twice as its one parent, Regardless of which method the traffic 
is passing.

-- 
Thanks,
    Dean E. Weimer
    http://www.dweimer.net/


From daniel.rieken at gmx.net  Fri Oct 17 13:24:00 2014
From: daniel.rieken at gmx.net (daniel.rieken at gmx.net)
Date: Fri, 17 Oct 2014 15:24:00 +0200
Subject: [squid-users] DEAD Parent detection
In-Reply-To: <6a5e9ef6a54628b6f4ad1ba125cb08b6@dweimer.net>
References: <trinity-3d22841b-ce8b-449f-869c-7b354aa54b85-1413470104094@3capp-gmx-bs62>, 
 <54403563.6080102@treenet.co.nz>
 <trinity-8dcc787f-4a35-49ee-b3f1-b600467aff2e-1413548601030@3capp-gmx-bs59>,
 <6a5e9ef6a54628b6f4ad1ba125cb08b6@dweimer.net>
Message-ID: <trinity-fcb421e9-1204-41c7-aa94-088697d0ac17-1413552240656@3capp-gmx-bs59>

Hello,

> Each of the parents are used for both HTTP & HTTPS in this 
> configuration, the dead parent detected log message isn't going to be 
> repeated twice as its one parent, Regardless of which method the traffic 
> is passing.

yes, that's correct, I agree, each peer is used for both HTTP & HTTPS.
But when I send only HTTPS traffic, squid is *not* logging "DEAD Parent detected" or "connection to 10.0.0.101:3128 failed".
The log message *only* appears as soon as squid is passing HTTP traffic.

In my scenario squid is only passing HTTPS-traffic, so I will never ever see a log message when a Parent dies.
I would expect squid to log a "DEAD Parent" message *once*, regardless of squid is currently passing HTTP or HTTPS. 
Is this a bug? Or am I doing something wrong?

Regdards,
Daniel


From dweimer at dweimer.net  Fri Oct 17 14:35:47 2014
From: dweimer at dweimer.net (dweimer)
Date: Fri, 17 Oct 2014 09:35:47 -0500
Subject: [squid-users] DEAD Parent detection
In-Reply-To: <trinity-fcb421e9-1204-41c7-aa94-088697d0ac17-1413552240656@3capp-gmx-bs59>
References: <trinity-3d22841b-ce8b-449f-869c-7b354aa54b85-1413470104094@3capp-gmx-bs62>, 
 <54403563.6080102@treenet.co.nz> 
 <trinity-8dcc787f-4a35-49ee-b3f1-b600467aff2e-1413548601030@3capp-gmx-bs59>,
 <6a5e9ef6a54628b6f4ad1ba125cb08b6@dweimer.net>
 <trinity-fcb421e9-1204-41c7-aa94-088697d0ac17-1413552240656@3capp-gmx-bs59>
Message-ID: <323db42f60d2a36d2ebf43a11940a803@dweimer.net>

On 10/17/2014 8:24 am, daniel.rieken at gmx.net wrote:
> Hello,
> 
>> Each of the parents are used for both HTTP & HTTPS in this
>> configuration, the dead parent detected log message isn't going to be
>> repeated twice as its one parent, Regardless of which method the 
>> traffic
>> is passing.
> 
> yes, that's correct, I agree, each peer is used for both HTTP & HTTPS.
> But when I send only HTTPS traffic, squid is *not* logging "DEAD
> Parent detected" or "connection to 10.0.0.101:3128 failed".
> The log message *only* appears as soon as squid is passing HTTP 
> traffic.
> 
> In my scenario squid is only passing HTTPS-traffic, so I will never
> ever see a log message when a Parent dies.
> I would expect squid to log a "DEAD Parent" message *once*, regardless
> of squid is currently passing HTTP or HTTPS.
> Is this a bug? Or am I doing something wrong?
> 

Ah, I see your dilemma, I spun up the test instance I have installed on 
my FreeBSD laptop of Squid 3.4.8, configured it to forward to two parent 
proxy servers. Then pointed my browser at it using a wpad.dat script 
that pointed HTTP traffic at the secondary parent proxy, and HTTPS 
traffic to the local test proxy. I created a bogus route entry to the 
primary parent proxy, forcing it to appear as dead. Just as you 
reported, traffic changed in the access log to listing ANY_OLD_PARENT 
and ran out secondary parent proxy server, with no Detected DEAD Parent 
log entry.

I then switch the browser from the script to hard coded so both HTTP & 
HTTPS traffic went to the local test proxy, as soon as HTTP traffic hit 
it, it logged the Detected DEAD Parent in the cache.log. The issue is 
repeatable, and well may be a bug in the logging process, unless someone 
else can give a reason that it works this way.

-- 
Thanks,
    Dean E. Weimer
    http://www.dweimer.net/


From sudakov at sibptus.tomsk.ru  Fri Oct 17 18:15:03 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Sat, 18 Oct 2014 01:15:03 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <m1iqc6$m3g$1@ger.gmane.org>
References: <20141006040725.GA31642@admin.sibptus.tomsk.ru>
 <20141006052346.GA32369@admin.sibptus.tomsk.ru>
 <20141007070403.GA57384@admin.sibptus.tomsk.ru>
 <20141007083542.GA60425@admin.sibptus.tomsk.ru>
 <m11nv3$nk8$1@ger.gmane.org>
 <20141008032925.GA77544@admin.sibptus.tomsk.ru>
 <m14if3$1ul$2@ger.gmane.org>
 <20141009021821.GA3372@admin.sibptus.tomsk.ru>
 <20141014052401.GA8411@admin.sibptus.tomsk.ru>
 <m1iqc6$m3g$1@ger.gmane.org>
Message-ID: <20141017181503.GA68927@admin.sibptus.tomsk.ru>

Markus Moeller wrote:
> > 
> > Now as I run the test authenticator, what's the
> > "INFO: continuation needed"
> > message from the squid Kerberos helper? How do I interperet it? Is it
> > success or fail?
> 
>   That just means that the server requires more information from the client. 
> This could happen if mutual authentication is required or the dataset is too 
> large and had to be split. If you run it in squid the client would send new 
> data until the server says the exchange is complete ( I have not programmed 
> this into the simple test tool).

And what if a "continuation needed" appears as a result of a
real authentication process between squid and browswer? Like here

negotiate_kerberos_auth.cc(258): pid=23857 :2014/10/17 23:46:31| negotiate_kerberos_auth: DEBUG: Got 'YR YIIGfAYGKwYBBQUCoIIGcDCCBmygMDAuBgkqhkiC9xIBAgIGCSqGSIb3EgECAgYKKwYBBAGCNwICHgYKKwYBBAGCNwICCqKCBjYEggYyYIIGLgYJKoZIhvcSAQICAQBuggYdMIIGGaADAgEFoQMCAQ6iBwMFACAAAACjggSZYYIElTCCBJGgAwIBBaEWGxRTSUJQVFVTLlRSQU5TTkVGVC5SVaIWMBSgAwIBAaENMAsbCXNxdWlkdXNlcqOCBFgwggRUoAMCAReiggRLBIIER+nsdlujlz4aJyrxe1Q+R+YevmObhmGIPc/RzJ9BbVce1YFGOwGJ7MvojHRYkphXrb2sLN3b9mksy438zbERlVV3H+xzdc37xvElyBhUkTGsHQOuVmy6wV377ER2M3/NCPRU9ddH4kehWFutOLIC3quBUNF0Phki15SwfxWjfLDJDHA5grpYtInZ+dHPSb5/HOrdExtFS668WoeeiBGI+RLyICao8iecaQNA1LujBdCvIdAQIiehXtAuw1jr48OLhngT4Rgs4u8sfRLNPuD4SOiZWETO6ClVGF52bK8mH3LqXhJith7gXtcsx/ZcnVlzwcgoF+XCRxZH9HOqQG0MqIGZDTbvAI+MZW9VrSs8W0L2KvwA8L4sIg2l0wba4zNvlVysVjOC7EbIOQAOqQhK5yuptRW2De+QUvEpVkeZD4b4fITJuYZN10wHI8RmizwedfrqkV8+GqmOI9CGs7Dmxk3mDi7vqZBYZBp49pTrQEbKEQ7sVExc1KLLXUI2naAaGpFx+8hmo7j9xLplo+Firzfa10d12EK1LfOMxxGLlIiV4BUlIxwwfqIVpedG3phKIhz9B1slQpCiYX+P7IKTnEafZuSj/BdogV1+JNB83OwKZH3bCFjTC27BcAdki6p1wt4sKVfrgBvG008fCb2rChngFEaNRl1tf72mXOvZmcEfxAFUhmdScqY+2bn7Hlp3OKb+w45k4/wGCGtySCI3rZE4vcFMaxsxkfMVA9s1JY0T/n4jnfBQUUfrLVQpO+EuCW6SImiAqVT6UG4SSTp7EgLar3rzs8basrL7u5mTOpnb88W2i2dfrmLosTmpjV70qRgxr6yaThKCm1G1xh3iVnUUjJxvCV3CZ5WS2OY6c42rQirvMj38P1scRzd7Poql3VIo83XVX0Xz8Vvnf3n3H6LbKT1wXDtI+ML+tzyv5lbx4Nw4/8at2lInIuQdzW9MD88/SLzzYwlUXHO3eEMIzLdAfIVMGcACIZdbrcz2aVvQnHMq4So6znbGHLQHEL5yA42846/9va05P2jWCOzApRYEdL7DvaDcZ5MjrAWOS1lB8F+bjYhHvEi/B2SGkUX+6rDWG8XIQQjTzsRl3cB0LZ9IcxGQGJ4Uz4IIe+1vRg6sRbmLpCDjZDz1O2xEcRJcqpJNlxRu5W6GxCAb+Y7YfOXuoA2F3VOxHaMnITgxXk4TJ9/3y+LxNL7Mj2srBCqWb6OmCCyFnw4Mg8E+Vt4rZbN+6oauU+rMmEOlrm8na9MqNFD7vk+uUA5nmm5iYG9i134XGnOgABPeWk0etYtjPCnEuMC9sjSf9uIDGThNHSNNkYd0h9J8SiprxWsWCV1qay7QODWIIukBqbzYdkpiB7uvWw1RBysuAttvEV7zq1OZ6AaDN5qLh/ngUQiZoNVhp2DQeJMYzlTXQPcnwZ/1sGfs2yi/QmgkkEp/+ZnVDX1kWP0rnw9hiqSCAWUwggFhoAMCAReiggFYBIIBVFDCWRb5Fro690dZPosxx2as60V6wYMbg2tijj7Xf66SmY5R8Cd5ZeQuMP74rzChysAMkD0AmY78VsHdr6kPK1rhRxF4t+yAPJWRo6YiuLvQeT6WwhZBHYQ+7UWm58gFz6Kgq7boxKVs7aixkxzQRAm3ItAOdn/EwIkwbNb4RR3eOVUXcVJtMqlv3mkocuaU9huOY3UfO518B63QJVIC07QVEUYRcsfj0gfYvT7BGyzxOQxtkgH22Bx89p29Keeo4IFnBJRMjegTRi9RNF30WlG2he84Kf3xm9F9mseA8XC5XCNDem0lmeTkigtHQ2AvV3cYBN6u70lMaHnEaS2JJYYaDibwPEYa/ASGMqtjmluPcPNF6TcPK4YVYb+UET6ZQPlETfCGVuiARVpIV6ijbHn8u18g/gomSLDP+a5R5/7J6ojnOmuQEK1hJE+kV+6C0dewQSU=' from squid (length: 2223).
negotiate_kerberos_auth.cc(311): pid=23857 :2014/10/17 23:46:31| negotiate_kerberos_auth: DEBUG: Decode 'YIIGfAYGKwYBBQUCoIIGcDCCBmygMDAuBgkqhkiC9xIBAgIGCSqGSIb3EgECAgYKKwYBBAGCNwICHgYKKwYBBAGCNwICCqKCBjYEggYyYIIGLgYJKoZIhvcSAQICAQBuggYdMIIGGaADAgEFoQMCAQ6iBwMFACAAAACjggSZYYIElTCCBJGgAwIBBaEWGxRTSUJQVFVTLlRSQU5TTkVGVC5SVaIWMBSgAwIBAaENMAsbCXNxdWlkdXNlcqOCBFgwggRUoAMCAReiggRLBIIER+nsdlujlz4aJyrxe1Q+R+YevmObhmGIPc/RzJ9BbVce1YFGOwGJ7MvojHRYkphXrb2sLN3b9mksy438zbERlVV3H+xzdc37xvElyBhUkTGsHQOuVmy6wV377ER2M3/NCPRU9ddH4kehWFutOLIC3quBUNF0Phki15SwfxWjfLDJDHA5grpYtInZ+dHPSb5/HOrdExtFS668WoeeiBGI+RLyICao8iecaQNA1LujBdCvIdAQIiehXtAuw1jr48OLhngT4Rgs4u8sfRLNPuD4SOiZWETO6ClVGF52bK8mH3LqXhJith7gXtcsx/ZcnVlzwcgoF+XCRxZH9HOqQG0MqIGZDTbvAI+MZW9VrSs8W0L2KvwA8L4sIg2l0wba4zNvlVysVjOC7EbIOQAOqQhK5yuptRW2De+QUvEpVkeZD4b4fITJuYZN10wHI8RmizwedfrqkV8+GqmOI9CGs7Dmxk3mDi7vqZBYZBp49pTrQEbKEQ7sVExc1KLLXUI2naAaGpFx+8hmo7j9xLplo+Firzfa10d12EK1LfOMxxGLlIiV4BUlIxwwfqIVpedG3phKIhz9B1slQpCiYX+P7IKTnEafZuSj/BdogV1+JNB83OwKZH3bCFjTC27BcAdki6p1wt4sKVfrgBvG008fCb2rChngFEaNRl1tf72mXOvZmcEfxAFUhmdScqY+2bn7Hlp3OKb+w45k4/wGCGtySCI3rZE4vcFMaxsxkfMVA9s1JY0T/n4jnfBQUUfrLVQpO+EuCW6SImiAqVT6UG4SSTp7EgLar3rzs8basrL7u5mTOpnb88W2i2dfrmLosTmpjV70qRgxr6yaThKCm1G1xh3iVnUUjJxvCV3CZ5WS2OY6c42rQirvMj38P1scRzd7Poql3VIo83XVX0Xz8Vvnf3n3H6LbKT1wXDtI+ML+tzyv5lbx4Nw4/8at2lInIuQdzW9MD88/SLzzYwlUXHO3eEMIzLdAfIVMGcACIZdbrcz2aVvQnHMq4So6znbGHLQHEL5yA42846/9va05P2jWCOzApRYEdL7DvaDcZ5MjrAWOS1lB8F+bjYhHvEi/B2SGkUX+6rDWG8XIQQjTzsRl3cB0LZ9IcxGQGJ4Uz4IIe+1vRg6sRbmLpCDjZDz1O2xEcRJcqpJNlxRu5W6GxCAb+Y7YfOXuoA2F3VOxHaMnITgxXk4TJ9/3y+LxNL7Mj2srBCqWb6OmCCyFnw4Mg8E+Vt4rZbN+6oauU+rMmEOlrm8na9MqNFD7vk+uUA5nmm5iYG9i134XGnOgABPeWk0etYtjPCnEuMC9sjSf9uIDGThNHSNNkYd0h9J8SiprxWsWCV1qay7QODWIIukBqbzYdkpiB7uvWw1RBysuAttvEV7zq1OZ6AaDN5qLh/ngUQiZoNVhp2DQeJMYzlTXQPcnwZ/1sGfs2yi/QmgkkEp/+ZnVDX1kWP0rnw9hiqSCAWUwggFhoAMCAReiggFYBIIBVFDCWRb5Fro690dZPosxx2as60V6wYMbg2tijj7Xf66SmY5R8Cd5ZeQuMP74rzChysAMkD0AmY78VsHdr6kPK1rhRxF4t+yAPJWRo6YiuLvQeT6WwhZBHYQ+7UWm58gFz6Kgq7boxKVs7aixkxzQRAm3ItAOdn/EwIkwbNb4RR3eOVUXcVJtMqlv3mkocuaU9huOY3UfO518B63QJVIC07QVEUYRcsfj0gfYvT7BGyzxOQxtkgH22Bx89p29Keeo4IFnBJRMjegTRi9RNF30WlG2he84Kf3xm9F9mseA8XC5XCNDem0lmeTkigtHQ2AvV3cYBN6u70lMaHnEaS2JJYYaDibwPEYa/ASGMqtjmluPcPNF6TcPK4YVYb+UET6ZQPlETfCGVuiARVpIV6ijbHn8u18g/gomSLDP+a5R5/7J6ojnOmuQEK1hJE+kV+6C0dewQSU=' (decoded length: 1664).
negotiate_kerberos_auth.cc(373): pid=23857 :2014/10/17 23:46:31| negotiate_kerberos_auth: INFO: continuation needed
negotiate_kerberos_auth.cc(258): pid=23857 :2014/10/17 23:46:31| negotiate_kerberos_auth: DEBUG: Got 'YR YIIGfAYGKwYBBQUCoIIGcDCCBmygMDAuBgkqhkiC9xIBAgIGCSqGSIb3EgECAgYKKwYBBAGCNwICHgYKKwYBBAGCNwICCqKCBjYEggYyYIIGLgYJKoZIhvcSAQICAQBuggYdMIIGGaADAgEFoQMCAQ6iBwMFACAAAACjggSZYYIElTCCBJGgAwIBBaEWGxRTSUJQVFVTLlRSQU5TTkVGVC5SVaIWMBSgAwIBAaENMAsbCXNxdWlkdXNlcqOCBFgwggRUoAMCAReiggRLBIIER+nsdlujlz4aJyrxe1Q+R+YevmObhmGIPc/RzJ9BbVce1YFGOwGJ7MvojHRYkphXrb2sLN3b9mksy438zbERlVV3H+xzdc37xvElyBhUkTGsHQOuVmy6wV377ER2M3/NCPRU9ddH4kehWFutOLIC3quBUNF0Phki15SwfxWjfLDJDHA5grpYtInZ+dHPSb5/HOrdExtFS668WoeeiBGI+RLyICao8iecaQNA1LujBdCvIdAQIiehXtAuw1jr48OLhngT4Rgs4u8sfRLNPuD4SOiZWETO6ClVGF52bK8mH3LqXhJith7gXtcsx/ZcnVlzwcgoF+XCRxZH9HOqQG0MqIGZDTbvAI+MZW9VrSs8W0L2KvwA8L4sIg2l0wba4zNvlVysVjOC7EbIOQAOqQhK5yuptRW2De+QUvEpVkeZD4b4fITJuYZN10wHI8RmizwedfrqkV8+GqmOI9CGs7Dmxk3mDi7vqZBYZBp49pTrQEbKEQ7sVExc1KLLXUI2naAaGpFx+8hmo7j9xLplo+Firzfa10d12EK1LfOMxxGLlIiV4BUlIxwwfqIVpedG3phKIhz9B1slQpCiYX+P7IKTnEafZuSj/BdogV1+JNB83OwKZH3bCFjTC27BcAdki6p1wt4sKVfrgBvG008fCb2rChngFEaNRl1tf72mXOvZmcEfxAFUhmdScqY+2bn7Hlp3OKb+w45k4/wGCGtySCI3rZE4vcFMaxsxkfMVA9s1JY0T/n4jnfBQUUfrLVQpO+EuCW6SImiAqVT6UG4SSTp7EgLar3rzs8basrL7u5mTOpnb88W2i2dfrmLosTmpjV70qRgxr6yaThKCm1G1xh3iVnUUjJxvCV3CZ5WS2OY6c42rQirvMj38P1scRzd7Poql3VIo83XVX0Xz8Vvnf3n3H6LbKT1wXDtI+ML+tzyv5lbx4Nw4/8at2lInIuQdzW9MD88/SLzzYwlUXHO3eEMIzLdAfIVMGcACIZdbrcz2aVvQnHMq4So6znbGHLQHEL5yA42846/9va05P2jWCOzApRYEdL7DvaDcZ5MjrAWOS1lB8F+bjYhHvEi/B2SGkUX+6rDWG8XIQQjTzsRl3cB0LZ9IcxGQGJ4Uz4IIe+1vRg6sRbmLpCDjZDz1O2xEcRJcqpJNlxRu5W6GxCAb+Y7YfOXuoA2F3VOxHaMnITgxXk4TJ9/3y+LxNL7Mj2srBCqWb6OmCCyFnw4Mg8E+Vt4rZbN+6oauU+rMmEOlrm8na9MqNFD7vk+uUA5nmm5iYG9i134XGnOgABPeWk0etYtjPCnEuMC9sjSf9uIDGThNHSNNkYd0h9J8SiprxWsWCV1qay7QODWIIukBqbzYdkpiB7uvWw1RBysuAttvEV7zq1OZ6AaDN5qLh/ngUQiZoNVhp2DQeJMYzlTXQPcnwZ/1sGfs2yi/QmgkkEp/+ZnVDX1kWP0rnw9hiqSCAWUwggFhoAMCAReiggFYBIIBVKPw3f3IDblKYZy+D48fufg/31z/AeMpxWXzKJWRsnURwariLBwhOL3hR10Ovn6hBElhmnDu1HWJcMyShzt1op6RM5qVj7yX8BqKs9eS3nE6l7035mgPP+ar6hYrqQ7D6op0DCnaNHtwJyKpslfkYE37u11OBujsNeuOcxyi1KEBfdqVHrX38gG0dDWpKby5KI5TFHsUilJ2IbHUiyxOS0FrEFgqaClzWCr77K39gdxOalkk7Hm9TP8D75FmF3/hAbkUviO3AA47wtDEkz7CpKfzVxZ6Oc7+zo36MdwN99kjXeqG3MP7BasfM9UU5sAbFoAlEMV3hYlLnrzmAic+dDWK71ZVEKIqA1bL/h6To72UEDZ8qDTGyIThWtwUYACXD1OGdNAxvoMuuI3kUYqtmPj70UGCDQa0yVYDAUeYmHL35hP/12Ap1El4M93Vc/SQn4C7B1E=' from squid (length: 2223).
negotiate_kerberos_auth.cc(311): pid=23857 :2014/10/17 23:46:31| negotiate_kerberos_auth: DEBUG: Decode 'YIIGfAYGKwYBBQUCoIIGcDCCBmygMDAuBgkqhkiC9xIBAgIGCSqGSIb3EgECAgYKKwYBBAGCNwICHgYKKwYBBAGCNwICCqKCBjYEggYyYIIGLgYJKoZIhvcSAQICAQBuggYdMIIGGaADAgEFoQMCAQ6iBwMFACAAAACjggSZYYIElTCCBJGgAwIBBaEWGxRTSUJQVFVTLlRSQU5TTkVGVC5SVaIWMBSgAwIBAaENMAsbCXNxdWlkdXNlcqOCBFgwggRUoAMCAReiggRLBIIER+nsdlujlz4aJyrxe1Q+R+YevmObhmGIPc/RzJ9BbVce1YFGOwGJ7MvojHRYkphXrb2sLN3b9mksy438zbERlVV3H+xzdc37xvElyBhUkTGsHQOuVmy6wV377ER2M3/NCPRU9ddH4kehWFutOLIC3quBUNF0Phki15SwfxWjfLDJDHA5grpYtInZ+dHPSb5/HOrdExtFS668WoeeiBGI+RLyICao8iecaQNA1LujBdCvIdAQIiehXtAuw1jr48OLhngT4Rgs4u8sfRLNPuD4SOiZWETO6ClVGF52bK8mH3LqXhJith7gXtcsx/ZcnVlzwcgoF+XCRxZH9HOqQG0MqIGZDTbvAI+MZW9VrSs8W0L2KvwA8L4sIg2l0wba4zNvlVysVjOC7EbIOQAOqQhK5yuptRW2De+QUvEpVkeZD4b4fITJuYZN10wHI8RmizwedfrqkV8+GqmOI9CGs7Dmxk3mDi7vqZBYZBp49pTrQEbKEQ7sVExc1KLLXUI2naAaGpFx+8hmo7j9xLplo+Firzfa10d12EK1LfOMxxGLlIiV4BUlIxwwfqIVpedG3phKIhz9B1slQpCiYX+P7IKTnEafZuSj/BdogV1+JNB83OwKZH3bCFjTC27BcAdki6p1wt4sKVfrgBvG008fCb2rChngFEaNRl1tf72mXOvZmcEfxAFUhmdScqY+2bn7Hlp3OKb+w45k4/wGCGtySCI3rZE4vcFMaxsxkfMVA9s1JY0T/n4jnfBQUUfrLVQpO+EuCW6SImiAqVT6UG4SSTp7EgLar3rzs8basrL7u5mTOpnb88W2i2dfrmLosTmpjV70qRgxr6yaThKCm1G1xh3iVnUUjJxvCV3CZ5WS2OY6c42rQirvMj38P1scRzd7Poql3VIo83XVX0Xz8Vvnf3n3H6LbKT1wXDtI+ML+tzyv5lbx4Nw4/8at2lInIuQdzW9MD88/SLzzYwlUXHO3eEMIzLdAfIVMGcACIZdbrcz2aVvQnHMq4So6znbGHLQHEL5yA42846/9va05P2jWCOzApRYEdL7DvaDcZ5MjrAWOS1lB8F+bjYhHvEi/B2SGkUX+6rDWG8XIQQjTzsRl3cB0LZ9IcxGQGJ4Uz4IIe+1vRg6sRbmLpCDjZDz1O2xEcRJcqpJNlxRu5W6GxCAb+Y7YfOXuoA2F3VOxHaMnITgxXk4TJ9/3y+LxNL7Mj2srBCqWb6OmCCyFnw4Mg8E+Vt4rZbN+6oauU+rMmEOlrm8na9MqNFD7vk+uUA5nmm5iYG9i134XGnOgABPeWk0etYtjPCnEuMC9sjSf9uIDGThNHSNNkYd0h9J8SiprxWsWCV1qay7QODWIIukBqbzYdkpiB7uvWw1RBysuAttvEV7zq1OZ6AaDN5qLh/ngUQiZoNVhp2DQeJMYzlTXQPcnwZ/1sGfs2yi/QmgkkEp/+ZnVDX1kWP0rnw9hiqSCAWUwggFhoAMCAReiggFYBIIBVKPw3f3IDblKYZy+D48fufg/31z/AeMpxWXzKJWRsnURwariLBwhOL3hR10Ovn6hBElhmnDu1HWJcMyShzt1op6RM5qVj7yX8BqKs9eS3nE6l7035mgPP+ar6hYrqQ7D6op0DCnaNHtwJyKpslfkYE37u11OBujsNeuOcxyi1KEBfdqVHrX38gG0dDWpKby5KI5TFHsUilJ2IbHUiyxOS0FrEFgqaClzWCr77K39gdxOalkk7Hm9TP8D75FmF3/hAbkUviO3AA47wtDEkz7CpKfzVxZ6Oc7+zo36MdwN99kjXeqG3MP7BasfM9UU5sAbFoAlEMV3hYlLnrzmAic+dDWK71ZVEKIqA1bL/h6To72UEDZ8qDTGyIThWtwUYACXD1OGdNAxvoMuuI3kUYqtmPj70UGCDQa0yVYDAUeYmHL35hP/12Ap1El4M93Vc/SQn4C7B1E=' (decoded length: 1664).
negotiate_kerberos_auth.cc(373): pid=23857 :2014/10/17 23:46:31| negotiate_kerberos_auth: INFO: continuation needed
negotiate_kerberos_auth.cc(258): pid=23857 :2014/10/18 00:46:31| negotiate_kerberos_auth: DEBUG: Got 'YR YIIGfAYGKwYBBQUCoIIGcDCCBmygMDAuBgkqhkiC9xIBAgIGCSqGSIb3EgECAgYKKwYBBAGCNwICHgYKKwYBBAGCNwICCqKCBjYEggYyYIIGLgYJKoZIhvcSAQICAQBuggYdMIIGGaADAgEFoQMCAQ6iBwMFACAAAACjggSZYYIElTCCBJGgAwIBBaEWGxRTSUJQVFVTLlRSQU5TTkVGVC5SVaIWMBSgAwIBAaENMAsbCXNxdWlkdXNlcqOCBFgwggRUoAMCAReiggRLBIIER+nsdlujlz4aJyrxe1Q+R+YevmObhmGIPc/RzJ9BbVce1YFGOwGJ7MvojHRYkphXrb2sLN3b9mksy438zbERlVV3H+xzdc37xvElyBhUkTGsHQOuVmy6wV377ER2M3/NCPRU9ddH4kehWFutOLIC3quBUNF0Phki15SwfxWjfLDJDHA5grpYtInZ+dHPSb5/HOrdExtFS668WoeeiBGI+RLyICao8iecaQNA1LujBdCvIdAQIiehXtAuw1jr48OLhngT4Rgs4u8sfRLNPuD4SOiZWETO6ClVGF52bK8mH3LqXhJith7gXtcsx/ZcnVlzwcgoF+XCRxZH9HOqQG0MqIGZDTbvAI+MZW9VrSs8W0L2KvwA8L4sIg2l0wba4zNvlVysVjOC7EbIOQAOqQhK5yuptRW2De+QUvEpVkeZD4b4fITJuYZN10wHI8RmizwedfrqkV8+GqmOI9CGs7Dmxk3mDi7vqZBYZBp49pTrQEbKEQ7sVExc1KLLXUI2naAaGpFx+8hmo7j9xLplo+Firzfa10d12EK1LfOMxxGLlIiV4BUlIxwwfqIVpedG3phKIhz9B1slQpCiYX+P7IKTnEafZuSj/BdogV1+JNB83OwKZH3bCFjTC27BcAdki6p1wt4sKVfrgBvG008fCb2rChngFEaNRl1tf72mXOvZmcEfxAFUhmdScqY+2bn7Hlp3OKb+w45k4/wGCGtySCI3rZE4vcFMaxsxkfMVA9s1JY0T/n4jnfBQUUfrLVQpO+EuCW6SImiAqVT6UG4SSTp7EgLar3rzs8basrL7u5mTOpnb88W2i2dfrmLosTmpjV70qRgxr6yaThKCm1G1xh3iVnUUjJxvCV3CZ5WS2OY6c42rQirvMj38P1scRzd7Poql3VIo83XVX0Xz8Vvnf3n3H6LbKT1wXDtI+ML+tzyv5lbx4Nw4/8at2lInIuQdzW9MD88/SLzzYwlUXHO3eEMIzLdAfIVMGcACIZdbrcz2aVvQnHMq4So6znbGHLQHEL5yA42846/9va05P2jWCOzApRYEdL7DvaDcZ5MjrAWOS1lB8F+bjYhHvEi/B2SGkUX+6rDWG8XIQQjTzsRl3cB0LZ9IcxGQGJ4Uz4IIe+1vRg6sRbmLpCDjZDz1O2xEcRJcqpJNlxRu5W6GxCAb+Y7YfOXuoA2F3VOxHaMnITgxXk4TJ9/3y+LxNL7Mj2srBCqWb6OmCCyFnw4Mg8E+Vt4rZbN+6oauU+rMmEOlrm8na9MqNFD7vk+uUA5nmm5iYG9i134XGnOgABPeWk0etYtjPCnEuMC9sjSf9uIDGThNHSNNkYd0h9J8SiprxWsWCV1qay7QODWIIukBqbzYdkpiB7uvWw1RBysuAttvEV7zq1OZ6AaDN5qLh/ngUQiZoNVhp2DQeJMYzlTXQPcnwZ/1sGfs2yi/QmgkkEp/+ZnVDX1kWP0rnw9hiqSCAWUwggFhoAMCAReiggFYBIIBVDPX6eNp0voRjU4CPqHxANndyGYUr9BOmvK+rmcmvPWrtZE+Od53iVyz2V+Bt8YXnzL7vftbC4Dj/yDhzaMlpXh8+c4cuuF5gw93KFHS7C0VWDs3v1DhhQmpR72N/3aEBohGcVCpUsR+lGGrBdLR0w719/wH68t4EZ7R06CM4FZllWHqWvmC21Yf8zFRlDaFF1ySQK8Lo7k5Y6XxckZuoD4Fury38Ns/gC3dYbmIEFihjbSuKzyR5bm/uI/9HV5I8KUA7qXC1K7uS4SbNt61Mu3o7JwRONUMlrx8nYpzfaUAOcptQ2TA5kyTRC/PA1HvwUk3+eSjxWFRomuo2YohoKip/lQybdpHkC3VQwmmeX9U/yeATuv4EpISsAiFEjeUZYGy7sL0SydqgBEHNmtHKGxsdhmgmBZ0nsF7fdCL/rDmDpPWumLARlK38qJod7GuNj5LUXM=' from squid (length: 2223).
negotiate_kerberos_auth.cc(311): pid=23857 :2014/10/18 00:46:31| negotiate_kerberos_auth: DEBUG: Decode 'YIIGfAYGKwYBBQUCoIIGcDCCBmygMDAuBgkqhkiC9xIBAgIGCSqGSIb3EgECAgYKKwYBBAGCNwICHgYKKwYBBAGCNwICCqKCBjYEggYyYIIGLgYJKoZIhvcSAQICAQBuggYdMIIGGaADAgEFoQMCAQ6iBwMFACAAAACjggSZYYIElTCCBJGgAwIBBaEWGxRTSUJQVFVTLlRSQU5TTkVGVC5SVaIWMBSgAwIBAaENMAsbCXNxdWlkdXNlcqOCBFgwggRUoAMCAReiggRLBIIER+nsdlujlz4aJyrxe1Q+R+YevmObhmGIPc/RzJ9BbVce1YFGOwGJ7MvojHRYkphXrb2sLN3b9mksy438zbERlVV3H+xzdc37xvElyBhUkTGsHQOuVmy6wV377ER2M3/NCPRU9ddH4kehWFutOLIC3quBUNF0Phki15SwfxWjfLDJDHA5grpYtInZ+dHPSb5/HOrdExtFS668WoeeiBGI+RLyICao8iecaQNA1LujBdCvIdAQIiehXtAuw1jr48OLhngT4Rgs4u8sfRLNPuD4SOiZWETO6ClVGF52bK8mH3LqXhJith7gXtcsx/ZcnVlzwcgoF+XCRxZH9HOqQG0MqIGZDTbvAI+MZW9VrSs8W0L2KvwA8L4sIg2l0wba4zNvlVysVjOC7EbIOQAOqQhK5yuptRW2De+QUvEpVkeZD4b4fITJuYZN10wHI8RmizwedfrqkV8+GqmOI9CGs7Dmxk3mDi7vqZBYZBp49pTrQEbKEQ7sVExc1KLLXUI2naAaGpFx+8hmo7j9xLplo+Firzfa10d12EK1LfOMxxGLlIiV4BUlIxwwfqIVpedG3phKIhz9B1slQpCiYX+P7IKTnEafZuSj/BdogV1+JNB83OwKZH3bCFjTC27BcAdki6p1wt4sKVfrgBvG008fCb2rChngFEaNRl1tf72mXOvZmcEfxAFUhmdScqY+2bn7Hlp3OKb+w45k4/wGCGtySCI3rZE4vcFMaxsxkfMVA9s1JY0T/n4jnfBQUUfrLVQpO+EuCW6SImiAqVT6UG4SSTp7EgLar3rzs8basrL7u5mTOpnb88W2i2dfrmLosTmpjV70qRgxr6yaThKCm1G1xh3iVnUUjJxvCV3CZ5WS2OY6c42rQirvMj38P1scRzd7Poql3VIo83XVX0Xz8Vvnf3n3H6LbKT1wXDtI+ML+tzyv5lbx4Nw4/8at2lInIuQdzW9MD88/SLzzYwlUXHO3eEMIzLdAfIVMGcACIZdbrcz2aVvQnHMq4So6znbGHLQHEL5yA42846/9va05P2jWCOzApRYEdL7DvaDcZ5MjrAWOS1lB8F+bjYhHvEi/B2SGkUX+6rDWG8XIQQjTzsRl3cB0LZ9IcxGQGJ4Uz4IIe+1vRg6sRbmLpCDjZDz1O2xEcRJcqpJNlxRu5W6GxCAb+Y7YfOXuoA2F3VOxHaMnITgxXk4TJ9/3y+LxNL7Mj2srBCqWb6OmCCyFnw4Mg8E+Vt4rZbN+6oauU+rMmEOlrm8na9MqNFD7vk+uUA5nmm5iYG9i134XGnOgABPeWk0etYtjPCnEuMC9sjSf9uIDGThNHSNNkYd0h9J8SiprxWsWCV1qay7QODWIIukBqbzYdkpiB7uvWw1RBysuAttvEV7zq1OZ6AaDN5qLh/ngUQiZoNVhp2DQeJMYzlTXQPcnwZ/1sGfs2yi/QmgkkEp/+ZnVDX1kWP0rnw9hiqSCAWUwggFhoAMCAReiggFYBIIBVDPX6eNp0voRjU4CPqHxANndyGYUr9BOmvK+rmcmvPWrtZE+Od53iVyz2V+Bt8YXnzL7vftbC4Dj/yDhzaMlpXh8+c4cuuF5gw93KFHS7C0VWDs3v1DhhQmpR72N/3aEBohGcVCpUsR+lGGrBdLR0w719/wH68t4EZ7R06CM4FZllWHqWvmC21Yf8zFRlDaFF1ySQK8Lo7k5Y6XxckZuoD4Fury38Ns/gC3dYbmIEFihjbSuKzyR5bm/uI/9HV5I8KUA7qXC1K7uS4SbNt61Mu3o7JwRONUMlrx8nYpzfaUAOcptQ2TA5kyTRC/PA1HvwUk3+eSjxWFRomuo2YohoKip/lQybdpHkC3VQwmmeX9U/yeATuv4EpISsAiFEjeUZYGy7sL0SydqgBEHNmtHKGxsdhmgmBZ0nsF7fdCL/rDmDpPWumLARlK38qJod7GuNj5LUXM=' (decoded length: 1664).
negotiate_kerberos_auth.cc(373): pid=23857 :2014/10/18 00:46:31| negotiate_kerberos_auth: INFO: continuation needed
negotiate_kerberos_auth.cc(258): pid=23857 :2014/10/18 00:46:32| negotiate_kerberos_auth: DEBUG: Got 'YR YIIGfAYGKwYBBQUCoIIGcDCCBmygMDAuBgkqhkiC9xIBAgIGCSqGSIb3EgECAgYKKwYBBAGCNwICHgYKKwYBBAGCNwICCqKCBjYEggYyYIIGLgYJKoZIhvcSAQICAQBuggYdMIIGGaADAgEFoQMCAQ6iBwMFACAAAACjggSZYYIElTCCBJGgAwIBBaEWGxRTSUJQVFVTLlRSQU5TTkVGVC5SVaIWMBSgAwIBAaENMAsbCXNxdWlkdXNlcqOCBFgwggRUoAMCAReiggRLBIIER+nsdlujlz4aJyrxe1Q+R+YevmObhmGIPc/RzJ9BbVce1YFGOwGJ7MvojHRYkphXrb2sLN3b9mksy438zbERlVV3H+xzdc37xvElyBhUkTGsHQOuVmy6wV377ER2M3/NCPRU9ddH4kehWFutOLIC3quBUNF0Phki15SwfxWjfLDJDHA5grpYtInZ+dHPSb5/HOrdExtFS668WoeeiBGI+RLyICao8iecaQNA1LujBdCvIdAQIiehXtAuw1jr48OLhngT4Rgs4u8sfRLNPuD4SOiZWETO6ClVGF52bK8mH3LqXhJith7gXtcsx/ZcnVlzwcgoF+XCRxZH9HOqQG0MqIGZDTbvAI+MZW9VrSs8W0L2KvwA8L4sIg2l0wba4zNvlVysVjOC7EbIOQAOqQhK5yuptRW2De+QUvEpVkeZD4b4fITJuYZN10wHI8RmizwedfrqkV8+GqmOI9CGs7Dmxk3mDi7vqZBYZBp49pTrQEbKEQ7sVExc1KLLXUI2naAaGpFx+8hmo7j9xLplo+Firzfa10d12EK1LfOMxxGLlIiV4BUlIxwwfqIVpedG3phKIhz9B1slQpCiYX+P7IKTnEafZuSj/BdogV1+JNB83OwKZH3bCFjTC27BcAdki6p1wt4sKVfrgBvG008fCb2rChngFEaNRl1tf72mXOvZmcEfxAFUhmdScqY+2bn7Hlp3OKb+w45k4/wGCGtySCI3rZE4vcFMaxsxkfMVA9s1JY0T/n4jnfBQUUfrLVQpO+EuCW6SImiAqVT6UG4SSTp7EgLar3rzs8basrL7u5mTOpnb88W2i2dfrmLosTmpjV70qRgxr6yaThKCm1G1xh3iVnUUjJxvCV3CZ5WS2OY6c42rQirvMj38P1scRzd7Poql3VIo83XVX0Xz8Vvnf3n3H6LbKT1wXDtI+ML+tzyv5lbx4Nw4/8at2lInIuQdzW9MD88/SLzzYwlUXHO3eEMIzLdAfIVMGcACIZdbrcz2aVvQnHMq4So6znbGHLQHEL5yA42846/9va05P2jWCOzApRYEdL7DvaDcZ5MjrAWOS1lB8F+bjYhHvEi/B2SGkUX+6rDWG8XIQQjTzsRl3cB0LZ9IcxGQGJ4Uz4IIe+1vRg6sRbmLpCDjZDz1O2xEcRJcqpJNlxRu5W6GxCAb+Y7YfOXuoA2F3VOxHaMnITgxXk4TJ9/3y+LxNL7Mj2srBCqWb6OmCCyFnw4Mg8E+Vt4rZbN+6oauU+rMmEOlrm8na9MqNFD7vk+uUA5nmm5iYG9i134XGnOgABPeWk0etYtjPCnEuMC9sjSf9uIDGThNHSNNkYd0h9J8SiprxWsWCV1qay7QODWIIukBqbzYdkpiB7uvWw1RBysuAttvEV7zq1OZ6AaDN5qLh/ngUQiZoNVhp2DQeJMYzlTXQPcnwZ/1sGfs2yi/QmgkkEp/+ZnVDX1kWP0rnw9hiqSCAWUwggFhoAMCAReiggFYBIIBVAqXS6ZmN5d6AGsLtZeiQ0KwmLC9RQWuBbCkCWnGWUS333bGrKZQ45obre6mGMYcj2vtEVZDHTC3Mr/NxGYdRgYZVtNK9u+iEE6MgY5tCjjcQEjosQjYhD+XAOt+pKCI6+I1L/zJ0j3mWtOwF1iNQc4TlAbO4fxAiGSOEoE0+rhEmhuPUEyb65l4vlZYcOGBMsEr0T1nG5WKR24LBKBgADRSDrFE9Tz0jTIrivI98iuFRgMu9068M5zP68pDopJ6BZbsZW/BYMnCsINAouyt0CUqn/Y/7YuYlN+jYdc0QTfVNnfT+FInu6ME33QQq78yZvqoNTPraGdRMZdgrZa3dBWIYrmJ/CjG1lQiNqAqswXn7teb3WLWOq8c+WBIZhK5nb8uvf9YIEPnF3Uf9IPXyqWsLHFS47nFytTYaKAN7E/jJG3vf/IJCsDveQsJ/Kb9NK4ZZZ8=' from squid (length: 2223).
negotiate_kerberos_auth.cc(311): pid=23857 :2014/10/18 00:46:32| negotiate_kerberos_auth: DEBUG: Decode 'YIIGfAYGKwYBBQUCoIIGcDCCBmygMDAuBgkqhkiC9xIBAgIGCSqGSIb3EgECAgYKKwYBBAGCNwICHgYKKwYBBAGCNwICCqKCBjYEggYyYIIGLgYJKoZIhvcSAQICAQBuggYdMIIGGaADAgEFoQMCAQ6iBwMFACAAAACjggSZYYIElTCCBJGgAwIBBaEWGxRTSUJQVFVTLlRSQU5TTkVGVC5SVaIWMBSgAwIBAaENMAsbCXNxdWlkdXNlcqOCBFgwggRUoAMCAReiggRLBIIER+nsdlujlz4aJyrxe1Q+R+YevmObhmGIPc/RzJ9BbVce1YFGOwGJ7MvojHRYkphXrb2sLN3b9mksy438zbERlVV3H+xzdc37xvElyBhUkTGsHQOuVmy6wV377ER2M3/NCPRU9ddH4kehWFutOLIC3quBUNF0Phki15SwfxWjfLDJDHA5grpYtInZ+dHPSb5/HOrdExtFS668WoeeiBGI+RLyICao8iecaQNA1LujBdCvIdAQIiehXtAuw1jr48OLhngT4Rgs4u8sfRLNPuD4SOiZWETO6ClVGF52bK8mH3LqXhJith7gXtcsx/ZcnVlzwcgoF+XCRxZH9HOqQG0MqIGZDTbvAI+MZW9VrSs8W0L2KvwA8L4sIg2l0wba4zNvlVysVjOC7EbIOQAOqQhK5yuptRW2De+QUvEpVkeZD4b4fITJuYZN10wHI8RmizwedfrqkV8+GqmOI9CGs7Dmxk3mDi7vqZBYZBp49pTrQEbKEQ7sVExc1KLLXUI2naAaGpFx+8hmo7j9xLplo+Firzfa10d12EK1LfOMxxGLlIiV4BUlIxwwfqIVpedG3phKIhz9B1slQpCiYX+P7IKTnEafZuSj/BdogV1+JNB83OwKZH3bCFjTC27BcAdki6p1wt4sKVfrgBvG008fCb2rChngFEaNRl1tf72mXOvZmcEfxAFUhmdScqY+2bn7Hlp3OKb+w45k4/wGCGtySCI3rZE4vcFMaxsxkfMVA9s1JY0T/n4jnfBQUUfrLVQpO+EuCW6SImiAqVT6UG4SSTp7EgLar3rzs8basrL7u5mTOpnb88W2i2dfrmLosTmpjV70qRgxr6yaThKCm1G1xh3iVnUUjJxvCV3CZ5WS2OY6c42rQirvMj38P1scRzd7Poql3VIo83XVX0Xz8Vvnf3n3H6LbKT1wXDtI+ML+tzyv5lbx4Nw4/8at2lInIuQdzW9MD88/SLzzYwlUXHO3eEMIzLdAfIVMGcACIZdbrcz2aVvQnHMq4So6znbGHLQHEL5yA42846/9va05P2jWCOzApRYEdL7DvaDcZ5MjrAWOS1lB8F+bjYhHvEi/B2SGkUX+6rDWG8XIQQjTzsRl3cB0LZ9IcxGQGJ4Uz4IIe+1vRg6sRbmLpCDjZDz1O2xEcRJcqpJNlxRu5W6GxCAb+Y7YfOXuoA2F3VOxHaMnITgxXk4TJ9/3y+LxNL7Mj2srBCqWb6OmCCyFnw4Mg8E+Vt4rZbN+6oauU+rMmEOlrm8na9MqNFD7vk+uUA5nmm5iYG9i134XGnOgABPeWk0etYtjPCnEuMC9sjSf9uIDGThNHSNNkYd0h9J8SiprxWsWCV1qay7QODWIIukBqbzYdkpiB7uvWw1RBysuAttvEV7zq1OZ6AaDN5qLh/ngUQiZoNVhp2DQeJMYzlTXQPcnwZ/1sGfs2yi/QmgkkEp/+ZnVDX1kWP0rnw9hiqSCAWUwggFhoAMCAReiggFYBIIBVAqXS6ZmN5d6AGsLtZeiQ0KwmLC9RQWuBbCkCWnGWUS333bGrKZQ45obre6mGMYcj2vtEVZDHTC3Mr/NxGYdRgYZVtNK9u+iEE6MgY5tCjjcQEjosQjYhD+XAOt+pKCI6+I1L/zJ0j3mWtOwF1iNQc4TlAbO4fxAiGSOEoE0+rhEmhuPUEyb65l4vlZYcOGBMsEr0T1nG5WKR24LBKBgADRSDrFE9Tz0jTIrivI98iuFRgMu9068M5zP68pDopJ6BZbsZW/BYMnCsINAouyt0CUqn/Y/7YuYlN+jYdc0QTfVNnfT+FInu6ME33QQq78yZvqoNTPraGdRMZdgrZa3dBWIYrmJ/CjG1lQiNqAqswXn7teb3WLWOq8c+WBIZhK5nb8uvf9YIEPnF3Uf9IPXyqWsLHFS47nFytTYaKAN7E/jJG3vf/IJCsDveQsJ/Kb9NK4ZZZ8=' (decoded length: 1664).
negotiate_kerberos_auth.cc(373): pid=23857 :2014/10/18 00:46:32| negotiate_kerberos_auth: INFO: continuation needed

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru


From frechdesign at gmail.com  Fri Oct 17 19:38:43 2014
From: frechdesign at gmail.com (Yassin CHOUCHANE)
Date: Fri, 17 Oct 2014 21:38:43 +0200
Subject: [squid-users] Ubuntu server 14.04 - Squid 3.3.8 - Active directory
	sync problem !
Message-ID: <CAASYH3yTHghWV4_RN0oafVW3eFCVtQK41FM+7SEHa0bNOkOo6w@mail.gmail.com>

Hello all,
I have installed an ubuntu 14.04 x64 with squid v3.3.8, and i need to make sso
with Windows microsoft active directory 2008 server r2.

so i make this :

i used the official how to here -->  http://wiki.squid-cache.org/ConfigExamp ?
e/Kerberos

SO after a frech install of ubuntu :

1> Pre-requisites for Active Directory integration

Serveur active directory :
     ip active directory : 192.168.1.60
     hostname : ws2008
     Nom de domaine : sonsofanarchy.fr
     Utilisateur de l'active directory :
            - administrateur password
            - jteller   P at ssword1

Serveur squid :
     ip : 192.168.1.62
     hostname : srv-proxy-01
     user administrateur
     password : password

Config du serveur proxy :

1.1> Install des pr?requis :

sudo apt-get install krb5-user msktutil squid samba-common-bin


- V?rification configuration DNS :

sudo nano  /etc/resolv.conf
# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
domain sonsofanarchy.fr
search sonsofanarchy.fr
nameserver 192.168.1.60

- Synchronisation de la date avec l'Active directory :

sudo nano /etc/default/ntpdate
# The settings in this file are used by the program ntpdate-debian, but not
# by the upstream program ntpdate.

# Set to "yes" to take the server list from /etc/ntp.conf, from package ntp,
# so you only have to keep it in one place.
NTPDATE_USE_NTP_CONF=yes

# List of NTP servers to use  (Separate multiple servers with spaces.)
# Not used if NTPDATE_USE_NTP_CONF is yes.
NTPSERVERS="ws2008.sonsofanarchy.fr"

# Additional options to pass to ntpdate
NTPOPTIONS=""

root at srv-proxy-01:~# ntpdate ws2008.sonsofanarchy.fr
13 Oct 18:16:27 ntpdate[1632]: adjust time server 192.168.1.60 offset 0.032533
sec

-Cr?ation du keytab : (If no message it will be good)

root at srv-proxy-01:~# kinit administrateur
Password for administrateur at SONSOFANARCHY.FR:
root at srv-proxy-01:~#


root at srv-proxy-01:~# msktutil -c -b "CN=COMPUTERS" -s
HTTP/srv-proxy-01.sonsofanarchy.fr -k /etc/squid3/PROXY.keytab --computer-name
SRV-PROXY-01-K --upn HTTP/srv-proxy-01.sonsofanarchy.fr --server
ws2008.sonsofanarchy.fr --verbose --enctypes 28
 -- init_password: Wiping the computer password structure
 -- generate_new_password: Generating a new, random password for the computer
account
 -- generate_new_password:  Characters read from /dev/udandom = 85
 -- create_fake_krb5_conf: Created a fake krb5.conf file:
/tmp/.msktkrb5.conf-p1Stna
 -- reload: Reloading Kerberos Context
 -- finalize_exec: SAM Account Name is: SRV-PROXY-01-K$
 -- try_machine_keytab_princ: Trying to authenticate for SRV-PROXY-01-K$ from
local keytab...
 -- try_machine_keytab_princ: Error: krb5_get_init_creds_keytab failed (Client
not found in Kerberos database)
 -- try_machine_keytab_princ: Authentication with keytab failed
 -- try_machine_keytab_princ: Trying to authenticate for host/srv-proxy-01 from
local keytab...
 -- try_machine_keytab_princ: Error: krb5_get_init_creds_keytab failed (Key
table entry not found)
 -- try_machine_keytab_princ: Authentication with keytab failed
 -- try_machine_password: Trying to authenticate for SRV-PROXY-01-K$ with
password.
 -- create_default_machine_password: Default machine password for
SRV-PROXY-01-K$ is srv-proxy-01-k
 -- try_machine_password: Error: krb5_get_init_creds_keytab failed (Client not
found in Kerberos database)
 -- try_machine_password: Authentication with password failed
 -- try_user_creds: Checking if default ticket cache has tickets...
 -- finalize_exec: Authenticated using method 4

 -- ldap_connect: Connecting to LDAP server: ws2008.sonsofanarchy.fr
try_tls=YES
 -- ldap_connect: Connecting to LDAP server: ws2008.sonsofanarchy.fr try_tls=NO
SASL/GSSAPI authentication started
SASL username: administrateur at SONSOFANARCHY.FR
SASL SSF: 56
SASL data security layer installed.
 -- ldap_connect: LDAP_OPT_X_SASL_SSF=56

 -- ldap_get_base_dn: Determining default LDAP base: dc=SONSOFANARCHY,dc=FR
 -- ldap_check_account: Checking that a computer account for SRV-PROXY-01-K$
exists
 -- ldap_check_account: Computer account not found, create the account

No computer account for SRV-PROXY-01-K found, creating a new one.
dn: cn=SRV-PROXY-01-K,CN=COMPUTERS,dc=SONSOFANARCHY,dc=FR
 -- ldap_check_account_strings: Inspecting (and updating) computer account
attributes
 -- ldap_simple_set_attr: Calling ldap_modify_ext_s to set dNSHostName to
srv-proxy-01
 -- ldap_simple_set_attr: Calling ldap_modify_ext_s to set userPrincipalName to
HTTP/srv-proxy-01.sonsofanarchy.fr at SONSOFANARCHY.FR
 -- ldap_set_supportedEncryptionTypes: DEE
dn=cn=SRV-PROXY-01-K,CN=COMPUTERS,dc=SONSOFANARCHY,dc=FR old=7 new=28

 -- ldap_simple_set_attr: Calling ldap_modify_ext_s to set
msDs-supportedEncryptionTypes to 28
 -- ldap_set_userAccountControl_flag: Setting userAccountControl bit at
0x200000 to 0x0
 -- ldap_set_userAccountControl_flag:  userAccountControl not changed 0x1000

 -- set_password: Attempting to reset computer's password
 -- set_password: Try change password using user's ticket cache

 -- ldap_get_pwdLastSet: pwdLastSet is 130576908153384910
 -- set_password: Successfully set password, waiting for it to be reflected in
LDAP.
 -- ldap_get_pwdLastSet: pwdLastSet is 130576908153853660
 -- set_password: Successfully reset computer's password
 -- ldap_add_principal: Checking that adding principal
HTTP/srv-proxy-01.sonsofanarchy.fr to SRV-PROXY-01-K$ won't cause a conflict
 -- ldap_add_principal: Adding principal HTTP/srv-proxy-01.sonsofanarchy.fr to
LDAP entry
 -- ldap_add_principal: Checking that adding principal host/srv-proxy-01 to
SRV-PROXY-01-K$ won't cause a conflict
 -- ldap_add_principal: Adding principal host/srv-proxy-01 to LDAP entry
 -- execute: Updating all entries for srv-proxy-01 in the keytab
WRFILE:/etc/squid3/PROXY.keytab

 -- update_keytab: Updating all entires for SRV-PROXY-01-K$
 -- ldap_get_kvno: KVNO is 2
 -- add_principal_keytab: Adding principal to keytab: SRV-PROXY-01-K$
 -- add_principal_keytab: Removing entries with kvno < 0
 -- add_principal_keytab: Deleting SRV-PROXY-01-K$@SONSOFANARCHY.FR kvno=3,
enctype=23
 -- add_principal_keytab: Deleting SRV-PROXY-01-K$@SONSOFANARCHY.FR kvno=3,
enctype=17
 -- add_principal_keytab: Deleting SRV-PROXY-01-K$@SONSOFANARCHY.FR kvno=3,
enctype=18
 -- add_principal_keytab:     Using salt of
SONSOFANARCHY.FRhostsrv-proxy-01-k.sonsofanarchy.fr
 -- add_principal_keytab:   Adding entry of enctype 0x17
 -- add_principal_keytab:     Using salt of
SONSOFANARCHY.FRhostsrv-proxy-01-k.sonsofanarchy.fr
 -- add_principal_keytab:   Adding entry of enctype 0x11
 -- add_principal_keytab:     Using salt of
SONSOFANARCHY.FRhostsrv-proxy-01-k.sonsofanarchy.fr
 -- add_principal_keytab:   Adding entry of enctype 0x12
 -- add_principal_keytab: Adding principal to keytab:
HTTP/srv-proxy-01.sonsofanarchy.fr
 -- add_principal_keytab: Removing entries with kvno < 0
 -- add_principal_keytab: Deleting
HTTP/srv-proxy-01.sonsofanarchy.fr at SONSOFANARCHY.FR kvno=3, enctype=23
 -- add_principal_keytab: Deleting
HTTP/srv-proxy-01.sonsofanarchy.fr at SONSOFANARCHY.FR kvno=3, enctype=17
 -- add_principal_keytab: Deleting
HTTP/srv-proxy-01.sonsofanarchy.fr at SONSOFANARCHY.FR kvno=3, enctype=18
 -- add_principal_keytab:     Using salt of
SONSOFANARCHY.FRhostsrv-proxy-01-k.sonsofanarchy.fr
 -- add_principal_keytab:   Adding entry of enctype 0x17
 -- add_principal_keytab:     Using salt of
SONSOFANARCHY.FRhostsrv-proxy-01-k.sonsofanarchy.fr
 -- add_principal_keytab:   Adding entry of enctype 0x11
 -- add_principal_keytab:     Using salt of
SONSOFANARCHY.FRhostsrv-proxy-01-k.sonsofanarchy.fr
 -- add_principal_keytab:   Adding entry of enctype 0x12
 -- add_principal_keytab: Adding principal to keytab: host/srv-proxy-01
 -- add_principal_keytab: Removing entries with kvno < 0
 -- add_principal_keytab:     Using salt of
SONSOFANARCHY.FRhostsrv-proxy-01-k.sonsofanarchy.fr
 -- add_principal_keytab:   Adding entry of enctype 0x17
 -- add_principal_keytab:     Using salt of
SONSOFANARCHY.FRhostsrv-proxy-01-k.sonsofanarchy.fr
 -- add_principal_keytab:   Adding entry of enctype 0x11
 -- add_principal_keytab:     Using salt of
SONSOFANARCHY.FRhostsrv-proxy-01-k.sonsofanarchy.fr
 -- add_principal_keytab:   Adding entry of enctype 0x12
 -- ~msktutil_exec: Destroying msktutil_exec
 -- ldap_cleanup: Disconnecting from LDAP server
 -- init_password: Wiping the computer password structure
 -- ~KRB5Context: Destroying Kerberos Context
root at srv-proxy-01:~#

Good rights on files :
root at srv-proxy-01:~# chgrp proxy /etc/squid3/PROXY.keytab
root at srv-proxy-01:~#  chmod g+r /etc/squid3/PROXY.keytab


squid.conf files :

# Listen on Port 8080
http_port 8080

auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -i -s
GSS_C_NO_NAME
auth_param negotiate children 10
auth_param negotiate keep_alive on

acl auth proxy_auth REQUIRED

http_access deny !auth
http_access allow auth
http_access deny all

and now i have always a popup with login/password, but nothig work and i have
this on the log :
/var/log/squid/cache.log

2014/10/13 19:15:52| ERROR: Negotiate Authentication validating user. Error
returned 'BH received type 1 NTLM token'
negotiate_kerberos_auth.cc(315): pid=3418 :2014/10/13 19:15:52|
negotiate_kerberos_auth: DEBUG: Got 'YR
TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' from squid (length:
59).
negotiate_kerberos_auth.cc(378): pid=3418 :2014/10/13 19:15:52|
negotiate_kerberos_auth: DEBUG: Decode
'TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' (decoded length:
40).
negotiate_kerberos_auth.cc(388): pid=3418 :2014/10/13 19:15:52|
negotiate_kerberos_auth: WARNING: received type 1 NTLM token
2014/10/13 19:15:52| ERROR: Negotiate Authentication validating user. Error
returned 'BH received type 1 NTLM token'

can someone can help me to fix this problem please


thanks to all.


From Bob.Luderitz at NiproGlassAmericas.com  Fri Oct 17 19:47:51 2014
From: Bob.Luderitz at NiproGlassAmericas.com (Luderitz Bob)
Date: Fri, 17 Oct 2014 19:47:51 +0000
Subject: [squid-users] Central Proxy using WCCP to multiple sites in our
 network with ASA box.
Message-ID: <0091F25702DBCD438E9EB76FF2CF5204F7314954@ngamil-exc02.nga.local>

                I have one central Proxy Server running Squid 3.1.10 under CentOS 6.3 running locally here and also for our 2 remote sites for all http traffic.

                We are using Cisco's WCCP and between the remote sites and the Squid is a ASA box.

                where the Proxy is running Site A and one of the remote Site B.
                From either of the remote sites, when I try to access a printer or other web enabled device thru a browser that is not defined in squid.conf, I get access denied.
                This is strange to me as this request should be considered part of the internal network.
When I put statements in squid.conf for this print, I then get connection timed out.

                From the Squid server, I cannot ping this remote printer due to the static route has 0.0.0.0 as its gateway address.

                See the below config for one of the remote sites:

                In /etc/rc.local file:

                iptunnel add tun-cc mode gre remote 192.168.253.16 local 10.80.166.227 dev eth0
ip link set dev tun-cc up
ip route add 10.80.202.0/23 dev tun-cc metric 101

In squid.conf, this network should be considered internal:
acl nga_net src 10.80.0.0/16    # Internal network (I have tried splitting out the ACL statements but same result)

http_access allow nga_net

If I look at the static routes on the server (netstat -rn or route -v)
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface
1.2.3.0         0.0.0.0         255.255.255.0   U         0 0          0 gre0
10.80.166.0     0.0.0.0         255.255.255.0   U         0 0          0 eth0
10.80.202.0     0.0.0.0         255.255.254.0   U         0 0          0 tun-cc  (remote site)
0.0.0.0         10.80.166.254   0.0.0.0         UG        0 0          0 eth0

As you can see, the gateway for this remote site is the Internet (0.0.0.0) and thinking it should be 10.80.166.254.
When I try to change the gateway for this static route, I get message - RTNETLINK answers: File exists
If I remove the static route, I cannot get to any internal or Internet site from a remote site workstation.

Due to the ASA in the traffic path of the remote sites, there is a gre tunnel setup for outbound traffic from the Squid server, without the tunnel the packet would be dropped by the ASA box.

I know the best practices is to have a proxy server at each remote location, but this solution does work for most requests.
Has anyone else run into this and found a solution, thanks....

______________________________________________________

NIPRO GLASS
______________________________________________________

CAUTION  - This message may contain privileged and confidential information intended only for the use of the addressee named above. If you are not the intended recipient of this message you are hereby
notified  that  any  use,  dissemination, distribution or reproduction of this message is prohibited. If you have received this message in error please notify NIPRO GLASS
 immediately. Any views expressed in
this message are those of the individual sender and may not necessarily reflect the views of NIPRO GLASS.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141017/ea2490c4/attachment.htm>

From squid3 at treenet.co.nz  Sat Oct 18 00:07:09 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 18 Oct 2014 13:07:09 +1300
Subject: [squid-users] Ubuntu server 14.04 - Squid 3.3.8 - Active
 directory sync problem !
In-Reply-To: <CAASYH3yTHghWV4_RN0oafVW3eFCVtQK41FM+7SEHa0bNOkOo6w@mail.gmail.com>
References: <CAASYH3yTHghWV4_RN0oafVW3eFCVtQK41FM+7SEHa0bNOkOo6w@mail.gmail.com>
Message-ID: <5441AF2D.5040400@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 18/10/2014 8:38 a.m., Yassin CHOUCHANE wrote:
> Hello all, I have installed an ubuntu 14.04 x64 with squid v3.3.8,
> and i need to make sso with Windows microsoft active directory 2008
> server r2.
> 
<snip>

> /var/log/squid/cache.log
> 
> 2014/10/13 19:15:52| ERROR: Negotiate Authentication validating
> user. Error returned 'BH received type 1 NTLM token' 
> negotiate_kerberos_auth.cc(315): pid=3418 :2014/10/13 19:15:52| 
> negotiate_kerberos_auth: DEBUG: Got 'YR 
> TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' from
> squid (length: 59). negotiate_kerberos_auth.cc(378): pid=3418
> :2014/10/13 19:15:52| negotiate_kerberos_auth: DEBUG: Decode 
> 'TlRMTVNTUAABAAAAl4II4gAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==' (decoded
> length: 40). negotiate_kerberos_auth.cc(388): pid=3418 :2014/10/13
> 19:15:52| negotiate_kerberos_auth: WARNING: received type 1 NTLM
> token 2014/10/13 19:15:52| ERROR: Negotiate Authentication
> validating user. Error returned 'BH received type 1 NTLM token'
> 
> can someone can help me to fix this problem please

As logged this is NTLM, not Kerberos.

Negotiate is a wrapper protocol around two "flavours" Negotiate/NTLM
and Negotiate/Kerberos. The client software has picked the wrong one
to use.
That usually means the problem is in the client software, in
particular how it is locating (or not) the keytab.

Some info about the client would be useful. In particular; what
software is it? what OS is it running on? does it try Kerberos or any
other login before that failed NTLM one?

NP: you could try the negotiate_wrapper helper to setup both Kerberos
and NTLM. But the best option is to get Kerberos working before going
there.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUQa8tAAoJELJo5wb/XPRjtNwH/j7mlsugEc/mhsu8Xd031VBH
WOXzci+43dBbA5eJsJVIPQWHUT0KsyT6GyOzG2BW9EoGV5ONOcaWvMGI6DGEcFhy
V+1XZTW1zlWCL8NgPbduPxK/E+AhTWiZrFqOowjRHi4SsJfRFF6bnCvbB6zagJPM
haNsB0rt2GhieECUAOqIn0eZF4a25kuuld7r3FuNmHl4XDHy/AqFN7XNtBB0t1JN
VpMPs7tKMIkEwkZ8YAzWcPrn8mEBHVlMFtS1h4G4o/gKB5MF3WWGmlFyggw9phEs
zggGCkABnPW2nKyND0LB++cBvuaFsUcKtNpbNI2Y2Lyuuhl9YOgn5Z1Nu/G4zog=
=QkfN
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Sat Oct 18 00:33:26 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 18 Oct 2014 13:33:26 +1300
Subject: [squid-users] Central Proxy using WCCP to multiple sites in our
 network with ASA box.
In-Reply-To: <0091F25702DBCD438E9EB76FF2CF5204F7314954@ngamil-exc02.nga.local>
References: <0091F25702DBCD438E9EB76FF2CF5204F7314954@ngamil-exc02.nga.local>
Message-ID: <5441B556.4050108@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 18/10/2014 8:47 a.m., Luderitz Bob wrote:
> I have one central Proxy Server running Squid 3.1.10 under CentOS
> 6.3 running locally here and also for our 2 remote sites for all
> http traffic.
> 
> We are using Cisco's WCCP and between the remote sites and the
> Squid is a ASA box.
> 
> where the Proxy is running Site A and one of the remote Site B. 
> From either of the remote sites, when I try to access a printer or
> other web enabled device thru a browser that is not defined in
> squid.conf, I get access denied. This is strange to me as this
> request should be considered part of the internal network. When I
> put statements in squid.conf for this print, I then get connection
> timed out.


What do you mean by "defined in squid.conf"? What statements?

and, what does your squid.conf contain already?

> 
> From the Squid server, I cannot ping this remote printer due to the
> static route has 0.0.0.0 as its gateway address.
> 

That should not affect ping/ICMP.


> See the below config for one of the remote sites:
> 
> In /etc/rc.local file:
> 
> iptunnel add tun-cc mode gre remote 192.168.253.16 local
> 10.80.166.227 dev eth0 ip link set dev tun-cc up ip route add
> 10.80.202.0/23 dev tun-cc metric 101
> 

Remote 192.168.253.16 ??
That might be the problem. How does 192.168.* traffic get routed over
the Internet to remote endpoint?


> In squid.conf, this network should be considered internal: acl
> nga_net src 10.80.0.0/16    # Internal network (I have tried
> splitting out the ACL statements but same result)
> 
> http_access allow nga_net
> 
> If I look at the static routes on the server (netstat -rn or route
> -v) Destination     Gateway         Genmask         Flags   MSS
> Window  irtt Iface 1.2.3.0         0.0.0.0         255.255.255.0
> U         0 0          0 gre0 10.80.166.0     0.0.0.0
> 255.255.255.0   U         0 0          0 eth0 10.80.202.0
> 0.0.0.0         255.255.254.0   U         0 0          0 tun-cc
> (remote site) 0.0.0.0         10.80.166.254   0.0.0.0         UG
> 0 0          0 eth0
> 
> As you can see, the gateway for this remote site is the Internet
> (0.0.0.0)

No. That is link-local "gateway". As in: this machine thinks it is has
a direct cable/wireless connection to all machines in that netblock -
maybe a un-managed switch or hub on between but nothing more. Thus no
gateway router is needed to contact them.

The way to things on Internet is unknown and complex, thus a gateway
(10.80.166.254) is needed to manage routing those packets around.

Looks correct to me like that routing table is correct, even if you
are misunderstanding it.


NP: the tun-cc should be wrapping the packets in a tunnel wrapper IP
that can traverse the network/Internet between this machine and the
other end of the tunnel. Just as if the tunnel were a single "wire".


> and thinking it should be 10.80.166.254. When I try to change the
> gateway for this static route, I get message - RTNETLINK answers:
> File exists If I remove the static route, I cannot get to any
> internal or Internet site from a remote site workstation.
> 
> Due to the ASA in the traffic path of the remote sites, there is a
> gre tunnel setup for outbound traffic from the Squid server,
> without the tunnel the packet would be dropped by the ASA box.
> 
> I know the best practices is to have a proxy server at each remote
> location, but this solution does work for most requests. Has anyone
> else run into this and found a solution, thanks....
> 


This is what I think is happening:

 * "normal" traffic from Squid is destined to Internet servers, thus
has Squid 10.* src-IP and some global dst-IP. These go out via eth0 to
the ASA and get routed (and NAT?) applied normally.

 * the internal traffic to remove POP (including ping?) attempts to go
out the tunnel, and gets wrapped as src-IP 10.80.166.227 with dst-IP
192.168.253.16. Then sent out eth0 to the ASA.
   - something blocks/drops those packets ?

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUQbVWAAoJELJo5wb/XPRjP40H/jeBJpG/7ku5+YZVWk1UTEYO
tcd1UWwws5bEHqTP6HbFWloks/utXOXEnQmd+CuUanrXooI5ykpXQy8oBo4sJzY+
DZqlNltryiywf+0SYD8i1OfutxSeDIjn2NpiBGO6HppFaZhuoKeiP2MLqhR/wxee
GXxteK9kuRDOIcufvY+pIx3HZwXQOAykCATM65AxprgzebwKfYNqxRIzfCUUL0ti
pIFeNLDdzcCJieys4KCVvf1VUvpErSE/Eh52Wvwuv2w4zRzQhMrQ1ejC1Qlz3GjH
wqnuww1qXTUWCtCSGs8oeCpP3PPYX4IkE3FWuPSEaPmWhQ/Q02tQP8bd1t7wQ6Y=
=+3m1
-----END PGP SIGNATURE-----


From eric.lackey at gmail.com  Sat Oct 18 05:10:02 2014
From: eric.lackey at gmail.com (Eric Lackey)
Date: Sat, 18 Oct 2014 00:10:02 -0500
Subject: [squid-users] HTTPS Filtering by Certificate Subject Name
Message-ID: <CAAaTm_AgUMT22eaBWVenuBTxuauCZHLUw2GAEYCqRnyeF-Rc0w@mail.gmail.com>

It looks like this question has come up before, but I'm hoping to get some
further details on it.

I've used a couple of firewalls (Watchguard & Fortigate) that allow me to
do a level of HTTPS site filtering without decryption. I believe that it
works by requesting and examining the certificate sent from the remote
server. If the subject name or subject alternate names on the certificate
match a whitelist of domains that we have specified then access to the site
is allowed. As far as I know, it does not require decrypting the SSL
connection and I'm positive that it doesn't return self generated
certificates.

It would not be very effective for someone trying to use Squid for blocking
end users access to every site on the Internet. But, it works great for our
use case where we want to allow our servers to only access a handful of
sites.

>From everything I've read, it looks like the only option is for Squid to
decrypt the connection. Is there a particular reason why this feature could
not be implemented in Squid if it's available in these other devices? Or if
it is available, could I get some direction.

Thank you in advance for any help.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141018/b16b2947/attachment.htm>

From james at ejbdigital.com.au  Sat Oct 18 07:22:14 2014
From: james at ejbdigital.com.au (James Harper)
Date: Sat, 18 Oct 2014 07:22:14 +0000
Subject: [squid-users] HTTPS Filtering by Certificate Subject Name
In-Reply-To: <CAAaTm_AgUMT22eaBWVenuBTxuauCZHLUw2GAEYCqRnyeF-Rc0w@mail.gmail.com>
References: <CAAaTm_AgUMT22eaBWVenuBTxuauCZHLUw2GAEYCqRnyeF-Rc0w@mail.gmail.com>
Message-ID: <6b35d4eebe3840039cd706f4265a72d4@HKNPR04MB0388.apcprd04.prod.outlook.com>

> 
> It looks like this question has come up before, but I'm hoping to get some
> further details on it.
> 
> I've used a couple of firewalls (Watchguard & Fortigate) that allow me to do a
> level of HTTPS site filtering without decryption. I believe that it works by
> requesting and examining the certificate sent from the remote server. If the
> subject name or subject alternate names on the certificate match a whitelist
> of domains that we have specified then access to the site is allowed. As far as
> I know, it does not require decrypting the SSL connection and I'm positive
> that it doesn't return self generated certificates.
> 
> It would not be very effective for someone trying to use Squid for blocking
> end users access to every site on the Internet. But, it works great for our use
> case where we want to allow our servers to only access a handful of sites.
> 
> From everything I've read, it looks like the only option is for Squid to decrypt
> the connection. Is there a particular reason why this feature could not be
> implemented in Squid if it's available in these other devices? Or if it is
> available, could I get some direction.
> 

I assume you are doing this for transparent proxying, otherwise you already have the hostname the user is trying to access, which is better than the cert name.

You could wait for this http://wiki.squid-cache.org/Features/SslPeekAndSplice which might eventually be able to do what you want.

In the meantime, you could try using an external acl. I didn't have a lot of luck... it works but has some limitations. Basically I threw together some php (see end of email), then used the following configuration:

# actual cert doesn't matter as it isn't used, but squid insists on it being there
https_port 0.0.0.0:33129 intercept name=transparentssl cert=/etc/squid/dummy.pem ssl-bump
...
ssl_bump none all
...
external_acl_type check_ssl %DST %PORT /usr/lib/squid3/check_ssl_cert_name
...
acl ssl_bad external check_ssl facebook.com
...
http_access deny transproxyssl ssl_bad
deny_info TCP_RESET transproxyssl

That's blacklist, not whitelist, but easy enough to invert. The problem I had is that I couldn't find a way to specify multiple 'acl ssl_bad external ...' lines, so you'd need a different acl + http_access for every certificate name you wanted to check against.

You'll find cases that will cause you trouble though, eg the certificate for "google.com" is also for "youtube.com", so you can't allow one without allowing the other.

About the code - I basically just threw it together using a few examples of ssl cert identification that google found for me. I don't sanitise any input. It almost certainly leaks memory and doesn't handle error conditions well, or at all. And the actual comparison to the value being tested is very basic. And I make the assumption that the certificate has a san, and that the cn is in the san list, which isn't always correct. Hopefully you will derive some inspiration from it though. One additional thing it could do is log the cn to the logfile - append "log=$cn" to the OK or ERR output, then use %ea (I think) in the squid log directive to log that value. Also PHP is probably a poor choice of language - I don't really know PHP it just happened to be the language my google search returned the best examples in.

I think squid caches the result of the external acl so performance shouldn't be too bad. If squid didn't cache the result you'd probably need to build some caching yourself otherwise it would do a callout every time.

James

#!/usr/bin/php
<?
stream_set_timeout(STDIN, -1);
while (!feof(STDIN)) {
  $line = trim(fgets(STDIN));
  if (substr_count($line, ' ') < 1) {
    continue;
  }
  $params = explode(' ', $line);
  $host = $params[0];
  $port = $params[1];
  $test = $params[2];

  $g = stream_context_create (array("ssl" => array("capture_peer_cert" => true)));
  $r = stream_socket_client("ssl://$host:$port", $errno, $errstr, 30, STREAM_CLIENT_CONNECT, $g);
  $cont = stream_context_get_params($r);
  $cert = openssl_x509_parse($cont["options"]["ssl"]["peer_certificate"]);
  $cn = $cert["subject"]["CN"];
  $san = $cert["extensions"]["subjectAltName"];
  $match = false;
  foreach (explode(', ', $san) as $name) {
    if (substr($name, -strlen($test)) == $test) {
      $match = true;
      break;
    }
  }
  if ($match) {
    fwrite(STDOUT, "OK\n");
  } else {
    fwrite(STDOUT, "ERR\n");
  }
}
?>


From squid at visolve.com  Sat Oct 18 07:27:45 2014
From: squid at visolve.com (Visolve Squid)
Date: Sat, 18 Oct 2014 12:57:45 +0530
Subject: [squid-users] website search broken
In-Reply-To: <b76b0d8cd5f34744b6adfeacfe2bd3c1@HKNPR04MB0388.apcprd04.prod.outlook.com>
References: <b76b0d8cd5f34744b6adfeacfe2bd3c1@HKNPR04MB0388.apcprd04.prod.outlook.com>
Message-ID: <54421671.80006@visolve.com>

Hi,

Now the URL "/cgi-bin/swish-query.cgi " was able to reach.

Please, check it "_http://www.squid-cache.org/cgi-bin/swish-query.cgi_"

Regards,
ViSolve Squid

On 10/17/2014 8:12 AM, James Harper wrote:
> Doing a search on the main squid page gives me this:
>
> The requested URL /cgi-bin/swish-query.cgi was not found on this server.
>
> Maybe better doing a google search anyway?
>
> James
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141018/85515ff8/attachment.htm>

From jborrell at central.aplitec.com  Sat Oct 18 07:56:11 2014
From: jborrell at central.aplitec.com (Josep Borrell)
Date: Sat, 18 Oct 2014 07:56:11 +0000
Subject: [squid-users] windowsupdate and ssl_bump
Message-ID: <42DE25A255671C44A93A7B58470DC09C4A6E97D7@Michelle.aplitec.local>

Hi,

We are using a 3.4.8 squid Proxy in intercept mode via wccp.
Squid intercepts HTTP and HTTPS via ssl_bump.
All is working fine except that Windows Machines can't do a Windows Update.
It is not working at all giving an error  80072F8F
with HTTPS redirection disabled all work fine.

Someone knows how to maintain the SSL interception with a functional Windows Update ?

Thanks

Josep


Squid.conf:


# Disable Cache for defined domains
acl disable-dom-cache dstdomain -i "/etc/squid3/no-cache.acl"
cache deny disable-dom-cache
cache allow all

#HTTPS (SSL) trafic interception options
sslcrtd_program /usr/lib/squid3/ssl_crtd -s /var/spool/squid3_ssldb -M 4MB
sslcrtd_children 8 startup=1 idle=1
# Disable ssl_bump for defined domains (using rDNS not always work !!)
acl disable-ssl-bump dstdomain -i "/etc/squid3/no-ssl-bump.acl"
ssl_bump none disable-ssl-bump
ssl_bump server-first all

# Videos/Musics/Images/Libraries Accelerator
store_id_program /etc/squid3/ut-storeid.php
store_id_children 25 startup=10 idle=5 concurrency=0
acl storeiddoms dstdomain -i '/etc/squid3/api-storeid-trial.txt'
store_id_access allow storeiddoms
store_id_access deny all

client_dst_passthru off

http_access allow all

http_port 3128
http_port 8080 intercept
https_port 8081 intercept ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB cert=/etc/squid3/ssl_cert/squidcert.pem

forward_max_tries 25
cache_mem 2 GB
maximum_object_size_in_memory 25 MB
maximum_object_size 1 GB

visible_hostname squid-v2

coredump_dir /var/spool/squid3
cache_replacement_policy heap LFUDA
cache_dir aufs /var/spool/squid3 45000 16 256

refresh_pattern ^http:\/\/.*\.unveiltech\.internal.*  10080 80%  79900  override-expire override-lastmod refresh-ims reload-into-ims ignore-reload ignore-no-store ignore-private ignore-auth ignore-must-revalidate
refresh_pattern ^ftp: 1440 20% 10080
refresh_pattern ^gopher: 1440 0% 10080
refresh_pattern -i (/cgi-bin/|\?) 0 0% 0
refresh_pattern . 0 80% 10080


# FortiGate interface of wccp
wccp2_router 192.168.111.1
# wccp version 2 configuration
wccp2_service standard 90
# tunneling method GRE for forward traffic
wccp2_forwarding_method gre
# tunneling method GRE for return traffic
wccp2_return_method gre
# which interface to use for WCCP (0.0.0.0 determines the interface from routing)
wccp2_address 0.0.0.0

snmp_port 3401
snmp_access allow all

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141018/3c158f10/attachment.htm>

From sudakov at sibptus.tomsk.ru  Sat Oct 18 10:11:16 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Sat, 18 Oct 2014 17:11:16 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <5440A9C0.3030503@norma.perm.ru>
References: <m11nv3$nk8$1@ger.gmane.org>
 <20141008032925.GA77544@admin.sibptus.tomsk.ru>
 <m14if3$1ul$2@ger.gmane.org>
 <20141009021821.GA3372@admin.sibptus.tomsk.ru>
 <20141014052401.GA8411@admin.sibptus.tomsk.ru>
 <m1iqc6$m3g$1@ger.gmane.org>
 <20141016161928.GA49304@admin.sibptus.tomsk.ru>
 <m1p4sp$aq3$1@ger.gmane.org>
 <20141017050231.GB60527@admin.sibptus.tomsk.ru>
 <5440A9C0.3030503@norma.perm.ru>
Message-ID: <20141018101116.GA77970@admin.sibptus.tomsk.ru>

Eugene M. Zheganin wrote:
> >
> > I am attaching a traffic dump.
> >
> > Please look at Frame No. 36, where a ticket is requested for
> > "HTTP/proxy.sibptus.transneft.ru", and then at Frame No. 39, where
> > the ticket is granted, but for the wrong principal name.
> >
> The thing is, valid exchange should not and does not contain the
> KRB5KRB_AP_ERR_MODIFIED error, and yours does. 

I thought as much. This error seems suspicious. But why does a second
request not cause the same error?

> This indicates something
> is wrong between these two hosts (as I understand, 10.14.134.4 is a
> Windows Server, and .122 is a workstation). 

Correct.

> You need to investigate on
> your DC what's happening, Probably these are the etype errors (may be
> not). 

I will ask our Windows admin to enable Kerberos event logging. Maybe
we'll find something there.

The huge problem is the absence of legible diagnostics on the
squid's side (the helper or the Heimdal library produce very
hard-to-interpret and too generic debug output).

> If your DC is really w2k (not w2k3 or w2k8) 

Unfortunately, it is really w2k. 

> and the workstation is
> of different generation, this can happen. 

The workstations are Windows XP and Windows 7, both giving mixed
results.

> Also, lots of howtos spread
> around the Internet, make an engineer believe that he should kreate the
> keytab with only one encryption type for squid, insted kreating the
> keytab with all of available on the DC ciphers, This can also lead to
> complicated situations.

We have tried both ways (enabling all ciphers and enabling only
arcfour-hmac-md5), but it made no difference. Currently we are using
the keytab with one arcfour-hmac-md5 key only:

Vno  Type              Principal
  1  arcfour-hmac-md5 HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU

Which of the ways is correct, in your opinion? Could you repeat?

> 
> There's also a decent article there:
> http://blogs.technet.com/b/askds/archive/2008/06/11/kerberos-authentication-problems-service-principal-name-spn-issues-part-3.aspx

Thanks for the link. I guess it boils down to two possibilities:

1. There is a duplicate SPN somewhere in the forest, or

2. Replication problem between the DCs, the principal's passwords
don't match.

> 
> Could help you as it did help me one day.

Which was your situation when the article helped?


-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru


From sudakov at sibptus.tomsk.ru  Sat Oct 18 12:16:55 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Sat, 18 Oct 2014 19:16:55 +0700
Subject: [squid-users] Negotiate bug in squidclient ?
Message-ID: <20141018121654.GA79094@admin.sibptus.tomsk.ru>

This time I tried squidclient to check Kerberos authentication. I am
afraid there is a bug in squidclient where the "Proxy-Authorization:"
header (the Negotiate token) is being sent truncated, and the server
reacts with the 'gss_accept_sec_context() failed:  A token was
invalid.' error.

Here is what I run:

./squidclient -v -h proxy.sibptus.transneft.ru -p 3131 -n http://ya.ru

and what it being sent to the server:

=====================

Request:'GET http://ya.ru HTTP/1.0
Host: ya.ru
User-Agent: squidclient/3.4.8
Accept: */*
Proxy-Authorization: Negotiate YIIGDQYGKwYBBQUCoIIGATCCBf2gDTALBgkqhkiG9xIBAgKiggXqBIIF5mCCBeIGCSqGSIb3EgECAgEAboIF0TCCBc2gAwIBBaEDAgEOogcDBQAAAAAAo4IEtGGCBLAwggSsoAMCAQWhFhsUU0lCUFRVUy5UUkFOU05FRlQuUlWiLTAroAMCAQGhJDAiGwRIVFRQGxpwcm94eS5zaWJwdHVzLnRyYW5zbmVmdC5ydaOCBFwwggRYoAMCAReiggRPBIIES8Tjx9IM4sRh+fXqnEEslV/wXuEqv1o5fA9k9QYfpd1Wwhll7ZDKEsDrGPKp57ylsm7X9l5ODhONBlkGwd24vngmmlgQ3Frxn8csh2+QgxeQZqhiV2QgdT/MVU3Khjae4jklS/F5yFxdd4DO0UrqRu7iaXLsgRf4h/4p/kxkTlQAtn+u5H8Nm50M670pdHU5s5GWAIKFY+v/oq6k8OdmU/COaXn5qkU2UtTPj51i24/Vi8aI7qb+KnvpmEOktMZ/+lhbjerZut6jQYXX7rZ6K/uBAGbI8wBLPjymv8yyd9bE3THTOuykcI+l/lEi3uyPP9ievHYnvlT9c1TSvuTRCJOFpRZ2WM1MPifu7GJ6RYkReHoyhQC+uCXcOaWsCn22uWBYNvVsUWCFEPAkId40k5y7w6IThtoDLC6+3NYtWJgl+LhXbiRNMl25H+4nDyNhm8eg2XC46WPJQ/4ljBfD/GoAJz6I2hWD+5Pvc1zGQQcS1w9vTXuDoWqkDeCQKFhfIWASY7H9w0v1IePRbGx+o8FJZuVtTU/8DKDJJ0x3FVxaMjKwrZk08jsDtxFpk+pdWOH9li+WPjXG5d1TL9tntrt6gsnl89i4hjuCfIL3hpfLN//QE41e+pbVGgyEOQk06mYetn6juKStlslQSPk8wXMr2J40Avmgzv9fFSZ5IdH9uyFbau0Q6Hf4Y6BVNKkT8qDxVjmakCDz8xl93k6HLcDUdt98Connection: close

'
Resolving... proxy.sibptus.transneft.ru
Connecting... proxy.sibptus.transneft.ru(10.14.140.9)
Connected to: proxy.sibptus.transneft.ru (10.14.140.9)
Sending HTTP request ... done.
HTTP/1.1 407 Proxy Authentication Required
Server: squid/3.4.8
=====================

WireShark reports about "SPNEGO-KRB5 truncated" in this packet
(though the capture size was set to "unlimited" and squid's helper
reacts with 'A token was invalid.'

Could someone reproduce?

Attached please find how it looks in Wireshark (note the "Connection:"
header glued to the end of the truncated Negotiate token).


-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-------------- next part --------------
GET http://ya.ru HTTP/1.0
Host: ya.ru
User-Agent: squidclient/3.4.8
Accept: */*
Proxy-Authorization: Negotiate YIIGDQYGKwYBBQUCoIIGATCCBf2gDTALBgkqhkiG9xIBAgKiggXqBIIF5mCCBeIGCSqGSIb3EgECAgEAboIF0TCCBc2gAwIBBaEDAgEOogcDBQAAAAAAo4IEtGGCBLAwggSsoAMCAQWhFhsUU0lCUFRVUy5UUkFOU05FRlQuUlWiLTAroAMCAQGhJDAiGwRIVFRQGxpwcm94eS5zaWJwdHVzLnRyYW5zbmVmdC5ydaOCBFwwggRYoAMCAReiggRPBIIES8Tjx9IM4sRh+fXqnEEslV/wXuEqv1o5fA9k9QYfpd1Wwhll7ZDKEsDrGPKp57ylsm7X9l5ODhONBlkGwd24vngmmlgQ3Frxn8csh2+QgxeQZqhiV2QgdT/MVU3Khjae4jklS/F5yFxdd4DO0UrqRu7iaXLsgRf4h/4p/kxkTlQAtn+u5H8Nm50M670pdHU5s5GWAIKFY+v/oq6k8OdmU/COaXn5qkU2UtTPj51i24/Vi8aI7qb+KnvpmEOktMZ/+lhbjerZut6jQYXX7rZ6K/uBAGbI8wBLPjymv8yyd9bE3THTOuykcI+l/lEi3uyPP9ievHYnvlT9c1TSvuTRCJOFpRZ2WM1MPifu7GJ6RYkReHoyhQC+uCXcOaWsCn22uWBYNvVsUWCFEPAkId40k5y7w6IThtoDLC6+3NYtWJgl+LhXbiRNMl25H+4nDyNhm8eg2XC46WPJQ/4ljBfD/GoAJz6I2hWD+5Pvc1zGQQcS1w9vTXuDoWqkDeCQKFhfIWASY7H9w0v1IePRbGx+o8FJZuVtTU/8DKDJJ0x3FVxaMjKwrZk08jsDtxFpk+pdWOH9li+WPjXG5d1TL9tntrt6gsnl89i4hjuCfIL3hpfLN//QE41e+pbVGgyEOQk06mYetn6juKStlslQSPk8wXMr2J40Avmgzv9fFSZ5IdH9uyFbau0Q6Hf4Y6BVNKkT8qDxVjmakCDz8xl93k6HLcDUdt98Connection: close

HTTP/1.1 407 Proxy Authentication Required
Server: squid/3.4.8
Mime-Version: 1.0
Date: Sat, 18 Oct 2014 11:56:09 GMT
Content-Type: text/html
Content-Length: 4231
X-Squid-Error: ERR_CACHE_ACCESS_DENIED 0
Vary: Accept-Language
Content-Language: en
Proxy-Authenticate: Negotiate
X-Cache: MISS from proxy.sibptus.transneft.ru
X-Cache-Lookup: NONE from proxy.sibptus.transneft.ru:3131
Via: 1.1 proxy.sibptus.transneft.ru (squid/3.4.8)
Connection: close

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>ERROR: Cache Access Denied</title>
<style type="text/css"><!-- 
 /*
 Stylesheet for Squid Error pages
 Adapted from design by Free CSS Templates
 http://www.freecsstemplates.org
 Released for free under a Creative Commons Attribution 2.5 License
*/

/* Page basics */
* {
	font-family: verdana, sans-serif;
}

html body {
	margin: 0;
	padding: 0;
	background: #efefef;
	font-size: 12px;
	color: #1e1e1e;
}

/* Page displayed title area */
#titles {
	margin-left: 15px;
	padding: 10px;
	padding-left: 100px;
	background: url('http://www.squid-cache.org/Artwork/SN.png') no-repeat left;
}

/* initial title */
#titles h1 {
	color: #000000;
}
#titles h2 {
	color: #000000;
}

/* special event: FTP success page titles */
#titles ftpsuccess {
	background-color:#00ff00;
	width:100%;
}

/* Page displayed body content area */
#content {
	padding: 10px;
	background: #ffffff;
}

/* General text */
p {
}

/* error brief description */
#error p {
}

/* some data which may have caused the problem */
#data {
}

/* the error message received from the system or other software */
#sysmsg {
}

pre {
    font-family:sans-serif;
}

/* special event: FTP / Gopher directory listing */
#dirmsg {
    font-family: courier;
    color: black;
    font-size: 10pt;
}
#dirlisting {
    margin-left: 2%;
    margin-right: 2%;
}
#dirlisting tr.entry td.icon,td.filename,td.size,td.date {
    border-bottom: groove;
}
#dirlisting td.size {
    width: 50px;
    text-align: right;
    padding-right: 5px;
}

/* horizontal lines */
hr {
	margin: 0;
}

/* page displayed footer area */
#footer {
	font-size: 9px;
	padding-left: 10px;
}


body
:lang(fa) { direction: rtl; font-size: 100%; font-family: Tahoma, Roya, sans-serif; float: right; }
:lang(he) { direction: rtl; }
 --></style>
</head><body id=ERR_CACHE_ACCESS_DENIED>
<div id="titles">
<h1>ERROR</h1>
<h2>Cache Access Denied.</h2>
</div>
<hr>

<div id="content">
<p>The following error was encountered while trying to retrieve the URL: <a href="http://ya.ru/">http://ya.ru/</a></p>

<blockquote id="error">
<p><b>Cache Access Denied.</b></p>
</blockquote>

<p>Sorry, you are not currently allowed to request http://ya.ru/ from this cache until you have authenticated yourself.</p>

<p>Please contact the <a href="mailto:noc at sibptus.ru?subject=CacheErrorInfo%20-%20ERR_CACHE_ACCESS_DENIED&amp;body=CacheHost%3A%20proxy.sibptus.transneft.ru%0D%0AErrPage%3A%20ERR_CACHE_ACCESS_DENIED%0D%0AErr%3A%20%5Bnone%5D%0D%0ATimeStamp%3A%20Sat,%2018%20Oct%202014%2011%3A56%3A09%20GMT%0D%0A%0D%0AClientIP%3A%2010.14.140.125%0D%0A%0D%0AHTTP%20Request%3A%0D%0AGET%20%2F%20HTTP%2F1.0%0AHost%3A%20ya.ru%0D%0AUser-Agent%3A%20squidclient%2F3.4.8%0D%0AAccept%3A%20*%2F*%0D%0AProxy-Authorization%3A%20Negotiate%20YIIGDQYGKwYBBQUCoIIGATCCBf2gDTALBgkqhkiG9xIBAgKiggXqBIIF5mCCBeIGCSqGSIb3EgECAgEAboIF0TCCBc2gAwIBBaEDAgEOogcDBQAAAAAAo4IEtGGCBLAwggSsoAMCAQWhFhsUU0lCUFRVUy5UUkFOU05FRlQuUlWiLTAroAMCAQGhJDAiGwRIVFRQGxpwcm94eS5zaWJwdHVzLnRyYW5zbmVmdC5ydaOCBFwwggRYoAMCAReiggRPBIIES8Tjx9IM4sRh+fXqnEEslV%2FwXuEqv1o5fA9k9QYfpd1Wwhll7ZDKEsDrGPKp57ylsm7X9l5ODhONBlkGwd24vngmmlgQ3Frxn8csh2+QgxeQZqhiV2QgdT%2FMVU3Khjae4jklS%2FF5yFxdd4DO0UrqRu7iaXLsgRf4h%2F4p%2FkxkTlQAtn+u5H8Nm50M670pdHU5s5GWAIKFY+v%2Foq6k8OdmU%2FCOaXn5qkU2UtTPj51i24%2FVi8aI7qb+KnvpmEOktMZ%2F+lhbjerZut6jQYXX7rZ6K%2FuBAGbI8wBLPjymv8yyd9bE3THTOuykcI+l%2FlEi3uyPP9ievHYnvlT9c1TSvuTRCJOFpRZ2WM1MPifu7GJ6RYkReHoyhQC+uCXcOaWsCn22uWBYNvVsUWCFEPAkId40k5y7w6IThtoDLC6+3NYtWJgl+LhXbiRNMl25H+4nDyNhm8eg2XC46WPJQ%2F4ljBfD%2FGoAJz6I2hWD+5Pvc1zGQQcS1w9vTXuDoWqkDeCQKFhfIWASY7H9w0v1IePRbGx+o8FJZuVtTU%2F8DKDJJ0x3FVxaMjKwrZk08jsDtxFpk+pdWOH9li+WPjXG5d1TL9tntrt6gsnl89i4hjuCfIL3hpfLN%2F%2FQE41e+pbVGgyEOQk06mYetn6juKStlslQSPk8wXMr2J40Avmgzv9fFSZ5IdH9uyFbau0Q6Hf4Y6BVNKkT8qDxVjmakCDz8xl93k6HLcDUdt98Connection%3A%20close%0D%0A%0D%0A%0D%0A">cache administrator</a> if you have difficulties authenticating yourself.</p>

<br>
</div>

<hr> 
<div id="footer">
<p>Generated Sat, 18 Oct 2014 11:56:09 GMT by proxy.sibptus.transneft.ru (squid/3.4.8)</p>
<!-- ERR_CACHE_ACCESS_DENIED -->
</div>
</body></html>

From eugene at zhegan.in  Sat Oct 18 18:40:03 2014
From: eugene at zhegan.in (Eugene M. Zheganin)
Date: Sun, 19 Oct 2014 00:40:03 +0600
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <20141018101116.GA77970@admin.sibptus.tomsk.ru>
References: <m11nv3$nk8$1@ger.gmane.org>
 <20141008032925.GA77544@admin.sibptus.tomsk.ru> <m14if3$1ul$2@ger.gmane.org>
 <20141009021821.GA3372@admin.sibptus.tomsk.ru>
 <20141014052401.GA8411@admin.sibptus.tomsk.ru> <m1iqc6$m3g$1@ger.gmane.org>
 <20141016161928.GA49304@admin.sibptus.tomsk.ru> <m1p4sp$aq3$1@ger.gmane.org>
 <20141017050231.GB60527@admin.sibptus.tomsk.ru>
 <5440A9C0.3030503@norma.perm.ru>
 <20141018101116.GA77970@admin.sibptus.tomsk.ru>
Message-ID: <5442B403.3070306@zhegan.in>

Hi.

On 18.10.2014 16:11, Victor Sudakov wrote:
> I thought as much. This error seems suspicious. But why does a second
> request not cause the same error?
No idea.
> We have tried both ways (enabling all ciphers and enabling only
> arcfour-hmac-md5), but it made no difference. Currently we are using
> the keytab with one arcfour-hmac-md5 key only:
>
> Vno  Type              Principal
>    1  arcfour-hmac-md5 HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU
>
> Which of the ways is correct, in your opinion? Could you repeat?
To my knowledge, RC4 should fit, because newer versions add only aes 
cipher suites.
> Which was your situation when the article helped?
I had a situaltion when there were lots ot e-types errors between non-R2 
w2k3 and w7 workstations. Plus, my keytab was only for RC4 only. Plus, I 
had duplicate SPNs and wrong understanding about how the kerberos 
exchange is working and what principal name is requested when (yours 
seems to be correct, though). I played with "use only DES" setting for a 
troubled user in AD, played with msDS-SupportedEncrytionTypes in AD, but 
due to all the complications this didn't help. So, I eliminated  w2k3 by 
changing it to the w2k3r2 dc, - this didn't help by itself, so I had to 
clear out other errors. Then my setup started to work. Unfortunately, I 
don't have an answer to the question "what is needed for squid to work 
in a kerberos environment with different generation OSes". I also didn't 
get KRB5KRB_AP_ERR_MODIFIED error. I can say that if we talk about w7 
coexistance with the w2k3 domain controller - no critical errors were 
seen, so workstations could log in to the AD domain just fine.

I would propose to you to conduct some tests pointing your squid setup 
to some modern DC, if you have one, and see if this error would disappear.

Eugene.


From sudakov at sibptus.tomsk.ru  Sun Oct 19 07:32:58 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Sun, 19 Oct 2014 14:32:58 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <5442B403.3070306@zhegan.in>
References: <m14if3$1ul$2@ger.gmane.org>
 <20141009021821.GA3372@admin.sibptus.tomsk.ru>
 <20141014052401.GA8411@admin.sibptus.tomsk.ru>
 <m1iqc6$m3g$1@ger.gmane.org>
 <20141016161928.GA49304@admin.sibptus.tomsk.ru>
 <m1p4sp$aq3$1@ger.gmane.org>
 <20141017050231.GB60527@admin.sibptus.tomsk.ru>
 <5440A9C0.3030503@norma.perm.ru>
 <20141018101116.GA77970@admin.sibptus.tomsk.ru>
 <5442B403.3070306@zhegan.in>
Message-ID: <20141019073258.GA91627@admin.sibptus.tomsk.ru>

Eugene M. Zheganin wrote:
> 
> On 18.10.2014 16:11, Victor Sudakov wrote:
> > I thought as much. This error seems suspicious. But why does a second
> > request not cause the same error?
> No idea.

Hopefully I can interest our Windows admin to enable Kerberos event
logging per KB262177.

But for the present I have found an ugly workaround. In squid's keytab, I
created another principal called 'squiduser' with the same hex key and
kvno as that of the principal 'HTTP/proxy.sibptus.transneft.ru.'

Of course this required running the squid authentication helper with
the '-s GSS_C_NO_NAME' option.

And you know what? It works. Browsers are being authenticated all
right.

This means that the encrypted token is all right, and the problem was
only in the principal name (it being different in the request and the
received ticket). This is quite mysterious to me. Also, Heimdal error
messages definitely suck.


-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru


From squid3 at treenet.co.nz  Sun Oct 19 20:31:54 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 20 Oct 2014 09:31:54 +1300
Subject: [squid-users] windowsupdate and ssl_bump
In-Reply-To: <42DE25A255671C44A93A7B58470DC09C4A6E97D7@Michelle.aplitec.local>
References: <42DE25A255671C44A93A7B58470DC09C4A6E97D7@Michelle.aplitec.local>
Message-ID: <54441FBA.1060300@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 18/10/2014 8:56 p.m., Josep Borrell wrote:
> Hi,
> 
> We are using a 3.4.8 squid Proxy in intercept mode via wccp. Squid
> intercepts HTTP and HTTPS via ssl_bump. All is working fine except
> that Windows Machines can't do a Windows Update. It is not working
> at all giving an error  80072F8F with HTTPS redirection disabled
> all work fine.
> 
> Someone knows how to maintain the SSL interception with a
> functional Windows Update ?

Windows Update has always done a "call home" CONNECT rquest to port
443 to verify the licensing or something. It may or may not actually
be HTTPS.

I would look into what is happening with those requests with your
bumping setup.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJURB+6AAoJELJo5wb/XPRjGzQH/jOWkNZMTRIL0X87hmPLYjEd
L1qoE4F+/Phh+d3aMl9EJxhdWQ6BuYOdNGTrL1Jpq4/37xFxUj3vCuZ638iY6Mad
ETQYTwb1oiX5vzJs0P/VaswJeQ36pR5yAMP0RmS3Y2uBTxeD9kSjQLwiwezt0BKI
obUqwJHcGS+K8CXsLfJle4ivIDkOy+BNFt/ujOYjjQ8UaY1Sg2GLZU2rtCFOoqav
05p62E4/jVkrBUP7o4AXFJADXHjaH/73FB/XY517vWp8R181xz6eWYcbkF8zdhzA
TixCnmt83mJEH5AdkNpl4IRRzaIPP4KsBTUUE4LN9cHH/ZS9ZQHPc2bKVVjr/aU=
=g5io
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Sun Oct 19 20:42:21 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 20 Oct 2014 09:42:21 +1300
Subject: [squid-users] Negotiate bug in squidclient ?
In-Reply-To: <20141018121654.GA79094@admin.sibptus.tomsk.ru>
References: <20141018121654.GA79094@admin.sibptus.tomsk.ru>
Message-ID: <5444222D.4060208@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

That is a bug. Please add to bugzilla.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJURCItAAoJELJo5wb/XPRjtgkIAKyGuSZQnpfofxeH5VggQ/sJ
2coDiglI/rVFjO4UAaCIu3e8Vhzst7cDmWaCbY9Gre6pemlliHuX2+64TmlzPcNv
3vRxx3zqUe19wwZ7shlsJXKRERJyQchM17olDAeD3bifz9QdG2Ha8pQOVLtZ2/pd
Pxzm2b4Au3HQ5uWKIB/otnjBD9ljLyrA4L1/OUqcUn65jsk/gv2xBQKHUUN9sUt4
PFW8tPxe136efDWzDBAshaBGyZhow0p8ba4KtTzolcLV1San0eOjKZ2H4Y4VnuRV
roFO0q3yuSpE598kDy7LZRKPImxiHApe6CIjXq3QLfIZRHejBVBTTdw0I1YiT1E=
=J73y
-----END PGP SIGNATURE-----


From eliezer at ngtech.co.il  Sun Oct 19 22:50:49 2014
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Mon, 20 Oct 2014 01:50:49 +0300
Subject: [squid-users] Squid,
	Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
	3.4.7.)
In-Reply-To: <20141019073258.GA91627@admin.sibptus.tomsk.ru>
References: <m14if3$1ul$2@ger.gmane.org>
 <20141009021821.GA3372@admin.sibptus.tomsk.ru>
 <20141014052401.GA8411@admin.sibptus.tomsk.ru> <m1iqc6$m3g$1@ger.gmane.org>
 <20141016161928.GA49304@admin.sibptus.tomsk.ru> <m1p4sp$aq3$1@ger.gmane.org>
 <20141017050231.GB60527@admin.sibptus.tomsk.ru>
 <5440A9C0.3030503@norma.perm.ru>
 <20141018101116.GA77970@admin.sibptus.tomsk.ru> <5442B403.3070306@zhegan.in>
 <20141019073258.GA91627@admin.sibptus.tomsk.ru>
Message-ID: <54444049.1010904@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 10/19/2014 10:32 AM, Victor Sudakov wrote:
> Hopefully I can interest our Windows admin to enable Kerberos
> event logging per KB262177.
> 
> But for the present I have found an ugly workaround. In squid's
> keytab, I created another principal called 'squiduser' with the
> same hex key and kvno as that of the principal
> 'HTTP/proxy.sibptus.transneft.ru.'
> 
> Of course this required running the squid authentication helper
> with the '-s GSS_C_NO_NAME' option.
> 
> And you know what? It works. Browsers are being authenticated all 
> right.
> 
> This means that the encrypted token is all right, and the problem
> was only in the principal name (it being different in the request
> and the received ticket). This is quite mysterious to me. Also,
> Heimdal error messages definitely suck.
> 
So you actually made it work!??

And about the basic issues that you were having with performance, does
it help to run Kerberos instead of NTLM (it should...)?

Eliezer
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUREBJAAoJENxnfXtQ8ZQUGsgIAJYiK+JM4cRpbaXimVDwj7j6
zKmHpwreZYI1848Bo+Gcfxm4M5m9ia2k53EYYCJ6KdBieu8necYMk7/TUdlYQhx+
Zw/T1SmNNr3vRNgn4vFAOeq+Ro/gPuWbhd0towgrG0XOWZVEoPjIFOrQuIxEv+Hw
fa/8YnITpW9ZV6Jlj0NioWAVAwUAlSBK+fZSV2AUM2jt7O095rgzsQAdWNeV2i9n
nxbl52flILyXWFbZCCBMH/yGUE4wgK6oazSlAZlOZfB/LwTwyc8DYUj7eeYpkYXj
u6vzsVho1hBXCZKnekScDRQT+oKOMxP7CwmMNSVkDYOkI3TjEcYdFXo0NWqTK8o=
=OzsW
-----END PGP SIGNATURE-----


From alex at samad.com.au  Mon Oct 20 01:28:11 2014
From: alex at samad.com.au (Alexander Samad)
Date: Mon, 20 Oct 2014 12:28:11 +1100
Subject: [squid-users] Question squid on centos 6.5 and poodle
In-Reply-To: <5440C345.6030603@treenet.co.nz>
References: <CAJ+Q1PW_K4gs5gRQpd9N_QEmsh+PcPuv_TL513jcDn7H0EMUhQ@mail.gmail.com>
 <5440C345.6030603@treenet.co.nz>
Message-ID: <CAJ+Q1PVwU7BSc4GGVj-uAtA_J6D8SdML5PhPdtXBNdD57pv2sw@mail.gmail.com>

Hi

Thanks for clearing that up. so when i do a openssl ciphers and select
the ciphers i want including the PFS enables oned, i take the list and
try and use it in ciphers= and the list seems to be dissregarded and
only 1 cipher is available. atleast from online checking and with
nmap.

I have nossl2 and nossl3, that covers me for most things apart from PFS.

I am not ready to upgrade to a non RHEL/CEntos version as that has
other implications ! But in the end if I must


I am wondering if thats a known bug or I am configuring it wrongly


this is the cipher list I have tried as well

openssl ciphers 'ALL:!SSLv2:!SSLv3:@STRENGTH'
ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:DHE-DSS-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA256:ADH-AES256-GCM-SHA384:ADH-AES256-SHA256:ECDH-RSA-AES256-GCM-SHA384:ECDH-ECDSA-AES256-GCM-SHA384:ECDH-RSA-AES256-SHA384:ECDH-ECDSA-AES256-SHA384:AES256-GCM-SHA384:AES256-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:DHE-DSS-AES128-GCM-SHA256:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-SHA256:DHE-DSS-AES128-SHA256:ADH-AES128-GCM-SHA256:ADH-AES128-SHA256:ECDH-RSA-AES128-GCM-SHA256:ECDH-ECDSA-AES128-GCM-SHA256:ECDH-RSA-AES128-SHA256:ECDH-ECDSA-AES128-SHA256:AES128-GCM-SHA256:AES128-SHA256


ldd points to /usr/lib64/libssl.so.10 and

openssl-1.0.1e-30.el6_5.2.x86_64


Alex

On 17 October 2014 18:20, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 17/10/2014 7:24 p.m., Alexander Samad wrote:
>> Hi
>>
>> I am trying to reconfig the ssl setup on a reverse proxy set
>>
>> https_port 2.7.3.1:443 accel
>> cert=/etc/httpd/conf.d/office.xyz.com.crt
>> key=/etc/httpd/conf.d/office.xyz.com.key
>> dhparams=/etc/httpd/conf.d/office.xyz.com.dhparam
>> defaultsite=office.yieldbroker.com  options=NO_SSLv2,NO_SSLv3
>> cipher=ALL:!SSLv2:!SSLv3 at STRENGTH
>>
>> But I only get a limited list of ciphers, completely different
>> from openssl ciphers 'ALL:!SSLv2:!SSLv3 at STRENGTH'
>>
>> in fact it doesn't seem to look at the cipher option at all
>
> There seems to be some FUD and confusion going around since POODLE was
> announced. In particular people mentioning a "cipher" called SSLv3.
>
> The cipher having problems is CBC. The SSLv3 is simply the SSL/TLS
> version where that cipher is mandatory to support.
>
> Lets be clear:  cipher != SSL/TLS version
>
> The cipher being unusable now *also* makes the whole version unusable
> and dangerous. Just like SSLv2 some years ago when the last of its
> ciphers was broken, and TLSv1.0 will someday soon.
>
>
> The "options=NO_SSLv2,NO_SSLv3" that you have set is sufficient to
> close POODLE vulnerability.
>
> NP: Do make sure you have a Squid 3.2 or later, the older ones enabled
> some "default" options that are pretty bad these days.
>
>>
>> and pointers on what I am doing wrong
>>
>> right now I am left with https_port 2.7.3.1:443 accel
>> cert=/etc/httpd/conf.d/office.xyz.com.crt
>> key=/etc/httpd/conf.d/office.xyz.com.key
>> dhparams=/etc/httpd/conf.d/office.xyz.com.dhparam
>> defaultsite=office.yieldbroker.com  options=NO_SSLv2,NO_SSLv3
>>
>> but https://www.ssllabs.com/ssltest/ gives me an A- .. no PFS.
>
> That I'm afraid depends on your OpenSSL library. Some of them have PFS
> ciphers enabled by default, some you have to add options or ciphers to
> get it, some dont support at all.
>
> You do need dhparams= to enable them. But beyond that its all OpenSSL.
>
> Amos
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2.0.22 (MingW32)
>
> iQEcBAEBAgAGBQJUQMNFAAoJELJo5wb/XPRj5QgH/2MHtjt/ZET3RjiwKfb2RL9x
> MIrL/vNxxDjzJn0fnrk5iXCOd5Z7rWKjD/SO4BndqnADJh2d6pQSCe2LDYyn4/ZQ
> D+giIfRJyYJdPAVpR50PsY/zNqSLWCW8g3/PDCxseRKNayyoOiOaUvU7fBkM4xZD
> bdTz5YoHeGXzzeRItLcaWsFN8JZWb9yI34AHJ7AzpugMz68uV/pW9UHciWrpOuj1
> hvnO3v/oE7Bu+KcTO5d36Fjmyrk00a60YcEMglZSkc7V80pigNsXA0TdKP0z8lE7
> M+2kACtIIuXrzszGyTOMIWRQsxuqYxozVVa3+pwyIUn0QQpqQMJtRN7gPqvkxnM=
> =axnA
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From squid3 at treenet.co.nz  Mon Oct 20 01:36:19 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 20 Oct 2014 14:36:19 +1300
Subject: [squid-users] Question squid on centos 6.5 and poodle
In-Reply-To: <CAJ+Q1PVwU7BSc4GGVj-uAtA_J6D8SdML5PhPdtXBNdD57pv2sw@mail.gmail.com>
References: <CAJ+Q1PW_K4gs5gRQpd9N_QEmsh+PcPuv_TL513jcDn7H0EMUhQ@mail.gmail.com>
 <5440C345.6030603@treenet.co.nz>
 <CAJ+Q1PVwU7BSc4GGVj-uAtA_J6D8SdML5PhPdtXBNdD57pv2sw@mail.gmail.com>
Message-ID: <54446713.1040501@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 20/10/2014 2:28 p.m., Alexander Samad wrote:
> Hi
> 
> Thanks for clearing that up. so when i do a openssl ciphers and
> select the ciphers i want including the PFS enables oned, i take
> the list and try and use it in ciphers= and the list seems to be
> dissregarded and only 1 cipher is available. atleast from online
> checking and with nmap.
> 
> I have nossl2 and nossl3, that covers me for most things apart from
> PFS.
> 
> I am not ready to upgrade to a non RHEL/CEntos version as that has 
> other implications ! But in the end if I must
> 
> 
> I am wondering if thats a known bug or I am configuring it wrongly
> 
> 
> this is the cipher list I have tried as well
> 
> openssl ciphers 'ALL:!SSLv2:!SSLv3:@STRENGTH' 
> ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:DHE-DSS-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA256:ADH-AES256-GCM-SHA384:ADH-AES256-SHA256:ECDH-RSA-AES256-GCM-SHA384:ECDH-ECDSA-AES256-GCM-SHA384:ECDH-RSA-AES256-SHA384:ECDH-ECDSA-AES256-SHA384:AES256-GCM-SHA384:AES256-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:DHE-DSS-AES128-GCM-SHA256:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-SHA256:DHE-DSS-AES128-SHA256:ADH-AES128-GCM-SHA256:ADH-AES128-SHA256:ECDH-RSA-AES128-GCM-SHA256:ECDH-ECDSA-AES128-GCM-SHA256:ECDH-RSA-AES128-SHA256:ECDH-ECDSA-AES128-SHA256:AES128-GCM-SHA256:AES128-SHA256
>
> 
> 
> ldd points to /usr/lib64/libssl.so.10 and
> 
> openssl-1.0.1e-30.el6_5.2.x86_64

That string is just passed as text to libssl.

As I understand it openssl ignores entries  it does not understand. So
I guess your library has been built without support for most of those
ciphers.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJURGcSAAoJELJo5wb/XPRjYvgH/j6AMjimV/DFGlUvo2gSXFhC
pGPyc49g1KHzIqCxJ6gh5xwHf/H/WFbOKtg+MoSHbAzAe9tRH52uoWrNBQonnXfc
OV3F/6gpWe4YPZ8ZyV/8ls0fYnGp/He6MXmwkkYF42PwJLkEFSKZTBZFvbJZv6tk
khVH/yzfJi/U5a+a3tAcPTTnPdB80yy0sBy+NaL2zaTr98OSOCUDToZSMr61TuPN
6CckbK7rjh2s+TgNXl1eUuO6IwzfzJOZLhBefj+jgmG10XXadeg2MdfBIXd75VB6
cz+/e5HHTd1ZK+HBfOgxcOBb0q1v+/tSH2IKoPbnBB1QSNAhZE0Wt619Jtc3fCw=
=iPqR
-----END PGP SIGNATURE-----


From alex at samad.com.au  Mon Oct 20 03:49:15 2014
From: alex at samad.com.au (Alexander Samad)
Date: Mon, 20 Oct 2014 14:49:15 +1100
Subject: [squid-users] Question squid on centos 6.5 and poodle
In-Reply-To: <54446713.1040501@treenet.co.nz>
References: <CAJ+Q1PW_K4gs5gRQpd9N_QEmsh+PcPuv_TL513jcDn7H0EMUhQ@mail.gmail.com>
 <5440C345.6030603@treenet.co.nz>
 <CAJ+Q1PVwU7BSc4GGVj-uAtA_J6D8SdML5PhPdtXBNdD57pv2sw@mail.gmail.com>
 <54446713.1040501@treenet.co.nz>
Message-ID: <CAJ+Q1PUoFO1MorcExBqcZBpac7FuGgDk7ukhO6wNSyKWtbzq6g@mail.gmail.com>

Hi

Hmm thats strange as its openssl that is giving me the list ...
openssl ciphers 'ALL:!SSLv2:!SSLv3:@STRENGTH' plus when i don't put
anything in the ciphers option I get most (but not all of the
ciphers).

A

On 20 October 2014 12:36, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 20/10/2014 2:28 p.m., Alexander Samad wrote:
>> Hi
>>
>> Thanks for clearing that up. so when i do a openssl ciphers and
>> select the ciphers i want including the PFS enables oned, i take
>> the list and try and use it in ciphers= and the list seems to be
>> dissregarded and only 1 cipher is available. atleast from online
>> checking and with nmap.
>>
>> I have nossl2 and nossl3, that covers me for most things apart from
>> PFS.
>>
>> I am not ready to upgrade to a non RHEL/CEntos version as that has
>> other implications ! But in the end if I must
>>
>>
>> I am wondering if thats a known bug or I am configuring it wrongly
>>
>>
>> this is the cipher list I have tried as well
>>
>> openssl ciphers 'ALL:!SSLv2:!SSLv3:@STRENGTH'
>> ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:DHE-DSS-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA256:ADH-AES256-GCM-SHA384:ADH-AES256-SHA256:ECDH-RSA-AES256-GCM-SHA384:ECDH-ECDSA-AES256-GCM-SHA384:ECDH-RSA-AES256-SHA384:ECDH-ECDSA-AES256-SHA384:AES256-GCM-SHA384:AES256-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:DHE-DSS-AES128-GCM-SHA256:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-SHA256:DHE-DSS-AES128-SHA256:ADH-AES128-GCM-SHA256:ADH-AES128-SHA256:ECDH-RSA-AES128-GCM-SHA256:ECDH-ECDSA-AES128-GCM-SHA256:ECDH-RSA-AES128-SHA256:ECDH-ECDSA-AES128-SHA256:AES128-GCM-SHA256:AES128-SHA256
>>
>>
>>
>> ldd points to /usr/lib64/libssl.so.10 and
>>
>> openssl-1.0.1e-30.el6_5.2.x86_64
>
> That string is just passed as text to libssl.
>
> As I understand it openssl ignores entries  it does not understand. So
> I guess your library has been built without support for most of those
> ciphers.
>
> Amos
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2.0.22 (MingW32)
>
> iQEcBAEBAgAGBQJURGcSAAoJELJo5wb/XPRjYvgH/j6AMjimV/DFGlUvo2gSXFhC
> pGPyc49g1KHzIqCxJ6gh5xwHf/H/WFbOKtg+MoSHbAzAe9tRH52uoWrNBQonnXfc
> OV3F/6gpWe4YPZ8ZyV/8ls0fYnGp/He6MXmwkkYF42PwJLkEFSKZTBZFvbJZv6tk
> khVH/yzfJi/U5a+a3tAcPTTnPdB80yy0sBy+NaL2zaTr98OSOCUDToZSMr61TuPN
> 6CckbK7rjh2s+TgNXl1eUuO6IwzfzJOZLhBefj+jgmG10XXadeg2MdfBIXd75VB6
> cz+/e5HHTd1ZK+HBfOgxcOBb0q1v+/tSH2IKoPbnBB1QSNAhZE0Wt619Jtc3fCw=
> =iPqR
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From emz at norma.perm.ru  Mon Oct 20 05:14:59 2014
From: emz at norma.perm.ru (Eugene M. Zheganin)
Date: Mon, 20 Oct 2014 11:14:59 +0600
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <20141019073258.GA91627@admin.sibptus.tomsk.ru>
References: <m14if3$1ul$2@ger.gmane.org>
 <20141009021821.GA3372@admin.sibptus.tomsk.ru>
 <20141014052401.GA8411@admin.sibptus.tomsk.ru> <m1iqc6$m3g$1@ger.gmane.org>
 <20141016161928.GA49304@admin.sibptus.tomsk.ru> <m1p4sp$aq3$1@ger.gmane.org>
 <20141017050231.GB60527@admin.sibptus.tomsk.ru>
 <5440A9C0.3030503@norma.perm.ru>
 <20141018101116.GA77970@admin.sibptus.tomsk.ru> <5442B403.3070306@zhegan.in>
 <20141019073258.GA91627@admin.sibptus.tomsk.ru>
Message-ID: <54449A53.20100@norma.perm.ru>

Hi.

On 19.10.2014 13:32, Victor Sudakov wrote:
>
> Hopefully I can interest our Windows admin to enable Kerberos event
> logging per KB262177.
>
> But for the present I have found an ugly workaround. In squid's keytab, I
> created another principal called 'squiduser' with the same hex key and
> kvno as that of the principal 'HTTP/proxy.sibptus.transneft.ru.'
>
(This may sound like a dumb question, but anyway) Did you initially map
any AD user to the SPN with a hostname that clients know your proxy under ?

Eugene.


From tomtux007 at gmail.com  Mon Oct 20 05:18:01 2014
From: tomtux007 at gmail.com (Tom Tom)
Date: Mon, 20 Oct 2014 07:18:01 +0200
Subject: [squid-users] TCP_DENIED/403 after Upgrading from 3.4.4 to
 3.4.7 (ssl_bump enabled)
In-Reply-To: <543B6E44.4090801@treenet.co.nz>
References: <CACLJR+M4J_zUyQM-i_1jQ-MknxSTz8ZsjadLAyNOpjbTdUCJbg@mail.gmail.com>
 <CACLJR+MGYogR-vJArRHVwHe=-XozFJs=4J6U5FdtaiCOUao0PQ@mail.gmail.com>
 <5435487A.5090302@treenet.co.nz> <543549A1.1070700@treenet.co.nz>
 <CACLJR+ONhco_QRz+7jk=LXUdL0DA3BpPA5gzSyq3cJ5NGJH7wg@mail.gmail.com>
 <CACLJR+MNEVmx_ZrmXdYhCKV3RpZrN+PPDAc3R3Ep9-nkc+FWqg@mail.gmail.com>
 <543B6E44.4090801@treenet.co.nz>
Message-ID: <CACLJR+NE1S5jJ==w3mfCb8Ypbo737Sp3mFvfbZLN7DJh7P7MTw@mail.gmail.com>

Hi Amos

Do you have new findings? Should I open a bug for better tracking?

Kind regards,
Tom

On Mon, Oct 13, 2014 at 8:16 AM, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 13/10/2014 6:26 p.m., Tom Tom wrote:
>> Hi
>>
>> Does anyone have some ideas/hints concerning this problem?
>
> I am looking into it and fairly sure its a bug in how the ACL result
> is returning 1 == ALLOWED. But that was done to solve another bug in
> auth ACLs re-authenticating credentials from outside the encryption,
> using the encrypted channel.
>
> Am still trying to figure out what the appropriate fix might look like.
>
> Amos
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2.0.22 (MingW32)
>
> iQEcBAEBAgAGBQJUO25CAAoJELJo5wb/XPRjjH0IAM2OK8MGRgkaxqBpXo+wKXiQ
> szuQfM3xSSUqXx6uFmD1IPssGRSy3ZxA5UBu5nVZB6X++nVGEkMwgjwo/dkymaw/
> 9egyKHGBBbVE1HjVi8/zktN01x1Tdrqo3fw6VpkzqQfsJAp5zt+/H4PjZvoRW11F
> NrCAIFlAx5eymYPZVunVOgejBb3G0zINn76MY5SnIRFUOtJurooTKcQx8fPppo4r
> yWYNLSrCxAq6ZKEqyHV0koiNp0ezjblwu53M8aZX1oXXdHjdcHwMKBBJ+x7CXhyj
> /rHYScUsn1B16SsQ4azA3mnlmP7AZgxjiv0MRiGfsrB9sWLQFydzneQppPfvxVo=
> =/B6U
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From squid3 at treenet.co.nz  Mon Oct 20 05:25:04 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 20 Oct 2014 18:25:04 +1300
Subject: [squid-users] TCP_DENIED/403 after Upgrading from 3.4.4 to
 3.4.7 (ssl_bump enabled)
In-Reply-To: <CACLJR+NE1S5jJ==w3mfCb8Ypbo737Sp3mFvfbZLN7DJh7P7MTw@mail.gmail.com>
References: <CACLJR+M4J_zUyQM-i_1jQ-MknxSTz8ZsjadLAyNOpjbTdUCJbg@mail.gmail.com>	<CACLJR+MGYogR-vJArRHVwHe=-XozFJs=4J6U5FdtaiCOUao0PQ@mail.gmail.com>	<5435487A.5090302@treenet.co.nz>	<543549A1.1070700@treenet.co.nz>	<CACLJR+ONhco_QRz+7jk=LXUdL0DA3BpPA5gzSyq3cJ5NGJH7wg@mail.gmail.com>	<CACLJR+MNEVmx_ZrmXdYhCKV3RpZrN+PPDAc3R3Ep9-nkc+FWqg@mail.gmail.com>	<543B6E44.4090801@treenet.co.nz>
 <CACLJR+NE1S5jJ==w3mfCb8Ypbo737Sp3mFvfbZLN7DJh7P7MTw@mail.gmail.com>
Message-ID: <54449CAF.7040501@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 20/10/2014 6:18 p.m., Tom Tom wrote:
> Hi Amos
> 
> Do you have new findings? Should I open a bug for better tracking?
> 

I got nothing new sorry. Yes a bug tracker would be useful to keep
track of it.

Amos

> Kind regards, Tom
> 
> On Mon, Oct 13, 2014 at 8:16 AM, Amos Jeffries
> <squid3 at treenet.co.nz> wrote: On 13/10/2014 6:26 p.m., Tom Tom
> wrote:
>>>> Hi
>>>> 
>>>> Does anyone have some ideas/hints concerning this problem?
> 
> I am looking into it and fairly sure its a bug in how the ACL
> result is returning 1 == ALLOWED. But that was done to solve
> another bug in auth ACLs re-authenticating credentials from outside
> the encryption, using the encrypted channel.
> 
> Am still trying to figure out what the appropriate fix might look
> like.
> 
> Amos
>> _______________________________________________ squid-users
>> mailing list squid-users at lists.squid-cache.org 
>> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJURJyvAAoJELJo5wb/XPRj3ugIALwdE3qvJ64VaFeia1S7SPDS
Ct36Rl/rBiSOpYV6CDakcHdISILEZcn0IkJFgnWMtBcZhMjna2K/Ot1qu5WSC1BO
dMQUt9KqU/x+O9gtx4Y9kUn6d3eUxzo+Y+5zACn/eFtBxwPj6LBLLnfYyf0OrnSj
XLeKDJDazNBC4AIUdJziIKrdZJNPrmXhO1Zi1g1CtuWB0ZEGAeTJVnRcLOaNeCFI
nOQnccBxqO7Dly71plx9ro6gBLDT1zor3/W8FhFGEx+syBw75elSp3aQJUZa4E+T
mOriNL+uQ0gI4uhh5+xI80MQgA/4p3l6hlVUEONeqE06nw7s9Vus6JJPjGDXsqU=
=HN83
-----END PGP SIGNATURE-----


From jborrell at central.aplitec.com  Mon Oct 20 06:35:17 2014
From: jborrell at central.aplitec.com (Josep Borrell)
Date: Mon, 20 Oct 2014 06:35:17 +0000
Subject: [squid-users] windowsupdate and ssl_bump
In-Reply-To: <54441FBA.1060300@treenet.co.nz>
References: <42DE25A255671C44A93A7B58470DC09C4A6E97D7@Michelle.aplitec.local>
 <54441FBA.1060300@treenet.co.nz>
Message-ID: <42DE25A255671C44A93A7B58470DC09C4ACB6E4E@Michelle.aplitec.local>

Hi Amos,

If you need something to take a look let me know.

Thanks

Josep



-----Mensaje original-----
De: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] En nombre de Amos Jeffries
Enviado el: domingo, 19 de octubre de 2014 22:32
Para: squid-users at lists.squid-cache.org
Asunto: Re: [squid-users] windowsupdate and ssl_bump

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 18/10/2014 8:56 p.m., Josep Borrell wrote:
> Hi,
> 
> We are using a 3.4.8 squid Proxy in intercept mode via wccp. Squid 
> intercepts HTTP and HTTPS via ssl_bump. All is working fine except 
> that Windows Machines can't do a Windows Update. It is not working at 
> all giving an error  80072F8F with HTTPS redirection disabled all work 
> fine.
> 
> Someone knows how to maintain the SSL interception with a functional 
> Windows Update ?

Windows Update has always done a "call home" CONNECT rquest to port
443 to verify the licensing or something. It may or may not actually be HTTPS.

I would look into what is happening with those requests with your bumping setup.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJURB+6AAoJELJo5wb/XPRjGzQH/jOWkNZMTRIL0X87hmPLYjEd
L1qoE4F+/Phh+d3aMl9EJxhdWQ6BuYOdNGTrL1Jpq4/37xFxUj3vCuZ638iY6Mad
ETQYTwb1oiX5vzJs0P/VaswJeQ36pR5yAMP0RmS3Y2uBTxeD9kSjQLwiwezt0BKI
obUqwJHcGS+K8CXsLfJle4ivIDkOy+BNFt/ujOYjjQ8UaY1Sg2GLZU2rtCFOoqav
05p62E4/jVkrBUP7o4AXFJADXHjaH/73FB/XY517vWp8R181xz6eWYcbkF8zdhzA
TixCnmt83mJEH5AdkNpl4IRRzaIPP4KsBTUUE4LN9cHH/ZS9ZQHPc2bKVVjr/aU=
=g5io
-----END PGP SIGNATURE-----
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

From lionxyes at gmail.com  Mon Oct 20 06:59:53 2014
From: lionxyes at gmail.com (lionxyes at gmail.com)
Date: Mon, 20 Oct 2014 14:59:53 +0800
Subject: [squid-users] question on compile squid 3.3.3 with --enable-ecap
	option on cygwin
Message-ID: <2014102014594836209434@gmail.com>


Hi.

A few days ago I compiled squid-3.3.3 successfully on cygwin , then I also compiled ecap-0.2.0 
successfully on cygwin because I want compiled squid-3.3.3 with --enable-ecap option on cygwin. 

Firstly, I edit squid.cygport file to add --enable-ecap option.

https://onedrive.live.com/redir?resid=D6D15DD582A99400!1095&authkey=!AJmIUOonXS28gW8&v=3&ithint=photo%2cjpg 

Secondly, I recompiled squid-3.3.3 by cygport. But, I get some errors when I do this step?
Here is the error messages.

https://onedrive.live.com/redir?resid=D6D15DD582A99400!1096&authkey=!AFGZHC7hElpvdUc&v=3&ithint=photo%2cjpg 

I think that the reson of this error is the link command is incorrect.
Here is the link command on cygwin and the link command on Kail linux.

https://onedrive.live.com/redir?resid=D6D15DD582A99400!1100&authkey=!AP_S5cfD2iwzPrs&v=3&ithint=photo%2cpng 

Compare it, we can find it the link command on cygwin don't refer to libecap.a?I think this is the reason.
But, I can?t repair it now, becaust I don't know well g++ command, automake, autoconf.

So, Are there anybody can help me? Thank you.

HDM1991



lionxyes at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141020/fcc6bcb8/attachment.htm>

From tomtux007 at gmail.com  Mon Oct 20 10:38:23 2014
From: tomtux007 at gmail.com (Tom Tom)
Date: Mon, 20 Oct 2014 12:38:23 +0200
Subject: [squid-users] TCP_DENIED/403 after Upgrading from 3.4.4 to
 3.4.7 (ssl_bump enabled)
In-Reply-To: <54449CAF.7040501@treenet.co.nz>
References: <CACLJR+M4J_zUyQM-i_1jQ-MknxSTz8ZsjadLAyNOpjbTdUCJbg@mail.gmail.com>
 <CACLJR+MGYogR-vJArRHVwHe=-XozFJs=4J6U5FdtaiCOUao0PQ@mail.gmail.com>
 <5435487A.5090302@treenet.co.nz> <543549A1.1070700@treenet.co.nz>
 <CACLJR+ONhco_QRz+7jk=LXUdL0DA3BpPA5gzSyq3cJ5NGJH7wg@mail.gmail.com>
 <CACLJR+MNEVmx_ZrmXdYhCKV3RpZrN+PPDAc3R3Ep9-nkc+FWqg@mail.gmail.com>
 <543B6E44.4090801@treenet.co.nz>
 <CACLJR+NE1S5jJ==w3mfCb8Ypbo737Sp3mFvfbZLN7DJh7P7MTw@mail.gmail.com>
 <54449CAF.7040501@treenet.co.nz>
Message-ID: <CACLJR+Pmy_FdMRFK5hGQwz6Q9SRtMxkXexeTLXe6tZau-+Dyrw@mail.gmail.com>

Entry created in bugzilla:
http://bugs.squid-cache.org/show_bug.cgi?id=4122



On Mon, Oct 20, 2014 at 7:25 AM, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 20/10/2014 6:18 p.m., Tom Tom wrote:
>> Hi Amos
>>
>> Do you have new findings? Should I open a bug for better tracking?
>>
>
> I got nothing new sorry. Yes a bug tracker would be useful to keep
> track of it.
>
> Amos
>
>> Kind regards, Tom
>>
>> On Mon, Oct 13, 2014 at 8:16 AM, Amos Jeffries
>> <squid3 at treenet.co.nz> wrote: On 13/10/2014 6:26 p.m., Tom Tom
>> wrote:
>>>>> Hi
>>>>>
>>>>> Does anyone have some ideas/hints concerning this problem?
>>
>> I am looking into it and fairly sure its a bug in how the ACL
>> result is returning 1 == ALLOWED. But that was done to solve
>> another bug in auth ACLs re-authenticating credentials from outside
>> the encryption, using the encrypted channel.
>>
>> Am still trying to figure out what the appropriate fix might look
>> like.
>>
>> Amos
>>> _______________________________________________ squid-users
>>> mailing list squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users
>
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2.0.22 (MingW32)
>
> iQEcBAEBAgAGBQJURJyvAAoJELJo5wb/XPRj3ugIALwdE3qvJ64VaFeia1S7SPDS
> Ct36Rl/rBiSOpYV6CDakcHdISILEZcn0IkJFgnWMtBcZhMjna2K/Ot1qu5WSC1BO
> dMQUt9KqU/x+O9gtx4Y9kUn6d3eUxzo+Y+5zACn/eFtBxwPj6LBLLnfYyf0OrnSj
> XLeKDJDazNBC4AIUdJziIKrdZJNPrmXhO1Zi1g1CtuWB0ZEGAeTJVnRcLOaNeCFI
> nOQnccBxqO7Dly71plx9ro6gBLDT1zor3/W8FhFGEx+syBw75elSp3aQJUZa4E+T
> mOriNL+uQ0gI4uhh5+xI80MQgA/4p3l6hlVUEONeqE06nw7s9Vus6JJPjGDXsqU=
> =HN83
> -----END PGP SIGNATURE-----


From sudakov at sibptus.tomsk.ru  Mon Oct 20 15:11:09 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Mon, 20 Oct 2014 22:11:09 +0700
Subject: [squid-users] Negotiate bug in squidclient ?
In-Reply-To: <5444222D.4060208@treenet.co.nz>
References: <20141018121654.GA79094@admin.sibptus.tomsk.ru>
 <5444222D.4060208@treenet.co.nz>
Message-ID: <20141020151109.GA22770@admin.sibptus.tomsk.ru>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Amos Jeffries wrote:
> 
> That is a bug. Please add to bugzilla.

http://bugs.squid-cache.org/show_bug.cgi?id=4123

- -- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJURSYNAAoJEA2k8lmbXsY0Td8H/j+avaeNvV+cvNOSXBF+lKFv
YBghykUvNA97WG0iGZaQcUNN0POBv0zxG9jaYzTBXIEKaNVEC+jQT9r2TdX8qoUT
P86KXmcQ9zZlGlRt56sMnCsOftgl0zQX//2EFU+/4VxGj0IeszZio7rEz6u0DRUZ
Rkmtq3fm73+MwE4BIEv+Pm88JPeQz7J07vtHj6uyAzqDgy3c4PQvxwuBhxL68s9T
qp7MnfZeWgspwRsYkSr9z3KuNk+FzFFRJF1SYz4IPLgrXk6R2W4OHtrpM5V+O05b
ab6iwldFPv7QQxqxWv+z8gx4p8su0gro8AOPG5U+skJEFkV/cM7DnzUtb5GWR/g=
=J61q
-----END PGP SIGNATURE-----


From sudakov at sibptus.tomsk.ru  Mon Oct 20 16:29:31 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Mon, 20 Oct 2014 23:29:31 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <54449A53.20100@norma.perm.ru>
References: <20141014052401.GA8411@admin.sibptus.tomsk.ru>
 <m1iqc6$m3g$1@ger.gmane.org>
 <20141016161928.GA49304@admin.sibptus.tomsk.ru>
 <m1p4sp$aq3$1@ger.gmane.org>
 <20141017050231.GB60527@admin.sibptus.tomsk.ru>
 <5440A9C0.3030503@norma.perm.ru>
 <20141018101116.GA77970@admin.sibptus.tomsk.ru>
 <5442B403.3070306@zhegan.in>
 <20141019073258.GA91627@admin.sibptus.tomsk.ru>
 <54449A53.20100@norma.perm.ru>
Message-ID: <20141020162931.GA24069@admin.sibptus.tomsk.ru>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Eugene M. Zheganin wrote:
> >
> > Hopefully I can interest our Windows admin to enable Kerberos event
> > logging per KB262177.
> >
> > But for the present I have found an ugly workaround. In squid's keytab, I
> > created another principal called 'squiduser' with the same hex key and
> > kvno as that of the principal 'HTTP/proxy.sibptus.transneft.ru.'
> >
> (This may sound like a dumb question, but anyway) Did you initially map
> any AD user to the SPN with a hostname that clients know your proxy under ?

That's what we did.

1. Created an AD user called squiduser.

2. Extracted its keytab with something like 

ktpass -princ HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU -mapuser squiduser +rndPass  -out squid.keytab -ptype KRB5_NT_PRINCIPAL /target dc01-sibptus -kvno 1 -crypto All 

3. Checked the mapping with "setspn -Q HTTP/*" (positive) and checked
for duplicate SPNs with "setspn -X" (negative).

4. Transferred squid.keytab to the proxy host.

Does it agree with your understanding of the right way?

- -- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJURThrAAoJEA2k8lmbXsY04twH/icn4ERHooRh+SihptuYTvPk
WO99RZh816EkSBGeTkNkOinEVnYqYwFn8UbL9wqlog6vVqS67EVGGFNEbLZ6kNOC
nP6kCFdND+LPGoZd+UQpd0nQDoTpN7pWfYzjDwPJaZ6o8pRY6HPqylJNVo28D2SD
so1phB3QVzeF/du/gxXxZQk8OAwGhOVZz06+90RQ0eaFLhp6Q86Vx1ndMI9EVv5F
7/9UoelcvXxZbO7YVmpMXWZR8yGnP0uYJ0NmVulz9YvJPcunbTxRWvZS/BUn/CAL
gSVlH8SHQIEWsmBp3pF2lWDl5+NRH8yXxLqAxtPePF6a4BuDD8ZOBlh05A1sObo=
=RSIh
-----END PGP SIGNATURE-----


From eugene at zhegan.in  Mon Oct 20 18:11:28 2014
From: eugene at zhegan.in (Eugene M. Zheganin)
Date: Tue, 21 Oct 2014 00:11:28 +0600
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <20141020162931.GA24069@admin.sibptus.tomsk.ru>
References: <20141014052401.GA8411@admin.sibptus.tomsk.ru>
 <m1iqc6$m3g$1@ger.gmane.org> <20141016161928.GA49304@admin.sibptus.tomsk.ru>
 <m1p4sp$aq3$1@ger.gmane.org> <20141017050231.GB60527@admin.sibptus.tomsk.ru>
 <5440A9C0.3030503@norma.perm.ru>
 <20141018101116.GA77970@admin.sibptus.tomsk.ru> <5442B403.3070306@zhegan.in>
 <20141019073258.GA91627@admin.sibptus.tomsk.ru>
 <54449A53.20100@norma.perm.ru>
 <20141020162931.GA24069@admin.sibptus.tomsk.ru>
Message-ID: <54455050.4060606@zhegan.in>

Hi.

On 20.10.2014 22:29, Victor Sudakov wrote:
> That's what we did.
>
> 1. Created an AD user called squiduser.
>
> 2. Extracted its keytab with something like
>
> ktpass -princ HTTP/proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU -mapuser squiduser +rndPass  -out squid.keytab -ptype KRB5_NT_PRINCIPAL /target dc01-sibptus -kvno 1 -crypto All
>
> 3. Checked the mapping with "setspn -Q HTTP/*" (positive) and checked
> for duplicate SPNs with "setspn -X" (negative).
>
> 4. Transferred squid.keytab to the proxy host.
>
> Does it agree with your understanding of the right way?
>
Yup.

Eugene.


From Jason_Haar at trimble.com  Mon Oct 20 22:22:10 2014
From: Jason_Haar at trimble.com (Jason Haar)
Date: Tue, 21 Oct 2014 11:22:10 +1300
Subject: [squid-users] infinite loop on using SSL to connect to squid with
	ssl-bump
Message-ID: <54458B12.3060106@trimble.com>

Hi there

Both Chrome and Firefox support talking to proxies using SSL (wpad type
"HTTPS" instead of "PROXY"). I'm trying to test that out against my
ssl-bump enabled squid proxy and it's causing an infinite loop

Basically if I do something like

(sleep 2;echo -ne "GET http://slashdot.org/ HTTP/1.0\r\n\r\n"; sleep
4)|openssl  s_client -connect localhost:3129

against a squid-3.4.8 proxy set up with

http_port 3128 ssl-bump cert=/usr/local/squid/etc/squidCA.cert 
capath=/etc/ssl/certs/ generate-host-certificates=on
dynamic_cert_mem_cache_size=256MB options=ALL
https_port 3129 ssl-bump intercept
cert=/usr/local/squid/etc/squidCA.cert  capath=/etc/ssl/certs/ 
generate-host-certificates=on dynamic_cert_mem_cache_size=256MB options=ALL

squid immediately hits 100% CPU and blocks until I kill it. I turned on
debugging (owch - almost had to power cycle to get out of that!) and
what was happening was squid was trying to ssl-bump the 127.0.0.1:3129
connection itself - ie infinite loop

The only difference between the HTTP and HTTPS ports are "intercept" -
but that's needed for https_port to even work. http_port works just fine

I bet I'm simply missing something, any suggestions?

Thanks!

-- 
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1



From rousskov at measurement-factory.com  Mon Oct 20 23:24:28 2014
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 20 Oct 2014 17:24:28 -0600
Subject: [squid-users] infinite loop on using SSL to connect to squid
 with ssl-bump
In-Reply-To: <54458B12.3060106@trimble.com>
References: <54458B12.3060106@trimble.com>
Message-ID: <544599AC.3050305@measurement-factory.com>

On 10/20/2014 04:22 PM, Jason Haar wrote:

> Both Chrome and Firefox support talking to proxies using SSL (wpad type
> "HTTPS" instead of "PROXY"). 

I did not know that support was added to major browsers. Any pointers to
the relevant configuration knobs? Can it be configured without WPAD?


> I'm trying to test that out against my
> ssl-bump enabled squid proxy and it's causing an infinite loop
> 
> Basically if I do something like
> 
> (sleep 2;echo -ne "GET http://slashdot.org/ HTTP/1.0\r\n\r\n"; sleep
> 4)|openssl  s_client -connect localhost:3129
> 
> against a squid-3.4.8 proxy set up with
> 
> https_port 3129 ssl-bump intercept


You are connecting directly to an interception port. I do not think that
is allowed. Interception assumes the client connection was intended for
a non-Squid address. When you break that assumption, you may get a loop.

If you remove SslBump and intercept options from https_port, then Squid
should be able to accept and decode the SSL connection, and receive a
plain GET request inside it.

Please note that I am not sure Squid can currently *bump* CONNECT
requests directed at https_port inside an SSL connection. It is
technically possible, but I am not sure we have the code to actually do
that. I suspect Squid may assume that there is at most one SSL wrapper
for a connection. Supporting multiple SSL layers while bumping the inner
CONNECT may need testing and possibly development.


HTH.

Alex.


> http_port 3128 ssl-bump cert=/usr/local/squid/etc/squidCA.cert 
> capath=/etc/ssl/certs/ generate-host-certificates=on
> dynamic_cert_mem_cache_size=256MB options=ALL

> https_port 3129 ssl-bump intercept
> cert=/usr/local/squid/etc/squidCA.cert  capath=/etc/ssl/certs/ 
> generate-host-certificates=on dynamic_cert_mem_cache_size=256MB options=ALL




From Jason_Haar at trimble.com  Mon Oct 20 23:45:10 2014
From: Jason_Haar at trimble.com (Jason Haar)
Date: Tue, 21 Oct 2014 12:45:10 +1300
Subject: [squid-users] infinite loop on using SSL to connect to squid
 with ssl-bump
In-Reply-To: <544599AC.3050305@measurement-factory.com>
References: <54458B12.3060106@trimble.com>
 <544599AC.3050305@measurement-factory.com>
Message-ID: <54459E86.6050808@trimble.com>

On 21/10/14 12:24, Alex Rousskov wrote:
> On 10/20/2014 04:22 PM, Jason Haar wrote:
>
>> Both Chrome and Firefox support talking to proxies using SSL (wpad type
>> "HTTPS" instead of "PROXY"). 
> I did not know that support was added to major browsers. Any pointers to
> the relevant configuration knobs? Can it be configured without WPAD?

The official Squid wiki is still mostly correct, other than Firefox
started working very recently

http://wiki.squid-cache.org/Features/HTTPS#Encrypted_browser-Squid_connection

So it looks like WPAD only at the moment
> If you remove SslBump and intercept options from https_port, then Squid
> should be able to accept and decode the SSL connection, and receive a
> plain GET request inside it.

Yeah that works just fine.

> Please note that I am not sure Squid can currently *bump* CONNECT
> requests directed at https_port inside an SSL connection.

Ah - well that would explain it then :-)

We run an internal PKI and all our staff have individual client certs.
What I'm wanting to test is if our firefox/chrome users could run their
browsers on the Internet back to our content-filtering Squid proxies via
ssl-proxy-with-client-certs. Hence my testing.

Probably won't work, but worth a shot ;-)



-- 
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1



From squid3 at treenet.co.nz  Tue Oct 21 01:28:00 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 21 Oct 2014 14:28:00 +1300
Subject: [squid-users] question on compile squid 3.3.3 with
 --enable-ecap option on cygwin
In-Reply-To: <2014102014594836209434@gmail.com>
References: <2014102014594836209434@gmail.com>
Message-ID: <5445B6A0.70607@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 20/10/2014 7:59 p.m., lionxyes wrote:
> 
> Hi.
> 
> A few days ago I compiled squid-3.3.3 successfully on cygwin , then
> I also compiled ecap-0.2.0 successfully on cygwin because I want
> compiled squid-3.3.3 with --enable-ecap option on cygwin.
> 
> Firstly, I edit squid.cygport file to add --enable-ecap option.
> 
> 
> 
> Secondly, I recompiled squid-3.3.3 by cygport. But, I get some
> errors when I do this step? Here is the error messages.
> 
> 
> 
> I think that the reson of this error is the link command is
> incorrect. Here is the link command on cygwin and the link command
> on Kail linux.
> 
> 
> 
> Compare it, we can find it the link command on cygwin don't refer
> to libecap.a?I think this is the reason. But, I can?t repair it
> now, becaust I don't know well g++ command, automake, autoconf.
> 
> So, Are there anybody can help me? Thank you.

ecap requires dynamic library loading. That is still one of the
untested features of Squid-3 on Windows.

some possibilities to try:
1) ensure that you have pkg-config tool installed. It is required for
detecting where your libecap is located.

2) For cygwin you may need --with-included-ltdl.

If not one of those then sorry I am not aware of the solution yet.

PS. in future please send the traces as inline text. This is a public
mailing list for the open-source community permanent record. Making
its content depend on proprietary services offered at the whim of
commercial entities is not a great idea.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJURbafAAoJELJo5wb/XPRjrYIH/jNQtqwjSSa/wn7Gjj6zGxDi
8P8J22a5ggS1hkzaehQygEmIAEBtnMSekepScxk9j9T5BCXQk2Gqt8IPG7Spe4Mu
bRAutwksNGv5NCjw4a7i96kmFNj515ngQwrt/YCrQh7fE8X16x590amc95IGBJib
y8Te5qkKEu+N98UV2UwxUMHjFNGiyxomeQ+Q8k7TG04Xuc4ZoZmAN4AYhYutg367
S21GlqkskKmDesON/Fr3xOcaQD9AS4/b7P02oNSMh7Fc90U61Ve74m1my5TXc4C2
z9lLHMxniPwXxfDz+Mp7u8MmsJbkWJsaR/RN/C/R+7PctPjcPkXqrynikgMW/0g=
=P14p
-----END PGP SIGNATURE-----


From lionxyes at gmail.com  Tue Oct 21 04:40:01 2014
From: lionxyes at gmail.com (lionxyes at gmail.com)
Date: Tue, 21 Oct 2014 12:40:01 +0800
Subject: [squid-users] question on compile squid 3.3.3 with
	--enable-ecap option on cygwin
References: <2014102014594836209434@gmail.com>, <5445B6A0.70607@treenet.co.nz>
Message-ID: <201410211239566730856@gmail.com>

Thank you very much. I made it.

I installed pkg-config?then I copy libecap.pc to /lib/pkgconfig dir.

Next, I will test it.

PS. You are right. It's not a good idea. I remember.



lionxyes at gmail.com
 
From: Amos Jeffries
Date: 2014-10-21 09:28
To: squid-users
Subject: Re: [squid-users] question on compile squid 3.3.3 with --enable-ecap option on cygwin
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
On 20/10/2014 7:59 p.m., lionxyes wrote:
> 
> Hi.
> 
> A few days ago I compiled squid-3.3.3 successfully on cygwin , then
> I also compiled ecap-0.2.0 successfully on cygwin because I want
> compiled squid-3.3.3 with --enable-ecap option on cygwin.
> 
> Firstly, I edit squid.cygport file to add --enable-ecap option.
> 
> 
> 
> Secondly, I recompiled squid-3.3.3 by cygport. But, I get some
> errors when I do this step? Here is the error messages.
> 
> 
> 
> I think that the reson of this error is the link command is
> incorrect. Here is the link command on cygwin and the link command
> on Kail linux.
> 
> 
> 
> Compare it, we can find it the link command on cygwin don't refer
> to libecap.a?I think this is the reason. But, I can?t repair it
> now, becaust I don't know well g++ command, automake, autoconf.
> 
> So, Are there anybody can help me? Thank you.
 
ecap requires dynamic library loading. That is still one of the
untested features of Squid-3 on Windows.
 
some possibilities to try:
1) ensure that you have pkg-config tool installed. It is required for
detecting where your libecap is located.
 
2) For cygwin you may need --with-included-ltdl.
 
If not one of those then sorry I am not aware of the solution yet.
 
PS. in future please send the traces as inline text. This is a public
mailing list for the open-source community permanent record. Making
its content depend on proprietary services offered at the whim of
commercial entities is not a great idea.
 
Amos
 
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)
 
iQEcBAEBAgAGBQJURbafAAoJELJo5wb/XPRjrYIH/jNQtqwjSSa/wn7Gjj6zGxDi
8P8J22a5ggS1hkzaehQygEmIAEBtnMSekepScxk9j9T5BCXQk2Gqt8IPG7Spe4Mu
bRAutwksNGv5NCjw4a7i96kmFNj515ngQwrt/YCrQh7fE8X16x590amc95IGBJib
y8Te5qkKEu+N98UV2UwxUMHjFNGiyxomeQ+Q8k7TG04Xuc4ZoZmAN4AYhYutg367
S21GlqkskKmDesON/Fr3xOcaQD9AS4/b7P02oNSMh7Fc90U61Ve74m1my5TXc4C2
z9lLHMxniPwXxfDz+Mp7u8MmsJbkWJsaR/RN/C/R+7PctPjcPkXqrynikgMW/0g=
=P14p
-----END PGP SIGNATURE-----
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141021/f0e821c2/attachment.htm>

From squid3 at treenet.co.nz  Tue Oct 21 05:08:54 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 21 Oct 2014 18:08:54 +1300
Subject: [squid-users] Squid 3.5.0.1 beta is available
Message-ID: <5445EA66.2020103@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

The Squid Software Foundation is very pleased to announce the
availability of the Squid-3.5.0.1 beta release!

   Thats right! The Squid Software Foundation is now formally
   in place as copyright representative (Squid remains GPLv2+
   with hundreds of individual copyright holders), and operator
   for the infrastructure used to assemble and publish this and
   later Squid versions.


This new 3.5 series of Squid brings useful new features and changes
providing improved performance over earlier release series.

More detailed descriptions of the major new features are available in
the release notes and wiki:
http://www.squid-cache.org/Versions/v3/3.5/RELEASENOTES.html
http://wiki.squid-cache.org/Squid-3.5

Detailed lists of the ./configure build and squid.conf changes can also
be found in the release notes.

This code is released as beta for wider testing purposes and potential
use. There are no more planned alterations to the existing features,
./configure options or squid.conf options.


All users of Squid-2.7 held back because of the Collapsed Forwarding
feature will be happy to know it has finally been ported in this
release. Please upgrade ASAP.


All developers of eCAP plugins need to be aware this release of Squid
supports libecap 1.0. This brings with it an end to some complications
plugins built against older libecap library versions had. This version
has some backward compatibility support, but plugins really should be
rebuilt against the new library for reliable behaviour.


Squid is now capable of accepting native FTP commands at an ftp_port
and relaying native FTP messages between FTP clients and FTP servers.
Some Squid modules (e.g., caching) do not currently work with native
FTP proxying, and many features have not even been tested for
compatibility.


Authentication helpers can now be passed arbitrary details in addition
to the credentials required for the HTTP authentication scheme.
 PLEASE NOTE: care needs to be taken when using this feature, it
*will* cause an increase in load on the authentication system
proportional to the variability of the extra details sent. In short,
it bypasses Squids' built-in DDoS and credential replay protection.
 The Store-ID and URL-rewrite helper interfaces are also extended with
matching abilities.


The Digest authentication, Store-ID, and URL-rewrite helpers packaged
with Squid have been updated to support concurrency channels. They
will auto-detect the channel-ID field and will produce the appropriate
response format. With these helpers concurrency may now be set to 0 or
any higher number as desired.
 Developers of third-party helpers still needing concurrency support
are encouraged to take a look and see how this auto-detection is done
for each interface. Concurrency on these interfaces is scheduled to be
enabled by default in a future release.


Named Services has now been extended to be available on all operating
systems, it has previously been a Windows-only feature. It restores
the ability to run multiple instances on the same machine even when
SMP support is being used. The squid.conf ${service_name} macro is
also added to simplify configuration file management.
 The ability intentionally includes some backward compatibility.
Whereas older Squid-3 SMP-aware versions may only have one instance of
themselves running in total, this feature allows the new version to
run alongside an older version by using a different service name.


Initial support for PROXY protocol, a more portable alternative to
X-Forwarded-For and Forwarded HTTP headers has been added in this
version. Currently only http_port uses the protocol wrapper to receive
traffic from a peer proxy or gateway device.


The squidclient tool has been through a minor overhaul in this version.
 Anyone utilizing its ability to 'ping' an HTTP server for uptime
monitoring need to be aware the command line options have now been
changed.
 HTTPS is now also supported if the GnuTLS library was available when
building Squid. OpenSSL-only builds of the tool do not have this feature.
 Run 'squidclient -h' for a quick summary of options or see the
Release Notes for more details.


Operating System support:

* Windows support has in recent times worked its way back into view
with both MinGW and Cygwin builds showing some success. Windows is now
being considered a supported OS again. So any and all assistance
building, testing and bug reports welcome. Just be aware that as this
is all a recent event Squid-3 as a whole is still considered beta on
this OS.

 * MacOS X is at risk of ending up in the sad situation Windows is
just vacating. Due to breakage in the shared memory API needed by
Squid for SMP support, along with a lack of interest from the MacOS
community in getting it fixed. If Squid on Mac is of importance to you
some assistance getting over that blocker problem is welcomed.


Major features dropped:
 * COSS support is officially purged from the code.

Rock store has been available for several versions, with COSS
operation broken for even longer. This version brings >32KB object
support to Rock store and thus removes the last potential need for COSS.

 * DNS helper API and dnsserver are officially purged from the code.

mDNS support has been available since Squid-3.4 and has no bug reports
across the entire series. Thus passing our criteria for stable, and
demonstrating the lack of need for the DNS helper.


All users are encouraged to give this Squid release a test run as soon
as time permits. All feedback welcome.


Please refer to the release notes at
http://www.squid-cache.org/Versions/v3/3.5/RELEASENOTES.html
if and when you are ready to make the switch to Squid-3.5

This new release can be downloaded from our HTTP or FTP servers

http://www.squid-cache.org/Versions/v3/3.5/
ftp://ftp.squid-cache.org/pub/squid/
ftp://ftp.squid-cache.org/pub/archive/3.5/

or the mirrors. For a list of mirror sites see

http://www.squid-cache.org/Download/http-mirrors.html
http://www.squid-cache.org/Download/mirrors.html

If you encounter any issues with this release please file a bug report.
http://bugs.squid-cache.org/

Amos Jeffries
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJURepmAAoJELJo5wb/XPRjke8H+wegB986HJfjpDaQ4JQv580t
YFzQwcCVExxumgA6B4waiTCJCGQ72JSQKktIoxidKKkA2fAgcp1Zvqx1lLUjw1kX
L9Z8yj8/mhsaSri0H5Ygr7HfuoodnqYJb+VOiGztkuORJK1WgBajIAuL5XMOFkMR
AlUKcDnzg5Q+KIW5lAOKMpR3Gy5gFRAmYG18iRm3YQ3hKtvYJNnxtnh4d0sILqu1
km+oF8fHMgL5WT0M0MPy2Wy2ds8+z/yUV0P08WyxgRotD2hQNI5d/P0CatEvHWsq
dizu5O6m92zi6L38tBnCeznSZgFSPxLsNR6rcEmLFOTPOvAhE3iErwTWrBrsZfE=
=l0aL
-----END PGP SIGNATURE-----


From ric.castellani at alice.it  Tue Oct 21 05:25:43 2014
From: ric.castellani at alice.it (Riccardo Castellani)
Date: Tue, 21 Oct 2014 07:25:43 +0200 (CEST)
Subject: [squid-users] Skype settings
Message-ID: <149312b0682.ric.castellani@alice.it>

I'm using Squid and it's unique access to go out to Internet.
I created rules 
for Skype traffic but I'd like to understand how to set its ports because my 
unique access way to Intenret is proxy on 3128.
I have firewall which is block 
all ports.

My settings:

Use port XXXXX for incoming connections
(yes) use 
port 80 and 443 for additional incoming connections

prosy settings:

HTTPS

host: myproxy 
port: 3128
I have no authentication method

With Squid proxy 
what's correctly setting for Skype ?


From squid3 at treenet.co.nz  Tue Oct 21 05:39:31 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 21 Oct 2014 18:39:31 +1300
Subject: [squid-users] Skype settings
In-Reply-To: <149312b0682.ric.castellani@alice.it>
References: <149312b0682.ric.castellani@alice.it>
Message-ID: <5445F193.3080403@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 21/10/2014 6:25 p.m., Riccardo Castellani wrote:
> I'm using Squid and it's unique access to go out to Internet. I
> created rules for Skype traffic but I'd like to understand how to
> set its ports because my unique access way to Intenret is proxy on
> 3128. I have firewall which is block all ports.
> 
> My settings:
> 
> Use port XXXXX for incoming connections (yes) use port 80 and 443
> for additional incoming connections
> 
> prosy settings:
> 
> HTTPS
> 
> host: myproxy port: 3128 I have no authentication method
> 
> With Squid proxy what's correctly setting for Skype ?

Uhm. Picture me confused.

Lets see ... you have a proxy. You also have a firewall configured to
block all traffic. And you want to run Skype.

Something is configured with some XX port and also running as a HTTP
(port 80) and HTTPS (port 443) web server.


Can you clarify what you are talking about please?
 naming the software or control panel in each point instead of saying
"it", "my" and "I" would be a good start,
 also a clear statement of what you want the "all working" situation
to be.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJURfGTAAoJELJo5wb/XPRjUu8H/3oeHCtoS0oK5qsNtK/kgX0S
SG33fYe5RbV3gf1usz96q2LnLvV9hkZ7sEZt4lSEw0GD9rCIc1omy4D4CZQQQuHk
rmsKWrpwDi69hyCJjO4pHPJMmZFVixjqYRztNw+Gs77bgCx9MenCP0ghqSICOnHT
Gud4YVSX5pRH2kP39QDslFxpk3bWtRnhNv8a6nxudYvNK5HXHGgGjLnjlcbgkL3Y
DZYQWcB3v5T95PD9a8FKU1ptWrhNqHkQZ+H2xMsIME1kdJJc4fCIGh7/0RkZ/oWL
0l6Fmby0Tj6Mj6dUWSEaB0IEpfpY8KJZpvOJu1AQt2QK9lWBtJhb8tSwmhMDdqs=
=Lr15
-----END PGP SIGNATURE-----


From sudakov at sibptus.tomsk.ru  Tue Oct 21 05:40:20 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Tue, 21 Oct 2014 12:40:20 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <54444049.1010904@ngtech.co.il>
References: <20141014052401.GA8411@admin.sibptus.tomsk.ru>
 <m1iqc6$m3g$1@ger.gmane.org>
 <20141016161928.GA49304@admin.sibptus.tomsk.ru>
 <m1p4sp$aq3$1@ger.gmane.org>
 <20141017050231.GB60527@admin.sibptus.tomsk.ru>
 <5440A9C0.3030503@norma.perm.ru>
 <20141018101116.GA77970@admin.sibptus.tomsk.ru>
 <5442B403.3070306@zhegan.in>
 <20141019073258.GA91627@admin.sibptus.tomsk.ru>
 <54444049.1010904@ngtech.co.il>
Message-ID: <20141021054020.GA84129@admin.sibptus.tomsk.ru>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Eliezer Croitoru wrote:
> > Hopefully I can interest our Windows admin to enable Kerberos
> > event logging per KB262177.
> > 
> > But for the present I have found an ugly workaround. In squid's
> > keytab, I created another principal called 'squiduser' with the
> > same hex key and kvno as that of the principal
> > 'HTTP/proxy.sibptus.transneft.ru.'
> > 
> > Of course this required running the squid authentication helper
> > with the '-s GSS_C_NO_NAME' option.
> > 
> > And you know what? It works. Browsers are being authenticated all 
> > right.
> > 
> > This means that the encrypted token is all right, and the problem
> > was only in the principal name (it being different in the request
> > and the received ticket). This is quite mysterious to me. Also,
> > Heimdal error messages definitely suck.
> > 
> So you actually made it work!??

Yes, I have.

> 
> And about the basic issues that you were having with performance, does
> it help to run Kerberos instead of NTLM (it should...)?

The performance is still poor, much worse than that of squid27 with
the NTLM authenticator.

- -- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJURfHEAAoJEA2k8lmbXsY0n8sIAJzxIBL3LoC+oUKEMC4wBHIs
bTYrLHT9DgJp48G66KZoIBocCXRmHKE4ZhGyHHU7NyPlYUABgqEmk+GBx6IhEoYU
GZDugLbm9tefg4Kpnd/DZiWknlzw/Ps44bSTKDFctI/lkuC3rwlxCiU6a2nQLp/m
OibWBgJS4ob7Ryca1v3wNYWuTwazOjl5h8QelJdwbQCQDdgJCA0QsFDe4S2CHrFs
ldCxivkXOJewLj5MzVjHBuHC7leYK1RQHcbbh4n66uhiX6t6CBg7ZCOXqg6wrF+0
7UQOT8283B3nK44mpGhDroK1wWUoxGeYZe2Jxd/2X2+Gx1PMxXQlnwZDVsw0y44=
=rkPI
-----END PGP SIGNATURE-----


From saleh.madi at hadara.ps  Tue Oct 21 05:55:32 2014
From: saleh.madi at hadara.ps (saleh madi)
Date: Tue, 21 Oct 2014 08:55:32 +0300 (IDT)
Subject: [squid-users] squid 2.7 TPROXY not working
In-Reply-To: <615858964.13990221.1413869661828.JavaMail.zimbra@hadara.ps>
Message-ID: <1849989767.13991831.1413870932161.JavaMail.zimbra@hadara.ps>

Hello,

I have compiled squid 2.7stable9 with TPROXY patch, but the TPROXY seem not working. The traffic arrived to squid, but when I try to open a website from the client browser I got no response "time Out". 

Note: traffic forwarder is Cisco Router with PBR (Policy Based Routing).


Please see below the Squid logs:


2014/10/20 22:36:20| parseHttpRequest: Complete request received
2014/10/20 22:36:20| commSetTimeout: FD 33 timeout 900
2014/10/20 22:36:20| removing 905 bytes; conn->in.offset = 0
2014/10/20 22:36:20| clientSetKeepaliveFlag: http_ver = 1.1
2014/10/20 22:36:20| clientSetKeepaliveFlag: method = GET
2014/10/20 22:36:20| The request GET http://www.cnn.com/ is ALLOWED, because it matched 'network'
2014/10/20 22:36:20| clientRedirectStart: 'http://www.cnn.com/'
2014/10/20 22:36:20| clientRedirectDone: 'http://www.cnn.com/' result=NULL
2014/10/20 22:36:20| clientInterpretRequestHeaders: REQ_NOCACHE = NOT SET
2014/10/20 22:36:20| clientInterpretRequestHeaders: REQ_CACHABLE = SET
2014/10/20 22:36:20| clientInterpretRequestHeaders: REQ_HIERARCHICAL = SET
2014/10/20 22:36:20| clientProcessRequest: GET 'http://www.cnn.com/'
2014/10/20 22:36:20| clientProcessRequest2: storeGet() MISS
2014/10/20 22:36:20| clientProcessRequest: TCP_MISS for 'http://www.cnn.com/'
2014/10/20 22:36:20| clientProcessMiss: 'GET http://www.cnn.com/'
2014/10/20 22:36:20| fwdStart: 'http://www.cnn.com/'
2014/10/20 22:36:20| fwdStartComplete: http://www.cnn.com/
2014/10/20 22:36:20| fwdConnectStart: http://www.cnn.com/
2014/10/20 22:36:20| fwdConnectStart: got addr 0.0.0.0, tos 0
2014/10/20 22:36:20| fwdConnectStart: setting outgoing.s_addr=0A16212C (will set TRANSPARENT)
2014/10/20 22:36:20| comm_openex: FD 34 is a new socket
2014/10/20 22:36:20| commSetTransparent: FD 34
2014/10/20 22:36:20| comm_add_close_handler: FD 34, handler=0x4373c0, data=0xc02648
2014/10/20 22:36:20| commSetTimeout: FD 34 timeout 60
2014/10/20 22:36:20| commConnectStart: FD 34, www.cnn.com:80
2014/10/20 22:36:20| comm_add_close_handler: FD 34, handler=0x42b240, data=0xc02878
2014/10/20 22:36:20| commSetSelect: FD 6 type 1
2014/10/20 22:36:20| commSetEvents(fd=6)
2014/10/20 22:36:20| commSetSelect: FD 33 type 1
2014/10/20 22:36:20| commSetEvents(fd=33)
2014/10/20 22:36:20| fwdStart: 'http://squid2:65534/squid-internal-periodic/store_digest'
2014/10/20 22:36:20| fwdStartComplete: http://squid2:65534/squid-internal-periodic/store_digest
2014/10/20 22:36:20| fwdConnectStart: http://squid2:65534/squid-internal-periodic/store_digest
2014/10/20 22:36:20| fwdConnectStart: got addr 0.0.0.0, tos 0
2014/10/20 22:36:20| comm_openex: FD 35 is a new socket
2014/10/20 22:36:20| comm_add_close_handler: FD 35, handler=0x4373c0, data=0xc05c38
2014/10/20 22:36:20| commSetTimeout: FD 35 timeout 60
2014/10/20 22:36:20| commConnectStart: FD 35, squid2:65534
2014/10/20 22:36:20| comm_add_close_handler: FD 35, handler=0x42b240, data=0xc05d88
2014/10/20 22:36:20| connect FD 35: (115) Operation now in progress
2014/10/20 22:36:20| commConnectHandle: FD 35: COMM_INPROGRESS
2014/10/20 22:36:20| commSetSelect: FD 35 type 2
2014/10/20 22:36:20| commSetEvents(fd=35)
2014/10/20 22:36:20| comm_select: timeout 0
2014/10/20 22:36:20| do_comm_select: 1 fds ready
2014/10/20 22:36:20| comm_call_handlers(): got fd=35 read_event=0 write_event=4 F->read_handler=(nil) F->write_handler=0x42b350
2014/10/20 22:36:20| comm_remove_close_handler: FD 35, handler=0x42b240, data=0xc05d88
2014/10/20 22:36:20| commSetTimeout: FD 35 timeout -1
2014/10/20 22:36:20| commConnectFree: FD 35
2014/10/20 22:36:20| fwdConnectDone: FD 35: 'http://squid2:65534/squid-internal-periodic/store_digest'
2014/10/20 22:36:20| fwdDispatch: FD -1: Fetching 'GET http://squid2:65534/squid-internal-periodic/store_digest'
2014/10/20 22:36:20| httpStart: "GET http://squid2:65534/squid-internal-periodic/store_digest"
2014/10/20 22:36:20| comm_add_close_handler: FD 35, handler=0x447d40, data=0xc05cb8
2014/10/20 22:36:20| httpSendRequest: FD 35: httpState 0xc05cb8.
2014/10/20 22:36:20| commSetTimeout: FD 35 timeout 900
2014/10/20 22:36:20| commSetSelect: FD 35 type 1
2014/10/20 22:36:20| commSetEvents(fd=35)
....

Thank you and Best Regards,
Saleh


From ric.castellani at alice.it  Tue Oct 21 06:04:02 2014
From: ric.castellani at alice.it (Riccardo Castellani)
Date: Tue, 21 Oct 2014 08:04:02 +0200 (CEST)
Subject: [squid-users] R: Re:  Skype settings
Message-ID: <149314e1bbc.ric.castellani@alice.it>

I'm saying about Skype settings in 'tools' - 'connection options' menu, I'm 
confused how to set Skype ports if I'm using Squid as proxy server.
If you need 
other info I'm ready to explain ...

>----Messaggio originale----
>Da: 
squid3 at treenet.co.nz
>Data: 21-ott-2014 7.39
>A: 
>Ogg: Re: [squid-users] Skype 
settings
>
>-----BEGIN PGP SIGNED MESSAGE-----
>Hash: SHA1
>
>On 21/10/2014 6:
25 p.m., Riccardo Castellani wrote:
>> I'm using Squid and it's unique access 
to go out to Internet. I
>> created rules for Skype traffic but I'd like to 
understand how to
>> set its ports because my unique access way to Intenret is 
proxy on
>> 3128. I have firewall which is block all ports.
>> 
>> My settings:

>> 
>> Use port XXXXX for incoming connections (yes) use port 80 and 443
>> for 
additional incoming connections
>> 
>> prosy settings:
>> 
>> HTTPS
>> 
>> 
host: myproxy port: 3128 I have no authentication method
>> 
>> With Squid 
proxy what's correctly setting for Skype ?
>
>Uhm. Picture me confused.
>
>Lets 
see ... you have a proxy. You also have a firewall configured to
>block all 
traffic. And you want to run Skype.
>
>Something is configured with some XX 
port and also running as a HTTP
>(port 80) and HTTPS (port 443) web server.
>
>

>Can you clarify what you are talking about please?
> naming the software or 
control panel in each point instead of saying
>"it", "my" and "I" would be a 
good start,
> also a clear statement of what you want the "all working" 
situation
>to be.
>
>Amos
>
>-----BEGIN PGP SIGNATURE-----
>Version: GnuPG v2.
0.22 (MingW32)
>

>iQEcBAEBAgAGBQJURfGTAAoJELJo5wb/XPRjUu8H/3oeHCtoS0oK5qsNtK/kgX0S

>SG33fYe5RbV3gf1usz96q2LnLvV9hkZ7sEZt4lSEw0GD9rCIc1omy4D4CZQQQuHk

>rmsKWrpwDi69hyCJjO4pHPJMmZFVixjqYRztNw+Gs77bgCx9MenCP0ghqSICOnHT

>Gud4YVSX5pRH2kP39QDslFxpk3bWtRnhNv8a6nxudYvNK5HXHGgGjLnjlcbgkL3Y

>DZYQWcB3v5T95PD9a8FKU1ptWrhNqHkQZ+H2xMsIME1kdJJc4fCIGh7/0RkZ/oWL

>0l6Fmby0Tj6Mj6dUWSEaB0IEpfpY8KJZpvOJu1AQt2QK9lWBtJhb8tSwmhMDdqs=
>=Lr15
>-----
END PGP SIGNATURE-----
>_______________________________________________
>squid-
users mailing list
>squid-users at lists.squid-cache.org
>http://lists.squid-cache.org/listinfo/squid-users>




From squid3 at treenet.co.nz  Tue Oct 21 06:20:25 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 21 Oct 2014 19:20:25 +1300
Subject: [squid-users] squid 2.7 TPROXY not working
In-Reply-To: <1849989767.13991831.1413870932161.JavaMail.zimbra@hadara.ps>
References: <1849989767.13991831.1413870932161.JavaMail.zimbra@hadara.ps>
Message-ID: <5445FB29.5020104@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 21/10/2014 6:55 p.m., saleh madi wrote:
> Hello,
> 
> I have compiled squid 2.7stable9 with TPROXY patch, but the TPROXY
> seem not working.

Er, yes. The "TPROXY patch" is not a Squid patch, it is a Linux kernel
patch adding TPROXY/cttproxy support to the extremely old Linux kernel
v2.2 and v2.4. Squid-2.7 does not need any patching to work with
kernels that have been appropriately patched, but does not work with
any newer kernels.

Please note that all the software you will need to play with to get
Squid-2.7 to do TPROXY was obsoleted 5-10 years ago, including
Squid-2.7. Finding people who even remember it is getting hard.

You would do better to upgrade to TPROXYv4, which should be available
in all modern Linux OS and is supported by current Squid-3 releases.

<http://wiki.squid-cache.org/Features/Tproxy4#Minimum_Requirements_.28IPv6_and_IPv4.29>


If you really want to stick with the old version, good luck. The
concepts outlined in the wiki page and Troubleshooting remain
unchanged. Just the specific configuration details are very different.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJURfspAAoJELJo5wb/XPRj7aUIALPnNV3iI3vSKbGok9Kmtixj
2+KsKFVr+aebnZboMDOuWEBSmvXSc+jLMYtH8qacJXuJdRoN9ee8mKP6bZVDX7ZW
IxcQrceQ3uX6JmINYU4ZKUoZYZwgotUBTj84d+CVEzvwbSNyauqCNpnbRBHdDLSp
CZbDAYNF+eqym+I9FmARL2KrEY/cOU1c4sdSdl8llDq6qWwFp9i0CGNjVpU1yC2X
scrdYQ2mkdgAS+KqpGE88die6M2q0sOQr/Y9T3y9v27vAI+tk63UGHLYXB+V0E/F
A/EjhCGD8djcPGqDm73mqZL/P6JaJvA0o4j01nQLKO3If0H4G3ACU2EDKTuWe9c=
=vw+9
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Tue Oct 21 06:29:59 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 21 Oct 2014 19:29:59 +1300
Subject: [squid-users] R: Re:  Skype settings
In-Reply-To: <149314e1bbc.ric.castellani@alice.it>
References: <149314e1bbc.ric.castellani@alice.it>
Message-ID: <5445FD67.8040202@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 21/10/2014 7:04 p.m., Riccardo Castellani wrote:
> I'm saying about Skype settings in 'tools' - 'connection options'
> menu, I'm confused how to set Skype ports if I'm using Squid as
> proxy server. If you need other info I'm ready to explain ...

Aha, okay.


The "incoming connections" part is not related to Squid. That is other
people connecting to you.


In the drop-down menu you can select:

1) "Automatic" - if your network uses WPAD protocol to inform software
about the proxy automatically.

2) "HTTP" or "HTTPS" - whichever is offered by your Skype version

 * "Host" is the domain name or IP address of the Squid proxy

 * "Port" should be 3128.


HTH
Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJURf1mAAoJELJo5wb/XPRjVIIH/i3ypi3fn0NY8o6cp7Y86UlA
wEy2FCuSr6zRVqCWI1QyZkYpbvTwVHnKigFtOpwuhtPl6t3TzNJoA4AM6NR/ZO4o
pJnpQ4k60ii6UV+V1h8R2LUKHbZ2jeNMfBBtz3bNr8sN8R9vecZxAZ30JVk141wi
A4jeDZ4Ub1UcwbNynCn6L6PenpIgWQAzB7Hnf8XY0pyNOn/M0+xq9++WqVGg6+av
lqykwV8wT0cYNBUAPZMFmOAj7TyY22RAVOO5MOy2Y0FGOx5/stQAJ+Pjn5tl/8XV
DMuJa7eZ8W9XVJyZSdQ5IZe/2p9OpZ5UnD4VUrm7yAtK2lE2EJgF/1Az0kYuY2U=
=W9qs
-----END PGP SIGNATURE-----


From saleh.madi at hadara.ps  Tue Oct 21 06:36:02 2014
From: saleh.madi at hadara.ps (saleh madi)
Date: Tue, 21 Oct 2014 09:36:02 +0300 (IDT)
Subject: [squid-users] squid 2.7 TPROXY not working
In-Reply-To: <5445FB29.5020104@treenet.co.nz>
References: <1849989767.13991831.1413870932161.JavaMail.zimbra@hadara.ps>
 <5445FB29.5020104@treenet.co.nz>
Message-ID: <1341794078.13996597.1413873362331.JavaMail.zimbra@hadara.ps>

Hello Amos,

Many thanks for your reply. Before two years I have tested squid 2.7 it's very stable and in the high http traffic request is very stable no crash. But for squid-3 I see too many different releases 3.0.x , 3.1.x, 3.2.x, 3.3.x and the current 3.4.x. What is the stable release in squid-3, that work with TPROXY and can carry more high http traffic request without crash in compare with squid 2.7 and what is alternative for "COSS" in squid-3 for small index object for the high http traffic request.

Best Regards,
Saleh



----- Original Message -----
From: "Amos Jeffries" <squid3 at treenet.co.nz>
To: squid-users at lists.squid-cache.org
Sent: Tuesday, October 21, 2014 8:20:25 AM
Subject: Re: [squid-users] squid 2.7 TPROXY not working

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 21/10/2014 6:55 p.m., saleh madi wrote:
> Hello,
> 
> I have compiled squid 2.7stable9 with TPROXY patch, but the TPROXY
> seem not working.

Er, yes. The "TPROXY patch" is not a Squid patch, it is a Linux kernel
patch adding TPROXY/cttproxy support to the extremely old Linux kernel
v2.2 and v2.4. Squid-2.7 does not need any patching to work with
kernels that have been appropriately patched, but does not work with
any newer kernels.

Please note that all the software you will need to play with to get
Squid-2.7 to do TPROXY was obsoleted 5-10 years ago, including
Squid-2.7. Finding people who even remember it is getting hard.

You would do better to upgrade to TPROXYv4, which should be available
in all modern Linux OS and is supported by current Squid-3 releases.

<http://wiki.squid-cache.org/Features/Tproxy4#Minimum_Requirements_.28IPv6_and_IPv4.29>


If you really want to stick with the old version, good luck. The
concepts outlined in the wiki page and Troubleshooting remain
unchanged. Just the specific configuration details are very different.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJURfspAAoJELJo5wb/XPRj7aUIALPnNV3iI3vSKbGok9Kmtixj
2+KsKFVr+aebnZboMDOuWEBSmvXSc+jLMYtH8qacJXuJdRoN9ee8mKP6bZVDX7ZW
IxcQrceQ3uX6JmINYU4ZKUoZYZwgotUBTj84d+CVEzvwbSNyauqCNpnbRBHdDLSp
CZbDAYNF+eqym+I9FmARL2KrEY/cOU1c4sdSdl8llDq6qWwFp9i0CGNjVpU1yC2X
scrdYQ2mkdgAS+KqpGE88die6M2q0sOQr/Y9T3y9v27vAI+tk63UGHLYXB+V0E/F
A/EjhCGD8djcPGqDm73mqZL/P6JaJvA0o4j01nQLKO3If0H4G3ACU2EDKTuWe9c=
=vw+9
-----END PGP SIGNATURE-----
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users


From lionxyes at gmail.com  Tue Oct 21 07:52:49 2014
From: lionxyes at gmail.com (lionxyes at gmail.com)
Date: Tue, 21 Oct 2014 15:52:49 +0800
Subject: [squid-users] Question about compiling and loading ecap-adapter
	module on windows
Message-ID: <2014102115500090457033@gmail.com>


Hi.  I?m coming again.

Now, I have compiled squid-3.3.3 with --enable-ecap option successfully on cygwin and run it 
successfully on windows.
But, there are another question about compiling ecap-adapter module?

I'm not sure that I should ask this question here, maybe I should ask eCAP developer.
but I think that I should try it firstly.

OK!
Question 1:  Does it need compile ecap-adapter module as .dll file if I want use ecap-adapter module on windows.
Question 2:  If it need, How to do it and do I shoud ask eCAP developer? Now, when I compile ecap-adapter module(ecap_adapter_sample-0.2.1.tar.gz) 
directly on cygwin. I just get .a .la file. Here is some output message when I make it.

------------------------------------------------------output message-----------------------------------------------------------
Making all in src 
make[1]: Entering directory '/usr/src/ecap_adapter_sample-0.2.1/src' 
make all-am 
make[2]: Entering directory '/usr/src/ecap_adapter_sample-0.2.1/src' 
/bin/sh ../libtool --tag=CXX --mode=compile g++ -DHAVE_CONFIG_H -I../src -I/usr/local/include -g -O3 -Wall -Wwrite-strings -Woverloaded-virtual -pipe -MT adapter_minimal.lo -MD -MP -MF .deps/adapter_minimal.Tpo -c -o adapter_minimal.lo adapter_minimal.cc 
libtool: compile: g++ -DHAVE_CONFIG_H -I../src -I/usr/local/include -g -O3 -Wall -Wwrite-strings -Woverloaded-virtual -pipe -MT adapter_minimal.lo -MD -MP -MF .deps/adapter_minimal.Tpo -c adapter_minimal.cc -DDLL_EXPORT -DPIC -o .libs/adapter_minimal.o 
libtool: compile: g++ -DHAVE_CONFIG_H -I../src -I/usr/local/include -g -O3 -Wall -Wwrite-strings -Woverloaded-virtual -pipe -MT adapter_minimal.lo -MD -MP -MF .deps/adapter_minimal.Tpo -c adapter_minimal.cc -o adapter_minimal.o >/dev/null 2>&1 
mv -f .deps/adapter_minimal.Tpo .deps/adapter_minimal.Plo 
/bin/sh ../libtool --tag=CXX --mode=link g++ -g -O3 -Wall -Wwrite-strings -Woverloaded-virtual -pipe -module -avoid-version -L/usr/local/lib -lecap -o ecap_adapter_minimal.la -rpath /usr/local/lib adapter_minimal.lo 

*** Warning: This system can not link to static lib archive /usr/local/lib/libecap.la. 
*** I have the capability to make that library automatically link in when 
*** you link to this library. But I can only do this if you have a 
*** shared version of the library, which you do not appear to have. 
*** But as you try to build a module library, libtool will still create 
*** a static module, that should work as long as the dlopening application 
*** is linked with the -dlopen flag to resolve symbols at runtime. 
libtool: link: warning: undefined symbols not allowed in i686-pc-cygwin shared libraries 
libtool: link: /usr/bin/ar cru .libs/ecap_adapter_minimal.a adapter_minimal.o 
libtool: link: ranlib .libs/ecap_adapter_minimal.a 
libtool: link: ( cd ".libs" && rm -f "ecap_adapter_minimal.la" && ln -s "../ecap_adapter_minimal.la" "ecap_adapter_minimal.la" ) 
------------------------------------------------------output message end-----------------------------------------------------------

Please give some help. Thank you.

HDM1991


lionxyes at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141021/80d32381/attachment.htm>

From squid3 at treenet.co.nz  Tue Oct 21 08:04:18 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 21 Oct 2014 21:04:18 +1300
Subject: [squid-users] squid 2.7 TPROXY not working
In-Reply-To: <1341794078.13996597.1413873362331.JavaMail.zimbra@hadara.ps>
References: <1849989767.13991831.1413870932161.JavaMail.zimbra@hadara.ps>
 <5445FB29.5020104@treenet.co.nz>
 <1341794078.13996597.1413873362331.JavaMail.zimbra@hadara.ps>
Message-ID: <54461382.1010705@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 21/10/2014 7:36 p.m., saleh madi wrote:
> Hello Amos,
> 
> Many thanks for your reply. Before two years I have tested squid
> 2.7 it's very stable and in the high http traffic request is very
> stable no crash. But for squid-3 I see too many different releases
> 3.0.x , 3.1.x, 3.2.x, 3.3.x and the current 3.4.x. What is the
> stable release in squid-3, that work with TPROXY and can carry more
> high http traffic request without crash in compare with squid 2.7
> and


In summary: "The latest you can get" (aka 3.4.8)


The long answer:

http://www.squid-cache.org/Versions/ has the answers you seek about
what Squid versions are most current "stable".

 That page says "Stable releases" -> 3.4,

 clicking the "3.4" link goes to a page saying:
   "Latest 3.4 series release" -> 3.4.8.

(** we are having trouble with some of our mirror servers at present,
please check the final page says 3.4.8. If not refresh or use
west.squid-cache.org domain name. **)


Squid-3 has many packages because we have a monthly release schedule.
All releases with two dots (x.y.z) are considered production ready
"stable" releases. For any x.y series the higher the z number the better.

So ... most of the time you should pick the one with latest number at
the time when installing (the versions and package download pages can
help there). Then can choose to stay with it (aka "stable" unchanging)
until something major requires an upgrade, or you can follow the
releases and stay on top of all sorts of small issues. Each month in
the announcement I try to highlight what sort of criteria you need to
consider when deciding.

As of today the current "stable" is Squid-3.4.8, and there is also a
Squid-3.5.0.1 beta for people wanting to try out some cool new
features from the upcoming 3.5 series.



Regarding your Question:

 * all the Squid versions 3.2 or later can handle more traffic than
what Squid-2.7 could. Performance is a constant topic of ongoing
improvement.

 * all releases since the *minimum* Squid package number (3.1.*) named
in the TPROXYv4 wiki page support TPROXYv4.

> what is alternative for "COSS" in squid-3 for small index object
> for the high http traffic request.

 * Rock storage type has replaced COSS. That is a feature added in
Squid-3.2 series.

Although be aware the Squid-3.2 to Squid-3.4 series rock storage is
limited by shared-memory design to only store 32KB or smaller objects.
This is sufficient for most use-cases.

If you have some important need for >32KB sized objects to be in the
Rock store, you will need to use the 3.5 series (currently beta) where
that limit has been removed.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJURhOCAAoJELJo5wb/XPRjdggIAMrDu/ARrUhRCFMFbuivv5kU
VKMpv/hbrZqPTwskpAVZxu8hFbUIko+CEzurLEcY2ybBlqX0HBsHqo2pGYLFC3As
4RqenWsF7jCeJIK9OhNMNLy3gNIQzcV6QVfRNG8PmspThhg9JOAj1r8tOuXUzB8q
OrtNCyYQO8R5eYKB9nzniNzJLWYcEy6F1z1F5d7+SPGb3evORwxiHhpo1yGiqh+6
aqXwxLYZkE3hLB8JPXsGta5c4cMdU1YZSwTGgeJQER3+oszjJTXfQJt7mHDZSbcD
3Jc5Lk71NnatJGDh8nDUieiahkLwE56vK0WtrMVknGTP2UC+wD+lpDC2cj/5hHo=
=N8xe
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Tue Oct 21 08:19:42 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 21 Oct 2014 21:19:42 +1300
Subject: [squid-users] Question about compiling and loading ecap-adapter
 module on windows
In-Reply-To: <2014102115500090457033@gmail.com>
References: <2014102115500090457033@gmail.com>
Message-ID: <5446171E.20601@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 21/10/2014 8:52 p.m., lionxyes at gmail.com wrote:
> 
> Hi.  I?m coming again.
> 
> Now, I have compiled squid-3.3.3 with --enable-ecap option
> successfully on cygwin and run it successfully on windows. But,
> there are another question about compiling ecap-adapter module?
> 
> I'm not sure that I should ask this question here, maybe I should
> ask eCAP developer. but I think that I should try it firstly.

Probably. But I'll give this a try at answering...

> 
> OK! Question 1:  Does it need compile ecap-adapter module as .dll
> file if I want use ecap-adapter module on windows.

If it is running natively on Windows, the answer is yes. If it is
running inside the cygwin environment (I suspect so) then the answer
might be no. The cygwin people maybe could help there.


> Question 2:  If it need, How to do it and do I shoud ask eCAP
> developer? Now, when I compile ecap-adapter
> module(ecap_adapter_sample-0.2.1.tar.gz) directly on cygwin. I just
> get .a .la file. Here is some output message when I make it.

IF its necessary the .dll parts should be done by your compiler tools
automatically. The error it produced gives a few obscure hints...

> 
> ------------------------------------------------------output
> message----------------------------------------------------------- 
> Making all in src make[1]: Entering directory
> '/usr/src/ecap_adapter_sample-0.2.1/src' make all-am make[2]:
> Entering directory '/usr/src/ecap_adapter_sample-0.2.1/src' /bin/sh
> ../libtool --tag=CXX --mode=compile g++ -DHAVE_CONFIG_H -I../src
> -I/usr/local/include -g -O3 -Wall -Wwrite-strings
> -Woverloaded-virtual -pipe -MT adapter_minimal.lo -MD -MP -MF
> .deps/adapter_minimal.Tpo -c -o adapter_minimal.lo
> adapter_minimal.cc libtool: compile: g++ -DHAVE_CONFIG_H -I../src
> -I/usr/local/include -g -O3 -Wall -Wwrite-strings
> -Woverloaded-virtual -pipe -MT adapter_minimal.lo -MD -MP -MF
> .deps/adapter_minimal.Tpo -c adapter_minimal.cc -DDLL_EXPORT -DPIC
> -o .libs/adapter_minimal.o libtool: compile: g++ -DHAVE_CONFIG_H
> -I../src -I/usr/local/include -g -O3 -Wall -Wwrite-strings
> -Woverloaded-virtual -pipe -MT adapter_minimal.lo -MD -MP -MF
> .deps/adapter_minimal.Tpo -c adapter_minimal.cc -o
> adapter_minimal.o >/dev/null 2>&1 mv -f .deps/adapter_minimal.Tpo
> .deps/adapter_minimal.Plo /bin/sh ../libtool --tag=CXX --mode=link
> g++ -g -O3 -Wall -Wwrite-strings -Woverloaded-virtual -pipe -module
> -avoid-version -L/usr/local/lib -lecap -o ecap_adapter_minimal.la
> -rpath /usr/local/lib adapter_minimal.lo
> 
> *** Warning: This system can not link to static lib archive
> /usr/local/lib/libecap.la. *** I have the capability to make that
> library automatically link in when *** you link to this library.
> But I can only do this if you have a *** shared version of the
> library, which you do not appear to have. *** But as you try to
> build a module library, libtool will still create *** a static
> module, that should work as long as the dlopening application ***
> is linked with the -dlopen flag to resolve symbols at runtime.

So, what its saying is that the libecap.la was built with -static
compiler flag. But the app now being built requires it to be dynamic
instead.

If Squid is also built with the -dlopen flag (Squid should be) then
the above warning does not matter.


> libtool: link: warning: undefined symbols not allowed in
> i686-pc-cygwin shared libraries

This warning might be more problematic, but given its just a warning
and the earlier one said it was okay... in your place I would test the
run-time behaviour to see if its really broken.

HTH
Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJURhceAAoJELJo5wb/XPRjVcwIAJOmEMfuKIDltB4sZPvZaakH
t77AwURtHd7R/zO4yAWVchrxUlaLOGyx9u2lykwA+zH28e9rPd3ukNND6v/43F9U
xIzQtpW5BoGnYPWtviod8bVqkDqs7sueyxtdcn+AOuG4UXLAh+SD/6EF9c97/7h/
gZHyAHg08C0hQPokCTtXKhI9CiLzdh94cN7poWcQV//XZib4HL/NNC1e2fBZirZm
ab4aEt+e8Asr53T278pMZ5AriawUiIi4N6wIQbSB6+1r90JVjcuf3ISbnTBS7IN7
u1epMhVnMsZx8KhzCsmIvQC/aLXZD3uUpkzaSgXzZ5lQy+Hr5/M9Y6iB+QLmcpY=
=PnXT
-----END PGP SIGNATURE-----


From saleh.madi at hadara.ps  Tue Oct 21 08:32:57 2014
From: saleh.madi at hadara.ps (saleh madi)
Date: Tue, 21 Oct 2014 11:32:57 +0300 (IDT)
Subject: [squid-users] squid 2.7 TPROXY not working
In-Reply-To: <54461382.1010705@treenet.co.nz>
References: <1849989767.13991831.1413870932161.JavaMail.zimbra@hadara.ps>
 <5445FB29.5020104@treenet.co.nz>
 <1341794078.13996597.1413873362331.JavaMail.zimbra@hadara.ps>
 <54461382.1010705@treenet.co.nz>
Message-ID: <360733775.14011498.1413880377108.JavaMail.zimbra@hadara.ps>

Hello Amos,

For squid 3.4.8, In the server we have 2xssd 240GB and 4XHDD 2000GB, Internet bandwidth 600Mbits and four squid instances, please what is the suggestion settings for cache_dir for SSD and HDD to cover the high http traffic request.

Thank you and Best Regards,
Saleh

----- Original Message -----
From: "Amos Jeffries" <squid3 at treenet.co.nz>
To: "saleh madi" <saleh.madi at hadara.ps>
Cc: squid-users at lists.squid-cache.org
Sent: Tuesday, October 21, 2014 10:04:18 AM
Subject: Re: [squid-users] squid 2.7 TPROXY not working

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 21/10/2014 7:36 p.m., saleh madi wrote:
> Hello Amos,
> 
> Many thanks for your reply. Before two years I have tested squid
> 2.7 it's very stable and in the high http traffic request is very
> stable no crash. But for squid-3 I see too many different releases
> 3.0.x , 3.1.x, 3.2.x, 3.3.x and the current 3.4.x. What is the
> stable release in squid-3, that work with TPROXY and can carry more
> high http traffic request without crash in compare with squid 2.7
> and


In summary: "The latest you can get" (aka 3.4.8)


The long answer:

http://www.squid-cache.org/Versions/ has the answers you seek about
what Squid versions are most current "stable".

 That page says "Stable releases" -> 3.4,

 clicking the "3.4" link goes to a page saying:
   "Latest 3.4 series release" -> 3.4.8.

(** we are having trouble with some of our mirror servers at present,
please check the final page says 3.4.8. If not refresh or use
west.squid-cache.org domain name. **)


Squid-3 has many packages because we have a monthly release schedule.
All releases with two dots (x.y.z) are considered production ready
"stable" releases. For any x.y series the higher the z number the better.

So ... most of the time you should pick the one with latest number at
the time when installing (the versions and package download pages can
help there). Then can choose to stay with it (aka "stable" unchanging)
until something major requires an upgrade, or you can follow the
releases and stay on top of all sorts of small issues. Each month in
the announcement I try to highlight what sort of criteria you need to
consider when deciding.

As of today the current "stable" is Squid-3.4.8, and there is also a
Squid-3.5.0.1 beta for people wanting to try out some cool new
features from the upcoming 3.5 series.



Regarding your Question:

 * all the Squid versions 3.2 or later can handle more traffic than
what Squid-2.7 could. Performance is a constant topic of ongoing
improvement.

 * all releases since the *minimum* Squid package number (3.1.*) named
in the TPROXYv4 wiki page support TPROXYv4.

> what is alternative for "COSS" in squid-3 for small index object
> for the high http traffic request.

 * Rock storage type has replaced COSS. That is a feature added in
Squid-3.2 series.

Although be aware the Squid-3.2 to Squid-3.4 series rock storage is
limited by shared-memory design to only store 32KB or smaller objects.
This is sufficient for most use-cases.

If you have some important need for >32KB sized objects to be in the
Rock store, you will need to use the 3.5 series (currently beta) where
that limit has been removed.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJURhOCAAoJELJo5wb/XPRjdggIAMrDu/ARrUhRCFMFbuivv5kU
VKMpv/hbrZqPTwskpAVZxu8hFbUIko+CEzurLEcY2ybBlqX0HBsHqo2pGYLFC3As
4RqenWsF7jCeJIK9OhNMNLy3gNIQzcV6QVfRNG8PmspThhg9JOAj1r8tOuXUzB8q
OrtNCyYQO8R5eYKB9nzniNzJLWYcEy6F1z1F5d7+SPGb3evORwxiHhpo1yGiqh+6
aqXwxLYZkE3hLB8JPXsGta5c4cMdU1YZSwTGgeJQER3+oszjJTXfQJt7mHDZSbcD
3Jc5Lk71NnatJGDh8nDUieiahkLwE56vK0WtrMVknGTP2UC+wD+lpDC2cj/5hHo=
=N8xe
-----END PGP SIGNATURE-----


From lionxyes at gmail.com  Tue Oct 21 08:38:16 2014
From: lionxyes at gmail.com (lionxyes at gmail.com)
Date: Tue, 21 Oct 2014 16:38:16 +0800
Subject: [squid-users] Question about compiling and loading ecap-adapter
	module on windows
References: <2014102115500090457033@gmail.com>, <5446171E.20601@treenet.co.nz>
Message-ID: <2014102116372046911247@gmail.com>

There are some other message that may be helpful.
I used to configure squid to load ecap-adapter module as following on windows.

-------------------configure---------------------------
ecap_enable on 
adaptation_send_client_ip on 

loadable_modules /usr/local/lib/ecap_adapter_modifying.so 
ecap_service ecapModifier respmod_precache \ 
uri=ecap://e-cap.org/ecap/services/sample/modifying \ 
victim=the \ 
replacement=a 
adaptation_access ecapModifier allow all
-----------------configure end ------------------------

then, when I run squid, i surely failed. Here is the error messages.

--------------------error message------------------------------
$ ./squid.exe -N -C -d1 
2014/10/20 23:33:26| WARNING cache_mem is larger than total disk cache space! 
2014/10/20 23:33:26| Starting Squid Cache version 3.3.3 for i686-pc-cygwin... 
2014/10/20 23:33:26| Process ID 3200 
2014/10/20 23:33:26| Process Roles: master worker 
2014/10/20 23:33:26| With 3072 file descriptors available 
2014/10/20 23:33:26| Initializing IP Cache... 
2014/10/20 23:33:26| DNS Socket created at [::], FD 4 
2014/10/20 23:33:26| DNS Socket created at 0.0.0.0, FD 5 
2014/10/20 23:33:26| Adding nameserver 8.8.8.8 from squid.conf 
2014/10/20 23:33:26| Logfile: opening log daemon:/var/log/squid/access.log 
2014/10/20 23:33:26| Logfile Daemon: opening log /var/log/squid/access.log 
2014/10/20 23:33:26| WARNING: no_suid: setuid(0): (22) Invalid argument 
2014/10/20 23:33:26| WARNING: no_suid: setuid(0): (22) Invalid argument 
2014/10/20 23:33:27| Unlinkd pipe opened on FD 11 
2014/10/20 23:33:27| Store logging disabled 
2014/10/20 23:33:27| Swap maxSize 102400 + 262144 KB, estimated 28041 objects 
2014/10/20 23:33:27| Target number of buckets: 1402 
2014/10/20 23:33:27| Using 8192 Store buckets 
2014/10/20 23:33:27| Max Mem size: 262144 KB 
2014/10/20 23:33:27| Max Swap size: 102400 KB 
2014/10/20 23:33:27| Rebuilding storage in /var/cache/squid (dirty log) 
2014/10/20 23:33:27| Using Least Load store dir selection 
2014/10/20 23:33:27| Set Current Directory to /var/cache/squid 
2014/10/20 23:33:27| Loaded Icons. 
2014/10/20 23:33:27| HTCP Disabled. 
2014/10/20 23:33:27| Loading Squid module from '/usr/local/lib/ecap_adapter_modifying.so' 
2014/10/20 23:33:27| FATAL: dying from an unhandled exception: %1 is not a valid Win32 application. 
terminate called after throwing an instance of 'TextException' 
what(): %1 is not a valid Win32 application. 
Aborted (core dumped) 
--------------------error message end-------------------------

So, I think that it is running natively on windows.

HDM1991


lionxyes at gmail.com
 
From: Amos Jeffries
Date: 2014-10-21 16:19
To: squid-users
Subject: Re: [squid-users] Question about compiling and loading ecap-adapter module on windows
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
On 21/10/2014 8:52 p.m., lionxyes at gmail.com wrote:
> 
> Hi.  I?m coming again.
> 
> Now, I have compiled squid-3.3.3 with --enable-ecap option
> successfully on cygwin and run it successfully on windows. But,
> there are another question about compiling ecap-adapter module?
> 
> I'm not sure that I should ask this question here, maybe I should
> ask eCAP developer. but I think that I should try it firstly.
 
Probably. But I'll give this a try at answering...
 
> 
> OK! Question 1:  Does it need compile ecap-adapter module as .dll
> file if I want use ecap-adapter module on windows.
 
If it is running natively on Windows, the answer is yes. If it is
running inside the cygwin environment (I suspect so) then the answer
might be no. The cygwin people maybe could help there.
 
 
> Question 2:  If it need, How to do it and do I shoud ask eCAP
> developer? Now, when I compile ecap-adapter
> module(ecap_adapter_sample-0.2.1.tar.gz) directly on cygwin. I just
> get .a .la file. Here is some output message when I make it.
 
IF its necessary the .dll parts should be done by your compiler tools
automatically. The error it produced gives a few obscure hints...
 
> 
> ------------------------------------------------------output
> message----------------------------------------------------------- 
> Making all in src make[1]: Entering directory
> '/usr/src/ecap_adapter_sample-0.2.1/src' make all-am make[2]:
> Entering directory '/usr/src/ecap_adapter_sample-0.2.1/src' /bin/sh
> ../libtool --tag=CXX --mode=compile g++ -DHAVE_CONFIG_H -I../src
> -I/usr/local/include -g -O3 -Wall -Wwrite-strings
> -Woverloaded-virtual -pipe -MT adapter_minimal.lo -MD -MP -MF
> .deps/adapter_minimal.Tpo -c -o adapter_minimal.lo
> adapter_minimal.cc libtool: compile: g++ -DHAVE_CONFIG_H -I../src
> -I/usr/local/include -g -O3 -Wall -Wwrite-strings
> -Woverloaded-virtual -pipe -MT adapter_minimal.lo -MD -MP -MF
> .deps/adapter_minimal.Tpo -c adapter_minimal.cc -DDLL_EXPORT -DPIC
> -o .libs/adapter_minimal.o libtool: compile: g++ -DHAVE_CONFIG_H
> -I../src -I/usr/local/include -g -O3 -Wall -Wwrite-strings
> -Woverloaded-virtual -pipe -MT adapter_minimal.lo -MD -MP -MF
> .deps/adapter_minimal.Tpo -c adapter_minimal.cc -o
> adapter_minimal.o >/dev/null 2>&1 mv -f .deps/adapter_minimal.Tpo
> .deps/adapter_minimal.Plo /bin/sh ../libtool --tag=CXX --mode=link
> g++ -g -O3 -Wall -Wwrite-strings -Woverloaded-virtual -pipe -module
> -avoid-version -L/usr/local/lib -lecap -o ecap_adapter_minimal.la
> -rpath /usr/local/lib adapter_minimal.lo
> 
> *** Warning: This system can not link to static lib archive
> /usr/local/lib/libecap.la. *** I have the capability to make that
> library automatically link in when *** you link to this library.
> But I can only do this if you have a *** shared version of the
> library, which you do not appear to have. *** But as you try to
> build a module library, libtool will still create *** a static
> module, that should work as long as the dlopening application ***
> is linked with the -dlopen flag to resolve symbols at runtime.
 
So, what its saying is that the libecap.la was built with -static
compiler flag. But the app now being built requires it to be dynamic
instead.
 
If Squid is also built with the -dlopen flag (Squid should be) then
the above warning does not matter.
 
 
> libtool: link: warning: undefined symbols not allowed in
> i686-pc-cygwin shared libraries
 
This warning might be more problematic, but given its just a warning
and the earlier one said it was okay... in your place I would test the
run-time behaviour to see if its really broken.
 
HTH
Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)
 
iQEcBAEBAgAGBQJURhceAAoJELJo5wb/XPRjVcwIAJOmEMfuKIDltB4sZPvZaakH
t77AwURtHd7R/zO4yAWVchrxUlaLOGyx9u2lykwA+zH28e9rPd3ukNND6v/43F9U
xIzQtpW5BoGnYPWtviod8bVqkDqs7sueyxtdcn+AOuG4UXLAh+SD/6EF9c97/7h/
gZHyAHg08C0hQPokCTtXKhI9CiLzdh94cN7poWcQV//XZib4HL/NNC1e2fBZirZm
ab4aEt+e8Asr53T278pMZ5AriawUiIi4N6wIQbSB6+1r90JVjcuf3ISbnTBS7IN7
u1epMhVnMsZx8KhzCsmIvQC/aLXZD3uUpkzaSgXzZ5lQy+Hr5/M9Y6iB+QLmcpY=
=PnXT
-----END PGP SIGNATURE-----
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141021/1273c849/attachment.htm>

From squid3 at treenet.co.nz  Tue Oct 21 08:53:20 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 21 Oct 2014 21:53:20 +1300
Subject: [squid-users] squid 2.7 TPROXY not working
In-Reply-To: <360733775.14011498.1413880377108.JavaMail.zimbra@hadara.ps>
References: <1849989767.13991831.1413870932161.JavaMail.zimbra@hadara.ps>
 <5445FB29.5020104@treenet.co.nz>
 <1341794078.13996597.1413873362331.JavaMail.zimbra@hadara.ps>
 <54461382.1010705@treenet.co.nz>
 <360733775.14011498.1413880377108.JavaMail.zimbra@hadara.ps>
Message-ID: <54461F00.4010900@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 21/10/2014 9:32 p.m., saleh madi wrote:
> Hello Amos,
> 
> For squid 3.4.8, In the server we have 2xssd 240GB and 4XHDD 
> 2000GB, Internet bandwidth 600Mbits and four squid instances, 
> please what is the suggestion settings for cache_dir for SSD and 
> HDD to cover the high http traffic request.
> 

Is this a quad-core machine?

Try a single Squid-3 instance with directive "workers 4" in the config
file, and same cache_dir layout you had for Squid-2. Using appropriate
min-size/max-size changes for the 32KB limit of Rock dirs (actually
use 32000 bytes limit to be safe).

(If you want a squid.conf audit please post it.)

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJURh8AAAoJELJo5wb/XPRjG4cH/2bcQ6MRr1+CjJNOWsqt7kkB
TG6+nUZV7GV1LusUJ/1T+9xNiYlWvp2htONYMrf/LY12jWiAuG/sGjkdvK6wVt5z
4EjT6IQCO5xjNOxkLSPGCzF8azlLOO7Jnp+ZiHgYI8g5SdsM69zAjNi8LIXK+sDE
8sxLqO/Gf66m2RRTyv4nfqil+znR8p5vZ3O7kRy3L+3KduVrQiGof6FlKdmOtGwk
JSeRMZri595JkOm38cttrSCmXm0z9ZFVB3pE1ZPzbebE6SMgMyOYpg+z83HG74lt
erUBSXTQnw4/0Sp3QNdygFloZf+dK0TRM3grCoWRtDSFxk7v5mTQFyeqyWToWb4=
=9UcO
-----END PGP SIGNATURE-----


From eugene at zhegan.in  Tue Oct 21 16:11:43 2014
From: eugene at zhegan.in (Eugene M. Zheganin)
Date: Tue, 21 Oct 2014 22:11:43 +0600
Subject: [squid-users] assertion failed: "lm_request->waiting"
Message-ID: <544685BF.5040208@zhegan.in>

Hi.

Is someone getting this too ? I get this with sad regularity:

# grep lm_request /var/log/squid/cache.log
2014/10/06 14:32:12 kid1| assertion failed: UserRequest.cc:229: 
"lm_request->waiting"
2014/10/07 16:06:10 kid1| assertion failed: UserRequest.cc:229: 
"lm_request->waiting"
2014/10/16 16:28:48 kid1| assertion failed: UserRequest.cc:229: 
"lm_request->waiting"
2014/10/17 14:32:34 kid1| assertion failed: UserRequest.cc:229: 
"lm_request->waiting"
2014/10/17 14:33:09 kid1| assertion failed: UserRequest.cc:229: 
"lm_request->waiting"
2014/10/21 12:25:18 kid1| assertion failed: UserRequest.cc:229: 
"lm_request->waiting"

each time squid crashes.
I filed a http://bugs.squid-cache.org/show_bug.cgi?id=4104, but noone 
got interesed.
I accept, this happens only on one of many installations. Probably 
someone knows a workaround ?

Thanks.
Eugene.


From mcsnv96 at afo.net  Tue Oct 21 16:40:51 2014
From: mcsnv96 at afo.net (Mike)
Date: Tue, 21 Oct 2014 11:40:51 -0500
Subject: [squid-users] Question about squid 3.5.x and SSL
Message-ID: <54468C93.3090709@afo.net>

I was reading through the release notes for squid 3.5, and in section 
2.4 regarding HTTPS, it mentions "When Squid is built with the GnuTLS 
encryption library the tool is able to open TLS (or SSL/3.0) connections 
to servers", and the wording makes me think that when openssl is in use, 
squid cannot open TLS/SSL connections to servers...

So my question is if it will still properly able to open TLS/SSL 
connections to server when openssl is in use (like we currently are 
using with 3.4.6 and ssl_bump)? Or is gnutls recommended for use with 
squid 3.5.x (despite its massive bugs and vulnerabilities compared to 
openssl)?

and my last question, regarding squid usage by people on HTTPS websites, 
what are some primary differences of using gnutls versus openssl?

Thanks!
Mike


From Job at colliniconsulting.it  Tue Oct 21 22:42:33 2014
From: Job at colliniconsulting.it (Job)
Date: Wed, 22 Oct 2014 00:42:33 +0200
Subject: [squid-users] Squid in captive portal and reconfigure
In-Reply-To: <88EF58F000EC4B4684700C2AA3A73D7A04F5323FBEE2@W2008DC01.ColliniConsulting.lan>
References: <88EF58F000EC4B4684700C2AA3A73D7A04F5323FBEE2@W2008DC01.ColliniConsulting.lan>
Message-ID: <88EF58F000EC4B4684700C2AA3A73D7A04F5323FBEE3@W2008DC01.ColliniConsulting.lan>


Hello,

integrating squid in a captive portal environment, i have to setup different profiles in order to apply restrictions dinamically.

The squid -k reconfigure kill active sessione/connections?

I tried when downloading a file, it stops for one/two seconds and then continues download, but i am not sure if sessiones are dropped/renewed.

Thank you,
Francesco

From gkinkie at gmail.com  Wed Oct 22 01:35:35 2014
From: gkinkie at gmail.com (Kinkie)
Date: Wed, 22 Oct 2014 03:35:35 +0200
Subject: [squid-users] Squid in captive portal and reconfigure
In-Reply-To: <88EF58F000EC4B4684700C2AA3A73D7A04F5323FBEE3@W2008DC01.ColliniConsulting.lan>
References: <88EF58F000EC4B4684700C2AA3A73D7A04F5323FBEE2@W2008DC01.ColliniConsulting.lan>
 <88EF58F000EC4B4684700C2AA3A73D7A04F5323FBEE3@W2008DC01.ColliniConsulting.lan>
Message-ID: <CA+Y8hcMbbwsHytzV8OnYP_Bt8sE4aknHxzHqtbs5V3kcbeMhvg@mail.gmail.com>

Hi,
   it depends on how your helpers are implemented: the helpers
themselves are restarted upon reconfiguration, but if they use a
persistent storage for sessions, that is not touched.
Ongoing transfers are not stopped and are in any case allowed to complete.

On Wed, Oct 22, 2014 at 12:42 AM, Job <Job at colliniconsulting.it> wrote:
>
> Hello,
>
> integrating squid in a captive portal environment, i have to setup different profiles in order to apply restrictions dinamically.
>
> The squid -k reconfigure kill active sessione/connections?
>
> I tried when downloading a file, it stops for one/two seconds and then continues download, but i am not sure if sessiones are dropped/renewed.
>
> Thank you,
> Francesco
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



-- 
    Francesco


From squid3 at treenet.co.nz  Wed Oct 22 01:48:29 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 22 Oct 2014 14:48:29 +1300
Subject: [squid-users] Question about squid 3.5.x and SSL
In-Reply-To: <54468C93.3090709@afo.net>
References: <54468C93.3090709@afo.net>
Message-ID: <54470CED.6080907@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 22/10/2014 5:40 a.m., Mike wrote:
> I was reading through the release notes for squid 3.5, and in
> section 2.4 regarding HTTPS, it mentions "When Squid is built with
> the GnuTLS encryption library the tool is able to open TLS (or
> SSL/3.0) connections to servers", and the wording makes me think
> that when openssl is in use, squid cannot open TLS/SSL connections
> to servers...
> 
> So my question is if it will still properly able to open TLS/SSL 
> connections to server when openssl is in use (like we currently
> are using with 3.4.6 and ssl_bump)? Or is gnutls recommended for
> use with squid 3.5.x (despite its massive bugs and vulnerabilities
> compared to openssl)?

"Squid" is a small collection of related programs. There is a "squid"
proxy binary, and also there is a separate "squidclient" binary which
is a tool for manual command line or scripted HTTP requests. Somewhat
like curl or wget but more oriented at debugging traffic.

Section 2.4 applies *only* to that squidclient tool. The main squid
and other binaries do not yet have any use of GnuTLS, which is
mentioned in section 4.1 build options. That is planned to change, but
timeline is flexible still as its one of my spare-time unpaid efforts.

Regarding:
> the wording makes me think that when openssl is in use, squid
> cannot open TLS/SSL connections to servers...

Correct, at least within the context of squidclient tool which section
2.4 is all about.

When using only OpenSSL the squidclient tool does not have any HTTPS
support. Never has.


> 
> and my last question, regarding squid usage by people on HTTPS
> websites, what are some primary differences of using gnutls versus
> openssl?

Primary difference as applies to Squid is that OpenSSL support has
been present across most of the Squid code for years and GnuTLS
support is only just now being added.

The main reason for adding it is GnuTLS is popular, portable, feature
compatible with what we use in OpenSSL, and also GPL license
compatibile. By using it our downstream distributors are able to
package HTTPS enabled binaries where previously they were prohibited
by OpenSSL license conditions.


PS. if you are building Squid I highly recommend you add libnettle and
libgnutls to your build environment. Both of them should be easily
available in any OS.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJURwztAAoJELJo5wb/XPRj7rkH/32jQaVSVKRRAYywHtLbBbaW
z+OVN6BwdoZES58JfZKupJFGb9RvOEb+wI+eCYb7RGXgFWOOqO7HUyZtCVDNYDpu
1pOoxIYiZ0pIsnjgLdSLTkffMIbywKWmSH7l4JGIna+UduJbYSIY1hCEqqGof96o
2kUE7aV2/Z9gNZtjK1/sJMgmrnnVV/ZHXWKcIiAsZBq2LxcLbtvmFutLUfBhoGw5
KzbocDh3dpUA95dwSYmNCji98YXCzo7Gz7qUeROdJj+ca9ReMAlmwU3975/T5hNY
tEeynBvPZa1HWZm9XpXA2WvAhjRRm4TaKsBFLtpo3ojv9NvgePXMRw9Cha3OQfM=
=8EVN
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Wed Oct 22 03:36:56 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 22 Oct 2014 16:36:56 +1300
Subject: [squid-users] assertion failed: "lm_request->waiting"
In-Reply-To: <544685BF.5040208@zhegan.in>
References: <544685BF.5040208@zhegan.in>
Message-ID: <54472658.9010300@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 22/10/2014 5:11 a.m., Eugene M. Zheganin wrote:
> Hi.
> 
> Is someone getting this too ? I get this with sad regularity:
> 
> # grep lm_request /var/log/squid/cache.log 2014/10/06 14:32:12
> kid1| assertion failed: UserRequest.cc:229: "lm_request->waiting" 
> 2014/10/07 16:06:10 kid1| assertion failed: UserRequest.cc:229: 
> "lm_request->waiting" 2014/10/16 16:28:48 kid1| assertion failed:
> UserRequest.cc:229: "lm_request->waiting" 2014/10/17 14:32:34 kid1|
> assertion failed: UserRequest.cc:229: "lm_request->waiting" 
> 2014/10/17 14:33:09 kid1| assertion failed: UserRequest.cc:229: 
> "lm_request->waiting" 2014/10/21 12:25:18 kid1| assertion failed:
> UserRequest.cc:229: "lm_request->waiting"
> 
> each time squid crashes. I filed a
> http://bugs.squid-cache.org/show_bug.cgi?id=4104, but noone got
> interesed.

Sorry about that. The server outage in Sept meant a lot of things had
to be triaged to low-priority, or relevant people did not get
notified. The bug backlog is still being assessed.

> I accept, this happens only on one of many installations. Probably 
> someone knows a workaround ?

Followed up in the bug report.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJURyZYAAoJELJo5wb/XPRjN+4IAN1Zm0YcA97ITN+tgLFVKmpy
IrYOBtf4zm9ZF5+YRrNr5+ruvf+4mJnzLbeTikFvPlIt6hh3Z+2Hy4NNS1Q2g+N6
YG8Zbf9euMBL/VyoEqSs8busqMYdQ5jHlwDim7qASyyKENOqJLHS7NLsGNbcWrfs
YMSHi1ITxhEeVafeu/d0Kea447mKAy10sv+SUvj4QtUqLLztQ5zkdSoESzwbQiK6
dAlSdDLdR1H6/Bq5eqG76cnFkTlgDgvSuNIxnYCfnqDJI+d3GGM7Fk3EzMBnfHQ0
GmTL5DM1mwZ1n/lqQH/0Ix4lsvqKiGUTbJaPcYGQLL9Y7psz3rYgzoiv/j+nec0=
=hq1e
-----END PGP SIGNATURE-----


From emz at norma.perm.ru  Wed Oct 22 06:02:19 2014
From: emz at norma.perm.ru (Eugene M. Zheganin)
Date: Wed, 22 Oct 2014 12:02:19 +0600
Subject: [squid-users] 3.3.x -> 3.4.x: huge performance regression
Message-ID: <5447486B.3010205@norma.perm.ru>

Hi.

I was using the 3.4.x branch for quite some time, it was working just
fine on small installations.
Yesterday I upgraded my largest cache installation from 3.3.13 to 3.4.8
(same config, diskd, NTLM/GSS-SPNEGO auth helpers, external helpers).
Today morning I noticed that squid is spiking to 100% of CPU and almost
isn't serving any traffic. Restart didn't help, squid is serving pages
while continuing to consume CPU, load grows, until it's at 100%, and
after some time my users are unable to open any page from Internet. This
is sad, so I downgraded to 3.3.13. CPU consumption went back to 20-35%
and everything is back to normal.

In order to understand what's happening I did some dtrace profiling to
see what is squid busy with, taking the consideration, that measuring
the same amount of connect()/socket() syscalls should give same amount
of squid work, but the results were totally different on one number of
such syscalls.

Anyone to comment ?

Thanks.
Eugene.


From frechdesign at gmail.com  Wed Oct 22 09:38:53 2014
From: frechdesign at gmail.com (Yassin CHOUCHANE)
Date: Wed, 22 Oct 2014 11:38:53 +0200
Subject: [squid-users] =?utf-8?q?Probl=C3=A9me_Squid_to_Java_application?=
Message-ID: <CAASYH3w7txNACjypOS5huGNi=f6heTufgp4EQRnVBv-RFsPP8A@mail.gmail.com>

Hello,
i have an web java application, and i need no cache to this application
but  i can add no cache to him
the url of my applications :
http://srv-java.e.t:6666/forms/frmservlet?

in acces.log i have this denied :

1413969949.072      0 124.100.1.2 TCP_DENIED/407 3892 GET
http://srv-java.e.t:6666/forms/frmservlet? - HIER_NONE/- text/html


i have added on my squid.conf this ACL :


acl NoCachedSites dstdomain srv-java.e.t
acl our_servers src 2.10.3.1


i have added the ip of server and the dstdomain, but squid continue to
block this java application can u have a tips to don't block this java
applicaiton with squid please ?

thans to all


From eliezer at ngtech.co.il  Wed Oct 22 09:41:48 2014
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Wed, 22 Oct 2014 12:41:48 +0300
Subject: [squid-users]
	=?utf-8?q?Probl=C3=A9me_Squid_to_Java_application?=
In-Reply-To: <CAASYH3w7txNACjypOS5huGNi=f6heTufgp4EQRnVBv-RFsPP8A@mail.gmail.com>
References: <CAASYH3w7txNACjypOS5huGNi=f6heTufgp4EQRnVBv-RFsPP8A@mail.gmail.com>
Message-ID: <54477BDC.8040308@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 10/22/2014 12:38 PM, Yassin CHOUCHANE wrote:
> i have added on my squid.conf this ACL :
> 
> 
> acl NoCachedSites dstdomain srv-java.e.t acl our_servers src
> 2.10.3.1
> 
> 
> i have added the ip of server and the dstdomain, but squid continue
> to block this java application can u have a tips to don't block
> this java applicaiton with squid please ?
> 
> thans to all

Hey,

You are being blocked since the port 6666 is by default a non standard
port for http and not inside the SAFE_PORTS acl.
If you would add the port 6666 to the acls it will work fine.

Eliezer
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUR3vcAAoJENxnfXtQ8ZQUDjsIAJO8DJP4iu7k6iL3hjGPliPo
M6xmkwU1W5UZPWvAYiq+SWea6MJl4Cj+uEvgVSYuUE5Arx8GtNn0y6A8o/v02Olk
JlW66Yk8VHme9CTzlgvG15WUWND03Nv8vd/Ic/sA2AC1TODZvzgUn5jrhX6WVeZK
nPFrlqlGJk1MQ3EMK+1xaTCzTE+zBIgRBYhbWH+k3fIbT6HdrSAOdk4INzDxEl00
G6/DKfC4aoVc5rDYqKlAr3DRxqcdSiYVVkFRk3+H6/AYgn/51n7iFqnEoO58exiR
bfzuokeXzhvU6Pp6p4S/czqy1Be3PsVzY0VnCdm2LMlingownBjWsMZ5V/v6NQ8=
=g7/j
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Wed Oct 22 11:35:03 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 23 Oct 2014 00:35:03 +1300
Subject: [squid-users] squid 2.7 TPROXY not working
In-Reply-To: <566745164.14114348.1413957659895.JavaMail.zimbra@hadara.ps>
References: <1849989767.13991831.1413870932161.JavaMail.zimbra@hadara.ps>
 <5445FB29.5020104@treenet.co.nz>
 <1341794078.13996597.1413873362331.JavaMail.zimbra@hadara.ps>
 <54461382.1010705@treenet.co.nz>
 <360733775.14011498.1413880377108.JavaMail.zimbra@hadara.ps>
 <54461F00.4010900@treenet.co.nz>
 <566745164.14114348.1413957659895.JavaMail.zimbra@hadara.ps>
Message-ID: <54479667.4090408@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 22/10/2014 7:00 p.m., saleh madi wrote:
> Hello Amos,
> 
> I have install squid 3.4.8 and the same problem squid not works
> with tproxy. When I try to open website form client browser I see
> this error:
> 
> ########################################################### ERROR
> 
> The requested URL could not be retrieved
> 
> The following error was encountered while trying to retrieve the
> URL: http://www.sat1.de/
> 
> Connection to 4.26.247.126 failed.
> 
> The system returned: (110) Connection timed out
> 
> The remote host or network may be down. Please try the request
> again.
> 
> Your cache administrator is webmaster.
> 
> 
> Generated Tue, 21 Oct 2014 21:49:29 GMT by cache01 (squid/3.4.8)
> 
> ########################################################################
>
> 
Note: When I manually set proxy in my browser and everything works fine
and when I use redirect with nat everything works fine.
> 
> Please find the attached file for cache logs. Hope you can find the
> problem in the log file.
> 
> Thank you and Best Regards, Saleh
> 

TPROXY is receiving the traffic just fine, the problem is starting on
the outgoing side.

Please check your config file for "via off" and remove it to verify if
you are having a forwarding loop issue.

To fix forwarding loop check your router handling of packets coming
out of Squid. With TPROXY they will look *completely* identical to
packets coming directly from the client machine. Only MAC address or
interface name based routing rules will work correctly.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUR5ZnAAoJELJo5wb/XPRjX9YIAMb1VjzOntTgcWFPyVvRDgQU
p7y9mOA8OnS4bQr6Ln2LPS/F4xB0oPMwUfs5EFdUKzZ+HKV+LwVwPzK0RepImV4O
l5714SXSOGGh8WC7oAAKyF7cUARiD1bZDAUu1lS+gceDj64Dh/xqoEXLSJG1GS5B
TnMGVeUXOEuCsZtWJKBCWLo5lU8+rMqBn+r4RV8Ymt+69zcyYdCz4s9F898I3alA
e7yHxSLOIyJT0HdBHYSJLZdrFVW72A1BX9yHToVFxn3XshqeBHsCBFqba8UTIx2E
F8+YIt1UTUOrC2t0U2VkRM5/f4e6r+ghnBqI+AfRDzFBoul0YtKJ0rudHto30uk=
=en+V
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Wed Oct 22 11:41:10 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 23 Oct 2014 00:41:10 +1300
Subject: [squid-users]
 =?utf-8?q?Probl=C3=A9me_Squid_to_Java_application?=
In-Reply-To: <54477BDC.8040308@ngtech.co.il>
References: <CAASYH3w7txNACjypOS5huGNi=f6heTufgp4EQRnVBv-RFsPP8A@mail.gmail.com>
 <54477BDC.8040308@ngtech.co.il>
Message-ID: <544797D6.4070907@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 22/10/2014 10:41 p.m., Eliezer Croitoru wrote:
> On 10/22/2014 12:38 PM, Yassin CHOUCHANE wrote:
>> i have added on my squid.conf this ACL :
> 
> 
>> acl NoCachedSites dstdomain srv-java.e.t acl our_servers src 
>> 2.10.3.1
> 
> 
>> i have added the ip of server and the dstdomain, but squid
>> continue to block this java application can u have a tips to
>> don't block this java applicaiton with squid please ?
> 
>> thans to all
> 
> Hey,
> 
> You are being blocked since the port 6666 is by default a non
> standard port for http and not inside the SAFE_PORTS acl. If you
> would add the port 6666 to the acls it will work fine.

Not quite. Ports 1025-65535 are safe enough and in the default
Safe_ports listing.

That is a 407 status code. The proxy is configured to require
authentication.


This has nothing to do with caching or ports. The Java application is
just needing  to authenticate.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUR5fWAAoJELJo5wb/XPRjejUIAKL/f8mr1hVS6vK6lcTkbaMZ
IezlsiXBI5e7RNdcJoPpy8vc9eATByoDr/xQMwhQCPyM9pDoU1y61/TcCDLu3x9m
Hd4uHHyYqEoZjEfHHv/yFXQdK4uTHd8qHnAbK8godL5a4zVHZBvB+/v10atllUt8
aXmxCdH4qq30eWz7Xvajhs1xhV8S8vi6FIfiubY0Al3e15r6IaFFardrM6baw+OI
IKmge+IfEqyY9KRAeRgzq5YeyUU0fwLDnH8TV6K5R3bMpkiGUlIT6Pvx8p57Qmaf
lVHVkosWK0NLPH0m85PlD/ZcGV9iRVUCtAsb8oBgooLHkR3CcXMniVwosoooVeA=
=cs6h
-----END PGP SIGNATURE-----


From frechdesign at gmail.com  Wed Oct 22 11:48:58 2014
From: frechdesign at gmail.com (Yassin CHOUCHANE)
Date: Wed, 22 Oct 2014 13:48:58 +0200
Subject: [squid-users]
	=?utf-8?q?Probl=C3=A9me_Squid_to_Java_application?=
In-Reply-To: <544797D6.4070907@treenet.co.nz>
References: <CAASYH3w7txNACjypOS5huGNi=f6heTufgp4EQRnVBv-RFsPP8A@mail.gmail.com>
 <54477BDC.8040308@ngtech.co.il> <544797D6.4070907@treenet.co.nz>
Message-ID: <CAASYH3xWb37FCPZGH4vaq2iar8n81NmZJVzLH1G2d5Q2vXhChQ@mail.gmail.com>

ok so how make an execption for this application in squid ?


2014-10-22 13:41 GMT+02:00 Amos Jeffries <squid3 at treenet.co.nz>:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 22/10/2014 10:41 p.m., Eliezer Croitoru wrote:
>> On 10/22/2014 12:38 PM, Yassin CHOUCHANE wrote:
>>> i have added on my squid.conf this ACL :
>>
>>
>>> acl NoCachedSites dstdomain srv-java.e.t acl our_servers src
>>> 2.10.3.1
>>
>>
>>> i have added the ip of server and the dstdomain, but squid
>>> continue to block this java application can u have a tips to
>>> don't block this java applicaiton with squid please ?
>>
>>> thans to all
>>
>> Hey,
>>
>> You are being blocked since the port 6666 is by default a non
>> standard port for http and not inside the SAFE_PORTS acl. If you
>> would add the port 6666 to the acls it will work fine.
>
> Not quite. Ports 1025-65535 are safe enough and in the default
> Safe_ports listing.
>
> That is a 407 status code. The proxy is configured to require
> authentication.
>
>
> This has nothing to do with caching or ports. The Java application is
> just needing  to authenticate.
>
> Amos
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2.0.22 (MingW32)
>
> iQEcBAEBAgAGBQJUR5fWAAoJELJo5wb/XPRjejUIAKL/f8mr1hVS6vK6lcTkbaMZ
> IezlsiXBI5e7RNdcJoPpy8vc9eATByoDr/xQMwhQCPyM9pDoU1y61/TcCDLu3x9m
> Hd4uHHyYqEoZjEfHHv/yFXQdK4uTHd8qHnAbK8godL5a4zVHZBvB+/v10atllUt8
> aXmxCdH4qq30eWz7Xvajhs1xhV8S8vi6FIfiubY0Al3e15r6IaFFardrM6baw+OI
> IKmge+IfEqyY9KRAeRgzq5YeyUU0fwLDnH8TV6K5R3bMpkiGUlIT6Pvx8p57Qmaf
> lVHVkosWK0NLPH0m85PlD/ZcGV9iRVUCtAsb8oBgooLHkR3CcXMniVwosoooVeA=
> =cs6h
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From marko.cupac at mimar.rs  Wed Oct 22 14:18:13 2014
From: marko.cupac at mimar.rs (Marko =?UTF-8?B?Q3VwYcSH?=)
Date: Wed, 22 Oct 2014 16:18:13 +0200
Subject: [squid-users]
 =?utf-8?q?Probl=C3=A9me_Squid_to_Java_application?=
In-Reply-To: <CAASYH3xWb37FCPZGH4vaq2iar8n81NmZJVzLH1G2d5Q2vXhChQ@mail.gmail.com>
References: <CAASYH3w7txNACjypOS5huGNi=f6heTufgp4EQRnVBv-RFsPP8A@mail.gmail.com>
 <54477BDC.8040308@ngtech.co.il> <544797D6.4070907@treenet.co.nz>
 <CAASYH3xWb37FCPZGH4vaq2iar8n81NmZJVzLH1G2d5Q2vXhChQ@mail.gmail.com>
Message-ID: <20141022161813.58d8d468e7086fb609cc0a94@mimar.rs>

On Wed, 22 Oct 2014 13:48:58 +0200
Yassin CHOUCHANE <frechdesign at gmail.com> wrote:

> ok so how make an execption for this application in squid ?

I work around sits with broken authentication like this:

acl noauth dstdomain "/var/squid/lists/noauth"
...
http_access allow noauth
http_access deny !auth
http_access allow auth

All I have to do is put domains that have broken authentication through
proxy to /var/squid/lists/noauth and restart squid.

-- 
Marko Cupa?
https://www.mimar.rs


From eliezer at ngtech.co.il  Wed Oct 22 18:17:32 2014
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Wed, 22 Oct 2014 21:17:32 +0300
Subject: [squid-users]
	=?utf-8?q?Probl=C3=A9me_Squid_to_Java_application?=
In-Reply-To: <544797D6.4070907@treenet.co.nz>
References: <CAASYH3w7txNACjypOS5huGNi=f6heTufgp4EQRnVBv-RFsPP8A@mail.gmail.com>
 <54477BDC.8040308@ngtech.co.il> <544797D6.4070907@treenet.co.nz>
Message-ID: <5447F4BC.3030208@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 10/22/2014 02:41 PM, Amos Jeffries wrote:
> That is a 407 status code. The proxy is configured to require 
> authentication.
> 
Right Right.. Sorry for missing it.
Then a specific acl that will allow all lan users access to this
domain for without the need for authentication will solve the issue.
It depends on your http_access rules order.

Eliezer
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUR/S8AAoJENxnfXtQ8ZQUPloH/A6DHetK2Dmy9EedNhFU8bKw
2vJiN06Jzb7jNADZZTOWeGXCBNyRq5lkSCjlI/JrCaGkq1jhF3YQAWisugKQgdDO
hoWReEzBsJ37ToMTasY1A8+dlah3suPWNAP6mg0IoLe7ZS0tMnJJ9Wd0h7YTBVFA
afCwTSQvJu5MbD5yxp9XVVzYwOEAYi0MpURK3LxJjm1PZitYcZeU7AwnnjanJeIh
K9GiFzZwOorbrE/D/W3ejQ5mAFUR9/zi49SvM+fyEl1WSSIEiPHZca32vxFUiUIK
lp5D1lPXG8ZZeqzom/MTgkNw3iLCvZ2rO11aO03Uce7DFqThZP9bGBJctMEcD2M=
=DhW0
-----END PGP SIGNATURE-----


From eliezer at ngtech.co.il  Wed Oct 22 18:45:23 2014
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Wed, 22 Oct 2014 21:45:23 +0300
Subject: [squid-users] Squid 3.5.0.1 beta is available
In-Reply-To: <5445EA66.2020103@treenet.co.nz>
References: <5445EA66.2020103@treenet.co.nz>
Message-ID: <5447FB43.5010504@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 10/21/2014 08:08 AM, Amos Jeffries wrote:
> The Squid Software Foundation is very pleased to announce the 
> availability of the Squid-3.5.0.1 beta release!

I am not sure about what file is this release is in?
Can you refer to a specific bzr revision?
I have seen this file:
http://www.squid-cache.org/Versions/v3/3.5/squid-3.5.0.0-20141009-r13638.tar.gz

Which I am almost sure is the relevant one but the naming is pretty
not consistent.

Also in the versions page at:
http://www.squid-cache.org/Versions/

I do not see any version at the beta section.

(I want to build a new RPM...)

Eliezer
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEbBAEBAgAGBQJUR/tCAAoJENxnfXtQ8ZQUmVYH+PiFklhVkjX//npDApcPz1gq
MWisaeonEKCpbDRajJQf7DqlixNQRa0IgPorxqXrB8vHCBibb73Yh3xUGM/pFOLM
CA+i6Hfye7mTkdlHN4y/Y4hPkPTsD8FiliTs0vS0ebrbzCzaAaTyw1I7QFB+KldA
uA30hY8NuLyxeJsTcmy3TUvOrxecmtRbK2XRhuWeY38jWz8EH3xGGdGbsYvX3Sup
3oBP7pVcV2w1g9OjscsgHxUo4qSregVu6BQ4Myj5T9BmzlJii5OWDwUliTthXLma
nUN5PtfI63R9uYm5TYbwc8JidPYaX4Q6KcZ2iMbIx7/7hxC81Gl1kakxMaMCGg==
=bqpi
-----END PGP SIGNATURE-----


From odhiambo at gmail.com  Wed Oct 22 20:18:57 2014
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Wed, 22 Oct 2014 13:18:57 -0700
Subject: [squid-users] Squid 3.5.0.1 beta is available
In-Reply-To: <5447FB43.5010504@ngtech.co.il>
References: <5445EA66.2020103@treenet.co.nz> <5447FB43.5010504@ngtech.co.il>
Message-ID: <CAAdA2WNkzo3WGY8+jYKKxkd-+1WRzaqu00geYavGN4YmgyisSw@mail.gmail.com>

+1

Confusions galore. I was wondering what's going on.

On 22 October 2014 11:45, Eliezer Croitoru <eliezer at ngtech.co.il> wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 10/21/2014 08:08 AM, Amos Jeffries wrote:
> > The Squid Software Foundation is very pleased to announce the
> > availability of the Squid-3.5.0.1 beta release!
>
> I am not sure about what file is this release is in?
> Can you refer to a specific bzr revision?
> I have seen this file:
>
> http://www.squid-cache.org/Versions/v3/3.5/squid-3.5.0.0-20141009-r13638.tar.gz
>
> Which I am almost sure is the relevant one but the naming is pretty
> not consistent.
>
> Also in the versions page at:
> http://www.squid-cache.org/Versions/
>
> I do not see any version at the beta section.
>
> (I want to build a new RPM...)
>
> Eliezer
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1
>
> iQEbBAEBAgAGBQJUR/tCAAoJENxnfXtQ8ZQUmVYH+PiFklhVkjX//npDApcPz1gq
> MWisaeonEKCpbDRajJQf7DqlixNQRa0IgPorxqXrB8vHCBibb73Yh3xUGM/pFOLM
> CA+i6Hfye7mTkdlHN4y/Y4hPkPTsD8FiliTs0vS0ebrbzCzaAaTyw1I7QFB+KldA
> uA30hY8NuLyxeJsTcmy3TUvOrxecmtRbK2XRhuWeY38jWz8EH3xGGdGbsYvX3Sup
> 3oBP7pVcV2w1g9OjscsgHxUo4qSregVu6BQ4Myj5T9BmzlJii5OWDwUliTthXLma
> nUN5PtfI63R9uYm5TYbwc8JidPYaX4Q6KcZ2iMbIx7/7hxC81Gl1kakxMaMCGg==
> =bqpi
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>



-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254733744121/+254722743223
"I can't hear you -- I'm using the scrambler."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141022/80d95db0/attachment.htm>

From squid3 at treenet.co.nz  Wed Oct 22 23:40:05 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 23 Oct 2014 12:40:05 +1300
Subject: [squid-users] Squid 3.5.0.1 beta is available
In-Reply-To: <CAAdA2WNkzo3WGY8+jYKKxkd-+1WRzaqu00geYavGN4YmgyisSw@mail.gmail.com>
References: <5445EA66.2020103@treenet.co.nz> <5447FB43.5010504@ngtech.co.il>
 <CAAdA2WNkzo3WGY8+jYKKxkd-+1WRzaqu00geYavGN4YmgyisSw@mail.gmail.com>
Message-ID: <54484055.502@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 23/10/2014 9:18 a.m., Odhiambo Washington wrote:
> +1
> 
> Confusions galore. I was wondering what's going on.
> 

One of our mirror servers for www.squid-cache.org is still failing to
pick up changes. Unfortunately a bunch of country-specific mirrors are
pulling content from www with web crawlers instead of using the rsync
service, so they get really weird results as well.

If you are seeing this old content constantly or round-robin style
between page loads you can use west.squid-cache.org temporarily in the
URLs instead of www.

Amos

> On 22 October 2014 11:45, Eliezer Croitoru <eliezer at ngtech.co.il>
> wrote:
> 
> On 10/21/2014 08:08 AM, Amos Jeffries wrote:
>>>> The Squid Software Foundation is very pleased to announce
>>>> the availability of the Squid-3.5.0.1 beta release!
> 
> I am not sure about what file is this release is in? Can you refer
> to a specific bzr revision? I have seen this file:
> 
> http://www.squid-cache.org/Versions/v3/3.5/squid-3.5.0.0-20141009-r13638.tar.gz
>
>  Which I am almost sure is the relevant one but the naming is
> pretty not consistent.
> 
> Also in the versions page at: http://www.squid-cache.org/Versions/
> 
> I do not see any version at the beta section.
> 
> (I want to build a new RPM...)
> 
> Eliezer
>> _______________________________________________ squid-users
>> mailing list squid-users at lists.squid-cache.org 
>> http://lists.squid-cache.org/listinfo/squid-users
>> 
> 
> 
> 
> 
> 
> _______________________________________________ squid-users mailing
> list squid-users at lists.squid-cache.org 
> http://lists.squid-cache.org/listinfo/squid-users
> 

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUSEBTAAoJELJo5wb/XPRjiSwH/0bbTGsAro34Br606lVLz16t
BVgXvesnaKQFsO7hH3sZkbc4fbGLOF7i6581AVhOKfyKL9nao1ZYRHOv+yu016eC
FVUPp37YQQ6EZwporB0vFR6gk/0qPq6jLTTmQsN6EsPn5MlOn61K/1hkyfI4g7Ha
YaIcR1NNujJtp7VH4D/IT6ALVITg+ek1o4U86T+r3TWtsYzZSAbEtv6OIHKqrAHz
vjP1Rx34QhYN9u/unmdT+1tSGAz8D+iLLbtl1TlmtwQrEsF21SLYi2FbeoVZceEq
5o6FsoIGxj2Rw61u6D3CkTAeC9Qg9ZrP1V1L7E8oRp0JGtiHf4D9buLKIH7G5pc=
=aeD/
-----END PGP SIGNATURE-----


From geekguy at geek-guy.com  Wed Oct 22 23:49:28 2014
From: geekguy at geek-guy.com (Lawrence Pingree)
Date: Wed, 22 Oct 2014 16:49:28 -0700
Subject: [squid-users] Donate to squid!
Message-ID: <01c601cfee52$d2fe16b0$78fa4410$@geek-guy.com>

Fyi, I just donated, and I encourage all of you to donate to squid to help
our squid development out!

 

To donate: http://www.squid-cache.org/Foundation/donate.html

 

 

 

 

"Convert your dreams to achievable and realistic goals, this way the journey
is satisfying and progressive." - LP

 

Best regards,

The Geek Guy



Lawrence Pingree

 <http://www.lawrencepingree.com/resume/>
http://www.lawrencepingree.com/resume/

 

Author of "The Manager's Guide to Becoming Great"

 <http://www.management-book.com/> http://www.Management-Book.com

 

 
<https://webportal.isc2.org/custom/CertificationVerificationResults.aspx?FN=
Lawrence&LN=Pingree&CN=76042> 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141022/d83a3cd4/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.gif
Type: image/gif
Size: 2852 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141022/d83a3cd4/attachment.gif>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 3024 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141022/d83a3cd4/attachment.png>

From lionxyes at gmail.com  Thu Oct 23 03:35:00 2014
From: lionxyes at gmail.com (DongMing Huang)
Date: Thu, 23 Oct 2014 11:35:00 +0800
Subject: [squid-users] Question about loading ecap-adapter module
Message-ID: <CAOzykZRt-odtrRrVC7rVosTbvG4wkZ47FLTsuW7Ra90eDNRf9g@mail.gmail.com>

Hi.

Before I have compiled squid-3.3.3 with --enable-ecap option successfully
on cygwin.
but then I faild to compile ecap-adapter module.

Now, I compiled it as .dll successfully by writing compile and link command
by myself.
------------------------compile and link
command-------------------------------------
g++ -DHAVE_CONFIG_H -I../src -I/usr/local/include -g -O3 -Wall
-Wwrite-strings -Woverloaded-virtual -pipe -MT adapter_modifying.lo -MD -MP
-MF .deps/adapter_modifying.Tpo -c adapter_modifying.cc  -DDLL_EXPORT -DPIC
-o adapter_modifying.o

g++ -shared -o cygmodify.dll -Wl,--out-implib=libmodify.dll.a
-Wl,--export-all-symbols -Wl,--enable-auto-import -Wl,--whole-archive
adapter_minimal.o -Wl,--no-whole-archive /usr/local/lib/libecap.a
------------------------compile and link command
end-------------------------------------

But, when I configure squid to load it, it does't work well.
Here are the message than squid output.
-----------------------squid
message-------------------------------------------
HDM at HDM-PC /cygdrive/c/squdid/sbin
$ ./squid.exe -N -C -d1
2014/10/22 19:29:30| WARNING cache_mem is larger than total disk cache
space!
2014/10/22 19:29:30| Starting Squid Cache version 3.3.3 for
i686-pc-cygwin...
2014/10/22 19:29:30| Process ID 2040
2014/10/22 19:29:30| Process Roles: master worker
2014/10/22 19:29:30| With 3072 file descriptors available
2014/10/22 19:29:30| Initializing IP Cache...
2014/10/22 19:29:30| DNS Socket created at [::], FD 4
2014/10/22 19:29:30| DNS Socket created at 0.0.0.0, FD 5
2014/10/22 19:29:30| Adding nameserver 8.8.8.8 from squid.conf
2014/10/22 19:29:30| Logfile: opening log
daemon:/cygdrive/c/squdid/var/logs/access.log
2014/10/22 19:29:30| Logfile Daemon: opening log
/cygdrive/c/squdid/var/logs/access.log
2014/10/22 19:29:30| WARNING: no_suid: setuid(0): (22) Invalid argument
2014/10/22 19:29:30| WARNING: no_suid: setuid(0): (22) Invalid argument
2014/10/22 19:29:30| Unlinkd pipe opened on FD 11
2014/10/22 19:29:30| Store logging disabled
2014/10/22 19:29:30| Swap maxSize 102400 + 262144 KB, estimated 28041
objects
2014/10/22 19:29:30| Target number of buckets: 1402
2014/10/22 19:29:30| Using 8192 Store buckets
2014/10/22 19:29:30| Max Mem  size: 262144 KB
2014/10/22 19:29:30| Max Swap size: 102400 KB
2014/10/22 19:29:30| Rebuilding storage in /usr/local/squid/var/cache/squid
(dirty log)
2014/10/22 19:29:30| Using Least Load store dir selection
2014/10/22 19:29:30| Set Current Directory to
/usr/local/squid/var/cache/squid
2014/10/22 19:29:30| Loaded Icons.
2014/10/22 19:29:30| HTCP Disabled.
2014/10/22 19:29:30| Loading Squid module from
'/usr/local/lib/cygmodify.dll'
2014/10/22 19:29:30| Squid plugin modules loaded: 1
2014/10/22 19:29:30| Adaptation support is on
2014/10/22 19:29:30| WARNING: configured ecap_service was not loaded:
ecap://e-cap.org/ecap/services/sample/modifying
2014/10/22 19:29:30| Accepting HTTP Socket connections at local=[::]:3128
remote=[::] FD 14 flags=9
2014/10/22 19:29:30| Done reading /usr/local/squid/var/cache/squid swaplog
(8 entries)
2014/10/22 19:29:30| Finished rebuilding storage from disk.
2014/10/22 19:29:30|         8 Entries scanned
2014/10/22 19:29:30|         0 Invalid entries.
2014/10/22 19:29:30|         0 With invalid flags.
2014/10/22 19:29:30|         8 Objects loaded.
2014/10/22 19:29:30|         0 Objects expired.
2014/10/22 19:29:30|         0 Objects cancelled.
2014/10/22 19:29:30|         0 Duplicate URLs purged.
2014/10/22 19:29:30|         0 Swapfile clashes avoided.
2014/10/22 19:29:30|   Took 0.02 seconds (512.82 objects/sec).
2014/10/22 19:29:30| Beginning Validation Procedure
2014/10/22 19:29:30|   Completed Validation Procedure
2014/10/22 19:29:30|   Validated 8 Entries
2014/10/22 19:29:30|   store_swap_size = 364.00 KB
2014/10/22 19:29:31| storeLateRelease: released 0 objects
-----------------------squid message
end-------------------------------------------

I think that the .dll file should be not OK.

Please give me some hints and the location of src where squid loads
ecap-adapter module.

I want debug it. Thanks.

HDM1991
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141023/0e179389/attachment.htm>

From sudakov at sibptus.tomsk.ru  Thu Oct 23 04:53:32 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Thu, 23 Oct 2014 11:53:32 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <54444049.1010904@ngtech.co.il>
References: <20141014052401.GA8411@admin.sibptus.tomsk.ru>
 <m1iqc6$m3g$1@ger.gmane.org>
 <20141016161928.GA49304@admin.sibptus.tomsk.ru>
 <m1p4sp$aq3$1@ger.gmane.org>
 <20141017050231.GB60527@admin.sibptus.tomsk.ru>
 <5440A9C0.3030503@norma.perm.ru>
 <20141018101116.GA77970@admin.sibptus.tomsk.ru>
 <5442B403.3070306@zhegan.in>
 <20141019073258.GA91627@admin.sibptus.tomsk.ru>
 <54444049.1010904@ngtech.co.il>
Message-ID: <20141023045332.GA23654@admin.sibptus.tomsk.ru>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Eliezer Croitoru wrote:
> 
> And about the basic issues that you were having with performance, does
> it help to run Kerberos instead of NTLM (it should...)?

I have even moved squid to a new virtual machine (FreeBSD 9.3-RELEASE under
VMWare, 1 GB RAM) and performance still sucks royally. 

The Web access is fast in the morning, but I begin getting complaints
about "slow Internet" by lunchtime. I myself can visualy see the
performance degradation while browsing the web, and the growth of the
squid memory consumption. I observe about 25-30 negotiate_kerberos_auth
processes simultaneously.

My config:

auth_param negotiate program /usr/local/libexec/squid/negotiate_kerberos_auth -s GSS_C_NO_NAME
auth_param negotiate children 100 startup=5 idle=10
auth_param negotiate keep_alive on

If I set "auth_param negotiate keep_alive" to off, should it improve
performance?


- -- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUSInMAAoJEA2k8lmbXsY0I3oIALf02fgPuL2kdfazx+ysMXx/
sGZSo94sYGJTUzz/aJ1QIqCK6q/2r1VLqo7Xhx145JorbcqgSrxh85iuyYyzO1Mu
BBy+LHj7WUXlZSRtas3rhi4Pq0J7eUoj358+P2EM4csH3vhqUf7DdyBBixsTnBq9
3iKGQpxzZrEJFzM1jAyRHDi2wa0Y/ZH8ei7Oj04UdQAKnwhHa1c0CuOw0qX6oH4l
Ftg1aJFBXSXsHFDxDboKJ8fULZwSo/3A2cRNctqaFMMzW/ycGyVCB+m7W7Avq50l
L7wiiNcFtkBTvNOQ2gM873f5U1UJ8ZVLEUltPE0GKcfd4hpAWV0RTvsN4xOsEaI=
=fUe7
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Thu Oct 23 05:03:19 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 23 Oct 2014 18:03:19 +1300
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <20141023045332.GA23654@admin.sibptus.tomsk.ru>
References: <20141014052401.GA8411@admin.sibptus.tomsk.ru>
 <m1iqc6$m3g$1@ger.gmane.org> <20141016161928.GA49304@admin.sibptus.tomsk.ru>
 <m1p4sp$aq3$1@ger.gmane.org> <20141017050231.GB60527@admin.sibptus.tomsk.ru>
 <5440A9C0.3030503@norma.perm.ru>
 <20141018101116.GA77970@admin.sibptus.tomsk.ru> <5442B403.3070306@zhegan.in>
 <20141019073258.GA91627@admin.sibptus.tomsk.ru>
 <54444049.1010904@ngtech.co.il>
 <20141023045332.GA23654@admin.sibptus.tomsk.ru>
Message-ID: <54488C17.9010207@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 23/10/2014 5:53 p.m., Victor Sudakov wrote:
> Eliezer Croitoru wrote:
> 
>> And about the basic issues that you were having with performance,
>> does it help to run Kerberos instead of NTLM (it should...)?
> 
> I have even moved squid to a new virtual machine (FreeBSD
> 9.3-RELEASE under VMWare, 1 GB RAM) and performance still sucks
> royally.
> 
> The Web access is fast in the morning, but I begin getting
> complaints about "slow Internet" by lunchtime. I myself can visualy
> see the performance degradation while browsing the web, and the
> growth of the squid memory consumption. I observe about 25-30
> negotiate_kerberos_auth processes simultaneously.
> 
> My config:
> 
> auth_param negotiate program
> /usr/local/libexec/squid/negotiate_kerberos_auth -s GSS_C_NO_NAME 
> auth_param negotiate children 100 startup=5 idle=10 auth_param
> negotiate keep_alive on
> 
> If I set "auth_param negotiate keep_alive" to off, should it
> improve performance?

You can try it if you like. It is a workaround to MSIE 6.0 NTLM
implementation bugs, so should not have any effect on Kerberos. But
may help with older clients using Negotiate/NTLM.

I recall you had IDENT protocol acting as a bypass on user login
earlier. Are you still using that with the new IDENT bug fix patch in
your Squid-3.4?

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUSIwWAAoJELJo5wb/XPRj1S0IALhQF646CI82XVEcNFtUsx8p
9QfzV1PlUgbhvPYbNIR/aLuvnObPgutThRe4hJ9GSgMES78MTShuDK3EmMAgkM/J
UKt/xjvMvBlBkFS3iopfV7vPo/zaX5AHshCpSLw5OaKg2nuC276LgSvNx6JMfln/
LD7o7HvhLXPwBoS5BBWf/y1qsDw8wBF1JyNwhySxkhbVWV8nrP/sb6FY4XClZln4
4UcJmKAIoNiQ2npaZRTguHh0DXVaEnWUumhUN+qBsO0kAQ2pIL4yyxxQuNLcAhgp
TJCc/mRW8mYY2QcsVdTGWjGWe2mfVgyV9TYIFriHqf9cqIDXsqiv9LFWiOidSpI=
=ekNx
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Thu Oct 23 05:04:35 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 23 Oct 2014 18:04:35 +1300
Subject: [squid-users] Donate to squid!
In-Reply-To: <01c601cfee52$d2fe16b0$78fa4410$@geek-guy.com>
References: <01c601cfee52$d2fe16b0$78fa4410$@geek-guy.com>
Message-ID: <54488C63.4020705@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 23/10/2014 12:49 p.m., Lawrence Pingree wrote:
> Fyi, I just donated, and I encourage all of you to donate to squid
> to help our squid development out!
> 
> 
> To donate: http://www.squid-cache.org/Foundation/donate.html
> 

Thank you very much Lawrence. And for the mention as well.


Amos Jeffries
Squid Software Foundation
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUSIxjAAoJELJo5wb/XPRjlYEH/jotxE77CVkvs14ofu3NVy90
qMxih6siR7Vv5YPhWk3pG+Lf1axQwiMa9lZ3DY0SzPvQLfqAdDdGualpreI9ECMm
RBLQIhdBQsF3fhu+Xxb+UoNKzje+CO8abbkgd7Lh8Az9JPBTYDKv3rU/uiknm0F6
4bTLVH54VPvhnji6TgjraTcdUTt6tqaMHU2sXUfzzPbgbuqV37FX9aFjlDdV3Bdz
1IzQBvgXIB/1/ObFsA4sCNAyTvxRbxyIAzuFdsDoV7IxVu7uFBuseBC9ZL1CJDGp
T0Rz75ICI1Y2DjjkB1lvFGN0b1Q784KCSiOvU+aIDv8HNMNeSU68TKNycMP1nnE=
=AZiJ
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Thu Oct 23 05:09:58 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 23 Oct 2014 18:09:58 +1300
Subject: [squid-users] 3.3.x -> 3.4.x: huge performance regression
In-Reply-To: <5447486B.3010205@norma.perm.ru>
References: <5447486B.3010205@norma.perm.ru>
Message-ID: <54488DA6.5030904@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 22/10/2014 7:02 p.m., Eugene M. Zheganin wrote:
> Hi.
> 
> I was using the 3.4.x branch for quite some time, it was working
> just fine on small installations. Yesterday I upgraded my largest
> cache installation from 3.3.13 to 3.4.8 (same config, diskd,
> NTLM/GSS-SPNEGO auth helpers, external helpers). Today morning I
> noticed that squid is spiking to 100% of CPU and almost isn't
> serving any traffic. Restart didn't help, squid is serving pages 
> while continuing to consume CPU, load grows, until it's at 100%,
> and after some time my users are unable to open any page from
> Internet. This is sad, so I downgraded to 3.3.13. CPU consumption
> went back to 20-35% and everything is back to normal.
> 
> In order to understand what's happening I did some dtrace profiling
> to see what is squid busy with, taking the consideration, that
> measuring the same amount of connect()/socket() syscalls should
> give same amount of squid work, but the results were totally
> different on one number of such syscalls.
> 
> Anyone to comment ?

Very well for stating what you looked at. But actually stating what
you saw when looking would have been more helpful.


I have seen a few people mentioning that diskd vs AUFS situation has
resolved itself in FreeBSD 9 or 10. You could try changing the
cache_dir "diskd" to "aufs" or "ufs" and see if the speed increases.
 NP: Only a -k reconfigure is needed moving between those three types.


Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUSI2jAAoJELJo5wb/XPRjhs4IANl3ecEvUNmVPO3wDaL18/ww
BSgnNbvBYIfwi9KfngtTDf42Vtkb65W/MHav+vQgYuQDSpaIgY9EBEy+Asja1zSc
q5ZrvG+Fog+eD5lia7eEQZ1GESYkHTnX1FedxBzVMqt/lI7100Kfr2U50oReQuG8
3jUGKv/LEGzNcVFPkpK5l7HslcxndNgvmOsGhhZ7zHhevDe0VmJCB10jKkiQ4uf8
ar4VUm6zgIJv8h/4LYWwoFdtYQ13J6j7oN2AT6t3kx/iT883N/Q1Aht++iEdbied
US523FODfmZEfMQFPkQwVmJNkIr9Ndub1MgkFHbBQMp4BvpzG5UJuf8q0vYAxgg=
=6xIA
-----END PGP SIGNATURE-----


From sudakov at sibptus.tomsk.ru  Thu Oct 23 05:19:37 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Thu, 23 Oct 2014 12:19:37 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <54488C17.9010207@treenet.co.nz>
References: <20141016161928.GA49304@admin.sibptus.tomsk.ru>
 <m1p4sp$aq3$1@ger.gmane.org>
 <20141017050231.GB60527@admin.sibptus.tomsk.ru>
 <5440A9C0.3030503@norma.perm.ru>
 <20141018101116.GA77970@admin.sibptus.tomsk.ru>
 <5442B403.3070306@zhegan.in>
 <20141019073258.GA91627@admin.sibptus.tomsk.ru>
 <54444049.1010904@ngtech.co.il>
 <20141023045332.GA23654@admin.sibptus.tomsk.ru>
 <54488C17.9010207@treenet.co.nz>
Message-ID: <20141023051937.GB23654@admin.sibptus.tomsk.ru>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Amos Jeffries wrote:
> > 
> >> And about the basic issues that you were having with performance,
> >> does it help to run Kerberos instead of NTLM (it should...)?
> > 
> > I have even moved squid to a new virtual machine (FreeBSD
> > 9.3-RELEASE under VMWare, 1 GB RAM) and performance still sucks
> > royally.
> > 
> > The Web access is fast in the morning, but I begin getting
> > complaints about "slow Internet" by lunchtime. I myself can visualy
> > see the performance degradation while browsing the web, and the
> > growth of the squid memory consumption. I observe about 25-30
> > negotiate_kerberos_auth processes simultaneously.
> > 
> > My config:
> > 
> > auth_param negotiate program
> > /usr/local/libexec/squid/negotiate_kerberos_auth -s GSS_C_NO_NAME 
> > auth_param negotiate children 100 startup=5 idle=10 auth_param
> > negotiate keep_alive on
> > 
> > If I set "auth_param negotiate keep_alive" to off, should it
> > improve performance?
> 
> You can try it if you like. It is a workaround to MSIE 6.0 NTLM
> implementation bugs, so should not have any effect on Kerberos. But
> may help with older clients using Negotiate/NTLM.

I don't use Negotiate/NTLM so this will make no difference to me, no
use trying.

> I recall you had IDENT protocol acting as a bypass on user login
> earlier. Are you still using that with the new IDENT bug fix patch in
> your Squid-3.4?

I am running squid-3.4.8_2 now and I have disabled IDENT lookups
completely.

May I show you again my "squidclient mgr:mem" right after the start
and several hours later?

- -- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUSI/pAAoJEA2k8lmbXsY0dF8H/ikVW4uHWGlJaR18KiMZhrnA
xeVF7NEgtr8BftTdsD9jXPiY+XDnEdaTxcOKZ9SDUbJyt7EysjOSsm6Kp+iIKxng
UaINArEH7I1/tnCmwc8MSGJx2rvNyfylTnXviQo2Vue9XvuW5I6R6JX/2/W6T5b0
PUauJP68PWiTHfFMFCWy2l9G+s0DifV+Z7dgdkhQp8H5NSpx7JJIzlyc1INPzFgI
Ai1VMAzzmDegC6DPJIcJ9l9ECxaBC7okGLDVlFyEdN5izxyNmyYAbK2Eggvn2pYs
oZdzoRpqkk/8QQ5vQm7z1sE9VWi8TsKVoX8brbaTAtHJcbdSo8Uc/qN3Kn9S35M=
=10g/
-----END PGP SIGNATURE-----


From sudakov at sibptus.tomsk.ru  Thu Oct 23 06:27:17 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Thu, 23 Oct 2014 13:27:17 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <20141023051937.GB23654@admin.sibptus.tomsk.ru>
References: <m1p4sp$aq3$1@ger.gmane.org>
 <20141017050231.GB60527@admin.sibptus.tomsk.ru>
 <5440A9C0.3030503@norma.perm.ru>
 <20141018101116.GA77970@admin.sibptus.tomsk.ru>
 <5442B403.3070306@zhegan.in>
 <20141019073258.GA91627@admin.sibptus.tomsk.ru>
 <54444049.1010904@ngtech.co.il>
 <20141023045332.GA23654@admin.sibptus.tomsk.ru>
 <54488C17.9010207@treenet.co.nz>
 <20141023051937.GB23654@admin.sibptus.tomsk.ru>
Message-ID: <20141023062717.GA26140@admin.sibptus.tomsk.ru>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Victor Sudakov wrote:
> > > 
> > >> And about the basic issues that you were having with performance,
> > >> does it help to run Kerberos instead of NTLM (it should...)?
> > > 
> > > I have even moved squid to a new virtual machine (FreeBSD
> > > 9.3-RELEASE under VMWare, 1 GB RAM) and performance still sucks
> > > royally.

I don't know what's happening with squid but this kind of CPU consumption is
just not normal:


last pid:  9761;  load averages:  0.98,  0.97,  0.83     up 0+19:23:06  13:23:42
50 processes:  2 running, 48 sleeping
CPU: 97.3% user,  0.0% nice,  2.4% system,  0.0% interrupt,  0.4% idle
Mem: 595M Active, 250M Inact, 107M Wired, 6508K Cache, 95M Buf, 26M Free
Swap: 1023M Total, 1304K Used, 1022M Free

  PID USERNAME    THR PRI NICE   SIZE    RES STATE    TIME    WCPU COMMAND
 8458 squid         1 101    0   557M   530M RUN     39:32 100.00% squid
 8459 squid         1  20    0 34276K 26204K sbwait   0:32   0.00% negotiate_ker
 8460 squid         1  20    0 17892K  9852K sbwait   0:09   0.00% negotiate_ker
 8461 squid         1  20    0 13796K  6452K sbwait   0:04   0.00% negotiate_ker
 8462 squid         1  20    0 13796K  4892K sbwait   0:02   0.00% negotiate_ker
 8464 squid         1  20    0 10860K  1932K piperd   0:01   0.00% unlinkd
 8463 squid         1  20    0 13796K  4168K sbwait   0:01   0.00% negotiate_ker
 8465 squid         1  20    0 13796K  3836K sbwait   0:01   0.00% negotiate_ker
 8466 squid         1  20    0 13796K  3648K sbwait   0:00   0.00% negotiate_ker
 8467 squid         1  20    0 13796K  3568K sbwait   0:00   0.00% negotiate_ker
 8468 squid         1  20    0 13796K  3520K sbwait   0:00   0.00% negotiate_ker
 8469 squid         1  20    0 13796K  3480K sbwait   0:00   0.00% negotiate_ker
 8470 squid         1  20    0 13796K  3460K sbwait   0:00   0.00% negotiate_ker
 8471 squid         1  20    0 13796K  3428K sbwait   0:00   0.00% negotiate_ker
 8472 squid         1  20    0 13796K  3420K sbwait   0:00   0.00% negotiate_ker
 8473 squid         1  20    0 13796K  3416K sbwait   0:00   0.00% negotiate_ker
 8474 squid         1  20    0 13796K  3404K sbwait   0:00   0.00% negotiate_ker

> > > 
> > > The Web access is fast in the morning, but I begin getting
> > > complaints about "slow Internet" by lunchtime. I myself can visualy
> > > see the performance degradation while browsing the web, and the
> > > growth of the squid memory consumption. I observe about 25-30
> > > negotiate_kerberos_auth processes simultaneously.
> > > 

- -- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUSJ/FAAoJEA2k8lmbXsY0KkEIAKXpYq0dHZnQR6vWDA8XyZ4y
Ht/2duwAyxPdnn4SsbY+hYc3HDy2JHm9us/2+6lCFE2sye1/LLdGLObH9LXFV++O
uXn2AfmtS4DNyLENytq+mPSScrMa29jIc5EKUgGs88f+UZDE1sPo7BjGkzaj7G6y
pRStBYogH2r8jfuwYcvJhbbyixdGlMprFZT4jg3+2IDTjamPIjmTuO/xDX+klhPZ
jMhZc9zcUvVUOsJHW/lHgQsNU0bMN+5kAO5kko9Vbzxdif2D8jWzlONcvsp4Rf1P
FZMaXo+eCRunCcKTzfW3zMaGkpivcrKT/kYuGt7cpwr0ga7LzaJr0CMJjM6q9LY=
=UysH
-----END PGP SIGNATURE-----


From eliezer at ngtech.co.il  Thu Oct 23 09:18:51 2014
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Thu, 23 Oct 2014 12:18:51 +0300
Subject: [squid-users] 3.3.x -> 3.4.x: huge performance regression
In-Reply-To: <5447486B.3010205@norma.perm.ru>
References: <5447486B.3010205@norma.perm.ru>
Message-ID: <5448C7FB.1080104@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hey,

What is the network load? how many users?
Have you been using workers at all in the past?
Can you see the avg requests per second on the cache manager page?

Eliezer

On 10/22/2014 09:02 AM, Eugene M. Zheganin wrote:
> Hi.
> 
> I was using the 3.4.x branch for quite some time, it was working
> just fine on small installations. Yesterday I upgraded my largest
> cache installation from 3.3.13 to 3.4.8 (same config, diskd,
> NTLM/GSS-SPNEGO auth helpers, external helpers). Today morning I
> noticed that squid is spiking to 100% of CPU and almost isn't
> serving any traffic. Restart didn't help, squid is serving pages 
> while continuing to consume CPU, load grows, until it's at 100%,
> and after some time my users are unable to open any page from
> Internet. This is sad, so I downgraded to 3.3.13. CPU consumption
> went back to 20-35% and everything is back to normal.
> 
> In order to understand what's happening I did some dtrace profiling
> to see what is squid busy with, taking the consideration, that
> measuring the same amount of connect()/socket() syscalls should
> give same amount of squid work, but the results were totally
> different on one number of such syscalls.
> 
> Anyone to comment ?
> 
> Thanks. Eugene. _______________________________________________ 
> squid-users mailing list squid-users at lists.squid-cache.org 
> http://lists.squid-cache.org/listinfo/squid-users
> 

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUSMf7AAoJENxnfXtQ8ZQU/KwH/icRcMBoEA4Y8u3/inbnvSiT
CMPX6On9CO+RJeXlDGcAMfbYofZixB8zR5BuBTOsNS35moqCtHmlzZYtoGxkLGLx
RU6KKEhLGuGNyFCnyQx/oh9hcG90PSnaFnsp0m3vClcFtxv3kcdn944VS8hPtKWC
MQw7G8KzXwu7RmTaP5nk+EGNX3JAn8GlQaINX6G4zKeujqwrK954KORPMt0S53iQ
P7k6rq+ckPDgTIHuK4L+eMCka22y0z2FTo41jxSXK7J6w3GnWUsvwA22yYo6BV1h
+4DjvvtoJA3nNuFtXYxXCcBLMXcwk953o2uQKGkqOmlLGg660Bu9tCTBFAvaQsg=
=79iu
-----END PGP SIGNATURE-----


From eliezer at ngtech.co.il  Thu Oct 23 09:21:08 2014
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Thu, 23 Oct 2014 12:21:08 +0300
Subject: [squid-users] Squid 3.5.0.1 beta is available
In-Reply-To: <54484055.502@treenet.co.nz>
References: <5445EA66.2020103@treenet.co.nz> <5447FB43.5010504@ngtech.co.il>
 <CAAdA2WNkzo3WGY8+jYKKxkd-+1WRzaqu00geYavGN4YmgyisSw@mail.gmail.com>
 <54484055.502@treenet.co.nz>
Message-ID: <5448C884.7060803@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 10/23/2014 02:40 AM, Amos Jeffries wrote:
> If you are seeing this old content constantly or round-robin style 
> between page loads you can use west.squid-cache.org temporarily in
> the URLs instead of www.
> 
> Amos
It's the same issue for me:
http://west.squid-cache.org/Versions/
shows no beta versions in the page at all.

Can you just give a direct link to the release tar.xz?

Thanks,
Eliezer
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUSMiEAAoJENxnfXtQ8ZQU2MYH/1T2kXVuZqTQ4DP/RdofbrfL
NRwcK7pCHd9CDDXgmViNaV45ryUsOrQ7KqF3ZG1LahrdFG6rzO2sQk1GqQQ1mRHg
bZT2PqiZTuuDkFehkWgjExb04jNWv40hnZTluB/qmwW7SEcSeWJLLVsWNvDzCwtN
afCOOXBQv7ZeS7JuGa/Undjd91Iuld7/d5MsfHqbKTSo03L6cjrPJUzsUeaPaY4L
77vjXD40B95mhV8E5vMmXKgSKh6ZJFEGgJ/iMZ4oxjxdA9pUfOT81IS+pimEq7w2
swhSW7o6Df+BTvaVCHJY9XYaZhImcDWGNH2pzm7Lf3yYASTXPteJUb6LImUqesg=
=bqS5
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Thu Oct 23 10:24:20 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 23 Oct 2014 23:24:20 +1300
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <20141023062717.GA26140@admin.sibptus.tomsk.ru>
References: <m1p4sp$aq3$1@ger.gmane.org>
 <20141017050231.GB60527@admin.sibptus.tomsk.ru>
 <5440A9C0.3030503@norma.perm.ru>
 <20141018101116.GA77970@admin.sibptus.tomsk.ru> <5442B403.3070306@zhegan.in>
 <20141019073258.GA91627@admin.sibptus.tomsk.ru>
 <54444049.1010904@ngtech.co.il>
 <20141023045332.GA23654@admin.sibptus.tomsk.ru>
 <54488C17.9010207@treenet.co.nz>
 <20141023051937.GB23654@admin.sibptus.tomsk.ru>
 <20141023062717.GA26140@admin.sibptus.tomsk.ru>
Message-ID: <5448D754.2040000@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 23/10/2014 7:27 p.m., Victor Sudakov wrote:
> Victor Sudakov wrote:
>>>> 
>>>>> And about the basic issues that you were having with
>>>>> performance, does it help to run Kerberos instead of NTLM
>>>>> (it should...)?
>>>> 
>>>> I have even moved squid to a new virtual machine (FreeBSD 
>>>> 9.3-RELEASE under VMWare, 1 GB RAM) and performance still
>>>> sucks royally.
> 
> I don't know what's happening with squid but this kind of CPU
> consumption is just not normal:

Well, it both is and it isn't.

Squid *will* use the CPU hardware right up too the 100% limit if it
has any need to that is normal.

Needing to for long periods of time is not particularly normal ...
except under conditions where the traffic load is too high for the
server hardware to cope with.

I did see a scenario with behaviour exactly like this at a client some
time back. After detailed analysis it turned out that their NTLM
helper had been so slow that clients traffic spent more time waiting
for next auth action than processing requests.
 But when they moved to the higher performance Kerberos and a simpler
proxy configuration the client traffic throughput increased to a
req/sec rate faster than the server could cope (3x previous rate).
 It thus was bottlenecked by 100% CPU speed limit rather than by NTLM
delays.

So, "normal" depends on what exactly is the cause of the behaviour.

What req/sec traffic rates are you seeing on what you consider a
"normal" / older proxy compared to this one?

Also, what are the heleprs stats looking like in the cachemgr report?

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUSNdUAAoJELJo5wb/XPRj57sIALpsmoKBfywN6iToL1ZfODbL
pXDGxm0dcMXBlLB3gadEjMLvA5LlgY9xyFl41UHGjYhvg93RAsoLQmCNHZUgRtT8
fNqyVgGV5CnbPZQTJwWMjHFiGOR3/p8VFbH67nXt5xB7WZdT8UhWKkVxK3kNm2P9
BopiIYKeXDqgTKGw2OzPw/Xe8ieLOr/avxAq1cQkFhGw3B0mj+f6S9DlNZ6wSQR0
tIsshL2hHxt9jDnYVo1A8Gg6khYjjwZmRNFs5ixzsftMzBKR2QKAv09q/BKTTqID
T1EFFU5MuHanoxRzURJ0lh3UPeSj2sook5qKUyHQ/gyUc7yJtO+E3IdKcC/yDDM=
=/yVu
-----END PGP SIGNATURE-----


From sudakov at sibptus.tomsk.ru  Thu Oct 23 11:28:14 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Thu, 23 Oct 2014 18:28:14 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <5448C758.2070704@ngtech.co.il>
References: <5440A9C0.3030503@norma.perm.ru>
 <20141018101116.GA77970@admin.sibptus.tomsk.ru>
 <5442B403.3070306@zhegan.in>
 <20141019073258.GA91627@admin.sibptus.tomsk.ru>
 <54444049.1010904@ngtech.co.il>
 <20141023045332.GA23654@admin.sibptus.tomsk.ru>
 <54488C17.9010207@treenet.co.nz>
 <20141023051937.GB23654@admin.sibptus.tomsk.ru>
 <20141023062717.GA26140@admin.sibptus.tomsk.ru>
 <5448C758.2070704@ngtech.co.il>
Message-ID: <20141023112814.GA27882@admin.sibptus.tomsk.ru>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Eliezer Croitoru wrote:
> > I don't know what's happening with squid but this kind of CPU
> > consumption is just not normal:
> > 
> 
> Victor are you using workers by any chance?

I doubt it.  I have compiled it from the FreeBSD ports, there was no
"workers" option.

Here is what the binary says about itself:

Squid Cache: Version 3.4.8
configure options:  '--with-default-user=squid' '--bindir=/usr/local/sbin' '--sbindir=/usr/local/sbin' '--datadir=/usr/local/etc/squid' '--libexecdir=/usr/local/libexec/squid' '--localstatedir=/var' '--sysconfdir=/usr/local/etc/squid' '--with-logdir=/var/log/squid' '--with-pidfile=/var/run/squid/squid.pid' '--with-swapdir=/var/squid/cache/squid' '--enable-auth' '--enable-build-info' '--enable-loadable-modules' '--enable-removal-policies=lru heap' '--disable-epoll' '--disable-linux-netfilter' '--disable-linux-tproxy' '--disable-translation' '--disable-arch-native' '--disable-eui' '--enable-cache-digests' '--enable-delay-pools' '--disable-ecap' '--disable-esi' '--disable-follow-x-forwarded-for' '--enable-htcp' '--disable-icap-client' '--disable-icmp' '--enable-ident-lookups' '--enable-ipv6' '--enable-kqueue' '--without-large-files' '--disable-http-violations' '--disable-snmp' '--disable-ssl' '--disable-ssl-crtd' '--disable-stacktraces' '--disable-ipf-transparent' '--disable-ipfw-transparent' '--disable-pf-transparent' '--without-nat-devpf' '--enable-forw-via-db' '--enable-wccp' '--enable-wccpv2' '--enable-auth-basic=DB MSNT MSNT-multi-domain NCSA PAM POP3 RADIUS fake getpwnam NIS' '--enable-auth-digest=file' '--enable-external-acl-helpers=file_userip time_quota unix_group' '--enable-auth-negotiate=kerberos wrapper' '--enable-auth-ntlm=fake smb_lm' '--enable-storeio=ufs aufs diskd' '--enable-disk-io=AIO Blocking IpcIo Mmapped DiskThreads DiskDaemon' '--enable-log-daemon-helpers=file' '--enable-url-rewrite-helpers=fake' '--enable-storeid-rewrite-helpers=file' '--prefix=/usr/local' '--mandir=/usr/local/man' '--infodir=/usr/local/info/' '--build=i386-portbld-freebsd9.3' 'build_alias=i386-portbld-freebsd9.3' 'CC=cc' 'CFLAGS=-O2 -pipe -fno-strict-aliasing' 'LDFLAGS= -pthread' 'LIBS=' 'CPPFLAGS=' 'CXX=c++' 'CXXFLAGS=-O2 -pipe -fno-strict-aliasing' 'CPP=cpp' --enable-ltdl-convenience


> If not then add another worker at a time to make sure that it's not an
> issue(and bump the VM CPUs into more then 2 to something like 4-6).

The problem does not seem to be in the squid itself. It's in the
authentication helpers or their interaction with the main squid
process.  Disabling authentication solves the performance/CPU problem. 

> It will lower the load only on one instance of squid.
> It can also mean that there is a degradation between old squid
> versions and new squid versions bumping the need for more CPU then before.

This is incredible that a virtual host with 1GB RAM would require so
many resources for running just squid. Why would a web cache for 200+
users be a CPU hog?

Should I perhaps increase the number of negotiate children?
- -- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUSOZOAAoJEA2k8lmbXsY0XSYH/1Ni3gkhl8vgV0sN5B37c7Iu
ytznAbfUJ7HZJLJjMsvCMQTJ79SdvxKJRv0st7cWQnGmT4os6WaqEPBCPTonT5ik
rxZxaKD8t6vcTxlLc4jqEZIHLE981u0yl5TMTAxN/LfzYvMTZt4EPmzWCB0Cy6OH
5jeUmOrcYqjK1VvTsZB4/dKDVPbxR+v5BHHilZYplkQarMjtdXemZB+Eca8wbWC/
CgbciYsaJl1RiuXW9VcLLxHO+6ZjDqjEO1hb5L1kx2tIm8attBdVr4Rcw6Cb7nX7
l2uQuptHr+3eAi/mPRHyAc9lgXtsXVsa3a3XM0nYeNbnGhJUh2XQwgBUitwy094=
=uH3e
-----END PGP SIGNATURE-----


From sudakov at sibptus.tomsk.ru  Thu Oct 23 11:41:16 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Thu, 23 Oct 2014 18:41:16 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <5448D754.2040000@treenet.co.nz>
References: <5440A9C0.3030503@norma.perm.ru>
 <20141018101116.GA77970@admin.sibptus.tomsk.ru>
 <5442B403.3070306@zhegan.in>
 <20141019073258.GA91627@admin.sibptus.tomsk.ru>
 <54444049.1010904@ngtech.co.il>
 <20141023045332.GA23654@admin.sibptus.tomsk.ru>
 <54488C17.9010207@treenet.co.nz>
 <20141023051937.GB23654@admin.sibptus.tomsk.ru>
 <20141023062717.GA26140@admin.sibptus.tomsk.ru>
 <5448D754.2040000@treenet.co.nz>
Message-ID: <20141023114116.GA28981@admin.sibptus.tomsk.ru>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Amos Jeffries wrote:
> >>>>> And about the basic issues that you were having with
> >>>>> performance, does it help to run Kerberos instead of NTLM
> >>>>> (it should...)?
> >>>> 
> >>>> I have even moved squid to a new virtual machine (FreeBSD 
> >>>> 9.3-RELEASE under VMWare, 1 GB RAM) and performance still
> >>>> sucks royally.
> > 
> > I don't know what's happening with squid but this kind of CPU
> > consumption is just not normal:
> 
> Well, it both is and it isn't.
> 
> Squid *will* use the CPU hardware right up too the 100% limit if it
> has any need to that is normal.
> 
> Needing to for long periods of time is not particularly normal ...
> except under conditions where the traffic load is too high for the
> server hardware to cope with.
> 
> I did see a scenario with behaviour exactly like this at a client some
> time back. After detailed analysis it turned out that their NTLM
> helper had been so slow that clients traffic spent more time waiting
> for next auth action than processing requests.

Looks like my scenario but I am already using a Kerberos helper.

I'll increase the number of virtual CPUs tonight. The OS kernel should
parallel the authentication children for 2 CPUs, maybe that will make
a difference.

>  But when they moved to the higher performance Kerberos and a simpler
> proxy configuration the client traffic throughput increased to a
> req/sec rate faster than the server could cope (3x previous rate).
>  It thus was bottlenecked by 100% CPU speed limit rather than by NTLM
> delays.
> 
> So, "normal" depends on what exactly is the cause of the behaviour.
> 
> What req/sec traffic rates are you seeing on what you consider a
> "normal" / older proxy compared to this one?

The number of clients and queries is exactly the same as with the
older proxy. Nothing has changed other than squid version. Besides,
the older proxy was using the LM auth helper.

> 
> Also, what are the heleprs stats looking like in the cachemgr report?

Here it is:

Sending HTTP request ... done.
HTTP/1.1 200 OK
Server: squid/3.4.8
Mime-Version: 1.0
Date: Thu, 23 Oct 2014 11:37:16 GMT
Content-Type: text/plain
Expires: Thu, 23 Oct 2014 11:37:16 GMT
Last-Modified: Thu, 23 Oct 2014 11:37:16 GMT
X-Cache: MISS from proxy.sibptus.transneft.ru
X-Cache-Lookup: MISS from proxy.sibptus.transneft.ru:3128
Via: 1.1 proxy.sibptus.transneft.ru (squid/3.4.8)
Connection: close

Negotiate Authenticator Statistics:
program: /usr/local/libexec/squid/negotiate_kerberos_auth
number active: 25 of 100 (0 shutting down)
requests sent: 51956
replies received: 51956
queue length: 0
avg service time: 1 msec

   ID #	     FD	    PID	 # Requests	  # Replies	 Flags	   Time	 Offset	Request
      0	      9	   9803	      32120	      32120	     	  0.001	      0	(none)
      0	     11	   9804	       9412	       9412	     	  0.011	      0	(none)
      0	     13	   9805	       4477	       4477	     	  0.011	      0	(none)
      0	     15	   9806	       2338	       2338	     	  0.011	      0	(none)
      0	     17	   9807	       1320	       1320	     	  0.009	      0	(none)
      0	    380	   9809	        789	        789	     	  0.009	      0	(none)
      0	    393	   9810	        521	        521	     	  0.011	      0	(none)
      0	    396	   9811	        332	        332	     	  0.025	      0	(none)
      0	    398	   9812	        221	        221	     	  0.025	      0	(none)
      0	    400	   9813	        144	        144	     	  0.025	      0	(none)
      0	    402	   9814	        100	        100	     	  0.024	      0	(none)
      0	    404	   9815	         58	         58	     	  1.211	      0	(none)
      0	    406	   9816	         38	         38	     	  1.211	      0	(none)
      0	    408	   9817	         29	         29	     	  1.211	      0	(none)
      0	    410	   9818	         20	         20	     	  1.211	      0	(none)
      0	    577	   9902	         13	         13	     	  1.211	      0	(none)
      0	    587	   9903	          8	          8	     	  1.211	      0	(none)
      0	    651	   9904	          5	          5	     	  1.211	      0	(none)
      0	    668	   9905	          4	          4	     	  1.211	      0	(none)
      0	    673	   9906	          3	          3	     	  1.211	      0	(none)
      0	    677	   9907	          2	          2	     	  3.669	      0	(none)
      0	    679	   9908	          1	          1	     	  3.669	      0	(none)
      0	    681	   9909	          1	          1	     	  3.669	      0	(none)
      0	    684	   9910	          0	          0	     	  0.000	      0	(none)
      0	    688	   9911	          0	          0	     	  0.000	      0	(none)

Flags key:

   B = BUSY
   C = CLOSING
   R = RESERVED
   S = SHUTDOWN PENDING
   P = PLACEHOLDER


- -- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUSOlbAAoJEA2k8lmbXsY0r7AIAJhEAcUYajdnLa+geOlMblaG
8w+EyzWX6H+Sg1qaevBi28rB16qo0aAez4SY+GvTtle3qUnGdU3xpMxOKz+F4LV9
8Rz47bV4XfTyB8o4YF7ukFE9u/1CGQP+wk9FKGWZwpANiaE633PyMnEG0ftJYo1i
dK96bCBMhNjArbwqKGgR1SQgO7KfJhVYspLs8700d/sgV2d8xx7FXoxICLhyG6Xz
N+yUETFn6el6CUFnM+YGKBXylfzp56KQg92pP/TNYZ9cj7vH4vKDsexmq3VrACTn
FsF7cz3vQWMaBrsTSLExFzcSm2Gri5WewjeMR9HBzxNBCw24VvbSn0CL7e5sbRw=
=0Hh1
-----END PGP SIGNATURE-----


From carlosdefoe at gmail.com  Thu Oct 23 12:13:41 2014
From: carlosdefoe at gmail.com (Carlos Defoe)
Date: Thu, 23 Oct 2014 09:13:41 -0300
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <20141023114116.GA28981@admin.sibptus.tomsk.ru>
References: <5440A9C0.3030503@norma.perm.ru>
 <20141018101116.GA77970@admin.sibptus.tomsk.ru>
 <5442B403.3070306@zhegan.in>
 <20141019073258.GA91627@admin.sibptus.tomsk.ru>
 <54444049.1010904@ngtech.co.il>
 <20141023045332.GA23654@admin.sibptus.tomsk.ru>
 <54488C17.9010207@treenet.co.nz>
 <20141023051937.GB23654@admin.sibptus.tomsk.ru>
 <20141023062717.GA26140@admin.sibptus.tomsk.ru>
 <5448D754.2040000@treenet.co.nz>
 <20141023114116.GA28981@admin.sibptus.tomsk.ru>
Message-ID: <CAHsHsyuHJwb95kCSoh-uJ4MnNM5jrTxHCMxOstGXcQExud-LjQ@mail.gmail.com>

I had this kind of 100% CPU problem with auth helpers when upgrading
to squid 3.4. I use negotiate_wrapper, kerberos, ntlm and basic auth.
Then I had to fall back to 3.3 and it is production until now, with
some troubles with broken clients, but with normal cpu usage most of
the time.
Can you try with squid 3.3 and see if that version don't have the same problem?

On Thu, Oct 23, 2014 at 8:41 AM, Victor Sudakov
<sudakov at sibptus.tomsk.ru> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Amos Jeffries wrote:
>> >>>>> And about the basic issues that you were having with
>> >>>>> performance, does it help to run Kerberos instead of NTLM
>> >>>>> (it should...)?
>> >>>>
>> >>>> I have even moved squid to a new virtual machine (FreeBSD
>> >>>> 9.3-RELEASE under VMWare, 1 GB RAM) and performance still
>> >>>> sucks royally.
>> >
>> > I don't know what's happening with squid but this kind of CPU
>> > consumption is just not normal:
>>
>> Well, it both is and it isn't.
>>
>> Squid *will* use the CPU hardware right up too the 100% limit if it
>> has any need to that is normal.
>>
>> Needing to for long periods of time is not particularly normal ...
>> except under conditions where the traffic load is too high for the
>> server hardware to cope with.
>>
>> I did see a scenario with behaviour exactly like this at a client some
>> time back. After detailed analysis it turned out that their NTLM
>> helper had been so slow that clients traffic spent more time waiting
>> for next auth action than processing requests.
>
> Looks like my scenario but I am already using a Kerberos helper.
>
> I'll increase the number of virtual CPUs tonight. The OS kernel should
> parallel the authentication children for 2 CPUs, maybe that will make
> a difference.
>
>>  But when they moved to the higher performance Kerberos and a simpler
>> proxy configuration the client traffic throughput increased to a
>> req/sec rate faster than the server could cope (3x previous rate).
>>  It thus was bottlenecked by 100% CPU speed limit rather than by NTLM
>> delays.
>>
>> So, "normal" depends on what exactly is the cause of the behaviour.
>>
>> What req/sec traffic rates are you seeing on what you consider a
>> "normal" / older proxy compared to this one?
>
> The number of clients and queries is exactly the same as with the
> older proxy. Nothing has changed other than squid version. Besides,
> the older proxy was using the LM auth helper.
>
>>
>> Also, what are the heleprs stats looking like in the cachemgr report?
>
> Here it is:
>
> Sending HTTP request ... done.
> HTTP/1.1 200 OK
> Server: squid/3.4.8
> Mime-Version: 1.0
> Date: Thu, 23 Oct 2014 11:37:16 GMT
> Content-Type: text/plain
> Expires: Thu, 23 Oct 2014 11:37:16 GMT
> Last-Modified: Thu, 23 Oct 2014 11:37:16 GMT
> X-Cache: MISS from proxy.sibptus.transneft.ru
> X-Cache-Lookup: MISS from proxy.sibptus.transneft.ru:3128
> Via: 1.1 proxy.sibptus.transneft.ru (squid/3.4.8)
> Connection: close
>
> Negotiate Authenticator Statistics:
> program: /usr/local/libexec/squid/negotiate_kerberos_auth
> number active: 25 of 100 (0 shutting down)
> requests sent: 51956
> replies received: 51956
> queue length: 0
> avg service time: 1 msec
>
>    ID #      FD     PID  # Requests       # Replies      Flags     Time  Offset Request
>       0       9    9803       32120           32120               0.001       0 (none)
>       0      11    9804        9412            9412               0.011       0 (none)
>       0      13    9805        4477            4477               0.011       0 (none)
>       0      15    9806        2338            2338               0.011       0 (none)
>       0      17    9807        1320            1320               0.009       0 (none)
>       0     380    9809         789             789               0.009       0 (none)
>       0     393    9810         521             521               0.011       0 (none)
>       0     396    9811         332             332               0.025       0 (none)
>       0     398    9812         221             221               0.025       0 (none)
>       0     400    9813         144             144               0.025       0 (none)
>       0     402    9814         100             100               0.024       0 (none)
>       0     404    9815          58              58               1.211       0 (none)
>       0     406    9816          38              38               1.211       0 (none)
>       0     408    9817          29              29               1.211       0 (none)
>       0     410    9818          20              20               1.211       0 (none)
>       0     577    9902          13              13               1.211       0 (none)
>       0     587    9903           8               8               1.211       0 (none)
>       0     651    9904           5               5               1.211       0 (none)
>       0     668    9905           4               4               1.211       0 (none)
>       0     673    9906           3               3               1.211       0 (none)
>       0     677    9907           2               2               3.669       0 (none)
>       0     679    9908           1               1               3.669       0 (none)
>       0     681    9909           1               1               3.669       0 (none)
>       0     684    9910           0               0               0.000       0 (none)
>       0     688    9911           0               0               0.000       0 (none)
>
> Flags key:
>
>    B = BUSY
>    C = CLOSING
>    R = RESERVED
>    S = SHUTDOWN PENDING
>    P = PLACEHOLDER
>
>
> - --
> Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
> sip:sudakov at sibptus.tomsk.ru
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1
>
> iQEcBAEBAgAGBQJUSOlbAAoJEA2k8lmbXsY0r7AIAJhEAcUYajdnLa+geOlMblaG
> 8w+EyzWX6H+Sg1qaevBi28rB16qo0aAez4SY+GvTtle3qUnGdU3xpMxOKz+F4LV9
> 8Rz47bV4XfTyB8o4YF7ukFE9u/1CGQP+wk9FKGWZwpANiaE633PyMnEG0ftJYo1i
> dK96bCBMhNjArbwqKGgR1SQgO7KfJhVYspLs8700d/sgV2d8xx7FXoxICLhyG6Xz
> N+yUETFn6el6CUFnM+YGKBXylfzp56KQg92pP/TNYZ9cj7vH4vKDsexmq3VrACTn
> FsF7cz3vQWMaBrsTSLExFzcSm2Gri5WewjeMR9HBzxNBCw24VvbSn0CL7e5sbRw=
> =0Hh1
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From emz at norma.perm.ru  Thu Oct 23 12:51:28 2014
From: emz at norma.perm.ru (Eugene M. Zheganin)
Date: Thu, 23 Oct 2014 18:51:28 +0600
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <CAHsHsyuHJwb95kCSoh-uJ4MnNM5jrTxHCMxOstGXcQExud-LjQ@mail.gmail.com>
References: <5440A9C0.3030503@norma.perm.ru>
 <20141018101116.GA77970@admin.sibptus.tomsk.ru> <5442B403.3070306@zhegan.in>
 <20141019073258.GA91627@admin.sibptus.tomsk.ru>
 <54444049.1010904@ngtech.co.il>
 <20141023045332.GA23654@admin.sibptus.tomsk.ru>
 <54488C17.9010207@treenet.co.nz>
 <20141023051937.GB23654@admin.sibptus.tomsk.ru>
 <20141023062717.GA26140@admin.sibptus.tomsk.ru>
 <5448D754.2040000@treenet.co.nz>
 <20141023114116.GA28981@admin.sibptus.tomsk.ru>
 <CAHsHsyuHJwb95kCSoh-uJ4MnNM5jrTxHCMxOstGXcQExud-LjQ@mail.gmail.com>
Message-ID: <5448F9D0.4020609@norma.perm.ru>

Hi.

On 23.10.2014 18:13, Carlos Defoe wrote:
> I had this kind of 100% CPU problem with auth helpers when upgrading
> to squid 3.4. I use negotiate_wrapper, kerberos, ntlm and basic auth.
> Then I had to fall back to 3.3 and it is production until now, with
> some troubles with broken clients, but with normal cpu usage most of
> the time.
> Can you try with squid 3.3 and see if that version don't have the same
problem?
>

Carlos, are you, by any chance, using FreeBSD too ?

Eugene.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141023/2ae4c1a2/attachment.htm>

From frechdesign at gmail.com  Thu Oct 23 13:04:25 2014
From: frechdesign at gmail.com (Yassin CHOUCHANE)
Date: Thu, 23 Oct 2014 15:04:25 +0200
Subject: [squid-users]
	=?utf-8?q?Probl=C3=A9me_Squid_to_Java_application?=
In-Reply-To: <5447F4BC.3030208@ngtech.co.il>
References: <CAASYH3w7txNACjypOS5huGNi=f6heTufgp4EQRnVBv-RFsPP8A@mail.gmail.com>
 <54477BDC.8040308@ngtech.co.il> <544797D6.4070907@treenet.co.nz>
 <5447F4BC.3030208@ngtech.co.il>
Message-ID: <CAASYH3wb_WtdOr86EXvoO6UwYN2B6iviYwuKZdq1dL0C-YOetg@mail.gmail.com>

ok thanks that's works :)
this my squid.Conf


# ACL Definitions
#
acl noauth dstdomain "/etc/squid3/conf.d/noauth" # website not use proxy
acl auth proxy_auth REQUIRED
include /etc/squid3/conf.d/std_acl_definitions.conf
include /etc/squid3/conf.d/my_acl_definitions.conf

#
# Caching Options
#
include /etc/squid3/conf.d/my_cache.conf

#
# http_access Rules
#

http_access allow noauth
http_access deny !auth
http_access allow auth

include /etc/squid3/conf.d/std_access.conf
include /etc/squid3/conf.d/my_access.conf
http_access deny all


cool :)


2014-10-22 20:17 GMT+02:00 Eliezer Croitoru <eliezer at ngtech.co.il>:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 10/22/2014 02:41 PM, Amos Jeffries wrote:
>> That is a 407 status code. The proxy is configured to require
>> authentication.
>>
> Right Right.. Sorry for missing it.
> Then a specific acl that will allow all lan users access to this
> domain for without the need for authentication will solve the issue.
> It depends on your http_access rules order.
>
> Eliezer
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1
>
> iQEcBAEBAgAGBQJUR/S8AAoJENxnfXtQ8ZQUPloH/A6DHetK2Dmy9EedNhFU8bKw
> 2vJiN06Jzb7jNADZZTOWeGXCBNyRq5lkSCjlI/JrCaGkq1jhF3YQAWisugKQgdDO
> hoWReEzBsJ37ToMTasY1A8+dlah3suPWNAP6mg0IoLe7ZS0tMnJJ9Wd0h7YTBVFA
> afCwTSQvJu5MbD5yxp9XVVzYwOEAYi0MpURK3LxJjm1PZitYcZeU7AwnnjanJeIh
> K9GiFzZwOorbrE/D/W3ejQ5mAFUR9/zi49SvM+fyEl1WSSIEiPHZca32vxFUiUIK
> lp5D1lPXG8ZZeqzom/MTgkNw3iLCvZ2rO11aO03Uce7DFqThZP9bGBJctMEcD2M=
> =DhW0
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From frechdesign at gmail.com  Thu Oct 23 13:10:04 2014
From: frechdesign at gmail.com (Yassin CHOUCHANE)
Date: Thu, 23 Oct 2014 15:10:04 +0200
Subject: [squid-users] Server Failure: The name server was unable to process
	this query.
Message-ID: <CAASYH3wymAud3aSPtwP=SWbEFOFToBcLLHhXVnkdGiM_22rR7Q@mail.gmail.com>

Hello,

ok now i have a dns issue for my intranet serveur.

so an my squid serveur with dnslookup the serveur is found :

root [~] > nslookup cafeServer
Server:         192.168.1.3
Address:        192.168.1.3#53

Name:   cafeServer.sonsofanarchy.fr
Address: 192.168.1.50


but when i lunch it on my webrowser i have the message
Server Failure: The name server was unable to process this query.

and on the log :
1414069554.906      0 192.168.1.8 TCP_DENIED/407 3890 GET
http://cafeServer/ - HIER_NONE/- text/html
1414069559.929   5021 192.168.1.8 TCP_MISS/503 6847 GET
http://cafeServer/ jteller at SONSOFANARCHY.FR HIER_NONE/- text/html


and if on my webbrowser i connet on my intranet with
http://192.168.1.50 that's work but with the dns name
http://cafeServer not working

what do u think please ?


From carlosdefoe at gmail.com  Thu Oct 23 13:16:43 2014
From: carlosdefoe at gmail.com (Carlos Defoe)
Date: Thu, 23 Oct 2014 10:16:43 -0300
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <5448F9D0.4020609@norma.perm.ru>
References: <5440A9C0.3030503@norma.perm.ru>
 <20141018101116.GA77970@admin.sibptus.tomsk.ru>
 <5442B403.3070306@zhegan.in>
 <20141019073258.GA91627@admin.sibptus.tomsk.ru>
 <54444049.1010904@ngtech.co.il>
 <20141023045332.GA23654@admin.sibptus.tomsk.ru>
 <54488C17.9010207@treenet.co.nz>
 <20141023051937.GB23654@admin.sibptus.tomsk.ru>
 <20141023062717.GA26140@admin.sibptus.tomsk.ru>
 <5448D754.2040000@treenet.co.nz>
 <20141023114116.GA28981@admin.sibptus.tomsk.ru>
 <CAHsHsyuHJwb95kCSoh-uJ4MnNM5jrTxHCMxOstGXcQExud-LjQ@mail.gmail.com>
 <5448F9D0.4020609@norma.perm.ru>
Message-ID: <CAHsHsyvA9Z7YtqU1jCFDFcyTk9ykjUfBNuXh_P71_DYHURrRtQ@mail.gmail.com>

no, rhel 6

On Thu, Oct 23, 2014 at 9:51 AM, Eugene M. Zheganin <emz at norma.perm.ru> wrote:
> Hi.
>
> On 23.10.2014 18:13, Carlos Defoe wrote:
>> I had this kind of 100% CPU problem with auth helpers when upgrading
>> to squid 3.4. I use negotiate_wrapper, kerberos, ntlm and basic auth.
>> Then I had to fall back to 3.3 and it is production until now, with
>> some troubles with broken clients, but with normal cpu usage most of
>> the time.
>> Can you try with squid 3.3 and see if that version don't have the same
>> problem?
>>
>
> Carlos, are you, by any chance, using FreeBSD too ?
>
> Eugene.
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


From Andreas.Reschke at mahle.com  Thu Oct 23 13:21:56 2014
From: Andreas.Reschke at mahle.com (Andreas.Reschke at mahle.com)
Date: Thu, 23 Oct 2014 15:21:56 +0200
Subject: [squid-users] OT: Re: 3.3.x -> 3.4.x: huge performance regression
In-Reply-To: <5448C7FB.1080104@ngtech.co.il>
References: <5448C7FB.1080104@ngtech.co.il>, <5447486B.3010205@norma.perm.ru>
Message-ID: <OFEC027C06.1E6F37F2-ONC1257D7A.00496B8B-C1257D7A.00496B93@mahle.com>

An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141023/f8494000/attachment.htm>

From gecom at tubosider.it  Thu Oct 23 13:32:27 2014
From: gecom at tubosider.it (masterx81)
Date: Thu, 23 Oct 2014 06:32:27 -0700 (PDT)
Subject: [squid-users] 3.3.x -> 3.4.x: huge performance regression
In-Reply-To: <5447486B.3010205@norma.perm.ru>
References: <5447486B.3010205@norma.perm.ru>
Message-ID: <1414071147514-4668036.post@n4.nabble.com>

Same here, i'm waiting the right time to go to the customer and try the debug
suggested by Amos Jeffries on 3.4.x codes to help to find where is the
performance issue.



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/3-3-x-3-4-x-huge-performance-regression-tp4668003p4668036.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From natxo.asenjo at gmail.com  Thu Oct 23 17:41:01 2014
From: natxo.asenjo at gmail.com (Natxo Asenjo)
Date: Thu, 23 Oct 2014 19:41:01 +0200
Subject: [squid-users] Server Failure: The name server was unable to
 process this query.
In-Reply-To: <CAASYH3wymAud3aSPtwP=SWbEFOFToBcLLHhXVnkdGiM_22rR7Q@mail.gmail.com>
References: <CAASYH3wymAud3aSPtwP=SWbEFOFToBcLLHhXVnkdGiM_22rR7Q@mail.gmail.com>
Message-ID: <CAHBEJzVQ_PNjgVw3AOmGeYkojTRRbKgqb3nWBMTkXoZFAOHq-Q@mail.gmail.com>

On Thu, Oct 23, 2014 at 3:10 PM, Yassin CHOUCHANE <frechdesign at gmail.com> wrote:
> root [~] > nslookup cafeServer
> Server:         192.168.1.3
> Address:        192.168.1.3#53
>
> Name:   cafeServer.sonsofanarchy.fr
> Address: 192.168.1.50
>
>
> but when i lunch it on my webrowser i have the message
> Server Failure: The name server was unable to process this query.

we solved this on the clients disabling local addresses . In firefox
you add <local> to your exception list, in IE you check the box for
local addresses.


--
Groeten,
natxo


From squid3 at treenet.co.nz  Thu Oct 23 20:42:08 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 24 Oct 2014 09:42:08 +1300
Subject: [squid-users] Server Failure: The name server was unable to
 process this query.
In-Reply-To: <CAHBEJzVQ_PNjgVw3AOmGeYkojTRRbKgqb3nWBMTkXoZFAOHq-Q@mail.gmail.com>
References: <CAASYH3wymAud3aSPtwP=SWbEFOFToBcLLHhXVnkdGiM_22rR7Q@mail.gmail.com>
 <CAHBEJzVQ_PNjgVw3AOmGeYkojTRRbKgqb3nWBMTkXoZFAOHq-Q@mail.gmail.com>
Message-ID: <54496820.5080704@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 24/10/2014 6:41 a.m., Natxo Asenjo wrote:
> On Thu, Oct 23, 2014 at 3:10 PM, Yassin CHOUCHANE wrote:
>> root [~] > nslookup cafeServer Server:         192.168.1.3 
>> Address:        192.168.1.3#53
>> 
>> Name:   cafeServer.sonsofanarchy.fr Address: 192.168.1.50
>> 
>> 
>> but when i lunch it on my webrowser i have the message Server
>> Failure: The name server was unable to process this query.
> 
> we solved this on the clients disabling local addresses . In
> firefox you add <local> to your exception list, in IE you check the
> box for local addresses.
> 

For the record that is not a "address" it is a name in particular it
is a firstname.

The problem is that your browser contacted the proxy and said the
equivalent of "Deliver this to Bob" instead of "Deliver this to Bob
who can be found at example.com". How many "Bob" are there on the
Internet?


FYI: There are a set of requirements that are mandatory for all
Internet connected machinery. One of them is using FQDN when
referencing other machinery if it can in any way be confused with a
public name. Bare hostname like that do encounter problems such as you
just did, and also problems accessing domains like http://com/ - which
is/was a real public-Internet fully qualified domain name for Verisign.

What you should be doing for best compatibility is using the domain
".local" for internal communications. The current releases of Squid
also support mDNS:
 http://www.squid-cache.org/Doc/config/dns_multicast_local/


You can still enable the ** 1970 - 1990 ** era networking behaviour
with this configuration option:
 http://www.squid-cache.org/Doc/config/dns_defnames/

And configuring the "search" or "domain" options in /etc/resolv.conf.

Note that it will make Squid assume that any requested name with
insufficient '.' in the name resolves locally. This has potential to
allow external access to internal client machines unless you are
careful to restrict with ACLswhere traffic can come from and go to.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUSWgfAAoJELJo5wb/XPRjXJ4H/296zuBcvvI3zQmF+fWI7/DI
slNFrkH1cAWFJgBTSmG9vcEWlyX/MSSHphETnPFuU6VMbJF6wjTRoasMhvu9D/Kh
h44iFcWFQxgg4Mux/bdR2/hiVz7a1GipcxH3NRahNHZN2G0cD/6NLmY9hJZ+kKwd
Pp25ev0iHIxMk2XohK5StbaOckS004xQ6cgxwbUHcW8IUlta3AZZjEPy3Ra2zHG6
6hWySx/cqO2E2wUjcnd/p0jdthzdTbPhkc0c7TdZBB0KfyYAfv/k5qdbfcP0GhHm
CpDzofVgPAd3q4GISZ3G71nM8Gx6a4i1hSyIiZ2pY/87rJIJMLiqIzeezYQEuK4=
=Trvm
-----END PGP SIGNATURE-----


From J.Xu at uws.edu.au  Fri Oct 24 00:41:27 2014
From: J.Xu at uws.edu.au (Julie Xu)
Date: Fri, 24 Oct 2014 00:41:27 +0000
Subject: [squid-users] problem with squid_ldap_auth
Message-ID: <ABCD499AC5326B4F828DBB3933CFE87E71087FBD@HIRT.AD.UWS.EDU.AU>

Hi

I have squid installed and trying to contact Ldap.

Below command is working for older squid, but not new one and both server are Redhat 6.5 (Santiago)

auth_param basic program /usr/lib64/squid/squid_ldap_auth -b ou=xx,dc=xx,dc=xx,dc=xx,dc=xx -f (&(cn=%s)(objectClass=*)) -u cn -s sub -P -c 5 -t 5 -R -a never -D cn=Lookup,ou=xx,dc=xx,dc=xx,dc=xx,dc=xx -w xxxxx mydomain


error message is:

squid_ldap_auth: WARNING, could not bind to binddn 'Can't contact LDAP server'
squid_ldap_auth: WARNING, could not bind to binddn 'Can't contact LDAP server'
squid_ldap_auth: WARNING, could not bind to binddn 'Can't contact LDAP server'

to stop type isse, I have scp the squid.conf from older one to new one? And restart the squid; and also tried to copy firewall configuration over to new box, in case some firewall issue. It is still not help.

Could any one advice me what is the possible issue related?

Any comments will be appreciated

Thanks in advance

Julie

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141024/ce5dfdb4/attachment.htm>

From ahmed.zaeem at netstream.ps  Fri Oct 24 13:09:51 2014
From: ahmed.zaeem at netstream.ps (Ahmed Allzaeem)
Date: Fri, 24 Oct 2014 06:09:51 -0700
Subject: [squid-users] Large rock supporting with stable squid version
Message-ID: <003001cfef8b$cd028220$67078660$@netstream.ps>

Hi

I want to ask about Large rock supporting.

In large rock supporting wts the max size for disk store ? and max size of
ram store? 

 

I need someone tried large rock with squid 3.head version and have seen a
stability , I used last time squid3.head but it hanged after sometime

 

I need  a help with a squid large rock  best practice.

 

 

Wish to help

Regards

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141024/f9448a66/attachment.htm>

From squid at visolve.com  Fri Oct 24 04:54:10 2014
From: squid at visolve.com (squid-list)
Date: Fri, 24 Oct 2014 10:24:10 +0530
Subject: [squid-users] problem with squid_ldap_auth
In-Reply-To: <ABCD499AC5326B4F828DBB3933CFE87E71087FBD@HIRT.AD.UWS.EDU.AU>
References: <ABCD499AC5326B4F828DBB3933CFE87E71087FBD@HIRT.AD.UWS.EDU.AU>
Message-ID: <5449DB72.60609@visolve.com>

Hi,

I think the error is not with squid version, it might be the connection 
problem between proxy server and  LDAP server. Please, check the 
reachability of LDAP server from the proxy server and also Just check 
the DNS configuration whether you have correctly configured it in proxy 
server.

First, You can try the test connection to the LDAP sever from the 
terminal, if it succeed then you can modify the squid configuration. I 
have given a sample one, modify the domain and credentials according to 
your one and try.

         [root at test ~] #  /usr/lib64/squid/squid_ldap_auth -R -b 
"dc=test,dc=com" -D "CN=admin,DC=test,DC=com" -w "password" -f 
sAMAccountName=%s  -h 192.168.195.195
         username password
         OK

If you get the output "OK", then you have successfully tested the 
connection with the LDAP server. If you cannot establish the connection 
with LDAP server, then you will get the same error.

         [root at test ~] #  /usr/lib64/squid/squid_ldap_auth -R -b 
"dc=test,dc=com" -D "CN=admin,DC=test,DC=com" -w "password" -f 
sAMAccountName=%s  -h 192.168.195.195
         username password
         squid_ldap_auth: WARNING, could not bind to binddn 'Can't 
contact LDAP server'

Regards,
ViSolve Squid

On 10/24/2014 06:11 AM, Julie Xu wrote:
>
> Hi
>
> I have squid installed and trying to contact Ldap.
>
> Below command is working for older squid, but not new one and both 
> server are Redhat 6.5 (Santiago)
>
> auth_param basic program /usr/lib64/squid/squid_ldap_auth -b 
> ou=xx,dc=xx,dc=xx,dc=xx,dc=xx -f (&(cn=%s)(objectClass=*)) -u cn -s 
> sub -P -c 5 -t 5 -R -a never -D 
> cn=Lookup,ou=xx,dc=xx,dc=xx,dc=xx,dc=xx -w xxxxx mydomain
>
> error message is:
>
> squid_ldap_auth: WARNING, could not bind to binddn 'Can't contact LDAP 
> server'
>
> squid_ldap_auth: WARNING, could not bind to binddn 'Can't contact LDAP 
> server'
>
> squid_ldap_auth: WARNING, could not bind to binddn 'Can't contact LDAP 
> server'
>
> to stop type isse, I have scp the squid.conf from older one to new 
> one? And restart the squid; and also tried to copy firewall 
> configuration over to new box, in case some firewall issue. It is 
> still not help.
>
> Could any one advice me what is the possible issue related?
>
> Any comments will be appreciated
>
> Thanks in advance
>
> Julie
>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141024/95c9fb72/attachment.htm>

From sudakov at sibptus.tomsk.ru  Fri Oct 24 08:52:56 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Fri, 24 Oct 2014 15:52:56 +0700
Subject: [squid-users] Squid,
 Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and
 3.4.7.)
In-Reply-To: <CAHsHsyuHJwb95kCSoh-uJ4MnNM5jrTxHCMxOstGXcQExud-LjQ@mail.gmail.com>
References: <5442B403.3070306@zhegan.in>
 <20141019073258.GA91627@admin.sibptus.tomsk.ru>
 <54444049.1010904@ngtech.co.il>
 <20141023045332.GA23654@admin.sibptus.tomsk.ru>
 <54488C17.9010207@treenet.co.nz>
 <20141023051937.GB23654@admin.sibptus.tomsk.ru>
 <20141023062717.GA26140@admin.sibptus.tomsk.ru>
 <5448D754.2040000@treenet.co.nz>
 <20141023114116.GA28981@admin.sibptus.tomsk.ru>
 <CAHsHsyuHJwb95kCSoh-uJ4MnNM5jrTxHCMxOstGXcQExud-LjQ@mail.gmail.com>
Message-ID: <20141024085256.GA43380@admin.sibptus.tomsk.ru>

Carlos Defoe wrote:
> I had this kind of 100% CPU problem with auth helpers when upgrading
> to squid 3.4. I use negotiate_wrapper, kerberos, ntlm and basic auth.
> Then I had to fall back to 3.3 and it is production until now, with
> some troubles with broken clients, but with normal cpu usage most of
> the time.
> Can you try with squid 3.3 and see if that version don't have the same problem?

Carlos,

After downgrading to squid33-3.3.13_2 I have not received a single
complaint either from the users or from my monitoring system, and
squid's WCPU is about maybe 20% during office hours, briefly rising to
70% or so.

Thanks for the advice. 

Something nasty seems to have happened between 3.3 and 3.4.

Eliezer Croitoru wrote:
> Victor two things:
> - - you should consider that one cpu is not enough to operate a loaded
> proxy with auth.
> - - squid and the helpers needs CPU...
> - - 200 users can require a lot of resources which for you seems like
> nothing but from computing point of view it's something else.
> - - about the number of negotiate children.. it depends if you use
> concurrency or not and also in the number of requests per second.

Eliezer,

How come that the same load is tolerated by squid33 and not tolerated
by squid34? 

I'll see however, perhaps there will be a different usage pattern on
Monday and squid33 will choke too. I'll report.


-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru


From markus.rietzler at fv.nrw.de  Fri Oct 24 11:17:24 2014
From: markus.rietzler at fv.nrw.de (Rietzler, Markus (RZF, SG 324 / <RIETZLER_SOFTWARE>))
Date: Fri, 24 Oct 2014 11:17:24 +0000
Subject: [squid-users] 3.3.x -> 3.4.x: huge performance regression
In-Reply-To: <5448C7FB.1080104@ngtech.co.il>
References: <5447486B.3010205@norma.perm.ru> <5448C7FB.1080104@ngtech.co.il>
Message-ID: <1FCF9DA5B29068478ECF15896F19F0840138A509A8@Y011008.bk.fin.local>

the important keyword is "NTLM"! 
without external auth helper squid 3.4 is working well. as soon as the external helper is active, cpu rises to 100%. nothing with workers etc.
even the fakehelper is not working. just to make sure, that the problem is not NTLM, samba, winbind, AD etc.

see http://bugs.squid-cache.org/show_bug.cgi?id=3997



> -----Urspr?ngliche Nachricht-----
> Von: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] Im
> Auftrag von Eliezer Croitoru
> Gesendet: Donnerstag, 23. Oktober 2014 11:19
> An: squid-users at lists.squid-cache.org
> Betreff: Re: [squid-users] 3.3.x -> 3.4.x: huge performance regression
> 
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> Hey,
> 
> What is the network load? how many users?
> Have you been using workers at all in the past?
> Can you see the avg requests per second on the cache manager page?
> 
> Eliezer
> 
> On 10/22/2014 09:02 AM, Eugene M. Zheganin wrote:
> > Hi.
> >
> > I was using the 3.4.x branch for quite some time, it was working
> > just fine on small installations. Yesterday I upgraded my largest
> > cache installation from 3.3.13 to 3.4.8 (same config, diskd,
> > NTLM/GSS-SPNEGO auth helpers, external helpers). Today morning I
> > noticed that squid is spiking to 100% of CPU and almost isn't
> > serving any traffic. Restart didn't help, squid is serving pages
> > while continuing to consume CPU, load grows, until it's at 100%,
> > and after some time my users are unable to open any page from
> > Internet. This is sad, so I downgraded to 3.3.13. CPU consumption
> > went back to 20-35% and everything is back to normal.
> >
> > In order to understand what's happening I did some dtrace profiling
> > to see what is squid busy with, taking the consideration, that
> > measuring the same amount of connect()/socket() syscalls should
> > give same amount of squid work, but the results were totally
> > different on one number of such syscalls.
> >
> > Anyone to comment ?
> >
> > Thanks. Eugene. _______________________________________________
> > squid-users mailing list squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
> >
> 
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1
> 
> iQEcBAEBAgAGBQJUSMf7AAoJENxnfXtQ8ZQU/KwH/icRcMBoEA4Y8u3/inbnvSiT
> CMPX6On9CO+RJeXlDGcAMfbYofZixB8zR5BuBTOsNS35moqCtHmlzZYtoGxkLGLx
> RU6KKEhLGuGNyFCnyQx/oh9hcG90PSnaFnsp0m3vClcFtxv3kcdn944VS8hPtKWC
> MQw7G8KzXwu7RmTaP5nk+EGNX3JAn8GlQaINX6G4zKeujqwrK954KORPMt0S53iQ
> P7k6rq+ckPDgTIHuK4L+eMCka22y0z2FTo41jxSXK7J6w3GnWUsvwA22yYo6BV1h
> +4DjvvtoJA3nNuFtXYxXCcBLMXcwk953o2uQKGkqOmlLGg660Bu9tCTBFAvaQsg=
> =79iu
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

From ahmed.zaeem at netstream.ps  Fri Oct 24 22:11:31 2014
From: ahmed.zaeem at netstream.ps (Ahmed Allzaeem)
Date: Fri, 24 Oct 2014 15:11:31 -0700
Subject: [squid-users] squid ipv6 tcp_outgoing limitation ??
Message-ID: <003f01cfefd7$7c78eaa0$756abfe0$@netstream.ps>

Hi ,

Recently I used squid 3.4.3 for ipv6 for tcp_outgoing for many ipv6
addresses based on the username.

 

 

I added about 1000 users with 1000 tcp_outgoing address but it didn't work
..it always uses the last line in squid.conf with tcp_outgoing directive !!

 

Does squid has limitation in ipv6 ?

 

The question is 

 

Is it squid issue ?

Networking issue ?

Kernel issue ?

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141024/a609515e/attachment.htm>

From emz at norma.perm.ru  Fri Oct 24 12:18:24 2014
From: emz at norma.perm.ru (Eugene M. Zheganin)
Date: Fri, 24 Oct 2014 18:18:24 +0600
Subject: [squid-users] 3.3.x -> 3.4.x: huge performance regression
In-Reply-To: <1FCF9DA5B29068478ECF15896F19F0840138A509A8@Y011008.bk.fin.local>
References: <5447486B.3010205@norma.perm.ru> <5448C7FB.1080104@ngtech.co.il>
 <1FCF9DA5B29068478ECF15896F19F0840138A509A8@Y011008.bk.fin.local>
Message-ID: <544A4390.3090903@norma.perm.ru>

Hi.

On 24.10.2014 17:17, Rietzler, Markus (RZF, SG 324 /
<RIETZLER_SOFTWARE>) wrote:
> the important keyword is "NTLM"! 
> without external auth helper squid 3.4 is working well. as soon as the external helper is active, cpu rises to 100%. nothing with workers etc.
> even the fakehelper is not working. just to make sure, that the problem is not NTLM, samba, winbind, AD etc.
>
> see http://bugs.squid-cache.org/show_bug.cgi?id=3997
There seems to be a large mix of terms, like "external helper" and
"external program". The ntlm_auth, which is external to squid and part
of the samba package, doesnt' change between version uprgrades, so I
don't see how it can be involved (and why replace it with a fake helper
?). In the same time it's an authentication helper. The squid_kerb_ldap,
also known as ext_kerberos_ldap_group_acl, is, indeed, an "external acl"
helper, but it has nothing to do with NTLM, as it doesn't use it. My
opinion - this pr is flooded with error messages of almost any kind, and
it's very hard to see the point.

We need to understand what's happening to squid when it starts to hit
the 100% CPU usage, last time I saw this during the night without any
possible user traffic load.

Eugene.


From eliezer at ngtech.co.il  Fri Oct 24 12:49:25 2014
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Fri, 24 Oct 2014 15:49:25 +0300
Subject: [squid-users] 3.3.x -> 3.4.x: huge performance regression
In-Reply-To: <544A4390.3090903@norma.perm.ru>
References: <5447486B.3010205@norma.perm.ru> <5448C7FB.1080104@ngtech.co.il>
 <1FCF9DA5B29068478ECF15896F19F0840138A509A8@Y011008.bk.fin.local>
 <544A4390.3090903@norma.perm.ru>
Message-ID: <544A4AD5.6040804@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hey Eugene,

I will try to clear things out.
Any helper is an external software but each and every one of them
answers to a specific logic.
external_acl url_rewrite and store_id helpers works in one way while
authentication works in another.

To make the story short external_acl url_rewrite and store_id helpers
acquire a single line from squid via STDIN and responses to his own
STDOUT towards squid STDIN.
an example would be:
1 http://www.yahoo.com "more things such as requester and others"

The helper responses to this with a line such as:
1 ERR
or
1 OK "more stuff"

The above example applies only to squid 3.4 while in squid 3.3 this is
being used only on the external_acl interface.

In auth helpers there are couple "stages" that applies on each requests.
In external_acl and the similar interfaces the client do not need to
send any details for the helper to analyze else then these that exists
on each request.
Auth helpers has a logic that denies with request for more details.
NTLM specifically has overload on the whole process since it can have
3 stages against squid.
Kerberous has the benefit of only 2 stages against squid:
1 - request -> denial
2 - request + credentials -> denial or approval

Comparing NTLM to external_acl helpers it is very different.
But comparing Kerberous to external_acl it's almost similar.

If for example NTML + Kerberous + external_acl + others suffers from
the same issue while using only one of them at a time it will prove
that there is a specific direction to the issue.
But if Kerberous and NTLM differ it will prove that there are other
things in hand.

Another approach to test the issue is to write an ECAP or ICAP helper
that will implement the whole authentication logic.
This will also prove that the helpers code is broken in 3.4 compared
to 3.3.

There is also the comparison of basic authentication compared to NTLM
+ Keberous which is also important.

The squid team needs a testing environment for the issue for quite
some time.

Now that Victor Sudakov has used Kerberous instead of NTLM we might be
able to put some efforts and to pinpoint the issue.

All The Bests,
Eliezer

On 10/24/2014 03:18 PM, Eugene M. Zheganin wrote:
>> see http://bugs.squid-cache.org/show_bug.cgi?id=3997
> There seems to be a large mix of terms, like "external helper" and 
> "external program". The ntlm_auth, which is external to squid and
> part of the samba package, doesnt' change between version
> uprgrades, so I don't see how it can be involved (and why replace
> it with a fake helper ?). In the same time it's an authentication
> helper. The squid_kerb_ldap, also known as
> ext_kerberos_ldap_group_acl, is, indeed, an "external acl" helper,
> but it has nothing to do with NTLM, as it doesn't use it. My 
> opinion - this pr is flooded with error messages of almost any
> kind, and it's very hard to see the point.
> 
> We need to understand what's happening to squid when it starts to
> hit the 100% CPU usage, last time I saw this during the night
> without any possible user traffic load.
> 
> Eugene.

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUSkrVAAoJENxnfXtQ8ZQUp8UIAI2MUcnASF98RWQECoKFczS9
E7SWOZMjQQLIy80NAId9MdiZ79XPNTF6a1VaGcdP4cAc78XgNqk6NdBF0eFIKSgy
31W48GGt8p0spJ0o8+NVijV9O/2pGcIW8M3psbnYG/fcgAzWq4DLz9Q/tFTtHsIa
UzY56BMuSX1+0d2IeZSO2bXxEnOyiyAJKrQ96H/7tlg/9VV5mHOB7Py1b6G+O1YP
nU/+vj4GppHYOYwPdqX9MwKfXwHzFPLHGXdafIJT1/Ci1ApEWW+137PMrvG1uvg3
pzSF9amhAyBpAjIA1WRgoYb5gtUciK43K0EIXYkmZnmmuw3mEFOv4WWyDApFBgs=
=TLyW
-----END PGP SIGNATURE-----


From palobo at gmail.com  Fri Oct 24 22:26:48 2014
From: palobo at gmail.com (Pedro Lobo)
Date: Fri, 24 Oct 2014 23:26:48 +0100
Subject: [squid-users] Kerberos Authentication Failing for Windows 7+ with
 BH gss_accept_sec_context() failed
Message-ID: <40E1E0E7-50C6-4117-94AA-50B06573430A@gmail.com>

Hi Squid Gurus,

I'm at my wit's end and in dire need of some squid expertise.

We've got a production environment with a couple of squid 2.7 servers 
using NTLM and basic authentication. Recently though, we decided to 
upgrade and I'm now setting up squid 3.3 with Kerberos and NTLM 
Fallback. I've followed just about every guide I could find and in my 
testing environment, things were working great. Now that I've hooked it 
up to the main domain, things are awry.


If I use a machine that's not part of the domain, NTLM kicks in and I 
can surf the web fine. If I use a Windows XP or Windows Server 2003, 
kerberos works just fine, however, if I use a machine Windows 7, 8 or 
2008 server, I keep getting a popup asking me to authenticate and even 
then, it's and endless loop until it fails. My cache.log is littered 
with:

     negotiate_kerberos_auth.cc(200): pid=1607 :2014/10/24 23:03:01| 
negotiate_kerberos_auth: ERROR: gss_accept_sec_context() failed: 
Unspecified GSS failure.  Minor code may provide more information.
	2014/10/24 23:03:01| ERROR: Negotiate Authentication validating user. 
Error returned 'BH gss_accept_sec_context() failed: Unspecified GSS 
failure.  Minor code may provide more information. '

The odd thing, is that this has worked before. Help me Obi Wan... You're 
my only hope! :)


**Current Setup**
Squid 3.3 running on Ubuntu 14.04 server. It's connected to a 2003 
server with function level 2000 (I know, we're trying to fase out the 
older servers).

**krb5.conf**

  	[libdefaults]
             default_realm = FAKE.NET
             dns_lookup_kdc = yes
             dns_lookup_realm = yes
             ticket_lifetime = 24h
             default_keytab_name = /etc/squid3/PROXY.keytab

     ; for Windows 2003
             default_tgs_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
             default_tkt_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
             permitted_enctypes = rc4-hmac des-cbc-crc des-cbc-md5

     [realms]
             FAKE.NET = {
                     kdc = srv01.fake.net
                     kdc = srv02.fake.net
                     kdc = srv03.fake.net
                     admin_server = srv01.fake.net
                     default_domain = fake.net
             }

     [domain_realm]
             .fake.net = FAKE.NET
             fake.net = FAKE.NET


     [logging]
       kdc = FILE:/var/log/kdc.log
       admin_server = FILE:/var/log/kadmin.log
       default = FILE:/var/log/krb5lib.log


**squid.conf**

	auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d 
-r -s HTTP/proxy01tst.fake.net
	auth_param negotiate children 20 startup=0 idle=1
	auth_param negotiate keep_alive off

	auth_param ntlm program /usr/bin/ntlm_auth --diagnostics 
--helper-protocol=squid-2.5-ntlmssp --domain=FAKE.NET
	auth_param ntlm children 10
	auth_param ntlm keep_alive off


Cheers,
Pedro

Cumprimentos
Pedro Lobo
Solutions Architect | System Engineer

pedro.lobo at pt.clara.net
Tlm.: +351 939 528 827 | Tel.: +351 214 127 314

Claranet Portugal
Ed. Parque Expo
Av. D. Jo?o II, 1.07-2.1, 4? Piso
1998-014 Lisboa
www.claranet.pt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141024/38421f18/attachment.htm>

From diego at woitasen.com.ar  Fri Oct 24 23:01:03 2014
From: diego at woitasen.com.ar (Diego Woitasen)
Date: Fri, 24 Oct 2014 20:01:03 -0300
Subject: [squid-users] squid 3.4. uses 100% cpu with ntlm_auth
In-Reply-To: <OF99973CD0.6667CF1E-ONC1257D6C.00324526-C1257D6C.0032452B@mahle.com>
References: <1FCF9DA5B29068478ECF15896F19F084FFDC4CEA@Y011007.bk.fin.local>
 <1412264045523-4667634.post@n4.nabble.com>
 <1412349508959-4667645.post@n4.nabble.com>
 <OF99973CD0.6667CF1E-ONC1257D6C.00324526-C1257D6C.0032452B@mahle.com>
Message-ID: <CAA7UhckNhgSXhAK+rFK=eEyaBzDPP246vytBh9QrLrf+gqOSSQ@mail.gmail.com>

On Thu, Oct 9, 2014 at 6:09 AM,  <Andreas.Reschke at mahle.com> wrote:
> Hello masterx81 ,
>
> thanks for this information. I've downgraded my 5 server form 3.4.8 to
> 3.3.13 . Everything works fine. The server have less than the half load as
> before, so I can shutdown one server. Perhaps I can reduce on more server.
>
>
> Mit freundlichen Gr??en / Kind regards
>
> Mr. Andreas Reschke
>
> -----"squid-users" <squid-users-bounces at lists.squid-cache.org> schrieb:
> -----
> An: squid-users at lists.squid-cache.org
> Von: masterx81
> Gesendet von: "squid-users"
> Datum: 03.10.2014 17:19
> Betreff: Re: [squid-users] squid 3.4. uses 100% cpu with ntlm_auth
>
> I can confirm that on 3.3.13 all is working correctly, the cpu usage is
> really low.
>
>
>
> --
> View this message in context:
> http://squid-web-proxy-cache.1019090.n4.nabble.com/squid-3-4-uses-100-cpu-with-ntlm-auth-tp4664169p4667645.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>

Hi,
 Do we still have this issue? I'm experiencing it in 3.4.8.

Disabling NTLM to test.

Regards,
  Diego

-- 
Diego Woitasen
Infrastructure Developer, DevOps Engineer, Linux and Open Source expert
http://www.woitasen.com.ar


From huaraz at moeller.plus.com  Sat Oct 25 00:26:40 2014
From: huaraz at moeller.plus.com (Markus Moeller)
Date: Sat, 25 Oct 2014 01:26:40 +0100
Subject: [squid-users] Kerberos Authentication Failing for Windows 7+
	with BH gss_accept_sec_context() failed
In-Reply-To: <40E1E0E7-50C6-4117-94AA-50B06573430A@gmail.com>
References: <40E1E0E7-50C6-4117-94AA-50B06573430A@gmail.com>
Message-ID: <m2eqo7$cf9$1@ger.gmane.org>

Hi Pedro,

How did you create your keytab ?  What does klist ?ekt <squid.keytab> show ( I assume you use MIT Kerberos) ? 

Markus

"Pedro Lobo" <palobo at gmail.com> wrote in message news:40E1E0E7-50C6-4117-94AA-50B06573430A at gmail.com...
Hi Squid Gurus,

I'm at my wit's end and in dire need of some squid expertise.

We've got a production environment with a couple of squid 2.7 servers using NTLM and basic authentication. Recently though, we decided to upgrade and I'm now setting up squid 3.3 with Kerberos and NTLM Fallback. I've followed just about every guide I could find and in my testing environment, things were working great. Now that I've hooked it up to the main domain, things are awry.

If I use a machine that's not part of the domain, NTLM kicks in and I can surf the web fine. If I use a Windows XP or Windows Server 2003, kerberos works just fine, however, if I use a machine Windows 7, 8 or 2008 server, I keep getting a popup asking me to authenticate and even then, it's and endless loop until it fails. My cache.log is littered with:

negotiate_kerberos_auth.cc(200): pid=1607 :2014/10/24 23:03:01| negotiate_kerberos_auth: ERROR: gss_accept_sec_context() failed: Unspecified GSS failure.  Minor code may provide more information.
2014/10/24 23:03:01| ERROR: Negotiate Authentication validating user. Error returned 'BH gss_accept_sec_context() failed: Unspecified GSS failure.  Minor code may provide more information. '
The odd thing, is that this has worked before. Help me Obi Wan... You're my only hope! :)

Current Setup
Squid 3.3 running on Ubuntu 14.04 server. It's connected to a 2003 server with function level 2000 (I know, we're trying to fase out the older servers).

krb5.conf

 [libdefaults]
        default_realm = FAKE.NET
        dns_lookup_kdc = yes
        dns_lookup_realm = yes
        ticket_lifetime = 24h
        default_keytab_name = /etc/squid3/PROXY.keytab

; for Windows 2003
        default_tgs_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
        default_tkt_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
        permitted_enctypes = rc4-hmac des-cbc-crc des-cbc-md5

[realms]
        FAKE.NET = {
                kdc = srv01.fake.net
                kdc = srv02.fake.net
                kdc = srv03.fake.net
                admin_server = srv01.fake.net
                default_domain = fake.net
        }

[domain_realm]
        .fake.net = FAKE.NET
        fake.net = FAKE.NET


[logging]
  kdc = FILE:/var/log/kdc.log
  admin_server = FILE:/var/log/kadmin.log
  default = FILE:/var/log/krb5lib.log
squid.conf

auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s HTTP/proxy01tst.fake.net
auth_param negotiate children 20 startup=0 idle=1
auth_param negotiate keep_alive off

auth_param ntlm program /usr/bin/ntlm_auth --diagnostics --helper-protocol=squid-2.5-ntlmssp --domain=FAKE.NET
auth_param ntlm children 10
auth_param ntlm keep_alive off
Cheers,
Pedro

Cumprimentos 
Pedro Lobo 
Solutions Architect | System Engineer 

pedro.lobo at pt.clara.net 
Tlm.: +351 939 528 827 | Tel.: +351 214 127 314 

Claranet Portugal 
Ed. Parque Expo 
Av. D. Jo?o II, 1.07-2.1, 4? Piso 
1998-014 Lisboa 
www.claranet.pt 

              

 

Empresa certificada ISO 9001, ISO 20000 e ISO 27001 




--------------------------------------------------------------------------------
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141025/5ae2d652/attachment.htm>

From carlosdefoe at gmail.com  Sat Oct 25 02:00:18 2014
From: carlosdefoe at gmail.com (Carlos Defoe)
Date: Fri, 24 Oct 2014 23:00:18 -0300
Subject: [squid-users] Kerberos Authentication Failing for Windows 7+
 with BH gss_accept_sec_context() failed
In-Reply-To: <m2eqo7$cf9$1@ger.gmane.org>
References: <40E1E0E7-50C6-4117-94AA-50B06573430A@gmail.com>
 <m2eqo7$cf9$1@ger.gmane.org>
Message-ID: <CAHsHsyuDgaahurxRFys6HJ0OdPDo8QA8Xe6kaWCnXP5G2wAtqg@mail.gmail.com>

Windows 7 inside the domain?

Anyway, you should configure a basic auth scheme as a second fallback.



On Fri, Oct 24, 2014 at 9:26 PM, Markus Moeller <huaraz at moeller.plus.com>
wrote:

>   Hi Pedro,
>
> How did you create your keytab ?  What does klist ?ekt <squid.keytab> show
> ( I assume you use MIT Kerberos) ?
>
> Markus
>
>  "Pedro Lobo" <palobo at gmail.com> wrote in message
> news:40E1E0E7-50C6-4117-94AA-50B06573430A at gmail.com...
>
> Hi Squid Gurus,
>
> I'm at my wit's end and in dire need of some squid expertise.
>
> We've got a production environment with a couple of squid 2.7 servers
> using NTLM and basic authentication. Recently though, we decided to upgrade
> and I'm now setting up squid 3.3 with Kerberos and NTLM Fallback. I've
> followed just about every guide I could find and in my testing environment,
> things were working great. Now that I've hooked it up to the main domain,
> things are awry.
>
> If I use a machine that's not part of the domain, NTLM kicks in and I can
> surf the web fine. If I use a Windows XP or Windows Server 2003, kerberos
> works just fine, however, if I use a machine Windows 7, 8 or 2008 server, I
> keep getting a popup asking me to authenticate and even then, it's and
> endless loop until it fails. My cache.log is littered with:
>
> negotiate_kerberos_auth.cc(200): pid=1607 :2014/10/24 23:03:01| negotiate_kerberos_auth: ERROR: gss_accept_sec_context() failed: Unspecified GSS failure.  Minor code may provide more information.
> 2014/10/24 23:03:01| ERROR: Negotiate Authentication validating user. Error returned 'BH gss_accept_sec_context() failed: Unspecified GSS failure.  Minor code may provide more information. '
>
> The odd thing, is that this has worked before. Help me Obi Wan... You're
> my only hope! :)
>
> *Current Setup*
> Squid 3.3 running on Ubuntu 14.04 server. It's connected to a 2003 server
> with function level 2000 (I know, we're trying to fase out the older
> servers).
>
> *krb5.conf*
>
>  [libdefaults]
>         default_realm = FAKE.NET
>         dns_lookup_kdc = yes
>         dns_lookup_realm = yes
>         ticket_lifetime = 24h
>         default_keytab_name = /etc/squid3/PROXY.keytab
>
> ; for Windows 2003
>         default_tgs_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
>         default_tkt_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
>         permitted_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
>
> [realms]
>         FAKE.NET = {
>                 kdc = srv01.fake.net
>                 kdc = srv02.fake.net
>                 kdc = srv03.fake.net
>                 admin_server = srv01.fake.net
>                 default_domain = fake.net
>         }
>
> [domain_realm]
>         .fake.net = FAKE.NET
>         fake.net = FAKE.NET
>
>
> [logging]
>   kdc = FILE:/var/log/kdc.log
>   admin_server = FILE:/var/log/kadmin.log
>   default = FILE:/var/log/krb5lib.log
>
> *squid.conf*
>
> auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s HTTP/proxy01tst.fake.net
> auth_param negotiate children 20 startup=0 idle=1
> auth_param negotiate keep_alive off
>
> auth_param ntlm program /usr/bin/ntlm_auth --diagnostics --helper-protocol=squid-2.5-ntlmssp --domain=FAKE.NET
> auth_param ntlm children 10
> auth_param ntlm keep_alive off
>
> Cheers,
> Pedro
>
> Cumprimentos
> Pedro Lobo
> *Solutions Architect | System Engineer*
>
> pedro.lobo at pt.clara.net
> Tlm.: +351 939 528 827 | Tel.: +351 214 127 314
>
> Claranet Portugal
> Ed. Parque Expo
> Av. D. Jo?o II, 1.07-2.1, 4? Piso
> 1998-014 Lisboa
> www.claranet.pt
>   [image:
> http://www.claranet.co.uk/sites/claranet.co.uk/files/u3/claranet_logo.png]
> <http://www.claranet.pt/> [image:
> http://www.claranet.co.uk/sites/claranet.co.uk/files/u3/email-linkedin-icon.png]
> <http://www.linkedin.com/groups?home=&gid=3746436> [image:
> http://www.claranet.co.uk/sites/claranet.co.uk/files/u3/email-twitter-icon.png]
> <https://twitter.com/Claranet_PT> [image:
> http://www.claranet.co.uk/sites/claranet.co.uk/files/u3/email-youtube-icon.png]
> <http://www.youtube.com/user/ClaranetPT>
>
> [image: GARTNER BANNER]
> <http://www.claranet.pt/sites/claranet.pt/files/u6/magic_quadrant_for_cloudenab_260243.pdf>
>
> Empresa certificada ISO 9001, ISO 20000 e ISO 27001
>
>   ------------------------------
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141024/7d80a631/attachment.htm>

From auny87 at gmail.com  Sat Oct 25 06:27:27 2014
From: auny87 at gmail.com (Ahmed Talha Khan)
Date: Fri, 25 Oct 2014 06:27:27 +0000
Subject: [squid-users] =?iso-8859-1?q?FW=3Aferdinando_4?=
Message-ID: <E0E6FCC42F8EE5695F78E771C1A74F00@myblake.it>

http://despedidadesolteroplaya.com/pyckf/rjeqpleabckinekxxseuj.zyhpyvgwotquvgkuembcouxqgv 















 Ahmed Talha Khan 


 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141025/fb996033/attachment.htm>

From palobo at gmail.com  Sat Oct 25 09:36:40 2014
From: palobo at gmail.com (Pedro Lobo)
Date: Sat, 25 Oct 2014 10:36:40 +0100
Subject: [squid-users] Kerberos Authentication Failing for Windows 7+
 with BH gss_accept_sec_context() failed
In-Reply-To: <m2eqo7$cf9$1@ger.gmane.org>
References: <40E1E0E7-50C6-4117-94AA-50B06573430A@gmail.com>
 <m2eqo7$cf9$1@ger.gmane.org>
Message-ID: <FD6832B9-3F1F-48C6-A76F-47A224F1697B@gmail.com>

Hi Markus,

I used msktutil to create the keytab.


	msktutil -c -s HTTP/proxy01tst.fake.net -h proxy01tst.fake.net -k 
/etc/squid3/PROXY.keytab --computer-name proxy01-tst --upn 
HTTP/proxy01tst.fake.net --server srv01.fake.net --verbose


Output of klist -ekt:

	   2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (arcfour-hmac)
	   2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET 
(aes128-cts-hmac-sha1-96)
	   2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET 
(aes256-cts-hmac-sha1-96)
	   2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET 
(arcfour-hmac)
	   2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET 
(aes128-cts-hmac-sha1-96)
	   2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET 
(aes256-cts-hmac-sha1-96)
	   2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET 
(arcfour-hmac)
	   2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET 
(aes128-cts-hmac-sha1-96)
	   2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET 
(aes256-cts-hmac-sha1-96)


Yep, using MIT Kerberos

Thanks in advance for any help.

Cheers,
Pedro


On 25 Oct 2014, at 1:26, Markus Moeller wrote:

> Hi Pedro,
>
> How did you create your keytab ?  What does klist ?ekt 
> <squid.keytab> show ( I assume you use MIT Kerberos) ?
>
> Markus
>
> "Pedro Lobo" <palobo at gmail.com> wrote in message 
> news:40E1E0E7-50C6-4117-94AA-50B06573430A at gmail.com...
> Hi Squid Gurus,
>
> I'm at my wit's end and in dire need of some squid expertise.
>
> We've got a production environment with a couple of squid 2.7 servers 
> using NTLM and basic authentication. Recently though, we decided to 
> upgrade and I'm now setting up squid 3.3 with Kerberos and NTLM 
> Fallback. I've followed just about every guide I could find and in my 
> testing environment, things were working great. Now that I've hooked 
> it up to the main domain, things are awry.
>
> If I use a machine that's not part of the domain, NTLM kicks in and I 
> can surf the web fine. If I use a Windows XP or Windows Server 2003, 
> kerberos works just fine, however, if I use a machine Windows 7, 8 or 
> 2008 server, I keep getting a popup asking me to authenticate and even 
> then, it's and endless loop until it fails. My cache.log is littered 
> with:
>
> negotiate_kerberos_auth.cc(200): pid=1607 :2014/10/24 23:03:01| 
> negotiate_kerberos_auth: ERROR: gss_accept_sec_context() failed: 
> Unspecified GSS failure.  Minor code may provide more information.
> 2014/10/24 23:03:01| ERROR: Negotiate Authentication validating user. 
> Error returned 'BH gss_accept_sec_context() failed: Unspecified GSS 
> failure.  Minor code may provide more information. '
> The odd thing, is that this has worked before. Help me Obi Wan... 
> You're my only hope! :)
>
> Current Setup
> Squid 3.3 running on Ubuntu 14.04 server. It's connected to a 2003 
> server with function level 2000 (I know, we're trying to fase out the 
> older servers).
>
> krb5.conf
>
> [libdefaults]
>     default_realm = FAKE.NET
>     dns_lookup_kdc = yes
>     dns_lookup_realm = yes
>     ticket_lifetime = 24h
>     default_keytab_name = /etc/squid3/PROXY.keytab
>
> ; for Windows 2003
>     default_tgs_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
>     default_tkt_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
>     permitted_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
>
> [realms]
>     FAKE.NET = {
>             kdc = srv01.fake.net
>             kdc = srv02.fake.net
>             kdc = srv03.fake.net
>             admin_server = srv01.fake.net
>             default_domain = fake.net
>     }
>
> [domain_realm]
>     .fake.net = FAKE.NET
>     fake.net = FAKE.NET
>
>
> [logging]
> kdc = FILE:/var/log/kdc.log
> admin_server = FILE:/var/log/kadmin.log
> default = FILE:/var/log/krb5lib.log
> squid.conf
>
> auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth 
> -d -r -s HTTP/proxy01tst.fake.net
> auth_param negotiate children 20 startup=0 idle=1
> auth_param negotiate keep_alive off
>
> auth_param ntlm program /usr/bin/ntlm_auth --diagnostics 
> --helper-protocol=squid-2.5-ntlmssp --domain=FAKE.NET
> auth_param ntlm children 10
> auth_param ntlm keep_alive off
> Cheers,
> Pedro
>
> Cumprimentos
> Pedro Lobo
> Solutions Architect | System Engineer
>
> pedro.lobo at pt.clara.net
> Tlm.: +351 939 528 827 | Tel.: +351 214 127 314
>
> Claranet Portugal
> Ed. Parque Expo
> Av. D. Jo?o II, 1.07-2.1, 4? Piso
> 1998-014 Lisboa
> www.claranet.pt
>
>
>
>
>
> Empresa certificada ISO 9001, ISO 20000 e ISO 27001
>
>
>
>
> --------------------------------------------------------------------------------
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


Cumprimentos
Pedro Lobo
Solutions Architect | System Engineer

pedro.lobo at pt.clara.net
Tlm.: +351 939 528 827 | Tel.: +351 214 127 314

Claranet Portugal
Ed. Parque Expo
Av. D. Jo?o II, 1.07-2.1, 4? Piso
1998-014 Lisboa
www.claranet.pt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141025/03283632/attachment.htm>

From palobo at gmail.com  Sat Oct 25 09:39:33 2014
From: palobo at gmail.com (Pedro Lobo)
Date: Sat, 25 Oct 2014 10:39:33 +0100
Subject: [squid-users] Kerberos Authentication Failing for Windows 7+
 with BH gss_accept_sec_context() failed
In-Reply-To: <CAHsHsyuDgaahurxRFys6HJ0OdPDo8QA8Xe6kaWCnXP5G2wAtqg@mail.gmail.com>
References: <40E1E0E7-50C6-4117-94AA-50B06573430A@gmail.com>
 <m2eqo7$cf9$1@ger.gmane.org>
 <CAHsHsyuDgaahurxRFys6HJ0OdPDo8QA8Xe6kaWCnXP5G2wAtqg@mail.gmail.com>
Message-ID: <F25AC009-CB36-480B-A788-A525AD29A8E3@gmail.com>

Hi Carlos,

Yeah, the Windows 7 machine is part of the domain. As for basic auth, I'll look into setting that up too, although we were hoping to forgo it entirely.


On 25 Oct 2014, at 3:00, Carlos Defoe wrote:

> Windows 7 inside the domain?
>
> Anyway, you should configure a basic auth scheme as a second fallback.
>
>
>
> On Fri, Oct 24, 2014 at 9:26 PM, Markus Moeller <huaraz at moeller.plus.com>
> wrote:
>
>> Hi Pedro,
>>
>> How did you create your keytab ?  What does klist ?ekt <squid.keytab> show
>> ( I assume you use MIT Kerberos) ?
>>
>> Markus
>>
>> "Pedro Lobo" <palobo at gmail.com> wrote in message
>> news:40E1E0E7-50C6-4117-94AA-50B06573430A at gmail.com...
>>
>> Hi Squid Gurus,
>>
>> I'm at my wit's end and in dire need of some squid expertise.
>>
>> We've got a production environment with a couple of squid 2.7 servers
>> using NTLM and basic authentication. Recently though, we decided to upgrade
>> and I'm now setting up squid 3.3 with Kerberos and NTLM Fallback. I've
>> followed just about every guide I could find and in my testing environment,
>> things were working great. Now that I've hooked it up to the main domain,
>> things are awry.
>>
>> If I use a machine that's not part of the domain, NTLM kicks in and I can
>> surf the web fine. If I use a Windows XP or Windows Server 2003, kerberos
>> works just fine, however, if I use a machine Windows 7, 8 or 2008 server, I
>> keep getting a popup asking me to authenticate and even then, it's and
>> endless loop until it fails. My cache.log is littered with:
>>
>> negotiate_kerberos_auth.cc(200): pid=1607 :2014/10/24 23:03:01| negotiate_kerberos_auth: ERROR: gss_accept_sec_context() failed: Unspecified GSS failure.  Minor code may provide more information.
>> 2014/10/24 23:03:01| ERROR: Negotiate Authentication validating user. Error returned 'BH gss_accept_sec_context() failed: Unspecified GSS failure.  Minor code may provide more information. '
>>
>> The odd thing, is that this has worked before. Help me Obi Wan... You're
>> my only hope! :)
>>
>> *Current Setup*
>> Squid 3.3 running on Ubuntu 14.04 server. It's connected to a 2003 server
>> with function level 2000 (I know, we're trying to fase out the older
>> servers).
>>
>> *krb5.conf*
>>
>> [libdefaults]
>>     default_realm = FAKE.NET
>>     dns_lookup_kdc = yes
>>     dns_lookup_realm = yes
>>     ticket_lifetime = 24h
>>     default_keytab_name = /etc/squid3/PROXY.keytab
>>
>> ; for Windows 2003
>>     default_tgs_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
>>     default_tkt_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
>>     permitted_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
>>
>> [realms]
>>     FAKE.NET = {
>>             kdc = srv01.fake.net
>>             kdc = srv02.fake.net
>>             kdc = srv03.fake.net
>>             admin_server = srv01.fake.net
>>             default_domain = fake.net
>>     }
>>
>> [domain_realm]
>>     .fake.net = FAKE.NET
>>     fake.net = FAKE.NET
>>
>>
>> [logging]
>> kdc = FILE:/var/log/kdc.log
>> admin_server = FILE:/var/log/kadmin.log
>> default = FILE:/var/log/krb5lib.log
>>
>> *squid.conf*
>>
>> auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s HTTP/proxy01tst.fake.net
>> auth_param negotiate children 20 startup=0 idle=1
>> auth_param negotiate keep_alive off
>>
>> auth_param ntlm program /usr/bin/ntlm_auth --diagnostics --helper-protocol=squid-2.5-ntlmssp --domain=FAKE.NET
>> auth_param ntlm children 10
>> auth_param ntlm keep_alive off
>>
>> Cheers,
>> Pedro
>>
>>
>> ------------------------------
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>>
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>>
>>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141025/573ebd27/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 536 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141025/573ebd27/attachment.sig>

From dan at getbusi.com  Sat Oct 25 09:41:14 2014
From: dan at getbusi.com (Dan Charlesworth)
Date: Sat, 25 Oct 2014 02:41:14 -0700 (PDT)
Subject: [squid-users] Kerberos Authentication Failing for Windows 7+
 with BH gss_accept_sec_context() failed
In-Reply-To: <FD6832B9-3F1F-48C6-A76F-47A224F1697B@gmail.com>
References: <FD6832B9-3F1F-48C6-A76F-47A224F1697B@gmail.com>
Message-ID: <1414230074331.a85bb773@Nodemailer>

I was recently receiving this (incredibly vague) error. Turns out my squid user didn?t have permission to read the keytab.

On Sat, Oct 25, 2014 at 8:37 PM, Pedro Lobo <palobo at gmail.com> wrote:

> Hi Markus,
> I used msktutil to create the keytab.
> 	msktutil -c -s HTTP/proxy01tst.fake.net -h proxy01tst.fake.net -k 
> /etc/squid3/PROXY.keytab --computer-name proxy01-tst --upn 
> HTTP/proxy01tst.fake.net --server srv01.fake.net --verbose
> Output of klist -ekt:
> 	   2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (arcfour-hmac)
> 	   2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET 
> (aes128-cts-hmac-sha1-96)
> 	   2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET 
> (aes256-cts-hmac-sha1-96)
> 	   2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET 
> (arcfour-hmac)
> 	   2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET 
> (aes128-cts-hmac-sha1-96)
> 	   2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET 
> (aes256-cts-hmac-sha1-96)
> 	   2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET 
> (arcfour-hmac)
> 	   2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET 
> (aes128-cts-hmac-sha1-96)
> 	   2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET 
> (aes256-cts-hmac-sha1-96)
> Yep, using MIT Kerberos
> Thanks in advance for any help.
> Cheers,
> Pedro
> On 25 Oct 2014, at 1:26, Markus Moeller wrote:
>> Hi Pedro,
>>
>> How did you create your keytab ?  What does klist ?ekt 
>> <squid.keytab> show ( I assume you use MIT Kerberos) ?
>>
>> Markus
>>
>> "Pedro Lobo" <palobo at gmail.com> wrote in message 
>> news:40E1E0E7-50C6-4117-94AA-50B06573430A at gmail.com...
>> Hi Squid Gurus,
>>
>> I'm at my wit's end and in dire need of some squid expertise.
>>
>> We've got a production environment with a couple of squid 2.7 servers 
>> using NTLM and basic authentication. Recently though, we decided to 
>> upgrade and I'm now setting up squid 3.3 with Kerberos and NTLM 
>> Fallback. I've followed just about every guide I could find and in my 
>> testing environment, things were working great. Now that I've hooked 
>> it up to the main domain, things are awry.
>>
>> If I use a machine that's not part of the domain, NTLM kicks in and I 
>> can surf the web fine. If I use a Windows XP or Windows Server 2003, 
>> kerberos works just fine, however, if I use a machine Windows 7, 8 or 
>> 2008 server, I keep getting a popup asking me to authenticate and even 
>> then, it's and endless loop until it fails. My cache.log is littered 
>> with:
>>
>> negotiate_kerberos_auth.cc(200): pid=1607 :2014/10/24 23:03:01| 
>> negotiate_kerberos_auth: ERROR: gss_accept_sec_context() failed: 
>> Unspecified GSS failure.  Minor code may provide more information.
>> 2014/10/24 23:03:01| ERROR: Negotiate Authentication validating user. 
>> Error returned 'BH gss_accept_sec_context() failed: Unspecified GSS 
>> failure.  Minor code may provide more information. '
>> The odd thing, is that this has worked before. Help me Obi Wan... 
>> You're my only hope! :)
>>
>> Current Setup
>> Squid 3.3 running on Ubuntu 14.04 server. It's connected to a 2003 
>> server with function level 2000 (I know, we're trying to fase out the 
>> older servers).
>>
>> krb5.conf
>>
>> [libdefaults]
>>     default_realm = FAKE.NET
>>     dns_lookup_kdc = yes
>>     dns_lookup_realm = yes
>>     ticket_lifetime = 24h
>>     default_keytab_name = /etc/squid3/PROXY.keytab
>>
>> ; for Windows 2003
>>     default_tgs_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
>>     default_tkt_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
>>     permitted_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
>>
>> [realms]
>>     FAKE.NET = {
>>             kdc = srv01.fake.net
>>             kdc = srv02.fake.net
>>             kdc = srv03.fake.net
>>             admin_server = srv01.fake.net
>>             default_domain = fake.net
>>     }
>>
>> [domain_realm]
>>     .fake.net = FAKE.NET
>>     fake.net = FAKE.NET
>>
>>
>> [logging]
>> kdc = FILE:/var/log/kdc.log
>> admin_server = FILE:/var/log/kadmin.log
>> default = FILE:/var/log/krb5lib.log
>> squid.conf
>>
>> auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth 
>> -d -r -s HTTP/proxy01tst.fake.net
>> auth_param negotiate children 20 startup=0 idle=1
>> auth_param negotiate keep_alive off
>>
>> auth_param ntlm program /usr/bin/ntlm_auth --diagnostics 
>> --helper-protocol=squid-2.5-ntlmssp --domain=FAKE.NET
>> auth_param ntlm children 10
>> auth_param ntlm keep_alive off
>> Cheers,
>> Pedro
>>
>> Cumprimentos
>> Pedro Lobo
>> Solutions Architect | System Engineer
>>
>> pedro.lobo at pt.clara.net
>> Tlm.: +351 939 528 827 | Tel.: +351 214 127 314
>>
>> Claranet Portugal
>> Ed. Parque Expo
>> Av. D. Jo?o II, 1.07-2.1, 4? Piso
>> 1998-014 Lisboa
>> www.claranet.pt
>>
>>
>>
>>
>>
>> Empresa certificada ISO 9001, ISO 20000 e ISO 27001
>>
>>
>>
>>
>> --------------------------------------------------------------------------------
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
> Cumprimentos
> Pedro Lobo
> Solutions Architect | System Engineer
> pedro.lobo at pt.clara.net
> Tlm.: +351 939 528 827 | Tel.: +351 214 127 314
> Claranet Portugal
> Ed. Parque Expo
> Av. D. Jo?o II, 1.07-2.1, 4? Piso
> 1998-014 Lisboa
> www.claranet.pt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141025/992b5b9a/attachment.htm>

From palobo at gmail.com  Sat Oct 25 09:53:56 2014
From: palobo at gmail.com (Pedro Lobo)
Date: Sat, 25 Oct 2014 10:53:56 +0100
Subject: [squid-users] Kerberos Authentication Failing for Windows 7+
 with BH gss_accept_sec_context() failed
In-Reply-To: <1414230074331.a85bb773@Nodemailer>
References: <FD6832B9-3F1F-48C6-A76F-47A224F1697B@gmail.com>
 <1414230074331.a85bb773@Nodemailer>
Message-ID: <5DF2361E-14D1-4C80-B39C-0EAAEBFAB76C@gmail.com>

Hi Dan,

Well now I feel incredibly stupid!!! Just checked and it seems something must've changed the permissions on my keytab file (I did mention it was working at one time). For some odd reason, although squid user and group both owned the key tab file, only user had read permissions. I haven't yet figured out what might have changed those permissions (maybe some troubleshooting I did earlier), but fixing the permissions seems to have sorted the problem.

Thanks everybody for your help. Have a great weekend!

Cheers,
Pedro

Monday I'll do a little more testing with the pilot group, but at least 

On 25 Oct 2014, at 10:41, Dan Charlesworth wrote:

> I was recently receiving this (incredibly vague) error. Turns out my squid user didn?t have permission to read the keytab.
>
> On Sat, Oct 25, 2014 at 8:37 PM, Pedro Lobo <palobo at gmail.com> wrote:
>
>> Hi Markus,
>> I used msktutil to create the keytab.
>> 	msktutil -c -s HTTP/proxy01tst.fake.net -h proxy01tst.fake.net -k
>> /etc/squid3/PROXY.keytab --computer-name proxy01-tst --upn
>> HTTP/proxy01tst.fake.net --server srv01.fake.net --verbose
>> Output of klist -ekt:
>> 	   2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (arcfour-hmac)
>> 	   2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET
>> (aes128-cts-hmac-sha1-96)
>> 	   2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET
>> (aes256-cts-hmac-sha1-96)
>> 	   2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET
>> (arcfour-hmac)
>> 	   2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET
>> (aes128-cts-hmac-sha1-96)
>> 	   2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET
>> (aes256-cts-hmac-sha1-96)
>> 	   2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET
>> (arcfour-hmac)
>> 	   2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET
>> (aes128-cts-hmac-sha1-96)
>> 	   2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET
>> (aes256-cts-hmac-sha1-96)
>> Yep, using MIT Kerberos
>> Thanks in advance for any help.
>> Cheers,
>> Pedro
>> On 25 Oct 2014, at 1:26, Markus Moeller wrote:
>>> Hi Pedro,
>>>
>>> How did you create your keytab ?  What does klist ?ekt
>>> <squid.keytab> show ( I assume you use MIT Kerberos) ?
>>>
>>> Markus
>>>
>>> "Pedro Lobo" <palobo at gmail.com> wrote in message
>>> news:40E1E0E7-50C6-4117-94AA-50B06573430A at gmail.com...
>>> Hi Squid Gurus,
>>>
>>> I'm at my wit's end and in dire need of some squid expertise.
>>>
>>> We've got a production environment with a couple of squid 2.7 servers
>>> using NTLM and basic authentication. Recently though, we decided to
>>> upgrade and I'm now setting up squid 3.3 with Kerberos and NTLM
>>> Fallback. I've followed just about every guide I could find and in my
>>> testing environment, things were working great. Now that I've hooked
>>> it up to the main domain, things are awry.
>>>
>>> If I use a machine that's not part of the domain, NTLM kicks in and I
>>> can surf the web fine. If I use a Windows XP or Windows Server 2003,
>>> kerberos works just fine, however, if I use a machine Windows 7, 8 or
>>> 2008 server, I keep getting a popup asking me to authenticate and even
>>> then, it's and endless loop until it fails. My cache.log is littered
>>> with:
>>>
>>> negotiate_kerberos_auth.cc(200): pid=1607 :2014/10/24 23:03:01|
>>> negotiate_kerberos_auth: ERROR: gss_accept_sec_context() failed:
>>> Unspecified GSS failure.  Minor code may provide more information.
>>> 2014/10/24 23:03:01| ERROR: Negotiate Authentication validating user.
>>> Error returned 'BH gss_accept_sec_context() failed: Unspecified GSS
>>> failure.  Minor code may provide more information. '
>>> The odd thing, is that this has worked before. Help me Obi Wan...
>>> You're my only hope! :)
>>>
>>> Current Setup
>>> Squid 3.3 running on Ubuntu 14.04 server. It's connected to a 2003
>>> server with function level 2000 (I know, we're trying to fase out the
>>> older servers).
>>>
>>> krb5.conf
>>>
>>> [libdefaults]
>>>  default_realm = FAKE.NET
>>>  dns_lookup_kdc = yes
>>>  dns_lookup_realm = yes
>>>  ticket_lifetime = 24h
>>>  default_keytab_name = /etc/squid3/PROXY.keytab
>>>
>>> ; for Windows 2003
>>>  default_tgs_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
>>>  default_tkt_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
>>>  permitted_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
>>>
>>> [realms]
>>>  FAKE.NET = {
>>>          kdc = srv01.fake.net
>>>          kdc = srv02.fake.net
>>>          kdc = srv03.fake.net
>>>          admin_server = srv01.fake.net
>>>          default_domain = fake.net
>>>  }
>>>
>>> [domain_realm]
>>>  .fake.net = FAKE.NET
>>>  fake.net = FAKE.NET
>>>
>>>
>>> [logging]
>>> kdc = FILE:/var/log/kdc.log
>>> admin_server = FILE:/var/log/kadmin.log
>>> default = FILE:/var/log/krb5lib.log
>>> squid.conf
>>>
>>> auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth
>>> -d -r -s HTTP/proxy01tst.fake.net
>>> auth_param negotiate children 20 startup=0 idle=1
>>> auth_param negotiate keep_alive off
>>>
>>> auth_param ntlm program /usr/bin/ntlm_auth --diagnostics
>>> --helper-protocol=squid-2.5-ntlmssp --domain=FAKE.NET
>>> auth_param ntlm children 10
>>> auth_param ntlm keep_alive off
>>> Cheers,
>>> Pedro
>>>
>>> --------------------------------------------------------------------------------
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141025/aecd9499/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 536 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141025/aecd9499/attachment.sig>

From Job at colliniconsulting.it  Sat Oct 25 11:49:52 2014
From: Job at colliniconsulting.it (Job)
Date: Sat, 25 Oct 2014 13:49:52 +0200
Subject: [squid-users] Filtering keywords on google search
Message-ID: <88EF58F000EC4B4684700C2AA3A73D7A04F5323FBEE4@W2008DC01.ColliniConsulting.lan>

Hello, since Google switch definitely on SSL connection it seems there is no way to filter semantic (with danguardian, squidguard or squid).

SSL Bump can help in this case, both on explicit or transparent proxying?

Is there another way to filter searches (and image searches!)?

Thank you!
Francesco

From huaraz at moeller.plus.com  Sat Oct 25 13:13:05 2014
From: huaraz at moeller.plus.com (Markus Moeller)
Date: Sat, 25 Oct 2014 14:13:05 +0100
Subject: [squid-users] Kerberos Authentication Failing for Windows 7+
	with BH gss_accept_sec_context() failed
In-Reply-To: <FD6832B9-3F1F-48C6-A76F-47A224F1697B@gmail.com>
References: <40E1E0E7-50C6-4117-94AA-50B06573430A@gmail.com>
 <m2eqo7$cf9$1@ger.gmane.org> <FD6832B9-3F1F-48C6-A76F-47A224F1697B@gmail.com>
Message-ID: <m2g7l9$1ee$1@ger.gmane.org>

Hi Pedro,

  I wonder if he upper case in the name is a problem. Can you try 

auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s GSS_C_NO_NAME

instead of

auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s HTTP/proxy01tst.fake.net

Markus

"Pedro Lobo" <palobo at gmail.com> wrote in message news:FD6832B9-3F1F-48C6-A76F-47A224F1697B at gmail.com...
Hi Markus,

I used msktutil to create the keytab.

msktutil -c -s HTTP/proxy01tst.fake.net -h proxy01tst.fake.net -k /etc/squid3/PROXY.keytab --computer-name proxy01-tst --upn HTTP/proxy01tst.fake.net --server srv01.fake.net --verbose
Output of klist -ekt:

   2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (arcfour-hmac)
   2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (aes128-cts-hmac-sha1-96)
   2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (aes256-cts-hmac-sha1-96)
   2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET (arcfour-hmac)
   2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET (aes128-cts-hmac-sha1-96)
   2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET (aes256-cts-hmac-sha1-96)
   2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET (arcfour-hmac)
   2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET (aes128-cts-hmac-sha1-96)
   2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET (aes256-cts-hmac-sha1-96)
Yep, using MIT Kerberos

Thanks in advance for any help.

Cheers,
Pedro

On 25 Oct 2014, at 1:26, Markus Moeller wrote:

  Hi Pedro,

  How did you create your keytab ? What does klist ?ekt <squid.keytab> show ( I assume you use MIT Kerberos) ?

  Markus

  "Pedro Lobo" palobo at gmail.com wrote in message news:40E1E0E7-50C6-4117-94AA-50B06573430A at gmail.com...
  Hi Squid Gurus,

  I'm at my wit's end and in dire need of some squid expertise.

  We've got a production environment with a couple of squid 2.7 servers using NTLM and basic authentication. Recently though, we decided to upgrade and I'm now setting up squid 3.3 with Kerberos and NTLM Fallback. I've followed just about every guide I could find and in my testing environment, things were working great. Now that I've hooked it up to the main domain, things are awry.

  If I use a machine that's not part of the domain, NTLM kicks in and I can surf the web fine. If I use a Windows XP or Windows Server 2003, kerberos works just fine, however, if I use a machine Windows 7, 8 or 2008 server, I keep getting a popup asking me to authenticate and even then, it's and endless loop until it fails. My cache.log is littered with:

  negotiate_kerberos_auth.cc(200): pid=1607 :2014/10/24 23:03:01| negotiate_kerberos_auth: ERROR: gss_accept_sec_context() failed: Unspecified GSS failure. Minor code may provide more information.
  2014/10/24 23:03:01| ERROR: Negotiate Authentication validating user. Error returned 'BH gss_accept_sec_context() failed: Unspecified GSS failure. Minor code may provide more information. '
  The odd thing, is that this has worked before. Help me Obi Wan... You're my only hope! :)

  Current Setup
  Squid 3.3 running on Ubuntu 14.04 server. It's connected to a 2003 server with function level 2000 (I know, we're trying to fase out the older servers).

  krb5.conf

  [libdefaults]
  default_realm = FAKE.NET
  dns_lookup_kdc = yes
  dns_lookup_realm = yes
  ticket_lifetime = 24h
  default_keytab_name = /etc/squid3/PROXY.keytab

  ; for Windows 2003
  default_tgs_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
  default_tkt_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
  permitted_enctypes = rc4-hmac des-cbc-crc des-cbc-md5

  [realms]
  FAKE.NET = {
  kdc = srv01.fake.net
  kdc = srv02.fake.net
  kdc = srv03.fake.net
  admin_server = srv01.fake.net
  default_domain = fake.net
  }

  [domain_realm]
  .fake.net = FAKE.NET
  fake.net = FAKE.NET

  [logging]
  kdc = FILE:/var/log/kdc.log
  admin_server = FILE:/var/log/kadmin.log
  default = FILE:/var/log/krb5lib.log
  squid.conf

  auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s HTTP/proxy01tst.fake.net
  auth_param negotiate children 20 startup=0 idle=1
  auth_param negotiate keep_alive off

  auth_param ntlm program /usr/bin/ntlm_auth --diagnostics --helper-protocol=squid-2.5-ntlmssp --domain=FAKE.NET
  auth_param ntlm children 10
  auth_param ntlm keep_alive off
  Cheers,
  Pedro

  Cumprimentos
  Pedro Lobo
  Solutions Architect | System Engineer

  pedro.lobo at pt.clara.net
  Tlm.: +351 939 528 827 | Tel.: +351 214 127 314

  Claranet Portugal
  Ed. Parque Expo
  Av. D. Jo?o II, 1.07-2.1, 4? Piso
  1998-014 Lisboa
  www.claranet.pt

  Empresa certificada ISO 9001, ISO 20000 e ISO 27001


------------------------------------------------------------------------------

------------------------------------------------------------------------------

  squid-users mailing list
  squid-users at lists.squid-cache.org
  http://lists.squid-cache.org/listinfo/squid-users


------------------------------------------------------------------------------

  squid-users mailing list
  squid-users at lists.squid-cache.org
  http://lists.squid-cache.org/listinfo/squid-users

Cumprimentos 
Pedro Lobo 
Solutions Architect | System Engineer 

pedro.lobo at pt.clara.net 
Tlm.: +351 939 528 827 | Tel.: +351 214 127 314 

Claranet Portugal 
Ed. Parque Expo 
Av. D. Jo?o II, 1.07-2.1, 4? Piso 
1998-014 Lisboa 
www.claranet.pt 

              

 

Empresa certificada ISO 9001, ISO 20000 e ISO 27001 




--------------------------------------------------------------------------------
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141025/027b7ea2/attachment.htm>

From palobo at gmail.com  Sat Oct 25 13:50:51 2014
From: palobo at gmail.com (Pedro Lobo)
Date: Sat, 25 Oct 2014 14:50:51 +0100
Subject: [squid-users] Kerberos Authentication Failing for Windows 7+
 with BH gss_accept_sec_context() failed
In-Reply-To: <m2g7l9$1ee$1@ger.gmane.org>
References: <40E1E0E7-50C6-4117-94AA-50B06573430A@gmail.com>
 <m2eqo7$cf9$1@ger.gmane.org> <FD6832B9-3F1F-48C6-A76F-47A224F1697B@gmail.com>
 <m2g7l9$1ee$1@ger.gmane.org>
Message-ID: <75991CAE-5F10-4635-B012-D372C27F8AC4@gmail.com>

Hi Markus,

I initially had it configured as such and changed it to `auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s HTTP/proxy01tst.fake.net` as a troubleshooting step. I've since then changed it back. Dan pointed out earlier that it could be a permissions problem, and sure enough, permissions on /etc/squid3/PROXY.keytab were wrong (group had no read permissions). Fixing that seems to have sorted out the problem. I'll be doing more extensive testes on Monday when the test group start surfing the web.

Thanks for all the help!

On 25 Oct 2014, at 14:13, Markus Moeller wrote:

> Hi Pedro,
>
> I wonder if he upper case in the name is a problem. Can you try
>
> auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s GSS_C_NO_NAME
>
> instead of
>
> auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s HTTP/proxy01tst.fake.net
>
> Markus
>
> "Pedro Lobo" <palobo at gmail.com> wrote in message news:FD6832B9-3F1F-48C6-A76F-47A224F1697B at gmail.com...
> Hi Markus,
>
> I used msktutil to create the keytab.
>
> msktutil -c -s HTTP/proxy01tst.fake.net -h proxy01tst.fake.net -k /etc/squid3/PROXY.keytab --computer-name proxy01-tst --upn HTTP/proxy01tst.fake.net --server srv01.fake.net --verbose
> Output of klist -ekt:
>
> 2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (arcfour-hmac)
> 2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (aes128-cts-hmac-sha1-96)
> 2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (aes256-cts-hmac-sha1-96)
> 2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET (arcfour-hmac)
> 2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET (aes128-cts-hmac-sha1-96)
> 2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET (aes256-cts-hmac-sha1-96)
> 2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET (arcfour-hmac)
> 2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET (aes128-cts-hmac-sha1-96)
> 2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET (aes256-cts-hmac-sha1-96)
> Yep, using MIT Kerberos
>
> Thanks in advance for any help.
>
> Cheers,
> Pedro
>
> On 25 Oct 2014, at 1:26, Markus Moeller wrote:
>
> Hi Pedro,
>
> How did you create your keytab ? What does klist ?ekt <squid.keytab> show ( I assume you use MIT Kerberos) ?
>
> Markus
>
> "Pedro Lobo" palobo at gmail.com wrote in message news:40E1E0E7-50C6-4117-94AA-50B06573430A at gmail.com...
> Hi Squid Gurus,
>
> I'm at my wit's end and in dire need of some squid expertise.
>
> We've got a production environment with a couple of squid 2.7 servers using NTLM and basic authentication. Recently though, we decided to upgrade and I'm now setting up squid 3.3 with Kerberos and NTLM Fallback. I've followed just about every guide I could find and in my testing environment, things were working great. Now that I've hooked it up to the main domain, things are awry.
>
> If I use a machine that's not part of the domain, NTLM kicks in and I can surf the web fine. If I use a Windows XP or Windows Server 2003, kerberos works just fine, however, if I use a machine Windows 7, 8 or 2008 server, I keep getting a popup asking me to authenticate and even then, it's and endless loop until it fails. My cache.log is littered with:
>
> negotiate_kerberos_auth.cc(200): pid=1607 :2014/10/24 23:03:01| negotiate_kerberos_auth: ERROR: gss_accept_sec_context() failed: Unspecified GSS failure. Minor code may provide more information.
> 2014/10/24 23:03:01| ERROR: Negotiate Authentication validating user. Error returned 'BH gss_accept_sec_context() failed: Unspecified GSS failure. Minor code may provide more information. '
> The odd thing, is that this has worked before. Help me Obi Wan... You're my only hope! :)
>
> Current Setup
> Squid 3.3 running on Ubuntu 14.04 server. It's connected to a 2003 server with function level 2000 (I know, we're trying to fase out the older servers).
>
> krb5.conf
>
> [libdefaults]
> default_realm = FAKE.NET
> dns_lookup_kdc = yes
> dns_lookup_realm = yes
> ticket_lifetime = 24h
> default_keytab_name = /etc/squid3/PROXY.keytab
>
> ; for Windows 2003
> default_tgs_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
> default_tkt_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
> permitted_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
>
> [realms]
> FAKE.NET = {
> kdc = srv01.fake.net
> kdc = srv02.fake.net
> kdc = srv03.fake.net
> admin_server = srv01.fake.net
> default_domain = fake.net
> }
>
> [domain_realm]
> .fake.net = FAKE.NET
> fake.net = FAKE.NET
>
> [logging]
> kdc = FILE:/var/log/kdc.log
> admin_server = FILE:/var/log/kadmin.log
> default = FILE:/var/log/krb5lib.log
> squid.conf
>
> auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s HTTP/proxy01tst.fake.net
> auth_param negotiate children 20 startup=0 idle=1
> auth_param negotiate keep_alive off
>
> auth_param ntlm program /usr/bin/ntlm_auth --diagnostics --helper-protocol=squid-2.5-ntlmssp --domain=FAKE.NET
> auth_param ntlm children 10
> auth_param ntlm keep_alive off
> Cheers,
> Pedro
>
> Cumprimentos
> Pedro Lobo
> Solutions Architect | System Engineer
>
> pedro.lobo at pt.clara.net
> Tlm.: +351 939 528 827 | Tel.: +351 214 127 314
>
> Claranet Portugal
> Ed. Parque Expo
> Av. D. Jo?o II, 1.07-2.1, 4? Piso
> 1998-014 Lisboa
> www.claranet.pt
>
> Empresa certificada ISO 9001, ISO 20000 e ISO 27001
>
>
> ------------------------------------------------------------------------------
>
> ------------------------------------------------------------------------------
>
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
> ------------------------------------------------------------------------------
>
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
> Cumprimentos
> Pedro Lobo
> Solutions Architect | System Engineer
>
> pedro.lobo at pt.clara.net
> Tlm.: +351 939 528 827 | Tel.: +351 214 127 314
>
> Claranet Portugal
> Ed. Parque Expo
> Av. D. Jo?o II, 1.07-2.1, 4? Piso
> 1998-014 Lisboa
> www.claranet.pt
>
>
>
>
>
> Empresa certificada ISO 9001, ISO 20000 e ISO 27001
>
>
>
>
> --------------------------------------------------------------------------------
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141025/6d5f37db/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 536 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141025/6d5f37db/attachment.sig>

From lameventanas at gmail.com  Sat Oct 25 14:20:08 2014
From: lameventanas at gmail.com (Alan)
Date: Sat, 25 Oct 2014 23:20:08 +0900
Subject: [squid-users] 3.3.x -> 3.4.x: huge performance regression
In-Reply-To: <544A4AD5.6040804@ngtech.co.il>
References: <5447486B.3010205@norma.perm.ru> <5448C7FB.1080104@ngtech.co.il>
 <1FCF9DA5B29068478ECF15896F19F0840138A509A8@Y011008.bk.fin.local>
 <544A4390.3090903@norma.perm.ru> <544A4AD5.6040804@ngtech.co.il>
Message-ID: <CAFKaCCSS_Mo0MWfxtM_Zp3fs-8iVrZcE7-EaO9x4aC+iVjYn8Q@mail.gmail.com>

I had the same problem when I tried to move from 3.3 to 3.4.  Because
of this, I had to go back to 3.3.

I don't remember the CPU being stuck at 100%, but it was certainly
higher, and the Internet browsing experience was slower.

I don't use the NTLM helper, but I do use the Kerberos one, and also a
couple of custom external acls.

Alan


On Fri, Oct 24, 2014 at 9:49 PM, Eliezer Croitoru <eliezer at ngtech.co.il> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Hey Eugene,
>
> I will try to clear things out.
> Any helper is an external software but each and every one of them
> answers to a specific logic.
> external_acl url_rewrite and store_id helpers works in one way while
> authentication works in another.
>
> To make the story short external_acl url_rewrite and store_id helpers
> acquire a single line from squid via STDIN and responses to his own
> STDOUT towards squid STDIN.
> an example would be:
> 1 http://www.yahoo.com "more things such as requester and others"
>
> The helper responses to this with a line such as:
> 1 ERR
> or
> 1 OK "more stuff"
>
> The above example applies only to squid 3.4 while in squid 3.3 this is
> being used only on the external_acl interface.
>
> In auth helpers there are couple "stages" that applies on each requests.
> In external_acl and the similar interfaces the client do not need to
> send any details for the helper to analyze else then these that exists
> on each request.
> Auth helpers has a logic that denies with request for more details.
> NTLM specifically has overload on the whole process since it can have
> 3 stages against squid.
> Kerberous has the benefit of only 2 stages against squid:
> 1 - request -> denial
> 2 - request + credentials -> denial or approval
>
> Comparing NTLM to external_acl helpers it is very different.
> But comparing Kerberous to external_acl it's almost similar.
>
> If for example NTML + Kerberous + external_acl + others suffers from
> the same issue while using only one of them at a time it will prove
> that there is a specific direction to the issue.
> But if Kerberous and NTLM differ it will prove that there are other
> things in hand.
>
> Another approach to test the issue is to write an ECAP or ICAP helper
> that will implement the whole authentication logic.
> This will also prove that the helpers code is broken in 3.4 compared
> to 3.3.
>
> There is also the comparison of basic authentication compared to NTLM
> + Keberous which is also important.
>
> The squid team needs a testing environment for the issue for quite
> some time.
>
> Now that Victor Sudakov has used Kerberous instead of NTLM we might be
> able to put some efforts and to pinpoint the issue.
>
> All The Bests,
> Eliezer
>
> On 10/24/2014 03:18 PM, Eugene M. Zheganin wrote:
>>> see http://bugs.squid-cache.org/show_bug.cgi?id=3997
>> There seems to be a large mix of terms, like "external helper" and
>> "external program". The ntlm_auth, which is external to squid and
>> part of the samba package, doesnt' change between version
>> uprgrades, so I don't see how it can be involved (and why replace
>> it with a fake helper ?). In the same time it's an authentication
>> helper. The squid_kerb_ldap, also known as
>> ext_kerberos_ldap_group_acl, is, indeed, an "external acl" helper,
>> but it has nothing to do with NTLM, as it doesn't use it. My
>> opinion - this pr is flooded with error messages of almost any
>> kind, and it's very hard to see the point.
>>
>> We need to understand what's happening to squid when it starts to
>> hit the 100% CPU usage, last time I saw this during the night
>> without any possible user traffic load.
>>
>> Eugene.
>
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1
>
> iQEcBAEBAgAGBQJUSkrVAAoJENxnfXtQ8ZQUp8UIAI2MUcnASF98RWQECoKFczS9
> E7SWOZMjQQLIy80NAId9MdiZ79XPNTF6a1VaGcdP4cAc78XgNqk6NdBF0eFIKSgy
> 31W48GGt8p0spJ0o8+NVijV9O/2pGcIW8M3psbnYG/fcgAzWq4DLz9Q/tFTtHsIa
> UzY56BMuSX1+0d2IeZSO2bXxEnOyiyAJKrQ96H/7tlg/9VV5mHOB7Py1b6G+O1YP
> nU/+vj4GppHYOYwPdqX9MwKfXwHzFPLHGXdafIJT1/Ci1ApEWW+137PMrvG1uvg3
> pzSF9amhAyBpAjIA1WRgoYb5gtUciK43K0EIXYkmZnmmuw3mEFOv4WWyDApFBgs=
> =TLyW
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From huaraz at moeller.plus.com  Sat Oct 25 14:22:52 2014
From: huaraz at moeller.plus.com (Markus Moeller)
Date: Sat, 25 Oct 2014 15:22:52 +0100
Subject: [squid-users] Kerberos Authentication Failing for Windows 7+
	with BH gss_accept_sec_context() failed
In-Reply-To: <75991CAE-5F10-4635-B012-D372C27F8AC4@gmail.com>
References: <40E1E0E7-50C6-4117-94AA-50B06573430A@gmail.com>
 <m2eqo7$cf9$1@ger.gmane.org> <FD6832B9-3F1F-48C6-A76F-47A224F1697B@gmail.com>
 <m2g7l9$1ee$1@ger.gmane.org> <75991CAE-5F10-4635-B012-D372C27F8AC4@gmail.com>
Message-ID: <m2gbo3$t4d$1@ger.gmane.org>

Hi Pedro,

   Good to know you solved it.  From your post it sounded like XP worked and Win 7 didn?t

Markus 


"Pedro Lobo" <palobo at gmail.com> wrote in message news:75991CAE-5F10-4635-B012-D372C27F8AC4 at gmail.com...
Hi Markus,

I initially had it configured as such and changed it to auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s HTTP/proxy01tst.fake.net as a troubleshooting step. I've since then changed it back. Dan pointed out earlier that it could be a permissions problem, and sure enough, permissions on /etc/squid3/PROXY.keytab were wrong (group had no read permissions). Fixing that seems to have sorted out the problem. I'll be doing more extensive testes on Monday when the test group start surfing the web.

Thanks for all the help!

On 25 Oct 2014, at 14:13, Markus Moeller wrote:

  Hi Pedro,

  I wonder if he upper case in the name is a problem. Can you try

  auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s GSS_C_NO_NAME

  instead of

  auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s HTTP/proxy01tst.fake.net

  Markus

  "Pedro Lobo" palobo at gmail.com wrote in message news:FD6832B9-3F1F-48C6-A76F-47A224F1697B at gmail.com...
  Hi Markus,

  I used msktutil to create the keytab.

  msktutil -c -s HTTP/proxy01tst.fake.net -h proxy01tst.fake.net -k /etc/squid3/PROXY.keytab --computer-name proxy01-tst --upn HTTP/proxy01tst.fake.net --server srv01.fake.net --verbose
  Output of klist -ekt:

  2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (arcfour-hmac)
  2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (aes128-cts-hmac-sha1-96)
  2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (aes256-cts-hmac-sha1-96)
  2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET (arcfour-hmac)
  2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET (aes128-cts-hmac-sha1-96)
  2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET (aes256-cts-hmac-sha1-96)
  2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET (arcfour-hmac)
  2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET (aes128-cts-hmac-sha1-96)
  2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET (aes256-cts-hmac-sha1-96)
  Yep, using MIT Kerberos

  Thanks in advance for any help.

  Cheers,
  Pedro

  On 25 Oct 2014, at 1:26, Markus Moeller wrote:

  Hi Pedro,

  How did you create your keytab ? What does klist ?ekt <squid.keytab> show ( I assume you use MIT Kerberos) ?

  Markus

  "Pedro Lobo" palobo at gmail.com wrote in message news:40E1E0E7-50C6-4117-94AA-50B06573430A at gmail.com...
  Hi Squid Gurus,

  I'm at my wit's end and in dire need of some squid expertise.

  We've got a production environment with a couple of squid 2.7 servers using NTLM and basic authentication. Recently though, we decided to upgrade and I'm now setting up squid 3.3 with Kerberos and NTLM Fallback. I've followed just about every guide I could find and in my testing environment, things were working great. Now that I've hooked it up to the main domain, things are awry.

  If I use a machine that's not part of the domain, NTLM kicks in and I can surf the web fine. If I use a Windows XP or Windows Server 2003, kerberos works just fine, however, if I use a machine Windows 7, 8 or 2008 server, I keep getting a popup asking me to authenticate and even then, it's and endless loop until it fails. My cache.log is littered with:

  negotiate_kerberos_auth.cc(200): pid=1607 :2014/10/24 23:03:01| negotiate_kerberos_auth: ERROR: gss_accept_sec_context() failed: Unspecified GSS failure. Minor code may provide more information.
  2014/10/24 23:03:01| ERROR: Negotiate Authentication validating user. Error returned 'BH gss_accept_sec_context() failed: Unspecified GSS failure. Minor code may provide more information. '
  The odd thing, is that this has worked before. Help me Obi Wan... You're my only hope! :)

  Current Setup
  Squid 3.3 running on Ubuntu 14.04 server. It's connected to a 2003 server with function level 2000 (I know, we're trying to fase out the older servers).

  krb5.conf

  [libdefaults]
  default_realm = FAKE.NET
  dns_lookup_kdc = yes
  dns_lookup_realm = yes
  ticket_lifetime = 24h
  default_keytab_name = /etc/squid3/PROXY.keytab

  ; for Windows 2003
  default_tgs_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
  default_tkt_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
  permitted_enctypes = rc4-hmac des-cbc-crc des-cbc-md5

  [realms]
  FAKE.NET = {
  kdc = srv01.fake.net
  kdc = srv02.fake.net
  kdc = srv03.fake.net
  admin_server = srv01.fake.net
  default_domain = fake.net
  }

  [domain_realm]
  .fake.net = FAKE.NET
  fake.net = FAKE.NET

  [logging]
  kdc = FILE:/var/log/kdc.log
  admin_server = FILE:/var/log/kadmin.log
  default = FILE:/var/log/krb5lib.log
  squid.conf

  auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s HTTP/proxy01tst.fake.net
  auth_param negotiate children 20 startup=0 idle=1
  auth_param negotiate keep_alive off

  auth_param ntlm program /usr/bin/ntlm_auth --diagnostics --helper-protocol=squid-2.5-ntlmssp --domain=FAKE.NET
  auth_param ntlm children 10
  auth_param ntlm keep_alive off
  Cheers,
  Pedro

  Cumprimentos
  Pedro Lobo
  Solutions Architect | System Engineer

  pedro.lobo at pt.clara.net
  Tlm.: +351 939 528 827 | Tel.: +351 214 127 314

  Claranet Portugal
  Ed. Parque Expo
  Av. D. Jo?o II, 1.07-2.1, 4? Piso
  1998-014 Lisboa
  www.claranet.pt

  Empresa certificada ISO 9001, ISO 20000 e ISO 27001


------------------------------------------------------------------------------

------------------------------------------------------------------------------

  squid-users mailing list
  squid-users at lists.squid-cache.org
  http://lists.squid-cache.org/listinfo/squid-users


------------------------------------------------------------------------------

  squid-users mailing list
  squid-users at lists.squid-cache.org
  http://lists.squid-cache.org/listinfo/squid-users

  Cumprimentos
  Pedro Lobo
  Solutions Architect | System Engineer

  pedro.lobo at pt.clara.net
  Tlm.: +351 939 528 827 | Tel.: +351 214 127 314

  Claranet Portugal
  Ed. Parque Expo
  Av. D. Jo?o II, 1.07-2.1, 4? Piso
  1998-014 Lisboa
  www.claranet.pt

  Empresa certificada ISO 9001, ISO 20000 e ISO 27001


------------------------------------------------------------------------------

------------------------------------------------------------------------------

  squid-users mailing list
  squid-users at lists.squid-cache.org
  http://lists.squid-cache.org/listinfo/squid-users


------------------------------------------------------------------------------

  squid-users mailing list
  squid-users at lists.squid-cache.org
  http://lists.squid-cache.org/listinfo/squid-users



--------------------------------------------------------------------------------
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141025/2161dfa9/attachment.htm>

From palobo at gmail.com  Sat Oct 25 14:45:07 2014
From: palobo at gmail.com (Pedro Lobo)
Date: Sat, 25 Oct 2014 15:45:07 +0100
Subject: [squid-users] Kerberos Authentication Failing for Windows 7+
 with BH gss_accept_sec_context() failed
In-Reply-To: <m2gbo3$t4d$1@ger.gmane.org>
References: <40E1E0E7-50C6-4117-94AA-50B06573430A@gmail.com>
 <m2eqo7$cf9$1@ger.gmane.org> <FD6832B9-3F1F-48C6-A76F-47A224F1697B@gmail.com>
 <m2g7l9$1ee$1@ger.gmane.org> <75991CAE-5F10-4635-B012-D372C27F8AC4@gmail.com>
 <m2gbo3$t4d$1@ger.gmane.org>
Message-ID: <90F52B7C-0FEE-4760-B204-FC544B348AA0@gmail.com>

Hi Markus,

Yeah, it seemed so at the time. I tested with the same user on a Windows 7 and 2003 server. Worked fine on one and not the other. Since correcting permissions on the keytab file it's working fine on both. Could also be a total coincidence honestly. I've tried so many things I lost track to tell you the truth, but I'll be sure to update you on Monday (hopefully with good news).

Cheers,
Pedro 


On 25 Oct 2014, at 15:22, Markus Moeller wrote:

> Hi Pedro,
>
> Good to know you solved it.  From your post it sounded like XP worked and Win 7 didn?t
>
> Markus
>
>
> "Pedro Lobo" <palobo at gmail.com> wrote in message news:75991CAE-5F10-4635-B012-D372C27F8AC4 at gmail.com...
> Hi Markus,
>
> I initially had it configured as such and changed it to auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s HTTP/proxy01tst.fake.net as a troubleshooting step. I've since then changed it back. Dan pointed out earlier that it could be a permissions problem, and sure enough, permissions on /etc/squid3/PROXY.keytab were wrong (group had no read permissions). Fixing that seems to have sorted out the problem. I'll be doing more extensive testes on Monday when the test group start surfing the web.
>
> Thanks for all the help!
>
> On 25 Oct 2014, at 14:13, Markus Moeller wrote:
>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 536 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141025/754fa69f/attachment.sig>

From diego at woitasen.com.ar  Sat Oct 25 15:17:23 2014
From: diego at woitasen.com.ar (Diego Woitasen)
Date: Sat, 25 Oct 2014 12:17:23 -0300
Subject: [squid-users] 3.3.x -> 3.4.x: huge performance regression
In-Reply-To: <CAFKaCCSS_Mo0MWfxtM_Zp3fs-8iVrZcE7-EaO9x4aC+iVjYn8Q@mail.gmail.com>
References: <5447486B.3010205@norma.perm.ru> <5448C7FB.1080104@ngtech.co.il>
 <1FCF9DA5B29068478ECF15896F19F0840138A509A8@Y011008.bk.fin.local>
 <544A4390.3090903@norma.perm.ru> <544A4AD5.6040804@ngtech.co.il>
 <CAFKaCCSS_Mo0MWfxtM_Zp3fs-8iVrZcE7-EaO9x4aC+iVjYn8Q@mail.gmail.com>
Message-ID: <CAA7UhcmzjjT=nyu-Ep6CUn09-GAE=f2DjEJxS1KQVk3K7zAeqw@mail.gmail.com>

On Sat, Oct 25, 2014 at 11:20 AM, Alan <lameventanas at gmail.com> wrote:
> I had the same problem when I tried to move from 3.3 to 3.4.  Because
> of this, I had to go back to 3.3.
>
> I don't remember the CPU being stuck at 100%, but it was certainly
> higher, and the Internet browsing experience was slower.
>
> I don't use the NTLM helper, but I do use the Kerberos one, and also a
> couple of custom external acls.
>
> Alan
>
>
> On Fri, Oct 24, 2014 at 9:49 PM, Eliezer Croitoru <eliezer at ngtech.co.il> wrote:
>> -----BEGIN PGP SIGNED MESSAGE-----
>> Hash: SHA1
>>
>> Hey Eugene,
>>
>> I will try to clear things out.
>> Any helper is an external software but each and every one of them
>> answers to a specific logic.
>> external_acl url_rewrite and store_id helpers works in one way while
>> authentication works in another.
>>
>> To make the story short external_acl url_rewrite and store_id helpers
>> acquire a single line from squid via STDIN and responses to his own
>> STDOUT towards squid STDIN.
>> an example would be:
>> 1 http://www.yahoo.com "more things such as requester and others"
>>
>> The helper responses to this with a line such as:
>> 1 ERR
>> or
>> 1 OK "more stuff"
>>
>> The above example applies only to squid 3.4 while in squid 3.3 this is
>> being used only on the external_acl interface.
>>
>> In auth helpers there are couple "stages" that applies on each requests.
>> In external_acl and the similar interfaces the client do not need to
>> send any details for the helper to analyze else then these that exists
>> on each request.
>> Auth helpers has a logic that denies with request for more details.
>> NTLM specifically has overload on the whole process since it can have
>> 3 stages against squid.
>> Kerberous has the benefit of only 2 stages against squid:
>> 1 - request -> denial
>> 2 - request + credentials -> denial or approval
>>
>> Comparing NTLM to external_acl helpers it is very different.
>> But comparing Kerberous to external_acl it's almost similar.
>>
>> If for example NTML + Kerberous + external_acl + others suffers from
>> the same issue while using only one of them at a time it will prove
>> that there is a specific direction to the issue.
>> But if Kerberous and NTLM differ it will prove that there are other
>> things in hand.
>>
>> Another approach to test the issue is to write an ECAP or ICAP helper
>> that will implement the whole authentication logic.
>> This will also prove that the helpers code is broken in 3.4 compared
>> to 3.3.
>>
>> There is also the comparison of basic authentication compared to NTLM
>> + Keberous which is also important.
>>
>> The squid team needs a testing environment for the issue for quite
>> some time.
>>
>> Now that Victor Sudakov has used Kerberous instead of NTLM we might be
>> able to put some efforts and to pinpoint the issue.
>>
>> All The Bests,
>> Eliezer
>>
>> On 10/24/2014 03:18 PM, Eugene M. Zheganin wrote:
>>>> see http://bugs.squid-cache.org/show_bug.cgi?id=3997
>>> There seems to be a large mix of terms, like "external helper" and
>>> "external program". The ntlm_auth, which is external to squid and
>>> part of the samba package, doesnt' change between version
>>> uprgrades, so I don't see how it can be involved (and why replace
>>> it with a fake helper ?). In the same time it's an authentication
>>> helper. The squid_kerb_ldap, also known as
>>> ext_kerberos_ldap_group_acl, is, indeed, an "external acl" helper,
>>> but it has nothing to do with NTLM, as it doesn't use it. My
>>> opinion - this pr is flooded with error messages of almost any
>>> kind, and it's very hard to see the point.
>>>
>>> We need to understand what's happening to squid when it starts to
>>> hit the 100% CPU usage, last time I saw this during the night
>>> without any possible user traffic load.
>>>
>>> Eugene.
>>
>> -----BEGIN PGP SIGNATURE-----
>> Version: GnuPG v1
>>
>> iQEcBAEBAgAGBQJUSkrVAAoJENxnfXtQ8ZQUp8UIAI2MUcnASF98RWQECoKFczS9
>> E7SWOZMjQQLIy80NAId9MdiZ79XPNTF6a1VaGcdP4cAc78XgNqk6NdBF0eFIKSgy
>> 31W48GGt8p0spJ0o8+NVijV9O/2pGcIW8M3psbnYG/fcgAzWq4DLz9Q/tFTtHsIa
>> UzY56BMuSX1+0d2IeZSO2bXxEnOyiyAJKrQ96H/7tlg/9VV5mHOB7Py1b6G+O1YP
>> nU/+vj4GppHYOYwPdqX9MwKfXwHzFPLHGXdafIJT1/Ci1ApEWW+137PMrvG1uvg3
>> pzSF9amhAyBpAjIA1WRgoYb5gtUciK43K0EIXYkmZnmmuw3mEFOv4WWyDApFBgs=
>> =TLyW
>> -----END PGP SIGNATURE-----
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

Same problem here. New users, only a few users from IT testing it and
CPU usage is really high from time to time.

Switched to basic auth for a few days. Looks like everybody is having
issues with NTLM/SPNEGO.

Keep in touch and we'll fix it :)

Regards,
   Diego

-- 
Diego Woitasen
Infrastructure Developer, DevOps Engineer, Linux and Open Source expert
http://www.woitasen.com.ar


From eliezer at ngtech.co.il  Sat Oct 25 16:50:36 2014
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Sat, 25 Oct 2014 19:50:36 +0300
Subject: [squid-users] 3.3.x -> 3.4.x: huge performance regression
In-Reply-To: <CAA7UhcmzjjT=nyu-Ep6CUn09-GAE=f2DjEJxS1KQVk3K7zAeqw@mail.gmail.com>
References: <5447486B.3010205@norma.perm.ru> <5448C7FB.1080104@ngtech.co.il>
 <1FCF9DA5B29068478ECF15896F19F0840138A509A8@Y011008.bk.fin.local>
 <544A4390.3090903@norma.perm.ru> <544A4AD5.6040804@ngtech.co.il>
 <CAFKaCCSS_Mo0MWfxtM_Zp3fs-8iVrZcE7-EaO9x4aC+iVjYn8Q@mail.gmail.com>
 <CAA7UhcmzjjT=nyu-Ep6CUn09-GAE=f2DjEJxS1KQVk3K7zAeqw@mail.gmail.com>
Message-ID: <544BD4DC.7070900@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hey Diego,

Can you take a look at the bug report and help pinpoint the issue please?
http://bugs.squid-cache.org/show_bug.cgi?id=3997

I am pretty sure it's unique to auth only but I want to verify that
external_acl helpers do not affect this issue.

Also if you can share the testing environment details or we can get
some help with testing from your IT testing team?

Thanks,
Eliezer


On 10/25/2014 06:17 PM, Diego Woitasen wrote:
> Same problem here. New users, only a few users from IT testing it
> and CPU usage is really high from time to time.
> 
> Switched to basic auth for a few days. Looks like everybody is
> having issues with NTLM/SPNEGO.
> 
> Keep in touch and we'll fix it :)
> 
> Regards, Diego

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUS9TcAAoJENxnfXtQ8ZQU4EEIAIKeKjvzrPSlj8UlGUaWHhT+
64ontOl7wiYdyo1rjU1MWZxg+6erlVVYg5p46Ki/bznes/on70peU6UndzInLA0K
JACZEq0P6eQBDQjP0eVfRbSVo4QeMA/+1prDZY8GAwyI3ugSWndeAT2dqVQFkVdt
x3OxXc5ch4nfV9ZF4HPAMKRp6mey4LJjixTToIw9CsoDpcAE7UAWuXi//JOHMqmp
b6ZONdhOBCJajWebhEHbUwNbciZVeCgGWXJGuyVA8kp0ChkFTtBnC7BpNjWRC3hL
rH5cJcfJXyFLoG67qZaPTueakk5aII8Aj2DkPauK2ofQAOjlLL6gh45GiO1oeJ0=
=sV5l
-----END PGP SIGNATURE-----


From J.Xu at uws.edu.au  Sun Oct 26 22:42:26 2014
From: J.Xu at uws.edu.au (Julie Xu)
Date: Sun, 26 Oct 2014 22:42:26 +0000
Subject: [squid-users] problem with squid_ldap_auth
Message-ID: <ABCD499AC5326B4F828DBB3933CFE87E7108A158@HIRT.AD.UWS.EDU.AU>

Do not see any reply, but, I found the problem. For the new squid, you have to put ACL for blockuser, even the older squid and new squid say  they are same version, but, actually, different.


From: Julie Xu
Sent: Friday, 24 October 2014 11:41 AM
To: 'squid-users at lists.squid-cache.org'
Subject: problem with squid_ldap_auth

Hi

I have squid installed and trying to contact Ldap.

Below command is working for older squid, but not new one and both server are Redhat 6.5 (Santiago)

auth_param basic program /usr/lib64/squid/squid_ldap_auth -b ou=xx,dc=xx,dc=xx,dc=xx,dc=xx -f (&(cn=%s)(objectClass=*)) -u cn -s sub -P -c 5 -t 5 -R -a never -D cn=Lookup,ou=xx,dc=xx,dc=xx,dc=xx,dc=xx -w xxxxx mydomain


error message is:

squid_ldap_auth: WARNING, could not bind to binddn 'Can't contact LDAP server'
squid_ldap_auth: WARNING, could not bind to binddn 'Can't contact LDAP server'
squid_ldap_auth: WARNING, could not bind to binddn 'Can't contact LDAP server'

to stop type isse, I have scp the squid.conf from older one to new one? And restart the squid; and also tried to copy firewall configuration over to new box, in case some firewall issue. It is still not help.

Could any one advice me what is the possible issue related?

Any comments will be appreciated

Thanks in advance

Julie

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141026/4988f2e5/attachment.htm>

From saleh.madi at hadara.ps  Mon Oct 27 11:17:18 2014
From: saleh.madi at hadara.ps (saleh madi)
Date: Mon, 27 Oct 2014 13:17:18 +0200 (IST)
Subject: [squid-users] squid 3.4.X multiple instances peering
In-Reply-To: <416140222.14594012.1414407674961.JavaMail.zimbra@hadara.ps>
Message-ID: <208697842.14595775.1414408638366.JavaMail.zimbra@hadara.ps>

Hello,

I have in the same box four squid 3.4.8 instances, I'm not using the workers Option. I will need to peering the multiple instances together to avoid duplication of objects. The below setting works for squid 2.7 but I have tested with squid 3.4.8 doesn't work.

In SQUID2:

cache_peer squid1 sibling 8181 0 no-netdb-exchange proxy-only no-delay no-tproxy
cache_peer squid3 sibling 65493 0 no-netdb-exchange proxy-only no-delay no-tproxy
cache_peer squid4 sibling 65492 0 no-netdb-exchange proxy-only no-delay no-tproxy

How to peering multiple squid 3.4.8 instances together to avoid duplication of objects.

Note: Not using the workers Option.

Thank you and Best Regards,
Saleh


From squid3 at treenet.co.nz  Mon Oct 27 11:51:21 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 28 Oct 2014 00:51:21 +1300
Subject: [squid-users] squid 3.4.X multiple instances peering
In-Reply-To: <208697842.14595775.1414408638366.JavaMail.zimbra@hadara.ps>
References: <208697842.14595775.1414408638366.JavaMail.zimbra@hadara.ps>
Message-ID: <544E31B9.5040904@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 28/10/2014 12:17 a.m., saleh madi wrote:
> Hello,
> 
> I have in the same box four squid 3.4.8 instances, I'm not using
> the workers Option. I will need to peering the multiple instances
> together to avoid duplication of objects. The below setting works
> for squid 2.7 but I have tested with squid 3.4.8 doesn't work.
> 

It should work, but no guarantees. SMP support is always enabled, even
if workers are not used.

You may need the 3.5 (beta) series with service name (-n) command line
switch for multiple instances of Squid-3.


NP: if you are doing the peering just to avoid duplicating objects
look at using the rock cache type with workers instead. Also, with the
3.5 series there is no object size limitation on rock storage, like
with current stable series.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUTjG5AAoJELJo5wb/XPRj+j0H/idD3xSuMKIjH0wc7NzrLY9D
WV2Jkz4WKSMKd7myo5/i/qPCcX6BWQBeygetC888/Xd8JQy7kEYkpc01sSo/vGpr
0GiKeiDS50othiAdiSUolvEahEJEHAdgXQScZIHGvzX/2A0XvQhcH7sLxa1dDpHb
YhpA5C1ZM92eVdUBG0opAQlbvPKc2n4lDhHUGcTdzugXQ2XQbCYl0cLoamfqsKji
MD6V1saw+2rUbc/LEz5jgT9OzSyzaBoCBN/7OXDTrI9xMnj99VH7NXdX/eqxq1p0
4dvSfCV26PR+BRBJ/YXjgwjbKje1Z9Pl9j4e6iCmpuoz9+2nr8xgiAPnBQoASg0=
=4VEB
-----END PGP SIGNATURE-----


From jorgevisentini at gmail.com  Mon Oct 27 11:55:32 2014
From: jorgevisentini at gmail.com (Jorge Visentini)
Date: Mon, 27 Oct 2014 09:55:32 -0200
Subject: [squid-users] Delay Class 3 - Squid
Message-ID: <CAG=j6fpDQp5jtBc1DtZXxS7y3OYOzB47CHukSnoWEmNyfTEweA@mail.gmail.com>

Hello!

Sorry my english.

I'm racking my brain to figure out why the error.

I've used a long time ago a rule delay pool but this time I am not able to
implement ...

In my squid.conf looks like this:
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141027/e7ec3951/attachment.htm>

From jorgevisentini at gmail.com  Mon Oct 27 11:57:08 2014
From: jorgevisentini at gmail.com (Jorge Visentini)
Date: Mon, 27 Oct 2014 09:57:08 -0200
Subject: [squid-users] Delay Class 3 - Squid
Message-ID: <CAG=j6fq0HVFY=7EqtZ7SDgBRdVwfbSCtZubj-_nSv5ehWsOTPw@mail.gmail.com>

Hello!

Sorry my english.

I'm racking my brain to figure out why the error.

I've used a long time ago a rule delay pool but this time I am not able to
implement ...

In my squid.conf looks like this:

delay_pools 1
delay_class 1 3
delay_parameters 1 50000/50000 24000/24000
delay_access 1 allow redeLOCAL


I am not able to work, giving the error is as follows:

[root at jmtpoax03 squid]# squid -k reconfigure
FATAL: Bungled /etc/squid/squid.conf line 136: delay_parameters 1
50000/50000 24000/24000
Squid Cache (Version 3.HEAD-20140127-r13248): Terminated abnormally.
CPU Usage: 0.032 seconds = 0.018 user + 0.014 sys
Maximum Resident Size: 29008 KB
Page faults with physical i/o: 0
[root at jmtpoax03 squid]#

Can someone help me?

Thank you!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141027/f1a7c2df/attachment.htm>

From squid3 at treenet.co.nz  Mon Oct 27 12:01:34 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 28 Oct 2014 01:01:34 +1300
Subject: [squid-users] Delay Class 3 - Squid
In-Reply-To: <CAG=j6fq0HVFY=7EqtZ7SDgBRdVwfbSCtZubj-_nSv5ehWsOTPw@mail.gmail.com>
References: <CAG=j6fq0HVFY=7EqtZ7SDgBRdVwfbSCtZubj-_nSv5ehWsOTPw@mail.gmail.com>
Message-ID: <544E341E.7080801@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 28/10/2014 12:57 a.m., Jorge Visentini wrote:
> Hello!
> 
> Sorry my english.
> 
> I'm racking my brain to figure out why the error.
> 
> I've used a long time ago a rule delay pool but this time I am not
> able to implement ...
> 
> In my squid.conf looks like this:
> 
> delay_pools 1 delay_class 1 3 delay_parameters 1 50000/50000
> 24000/24000

http://www.squid-cache.org/Doc/config/delay_parameters/

class 1 pools only have one speed parameter. Not two.


Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUTjQeAAoJELJo5wb/XPRjm0IH/3Fwh9VhfFOhpMfn1Z20ii2b
49SC9fhyMmVfoNdm49uOY9txb/7VDQpfRtb4yvNcAJJ+t0soNRlz8wcYrvJHeu52
HMG1te3wySXVZgar/DzQbsI/k15Ar2uuUVmJJ/rkQextBjftqXF7HLXo6kBNRLG7
xcwSSrtGy9SIY8yOZflz+4ANJr5Z1Fme1w2Cp88UXXBLuKXZ3JNeQrte06aRpJkn
KwWQwSLwv3KGF48PbuLRD2M8flA/eFkoqg0VK0CRzjytGwxb/b0OIE9shl/GH2A0
oEcWVowZHqAXSsSbbpW9GIyNpKoxjndY80VBijaTvvXj+tBQK2DaIse7e7NaEGc=
=tJHs
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Mon Oct 27 12:06:13 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 28 Oct 2014 01:06:13 +1300
Subject: [squid-users] Delay Class 3 - Squid
In-Reply-To: <544E341E.7080801@treenet.co.nz>
References: <CAG=j6fq0HVFY=7EqtZ7SDgBRdVwfbSCtZubj-_nSv5ehWsOTPw@mail.gmail.com>
 <544E341E.7080801@treenet.co.nz>
Message-ID: <544E3535.7050805@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 28/10/2014 1:01 a.m., Amos Jeffries wrote:
> On 28/10/2014 12:57 a.m., Jorge Visentini wrote:
>> Hello!
> 
>> Sorry my english.
> 
>> I'm racking my brain to figure out why the error.
> 
>> I've used a long time ago a rule delay pool but this time I am
>> not able to implement ...
> 
>> In my squid.conf looks like this:
> 
>> delay_pools 1 delay_class 1 3 delay_parameters 1 50000/50000 
>> 24000/24000
> 
> http://www.squid-cache.org/Doc/config/delay_parameters/
> 
> class 1 pools only have one speed parameter. Not two.
> 

Meh, sorry. I mean class 3 has 3 parameters.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUTjU1AAoJELJo5wb/XPRjHYAIAI2oAOpjZTgsTlbdz20LZW+k
XAAAnm8QgJSDBI7ErmZAJ7AxJILfi2PR2M60411mN5AgrVYulofUriTebS13bguR
g0aoFmVMBj003T70sNZWwSgyf18Gr9ewu5X6sOSu1IdQg6M9VMJFaUUMs+FFy2bs
IOqfhEhkcszlz0wrmY+xhAxR7mm8qWenrRk47W6rQR90p5Ml5m6ha0cCyTMTo46H
euojiX3JHvbFa3NtoOiNTmNOK7ZVt6bE/KTDSGobx6ehNtsUgKQgMBfyQ9ET2269
x8/MBDBjpK3JSld0UF3CjTkF8eWZHLAC+/Y6ZRR1vY6ihXi5B4yK7+Ve0ZvK5eU=
=7r5y
-----END PGP SIGNATURE-----


From cassiano at polaco.pro.br  Mon Oct 27 13:05:33 2014
From: cassiano at polaco.pro.br (Cassiano Martin)
Date: Mon, 27 Oct 2014 11:05:33 -0200
Subject: [squid-users] Filtering keywords on google search
In-Reply-To: <88EF58F000EC4B4684700C2AA3A73D7A04F5323FBEE4@W2008DC01.ColliniConsulting.lan>
References: <88EF58F000EC4B4684700C2AA3A73D7A04F5323FBEE4@W2008DC01.ColliniConsulting.lan>
Message-ID: <CAOoxthNmWSP7Xck4BpNxOO-wNNsGe3e4jkXgfvsLffeSbk9f2A@mail.gmail.com>

I have some proof of concept on my github. it can be done thought  DNS
hijacking. I modified a version of tinyproxy to enforce safe search.
you can check it out on https://github.com/polaco1782/tinyproxy

2014-10-25 9:49 GMT-02:00 Job <Job at colliniconsulting.it>:
> Hello, since Google switch definitely on SSL connection it seems there is no way to filter semantic (with danguardian, squidguard or squid).
>
> SSL Bump can help in this case, both on explicit or transparent proxying?
>
> Is there another way to filter searches (and image searches!)?
>
> Thank you!
> Francesco
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From franta at hanzlici.cz  Mon Oct 27 13:32:39 2014
From: franta at hanzlici.cz (Frantisek Hanzlik)
Date: Mon, 27 Oct 2014 14:32:39 +0100
Subject: [squid-users] how to obtain info about actual active downloads?
Message-ID: <544E4977.3050705@hanzlici.cz>

Please, what is best way for determining who squid clients (their
PC IP addresses) have which downloads active?
I want it to determine which clients burden our slow internet line.
Examining 'access.log' does not help much in this case, because users
can download large files and it may take a few minutes or hours (e.g.
in case of consuming some audio/video streams).

I tried inspecting informations in 'Client-side Active Requests' menu
in cachemgr.cgi, where are paragraphs as:

Connection: 0x7f442037aa48
	FD 94, read 5892, wrote 148211583
	FD desc: Reading next request
	in: buf 0x7f440efc9150, offset 0, size 4096
	remote: 192.168.1.44:1631
	local: 192.168.1.254:3128
	nrequests: 7
uri http://ice.abradio.cz/prachen64.mp3
logType TCP_MISS
out.offset 148178800, out.size 148179207
req_sz 724
entry 0x7f440d5d6220/A1AD3A830E803B23F9295A9BCB9C1949
start 1414389495.929684 (18515.473233 seconds ago)
username
delay_pool 0

which seems to contain the necessary items and it would not be a big
problem adjust them to shorter form using e.g. awk or sed script,
and this informations is possible obtain in batch with some as:

wget -q -O - 'http://localhost/Squid/cgi-bin/cachemgr.cgi?host=localhost&port=3128&user_name=&operation=active_requests'
or
lynx -dump 'http://localhost/Squid/cgi-bin/cachemgr.cgi?host=localhost&port=3128&user_name=&operation=active_requests'

But is this the correct way? Or Squid offers other tools for this
case? Or is possible cachemgr.cgi supply/enwrap with some filter
which output needed info in some customized format?
We are using squid-3.3.13/Linux i686 now, it run on our LAN internet
router, LAN has approx. twenty PCs.

Thanks in advance, Franta Hanzlik



From Antony.Stone at squid.open.source.it  Mon Oct 27 13:47:00 2014
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Mon, 27 Oct 2014 14:47:00 +0100
Subject: [squid-users] how to obtain info about actual active downloads?
In-Reply-To: <544E4977.3050705@hanzlici.cz>
References: <544E4977.3050705@hanzlici.cz>
Message-ID: <201410271447.00509.Antony.Stone@squid.open.source.it>

On Monday 27 October 2014 at 14:32:39 (EU time), Frantisek Hanzlik wrote:

> Please, what is best way for determining who squid clients (their
> PC IP addresses) have which downloads active?
> I want it to determine which clients burden our slow internet line.
> Examining 'access.log' does not help much in this case, because users
> can download large files and it may take a few minutes or hours (e.g.
> in case of consuming some audio/video streams).

I would use the tool 'iptraf', either running on your squid server, or on a 
machine which can sniff your internal network traffic (possibly with the use of a 
spanning port on the switch).

That can give you real-time bandwidth measurements per IP address.

Regards,


Antony.

-- 
Anything that improbable is effectively impossible.

 - Murray Gell-Mann, Nobel Prizewinner in Physics

                                                   Please reply to the list;
                                                         please *don't* CC me.


From leolistas at solutti.com.br  Mon Oct 27 16:37:43 2014
From: leolistas at solutti.com.br (Leonardo Rodrigues)
Date: Mon, 27 Oct 2014 14:37:43 -0200
Subject: [squid-users] how to obtain info about actual active downloads?
In-Reply-To: <201410271447.00509.Antony.Stone@squid.open.source.it>
References: <544E4977.3050705@hanzlici.cz>
 <201410271447.00509.Antony.Stone@squid.open.source.it>
Message-ID: <544E74D7.2030104@solutti.com.br>

On 27/10/14 11:47, Antony Stone wrote:
> On Monday 27 October 2014 at 14:32:39 (EU time), Frantisek Hanzlik wrote:
>
>> Please, what is best way for determining who squid clients (their
>> PC IP addresses) have which downloads active?
>> I want it to determine which clients burden our slow internet line.
>> Examining 'access.log' does not help much in this case, because users
>> can download large files and it may take a few minutes or hours (e.g.
>> in case of consuming some audio/video streams).
> I would use the tool 'iptraf', either running on your squid server, or on a
> machine which can sniff your internal network traffic (possibly with the use of a
> spanning port on the switch).
>
> That can give you real-time bandwidth measurements per IP address.
>

     I use this script:

http://samm.kiev.ua/sqstat/

     Set it to auto-update on 15/15 seconds, for example, and you'll 
have a great and easy way to evaluate active connections and high 
bandwidth use connections.

-- 


	Atenciosamente / Sincerily,
	Leonardo Rodrigues
	Solutti Tecnologia
	http://www.solutti.com.br

	Minha armadilha de SPAM, N?O mandem email
	gertrudes at solutti.com.br
	My SPAMTRAP, do not email it





From palobo at gmail.com  Mon Oct 27 16:39:17 2014
From: palobo at gmail.com (Pedro Lobo)
Date: Mon, 27 Oct 2014 16:39:17 +0000
Subject: [squid-users] Kerberos Authentication Failing for Windows 7+
 with BH gss_accept_sec_context() failed
In-Reply-To: <m2g7l9$1ee$1@ger.gmane.org>
References: <40E1E0E7-50C6-4117-94AA-50B06573430A@gmail.com>
 <m2eqo7$cf9$1@ger.gmane.org> <FD6832B9-3F1F-48C6-A76F-47A224F1697B@gmail.com>
 <m2g7l9$1ee$1@ger.gmane.org>
Message-ID: <94F74226-F24B-4910-95B7-B86ACE815995@gmail.com>

Hey Everybody,

Seems as though I celebrated too soon on Saturday. Today things are back to not working for Windows 7+ machines and XP/2003 machines are working just fine.

I've also checked the permissions on the keytab file and they haven't changed since Saturday, so it's not that... ARGH!!!! 

Craving ideas and solutions right now... Pilot users are less than satisfied ;)

Cheers,
Pedro 

On 25 Oct 2014, at 14:13, Markus Moeller wrote:

> Hi Pedro,
>
> I wonder if he upper case in the name is a problem. Can you try
>
> auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s GSS_C_NO_NAME
>
> instead of
>
> auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s HTTP/proxy01tst.fake.net
>
> Markus
>
> "Pedro Lobo" <palobo at gmail.com> wrote in message news:FD6832B9-3F1F-48C6-A76F-47A224F1697B at gmail.com...
> Hi Markus,
>
> I used msktutil to create the keytab.
>
> msktutil -c -s HTTP/proxy01tst.fake.net -h proxy01tst.fake.net -k /etc/squid3/PROXY.keytab --computer-name proxy01-tst --upn HTTP/proxy01tst.fake.net --server srv01.fake.net --verbose
> Output of klist -ekt:
>
> 2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (arcfour-hmac)
> 2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (aes128-cts-hmac-sha1-96)
> 2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (aes256-cts-hmac-sha1-96)
> 2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET (arcfour-hmac)
> 2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET (aes128-cts-hmac-sha1-96)
> 2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET (aes256-cts-hmac-sha1-96)
> 2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET (arcfour-hmac)
> 2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET (aes128-cts-hmac-sha1-96)
> 2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET (aes256-cts-hmac-sha1-96)
> Yep, using MIT Kerberos
>
> Thanks in advance for any help.
>
> Cheers,
> Pedro
>
> On 25 Oct 2014, at 1:26, Markus Moeller wrote:
>
> Hi Pedro,
>
> How did you create your keytab ? What does klist ?ekt <squid.keytab> show ( I assume you use MIT Kerberos) ?
>
> Markus
>
> "Pedro Lobo" palobo at gmail.com wrote in message news:40E1E0E7-50C6-4117-94AA-50B06573430A at gmail.com...
> Hi Squid Gurus,
>
> I'm at my wit's end and in dire need of some squid expertise.
>
> We've got a production environment with a couple of squid 2.7 servers using NTLM and basic authentication. Recently though, we decided to upgrade and I'm now setting up squid 3.3 with Kerberos and NTLM Fallback. I've followed just about every guide I could find and in my testing environment, things were working great. Now that I've hooked it up to the main domain, things are awry.
>
> If I use a machine that's not part of the domain, NTLM kicks in and I can surf the web fine. If I use a Windows XP or Windows Server 2003, kerberos works just fine, however, if I use a machine Windows 7, 8 or 2008 server, I keep getting a popup asking me to authenticate and even then, it's and endless loop until it fails. My cache.log is littered with:
>
> negotiate_kerberos_auth.cc(200): pid=1607 :2014/10/24 23:03:01| negotiate_kerberos_auth: ERROR: gss_accept_sec_context() failed: Unspecified GSS failure. Minor code may provide more information.
> 2014/10/24 23:03:01| ERROR: Negotiate Authentication validating user. Error returned 'BH gss_accept_sec_context() failed: Unspecified GSS failure. Minor code may provide more information. '
> The odd thing, is that this has worked before. Help me Obi Wan... You're my only hope! :)
>
> Current Setup
> Squid 3.3 running on Ubuntu 14.04 server. It's connected to a 2003 server with function level 2000 (I know, we're trying to fase out the older servers).
>
> krb5.conf
>
> [libdefaults]
> default_realm = FAKE.NET
> dns_lookup_kdc = yes
> dns_lookup_realm = yes
> ticket_lifetime = 24h
> default_keytab_name = /etc/squid3/PROXY.keytab
>
> ; for Windows 2003
> default_tgs_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
> default_tkt_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
> permitted_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
>
> [realms]
> FAKE.NET = {
> kdc = srv01.fake.net
> kdc = srv02.fake.net
> kdc = srv03.fake.net
> admin_server = srv01.fake.net
> default_domain = fake.net
> }
>
> [domain_realm]
> .fake.net = FAKE.NET
> fake.net = FAKE.NET
>
> [logging]
> kdc = FILE:/var/log/kdc.log
> admin_server = FILE:/var/log/kadmin.log
> default = FILE:/var/log/krb5lib.log
> squid.conf
>
> auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s HTTP/proxy01tst.fake.net
> auth_param negotiate children 20 startup=0 idle=1
> auth_param negotiate keep_alive off
>
> auth_param ntlm program /usr/bin/ntlm_auth --diagnostics --helper-protocol=squid-2.5-ntlmssp --domain=FAKE.NET
> auth_param ntlm children 10
> auth_param ntlm keep_alive off
> Cheers,
> Pedro
>
> Cumprimentos
> Pedro Lobo
> Solutions Architect | System Engineer
>
> pedro.lobo at pt.clara.net
> Tlm.: +351 939 528 827 | Tel.: +351 214 127 314
>
> Claranet Portugal
> Ed. Parque Expo
> Av. D. Jo?o II, 1.07-2.1, 4? Piso
> 1998-014 Lisboa
> www.claranet.pt
>
> Empresa certificada ISO 9001, ISO 20000 e ISO 27001
>
>
> ------------------------------------------------------------------------------
>
> ------------------------------------------------------------------------------
>
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
> ------------------------------------------------------------------------------
>
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
> Cumprimentos
> Pedro Lobo
> Solutions Architect | System Engineer
>
> pedro.lobo at pt.clara.net
> Tlm.: +351 939 528 827 | Tel.: +351 214 127 314
>
> Claranet Portugal
> Ed. Parque Expo
> Av. D. Jo?o II, 1.07-2.1, 4? Piso
> 1998-014 Lisboa
> www.claranet.pt
>
>
>
>
>
> Empresa certificada ISO 9001, ISO 20000 e ISO 27001
>
>
>
>
> --------------------------------------------------------------------------------
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141027/219e87ff/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 536 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141027/219e87ff/attachment.sig>

From gecom at tubosider.it  Mon Oct 27 17:26:15 2014
From: gecom at tubosider.it (masterx81)
Date: Mon, 27 Oct 2014 10:26:15 -0700 (PDT)
Subject: [squid-users] Group check against AD
Message-ID: <1414430775554-4668078.post@n4.nabble.com>

Hi!
I'm trying to check if a user is present in a Group, and now i'm using the
following config:

external_acl_type memberof ttl=30 %LOGIN
/usr/local/squid/libexec/ext_ldap_group_acl -v 3 -R -K -b
"dc=domain,dc=local" -D squid at domain.local -W /etc/squid/ldappass.txt -f
"(&(objectclass=person)(sAMAccountName=%v)(memberof=cn=%g,ou=SQUID,ou=OU
domain,dc=domain,dc=local))" -h srv-dc1.domain.local

It work, but has some limits, for example if a user is only in the group of
interest it not pass (while adding a second Group that is the default Group
it works). Also, if a user is on some "sub" groups it not work.

I've tried also the kerb helper (with kerb configured and keytab working),
using shell commands it work, for example:
/usr/lib64/squid/ext_kerberos_ldap_group_acl -g "Internet libero" -D
"DOMAIN.LOCAL"
that converted in squid must be something like:
external_acl_type memberof ttl=30 %LOGIN
/usr/lib64/squid/ext_kerberos_ldap_group_acl -d -g "%g" -D "DOMAIN.LOCAL"
works (on shell, i've not tried the second syntax on squid), but with the
same limits.

There is a way to at least have the user in only one Group (that is the
default group)?
Thanks!




--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Group-check-against-AD-tp4668078.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From saleh.madi at hadara.ps  Mon Oct 27 18:07:31 2014
From: saleh.madi at hadara.ps (saleh madi)
Date: Mon, 27 Oct 2014 20:07:31 +0200 (IST)
Subject: [squid-users] squid 3.4.8 Eating all of the Bandwidth
In-Reply-To: <729519633.14630562.1414432883752.JavaMail.zimbra@hadara.ps>
Message-ID: <1340988345.14631088.1414433251141.JavaMail.zimbra@hadara.ps>

Hello,

Why squid 3.4.8 Eating all of the Bandwidth:

iptraf -d eth0 in the squid box

Incoming rates:  435007.2 kbits/sec                                                                                                                      
                 50974.2 packets/sec                                                                                                                    
                                                                                                                        
Outgoing rates:  276229.9 kbits/sec                                                                                                                       
                 45568.4 packets/sec   


squid config:

range_offset_limit 0
quick_abort_min 0
quick_abort_max 0

You see the difference between the Incoming rates and Outgoing rates is: 200M and more.

Thank you and Best Regards,
Saleh



From rafael.akchurin at diladele.com  Mon Oct 27 19:01:06 2014
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Mon, 27 Oct 2014 19:01:06 +0000
Subject: [squid-users] Filtering keywords on google search
In-Reply-To: <88EF58F000EC4B4684700C2AA3A73D7A04F5323FBEE4@W2008DC01.ColliniConsulting.lan>
References: <88EF58F000EC4B4684700C2AA3A73D7A04F5323FBEE4@W2008DC01.ColliniConsulting.lan>
Message-ID: <44e0e66e3e3b4a6f8acbcc4629bd7c0c@AM3PR04MB450.eurprd04.prod.outlook.com>

Hello Francesco,

You may want to look into ICAP servers for squid. The ICAP protocol was designed to allow content adaptation. Squid supports ICAP since version 3. Default stock Squid in CentOS for example allows for SSL Sump out of the box (not for Firefox though). This allows you to enforce safe search on Google and YouTube.

Best regards,
Rafael Akchurin


-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Job
Sent: Saturday, October 25, 2014 1:50 PM
To: squid-users at squid-cache.org
Subject: [squid-users] Filtering keywords on google search

Hello, since Google switch definitely on SSL connection it seems there is no way to filter semantic (with danguardian, squidguard or squid).

SSL Bump can help in this case, both on explicit or transparent proxying?

Is there another way to filter searches (and image searches!)?

Thank you!
Francesco
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

From huaraz at moeller.plus.com  Mon Oct 27 19:47:09 2014
From: huaraz at moeller.plus.com (Markus Moeller)
Date: Mon, 27 Oct 2014 19:47:09 -0000
Subject: [squid-users] Kerberos Authentication Failing for Windows 7+
	with BH gss_accept_sec_context() failed
In-Reply-To: <94F74226-F24B-4910-95B7-B86ACE815995@gmail.com>
References: <40E1E0E7-50C6-4117-94AA-50B06573430A@gmail.com>
 <m2eqo7$cf9$1@ger.gmane.org> <FD6832B9-3F1F-48C6-A76F-47A224F1697B@gmail.com>
 <m2g7l9$1ee$1@ger.gmane.org> <94F74226-F24B-4910-95B7-B86ACE815995@gmail.com>
Message-ID: <m2m7g0$9l7$1@ger.gmane.org>

Hi Pedro,

  Did you try the ?s GSS_C_NO_NAME option ? 

Markus

"Pedro Lobo" <palobo at gmail.com> wrote in message news:94F74226-F24B-4910-95B7-B86ACE815995 at gmail.com...
Hey Everybody,

Seems as though I celebrated too soon on Saturday. Today things are back to not working for Windows 7+ machines and XP/2003 machines are working just fine.

I've also checked the permissions on the keytab file and they haven't changed since Saturday, so it's not that... ARGH!!!! 

Craving ideas and solutions right now... Pilot users are less than satisfied ;)

Cheers,
Pedro 

On 25 Oct 2014, at 14:13, Markus Moeller wrote:

  Hi Pedro,

  I wonder if he upper case in the name is a problem. Can you try

  auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s GSS_C_NO_NAME

  instead of

  auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s HTTP/proxy01tst.fake.net

  Markus

  "Pedro Lobo" palobo at gmail.com wrote in message news:FD6832B9-3F1F-48C6-A76F-47A224F1697B at gmail.com...
  Hi Markus,

  I used msktutil to create the keytab.

  msktutil -c -s HTTP/proxy01tst.fake.net -h proxy01tst.fake.net -k /etc/squid3/PROXY.keytab --computer-name proxy01-tst --upn HTTP/proxy01tst.fake.net --server srv01.fake.net --verbose
  Output of klist -ekt:

  2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (arcfour-hmac)
  2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (aes128-cts-hmac-sha1-96)
  2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (aes256-cts-hmac-sha1-96)
  2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET (arcfour-hmac)
  2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET (aes128-cts-hmac-sha1-96)
  2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET (aes256-cts-hmac-sha1-96)
  2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET (arcfour-hmac)
  2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET (aes128-cts-hmac-sha1-96)
  2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET (aes256-cts-hmac-sha1-96)
  Yep, using MIT Kerberos

  Thanks in advance for any help.

  Cheers,
  Pedro

  On 25 Oct 2014, at 1:26, Markus Moeller wrote:

  Hi Pedro,

  How did you create your keytab ? What does klist ?ekt <squid.keytab> show ( I assume you use MIT Kerberos) ?

  Markus

  "Pedro Lobo" palobo at gmail.com wrote in message news:40E1E0E7-50C6-4117-94AA-50B06573430A at gmail.com...
  Hi Squid Gurus,

  I'm at my wit's end and in dire need of some squid expertise.

  We've got a production environment with a couple of squid 2.7 servers using NTLM and basic authentication. Recently though, we decided to upgrade and I'm now setting up squid 3.3 with Kerberos and NTLM Fallback. I've followed just about every guide I could find and in my testing environment, things were working great. Now that I've hooked it up to the main domain, things are awry.

  If I use a machine that's not part of the domain, NTLM kicks in and I can surf the web fine. If I use a Windows XP or Windows Server 2003, kerberos works just fine, however, if I use a machine Windows 7, 8 or 2008 server, I keep getting a popup asking me to authenticate and even then, it's and endless loop until it fails. My cache.log is littered with:

  negotiate_kerberos_auth.cc(200): pid=1607 :2014/10/24 23:03:01| negotiate_kerberos_auth: ERROR: gss_accept_sec_context() failed: Unspecified GSS failure. Minor code may provide more information.
  2014/10/24 23:03:01| ERROR: Negotiate Authentication validating user. Error returned 'BH gss_accept_sec_context() failed: Unspecified GSS failure. Minor code may provide more information. '
  The odd thing, is that this has worked before. Help me Obi Wan... You're my only hope! :)

  Current Setup
  Squid 3.3 running on Ubuntu 14.04 server. It's connected to a 2003 server with function level 2000 (I know, we're trying to fase out the older servers).

  krb5.conf

  [libdefaults]
  default_realm = FAKE.NET
  dns_lookup_kdc = yes
  dns_lookup_realm = yes
  ticket_lifetime = 24h
  default_keytab_name = /etc/squid3/PROXY.keytab

  ; for Windows 2003
  default_tgs_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
  default_tkt_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
  permitted_enctypes = rc4-hmac des-cbc-crc des-cbc-md5

  [realms]
  FAKE.NET = {
  kdc = srv01.fake.net
  kdc = srv02.fake.net
  kdc = srv03.fake.net
  admin_server = srv01.fake.net
  default_domain = fake.net
  }

  [domain_realm]
  .fake.net = FAKE.NET
  fake.net = FAKE.NET

  [logging]
  kdc = FILE:/var/log/kdc.log
  admin_server = FILE:/var/log/kadmin.log
  default = FILE:/var/log/krb5lib.log
  squid.conf

  auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s HTTP/proxy01tst.fake.net
  auth_param negotiate children 20 startup=0 idle=1
  auth_param negotiate keep_alive off

  auth_param ntlm program /usr/bin/ntlm_auth --diagnostics --helper-protocol=squid-2.5-ntlmssp --domain=FAKE.NET
  auth_param ntlm children 10
  auth_param ntlm keep_alive off
  Cheers,
  Pedro

  Cumprimentos
  Pedro Lobo
  Solutions Architect | System Engineer

  pedro.lobo at pt.clara.net
  Tlm.: +351 939 528 827 | Tel.: +351 214 127 314

  Claranet Portugal
  Ed. Parque Expo
  Av. D. Jo?o II, 1.07-2.1, 4? Piso
  1998-014 Lisboa
  www.claranet.pt

  Empresa certificada ISO 9001, ISO 20000 e ISO 27001


------------------------------------------------------------------------------

------------------------------------------------------------------------------

  squid-users mailing list
  squid-users at lists.squid-cache.org
  http://lists.squid-cache.org/listinfo/squid-users


------------------------------------------------------------------------------

  squid-users mailing list
  squid-users at lists.squid-cache.org
  http://lists.squid-cache.org/listinfo/squid-users

  Cumprimentos
  Pedro Lobo
  Solutions Architect | System Engineer

  pedro.lobo at pt.clara.net
  Tlm.: +351 939 528 827 | Tel.: +351 214 127 314

  Claranet Portugal
  Ed. Parque Expo
  Av. D. Jo?o II, 1.07-2.1, 4? Piso
  1998-014 Lisboa
  www.claranet.pt

  Empresa certificada ISO 9001, ISO 20000 e ISO 27001


------------------------------------------------------------------------------

------------------------------------------------------------------------------

  squid-users mailing list
  squid-users at lists.squid-cache.org
  http://lists.squid-cache.org/listinfo/squid-users


------------------------------------------------------------------------------

  squid-users mailing list
  squid-users at lists.squid-cache.org
  http://lists.squid-cache.org/listinfo/squid-users



--------------------------------------------------------------------------------
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141027/5bba407e/attachment.htm>

From palobo at gmail.com  Mon Oct 27 20:25:46 2014
From: palobo at gmail.com (Pedro Lobo)
Date: Mon, 27 Oct 2014 20:25:46 +0000
Subject: [squid-users] Kerberos Authentication Failing for Windows 7+
 with BH gss_accept_sec_context() failed
In-Reply-To: <m2m7g0$9l7$1@ger.gmane.org>
References: <40E1E0E7-50C6-4117-94AA-50B06573430A@gmail.com>
 <m2eqo7$cf9$1@ger.gmane.org>
 <FD6832B9-3F1F-48C6-A76F-47A224F1697B@gmail.com>
 <m2g7l9$1ee$1@ger.gmane.org>
 <94F74226-F24B-4910-95B7-B86ACE815995@gmail.com>
 <m2m7g0$9l7$1@ger.gmane.org>
Message-ID: <b4adceec-5a53-4212-b16c-106237fc4504@Pedros-iPhone>

Hi Markus Moeller,


Hi Markus,

Yeah, I'm currently using that option and permissions are correct too. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141027/aa59eeab/attachment.htm>

From huaraz at moeller.plus.com  Mon Oct 27 20:53:18 2014
From: huaraz at moeller.plus.com (Markus Moeller)
Date: Mon, 27 Oct 2014 20:53:18 -0000
Subject: [squid-users] Kerberos Authentication Failing for Windows 7+
	with BH gss_accept_sec_context() failed
In-Reply-To: <b4adceec-5a53-4212-b16c-106237fc4504@Pedros-iPhone>
References: <40E1E0E7-50C6-4117-94AA-50B06573430A@gmail.com>
 <m2eqo7$cf9$1@ger.gmane.org> <FD6832B9-3F1F-48C6-A76F-47A224F1697B@gmail.com>
 <m2g7l9$1ee$1@ger.gmane.org> <94F74226-F24B-4910-95B7-B86ACE815995@gmail.com>
 <m2m7g0$9l7$1@ger.gmane.org>
 <b4adceec-5a53-4212-b16c-106237fc4504@Pedros-iPhone>
Message-ID: <m2mbc1$b54$1@ger.gmane.org>

Hi Pedro,

   Can you capture the traffic from one Windows 7 on XP client on port 88 ( just after the login before access a website via squid until successful or unsuccessful accessing the website) using wireshark ?   Send me the .cap files to check.

Markus

"Pedro Lobo" <palobo at gmail.com> wrote in message news:b4adceec-5a53-4212-b16c-106237fc4504 at Pedros-iPhone...
Hi Markus Moeller,


Hi Markus,

Yeah, I'm currently using that option and permissions are correct too. 

On 27 Oct 2014 19:47, Markus Moeller wrote: 


  Hi Pedro,

    Did you try the ?s GSS_C_NO_NAME option ?

  Markus

  "Pedro Lobo" <palobo at gmail.com> wrote in message news:94F74226-F24B-4910-95B7-B86ACE815995 at gmail.com...
  Hey Everybody,

  Seems as though I celebrated too soon on Saturday. Today things are back to not working for Windows 7+ machines and XP/2003 machines are working just fine.

  I've also checked the permissions on the keytab file and they haven't changed since Saturday, so it's not that... ARGH!!!!

  Craving ideas and solutions right now... Pilot users are less than satisfied ;)

  Cheers,
  Pedro

  On 25 Oct 2014, at 14:13, Markus Moeller wrote:

    Hi Pedro,

    I wonder if he upper case in the name is a problem. Can you try

    auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s GSS_C_NO_NAME

    instead of

    auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s HTTP/proxy01tst.fake.net

    Markus

    "Pedro Lobo" palobo at gmail.com wrote in message news:FD6832B9-3F1F-48C6-A76F-47A224F1697B at gmail.com...
    Hi Markus,

    I used msktutil to create the keytab.

    msktutil -c -s HTTP/proxy01tst.fake.net -h proxy01tst.fake.net -k /etc/squid3/PROXY.keytab --computer-name proxy01-tst --upn HTTP/proxy01tst.fake.net --server srv01.fake.net --verbose
    Output of klist -ekt:

    2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (arcfour-hmac)
    2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (aes128-cts-hmac-sha1-96)
    2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (aes256-cts-hmac-sha1-96)
    2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET (arcfour-hmac)
    2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET (aes128-cts-hmac-sha1-96)
    2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET (aes256-cts-hmac-sha1-96)
    2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET (arcfour-hmac)
    2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET (aes128-cts-hmac-sha1-96)
    2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET (aes256-cts-hmac-sha1-96)
    Yep, using MIT Kerberos

    Thanks in advance for any help.

    Cheers,
    Pedro

    On 25 Oct 2014, at 1:26, Markus Moeller wrote:

    Hi Pedro,

    How did you create your keytab ? What does klist ?ekt <squid.keytab> show ( I assume you use MIT Kerberos) ?

    Markus

    "Pedro Lobo" palobo at gmail.com wrote in message news:40E1E0E7-50C6-4117-94AA-50B06573430A at gmail.com...
    Hi Squid Gurus,

    I'm at my wit's end and in dire need of some squid expertise.

    We've got a production environment with a couple of squid 2.7 servers using NTLM and basic authentication. Recently though, we decided to upgrade and I'm now setting up squid 3.3 with Kerberos and NTLM Fallback. I've followed just about every guide I could find and in my testing environment, things were working great. Now that I've hooked it up to the main domain, things are awry.

    If I use a machine that's not part of the domain, NTLM kicks in and I can surf the web fine. If I use a Windows XP or Windows Server 2003, kerberos works just fine, however, if I use a machine Windows 7, 8 or 2008 server, I keep getting a popup asking me to authenticate and even then, it's and endless loop until it fails. My cache.log is littered with:

    negotiate_kerberos_auth.cc(200): pid=1607 :2014/10/24 23:03:01| negotiate_kerberos_auth: ERROR: gss_accept_sec_context() failed: Unspecified GSS failure. Minor code may provide more information.
    2014/10/24 23:03:01| ERROR: Negotiate Authentication validating user. Error returned 'BH gss_accept_sec_context() failed: Unspecified GSS failure. Minor code may provide more information. '
    The odd thing, is that this has worked before. Help me Obi Wan... You're my only hope! :)

    Current Setup
    Squid 3.3 running on Ubuntu 14.04 server. It's connected to a 2003 server with function level 2000 (I know, we're trying to fase out the older servers).

    krb5.conf

    [libdefaults]
    default_realm = FAKE.NET
    dns_lookup_kdc = yes
    dns_lookup_realm = yes
    ticket_lifetime = 24h
    default_keytab_name = /etc/squid3/PROXY.keytab

    ; for Windows 2003
    default_tgs_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
    default_tkt_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
    permitted_enctypes = rc4-hmac des-cbc-crc des-cbc-md5

    [realms]
    FAKE.NET = {
    kdc = srv01.fake.net
    kdc = srv02.fake.net
    kdc = srv03.fake.net
    admin_server = srv01.fake.net
    default_domain = fake.net
    }

    [domain_realm]
    .fake.net = FAKE.NET
    fake.net = FAKE.NET

    [logging]
    kdc = FILE:/var/log/kdc.log
    admin_server = FILE:/var/log/kadmin.log
    default = FILE:/var/log/krb5lib.log
    squid.conf

    auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s HTTP/proxy01tst.fake.net
    auth_param negotiate children 20 startup=0 idle=1
    auth_param negotiate keep_alive off

    auth_param ntlm program /usr/bin/ntlm_auth --diagnostics --helper-protocol=squid-2.5-ntlmssp --domain=FAKE.NET
    auth_param ntlm children 10
    auth_param ntlm keep_alive off
    Cheers,
    Pedro

    Cumprimentos
    Pedro Lobo
    Solutions Architect | System Engineer

    pedro.lobo at pt.clara.net
    Tlm.: +351 939 528 827 | Tel.: +351 214 127 314

    Claranet Portugal
    Ed. Parque Expo
    Av. D. Jo?o II, 1.07-2.1, 4? Piso
    1998-014 Lisboa
    www.claranet.pt

    Empresa certificada ISO 9001, ISO 20000 e ISO 27001


----------------------------------------------------------------------------

----------------------------------------------------------------------------

    squid-users mailing list
    squid-users at lists.squid-cache.org
    http://lists.squid-cache.org/listinfo/squid-users


----------------------------------------------------------------------------

    squid-users mailing list
    squid-users at lists.squid-cache.org
    http://lists.squid-cache.org/listinfo/squid-users

    Cumprimentos
    Pedro Lobo
    Solutions Architect | System Engineer

    pedro.lobo at pt.clara.net
    Tlm.: +351 939 528 827 | Tel.: +351 214 127 314

    Claranet Portugal
    Ed. Parque Expo
    Av. D. Jo?o II, 1.07-2.1, 4? Piso
    1998-014 Lisboa
    www.claranet.pt

    Empresa certificada ISO 9001, ISO 20000 e ISO 27001


----------------------------------------------------------------------------

----------------------------------------------------------------------------

    squid-users mailing list
    squid-users at lists.squid-cache.org
    http://lists.squid-cache.org/listinfo/squid-users


----------------------------------------------------------------------------

    squid-users mailing list
    squid-users at lists.squid-cache.org
    http://lists.squid-cache.org/listinfo/squid-users



------------------------------------------------------------------------------
  _______________________________________________
  squid-users mailing list
  squid-users at lists.squid-cache.org
  http://lists.squid-cache.org/listinfo/squid-users



--------------------------------------------------------------------------------
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141027/33c772b8/attachment.htm>

From palobo at gmail.com  Mon Oct 27 22:21:19 2014
From: palobo at gmail.com (Pedro Lobo)
Date: Mon, 27 Oct 2014 22:21:19 +0000
Subject: [squid-users] Kerberos Authentication Failing for Windows 7+
	with BH gss_accept_sec_context() failed
In-Reply-To: <m2mbc1$b54$1@ger.gmane.org>
References: <40E1E0E7-50C6-4117-94AA-50B06573430A@gmail.com>
 <m2eqo7$cf9$1@ger.gmane.org> <FD6832B9-3F1F-48C6-A76F-47A224F1697B@gmail.com>
 <m2g7l9$1ee$1@ger.gmane.org> <94F74226-F24B-4910-95B7-B86ACE815995@gmail.com>
 <m2m7g0$9l7$1@ger.gmane.org>
 <b4adceec-5a53-4212-b16c-106237fc4504@Pedros-iPhone>
 <m2mbc1$b54$1@ger.gmane.org>
Message-ID: <09275CEC-ABC1-4BC6-B4F3-546E8C5D3B7E@gmail.com>

Hi Markus, 

When I get in to the office tomorrow, I'll do that and send you the .cap file. Thanks for all the help so far. 

Pedro Lobo

> On 27 Oct 2014, at 20:53, Markus Moeller <huaraz at moeller.plus.com> wrote:
> 
> Hi Pedro,
>  
>    Can you capture the traffic from one Windows 7 on XP client on port 88 ( just after the login before access a website via squid until successful or unsuccessful accessing the website) using wireshark ?    Send me the .cap files to check.
>  
> Markus
>  
> "Pedro Lobo" <palobo at gmail.com> wrote in message news:b4adceec-5a53-4212-b16c-106237fc4504 at Pedros-iPhone...
> Hi Markus Moeller,
> 
> 
> Hi Markus,
> 
> Yeah, I'm currently using that option and permissions are correct too.
> 
>> On 27 Oct 2014 19:47, Markus Moeller wrote: 
>> 
>> Hi Pedro,
>>  
>>   Did you try the ?s GSS_C_NO_NAME option ?
>>  
>> Markus
>>  
>> "Pedro Lobo" <palobo at gmail.com> wrote in message news:94F74226-F24B-4910-95B7-B86ACE815995 at gmail.com...
>> Hey Everybody,
>> 
>> Seems as though I celebrated too soon on Saturday. Today things are back to not working for Windows 7+ machines and XP/2003 machines are working just fine.
>> 
>> I've also checked the permissions on the keytab file and they haven't changed since Saturday, so it's not that... ARGH!!!!
>> 
>> Craving ideas and solutions right now... Pilot users are less than satisfied ;)
>> 
>> Cheers,
>> Pedro
>> 
>> On 25 Oct 2014, at 14:13, Markus Moeller wrote:
>> 
>> Hi Pedro,
>> 
>> I wonder if he upper case in the name is a problem. Can you try
>> 
>> auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s GSS_C_NO_NAME
>> 
>> instead of
>> 
>> auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s HTTP/proxy01tst.fake.net
>> 
>> Markus
>> 
>> "Pedro Lobo" palobo at gmail.com wrote in message news:FD6832B9-3F1F-48C6-A76F-47A224F1697B at gmail.com...
>> Hi Markus,
>> 
>> I used msktutil to create the keytab.
>> 
>> msktutil -c -s HTTP/proxy01tst.fake.net -h proxy01tst.fake.net -k /etc/squid3/PROXY.keytab --computer-name proxy01-tst --upn HTTP/proxy01tst.fake.net --server srv01.fake.net --verbose
>> Output of klist -ekt:
>> 
>> 2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (arcfour-hmac)
>> 2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (aes128-cts-hmac-sha1-96)
>> 2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (aes256-cts-hmac-sha1-96)
>> 2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET (arcfour-hmac)
>> 2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET (aes128-cts-hmac-sha1-96)
>> 2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET (aes256-cts-hmac-sha1-96)
>> 2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET (arcfour-hmac)
>> 2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET (aes128-cts-hmac-sha1-96)
>> 2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET (aes256-cts-hmac-sha1-96)
>> Yep, using MIT Kerberos
>> 
>> Thanks in advance for any help.
>> 
>> Cheers,
>> Pedro
>> 
>> On 25 Oct 2014, at 1:26, Markus Moeller wrote:
>> 
>> Hi Pedro,
>> 
>> How did you create your keytab ? What does klist ?ekt <squid.keytab> show ( I assume you use MIT Kerberos) ?
>> 
>> Markus
>> 
>> "Pedro Lobo" palobo at gmail.com wrote in message news:40E1E0E7-50C6-4117-94AA-50B06573430A at gmail.com...
>> Hi Squid Gurus,
>> 
>> I'm at my wit's end and in dire need of some squid expertise.
>> 
>> We've got a production environment with a couple of squid 2.7 servers using NTLM and basic authentication. Recently though, we decided to upgrade and I'm now setting up squid 3.3 with Kerberos and NTLM Fallback. I've followed just about every guide I could find and in my testing environment, things were working great. Now that I've hooked it up to the main domain, things are awry.
>> 
>> If I use a machine that's not part of the domain, NTLM kicks in and I can surf the web fine. If I use a Windows XP or Windows Server 2003, kerberos works just fine, however, if I use a machine Windows 7, 8 or 2008 server, I keep getting a popup asking me to authenticate and even then, it's and endless loop until it fails. My cache.log is littered with:
>> 
>> negotiate_kerberos_auth.cc(200): pid=1607 :2014/10/24 23:03:01| negotiate_kerberos_auth: ERROR: gss_accept_sec_context() failed: Unspecified GSS failure. Minor code may provide more information.
>> 2014/10/24 23:03:01| ERROR: Negotiate Authentication validating user. Error returned 'BH gss_accept_sec_context() failed: Unspecified GSS failure. Minor code may provide more information. '
>> The odd thing, is that this has worked before. Help me Obi Wan... You're my only hope! :)
>> 
>> Current Setup
>> Squid 3.3 running on Ubuntu 14.04 server. It's connected to a 2003 server with function level 2000 (I know, we're trying to fase out the older servers).
>> 
>> krb5.conf
>> 
>> [libdefaults]
>> default_realm = FAKE.NET
>> dns_lookup_kdc = yes
>> dns_lookup_realm = yes
>> ticket_lifetime = 24h
>> default_keytab_name = /etc/squid3/PROXY.keytab
>> 
>> ; for Windows 2003
>> default_tgs_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
>> default_tkt_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
>> permitted_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
>> 
>> [realms]
>> FAKE.NET = {
>> kdc = srv01.fake.net
>> kdc = srv02.fake.net
>> kdc = srv03.fake.net
>> admin_server = srv01.fake.net
>> default_domain = fake.net
>> }
>> 
>> [domain_realm]
>> .fake.net = FAKE.NET
>> fake.net = FAKE.NET
>> 
>> [logging]
>> kdc = FILE:/var/log/kdc.log
>> admin_server = FILE:/var/log/kadmin.log
>> default = FILE:/var/log/krb5lib.log
>> squid.conf
>> 
>> auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s HTTP/proxy01tst.fake.net
>> auth_param negotiate children 20 startup=0 idle=1
>> auth_param negotiate keep_alive off
>> 
>> auth_param ntlm program /usr/bin/ntlm_auth --diagnostics --helper-protocol=squid-2.5-ntlmssp --domain=FAKE.NET
>> auth_param ntlm children 10
>> auth_param ntlm keep_alive off
>> Cheers,
>> Pedro
>> 
>> Cumprimentos
>> Pedro Lobo
>> Solutions Architect | System Engineer
>> 
>> pedro.lobo at pt.clara.net
>> Tlm.: +351 939 528 827 | Tel.: +351 214 127 314
>> 
>> Claranet Portugal
>> Ed. Parque Expo
>> Av. D. Jo?o II, 1.07-2.1, 4? Piso
>> 1998-014 Lisboa
>> www.claranet.pt
>> 
>> Empresa certificada ISO 9001, ISO 20000 e ISO 27001
>> 
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>> 
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>> 
>> Cumprimentos
>> Pedro Lobo
>> Solutions Architect | System Engineer
>> 
>> pedro.lobo at pt.clara.net
>> Tlm.: +351 939 528 827 | Tel.: +351 214 127 314
>> 
>> Claranet Portugal
>> Ed. Parque Expo
>> Av. D. Jo?o II, 1.07-2.1, 4? Piso
>> 1998-014 Lisboa
>> www.claranet.pt
>> 
>> Empresa certificada ISO 9001, ISO 20000 e ISO 27001
>> 
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>> 
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>> 
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141027/c04f375f/attachment.htm>

From palobo at gmail.com  Mon Oct 27 22:22:35 2014
From: palobo at gmail.com (Pedro Lobo)
Date: Mon, 27 Oct 2014 22:22:35 +0000
Subject: [squid-users] Kerberos Authentication Failing for Windows 7+
	with BH gss_accept_sec_context() failed
In-Reply-To: <1F13F4C925B73F48A73307A32424FB8702075E51A0@chemsur-ex-01.emlchem.local>
References: <40E1E0E7-50C6-4117-94AA-50B06573430A@gmail.com>
 <m2eqo7$cf9$1@ger.gmane.org> <FD6832B9-3F1F-48C6-A76F-47A224F1697B@gmail.com>
 <m2g7l9$1ee$1@ger.gmane.org> <94F74226-F24B-4910-95B7-B86ACE815995@gmail.com>
 <m2m7g0$9l7$1@ger.gmane.org>
 <b4adceec-5a53-4212-b16c-106237fc4504@Pedros-iPhone>
 <1F13F4C925B73F48A73307A32424FB8702075E51A0@chemsur-ex-01.emlchem.local>
Message-ID: <2DB6E356-8CAA-4393-B7B9-E4DABE1AC8EF@gmail.com>

Thanks Paul,

I'll surely look into that too, but given that authentication seems o work for a day or so and then stop (was working Saturday, no longer today) I highly doubt it's related. Still worth checking I'm sure. 

Pedro Lobo

> On 27 Oct 2014, at 21:12, Paul Freeman <paul.freeman at emlchem.com.au> wrote:
> 
> Pedro,
> This sounds similar to a problem I had a couple of years ago when using Kerberos authentication with Squid (3.1.x) on Ubuntu (10.04 at that stage). (see RE: [squid-users] Re: Authentication using squid_kerb_auth with Internet Explorer 8 on Windows Server 2008 R2, squid-users group Nov 3 2010)
>  
> What I discovered after debugging the Kerberos authentication process with gdb was the MIT Kerberos version distributed with that version of Ubuntu did not support one of the encryption types requested by the newer versions of Windows (7, 2008).  This was a reported issue with the version of Kerberos used in Ubuntu.  I ended up patching the Ubuntu MIT Kerberos source (a trivial patch) and compiling the packages manually.  This corrected the problem.
>  
> I am unsure whether this is the root cause of your issue though but thought it might be worth mentioning.  I have not kept up with the MIT Kerberos packages included with Ubuntu 12.04 and 14.04 to know whether the patch is included in the later versions.
>  
> Regards
>  
> Paul
>  
> From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Pedro Lobo
> Sent: Tuesday, 28 October 2014 7:26 AM
> To: Markus Moeller
> Cc: squid-users at squid-cache.org
> Subject: Re: [squid-users] Kerberos Authentication Failing for Windows 7+ with BH gss_accept_sec_context() failed
>  
> Hi Markus Moeller,
> 
> 
> Hi Markus,
> 
> Yeah, I'm currently using that option and permissions are correct too.
> 
> On 27 Oct 2014 19:47, Markus Moeller wrote:
> 
> Hi Pedro,
>  
>   Did you try the ?s GSS_C_NO_NAME option ?
>  
> Markus
>  
> "Pedro Lobo" <palobo at gmail.com> wrote in message news:94F74226-F24B-4910-95B7-B86ACE815995 at gmail.com...
> Hey Everybody,
> 
> Seems as though I celebrated too soon on Saturday. Today things are back to not working for Windows 7+ machines and XP/2003 machines are working just fine.
> 
> I've also checked the permissions on the keytab file and they haven't changed since Saturday, so it's not that... ARGH!!!!
> 
> Craving ideas and solutions right now... Pilot users are less than satisfied ;)
> 
> Cheers,
> Pedro
> 
> On 25 Oct 2014, at 14:13, Markus Moeller wrote:
> 
> Hi Pedro,
> 
> I wonder if he upper case in the name is a problem. Can you try
> 
> auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s GSS_C_NO_NAME
> 
> instead of
> 
> auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s HTTP/proxy01tst.fake.net
> 
> Markus
> 
> "Pedro Lobo" palobo at gmail.com wrote in message news:FD6832B9-3F1F-48C6-A76F-47A224F1697B at gmail.com...
> Hi Markus,
> 
> I used msktutil to create the keytab.
> 
> msktutil -c -s HTTP/proxy01tst.fake.net -h proxy01tst.fake.net -k /etc/squid3/PROXY.keytab --computer-name proxy01-tst --upn HTTP/proxy01tst.fake.net --server srv01.fake.net --verbose
> Output of klist -ekt:
> 
> 2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (arcfour-hmac)
> 2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (aes128-cts-hmac-sha1-96)
> 2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (aes256-cts-hmac-sha1-96)
> 2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET (arcfour-hmac)
> 2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET (aes128-cts-hmac-sha1-96)
> 2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET (aes256-cts-hmac-sha1-96)
> 2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET (arcfour-hmac)
> 2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET (aes128-cts-hmac-sha1-96)
> 2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET (aes256-cts-hmac-sha1-96)
> Yep, using MIT Kerberos
> 
> Thanks in advance for any help.
> 
> Cheers,
> Pedro
> 
> On 25 Oct 2014, at 1:26, Markus Moeller wrote:
> 
> Hi Pedro,
> 
> How did you create your keytab ? What does klist ?ekt <squid.keytab> show ( I assume you use MIT Kerberos) ?
> 
> Markus
> 
> "Pedro Lobo" palobo at gmail.com wrote in message news:40E1E0E7-50C6-4117-94AA-50B06573430A at gmail.com...
> Hi Squid Gurus,
> 
> I'm at my wit's end and in dire need of some squid expertise.
> 
> We've got a production environment with a couple of squid 2.7 servers using NTLM and basic authentication. Recently though, we decided to upgrade and I'm now setting up squid 3.3 with Kerberos and NTLM Fallback. I've followed just about every guide I could find and in my testing environment, things were working great. Now that I've hooked it up to the main domain, things are awry.
> 
> If I use a machine that's not part of the domain, NTLM kicks in and I can surf the web fine. If I use a Windows XP or Windows Server 2003, kerberos works just fine, however, if I use a machine Windows 7, 8 or 2008 server, I keep getting a popup asking me to authenticate and even then, it's and endless loop until it fails. My cache.log is littered with:
> 
> negotiate_kerberos_auth.cc(200): pid=1607 :2014/10/24 23:03:01| negotiate_kerberos_auth: ERROR: gss_accept_sec_context() failed: Unspecified GSS failure. Minor code may provide more information.
> 2014/10/24 23:03:01| ERROR: Negotiate Authentication validating user. Error returned 'BH gss_accept_sec_context() failed: Unspecified GSS failure. Minor code may provide more information. '
> The odd thing, is that this has worked before. Help me Obi Wan... You're my only hope! :)
> 
> Current Setup
> Squid 3.3 running on Ubuntu 14.04 server. It's connected to a 2003 server with function level 2000 (I know, we're trying to fase out the older servers).
> 
> krb5.conf
> 
> [libdefaults]
> default_realm = FAKE.NET
> dns_lookup_kdc = yes
> dns_lookup_realm = yes
> ticket_lifetime = 24h
> default_keytab_name = /etc/squid3/PROXY.keytab
> 
> ; for Windows 2003
> default_tgs_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
> default_tkt_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
> permitted_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
> 
> [realms]
> FAKE.NET = {
> kdc = srv01.fake.net
> kdc = srv02.fake.net
> kdc = srv03.fake.net
> admin_server = srv01.fake.net
> default_domain = fake.net
> }
> 
> [domain_realm]
> .fake.net = FAKE.NET
> fake.net = FAKE.NET
> 
> [logging]
> kdc = FILE:/var/log/kdc.log
> admin_server = FILE:/var/log/kadmin.log
> default = FILE:/var/log/krb5lib.log
> squid.conf
> 
> auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s HTTP/proxy01tst.fake.net
> auth_param negotiate children 20 startup=0 idle=1
> auth_param negotiate keep_alive off
> 
> auth_param ntlm program /usr/bin/ntlm_auth --diagnostics --helper-protocol=squid-2.5-ntlmssp --domain=FAKE.NET
> auth_param ntlm children 10
> auth_param ntlm keep_alive off
> Cheers,
> Pedro
> 
> Cumprimentos
> Pedro Lobo
> Solutions Architect | System Engineer
> 
> pedro.lobo at pt.clara.net
> Tlm.: +351 939 528 827 | Tel.: +351 214 127 314
> 
> Claranet Portugal
> Ed. Parque Expo
> Av. D. Jo?o II, 1.07-2.1, 4? Piso
> 1998-014 Lisboa
> www.claranet.pt
> 
> Empresa certificada ISO 9001, ISO 20000 e ISO 27001
> 
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 
> Cumprimentos
> Pedro Lobo
> Solutions Architect | System Engineer
> 
> pedro.lobo at pt.clara.net
> Tlm.: +351 939 528 827 | Tel.: +351 214 127 314
> 
> Claranet Portugal
> Ed. Parque Expo
> Av. D. Jo?o II, 1.07-2.1, 4? Piso
> 1998-014 Lisboa
> www.claranet.pt
> 
> Empresa certificada ISO 9001, ISO 20000 e ISO 27001
> 
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 
> 
> __________ Information from ESET Smart Security, version of virus signature database 10628 (20141027) __________
> 
> The message was checked by ESET Smart Security.
> 
> http://www.eset.com
> 
> 
> __________ Information from ESET Smart Security, version of virus signature database 10628 (20141027) __________
> 
> The message was checked by ESET Smart Security.
> 
> http://www.eset.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141027/515986fb/attachment.htm>

From eliezer at ngtech.co.il  Mon Oct 27 22:35:45 2014
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Tue, 28 Oct 2014 00:35:45 +0200
Subject: [squid-users] Filtering keywords on google search
In-Reply-To: <44e0e66e3e3b4a6f8acbcc4629bd7c0c@AM3PR04MB450.eurprd04.prod.outlook.com>
References: <88EF58F000EC4B4684700C2AA3A73D7A04F5323FBEE4@W2008DC01.ColliniConsulting.lan>
 <44e0e66e3e3b4a6f8acbcc4629bd7c0c@AM3PR04MB450.eurprd04.prod.outlook.com>
Message-ID: <544EC8C1.6050104@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 10/27/2014 09:01 PM, Rafael Akchurin wrote:
> Default stock Squid in CentOS for example allows for SSL Sump out
> of the box (not for Firefox though).
Why not for firefox?
It is working on firefox and all other browsers while some will like
the certificate they will get and others will not.

Also there have been couple patches to ssl bump that can help with
couple issues(while might bringing others)

Eliezer
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUTsjBAAoJENxnfXtQ8ZQUvm4H/0N3+X4YtfgsQogRw8/Po3m6
syZq+YdsjAjXB4NMQqG81GoD0Jhz3ENDThjd4Srj6a0vpaVSdp6efjIwMiMr6I4w
jWbKoSDZWqE/HIg43MShNMy5PVzW+c6VuAIr/D9qIsUPHlnlHC3rCqGggV5xZJHr
b8Sfn4YnU9LwFOOON2e0iBme9rwtDOrIpQ+TUuaKT5rcKmNxsFTQav5FcdvaataO
pqmckmXGX7eZMmci/ivxwfxlxkdrNyGRvvMJNhnIRw47pUoXb8CihchgXJUDaGhq
oC3sV4TQ94OZKs62ZUUJD5sgxHkbRFYSyPlLt0M4YsXtA5e/vAlQkrJdAVh3bYc=
=gwdo
-----END PGP SIGNATURE-----


From rafael.akchurin at diladele.com  Mon Oct 27 23:03:29 2014
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Mon, 27 Oct 2014 23:03:29 +0000
Subject: [squid-users] Filtering keywords on google search
In-Reply-To: <544EC8C1.6050104@ngtech.co.il>
References: <88EF58F000EC4B4684700C2AA3A73D7A04F5323FBEE4@W2008DC01.ColliniConsulting.lan>
 <44e0e66e3e3b4a6f8acbcc4629bd7c0c@AM3PR04MB450.eurprd04.prod.outlook.com>
 <544EC8C1.6050104@ngtech.co.il>
Message-ID: <b018214c059d4e0d8d487c5ceef4132c@AM3PR04MB450.eurprd04.prod.outlook.com>

Hello Eliezer,

I did not mean to be rude, just forgot to type CentOS *7* stock Squid from the distribution maintainers (not from you :)

The FF requires patching in gadget.cc otherwise it shows sec_error_inadequate_key_usage for almost all SSL bumped pages. The new version 3.4.8 is probably better in handling this but it is not part of stock CentOS 7 yet.

Some admins seem to heavily rely on updates coming from distribution maintainers and deny recompiling any software.

Best regards,
Rafael Akchurin
Diladele B.V.

-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Eliezer Croitoru
Sent: Monday, October 27, 2014 11:36 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Filtering keywords on google search

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 10/27/2014 09:01 PM, Rafael Akchurin wrote:
> Default stock Squid in CentOS for example allows for SSL Sump out of 
> the box (not for Firefox though).
Why not for firefox?
It is working on firefox and all other browsers while some will like the certificate they will get and others will not.

Also there have been couple patches to ssl bump that can help with couple issues(while might bringing others)

Eliezer
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUTsjBAAoJENxnfXtQ8ZQUvm4H/0N3+X4YtfgsQogRw8/Po3m6
syZq+YdsjAjXB4NMQqG81GoD0Jhz3ENDThjd4Srj6a0vpaVSdp6efjIwMiMr6I4w
jWbKoSDZWqE/HIg43MShNMy5PVzW+c6VuAIr/D9qIsUPHlnlHC3rCqGggV5xZJHr
b8Sfn4YnU9LwFOOON2e0iBme9rwtDOrIpQ+TUuaKT5rcKmNxsFTQav5FcdvaataO
pqmckmXGX7eZMmci/ivxwfxlxkdrNyGRvvMJNhnIRw47pUoXb8CihchgXJUDaGhq
oC3sV4TQ94OZKs62ZUUJD5sgxHkbRFYSyPlLt0M4YsXtA5e/vAlQkrJdAVh3bYc=
=gwdo
-----END PGP SIGNATURE-----
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

From squid3 at treenet.co.nz  Mon Oct 27 23:21:10 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 28 Oct 2014 12:21:10 +1300
Subject: [squid-users] how to obtain info about actual active downloads?
In-Reply-To: <544E74D7.2030104@solutti.com.br>
References: <544E4977.3050705@hanzlici.cz>
 <201410271447.00509.Antony.Stone@squid.open.source.it>
 <544E74D7.2030104@solutti.com.br>
Message-ID: <544ED366.2050708@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 28/10/2014 5:37 a.m., Leonardo Rodrigues wrote:
> On 27/10/14 11:47, Antony Stone wrote:
>> On Monday 27 October 2014 at 14:32:39 (EU time), Frantisek
>> Hanzlik wrote:
>> 
>>> Please, what is best way for determining who squid clients
>>> (their PC IP addresses) have which downloads active? I want it
>>> to determine which clients burden our slow internet line. 
>>> Examining 'access.log' does not help much in this case, because
>>> users can download large files and it may take a few minutes or
>>> hours (e.g. in case of consuming some audio/video streams).
>> I would use the tool 'iptraf', either running on your squid
>> server, or on a machine which can sniff your internal network
>> traffic (possibly with the use of a spanning port on the
>> switch).
>> 
>> That can give you real-time bandwidth measurements per IP
>> address.
>> 
> 
> I use this script:
> 
> http://samm.kiev.ua/sqstat/
> 
> Set it to auto-update on 15/15 seconds, for example, and you'll
> have a great and easy way to evaluate active connections and high
> bandwidth use connections.
> 


There is also the cachemgr interface for Squid. The "active_requests"
report lists the currently underway transactions.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUTtNmAAoJELJo5wb/XPRjgRMH/iBjkuYP/8Ri3sULxNMtQfNz
bEoOVL45ts2PwS3tLpo5p6zXeQRBy+wMpH6urjRIbObw0NP2aGQzlG4dowk/WSeE
4TA4+4f+u5f2roY4Lx+Jt0e5ndDvCb/XP7afcyO3kMhCN26Ns+OmKCj3CndHzUHT
H4OLhOzsSOXqv2rLzje0+NttgjveLG+7AsxOVzBsRUQWUduq4Z09igqn/UolfkPn
lK/6E6a3J5/4n9/mAamxep6vc2SIihBQ2NP4jnzsSLuoblqRnGBgaGRr+7/q0+uB
Mx8BY4g/lPSNa5arTRoyniGe/Q3LmlXk/fv1tWGnsSQdgh2WK5kVNVyPZI3ZV1E=
=iy8M
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Tue Oct 28 00:01:14 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 28 Oct 2014 13:01:14 +1300
Subject: [squid-users] squid 3.4.8 Eating all of the Bandwidth
In-Reply-To: <1340988345.14631088.1414433251141.JavaMail.zimbra@hadara.ps>
References: <1340988345.14631088.1414433251141.JavaMail.zimbra@hadara.ps>
Message-ID: <544EDCCA.5070200@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 28/10/2014 7:07 a.m., saleh madi wrote:
> Hello,
> 
> Why squid 3.4.8 Eating all of the Bandwidth:
> 
> iptraf -d eth0 in the squid box
> 
> Incoming rates:  435007.2 kbits/sec
>  50974.2 packets/sec
> 
> 
> Outgoing rates:  276229.9 kbits/sec
>  45568.4 packets/sec
> 
> 
> squid config:
> 
> range_offset_limit 0 quick_abort_min 0 quick_abort_max 0
> 
> You see the difference between the Incoming rates and Outgoing
> rates is: 200M and more.

Please avoid relying on the terms "incoming" and "outgoing". When
proxying they get a bit obscure. Like telling someone to turn left or
right you have to know which way they are facing first.


Since you think there is a problem I am going to assume "incoming" is
traffic from the Internet? given that it has a higher number than
outgoing.

Bandwidth differences like this can occur for several reasons...

* Squid talking HTTP/1.1 to clients and 1.0 to servers. HTTP/1.1
contains a number of bandwidth optimization features such as REFRESH
(INM, IMS) requests which do not exist in HTTP/1.0.
 The client may be using those 1.1 features to efficiently update its
content, but the 1.0 server delivering only inefficient full-content
(200) responses to Squid.

* Squid does not cache range replies. Given your range_offset_limit it
is quite possible Squid is translating between 200 and 206 responses.
 The clients sending many small byte range requests can cause Squid to
fetch new content (200 response) from the server, then translate it to
a smaller 206 response.
 Use range_offset_limit sparingly.

* Squid-3.4 has much improved caching of objects. If you are using
ignore-auth or ignore-private options on the refresh_pattern directive
you can actively *prevent* Squid from storing many objects which
otherwise would cache nicely. Which makes the above problems worse.
 The popular "override-expires" can also cause the same issues if the
web server emits an Expires header indicating more storage time
allowed than refresh_pattern "min" time field. I find it quite common
for admin to think they are forcing things to cache when in fact they
are *reducing* the storage time with override-expires.

* Squid-3.x older than 3.5 are missing the "collapsed forwarding"
feature enjoyed by Squid-2.6/2.7 users. As a result many clients
requesting the same non-cached object at the same time can cause it to
be downloaded multiple times. Combined with the Range request issue
above this can cause a lot of extra bandwidth usage on the
Internet/server connections.


* It is also possible you have configured an open proxy. If so there
can be a lot of traffic to/from the Internet without matching LAN traffic.

* Squid is only using a portion of the bandwidth measured by iptraf.
For certain there are TCP protocol overheads, and likely also UDP
protocols such as DNS packets going over the connections.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUTtzKAAoJELJo5wb/XPRjA+cIAMPUXydfHNKyL6LEhPb5lS0Y
d7VWS4F0Z8VKKibxtrdc8y9fh7LpnGQyU1hxkuJRsXZSI1EzkyXCNfnaqAK6IkIL
q+JEbsenIWO9U53rwN704Wd/O3ASAT9HO5q6QmBcZ8PMVlZYCLEqCdwW9pCoij47
ZrQ6Zb6wPcdR4vJ+LtsSeFXJiZahWMoKuvqEbZld2tJASfF3H4WWqlxcxSzT1hjn
Rfb1XU6GpGikNbqg3ExlwXS9wV43/tbyeUj0d+8SWhXI8b+Vx3DiWHh7BILsMkuD
+NQNnZ6cLGPi2ccK+4MOazuHjVHyC5iK1LoWLBudKp5sncRmCuXtYAAg9FWTASU=
=B7ez
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Tue Oct 28 00:09:14 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 28 Oct 2014 13:09:14 +1300
Subject: [squid-users] Group check against AD
In-Reply-To: <1414430775554-4668078.post@n4.nabble.com>
References: <1414430775554-4668078.post@n4.nabble.com>
Message-ID: <544EDEAA.1000604@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 28/10/2014 6:26 a.m., masterx81 wrote:
> Hi! I'm trying to check if a user is present in a Group, and now
> i'm using the following config:
> 
> external_acl_type memberof ttl=30 %LOGIN 
> /usr/local/squid/libexec/ext_ldap_group_acl -v 3 -R -K -b 
> "dc=domain,dc=local" -D squid at domain.local -W
> /etc/squid/ldappass.txt -f 
> "(&(objectclass=person)(sAMAccountName=%v)(memberof=cn=%g,ou=SQUID,ou=OU
>
> 
domain,dc=domain,dc=local))" -h srv-dc1.domain.local
> 
> It work, but has some limits, for example if a user is only in the
> group of interest it not pass (while adding a second Group that is
> the default Group it works). Also, if a user is on some "sub"
> groups it not work.
> 
> I've tried also the kerb helper (with kerb configured and keytab
> working), using shell commands it work, for example: 
> /usr/lib64/squid/ext_kerberos_ldap_group_acl -g "Internet libero"
> -D "DOMAIN.LOCAL" that converted in squid must be something like: 
> external_acl_type memberof ttl=30 %LOGIN 
> /usr/lib64/squid/ext_kerberos_ldap_group_acl -d -g "%g" -D
> "DOMAIN.LOCAL" works (on shell, i've not tried the second syntax on
> squid), but with the same limits.

This is not a group check. There are three parts to those.

1) The configuration for how the helper connects to LDAP and *where*
it looks for groups. What you have detailed above.

2) The group(s) to be checked is an "acl ... external memberof ..."
line later in your config file. Each entry there will be inserted in
the LDAP query where %g is used.

3) The timing of when to check it is an http_access or other access
list using that acl line even later in the config.


You are using %v in the filter for some reason. That is not a macro
supported by this helper and thus will be replaced with nothing.
I suspect you meant to be using %u instead - which is replaced on
lookups by the user name from %LOGIN.

See the -f option documentation:
<http://www.squid-cache.org/Versions/v3/3.4/manuals/ext_ldap_group_acl.html>

> 
> There is a way to at least have the user in only one Group (that is
> the default group)?

Having a user "in" a group is a property of the AD unrelated to Squid
or any of thise squid.conf settings. Squid is just doing a
lookup/query of the AD database using LDAP protocol.

I suspect with that %v mistake yoru rules are effectively telling LDAP
to query whether *any* object of objectclass=person exists in the
group. Which would normally be true of groups, so the first group
always returns a match on your lookups.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUTt6qAAoJELJo5wb/XPRjkg0H+wa45d4CtDzAHpKBRAhS8d4L
3oCft0R8rF2KlgHknWdG67qRSHZwSfyUvHfaCF7fbh1OHt6jPUDhjRt2d2z4oHUf
/VWwXsS/3O85PrRX8a4yUbMUutTRpTy0H7G20IUVqVhywUMbANLNPcNfwlb1y6s6
64lKrepGlkzmsOmudO6mYlFPxdhAPi8S+GKowgPFrzIoD1DSxy4RfYs/P7oqPEQN
UfTUFXmdooc+lsqjBjo3hSC8uP/mQ6ER/YrGZzp4sE1ZuASwzENos2ndphPRUFU+
k6YgbtiP+2VUSxy2r1Oarbjzd3niRlecSIDnWEu25HiRm6/axzDs1iuVQaYVmOc=
=hZqC
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Tue Oct 28 00:29:49 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 28 Oct 2014 13:29:49 +1300
Subject: [squid-users] squid ipv6 tcp_outgoing limitation ??
In-Reply-To: <003f01cfefd7$7c78eaa0$756abfe0$@netstream.ps>
References: <003f01cfefd7$7c78eaa0$756abfe0$@netstream.ps>
Message-ID: <544EE37D.6040902@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 25/10/2014 11:11 a.m., Ahmed Allzaeem wrote:
> Hi ,
> 
> Recently I used squid 3.4.3 for ipv6 for tcp_outgoing for many
> ipv6 addresses based on the username.
> 
> 
> 
> 
> 
> I added about 1000 users with 1000 tcp_outgoing address but it
> didn't work ..it always uses the last line in squid.conf with
> tcp_outgoing directive !!
> 
> 
> 
> Does squid has limitation in ipv6 ?
> 

Not in this regard.

The only IPv4/IPv6 related limitation in 3.4 is that IPv6 address
cannot be used to contact server IPv4 address and similarly no IPv4
use to contact server IPv6 address.
eg the problem which earlier versions needed to use the special
"ipv6"/"ipv4" ACL matches for is fixed.

More likely the credentials are not available at the time the tests
are being run.


> The question is
> 
> 
> 
> Is it squid issue ?
> 
> Networking issue ?
> 
> Kernel issue ?
> 

Unknown, unknown, unknown. More info is required to diagnose what the
problem is. In particular:

 what does squid.conf contain?

 what server domain *and* IP(s) are being contacted?
  (all of the IPs)

 what does adding "debug_options 28,4 " produce in cache.log?
  (be aware this may have large amount of output, we only need one or
two requests details)

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUTuN5AAoJELJo5wb/XPRjfngIAIviCYmqTOo5uzoyVAdMkvLv
VDcZ2u8TDy9A86J6OL1thxwpGwUxO0QmkSEuJeVawxBzM9lfy8w0iGT5DICrYfgQ
Gm2YWKxl2MYUIx8NEBOdJGMVk2Yfrs8WZPCDoQaTaK8zcKr8NKiUrEKwLXtw6PZq
xQG5lwTlw3n4j+1vZUzEp8qV2eRenP8tbAKzYNxfOgD7e5kq0pSanFE/y+CwAgwR
4JWqGyUCKJrP3UZKog2H4VqwMw+B0eahDjM+gJ4HZ5XfooHQfY2te+TawXnvazoL
PG+ISeRP7Vf1nyVZd1W3YlHCQ1aBo9J6SWj1VKiucKypSjwVAS9oNJmJsA2gsJA=
=8Yol
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Tue Oct 28 00:53:13 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 28 Oct 2014 13:53:13 +1300
Subject: [squid-users] Large rock supporting with stable squid version
In-Reply-To: <003001cfef8b$cd028220$67078660$@netstream.ps>
References: <003001cfef8b$cd028220$67078660$@netstream.ps>
Message-ID: <544EE8F9.3040406@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 25/10/2014 2:09 a.m., Ahmed Allzaeem wrote:
> Hi
> 
> I want to ask about Large rock supporting.
> 
> In large rock supporting wts the max size for disk store ? and max
> size of ram store?

The disk store limit depends on HDD/SSD space available. That goes for
all cache_dir types.


What do you mean by "ram store" ?

 IIRC, rock storage does away with the split memory/disk "slices"
which were used in COSS. So there is no tricky management of how many
slices are in memory and swapping in/out.

 Squid has a RAM store (cache_mem) which is not particularly related
to Rock storage. You need to tune that cache_mem size around how much
RAM is used for all cache_dir existing, and active transaction needs.
Nobody can tell you the answer since the administrative "test,
measure, tune" process is the only way to find it.


> 
> I need someone tried large rock with squid 3.head version and have
> seen a stability , I used last time squid3.head but it hanged after
> sometime
> 

Details required. "hangs after some time" and "it" are very vague.

> 
> I need  a help with a squid large rock  best practice.
> 

The feature is still in beta. As an early adopter you are one of the
people whose feedback will define what the best practice in future
will be.

Despite being *capable* of large object storage rock is optimal for
small objects. UFS/AUFS/diskd cache types are optimal for large
objects - except no SMP sharing there yet which is just annoying.

For now the regular best practice for cache_dir in general applies. To
ensure you have enough RAM for cache index (10-15MB er GB of cached
data) not to cause memory swapping, to ensure you do not exceded
available disk space, etc. etc.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUTuj5AAoJELJo5wb/XPRjwW4IAJcHO5Nbz1y1DZ8K3vIWLEaQ
02kqrTShzkciM98dzMfBzRytq/8zuCiQNW463vgxdypTmcYKo4vNCfuGuf8Jo8yY
MxmTsEgZQvZgxCrpCBPuklzz2oyGcIrXvtL0OJZ1WqNL0oa8fjHjJ1YP5RMeGHD4
LwHbM0OI1+MEpGErCETFXGiO5EZz2pnHfWj8VNz3Eb81Dm0whJy09gfayX4Nqm77
W1/1k4fihXZ2WtLvKPqN16fBOrWJUxe0x3r5vhb9YTv/mbU06jv3EPa58tXAI6H0
Etno/ITlwbkJOhvpCJpl6r5BeQyuATEI1NLG1Ffg3Cd5x/cc8NTJHMPUIBhXlHk=
=+IXG
-----END PGP SIGNATURE-----


From a9121431 at gmail.com  Tue Oct 28 01:17:04 2014
From: a9121431 at gmail.com (John Mok)
Date: Tue, 28 Oct 2014 09:17:04 +0800
Subject: [squid-users] Kerberos Authentication Failing for Windows 7+
 with BH gss_accept_sec_context() failed
In-Reply-To: <2DB6E356-8CAA-4393-B7B9-E4DABE1AC8EF@gmail.com>
References: <40E1E0E7-50C6-4117-94AA-50B06573430A@gmail.com>
 <m2eqo7$cf9$1@ger.gmane.org>
 <FD6832B9-3F1F-48C6-A76F-47A224F1697B@gmail.com>
 <m2g7l9$1ee$1@ger.gmane.org>
 <94F74226-F24B-4910-95B7-B86ACE815995@gmail.com>
 <m2m7g0$9l7$1@ger.gmane.org>
 <b4adceec-5a53-4212-b16c-106237fc4504@Pedros-iPhone>
 <1F13F4C925B73F48A73307A32424FB8702075E51A0@chemsur-ex-01.emlchem.local>
 <2DB6E356-8CAA-4393-B7B9-E4DABE1AC8EF@gmail.com>
Message-ID: <CALYzA8Fy-Ufp5K+9JfBaYA4bGeCDZUEWWnRTeWj2rctRdK4ZVA@mail.gmail.com>

Pedro,

By default, Windows 7 (and later) does not support weak encryption
types in Kerberos, e.g. DES. Since Windows 7 clients are working with
domain controller on Windows 2000 functional level, it is very likely
the Kerberos encryption type on the TGT ticket is DES. You can verify
that on Windows XP/2003.

If so, you need to re-enable the support of weak encryption types in
Kerberos on Windows 7 by GPO or editing registry.

http://blogs.msdn.com/b/openspecification/archive/2011/05/31/windows-configurations-for-kerberos-supported-encryption-type.aspx

http://technet.microsoft.com/en-us/library/dd560670%28v=ws.10%29.aspx

Regards,  John Mok

On Tue, Oct 28, 2014 at 6:22 AM, Pedro Lobo <palobo at gmail.com> wrote:
> Thanks Paul,
>
> I'll surely look into that too, but given that authentication seems o work
> for a day or so and then stop (was working Saturday, no longer today) I
> highly doubt it's related. Still worth checking I'm sure.
>
> Pedro Lobo
>
> On 27 Oct 2014, at 21:12, Paul Freeman <paul.freeman at emlchem.com.au> wrote:
>
> Pedro,
>
> This sounds similar to a problem I had a couple of years ago when using
> Kerberos authentication with Squid (3.1.x) on Ubuntu (10.04 at that stage).
> (see RE: [squid-users] Re: Authentication using squid_kerb_auth with
> Internet Explorer 8 on Windows Server 2008 R2, squid-users group Nov 3 2010)
>
>
>
> What I discovered after debugging the Kerberos authentication process with
> gdb was the MIT Kerberos version distributed with that version of Ubuntu did
> not support one of the encryption types requested by the newer versions of
> Windows (7, 2008).  This was a reported issue with the version of Kerberos
> used in Ubuntu.  I ended up patching the Ubuntu MIT Kerberos source (a
> trivial patch) and compiling the packages manually.  This corrected the
> problem.
>
>
>
> I am unsure whether this is the root cause of your issue though but thought
> it might be worth mentioning.  I have not kept up with the MIT Kerberos
> packages included with Ubuntu 12.04 and 14.04 to know whether the patch is
> included in the later versions.
>
>
>
> Regards
>
>
>
> Paul
>
>
>
> From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On
> Behalf Of Pedro Lobo
> Sent: Tuesday, 28 October 2014 7:26 AM
> To: Markus Moeller
> Cc: squid-users at squid-cache.org
> Subject: Re: [squid-users] Kerberos Authentication Failing for Windows 7+
> with BH gss_accept_sec_context() failed
>
>
>
> Hi Markus Moeller,
>
>
> Hi Markus,
>
> Yeah, I'm currently using that option and permissions are correct too.
>
>
> On 27 Oct 2014 19:47, Markus Moeller wrote:
>
> Hi Pedro,
>
>
>
>   Did you try the ?s GSS_C_NO_NAME option ?
>
>
>
> Markus
>
>
>
> "Pedro Lobo" <palobo at gmail.com> wrote in message
> news:94F74226-F24B-4910-95B7-B86ACE815995 at gmail.com...
>
> Hey Everybody,
>
> Seems as though I celebrated too soon on Saturday. Today things are back to
> not working for Windows 7+ machines and XP/2003 machines are working just
> fine.
>
> I've also checked the permissions on the keytab file and they haven't
> changed since Saturday, so it's not that... ARGH!!!!
>
> Craving ideas and solutions right now... Pilot users are less than satisfied
> ;)
>
> Cheers,
> Pedro
>
> On 25 Oct 2014, at 14:13, Markus Moeller wrote:
>
> Hi Pedro,
>
> I wonder if he upper case in the name is a problem. Can you try
>
> auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r
> -s GSS_C_NO_NAME
>
> instead of
>
> auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r
> -s HTTP/proxy01tst.fake.net
>
> Markus
>
> "Pedro Lobo" palobo at gmail.com wrote in message
> news:FD6832B9-3F1F-48C6-A76F-47A224F1697B at gmail.com...
> Hi Markus,
>
> I used msktutil to create the keytab.
>
> msktutil -c -s HTTP/proxy01tst.fake.net -h proxy01tst.fake.net -k
> /etc/squid3/PROXY.keytab --computer-name proxy01-tst --upn
> HTTP/proxy01tst.fake.net --server srv01.fake.net --verbose
> Output of klist -ekt:
>
> 2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (arcfour-hmac)
> 2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (aes128-cts-hmac-sha1-96)
> 2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (aes256-cts-hmac-sha1-96)
> 2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET (arcfour-hmac)
> 2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET
> (aes128-cts-hmac-sha1-96)
> 2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET
> (aes256-cts-hmac-sha1-96)
> 2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET (arcfour-hmac)
> 2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET
> (aes128-cts-hmac-sha1-96)
> 2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET
> (aes256-cts-hmac-sha1-96)
> Yep, using MIT Kerberos
>
> Thanks in advance for any help.
>
> Cheers,
> Pedro
>
> On 25 Oct 2014, at 1:26, Markus Moeller wrote:
>
> Hi Pedro,
>
> How did you create your keytab ? What does klist ?ekt <squid.keytab> show (
> I assume you use MIT Kerberos) ?
>
> Markus
>
> "Pedro Lobo" palobo at gmail.com wrote in message
> news:40E1E0E7-50C6-4117-94AA-50B06573430A at gmail.com...
> Hi Squid Gurus,
>
> I'm at my wit's end and in dire need of some squid expertise.
>
> We've got a production environment with a couple of squid 2.7 servers using
> NTLM and basic authentication. Recently though, we decided to upgrade and
> I'm now setting up squid 3.3 with Kerberos and NTLM Fallback. I've followed
> just about every guide I could find and in my testing environment, things
> were working great. Now that I've hooked it up to the main domain, things
> are awry.
>
> If I use a machine that's not part of the domain, NTLM kicks in and I can
> surf the web fine. If I use a Windows XP or Windows Server 2003, kerberos
> works just fine, however, if I use a machine Windows 7, 8 or 2008 server, I
> keep getting a popup asking me to authenticate and even then, it's and
> endless loop until it fails. My cache.log is littered with:
>
> negotiate_kerberos_auth.cc(200): pid=1607 :2014/10/24 23:03:01|
> negotiate_kerberos_auth: ERROR: gss_accept_sec_context() failed: Unspecified
> GSS failure. Minor code may provide more information.
> 2014/10/24 23:03:01| ERROR: Negotiate Authentication validating user. Error
> returned 'BH gss_accept_sec_context() failed: Unspecified GSS failure. Minor
> code may provide more information. '
> The odd thing, is that this has worked before. Help me Obi Wan... You're my
> only hope! :)
>
> Current Setup
> Squid 3.3 running on Ubuntu 14.04 server. It's connected to a 2003 server
> with function level 2000 (I know, we're trying to fase out the older
> servers).
>
> krb5.conf
>
> [libdefaults]
> default_realm = FAKE.NET
> dns_lookup_kdc = yes
> dns_lookup_realm = yes
> ticket_lifetime = 24h
> default_keytab_name = /etc/squid3/PROXY.keytab
>
> ; for Windows 2003
> default_tgs_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
> default_tkt_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
> permitted_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
>
> [realms]
> FAKE.NET = {
> kdc = srv01.fake.net
> kdc = srv02.fake.net
> kdc = srv03.fake.net
> admin_server = srv01.fake.net
> default_domain = fake.net
> }
>
> [domain_realm]
> .fake.net = FAKE.NET
> fake.net = FAKE.NET
>
> [logging]
> kdc = FILE:/var/log/kdc.log
> admin_server = FILE:/var/log/kadmin.log
> default = FILE:/var/log/krb5lib.log
> squid.conf
>
> auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r
> -s HTTP/proxy01tst.fake.net
> auth_param negotiate children 20 startup=0 idle=1
> auth_param negotiate keep_alive off
>
> auth_param ntlm program /usr/bin/ntlm_auth --diagnostics
> --helper-protocol=squid-2.5-ntlmssp --domain=FAKE.NET
> auth_param ntlm children 10
> auth_param ntlm keep_alive off
> Cheers,
> Pedro
>
> Cumprimentos
> Pedro Lobo
> Solutions Architect | System Engineer
>
> pedro.lobo at pt.clara.net
> Tlm.: +351 939 528 827 | Tel.: +351 214 127 314
>
> Claranet Portugal
> Ed. Parque Expo
> Av. D. Jo?o II, 1.07-2.1, 4? Piso
> 1998-014 Lisboa
> www.claranet.pt
>
> Empresa certificada ISO 9001, ISO 20000 e ISO 27001
>
> ________________________________
> ________________________________
>
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
> ________________________________
>
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
> Cumprimentos
> Pedro Lobo
> Solutions Architect | System Engineer
>
> pedro.lobo at pt.clara.net
> Tlm.: +351 939 528 827 | Tel.: +351 214 127 314
>
> Claranet Portugal
> Ed. Parque Expo
> Av. D. Jo?o II, 1.07-2.1, 4? Piso
> 1998-014 Lisboa
> www.claranet.pt
>
> Empresa certificada ISO 9001, ISO 20000 e ISO 27001
>
> ________________________________
> ________________________________
>
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
> ________________________________
>
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
> ________________________________
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
>
> __________ Information from ESET Smart Security, version of virus signature
> database 10628 (20141027) __________
>
> The message was checked by ESET Smart Security.
>
> http://www.eset.com
>
>
>
> __________ Information from ESET Smart Security, version of virus signature
> database 10628 (20141027) __________
>
> The message was checked by ESET Smart Security.
>
> http://www.eset.com
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


From donald at infomed.sld.cu  Tue Oct 28 17:14:52 2014
From: donald at infomed.sld.cu (donald at infomed.sld.cu)
Date: Tue, 28 Oct 2014 13:14:52 -0400
Subject: [squid-users] ext_ldap_group_acl & Zimbra LDAP
Message-ID: <20141028131452.12254su2tgne6ivg@webmail.sld.cu>

Hello people, for 2 days I was looking around de web for the correct  
filter to use SQUID ext_ldap_group_acl to verify the Zimbra group of  
an authenticate user but I'm tired right now. Because of that I  
looking for the answer here.

I use Squid 3.3.8 on Ubuntu Server 14.04 and ZCS 8.5, the filter for  
users works OK, the acl for the groups is the next:

external_acl_type Grupos_ZCS %LOGIN /usr/lib/squid3/ext_ldap_group_acl  
-R -v 3 -b "dc=ejemplo,dc=local" -D "uid=zimbra,cn=admins,cn=zimbra"  
-w "secretPass" -f "(&(uid=%u)(objectClass=zimbraAccount))" -h  
192.168.1.3

The -f filter not work, I tried a lot of filters but none work, I hope  
somebody can help me. Last, sorry my english, thanks...

----------------------------------------------------------------
This message was sent using IMP, the Internet Messaging Program.



--
Nunca digas nunca, di mejor: gracias, permiso, disculpe.

Este mensaje le ha llegado mediante el servicio de correo electronico que ofrece Infomed para respaldar el cumplimiento de las misiones del Sistema Nacional de Salud. La persona que envia este correo asume el compromiso de usar el servicio a tales fines y cumplir con las regulaciones establecidas

Infomed: http://www.sld.cu/



From ahmed.zaeem at netstream.ps  Tue Oct 28 20:46:23 2014
From: ahmed.zaeem at netstream.ps (Ahmed Allzaeem)
Date: Tue, 28 Oct 2014 13:46:23 -0700
Subject: [squid-users] Large rock supporting with stable squid version
In-Reply-To: <544EE8F9.3040406@treenet.co.nz>
References: <003001cfef8b$cd028220$67078660$@netstream.ps>
 <544EE8F9.3040406@treenet.co.nz>
Message-ID: <007301cff2f0$3db74ed0$b925ec70$@netstream.ps>

Hi Amos , thank you.

I just wanted to explain something

Now , im okay without SMP , I can save bandwidth and its fine...but cores are not balanced and that may lead some cpu cores reach 100 %

But...... I need to use SMP with large rock to save bandwidth .... now it works fine ...but no saving !!
Im using 3.4.7 stable 

What I need is ,
Someone used 3.head and found a result of saving bandwith.....as an example wt max cache size and mem size allow in large rock ?


That wt I need .... I need a fast browsing squid  that can save my bandwidth.
Amos , can u guide me with a 3.head verison you used with large rock and gave you thr best results of saving bandwidth ???

regards

-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Amos Jeffries
Sent: Monday, October 27, 2014 5:53 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Large rock supporting with stable squid version

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 25/10/2014 2:09 a.m., Ahmed Allzaeem wrote:
> Hi
> 
> I want to ask about Large rock supporting.
> 
> In large rock supporting wts the max size for disk store ? and max 
> size of ram store?

The disk store limit depends on HDD/SSD space available. That goes for all cache_dir types.


What do you mean by "ram store" ?

 IIRC, rock storage does away with the split memory/disk "slices"
which were used in COSS. So there is no tricky management of how many slices are in memory and swapping in/out.

 Squid has a RAM store (cache_mem) which is not particularly related to Rock storage. You need to tune that cache_mem size around how much RAM is used for all cache_dir existing, and active transaction needs.
Nobody can tell you the answer since the administrative "test, measure, tune" process is the only way to find it.


> 
> I need someone tried large rock with squid 3.head version and have 
> seen a stability , I used last time squid3.head but it hanged after 
> sometime
> 

Details required. "hangs after some time" and "it" are very vague.

> 
> I need  a help with a squid large rock  best practice.
> 

The feature is still in beta. As an early adopter you are one of the people whose feedback will define what the best practice in future will be.

Despite being *capable* of large object storage rock is optimal for small objects. UFS/AUFS/diskd cache types are optimal for large objects - except no SMP sharing there yet which is just annoying.

For now the regular best practice for cache_dir in general applies. To ensure you have enough RAM for cache index (10-15MB er GB of cached
data) not to cause memory swapping, to ensure you do not exceded available disk space, etc. etc.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUTuj5AAoJELJo5wb/XPRjwW4IAJcHO5Nbz1y1DZ8K3vIWLEaQ
02kqrTShzkciM98dzMfBzRytq/8zuCiQNW463vgxdypTmcYKo4vNCfuGuf8Jo8yY
MxmTsEgZQvZgxCrpCBPuklzz2oyGcIrXvtL0OJZ1WqNL0oa8fjHjJ1YP5RMeGHD4
LwHbM0OI1+MEpGErCETFXGiO5EZz2pnHfWj8VNz3Eb81Dm0whJy09gfayX4Nqm77
W1/1k4fihXZ2WtLvKPqN16fBOrWJUxe0x3r5vhb9YTv/mbU06jv3EPa58tXAI6H0
Etno/ITlwbkJOhvpCJpl6r5BeQyuATEI1NLG1Ffg3Cd5x/cc8NTJHMPUIBhXlHk=
=+IXG
-----END PGP SIGNATURE-----
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From franta at hanzlici.cz  Tue Oct 28 23:57:57 2014
From: franta at hanzlici.cz (Frantisek Hanzlik)
Date: Wed, 29 Oct 2014 00:57:57 +0100
Subject: [squid-users] how to obtain info about actual active downloads?
In-Reply-To: <544E74D7.2030104@solutti.com.br>
References: <544E4977.3050705@hanzlici.cz>
 <201410271447.00509.Antony.Stone@squid.open.source.it>
 <544E74D7.2030104@solutti.com.br>
Message-ID: <54502D85.9040806@hanzlici.cz>

Leonardo Rodrigues wrote:
> On 27/10/14 11:47, Antony Stone wrote:
>> On Monday 27 October 2014 at 14:32:39 (EU time), Frantisek Hanzlik wrote:
>>
>>> Please, what is best way for determining who squid clients (their
>>> PC IP addresses) have which downloads active?
>>> I want it to determine which clients burden our slow internet line.
>>> Examining 'access.log' does not help much in this case, because users
>>> can download large files and it may take a few minutes or hours (e.g.
>>> in case of consuming some audio/video streams).
>> I would use the tool 'iptraf', either running on your squid server, or on a
>> machine which can sniff your internal network traffic (possibly with the
>> use of a
>> spanning port on the switch).
>>
>> That can give you real-time bandwidth measurements per IP address.

Hi Antony,
thanks for reply. I know and use iptraf[-ng], but in this case it
isn't ideal:
- I want to use it as well as non-IT people with windos PCs, thus I
 prefer something like www interface.
- To decide whether it is legal working download or something
 inappropriate is very useful to know what URL download is.

First point could be met with something like ntop/ntopng, but for
 the second is probably necessary to inquire directly squid.


>     I use this script:
> 
> http://samm.kiev.ua/sqstat/
> 
>     Set it to auto-update on 15/15 seconds, for example, and you'll have a
> great and easy way to evaluate active connections and high bandwidth use
> connections.

Leonardo, thanks for this info and link - it is presumably exactly
what I wanted. I tried sqstat-1.20, but unfortunately last version
1.20 is ~8 years old and probably works with some older squid version
 - according to squid log, sqstat makes inquiries
"GET cache_object://localhost/active_requests"
and want "HTTP/1.0 200 OK" reply - but squid-3.3.13 now return
"HTTP/1.1 200 OK".
And even I correct this, there is still some bad, all my hosts have
IP 0.0.0.0 (on IPv4-only LAN). Maybe from squid-3.3 returned data are
different than these from older squids for what was sqstat then written.
But I'll try to play with it even more.

Franta Hanzlik



From franta at hanzlici.cz  Wed Oct 29 00:56:40 2014
From: franta at hanzlici.cz (Frantisek Hanzlik)
Date: Wed, 29 Oct 2014 01:56:40 +0100
Subject: [squid-users] how to obtain info about actual active downloads?
In-Reply-To: <544ED366.2050708@treenet.co.nz>
References: <544E4977.3050705@hanzlici.cz>
 <201410271447.00509.Antony.Stone@squid.open.source.it>
 <544E74D7.2030104@solutti.com.br> <544ED366.2050708@treenet.co.nz>
Message-ID: <54503B48.3060207@hanzlici.cz>

Amos Jeffries wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> On 28/10/2014 5:37 a.m., Leonardo Rodrigues wrote:
>> On 27/10/14 11:47, Antony Stone wrote:
>>> On Monday 27 October 2014 at 14:32:39 (EU time), Frantisek
>>> Hanzlik wrote:
>>>
>>>> Please, what is best way for determining who squid clients
>>>> (their PC IP addresses) have which downloads active? I want it
>>>> to determine which clients burden our slow internet line. 
>>>> Examining 'access.log' does not help much in this case, because
>>>> users can download large files and it may take a few minutes or
>>>> hours (e.g. in case of consuming some audio/video streams).
>>> I would use the tool 'iptraf', either running on your squid
>>> server, or on a machine which can sniff your internal network
>>> traffic (possibly with the use of a spanning port on the
>>> switch).from 
>>>
>>> That can give you real-time bandwidth measurements per IP
>>> address.
>>>
>>
>> I use this script:
>>
>> http://samm.kiev.ua/sqstat/
>>
>> Set it to auto-update on 15/15 seconds, for example, and you'll
>> have a great and easy way to evaluate active connections and high
>> bandwidth use connections.
>>
> 
> 
> There is also the cachemgr interface for Squid. The "active_requests"
> report lists the currently underway transactions.
> 
> Amos

Amos, thanks for this information. From Leonardo recommended 'sqstat'
PHP script from Alex Samorukov about doing what I need. I'm not
a programmer, and I would have had a problem write such a program.
And from my very quick view, I not found useful informations about
cachemgr interface, searching for 'cachemgr' at
http://www.squid-cache.org/ return nothing and searching at
http://wiki.squid-cache.org/ return reference to
http://wiki.squid-cache.org/ProgrammingGuide/CacheMgrApi
, but it seems as there are only some basest informations.
(which does not matter, I did not know how to program it anyway)

Thanks, Franta Hanzlik


From squid3 at treenet.co.nz  Wed Oct 29 01:45:51 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 29 Oct 2014 14:45:51 +1300
Subject: [squid-users] how to obtain info about actual active downloads?
In-Reply-To: <54503B48.3060207@hanzlici.cz>
References: <544E4977.3050705@hanzlici.cz>
 <201410271447.00509.Antony.Stone@squid.open.source.it>
 <544E74D7.2030104@solutti.com.br> <544ED366.2050708@treenet.co.nz>
 <54503B48.3060207@hanzlici.cz>
Message-ID: <545046CF.8030001@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 29/10/2014 1:56 p.m., Frantisek Hanzlik wrote:
> Amos Jeffries wrote:
>> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
>> 
>> On 28/10/2014 5:37 a.m., Leonardo Rodrigues wrote:
>>> On 27/10/14 11:47, Antony Stone wrote:
>>>> On Monday 27 October 2014 at 14:32:39 (EU time), Frantisek 
>>>> Hanzlik wrote:
>>>> 
>>>>> Please, what is best way for determining who squid clients 
>>>>> (their PC IP addresses) have which downloads active? I want
>>>>> it to determine which clients burden our slow internet
>>>>> line. Examining 'access.log' does not help much in this
>>>>> case, because users can download large files and it may
>>>>> take a few minutes or hours (e.g. in case of consuming some
>>>>> audio/video streams).
>>>> I would use the tool 'iptraf', either running on your squid 
>>>> server, or on a machine which can sniff your internal
>>>> network traffic (possibly with the use of a spanning port on
>>>> the switch).from
>>>> 
>>>> That can give you real-time bandwidth measurements per IP 
>>>> address.
>>>> 
>>> 
>>> I use this script:
>>> 
>>> http://samm.kiev.ua/sqstat/
>>> 
>>> Set it to auto-update on 15/15 seconds, for example, and
>>> you'll have a great and easy way to evaluate active connections
>>> and high bandwidth use connections.
>>> 
>> 
>> 
>> There is also the cachemgr interface for Squid. The
>> "active_requests" report lists the currently underway
>> transactions.
>> 
>> Amos
> 
> Amos, thanks for this information. From Leonardo recommended
> 'sqstat' PHP script from Alex Samorukov about doing what I need.
> I'm not a programmer, and I would have had a problem write such a
> program. And from my very quick view, I not found useful
> informations about cachemgr interface, searching for 'cachemgr' at 
> http://www.squid-cache.org/ return nothing and searching at 
> http://wiki.squid-cache.org/ return reference to 
> http://wiki.squid-cache.org/ProgrammingGuide/CacheMgrApi , but it
> seems as there are only some basest informations. (which does not
> matter, I did not know how to program it anyway)

Ah sorry. The cachemgr.cgi is the Web UI to Squid. The squidclient
tool also has a way to access the reports in TXT format for command line.

http://wiki.squid-cache.org/Features/CacheManager

The doc there is still sparse, but setting it up and having an explore
should help cover the gaps as the reports are mostly supposed to be
self-explanatory.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUUEbPAAoJELJo5wb/XPRjm30H/iTS2mfQCShaU6JBZSMGZRzi
0MzEKuEqj930zZv9vr1qawU+ap9yX/acM5aFqvhI8WYVp5O7uq6q65OOoqBojCMG
dJLNagpy6p/ozBimRIotGwgXZlwrcvMhr4uXxxtUEg/x8BjXXRJrBtemkwuE/BN+
iodwKx0LDH5Zzn+jxasBV+UrwRkwrY5ipivRtzx6I0RhpVWVa9C8n912JVjy2dFg
Vf9dEW/d4QIyy9BnLx6WyRd8ubz5Nj9cjLPuNOrH5iiHOqgLZ7rrRDYzea78vv63
4JV/HKjMqIZp3O3nW6a8ngVSLJFblYpDg41i5IT8WuOWSBMcJIMuUk16ZUeCQ5Q=
=9613
-----END PGP SIGNATURE-----


From ammdispose-squid at yahoo.com  Wed Oct 29 02:35:07 2014
From: ammdispose-squid at yahoo.com (Amm)
Date: Wed, 29 Oct 2014 08:05:07 +0530
Subject: [squid-users] how to obtain info about actual active downloads?
In-Reply-To: <545046CF.8030001@treenet.co.nz>
References: <544E4977.3050705@hanzlici.cz>
 <201410271447.00509.Antony.Stone@squid.open.source.it>
 <544E74D7.2030104@solutti.com.br> <544ED366.2050708@treenet.co.nz>
 <54503B48.3060207@hanzlici.cz> <545046CF.8030001@treenet.co.nz>
Message-ID: <5450525B.6040906@yahoo.com>


On Wednesday 29 October 2014 07:15 AM, Amos Jeffries wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 29/10/2014 1:56 p.m., Frantisek Hanzlik wrote:
>>
>> Amos, thanks for this information. From Leonardo recommended
>> 'sqstat' PHP script from Alex Samorukov about doing what I need.
>>
> Ah sorry. The cachemgr.cgi is the Web UI to Squid. The squidclient
> tool also has a way to access the reports in TXT format for command line.
>
> http://wiki.squid-cache.org/Features/CacheManager
>
>
> Amos

This command should help:

squidclient -h 127.0.0.1 mgr:active_requests

You may have to replace 127.0.0.1 with localhost

Amm.


From squid3 at treenet.co.nz  Wed Oct 29 02:59:59 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 29 Oct 2014 15:59:59 +1300
Subject: [squid-users] Large rock supporting with stable squid version
In-Reply-To: <007301cff2f0$3db74ed0$b925ec70$@netstream.ps>
References: <003001cfef8b$cd028220$67078660$@netstream.ps>
 <544EE8F9.3040406@treenet.co.nz>
 <007301cff2f0$3db74ed0$b925ec70$@netstream.ps>
Message-ID: <5450582F.7050502@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 29/10/2014 9:46 a.m., Ahmed Allzaeem wrote:
> Hi Amos , thank you.
> 
> I just wanted to explain something
> 
> Now , im okay without SMP , I can save bandwidth and its fine...but
> cores are not balanced and that may lead some cpu cores reach 100
> %
> 
> But...... I need to use SMP with large rock to save bandwidth ....
> now it works fine ...but no saving !! Im using 3.4.7 stable
> 
> What I need is , Someone used 3.head and found a result of saving
> bandwith.....as an example wt max cache size and mem size allow in
> large rock ?
> 


How are you testing for savings?
 - things as simple as pressing the browser refresh button can screw
up the results. "Refresh/reload" button sends a cache-control forcing
a MISS instead of HIT.

How are you measuring for savings?

Does your cachemgr "info" report byte-HIT ratio show greater than 0.0 ?
 - if so you are saving by that amount.


> 
> That wt I need .... I need a fast browsing squid  that can save my
> bandwidth.

Understood. Lets get you there.

> Amos , can u guide me with a 3.head verison you used with large
> rock and gave you thr best results of saving bandwidth ???
> 

I have not had any need to tune rock cache particularly. It just
worked for me.

Amos


> regards
> 
> -----Original Message----- From: squid-users
> [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of
> Amos Jeffries Sent: Monday, October 27, 2014 5:53 PM To:
> squid-users at lists.squid-cache.org Subject: Re: [squid-users] Large
> rock supporting with stable squid version
> 
> On 25/10/2014 2:09 a.m., Ahmed Allzaeem wrote:
>> Hi
> 
>> I want to ask about Large rock supporting.
> 
>> In large rock supporting wts the max size for disk store ? and
>> max size of ram store?
> 
> The disk store limit depends on HDD/SSD space available. That goes
> for all cache_dir types.
> 
> 
> What do you mean by "ram store" ?
> 
> IIRC, rock storage does away with the split memory/disk "slices" 
> which were used in COSS. So there is no tricky management of how
> many slices are in memory and swapping in/out.
> 
> Squid has a RAM store (cache_mem) which is not particularly related
> to Rock storage. You need to tune that cache_mem size around how
> much RAM is used for all cache_dir existing, and active transaction
> needs. Nobody can tell you the answer since the administrative
> "test, measure, tune" process is the only way to find it.
> 
> 
> 
>> I need someone tried large rock with squid 3.head version and
>> have seen a stability , I used last time squid3.head but it
>> hanged after sometime
> 
> 
> Details required. "hangs after some time" and "it" are very vague.
> 
> 
>> I need  a help with a squid large rock  best practice.
> 
> 
> The feature is still in beta. As an early adopter you are one of
> the people whose feedback will define what the best practice in
> future will be.
> 
> Despite being *capable* of large object storage rock is optimal for
> small objects. UFS/AUFS/diskd cache types are optimal for large
> objects - except no SMP sharing there yet which is just annoying.
> 
> For now the regular best practice for cache_dir in general applies.
> To ensure you have enough RAM for cache index (10-15MB er GB of
> cached data) not to cause memory swapping, to ensure you do not
> exceded available disk space, etc. etc.
> 
> Amos
> 
> _______________________________________________ squid-users mailing
> list squid-users at lists.squid-cache.org 
> http://lists.squid-cache.org/listinfo/squid-users
> 

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUUFgvAAoJELJo5wb/XPRj8coIAK81FHh7477B9F9UTNUj6TuY
mmi0OaQBLTgW7uyb3VZmyqjEqbZCaPva0du/JM1bpT2QudUsodrzQSvNyXPcBHxa
ne+GUfJAGnlf7bbeLuaL4uQjh5VagzwmzHffGxr/J7ekvBIduDzPfMwsWvJkVPct
rkgZ32UMayU8q3QwLV1MlG7K6MljfZUkeT0mKdoxGiNisnLlb4fRQ87tnaGCbiPR
50BdNpjQPvZjrBuAGWw9w2s8UNSpjNK8JQUsH++joonZ45K2kA4nTZGTweEnXVcm
31Q1tswg6OMLOKLV0uGM5zqSf0fxEp1vL0WVfuDEqe4rjPzWOyaNrkvTPLXvMX4=
=ZW9I
-----END PGP SIGNATURE-----


From yuri1987 at gmail.com  Wed Oct 29 08:11:21 2014
From: yuri1987 at gmail.com (Yuri Levin)
Date: Wed, 29 Oct 2014 10:11:21 +0200
Subject: [squid-users] squid removing authorization header
Message-ID: <CAAdsrF9Gn8pq6_734e83j2zfyrMO3QeNFc=m_JWCWYFc5WTFjg@mail.gmail.com>

hi,

running squid 3.3.9
is there any way to keep and pass to the cache peer the
original authorization header?

example for header:
*Authorization: Basic xxx*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141029/695f1df5/attachment.htm>

From squid3 at treenet.co.nz  Wed Oct 29 09:32:17 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 29 Oct 2014 22:32:17 +1300
Subject: [squid-users] squid removing authorization header
In-Reply-To: <CAAdsrF9Gn8pq6_734e83j2zfyrMO3QeNFc=m_JWCWYFc5WTFjg@mail.gmail.com>
References: <CAAdsrF9Gn8pq6_734e83j2zfyrMO3QeNFc=m_JWCWYFc5WTFjg@mail.gmail.com>
Message-ID: <5450B421.8090409@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 29/10/2014 9:11 p.m., Yuri Levin wrote:
> hi,
> 
> running squid 3.3.9 is there any way to keep and pass to the cache
> peer the original authorization header?

http://www.squid-cache.org/Doc/config/cache_peer/

Under "AUTHENTICATION OPTIONS":

 cache_peer ... login=PASSTHRU

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUULQhAAoJELJo5wb/XPRjj1gIAIzzjF/UmBzCezorNiqmyMBM
iGiDu1FxRHRBAThiFPYsXx9z5StU6SVVdRPYDXSDfVzmBV3wFCtjafYOHokHPOoz
VcfCYUG2LXcQna/rQRgk6E1qDXiae7cCOYjUGOxiYKIPYZITcrmB7G3EBDeL/k08
mP1WhGPEVxBl7Sfd3pxfvNGpJrCqiarsGHzsSkBoylmf1BY90nL41WdMoveAt6NS
4MucjTiGiQBiTke4xTdbW4qN8BQRCZ8tFanF2IP8tQkiqXyFOd8ff6f5SttGtLAS
YzsizfFGBGZQDBGzKnC4wWH0/AgtpXg1w7h//JfBj40BpLXeUQgTKPu6QWvlXLk=
=cGuu
-----END PGP SIGNATURE-----


From claudioml at mediaservice.net  Wed Oct 29 10:09:10 2014
From: claudioml at mediaservice.net (Claudio ML)
Date: Wed, 29 Oct 2014 11:09:10 +0100
Subject: [squid-users] Squid restarting continuously the authenticator
	processes
Message-ID: <5450BCC6.2090406@mediaservice.net>

Hello all,

I have a strange problem with a SQUID proxy with the NTLM
authentication. It randomly restarts the authenticator processes
(restart maybe not the right term), as follows:

2014-10-29T10:45:02.528245+01:00 yel1swa208 squid[29306]: Starting new
ntlmauthenticator helpers...
2014-10-29T10:45:02.529490+01:00 yel1swa208 squid[29306]:
helperOpenServers: Starting 1/800 'ntlm_auth' processes
2014-10-29T10:45:02.538002+01:00 yel1swa208 squid[29306]: Starting new
ntlmauthenticator helpers...
2014-10-29T10:45:02.539020+01:00 yel1swa208 squid[29306]:
helperOpenServers: Starting 1/800 'ntlm_auth' processes
2014-10-29T10:45:02.550401+01:00 yel1swa208 squid[29306]: Starting new
ntlmauthenticator helpers...
2014-10-29T10:45:02.551314+01:00 yel1swa208 squid[29306]:
helperOpenServers: Starting 1/800 'ntlm_auth' processes
2014-10-29T10:45:02.559424+01:00 yel1swa208 squid[29306]: Starting new
ntlmauthenticator helpers...
2014-10-29T10:45:02.560442+01:00 yel1swa208 squid[29306]:
helperOpenServers: Starting 1/800 'ntlm_auth' processes
2014-10-29T10:45:02.569961+01:00 yel1swa208 squid[29306]: Starting new
ntlmauthenticator helpers...
2014-10-29T10:45:02.570984+01:00 yel1swa208 squid[29306]:
helperOpenServers: Starting 1/800 'ntlm_auth' processes
2014-10-29T10:45:02.578951+01:00 yel1swa208 squid[29306]: Starting new
ntlmauthenticator helpers...
2014-10-29T10:45:02.579863+01:00 yel1swa208 squid[29306]:
helperOpenServers: Starting 1/800 'ntlm_auth' processes
2014-10-29T10:45:02.588642+01:00 yel1swa208 squid[29306]: Starting new
ntlmauthenticator helpers...
2014-10-29T10:45:02.589484+01:00 yel1swa208 squid[29306]:
helperOpenServers: Starting 1/800 'ntlm_auth' processes
2014-10-29T10:45:02.599002+01:00 yel1swa208 squid[29306]: Starting new
ntlmauthenticator helpers...
2014-10-29T10:45:02.599918+01:00 yel1swa208 squid[29306]:
helperOpenServers: Starting 1/800 'ntlm_auth' processes
2014-10-29T10:45:02.609309+01:00 yel1swa208 squid[29306]: Starting new
ntlmauthenticator helpers...
2014-10-29T10:45:02.610286+01:00 yel1swa208 squid[29306]:
helperOpenServers: Starting 1/800 'ntlm_auth' processes
2014-10-29T10:45:02.619248+01:00 yel1swa208 squid[29306]: Starting new
ntlmauthenticator helpers...
2014-10-29T10:45:02.620409+01:00 yel1swa208 squid[29306]:
helperOpenServers: Starting 1/800 'ntlm_auth' processes
2014-10-29T10:45:02.629324+01:00 yel1swa208 squid[29306]: Starting new
ntlmauthenticator helpers...
2014-10-29T10:45:02.630359+01:00 yel1swa208 squid[29306]:
helperOpenServers: Starting 1/800 'ntlm_auth' processes
2014-10-29T10:45:02.639402+01:00 yel1swa208 squid[29306]: Starting new
ntlmauthenticator helpers...
2014-10-29T10:45:02.640348+01:00 yel1swa208 squid[29306]:
helperOpenServers: Starting 1/800 'ntlm_auth' processes
2014-10-29T10:45:02.649164+01:00 yel1swa208 squid[29306]: Starting new
ntlmauthenticator helpers...
2014-10-29T10:45:02.650165+01:00 yel1swa208 squid[29306]:
helperOpenServers: Starting 1/800 'ntlm_auth' processes

Not sure if is a result of this, but after 10-20 mins the authentication
process with ntlm slows down terribly (tested with wbinfo -t), and the
users have some serious problem with the navigation.

Follows the relevant part of squid.conf:

# Ntlm Auth
auth_param ntlm program /usr/bin/ntlm_auth
--helper-protocol=squid-2.5-ntlmssp --debuglevel=0
auth_param ntlm children 800
#auth param ntlm keep_alive off
authenticate_ttl 3 hour
authenticate_ip_ttl 3 hour

# Base Auth
auth_param basic program /usr/bin/ntlm_auth
--helper-protocol=squid-2.5-basic
auth_param basic children 200
auth_param basic realm Squid proxy-caching web server
auth_param basic credentialsttl 2 hours

And the relevant part of smb.conf:

allow trusted domains = Yes
winbind nested groups = Yes
wins server = x.x.x.x
winbind uid = 40000-90000000000000
winbind gid = 4000-100000000000000
winbind use default domain = yes
winbind enum users = yes
winbind enum groups = yes
winbind cache time = 1000
winbind max clients = 600

The kerberos and samba authentication works perfectly, as follows:

wbinfo -t
checking the trust secret for domain YEL via RPC calls succeeded

Any idea of why this? Please is pretty urgent to solve, it causing big
problems...

Cordially,

Claudio.



From squid3 at treenet.co.nz  Wed Oct 29 11:01:41 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 30 Oct 2014 00:01:41 +1300
Subject: [squid-users] Squid restarting continuously the authenticator
 processes
In-Reply-To: <5450BCC6.2090406@mediaservice.net>
References: <5450BCC6.2090406@mediaservice.net>
Message-ID: <5450C915.3000200@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 29/10/2014 11:09 p.m., Claudio ML wrote:
> Hello all,
> 
> I have a strange problem with a SQUID proxy with the NTLM

The word is "Squid", it is a name not an acronym.

> authentication. It randomly restarts the authenticator processes 
> (restart maybe not the right term), as follows:
> 

Randomly? no, when an authenticator dies/aborts Squid starts a
replacement one.

Question is why they are dying.

Perhapse you could start by indicating what version of Squid you are
using ?


<snip>
> 2014-10-29T10:45:02.649164+01:00 yel1swa208 squid[29306]: Starting
> new ntlmauthenticator helpers... 2014-10-29T10:45:02.650165+01:00
> yel1swa208 squid[29306]: helperOpenServers: Starting 1/800
> 'ntlm_auth' processes
> 
> Not sure if is a result of this, but after 10-20 mins the
> authentication process with ntlm slows down terribly (tested with
> wbinfo -t), and the users have some serious problem with the
> navigation.
> 
> Follows the relevant part of squid.conf:
> 
> # Ntlm Auth auth_param ntlm program /usr/bin/ntlm_auth 
> --helper-protocol=squid-2.5-ntlmssp --debuglevel=0 auth_param ntlm
> children 800 #auth param ntlm keep_alive off

That is the Samba helper, so any bugs inside it are Samba problems.

Squid for NTLM is just a "dumb relay" passing the HTTP request header
tokens to the helper(s) and relaying their responses back to the
client in HTTP reply headers.

There might still be bugs in the relaying logic though. But to me it
sounds like the helpers having issues.


> authenticate_ttl 3 hour authenticate_ip_ttl 3 hour
> 
> # Base Auth auth_param basic program /usr/bin/ntlm_auth 
> --helper-protocol=squid-2.5-basic auth_param basic children 200 
> auth_param basic realm Squid proxy-caching web server auth_param
> basic credentialsttl 2 hours
> 
> And the relevant part of smb.conf:
> 
> allow trusted domains = Yes winbind nested groups = Yes wins server
> = x.x.x.x winbind uid = 40000-90000000000000 winbind gid =
> 4000-100000000000000 winbind use default domain = yes winbind enum
> users = yes winbind enum groups = yes winbind cache time = 1000 
> winbind max clients = 600


There is a big hint.

 max clients 600 vs. 800 configured Squid helpers ...

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUUMkVAAoJELJo5wb/XPRjsr8IAMRJ0xW3clhmqgGIOgwta4kD
YNE2BFdogelhmi/vVAH+wnNPRAo5tISiXgc5y3E5kvc60ibBIjJTJYsLHF2U88bn
pYhEX4Aw1pqZstVQzfFt4lNR1NQXAnzOtChQtphUGMEiywU6mVqS3KWiemp0fIwh
vSQCz6HCBgVBDN5K6wPDy1fyx2e+jzx0m9QL9Y6NxjdwEVD4nG/pHkh+HX0bQDzB
dRiaoavyZTB6SmSs1saCcd2p1LnKJ90Wgp7iv/Uuy0DNdhqzMe9DpVRIvitFMUTg
RLkcxMk6ORNKAjHH4rXya9Ct0XBjGCLXjxO9tBiS24uX819c5qyMtCjwBuLawX4=
=EqI3
-----END PGP SIGNATURE-----


From claudioml at mediaservice.net  Wed Oct 29 11:11:41 2014
From: claudioml at mediaservice.net (Claudio ML)
Date: Wed, 29 Oct 2014 12:11:41 +0100
Subject: [squid-users] Squid restarting continuously the authenticator
 processes
In-Reply-To: <5450C915.3000200@treenet.co.nz>
References: <5450BCC6.2090406@mediaservice.net>
 <5450C915.3000200@treenet.co.nz>
Message-ID: <5450CB6D.8080003@mediaservice.net>

Il 29/10/2014 12:01, Amos Jeffries ha scritto:
> On 29/10/2014 11:09 p.m., Claudio ML wrote:
> > Hello all,
>
> > I have a strange problem with a SQUID proxy with the NTLM
>
> The word is "Squid", it is a name not an acronym.
>
> > authentication. It randomly restarts the authenticator processes
> > (restart maybe not the right term), as follows:
>
>
> Randomly? no, when an authenticator dies/aborts Squid starts a
> replacement one.
>
> Question is why they are dying.
>
> Perhapse you could start by indicating what version of Squid you are
> using ?
>
My Squid version is 3.2.11 (OpenSuSE 12.3)
>
> <snip>
> > 2014-10-29T10:45:02.649164+01:00 yel1swa208 squid[29306]: Starting
> > new ntlmauthenticator helpers... 2014-10-29T10:45:02.650165+01:00
> > yel1swa208 squid[29306]: helperOpenServers: Starting 1/800
> > 'ntlm_auth' processes
>
> > Not sure if is a result of this, but after 10-20 mins the
> > authentication process with ntlm slows down terribly (tested with
> > wbinfo -t), and the users have some serious problem with the
> > navigation.
>
> > Follows the relevant part of squid.conf:
>
> > # Ntlm Auth auth_param ntlm program /usr/bin/ntlm_auth
> > --helper-protocol=squid-2.5-ntlmssp --debuglevel=0 auth_param ntlm
> > children 800 #auth param ntlm keep_alive off
>
> That is the Samba helper, so any bugs inside it are Samba problems.
>
> Squid for NTLM is just a "dumb relay" passing the HTTP request header
> tokens to the helper(s) and relaying their responses back to the
> client in HTTP reply headers.
>
> There might still be bugs in the relaying logic though. But to me it
> sounds like the helpers having issues.
>
>
Where into log files i can look if helpers have issues?
> > authenticate_ttl 3 hour authenticate_ip_ttl 3 hour
>
> > # Base Auth auth_param basic program /usr/bin/ntlm_auth
> > --helper-protocol=squid-2.5-basic auth_param basic children 200
> > auth_param basic realm Squid proxy-caching web server auth_param
> > basic credentialsttl 2 hours
>
> > And the relevant part of smb.conf:
>
> > allow trusted domains = Yes winbind nested groups = Yes wins server
> > = x.x.x.x winbind uid = 40000-90000000000000 winbind gid =
> > 4000-100000000000000 winbind use default domain = yes winbind enum
> > users = yes winbind enum groups = yes winbind cache time = 1000
> > winbind max clients = 600
>
>
> There is a big hint.
>
>  max clients 600 vs. 800 configured Squid helpers ...
>
You are right, now my config is 800 as max clients on samba, and 800
Squid helpers.

Thank you,

Claudio.
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141029/3fc7735d/attachment.htm>

From anton.tkachev at gmail.com  Wed Oct 29 11:19:35 2014
From: anton.tkachev at gmail.com (Anton Tkachev)
Date: Wed, 29 Oct 2014 17:19:35 +0600
Subject: [squid-users] Add reply header in Squid
Message-ID: <CAL6QG4Vh-9u0-0y3r-sayBEW4xY78aNHZU7Gz6RUHVU+2BMeEQ@mail.gmail.com>

Dear Squid users

I need to add response header to every response in squid.
There is no reply_header_add configuration directive, so I assume that
modifying the source code is the only way to do this.

Does anybody know where exactly in the source code I should do it?

Thank you,
Anton Tkachev.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141029/ea487a6a/attachment.htm>

From squid3 at treenet.co.nz  Wed Oct 29 12:10:39 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 30 Oct 2014 01:10:39 +1300
Subject: [squid-users] Squid restarting continuously the authenticator
 processes
In-Reply-To: <5450CB6D.8080003@mediaservice.net>
References: <5450BCC6.2090406@mediaservice.net>
 <5450C915.3000200@treenet.co.nz> <5450CB6D.8080003@mediaservice.net>
Message-ID: <5450D93F.20507@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 30/10/2014 12:11 a.m., Claudio ML wrote:
> Where into log files i can look if helpers have issues?

In the cache.log. But you need to configure the helper to emit debug
info before it will show up most times.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUUNk+AAoJELJo5wb/XPRj+awH/i9KVfEDNlC+6n8Qczv3OXzk
TYd/fyRCHO/IIbExlBLoW78+4KHCsvyAsFd2FKv4MbEsPw1M/kCVjHouhIQ1hKxP
m+frwzJIiWaXqcVCVGX51eWUNoBEJKB91UO3Wg/cXaOxltyebRPlRMzUiP3NARdN
FCTSyYZLa3quR7josc2p9vdr8DBSxRbJVQk6alqqwyKTHKZNmXhaahBlTOGN0Ngi
/iRW+v/gUIiPaddxFTJcKVBVrjVmJsduF+sk+iVPry2m8giXG5kkxvOuXBpUyHXZ
DB3XFPdCYwMzZU0Lv4FgLkSOBImHxa2OS18MFJBFDtdsSdDv7ufg8E7SGY70CPQ=
=QP1D
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Wed Oct 29 12:11:22 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 30 Oct 2014 01:11:22 +1300
Subject: [squid-users] Add reply header in Squid
In-Reply-To: <CAL6QG4Vh-9u0-0y3r-sayBEW4xY78aNHZU7Gz6RUHVU+2BMeEQ@mail.gmail.com>
References: <CAL6QG4Vh-9u0-0y3r-sayBEW4xY78aNHZU7Gz6RUHVU+2BMeEQ@mail.gmail.com>
Message-ID: <5450D96A.5060707@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 30/10/2014 12:19 a.m., Anton Tkachev wrote:
> Dear Squid users
> 
> I need to add response header to every response in squid.
> There is no reply_header_add configuration directive, so I assume that
> modifying the source code is the only way to do this.
> 
> Does anybody know where exactly in the source code I should do it?

What are you trying to do with these custom reply headers?

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUUNlqAAoJELJo5wb/XPRj6eYH/iyt2oFPla91HT8v5Q168LSR
m4YiwUX7pIsMltxdWegZQ6XSBS8xMwWjoCFY/F4MK0uYfJsTwAP22dUgUVl02Jzk
dNX4LnMAaBhjOC2m0hawWimzEvaqB8oraQKD/0PXbPIKBpMkudG116G6gpoL/1k3
7XLOUiK1YDxLnwb4UBj21l35gyANd7dAXsOvlGx8Fi7lstMuS/JAPdwwYQSRMgRh
im5P0RYxnNXWhVZBbrPlJbEv6pLIN7RYYE+4aWZ3gVuXCLXr9ZJTxv83ZgLJLp8k
en+ZlE0DEHL4jLQlrFA6j7GJmmvMHN86E57MZUFCq11OofqPzhdVPI+JvL0ufHw=
=jJNQ
-----END PGP SIGNATURE-----


From raghu.sai92 at gmail.com  Wed Oct 29 12:40:39 2014
From: raghu.sai92 at gmail.com (sai raghavendra)
Date: Wed, 29 Oct 2014 18:10:39 +0530
Subject: [squid-users] Sticky sessions support in squid
Message-ID: <CAJ1HmOz0JFneEfDoruqiqu09Tf=y_Vg=0JEaJoUQSQdzMiAZ+Q@mail.gmail.com>

Hi,

                We are currently using squid-3.1.10 as an internal proxy
server. It sends requests to 3 external proxies which interact with the
world wide web.


I was just wondering if there is a support for sticky sessions in squid ,
so that we can send a set of continual requests to a specific external
proxy through squid.

As a part of this, also wanted to know  if the client can send an HTTP
request header to squid to choose which external proxy squid should send
the request to.


Please let us know for any clarity.


Thanks

Sai
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141029/88735c4d/attachment.htm>

From squid3 at treenet.co.nz  Wed Oct 29 13:21:48 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 30 Oct 2014 02:21:48 +1300
Subject: [squid-users] Sticky sessions support in squid
In-Reply-To: <CAJ1HmOz0JFneEfDoruqiqu09Tf=y_Vg=0JEaJoUQSQdzMiAZ+Q@mail.gmail.com>
References: <CAJ1HmOz0JFneEfDoruqiqu09Tf=y_Vg=0JEaJoUQSQdzMiAZ+Q@mail.gmail.com>
Message-ID: <5450E9EC.90006@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 30/10/2014 1:40 a.m., sai raghavendra wrote:
> Hi,
> 
> We are currently using squid-3.1.10 as an internal proxy server. It
> sends requests to 3 external proxies which interact with the world
> wide web.
> 
> 
> I was just wondering if there is a support for sticky sessions in
> squid , so that we can send a set of continual requests to a
> specific external proxy through squid.

It sounds like you are wanting either the carp, userhash, or
sourcehash peering algorithm.
http://www.squid-cache.org/Doc/config/cache_peer/

> 
> As a part of this, also wanted to know  if the client can send an
> HTTP request header to squid to choose which external proxy squid
> should send the request to.

cache_peer_access with an req_header ACL test can do that.
http://www.squid-cache.org/Doc/config/cache_peer_access/
http://www.squid-cache.org/Doc/config/acl/

However be aware that placing the client UA in control of low-level
routing details is not compatible with the earlier mentioned selection
algorithms. Layering algorithms just causes 500 or 503 errors whenever
the hash algorithm and client disagree on what peer to use.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUUOnsAAoJELJo5wb/XPRjdnwH/1WuBNBdfWc/eLmYfv6HvgTB
KBYGJ1zQnNEDzon1yllP4DU0HL6vCjdIf3puf+zvxm/RoV7iTqmikF3dBYHNiE32
6NhtphFkVgb0uVHntVKKnXdmMeN9a7t2jQk2NzVyrWNTckGVs9WsxknEGBwyQ9ox
fWf0xOV/nBOeoZW+fdN7PiAsiG1+qlFgjRMve/I9u4wAgL6ZoMvPo+/VP7aR0mAb
QOfx2RId7AXecTlkRaOBoPNdjwD5nPK+uBztxDTDV98qttq9xJd5T7+aOhDu2Pl+
ew+H3BuytKtIbkjZowgiH745iu8s3aQVzbSLTKBuyETsFMz/aRg5K46CYqw8tdE=
=uuoB
-----END PGP SIGNATURE-----


From anton.tkachev at gmail.com  Wed Oct 29 17:46:38 2014
From: anton.tkachev at gmail.com (Anton Tkachev)
Date: Wed, 29 Oct 2014 23:46:38 +0600
Subject: [squid-users] Add reply header in Squid
Message-ID: <CAL6QG4XE8C6GuO5uu9KokAv1T7Xn9LDnTHAHaAckk4DkJ=mNSw@mail.gmail.com>

Hi Amos

We need some kind of communication between Squid and the client (browser
extension).
The idea is to add resonse header to all responses in the source code and
then control it using reply_header_access.


> What are you trying to do with these custom reply headers?
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141029/387e272d/attachment.htm>

From jlay at slave-tothe-box.net  Thu Oct 30 00:48:10 2014
From: jlay at slave-tothe-box.net (James Lay)
Date: Wed, 29 Oct 2014 18:48:10 -0600
Subject: [squid-users] Status of SSL Peek and Splice
Message-ID: <1414630090.2891.2.camel@JamesiMac>

Hey all,

I'm currently running Squid Cache: Version 3.HEAD-BZR.  I was wondering
what the status was of this...if there have been later releases with
improvements.  Thank you.

James



From dan at getbusi.com  Thu Oct 30 00:51:01 2014
From: dan at getbusi.com (dan at getbusi.com)
Date: Wed, 29 Oct 2014 17:51:01 -0700 (PDT)
Subject: [squid-users] Status of SSL Peek and Splice
In-Reply-To: <1414630090.2891.2.camel@JamesiMac>
References: <1414630090.2891.2.camel@JamesiMac>
Message-ID: <1414630260898.e1de0b52@Nodemailer>

+1




Struggled through building 3.5.0.1 RPM the other day to try this but there didn?t seem to be any change to the SSL bump behaviour from what I could tell ?

On Thu, Oct 30, 2014 at 11:49 AM, James Lay <jlay at slave-tothe-box.net>
wrote:

> Hey all,
> I'm currently running Squid Cache: Version 3.HEAD-BZR.  I was wondering
> what the status was of this...if there have been later releases with
> improvements.  Thank you.
> James
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141029/412e338a/attachment.htm>

From squid3 at treenet.co.nz  Thu Oct 30 00:57:18 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 30 Oct 2014 13:57:18 +1300
Subject: [squid-users] Status of SSL Peek and Splice
In-Reply-To: <1414630090.2891.2.camel@JamesiMac>
References: <1414630090.2891.2.camel@JamesiMac>
Message-ID: <54518CEE.3010408@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 30/10/2014 1:48 p.m., James Lay wrote:
> Hey all,
> 
> I'm currently running Squid Cache: Version 3.HEAD-BZR.  I was
> wondering what the status was of this...if there have been later
> releases with improvements.  Thank you.

"Peek and Splice" feature was included in the 3.5 series which is now
in beta cycle with a 3.5.0.1 package available for testing.
http://www.squid-cache.org/Versions/v3/3.5/

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUUYzuAAoJELJo5wb/XPRjy1IH/2oeZVNqDN3tC+9sOt6dB3nk
IdDwTyoeLEuiHgd/fqtsDmj769wEiGjCfYa6G8rpLkVEKxQ2br6dHNU7F+fdP9bM
v1EI1UT3poa2GbniNYc4B7vX3NSqsh6NZVt+yLXlpnbKMj9vaP9GJrh6iFLi1dXN
AmVHlPVQVZlA/u4BLAG7uMX2WK0i+OWfPgNtzTZk6dWleQ6oIPCs93PXzvN1UkfP
YhF+VdZDo9pdVoc6XtpQRrQINZG2TFLXZFZGdor3O9iReeBH60vxUToDfm1qOwpO
e/YDR8V6VqlZWnQw4XAgtCs8192Gc0wT1f81L3lC7Mi4p7frpCUjOSM61eXts3U=
=64GE
-----END PGP SIGNATURE-----


From jlay at slave-tothe-box.net  Thu Oct 30 01:06:38 2014
From: jlay at slave-tothe-box.net (James Lay)
Date: Wed, 29 Oct 2014 19:06:38 -0600
Subject: [squid-users] Status of SSL Peek and Splice
In-Reply-To: <54518CEE.3010408@treenet.co.nz>
References: <1414630090.2891.2.camel@JamesiMac>
 <54518CEE.3010408@treenet.co.nz>
Message-ID: <1414631198.2891.3.camel@JamesiMac>

On Thu, 2014-10-30 at 13:57 +1300, Amos Jeffries wrote:
> On 30/10/2014 1:48 p.m., James Lay wrote:
> > Hey all,
> > 
> > I'm currently running Squid Cache: Version 3.HEAD-BZR.  I was
> > wondering what the status was of this...if there have been later
> > releases with improvements.  Thank you.
> 
> "Peek and Splice" feature was included in the 3.5 series which is now
> in beta cycle with a 3.5.0.1 package available for testing.
> http://www.squid-cache.org/Versions/v3/3.5/
> 
> Amos
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

Thank you Amos...I will give it a go.

James



From squid3 at treenet.co.nz  Thu Oct 30 01:09:08 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 30 Oct 2014 14:09:08 +1300
Subject: [squid-users] Status of SSL Peek and Splice
In-Reply-To: <1414630260898.e1de0b52@Nodemailer>
References: <1414630090.2891.2.camel@JamesiMac>
 <1414630260898.e1de0b52@Nodemailer>
Message-ID: <54518FB4.5080007@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 30/10/2014 1:51 p.m., dan at getbusi.com wrote:
> +1
> 
> Struggled through building 3.5.0.1 RPM the other day to try this
> but there didn?t seem to be any change to the SSL bump behaviour
> from what I could tell ?
> 


Oh, in that regards no there have been no changes to that specific
feature since it was merged to 3.HEAD/3.5.
 But there have been other bug fixes improving the overall squid
stability.

Things are a little bit confusing with 3.5 at present, technically it
has passed the criteria for becoming stable already. On the one hand
it has had more testing than any previous release so that was a hoped
for outcome. On the other hand the Sept services outage has still been
causing problems with beta testers being able to fetch and test the
3.5.0.1 package across Oct.
So I will be giving it an extra few weeks with the stable countdown
clock starting from yesterday when the main mirror servers got their
updates working again.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUUY+0AAoJELJo5wb/XPRjBDQH/RkPrpAtM8khhorQ7EBS3Rny
vIcNzrZqYhYbxtMbaIP5CZeY5YGsI7PYELNS1BZSV2UqPAxGNDhpISbAI3Jopfwh
mnl/3DS15ERehvVcv1sp2N+KKz/yvABFUqs85ieVwNrloQrP+OFJsxFGrtv4EhRv
LSYbjnwqdKKAQPUGJcJiRNPFdRuWQqZwZumaVjR2va7JhCHs3lKdv4alRCbgS4tT
eiswrTW5fBx/dgDs/jZu+5s704a71w+3gWFXynVEwqwNVr+xnmxxgjzP7svJ1Lle
F5o1UuDMdOHh5qQ11uacjvIJ1ysJV4Jc73oAzm2t04LhlBYvmCgGYp75JwMTRF0=
=BcNq
-----END PGP SIGNATURE-----


From dan at getbusi.com  Thu Oct 30 01:12:00 2014
From: dan at getbusi.com (dan at getbusi.com)
Date: Wed, 29 Oct 2014 18:12:00 -0700 (PDT)
Subject: [squid-users] Status of SSL Peek and Splice
In-Reply-To: <1414631198.2891.3.camel@JamesiMac>
References: <1414631198.2891.3.camel@JamesiMac>
Message-ID: <1414631519724.45002e1e@Nodemailer>

Hey James




Please report back on how you go with it. An example of your configuration would be awesome, if you get Peek & Splice happening.




Cheers!

Dan

On Thu, Oct 30, 2014 at 12:06 PM, James Lay <jlay at slave-tothe-box.net>
wrote:

> On Thu, 2014-10-30 at 13:57 +1300, Amos Jeffries wrote:
>> On 30/10/2014 1:48 p.m., James Lay wrote:
>> > Hey all,
>> > 
>> > I'm currently running Squid Cache: Version 3.HEAD-BZR.  I was
>> > wondering what the status was of this...if there have been later
>> > releases with improvements.  Thank you.
>> 
>> "Peek and Splice" feature was included in the 3.5 series which is now
>> in beta cycle with a 3.5.0.1 package available for testing.
>> http://www.squid-cache.org/Versions/v3/3.5/
>> 
>> Amos
>> 
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
> Thank you Amos...I will give it a go.
> James
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141029/274b286e/attachment.htm>

From jlay at slave-tothe-box.net  Thu Oct 30 01:29:06 2014
From: jlay at slave-tothe-box.net (James Lay)
Date: Wed, 29 Oct 2014 19:29:06 -0600
Subject: [squid-users] Status of SSL Peek and Splice
In-Reply-To: <1414631519724.45002e1e@Nodemailer>
References: <1414631198.2891.3.camel@JamesiMac>
 <1414631519724.45002e1e@Nodemailer>
Message-ID: <1414632546.2891.6.camel@JamesiMac>

On Wed, 2014-10-29 at 18:12 -0700, dan at getbusi.com wrote:
> Hey James
> 
> 
> Please report back on how you go with it. An example of your
> configuration would be awesome, if you get Peek & Splice happening.
> 
> 
> Cheers!
> Dan
> 
> 
> 
>  
> 
> 
> On Thu, Oct 30, 2014 at 12:06 PM, James Lay <jlay at slave-tothe-box.net>
> wrote:
> 
> 
>         On Thu, 2014-10-30 at 13:57 +1300, Amos Jeffries wrote:
>         > On 30/10/2014 1:48 p.m., James Lay wrote:
>         > > Hey all,
>         > > 
>         > > I'm currently running Squid Cache: Version 3.HEAD-BZR. I
>         was
>         > > wondering what the status was of this...if there have been
>         later
>         > > releases with improvements. Thank you.
>         > 
>         > "Peek and Splice" feature was included in the 3.5 series
>         which is now
>         > in beta cycle with a 3.5.0.1 package available for testing.
>         > http://www.squid-cache.org/Versions/v3/3.5/
>         > 
>         > Amos
>         > 
>         > _______________________________________________
>         > squid-users mailing list
>         > squid-users at lists.squid-cache.org
>         > http://lists.squid-cache.org/listinfo/squid-users
>         
>         Thank you Amos...I will give it a go.
>         
>         James
>         
>         _______________________________________________
>         squid-users mailing list
>         squid-users at lists.squid-cache.org
>         http://lists.squid-cache.org/listinfo/squid-users
>         
>         
> 
I sure will.  My hope has been just to peek everything since I have two
kids...I have an url.txt file that gontains what the have access to...I
don't actually want to decrypt anything, just make sure they're not
going anywhere they shouldn't.  I have been enable to do this as of yet,
but I'll keep trying.  I'll post configs and whatnot in a separate
thread.  Thank you.

James




From niulicheng at gmail.com  Thu Oct 30 03:27:32 2014
From: niulicheng at gmail.com (Niu Licheng)
Date: Thu, 30 Oct 2014 11:27:32 +0800
Subject: [squid-users] Does Squid support setting an expiration time less
	than one minute?
Message-ID: <67A6359C-E19A-4134-B7E1-1E53BCC9F969@gmail.com>

Hi guys,

I?ve been using Squid as a proxy cache. In my specific case, I need to set cache expiry time to 10 seconds. I tried refresh_pattern, but I found refresh_pattern only supports setting expiry time in minute unites. 
E.g.	refresh_pattern   ^http:   1  0%  1  override-expire

Is there any ways to configure an expiry time in second unites?

Thanks

From squid3 at treenet.co.nz  Thu Oct 30 03:47:56 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 30 Oct 2014 16:47:56 +1300
Subject: [squid-users] Does Squid support setting an expiration time
 less than one minute?
In-Reply-To: <67A6359C-E19A-4134-B7E1-1E53BCC9F969@gmail.com>
References: <67A6359C-E19A-4134-B7E1-1E53BCC9F969@gmail.com>
Message-ID: <5451B4EC.3030606@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 30/10/2014 4:27 p.m., Niu Licheng wrote:
> Hi guys,
> 
> I?ve been using Squid as a proxy cache. In my specific case, I need
> to set cache expiry time to 10 seconds. I tried refresh_pattern,
> but I found refresh_pattern only supports setting expiry time in
> minute unites. E.g.	refresh_pattern   ^http:   1  0%  1
> override-expire
> 
> Is there any ways to configure an expiry time in second unites?

No. The server is supposed to be setting correct expiry and cache
controls.

The refresh_pattern you are trying to use above defeats the purpose of
having the proxy caching at all. Might as well not cache.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUUbTsAAoJELJo5wb/XPRjp34IANwu6A4/tyu1kAfkNToWPPhj
fdyR9LTglBMno5xCy57vAzazXV87Wa683vmkp2kHBrjblUi8SB8Ya6tAh8WNDvjW
pMheTH4Gk2Nq7Gwm0B5q7QJriOwvHESklhr/smfKbVmrwzcfZVx0Pz2TRIIf/OmU
ti2ncusd6SQKZdbJJae/DZ51ZMv+LR2t1qSaEsAsxRu+KwePQCLBluKxp9odcXPT
r5YIub+fBlJ5fGFwk9HukSU2vd4y69713PfgTreS0mVRsZcgyDYc2biygebV7rzx
gPPeUQX04pjUGjFo+oj979/b7qmvfgMz4QRU9eIqfFRki1o35WiUAKeXfARV9b4=
=6Ii+
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Thu Oct 30 04:52:29 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 30 Oct 2014 17:52:29 +1300
Subject: [squid-users] ident authentication problem
In-Reply-To: <8ae2d3b4416b4528b75012c7f4a23436@SIXPR04MB304.apcprd04.prod.outlook.com>
References: <8ae2d3b4416b4528b75012c7f4a23436@SIXPR04MB304.apcprd04.prod.outlook.com>
Message-ID: <5451C40D.8060504@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Sorry for this not being replied to earlier. Details inline below.

On 26/08/2014 2:25 p.m., James Harper wrote:
> I am using the latest 3.4 build and a config that looks like:
> 
> ident_lookup_access allow localnet ident_lookup_access deny all 
> ident_timeout 5 seconds
> 
> acl password_required proxy_auth REQUIRED acl ident_required ident
> REQUIRED
> 
> http_access allow localnet ident_required ident_unrestricted_group 
> http_access allow localnet ident_required unrestricted_sites 
> http_access_deny localnet ident_required
> 
> http_access allow localnet password_required
> password_unrestricted_group http_access allow localnet
> password_required unrestricted_sites
> 
> http_access_deny
> 
> The idea is that ident will be used, and if ident can't be used,
> proxy auth (ntlm) will be used.
> 
> The problem is that for users who ident successfully but are not in
> the ident_unrestricted_group / password_unrestricted_group (both
> the same windows group), they get a 407 response and a password
> prompt, instead of an access denied. I can work around this by
> putting:
> 
> deny_info 403:ERR_ACCESS_DENIED ident_required
> 
> just before the identd deny, but it seems like a hack.
> 
> Am I doing something wrong or could this be a bug?

You seem to be expecting that ident_required will return false if
ident is not supplied

Try this instead:

 acl login proxy_auth REQUIRED
 acl ident ident REQUIRED

 http_access deny !localnet
 http_access allow unrestricted_sites

 http_access deny ident !ident_unrestricted_group
 http_access allow ident

 http_access deny !login
 http_access allow password_unrestricted_group

 http_access deny all


> 
> Also, are there any implementations of ident that are a bit more
> useful? Such a thing would: . have a single TCP connection between
> squid and the client (preferably client initiated), kept alive for
> a reasonable time . authenticate the identd server itself (identd
> is not really considered secure) . allow squid to specify all
> aspects of the connection (ident expects the lookup to come from
> the destination, which isn't true if you are doing transparent
> proxying, although easy to patch squid to fake the source)
> 


IDENT is a protocol. It is what it was designed to be. It is *not* a
form of authentication in any way.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUUcQNAAoJELJo5wb/XPRj7CIH/0bSEnAgxKnDOCIwHvejBVOk
3/xnaExb62H5ujP+MoFRE2Kd35xaMSsGT7GjFC0a46OpU1SkO9zGzyqLeWCzrPTN
Pyf3b7sBon0pc37uU0IEm76mbJ6lARI3hoRYQiUVtPiwcOduQi1DAVfv1c+u8o5D
ivPoHPM1gLl3KJi2Vw0WleCafYgmm1eKJNLGVqkGX2c0DEpFs+UG4xSbiKi+82tP
vv1BybV7n5DoS3qwqTRikWe5h1Ar8Uc6gGs5vgMu//lZyxUb6BrrTQhqZOIwPnbz
5/5p0X56t2qrRn82D8UE+zdi1zlYfg/ZhZy3mYvkXCyO+y3HPW8qnvIzFGo0gWw=
=Y/kW
-----END PGP SIGNATURE-----


From niulicheng at gmail.com  Thu Oct 30 06:19:23 2014
From: niulicheng at gmail.com (Niu Licheng)
Date: Thu, 30 Oct 2014 14:19:23 +0800
Subject: [squid-users] Does Squid support setting an expiration time
	less than one minute?
In-Reply-To: <5451B4EC.3030606@treenet.co.nz>
References: <67A6359C-E19A-4134-B7E1-1E53BCC9F969@gmail.com>
 <5451B4EC.3030606@treenet.co.nz>
Message-ID: <1C8A0E61-196A-409A-A024-B88F41E2B14B@gmail.com>

Thanks for the quick response. In my specific case, I want the http responses to be valid in the cache for a constant time period, I know it violate http standard though.  
Nginx supports setting caching time by "proxy_cache_valid 200 10s?, is there similar approaches in Squid?


On Oct 30, 2014, at 11:47 AM, Amos Jeffries <squid3 at treenet.co.nz> wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> On 30/10/2014 4:27 p.m., Niu Licheng wrote:
>> Hi guys,
>> 
>> I?ve been using Squid as a proxy cache. In my specific case, I need
>> to set cache expiry time to 10 seconds. I tried refresh_pattern,
>> but I found refresh_pattern only supports setting expiry time in
>> minute unites. E.g.	refresh_pattern   ^http:   1  0%  1
>> override-expire
>> 
>> Is there any ways to configure an expiry time in second unites?
> 
> No. The server is supposed to be setting correct expiry and cache
> controls.
> 
> The refresh_pattern you are trying to use above defeats the purpose of
> having the proxy caching at all. Might as well not cache.
> 
> Amos
> 
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2.0.22 (MingW32)
> 
> iQEcBAEBAgAGBQJUUbTsAAoJELJo5wb/XPRjp34IANwu6A4/tyu1kAfkNToWPPhj
> fdyR9LTglBMno5xCy57vAzazXV87Wa683vmkp2kHBrjblUi8SB8Ya6tAh8WNDvjW
> pMheTH4Gk2Nq7Gwm0B5q7QJriOwvHESklhr/smfKbVmrwzcfZVx0Pz2TRIIf/OmU
> ti2ncusd6SQKZdbJJae/DZ51ZMv+LR2t1qSaEsAsxRu+KwePQCLBluKxp9odcXPT
> r5YIub+fBlJ5fGFwk9HukSU2vd4y69713PfgTreS0mVRsZcgyDYc2biygebV7rzx
> gPPeUQX04pjUGjFo+oj979/b7qmvfgMz4QRU9eIqfFRki1o35WiUAKeXfARV9b4=
> =6Ii+
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From squid3 at treenet.co.nz  Thu Oct 30 08:08:51 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 30 Oct 2014 21:08:51 +1300
Subject: [squid-users] Does Squid support setting an expiration time
 less than one minute?
In-Reply-To: <1C8A0E61-196A-409A-A024-B88F41E2B14B@gmail.com>
References: <67A6359C-E19A-4134-B7E1-1E53BCC9F969@gmail.com>
 <5451B4EC.3030606@treenet.co.nz>
 <1C8A0E61-196A-409A-A024-B88F41E2B14B@gmail.com>
Message-ID: <5451F213.1030808@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 30/10/2014 7:19 p.m., Niu Licheng wrote:
> Thanks for the quick response. In my specific case, I want the http
> responses to be valid in the cache for a constant time period, I
> know it violate http standard though. Nginx supports setting
> caching time by "proxy_cache_valid 200 10s?, is there similar
> approaches in Squid?
> 

The closest is the refresh_pattern override you found already.

In Squid we believe in following the web standards, and encouraging
server operators to follow them as much as possible too.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUUfISAAoJELJo5wb/XPRjwvMH/RP4MRZy1Q+R4pwiMvvBze7l
+JRhSnQ8murBWp0mnhc1u0o+N2Eq7GoWYumtdpIvg27paThn/bApkj8H6PfTFmRP
Z6sNMJ7EGejMw9RblAagYsvp+DfClgEyeCrcEpViqG3MMpPcuzGWFH7nrl2tGOL9
7VXeH8W9HjO7dyEfDjZSk+X3mng9p3VWfsuaw3+xaLVfL4plwxYEblDfsQJslLcE
7qfCJ6MoFfAj2y83jeXJ4LaLWyZVGlSCsnVI9rPvTJJwSqSqqkA5Jsm8gBvb84IF
s2sh1sL8/+mQkb3AcosRqG7K9M30HdviVeLiauT+V7M8HD9pztX2Tj6NQR0ZIFk=
=YBfG
-----END PGP SIGNATURE-----


From jlay at slave-tothe-box.net  Thu Oct 30 12:06:06 2014
From: jlay at slave-tothe-box.net (James Lay)
Date: Thu, 30 Oct 2014 06:06:06 -0600
Subject: [squid-users] Correctly implementing peak-splice
Message-ID: <1414670766.2891.14.camel@JamesiMac>

Hello all,

Here is my complete config for trying out peek/splice.  This currently
does not work..is there something obvious that I'm mission?  Current
error is:

Oct 30 06:03:14 gateway squid: 192.168.1.110 - - [30/Oct/2014:06:03:14
-0600] "GET https://www.google.com/ HTTP/1.1" 503 3854
TAG_NONE:HIER_NONE

and on the page I get a 71 protocol error and a SSL3_WRITE_PENDING:bad
write retry.

Thank you.

James

acl localnet src 192.168.1.0/24

acl SSL_ports port 443
acl Safe_ports port 80		# http
acl Safe_ports port 21		# ftp
acl Safe_ports port 443		# https
acl Safe_ports port 1025-65535	# unregistered ports
acl Safe_ports port 280		# http-mgmt
acl Safe_ports port 488		# gss-http
acl Safe_ports port 591		# filemaker
acl Safe_ports port 777		# multiling http

acl CONNECT method CONNECT
acl allowed_sites url_regex "/opt/etc/squid/url.txt"
acl all_others dst all
acl SSL method CONNECT


http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

http_access allow manager localhost
http_access deny manager

http_access allow allowed_sites
http_access deny all_others 
http_access allow localnet
http_access allow localhost

http_access deny all
icp_access deny all

sslproxy_cert_error allow all

sslproxy_options ALL
sslproxy_flags DONT_VERIFY_PEER

ssl_bump peek all

sslcrtd_program /opt/libexec/ssl_crtd -s /opt/etc/squid/ssl_db -M 4MB
sslcrtd_children 8 startup=1 idle=1

http_port 192.168.1.253:3128 intercept
 
https_port 192.168.1.253:3129 intercept ssl-bump
generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
cert=/opt/sslsplit/sslsplit.crt key=/opt/sslsplit/sslsplitca.key
options=ALL sslflags=NO_SESSION_REUSE

always_direct allow all


access_log syslog:daemon.info common

refresh_pattern ^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern -i (cgi-bin|\?)	0	0%	0
refresh_pattern .		0	20%	4320

icp_port 3130

coredump_dir /opt/var



From jlay at slave-tothe-box.net  Thu Oct 30 13:00:52 2014
From: jlay at slave-tothe-box.net (James Lay)
Date: Thu, 30 Oct 2014 07:00:52 -0600
Subject: [squid-users] Adding ssl info to logging
Message-ID: <1414674052.2891.18.camel@JamesiMac>

A quick question.  Currently I have no logformat line at all in my
config.  What's the easiest way to add %ssl::>cert_subject as an
addition?  Do I just mimic:

logformat common

and add it in like:

logformat %>a %[ui %[un [%tl] "%rm %ru HTTP/%rv" %>Hs %<st %Ss:%Sh %
ssl::>cert_subject

Thank you.

James



From squid3 at treenet.co.nz  Thu Oct 30 13:14:42 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 31 Oct 2014 02:14:42 +1300
Subject: [squid-users] Adding ssl info to logging
In-Reply-To: <1414674052.2891.18.camel@JamesiMac>
References: <1414674052.2891.18.camel@JamesiMac>
Message-ID: <545239C2.6080204@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 31/10/2014 2:00 a.m., James Lay wrote:
> A quick question.  Currently I have no logformat line at all in my 
> config.  What's the easiest way to add %ssl::>cert_subject as an 
> addition?  Do I just mimic:
> 
> logformat common
> 
> and add it in like:
> 
> logformat %>a %[ui %[un [%tl] "%rm %ru HTTP/%rv" %>Hs %<st %Ss:%Sh
> % ssl::>cert_subject

Pretty much. Though don't forget the format name.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUUjnBAAoJELJo5wb/XPRj2SwH/2Pngbm4t2AgbfDbiXJT1L/o
XppS3mwNIqEYuZb6Pzrwq5JYM8/HPvqej1hzGkV0HflLQzUdcVcDf7sPWSbUvZJQ
nxO2SeLLASKL4YQWsSYdTruCm4lfD8RScz2fTmh3PfoWm90psz5H/vdJ44Tr2p1k
SZ0rh2L8QEzhO6YZpvkeZfCyKNZYnZJwk92/qUk5WOMGZYoYdm0598UJ8gPs4fkG
UpFvfOXdcz9Gl1Y3yXdsT4e9ebNWdDv3qOsASReIsprj8DNHIcHkvVaQbf4gVr8V
7Ex0GefUzAW/zNrACSaU3/Nh/R9tW38HkqV3nSgiYDQVFzbsLX9BNbmhxZoWzbU=
=Laq4
-----END PGP SIGNATURE-----


From donald at infomed.sld.cu  Thu Oct 30 13:46:10 2014
From: donald at infomed.sld.cu (donald at infomed.sld.cu)
Date: Thu, 30 Oct 2014 09:46:10 -0400
Subject: [squid-users] ext_ldap_group_acl & Zimbra LDAP
Message-ID: <20141030094610.75998poj00617bxe@webmail.sld.cu>

Hello people, for 2 days I was looking around de web for the correct  
filter to use SQUID ext_ldap_group_acl to verify the Zimbra group of  
an authenticate user but I'm tired right now. Because of that I  
looking for the answer here.

I use Squid 3.3.8 on Ubuntu Server 14.04 and ZCS 8.5, the filter for  
users works OK, the acl for the groups is the next:

external_acl_type Grupos_ZCS %LOGIN /usr/lib/squid3/ext_ldap_group_acl  
-R -v 3 -b "dc=ejemplo,dc=local" -D "uid=zimbra,cn=admins,cn=zimbra"  
-w "secretPass" -f "(&(uid=%u)(objectClass=zimbraAccount))" -h  
192.168.1.3

The -f filter not work, I tried a lot of filters but none work, I hope  
somebody can help me. Last, sorry my english, thanks...

----------------------------------------------------------------
This message was sent using IMP, the Internet Messaging Program.



--
Nunca digas nunca, di mejor: gracias, permiso, disculpe.

Este mensaje le ha llegado mediante el servicio de correo electronico que ofrece Infomed para respaldar el cumplimiento de las misiones del Sistema Nacional de Salud. La persona que envia este correo asume el compromiso de usar el servicio a tales fines y cumplir con las regulaciones establecidas

Infomed: http://www.sld.cu/



From donald at infomed.sld.cu  Thu Oct 30 13:46:08 2014
From: donald at infomed.sld.cu (donald at infomed.sld.cu)
Date: Thu, 30 Oct 2014 09:46:08 -0400
Subject: [squid-users] ext_ldap_group_acl & Zimbra LDAP
Message-ID: <20141030094608.12042pf0fqltqlnk@webmail.sld.cu>

Hello people, for 2 days I was looking around de web for the correct  
filter to use SQUID ext_ldap_group_acl to verify the Zimbra group of  
an authenticate user but I'm tired right now. Because of that I  
looking for the answer here.

I use Squid 3.3.8 on Ubuntu Server 14.04 and ZCS 8.5, the filter for  
users works OK, the acl for the groups is the next:

external_acl_type Grupos_ZCS %LOGIN /usr/lib/squid3/ext_ldap_group_acl  
-R -v 3 -b "dc=ejemplo,dc=local" -D "uid=zimbra,cn=admins,cn=zimbra"  
-w "secretPass" -f "(&(uid=%u)(objectClass=zimbraAccount))" -h  
192.168.1.3

The -f filter not work, I tried a lot of filters but none work, I hope  
somebody can help me. Last, sorry my english, thanks...

----------------------------------------------------------------
This message was sent using IMP, the Internet Messaging Program.



--
Nunca digas nunca, di mejor: gracias, permiso, disculpe.

Este mensaje le ha llegado mediante el servicio de correo electronico que ofrece Infomed para respaldar el cumplimiento de las misiones del Sistema Nacional de Salud. La persona que envia este correo asume el compromiso de usar el servicio a tales fines y cumplir con las regulaciones establecidas

Infomed: http://www.sld.cu/



From squid3 at treenet.co.nz  Thu Oct 30 14:10:41 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 31 Oct 2014 03:10:41 +1300
Subject: [squid-users] ext_ldap_group_acl & Zimbra LDAP
In-Reply-To: <20141030094610.75998poj00617bxe@webmail.sld.cu>
References: <20141030094610.75998poj00617bxe@webmail.sld.cu>
Message-ID: <545246E1.1060702@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 31/10/2014 2:46 a.m., donald at infomed.sld.cu wrote:
> Hello people, for 2 days I was looking around de web for the
> correct filter to use SQUID ext_ldap_group_acl to verify the Zimbra
> group of an authenticate user but I'm tired right now. Because of
> that I looking for the answer here.
> 

We got your mail the first time or two. Lack of response around here
means nobody knows the answer or anything helpful.

I can only suggest that you add -d option to your helper parameters to
get debug info. Hopefully that will show why the filter is not working
for you.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUUkbhAAoJELJo5wb/XPRjxqwIAIW00n0CYAnOsR8NvU3XmXR8
T2KdNjO4MPL4Lo6kyUXMQCVInR5XdwIJXRlzC+94HSS4u/tQBQlx93V+b4CZ7idA
bIqtAFC4bsBRbXzmZWyHa57jUuSd/BGlkZTfyFYk/EOXyUzuEEolTn0VcTfNO5vs
1imVw7aFYhl8H/p/LZXn7drgJTx4OWruzNu+v/7f+5aCdb5TT913tNoBjEL5YTgC
Iwfnow8FZYImBqZo6xYhPKf+Zx+PQGzHXaPkaUUJOltrl6Trgz/XgArAjWVre4RX
UlzxgnUc8DLvSiupG8qvjgDRSL9hz94xD2xsInt6ZCEI37eEBWNlJyMsKsa7C0s=
=/DHe
-----END PGP SIGNATURE-----


From sylviotamorim at gmail.com  Thu Oct 30 14:44:32 2014
From: sylviotamorim at gmail.com (Sylvio Cesar)
Date: Thu, 30 Oct 2014 12:44:32 -0200
Subject: [squid-users] unscribed
Message-ID: <CABFwcnQ-OuRuRW2hvnqSWQw2z6LzHSBE=+9nXVNz4r-6Vcxbnw@mail.gmail.com>

-- 
Att,

Sylvio C?sar,
LPIC1, LPIC2, RHCT, RHCE, NCLA, FreeBSD Committer.

----
Se v?s estiverdes em mim, e as minhas palavras estiverem em v?s,
pedireis tudo o que quiserdes, e vos ser? feito. Jo?o 15:7


From palobo at gmail.com  Thu Oct 30 16:27:58 2014
From: palobo at gmail.com (Pedro Lobo)
Date: Thu, 30 Oct 2014 16:27:58 +0000
Subject: [squid-users] Kerberos Authentication Failing for Windows 7+
 with BH gss_accept_sec_context() failed
In-Reply-To: <CALYzA8Fy-Ufp5K+9JfBaYA4bGeCDZUEWWnRTeWj2rctRdK4ZVA@mail.gmail.com>
References: <40E1E0E7-50C6-4117-94AA-50B06573430A@gmail.com>
 <m2eqo7$cf9$1@ger.gmane.org> <FD6832B9-3F1F-48C6-A76F-47A224F1697B@gmail.com>
 <m2g7l9$1ee$1@ger.gmane.org> <94F74226-F24B-4910-95B7-B86ACE815995@gmail.com>
 <m2m7g0$9l7$1@ger.gmane.org>
 <b4adceec-5a53-4212-b16c-106237fc4504@Pedros-iPhone>
 <1F13F4C925B73F48A73307A32424FB8702075E51A0@chemsur-ex-01.emlchem.local>
 <2DB6E356-8CAA-4393-B7B9-E4DABE1AC8EF@gmail.com>
 <CALYzA8Fy-Ufp5K+9JfBaYA4bGeCDZUEWWnRTeWj2rctRdK4ZVA@mail.gmail.com>
Message-ID: <644FFD9B-2864-498C-9D2A-0D31DEFF41CA@gmail.com>

Thanks Jon,

If it had never worked on Windows 7, then I could possibly see that as being an issue, but the fact that it's worked and then a couple if days later stopped, leads me to believe that is not the issue here.

Thanks anyway for your input.

Cheers,
Pedro

On 28 Oct 2014, at 1:17, John Mok wrote:

> Pedro,
>
> By default, Windows 7 (and later) does not support weak encryption
> types in Kerberos, e.g. DES. Since Windows 7 clients are working with
> domain controller on Windows 2000 functional level, it is very likely
> the Kerberos encryption type on the TGT ticket is DES. You can verify
> that on Windows XP/2003.
>
> If so, you need to re-enable the support of weak encryption types in
> Kerberos on Windows 7 by GPO or editing registry.
>
> http://blogs.msdn.com/b/openspecification/archive/2011/05/31/windows-configurations-for-kerberos-supported-encryption-type.aspx
>
> http://technet.microsoft.com/en-us/library/dd560670%28v=ws.10%29.aspx
>
> Regards,  John Mok
>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 536 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141030/d00445c2/attachment.sig>

From inetjunkmail at gmail.com  Thu Oct 30 19:30:10 2014
From: inetjunkmail at gmail.com (inetjunkmail)
Date: Thu, 30 Oct 2014 15:30:10 -0400
Subject: [squid-users] iOS 8 and ssl_bump: Anyone working?
Message-ID: <CAAJ38WX+JAcPRs_FzS6KK-YsdE3zVWEKh5S8NOTOeAymkacHgQ@mail.gmail.com>

We have an explicit squid proxy running ssl bump that works fine for iOS 7
but Safari on iOS 8 gives an error stating that "There was a problem
communicating with the secure web proxy server (HTTPS)."  when browsing to
an SSL site that is bumped.

We can wipe an iOS 7 device, add the proxy CA to the trust store, and
successfully browse to an intercepted site.  Doing the same process with
iOS 8 reveals the error.

The error has been reproduced on two other intercepting proxy solutions.

Accessing SSL sites directly or non-intercepted is fine even if the
certificate is self signed or untrusted in any way.

We've tried contacting Apple and they are pressing hard to close the case
saying that they don't support interception; contact the vendor.  The fact
that it works fine with iOS 7, and the same error is reproducible with 3
separate SSL interception proxies suggests to me it's on them.

Is anyone else running into this?  Is anyone else working?

Thanks,
Each
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141030/3e79a2f1/attachment.htm>

From squid3 at treenet.co.nz  Fri Oct 31 01:12:35 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 31 Oct 2014 14:12:35 +1300
Subject: [squid-users] iOS 8 and ssl_bump: Anyone working?
In-Reply-To: <CAAJ38WX+JAcPRs_FzS6KK-YsdE3zVWEKh5S8NOTOeAymkacHgQ@mail.gmail.com>
References: <CAAJ38WX+JAcPRs_FzS6KK-YsdE3zVWEKh5S8NOTOeAymkacHgQ@mail.gmail.com>
Message-ID: <5452E203.4010708@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 31/10/2014 8:30 a.m., inetjunkmail wrote:
> We have an explicit squid proxy running ssl bump that works fine
> for iOS 7 but Safari on iOS 8 gives an error stating that "There
> was a problem communicating with the secure web proxy server
> (HTTPS)."  when browsing to an SSL site that is bumped.
> 
> We can wipe an iOS 7 device, add the proxy CA to the trust store,
> and successfully browse to an intercepted site.  Doing the same
> process with iOS 8 reveals the error.
> 
> The error has been reproduced on two other intercepting proxy
> solutions.
> 
> Accessing SSL sites directly or non-intercepted is fine even if
> the certificate is self signed or untrusted in any way.
> 
> We've tried contacting Apple and they are pressing hard to close
> the case saying that they don't support interception; contact the
> vendor.  The fact that it works fine with iOS 7, and the same error
> is reproducible with 3 separate SSL interception proxies suggests
> to me it's on them.


Perhapse it is a result of the arms-race happening in the SSL/TLS
area. Try upgrading to the latest Squid-3.5 and see if the bumping
features there help. We know for certain that the ssl-bump features in
3.2 and 3.3 are useless with a growing number of websites using HSTS
and "cert-pinning".


But I dont think it is that clearly "on them". Interception *is* an
attack on your users, and illegal in a lot of cases as well. It is
reasonable for them not to support it.


> 
> Is anyone else running into this?  Is anyone else working?

You are the first person noticably involved with MacOS / iOS in any
way to post anything here in a long while. So unless you get a direct
the answer assume it is "none of us use iOS like this".

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUUuIDAAoJELJo5wb/XPRjSQ4H/iqQu8RtxDTnrx1o9TnCdNDm
g806kzuJ6h1k63oG7MaVlWu0FMkqw0XL1eq1dzqj9gT/qq9xQ08vDh6+TS9l8jn6
oOvUef/5i5FhZ0X7Ixa1d9JNzFLwVeZdrUwwxW3m0cPFMDHonxnJ1vYYk8F7oBlQ
6c1/4teZ4U42JDTKGtTl+rI3HimrcSSnNuMYtyZ5uVooWK3nZcUnGDPjEr0iZXtM
qrQo1H/ZgaVfa0uaBKb2e5sXvBcwtec1kP++v34WY4gIVFzvfor4slMAXhmg3XBV
zBD6sn66Uy6GoAknspvh4N4eQoujdF6GKp44xUk1RvdPb/7We0DwaiJh8iry30Y=
=2lH3
-----END PGP SIGNATURE-----


From david at oldcolo.com  Fri Oct 31 01:52:39 2014
From: david at oldcolo.com (David Hughes)
Date: Thu, 30 Oct 2014 19:52:39 -0600
Subject: [squid-users] Been a long time....
Message-ID: <5452EB67.2010503@oldcolo.com>

Used to install squid years ago for some projects.  Squid is an old friend.

Question, and beg pardon if I skew terms.

Say one has a DSL line into a home that connects to a wireless router 
that ends up with many devices connected to it.  Laptops, desktops, 
pads, phones, network capable DVD players, etc etc etc.  A lot of 
circuits get created and funnelled out through the DSL router.  The 
service provide sees this and implements throttling of the network 
service.  We can see measurable dips in the service based on the traffic 
load.

Can Squid, does squid help this situation?  As in devices connecting to 
a Squid proxy server and creating what the service provider sees as ONE 
stream, instead of many?  Reducing the throttling potential?

I know I have framed this awkwardly but hopefully this gets the idea 
across.  Can anyone offer and answer and correct my conceptions about 
how IP traffic works?

tx


From squid3 at treenet.co.nz  Fri Oct 31 02:05:49 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 31 Oct 2014 15:05:49 +1300
Subject: [squid-users] Been a long time....
In-Reply-To: <5452EB67.2010503@oldcolo.com>
References: <5452EB67.2010503@oldcolo.com>
Message-ID: <5452EE7D.8010105@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 31/10/2014 2:52 p.m., David Hughes wrote:
> Used to install squid years ago for some projects.  Squid is an old
> friend.
> 
> Question, and beg pardon if I skew terms.
> 
> Say one has a DSL line into a home that connects to a wireless
> router that ends up with many devices connected to it.  Laptops,
> desktops, pads, phones, network capable DVD players, etc etc etc.
> A lot of circuits get created and funnelled out through the DSL
> router.  The service provide sees this and implements throttling of
> the network service.  We can see measurable dips in the service
> based on the traffic load.
> 
> Can Squid, does squid help this situation?  As in devices
> connecting to a Squid proxy server and creating what the service
> provider sees as ONE stream, instead of many?  Reducing the
> throttling potential?

For HTTP yes. For other protocols no.

Ensure that persistent connections to clients and servers is enabled
and Squid will multiples HTTP traffic as much as possible on outgoing
connections.

> 
> I know I have framed this awkwardly but hopefully this gets the
> idea across.  Can anyone offer and answer and correct my
> conceptions about how IP traffic works?

You are assuming two things that are possibly incorrect.

Firstly, that there is intentional throttling happening at all.
 - If you have a large amount of traffic on a DSL line it is more
likely to be simple network congestion.

Secondly, that it is happening based on number of connections.
 - Active throttling is more likely to be based on total bytes
transferred. It is simpler to implement for ISP and has the same
management effects.

Squid can also help somewhat with either of those situations by
caching HTTP responses and reducing the upstream HTTP bandwidth used.

The more current your Squid version the better it will be able to do
on both persistent connection re-use, caching and HTTP/1.1 bandwidth
optimizations.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUUu59AAoJELJo5wb/XPRjn+IIAIz+sulSc4462C4p9CuN4ack
h5IM4vlaZJSshommRUqWvSZrJMVTvaw6LAUKnng/SA9ZGUYYeZpOEVL50XBHSq4E
y+8wDkBRlxmbtLvnwM2nhw2XeZMM0FB1tg2b7dQORlFZPsCzDVrYxCLy0QwpDbCa
9Drn6yj61KHUq3ihQuyYsh3aVIrszhDMI3SubxfMUSJ9MGmW7sojTAaoZBzrrian
Cz7SrUBhGBoX2eg1F8O3t6ni+flUA9tFNgohAtl88K1urD7QjbApZh8fK0xZCsZa
bXxOwZetVoJzTKMXASe8IWT9WWyi4tv7q0pXU6Xe2fwPaeXqcExJcUA1D5nE9Uo=
=yp84
-----END PGP SIGNATURE-----


From lionxyes at gmail.com  Fri Oct 31 06:55:40 2014
From: lionxyes at gmail.com (lionxyes at gmail.com)
Date: Fri, 31 Oct 2014 14:55:40 +0800
Subject: [squid-users] Question about the reponse body content geted by
	ecap-adapter
Message-ID: <201410311455346317317@gmail.com>

Hi.

As we know, the reponse body content may be encoded by web server, for example gzip.

Before, I think the reponse body content geted by ecap-adapter from squid has been decoded by squid.

But, Now I?m not sure about this.

So, What is the really answer ?


lionxyes at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141031/e03d3204/attachment.htm>

From lionxyes at gmail.com  Fri Oct 31 07:00:52 2014
From: lionxyes at gmail.com (DongMing Huang)
Date: Fri, 31 Oct 2014 15:00:52 +0800
Subject: [squid-users] Question about the reponse body content geted by
	ecap-adapter
Message-ID: <CAOzykZTEqbnquSVzpQ6rDhJGcp_C+N7fbSa3-fFJC4FuhJbERQ@mail.gmail.com>

Hi.

As we know, the reponse body content may be encoded by web server, for
example gzip.

Before, I think the reponse body content geted by ecap-adapter from
squid has been decoded by squid.

But, Now I?m not sure about this.

So, What is the really answer ?

HDM1991


From squid3 at treenet.co.nz  Fri Oct 31 07:43:33 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 31 Oct 2014 20:43:33 +1300
Subject: [squid-users] Question about the reponse body content geted by
 ecap-adapter
In-Reply-To: <CAOzykZTEqbnquSVzpQ6rDhJGcp_C+N7fbSa3-fFJC4FuhJbERQ@mail.gmail.com>
References: <CAOzykZTEqbnquSVzpQ6rDhJGcp_C+N7fbSa3-fFJC4FuhJbERQ@mail.gmail.com>
Message-ID: <54533DA5.5050904@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 31/10/2014 8:00 p.m., DongMing Huang wrote:
> Hi.
> 
> As we know, the reponse body content may be encoded by web server,
> for example gzip.
> 
> Before, I think the reponse body content geted by ecap-adapter
> from squid has been decoded by squid.
> 
> But, Now I?m not sure about this.
> 
> So, What is the really answer ?

There are two forms of encoding HTTP messages. Content-Encoding and
Transfer-Encoding.

Transfer-Encoding gets removed before processing by Squid, and added
to messages output as they get delivered to clients/servers.

Content-Encoding is supposed to be end-to-end and is not touched by
Squid. eCAP adapters should expect content passed to them to match the
Content-Encoding header of the message.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUUz2kAAoJELJo5wb/XPRjOmoIAIqCPJJ4p3JfLcFZ+S4O6Mfg
hLemGvuTcyhUwZ6ArIs8VeiQK3izKvZPq8LLNHJk7L2HduyDY74RZeAd6czO9Cv7
1yciiuk03b4+HF5yNbsYrdDejBm1ejRHndvYqAGij8VL3CezE+SfExdeJpeuZW6I
HJ8o830zGcrgfGaK/Bka87eg0R9+RyOxsGc5150+1hBSBTGZjgQMWLz/IWgGVUie
aVtIxK6AsxjGOAYAetOhoEUFaBV1dixFTVy8GVsQ5hiOFZ/oVN4qgaZmIf4KcUxS
eMDXj0U/dIDqhIBpOyeegQvZlQyuMw0SfTT++9+cxvcxnppQxPJyUdtD282Lkfk=
=kgvr
-----END PGP SIGNATURE-----


From lionxyes at gmail.com  Fri Oct 31 08:26:44 2014
From: lionxyes at gmail.com (DongMing Huang)
Date: Fri, 31 Oct 2014 16:26:44 +0800
Subject: [squid-users] The Solution Of How to run squid with eCAP feature on
	windows
Message-ID: <CAOzykZQ8gYu-_7EY6uKHFbM3GovEf+ObW=5kRov1+=XES6XGew@mail.gmail.com>

Some day ago, I made it. Just share.

Ready
Step 1: Install cygwin.

    https://cygwin.com/install.html

Step 2: Get squid-3.3.3-2 src by cygwin setup-x86.exe or setup-x86_64.exe.
They are GUI package manager of cygwin.

    HDM at HDM-PC /usr/src/squid-3.3.3-2.src
    $ ls
    3.3.3-cygwin.patch squid.cygport squid-3.3.3.tar.bz2
squid-3.3.3.tar.bz2.asc

    3.3.3-cygwin.patch is used to patch squid-3.3.3-2 src.
    squid.cygprot. we will introduce it later.

Step 3: Install cygport by setup-x86.exe or setup-x86_64.exe. We will use
cygport to unpack sources, apply patches and compile squid-3.3.3.-2.
squid.cygprot tell cygport how to compile squid-3.3.3-3. Please look the
content of it.

Compile eCAP
Step 1: compile ecap-0.2.0 as before.

    HDM at HDM-PC /usr/src/ecap-0.2.0
    $ ./configure && make

Now, We get libcommon.a, libadapter.a and libhost.a

Step 2: link it by runing command as following.

    HDM at HDM-PC /usr/src/libecap-0.2.0/src/libecap
    $ g++ -shared -o cygecap.dll -Wl,--out-implib=libecap.dll.a
-Wl,--export-all-symbols -Wl,--enable-auto-import -Wl,--whole-archive
common/.libs/libcommon.a adapter/.libs/libadapter.a host/.libs/libhost.a
-Wl,--no-whole-archive -lstdc++ -lm -lc

    HDM at HDM-PC /usr/src/libecap-0.2.0/src/libecap
        $ ls | grep dll || a
        cygecap.dll
        libecap.dll.a

Compile Squid-3.3.3-2
Step 1: copy libecap.dll.a to /usr/lib and copy cygecap.dll to /usr/bin

    HDM at HDM-PC /usr/lib
    $ ls | grep libecap
    libecap.dll.a
    HDM at HDM-PC /usr/bin
    $ ls | grep cygecap
    cygecap.dll

Step 2: Add --enable-ecap option by editing squid.cygport file
////////////////////////squid.cygport/////////////////////////
.
.
.
src_compile() {
        cd ${S}
        ./bootstrap.sh
        lndirs
        cd ${B}
        cygconf \
          --sysconfdir=/etc/squid \
          --datadir=/usr/share/squid \
          --libexecdir=/usr/lib/squid \
          --disable-strict-error-checking \
          --with-logdir=/var/log/squid \
          --with-swapdir=/var/cache/squid \
          --with-pidfile=/var/run/squid.pid \
          --enable-ecap \
          --enable-ssl \
          --enable-esi \
          --enable-disk-io="AIO,Blocking,DiskThreads,IpcIo,Mmapped" \

--enable-auth-basic="DB,LDAP,MSNT,MSNT-multi-domain,NCSA,POP3,RADIUS,SASL,SMB,fake,getpwnam"
\
          --enable-auth-ntlm='fake,smb_lm' \
          --enable-auth-negotiate='kerberos,wrapper' \

--enable-external-acl-helpers='LDAP_group,SQL_session,eDirectory_userip,file_userip,kerberos_ldap_group,session,time_quota,unix_group,wbinfo_group'
\
          --with-filedescriptors=3072

        # FIXME: error: 'snprintf' was not declared in this scope
        for fn in `find . -name Makefile`
        do
          sed -i -e "s#c++0x#gnu++0x#" ${fn}
        done

        make
}
.
.
.
///////////////////////////////////squid.cygport////////////////////////////

Step 3: compile squid-3.3.3-2 src. Then we can get .o files.

  HDM at HDM-PC /usr/src/squid-3.3.3-2.src
  $ ls
  3.3.3-cygwin.patch squid.cygport squid-3.3.3.tar.bz2
squid-3.3.3.tar.bz2.asc squid-3.3.3-2.i686

  HDM at HDM-PC /usr/src/squid-3.3.3-2.src
  $ cygport --32 squid.cygport prep compile install

Step 4: link it by runing command as following.

  HDM at HDM-PC
/usr/src/squid-3.3.3-2.src/squid-3.3.3-2.i686/src/squid-3.3.3/src
  $ g++ -Wall -Wpointer-arith -Wwrite-strings -Wcomments -pipe -D_REENTRANT
-g -O2 -std=gnu++0x .libs/squid.exeS.o -g -o squid.exe AclRegs.o AuthReg.o
AccessLogEntry.o AsyncEngine.o YesNoNone.o cache_cf.o CacheDigest.o
cache_manager.o carp.o cbdata.o ChunkedCodingParser.o client_db.o
client_side.o client_side_reply.o client_side_request.o BodyPipe.o
clientStream.o CompletionDispatcher.o ConfigOption.o ConfigParser.o
CpuAffinity.o CpuAffinityMap.o CpuAffinitySet.o debug.o disk.o
DiskIO/DiskIOModule.o DiskIO/ReadRequest.o DiskIO/WriteRequest.o dlink.o
dns_internal.o DnsLookupDetails.o errorpage.o ETag.o event.o EventLoop.o
external_acl.o ExternalACLEntry.o FadingCounter.o fatal.o fd.o fde.o
filemap.o forward.o fqdncache.o ftp.o gopher.o helper.o HelperChildConfig.o
htcp.o http.o HttpStatusLine.o HttpHdrCc.o HttpHdrRange.o HttpHdrSc.o
HttpHdrScTarget.o HttpHdrContRange.o HttpHeader.o HttpHeaderTools.o
HttpBody.o HttpMsg.o HttpParser.o HttpReply.o RequestFlags.o HttpRequest.o
HttpRequestMethod.o icp_v2.o icp_v3.o int.o internal.o ipc.o ipcache.o
SquidList.o main.o mem.o mem_node.o MemBuf.o MemObject.o mime.o
mime_header.o multicast.o neighbors.o Packer.o Parsing.o pconn.o
peer_digest.o peer_proxy_negotiate_auth.o peer_select.o peer_sourcehash.o
peer_userhash.o redirect.o refresh.o RemovalPolicy.o send-announce.o
MemBlob.o snmp_core.o snmp_agent.o SquidMath.o SquidNew.o stat.o
StatCounters.o StatHist.o String.o StrList.o stmem.o store.o
StoreFileSystem.o store_io.o StoreIOState.o store_client.o store_digest.o
store_dir.o store_key_md5.o store_log.o store_rebuild.o store_swapin.o
store_swapmeta.o store_swapout.o StoreMeta.o StoreMetaMD5.o StoreMetaSTD.o
StoreMetaSTDLFS.o StoreMetaUnpacker.o StoreMetaURL.o StoreMetaVary.o
StoreStats.o StoreSwapLogData.o Server.o SwapDir.o MemStore.o time.o
tools.o tunnel.o unlinkd.o url.o URLScheme.o urn.o wccp.o wccp2.o whois.o
wordlist.o LoadableModule.o LoadableModules.o DiskIO/DiskIOModules_gen.o
err_type.o err_detail_type.o globals.o hier_code.o icp_opcode.o lookup_t.o
repl_modules.o swap_log_op.o DiskIO/Blocking/BlockingDiskIOModule.o
DiskIO/DiskThreads/DiskThreadsDiskIOModule.o
DiskIO/IpcIo/IpcIoDiskIOModule.o DiskIO/Mmapped/MmappedDiskIOModule.o
-Wl,--export-all-symbols auth/.libs/libacls.a ident/.libs/libident.a
acl/.libs/libacls.a acl/.libs/libstate.a auth/.libs/libauth.a libBlocking.a
libDiskThreads.a libIpcIo.a libMmapped.a acl/.libs/libapi.a
base/.libs/libbase.a ./.libs/libsquid.a ip/.libs/libip.a fs/.libs/libfs.a
ipc/.libs/libipc.a mgr/.libs/libmgr.a anyp/.libs/libanyp.a
comm/.libs/libcomm.a eui/.libs/libeui.a icmp/.libs/libicmp.a
icmp/.libs/libicmp-core.a log/.libs/liblog.a format/.libs/libformat.a
repl/liblru.a -lpthread -lcrypt adaptation/.libs/libadaptation.a
-L/usr/local/lib esi/.libs/libesi.a ../lib/libTrie/src/libTrie.a
/usr/lib/libexpat.dll.a ssl/.libs/libsslsquid.a ssl/.libs/libsslutil.a
snmp/.libs/libsnmp.a ../snmplib/libsnmplib.a
../lib/.libs/libmisccontainers.a ../lib/.libs/libmiscencoding.a
../lib/.libs/libmiscutil.a -lssl -lcrypto -L../compat -lcompat-squid -L..
/usr/lib/libltdl.dll.a /usr/lib/libecap.dll.a

  Now,we can get the new squid.exe.

  HDM at HDM-PC
/usr/src/squid-3.3.3-2.src/squid-3.3.3-2.i686/src/squid-3.3.3/src
  $ find . -name squid.exe
  ./.libs/squid.exe
  ./squid.exe

Compile ecap_adapter_sample-0.2.1
Step 1: compile ecap-0.2.0 as usually.
  HDM at HDM-PC /usr/src/ecap_adapter_sample-0.2.1
  $ ./configure && make

Step 2: link it by runing command as following.
  HDM at HDM-PC /usr/src/ecap_adapter_sample-0.2.1/src
  $ g++ -shared -o cygmodifying.dll -Wl,--out-implib=libmodifying.dll.a
-Wl,--export-all-symbols -Wl,--enable-auto-import -Wl,--whole-archive
adapter_modifying.o -Wl,--no-whole-archive /usr/lib/libecap.dll.a

  HDM at HDM-PC /usr/src/ecap_adapter_sample-0.2.1/src
  $ g++ -shared -o cygrecord.dll -Wl,--out-implib=librecord.dll.a
-Wl,--export-all-symbols -Wl,--enable-auto-import -Wl,--whole-archive
adapter_passthru.o -Wl,--no-whole-archive /usr/lib/libecap.dll.a

  HDM at HDM-PC /usr/src/ecap_adapter_sample-0.2.1/src
  $ g++ -shared -o cygminimal.dll -Wl,--out-implib=librecord.dll.a
-Wl,--export-all-symbols -Wl,--enable-auto-import -Wl,--whole-archive
adapter_minimal.o -Wl,--no-whole-archive /usr/lib/libecap.dll.a

Ok. It' over.

Other
As you see, we compile squid-3.3.3-2 by cygport in the above steps. We also
can compile by ourself by parsing squid.cygprot. So, we can control the
install dir option etc. Here are my method.

  HDM at HDM-PC /usr/src/squid-3.3.3-2.src/squid-3.3.3-2.i686/src/squid-3.3.3
  $ ./configure --prefix=/cygdrive/c/squid --disable-strict-error-checking
--enable-ecap --enable-ssl --enable-esi
--enable-disk-io="AIO,Blocking,DiskThreads,IpcIo,Mmapped"
--enable-auth-basic="DB,LDAP,MSNT,MSNT-multi-domain,NCSA,POP3,RADIUS,SASL,SMB,fake,getpwnam"
--enable-auth-ntlm='fake,smb_lm' --enable-auth-negotiate='kerberos,wrapper'
--enable-external-acl-helpers='LDAP_group,SQL_session,eDirectory_userip,file_userip,kerberos_ldap_group,session,time_quota,unix_group,wbinfo_group'
--with-filedescriptors=3072

  HDM at HDM-PC /usr/src/squid-3.3.3-2.src/squid-3.3.3-2.i686/src/squid-3.3.3
  $ ./test.sh

  HDM at HDM-PC /usr/src/squid-3.3.3-2.src/squid-3.3.3-2.i686/src/squid-3.3.3
  $ make && make install

  -------------------------test.sh----------------------------------------
  #!/bin/bash

  for fn in `find . -name Makefile`
  do
    sed -i -e "s#c++0x#gnu++0x#" ${fn}
  done
  -------------------------test.sh end
----------------------------------------

Morely, I write link command by myself because I don't know well about g++,
automake, autoconf. So, maybe someone else can improve it. Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141031/c2be0bb0/attachment.htm>

From lionxyes at gmail.com  Fri Oct 31 08:31:12 2014
From: lionxyes at gmail.com (DongMing Huang)
Date: Fri, 31 Oct 2014 16:31:12 +0800
Subject: [squid-users] The Solution Of How to run squid with eCAP feature on
	windows
Message-ID: <CAOzykZQ4n4sC8Bvahk-=+xQyaEumtZ0cA4M0K+wcZC7wX4-V8g@mail.gmail.com>

Some day ago, I made it. Just share.

Ready
Step 1: Install cygwin.

    https://cygwin.com/install.html

Step 2: Get squid-3.3.3-2 src by cygwin setup-x86.exe or setup-x86_64.exe.
They are GUI package manager of cygwin.

    HDM at HDM-PC /usr/src/squid-3.3.3-2.src
    $ ls
    3.3.3-cygwin.patch squid.cygport squid-3.3.3.tar.bz2
squid-3.3.3.tar.bz2.asc

    3.3.3-cygwin.patch is used to patch squid-3.3.3-2 src.
    squid.cygprot. we will introduce it later.

Step 3: Install cygport by setup-x86.exe or setup-x86_64.exe. We will use
cygport to unpack sources, apply patches and compile squid-3.3.3.-2.
squid.cygprot tell cygport how to compile squid-3.3.3-3. Please look the
content of it.

Compile eCAP
Step 1: compile ecap-0.2.0 as before.

    HDM at HDM-PC /usr/src/ecap-0.2.0
    $ ./configure && make

Now, We get libcommon.a, libadapter.a and libhost.a

Step 2: link it by runing command as following.

    HDM at HDM-PC /usr/src/libecap-0.2.0/src/libecap
    $ g++ -shared -o cygecap.dll -Wl,--out-implib=libecap.dll.a
-Wl,--export-all-symbols -Wl,--enable-auto-import -Wl,--whole-archive
common/.libs/libcommon.a adapter/.libs/libadapter.a host/.libs/libhost.a
-Wl,--no-whole-archive -lstdc++ -lm -lc

    HDM at HDM-PC /usr/src/libecap-0.2.0/src/libecap
        $ ls | grep dll || a
        cygecap.dll
        libecap.dll.a

Compile Squid-3.3.3-2
Step 1: copy libecap.dll.a to /usr/lib and copy cygecap.dll to /usr/bin

    HDM at HDM-PC /usr/lib
    $ ls | grep libecap
    libecap.dll.a
    HDM at HDM-PC /usr/bin
    $ ls | grep cygecap
    cygecap.dll

Step 2: Add --enable-ecap option by editing squid.cygport file
////////////////////////squid.cygport/////////////////////////
.
.
.
src_compile() {
        cd ${S}
        ./bootstrap.sh
        lndirs
        cd ${B}
        cygconf \
          --sysconfdir=/etc/squid \
          --datadir=/usr/share/squid \
          --libexecdir=/usr/lib/squid \
          --disable-strict-error-checking \
          --with-logdir=/var/log/squid \
          --with-swapdir=/var/cache/squid \
          --with-pidfile=/var/run/squid.pid \
          --enable-ecap \
          --enable-ssl \
          --enable-esi \
          --enable-disk-io="AIO,Blocking,DiskThreads,IpcIo,Mmapped" \

--enable-auth-basic="DB,LDAP,MSNT,MSNT-multi-domain,NCSA,POP3,RADIUS,SASL,SMB,fake,getpwnam"
\
          --enable-auth-ntlm='fake,smb_lm' \
          --enable-auth-negotiate='kerberos,wrapper' \

--enable-external-acl-helpers='LDAP_group,SQL_session,eDirectory_userip,file_userip,kerberos_ldap_group,session,time_quota,unix_group,wbinfo_group'
\
          --with-filedescriptors=3072

        # FIXME: error: 'snprintf' was not declared in this scope
        for fn in `find . -name Makefile`
        do
          sed -i -e "s#c++0x#gnu++0x#" ${fn}
        done

        make
}
.
.
.
///////////////////////////////////squid.cygport////////////////////////////

Step 3: compile squid-3.3.3-2 src. Then we can get .o files.

  HDM at HDM-PC /usr/src/squid-3.3.3-2.src
  $ ls
  3.3.3-cygwin.patch squid.cygport squid-3.3.3.tar.bz2
squid-3.3.3.tar.bz2.asc squid-3.3.3-2.i686

  HDM at HDM-PC /usr/src/squid-3.3.3-2.src
  $ cygport --32 squid.cygport prep compile install

Step 4: link it by runing command as following.

  HDM at HDM-PC
/usr/src/squid-3.3.3-2.src/squid-3.3.3-2.i686/src/squid-3.3.3/src
  $ g++ -Wall -Wpointer-arith -Wwrite-strings -Wcomments -pipe -D_REENTRANT
-g -O2 -std=gnu++0x .libs/squid.exeS.o -g -o squid.exe AclRegs.o AuthReg.o
AccessLogEntry.o AsyncEngine.o YesNoNone.o cache_cf.o CacheDigest.o
cache_manager.o carp.o cbdata.o ChunkedCodingParser.o client_db.o
client_side.o client_side_reply.o client_side_request.o BodyPipe.o
clientStream.o CompletionDispatcher.o ConfigOption.o ConfigParser.o
CpuAffinity.o CpuAffinityMap.o CpuAffinitySet.o debug.o disk.o
DiskIO/DiskIOModule.o DiskIO/ReadRequest.o DiskIO/WriteRequest.o dlink.o
dns_internal.o DnsLookupDetails.o errorpage.o ETag.o event.o EventLoop.o
external_acl.o ExternalACLEntry.o FadingCounter.o fatal.o fd.o fde.o
filemap.o forward.o fqdncache.o ftp.o gopher.o helper.o HelperChildConfig.o
htcp.o http.o HttpStatusLine.o HttpHdrCc.o HttpHdrRange.o HttpHdrSc.o
HttpHdrScTarget.o HttpHdrContRange.o HttpHeader.o HttpHeaderTools.o
HttpBody.o HttpMsg.o HttpParser.o HttpReply.o RequestFlags.o HttpRequest.o
HttpRequestMethod.o icp_v2.o icp_v3.o int.o internal.o ipc.o ipcache.o
SquidList.o main.o mem.o mem_node.o MemBuf.o MemObject.o mime.o
mime_header.o multicast.o neighbors.o Packer.o Parsing.o pconn.o
peer_digest.o peer_proxy_negotiate_auth.o peer_select.o peer_sourcehash.o
peer_userhash.o redirect.o refresh.o RemovalPolicy.o send-announce.o
MemBlob.o snmp_core.o snmp_agent.o SquidMath.o SquidNew.o stat.o
StatCounters.o StatHist.o String.o StrList.o stmem.o store.o
StoreFileSystem.o store_io.o StoreIOState.o store_client.o store_digest.o
store_dir.o store_key_md5.o store_log.o store_rebuild.o store_swapin.o
store_swapmeta.o store_swapout.o StoreMeta.o StoreMetaMD5.o StoreMetaSTD.o
StoreMetaSTDLFS.o StoreMetaUnpacker.o StoreMetaURL.o StoreMetaVary.o
StoreStats.o StoreSwapLogData.o Server.o SwapDir.o MemStore.o time.o
tools.o tunnel.o unlinkd.o url.o URLScheme.o urn.o wccp.o wccp2.o whois.o
wordlist.o LoadableModule.o LoadableModules.o DiskIO/DiskIOModules_gen.o
err_type.o err_detail_type.o globals.o hier_code.o icp_opcode.o lookup_t.o
repl_modules.o swap_log_op.o DiskIO/Blocking/BlockingDiskIOModule.o
DiskIO/DiskThreads/DiskThreadsDiskIOModule.o
DiskIO/IpcIo/IpcIoDiskIOModule.o DiskIO/Mmapped/MmappedDiskIOModule.o
-Wl,--export-all-symbols auth/.libs/libacls.a ident/.libs/libident.a
acl/.libs/libacls.a acl/.libs/libstate.a auth/.libs/libauth.a libBlocking.a
libDiskThreads.a libIpcIo.a libMmapped.a acl/.libs/libapi.a
base/.libs/libbase.a ./.libs/libsquid.a ip/.libs/libip.a fs/.libs/libfs.a
ipc/.libs/libipc.a mgr/.libs/libmgr.a anyp/.libs/libanyp.a
comm/.libs/libcomm.a eui/.libs/libeui.a icmp/.libs/libicmp.a
icmp/.libs/libicmp-core.a log/.libs/liblog.a format/.libs/libformat.a
repl/liblru.a -lpthread -lcrypt adaptation/.libs/libadaptation.a
-L/usr/local/lib esi/.libs/libesi.a ../lib/libTrie/src/libTrie.a
/usr/lib/libexpat.dll.a ssl/.libs/libsslsquid.a ssl/.libs/libsslutil.a
snmp/.libs/libsnmp.a ../snmplib/libsnmplib.a
../lib/.libs/libmisccontainers.a ../lib/.libs/libmiscencoding.a
../lib/.libs/libmiscutil.a -lssl -lcrypto -L../compat -lcompat-squid -L..
/usr/lib/libltdl.dll.a /usr/lib/libecap.dll.a

  Now,we can get the new squid.exe.

  HDM at HDM-PC
/usr/src/squid-3.3.3-2.src/squid-3.3.3-2.i686/src/squid-3.3.3/src
  $ find . -name squid.exe
  ./.libs/squid.exe
  ./squid.exe

Compile ecap_adapter_sample-0.2.1
Step 1: compile ecap-0.2.0 as usually.
  HDM at HDM-PC /usr/src/ecap_adapter_sample-0.2.1
  $ ./configure && make

Step 2: link it by runing command as following.
  HDM at HDM-PC /usr/src/ecap_adapter_sample-0.2.1/src
  $ g++ -shared -o cygmodifying.dll -Wl,--out-implib=libmodifying.dll.a
-Wl,--export-all-symbols -Wl,--enable-auto-import -Wl,--whole-archive
adapter_modifying.o -Wl,--no-whole-archive /usr/lib/libecap.dll.a

  HDM at HDM-PC /usr/src/ecap_adapter_sample-0.2.1/src
  $ g++ -shared -o cygrecord.dll -Wl,--out-implib=librecord.dll.a
-Wl,--export-all-symbols -Wl,--enable-auto-import -Wl,--whole-archive
adapter_passthru.o -Wl,--no-whole-archive /usr/lib/libecap.dll.a

  HDM at HDM-PC /usr/src/ecap_adapter_sample-0.2.1/src
  $ g++ -shared -o cygminimal.dll -Wl,--out-implib=librecord.dll.a
-Wl,--export-all-symbols -Wl,--enable-auto-import -Wl,--whole-archive
adapter_minimal.o -Wl,--no-whole-archive /usr/lib/libecap.dll.a

Ok. It' over.

Other
As you see, we compile squid-3.3.3-2 by cygport in the above steps. We also
can compile by ourself by parsing squid.cygprot. So, we can control the
install dir option etc. Here are my method.

  HDM at HDM-PC /usr/src/squid-3.3.3-2.src/squid-3.3.3-2.i686/src/squid-3.3.3
  $ ./configure --prefix=/cygdrive/c/squid --disable-strict-error-checking
--enable-ecap --enable-ssl --enable-esi
--enable-disk-io="AIO,Blocking,DiskThreads,IpcIo,Mmapped"
--enable-auth-basic="DB,LDAP,MSNT,MSNT-multi-domain,NCSA,POP3,RADIUS,SASL,SMB,fake,getpwnam"
--enable-auth-ntlm='fake,smb_lm' --enable-auth-negotiate='kerberos,wrapper'
--enable-external-acl-helpers='LDAP_group,SQL_session,eDirectory_userip,file_userip,kerberos_ldap_group,session,time_quota,unix_group,wbinfo_group'
--with-filedescriptors=3072

  HDM at HDM-PC /usr/src/squid-3.3.3-2.src/squid-3.3.3-2.i686/src/squid-3.3.3
  $ ./test.sh

  HDM at HDM-PC /usr/src/squid-3.3.3-2.src/squid-3.3.3-2.i686/src/squid-3.3.3
  $ make && make install

  -------------------------test.sh----------------------------------------
  #!/bin/bash

  for fn in `find . -name Makefile`
  do
    sed -i -e "s#c++0x#gnu++0x#" ${fn}
  done
  -------------------------test.sh end
----------------------------------------

Morely, I write link command by myself because I don't know well about g++,
automake, autoconf. So, maybe someone else can improve it. Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141031/7490907d/attachment.htm>

From inetjunkmail at gmail.com  Fri Oct 31 12:05:12 2014
From: inetjunkmail at gmail.com (inetjunkmail)
Date: Fri, 31 Oct 2014 08:05:12 -0400
Subject: [squid-users] iOS 8 and ssl_bump: Anyone working?
In-Reply-To: <5452E203.4010708@treenet.co.nz>
References: <CAAJ38WX+JAcPRs_FzS6KK-YsdE3zVWEKh5S8NOTOeAymkacHgQ@mail.gmail.com>
 <5452E203.4010708@treenet.co.nz>
Message-ID: <CAAJ38WWdyOUEUWx3pX=Wqdj2CWN62A10LixK3bH-=-bwBytxxw@mail.gmail.com>

Thanks for your input.  After further testing (which I thought I already
tested and determined was not the case...), it looks like it fails any time
a certificate is "broken" when using a proxy server even with ssl bumping
turned off.  If I use a host file to make the cert name not match, I get
the same error.  Browse to a site with a set signed cert, same error.  So
this seems to be a little more generic of an issue than I suspected.  I
appreciate your feedback.  We'll re-engage Apple with the new details and
see how it goes.

On Thu, Oct 30, 2014 at 9:12 PM, Amos Jeffries <squid3 at treenet.co.nz> wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 31/10/2014 8:30 a.m., inetjunkmail wrote:
> > We have an explicit squid proxy running ssl bump that works fine
> > for iOS 7 but Safari on iOS 8 gives an error stating that "There
> > was a problem communicating with the secure web proxy server
> > (HTTPS)."  when browsing to an SSL site that is bumped.
> >
> > We can wipe an iOS 7 device, add the proxy CA to the trust store,
> > and successfully browse to an intercepted site.  Doing the same
> > process with iOS 8 reveals the error.
> >
> > The error has been reproduced on two other intercepting proxy
> > solutions.
> >
> > Accessing SSL sites directly or non-intercepted is fine even if
> > the certificate is self signed or untrusted in any way.
> >
> > We've tried contacting Apple and they are pressing hard to close
> > the case saying that they don't support interception; contact the
> > vendor.  The fact that it works fine with iOS 7, and the same error
> > is reproducible with 3 separate SSL interception proxies suggests
> > to me it's on them.
>
>
> Perhapse it is a result of the arms-race happening in the SSL/TLS
> area. Try upgrading to the latest Squid-3.5 and see if the bumping
> features there help. We know for certain that the ssl-bump features in
> 3.2 and 3.3 are useless with a growing number of websites using HSTS
> and "cert-pinning".
>
>
> But I dont think it is that clearly "on them". Interception *is* an
> attack on your users, and illegal in a lot of cases as well. It is
> reasonable for them not to support it.
>
>
> >
> > Is anyone else running into this?  Is anyone else working?
>
> You are the first person noticably involved with MacOS / iOS in any
> way to post anything here in a long while. So unless you get a direct
> the answer assume it is "none of us use iOS like this".
>
> Amos
>
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2.0.22 (MingW32)
>
> iQEcBAEBAgAGBQJUUuIDAAoJELJo5wb/XPRjSQ4H/iqQu8RtxDTnrx1o9TnCdNDm
> g806kzuJ6h1k63oG7MaVlWu0FMkqw0XL1eq1dzqj9gT/qq9xQ08vDh6+TS9l8jn6
> oOvUef/5i5FhZ0X7Ixa1d9JNzFLwVeZdrUwwxW3m0cPFMDHonxnJ1vYYk8F7oBlQ
> 6c1/4teZ4U42JDTKGtTl+rI3HimrcSSnNuMYtyZ5uVooWK3nZcUnGDPjEr0iZXtM
> qrQo1H/ZgaVfa0uaBKb2e5sXvBcwtec1kP++v34WY4gIVFzvfor4slMAXhmg3XBV
> zBD6sn66Uy6GoAknspvh4N4eQoujdF6GKp44xUk1RvdPb/7We0DwaiJh8iry30Y=
> =2lH3
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141031/99216c00/attachment.htm>

From steve at opendium.com  Fri Oct 31 18:20:52 2014
From: steve at opendium.com (Steve Hill)
Date: Fri, 31 Oct 2014 18:20:52 +0000
Subject: [squid-users] SSL bump fails accessing .gov.uk servers
Message-ID: <5453D304.7030909@opendium.com>


This is probably not a problem with Squid, but I'm posting here in the
hope that someone may have more clue than me when it comes to SSL :)

When accessing https://www.taxdisc.service.gov.uk/ through an SSL
bumping squid, I get:

-----
The following error was encountered while trying to retrieve the URL:
https://www.taxdisc.service.gov.uk/*

    Failed to establish a secure connection to 62.25.101.198

The system returned:

    (71) Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)

    Handshake with SSL server failed: [No Error]
-----


Trying to connect with openssl directly also fails:

[steve at atlantis ~]$ openssl s_client -connect 62.25.101.198:443 -showcerts
CONNECTED(00000003)
140259944179584:error:140790E5:SSL routines:SSL23_WRITE:ssl handshake
failure:s23_lib.c:177:
---
no peer certificate available
---
No client certificate CA names sent
---
SSL handshake has read 0 bytes and written 249 bytes
---
New, (NONE), Cipher is (NONE)
Secure Renegotiation IS NOT supported
Compression: NONE
Expansion: NONE
---


If I force openssl into TLS1 mode (with the -tls1 argument) then it
works fine.  TLS 1.1 and 1.2 both fail.  However, shouldn't openssl be
negotiating the highest TLS version supported by both server and client?

It works correctly when FireFox connects directly to the web server
rather than going through the proxy.

So my question is: is the web server broken, or am I misunderstanding
something?

Many thanks.

-- 

 - Steve Hill
   Technical Director
   Opendium Limited     http://www.opendium.com

Direct contacts:
   Instant messager: xmpp:steve at opendium.com
   Email:            steve at opendium.com
   Phone:            sip:steve at opendium.com

Sales / enquiries contacts:
   Email:            sales at opendium.com
   Phone:            +44-1792-825748 / sip:sales at opendium.com

Support contacts:
   Email:            support at opendium.com
   Phone:            +44-1792-824568 / sip:support at opendium.com


From squid at bloms.de  Fri Oct 31 20:03:42 2014
From: squid at bloms.de (Dieter Bloms)
Date: Fri, 31 Oct 2014 21:03:42 +0100
Subject: [squid-users] SSL bump fails accessing .gov.uk servers
In-Reply-To: <5453D304.7030909@opendium.com>
References: <5453D304.7030909@opendium.com>
Message-ID: <20141031200342.GA27156@bloms.de>

Hi Steve,

On Fri, Oct 31, Steve Hill wrote:

> This is probably not a problem with Squid, but I'm posting here in the
> hope that someone may have more clue than me when it comes to SSL :)

...

> If I force openssl into TLS1 mode (with the -tls1 argument) then it
> works fine.  TLS 1.1 and 1.2 both fail.  However, shouldn't openssl be
> negotiating the highest TLS version supported by both server and client?

but when the server is broken, it will not work.
Have a look at:

https://www.ssllabs.com/ssltest/analyze.html?d=www.taxdisc.service.gov.uk

> It works correctly when FireFox connects directly to the web server
> rather than going through the proxy.

yes the browsers have a workaround and try with different cipher suites,
when the first connect fails.

> So my question is: is the web server broken, or am I misunderstanding
> something?

The webserver is broken.


-- 
Regards.

  Dieter

--
I do not get viruses because I do not use MS software.
If you use Outlook then please do not put my email address in your
address-book so that WHEN you get a virus it won't use my address in the
>From field.


From jlay at slave-tothe-box.net  Fri Oct 31 22:40:54 2014
From: jlay at slave-tothe-box.net (James Lay)
Date: Fri, 31 Oct 2014 16:40:54 -0600
Subject: [squid-users] Correctly implementing peak-splice
In-Reply-To: <1414670766.2891.14.camel@JamesiMac>
References: <1414670766.2891.14.camel@JamesiMac>
Message-ID: <1414795254.2813.0.camel@JamesiMac>

On Thu, 2014-10-30 at 06:06 -0600, James Lay wrote:
> Hello all,
> 
> Here is my complete config for trying out peek/splice.  This currently
> does not work..is there something obvious that I'm mission?  Current
> error is:
> 
> Oct 30 06:03:14 gateway squid: 192.168.1.110 - - [30/Oct/2014:06:03:14
> -0600] "GET https://www.google.com/ HTTP/1.1" 503 3854
> TAG_NONE:HIER_NONE
> 
> and on the page I get a 71 protocol error and a SSL3_WRITE_PENDING:bad
> write retry.
> 
> Thank you.
> 
> James
> 
> acl localnet src 192.168.1.0/24
> 
> acl SSL_ports port 443
> acl Safe_ports port 80		# http
> acl Safe_ports port 21		# ftp
> acl Safe_ports port 443		# https
> acl Safe_ports port 1025-65535	# unregistered ports
> acl Safe_ports port 280		# http-mgmt
> acl Safe_ports port 488		# gss-http
> acl Safe_ports port 591		# filemaker
> acl Safe_ports port 777		# multiling http
> 
> acl CONNECT method CONNECT
> acl allowed_sites url_regex "/opt/etc/squid/url.txt"
> acl all_others dst all
> acl SSL method CONNECT
> 
> 
> http_access deny !Safe_ports
> http_access deny CONNECT !SSL_ports
> 
> http_access allow manager localhost
> http_access deny manager
> 
> http_access allow allowed_sites
> http_access deny all_others 
> http_access allow localnet
> http_access allow localhost
> 
> http_access deny all
> icp_access deny all
> 
> sslproxy_cert_error allow all
> 
> sslproxy_options ALL
> sslproxy_flags DONT_VERIFY_PEER
> 
> ssl_bump peek all
> 
> sslcrtd_program /opt/libexec/ssl_crtd -s /opt/etc/squid/ssl_db -M 4MB
> sslcrtd_children 8 startup=1 idle=1
> 
> http_port 192.168.1.253:3128 intercept
>  
> https_port 192.168.1.253:3129 intercept ssl-bump
> generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
> cert=/opt/sslsplit/sslsplit.crt key=/opt/sslsplit/sslsplitca.key
> options=ALL sslflags=NO_SESSION_REUSE
> 
> always_direct allow all
> 
> 
> access_log syslog:daemon.info common
> 
> refresh_pattern ^ftp:		1440	20%	10080
> refresh_pattern ^gopher:	1440	0%	1440
> refresh_pattern -i (cgi-bin|\?)	0	0%	0
> refresh_pattern .		0	20%	4320
> 
> icp_port 3130
> 
> coredump_dir /opt/var
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

Bump on this....is anyone on this list having success with peek?  Thank
you.

James



From marcus.kool at urlfilterdb.com  Fri Oct 31 23:09:04 2014
From: marcus.kool at urlfilterdb.com (Marcus Kool)
Date: Fri, 31 Oct 2014 21:09:04 -0200
Subject: [squid-users] SSL bump fails accessing .gov.uk servers
In-Reply-To: <20141031200342.GA27156@bloms.de>
References: <5453D304.7030909@opendium.com> <20141031200342.GA27156@bloms.de>
Message-ID: <54541690.9060206@urlfilterdb.com>

With OpenSSL 1.0.1e-fips :

openssl s_client -connect www.taxdisc.service.gov.uk:443         fails (tries TLS1.2)
openssl s_client -connect www.taxdisc.service.gov.uk:443 -ssl3   works

The webmail server of my ISP works like this: it uses only TLS1.0, so no TLS1.1 or TLS1.2,
but when with
    openssl s_client -connect WEBMAIL:443 -tls1_2
the connection is automagically downgraded to TLS1.0.  taxdisc does not do this.
Taxdisc does not negotiate, so the client must guess the desired protocol (SSL3 or TLS1.0)
and use that.

I do not know all details about TLS and downgrading rules but the server seems broken to me.
Firefox knows how to deal with it and Squid not yet.

Marcus


On 10/31/2014 06:03 PM, Dieter Bloms wrote:
> Hi Steve,
>
> On Fri, Oct 31, Steve Hill wrote:
>
>> This is probably not a problem with Squid, but I'm posting here in the
>> hope that someone may have more clue than me when it comes to SSL :)
>
> ...
>
>> If I force openssl into TLS1 mode (with the -tls1 argument) then it
>> works fine.  TLS 1.1 and 1.2 both fail.  However, shouldn't openssl be
>> negotiating the highest TLS version supported by both server and client?
>
> but when the server is broken, it will not work.
> Have a look at:
>
> https://www.ssllabs.com/ssltest/analyze.html?d=www.taxdisc.service.gov.uk
>
>> It works correctly when FireFox connects directly to the web server
>> rather than going through the proxy.
>
> yes the browsers have a workaround and try with different cipher suites,
> when the first connect fails.
>
>> So my question is: is the web server broken, or am I misunderstanding
>> something?
>
> The webserver is broken.
>
>


From paul.freeman at emlchem.com.au  Mon Oct 27 21:12:50 2014
From: paul.freeman at emlchem.com.au (Paul Freeman)
Date: Mon, 27 Oct 2014 21:12:50 -0000
Subject: [squid-users] Kerberos Authentication Failing for Windows 7+
 with BH gss_accept_sec_context() failed
In-Reply-To: <b4adceec-5a53-4212-b16c-106237fc4504@Pedros-iPhone>
References: <40E1E0E7-50C6-4117-94AA-50B06573430A@gmail.com>
 <m2eqo7$cf9$1@ger.gmane.org>
 <FD6832B9-3F1F-48C6-A76F-47A224F1697B@gmail.com>
 <m2g7l9$1ee$1@ger.gmane.org>
 <94F74226-F24B-4910-95B7-B86ACE815995@gmail.com>
 <m2m7g0$9l7$1@ger.gmane.org>
 <b4adceec-5a53-4212-b16c-106237fc4504@Pedros-iPhone>
Message-ID: <1F13F4C925B73F48A73307A32424FB8702075E51A0@chemsur-ex-01.emlchem.local>

Pedro,

This sounds similar to a problem I had a couple of years ago when using Kerberos authentication with Squid (3.1.x) on Ubuntu (10.04 at that stage). (see RE: [squid-users] Re: Authentication using squid_kerb_auth with Internet Explorer 8 on Windows Server 2008 R2, squid-users group Nov 3 2010)



What I discovered after debugging the Kerberos authentication process with gdb was the MIT Kerberos version distributed with that version of Ubuntu did not support one of the encryption types requested by the newer versions of Windows (7, 2008).  This was a reported issue with the version of Kerberos used in Ubuntu.  I ended up patching the Ubuntu MIT Kerberos source (a trivial patch) and compiling the packages manually.  This corrected the problem.



I am unsure whether this is the root cause of your issue though but thought it might be worth mentioning.  I have not kept up with the MIT Kerberos packages included with Ubuntu 12.04 and 14.04 to know whether the patch is included in the later versions.



Regards



Paul



From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Pedro Lobo
Sent: Tuesday, 28 October 2014 7:26 AM
To: Markus Moeller
Cc: squid-users at squid-cache.org
Subject: Re: [squid-users] Kerberos Authentication Failing for Windows 7+ with BH gss_accept_sec_context() failed



Hi Markus Moeller,


Hi Markus,

Yeah, I'm currently using that option and permissions are correct too.


On 27 Oct 2014 19:47, Markus Moeller wrote:

   Hi Pedro,



     Did you try the ?s GSS_C_NO_NAME option ?



   Markus



   "Pedro Lobo" <palobo at gmail.com<mailto:palobo at gmail.com>> wrote in message news:94F74226-F24B-4910-95B7-B86ACE815995 at gmail.com...

   Hey Everybody,

   Seems as though I celebrated too soon on Saturday. Today things are back to not working for Windows 7+ machines and XP/2003 machines are working just fine.

   I've also checked the permissions on the keytab file and they haven't changed since Saturday, so it's not that... ARGH!!!!

   Craving ideas and solutions right now... Pilot users are less than satisfied ;)

   Cheers,
   Pedro

   On 25 Oct 2014, at 14:13, Markus Moeller wrote:

      Hi Pedro,

      I wonder if he upper case in the name is a problem. Can you try

      auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s GSS_C_NO_NAME

      instead of

      auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s HTTP/proxy01tst.fake.net

      Markus

      "Pedro Lobo" palobo at gmail.com<mailto:palobo at gmail.com> wrote in message news:FD6832B9-3F1F-48C6-A76F-47A224F1697B at gmail.com...
      Hi Markus,

      I used msktutil to create the keytab.

      msktutil -c -s HTTP/proxy01tst.fake.net -h proxy01tst.fake.net -k /etc/squid3/PROXY.keytab --computer-name proxy01-tst --upn HTTP/proxy01tst.fake.net --server srv01.fake.net --verbose
      Output of klist -ekt:

      2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET<mailto:proxy01-tst$@FAKE.NET> (arcfour-hmac)
      2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET<mailto:proxy01-tst$@FAKE.NET> (aes128-cts-hmac-sha1-96)
      2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET<mailto:proxy01-tst$@FAKE.NET> (aes256-cts-hmac-sha1-96)
      2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET<mailto:proxy01tst.FAKE.net at FAKE.NET> (arcfour-hmac)
      2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET<mailto:proxy01tst.FAKE.net at FAKE.NET> (aes128-cts-hmac-sha1-96)
      2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET<mailto:proxy01tst.FAKE.net at FAKE.NET> (aes256-cts-hmac-sha1-96)
      2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET<mailto:proxy01tst.FAKE.net at FAKE.NET> (arcfour-hmac)
      2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET<mailto:proxy01tst.FAKE.net at FAKE.NET> (aes128-cts-hmac-sha1-96)
      2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET<mailto:proxy01tst.FAKE.net at FAKE.NET> (aes256-cts-hmac-sha1-96)
      Yep, using MIT Kerberos

      Thanks in advance for any help.

      Cheers,
      Pedro

      On 25 Oct 2014, at 1:26, Markus Moeller wrote:

      Hi Pedro,

      How did you create your keytab ? What does klist ?ekt <squid.keytab> show ( I assume you use MIT Kerberos) ?

      Markus

      "Pedro Lobo" palobo at gmail.com<mailto:palobo at gmail.com> wrote in message news:40E1E0E7-50C6-4117-94AA-50B06573430A at gmail.com...
      Hi Squid Gurus,

      I'm at my wit's end and in dire need of some squid expertise.

      We've got a production environment with a couple of squid 2.7 servers using NTLM and basic authentication. Recently though, we decided to upgrade and I'm now setting up squid 3.3 with Kerberos and NTLM Fallback. I've followed just about every guide I could find and in my testing environment, things were working great. Now that I've hooked it up to the main domain, things are awry.

      If I use a machine that's not part of the domain, NTLM kicks in and I can surf the web fine. If I use a Windows XP or Windows Server 2003, kerberos works just fine, however, if I use a machine Windows 7, 8 or 2008 server, I keep getting a popup asking me to authenticate and even then, it's and endless loop until it fails. My cache.log is littered with:

      negotiate_kerberos_auth.cc(200): pid=1607 :2014/10/24 23:03:01| negotiate_kerberos_auth: ERROR: gss_accept_sec_context() failed: Unspecified GSS failure. Minor code may provide more information.
      2014/10/24 23:03:01| ERROR: Negotiate Authentication validating user. Error returned 'BH gss_accept_sec_context() failed: Unspecified GSS failure. Minor code may provide more information. '
      The odd thing, is that this has worked before. Help me Obi Wan... You're my only hope! :)

      Current Setup
      Squid 3.3 running on Ubuntu 14.04 server. It's connected to a 2003 server with function level 2000 (I know, we're trying to fase out the older servers).

      krb5.conf

      [libdefaults]
      default_realm = FAKE.NET
      dns_lookup_kdc = yes
      dns_lookup_realm = yes
      ticket_lifetime = 24h
      default_keytab_name = /etc/squid3/PROXY.keytab

      ; for Windows 2003
      default_tgs_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
      default_tkt_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
      permitted_enctypes = rc4-hmac des-cbc-crc des-cbc-md5

      [realms]
      FAKE.NET = {
      kdc = srv01.fake.net
      kdc = srv02.fake.net
      kdc = srv03.fake.net
      admin_server = srv01.fake.net
      default_domain = fake.net
      }

      [domain_realm]
      .fake.net = FAKE.NET
      fake.net = FAKE.NET

      [logging]
      kdc = FILE:/var/log/kdc.log
      admin_server = FILE:/var/log/kadmin.log
      default = FILE:/var/log/krb5lib.log
      squid.conf

      auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d -r -s HTTP/proxy01tst.fake.net
      auth_param negotiate children 20 startup=0 idle=1
      auth_param negotiate keep_alive off

      auth_param ntlm program /usr/bin/ntlm_auth --diagnostics --helper-protocol=squid-2.5-ntlmssp --domain=FAKE.NET
      auth_param ntlm children 10
      auth_param ntlm keep_alive off
      Cheers,
      Pedro

      Cumprimentos
      Pedro Lobo
      Solutions Architect | System Engineer

      pedro.lobo at pt.clara.net<mailto:pedro.lobo at pt.clara.net>
      Tlm.: +351 939 528 827 | Tel.: +351 214 127 314

      Claranet Portugal
      Ed. Parque Expo
      Av. D. Jo?o II, 1.07-2.1, 4? Piso
      1998-014 Lisboa
      www.claranet.pt<http://www.claranet.pt>

      Empresa certificada ISO 9001, ISO 20000 e ISO 27001


        _____


        _____


      squid-users mailing list
      squid-users at lists.squid-cache.org<mailto:squid-users at lists.squid-cache.org>
      http://lists.squid-cache.org/listinfo/squid-users


        _____


      squid-users mailing list
      squid-users at lists.squid-cache.org<mailto:squid-users at lists.squid-cache.org>
      http://lists.squid-cache.org/listinfo/squid-users

      Cumprimentos
      Pedro Lobo
      Solutions Architect | System Engineer

      pedro.lobo at pt.clara.net<mailto:pedro.lobo at pt.clara.net>
      Tlm.: +351 939 528 827 | Tel.: +351 214 127 314

      Claranet Portugal
      Ed. Parque Expo
      Av. D. Jo?o II, 1.07-2.1, 4? Piso
      1998-014 Lisboa
      www.claranet.pt<http://www.claranet.pt>

      Empresa certificada ISO 9001, ISO 20000 e ISO 27001


        _____


        _____


      squid-users mailing list
      squid-users at lists.squid-cache.org<mailto:squid-users at lists.squid-cache.org>
      http://lists.squid-cache.org/listinfo/squid-users


        _____


      squid-users mailing list
      squid-users at lists.squid-cache.org<mailto:squid-users at lists.squid-cache.org>
      http://lists.squid-cache.org/listinfo/squid-users


     _____


   _______________________________________________
   squid-users mailing list
   squid-users at lists.squid-cache.org<mailto:squid-users at lists.squid-cache.org>
   http://lists.squid-cache.org/listinfo/squid-users



   __________ Information from ESET Smart Security, version of virus signature database 10628 (20141027) __________

   The message was checked by ESET Smart Security.

   http://www.eset.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141027/11481341/attachment.htm>

From palobo at gmail.com  Thu Oct 30 15:53:36 2014
From: palobo at gmail.com (Pedro Lobo)
Date: Thu, 30 Oct 2014 15:53:36 -0000
Subject: [squid-users] Kerberos Authentication Failing for Windows 7+
 with BH gss_accept_sec_context() failed
In-Reply-To: <m2mbc1$b54$1@ger.gmane.org>
References: <40E1E0E7-50C6-4117-94AA-50B06573430A@gmail.com>
 <m2eqo7$cf9$1@ger.gmane.org> <FD6832B9-3F1F-48C6-A76F-47A224F1697B@gmail.com>
 <m2g7l9$1ee$1@ger.gmane.org> <94F74226-F24B-4910-95B7-B86ACE815995@gmail.com>
 <m2m7g0$9l7$1@ger.gmane.org>
 <b4adceec-5a53-4212-b16c-106237fc4504@Pedros-iPhone>
 <m2mbc1$b54$1@ger.gmane.org>
Message-ID: <B7CA710E-D8F2-4E90-9232-6A4B06DBE77A@gmail.com>

Hi Markus,

Sorry about the delay, but I had a couple of urgent fires to put out. 
Anyway, I'm back to vanquishing this hellish beast that is Squid with 
Kerberos.

I did a little more testing and I've concluded the following:

**Windows 8.1**
Everything seems to work just fine. In debug mode, I see kerberos 
information being thrown around in cache log and I can surf sites just 
fine. Oddly enough, I don't see any traffic on port 88 with Wireshark (I 
could just be doing something stupid there).

**Windows 7**
Same as before, I simply can't surf any site that requires 
authentication. If I surf to a site that I explicitly set not to require 
auth, then all is fine. If however I try a site that requires it, it 
simply fails and goes in to a loop of requeste credentials, I enter 
them, it asks again and again until it fails. I've attached the 
wireshark capture for you to look into.

I also noticed something off in cache.log. When things fail, it seems as 
though no information is being sent over about the user. I see this is 
the log:

	negotiate_kerberos_auth.cc(315): pid=1456 :2014/10/30 12:21:47| 
negotiate_kerberos_auth: DEBUG: Got 'YR 
YIIHLw---<cut>---fmcqUg2C0CjXimVz8Lx5lNux7qfmaxGvLX4Mm4OgllOsTRB7Ng==' 
from squid (length: 2463).

	negotiate_kerberos_auth.cc(378): pid=1456 :2014/10/30 12:21:47| 
negotiate_kerberos_auth: DEBUG: Decode 
'YIIHLw---<cut>---fmcqUg2C0CjXimVz8Lx5lNux7qfmaxGvLX4Mm4OgllOsTRB7Ng==' 
(decoded length: 1843).
	negotiate_kerberos_auth.cc(200): pid=1456 :2014/10/30 12:21:47| 
negotiate_kerberos_auth: ERROR: gss_accept_sec_context() failed: 
Unspecified GSS failure.  Minor code may provide more information.
	2014/10/30 12:21:47| ERROR: Negotiate Authentication validating user. 
Error returned 'BH gss_accept_sec_context() failed: Unspecified GSS 
failure.  Minor code may provide more information. '

Notice that there is no username after decoding `=='` from squid...

In successful casses, I see something akin to:

	negotiate_kerberos_auth.cc(315): pid=1463 :2014/10/30 12:54:44| 
negotiate_kerberos_auth: DEBUG: Got 'YR 
YIIGnw---<cut>---vSSEll5Cl5H2pngowpplrKoJwLbahwnoSkFOzWqFoNq9qv1IXcyi4Ym7PbMadwDq4FpUdfDA84D6eGxospx8aPmJKZ0AuQMrtw==' 
from squid (length: 2271).
	negotiate_kerberos_auth.cc(378): pid=1463 :2014/10/30 12:54:44| 
negotiate_kerberos_auth: DEBUG: Decode 
'YIIGnw---<cut>---vSSEll5Cl5H2pngowpplrKoJwLbahwnoSkFOzWqFoNq9qv1IXcyi4Ym7PbMadwDq4FpUdfDA84D6eGxospx8aPmJKZ0AuQMrtw==' 
(decoded length: 1699).
	negotiate_kerberos_auth.cc(462): pid=1463 :2014/10/30 12:54:45| 
negotiate_kerberos_auth: DEBUG: AF 
oYGgMIGdoAMKAQChCwYJKoZIhvcSAQICooGIBIGFYIGCBgkqhkiG9xIBAgICAG9zMHGgAwIBBaEDAgEPomUwY6ADAgEXolwEWnc+iBxbOhzQ36fAORmtdcn09xrBAmdvisZ2BxTPeuj8IxMULD9BJylCXHE8DVqqgyhS1Gzy1Y+BfyPvKyugBo1NnY3r7o3wYCnmbGli2NgcdrhQekHg1fbk8w== 
echironteste

Notice the extra line with username (echironteste). I'm not sure if this 
is relevant, but it does look like it.


**Windows XP**
Just like Windows 8.1, surfing worked fine and I did see kerberos 
activity in cache.log, however I saw nothing being captured by Wireshark 
on port 88 or even widening the query, nothing for krb5rpc. What's 
happening here, anybody have an idea?

Cheers all and thanks for the help.



On 27 Oct 2014, at 20:53, Markus Moeller wrote:

> Hi Pedro,
>
> Can you capture the traffic from one Windows 7 on XP client on port 88 
> ( just after the login before access a website via squid until 
> successful or unsuccessful accessing the website) using wireshark ?   
> Send me the .cap files to check.
>
> Markus
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141030/b7bc01c6/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: win7.pcapng.zip
Type: application/zip
Size: 36082 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141030/b7bc01c6/attachment.zip>

From jorgevisentini at gmail.com  Mon Oct 27 17:28:02 2014
From: jorgevisentini at gmail.com (Jorge Visentini)
Date: Mon, 27 Oct 2014 17:28:02 -0000
Subject: [squid-users] Delay Class 3 - Squid (Amos Jeffries)
Message-ID: <CAG=j6fr32cb6i-fpRFXh=nUh+zEzHqwVrjtv688Baa7DJ_SaDw@mail.gmail.com>

Hello Amos Jeffries!

I tried to use three parameters, but it did not work.

I did not understand why this is giving error...




2014-10-27 14:40 GMT-02:00 <squid-users-request at lists.squid-cache.org>:

> Send squid-users mailing list submissions to
>         squid-users at lists.squid-cache.org
>
> To subscribe or unsubscribe via the World Wide Web, visit
>         http://lists.squid-cache.org/listinfo/squid-users
> or, via email, send a message with subject or body 'help' to
>         squid-users-request at lists.squid-cache.org
>
> You can reach the person managing the list at
>         squid-users-owner at lists.squid-cache.org
>
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of squid-users digest..."
>
>
> Today's Topics:
>
>    1. Re: Delay Class 3 - Squid (Amos Jeffries)
>    2. Re: Delay Class 3 - Squid (Amos Jeffries)
>    3. Re: Filtering keywords on google search (Cassiano Martin)
>    4. how to obtain info about actual active downloads?
>       (Frantisek Hanzlik)
>    5. Re: how to obtain info about actual active downloads?
>       (Antony Stone)
>    6. Re: how to obtain info about actual active downloads?
>       (Leonardo Rodrigues)
>    7. Re: Kerberos Authentication Failing for Windows 7+ with BH
>       gss_accept_sec_context() failed (Pedro Lobo)
>
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Tue, 28 Oct 2014 01:01:34 +1300
> From: Amos Jeffries <squid3 at treenet.co.nz>
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] Delay Class 3 - Squid
> Message-ID: <544E341E.7080801 at treenet.co.nz>
> Content-Type: text/plain; charset=utf-8
>
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 28/10/2014 12:57 a.m., Jorge Visentini wrote:
> > Hello!
> >
> > Sorry my english.
> >
> > I'm racking my brain to figure out why the error.
> >
> > I've used a long time ago a rule delay pool but this time I am not
> > able to implement ...
> >
> > In my squid.conf looks like this:
> >
> > delay_pools 1 delay_class 1 3 delay_parameters 1 50000/50000
> > 24000/24000
>
> http://www.squid-cache.org/Doc/config/delay_parameters/
>
> class 1 pools only have one speed parameter. Not two.
>
>
> Amos
>
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2.0.22 (MingW32)
>
> iQEcBAEBAgAGBQJUTjQeAAoJELJo5wb/XPRjm0IH/3Fwh9VhfFOhpMfn1Z20ii2b
> 49SC9fhyMmVfoNdm49uOY9txb/7VDQpfRtb4yvNcAJJ+t0soNRlz8wcYrvJHeu52
> HMG1te3wySXVZgar/DzQbsI/k15Ar2uuUVmJJ/rkQextBjftqXF7HLXo6kBNRLG7
> xcwSSrtGy9SIY8yOZflz+4ANJr5Z1Fme1w2Cp88UXXBLuKXZ3JNeQrte06aRpJkn
> KwWQwSLwv3KGF48PbuLRD2M8flA/eFkoqg0VK0CRzjytGwxb/b0OIE9shl/GH2A0
> oEcWVowZHqAXSsSbbpW9GIyNpKoxjndY80VBijaTvvXj+tBQK2DaIse7e7NaEGc=
> =tJHs
> -----END PGP SIGNATURE-----
>
>
> ------------------------------
>
> Message: 2
> Date: Tue, 28 Oct 2014 01:06:13 +1300
> From: Amos Jeffries <squid3 at treenet.co.nz>
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] Delay Class 3 - Squid
> Message-ID: <544E3535.7050805 at treenet.co.nz>
> Content-Type: text/plain; charset=utf-8
>
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 28/10/2014 1:01 a.m., Amos Jeffries wrote:
> > On 28/10/2014 12:57 a.m., Jorge Visentini wrote:
> >> Hello!
> >
> >> Sorry my english.
> >
> >> I'm racking my brain to figure out why the error.
> >
> >> I've used a long time ago a rule delay pool but this time I am
> >> not able to implement ...
> >
> >> In my squid.conf looks like this:
> >
> >> delay_pools 1 delay_class 1 3 delay_parameters 1 50000/50000
> >> 24000/24000
> >
> > http://www.squid-cache.org/Doc/config/delay_parameters/
> >
> > class 1 pools only have one speed parameter. Not two.
> >
>
> Meh, sorry. I mean class 3 has 3 parameters.
>
> Amos
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2.0.22 (MingW32)
>
> iQEcBAEBAgAGBQJUTjU1AAoJELJo5wb/XPRjHYAIAI2oAOpjZTgsTlbdz20LZW+k
> XAAAnm8QgJSDBI7ErmZAJ7AxJILfi2PR2M60411mN5AgrVYulofUriTebS13bguR
> g0aoFmVMBj003T70sNZWwSgyf18Gr9ewu5X6sOSu1IdQg6M9VMJFaUUMs+FFy2bs
> IOqfhEhkcszlz0wrmY+xhAxR7mm8qWenrRk47W6rQR90p5Ml5m6ha0cCyTMTo46H
> euojiX3JHvbFa3NtoOiNTmNOK7ZVt6bE/KTDSGobx6ehNtsUgKQgMBfyQ9ET2269
> x8/MBDBjpK3JSld0UF3CjTkF8eWZHLAC+/Y6ZRR1vY6ihXi5B4yK7+Ve0ZvK5eU=
> =7r5y
> -----END PGP SIGNATURE-----
>
>
> ------------------------------
>
> Message: 3
> Date: Mon, 27 Oct 2014 11:05:33 -0200
> From: Cassiano Martin <cassiano at polaco.pro.br>
> To: Job <Job at colliniconsulting.it>
> Cc: "squid-users at squid-cache.org" <squid-users at squid-cache.org>
> Subject: Re: [squid-users] Filtering keywords on google search
> Message-ID:
>         <
> CAOoxthNmWSP7Xck4BpNxOO-wNNsGe3e4jkXgfvsLffeSbk9f2A at mail.gmail.com>
> Content-Type: text/plain; charset=UTF-8
>
> I have some proof of concept on my github. it can be done thought  DNS
> hijacking. I modified a version of tinyproxy to enforce safe search.
> you can check it out on https://github.com/polaco1782/tinyproxy
>
> 2014-10-25 9:49 GMT-02:00 Job <Job at colliniconsulting.it>:
> > Hello, since Google switch definitely on SSL connection it seems there
> is no way to filter semantic (with danguardian, squidguard or squid).
> >
> > SSL Bump can help in this case, both on explicit or transparent proxying?
> >
> > Is there another way to filter searches (and image searches!)?
> >
> > Thank you!
> > Francesco
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
>
>
> ------------------------------
>
> Message: 4
> Date: Mon, 27 Oct 2014 14:32:39 +0100
> From: Frantisek Hanzlik <franta at hanzlici.cz>
> To: Squid users list <squid-users at squid-cache.org>
> Subject: [squid-users] how to obtain info about actual active
>         downloads?
> Message-ID: <544E4977.3050705 at hanzlici.cz>
> Content-Type: text/plain; charset=UTF-8
>
> Please, what is best way for determining who squid clients (their
> PC IP addresses) have which downloads active?
> I want it to determine which clients burden our slow internet line.
> Examining 'access.log' does not help much in this case, because users
> can download large files and it may take a few minutes or hours (e.g.
> in case of consuming some audio/video streams).
>
> I tried inspecting informations in 'Client-side Active Requests' menu
> in cachemgr.cgi, where are paragraphs as:
>
> Connection: 0x7f442037aa48
>         FD 94, read 5892, wrote 148211583
>         FD desc: Reading next request
>         in: buf 0x7f440efc9150, offset 0, size 4096
>         remote: 192.168.1.44:1631
>         local: 192.168.1.254:3128
>         nrequests: 7
> uri http://ice.abradio.cz/prachen64.mp3
> logType TCP_MISS
> out.offset 148178800, out.size 148179207
> req_sz 724
> entry 0x7f440d5d6220/A1AD3A830E803B23F9295A9BCB9C1949
> start 1414389495.929684 (18515.473233 seconds ago)
> username
> delay_pool 0
>
> which seems to contain the necessary items and it would not be a big
> problem adjust them to shorter form using e.g. awk or sed script,
> and this informations is possible obtain in batch with some as:
>
> wget -q -O - '
> http://localhost/Squid/cgi-bin/cachemgr.cgi?host=localhost&port=3128&user_name=&operation=active_requests
> '
> or
> lynx -dump '
> http://localhost/Squid/cgi-bin/cachemgr.cgi?host=localhost&port=3128&user_name=&operation=active_requests
> '
>
> But is this the correct way? Or Squid offers other tools for this
> case? Or is possible cachemgr.cgi supply/enwrap with some filter
> which output needed info in some customized format?
> We are using squid-3.3.13/Linux i686 now, it run on our LAN internet
> router, LAN has approx. twenty PCs.
>
> Thanks in advance, Franta Hanzlik
>
>
>
> ------------------------------
>
> Message: 5
> Date: Mon, 27 Oct 2014 14:47:00 +0100
> From: Antony Stone <Antony.Stone at squid.open.source.it>
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] how to obtain info about actual active
>         downloads?
> Message-ID: <201410271447.00509.Antony.Stone at squid.open.source.it>
> Content-Type: Text/Plain;  charset="utf-8"
>
> On Monday 27 October 2014 at 14:32:39 (EU time), Frantisek Hanzlik wrote:
>
> > Please, what is best way for determining who squid clients (their
> > PC IP addresses) have which downloads active?
> > I want it to determine which clients burden our slow internet line.
> > Examining 'access.log' does not help much in this case, because users
> > can download large files and it may take a few minutes or hours (e.g.
> > in case of consuming some audio/video streams).
>
> I would use the tool 'iptraf', either running on your squid server, or on a
> machine which can sniff your internal network traffic (possibly with the
> use of a
> spanning port on the switch).
>
> That can give you real-time bandwidth measurements per IP address.
>
> Regards,
>
>
> Antony.
>
> --
> Anything that improbable is effectively impossible.
>
>  - Murray Gell-Mann, Nobel Prizewinner in Physics
>
>                                                    Please reply to the
> list;
>                                                          please *don't* CC
> me.
>
>
> ------------------------------
>
> Message: 6
> Date: Mon, 27 Oct 2014 14:37:43 -0200
> From: Leonardo Rodrigues <leolistas at solutti.com.br>
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] how to obtain info about actual active
>         downloads?
> Message-ID: <544E74D7.2030104 at solutti.com.br>
> Content-Type: text/plain; charset=utf-8; format=flowed
>
> On 27/10/14 11:47, Antony Stone wrote:
> > On Monday 27 October 2014 at 14:32:39 (EU time), Frantisek Hanzlik wrote:
> >
> >> Please, what is best way for determining who squid clients (their
> >> PC IP addresses) have which downloads active?
> >> I want it to determine which clients burden our slow internet line.
> >> Examining 'access.log' does not help much in this case, because users
> >> can download large files and it may take a few minutes or hours (e.g.
> >> in case of consuming some audio/video streams).
> > I would use the tool 'iptraf', either running on your squid server, or
> on a
> > machine which can sniff your internal network traffic (possibly with the
> use of a
> > spanning port on the switch).
> >
> > That can give you real-time bandwidth measurements per IP address.
> >
>
>      I use this script:
>
> http://samm.kiev.ua/sqstat/
>
>      Set it to auto-update on 15/15 seconds, for example, and you'll
> have a great and easy way to evaluate active connections and high
> bandwidth use connections.
>
> --
>
>
>         Atenciosamente / Sincerily,
>         Leonardo Rodrigues
>         Solutti Tecnologia
>         http://www.solutti.com.br
>
>         Minha armadilha de SPAM, N?O mandem email
>         gertrudes at solutti.com.br
>         My SPAMTRAP, do not email it
>
>
>
>
>
> ------------------------------
>
> Message: 7
> Date: Mon, 27 Oct 2014 16:39:17 +0000
> From: "Pedro Lobo" <palobo at gmail.com>
> To: "Markus Moeller" <huaraz at moeller.plus.com>
> Cc: squid-users at squid-cache.org
> Subject: Re: [squid-users] Kerberos Authentication Failing for Windows
>         7+ with BH gss_accept_sec_context() failed
> Message-ID: <94F74226-F24B-4910-95B7-B86ACE815995 at gmail.com>
> Content-Type: text/plain; charset="utf-8"
>
> Hey Everybody,
>
> Seems as though I celebrated too soon on Saturday. Today things are back
> to not working for Windows 7+ machines and XP/2003 machines are working
> just fine.
>
> I've also checked the permissions on the keytab file and they haven't
> changed since Saturday, so it's not that... ARGH!!!!
>
> Craving ideas and solutions right now... Pilot users are less than
> satisfied ;)
>
> Cheers,
> Pedro
>
> On 25 Oct 2014, at 14:13, Markus Moeller wrote:
>
> > Hi Pedro,
> >
> > I wonder if he upper case in the name is a problem. Can you try
> >
> > auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d
> -r -s GSS_C_NO_NAME
> >
> > instead of
> >
> > auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d
> -r -s HTTP/proxy01tst.fake.net
> >
> > Markus
> >
> > "Pedro Lobo" <palobo at gmail.com> wrote in message
> news:FD6832B9-3F1F-48C6-A76F-47A224F1697B at gmail.com...
> > Hi Markus,
> >
> > I used msktutil to create the keytab.
> >
> > msktutil -c -s HTTP/proxy01tst.fake.net -h proxy01tst.fake.net -k
> /etc/squid3/PROXY.keytab --computer-name proxy01-tst --upn HTTP/
> proxy01tst.fake.net --server srv01.fake.net --verbose
> > Output of klist -ekt:
> >
> > 2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (arcfour-hmac)
> > 2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (aes128-cts-hmac-sha1-96)
> > 2 10/24/2014 22:59:50 proxy01-tst$@FAKE.NET (aes256-cts-hmac-sha1-96)
> > 2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET (arcfour-hmac)
> > 2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET
> (aes128-cts-hmac-sha1-96)
> > 2 10/24/2014 22:59:50 HTTP/proxy01tst.FAKE.net at FAKE.NET
> (aes256-cts-hmac-sha1-96)
> > 2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET (arcfour-hmac)
> > 2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET
> (aes128-cts-hmac-sha1-96)
> > 2 10/24/2014 22:59:50 host/proxy01tst.FAKE.net at FAKE.NET
> (aes256-cts-hmac-sha1-96)
> > Yep, using MIT Kerberos
> >
> > Thanks in advance for any help.
> >
> > Cheers,
> > Pedro
> >
> > On 25 Oct 2014, at 1:26, Markus Moeller wrote:
> >
> > Hi Pedro,
> >
> > How did you create your keytab ? What does klist ?ekt <squid.keytab>
> show ( I assume you use MIT Kerberos) ?
> >
> > Markus
> >
> > "Pedro Lobo" palobo at gmail.com wrote in message
> news:40E1E0E7-50C6-4117-94AA-50B06573430A at gmail.com...
> > Hi Squid Gurus,
> >
> > I'm at my wit's end and in dire need of some squid expertise.
> >
> > We've got a production environment with a couple of squid 2.7 servers
> using NTLM and basic authentication. Recently though, we decided to upgrade
> and I'm now setting up squid 3.3 with Kerberos and NTLM Fallback. I've
> followed just about every guide I could find and in my testing environment,
> things were working great. Now that I've hooked it up to the main domain,
> things are awry.
> >
> > If I use a machine that's not part of the domain, NTLM kicks in and I
> can surf the web fine. If I use a Windows XP or Windows Server 2003,
> kerberos works just fine, however, if I use a machine Windows 7, 8 or 2008
> server, I keep getting a popup asking me to authenticate and even then,
> it's and endless loop until it fails. My cache.log is littered with:
> >
> > negotiate_kerberos_auth.cc(200): pid=1607 :2014/10/24 23:03:01|
> negotiate_kerberos_auth: ERROR: gss_accept_sec_context() failed:
> Unspecified GSS failure. Minor code may provide more information.
> > 2014/10/24 23:03:01| ERROR: Negotiate Authentication validating user.
> Error returned 'BH gss_accept_sec_context() failed: Unspecified GSS
> failure. Minor code may provide more information. '
> > The odd thing, is that this has worked before. Help me Obi Wan... You're
> my only hope! :)
> >
> > Current Setup
> > Squid 3.3 running on Ubuntu 14.04 server. It's connected to a 2003
> server with function level 2000 (I know, we're trying to fase out the older
> servers).
> >
> > krb5.conf
> >
> > [libdefaults]
> > default_realm = FAKE.NET
> > dns_lookup_kdc = yes
> > dns_lookup_realm = yes
> > ticket_lifetime = 24h
> > default_keytab_name = /etc/squid3/PROXY.keytab
> >
> > ; for Windows 2003
> > default_tgs_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
> > default_tkt_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
> > permitted_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
> >
> > [realms]
> > FAKE.NET = {
> > kdc = srv01.fake.net
> > kdc = srv02.fake.net
> > kdc = srv03.fake.net
> > admin_server = srv01.fake.net
> > default_domain = fake.net
> > }
> >
> > [domain_realm]
> > .fake.net = FAKE.NET
> > fake.net = FAKE.NET
> >
> > [logging]
> > kdc = FILE:/var/log/kdc.log
> > admin_server = FILE:/var/log/kadmin.log
> > default = FILE:/var/log/krb5lib.log
> > squid.conf
> >
> > auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -d
> -r -s HTTP/proxy01tst.fake.net
> > auth_param negotiate children 20 startup=0 idle=1
> > auth_param negotiate keep_alive off
> >
> > auth_param ntlm program /usr/bin/ntlm_auth --diagnostics
> --helper-protocol=squid-2.5-ntlmssp --domain=FAKE.NET
> > auth_param ntlm children 10
> > auth_param ntlm keep_alive off
> > Cheers,
> > Pedro
> >
> > Cumprimentos
> > Pedro Lobo
> > Solutions Architect | System Engineer
> >
> > pedro.lobo at pt.clara.net
> > Tlm.: +351 939 528 827 | Tel.: +351 214 127 314
> >
> > Claranet Portugal
> > Ed. Parque Expo
> > Av. D. Jo?o II, 1.07-2.1, 4? Piso
> > 1998-014 Lisboa
> > www.claranet.pt
> >
> > Empresa certificada ISO 9001, ISO 20000 e ISO 27001
> >
> >
> >
> ------------------------------------------------------------------------------
> >
> >
> ------------------------------------------------------------------------------
> >
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
> >
> >
> >
> ------------------------------------------------------------------------------
> >
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
> >
> > Cumprimentos
> > Pedro Lobo
> > Solutions Architect | System Engineer
> >
> > pedro.lobo at pt.clara.net
> > Tlm.: +351 939 528 827 | Tel.: +351 214 127 314
> >
> > Claranet Portugal
> > Ed. Parque Expo
> > Av. D. Jo?o II, 1.07-2.1, 4? Piso
> > 1998-014 Lisboa
> > www.claranet.pt
> >
> >
> >
> >
> >
> > Empresa certificada ISO 9001, ISO 20000 e ISO 27001
> >
> >
> >
> >
> >
> --------------------------------------------------------------------------------
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
> -------------- next part --------------
> An HTML attachment was scrubbed...
> URL: <
> http://lists.squid-cache.org/pipermail/squid-users/attachments/20141027/219e87ff/attachment.html
> >
> -------------- next part --------------
> A non-text attachment was scrubbed...
> Name: signature.asc
> Type: application/pgp-signature
> Size: 536 bytes
> Desc: OpenPGP digital signature
> URL: <
> http://lists.squid-cache.org/pipermail/squid-users/attachments/20141027/219e87ff/attachment.sig
> >
>
> ------------------------------
>
> Subject: Digest Footer
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
> ------------------------------
>
> End of squid-users Digest, Vol 2, Issue 97
> ******************************************
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20141027/cdb0b866/attachment.htm>

