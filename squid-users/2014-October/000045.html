<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20leaking%20memory%20in%20squid%203.4.8%20and%203.4.7.&In-Reply-To=%3C542BB76C.1010809%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000044.html">
   <LINK REL="Next"  HREF="000068.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] leaking memory in squid 3.4.8 and 3.4.7.</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20leaking%20memory%20in%20squid%203.4.8%20and%203.4.7.&In-Reply-To=%3C542BB76C.1010809%40treenet.co.nz%3E"
       TITLE="[squid-users] leaking memory in squid 3.4.8 and 3.4.7.">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Oct  1 08:12:28 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000044.html">[squid-users] leaking memory in squid 3.4.8 and 3.4.7.
</A></li>
        <LI>Next message (by thread): <A HREF="000068.html">[squid-users] leaking memory in squid 3.4.8 and 3.4.7.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45">[ date ]</a>
              <a href="thread.html#45">[ thread ]</a>
              <a href="subject.html#45">[ subject ]</a>
              <a href="author.html#45">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 1/10/2014 8:45 p.m., Victor Sudakov wrote:
&gt;<i> Amos Jeffries wrote:
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> You have 200 MB of RAM locked up in IDENT lookups.
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> Probably <A HREF="http://bugs.squid-cache.org/show_bug.cgi?id=3803">http://bugs.squid-cache.org/show_bug.cgi?id=3803</A>
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> I have temporarily disabled IDENT-related acls. Squid still
</I>&gt;&gt;&gt;&gt;<i> grows in memory, but more slowly. So IDENT was certainly one
</I>&gt;&gt;&gt;&gt;<i> of the major causes of the leak.
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> Could we make another iteration of looking at the
</I>&gt;&gt;&gt;&gt;<i> cachemgr.cgi memory counters?
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Attaching two cachemgr reports: right after squid restart and 
</I>&gt;&gt;&gt;<i> several hours later (grown to 816M in SIZE).
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> These are still showing over 47K IDENT lookups.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Probably you did not disable all the uses of IDENT. You need to
</I>&gt;&gt;<i> both set &quot;ident_access deny all&quot; and remove use of ident type
</I>&gt;&gt;<i> ACLs.
</I>&gt;<i> 
</I>&gt;<i> Bingo! After setting &quot;ident_access deny all&quot; squid does not grow 
</I>&gt;<i> infinitely any more. However, it remains a major CPU hog.
</I>&gt;<i> 
</I>
Yay. Any news on the bug patch?


Note that from the same &quot;CPU hog&quot; cycles you are now getting around 2x
the HTTP traffic throughput.

&gt;<i> 
</I>&gt;<i> Start Time:	Mon, 29 Sep 2014 15:24:54 GMT Current Time:	Tue, 30 Sep
</I>&gt;<i> 2014 02:09:51 GMT Connection information for squid: Number of
</I>&gt;<i> clients accessing cache:	161 Number of HTTP requests received:
</I>&gt;<i> 152054 Average HTTP requests per minute since start:	235.8 Select
</I>&gt;<i> loop called: 4664551 times, 8.296 ms avg
</I>


&gt;<i> Start Time:	Tue, 30 Sep 2014 15:56:38 GMT Current Time:	Wed, 01 Oct
</I>&gt;<i> 2014 06:00:28 GMT Connection information for squid: Number of
</I>&gt;<i> clients accessing cache:	170 Number of HTTP requests received:
</I>&gt;<i> 375550 Average HTTP requests per minute since start:	445.1 Select
</I>&gt;<i> loop called: 32559927 times, 1.555 ms avg
</I>
You have the delay pools feature configured. It is a wasteful consumer
of CPU cycles. Also NTLM authentication is used, that doubles the HTTP
request overheads on each new TCP connection.


There are two things you can do to further improve performance:
 1) converting from NTLM to Kerberos authentication.
 2) moving the delay pools limitation into kernel QoS systems.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUK7dsAAoJELJo5wb/XPRjJqQIAICPcvQbP+pMvmZk5SnqHUvU
vrHLXcK1+WHhw+29UvYTZUQaTf8f7r3oWSfQS4mm56YrekMiFFJSeb+QMTh3nRdK
ij3dcgdk/cT1ziQJgyh7i2AyzpC8iAofC5I8MTP247qzV14s0ZdmtRpyCbPYeRL5
JqCsMW+X/7dWbVvNhSjb0J57Po2M4Fo0RWFuPIhU/gOP6jLyesbqgm1CaGXSYvyh
kVjwZuaNKjCL1bV18vPPMJXW6Kgl6p4cK+X/v8aw00Eb2EcYsu8ieaLXvAehlsuB
xViLWe1KPuJOawJ6uaGULkoGF+a6hc+3DbJ+iLHRFNdW1OHvKWJGgOs8M5jiIHw=
=Z7vQ
-----END PGP SIGNATURE-----

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000044.html">[squid-users] leaking memory in squid 3.4.8 and 3.4.7.
</A></li>
	<LI>Next message (by thread): <A HREF="000068.html">[squid-users] leaking memory in squid 3.4.8 and 3.4.7.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#45">[ date ]</a>
              <a href="thread.html#45">[ thread ]</a>
              <a href="subject.html#45">[ subject ]</a>
              <a href="author.html#45">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
