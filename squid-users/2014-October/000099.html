<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] transparent proxy https and self signed certificate error
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20transparent%20proxy%20https%20and%20self%20signed%0A%20certificate%20error&In-Reply-To=%3CD056EE6D.7C5A%25rafael.akchurin%40diladele.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000270.html">
   <LINK REL="Next"  HREF="000093.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] transparent proxy https and self signed certificate error</H1>
    <B>Rafael Akchurin</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20transparent%20proxy%20https%20and%20self%20signed%0A%20certificate%20error&In-Reply-To=%3CD056EE6D.7C5A%25rafael.akchurin%40diladele.com%3E"
       TITLE="[squid-users] transparent proxy https and self signed certificate error">rafael.akchurin at diladele.com
       </A><BR>
    <I>Sun Oct  5 10:49:28 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000270.html">[squid-users] transparent proxy https and self signed	certificate error
</A></li>
        <LI>Next message (by thread): <A HREF="000093.html">[squid-users] Best OS for latest squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#99">[ date ]</a>
              <a href="thread.html#99">[ thread ]</a>
              <a href="subject.html#99">[ subject ]</a>
              <a href="author.html#99">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Robert,

Just my two cents - if you remove or comment out the
  sslproxy_cert_error allow all
  sslproxy_flags DONT_VERIFY_PEER

from squid config - may it be that squid starts complaining - &quot;cannot get cert issues locally&quot; on the google sites?

Rafael.

From: Robert Watson &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">robert at gillecaluim.com</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">robert at gillecaluim.com</A>&gt;&gt;
Date: Sunday 5 October 2014 02:29
To: &quot;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;&gt;
Subject: [squid-users] transparent proxy https and self signed certificate error

using squid 3.4.8, compiled from source with ./configure flags --enable-icap-client --enable-ssl --enable-ssl-crtd
configured iptables for transparent proxy (redirect 80 to 3128) and everything works fine

configured iptables for transparent proxy (redirect 443 to 3127) but can't get transparent proxy for https to work
my squid.conf
...
# Squid https port
https_port 3127 intercept ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB cert=/etc/squid/ssl_cert/XXX.pem
acl broken_sites dstdomain .example.com&lt;<A HREF="http://example.com">http://example.com</A>&gt;
ssl_bump none localhost
ssl_bump none broken_sites
ssl_bump server-first all
sslproxy_cert_error allow all
sslproxy_flags DONT_VERIFY_PEER
sslcrtd_program /usr/lib/squid/ssl_crtd -s /var/lib/squid/ssl_db -M 4MB
sslcrtd_children 32 startup=5 idle=1

when visiting google (or any other https site) chrome complains
NET::ERR_CERT_AUTHORITY_INVALID
I tried using internet explorer as admin and imported the self signed certificate but that hasn't helped

can anyone please with how to debug this
thanks, Robert

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20141005/3cb55eab/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20141005/3cb55eab/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000270.html">[squid-users] transparent proxy https and self signed	certificate error
</A></li>
	<LI>Next message (by thread): <A HREF="000093.html">[squid-users] Best OS for latest squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#99">[ date ]</a>
              <a href="thread.html#99">[ thread ]</a>
              <a href="subject.html#99">[ subject ]</a>
              <a href="author.html#99">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
