<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TCP_DENIED/403 after Upgrading from 3.4.4 to 3.4.7	(ssl_bump enabled)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_DENIED/403%20after%20Upgrading%20from%203.4.4%20to%203.4.7%0A%09%28ssl_bump%20enabled%29&In-Reply-To=%3CCACLJR%2BM4J_zUyQM-i_1jQ-MknxSTz8ZsjadLAyNOpjbTdUCJbg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000156.html">
   <LINK REL="Next"  HREF="000194.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TCP_DENIED/403 after Upgrading from 3.4.4 to 3.4.7	(ssl_bump enabled)</H1>
    <B>Tom Tom</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_DENIED/403%20after%20Upgrading%20from%203.4.4%20to%203.4.7%0A%09%28ssl_bump%20enabled%29&In-Reply-To=%3CCACLJR%2BM4J_zUyQM-i_1jQ-MknxSTz8ZsjadLAyNOpjbTdUCJbg%40mail.gmail.com%3E"
       TITLE="[squid-users] TCP_DENIED/403 after Upgrading from 3.4.4 to 3.4.7	(ssl_bump enabled)">tomtux007 at gmail.com
       </A><BR>
    <I>Mon Oct  6 09:59:14 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000156.html">[squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth broken?)
</A></li>
        <LI>Next message (by thread): <A HREF="000194.html">[squid-users] TCP_DENIED/403 after Upgrading from 3.4.4 to	3.4.7 (ssl_bump enabled)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#125">[ date ]</a>
              <a href="thread.html#125">[ thread ]</a>
              <a href="subject.html#125">[ subject ]</a>
              <a href="author.html#125">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi

After upgrading squid 3.4.4 to 3.4.7 (64Bit, self-compiled, the same
configure-options, the same config-file, ssl_bump with &quot;ssl_bump
server-first all&quot; enabled), I'm no more able to access bumped
https-sites because of a TCP_DENIED/403.


#---------------------- relevant parts of squid.conf ----------------------#
auth_param negotiate program /usr/local/squid/libexec/
negotiate_kerberos_auth
auth_param negotiate children 50 startup=10 idle=5
auth_param negotiate keep_alive on
acl AUTHENTICATED proxy_auth REQUIRED

external_acl_type SQUID_KERB_LDAP ttl=7200 children-max=50
children-startup=20 children-idle=5 negative_ttl=7200 %LOGIN
/usr/local/squid/libexec/ext_kerberos_ldap_group_acl -g &quot;Internet
Users&quot;
acl INTERNET_ACCESS external SQUID_KERB_LDAP
acl DENY_USERS_LOCAL proxy_auth_regex -i &quot;/etc/squid/DENY_USERS_LOCAL&quot;
...
...
http_access deny DENY_USERS_LOCAL all
http_access deny !INTERNET_ACCESS all
http_access deny !AUTHENTICATED all
http_access allow INTERNET_ACCESS AUTHENTICATED
http_access deny all
#---------------------- relevant parts of squid.conf ----------------------#

The meaning of the &quot;DENY_USERS_LOCAL&quot;-file is to insert all users (by
AD-username), which shouldn't have internet-access. In squid 3.4.4, I
had no restrictions with this directive. After upgrading to 3.4.7 (the
same config as in 3.4.4), I always catch a TCP_DENIED/403. The
cache.log with debug actived looks like this:

#---------------------- cache.log ----------------------#
2014/09/09 14:35:24.539 kid2| Acl.cc(177) matches: checked: http_access#4 = 0
2014/09/09 14:35:24.540 kid2| Acl.cc(157) matches: checking http_access#5
2014/09/09 14:35:24.540 kid2| Acl.cc(157) matches: checking DENY_USERS_LOCAL
2014/09/09 14:35:24.540 kid2| Acl.cc(28) AuthenticateAcl: SslBumped
request: It is an  encapsulated request do not authenticate
2014/09/09 14:35:24.540 kid2| Acl.cc(177) matches: checked: DENY_USERS_LOCAL = 1
2014/09/09 14:35:24.540 kid2| Acl.cc(177) matches: checked: http_access#5 = 1
2014/09/09 14:35:24.540 kid2| Acl.cc(177) matches: checked: http_access = 1
2014/09/09 14:35:24.540 kid2| Checklist.cc(55) markFinished: 0x27cfb98
answer DENIED for match
2014/09/09 14:35:24.540 kid2| Checklist.cc(155) checkCallback:
ACLChecklist::checkCallback: 0x27cfb98 answer=DENIED
#---------------------- cache.log ----------------------#


The file &quot;DENY_USERS_LOCAL&quot; is actual empty. Why does squid in the
3.4.7er version blocks me with the &quot;http_access deny DENY_USERS_LOCAL&quot;?
What changed hereby in the current version? How can I enforce the &quot;old
behaviour&quot; (like 3.4.4)?

Many thanks.

Kind regards,
Tom

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000156.html">[squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth broken?)
</A></li>
	<LI>Next message (by thread): <A HREF="000194.html">[squid-users] TCP_DENIED/403 after Upgrading from 3.4.4 to	3.4.7 (ssl_bump enabled)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#125">[ date ]</a>
              <a href="thread.html#125">[ thread ]</a>
              <a href="subject.html#125">[ subject ]</a>
              <a href="author.html#125">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
