<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth broken?)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ntlmssp%3A%20bad%20ascii%3A%20ffffffab%20%28Lan%20Manager%20auth%0A%20broken%3F%29&In-Reply-To=%3C54335E01.2070904%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000144.html">
   <LINK REL="Next"  HREF="000142.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth broken?)</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ntlmssp%3A%20bad%20ascii%3A%20ffffffab%20%28Lan%20Manager%20auth%0A%20broken%3F%29&In-Reply-To=%3C54335E01.2070904%40treenet.co.nz%3E"
       TITLE="[squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth broken?)">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Oct  7 03:29:05 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000144.html">[squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth broken?)
</A></li>
        <LI>Next message (by thread): <A HREF="000142.html">[squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth broken?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#139">[ date ]</a>
              <a href="thread.html#139">[ thread ]</a>
              <a href="subject.html#139">[ subject ]</a>
              <a href="author.html#139">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 7/10/2014 3:52 p.m., Victor Sudakov wrote:
&gt;<i> Amos Jeffries wrote:
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> I have never used the helper provided by Samba, and I am not 
</I>&gt;&gt;&gt;<i> willing to start using it.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> I don't want to install Samba on a proxy server, maintain a 
</I>&gt;&gt;&gt;<i> smb.conf and TDB databases there, join a domain, see hundreds
</I>&gt;&gt;&gt;<i> of winbindd processes etc.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Thats the price of NTLM.
</I>&gt;<i> 
</I>&gt;<i> This price is too high for my objectives.
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i> The ntlm_auth plugin has always been sufficient for my needs.
</I>&gt;&gt;&gt;<i> I hoped it would continue to be usable, but something is broken
</I>&gt;&gt;&gt;<i> in it.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> The Squid &quot;ntlm_auth&quot; helper (now ntlm_smb_lm_auth) does not,
</I>&gt;&gt;<i> and never has, performed NTLM in any way.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> What it does is this <A HREF="http://en.wikipedia.org/wiki/LM_hash.">http://en.wikipedia.org/wiki/LM_hash.</A>
</I>&gt;<i> 
</I>&gt;<i> I am perfectly aware of that. The problem is that this LM 
</I>&gt;<i> authentication did work with the squid27 ntlm_auth helper and does
</I>&gt;<i> not work with the squid34 newer ntlm_smb_lm_auth helper. There was
</I>&gt;<i> no need to break what was working.
</I>
SMB LM supports both ASCII and UNICODE. Each packet is explicitly
flagged as one or other. Apparently your client software wants to
authenticate using a character 171 out of an array of length 127.


&gt;<i> 
</I>&gt;&gt;<i> The *Basic* authentication provided in HTTP is actually a
</I>&gt;&gt;<i> superior form of authentication. If you convert your proxy to
</I>&gt;&gt;<i> requesting Basic auth you will find your
</I>&gt;<i> 
</I>&gt;<i> I am afraid you are mistaken. If I convert my proxy to Basic, it 
</I>&gt;<i> will start asking users for their login/password for proxy access, 
</I>&gt;<i> instead of authenticating them transparently with their Windows 
</I>&gt;<i> credentials.
</I>
That is a limitation of your software. Basic itself is superior to SMB
LM. You are just given no access to use it for SSO by the tools
currently in use.


&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> I would be glad to migrate to Kerberos though, if I can only
</I>&gt;&gt;&gt;<i> make browsers use it. No success so far. If anybody can help
</I>&gt;&gt;&gt;<i> with it, I would greatly appreciate.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Since your environment was accepting the old versions of 
</I>&gt;&gt;<i> ntlm_smb_lm_auth helper I predict that most of that software
</I>&gt;&gt;<i> will attempt to use the Negotiate/NTLM form of Negotiate
</I>&gt;&gt;<i> authentication over HTTP.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> To prevent that you will have to disable NTLM use on the
</I>&gt;&gt;<i> machine(s) you are trying to convert to Kerberos.
</I>&gt;<i> 
</I>&gt;<i> Yes, I have special provisions in the domain policies to allow the
</I>&gt;<i> old NTLM.  Do you mean to say if I disable NTLM, the browsers will
</I>&gt;<i> start talking Negotiate/Kerberos?
</I>
I mean turn off NTLM for the specific machines being checked so you
can identify the ones that have broken Kerberos and concentrate on
resolving that. Otherwise they will &quot;work&quot; and continue to use NTLM
invisibly. You hit a major emergency if you think all are using
Kerberos and NTLM can be turned off completely.


&gt;<i> 
</I>&gt;<i> Thanks for the hint, I will try that out and report here.
</I>&gt;<i> 
</I>&gt;&gt;<i> Adding Basic as a fallback offering you can test the Kerberos is
</I>&gt;&gt;<i> working without cutting the service or /user off completely.
</I>&gt;<i> 
</I>&gt;<i> No, adding Basic is not an option because I will have to provide 
</I>&gt;<i> special &quot;proxy passwords&quot; to the users, or make them enter their 
</I>&gt;<i> Windows passwords by hand. This is highly undesirable. Once they 
</I>&gt;<i> logon into Windows, they must have (or not have) Web access 
</I>&gt;<i> transparently.
</I>&gt;<i> 
</I>&gt;<i> If you know how to achieve SSO with Basic auth, please share.
</I>&gt;<i> 
</I>
This is what password managers in the browser are for IME. Someone
else might know how to get Windows itself providing them to the browser.

On the AD end of things the LDAP interface I think is required for
non-NTLM/Kerberos SSO.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUM14BAAoJELJo5wb/XPRjJD4H/10GqG12nApeSchd70Oc/sMn
RGGdYJYALv5jPfA6/Zu1IW/Vdbnz7pEQwUmNEBnKxzMHm+/4ZFd6qGiL6xYiS2AE
Tzhkgsu8Jm1JTE3NbK06qb0lE8KbuRHzcmjUihjD+0DoY0Bbm9Om/4PHv9q4KaC2
aVq08AhrBaiYT0tbli+FmMTHYmrKjyKaiwPo5U//Rpotv2J4oZsPWRfxyN2yeIpH
qZMUMUzEcKR6HRlKlOyG1UhXdciwgk0QgR1wfgFHBTbmxsB62PMU9nqpKc+RUkdu
ZBBBigOrhsSrz9FWZhJOZMwta6UCdpRJjS/zx6VMb8bu93nXwb0pA2qffXFYcHU=
=uZCV
-----END PGP SIGNATURE-----

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000144.html">[squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth broken?)
</A></li>
	<LI>Next message (by thread): <A HREF="000142.html">[squid-users] ntlmssp: bad ascii: ffffffab (Lan Manager auth broken?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#139">[ date ]</a>
              <a href="thread.html#139">[ thread ]</a>
              <a href="subject.html#139">[ subject ]</a>
              <a href="author.html#139">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
