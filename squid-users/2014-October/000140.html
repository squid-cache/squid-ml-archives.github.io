<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] https issues for google
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20https%20issues%20for%20google&In-Reply-To=%3C2329B68B3D676246BA0D1149E22F509F01A02886%40bneseqs20.bradnams.com.au%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000135.html">
   <LINK REL="Next"  HREF="000154.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] https issues for google</H1>
    <B>glenn.groves at bradnams.com.au</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20https%20issues%20for%20google&In-Reply-To=%3C2329B68B3D676246BA0D1149E22F509F01A02886%40bneseqs20.bradnams.com.au%3E"
       TITLE="[squid-users] https issues for google">glenn.groves at bradnams.com.au
       </A><BR>
    <I>Tue Oct  7 03:51:49 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000135.html">[squid-users] SSL BUMP, https interception, etc
</A></li>
        <LI>Next message (by thread): <A HREF="000154.html">[squid-users] https issues for google
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#140">[ date ]</a>
              <a href="thread.html#140">[ thread ]</a>
              <a href="subject.html#140">[ subject ]</a>
              <a href="author.html#140">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi All,

We have a weird issue where https sites apparently don't respond (get message &quot;this page can't be displayed&quot;). This mainly affects google websites and to a lesser affect youtube. It has been reported it may have affected some banking sites but this is unconfirmed. We are running centos 6.5 with up to date squid from the centos repositories. 

Here is the version of squid: 
yum list installed | grep squid
squid.x86_64&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;7:3.1.10-20.el6_5.3

The https sites work fine if I put a direct hole in the firewall to allow internet traffic directly out - but this is not a solution.

Thanks, Glenn

Below is the conf file:

### /etc/squid/squid.conf Configuration File ####

### cache manager
cache_mgr <A HREF="https://lists.squid-cache.org/listinfo/squid-users">somone at email.com</A>

### negotiate kerberos and ntlm authentication
auth_param negotiate program /usr/local/bin/negotiate_wrapper -d --ntlm /usr/bin/ntlm_auth --diagnostics --helper-protocol=squid-2.5-ntlmssp --domain=DOMAIN --kerberos /usr/lib64/squid/squid_kerb_auth -i -d -s HTTP/proxycen.email.com
auth_param negotiate children 50
auth_param negotiate keep_alive off

### pure ntlm authentication
auth_param ntlm program /usr/bin/ntlm_auth --diagnostics --helper-protocol=squid-2.5-ntlmssp --domain=DOMAIN
auth_param ntlm children 200
# auth_param ntlm max_challenge_lifetime 5 minutes
auth_param ntlm keep_alive off

### provide basic authentication via ldap for clients not authenticated via kerberos/ntlm
auth_param basic program /usr/lib64/squid/squid_ldap_auth -R -b &quot;dc=DOMAIN,dc=com &quot; -D <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid at email.com</A> -W /etc/squid/ldappass.txt -f sAMAccountName=%s -h SERVER.email.com
auth_param basic children 100
auth_param basic realm Internet Proxy
auth_param basic credentialsttl 1 minute

### ldap authorisation
# external_acl_type memberof children=300 %LOGIN /usr/lib64/squid/squid_ldap_group -R -K -b &quot;dc=DOMAIN,dc=com,dc=au&quot; -D <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid at email.com</A> -W /etc/squid/ldappass.txt -f &quot;(&amp;(objectclass=person)(sAMAccountName=%v)(memberof=cn=%g, ou=Internet,ou=DOMAIN Groups,ou=DOMAIN,dc=DOMAIN,dc=com,dc=au))&quot; -h SERVER.email.com

### Squid Cache Manager
cachemgr_passwd none info

cache_dir aufs /var/spool/squid 30000 16 256
minimum_object_size 2 KB
maximum_object_size 10 MB
cache_swap_low 95
cache_swap_high 97

### acl for proxy auth and ldap authorizations
acl SSL method CONNECT
acl allowedsites&#160;&#160;&#160;&#160; &#160;&#160;&#160;dstdomain &quot;/etc/squid/allowedsites.txt&quot;
acl auth proxy_auth REQUIRED
#&#160;&#160; aclname&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; acltype&#160; typename activedirectorygroup
# acl BlockedAccess&#160;&#160;&#160;&#160;&#160;&#160; external memberof &quot;/etc/squid/blocked_access.txt&quot;
# acl RestrictedAccess&#160;&#160;&#160; external memberof &quot;/etc/squid/restricted_access.txt&quot;
# acl StandardAccess&#160;&#160;&#160;&#160;&#160; external memberof &quot;/etc/squid/standard_access.txt&quot;
# acl ExceptionAccess&#160;&#160;&#160;&#160; external memberof &quot;/etc/squid/exception_access.txt&quot;
# acl FullAccess&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; external memberof &quot;/etc/squid/full_access.txt&quot;
# acl AnonymousAccess&#160;&#160;&#160;&#160; external memberof &quot;/etc/squid/anonymous_access.txt&quot;
# acl allowedsites&#160;&#160;&#160;&#160;&#160;&#160;&#160; dstdomain &quot;/etc/squid/allowedsites.txt&quot;
# acl blockedsites&#160;&#160;&#160;&#160;&#160;&#160;&#160; dstdomain &quot;/etc/squid/blockedsites.txt&quot;
# acl exceptedsites&#160;&#160;&#160;&#160;&#160;&#160; dstdomain &quot;/etc/squid/exceptedsites.txt&quot;
acl prioritysites&#160;&#160;&#160;&#160;&#160;&#160; dstdomain &quot;/etc/squid/prioritysites.txt&quot;

### squid defaults
acl manager proto cache_object
acl localhost src 127.0.0.1/32 ::1
acl allowedsite124 src 192.168.124.0/24
acl to_localhost dst 127.0.0.0/8 0.0.0.0/32 ::1
acl SSL_ports port 443
acl Safe_ports port 80&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # http
acl Safe_ports port 21&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # ftp
acl Safe_ports port 443&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # https
acl Safe_ports port 70&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # gopher
acl Safe_ports port 210&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # wais
acl Safe_ports port 1025-65535&#160; # unregistered ports
acl Safe_ports port 280&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # http-mgmt
acl Safe_ports port 488&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # gss-http
acl Safe_ports port 591&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # filemaker
acl Safe_ports port 777&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;# multiling http
acl Safe_ports port 17500&#160;&#160;&#160;&#160;&#160;&#160; # dropbox
#http_access deny CONNECT !SSL_ports
#http_access allow SSL_ports
http_access allow allowedsites
acl CONNECT method CONNECT
acl cacheadmin src 192.168.11.221 192.168.8.175
http_access allow manager localhost
http_access allow manager cacheadmin
http_access deny manager
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost

### http_access rules
# allow unrestricted access to prioritysites
http_access allow prioritysites
# enforce authentication, order of rules is important for authorization levels
http_access allow allowedsite124
http_access deny !auth
# prevent access to basic auth prompt for BlockedAccess users
# http_access deny BlockedAccess all
# http_access allow allowedsites
# http_access deny RestrictedAccess all
# http_access allow AnonymousAccess auth
# http_access allow FullAccess auth
# http_access allow exceptedsites ExceptionAccess auth
# http_access deny blockedsites
# http_access allow StandardAccess auth
http_access allow auth
# http_access deny !auth
# DO NOT REMOVE THE FOLLOWING LINE
http_access deny all

### logging
access_log /var/log/squid/access.log squid

### Set memory manually, to allow it to use more of the system
cache_mem 1024 MB

### squid Debian defaults
http_port 8080
hierarchy_stoplist cgi-bin ?
coredump_dir /var/spool/squid
refresh_pattern ^ftp:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 1440&#160;&#160;&#160; 20%&#160;&#160;&#160;&#160; 10080
refresh_pattern ^gopher:&#160;&#160;&#160;&#160;&#160;&#160;&#160; 1440&#160;&#160;&#160; 0%&#160;&#160;&#160;&#160;&#160; 1440
refresh_pattern -i (/cgi-bin/|\?) 0&#160;&#160;&#160;&#160; 0%&#160;&#160;&#160;&#160;&#160; 0
refresh_pattern .&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160;&#160; 20%&#160;&#160;&#160;&#160; 4320
[<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at proxycen</A> squid]#


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000135.html">[squid-users] SSL BUMP, https interception, etc
</A></li>
	<LI>Next message (by thread): <A HREF="000154.html">[squid-users] https issues for google
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#140">[ date ]</a>
              <a href="thread.html#140">[ thread ]</a>
              <a href="subject.html#140">[ subject ]</a>
              <a href="author.html#140">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
