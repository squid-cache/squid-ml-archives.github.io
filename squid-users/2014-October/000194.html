<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TCP_DENIED/403 after Upgrading from 3.4.4 to	3.4.7 (ssl_bump enabled)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_DENIED/403%20after%20Upgrading%20from%203.4.4%20to%0A%093.4.7%20%28ssl_bump%20enabled%29&In-Reply-To=%3CCACLJR%2BMGYogR-vJArRHVwHe%3D-XozFJs%3D4J6U5FdtaiCOUao0PQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000125.html">
   <LINK REL="Next"  HREF="000196.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TCP_DENIED/403 after Upgrading from 3.4.4 to	3.4.7 (ssl_bump enabled)</H1>
    <B>Tom Tom</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_DENIED/403%20after%20Upgrading%20from%203.4.4%20to%0A%093.4.7%20%28ssl_bump%20enabled%29&In-Reply-To=%3CCACLJR%2BMGYogR-vJArRHVwHe%3D-XozFJs%3D4J6U5FdtaiCOUao0PQ%40mail.gmail.com%3E"
       TITLE="[squid-users] TCP_DENIED/403 after Upgrading from 3.4.4 to	3.4.7 (ssl_bump enabled)">tomtux007 at gmail.com
       </A><BR>
    <I>Wed Oct  8 13:09:59 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000125.html">[squid-users] TCP_DENIED/403 after Upgrading from 3.4.4 to 3.4.7	(ssl_bump enabled)
</A></li>
        <LI>Next message (by thread): <A HREF="000196.html">[squid-users] TCP_DENIED/403 after Upgrading from 3.4.4 to 3.4.7 (ssl_bump enabled)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#194">[ date ]</a>
              <a href="thread.html#194">[ thread ]</a>
              <a href="subject.html#194">[ subject ]</a>
              <a href="author.html#194">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I think, this behaviour was introduced with squid 3.4.4.1
(<A HREF="http://www.squid-cache.org/Versions/v3/3.4/changesets/squid-3.4-13113.patch">http://www.squid-cache.org/Versions/v3/3.4/changesets/squid-3.4-13113.patch</A>).

I don't exactly understand this behaviour.
Any hints for this?

Thanks a lot.
Kind regards,
Tom

On Mon, Oct 6, 2014 at 11:59 AM, Tom Tom &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">tomtux007 at gmail.com</A>&gt; wrote:
&gt;<i> Hi
</I>&gt;<i>
</I>&gt;<i> After upgrading squid 3.4.4 to 3.4.7 (64Bit, self-compiled, the same
</I>&gt;<i> configure-options, the same config-file, ssl_bump with &quot;ssl_bump
</I>&gt;<i> server-first all&quot; enabled), I'm no more able to access bumped
</I>&gt;<i> https-sites because of a TCP_DENIED/403.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> #---------------------- relevant parts of squid.conf ----------------------#
</I>&gt;<i> auth_param negotiate program /usr/local/squid/libexec/
</I>&gt;<i> negotiate_kerberos_auth
</I>&gt;<i> auth_param negotiate children 50 startup=10 idle=5
</I>&gt;<i> auth_param negotiate keep_alive on
</I>&gt;<i> acl AUTHENTICATED proxy_auth REQUIRED
</I>&gt;<i>
</I>&gt;<i> external_acl_type SQUID_KERB_LDAP ttl=7200 children-max=50
</I>&gt;<i> children-startup=20 children-idle=5 negative_ttl=7200 %LOGIN
</I>&gt;<i> /usr/local/squid/libexec/ext_kerberos_ldap_group_acl -g &quot;Internet
</I>&gt;<i> Users&quot;
</I>&gt;<i> acl INTERNET_ACCESS external SQUID_KERB_LDAP
</I>&gt;<i> acl DENY_USERS_LOCAL proxy_auth_regex -i &quot;/etc/squid/DENY_USERS_LOCAL&quot;
</I>&gt;<i> ...
</I>&gt;<i> ...
</I>&gt;<i> http_access deny DENY_USERS_LOCAL all
</I>&gt;<i> http_access deny !INTERNET_ACCESS all
</I>&gt;<i> http_access deny !AUTHENTICATED all
</I>&gt;<i> http_access allow INTERNET_ACCESS AUTHENTICATED
</I>&gt;<i> http_access deny all
</I>&gt;<i> #---------------------- relevant parts of squid.conf ----------------------#
</I>&gt;<i>
</I>&gt;<i> The meaning of the &quot;DENY_USERS_LOCAL&quot;-file is to insert all users (by
</I>&gt;<i> AD-username), which shouldn't have internet-access. In squid 3.4.4, I
</I>&gt;<i> had no restrictions with this directive. After upgrading to 3.4.7 (the
</I>&gt;<i> same config as in 3.4.4), I always catch a TCP_DENIED/403. The
</I>&gt;<i> cache.log with debug actived looks like this:
</I>&gt;<i>
</I>&gt;<i> #---------------------- cache.log ----------------------#
</I>&gt;<i> 2014/09/09 14:35:24.539 kid2| Acl.cc(177) matches: checked: http_access#4 = 0
</I>&gt;<i> 2014/09/09 14:35:24.540 kid2| Acl.cc(157) matches: checking http_access#5
</I>&gt;<i> 2014/09/09 14:35:24.540 kid2| Acl.cc(157) matches: checking DENY_USERS_LOCAL
</I>&gt;<i> 2014/09/09 14:35:24.540 kid2| Acl.cc(28) AuthenticateAcl: SslBumped
</I>&gt;<i> request: It is an  encapsulated request do not authenticate
</I>&gt;<i> 2014/09/09 14:35:24.540 kid2| Acl.cc(177) matches: checked: DENY_USERS_LOCAL = 1
</I>&gt;<i> 2014/09/09 14:35:24.540 kid2| Acl.cc(177) matches: checked: http_access#5 = 1
</I>&gt;<i> 2014/09/09 14:35:24.540 kid2| Acl.cc(177) matches: checked: http_access = 1
</I>&gt;<i> 2014/09/09 14:35:24.540 kid2| Checklist.cc(55) markFinished: 0x27cfb98
</I>&gt;<i> answer DENIED for match
</I>&gt;<i> 2014/09/09 14:35:24.540 kid2| Checklist.cc(155) checkCallback:
</I>&gt;<i> ACLChecklist::checkCallback: 0x27cfb98 answer=DENIED
</I>&gt;<i> #---------------------- cache.log ----------------------#
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The file &quot;DENY_USERS_LOCAL&quot; is actual empty. Why does squid in the
</I>&gt;<i> 3.4.7er version blocks me with the &quot;http_access deny DENY_USERS_LOCAL&quot;?
</I>&gt;<i> What changed hereby in the current version? How can I enforce the &quot;old
</I>&gt;<i> behaviour&quot; (like 3.4.4)?
</I>&gt;<i>
</I>&gt;<i> Many thanks.
</I>&gt;<i>
</I>&gt;<i> Kind regards,
</I>&gt;<i> Tom
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000125.html">[squid-users] TCP_DENIED/403 after Upgrading from 3.4.4 to 3.4.7	(ssl_bump enabled)
</A></li>
	<LI>Next message (by thread): <A HREF="000196.html">[squid-users] TCP_DENIED/403 after Upgrading from 3.4.4 to 3.4.7 (ssl_bump enabled)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#194">[ date ]</a>
              <a href="thread.html#194">[ thread ]</a>
              <a href="subject.html#194">[ subject ]</a>
              <a href="author.html#194">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
