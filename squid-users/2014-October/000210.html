<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 2.7 STABLE8 (Win2008) can't get my MS Lync 2013 to work?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%202.7%20STABLE8%20%28Win2008%29%20can%27t%20get%20my%20MS%20Lync%0A%202013%20to%20work%3F&In-Reply-To=%3C543611C0.9090002%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000209.html">
   <LINK REL="Next"  HREF="000182.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 2.7 STABLE8 (Win2008) can't get my MS Lync 2013 to work?</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%202.7%20STABLE8%20%28Win2008%29%20can%27t%20get%20my%20MS%20Lync%0A%202013%20to%20work%3F&In-Reply-To=%3C543611C0.9090002%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid 2.7 STABLE8 (Win2008) can't get my MS Lync 2013 to work?">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Oct  9 04:40:32 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000209.html">[squid-users] Squid 2.7 STABLE8 (Win2008) can't get my MS Lync 2013 to work?
</A></li>
        <LI>Next message (by thread): <A HREF="000182.html">[squid-users] can i disable ipv4 for tcp_outgoing ???? and allow	only ipv6 ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#210">[ date ]</a>
              <a href="thread.html#210">[ thread ]</a>
              <a href="subject.html#210">[ subject ]</a>
              <a href="author.html#210">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 9/10/2014 4:19 a.m., Mirza Dedic wrote:
&gt;<i> Thanks Amos, It seems I spoke too fast, the proxy prompt is back,
</I>&gt;<i> so disabling SG didn't do the trick.
</I>

Replying with a config file audit separately so it does not get lost
in the technical details of running on Windows. All of these are
general points relevant to 2.7 regardless of who is running it or where.


&gt;<i> # Port on which Squid will lisen on http_port 8080
</I>&gt;<i> 
</I>&gt;<i> # Authentication auth_param ntlm program
</I>&gt;<i> c:/squid/libexec/mswin_ntlm_auth.exe
</I>&gt;<i> --helper-protocol=squid-2.5-ntlmssp auth_param ntlm children 5 
</I>&gt;<i> auth_param ntlm keep_alive on auth_param basic program
</I>&gt;<i> c:/squid/libexec/mswin_ntlm_auth.exe
</I>&gt;<i> --helper-protocol=squid-2.5-basic auth_param basic children 5 
</I>&gt;<i> auth_param basic realm Visalia Proxy Server 10072014 auth_param
</I>&gt;<i> basic credentialsttl 2 hours auth_param basic casesensitive off 
</I>&gt;<i> authenticate_cache_garbage_interval 10 seconds
</I>&gt;<i> 
</I>&gt;<i> # Squid Defaults acl all src all acl manager proto cache_object acl
</I>&gt;<i> localhost src 127.0.0.1
</I>&gt;<i> 
</I>&gt;<i> # Class C Internal Subnet - Defaults acl localnet src 10.0.0.0/8 
</I>&gt;<i> acl localnet src 172.16.0.0/12 acl localnet src 192.168.0.0/16
</I>&gt;<i> 
</I>&gt;<i> # ACLs # for destination machine acl lan_dst dst 172.16.0.0/16 #
</I>&gt;<i> for source machine acl lan_src src 172.16.0.0/16 # for destination
</I>&gt;<i> domain acl lan_domain dstdomain .oppy.com
</I>&gt;<i> 
</I>&gt;<i> # SSL Ports acl SSL_ports port 443 8180 8443 563 1494 2598 8531
</I>&gt;<i> 
</I>&gt;<i> # Standard Ports acl Safe_ports port 80						# http acl Safe_ports
</I>&gt;<i> port 81          			# http for Pacific Brokerage acl Safe_ports
</I>&gt;<i> port 21						# ftp acl Safe_ports port 443 563					# http acl
</I>&gt;<i> Safe_ports port 70						# gopher acl Safe_ports port 210						#
</I>&gt;<i> wais acl Safe_ports port 280						# http-mgmt acl Safe_ports port
</I>&gt;<i> 488						# gss-http acl Safe_ports port 591						# filemaker acl
</I>&gt;<i> Safe_ports port 777						# multiling http acl Safe_ports port 8080
</I>&gt;<i> 8081 8082 8088 8180 acl Safe_ports port 3128        			# Squid http
</I>&gt;<i> server acl Safe_ports port 1494 2598   			# ICA - Citrix acl
</I>&gt;<i> Safe_ports port 7000 8000   			# Oracle acl Safe_ports port 9000
</I>&gt;<i> # Oracle acl Safe_ports port 8530					# WSUS acl Safe_ports port
</I>&gt;<i> 55905					# WSUS acl Safe_ports port 1025-65535				# unregistered
</I>&gt;<i> ports
</I>&gt;<i> 
</I>&gt;<i> external_acl_type AD_group %LOGIN
</I>&gt;<i> c:/squid/libexec/mswin_check_ad_group.exe -G acl AuthorizedUsers
</I>&gt;<i> proxy_auth REQUIRED
</I>&gt;<i> 
</I>&gt;<i> # ACL - Microsoft acl msdomains dstdomain .windowsupdate.com acl
</I>&gt;<i> msdomains dstdomain .microsoft.com acl msdomains dstdomain ... acl
</I>&gt;<i> msdomains dstdomain .microsoftonline.com acl msdomains dstdomain
</I>&gt;<i> ...
</I>&gt;<i> 
</I>&gt;<i> # ACL - SSL Providers acl registars dstdomain ...
</I>&gt;<i> 
</I>&gt;<i> # LYNC acl lync2013 dst ...
</I>&gt;<i> 
</I>&gt;<i> # OFFICE 365 PORTAL AND IDENTITY acl 365portal dst ...
</I>&gt;<i> 
</I>&gt;<i> # OFFICE ONLINE acl office365 dst ...
</I>&gt;<i> 
</I>&gt;<i> acl dropbox dstdomain .dropbox.com acl icloud dstdomain
</I>&gt;<i> .icloud.com
</I>&gt;<i> 
</I>&gt;<i> # Squid Cache acl PURGE method PURGE
</I>&gt;<i> 
</I>&gt;<i> http_access deny manager !localhost http_access allow PURGE
</I>&gt;<i> localhost http_access deny PURGE
</I>&gt;<i> 
</I>&gt;<i> # The method ACL type allows you to restrict access based on the
</I>&gt;<i> request HTTP method, i.e. GET (used for downloading), POST (used
</I>&gt;<i> for uploading) and CONNECT (used for SSL data transfers) # It is
</I>&gt;<i> very important that you stop CONNECT type requests to non-SSL
</I>&gt;<i> ports. The CONNECT method allows data transfer in any direction at
</I>&gt;<i> any time, regardless of the transport protocol used. acl CONNECT
</I>&gt;<i> method CONNECT http_access deny CONNECT !SSL_ports
</I>&gt;<i> 
</I>&gt;<i> # Deny access to all ports except the ones defined http_access deny
</I>&gt;<i> !Safe_ports # This blocks attempts to request <A HREF="http://localhost">http://localhost</A> on
</I>&gt;<i> the proxy server via the proxy. http_access deny localhost # Deny
</I>&gt;<i> caching for everyone so that there is not caching at all cache deny
</I>&gt;<i> all
</I>&gt;<i> 
</I>&lt;snip default security checks&gt;


&gt;<i> http_access allow msdomains
</I>
 ... the transaction &quot;POST
<A HREF="http://sqm.microsoft.com/sqm/wm/sqmserver.dll">http://sqm.microsoft.com/sqm/wm/sqmserver.dll</A>&quot; is permitted here.
Authentication is neither required nor used.

 ... the transaction &quot;CONNECT login.microsoftonline.com:443&quot; is
permitted here. Everythign inside that tunnel is then strictly between
the client software and login.microsoftonline.com server.
Authentication is neither required nor used to setup the tunnel itself.


&gt;<i> http_access allow lync2013 http_access allow 365portal http_access
</I>&gt;<i> allow office365 http_access allow registars http_access allow
</I>&gt;<i> dropbox http_access allow icloud http_access allow lan_domain
</I>&gt;<i> 
</I>&gt;<i> http_access allow CONNECT msdomains http_access allow CONNECT
</I>&gt;<i> lync2013 http_access allow CONNECT 365portal http_access allow
</I>&gt;<i> CONNECT office365 http_access allow CONNECT registars http_access
</I>&gt;<i> allow CONNECT dropbox http_access allow CONNECT icloud http_access
</I>&gt;<i> allow CONNECT lan_domain
</I>
All transactions which might match these CONNECT+something ACL checks
are already permitted by the &quot;allow something&quot; set directly above.

The CONNECT part of teh ACL check is unnecessary.

&gt;<i> 
</I>&gt;<i> # Deny access to proxy to everyone except Authorized Users group in
</I>&gt;<i> AD http_access deny !AuthorizedUsers
</I>&gt;<i> 
</I>
&gt;<i> # Disable caching always_direct allow msdomains all always_direct
</I>&gt;<i> allow registars all always_direct allow lync2013 all always_direct
</I>&gt;<i> allow 365portal all always_direct allow office365 all
</I>&gt;<i> 
</I>&gt;<i> # Allow direct connection if the destination machine is on LAN 
</I>&gt;<i> always_direct allow lan_dst
</I>
always_direct prevents configured cache_peer being used to fetch the
traffic. That is all.

You do not have any cache_peer, so these always_direct lines are not
useful and just slow the proxy down.

FWIW: 'DIRECT' in HTTP means using DNS records to locate an
appropriate server. Instead of peer configuration or WPAD algorithms.


&gt;<i> # Caching cache_mgr <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ittechs at oppy.com</A> refresh_pattern ^ftp:		1440
</I>&gt;<i> 20%	10080 refresh_pattern ^gopher:	1440	0%	1440 refresh_pattern -i
</I>&gt;<i> (/cgi-bin/|\?) 0	0%	0 refresh_pattern .		0	20%	4320
</I>&gt;<i> 
</I>&gt;<i> # Dont cache these pages acl DYNAMIC_CONTENT urlpath_regex cgi-bin
</I>&gt;<i> \.cgi \.pl \.php3 \.asp \.php no_cache deny DYNAMIC_CONTENT
</I>
Squid-2.7 and later are just fine caching dynamic content provided you
use correct refresh_patterns.

Also, you have two earlier config settings which make this useless.
First is the &quot;cache deny all&quot; above, which makes this useless. Second
is the refresh_pattern on (/cgi-bin/|\?), which discards dynamic
content strictly according to protocol requirements.

I suggest you erase the above DYNAMIC_CONTENT bits.

Cheers
Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUNhHAAAoJELJo5wb/XPRj5QcH/imDm2RLbJnia4rqWamC3UTo
uQlM6Mha0/boL+L7VOHu/1MsBlq4pN22EEBUBWyfUYWFRT+0M6onQ6lb4sDSKgnu
hHvhaI3D0a6c/bXOYTv+19TXb4kzaXq1c4/ph9gEZFslymw457adIJjU/jZuSg7D
OsOKjvP3i7Bi1DoNsZwiuYXyN1e1zNjYGEFN5Vo+WlK4Ola2mno9mdzIhQGodibM
+x52uqmUGeKKsllkZ1CrLWsnbzNbHAY4x8F6m85yGUk7ZBQ1dASGmiBalYTN/cT+
LF2KTijgL/hnAFlAnejopxuUCRcb7sXElQQfPYcAA4LR0eHRb+G+jU1PduoY390=
=IDPH
-----END PGP SIGNATURE-----

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000209.html">[squid-users] Squid 2.7 STABLE8 (Win2008) can't get my MS Lync 2013 to work?
</A></li>
	<LI>Next message (by thread): <A HREF="000182.html">[squid-users] can i disable ipv4 for tcp_outgoing ???? and allow	only ipv6 ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#210">[ date ]</a>
              <a href="thread.html#210">[ thread ]</a>
              <a href="subject.html#210">[ subject ]</a>
              <a href="author.html#210">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
