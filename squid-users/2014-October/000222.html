<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] blockVirgin Works for CONNECT but Custom Response does not work
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20blockVirgin%20Works%20for%20CONNECT%20but%20Custom%20Response%0A%20does%20not%20work&In-Reply-To=%3CCAGRJihX7xqTWJA4RHa99jUmd1k-gtCyE-hq%3DMzRK4XTHXtgfwA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000240.html">
   <LINK REL="Next"  HREF="000228.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] blockVirgin Works for CONNECT but Custom Response does not work</H1>
    <B>Jatin Bhasin</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20blockVirgin%20Works%20for%20CONNECT%20but%20Custom%20Response%0A%20does%20not%20work&In-Reply-To=%3CCAGRJihX7xqTWJA4RHa99jUmd1k-gtCyE-hq%3DMzRK4XTHXtgfwA%40mail.gmail.com%3E"
       TITLE="[squid-users] blockVirgin Works for CONNECT but Custom Response does not work">jbhasin83 at gmail.com
       </A><BR>
    <I>Fri Oct 10 05:57:47 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000240.html">[squid-users] I need a help with user permissions credentials
</A></li>
        <LI>Next message (by thread): <A HREF="000228.html">[squid-users] blockVirgin Works for CONNECT but Custom Response does not work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#222">[ date ]</a>
              <a href="thread.html#222">[ thread ]</a>
              <a href="subject.html#222">[ subject ]</a>
              <a href="author.html#222">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Alex,

I used the annotation mechanism as you had suggested. My squid
configuration files looks as below: (For now I am using X-Virus-ID to
see if the concept works for my case)

adaptation_masterx_shared_names X-Virus-ID
acl toBump note X-Virus-ID yes
ssl_bump client-first toBump


My eCap adapter functions which returns yes for the X-Virus-ID are:
=================================================================
const libecap::Area Adapter::Xaction::option(const libecap::Name &amp;name) const
{
std::string str = &quot;yes&quot;;
return libecap::Area(str.data(), str.size());
}
--------------------------------------------------------------------------------------------------------------------
void Adapter::Xaction::visitEachOption(libecap::NamedValueVisitor
&amp;visitor) const
{
std::string str = &quot;yes&quot;;
    visitor.visit(libecap::metaVirusId, libecap::Area(str.data(), str.size()));
}
=================================================================

Now looking at the log file I see the following. Also, from cache.log
toBump does not seem to be getting matched probably because X-Virus-ID
is not set to yes.
2014/10/10 14:51:21.431 kid1| client_side_request.cc(1551)
sslBumpNeed: sslBump required: none

I have placed debug statements in my eCap adapter function to confirm
if I am seeing CONNECT requests for a URL and also that I am setting
X-Virus-ID to yes. But I am not to understand that what I could be
missing.

Can you please suggest me what I could be missing.



Thanks,
Jatin

On Sat, Aug 23, 2014 at 10:24 AM, Alex Rousskov
&lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:
&gt;<i> On 08/21/2014 07:06 PM, Jatin Bhasin wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> So, can somebody suggest me if there is a way to pass a flag to squid
</I>&gt;&gt;<i> from ecap adapter to decrypt a site regardless of what ACL says. For
</I>&gt;&gt;<i> example if I have an acl as below which says do not decrypt
</I>&gt;&gt;<i> www.888.com but If my ecap adapter could pass a message to squid
</I>&gt;&gt;<i> asking it to decrypt www.888.com (for that session only) and ignore
</I>&gt;&gt;<i> the below acl.
</I>&gt;&gt;<i> Is it possible?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Given a recent-enough Squid version, an adaptation service can control
</I>&gt;<i> Squid behavior via the annotations mechanism and the &quot;note&quot; ACL
</I>&gt;<i> associated with it. For example, your eCAP adapter can return an
</I>&gt;<i> X-Bump:yes annotation(**) that Squid can then match using the note ACL.
</I>&gt;<i> Something along these untested lines:
</I>&gt;<i>
</I>&gt;<i>   acl note toBump X-Bump yes
</I>&gt;<i>   ssl_bump server-first toBump
</I>&gt;<i>   ssl_bump server-first ...
</I>&gt;<i>   ssl_bump none all
</I>&gt;<i>
</I>&gt;<i> This mechanism should be supported for ssl_bump ACLs but I have not
</I>&gt;<i> tested that claim myself.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> HTH,
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i> (**) In eCAP terminology, an X-Bump:yes annotation is an adapter
</I>&gt;<i> transaction option named X-Bump with a &quot;yes&quot; value. See
</I>&gt;<i> libecap::Options, which is a parent of libecap::adapter::Xaction.
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000240.html">[squid-users] I need a help with user permissions credentials
</A></li>
	<LI>Next message (by thread): <A HREF="000228.html">[squid-users] blockVirgin Works for CONNECT but Custom Response does not work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#222">[ date ]</a>
              <a href="thread.html#222">[ thread ]</a>
              <a href="subject.html#222">[ subject ]</a>
              <a href="author.html#222">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
