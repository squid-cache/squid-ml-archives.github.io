<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] blockVirgin Works for CONNECT but Custom Response does not work
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20blockVirgin%20Works%20for%20CONNECT%20but%20Custom%20Response%0A%20does%20not%20work&In-Reply-To=%3CCAGRJihUdL99qd5Sc3AvgpJ2CGMPB_Fja6AN9t%3DTxfzHJ%2BaQcQw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000222.html">
   <LINK REL="Next"  HREF="000231.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] blockVirgin Works for CONNECT but Custom Response does not work</H1>
    <B>Jatin Bhasin</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20blockVirgin%20Works%20for%20CONNECT%20but%20Custom%20Response%0A%20does%20not%20work&In-Reply-To=%3CCAGRJihUdL99qd5Sc3AvgpJ2CGMPB_Fja6AN9t%3DTxfzHJ%2BaQcQw%40mail.gmail.com%3E"
       TITLE="[squid-users] blockVirgin Works for CONNECT but Custom Response does not work">jbhasin83 at gmail.com
       </A><BR>
    <I>Fri Oct 10 11:56:25 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000222.html">[squid-users] blockVirgin Works for CONNECT but Custom Response does not work
</A></li>
        <LI>Next message (by thread): <A HREF="000231.html">[squid-users] blockVirgin Works for CONNECT but Custom Response does not work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#228">[ date ]</a>
              <a href="thread.html#228">[ thread ]</a>
              <a href="subject.html#228">[ subject ]</a>
              <a href="author.html#228">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Alex,

Looking at cache.log I see that X-Virus-ID is set to yes but the eCap
adapter functions. But I do not know that how it will be picked up
note acl. Please suggest.


2014/10/10 22:50:55.341 kid1| HttpHeader.cc(1272) putExt:
0x7fff1d656f80 adds ext entry X-Virus-ID : yes
2014/10/10 22:50:55.341 kid1| HttpHeader.cc(1525) HttpHeaderEntry:
created HttpHeaderEntry 0x1722650: 'X-Virus-ID : yes
2014/10/10 22:50:55.341 kid1| HttpHeader.cc(907) addEntry:
0x7fff1d656f80 adding entry: 77 at 0
2014/10/10 22:50:55.341 kid1| HttpHeader.cc(442) clean: cleaning hdr:
0x1722538 owner: 3
2014/10/10 22:50:55.341 kid1| HttpHeader.cc(818) delByName: deleting
'X-Virus-ID' fields in hdr 0x1722538
2014/10/10 22:50:55.341 kid1| HttpHeader.cc(533) update: Updating
header 'Other:' in cached entry
2014/10/10 22:50:55.341 kid1| HttpHeader.cc(1525) HttpHeaderEntry:
created HttpHeaderEntry 0x1722720: 'X-Virus-ID : yes
2014/10/10 22:50:55.341 kid1| HttpHeader.cc(907) addEntry: 0x1722538
adding entry: 77 at 0
2014/10/10 22:50:55.341 kid1| HttpHeader.cc(818) delByName: deleting
'X-Virus-ID' fields in hdr 0x1722568
2014/10/10 22:50:55.341 kid1| HttpHeader.cc(533) update: Updating
header 'Other:' in cached entry
2014/10/10 22:50:55.341 kid1| HttpHeader.cc(1525) HttpHeaderEntry:
created HttpHeaderEntry 0x17227f0: 'X-Virus-ID : yes
2014/10/10 22:50:55.341 kid1| HttpHeader.cc(907) addEntry: 0x1722568
adding entry: 77 at 0
2014/10/10 22:50:55.341 kid1| HttpHeader.cc(442) clean: cleaning hdr:
0x7fff1d656f80 owner: 3
2014/10/10 22:50:55.341 kid1| HttpHeader.cc(1531) ~HttpHeaderEntry:
destroying entry 0x1722650: 'X-Virus-ID: yes'

On Fri, Oct 10, 2014 at 4:57 PM, Jatin Bhasin &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">jbhasin83 at gmail.com</A>&gt; wrote:
&gt;<i> Hi Alex,
</I>&gt;<i>
</I>&gt;<i> I used the annotation mechanism as you had suggested. My squid
</I>&gt;<i> configuration files looks as below: (For now I am using X-Virus-ID to
</I>&gt;<i> see if the concept works for my case)
</I>&gt;<i>
</I>&gt;<i> adaptation_masterx_shared_names X-Virus-ID
</I>&gt;<i> acl toBump note X-Virus-ID yes
</I>&gt;<i> ssl_bump client-first toBump
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> My eCap adapter functions which returns yes for the X-Virus-ID are:
</I>&gt;<i> =================================================================
</I>&gt;<i> const libecap::Area Adapter::Xaction::option(const libecap::Name &amp;name) const
</I>&gt;<i> {
</I>&gt;<i> std::string str = &quot;yes&quot;;
</I>&gt;<i> return libecap::Area(str.data(), str.size());
</I>&gt;<i> }
</I>&gt;<i> --------------------------------------------------------------------------------------------------------------------
</I>&gt;<i> void Adapter::Xaction::visitEachOption(libecap::NamedValueVisitor
</I>&gt;<i> &amp;visitor) const
</I>&gt;<i> {
</I>&gt;<i> std::string str = &quot;yes&quot;;
</I>&gt;<i>     visitor.visit(libecap::metaVirusId, libecap::Area(str.data(), str.size()));
</I>&gt;<i> }
</I>&gt;<i> =================================================================
</I>&gt;<i>
</I>&gt;<i> Now looking at the log file I see the following. Also, from cache.log
</I>&gt;<i> toBump does not seem to be getting matched probably because X-Virus-ID
</I>&gt;<i> is not set to yes.
</I>&gt;<i> 2014/10/10 14:51:21.431 kid1| client_side_request.cc(1551)
</I>&gt;<i> sslBumpNeed: sslBump required: none
</I>&gt;<i>
</I>&gt;<i> I have placed debug statements in my eCap adapter function to confirm
</I>&gt;<i> if I am seeing CONNECT requests for a URL and also that I am setting
</I>&gt;<i> X-Virus-ID to yes. But I am not to understand that what I could be
</I>&gt;<i> missing.
</I>&gt;<i>
</I>&gt;<i> Can you please suggest me what I could be missing.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> Jatin
</I>&gt;<i>
</I>&gt;<i> On Sat, Aug 23, 2014 at 10:24 AM, Alex Rousskov
</I>&gt;<i> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:
</I>&gt;&gt;<i> On 08/21/2014 07:06 PM, Jatin Bhasin wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> So, can somebody suggest me if there is a way to pass a flag to squid
</I>&gt;&gt;&gt;<i> from ecap adapter to decrypt a site regardless of what ACL says. For
</I>&gt;&gt;&gt;<i> example if I have an acl as below which says do not decrypt
</I>&gt;&gt;&gt;<i> www.888.com but If my ecap adapter could pass a message to squid
</I>&gt;&gt;&gt;<i> asking it to decrypt www.888.com (for that session only) and ignore
</I>&gt;&gt;&gt;<i> the below acl.
</I>&gt;&gt;&gt;<i> Is it possible?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Given a recent-enough Squid version, an adaptation service can control
</I>&gt;&gt;<i> Squid behavior via the annotations mechanism and the &quot;note&quot; ACL
</I>&gt;&gt;<i> associated with it. For example, your eCAP adapter can return an
</I>&gt;&gt;<i> X-Bump:yes annotation(**) that Squid can then match using the note ACL.
</I>&gt;&gt;<i> Something along these untested lines:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   acl note toBump X-Bump yes
</I>&gt;&gt;<i>   ssl_bump server-first toBump
</I>&gt;&gt;<i>   ssl_bump server-first ...
</I>&gt;&gt;<i>   ssl_bump none all
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This mechanism should be supported for ssl_bump ACLs but I have not
</I>&gt;&gt;<i> tested that claim myself.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> HTH,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Alex.
</I>&gt;&gt;<i> (**) In eCAP terminology, an X-Bump:yes annotation is an adapter
</I>&gt;&gt;<i> transaction option named X-Bump with a &quot;yes&quot; value. See
</I>&gt;&gt;<i> libecap::Options, which is a parent of libecap::adapter::Xaction.
</I>&gt;&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000222.html">[squid-users] blockVirgin Works for CONNECT but Custom Response does not work
</A></li>
	<LI>Next message (by thread): <A HREF="000231.html">[squid-users] blockVirgin Works for CONNECT but Custom Response does not work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#228">[ date ]</a>
              <a href="thread.html#228">[ thread ]</a>
              <a href="subject.html#228">[ subject ]</a>
              <a href="author.html#228">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
