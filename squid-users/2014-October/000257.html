<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSL/SSH/SFTP/FTPS to alternate ports
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL/SSH/SFTP/FTPS%20to%20alternate%20ports&In-Reply-To=%3CA26D68A9-86B3-4349-B5C2-53E02C430A8C%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000255.html">
   <LINK REL="Next"  HREF="000259.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSL/SSH/SFTP/FTPS to alternate ports</H1>
    <B>Timothy Spear</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL/SSH/SFTP/FTPS%20to%20alternate%20ports&In-Reply-To=%3CA26D68A9-86B3-4349-B5C2-53E02C430A8C%40gmail.com%3E"
       TITLE="[squid-users] SSL/SSH/SFTP/FTPS to alternate ports">n614cd at gmail.com
       </A><BR>
    <I>Sun Oct 12 14:49:05 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000255.html">[squid-users] SSL/SSH/SFTP/FTPS to alternate ports
</A></li>
        <LI>Next message (by thread): <A HREF="000259.html">[squid-users] SSL/SSH/SFTP/FTPS to alternate ports
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#257">[ date ]</a>
              <a href="thread.html#257">[ thread ]</a>
              <a href="subject.html#257">[ subject ]</a>
              <a href="author.html#257">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Here is the access log. I should have included it in the original post. This is accessing a test machine I setup to hit SSH on 22 and 443. I can also hit HTTPS on multiple other ports.

1413125068.706     87 10.110.98.21 TCP_MISS/503 0 CONNECT XXX.XXXX.com:22 - HIER_NONE/- -
1413125086.496   8061 10.110.98.21 TCP_MISS/200 3657 CONNECT XXX.XXXX.com:443 - HIER_DIRECT/54.68.15.208 -

Yes, my intent in the rule set is to provide a list of allowed ports and sites. 

Tim

On Oct 11, 2014, at 11:37 PM, B &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">crazyworld at outlook.com</A>&gt; wrote:

&gt;<i> check out your access log seeing what it says. Sounds like you are looking for an AFW from squid. The ports themselves are defined. You need to make sure the other ports are opened.
</I>&gt;<i> 
</I>&gt;<i> Your rule tells squid to block the non-allowed sites to the non-allowed ports. Still sounds like FW function, but with the domain feature only.
</I>&gt;<i> 
</I>&gt;<i> -B
</I>&gt;<i> On 10/12/2014 7:48 AM, Timothy Spear wrote:
</I>&gt;&gt;<i> Hello,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Here is the issue:
</I>&gt;&gt;<i> I can proxy through Squid just fine to HTTP and HTTPS. I can also run SSH via Corkscrew to a SSH server running on port 443 and it works fine.
</I>&gt;&gt;<i> What I cannot do, is access HTTPS or SSH on any other port except 443. I have lost track of the number of things I have tried so any help will be appreciated and I feel like I am missing something simple. 
</I>&gt;&gt;<i> OS: Ubuntu 14.04.1 LTS
</I>&gt;&gt;<i> Squid: 3.3.8-1ubuntu6.1
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Here is my current Squid 3 configuration:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> debug_options all,3
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> # local network we proxy for
</I>&gt;&gt;<i> acl localnet src 10.110.98.0/24
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> # what ports can be the desitnation
</I>&gt;&gt;<i> acl allowedPorts port 21
</I>&gt;&gt;<i> acl allowedPorts port 22
</I>&gt;&gt;<i> acl allowedPorts port 2222
</I>&gt;&gt;<i> acl allowedPorts port 80
</I>&gt;&gt;<i> acl allowedPorts port 443
</I>&gt;&gt;<i> acl allowedPorts port 8443
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> acl CONNECT method CONNECT
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> # determine the available sites
</I>&gt;&gt;<i> acl allowedSites dstdomain &quot;/etc/squid3/allowed-sites.squid&quot;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> # now block anything not on the localnet or ports
</I>&gt;&gt;<i> http_access deny !localnet
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> # allow connect only for approved ports
</I>&gt;&gt;<i> http_access deny CONNECT !allowedPorts
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> # now only allow to the specific sites
</I>&gt;&gt;<i> http_access allow localnet allowedSites allowedPorts
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> http_port 3128
</I>&gt;&gt;<i> access_log /var/log/squid3/access.log squid
</I>&gt;&gt;<i> hosts_file /etc/hosts
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Background (just FYI):
</I>&gt;&gt;<i> I am trying to setup Squid to control network access from a local subnet to a select number of domains. I do not need to bump the encrypted traffic and play man in the middle, I just need to prevent the servers on the local network from accessing unauthorized networks. Yes, I know I can do this in the Firewall, but that is IP based and I am dealing with enough other companies that maintaining the IP list has become a major pain. Instead I want to use domains, which I can do in Squid.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Tim
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20141012/ecf66eb1/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20141012/ecf66eb1/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000255.html">[squid-users] SSL/SSH/SFTP/FTPS to alternate ports
</A></li>
	<LI>Next message (by thread): <A HREF="000259.html">[squid-users] SSL/SSH/SFTP/FTPS to alternate ports
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#257">[ date ]</a>
              <a href="thread.html#257">[ thread ]</a>
              <a href="subject.html#257">[ subject ]</a>
              <a href="author.html#257">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
