<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSL/SSH/SFTP/FTPS to alternate ports
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL/SSH/SFTP/FTPS%20to%20alternate%20ports&In-Reply-To=%3C543AA9C4.6030106%40artifact-software.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000260.html">
   <LINK REL="Next"  HREF="000256.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSL/SSH/SFTP/FTPS to alternate ports</H1>
    <B>Ron Wheeler</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL/SSH/SFTP/FTPS%20to%20alternate%20ports&In-Reply-To=%3C543AA9C4.6030106%40artifact-software.com%3E"
       TITLE="[squid-users] SSL/SSH/SFTP/FTPS to alternate ports">rwheeler at artifact-software.com
       </A><BR>
    <I>Sun Oct 12 16:18:12 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000260.html">[squid-users] SSL/SSH/SFTP/FTPS to alternate ports
</A></li>
        <LI>Next message (by thread): <A HREF="000256.html">[squid-users] SSL/SSH/SFTP/FTPS to alternate ports
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#261">[ date ]</a>
              <a href="thread.html#261">[ thread ]</a>
              <a href="subject.html#261">[ subject ]</a>
              <a href="author.html#261">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12/10/2014 11:33 AM, Timothy Spear wrote:
&gt;<i> B,
</I>&gt;<i>
</I>&gt;<i> I was going to attach the logs, but I now feel like an idiot. :D
</I>&gt;<i> The jump box I am running Squid on, currently only allows 80 and 443 
</I>&gt;<i> outbound. I recalled this when I went to scp the log files and the 
</I>&gt;<i> connection was refused....
</I>&gt;<i> I detest overlooking things like this. Sometimes, you really need 
</I>&gt;<i> question any assumptions.
</I>
You are not alone! &quot;Sometimes&quot;-&gt;&quot;Always&quot;

&gt;<i>
</I>&gt;<i> Tim
</I>&gt;<i>
</I>&gt;<i> On Oct 12, 2014, at 11:11 AM, crazy world &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">crazyworld at outlook.com</A> 
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">crazyworld at outlook.com</A>&gt;&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Do you have the log for the connection when you can't access? Other 
</I>&gt;&gt;<i> than 22 and 443 as you said.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -B
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ------------------------------------------------------------------------
</I>&gt;&gt;<i> Subject: Re: [squid-users] SSL/SSH/SFTP/FTPS to alternate ports
</I>&gt;&gt;<i> From: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">n614cd at gmail.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">n614cd at gmail.com</A>&gt;
</I>&gt;&gt;<i> Date: Sun, 12 Oct 2014 10:49:05 -0400
</I>&gt;&gt;<i> CC: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">n614cd at gmail.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">n614cd at gmail.com</A>&gt;; 
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> 
</I>&gt;&gt;<i> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">crazyworld at outlook.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">crazyworld at outlook.com</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Here is the access log. I should have included it in the original 
</I>&gt;&gt;<i> post. This is accessing a test machine I setup to hit SSH on 22 and 
</I>&gt;&gt;<i> 443. I can also hit HTTPS on multiple other ports.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 1413125068.706     87 10.110.98.21 TCP_MISS/503 0 CONNECTXXX.XXXX.com 
</I>&gt;&gt;<i> &lt;<A HREF="http://xxx.xxxx.com/">http://xxx.xxxx.com/</A>&gt;:22 - HIER_NONE/- -
</I>&gt;&gt;<i> 1413125086.496   8061 10.110.98.21 TCP_MISS/200 3657 
</I>&gt;&gt;<i> CONNECTXXX.XXXX.com &lt;<A HREF="http://xxx.xxxx.com/">http://xxx.xxxx.com/</A>&gt;:443 - 
</I>&gt;&gt;<i> HIER_DIRECT/54.68.15.208 -
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Yes, my intent in the rule set is to provide a list of allowed ports 
</I>&gt;&gt;<i> and sites.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Tim
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Oct 11, 2014, at 11:37 PM, B &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">crazyworld at outlook.com</A> 
</I>&gt;&gt;<i> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">crazyworld at outlook.com</A>&gt;&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     check out your access log seeing what it says. Sounds like you
</I>&gt;&gt;<i>     are looking for an AFW from squid. The ports themselves are
</I>&gt;&gt;<i>     defined. You need to make sure the other ports are opened.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     Your rule tells squid to block the non-allowed sites to the
</I>&gt;&gt;<i>     non-allowed ports. Still sounds like FW function, but with the
</I>&gt;&gt;<i>     domain feature only.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     -B
</I>&gt;&gt;<i>     On 10/12/2014 7:48 AM, Timothy Spear wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         Hello,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         Here is the issue:
</I>&gt;&gt;<i>         I can proxy through Squid just fine to HTTP and HTTPS. I can
</I>&gt;&gt;<i>         also run SSH via Corkscrew to a SSH server running on port
</I>&gt;&gt;<i>         443 and it works fine.
</I>&gt;&gt;<i>         What I cannot do, is access HTTPS or SSH on any other port
</I>&gt;&gt;<i>         except 443. I have lost track of the number of things I have
</I>&gt;&gt;<i>         tried so any help will be appreciated and I feel like I am
</I>&gt;&gt;<i>         missing something simple.
</I>&gt;&gt;<i>         OS: Ubuntu 14.04.1 LTS
</I>&gt;&gt;<i>         Squid: 3.3.8-1ubuntu6.1
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         Here is my current Squid 3 configuration:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         debug_optionsall,3
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         # local network we proxy for
</I>&gt;&gt;<i>         acllocalnetsrc10.110.98.0/24
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         # what ports can be the desitnation
</I>&gt;&gt;<i>         aclallowedPortsport21
</I>&gt;&gt;<i>         aclallowedPortsport22
</I>&gt;&gt;<i>         acl allowedPorts port 2222
</I>&gt;&gt;<i>         aclallowedPortsport80
</I>&gt;&gt;<i>         acl allowedPorts port 443
</I>&gt;&gt;<i>         acl allowedPorts port 8443
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         aclCONNECTmethodCONNECT
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         # determine the available sites
</I>&gt;&gt;<i>         aclallowedSitesdstdomain&quot;/etc/squid3/allowed-sites.squid&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         # now block anything not on the localnet or ports
</I>&gt;&gt;<i>         http_accessdeny!localnet
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         # allow connect only for approved ports
</I>&gt;&gt;<i>         http_access deny CONNECT !allowedPorts
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         # now only allow to the specific sites
</I>&gt;&gt;<i>         http_accessallowlocalnet allowedSites allowedPorts
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         http_port3128
</I>&gt;&gt;<i>         access_log/var/log/squid3/access.logsquid
</I>&gt;&gt;<i>         hosts_file /etc/hosts
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         Background (just FYI):
</I>&gt;&gt;<i>         I am trying to setup Squid to control network access from a
</I>&gt;&gt;<i>         local subnet to a select number of domains. I do not need to
</I>&gt;&gt;<i>         bump the encrypted traffic and play man in the middle, I just
</I>&gt;&gt;<i>         need to prevent the servers on the local network from
</I>&gt;&gt;<i>         accessing unauthorized networks. Yes, I know I can do this in
</I>&gt;&gt;<i>         the Firewall, but that is IP based and I am dealing with
</I>&gt;&gt;<i>         enough other companies that maintaining the IP list has
</I>&gt;&gt;<i>         become a major pain. Instead I want to use domains, which I
</I>&gt;&gt;<i>         can do in Squid.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         Thanks,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         Tim
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         _______________________________________________
</I>&gt;&gt;<i>         squid-users mailing list
</I>&gt;&gt;<i>         <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>  &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;&gt;<i>         <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

-- 
Ron Wheeler
President
Artifact Software Inc
email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">rwheeler at artifact-software.com</A>
skype: ronaldmwheeler
phone: 866-970-2435, ext 102

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20141012/4d72b5f2/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20141012/4d72b5f2/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000260.html">[squid-users] SSL/SSH/SFTP/FTPS to alternate ports
</A></li>
	<LI>Next message (by thread): <A HREF="000256.html">[squid-users] SSL/SSH/SFTP/FTPS to alternate ports
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#261">[ date ]</a>
              <a href="thread.html#261">[ thread ]</a>
              <a href="subject.html#261">[ subject ]</a>
              <a href="author.html#261">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
