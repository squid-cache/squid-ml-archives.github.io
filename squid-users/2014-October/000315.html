<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Unable to display splash page on inactive timeout
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Unable%20to%20display%20splash%20page%20on%20inactive%20timeout&In-Reply-To=%3C543E3BCC.8020002%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000312.html">
   <LINK REL="Next"  HREF="000330.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Unable to display splash page on inactive timeout</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Unable%20to%20display%20splash%20page%20on%20inactive%20timeout&In-Reply-To=%3C543E3BCC.8020002%40treenet.co.nz%3E"
       TITLE="[squid-users] Unable to display splash page on inactive timeout">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Oct 15 09:18:04 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000312.html">[squid-users] Unable to display splash page on inactive timeout
</A></li>
        <LI>Next message (by thread): <A HREF="000330.html">[squid-users] Unable to display splash page on inactive timeout
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#315">[ date ]</a>
              <a href="thread.html#315">[ thread ]</a>
              <a href="subject.html#315">[ subject ]</a>
              <a href="author.html#315">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 15/10/2014 8:31 p.m., santosh wrote:
&gt;<i> Hello Team,
</I>&gt;<i> 
</I>&gt;<i> I have set-up a squid proxy server and have implemented the URL
</I>&gt;<i> blocking and authentication through ldap successfully . Now i have
</I>&gt;<i> a requirement that the squid proxy has to timeout inactive
</I>&gt;<i> authenticated sessions informing the user to re-login. I followed
</I>&gt;<i> up the below links as below
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://wiki.squid-cache.org/ConfigExamples/Portal/Splash">http://wiki.squid-cache.org/ConfigExamples/Portal/Splash</A> 
</I>&gt;<i> <A HREF="http://thejimmahknows.com/squid-proxy-splash-page-2/">http://thejimmahknows.com/squid-proxy-splash-page-2/</A>
</I>&gt;<i> 
</I>&gt;<i> have tried different combinations and i'm not able to make it to
</I>&gt;<i> work , i Have posted the acl as below please let me know wherei'm
</I>&gt;<i> going wrong
</I>&gt;<i> 
</I>
You started going wrong with the assumption that there *are*
authentication sessions in HTTP.  Once you realise there are no
sessions, then its clear there is no way for then to become &quot;inactive&quot;.

HTTP is stateless at the protocol messaging level. Every request
involving authentication MUST have the relevant credentials sent
explicitly so as to re-authenticate them per-request.

So, Squid is always getting &quot;fresh&quot; credentials from the client. The
TTL relavant to Squid (helper TTL value) is just how often it has to
re-validate that constant incoming stream with the backend for
changes, versus comparing against its prevously cached auth result.
 - this happens during &quot;allow ldapauth&quot; so Squid never gets to any
not-logged-in state for valid users at the &quot;deny !existing_users&quot;
check. So move your existing_users check above the auth check.
 - even if you get this 511 result back to the client, bad things will
happen.


Basic auth has a binary respone to the client. Which states only
OK/allowed or 407-DENIED/invalid credentials.

Digest auth offers something closer to a session mechanism where Squid
can explicitly send the client a nonce-expired/stale marker to the
client instead of just rejecting the credentials as invalid.

Both of these are handled automatically behind the scenery in the
authentication logics. The human user should never be bothered more
than once per connection for credentials.


Additional to that...

Your requirement is a bit of a nasty idea due to the fact that web
&quot;pages&quot; do not actually exist as objects being requested. What *will*
happen is that some random object used to create a page will be
replaced by the session re-login &quot;page&quot; you are sending.

That is not necessarily going to be visible to the user. If it does
happen by chance to replace an HTML object or image, maybe. But a
large proportion of web content is actually scripts, CSS, or data
objects parsed and processed by scripts in the browser to display some
other visible content. Replacing any one of those with an arbitrary
HTML object is potentially dangerous or at best screwing up the client
experience badly without the re-login info actually being made visible.
 - once it has been sent and done its damage the very next client
request continues on with the same old credentials in the new session
period.


&gt;<i> # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS #
</I>&gt;<i> 
</I>&gt;<i> external_acl_type splash_page ttl=60 concurrency=100 %SRC 
</I>&gt;<i> /usr/lib/squid3/ext_session_acl -t 80 -b
</I>&gt;<i> /usr/lib/squid3/session.db
</I>&gt;<i> 
</I>&gt;<i> acl existing_users external splash_page
</I>&gt;<i> 
</I>&gt;<i> auth_param basic program /usr/lib/squid3/basic_ldap_auth -b 
</I>&gt;<i> &quot;dc=example,dc=com&quot; -f &quot;(|(uid=%s)(mail=%s))&quot; -h proxy.example.com
</I>&gt;<i> 
</I>&gt;<i> acl ldapauth proxy_auth REQUIRED acl bad_url url_regex
</I>&gt;<i> &quot;/etc/squid3/badsites.conf&quot;
</I>&gt;<i> 
</I>&gt;<i> http_access deny bad_url http_access allow ldapauth http_access
</I>&gt;<i> deny !existing_users deny_info 511:/var/www/html/info.php
</I>&gt;<i> existing_users
</I>&gt;<i> 
</I>
Regarding the 511 usage. It is intended for situations where
407/proxy-auth is not possible. When authentication has to be done
*entirely* by an external_acl_type helper, (eg  when intercepting
traffic).

The 407 message itself has essentially the same meaning as 511, but
triggers the client software to use proxy-auth headers in future
requests. Whereas 511 implies that something else (like cookies) are
being used to convey the credentials - but no HTTP level information
is contained about what that mechanism might actually be.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUPjvMAAoJELJo5wb/XPRjhj0H/jz9sSy2d9EQB4uQyy+7d6Rt
cGeZAo8MsgAuvT0V1p3H1a9HZrp5lmiIevs7dn3bpIXC22wMgjd0Tq0lp4coGw6R
a4ufSZrGdwEMB/9BNqsXW3rSncIQ2Dr4JfgPeM/dCkS2hDxo4XKWM8nOxDq9MEEX
7y3Q8t99Y7fV1VLnGeq1R1Dk6oZzku5veouLVxFaiiKWsQH3FKm7pbi8+5ridr4E
M4XPEUk9kMAqZ5Un9bpEEarbLYjD/xA5Cz1l7NPPZXr+sTK+brsi4ET7uo02Lh8+
B4K0BOHwt/Xu57zmjJhxJSIPw+PcFDdWKwghLc0z1X1DycPI59cBiidS0/sYgUk=
=kMPD
-----END PGP SIGNATURE-----

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000312.html">[squid-users] Unable to display splash page on inactive timeout
</A></li>
	<LI>Next message (by thread): <A HREF="000330.html">[squid-users] Unable to display splash page on inactive timeout
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#315">[ date ]</a>
              <a href="thread.html#315">[ thread ]</a>
              <a href="subject.html#315">[ subject ]</a>
              <a href="author.html#315">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
