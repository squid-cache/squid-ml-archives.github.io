<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Supported configuration for adding origin server IP in response header
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Supported%20configuration%20for%20adding%20origin%20server%0A%20IP%20in%20response%20header&In-Reply-To=%3C54401F44.7080408%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000345.html">
   <LINK REL="Next"  HREF="000347.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Supported configuration for adding origin server IP in response header</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Supported%20configuration%20for%20adding%20origin%20server%0A%20IP%20in%20response%20header&In-Reply-To=%3C54401F44.7080408%40treenet.co.nz%3E"
       TITLE="[squid-users] Supported configuration for adding origin server IP in response header">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Oct 16 19:40:52 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000345.html">[squid-users] Supported configuration for adding origin server IP	in response header
</A></li>
        <LI>Next message (by thread): <A HREF="000347.html">[squid-users] Supported configuration for adding origin server IP in response header
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#346">[ date ]</a>
              <a href="thread.html#346">[ thread ]</a>
              <a href="subject.html#346">[ subject ]</a>
              <a href="author.html#346">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 17/10/2014 8:10 a.m., Darren Spruell wrote:
&gt;<i> Had a use case to ask about, apologies if I missed in docs. Is
</I>&gt;<i> there a configuration that allows squid running as forward proxy to
</I>&gt;<i> add a custom response header containing the origin server IP
</I>&gt;<i> address that served the resource? Assuming no cache hierarchy.
</I>&gt;<i> 
</I>&gt;<i> In the event that the resource is served from cache, would be 
</I>&gt;<i> interesting if squid were able to track the IP address from which
</I>&gt;<i> the cached resource was originally retrieved to include in
</I>&gt;<i> responses. In the event that's not possible, then the IP address of
</I>&gt;<i> the cache itself as well as an indication that the resource was
</I>&gt;<i> served from cache rather than an upstream origin.
</I>&gt;<i> 
</I>&gt;<i> Most resources seem to cover including this information in the
</I>&gt;<i> access log, however I'm interested in having the data in the HTTP
</I>&gt;<i> response for this case.
</I>&gt;<i> 
</I>
IP address is not much useful in the response - any given machine has
multiple of those and they are also shared between anycast servers or
load balancers.

It is also a mistake to think of &quot;the&quot; server as being one machine. It
is becomming extremely popular to use CDN services these days. CDN are
reverse-proxy services in one form or another. So &quot;the&quot; server may be
a chain of servers on some path through a server farm.


1) The Via header is closest to what you are seeking. In responses it
contains each servers FQDN or an unique alias. It is supposed to
contain a record of the whole chain of machines the message traversed.
 - The problem is that a lot of admin disable it or strip it out of
the traffic. So you may get a proper chain or only what your proxy is
adding, with no easy way to identify missing chain data.


2) If the respone contains an Age: header then it has been cached.


3) Squid also adds X-Cache* headers indicating HIT/MISS status. But
those contain misinformation on REFRESH'd responses.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUQB9EAAoJELJo5wb/XPRjoWsIANzZ03aSY1nHb6p9pDXGSKmu
4klFIaQSRi5VKQn2pbZljzxfoAO3Ev3sQBdbyoXzw14cv4EKXA9l5Jj+Q/XjG8Lh
ab07tcdordERsmH3iUmSpgOwRxvBoEI5HKqeKli4S37JjHOnZ+l/oU2MYZ2LTyJ7
pmnCWOJURjLlPBfEWCzh8eI6M1c5v56kS77qINapjK3qVqoc7UO5wYUTEm/S6iSX
EhmsIxrkCH4K3lZo74Krz4/sBcDViSZpfYE9SZeKlq9pakSH3uH4PU9Jw1qHYm6P
KE7clU+5DNMm6q0YR6z0GE0vw/8xFFrWkCCxXagRF0dOlbgIfE75w0nyy4k+jTg=
=s0Ul
-----END PGP SIGNATURE-----

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000345.html">[squid-users] Supported configuration for adding origin server IP	in response header
</A></li>
	<LI>Next message (by thread): <A HREF="000347.html">[squid-users] Supported configuration for adding origin server IP in response header
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#346">[ date ]</a>
              <a href="thread.html#346">[ thread ]</a>
              <a href="subject.html#346">[ subject ]</a>
              <a href="author.html#346">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
