<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Supported configuration for adding origin server IP in response header
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Supported%20configuration%20for%20adding%20origin%20server%0A%20IP%20in%20response%20header&In-Reply-To=%3CCAKVSOJU2VzEYfdr9JwY7uyNy%3DRMUpXrm%3DP5%3DhGc8f3DDfVth-A%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000346.html">
   <LINK REL="Next"  HREF="000348.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Supported configuration for adding origin server IP in response header</H1>
    <B>Darren Spruell</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Supported%20configuration%20for%20adding%20origin%20server%0A%20IP%20in%20response%20header&In-Reply-To=%3CCAKVSOJU2VzEYfdr9JwY7uyNy%3DRMUpXrm%3DP5%3DhGc8f3DDfVth-A%40mail.gmail.com%3E"
       TITLE="[squid-users] Supported configuration for adding origin server IP in response header">phatbuckett at gmail.com
       </A><BR>
    <I>Thu Oct 16 20:29:23 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000346.html">[squid-users] Supported configuration for adding origin server IP in response header
</A></li>
        <LI>Next message (by thread): <A HREF="000348.html">[squid-users] Supported configuration for adding origin server IP in response header
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#347">[ date ]</a>
              <a href="thread.html#347">[ thread ]</a>
              <a href="subject.html#347">[ subject ]</a>
              <a href="author.html#347">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Oct 16, 2014 at 12:40 PM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:
&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i> Hash: SHA1
</I>&gt;<i>
</I>&gt;<i> On 17/10/2014 8:10 a.m., Darren Spruell wrote:
</I>&gt;&gt;<i> Had a use case to ask about, apologies if I missed in docs. Is
</I>&gt;&gt;<i> there a configuration that allows squid running as forward proxy to
</I>&gt;&gt;<i> add a custom response header containing the origin server IP
</I>&gt;&gt;<i> address that served the resource? Assuming no cache hierarchy.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In the event that the resource is served from cache, would be
</I>&gt;&gt;<i> interesting if squid were able to track the IP address from which
</I>&gt;&gt;<i> the cached resource was originally retrieved to include in
</I>&gt;&gt;<i> responses. In the event that's not possible, then the IP address of
</I>&gt;&gt;<i> the cache itself as well as an indication that the resource was
</I>&gt;&gt;<i> served from cache rather than an upstream origin.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Most resources seem to cover including this information in the
</I>&gt;&gt;<i> access log, however I'm interested in having the data in the HTTP
</I>&gt;&gt;<i> response for this case.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> IP address is not much useful in the response - any given machine has
</I>&gt;<i> multiple of those and they are also shared between anycast servers or
</I>&gt;<i> load balancers.
</I>
Usefulness (utility) is in the eye of the beholder. :)

&gt;<i> It is also a mistake to think of &quot;the&quot; server as being one machine. It
</I>&gt;<i> is becomming extremely popular to use CDN services these days. CDN are
</I>&gt;<i> reverse-proxy services in one form or another. So &quot;the&quot; server may be
</I>&gt;<i> a chain of servers on some path through a server farm.
</I>
In my case, those abstractions are not significant. The goal is
determining, for a client behind a forward proxy, can the proxy simply
inform the client of the IP address to which the proxy connected to
fetch the resource? The IP address is the key data element for this
case. Even with a CDN the IP address of the frontend is fine.

&gt;<i> 1) The Via header is closest to what you are seeking. In responses it
</I>&gt;<i> contains each servers FQDN or an unique alias. It is supposed to
</I>&gt;<i> contain a record of the whole chain of machines the message traversed.
</I>&gt;<i>  - The problem is that a lot of admin disable it or strip it out of
</I>&gt;<i> the traffic. So you may get a proper chain or only what your proxy is
</I>&gt;<i> adding, with no easy way to identify missing chain data.
</I>
I view the Via header as similar to the Received header in SMTP. In
this case it's added by other proxies/caches, correct? But I have no
cache hierarchy, and simply need the IP address of the origin server.
Squid knows what it is, because it opens a socket to it. It can filter
it with ACLs. It can log it in the access log.

Can it add it into a response header?

DS

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000346.html">[squid-users] Supported configuration for adding origin server IP in response header
</A></li>
	<LI>Next message (by thread): <A HREF="000348.html">[squid-users] Supported configuration for adding origin server IP in response header
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#347">[ date ]</a>
              <a href="thread.html#347">[ thread ]</a>
              <a href="subject.html#347">[ subject ]</a>
              <a href="author.html#347">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
