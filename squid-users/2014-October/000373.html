<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Central Proxy using WCCP to multiple sites in our network with ASA box.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Central%20Proxy%20using%20WCCP%20to%20multiple%20sites%20in%20our%0A%20network%20with%20ASA%20box.&In-Reply-To=%3C0091F25702DBCD438E9EB76FF2CF5204F7314954%40ngamil-exc02.nga.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000374.html">
   <LINK REL="Next"  HREF="000375.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Central Proxy using WCCP to multiple sites in our network with ASA box.</H1>
    <B>Luderitz Bob</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Central%20Proxy%20using%20WCCP%20to%20multiple%20sites%20in%20our%0A%20network%20with%20ASA%20box.&In-Reply-To=%3C0091F25702DBCD438E9EB76FF2CF5204F7314954%40ngamil-exc02.nga.local%3E"
       TITLE="[squid-users] Central Proxy using WCCP to multiple sites in our network with ASA box.">Bob.Luderitz at NiproGlassAmericas.com
       </A><BR>
    <I>Fri Oct 17 19:47:51 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000374.html">[squid-users] Ubuntu server 14.04 - Squid 3.3.8 - Active directory sync problem !
</A></li>
        <LI>Next message (by thread): <A HREF="000375.html">[squid-users] Central Proxy using WCCP to multiple sites in our network with ASA box.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#373">[ date ]</a>
              <a href="thread.html#373">[ thread ]</a>
              <a href="subject.html#373">[ subject ]</a>
              <a href="author.html#373">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>                I have one central Proxy Server running Squid 3.1.10 under CentOS 6.3 running locally here and also for our 2 remote sites for all http traffic.

                We are using Cisco's WCCP and between the remote sites and the Squid is a ASA box.

                where the Proxy is running Site A and one of the remote Site B.
                From either of the remote sites, when I try to access a printer or other web enabled device thru a browser that is not defined in squid.conf, I get access denied.
                This is strange to me as this request should be considered part of the internal network.
When I put statements in squid.conf for this print, I then get connection timed out.

                From the Squid server, I cannot ping this remote printer due to the static route has 0.0.0.0 as its gateway address.

                See the below config for one of the remote sites:

                In /etc/rc.local file:

                iptunnel add tun-cc mode gre remote 192.168.253.16 local 10.80.166.227 dev eth0
ip link set dev tun-cc up
ip route add 10.80.202.0/23 dev tun-cc metric 101

In squid.conf, this network should be considered internal:
acl nga_net src 10.80.0.0/16    # Internal network (I have tried splitting out the ACL statements but same result)

http_access allow nga_net

If I look at the static routes on the server (netstat -rn or route -v)
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface
1.2.3.0         0.0.0.0         255.255.255.0   U         0 0          0 gre0
10.80.166.0     0.0.0.0         255.255.255.0   U         0 0          0 eth0
10.80.202.0     0.0.0.0         255.255.254.0   U         0 0          0 tun-cc  (remote site)
0.0.0.0         10.80.166.254   0.0.0.0         UG        0 0          0 eth0

As you can see, the gateway for this remote site is the Internet (0.0.0.0) and thinking it should be 10.80.166.254.
When I try to change the gateway for this static route, I get message - RTNETLINK answers: File exists
If I remove the static route, I cannot get to any internal or Internet site from a remote site workstation.

Due to the ASA in the traffic path of the remote sites, there is a gre tunnel setup for outbound traffic from the Squid server, without the tunnel the packet would be dropped by the ASA box.

I know the best practices is to have a proxy server at each remote location, but this solution does work for most requests.
Has anyone else run into this and found a solution, thanks....

______________________________________________________

NIPRO GLASS
______________________________________________________

CAUTION  - This message may contain privileged and confidential information intended only for the use of the addressee named above. If you are not the intended recipient of this message you are hereby
notified  that  any  use,  dissemination, distribution or reproduction of this message is prohibited. If you have received this message in error please notify NIPRO GLASS
 immediately. Any views expressed in
this message are those of the individual sender and may not necessarily reflect the views of NIPRO GLASS.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20141017/ea2490c4/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20141017/ea2490c4/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000374.html">[squid-users] Ubuntu server 14.04 - Squid 3.3.8 - Active directory sync problem !
</A></li>
	<LI>Next message (by thread): <A HREF="000375.html">[squid-users] Central Proxy using WCCP to multiple sites in our network with ASA box.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#373">[ date ]</a>
              <a href="thread.html#373">[ thread ]</a>
              <a href="subject.html#373">[ subject ]</a>
              <a href="author.html#373">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
