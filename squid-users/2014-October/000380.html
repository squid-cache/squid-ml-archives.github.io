<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid, Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and 3.4.7.)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%2C%0A%20Kerberos%20and%20FireFox%20%28Was%3A%20Re%3A%20leaking%20memory%20in%20squid%203.4.8%20and%0A%203.4.7.%29&In-Reply-To=%3C20141018101116.GA77970%40admin.sibptus.tomsk.ru%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000358.html">
   <LINK REL="Next"  HREF="000382.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid, Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and 3.4.7.)</H1>
    <B>Victor Sudakov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%2C%0A%20Kerberos%20and%20FireFox%20%28Was%3A%20Re%3A%20leaking%20memory%20in%20squid%203.4.8%20and%0A%203.4.7.%29&In-Reply-To=%3C20141018101116.GA77970%40admin.sibptus.tomsk.ru%3E"
       TITLE="[squid-users] Squid, Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and 3.4.7.)">sudakov at sibptus.tomsk.ru
       </A><BR>
    <I>Sat Oct 18 10:11:16 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000358.html">[squid-users] Squid, Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and 3.4.7.)
</A></li>
        <LI>Next message (by thread): <A HREF="000382.html">[squid-users] Squid, Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and 3.4.7.)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#380">[ date ]</a>
              <a href="thread.html#380">[ thread ]</a>
              <a href="subject.html#380">[ subject ]</a>
              <a href="author.html#380">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Eugene M. Zheganin wrote:
&gt;<i> &gt;
</I>&gt;<i> &gt; I am attaching a traffic dump.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Please look at Frame No. 36, where a ticket is requested for
</I>&gt;<i> &gt; &quot;HTTP/proxy.sibptus.transneft.ru&quot;, and then at Frame No. 39, where
</I>&gt;<i> &gt; the ticket is granted, but for the wrong principal name.
</I>&gt;<i> &gt;
</I>&gt;<i> The thing is, valid exchange should not and does not contain the
</I>&gt;<i> KRB5KRB_AP_ERR_MODIFIED error, and yours does. 
</I>
I thought as much. This error seems suspicious. But why does a second
request not cause the same error?

&gt;<i> This indicates something
</I>&gt;<i> is wrong between these two hosts (as I understand, 10.14.134.4 is a
</I>&gt;<i> Windows Server, and .122 is a workstation). 
</I>
Correct.

&gt;<i> You need to investigate on
</I>&gt;<i> your DC what's happening, Probably these are the etype errors (may be
</I>&gt;<i> not). 
</I>
I will ask our Windows admin to enable Kerberos event logging. Maybe
we'll find something there.

The huge problem is the absence of legible diagnostics on the
squid's side (the helper or the Heimdal library produce very
hard-to-interpret and too generic debug output).

&gt;<i> If your DC is really w2k (not w2k3 or w2k8) 
</I>
Unfortunately, it is really w2k. 

&gt;<i> and the workstation is
</I>&gt;<i> of different generation, this can happen. 
</I>
The workstations are Windows XP and Windows 7, both giving mixed
results.

&gt;<i> Also, lots of howtos spread
</I>&gt;<i> around the Internet, make an engineer believe that he should kreate the
</I>&gt;<i> keytab with only one encryption type for squid, insted kreating the
</I>&gt;<i> keytab with all of available on the DC ciphers, This can also lead to
</I>&gt;<i> complicated situations.
</I>
We have tried both ways (enabling all ciphers and enabling only
arcfour-hmac-md5), but it made no difference. Currently we are using
the keytab with one arcfour-hmac-md5 key only:

Vno  Type              Principal
  1  arcfour-hmac-md5 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.sibptus.transneft.ru at SIBPTUS.TRANSNEFT.RU</A>

Which of the ways is correct, in your opinion? Could you repeat?

&gt;<i> 
</I>&gt;<i> There's also a decent article there:
</I>&gt;<i> <A HREF="http://blogs.technet.com/b/askds/archive/2008/06/11/kerberos-authentication-problems-service-principal-name-spn-issues-part-3.aspx">http://blogs.technet.com/b/askds/archive/2008/06/11/kerberos-authentication-problems-service-principal-name-spn-issues-part-3.aspx</A>
</I>
Thanks for the link. I guess it boils down to two possibilities:

1. There is a duplicate SPN somewhere in the forest, or

2. Replication problem between the DCs, the principal's passwords
don't match.

&gt;<i> 
</I>&gt;<i> Could help you as it did help me one day.
</I>
Which was your situation when the article helped?


-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">sudakov at sibptus.tomsk.ru</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000358.html">[squid-users] Squid, Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and 3.4.7.)
</A></li>
	<LI>Next message (by thread): <A HREF="000382.html">[squid-users] Squid, Kerberos and FireFox (Was: Re: leaking memory in squid 3.4.8 and 3.4.7.)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#380">[ date ]</a>
              <a href="thread.html#380">[ thread ]</a>
              <a href="subject.html#380">[ subject ]</a>
              <a href="author.html#380">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
