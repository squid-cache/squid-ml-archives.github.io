<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Question about compiling and loading ecap-adapter	module on windows
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Question%20about%20compiling%20and%20loading%20ecap-adapter%0A%09module%20on%20windows&In-Reply-To=%3C2014102116372046911247%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000415.html">
   <LINK REL="Next"  HREF="000419.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Question about compiling and loading ecap-adapter	module on windows</H1>
    <B>lionxyes at gmail.com</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Question%20about%20compiling%20and%20loading%20ecap-adapter%0A%09module%20on%20windows&In-Reply-To=%3C2014102116372046911247%40gmail.com%3E"
       TITLE="[squid-users] Question about compiling and loading ecap-adapter	module on windows">lionxyes at gmail.com
       </A><BR>
    <I>Tue Oct 21 08:38:16 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000415.html">[squid-users] Question about compiling and loading ecap-adapter module on windows
</A></li>
        <LI>Next message (by thread): <A HREF="000419.html">[squid-users] assertion failed: &quot;lm_request-&gt;waiting&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#417">[ date ]</a>
              <a href="thread.html#417">[ thread ]</a>
              <a href="subject.html#417">[ subject ]</a>
              <a href="author.html#417">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>There are some other message that may be helpful.
I used to configure squid to load ecap-adapter module as following on windows.

-------------------configure---------------------------
ecap_enable on 
adaptation_send_client_ip on 

loadable_modules /usr/local/lib/ecap_adapter_modifying.so 
ecap_service ecapModifier respmod_precache \ 
uri=<A HREF="ecap://e-cap.org/ecap/services/sample/modifying">ecap://e-cap.org/ecap/services/sample/modifying</A> \ 
victim=the \ 
replacement=a 
adaptation_access ecapModifier allow all
-----------------configure end ------------------------

then, when I run squid, i surely failed. Here is the error messages.

--------------------error message------------------------------
$ ./squid.exe -N -C -d1 
2014/10/20 23:33:26| WARNING cache_mem is larger than total disk cache space! 
2014/10/20 23:33:26| Starting Squid Cache version 3.3.3 for i686-pc-cygwin... 
2014/10/20 23:33:26| Process ID 3200 
2014/10/20 23:33:26| Process Roles: master worker 
2014/10/20 23:33:26| With 3072 file descriptors available 
2014/10/20 23:33:26| Initializing IP Cache... 
2014/10/20 23:33:26| DNS Socket created at [::], FD 4 
2014/10/20 23:33:26| DNS Socket created at 0.0.0.0, FD 5 
2014/10/20 23:33:26| Adding nameserver 8.8.8.8 from squid.conf 
2014/10/20 23:33:26| Logfile: opening log daemon:/var/log/squid/access.log 
2014/10/20 23:33:26| Logfile Daemon: opening log /var/log/squid/access.log 
2014/10/20 23:33:26| WARNING: no_suid: setuid(0): (22) Invalid argument 
2014/10/20 23:33:26| WARNING: no_suid: setuid(0): (22) Invalid argument 
2014/10/20 23:33:27| Unlinkd pipe opened on FD 11 
2014/10/20 23:33:27| Store logging disabled 
2014/10/20 23:33:27| Swap maxSize 102400 + 262144 KB, estimated 28041 objects 
2014/10/20 23:33:27| Target number of buckets: 1402 
2014/10/20 23:33:27| Using 8192 Store buckets 
2014/10/20 23:33:27| Max Mem size: 262144 KB 
2014/10/20 23:33:27| Max Swap size: 102400 KB 
2014/10/20 23:33:27| Rebuilding storage in /var/cache/squid (dirty log) 
2014/10/20 23:33:27| Using Least Load store dir selection 
2014/10/20 23:33:27| Set Current Directory to /var/cache/squid 
2014/10/20 23:33:27| Loaded Icons. 
2014/10/20 23:33:27| HTCP Disabled. 
2014/10/20 23:33:27| Loading Squid module from '/usr/local/lib/ecap_adapter_modifying.so' 
2014/10/20 23:33:27| FATAL: dying from an unhandled exception: %1 is not a valid Win32 application. 
terminate called after throwing an instance of 'TextException' 
what(): %1 is not a valid Win32 application. 
Aborted (core dumped) 
--------------------error message end-------------------------

So, I think that it is running natively on windows.

HDM1991


<A HREF="https://lists.squid-cache.org/listinfo/squid-users">lionxyes at gmail.com</A>
 
From: Amos Jeffries
Date: 2014-10-21 16:19
To: squid-users
Subject: Re: [squid-users] Question about compiling and loading ecap-adapter module on windows
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
On 21/10/2014 8:52 p.m., <A HREF="https://lists.squid-cache.org/listinfo/squid-users">lionxyes at gmail.com</A> wrote:
&gt;<i> 
</I>&gt;<i> Hi.  I&#8216;m coming again.
</I>&gt;<i> 
</I>&gt;<i> Now, I have compiled squid-3.3.3 with --enable-ecap option
</I>&gt;<i> successfully on cygwin and run it successfully on windows. But,
</I>&gt;<i> there are another question about compiling ecap-adapter module&#65311;
</I>&gt;<i> 
</I>&gt;<i> I'm not sure that I should ask this question here, maybe I should
</I>&gt;<i> ask eCAP developer. but I think that I should try it firstly.
</I> 
Probably. But I'll give this a try at answering...
 
&gt;<i> 
</I>&gt;<i> OK! Question 1:  Does it need compile ecap-adapter module as .dll
</I>&gt;<i> file if I want use ecap-adapter module on windows.
</I> 
If it is running natively on Windows, the answer is yes. If it is
running inside the cygwin environment (I suspect so) then the answer
might be no. The cygwin people maybe could help there.
 
 
&gt;<i> Question 2:  If it need, How to do it and do I shoud ask eCAP
</I>&gt;<i> developer? Now, when I compile ecap-adapter
</I>&gt;<i> module(ecap_adapter_sample-0.2.1.tar.gz) directly on cygwin. I just
</I>&gt;<i> get .a .la file. Here is some output message when I make it.
</I> 
IF its necessary the .dll parts should be done by your compiler tools
automatically. The error it produced gives a few obscure hints...
 
&gt;<i> 
</I>&gt;<i> ------------------------------------------------------output
</I>&gt;<i> message----------------------------------------------------------- 
</I>&gt;<i> Making all in src make[1]: Entering directory
</I>&gt;<i> '/usr/src/ecap_adapter_sample-0.2.1/src' make all-am make[2]:
</I>&gt;<i> Entering directory '/usr/src/ecap_adapter_sample-0.2.1/src' /bin/sh
</I>&gt;<i> ../libtool --tag=CXX --mode=compile g++ -DHAVE_CONFIG_H -I../src
</I>&gt;<i> -I/usr/local/include -g -O3 -Wall -Wwrite-strings
</I>&gt;<i> -Woverloaded-virtual -pipe -MT adapter_minimal.lo -MD -MP -MF
</I>&gt;<i> .deps/adapter_minimal.Tpo -c -o adapter_minimal.lo
</I>&gt;<i> adapter_minimal.cc libtool: compile: g++ -DHAVE_CONFIG_H -I../src
</I>&gt;<i> -I/usr/local/include -g -O3 -Wall -Wwrite-strings
</I>&gt;<i> -Woverloaded-virtual -pipe -MT adapter_minimal.lo -MD -MP -MF
</I>&gt;<i> .deps/adapter_minimal.Tpo -c adapter_minimal.cc -DDLL_EXPORT -DPIC
</I>&gt;<i> -o .libs/adapter_minimal.o libtool: compile: g++ -DHAVE_CONFIG_H
</I>&gt;<i> -I../src -I/usr/local/include -g -O3 -Wall -Wwrite-strings
</I>&gt;<i> -Woverloaded-virtual -pipe -MT adapter_minimal.lo -MD -MP -MF
</I>&gt;<i> .deps/adapter_minimal.Tpo -c adapter_minimal.cc -o
</I>&gt;<i> adapter_minimal.o &gt;/dev/null 2&gt;&amp;1 mv -f .deps/adapter_minimal.Tpo
</I>&gt;<i> .deps/adapter_minimal.Plo /bin/sh ../libtool --tag=CXX --mode=link
</I>&gt;<i> g++ -g -O3 -Wall -Wwrite-strings -Woverloaded-virtual -pipe -module
</I>&gt;<i> -avoid-version -L/usr/local/lib -lecap -o ecap_adapter_minimal.la
</I>&gt;<i> -rpath /usr/local/lib adapter_minimal.lo
</I>&gt;<i> 
</I>&gt;<i> *** Warning: This system can not link to static lib archive
</I>&gt;<i> /usr/local/lib/libecap.la. *** I have the capability to make that
</I>&gt;<i> library automatically link in when *** you link to this library.
</I>&gt;<i> But I can only do this if you have a *** shared version of the
</I>&gt;<i> library, which you do not appear to have. *** But as you try to
</I>&gt;<i> build a module library, libtool will still create *** a static
</I>&gt;<i> module, that should work as long as the dlopening application ***
</I>&gt;<i> is linked with the -dlopen flag to resolve symbols at runtime.
</I> 
So, what its saying is that the libecap.la was built with -static
compiler flag. But the app now being built requires it to be dynamic
instead.
 
If Squid is also built with the -dlopen flag (Squid should be) then
the above warning does not matter.
 
 
&gt;<i> libtool: link: warning: undefined symbols not allowed in
</I>&gt;<i> i686-pc-cygwin shared libraries
</I> 
This warning might be more problematic, but given its just a warning
and the earlier one said it was okay... in your place I would test the
run-time behaviour to see if its really broken.
 
HTH
Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)
 
iQEcBAEBAgAGBQJURhceAAoJELJo5wb/XPRjVcwIAJOmEMfuKIDltB4sZPvZaakH
t77AwURtHd7R/zO4yAWVchrxUlaLOGyx9u2lykwA+zH28e9rPd3ukNND6v/43F9U
xIzQtpW5BoGnYPWtviod8bVqkDqs7sueyxtdcn+AOuG4UXLAh+SD/6EF9c97/7h/
gZHyAHg08C0hQPokCTtXKhI9CiLzdh94cN7poWcQV//XZib4HL/NNC1e2fBZirZm
ab4aEt+e8Asr53T278pMZ5AriawUiIi4N6wIQbSB6+1r90JVjcuf3ISbnTBS7IN7
u1epMhVnMsZx8KhzCsmIvQC/aLXZD3uUpkzaSgXzZ5lQy+Hr5/M9Y6iB+QLmcpY=
=PnXT
-----END PGP SIGNATURE-----
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20141021/1273c849/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20141021/1273c849/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000415.html">[squid-users] Question about compiling and loading ecap-adapter module on windows
</A></li>
	<LI>Next message (by thread): <A HREF="000419.html">[squid-users] assertion failed: &quot;lm_request-&gt;waiting&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#417">[ date ]</a>
              <a href="thread.html#417">[ thread ]</a>
              <a href="subject.html#417">[ subject ]</a>
              <a href="author.html#417">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
