<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] 3.3.x -&gt; 3.4.x: huge performance regression
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%203.3.x%20-%3E%203.4.x%3A%20huge%20performance%20regression&In-Reply-To=%3C544A4AD5.6040804%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000464.html">
   <LINK REL="Next"  HREF="000478.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] 3.3.x -&gt; 3.4.x: huge performance regression</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%203.3.x%20-%3E%203.4.x%3A%20huge%20performance%20regression&In-Reply-To=%3C544A4AD5.6040804%40ngtech.co.il%3E"
       TITLE="[squid-users] 3.3.x -&gt; 3.4.x: huge performance regression">eliezer at ngtech.co.il
       </A><BR>
    <I>Fri Oct 24 12:49:25 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000464.html">[squid-users] 3.3.x -&gt; 3.4.x: huge performance regression
</A></li>
        <LI>Next message (by thread): <A HREF="000478.html">[squid-users] 3.3.x -&gt; 3.4.x: huge performance regression
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#465">[ date ]</a>
              <a href="thread.html#465">[ thread ]</a>
              <a href="subject.html#465">[ subject ]</a>
              <a href="author.html#465">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hey Eugene,

I will try to clear things out.
Any helper is an external software but each and every one of them
answers to a specific logic.
external_acl url_rewrite and store_id helpers works in one way while
authentication works in another.

To make the story short external_acl url_rewrite and store_id helpers
acquire a single line from squid via STDIN and responses to his own
STDOUT towards squid STDIN.
an example would be:
1 <A HREF="http://www.yahoo.com">http://www.yahoo.com</A> &quot;more things such as requester and others&quot;

The helper responses to this with a line such as:
1 ERR
or
1 OK &quot;more stuff&quot;

The above example applies only to squid 3.4 while in squid 3.3 this is
being used only on the external_acl interface.

In auth helpers there are couple &quot;stages&quot; that applies on each requests.
In external_acl and the similar interfaces the client do not need to
send any details for the helper to analyze else then these that exists
on each request.
Auth helpers has a logic that denies with request for more details.
NTLM specifically has overload on the whole process since it can have
3 stages against squid.
Kerberous has the benefit of only 2 stages against squid:
1 - request -&gt; denial
2 - request + credentials -&gt; denial or approval

Comparing NTLM to external_acl helpers it is very different.
But comparing Kerberous to external_acl it's almost similar.

If for example NTML + Kerberous + external_acl + others suffers from
the same issue while using only one of them at a time it will prove
that there is a specific direction to the issue.
But if Kerberous and NTLM differ it will prove that there are other
things in hand.

Another approach to test the issue is to write an ECAP or ICAP helper
that will implement the whole authentication logic.
This will also prove that the helpers code is broken in 3.4 compared
to 3.3.

There is also the comparison of basic authentication compared to NTLM
+ Keberous which is also important.

The squid team needs a testing environment for the issue for quite
some time.

Now that Victor Sudakov has used Kerberous instead of NTLM we might be
able to put some efforts and to pinpoint the issue.

All The Bests,
Eliezer

On 10/24/2014 03:18 PM, Eugene M. Zheganin wrote:
&gt;&gt;<i> see <A HREF="http://bugs.squid-cache.org/show_bug.cgi?id=3997">http://bugs.squid-cache.org/show_bug.cgi?id=3997</A>
</I>&gt;<i> There seems to be a large mix of terms, like &quot;external helper&quot; and 
</I>&gt;<i> &quot;external program&quot;. The ntlm_auth, which is external to squid and
</I>&gt;<i> part of the samba package, doesnt' change between version
</I>&gt;<i> uprgrades, so I don't see how it can be involved (and why replace
</I>&gt;<i> it with a fake helper ?). In the same time it's an authentication
</I>&gt;<i> helper. The squid_kerb_ldap, also known as
</I>&gt;<i> ext_kerberos_ldap_group_acl, is, indeed, an &quot;external acl&quot; helper,
</I>&gt;<i> but it has nothing to do with NTLM, as it doesn't use it. My 
</I>&gt;<i> opinion - this pr is flooded with error messages of almost any
</I>&gt;<i> kind, and it's very hard to see the point.
</I>&gt;<i> 
</I>&gt;<i> We need to understand what's happening to squid when it starts to
</I>&gt;<i> hit the 100% CPU usage, last time I saw this during the night
</I>&gt;<i> without any possible user traffic load.
</I>&gt;<i> 
</I>&gt;<i> Eugene.
</I>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUSkrVAAoJENxnfXtQ8ZQUp8UIAI2MUcnASF98RWQECoKFczS9
E7SWOZMjQQLIy80NAId9MdiZ79XPNTF6a1VaGcdP4cAc78XgNqk6NdBF0eFIKSgy
31W48GGt8p0spJ0o8+NVijV9O/2pGcIW8M3psbnYG/fcgAzWq4DLz9Q/tFTtHsIa
UzY56BMuSX1+0d2IeZSO2bXxEnOyiyAJKrQ96H/7tlg/9VV5mHOB7Py1b6G+O1YP
nU/+vj4GppHYOYwPdqX9MwKfXwHzFPLHGXdafIJT1/Ci1ApEWW+137PMrvG1uvg3
pzSF9amhAyBpAjIA1WRgoYb5gtUciK43K0EIXYkmZnmmuw3mEFOv4WWyDApFBgs=
=TLyW
-----END PGP SIGNATURE-----

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000464.html">[squid-users] 3.3.x -&gt; 3.4.x: huge performance regression
</A></li>
	<LI>Next message (by thread): <A HREF="000478.html">[squid-users] 3.3.x -&gt; 3.4.x: huge performance regression
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#465">[ date ]</a>
              <a href="thread.html#465">[ thread ]</a>
              <a href="subject.html#465">[ subject ]</a>
              <a href="author.html#465">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
