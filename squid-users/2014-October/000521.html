<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid restarting continuously the authenticator processes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20restarting%20continuously%20the%20authenticator%0A%20processes&In-Reply-To=%3C5450C915.3000200%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000520.html">
   <LINK REL="Next"  HREF="000522.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid restarting continuously the authenticator processes</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20restarting%20continuously%20the%20authenticator%0A%20processes&In-Reply-To=%3C5450C915.3000200%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid restarting continuously the authenticator processes">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Oct 29 11:01:41 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000520.html">[squid-users] Squid restarting continuously the authenticator	processes
</A></li>
        <LI>Next message (by thread): <A HREF="000522.html">[squid-users] Squid restarting continuously the authenticator processes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#521">[ date ]</a>
              <a href="thread.html#521">[ thread ]</a>
              <a href="subject.html#521">[ subject ]</a>
              <a href="author.html#521">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 29/10/2014 11:09 p.m., Claudio ML wrote:
&gt;<i> Hello all,
</I>&gt;<i> 
</I>&gt;<i> I have a strange problem with a SQUID proxy with the NTLM
</I>
The word is &quot;Squid&quot;, it is a name not an acronym.

&gt;<i> authentication. It randomly restarts the authenticator processes 
</I>&gt;<i> (restart maybe not the right term), as follows:
</I>&gt;<i> 
</I>
Randomly? no, when an authenticator dies/aborts Squid starts a
replacement one.

Question is why they are dying.

Perhapse you could start by indicating what version of Squid you are
using ?


&lt;snip&gt;
&gt;<i> 2014-10-29T10:45:02.649164+01:00 yel1swa208 squid[29306]: Starting
</I>&gt;<i> new ntlmauthenticator helpers... 2014-10-29T10:45:02.650165+01:00
</I>&gt;<i> yel1swa208 squid[29306]: helperOpenServers: Starting 1/800
</I>&gt;<i> 'ntlm_auth' processes
</I>&gt;<i> 
</I>&gt;<i> Not sure if is a result of this, but after 10-20 mins the
</I>&gt;<i> authentication process with ntlm slows down terribly (tested with
</I>&gt;<i> wbinfo -t), and the users have some serious problem with the
</I>&gt;<i> navigation.
</I>&gt;<i> 
</I>&gt;<i> Follows the relevant part of squid.conf:
</I>&gt;<i> 
</I>&gt;<i> # Ntlm Auth auth_param ntlm program /usr/bin/ntlm_auth 
</I>&gt;<i> --helper-protocol=squid-2.5-ntlmssp --debuglevel=0 auth_param ntlm
</I>&gt;<i> children 800 #auth param ntlm keep_alive off
</I>
That is the Samba helper, so any bugs inside it are Samba problems.

Squid for NTLM is just a &quot;dumb relay&quot; passing the HTTP request header
tokens to the helper(s) and relaying their responses back to the
client in HTTP reply headers.

There might still be bugs in the relaying logic though. But to me it
sounds like the helpers having issues.


&gt;<i> authenticate_ttl 3 hour authenticate_ip_ttl 3 hour
</I>&gt;<i> 
</I>&gt;<i> # Base Auth auth_param basic program /usr/bin/ntlm_auth 
</I>&gt;<i> --helper-protocol=squid-2.5-basic auth_param basic children 200 
</I>&gt;<i> auth_param basic realm Squid proxy-caching web server auth_param
</I>&gt;<i> basic credentialsttl 2 hours
</I>&gt;<i> 
</I>&gt;<i> And the relevant part of smb.conf:
</I>&gt;<i> 
</I>&gt;<i> allow trusted domains = Yes winbind nested groups = Yes wins server
</I>&gt;<i> = x.x.x.x winbind uid = 40000-90000000000000 winbind gid =
</I>&gt;<i> 4000-100000000000000 winbind use default domain = yes winbind enum
</I>&gt;<i> users = yes winbind enum groups = yes winbind cache time = 1000 
</I>&gt;<i> winbind max clients = 600
</I>

There is a big hint.

 max clients 600 vs. 800 configured Squid helpers ...

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUUMkVAAoJELJo5wb/XPRjsr8IAMRJ0xW3clhmqgGIOgwta4kD
YNE2BFdogelhmi/vVAH+wnNPRAo5tISiXgc5y3E5kvc60ibBIjJTJYsLHF2U88bn
pYhEX4Aw1pqZstVQzfFt4lNR1NQXAnzOtChQtphUGMEiywU6mVqS3KWiemp0fIwh
vSQCz6HCBgVBDN5K6wPDy1fyx2e+jzx0m9QL9Y6NxjdwEVD4nG/pHkh+HX0bQDzB
dRiaoavyZTB6SmSs1saCcd2p1LnKJ90Wgp7iv/Uuy0DNdhqzMe9DpVRIvitFMUTg
RLkcxMk6ORNKAjHH4rXya9Ct0XBjGCLXjxO9tBiS24uX819c5qyMtCjwBuLawX4=
=EqI3
-----END PGP SIGNATURE-----

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000520.html">[squid-users] Squid restarting continuously the authenticator	processes
</A></li>
	<LI>Next message (by thread): <A HREF="000522.html">[squid-users] Squid restarting continuously the authenticator processes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#521">[ date ]</a>
              <a href="thread.html#521">[ thread ]</a>
              <a href="subject.html#521">[ subject ]</a>
              <a href="author.html#521">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
