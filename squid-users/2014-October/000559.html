<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSL bump fails accessing .gov.uk servers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20bump%20fails%20accessing%20.gov.uk%20servers&In-Reply-To=%3C5453D304.7030909%40opendium.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000557.html">
   <LINK REL="Next"  HREF="000560.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSL bump fails accessing .gov.uk servers</H1>
    <B>Steve Hill</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20bump%20fails%20accessing%20.gov.uk%20servers&In-Reply-To=%3C5453D304.7030909%40opendium.com%3E"
       TITLE="[squid-users] SSL bump fails accessing .gov.uk servers">steve at opendium.com
       </A><BR>
    <I>Fri Oct 31 18:20:52 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000557.html">[squid-users] The Solution Of How to run squid with eCAP feature on	windows
</A></li>
        <LI>Next message (by thread): <A HREF="000560.html">[squid-users] SSL bump fails accessing .gov.uk servers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#559">[ date ]</a>
              <a href="thread.html#559">[ thread ]</a>
              <a href="subject.html#559">[ subject ]</a>
              <a href="author.html#559">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
This is probably not a problem with Squid, but I'm posting here in the
hope that someone may have more clue than me when it comes to SSL :)

When accessing <A HREF="https://www.taxdisc.service.gov.uk/">https://www.taxdisc.service.gov.uk/</A> through an SSL
bumping squid, I get:

-----
The following error was encountered while trying to retrieve the URL:
<A HREF="https://www.taxdisc.service.gov.uk/*">https://www.taxdisc.service.gov.uk/*</A>

    Failed to establish a secure connection to 62.25.101.198

The system returned:

    (71) Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)

    Handshake with SSL server failed: [No Error]
-----


Trying to connect with openssl directly also fails:

[<A HREF="https://lists.squid-cache.org/listinfo/squid-users">steve at atlantis</A> ~]$ openssl s_client -connect 62.25.101.198:443 -showcerts
CONNECTED(00000003)
140259944179584:error:140790E5:SSL routines:SSL23_WRITE:ssl handshake
failure:s23_lib.c:177:
---
no peer certificate available
---
No client certificate CA names sent
---
SSL handshake has read 0 bytes and written 249 bytes
---
New, (NONE), Cipher is (NONE)
Secure Renegotiation IS NOT supported
Compression: NONE
Expansion: NONE
---


If I force openssl into TLS1 mode (with the -tls1 argument) then it
works fine.  TLS 1.1 and 1.2 both fail.  However, shouldn't openssl be
negotiating the highest TLS version supported by both server and client?

It works correctly when FireFox connects directly to the web server
rather than going through the proxy.

So my question is: is the web server broken, or am I misunderstanding
something?

Many thanks.

-- 

 - Steve Hill
   Technical Director
   Opendium Limited     <A HREF="http://www.opendium.com">http://www.opendium.com</A>

Direct contacts:
   Instant messager: xmpp:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">steve at opendium.com</A>
   Email:            <A HREF="https://lists.squid-cache.org/listinfo/squid-users">steve at opendium.com</A>
   Phone:            sip:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">steve at opendium.com</A>

Sales / enquiries contacts:
   Email:            <A HREF="https://lists.squid-cache.org/listinfo/squid-users">sales at opendium.com</A>
   Phone:            +44-1792-825748 / sip:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">sales at opendium.com</A>

Support contacts:
   Email:            <A HREF="https://lists.squid-cache.org/listinfo/squid-users">support at opendium.com</A>
   Phone:            +44-1792-824568 / sip:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">support at opendium.com</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000557.html">[squid-users] The Solution Of How to run squid with eCAP feature on	windows
</A></li>
	<LI>Next message (by thread): <A HREF="000560.html">[squid-users] SSL bump fails accessing .gov.uk servers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#559">[ date ]</a>
              <a href="thread.html#559">[ thread ]</a>
              <a href="subject.html#559">[ subject ]</a>
              <a href="author.html#559">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
