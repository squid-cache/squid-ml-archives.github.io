<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSL bump fails accessing .gov.uk servers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20bump%20fails%20accessing%20.gov.uk%20servers&In-Reply-To=%3C54541690.9060206%40urlfilterdb.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000560.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSL bump fails accessing .gov.uk servers</H1>
    <B>Marcus Kool</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20bump%20fails%20accessing%20.gov.uk%20servers&In-Reply-To=%3C54541690.9060206%40urlfilterdb.com%3E"
       TITLE="[squid-users] SSL bump fails accessing .gov.uk servers">marcus.kool at urlfilterdb.com
       </A><BR>
    <I>Fri Oct 31 23:09:04 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000560.html">[squid-users] SSL bump fails accessing .gov.uk servers
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#562">[ date ]</a>
              <a href="thread.html#562">[ thread ]</a>
              <a href="subject.html#562">[ subject ]</a>
              <a href="author.html#562">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>With OpenSSL 1.0.1e-fips :

openssl s_client -connect www.taxdisc.service.gov.uk:443         fails (tries TLS1.2)
openssl s_client -connect www.taxdisc.service.gov.uk:443 -ssl3   works

The webmail server of my ISP works like this: it uses only TLS1.0, so no TLS1.1 or TLS1.2,
but when with
    openssl s_client -connect WEBMAIL:443 -tls1_2
the connection is automagically downgraded to TLS1.0.  taxdisc does not do this.
Taxdisc does not negotiate, so the client must guess the desired protocol (SSL3 or TLS1.0)
and use that.

I do not know all details about TLS and downgrading rules but the server seems broken to me.
Firefox knows how to deal with it and Squid not yet.

Marcus


On 10/31/2014 06:03 PM, Dieter Bloms wrote:
&gt;<i> Hi Steve,
</I>&gt;<i>
</I>&gt;<i> On Fri, Oct 31, Steve Hill wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> This is probably not a problem with Squid, but I'm posting here in the
</I>&gt;&gt;<i> hope that someone may have more clue than me when it comes to SSL :)
</I>&gt;<i>
</I>&gt;<i> ...
</I>&gt;<i>
</I>&gt;&gt;<i> If I force openssl into TLS1 mode (with the -tls1 argument) then it
</I>&gt;&gt;<i> works fine.  TLS 1.1 and 1.2 both fail.  However, shouldn't openssl be
</I>&gt;&gt;<i> negotiating the highest TLS version supported by both server and client?
</I>&gt;<i>
</I>&gt;<i> but when the server is broken, it will not work.
</I>&gt;<i> Have a look at:
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://www.ssllabs.com/ssltest/analyze.html?d=www.taxdisc.service.gov.uk">https://www.ssllabs.com/ssltest/analyze.html?d=www.taxdisc.service.gov.uk</A>
</I>&gt;<i>
</I>&gt;&gt;<i> It works correctly when FireFox connects directly to the web server
</I>&gt;&gt;<i> rather than going through the proxy.
</I>&gt;<i>
</I>&gt;<i> yes the browsers have a workaround and try with different cipher suites,
</I>&gt;<i> when the first connect fails.
</I>&gt;<i>
</I>&gt;&gt;<i> So my question is: is the web server broken, or am I misunderstanding
</I>&gt;&gt;<i> something?
</I>&gt;<i>
</I>&gt;<i> The webserver is broken.
</I>&gt;<i>
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000560.html">[squid-users] SSL bump fails accessing .gov.uk servers
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#562">[ date ]</a>
              <a href="thread.html#562">[ thread ]</a>
              <a href="subject.html#562">[ subject ]</a>
              <a href="author.html#562">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
