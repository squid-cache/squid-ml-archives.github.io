From ahmed.zaeem at netstream.ps  Mon Sep 29 19:00:30 2014
From: ahmed.zaeem at netstream.ps (Ahmd)
Date: Mon, 29 Sep 2014 21:00:30 +0200
Subject: [squid-users] squid bandwidth saving optimization for specific sites
Message-ID: <009b01cfdc17$a4b04e10$ee10ea30$@zaeem@netstream.ps>

 

Hi Guys ,

 

I have found that 60 % of my uses open about 4 common sites every day and
we can say that they are visited so much.

 

I began to think in a method to let squid to save the entire website since
it has a lot of visits.

 

Again  , here I want to save bandwidth as I can since the visits is a lot on
these sites.

 

I need a best practice for squid config that may help me.

 

Any ideas ?

 

regards

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20140929/150e4d13/attachment.htm>

From geekguy at geek-guy.com  Mon Sep 29 20:56:26 2014
From: geekguy at geek-guy.com (geekguy)
Date: Mon, 29 Sep 2014 13:56:26 -0700 (PDT)
Subject: [squid-users] squid bandwidth saving optimization for specific
	sites
In-Reply-To: <009b01cfdc17$a4b04e10$ee10ea30$@zaeem@netstream.ps>
References: <009b01cfdc17$a4b04e10$ee10ea30$@zaeem@netstream.ps>
Message-ID: <030c01cfdc27$c9053270$5b0f9750$@geek-guy.com>

Try my config:

http://www.lawrencepingree.com/2014/08/13/optimized-squid-conf-configuration
-for-squid-proxy-3-4-4/

 

From: Ahmd [via Squid Web Proxy Cache]
[mailto:ml-node+s1019090n4667562h82 at n4.nabble.com] 
Sent: Monday, September 29, 2014 10:59 AM
To: geekguy
Subject: squid bandwidth saving optimization for specific sites

 

 

Hi Guys ,

 

I have found that 60 % of my uses open about 4 common sites every day and
we can say that they are visited so much.

 

I began to think in a method to let squid to save the entire website since
it has a lot of visits.

 

Again  , here I want to save bandwidth as I can since the visits is a lot on
these sites.

 

I need a best practice for squid config that may help me.

 

Any ideas ?

 

regards

 

 


_______________________________________________ 
squid-users mailing list 
[hidden email] 
http://lists.squid-cache.org/listinfo/squid-users



  _____  

If you reply to this email, your message will be added to the discussion
below:

http://squid-web-proxy-cache.1019090.n4.nabble.com/squid-bandwidth-saving-op
timization-for-specific-sites-tp4667562.html 

To start a new topic under Squid - Users, email
ml-node+s1019090n1019091h81 at n4.nabble.com
<mailto:ml-node+s1019090n1019091h81 at n4.nabble.com>  
To unsubscribe from Squid - Users, click here
<http://squid-web-proxy-cache.1019090.n4.nabble.com/template/NamlServlet.jtp
?macro=unsubscribe_by_code&node=1019091&code=Z2Vla2d1eUBnZWVrLWd1eS5jb218MTA
xOTA5MXwtMTE0MTM3MTc2Mg==> .
 
<http://squid-web-proxy-cache.1019090.n4.nabble.com/template/NamlServlet.jtp
?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.n
amespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.vie
w.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail
.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aema
il.naml> NAML 





--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/squid-bandwidth-saving-optimization-for-specific-sites-tp4667562p4667563.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From geekguy at geek-guy.com  Mon Sep 29 21:02:15 2014
From: geekguy at geek-guy.com (geekguy)
Date: Mon, 29 Sep 2014 14:02:15 -0700 (PDT)
Subject: [squid-users] Nabble
Message-ID: <1412024535701-4667564.post@n4.nabble.com>

Hi there,
Ever since going to this nabble forum I keep getting unsubscribed. I'm not
sure why, I have had no warning nor am I aware of doing anything wrong. Can
anyone please help me understand what is going on??



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Nabble-tp4667564.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From nils at anonymox.net  Sat Sep 27 10:36:29 2014
From: nils at anonymox.net (=?UTF-8?B?Ik5pbHMgSMO8Z2VsbWFubiAoYW5vbnltb1gubmV0KSI=?=)
Date: Sat, 27 Sep 2014 12:36:29 +0200
Subject: [squid-users] Digest auth DENIED/407 for notexistant user
Message-ID: <5426932D.5090306@anonymox.net>

Hi,

In squid 3.4.7, when authenticating with an inexistant user, i get only
DENIED/407 replies. Instead of first 407 and then 403.

config:

auth_param digest program digest_file_auth /etc/passwd
auth_param digest realm anonymox.net

acl proxyauth_passed proxy_auth REQUIRED

http_access allow proxyauth_passed
http_access deny all


test request:

$ curl -x server:80 -I --proxy-digest -U asd:aqads http://google.com   
HTTP/1.1 407 Proxy Authentication Required
Server: squid/3.4.7
Mime-Version: 1.0
Date: Sat, 27 Sep 2014 10:32:29 GMT
Content-Type: text/html
Content-Length: 2997
X-Squid-Error: ERR_CACHE_ACCESS_DENIED 0
Vary: Accept-Language
Content-Language: en
Proxy-Authenticate: Digest realm="anonymox.net",
nonce="PZImVAAAAADwrX30ln8AABnVEEcAAAAA", qop="auth", stale=false
X-Cache: MISS from testproxy1
Via: 1.1 testproxy1 (squid/3.4.7)
Connection: keep-alive

HTTP/1.1 407 Proxy Authentication Required
Server: squid/3.4.7
Mime-Version: 1.0
Date: Sat, 27 Sep 2014 10:32:29 GMT
Content-Type: text/html
Content-Length: 3346
X-Squid-Error: ERR_CACHE_ACCESS_DENIED 0
Vary: Accept-Language
Content-Language: en
Proxy-Authenticate: Digest realm="anonymox.net",
nonce="PZImVAAAAABgnX30ln8AAB94ugUAAAAA", qop="auth", stale=false
X-Cache: MISS from testproxy1
Via: 1.1 testproxy1 (squid/3.4.7)
Connection: keep-alive

authhelper test (bundled unmodified digest_file_auth):

$ digest_file_auth /etc/passwd
"asd":"anonymox.net"
ERR message="No such user"

Anything i missed? Or should i file a bug?

-- 
Best Regards

Nils

anonymoX Team
http://www.anonymox.net/




From ajm.martinez at gmail.com  Mon Sep 29 09:39:32 2014
From: ajm.martinez at gmail.com (Alejandro Martinez)
Date: Mon, 29 Sep 2014 06:39:32 -0300
Subject: [squid-users] ERROR: URL-rewrite
Message-ID: <CAFEXmxiArT4zHR3qorfopPN6r5s08cYdctok-zvMsEyt+sXLKA@mail.gmail.com>

Hi

I'm geting this error in cache.log

ERROR: URL-rewrite produces invalid request: GET ERR HTTP1.0

This error gives me with squidGuard (1.4).

I have tested a simple redirector in php to check the new helper interface
(The actual version of squid is 3.3.13), and It gives me the same message

Squid Cache: Version 3.3.13
configure options:  '--enable-icmp' '--enable-delay-pools'
'--enable-icap-client' '--disable-wccp' '--disable-wccpv2' '--enable-ssl'
'--enable-forw-via-db' '--disable-epoll' '--disable-http-violations'
'--enable-linux-netfilter' '--enable-follow-x-forwarded-for'
'--enable-ssl-crtd' '--enable-url-rewrite-helpers'

the redirector code is this (code taken from squid site):

$temp = array();
stream_set_timeout(STDIN, 86400);

while ( $input = fgets(STDIN) ) {
  $temp = split(' ', $input);
  $url = $temp[0];
  if ( $url == "http://www.google.com" )
  {
     echo "OK rewrite-url=http://192.168.1.10/block.php \n";
  } else {
     echo "ERR \n";
  }
}

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20140929/68eb7b08/attachment.htm>

From eliezer at ngtech.co.il  Mon Sep 29 21:27:28 2014
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Tue, 30 Sep 2014 00:27:28 +0300
Subject: [squid-users] squid bandwidth saving optimization for specific
	sites
In-Reply-To: <"009b01cfdc17$a4b04e10$ee10ea30$@zaeem"@netstream.ps>
References: <"009b01cfdc17$a4b04e10$ee10ea30$@zaeem"@netstream.ps>
Message-ID: <5429CEC0.5060404@ngtech.co.il>

It really depends on the site.
If the site do not support caching since the content cannot be cached 
(dynamic) you probably cannot cache it.
If the site supports cache you can try to modify the refresh_pattern to 
tweak couple things about the traffic.

Can you share the website name?

Eliezer

On 09/29/2014 10:00 PM, Ahmd wrote:
> Hi Guys ,
>
> I have found that 60 % of my uses open about 4 common sites every day
> and  we can say that they are visited so much.
>
> I began to think in a method to let squid to save the entire website
> since it has a lot of visits.
>
> Again  , here I want to save bandwidth as I can since the visits is a
> lot on these sites.
>
> I need a best practice for squid config that may help me.
>
> Any ideas ?
>
> regards
>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>



From sudakov at sibptus.tomsk.ru  Tue Sep 30 02:11:50 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Tue, 30 Sep 2014 09:11:50 +0700
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <542952FB.9050600@ngtech.co.il>
References: <20140928062806.GA34166@admin.sibptus.tomsk.ru>
 <5427B9EC.6060500@ngtech.co.il> <5429209D.1050909@opendium.com>
 <542952FB.9050600@ngtech.co.il>
Message-ID: <20140930021150.GA82566@admin.sibptus.tomsk.ru>

> 
> Can you share the basic cache manager requests statistics and the up 
> time for the service?
> (mgr:info)
> 
> This would give us a basic idea of the load\requests needed to reproduce it.

I am not Steve but in case you care to look at my statistics as well,
I am attaching it.

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20140930/4ecc2e4d/attachment.htm>

From sudakov at sibptus.tomsk.ru  Tue Sep 30 02:28:59 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Tue, 30 Sep 2014 09:28:59 +0700
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <54291BB8.5020904@treenet.co.nz>
References: <20140928062806.GA34166@admin.sibptus.tomsk.ru>
 <5427C7E6.3070600@zhegan.in>
 <20140928091835.GA37229@admin.sibptus.tomsk.ru>
 <5427E97A.1020309@ngtech.co.il>
 <20140928124159.GA38727@admin.sibptus.tomsk.ru>
 <5428AA6B.1010201@treenet.co.nz>
 <20140929071652.GA60398@admin.sibptus.tomsk.ru>
 <54291BB8.5020904@treenet.co.nz>
Message-ID: <20140930022859.GA83414@admin.sibptus.tomsk.ru>

Amos Jeffries wrote:
> >>> 
> >>> I have tried looking at the cachemgr.cgi memory counters but
> >>> they are too numerous and cryptic for me.
> >> 
> >> Would you mind posting a copy of that mgr report? perhapse we can
> >> see something unusual.
> >> 
> > 
> > I am attaching two reports. The first one was taken right after
> > the squid restart. The second it several hours later when squid is
> > already 843M in size (610M RES).
> > 
> 
> You have 200 MB of RAM locked up in IDENT lookups.
> 
> Probably http://bugs.squid-cache.org/show_bug.cgi?id=3803

I have temporarily disabled IDENT-related acls. Squid still grows in
memory, but more slowly. So IDENT was certainly one of the major
causes of the leak.

Could we make another iteration of looking at the cachemgr.cgi memory
counters?


-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru


From squid3 at treenet.co.nz  Tue Sep 30 03:38:39 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 30 Sep 2014 16:38:39 +1300
Subject: [squid-users] ERROR: URL-rewrite
In-Reply-To: <CAFEXmxiArT4zHR3qorfopPN6r5s08cYdctok-zvMsEyt+sXLKA@mail.gmail.com>
References: <CAFEXmxiArT4zHR3qorfopPN6r5s08cYdctok-zvMsEyt+sXLKA@mail.gmail.com>
Message-ID: <542A25BF.7020202@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 29/09/2014 10:39 p.m., Alejandro Martinez wrote:
> Hi
> 
> I'm geting this error in cache.log
> 
> ERROR: URL-rewrite produces invalid request: GET ERR HTTP1.0
> 
> This error gives me with squidGuard (1.4).
> 
> I have tested a simple redirector in php to check the new helper
> interface (The actual version of squid is 3.3.13), and It gives me
> the same message
> 
> Squid Cache: Version 3.3.13 configure options:  '--enable-icmp'
> '--enable-delay-pools' '--enable-icap-client' '--disable-wccp'
> '--disable-wccpv2' '--enable-ssl' '--enable-forw-via-db'
> '--disable-epoll' '--disable-http-violations' 
> '--enable-linux-netfilter' '--enable-follow-x-forwarded-for' 
> '--enable-ssl-crtd' '--enable-url-rewrite-helpers'
> 
> the redirector code is this (code taken from squid site):
> 
> $temp = array(); stream_set_timeout(STDIN, 86400);
> 
> while ( $input = fgets(STDIN) ) { $temp = split(' ', $input); $url
> = $temp[0]; if ( $url == "http://www.google.com" ) { echo "OK
> rewrite-url=http://192.168.1.10/block.php \n"; } else { echo "ERR
> \n"; } }
> 
> Thanks

Squid-3.3 does not support new features added in Squid-3.4.
If you are going to test the new protocol, you need to test it with a
version of Squid that supports it.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUKiW/AAoJELJo5wb/XPRjH/cH/ApJlNMT34srQ0ZRsHZcLFHm
yFsKTudrxvx6w1BWCq05kHfTZjjK62TpeQeFX8nUcrSIysUJl6vgYOHt/7UX5SSM
15BEkqY3GE6lknV/LO9Xr44YMIhiVkU9J/U2DiKNi9SYzRzVOJLNzgXGljNJIt7t
fQENCxJF9Kry15+bQasf5apclCMsthiZ8dTszgrlBbcUCWrLrKuGicZrT8jC0J7C
kAhoHFbrcxQVUE8OS6IZJIeRh6MZi4QXh8Yi1hZNy3Cn3Y7Vdxx4wKvQzS7QtaSY
Kv6ppjhzaRGFOoIcr9EuWr6eviyRAXf+oulOJYUJTjnxzZAkkkrPk+x3tXFqybk=
=OE3x
-----END PGP SIGNATURE-----


From sudakov at sibptus.tomsk.ru  Tue Sep 30 05:33:26 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Tue, 30 Sep 2014 12:33:26 +0700
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <20140930022859.GA83414@admin.sibptus.tomsk.ru>
References: <20140928062806.GA34166@admin.sibptus.tomsk.ru>
 <5427C7E6.3070600@zhegan.in>
 <20140928091835.GA37229@admin.sibptus.tomsk.ru>
 <5427E97A.1020309@ngtech.co.il>
 <20140928124159.GA38727@admin.sibptus.tomsk.ru>
 <5428AA6B.1010201@treenet.co.nz>
 <20140929071652.GA60398@admin.sibptus.tomsk.ru>
 <54291BB8.5020904@treenet.co.nz>
 <20140930022859.GA83414@admin.sibptus.tomsk.ru>
Message-ID: <20140930053326.GA90693@admin.sibptus.tomsk.ru>

Victor Sudakov wrote:
> Amos Jeffries wrote:
> > 
> > You have 200 MB of RAM locked up in IDENT lookups.
> > 
> > Probably http://bugs.squid-cache.org/show_bug.cgi?id=3803
> 
> I have temporarily disabled IDENT-related acls. Squid still grows in
> memory, but more slowly. So IDENT was certainly one of the major
> causes of the leak.
> 
> Could we make another iteration of looking at the cachemgr.cgi memory
> counters?
> 

Attaching two cachemgr reports: right after squid restart and several
hours later (grown to 816M in SIZE).

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-------------- next part --------------
A non-text attachment was scrubbed...
Name: squid_mem.zip
Type: application/zip
Size: 9748 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20140930/0146fbf7/attachment.zip>

From nam.nh at nd24.net  Tue Sep 30 08:17:55 2014
From: nam.nh at nd24.net (Neddy, NH. Nam)
Date: Tue, 30 Sep 2014 15:17:55 +0700
Subject: [squid-users] Squid-cache.org won't redirect to www.squid-cache.org?
Message-ID: <CAA44a74oDLoTpjdFKHwiyVGLk7O4DD1cFkV0Bt+_A1NbqaU7Tg@mail.gmail.com>

Hi,

I "accidentally" access squid-cache.org and get 403 Forbidden error,
and am wondering why NOT redirect to WWW.squid-cache.org
automatically?

I'm sorry if it's intention.
~Ned


From squid at visolve.com  Tue Sep 30 08:42:10 2014
From: squid at visolve.com (Visolve Squid)
Date: Tue, 30 Sep 2014 14:12:10 +0530
Subject: [squid-users] Squid-cache.org won't redirect to
	www.squid-cache.org?
In-Reply-To: <CAA44a74oDLoTpjdFKHwiyVGLk7O4DD1cFkV0Bt+_A1NbqaU7Tg@mail.gmail.com>
References: <CAA44a74oDLoTpjdFKHwiyVGLk7O4DD1cFkV0Bt+_A1NbqaU7Tg@mail.gmail.com>
Message-ID: <542A6CE2.3050204@visolve.com>

Hi,

The http://www.squid-cache.org/ domain web site is working fine.

We have accessed the site a min ago.

Regards,
ViSolve Squid

On 9/30/2014 1:47 PM, Neddy, NH. Nam wrote:
> Hi,
>
> I "accidentally" access squid-cache.org and get 403 Forbidden error,
> and am wondering why NOT redirect to WWW.squid-cache.org
> automatically?
>
> I'm sorry if it's intention.
> ~Ned
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From d.shylenko at global-it.com.ua  Tue Sep 30 08:45:50 2014
From: d.shylenko at global-it.com.ua (=?UTF-8?Q?=D0=94=D0=BC=D0=B8=D1=82=D1=80=D0=B8=D0=B9_=D0=A8=D0=B8?= =?UTF-8?Q?=D0=BB=D0=B5=D0=BD=D0=BA=D0=BE?=)
Date: Tue, 30 Sep 2014 11:45:50 +0300
Subject: [squid-users]
 =?utf-8?q?Squid-cache=2Eorg_won=27t_redirect_to_www?=
 =?utf-8?q?=2Esquid-cache=2Eorg=3F?=
In-Reply-To: <542A6CE2.3050204@visolve.com>
References: <CAA44a74oDLoTpjdFKHwiyVGLk7O4DD1cFkV0Bt+_A1NbqaU7Tg@mail.gmail.com>
 <542A6CE2.3050204@visolve.com>
Message-ID: <f32d7efc4ca707a3f275a06ce2fcf67c@global-it.com.ua>

without "www.*"  -->> Forbidden You don't have permission to access / on this 
server.

Visolve Squid ????? 30.09.2014 11:42:
> Hi,
> 
> The http://www.squid-cache.org/ domain web site is working fine.
> 
> We have accessed the site a min ago.
> 
> Regards,
> ViSolve Squid
> 
> On 9/30/2014 1:47 PM, Neddy, NH. Nam wrote:
>> Hi,
>> 
>> I "accidentally" access squid-cache.org and get 403 Forbidden error,
>> and am wondering why NOT redirect to WWW.squid-cache.org
>> automatically?
>> 
>> I'm sorry if it's intention.
>> ~Ned
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
  ? ??. ??????? ???????
  ????????? ???????
  global-it.com.ua
  ???. (063)142-32-59
  ???? 221-72-55


From ammdispose-squid at yahoo.com  Tue Sep 30 08:49:34 2014
From: ammdispose-squid at yahoo.com (Amm)
Date: Tue, 30 Sep 2014 14:19:34 +0530
Subject: [squid-users] Squid-cache.org won't redirect to
	www.squid-cache.org?
In-Reply-To: <f32d7efc4ca707a3f275a06ce2fcf67c@global-it.com.ua>
References: <CAA44a74oDLoTpjdFKHwiyVGLk7O4DD1cFkV0Bt+_A1NbqaU7Tg@mail.gmail.com>
 <542A6CE2.3050204@visolve.com>
 <f32d7efc4ca707a3f275a06ce2fcf67c@global-it.com.ua>
Message-ID: <542A6E9E.2020805@yahoo.com>

I had pointed this out few months back but I suppose it was not 
corrected or not considered necessary.

Amm.

On 09/30/2014 02:15 PM, ??????? ??????? wrote:
> without "www.*"  -->> Forbidden You don't have permission to access / 
> on this server.
>
> Visolve Squid ????? 30.09.2014 11:42:
>> Hi,
>>
>> The http://www.squid-cache.org/ domain web site is working fine.
>>
>> We have accessed the site a min ago.
>>
>> Regards,
>> ViSolve Squid
>>
>> On 9/30/2014 1:47 PM, Neddy, NH. Nam wrote:
>>> Hi,
>>>
>>> I "accidentally" access squid-cache.org and get 403 Forbidden error,
>>> and am wondering why NOT redirect to WWW.squid-cache.org
>>> automatically?
>>>
>>> I'm sorry if it's intention.
>>> ~Ned
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>



From james at ejbdigital.com.au  Tue Sep 30 09:40:19 2014
From: james at ejbdigital.com.au (James Harper)
Date: Tue, 30 Sep 2014 09:40:19 +0000
Subject: [squid-users] Squid-cache.org won't redirect to
 www.squid-cache.org?
In-Reply-To: <f32d7efc4ca707a3f275a06ce2fcf67c@global-it.com.ua>
References: <CAA44a74oDLoTpjdFKHwiyVGLk7O4DD1cFkV0Bt+_A1NbqaU7Tg@mail.gmail.com>
 <542A6CE2.3050204@visolve.com>
 <f32d7efc4ca707a3f275a06ce2fcf67c@global-it.com.ua>
Message-ID: <6f51b3fb05be40e0babab6d24b509ba3@SIXPR04MB304.apcprd04.prod.outlook.com>

> 
> without "www.*"  -->> Forbidden You don't have permission to access / on
> this
> server.
> 

Some browsers (Chrome?) will "help" by prepending www on the front for you... if you type just "squid-cache.org" it will turn it into http://www.squid-cache.org and you won't see the problem. Maybe this only happens if you have previously visited www.squid-cache.org, or maybe it tests squid-cache.org first... not sure exactly.

If you type http://squid-cache.org you will see what the OP means.

James

From gkinkie at gmail.com  Tue Sep 30 09:43:27 2014
From: gkinkie at gmail.com (Kinkie)
Date: Tue, 30 Sep 2014 11:43:27 +0200
Subject: [squid-users] Squid-cache.org won't redirect to
	www.squid-cache.org?
In-Reply-To: <542A6E9E.2020805@yahoo.com>
References: <CAA44a74oDLoTpjdFKHwiyVGLk7O4DD1cFkV0Bt+_A1NbqaU7Tg@mail.gmail.com>
 <542A6CE2.3050204@visolve.com>
 <f32d7efc4ca707a3f275a06ce2fcf67c@global-it.com.ua>
 <542A6E9E.2020805@yahoo.com>
Message-ID: <CA+Y8hcP1H-Y_RR9=C9x07EZz5RAZdXK=sZ8QkcYxdmj5_LNnsQ@mail.gmail.com>

Hi,
  It is one of the unfortunate side effects of the main server dying. The
sysadmins are working hard to restore services but our manpower is limited
so we have to prioritize.
Feel free to submit a but to the bugzilla database so it is not forgotten.
If you wish to help out,  please consider donating to the Squid Software
Foundation (see the "donate" page on the main site) or to join the
sysadmins team (contact me if you are interested). We are working hard to
ensure that such an outage never happens again.
On Sep 30, 2014 10:50 AM, "Amm" <ammdispose-squid at yahoo.com> wrote:

> I had pointed this out few months back but I suppose it was not corrected
> or not considered necessary.
>
> Amm.
>
> On 09/30/2014 02:15 PM, ??????? ??????? wrote:
>
>> without "www.*"  -->> Forbidden You don't have permission to access / on
>> this server.
>>
>> Visolve Squid ????? 30.09.2014 11:42:
>>
>>> Hi,
>>>
>>> The http://www.squid-cache.org/ domain web site is working fine.
>>>
>>> We have accessed the site a min ago.
>>>
>>> Regards,
>>> ViSolve Squid
>>>
>>> On 9/30/2014 1:47 PM, Neddy, NH. Nam wrote:
>>>
>>>> Hi,
>>>>
>>>> I "accidentally" access squid-cache.org and get 403 Forbidden error,
>>>> and am wondering why NOT redirect to WWW.squid-cache.org
>>>> automatically?
>>>>
>>>> I'm sorry if it's intention.
>>>> ~Ned
>>>> _______________________________________________
>>>> squid-users mailing list
>>>> squid-users at lists.squid-cache.org
>>>> http://lists.squid-cache.org/listinfo/squid-users
>>>>
>>>
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users
>>>
>>
>>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20140930/f3deca52/attachment.htm>

From nam.nh at nd24.net  Tue Sep 30 09:51:07 2014
From: nam.nh at nd24.net (Neddy, NH. Nam)
Date: Tue, 30 Sep 2014 16:51:07 +0700
Subject: [squid-users] Squid-cache.org won't redirect to
	www.squid-cache.org?
In-Reply-To: <6f51b3fb05be40e0babab6d24b509ba3@SIXPR04MB304.apcprd04.prod.outlook.com>
References: <CAA44a74oDLoTpjdFKHwiyVGLk7O4DD1cFkV0Bt+_A1NbqaU7Tg@mail.gmail.com>
 <542A6CE2.3050204@visolve.com>
 <f32d7efc4ca707a3f275a06ce2fcf67c@global-it.com.ua>
 <6f51b3fb05be40e0babab6d24b509ba3@SIXPR04MB304.apcprd04.prod.outlook.com>
Message-ID: <CAA44a769gGTb1rErVtCEE787d49e3RMorQLB9V6N6h==y2caMg@mail.gmail.com>

I've used Chrome 38 and Firefox 32 when open squid-cache.org and it
returns the same 403 Error.

On Tue, Sep 30, 2014 at 4:40 PM, James Harper <james at ejbdigital.com.au> wrote:
>>
>> without "www.*"  -->> Forbidden You don't have permission to access / on
>> this
>> server.
>>
>
> Some browsers (Chrome?) will "help" by prepending www on the front for you... if you type just "squid-cache.org" it will turn it into http://www.squid-cache.org and you won't see the problem. Maybe this only happens if you have previously visited www.squid-cache.org, or maybe it tests squid-cache.org first... not sure exactly.
>
> If you type http://squid-cache.org you will see what the OP means.
>
> James
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From eliezer at ngtech.co.il  Tue Sep 30 10:38:18 2014
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Tue, 30 Sep 2014 13:38:18 +0300
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <20140930021150.GA82566@admin.sibptus.tomsk.ru>
References: <20140928062806.GA34166@admin.sibptus.tomsk.ru>
 <5427B9EC.6060500@ngtech.co.il> <5429209D.1050909@opendium.com>
 <542952FB.9050600@ngtech.co.il>
 <20140930021150.GA82566@admin.sibptus.tomsk.ru>
Message-ID: <542A881A.3000307@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 09/30/2014 05:11 AM, Victor Sudakov wrote:
>> 
>> Can you share the basic cache manager requests statistics and the
>> up time for the service? (mgr:info)
>> 
>> This would give us a basic idea of the load\requests needed to
>> reproduce it.
> 
> I am not Steve but in case you care to look at my statistics as
> well, I am attaching it.
> 
OK.

The basic info states that the server is up for about 10+ hours.
and passed in this period of time: 152054 request which is about
230-253 per minute.

The cache is holding more then 20k objects and maximizing it's ram
memory usage (less 0.6%).
Considering that you are using 128MB for ram storage the service
should be considered 128MB used as more then normal.
In the log it states that the accounted memory:
403163 KB which is about 390MB in usage.
390 -128 = 262
so the only issue is about 250-260 MB which are being used and not for
cache.
the basic usage of squid is about 3MB if i'm not wrong but there are
operational needs such as buffers and in transit stuff.
So 255 MB to think about..
500 FD which means about 300-350 connections doubles 64kb.
then it's about 13-14 MB for in transit stuff.
So there is about 241 MB which needs to be justified.

These are the basics.

Eliezer
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUKogaAAoJENxnfXtQ8ZQU/pUIAIh2Q1687fXSTsiUCO0jlnyO
NOD7F250EcppFwrQ4GPzDvRiNWUhzJSVzncAzJWlgQbWmoCnsvwB0C7MUN6bSOBf
ek0qmJi1m/xz1ePVFI1u1k/PfC4t2FTC8XM2zICSQKSkHIlV06EPNd5Km954bIYP
C7kzSl9CHl34v3179S22rEt1hej4Q3FEVayvoATrrPdrmyWLE2lICJYFxqGEIPK4
ivzxdcpdVovR2AwCHeDqXrTB/wTrYaZz1TQWUZScCmPibd1oqGXd3gHefE1aOMwS
ZsuBUZLfiTmaezBBeEqq8P3oWLIBh2mU1m4JogUbDixkrLpi4GaIFk+TIp9CTNw=
=e8AJ
-----END PGP SIGNATURE-----


From eliezer at ngtech.co.il  Tue Sep 30 11:04:56 2014
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Tue, 30 Sep 2014 14:04:56 +0300
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <20140930053326.GA90693@admin.sibptus.tomsk.ru>
References: <20140928062806.GA34166@admin.sibptus.tomsk.ru>
 <5427C7E6.3070600@zhegan.in> <20140928091835.GA37229@admin.sibptus.tomsk.ru>
 <5427E97A.1020309@ngtech.co.il>
 <20140928124159.GA38727@admin.sibptus.tomsk.ru>
 <5428AA6B.1010201@treenet.co.nz>
 <20140929071652.GA60398@admin.sibptus.tomsk.ru>
 <54291BB8.5020904@treenet.co.nz>
 <20140930022859.GA83414@admin.sibptus.tomsk.ru>
 <20140930053326.GA90693@admin.sibptus.tomsk.ru>
Message-ID: <542A8E58.3010704@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 09/30/2014 08:33 AM, Victor Sudakov wrote:
> Attaching two cachemgr reports: right after squid restart and
> several hours later (grown to 816M in SIZE).
I am not very good at calculating what I do not know how to yet!
What I do understand is that "Cumulative allocated volume: 22.198 GB"
means that this is what was used ever by squid for this uptime.
Since I am not such a good calculator and the data exists already lets
lets try and see the next output of:
mgr:mem
mgr:info
and "top -n 1 -b|egrep "proxy|squid|PID""

Which should give a nice output of the squid process memory consumption.

Thanks,
Eliezer

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUKo5YAAoJENxnfXtQ8ZQUaA4H/2wEiismAH8PnrrkH6BdZ4Y/
m64kSlM2uyVB+dOdNqaH2Ftm+QLRQxKzFvaWp6dmA5Ih3C8rxt1tBD4ZAW9BwXJp
SVynocW44iXr/8aboIjmph4ojo9PVSuiZ87XrRB+jHC+K1YUpnNOWdmSYVEE/apx
xWt9wONllmHUqISy4C1CFhbZxeyweGsRMYzwWzgR76gDDTmw7oCZsp48H8s/aE7c
qchNNWCKmXqtHKyhFPobJpRvy4uAt5Xx8RxaHva46qF3EEWRDWM1Hcl4c26YkPVw
88hylHuz1JB4LCeG0g4Kxcs4AOnEHgqfXWtgpPwGevoHq64ytiVnBGI/o8bp/Dc=
=kI7u
-----END PGP SIGNATURE-----


From eliezer at ngtech.co.il  Tue Sep 30 11:13:25 2014
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Tue, 30 Sep 2014 14:13:25 +0300
Subject: [squid-users] ERROR: URL-rewrite
In-Reply-To: <CAFEXmxiArT4zHR3qorfopPN6r5s08cYdctok-zvMsEyt+sXLKA@mail.gmail.com>
References: <CAFEXmxiArT4zHR3qorfopPN6r5s08cYdctok-zvMsEyt+sXLKA@mail.gmail.com>
Message-ID: <542A9055.9090207@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hey Alejandro,

Can I ask where in the site have you taken this code from?
Using php as a helper is not such a good choice due to couple issues
it has with squid "stdin\stdout" emulation.

You'd better use perl\python\ruby\other then php unless you found a
solution to a bug that php developers consider a feature.

Also only squid 3.4 uses the "OK rewrite-url=XYZ" format and "ERR"
in squid 3.3 you use either a "http://xyz" as it is or
"302:http://xyz" for a redirection and a blank line "" for no change.

All The Bests,
Eliezer

On 09/29/2014 12:39 PM, Alejandro Martinez wrote:
> the redirector code is this (code taken from squid site):
> 
> $temp = array(); stream_set_timeout(STDIN, 86400);
> 
> while ( $input = fgets(STDIN) ) { $temp = split(' ', $input); $url
> = $temp[0]; if ( $url == "http://www.google.com" ) { echo "OK
> rewrite-url=http://192.168.1.10/block.php \n"; } else { echo "ERR
> \n"; } }
> 
> Thanks

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUKpBVAAoJENxnfXtQ8ZQUqu8H/ifHq2l8BrrSb5JIo7xf4ijw
1jRbFt37ApmrEFMmaiZVErEvAyi8miHqjmlgeLLA+efXydCIISbBZHOsDdOima+3
gshG9gaceJ54zP0dGiPL1pCRioGY16R2JQh7nhWz/scSEVcmB1UQ4bHmrkpsJ9Y2
OHwf/cuSGbYXtgzHsavDmNYdUp+UpJ0KtoealP35UmqizRW5OSA4YqusEPwxG1oj
HRqHocPE9Lb0BMIkBjZDbWs9DMRYAvx6p5JJaCB0VpwpXBa8oIMB5Fke6AjoAwBn
5k9nWo2myvQ+raa1WHldJF7xaUbFNVB2VFDt3Rw48PEVP+YJKIjlAZWpXzuZcnI=
=XWQb
-----END PGP SIGNATURE-----


From sudakov at sibptus.tomsk.ru  Tue Sep 30 12:24:30 2014
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Tue, 30 Sep 2014 19:24:30 +0700
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <542A8E58.3010704@ngtech.co.il>
References: <5427C7E6.3070600@zhegan.in>
 <20140928091835.GA37229@admin.sibptus.tomsk.ru>
 <5427E97A.1020309@ngtech.co.il>
 <20140928124159.GA38727@admin.sibptus.tomsk.ru>
 <5428AA6B.1010201@treenet.co.nz>
 <20140929071652.GA60398@admin.sibptus.tomsk.ru>
 <54291BB8.5020904@treenet.co.nz>
 <20140930022859.GA83414@admin.sibptus.tomsk.ru>
 <20140930053326.GA90693@admin.sibptus.tomsk.ru>
 <542A8E58.3010704@ngtech.co.il>
Message-ID: <20140930122430.GB4168@admin.sibptus.tomsk.ru>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Eliezer Croitoru wrote:
> > Attaching two cachemgr reports: right after squid restart and
> > several hours later (grown to 816M in SIZE).
> I am not very good at calculating what I do not know how to yet!
> What I do understand is that "Cumulative allocated volume: 22.198 GB"
> means that this is what was used ever by squid for this uptime.
> Since I am not such a good calculator and the data exists already lets
> lets try and see the next output of:
> mgr:mem
> mgr:info

I have already restarted squid several times since I obtained the
reports attached to the previous mail. The mgr:mem and mgr:info info
reports don't have to be from the same process, do they?

And is there a way to obtain mgr:info etc from the command line, not
from a browser?

> and "top -n 1 -b|egrep "proxy|squid|PID""
> Which should give a nice output of the squid process memory consumption.

- -- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:sudakov at sibptus.tomsk.ru
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUKqD+AAoJEA2k8lmbXsY0IP4H/2IjJUN4Gi7h0L58W3RvEthQ
8qkR7KoAKQHpeJ/BAQLehUM5W3M4DInJvxezfjrJIo6tS1UgzsoB9Gv012YcHU7J
JwQi/8zofnw4kjLeXnEJrIh4yTl5u46zQQARG+iyDjd1oRr4AMtO8zu84+gz1oc8
18Dsyjt5g9HV2ErsCkmSmKpIIVo/sU/PBj3Wsa4g386FCBMB7UkzRP3TrnwqFbgc
vrEZ3xKfZHm7AB16L7gURw64kp1Rs26rdcm4JVnkzlMrYziAZmWfZcQeeJILAFmM
wLwOdQLj19OFpxS5wfo/L1yux3oLcBxLS15Rdw8w+RoYptWFPeSY/pfD5Er4Mzo=
=Tjgd
-----END PGP SIGNATURE-----


From fuskbyggehbg at gmail.com  Tue Sep 30 12:45:56 2014
From: fuskbyggehbg at gmail.com (Mr C K)
Date: Tue, 30 Sep 2014 14:45:56 +0200
Subject: [squid-users] 301 Error in squid -> followed by 302
Message-ID: <CA+wGmzOEUypKdyO=_psYO2e+FxttKj9-QE-=7jCrL7keDOnOcA@mail.gmail.com>

When i use squid and get headers like,

HTTP/1.1 301 Moved Permanently
Location: http://www.hotmail.com/

squid ends up in a endless loop.

ERR_TOO_MANY_REDIRECTS

Some say to use u url_rewriter or location_rewrite, but how and where
to read more about this.

or is it that simple that squid can't handle this type of redirect?

/Mr Cincinati


From squid3 at treenet.co.nz  Tue Sep 30 13:10:30 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 01 Oct 2014 02:10:30 +1300
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <20140930122430.GB4168@admin.sibptus.tomsk.ru>
References: <5427C7E6.3070600@zhegan.in>
 <20140928091835.GA37229@admin.sibptus.tomsk.ru>
 <5427E97A.1020309@ngtech.co.il>
 <20140928124159.GA38727@admin.sibptus.tomsk.ru>
 <5428AA6B.1010201@treenet.co.nz>
 <20140929071652.GA60398@admin.sibptus.tomsk.ru>
 <54291BB8.5020904@treenet.co.nz>
 <20140930022859.GA83414@admin.sibptus.tomsk.ru>
 <20140930053326.GA90693@admin.sibptus.tomsk.ru>
 <542A8E58.3010704@ngtech.co.il>
 <20140930122430.GB4168@admin.sibptus.tomsk.ru>
Message-ID: <542AABC6.1010005@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 1/10/2014 1:24 a.m., Victor Sudakov wrote:
> Eliezer Croitoru wrote:
>>> Attaching two cachemgr reports: right after squid restart and 
>>> several hours later (grown to 816M in SIZE).
>> I am not very good at calculating what I do not know how to yet! 
>> What I do understand is that "Cumulative allocated volume: 22.198
>> GB" means that this is what was used ever by squid for this
>> uptime. Since I am not such a good calculator and the data exists
>> already lets lets try and see the next output of: mgr:mem 
>> mgr:info
> 
> I have already restarted squid several times since I obtained the 
> reports attached to the previous mail. The mgr:mem and mgr:info
> info reports don't have to be from the same process, do they?

Yes, its preferrable that they are from the same process as close to
the same time as possible.

> 
> And is there a way to obtain mgr:info etc from the command line,
> not from a browser?

The squidclient tool can be used to pull manager reports directly and
quickly. Like so:

  squidclient mgr:info >squid_mgr_info.txt
  squidclient mgr:mem  >squid_mgr_memory.tsv

Since you expressed some confusion about reading the mem report here
are some basics that should help:

The memory report table is a TSV format. The .tsv file generated above
can be opened by most any spreadsheet tools (Excell, OpenOffice Calc,
etc). You just select "TXT formatted" or "Comma Separated Value" as
the file type then select Tab as separator (de-select comma / CSV) if
asked what the format type is. That makes it easier to view and play
with the data.

In your case with pooling disabled the relevant details are in the
section of columns titled "In Use". The "Chunked" and "Allocations
Saved" sections are garbage when pools are off.

The report is sorted by which objects have been allocated most memory.
So if you are familar or can find out what the named objects are used
for then it may (or not) be easy to spot something odd.
 eg. in your first report I saw the IdentStateData was in hundreds of
MB with 50K active requests for just 150 clients. *very* odd given
your config should make no more than 3 IDENT lookups per client.

Most objects names should give away ther meaning.

The unusual one you should expect to be first is mem_node. Which is
the name for a 4KB chunk of cache_mem and in-transit objects. There is
some bytes of meta data making it slightly bigger than 4KB, which on
some OS means the memory page uses 8KB per object without telling
Squid. This can be a hidden gotcha and why Squid sometimes uses
slightly over 2x what the mem_node column says is allocated to
cache_mem. :-(


> 
>> and "top -n 1 -b|egrep "proxy|squid|PID"" Which should give a
>> nice output of the squid process memory consumption.

Be careful noting which column is resident memory and which is virtual
memory in that output. Each helper spawned is allocated virtual memory
equal to the total resident size of its squid parent process
(including cache_mem and any shared memory usage) at the time of its
spawning. It can show very huge numbers even while Squid goes nowhere
near using any of it.

HTH
Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUKqvAAAoJELJo5wb/XPRj2rEH/2ThUFxwWX5JgXDH/Tpp/QLc
YYROxf65XpSRMUVvyygl1AVzgZxwO3XK6HQGz/bzlRWBIQFbLYuCucWLk0RBBy2Q
4CHdS90SOML4fjCUpxTXvtbH8f6jp+MNH6ULEvmCpDtmAg1o6NQD86mO/nlddfHU
/TexsrkvGMNWluMGDi/dhUJY2XHvAbMfd3l3dGpmzmDu2uPM8LwDDV26nJ07657j
BIxG1kue+sAD0LdK+DQlegedo4zu4aCy8H355eGskhUht56dx0dMniTe0q8nxP+x
y/cuiGOEjjfHwNmLAXZbSVjdMZc4V2sk9mhyXQ7CAQ4CAD3e0VxrXqsPwLh4lwE=
=/mkc
-----END PGP SIGNATURE-----


From ahmed.zaeem at netstream.ps  Tue Sep 30 14:28:59 2014
From: ahmed.zaeem at netstream.ps (Ahmd)
Date: Tue, 30 Sep 2014 16:28:59 +0200
Subject: [squid-users] squid bandwidth saving optimization for
	specific	sites
In-Reply-To: <5429CEC0.5060404@ngtech.co.il>
References: <"009b01cfdc17$a4b04e10$ee10ea30$@zaeem"@netstream.ps>
 <5429CEC0.5060404@ngtech.co.il>
Message-ID: <00c401cfdcba$e1a553d0$a4effb70$@zaeem@netstream.ps>

Hi eleizer,
Here is sample of them :
=====================================================

and there are more websites .....

can u help me with refresh pattern config ?

here is my current squid config :

=================
[root at squidsmp ~]# cat /etc/squid/squid.conf
# Example rule allowing access from your local networks.
# Adapt to list your (internal) IP networks from where browsing
# should be allowed
acl localnet src 10.0.0.0/8     # RFC1918 possible internal network
acl localnet src 172.16.0.0/12  # RFC1918 possible internal network
acl localnet src 192.168.0.0/16 # RFC1918 possible internal network
acl localnet src fc00::/7       # RFC 4193 local private network range
acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged) machines
acl mysubnet src vvvvvvvvvv
acl vvvvv src vvvvv
acl localip     src     vvvvvvv
acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl CONNECT method CONNECT
######################################################
# Recommended minimum Access Permission configuration:
# Deny requests to certain unsafe ports
###########################################################
######Dening feezed ips and redirect them to page payment######
######################################################
acl localnetx src 10.11.0.0/16 10.12.0.0/16 
acl localnety dst  192.168.70.2/32
http_access allow localnetx localnety
http_access deny localnetx
deny_info http://192.168.70.2:9090/pay/payment localnetx
##############################################################
http_access allow vvvvv
http_access allow manager vvvvv
http_access deny !Safe_ports
http_access allow localnet
# Deny CONNECT to other than secure SSL ports
http_access deny CONNECT !SSL_ports
#######################################################
###########SMP oPTIONS#####################
dns_v4_first on 
# 3 workers, using worker #1 as the frontend is important
workers 2

visible_hostname vvvvv
####################################################
####Filterring##############
acl blockkeywords dstdomain "/etc/squid/koko.acl"
http_access deny blockkeywords
#################################################
##Regix filtering##########
acl xacl dstdom_regex "/etc/squid/squid-regex.acl"
http_access deny xacl
##############################
cache_log /var/log/squid/cache.log
#access_log stdio:/var/log/squid/access.log
access_log /var/log/squid/access.log 
############################################### 
http_port vvv:65000
http_port vvvv:3129 tproxy
############################################################################
http_access allow mysubnet
############################################################################################
cache_mgr vvv        
cachemgr_passwd vv
#######################################################
# add user authentication and similar options here
http_access allow manager localhost
http_access allow manager localip
http_access allow manager mysubnet
http_access allow mysubnet manager
http_access deny manager
#######################################################################
#cache_mem 1500 M
cache_mem 20000 MB
#cache_mem 1000 MB 
# ^^ per process mem size.
################################################
#maximum_object_size_in_memory 64 KB

maximum_object_size 20 MB
maximum_object_size_in_memory 20 MB
#minimum_object_size 0 KB
##################################################
# the frontend requires a different name to the backend
#######################################################################
cache_swap_low 90
cache_swap_high 95
###########################################################

#########################################################
quick_abort_pct 95
fqdncache_size 65535
ipcache_size 65535
###########################################################
ipcache_low 98
ipcache_high 99
#####################################################
########### WCCP2 Config#############
wccp2_router vvvvvvv
wccp2_rebuild_wait off   
wccp_version 2
wccp2_forwarding_method 2
wccp2_return_method 2
wccp2_assignment_method 2
wccp2_service dynamic 80
wccp2_service_info 80 protocol=tcp flags=src_ip_hash priority=250 ports=80
wccp2_service dynamic 90
wccp2_service_info 90 protocol=tcp flags=dst_ip_hash,ports_source priority=250 ports=80
######################################################
cache_effective_user squid
cache_effective_group squid
#######################################################
memory_replacement_policy heap GDSF
cache_replacement_policy heap LFUDA
#####################################################
dns_nameservers vvvvvvvv
# better used with local only!!
#dns_nameservers 8.8.8.8
####################################################### 
http_access deny all
##############################
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320
####################################################
####Slow after sometime tshooting############
memory_pools off 
###########################################
#server_persistent_connections on
#client_persistent_connections on
# Defaults for ^^ are on
pconn_timeout 2 minutes
persistent_request_timeout 1 minute 
read_ahead_gap 128 KB
#this ^^ gives the clients a for the download of the page
# it is not recommended to use it by default settings but if you would like to try it's worth.
###############################################
#####rotating logs#####
logfile_rotate 0
###########################################################################
max_filedescriptors 131072
======================



[root at squidsmp ~]# squid -v
Squid Cache: Version 3.4.7
configure options:  '--build=i486-linux-gnu' '--prefix=/usr' '--includedir=/include' '--mandir=/share/man' '--infodir=/share/info' '--sysconfdir=/etc' '--enable-cachemgr-hostname=drx' '--localstatedir=/var' '--libexecdir=/lib/squid' '--disable-maintainer-mode' '--disable-dependency-tracking' '--disable-silent-rules' '--srcdir=.' '--datadir=/usr/share/squid' '--sysconfdir=/etc/squid' '--mandir=/usr/share/man' '--enable-inline' '--enable-async-io=8' '--enable-storeio=ufs,aufs,diskd,rock' '--enable-removal-policies=lru,heap' '--enable-delay-pools' '--enable-cache-digests' '--enable-underscores' '--enable-icap-client' '--enable-follow-x-forwarded-for' '--enable-auth' '--enable-basic-auth-helpers=LDAP,MSNT,NCSA,PAM,SASL,SMB,YP,DB,POP3,getpwnam,squid_radius_auth,multi-domain-NTLM' '--enable-ntlm-auth-helpers=smb_lm' '--enable-digest-auth-helpers=ldap,password' '--enable-negotiate-auth-helpers=squid_kerb_auth' '--enable-arp-acl' '--enable-esi' '--disable-translation' '--with-logdir=/var/log/squid' '--with-pidfile=/var/run/squid.pid' '--with-filedescriptors=131072' '--with-large-files' '--with-default-user=squid' '--enable-linux-netfilter' 'build_alias=i486-linux-gnu' 'CFLAGS=-g -O2 -g -Wall -O2' 'LDFLAGS=' 'CPPFLAGS=' 'CXXFLAGS=-g -O2 -g -Wall -O2' '--enable-ltdl-convenience'







-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Eliezer Croitoru
Sent: Monday, September 29, 2014 11:27 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] squid bandwidth saving optimization for specific sites

It really depends on the site.
If the site do not support caching since the content cannot be cached 
(dynamic) you probably cannot cache it.
If the site supports cache you can try to modify the refresh_pattern to 
tweak couple things about the traffic.

Can you share the website name?

Eliezer

On 09/29/2014 10:00 PM, Ahmd wrote:
> Hi Guys ,
>
> I have found that 60 % of my uses open about 4 common sites every day
> and  we can say that they are visited so much.
>
> I began to think in a method to let squid to save the entire website
> since it has a lot of visits.
>
> Again  , here I want to save bandwidth as I can since the visits is a
> lot on these sites.
>
> I need a best practice for squid config that may help me.
>
> Any ideas ?
>
> regards
>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users




From eliezer at ngtech.co.il  Tue Sep 30 13:28:16 2014
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Tue, 30 Sep 2014 16:28:16 +0300
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <542AABC6.1010005@treenet.co.nz>
References: <5427C7E6.3070600@zhegan.in>
 <20140928091835.GA37229@admin.sibptus.tomsk.ru>
 <5427E97A.1020309@ngtech.co.il>
 <20140928124159.GA38727@admin.sibptus.tomsk.ru>
 <5428AA6B.1010201@treenet.co.nz>
 <20140929071652.GA60398@admin.sibptus.tomsk.ru>
 <54291BB8.5020904@treenet.co.nz>
 <20140930022859.GA83414@admin.sibptus.tomsk.ru>
 <20140930053326.GA90693@admin.sibptus.tomsk.ru>
 <542A8E58.3010704@ngtech.co.il>
 <20140930122430.GB4168@admin.sibptus.tomsk.ru>
 <542AABC6.1010005@treenet.co.nz>
Message-ID: <542AAFF0.1090908@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

About the memory page size:
getconf PAGESIZE
getconf PAGE_SIZE

One of the above should provide the basic information.

Waiting for some more info.

Eliezer

On 09/30/2014 04:10 PM, Amos Jeffries wrote:
> The unusual one you should expect to be first is mem_node. Which
> is the name for a 4KB chunk of cache_mem and in-transit objects.
> There is some bytes of meta data making it slightly bigger than
> 4KB, which on some OS means the memory page uses 8KB per object
> without telling Squid. This can be a hidden gotcha and why Squid
> sometimes uses slightly over 2x what the mem_node column says is
> allocated to cache_mem. :-(
> 
> 
>>> 
>>>>> and "top -n 1 -b|egrep "proxy|squid|PID"" Which should give
>>>>> a nice output of the squid process memory consumption.
> Be careful noting which column is resident memory and which is
> virtual memory in that output. Each helper spawned is allocated
> virtual memory equal to the total resident size of its squid parent
> process (including cache_mem and any shared memory usage) at the
> time of its spawning. It can show very huge numbers even while
> Squid goes nowhere near using any of it.
> 
> HTH Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUKq/wAAoJENxnfXtQ8ZQU70IH/0PUDwHg1aXQZcPpMb1FA9oM
0cFu5AIZOf5c4a5VcgvYRLo0mq7yrQnQ21D2cggs5U/OqB7/7UwDUleYqyc+qNN/
vZug02WaWO/GlNztzUPHXUsuLBqAO3ULHXc9BcC7h/M3IB4hjHeiwH5YsAKx17aA
ktc97witmsVzU0/LUN9B4Ptyhb5vDq/jVfbrn5JkETPUO3lreuw1EzxTKSpf5eKU
VqrSOFo+tAnMWoN3WK5Wn1ZCY7HlC+Rwevb6wjtBJtQU6SW4k7T075soLbHyWprS
mwW1srOmc4KZ1ZDtxkhN3NBKfr92dWzUxxJPTr1WpTTYMg9MaCvIHY9I+TDzLY8=
=0BTf
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Tue Sep 30 13:48:58 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 01 Oct 2014 02:48:58 +1300
Subject: [squid-users] 301 Error in squid -> followed by 302
In-Reply-To: <CA+wGmzOEUypKdyO=_psYO2e+FxttKj9-QE-=7jCrL7keDOnOcA@mail.gmail.com>
References: <CA+wGmzOEUypKdyO=_psYO2e+FxttKj9-QE-=7jCrL7keDOnOcA@mail.gmail.com>
Message-ID: <542AB4CA.7070802@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 1/10/2014 1:45 a.m., Mr C K wrote:
> When i use squid and get headers like,
> 
> HTTP/1.1 301 Moved Permanently Location: http://www.hotmail.com/
> 
> squid ends up in a endless loop.

Not Squid.

> 
> ERR_TOO_MANY_REDIRECTS

This is a Chrome web browser error.

> 
> Some say to use u url_rewriter or location_rewrite, but how and
> where to read more about this.
> 
> or is it that simple that squid can't handle this type of
> redirect?

There is nothing to "handle" here.

 1a) Squid takes some request from the client and passes it to the
server, which responds with 301.
 1b) Squid takes the 301 and delivers it to the client.

 2a) Squid takes client followup request for the new Location URL and
passes it to the server, which responds with 302 pointing back to the
first URL.
 2b) Squid takes the 302 and delivers it to the client.

 3a) goto 1a.


See the problem?


Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUKrTKAAoJELJo5wb/XPRjm+8IAOLFlk+3kGmePfW8t9rYBqIY
33UslC4XdJ8EiV1aPy0LaZDYfIlnnZL308bVuPJ1Tcsw1nqR4YO7oFrFTHUUWVu2
7KExx5cn47EsCUOrneuL91uxtpYE3RNyith0Vb30PhKo/1gMWw/g+ghx38MVb3ix
yj98emUqy4AZCsza5BZFp1TXMAKNv7rJ3ORhTMoVtWhhBQ39P7MZDFB/TpwUgz7X
lmS+pjdec4nFK5NZwpFvyQnker8ivfCe5lzC9bZfRVTgae5C6G3eX2fqUXn6axr8
mZ3vRQVtX+9KdmJy8UsqPBITEWhQtczOJHnGjpPWgzHYaygHUdsEyfUwdtIPXB4=
=78Ka
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Tue Sep 30 14:13:19 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 01 Oct 2014 03:13:19 +1300
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <5429209D.1050909@opendium.com>
References: <20140928062806.GA34166@admin.sibptus.tomsk.ru>
 <5427B9EC.6060500@ngtech.co.il> <5429209D.1050909@opendium.com>
Message-ID: <542ABA7F.6010401@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 29/09/2014 10:04 p.m., Steve Hill wrote:
> On 28.09.14 08:34, Eliezer Croitoru wrote:
> 
>> Also to minimize the leak source try to share more information
>> about your usage. Are you using SMP workers or not? What is the
>> mem and info options in the cache manager page data? Did you
>> tried "cache deny all" acl to minimize the source of the leak?
> 
> For what its worth, I'm also seeing a big memory leak on multiple 
> servers under Squid 3.4.6:
> 
> I have two basic Squid configurations - one of them is a plain
> caching proxy and is _not_ leaking.  The other does no caching, but
> is doing ICAP, external ACLs, SSL bumping and TPROXY and leaks like
> a sieve (several gigabytes a day).
> 
> I _think_ I have narrowed it down to something ICAP related and
> I'm currently valgrinding.  Unfortunately I can't seem to get the
> valgrind instrumentation to work so I'm having to do without (I
> compile --with-valgrind-debug but "squidclient mgr:mem" doesn't
> produce a valgrind report).  I have noticed that there are a _lot_
> of memory errors reported by valgrind though (uninitialised
> memory).

IIRC the valgrind report is strangely at the end of mgr:info rather
than mgr:mem. It also only lists details if there is *real* leaked memory.

With one small exception all the reports of memory "leaks" in
3.2/3.3/3.4 series are in fact memory over-allocations. The difference
is that over-allocated memory is still referenced by some part of
Squid, so it *does not* show up in a leak finder like valgrind.

For example; most of Victors "leak" was in fact thousands of hung
asynchronous code chains/threads waiting for some network I/O which
could never happen, or if it does not for some very long time. Still
perfectly accessible to Squid via the index of active IDENT lookups
(ie not leaked), but should have been explicitly released already.



> 
> Pretty much all of the leaky memory is showing up as unaccounted: 
> Memory accounted for: Total accounted:        84306 KB   3% memPool
> accounted:      84306 KB   3% memPool unaccounted:   2917158 KB
> 97%
> 
> I am using SMP workers, but turning that off doesn't fix the
> issue.
> 

If you are using a 64-bit OS then the unaccounted numbers there are
bogus. They are based on mallinfo() lookup results which suffer from
32-bit wrap issues. Use the OS command line to get a memory report
from top or similar instead.

HTH
Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUKrp/AAoJELJo5wb/XPRjfgEH/jMS0eZ0y/rZ4k4nZAprDCmr
+iJrBOR7/7yObQ4FEZlX793qofky760x35VuHvVantzl0oy2CNk2rCmluI85WOTn
i4WYfCvU/1J5ECp9PnodcslldgFM8TXcG5yuXhj2Ro36Prs0RYuXvwC7cuf4ASd9
BuoP/RCbNjlJFwHoHEcXM35OLMU0dshnSZ6YnesLOZODRUz9qNJK/x1Q0xeXAXBC
LjRatV2IEr8O5iV6BqTHQDVHOAUuG/m35dIeruyeg6r3pLngtR8PYxWfLsdTVxfP
UUjN4EoVozpyuIytvB4/PYSKDkFf8AtQbEnznXtnuyaWZR49/E8kpSp4bd61fyg=
=x7XO
-----END PGP SIGNATURE-----


From steve at opendium.com  Tue Sep 30 14:27:32 2014
From: steve at opendium.com (Steve Hill)
Date: Tue, 30 Sep 2014 15:27:32 +0100
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <542952FB.9050600@ngtech.co.il>
References: <20140928062806.GA34166@admin.sibptus.tomsk.ru>
 <5427B9EC.6060500@ngtech.co.il> <5429209D.1050909@opendium.com>
 <542952FB.9050600@ngtech.co.il>
Message-ID: <542ABDD4.50300@opendium.com>

On 29.09.14 13:39, Eliezer Croitoru wrote:
> Hey Steve,
>
> Can you share the basic cache manager requests statistics and the up
> time for the service?
> (mgr:info)

This is with 8 workers and was restarted this morning, about 6 hours 
ago.  As you can see, it's using about 5GB at the moment - as mentioned, 
there is no caching enabled for this configuration so there doesn't seem 
much reason for it to grow so large.

Squid Object Cache: Version 3.4.6
Build Info:
Start Time:	Tue, 30 Sep 2014 08:33:01 GMT
Current Time:	Tue, 30 Sep 2014 14:14:28 GMT
Connection information for squid:
	Number of clients accessing cache:	2545
	Number of HTTP requests received:	926815
	Number of ICP messages received:	0
	Number of ICP messages sent:	0
	Number of queued ICP replies:	0
	Number of HTCP messages received:	0
	Number of HTCP messages sent:	0
	Request failure ratio:	 0.00
	Average HTTP requests per minute since start:	2714.3
	Average ICP messages per minute since start:	0.0
	Select loop called: 33693001 times, 5.219 ms avg
Cache information for squid:
	Hits as % of all requests:	5min: 0.0%, 60min: 0.0%
	Hits as % of bytes sent:	5min: 3.5%, 60min: 4.4%
	Memory hits as % of hit requests:	5min: 0.0%, 60min: 0.0%
	Disk hits as % of hit requests:	5min: 0.0%, 60min: 0.0%
	Storage Swap size:	0 KB
	Storage Swap capacity:	 0.0% used,  0.0% free
	Storage Mem size:	2168 KB
	Storage Mem capacity:	 0.0% used,  0.0% free
	Mean Object Size:	0.00 KB
	Requests given to unlinkd:	0
Median Service Times (seconds)  5 min    60 min:
	HTTP Requests (All):   0.06557  0.06988
	Cache Misses:          0.06629  0.07171
	Cache Hits:            0.00000  0.00000
	Near Hits:             0.00000  0.00000
	Not-Modified Replies:  0.00000  0.00000
	DNS Lookups:           0.00012  0.00000
	ICP Queries:           0.00000  0.00000
Resource usage for squid:
	UP Time:	20487.255 seconds
	CPU Time:	3177.711 seconds
	CPU Usage:	15.51%
	CPU Usage, 5 minute avg:	11.44%
	CPU Usage, 60 minute avg:	12.40%
	Maximum Resident Size: 19930960 KB
	Page faults with physical i/o: 6
Memory usage for squid via mallinfo():
	Total space in arena:  5014812 KB
	Ordinary blocks:       5004965 KB   2620 blks
	Small blocks:               0 KB      0 blks
	Holding blocks:         82080 KB     48 blks
	Free Small blocks:          0 KB
	Free Ordinary blocks:    9847 KB
	Total in use:            9847 KB 0%
	Total free:              9847 KB 0%
	Total size:            5096892 KB
Memory accounted for:
	Total accounted:       447132 KB   9%
	memPool accounted:     447132 KB   9%
	memPool unaccounted:   4649760 KB  91%
	memPoolAlloc calls: 528851610
	memPoolFree calls:  531832922
File descriptor usage for squid:
	Maximum number of file descriptors:   131072
	Largest file desc currently in use:    209
	Number of file desc currently in use:  754
	Files queued for open:                   0
	Available number of file descriptors: 130318
	Reserved number of file descriptors:   800
	Store Disk files open:                   0
Internal Data Structures:
	   510 StoreEntries
	   510 StoreEntries with MemObjects
	   408 Hot Object Cache Items
	     0 on-disk objects


For comparison, almost all of the http (but none of the https) requests 
that go through the proxy above are then sent through a second proxy 
which does do some caching, but no fancy stuff like ICAP or ssl bumping 
- the caching proxy has been running for 18 days and has a far smaller 
process size (again, 8 workers):

Squid Object Cache: Version 3.4.6
Build Info:
Start Time:	Fri, 12 Sep 2014 08:48:50 GMT
Current Time:	Tue, 30 Sep 2014 14:18:35 GMT
Connection information for squid:
	Number of clients accessing cache:	1
	Number of HTTP requests received:	19496669
	Number of ICP messages received:	0
	Number of ICP messages sent:	0
	Number of queued ICP replies:	0
	Number of HTCP messages received:	0
	Number of HTCP messages sent:	0
	Request failure ratio:	 0.00
	Average HTTP requests per minute since start:	742.7
	Average ICP messages per minute since start:	0.0
	Select loop called: 763795228 times, 2.062 ms avg
Cache information for squid:
	Hits as % of all requests:	5min: 13.1%, 60min: 12.8%
	Hits as % of bytes sent:	5min: 7.0%, 60min: 4.7%
	Memory hits as % of hit requests:	5min: 0.0%, 60min: 0.0%
	Disk hits as % of hit requests:	5min: 16.4%, 60min: 11.9%
	Storage Swap size:	3773012 KB
	Storage Swap capacity:	90.0% used, 10.0% free
	Storage Mem size:	262144 KB
	Storage Mem capacity:	100.0% used,  0.0% free
	Mean Object Size:	28.55 KB
	Requests given to unlinkd:	3198063
Median Service Times (seconds)  5 min    60 min:
	HTTP Requests (All):   0.02899  0.03241
	Cache Misses:          0.03066  0.03241
	Cache Hits:            0.00405  0.00091
	Near Hits:             0.03066  0.03427
	Not-Modified Replies:  0.00000  0.00000
	DNS Lookups:           0.00000  0.00000
	ICP Queries:           0.00000  0.00000
Resource usage for squid:
	UP Time:	1574985.354 seconds
	CPU Time:	32733.608 seconds
	CPU Usage:	2.08%
	CPU Usage, 5 minute avg:	3.80%
	CPU Usage, 60 minute avg:	3.54%
	Maximum Resident Size: 1025200 KB
	Page faults with physical i/o: 289968
Memory usage for squid via mallinfo():
	Total space in arena:   49616 KB
	Ordinary blocks:        38418 KB  15268 blks
	Small blocks:               0 KB      0 blks
	Holding blocks:         10520 KB      7 blks
	Free Small blocks:          0 KB
	Free Ordinary blocks:   11198 KB
	Total in use:           11198 KB 19%
	Total free:             11198 KB 19%
	Total size:             60136 KB
Memory accounted for:
	Total accounted:        27128 KB  45%
	memPool accounted:      27128 KB  45%
	memPool unaccounted:    33008 KB  55%
	memPoolAlloc calls: 5279809700
	memPoolFree calls:  5314670336
File descriptor usage for squid:
	Maximum number of file descriptors:   16384
	Largest file desc currently in use:     67
	Number of file desc currently in use:   50
	Files queued for open:                   0
	Available number of file descriptors: 16334
	Reserved number of file descriptors:   100
	Store Disk files open:                   0
Internal Data Structures:
	132586 StoreEntries
	   444 StoreEntries with MemObjects
	  8192 Hot Object Cache Items
	132142 on-disk objects



As a separate note: I'm not sure why the memory footprint of the caching 
squid is so low - with cache_mem set to 256MB (100% used, apparently) 
and 8 workers I would expect it to be much more.  Something else for me 
to investigate when I've got time. :)

-- 
  - Steve Hill
    Technical Director
    Opendium Limited     http://www.opendium.com

Direct contacts:
    Instant messager: xmpp:steve at opendium.com
    Email:            steve at opendium.com
    Phone:            sip:steve at opendium.com

Sales / enquiries contacts:
    Email:            sales at opendium.com
    Phone:            +44-844-9791439 / sip:sales at opendium.com

Support contacts:
    Email:            support at opendium.com
    Phone:            +44-844-4844916 / sip:support at opendium.com


From squid3 at treenet.co.nz  Tue Sep 30 14:28:53 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 01 Oct 2014 03:28:53 +1300
Subject: [squid-users] 301 Error in squid -> followed by 302
In-Reply-To: <CA+wGmzMeG0ciRh9W38ccoJ35tJcA=JAEHGsYbXOkfPQ5W7o1wQ@mail.gmail.com>
References: <CA+wGmzOEUypKdyO=_psYO2e+FxttKj9-QE-=7jCrL7keDOnOcA@mail.gmail.com>	<542AB4CA.7070802@treenet.co.nz>
 <CA+wGmzMeG0ciRh9W38ccoJ35tJcA=JAEHGsYbXOkfPQ5W7o1wQ@mail.gmail.com>
Message-ID: <542ABE25.5080905@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 1/10/2014 3:00 a.m., Mr C K wrote:
> Hmm, i see the problem but if i not use squid it works, i tried
> squid in all different ways.
> 
> http_port 3128 http_port 3128 accell http_port 3128 intercept
> 
> not tproxy since i use FreeBSD.
> 
> Could it be since i'm running parent and siblings ?
> 
> Thank you anyway - but if you know more feed me if you want. :)
> 


Using the squidclient tool to try and replicate the problem here I see
that http://www.hotmail.com/ redirects with a 301 as you describe.

But it redirects to https://mail.live.com/default.aspx.
 * if you are intercepting the traffic that URL should not be going
through your Squid at all since you are not doing HTTPS interception.
 * if your browser is configured to use the proxy explicitly it should
be going through Squid as a "CONNECT mail.live.com:443" request. Which
gets tunneled directly to the mail.live.com server.

If the browser does not deliver one or more of several Cookie headers
correctly the HTTPS request to mail.live.com redirects with 302 to
https://login.live.com/login.srf?wa=... which in turn asks for
credentials.

Not having a hotmail account I stop tracing at that point.


I have one suspicion...
  do you have the Squid directive balance_on_multiple_ip configured to
ON ?
  The hotmail security system used to (maybe still?) require all
inbound connections from one client to be using a single identical IP
address contacting a single server at the hotmail end of things. The
balance_on_multiple_ip directive forces Squid to break that assumption
and use a different origin server on every single request.

Amos



> 2014-09-30 15:48 GMT+02:00 Amos Jeffries: On 1/10/2014 1:45 a.m.,
> Mr C K wrote:
>>>> When i use squid and get headers like,
>>>> 
>>>> HTTP/1.1 301 Moved Permanently Location:
>>>> http://www.hotmail.com/
>>>> 
>>>> squid ends up in a endless loop.
> 
> Not Squid.
> 
>>>> 
>>>> ERR_TOO_MANY_REDIRECTS
> 
> This is a Chrome web browser error.
> 
>>>> 
>>>> Some say to use u url_rewriter or location_rewrite, but how
>>>> and where to read more about this.
>>>> 
>>>> or is it that simple that squid can't handle this type of 
>>>> redirect?
> 
> There is nothing to "handle" here.
> 
> 1a) Squid takes some request from the client and passes it to the 
> server, which responds with 301. 1b) Squid takes the 301 and
> delivers it to the client.
> 
> 2a) Squid takes client followup request for the new Location URL
> and passes it to the server, which responds with 302 pointing back
> to the first URL. 2b) Squid takes the 302 and delivers it to the
> client.
> 
> 3a) goto 1a.
> 
> 
> See the problem?
> 
> 
> Amos
> 
>> _______________________________________________ squid-users
>> mailing list squid-users at lists.squid-cache.org 
>> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUKr4kAAoJELJo5wb/XPRjdu0H/0zz+InLdijPGj3q6hqBmVJS
aJNe8TGCYUpeNbjfqv6eK8xmvzo0clwHy3GBMwwb9oOBeEwnCb8uMX+wYMg9t34R
ZVrVJ6zjNHUKJru2+W/1NGVLGm9JmLQmTIlwGZK/RrSsVQgHCapRA8RXiFa/l1gf
iHTyS2mwOc+MXg+jjCh/fRLAJBLOpDwc57AmMdh/T5N97yLnFrQy3O2iDnYN8RS6
vTrmQxmo9bt//s2PktxpqpAzOHFrZRA1jmSf+dD4qtyYwkmrF1a1SaguQD8IuU3n
o11+JBCxf51hfFWfnYMXl+H+2VSwzqeBdGkho5L7n81SUG1lKtwXmKP6p6xR1qw=
=4BdT
-----END PGP SIGNATURE-----


From steve at opendium.com  Tue Sep 30 14:59:24 2014
From: steve at opendium.com (Steve Hill)
Date: Tue, 30 Sep 2014 15:59:24 +0100
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <542ABA7F.6010401@treenet.co.nz>
References: <20140928062806.GA34166@admin.sibptus.tomsk.ru>
 <5427B9EC.6060500@ngtech.co.il> <5429209D.1050909@opendium.com>
 <542ABA7F.6010401@treenet.co.nz>
Message-ID: <542AC54C.408@opendium.com>


On 30.09.14 15:13, Amos Jeffries wrote:

> IIRC the valgrind report is strangely at the end of mgr:info rather
> than mgr:mem.

In that case the wiki is wrong. :)
Anyway, it doesn't show up on either of them for me so I guess you might 
be right that it isn't "real" leaked memory.  (I still thought I'd see 
some indication that it was invoking the valgrind report though, even if 
it contained no data)

> With one small exception all the reports of memory "leaks" in
> 3.2/3.3/3.4 series are in fact memory over-allocations. The difference
> is that over-allocated memory is still referenced by some part of
> Squid, so it *does not* show up in a leak finder like valgrind.

Do you have any advice for finding out what memory is still referenced 
in large amounts?  Since this is unaccounted memory, it presumably 
doesn't appear in mgr:mem (at least, I can't see anything obvious in there)?

I'm trying to figure out if there's a way of convincing valgrind to dump 
info about all the currently allocated memory while the program is still 
running - there would be a lot of legitimate stuff in the report, but 
hopefully a few hundred MB of memory that shouldn't be there would stick 
out like a sore thumb.

> If you are using a 64-bit OS then the unaccounted numbers there are
> bogus. They are based on mallinfo() lookup results which suffer from
> 32-bit wrap issues. Use the OS command line to get a memory report
> from top or similar instead.

In this case I don't believe the data is bogus.  I have 8 workers, which 
top shows as:
26249 squid     20   0  871m 782m 5348 S  0.7 10.0   8:44.81 squid
26245 squid     20   0  732m 644m 5344 S  0.3  8.3   8:00.77 squid
26244 squid     20   0  706m 617m 5348 S  1.0  7.9   7:42.29 squid
26250 squid     20   0  699m 613m 5348 S  3.6  7.9   4:43.49 squid
26246 squid     20   0  699m 612m 5348 S  2.3  7.9   6:12.78 squid
26251 squid     20   0  662m 576m 5348 S  0.7  7.4   5:45.11 squid
26248 squid     20   0  649m 564m 5348 S  2.3  7.2   9:22.91 squid
26247 squid     20   0  603m 518m 5348 S  1.3  6.6   4:45.47 squid

Adding the sizes in the "virt" column gives me 5621MB.  The combined RSS 
is 4926MB.  Process 26250 has just 2MB in swap, the rest have no swap at 
all.  I guess the difference between the RSS and Virt totals can 
probably be almost entirely accounted for by the executables.

mallinfo() says there is about 4897MB in the arena - close enough to sum 
of the RSS that I'm inclined to believe it.  Since no one process 
exceeds 2GB, mallinfo() is probably trustworthy in this case.

The accounted for memory is 440MB - potentially higher than I would 
expect for a Squid with caching disabled, but certainly low enough to 
not be an immediate concern.  But that gives us about 4.4GB of memory 
unaccounted for (by subtracting 440MB from the sum of the RSS as shown 
by top).

4.4GB of unaccounted memory after running for just 6 hours is a 
significant amount, and if left to their own devices Squid continues to 
eat all the memory, leaving the machine thrashing swap.

I count 531 sockets in netstat, so my guess is that it isn't just data 
associated with some open sockets:
netstat -apn|egrep '26249|26245|26244|26250|26246|26251|26248|26247' -c
531


-- 
  - Steve


From squid3 at treenet.co.nz  Tue Sep 30 14:58:41 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 01 Oct 2014 03:58:41 +1300
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <20140930053326.GA90693@admin.sibptus.tomsk.ru>
References: <20140928062806.GA34166@admin.sibptus.tomsk.ru>
 <5427C7E6.3070600@zhegan.in> <20140928091835.GA37229@admin.sibptus.tomsk.ru>
 <5427E97A.1020309@ngtech.co.il>
 <20140928124159.GA38727@admin.sibptus.tomsk.ru>
 <5428AA6B.1010201@treenet.co.nz>
 <20140929071652.GA60398@admin.sibptus.tomsk.ru>
 <54291BB8.5020904@treenet.co.nz>
 <20140930022859.GA83414@admin.sibptus.tomsk.ru>
 <20140930053326.GA90693@admin.sibptus.tomsk.ru>
Message-ID: <542AC521.2040006@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 30/09/2014 6:33 p.m., Victor Sudakov wrote:
> Victor Sudakov wrote:
>> Amos Jeffries wrote:
>>> 
>>> You have 200 MB of RAM locked up in IDENT lookups.
>>> 
>>> Probably http://bugs.squid-cache.org/show_bug.cgi?id=3803
>> 
>> I have temporarily disabled IDENT-related acls. Squid still grows
>> in memory, but more slowly. So IDENT was certainly one of the
>> major causes of the leak.
>> 
>> Could we make another iteration of looking at the cachemgr.cgi
>> memory counters?
>> 
> 
> Attaching two cachemgr reports: right after squid restart and
> several hours later (grown to 816M in SIZE).
> 

These are still showing over 47K IDENT lookups.

Probably you did not disable all the uses of IDENT. You need to both
set "ident_access deny all" and remove use of ident type ACLs.

Before trying that though, I attached a new patch to bug report 3803.
Can you apply that and see if it works?

NP: For your request rate of 150 req/sec I expect the mgr:mem "cbdata
IdentStateData (17)" to show less than 3K in "(#) Allocated" ( 12152
in "(KB) Allocated").

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUKsUhAAoJELJo5wb/XPRjxBwH/i9ee1HQtS2cwsYrNNqd2yG8
cdlvpfceHXY+iS19HL/hOPRDFUN9VfTh9LxWdk7wCASmIFd8he5I5e8Fpgu0/+80
HhpXkXgTMTUljKc6A7Vs+M6RUalp1MdWqcebzzuh7xMTXDzKaD1pky3xOsFcPuqy
umoDC7fFukhuCWVkBXBv/IvC8z3oUUbUD8oLVUD5PVqW5X3/RDYWW4L7LosxDt92
4rKW6uDJs+ytYlRYfZ43I1AEHlXMbvAxClFtVttG91I5b2uBzKasWiI9OQCyVVht
uAnm7LlQvHnT72JchbyqRPPaeESyFRpNGPlFFNv7mi67EAs2N6cMGDbJeaRLWV4=
=lAX8
-----END PGP SIGNATURE-----


From eliezer at ngtech.co.il  Tue Sep 30 15:12:45 2014
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Tue, 30 Sep 2014 18:12:45 +0300
Subject: [squid-users] squid bandwidth saving optimization for specific
	sites
In-Reply-To: <"00c401cfdcba$e1a553d0$a4effb70$@zaeem"@netstream.ps>
References: <"009b01cfdc17$a4b04e10$ee10ea30$@zaeem"@netstream.ps>
 <5429CEC0.5060404@ngtech.co.il>
 <"00c401cfdcba$e1a553d0$a4effb70$@zaeem"@netstream.ps>
Message-ID: <542AC86D.3010205@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 09/30/2014 05:28 PM, Ahmd wrote:
> and there are more websites .....
Where?

Eliezer
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUKshtAAoJENxnfXtQ8ZQUInYH/0Q7vkvhaSbLcvXeztchPdEm
IxXpYuI0wkz8/+T8spZ8ls1iw8NFkGB4WdYXj7lXvQQSsjPSzkIoYl4/mlRWIGcj
cue3rcWqqWJ68w1VYWBhTEq/6Bvr7TmIUql1s+/HxXJJ7wl9e2TUtpFrofsLKckJ
y/3VESBC8AdPpckD+EBTFEOYSpISKhTwHN4VBFy9riudf5Rdljeis+ha+UiXgpCl
ArHNGXTmP4bhFhACEzypNl7CrJZx77Ob8NX67tyWPIsLzKZh0PKAWm+FzsDPNUla
r6WQYZRD8bewkmSAe2LkHCZ8X77zFfvyHra+KgiPlmywX7Uej396pMidk3rB/uE=
=8fFU
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Tue Sep 30 15:13:01 2014
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 01 Oct 2014 04:13:01 +1300
Subject: [squid-users] leaking memory in squid 3.4.8 and 3.4.7.
In-Reply-To: <542AC54C.408@opendium.com>
References: <20140928062806.GA34166@admin.sibptus.tomsk.ru>
 <5427B9EC.6060500@ngtech.co.il> <5429209D.1050909@opendium.com>
 <542ABA7F.6010401@treenet.co.nz> <542AC54C.408@opendium.com>
Message-ID: <542AC87D.7040806@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 1/10/2014 3:59 a.m., Steve Hill wrote:
> 
> On 30.09.14 15:13, Amos Jeffries wrote:
> 
>> IIRC the valgrind report is strangely at the end of mgr:info
>> rather than mgr:mem.
> 
> In that case the wiki is wrong. :) Anyway, it doesn't show up on
> either of them for me so I guess you might be right that it isn't
> "real" leaked memory.  (I still thought I'd see some indication
> that it was invoking the valgrind report though, even if it
> contained no data)
> 
>> With one small exception all the reports of memory "leaks" in 
>> 3.2/3.3/3.4 series are in fact memory over-allocations. The
>> difference is that over-allocated memory is still referenced by
>> some part of Squid, so it *does not* show up in a leak finder
>> like valgrind.
> 
> Do you have any advice for finding out what memory is still
> referenced in large amounts?  Since this is unaccounted memory, it
> presumably doesn't appear in mgr:mem (at least, I can't see
> anything obvious in there)?
> 
> I'm trying to figure out if there's a way of convincing valgrind to
> dump info about all the currently allocated memory while the
> program is still running - there would be a lot of legitimate stuff
> in the report, but hopefully a few hundred MB of memory that
> shouldn't be there would stick out like a sore thumb.

That would be lovely. If you can find it I'd like to know too :-)

A third option is using a ALL,9 cache.log tracer. We have begun
instrumenting class contstructors and destructors with debug
statements to record their lifetimes regardless of whether they are
accounted. A lot are not yet done though.
 The bzr repo contains a debug script at scripts/find-alive.pl which
correlates constructors to destructors in that log. It is useful for
scanning a cache.log while Squid is still running, crashed, or paused
in debugger to show what Jobs/requests etc are currently active.

> 
>> If you are using a 64-bit OS then the unaccounted numbers there
>> are bogus. They are based on mallinfo() lookup results which
>> suffer from 32-bit wrap issues. Use the OS command line to get a
>> memory report from top or similar instead.
> 
> In this case I don't believe the data is bogus.  I have 8 workers,
> which top shows as: 26249 squid     20   0  871m 782m 5348 S  0.7
> 10.0   8:44.81 squid 26245 squid     20   0  732m 644m 5344 S  0.3
> 8.3   8:00.77 squid 26244 squid     20   0  706m 617m 5348 S  1.0
> 7.9   7:42.29 squid 26250 squid     20   0  699m 613m 5348 S  3.6
> 7.9   4:43.49 squid 26246 squid     20   0  699m 612m 5348 S  2.3
> 7.9   6:12.78 squid 26251 squid     20   0  662m 576m 5348 S  0.7
> 7.4   5:45.11 squid 26248 squid     20   0  649m 564m 5348 S  2.3
> 7.2   9:22.91 squid 26247 squid     20   0  603m 518m 5348 S  1.3
> 6.6   4:45.47 squid
> 
> Adding the sizes in the "virt" column gives me 5621MB.  The
> combined RSS is 4926MB.  Process 26250 has just 2MB in swap, the
> rest have no swap at all.  I guess the difference between the RSS
> and Virt totals can probably be almost entirely accounted for by
> the executables.
> 
> mallinfo() says there is about 4897MB in the arena - close enough
> to sum of the RSS that I'm inclined to believe it.  Since no one
> process exceeds 2GB, mallinfo() is probably trustworthy in this
> case.
> 
> The accounted for memory is 440MB - potentially higher than I
> would expect for a Squid with caching disabled, but certainly low
> enough to not be an immediate concern.  But that gives us about
> 4.4GB of memory unaccounted for (by subtracting 440MB from the sum
> of the RSS as shown by top).
> 
> 4.4GB of unaccounted memory after running for just 6 hours is a 
> significant amount, and if left to their own devices Squid
> continues to eat all the memory, leaving the machine thrashing
> swap.
> 
> I count 531 sockets in netstat, so my guess is that it isn't just
> data associated with some open sockets: netstat -apn|egrep
> '26249|26245|26244|26250|26246|26251|26248|26247' -c 531
> 
> 

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUKsh9AAoJELJo5wb/XPRjUnAIALX5yfqY/XOVOcH90OXUree2
sHDJdCB5zlr4EO94qvichnkUm5bCMlg78dkPv8Nwyd43nG4SUUBNt4nh2dvZxYHn
8scHWFA1ZMsbl3k3dQ3eEHNCm+PfugvBo34ZokkMpSR8mLZhh9vqxXDhh9rwj6ez
K8mKnYMbNI/z/DOHhJxcM1NdnbYIyO84EUQfb9RGaJaKb8LDNLt4j6yCEeKa2Z8N
YcnPdA9VZZ3RCpImq0Py8U0kZbCPPBRs+cJAvUIgaAO080ZTrbF+bLZ+dHe4W7hA
JMxXUD4lfEy2HVja2+jfKBcJQwVCDwBK0tcu76bQ64WIrfuIIc/NyIOBwEhPT1I=
=cLQ3
-----END PGP SIGNATURE-----


From almarzuki2011 at hotmail.com  Tue Sep 30 16:41:20 2014
From: almarzuki2011 at hotmail.com (hadi)
Date: Tue, 30 Sep 2014 19:41:20 +0300
Subject: [squid-users] redirect all ports to squid
Message-ID: <DUB123-DS15337FBB7B90E43B736C7EB3BB0@phx.gbl>

It's possible to redirect all ports to squid ? thru iptables ?
For example port 25 smtp,143 imap, etc...
Can squid handle that. In transparent mode.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 1625 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20140930/5d88978a/attachment.bin>

From leolistas at solutti.com.br  Tue Sep 30 17:30:42 2014
From: leolistas at solutti.com.br (Leonardo Rodrigues)
Date: Tue, 30 Sep 2014 14:30:42 -0300
Subject: [squid-users] redirect all ports to squid
In-Reply-To: <DUB123-DS15337FBB7B90E43B736C7EB3BB0@phx.gbl>
References: <DUB123-DS15337FBB7B90E43B736C7EB3BB0@phx.gbl>
Message-ID: <542AE8C2.2000307@solutti.com.br>

On 30/09/14 13:41, hadi wrote:
> It's possible to redirect all ports to squid ? thru iptables ?
> For example port 25 smtp,143 imap, etc...
> Can squid handle that. In transparent mode.
>

     for the 1000th time here on the mailing list ... no, you cannot. 
Squid is an HTTP/HTTPS proxy and cannot handle other protocols.

     HTTPS can be transparently redirected, but complex configurations 
are needed for that and, in most cases, it will not be 100% transparent 
as for HTTP protocol.

     Other protocols, SMTP, IMAP, POP3, etc etc etc, cannot be handled 
by squid.



-- 


	Atenciosamente / Sincerily,
	Leonardo Rodrigues
	Solutti Tecnologia
	http://www.solutti.com.br

	Minha armadilha de SPAM, N?O mandem email
	gertrudes at solutti.com.br
	My SPAMTRAP, do not email it





From eliezer at ngtech.co.il  Tue Sep 30 17:47:50 2014
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Tue, 30 Sep 2014 20:47:50 +0300
Subject: [squid-users] redirect all ports to squid
In-Reply-To: <DUB123-DS15337FBB7B90E43B736C7EB3BB0@phx.gbl>
References: <DUB123-DS15337FBB7B90E43B736C7EB3BB0@phx.gbl>
Message-ID: <542AECC6.1010901@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Indeed using SSL-BUMP it's possible but(a bit but)..
It will not be able to handle non http\https traffic just like that.
It will require more then just squid setup and it might be a better
idea to find a better solution for you rather then using squid.

If you find one that can do it the right way please send me a link.

Eliezer

On 09/30/2014 07:41 PM, hadi wrote:
> It's possible to redirect all ports to squid ? thru iptables ? For
> example port 25 smtp,143 imap, etc... Can squid handle that. In
> transparent mode.

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUKuzFAAoJENxnfXtQ8ZQUVLAH/23Exs+zStTsI8ltn7LcZ0x6
RL1l46e68anl/hSGbeAU5FUDT3IcTmHzmnLyjQC/0VHegBHzzCn0a3lcFmFDX4xI
sH9vw+LSewSfxuQ/VRWHPUBF87T1awJQ36vWN8wanzZkFPCjvKvHdwQQIc2+Mrlq
2ALoKtYh/cZqpCjTCRJJT6//xxuHNaOkN4cp0AUNMEk8bJ2gUljNyoV7AFySeG5G
M9IqcX0BfJnazK0OxdzC18B8ENaLBcVihPdHw5JxDTx2yWsMLKFujBv9KqHbmEmF
9LvXb6pwBbD3tz6b2yrndwyLix/HnwIreHCb9YyxwiBJ3w7PW4whMbBJt/yFPTg=
=MyrY
-----END PGP SIGNATURE-----


From eliezer at ngtech.co.il  Tue Sep 30 17:48:45 2014
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Tue, 30 Sep 2014 20:48:45 +0300
Subject: [squid-users] redirect all ports to squid
In-Reply-To: <542AE8C2.2000307@solutti.com.br>
References: <DUB123-DS15337FBB7B90E43B736C7EB3BB0@phx.gbl>
 <542AE8C2.2000307@solutti.com.br>
Message-ID: <542AECFD.8050306@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 09/30/2014 08:30 PM, Leonardo Rodrigues wrote:
> Other protocols, SMTP, IMAP, POP3, etc etc etc, cannot be handled
> by squid.
They cannot be interpreted but can be handled with a "none" rule for
ssl bump.

Eliezer
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUKuz9AAoJENxnfXtQ8ZQUvEgH/i/rl/NFDwbYN+afuaaMYace
rSunwCJDtJPZJ5XQg197c3peDuGILnep27lvCJCiUt9rhWlhfHZIqfD5D4vjJmHC
ABRsuLFrtUE19kMOalEMo4Zlwna13ky5hIMSUrue5SJK7b6+xdVPNKqXMsb9a2Nm
nWA6+IQg4zZQ3fcR6D0Jqk7VUxAPDXLLVMkNIV/YeE8sd/IX2st3+bpxel+sOegv
A3AAgUt7blkBIf1FcxN5Tl56lTmz/2OLC1EoWj7HKRCX/zEc3/IavWI6yM9AVlCI
yze0Nm0PTCoXezkee8dz/nSMfUj9ZKxo2nlJrlHs+oeeQ+piOz6nfiT6TTTOvp4=
=0+Ix
-----END PGP SIGNATURE-----


From ahmed.zaeem at netstream.ps  Tue Sep 30 21:59:06 2014
From: ahmed.zaeem at netstream.ps (Ahmd)
Date: Tue, 30 Sep 2014 23:59:06 +0200
Subject: [squid-users] is there a way to hide squid
	from	http://www.ip-score.com/ ??
In-Reply-To: <54296CDF.9040402@ngtech.co.il>
References: <542875b9.a349320a.1910.6642SMTPIN_ADDED_BROKEN@mx.google.com>
 <CALizV5Vz52wGbAMhyy+MXLVwOD8uYDcCmDevB5sUYWiOn4wdnA@mail.gmail.com>
 <"006701cfdbf6$e10395a0$a30ac0e0$@zaeem"@netstream.ps>
 <54296CDF.9040402@ngtech.co.il>
Message-ID: <000601cfdcf9$c2715b50$475411f0$@zaeem@netstream.ps>

Hi eleizer , 

I wish you give me any ideas about that ...can u provide with any kernel patched for my goal ?
Or for any other easier solutions?

Im very interested in doing that !

regards

-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Eliezer Croitoru
Sent: Monday, September 29, 2014 4:30 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] is there a way to hide squid from http://www.ip-score.com/ ??

On 09/29/2014 06:05 PM, Ahmd wrote:
> Don?t u think there  is any way to hide ?
>
>   Any other luck ?
>
Ahmd,

I am sorry but you maybe either not understand.
If you use a transparent proxy and remove any headers related to such a 
thing you are invisible!!!

If a flash\java\html5 application is being used it will still not detect 
that there is a proxy there unless it's smart enough.(which might be the 
case)

Try to not look at the "real ip" section of their site since it can 
provide false positives some times.

Squid can add or remove headers and thats it!!
You are maybe looking for something else but there isn't.
The only option is that this client is verifying that the originating 
tcp\udp port is the same as the socket and which in this case the proxy 
will be 100% visible and it cannot be changed by simple config files.
To fix tcp\udp ports issues you will need to:
- Patch the linux kernel(a lot).
- Use a NAT server farm with one end in and one end out.
- other ideas.

All The Bests,
Eliezer
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From james at ejbdigital.com.au  Tue Sep 30 21:49:30 2014
From: james at ejbdigital.com.au (James Harper)
Date: Tue, 30 Sep 2014 21:49:30 +0000
Subject: [squid-users] redirect all ports to squid
In-Reply-To: <DUB123-DS15337FBB7B90E43B736C7EB3BB0@phx.gbl>
References: <DUB123-DS15337FBB7B90E43B736C7EB3BB0@phx.gbl>
Message-ID: <2207092051854955ae5ff49b9e9b25e9@SIXPR04MB304.apcprd04.prod.outlook.com>

> 
> It's possible to redirect all ports to squid ? thru iptables ?
> For example port 25 smtp,143 imap, etc...
> Can squid handle that. In transparent mode.

Yes. Kind of. You need:
. An appropriate rule in iptables nat table that ends with -j REDIRECT --to-ports 3129 (or whatever port you are listening on for this traffic)
. A https_port definition in squid.conf on that port with ssl-bump and a certificate (certificate doesn't get used unless you are doing actual https but the syntax requires it) and a port name
. an acl attached to the name of the listeners myportname
. an ssl_bump none that matches the traffic you are interested in (all if you aren't doing https interception)

Now that you know you can do it, consider:
. I've asked this question on the list and the response from people who really do know what they are talking about is that squid is not designed as a general tcp proxy and there are probably other solutions that work better
. squid currently doesn't allow a sensible termination of the connection if it isn't allowed, or if there is nothing listening at the other end. Your smtp/pop3/imap/etc application won't like that.
. you have to do authentication out-of-band (eg ident), but that's the same with transparent http anyway

To do this really nicely, squid would need:
. a "tcp_port" instead of "http_port" designed for exactly this sort of thing
. a way to call out to the destination before accepting the connection so that a 'connection refused' could be given if there is nothing listening
. a way to simply drop the connection if it doesn't succeed rather than the default response squid gives
. a way to redirect traffic to a helper (eg SMTP/IMAP/POP3 filter to scan for viruses, etc) (maybe this already exists already via other means?)

So in short it works, but not as well as it could, and you might be better of finding another solution. The main reason I was interested is that Squid already has a very nice acl implementation, and there are already a number of good log analysis tools for it.

James



From leolistas at solutti.com.br  Tue Sep 30 21:59:55 2014
From: leolistas at solutti.com.br (Leonardo Rodrigues)
Date: Tue, 30 Sep 2014 18:59:55 -0300
Subject: [squid-users] redirect all ports to squid
In-Reply-To: <2207092051854955ae5ff49b9e9b25e9@SIXPR04MB304.apcprd04.prod.outlook.com>
References: <DUB123-DS15337FBB7B90E43B736C7EB3BB0@phx.gbl>
 <2207092051854955ae5ff49b9e9b25e9@SIXPR04MB304.apcprd04.prod.outlook.com>
Message-ID: <542B27DB.8000203@solutti.com.br>

On 30/09/14 18:49, James Harper wrote:
>> It's possible to redirect all ports to squid ? thru iptables ?
>> For example port 25 smtp,143 imap, etc...
>> Can squid handle that. In transparent mode.
>
> So in short it works, but not as well as it could, and you might be better of finding another solution. The main reason I was interested is that Squid already has a very nice acl implementation, and there are already a number of good log analysis tools for it.
>
>

     Despite the fact it can work with some heavy tweaking as you 
pointed, it's important to have it clear that "it was NOT designed for 
that". Squid was designed to be an http/https proxy, not a general tcp 
applications one. As said, despite it can work, other solutions designed 
for that specific protocol will surely make a much better work.


-- 


	Atenciosamente / Sincerily,
	Leonardo Rodrigues
	Solutti Tecnologia
	http://www.solutti.com.br

	Minha armadilha de SPAM, N?O mandem email
	gertrudes at solutti.com.br
	My SPAMTRAP, do not email it





From jimoe at sohnen-moe.com  Tue Sep 30 22:34:14 2014
From: jimoe at sohnen-moe.com (James Moe)
Date: Tue, 30 Sep 2014 15:34:14 -0700
Subject: [squid-users] How to unblock a port
Message-ID: <sig.13508324ae.542B2FE6.4030003@sohnen-moe.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1


Squid rejects connections made with <https://sohnen-moe.com:2083/>. I
had thought that the ACL "acl Safe_ports port 1025-65535" was
sufficient. Obviously not.

What should I change to allow connections with port 2083?

- ----[ Excerpts from the conf: ]----

acl localnet src fc00::/7
acl localnet src fe80::/10
acl SSL_ports port 443
acl Safe_ports port 80
acl Safe_ports port 21
acl Safe_ports port 443
acl Safe_ports port 563
acl Safe_ports port 70
acl Safe_ports port 210
acl Safe_ports port 1025-65535
acl Safe_ports port 280
acl Safe_ports port 488
acl Safe_ports port 591
acl Safe_ports port 777
acl CONNECT method CONNECT
acl localnet src 192.168.69.0/24

http_access allow manager managerAdmin
http_access deny manager
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localnet
http_access deny all




- -- 
James Moe
moe dot james at sohnen-moe dot com
520.743.3936
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (GNU/Linux)

iEYEARECAAYFAlQrL+YACgkQzTcr8Prq0ZPhzwCgtfqmpUuOKvfp1elqnaMsRwAs
uj4AnjCfgbBYCE44UmdWfP/Lutudro8r
=Dvjw
-----END PGP SIGNATURE-----


From ambrose.li at gmail.com  Tue Sep 30 22:43:43 2014
From: ambrose.li at gmail.com (Ambrose LI)
Date: Tue, 30 Sep 2014 18:43:43 -0400
Subject: [squid-users] How to unblock a port
In-Reply-To: <sig.13508324ae.542B2FE6.4030003@sohnen-moe.com>
References: <sig.13508324ae.542B2FE6.4030003@sohnen-moe.com>
Message-ID: <CADJvFOW5xbQkzQ1TpOJ6QHbzuGC7Y9Y7y5c9sQWSQX-MkTLVsA@mail.gmail.com>

On 30 September 2014 18:34, James Moe <jimoe at sohnen-moe.com> wrote:
> Squid rejects connections made with <https://sohnen-moe.com:2083/>. I
> had thought that the ACL "acl Safe_ports port 1025-65535" was
> sufficient. Obviously not.
>
> What should I change to allow connections with port 2083?

You need SSL_ports instead of Safe_ports for https

-- 
cheers,
-ambrose <http://gniw.ca>


From jimoe at sohnen-moe.com  Tue Sep 30 22:55:28 2014
From: jimoe at sohnen-moe.com (James Moe)
Date: Tue, 30 Sep 2014 15:55:28 -0700
Subject: [squid-users] How to unblock a port
In-Reply-To: <CADJvFOW5xbQkzQ1TpOJ6QHbzuGC7Y9Y7y5c9sQWSQX-MkTLVsA@mail.gmail.com>
References: <542B2FE6.4030003@sohnen-moe.com>
 <CADJvFOW5xbQkzQ1TpOJ6QHbzuGC7Y9Y7y5c9sQWSQX-MkTLVsA@mail.gmail.com>
Message-ID: <sig.13503e6738.542B34E0.3050306@sohnen-moe.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 09/30/2014 03:43 PM, Ambrose LI wrote:
>> What should I change to allow connections with port 2083?
> You need SSL_ports instead of Safe_ports for https
> 
  Thank you!

- -- 
James Moe
moe dot james at sohnen-moe dot com
520.743.3936
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (GNU/Linux)

iEYEARECAAYFAlQrNOAACgkQzTcr8Prq0ZPwagCeKuOcC6h+jA2yBxdjAg+8MCxo
8KwAoI/C2zxNwlsTQ1YnyW2l4uA4GYjg
=LFg3
-----END PGP SIGNATURE-----


