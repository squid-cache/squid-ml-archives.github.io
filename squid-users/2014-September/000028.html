<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] 301 Error in squid -&gt; followed by 302
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20301%20Error%20in%20squid%20-%3E%20followed%20by%20302&In-Reply-To=%3C542ABE25.5080905%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000025.html">
   <LINK REL="Next"  HREF="000033.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] 301 Error in squid -&gt; followed by 302</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20301%20Error%20in%20squid%20-%3E%20followed%20by%20302&In-Reply-To=%3C542ABE25.5080905%40treenet.co.nz%3E"
       TITLE="[squid-users] 301 Error in squid -&gt; followed by 302">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Sep 30 14:28:53 UTC 2014</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="000025.html">[squid-users] 301 Error in squid -&gt; followed by 302
</A></li>
        <LI>Next message (by thread): <A HREF="000033.html">[squid-users] redirect all ports to squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28">[ date ]</a>
              <a href="thread.html#28">[ thread ]</a>
              <a href="subject.html#28">[ subject ]</a>
              <a href="author.html#28">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 1/10/2014 3:00 a.m., Mr C K wrote:
&gt;<i> Hmm, i see the problem but if i not use squid it works, i tried
</I>&gt;<i> squid in all different ways.
</I>&gt;<i> 
</I>&gt;<i> http_port 3128 http_port 3128 accell http_port 3128 intercept
</I>&gt;<i> 
</I>&gt;<i> not tproxy since i use FreeBSD.
</I>&gt;<i> 
</I>&gt;<i> Could it be since i'm running parent and siblings ?
</I>&gt;<i> 
</I>&gt;<i> Thank you anyway - but if you know more feed me if you want. :)
</I>&gt;<i> 
</I>

Using the squidclient tool to try and replicate the problem here I see
that <A HREF="http://www.hotmail.com/">http://www.hotmail.com/</A> redirects with a 301 as you describe.

But it redirects to <A HREF="https://mail.live.com/default.aspx.">https://mail.live.com/default.aspx.</A>
 * if you are intercepting the traffic that URL should not be going
through your Squid at all since you are not doing HTTPS interception.
 * if your browser is configured to use the proxy explicitly it should
be going through Squid as a &quot;CONNECT mail.live.com:443&quot; request. Which
gets tunneled directly to the mail.live.com server.

If the browser does not deliver one or more of several Cookie headers
correctly the HTTPS request to mail.live.com redirects with 302 to
<A HREF="https://login.live.com/login.srf?wa=...">https://login.live.com/login.srf?wa=...</A> which in turn asks for
credentials.

Not having a hotmail account I stop tracing at that point.


I have one suspicion...
  do you have the Squid directive balance_on_multiple_ip configured to
ON ?
  The hotmail security system used to (maybe still?) require all
inbound connections from one client to be using a single identical IP
address contacting a single server at the hotmail end of things. The
balance_on_multiple_ip directive forces Squid to break that assumption
and use a different origin server on every single request.

Amos



&gt;<i> 2014-09-30 15:48 GMT+02:00 Amos Jeffries: On 1/10/2014 1:45 a.m.,
</I>&gt;<i> Mr C K wrote:
</I>&gt;&gt;&gt;&gt;<i> When i use squid and get headers like,
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> HTTP/1.1 301 Moved Permanently Location:
</I>&gt;&gt;&gt;&gt;<i> <A HREF="http://www.hotmail.com/">http://www.hotmail.com/</A>
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> squid ends up in a endless loop.
</I>&gt;<i> 
</I>&gt;<i> Not Squid.
</I>&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> ERR_TOO_MANY_REDIRECTS
</I>&gt;<i> 
</I>&gt;<i> This is a Chrome web browser error.
</I>&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> Some say to use u url_rewriter or location_rewrite, but how
</I>&gt;&gt;&gt;&gt;<i> and where to read more about this.
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> or is it that simple that squid can't handle this type of 
</I>&gt;&gt;&gt;&gt;<i> redirect?
</I>&gt;<i> 
</I>&gt;<i> There is nothing to &quot;handle&quot; here.
</I>&gt;<i> 
</I>&gt;<i> 1a) Squid takes some request from the client and passes it to the 
</I>&gt;<i> server, which responds with 301. 1b) Squid takes the 301 and
</I>&gt;<i> delivers it to the client.
</I>&gt;<i> 
</I>&gt;<i> 2a) Squid takes client followup request for the new Location URL
</I>&gt;<i> and passes it to the server, which responds with 302 pointing back
</I>&gt;<i> to the first URL. 2b) Squid takes the 302 and delivers it to the
</I>&gt;<i> client.
</I>&gt;<i> 
</I>&gt;<i> 3a) goto 1a.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> See the problem?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Amos
</I>&gt;<i> 
</I>&gt;&gt;<i> _______________________________________________ squid-users
</I>&gt;&gt;<i> mailing list <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> 
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUKr4kAAoJELJo5wb/XPRjdu0H/0zz+InLdijPGj3q6hqBmVJS
aJNe8TGCYUpeNbjfqv6eK8xmvzo0clwHy3GBMwwb9oOBeEwnCb8uMX+wYMg9t34R
ZVrVJ6zjNHUKJru2+W/1NGVLGm9JmLQmTIlwGZK/RrSsVQgHCapRA8RXiFa/l1gf
iHTyS2mwOc+MXg+jjCh/fRLAJBLOpDwc57AmMdh/T5N97yLnFrQy3O2iDnYN8RS6
vTrmQxmo9bt//s2PktxpqpAzOHFrZRA1jmSf+dD4qtyYwkmrF1a1SaguQD8IuU3n
o11+JBCxf51hfFWfnYMXl+H+2VSwzqeBdGkho5L7n81SUG1lKtwXmKP6p6xR1qw=
=4BdT
-----END PGP SIGNATURE-----

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="000025.html">[squid-users] 301 Error in squid -&gt; followed by 302
</A></li>
	<LI>Next message (by thread): <A HREF="000033.html">[squid-users] redirect all ports to squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28">[ date ]</a>
              <a href="thread.html#28">[ thread ]</a>
              <a href="subject.html#28">[ subject ]</a>
              <a href="author.html#28">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
