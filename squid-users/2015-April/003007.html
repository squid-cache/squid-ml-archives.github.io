<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] NTLM authentication problems with HTTP 1.1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20NTLM%20authentication%20problems%20with%20HTTP%201.1&In-Reply-To=%3CCAP6yRXjmMusAVAD0YR1Bpq3Dk_Vg4_bh%3DehxHp0OK7c1b1KJ5A%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003006.html">
   <LINK REL="Next"  HREF="003008.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] NTLM authentication problems with HTTP 1.1</H1>
    <B>Samuel Anderson</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20NTLM%20authentication%20problems%20with%20HTTP%201.1&In-Reply-To=%3CCAP6yRXjmMusAVAD0YR1Bpq3Dk_Vg4_bh%3DehxHp0OK7c1b1KJ5A%40mail.gmail.com%3E"
       TITLE="[squid-users] NTLM authentication problems with HTTP 1.1">sam at idsdoc.com
       </A><BR>
    <I>Wed Apr  8 15:20:45 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003006.html">[squid-users] Transparent Proxy
</A></li>
        <LI>Next message (by thread): <A HREF="003008.html">[squid-users] NTLM authentication problems with HTTP 1.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3007">[ date ]</a>
              <a href="thread.html#3007">[ thread ]</a>
              <a href="subject.html#3007">[ subject ]</a>
              <a href="author.html#3007">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello all,


I'm having a problem where HTTP 1.1 connect requests do not authenticate
using NTLM. Browsing the internet works fine in all major browsers, I
mostly see this occurring in programs that are installed locally on a users
computer. Using wireshark I'm able to follow the TCP stream and I can see
that the server returns the error (407 Proxy Authentication Required). I am
able to work around this problem by explicitly bypassing a domain from
requiring authentication, however I really don't want to do that. Any ideas
would be appreciated very much.

Thanks,


Below is the content summery of some of the network packets that I'm
working with along with my config file

TCP Stream Content

####################
CONNECT batch.internetpostage.com:443 HTTP/1.1
Host: batch.internetpostage.com
Proxy-Connection: Keep-Alive


HTTP/1.1 407 Proxy Authentication Required
Server: squid/3.3.8
Mime-Version: 1.0
Date: Tue, 07 Apr 2015 21:02:24 GMT
Content-Type: text/html
Content-Length: 3208
X-Squid-Error: ERR_CACHE_ACCESS_DENIED 0
Proxy-Authenticate: Negotiate
Proxy-Authenticate: NTLM
X-Cache: MISS from squid2.****.local
X-Cache-Lookup: NONE from squid2.****.local:3128
Via: 1.1 squid2.****.local (squid/3.3.8)
Connection: close
####################

CONFIG File

####################

#Kerberos and NTLM authentication

auth_param negotiate program /usr/local/bin/negotiate_wrapper --ntlm
/usr/bin/ntlm_auth --diagnostics --helper-protocol=squid-2.5-ntlmssp
--domain=****.LOCAL --kerberos /usr/lib/squid3/negotiate_kerberos_auth -d
-s GSS_C_NO_NAME
auth_param negotiate children 30
auth_param negotiate keep_alive off

auth_param ntlm program /usr/bin/ntlm_auth
--helper-protocol=squid-2.5-ntlmssp --domain=****
auth_param ntlm children 30
auth_param ntlm keep_alive off

# AD group membership lookup

external_acl_type ldap_group ttl=60 children-startup=10 children-max=50
children-idle=2 %LOGIN /usr/lib/squid3/ext_ldap_group_acl -R -K -S -b
&quot;DC=****,DC=local&quot; -D &quot;CN=SQUID,OU=**** Service Accounts,DC=****,DC=local&quot;
-w &quot;****&quot; -f &quot;(&amp;(objectclass=person)
(sAMAccountname=%v)(memberof=CN=%a,OU=PROXY,ou=ALL **** Groups,DC=****
,DC=local))&quot; -h dc1.****.local,dc2.****.local,dc3.****.local,dc4.****.local

# auth required

acl auth proxy_auth REQUIRED
http_access deny !auth all

####################

-- 
Samuel Anderson  |  Information Technology Administrator  |  International
Document Services

IDS  |  11629 South 700 East, Suite 200  |  Draper, UT 84020-4607

-- 
CONFIDENTIALITY NOTICE:
This e-mail and any attachments are confidential. If you are not an 
intended recipient, please contact the sender to report the error and 
delete all copies of this message from your system.  Any unauthorized 
review, use, disclosure or distribution is prohibited.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150408/e5302192/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150408/e5302192/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003006.html">[squid-users] Transparent Proxy
</A></li>
	<LI>Next message (by thread): <A HREF="003008.html">[squid-users] NTLM authentication problems with HTTP 1.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3007">[ date ]</a>
              <a href="thread.html#3007">[ thread ]</a>
              <a href="subject.html#3007">[ subject ]</a>
              <a href="author.html#3007">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
