<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] NTLM authentication problems with HTTP 1.1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20NTLM%20authentication%20problems%20with%20HTTP%201.1&In-Reply-To=%3CCAP6yRXjvNzQ1DFSHMQjmio8ov75%3DqT3ZYbqJcUkBvbS8KokJPg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003008.html">
   <LINK REL="Next"  HREF="003010.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] NTLM authentication problems with HTTP 1.1</H1>
    <B>Samuel Anderson</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20NTLM%20authentication%20problems%20with%20HTTP%201.1&In-Reply-To=%3CCAP6yRXjvNzQ1DFSHMQjmio8ov75%3DqT3ZYbqJcUkBvbS8KokJPg%40mail.gmail.com%3E"
       TITLE="[squid-users] NTLM authentication problems with HTTP 1.1">sam at idsdoc.com
       </A><BR>
    <I>Wed Apr  8 17:42:48 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003008.html">[squid-users] NTLM authentication problems with HTTP 1.1
</A></li>
        <LI>Next message (by thread): <A HREF="003010.html">[squid-users] NTLM authentication problems with HTTP 1.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3009">[ date ]</a>
              <a href="thread.html#3009">[ thread ]</a>
              <a href="subject.html#3009">[ subject ]</a>
              <a href="author.html#3009">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Oh okay, that makes sense.

Thanks brendan

On Wed, Apr 8, 2015 at 1:20 PM, brendan kearney &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">bpk678 at gmail.com</A>&gt; wrote:

&gt;<i> Note the lack of a user-agent string.  This is likely an app that cannot
</I>&gt;<i> authenticate.
</I>&gt;<i>
</I>&gt;<i> My standard for Auth Bypass is source IP, user-agent string and
</I>&gt;<i> destination URL.  Generally the source is preferred to be statically
</I>&gt;<i> assigned otherwise you need to allow the entire dhcp pool or range.
</I>&gt;<i> Because there is no user-agent you can drop the requirement or force it
</I>&gt;<i> with some sort of negated logic (!any)
</I>&gt;<i> On Apr 8, 2015 11:21 AM, &quot;Samuel Anderson&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">sam at idsdoc.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hello all,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'm having a problem where HTTP 1.1 connect requests do not authenticate
</I>&gt;&gt;<i> using NTLM. Browsing the internet works fine in all major browsers, I
</I>&gt;&gt;<i> mostly see this occurring in programs that are installed locally on a users
</I>&gt;&gt;<i> computer. Using wireshark I'm able to follow the TCP stream and I can see
</I>&gt;&gt;<i> that the server returns the error (407 Proxy Authentication Required). I am
</I>&gt;&gt;<i> able to work around this problem by explicitly bypassing a domain from
</I>&gt;&gt;<i> requiring authentication, however I really don't want to do that. Any ideas
</I>&gt;&gt;<i> would be appreciated very much.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Below is the content summery of some of the network packets that I'm
</I>&gt;&gt;<i> working with along with my config file
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> TCP Stream Content
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ####################
</I>&gt;&gt;<i> CONNECT batch.internetpostage.com:443 HTTP/1.1
</I>&gt;&gt;<i> Host: batch.internetpostage.com
</I>&gt;&gt;<i> Proxy-Connection: Keep-Alive
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> HTTP/1.1 407 Proxy Authentication Required
</I>&gt;&gt;<i> Server: squid/3.3.8
</I>&gt;&gt;<i> Mime-Version: 1.0
</I>&gt;&gt;<i> Date: Tue, 07 Apr 2015 21:02:24 GMT
</I>&gt;&gt;<i> Content-Type: text/html
</I>&gt;&gt;<i> Content-Length: 3208
</I>&gt;&gt;<i> X-Squid-Error: ERR_CACHE_ACCESS_DENIED 0
</I>&gt;&gt;<i> Proxy-Authenticate: Negotiate
</I>&gt;&gt;<i> Proxy-Authenticate: NTLM
</I>&gt;&gt;<i> X-Cache: MISS from squid2.****.local
</I>&gt;&gt;<i> X-Cache-Lookup: NONE from squid2.****.local:3128
</I>&gt;&gt;<i> Via: 1.1 squid2.****.local (squid/3.3.8)
</I>&gt;&gt;<i> Connection: close
</I>&gt;&gt;<i> ####################
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> CONFIG File
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ####################
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> #Kerberos and NTLM authentication
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> auth_param negotiate program /usr/local/bin/negotiate_wrapper --ntlm
</I>&gt;&gt;<i> /usr/bin/ntlm_auth --diagnostics --helper-protocol=squid-2.5-ntlmssp
</I>&gt;&gt;<i> --domain=****.LOCAL --kerberos /usr/lib/squid3/negotiate_kerberos_auth -d
</I>&gt;&gt;<i> -s GSS_C_NO_NAME
</I>&gt;&gt;<i> auth_param negotiate children 30
</I>&gt;&gt;<i> auth_param negotiate keep_alive off
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> auth_param ntlm program /usr/bin/ntlm_auth
</I>&gt;&gt;<i> --helper-protocol=squid-2.5-ntlmssp --domain=****
</I>&gt;&gt;<i> auth_param ntlm children 30
</I>&gt;&gt;<i> auth_param ntlm keep_alive off
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # AD group membership lookup
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> external_acl_type ldap_group ttl=60 children-startup=10 children-max=50
</I>&gt;&gt;<i> children-idle=2 %LOGIN /usr/lib/squid3/ext_ldap_group_acl -R -K -S -b
</I>&gt;&gt;<i> &quot;DC=****,DC=local&quot; -D &quot;CN=SQUID,OU=**** Service Accounts,DC=****,DC=local&quot;
</I>&gt;&gt;<i> -w &quot;****&quot; -f &quot;(&amp;(objectclass=person)
</I>&gt;&gt;<i> (sAMAccountname=%v)(memberof=CN=%a,OU=PROXY,ou=ALL **** Groups,DC=****
</I>&gt;&gt;<i> ,DC=local))&quot; -h dc1.****.local,dc2.****.local,dc3.****.local,dc4.****.local
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # auth required
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> acl auth proxy_auth REQUIRED
</I>&gt;&gt;<i> http_access deny !auth all
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ####################
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> Samuel Anderson  |  Information Technology Administrator  |
</I>&gt;&gt;<i>  International Document Services
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> IDS  |  11629 South 700 East, Suite 200  |  Draper, UT 84020-4607
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> CONFIDENTIALITY NOTICE:
</I>&gt;&gt;<i> This e-mail and any attachments are confidential. If you are not an
</I>&gt;&gt;<i> intended recipient, please contact the sender to report the error and
</I>&gt;&gt;<i> delete all copies of this message from your system.  Any unauthorized
</I>&gt;&gt;<i> review, use, disclosure or distribution is prohibited.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>

-- 
Samuel Anderson  |  Information Technology Administrator  |  International
Document Services

IDS  |  11629 South 700 East, Suite 200  |  Draper, UT 84020-4607

-- 
CONFIDENTIALITY NOTICE:
This e-mail and any attachments are confidential. If you are not an 
intended recipient, please contact the sender to report the error and 
delete all copies of this message from your system.  Any unauthorized 
review, use, disclosure or distribution is prohibited.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150408/03d2f9e8/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150408/03d2f9e8/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003008.html">[squid-users] NTLM authentication problems with HTTP 1.1
</A></li>
	<LI>Next message (by thread): <A HREF="003010.html">[squid-users] NTLM authentication problems with HTTP 1.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3009">[ date ]</a>
              <a href="thread.html#3009">[ thread ]</a>
              <a href="subject.html#3009">[ subject ]</a>
              <a href="author.html#3009">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
