<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] T3/T3S Protocol
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20T3/T3S%20Protocol&In-Reply-To=%3C552A1C1D.8070100%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003048.html">
   <LINK REL="Next"  HREF="003051.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] T3/T3S Protocol</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20T3/T3S%20Protocol&In-Reply-To=%3C552A1C1D.8070100%40treenet.co.nz%3E"
       TITLE="[squid-users] T3/T3S Protocol">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Apr 12 07:17:49 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003048.html">[squid-users] T3/T3S Protocol
</A></li>
        <LI>Next message (by thread): <A HREF="003051.html">[squid-users] BUG 3279: HTTP reply without Date:
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3049">[ date ]</a>
              <a href="thread.html#3049">[ thread ]</a>
              <a href="subject.html#3049">[ subject ]</a>
              <a href="author.html#3049">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12/04/2015 4:41 p.m., Farci, Anatole V wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I have a JavaClient that uses T3S:443 to connect to Oracle's WLS
</I>application server. WLS is in DMZ and I have Squid proxy between the DMZ
and our Intranet (in its own DMZ) to fwd all requests to WLS. The ports
(443) is open since the browsers can talk to the WLS but it appears that
the T3S is not going thru the proxy. I have searched to see what I can
add to allow this T3 (RMI protocol) to go thru and our Squid
configuration is very simple and have a whitelist and allows all traffic
on port 80 and 443 to go thru.
&gt;<i> 
</I>&gt;<i> On the client side, I get this error:
</I>&gt;<i> javax.naming.CommunicationException [Root exception is java.net.ConnectException: t3<A HREF="s://xxxx.yyy.intel.com:443:">s://xxxx.yyy.intel.com:443:</A> Destination xxx.yyy.zzz.www, 443 unreachable; nested exception is:
</I>&gt;<i>         java.net.ConnectException: Connection timed out: connect; No available router to destination]
</I>
Does this Java application support HTTP proxying ?

Squid is an HTTP proxy, use of any other protocol over it has to be via
HTTP mechanisms. CONNECT requests in this case. It wont help at all if
the Java application cannot do HTTP enough to perform an HTTP CONNECT
request.

&gt;<i> 
</I>&gt;<i> on the Squid Acccess.log where &lt;dns&gt; and &lt;fqdn&gt; are the correct values and using a browser, I can open reach the WLS with either of them using HTTPS:443
</I>&gt;<i> 1428776399.835  27238 10.254.98.83 TCP_MISS/200 2439 CONNECT &lt;dns&gt;.intel.com:443 - DIRECT/xxx.yyy.zzz.www -
</I>&gt;<i> 1428776414.999  15117 10.254.98.83 TCP_MISS/200 2199 CONNECT &lt;dns&gt;.intel.com:443 - DIRECT/xxx.yyy.zzz.www -
</I>&gt;<i> 1428776430.068  27768 10.254.98.83 TCP_MISS/200 9658 CONNECT &lt;dns&gt;.intel.com:443 - DIRECT/xxx.yyy.zzz.www -
</I>&gt;<i> 1428776445.200  15085 10.254.98.83 TCP_MISS/200 2439 CONNECT &lt;dns&gt;.intel.com:443 - DIRECT/xxx.yyy.zzz.www -
</I>&gt;<i> 1428776460.396  15118 10.254.98.83 TCP_MISS/200 2439 CONNECT &lt;dns&gt;.intel.com:443 - DIRECT/xxx.yyy.zzz.www -
</I>&gt;<i> 1428776480.270  15211 10.254.98.83 TCP_MISS/200 9722 CONNECT &lt;FQDN&gt;.intel.com:443 - DIRECT/xxx.yyy.zzz.www -
</I>&gt;<i> 1428776495.293  27207 10.254.98.83 TCP_MISS/200 2439 CONNECT &lt;dns&gt;.intel.com:443 - DIRECT/xxx.yyy.zzz.www -
</I>&gt;<i> 
</I>
Yes. However note that HTTPS != T3S


&gt;<i> Store.log has this one entry only:
</I>&gt;<i> 1428773672.888 RELEASE -1 FFFFFFFF 93F32BC091B147DF27B4355731396BC9  200 1428770072 1428770072 1428773672 application/cache-digest 144/144 GET <A HREF="internal://proxy..intel.com/squid-internal-periodic/store_digest">internal://proxy..intel.com/squid-internal-periodic/store_digest</A>
</I>&gt;<i> 
</I>
CONNECT are not cacheable. There is nothing that can be stored to disk.


&gt;<i> and the squid config looks like this:
</I>&gt;<i> visible_hostname proxy.intel.com
</I>&gt;<i> http_port 912
</I>
APEX and HTTP protocols are not safe to be mixing up. Use of 3128 is
sufficient for Squid proxy (its even registered for Squid use).

&gt;<i> 
</I>&gt;<i> logfile_rotate 30
</I>&gt;<i> cache_access_log C:/squid/var/logs/access.log
</I>
That should be:
 access_log C:/squid/var/logs/access.log


&gt;<i> 
</I>&gt;<i> acl all src 0.0.0.0/0.0.0.0
</I>&gt;<i> acl whitelist dstdomain .intel.com
</I>&gt;<i> acl http proto http t3
</I>&gt;<i> acl port_80 port 80
</I>&gt;<i> acl port_443 port 443
</I>&gt;<i> acl port_23791 port 23791
</I>&gt;<i> acl CONNECT method CONNECT
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> # rules allowing non-authenticated users
</I>&gt;<i> http_access allow http port_80 whitelist
</I>&gt;<i> http_access allow CONNECT port_443 whitelist
</I>&gt;<i> http_access allow CONNECT port_23791 whitelist
</I>
Highly dangerous. Please use the recommended defaults:

 acl SSL_ports port 443
 acl Safe_ports port 80          # http
 acl Safe_ports port 21          # ftp
 acl Safe_ports port 443         # https
 acl Safe_ports port 70          # gopher
 acl Safe_ports port 210         # wais
 acl Safe_ports port 1025-65535  # unregistered ports
 acl Safe_ports port 280         # http-mgmt
 acl Safe_ports port 488         # gss-http
 acl Safe_ports port 591         # filemaker
 acl Safe_ports port 777         # multiling http

 http_access deny !Safe_ports
 http_access deny CONNECT !SSL_ports

 # Then your bit...
 http_access allow whitelist

 http_access deny all


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003048.html">[squid-users] T3/T3S Protocol
</A></li>
	<LI>Next message (by thread): <A HREF="003051.html">[squid-users] BUG 3279: HTTP reply without Date:
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3049">[ date ]</a>
              <a href="thread.html#3049">[ thread ]</a>
              <a href="subject.html#3049">[ subject ]</a>
              <a href="author.html#3049">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
