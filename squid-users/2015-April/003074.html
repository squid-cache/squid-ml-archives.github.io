<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] does http_port sssl-bump work	require-proxy-header?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20does%20http_port%20sssl-bump%20work%0A%09require-proxy-header%3F&In-Reply-To=%3CCAMjA_BkeMG4wUvuS_BEBdiF%3D5Xz9KU--oaLFmiapM1%2BdaWPZtw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003066.html">
   <LINK REL="Next"  HREF="003083.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] does http_port sssl-bump work	require-proxy-header?</H1>
    <B>Yuhua Wu</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20does%20http_port%20sssl-bump%20work%0A%09require-proxy-header%3F&In-Reply-To=%3CCAMjA_BkeMG4wUvuS_BEBdiF%3D5Xz9KU--oaLFmiapM1%2BdaWPZtw%40mail.gmail.com%3E"
       TITLE="[squid-users] does http_port sssl-bump work	require-proxy-header?">ywu at bitglass.com
       </A><BR>
    <I>Tue Apr 14 17:05:39 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003066.html">[squid-users] does http_port sssl-bump work	require-proxy-header?
</A></li>
        <LI>Next message (by thread): <A HREF="003083.html">[squid-users] does http_port sssl-bump work	require-proxy-header?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3074">[ date ]</a>
              <a href="thread.html#3074">[ thread ]</a>
              <a href="subject.html#3074">[ subject ]</a>
              <a href="author.html#3074">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I think, in the sslbump mode, if PROXY protocol is enabled, client cannot
set up the SSL tunnel with squid after CONNECT call succeeds. I remember
that HAProxy will send PROXY protocol line during ssl negotiation. If squid
does not parse the PROXY protocol header during SSL negotiation, this will
cause the problem.

Alex

On Mon, Apr 13, 2015 at 7:56 PM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:

&gt;<i> On 14/04/2015 4:47 a.m., Yuhua Wu wrote:
</I>&gt;<i> &gt; For example, is this configuration supported?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; http_port 3129 require-proxy-header ssl-bump &#8230;&#8230;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; By the way, we added acl rules:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl frontend src 10.0.0.0/8
</I>&gt;<i> &gt; proxy_protocol_access allow frontend
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Alex
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> Yes that should work.
</I>&gt;<i>
</I>&gt;<i> &lt;<A HREF="http://www.squid-cache.org/Versions/v3/3.5/RELEASENOTES.html#ss2.7">http://www.squid-cache.org/Versions/v3/3.5/RELEASENOTES.html#ss2.7</A>&gt;
</I>&gt;<i>
</I>&gt;<i> Your above config example decrypts the traffic through the following
</I>&gt;<i> layers:
</I>&gt;<i>   HTTPS over HTTP/1.x over PROXY/TCP ...
</I>&gt;<i>
</I>&gt;<i> As you can see the PROXY and HTTPS layers are separate protocols that
</I>&gt;<i> dont interact.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150414/7e2aac7d/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150414/7e2aac7d/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003066.html">[squid-users] does http_port sssl-bump work	require-proxy-header?
</A></li>
	<LI>Next message (by thread): <A HREF="003083.html">[squid-users] does http_port sssl-bump work	require-proxy-header?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3074">[ date ]</a>
              <a href="thread.html#3074">[ thread ]</a>
              <a href="subject.html#3074">[ subject ]</a>
              <a href="author.html#3074">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
