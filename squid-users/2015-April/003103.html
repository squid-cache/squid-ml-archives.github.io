<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3.4.8 - Forwarding loop detected - Squid doesn't forward request to outside
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.4.8%20-%20Forwarding%20loop%20detected%20-%20Squid%0A%20doesn%27t%20forward%20request%20to%20outside&In-Reply-To=%3C552E47A0.4070300%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003098.html">
   <LINK REL="Next"  HREF="003109.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3.4.8 - Forwarding loop detected - Squid doesn't forward request to outside</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.4.8%20-%20Forwarding%20loop%20detected%20-%20Squid%0A%20doesn%27t%20forward%20request%20to%20outside&In-Reply-To=%3C552E47A0.4070300%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid 3.4.8 - Forwarding loop detected - Squid doesn't forward request to outside">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Apr 15 11:12:32 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003098.html">[squid-users] Squid 3.4.8 - Forwarding loop detected - Squid doesn't forward request to outside
</A></li>
        <LI>Next message (by thread): <A HREF="003109.html">[squid-users] Integrate Squid Kerberos auth and Squidguard	ldapusersearch into AD
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3103">[ date ]</a>
              <a href="thread.html#3103">[ thread ]</a>
              <a href="subject.html#3103">[ subject ]</a>
              <a href="author.html#3103">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 15/04/2015 10:21 p.m., Keyvan Hedayati wrote:
&gt;<i> Hi
</I>&gt;<i> I'm having trouble setting a transparent proxy in our network.
</I>&gt;<i> For testing I've asked our net admin to transparently forward all of my
</I>&gt;<i> http traffic to squid port but when I try to open a page I get *Access
</I>&gt;<i> Denied *error and a warring about Forwarding loop.
</I>&gt;<i> As you can see in tcpdump squid sends request to it's machine and not to
</I>&gt;<i> outside and I've no idea why this happens.
</I>&gt;<i> Can you help my about this? I feel like I'm missing something tiny here.
</I>&gt;<i> 
</I>&gt;<i> Squid box: 172.16.1.5
</I>&gt;<i> My box: 192.168.10.122
</I>&gt;<i> 
</I>&gt;<i> Thanks
</I>&gt;<i> 
</I>&gt;<i> -------------------- tcpdump -ntAi any port ! 22
</I>&gt;<i> IP 192.168.10.122.59550 &gt; 172.16.1.5.3128: Flags [S], seq 1494863721, win
</I>&gt;<i> 29200, options [mss 1460,sackOK,TS val 5421406 ecr 0,nop,wscale 7], length 0
</I>
Wheres the origin server IP?

 google.com:80 != 172.16.1.5:3128

If you are performing NAT on a machine other than the Squid box you are
guaranteed to get this type of forwarding loop.


One of these almost identical configs is the correct Squid box config
for you:
 &lt;<A HREF="http://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxRedirect">http://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxRedirect</A>&gt;
 &lt;<A HREF="http://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxDnat">http://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxDnat</A>&gt;

DNAT is best if you have static IPs in a high-peformance situation,
REDIRECT if you have DHCP assigned / dynamic proxy IPs or are unsure
what the final machine IP will be (ie plug-n-play proxy device).


You also need the router changed to *route* the packets to the Squid
machine without NAT'ing them in any way. There may be other devices
along the packet path needing updates to handle the new route properly,
your sysadmin should know what to do about all that.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003098.html">[squid-users] Squid 3.4.8 - Forwarding loop detected - Squid doesn't forward request to outside
</A></li>
	<LI>Next message (by thread): <A HREF="003109.html">[squid-users] Integrate Squid Kerberos auth and Squidguard	ldapusersearch into AD
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3103">[ date ]</a>
              <a href="thread.html#3103">[ thread ]</a>
              <a href="subject.html#3103">[ subject ]</a>
              <a href="author.html#3103">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
