<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid logs not rotating
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20logs%20not%20rotating&In-Reply-To=%3C81D4BEDF5F61664A9ADB2FF8E4AA61BD24C169D5%40EXCH-MBX-PRD-T3.usq.edu.au%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003285.html">
   <LINK REL="Next"  HREF="003162.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid logs not rotating</H1>
    <B>Gary Woodman</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20logs%20not%20rotating&In-Reply-To=%3C81D4BEDF5F61664A9ADB2FF8E4AA61BD24C169D5%40EXCH-MBX-PRD-T3.usq.edu.au%3E"
       TITLE="[squid-users] squid logs not rotating">Gary.Woodman at usq.edu.au
       </A><BR>
    <I>Fri Apr 17 07:45:44 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003285.html">[squid-users] assertion failed: comm.cc:557: &quot;F-&gt;flags.open&quot;
</A></li>
        <LI>Next message (by thread): <A HREF="003162.html">[squid-users] squid logs not rotating
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3140">[ date ]</a>
              <a href="thread.html#3140">[ thread ]</a>
              <a href="subject.html#3140">[ subject ]</a>
              <a href="author.html#3140">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Greetings!

We have a couple of instances of squid to service our students' Internet access.

Squid version is:
Squid Cache: Version 3.4.10
We use the pre-packaged Red Hat binary from <A HREF="http://www1.ngtech.co.il/repo/centos/,">http://www1.ngtech.co.il/repo/centos/,</A> as linked to from the squid wiki, as the Red Hat version is rather old.

The two instances are effectively identical; they are not peered, we just use round-robin DNS. We have a script to sync the configs (barring obvious things like tcp_outgoing_address and visible_hostname).

The first system, I'll call T1, functions fine and specifically, the logging behaves as expected and like all our other squid instances. We have &quot;log_rotate 30&quot; to keep 30 days of logs, and &quot;squid -k rotate&quot; at midnight via cron. The rotate renumbers all the logs, and squid starts writing in a new access.log. This is our main interest, as data from access logs feeds our quotaing and other usage reports.

The second system, T2, has the same setup and while it renumbers the logs all right, it doesn't close them or start writing in new ones. Thus we see a succession of zero-length access.logs, eventually access.log.29 reaches over 3 gigabytes, and on the next rotation, the whole lot is thrown away and squid finally starts writing in a fresh access.log, which gradually works its way up to access.log.29 again in the next log_rotate cycle. This is rather disadvantageous, as most of the time there will not be 30 days worth of data in the logs like on T1.

Other logs such as cache.log and store.log suffer equally the same buildup and wipe.

Does anyone have any suggestions? How might we go about debugging this situation?


Regards
Gary

Gary Woodman
Enterprise Systems Engineer

ICT Infrastructure Services | ICT Services | University of Southern Queensland
Toowoomba | Queensland | 4350 | Australia
Phone: +61 7 4631 1688 | Fax: +61 7 4631 2798
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">gary.woodman at usq.edu.au</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">gary.woodman at usq.edu.au</A>&gt;
(CRICOS No: 00244B QLD; 02225M NSW; TEQSA PRV12081)



_____________________________________________________________
This email (including any attached files) is confidential and is for the intended recipient(s) only. If you received this email by mistake, please, as a courtesy, tell the sender, then delete this email.

The views and opinions are the originator's and do not necessarily reflect those of the University of Southern Queensland. Although all reasonable precautions were taken to ensure that this email contained no viruses at the time it was sent we accept no liability for any losses arising from its receipt.

The University of Southern Queensland is a registered provider of education with the Australian Government.
(CRICOS Institution Code QLD 00244B / NSW 02225M, TEQSA PRV12081 )

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150417/7ee473ce/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150417/7ee473ce/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003285.html">[squid-users] assertion failed: comm.cc:557: &quot;F-&gt;flags.open&quot;
</A></li>
	<LI>Next message (by thread): <A HREF="003162.html">[squid-users] squid logs not rotating
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3140">[ date ]</a>
              <a href="thread.html#3140">[ thread ]</a>
              <a href="subject.html#3140">[ subject ]</a>
              <a href="author.html#3140">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
