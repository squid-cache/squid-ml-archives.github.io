<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid logs not rotating
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20logs%20not%20rotating&In-Reply-To=%3C5533A8A0.4090507%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003140.html">
   <LINK REL="Next"  HREF="003297.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid logs not rotating</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20logs%20not%20rotating&In-Reply-To=%3C5533A8A0.4090507%40treenet.co.nz%3E"
       TITLE="[squid-users] squid logs not rotating">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Apr 19 13:07:44 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003140.html">[squid-users] squid logs not rotating
</A></li>
        <LI>Next message (by thread): <A HREF="003297.html">[squid-users] squid logs not rotating
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3162">[ date ]</a>
              <a href="thread.html#3162">[ thread ]</a>
              <a href="subject.html#3162">[ subject ]</a>
              <a href="author.html#3162">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 17/04/2015 7:45 p.m., Gary Woodman wrote:
&gt;<i> Greetings!
</I>&gt;<i> 
</I>&gt;<i> We have a couple of instances of squid to service our students' Internet access.
</I>&gt;<i> 
</I>&gt;<i> Squid version is:
</I>&gt;<i> Squid Cache: Version 3.4.10
</I>&gt;<i> We use the pre-packaged Red Hat binary from <A HREF="http://www1.ngtech.co.il/repo/centos/,">http://www1.ngtech.co.il/repo/centos/,</A> as linked to from the squid wiki, as the Red Hat version is rather old.
</I>&gt;<i> 
</I>&gt;<i> The two instances are effectively identical; they are not peered, we just use round-robin DNS. We have a script to sync the configs (barring obvious things like tcp_outgoing_address and visible_hostname).
</I>&gt;<i> 
</I>&gt;<i> The first system, I'll call T1, functions fine and specifically, the logging behaves as expected and like all our other squid instances. We have &quot;log_rotate 30&quot; to keep 30 days of logs, and &quot;squid -k rotate&quot; at midnight via cron. The rotate renumbers all the logs, and squid starts writing in a new access.log. This is our main interest, as data from access logs feeds our quotaing and other usage reports.
</I>&gt;<i> 
</I>&gt;<i> The second system, T2, has the same setup and while it renumbers the logs all right, it doesn't close them or start writing in new ones. Thus we see a succession of zero-length access.logs, eventually access.log.29 reaches over 3 gigabytes, and on the next rotation, the whole lot is thrown away and squid finally starts writing in a fresh access.log, which gradually works its way up to access.log.29 again in the next log_rotate cycle. This is rather disadvantageous, as most of the time there will not be 30 days worth of data in the logs like on T1.
</I>&gt;<i> 
</I>&gt;<i> Other logs such as cache.log and store.log suffer equally the same buildup and wipe.
</I>&gt;<i> 
</I>&gt;<i> Does anyone have any suggestions? How might we go about debugging this situation?
</I>
I'd almost guarantee you the log rotation script is different on the two
servers.

Most systems use the OS provided log rotation service, which does the
rotate atomically then runs squid -k rotate. squid.conf has
&quot;logfile_rotate 0&quot; to prevent Squid touching the OS rotation numbering.

What you describe is classic symptoms of the OS rotating logs, but only
doing the &quot;squid -k rotate&quot; action once every month.


HTH
Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003140.html">[squid-users] squid logs not rotating
</A></li>
	<LI>Next message (by thread): <A HREF="003297.html">[squid-users] squid logs not rotating
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3162">[ date ]</a>
              <a href="thread.html#3162">[ thread ]</a>
              <a href="subject.html#3162">[ subject ]</a>
              <a href="author.html#3162">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
