<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] WARNING: Tos value ... adjusted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20WARNING%3A%20Tos%20value%20...%20adjusted&In-Reply-To=%3CCAKOb%3DYYbTitQeLLyUUW%2BDPBNrmFOOhnu3YzHNVxFoWaY4Ge7sA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003223.html">
   <LINK REL="Next"  HREF="003225.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] WARNING: Tos value ... adjusted</H1>
    <B>Nick Rogers</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20WARNING%3A%20Tos%20value%20...%20adjusted&In-Reply-To=%3CCAKOb%3DYYbTitQeLLyUUW%2BDPBNrmFOOhnu3YzHNVxFoWaY4Ge7sA%40mail.gmail.com%3E"
       TITLE="[squid-users] WARNING: Tos value ... adjusted">ncrogers at gmail.com
       </A><BR>
    <I>Wed Apr 22 21:14:44 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003223.html">[squid-users] DNS Server Issued in Squid Proxy
</A></li>
        <LI>Next message (by thread): <A HREF="003225.html">[squid-users] WARNING: Tos value ... adjusted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3219">[ date ]</a>
              <a href="thread.html#3219">[ thread ]</a>
              <a href="subject.html#3219">[ subject ]</a>
              <a href="author.html#3219">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>After upgrading from 3.4.x to 3.5.x, I've noticed a new error message with
my squid configuration. Apparently squid 3.5 no longer allows setting the
two lower-most ECN bits of the ToS byte. I realize that this is to
encourage people to use the modernized definition of ToS being a 6 bit DSCP
field and a two bit ECN field, however enforcing this in the configuration
parser introduces a big problem for me. I use the ToS byte as a way to tag
outbound requests from squid based on ACLs, to then queue the traffic
differently via PF + ALTQ engine on FreeBSD. This is a way to queue upload
traffic from squid on a per-IP/ACL basis. Having 256 values (8 bit ToS) to
work with is a lot preferable than only 64 (6 bit DSCP field). I'm not sure
if I care if the ECN bits are set, as it is likely scrubbed away by my
upstream ISP, or I can normalize it with PF. The point is I really need to
be able to tag outgoing packets with the full 8 bits of the ToS byte, not
just 6. I've been doing this for nearly a decade since early squid 2.x.

So my question is, is the squid team willing to revert this change
entirely, and leave it up to the admin to decide what ToS values are
appropriate. Or are you guys now pretty adamant about never setting the ECN
field?

It looks like the change got snuck into this commit along with fixing some
other tcp outgoing tos bugs. It really caught me off-guard because there is
no mention of this new behavior in the changelog.

<A HREF="https://github.com/squid-cache/squid/commit/651ba437462fb5fde21f8d3b66d09afa1e069d5c">https://github.com/squid-cache/squid/commit/651ba437462fb5fde21f8d3b66d09afa1e069d5c</A>

The enforcement happens in src/cache_cf.cc. Its 5 lines of code that seem
trivial to either remove or make configurable, however I am not sure how to
go about making it configurable. I am debating just patching my squid
builds to remove the check against the ToS field, but I would like to use
unmodified squid 3.5.x. I'm not sure if going from 256 to 64 possible
fields is possible for my deployments.

Thanks.

-Nick
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150422/a3237827/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150422/a3237827/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003223.html">[squid-users] DNS Server Issued in Squid Proxy
</A></li>
	<LI>Next message (by thread): <A HREF="003225.html">[squid-users] WARNING: Tos value ... adjusted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3219">[ date ]</a>
              <a href="thread.html#3219">[ thread ]</a>
              <a href="subject.html#3219">[ subject ]</a>
              <a href="author.html#3219">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
