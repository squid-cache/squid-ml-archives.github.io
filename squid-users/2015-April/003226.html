<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ERR_ONLY_IF_CACHED_MISS and cache digests problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ERR_ONLY_IF_CACHED_MISS%20and%20cache%20digests%20problem&In-Reply-To=%3C553887C3.30106%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003224.html">
   <LINK REL="Next"  HREF="003231.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ERR_ONLY_IF_CACHED_MISS and cache digests problem</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ERR_ONLY_IF_CACHED_MISS%20and%20cache%20digests%20problem&In-Reply-To=%3C553887C3.30106%40treenet.co.nz%3E"
       TITLE="[squid-users] ERR_ONLY_IF_CACHED_MISS and cache digests problem">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Apr 23 05:48:51 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003224.html">[squid-users] ERR_ONLY_IF_CACHED_MISS and cache digests problem
</A></li>
        <LI>Next message (by thread): <A HREF="003231.html">[squid-users] ERR_ONLY_IF_CACHED_MISS and cache digests problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3226">[ date ]</a>
              <a href="thread.html#3226">[ thread ]</a>
              <a href="subject.html#3226">[ subject ]</a>
              <a href="author.html#3226">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 23/04/2015 5:10 p.m., Victor Sudakov wrote:
&gt;<i> Dear Colleagues,
</I>&gt;<i> 
</I>&gt;<i> I have two squid-3.5.3 proxies configured as mutual siblings:
</I>&gt;<i> 
</I>&gt;<i> ==== proxy:/usr/local/etc/squid/squid.conf
</I>&gt;<i> 
</I>&gt;<i> acl internal src 212.73.124.0/28
</I>&gt;<i> http_access allow internal
</I>&gt;<i> cache_peer proxy2.sibptus.ru sibling 3128 3130
</I>&gt;<i> 
</I>&gt;<i> ==== proxy2:/usr/local/etc/squid/squid.conf
</I>&gt;<i> 
</I>&gt;<i> acl cisa_servers src 212.73.124.0/28
</I>&gt;<i> http_access allow cisa_servers
</I>&gt;<i> cache_peer proxy.sibptus.ru sibling 3128 3130
</I>&gt;<i> 
</I>&gt;<i> I believe this is a correct configuration. The users' browsers are
</I>&gt;<i> configured to use proxy2.sibptus.ru, but sometimes users see the
</I>&gt;<i> ERR_ONLY_IF_CACHED_MISS error from proxy.sibptus.ru!
</I>&gt;<i> 
</I>&gt;<i> Both proxies are compiled with cache digest support. I think it's on
</I>&gt;<i> by default. However, the problem seems to disappear when I add the
</I>&gt;<i> &quot;no-digest&quot; flag to the cache_peer definitions.
</I>&gt;<i> 
</I>&gt;<i> What is wrong with my setup? Is anything wrong with mutual siblings
</I>&gt;<i> and cache digests?
</I>&gt;<i> 
</I>
I dont think anything is wrong wth either. Its more a collision in how
the features work vs the protocols.

Cache Digests (CD) are exchanged periodically and updated approx hourly.
Also they are based on just the URL. So there is always a gap where they
may not be accurate for any highly volatile objects, and variant objects
(using Vary headers) will have a high false-positive rate.

only-if-cached requires the *right now* state of the object to be fresh
and in cache. It takes account of both the URL and the entire HTTP
headers. So

The ICP protocol used as a backup to confirm objects existence also
suffers the same URL basis problem as CD. They work fine for HTTP/1.0
but HTTP/1.1 features dont fare quite so well.

My recommendation these days is to use HTCP instead of ICP. Since you
seem to need accuracy HTCP would probably suit your needs better than CD
as well.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003224.html">[squid-users] ERR_ONLY_IF_CACHED_MISS and cache digests problem
</A></li>
	<LI>Next message (by thread): <A HREF="003231.html">[squid-users] ERR_ONLY_IF_CACHED_MISS and cache digests problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3226">[ date ]</a>
              <a href="thread.html#3226">[ thread ]</a>
              <a href="subject.html#3226">[ subject ]</a>
              <a href="author.html#3226">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
