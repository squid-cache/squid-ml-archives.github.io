<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ssl_bump peek in squid-3.5.3
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ssl_bump%20peek%20in%20squid-3.5.3&In-Reply-To=%3CD95ED8DB-7C03-49C7-8F87-B5327D719FF0%40hendrie.id.au%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003231.html">
   <LINK REL="Next"  HREF="003228.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ssl_bump peek in squid-3.5.3</H1>
    <B>Michael Hendrie</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ssl_bump%20peek%20in%20squid-3.5.3&In-Reply-To=%3CD95ED8DB-7C03-49C7-8F87-B5327D719FF0%40hendrie.id.au%3E"
       TITLE="[squid-users] ssl_bump peek in squid-3.5.3">michael at hendrie.id.au
       </A><BR>
    <I>Thu Apr 23 06:29:01 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003231.html">[squid-users] ERR_ONLY_IF_CACHED_MISS and cache digests problem
</A></li>
        <LI>Next message (by thread): <A HREF="003228.html">[squid-users] ssl_bump peek in squid-3.5.3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3227">[ date ]</a>
              <a href="thread.html#3227">[ thread ]</a>
              <a href="subject.html#3227">[ subject ]</a>
              <a href="author.html#3227">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi All

I&#8217;ve been running squid-3.4.x in tproxy mode with ssl_bump server-first for some time and has been working great.

I have just moved to 3.5.3 to use peek to overcome some issues with sites that require SNI to serve up the correct certificate.  In most cases this is work well however I seem to have an issue that (so far) only effects the Safari web browser with certain sites.  As an example, <A HREF="https://twitter.com">https://twitter.com</A> &lt;<A HREF="https://twitter.com/">https://twitter.com/</A>&gt; and <A HREF="https://www.openssl.org">https://www.openssl.org</A> &lt;<A HREF="https://www.openssl.org/">https://www.openssl.org/</A>&gt; will result in a Safari error page &#8220;can&#8217;t establish a secure connection with the server&#8221;.  There is also a correlating entry in the cache.log 'Error negotiating SSL connection on FD 45: error:140A1175:SSL routines:SSL_BYTES_TO_CIPHER_LIST:inappropriate fallback (1/-1)&#8217;

Google shows some hits for this SSL error on other products, mostly nginx, but nothing suggesting in those posting seems to have worked for me (settings specific SSL/TLS versions and ciphers)

If use a different browser the above mentioned sites work as expected.  If continue to bump &#8216;server-first&#8217; for these problem sites they also load as expected in Safari however I&#8217;m hoping to move to peek exclusively to overcome SNI issues.

Anyone experiencing the same thing or have any suggestions?  ssl_bump related config below:

https_port 8090 tproxy ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=16MB cert=/etc/squid/ssl-bump.cer key=/etc/squid/ssl-bump.key
acl p8090 myportname 8090
acl step1 at_step SslBump1
#acl broken_peek dstdomain .twttr.com .twitter.com .facebook.com .openssl.org
#ssl_bump server-first broken_peek
ssl_bump peek step1
ssl_bump bump p8090

Thanks!

Michael


-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150423/d029dd87/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150423/d029dd87/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003231.html">[squid-users] ERR_ONLY_IF_CACHED_MISS and cache digests problem
</A></li>
	<LI>Next message (by thread): <A HREF="003228.html">[squid-users] ssl_bump peek in squid-3.5.3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3227">[ date ]</a>
              <a href="thread.html#3227">[ thread ]</a>
              <a href="subject.html#3227">[ subject ]</a>
              <a href="author.html#3227">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
