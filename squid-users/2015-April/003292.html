<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] FW: Trying to setup Squid as a reverse proxy. Works	fine, but when a client does an HTTP POST,	Squid claims there's a forwarding error.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FW%3A%20Trying%20to%20setup%20Squid%20as%20a%20reverse%20proxy.%20Works%0A%09fine%2C%20but%20when%20a%20client%20does%20an%20HTTP%20POST%2C%0A%09Squid%20claims%20there%27s%20a%20forwarding%20error.&In-Reply-To=%3C016701d08104%24ba5d3fb0%242f17bf10%24%40casipc.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003290.html">
   <LINK REL="Next"  HREF="003304.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] FW: Trying to setup Squid as a reverse proxy. Works	fine, but when a client does an HTTP POST,	Squid claims there's a forwarding error.</H1>
    <B>Brent Newland</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FW%3A%20Trying%20to%20setup%20Squid%20as%20a%20reverse%20proxy.%20Works%0A%09fine%2C%20but%20when%20a%20client%20does%20an%20HTTP%20POST%2C%0A%09Squid%20claims%20there%27s%20a%20forwarding%20error.&In-Reply-To=%3C016701d08104%24ba5d3fb0%242f17bf10%24%40casipc.com%3E"
       TITLE="[squid-users] FW: Trying to setup Squid as a reverse proxy. Works	fine, but when a client does an HTTP POST,	Squid claims there's a forwarding error.">brent.newland at casipc.com
       </A><BR>
    <I>Mon Apr 27 16:10:48 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003290.html">[squid-users] squid3 doesn't work well
</A></li>
        <LI>Next message (by thread): <A HREF="003304.html">[squid-users] FW: Trying to setup Squid as a reverse proxy. Works fine, but when a client does an HTTP POST, Squid claims there's a forwarding error.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3292">[ date ]</a>
              <a href="thread.html#3292">[ thread ]</a>
              <a href="subject.html#3292">[ subject ]</a>
              <a href="author.html#3292">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>x-post
<A HREF="http://www.reddit.com/r/sysadmin/comments/340f36/trying_to_setup_squid_as_a">http://www.reddit.com/r/sysadmin/comments/340f36/trying_to_setup_squid_as_a</A>_
reverse_proxy_works/

At this point, I've trimmed my Squid config down to:

http_access allow all
cache_peer 127.0.0.1 parent 8084 0 no-digest no-query originserver
name=mywebsite
cache_peer_domain mywebsite beta.mywebsite.com
coredump_dir /var/cache/squid
dns_nameservers 8.8.8.8 208.67.222.222

As for my server configuration, I'm on Windows Server 2008 R2 running Squid
3.5 from <A HREF="http://squid.diladele.com/&#160;Squid">http://squid.diladele.com/&#160;Squid</A> is a reverse proxy for a PHP
process running the PHP built-in webserver on port 8084. The issue does not
happen when the PHP webserver is on port 80, so I'm 99% sure the problem
isn't coming from there.

It's a wordpress install I'm having the problem in. When logging in at
/wp-login.php, it loads the login form, but then gives me:

ERROR
The requested URL could not be retrieved The following error was encountered
while trying to retrieve the
URL:&#160;<A HREF="http://beta.mywebsite.com/wp-login.php[2">http://beta.mywebsite.com/wp-login.php[2</A>]
Access Denied.
Access control configuration prevents your request from being allowed at
this time. Please contact your service provider if you feel this is
incorrect.
Your cache administrator is webmaster.
Generated Mon, 27 Apr 2015 08:05:24 GMT by SERVER
(squid/3.5.1-20150206-r13746)

In the access log I get:

1430122290.530 1 192.168.10.1 TCP_MISS/403 5050
POST&#160;<A HREF="http://beta.mywebsite.com/wp-login.php[3">http://beta.mywebsite.com/wp-login.php[3</A>]&#160;- HIER_NONE/- text/html
1430122290.532 17 69.146.194.21 TCP_MISS/403 5119
POST&#160;<A HREF="http://beta.mywebsite.com/wp-login.php[4">http://beta.mywebsite.com/wp-login.php[4</A>]&#160;- HIER_DIRECT/12.34.56.78
text/html

And in the cache log:

2015/04/27 02:11:30 kid1| WARNING: Forwarding loop detected for:
POST /wp-login.php HTTP/1.1
Host: beta.mywebsite.com
Content-Length: 126
Pragma: no-cache
Accept:
text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,/;q=0.8
Origin:&#160;<A HREF="http://beta.mywebsite.com[5">http://beta.mywebsite.com[5</A>]
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML,
like Gecko) Chrome/41.0.2272.118 Safari/537.36
Content-Type: application/x-www-form-urlencoded
DNT: 1
Referer:&#160;<A HREF="http://beta.mywebsite.com/wp-login.php?loggedout=true[6">http://beta.mywebsite.com/wp-login.php?loggedout=true[6</A>]
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.8
Cookie:
Via: 1.1 SERVER (squid/3.5.1-20150206-r13746)
Surrogate-Capability: SERVER=&quot;Surrogate/1.0 ESI/1.0&quot;
X-Forwarded-For: 12.34.56.78
Cache-Control: no-cache
Connection: keep-alive

Same thing happens on wp-cron.php. Near as I can tell, it's deciding a
perfectly good redirect is a forwarding redirect.

Am I missing something here? It's driving me crazy.

I should mention that viewing PHP files and HTML files and pictures all work
fine, it's just self-referential HTTP POST's that fail.




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003290.html">[squid-users] squid3 doesn't work well
</A></li>
	<LI>Next message (by thread): <A HREF="003304.html">[squid-users] FW: Trying to setup Squid as a reverse proxy. Works fine, but when a client does an HTTP POST, Squid claims there's a forwarding error.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3292">[ date ]</a>
              <a href="thread.html#3292">[ thread ]</a>
              <a href="subject.html#3292">[ subject ]</a>
              <a href="author.html#3292">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
