<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Individual delay pools and youtube
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Individual%20delay%20pools%20and%20youtube&In-Reply-To=%3C1430286253928.fcbd2ab7%40Nodemailer%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003174.html">
   <LINK REL="Next"  HREF="003319.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Individual delay pools and youtube</H1>
    <B>dan at getbusi.com</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Individual%20delay%20pools%20and%20youtube&In-Reply-To=%3C1430286253928.fcbd2ab7%40Nodemailer%3E"
       TITLE="[squid-users] Individual delay pools and youtube">dan at getbusi.com
       </A><BR>
    <I>Wed Apr 29 05:44:14 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003174.html">[squid-users] Individual delay pools and youtube
</A></li>
        <LI>Next message (by thread): <A HREF="003319.html">[squid-users] Individual delay pools and youtube
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3315">[ date ]</a>
              <a href="thread.html#3315">[ thread ]</a>
              <a href="subject.html#3315">[ subject ]</a>
              <a href="author.html#3315">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I mentioned last time that we had to x2 all our delay_parameter&#8217;s bytes because of a weird bug where squid would apply it at half speed for no reason.




It just occurred to me that (obviously) this is why HTTPS downloads are going too fast; because this bug must only affect HTTP traffic.




So HTTPS downloads are going at the actual speed we&#8217;ve specified and HTTP is going at half that.




Therefore, we should be able to work around it by setting different delay_parameters for HTTP and HTTPS requests.




So my question is, how best to target only those requests? By the CONNECT method?




P.S. This bug is still present in the latest Squid 3.5 HEAD.

On Mon, Apr 20, 2015 at 11:44 AM, null &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">dan at getbusi.com</A>&gt; wrote:

&gt;<i> Thanks Amos
</I>&gt;<i> Sorry if that wasn&#8217;t clear, but yeah, 7 KB/s was the desired speed in that test.&#160;
</I>&gt;<i> I was testing against an ISO in an S3 bucket of ours. I would start the download using <A HREF="http://">http://</A> and get 7 KB/s (great). Then cancel it and edit the URL to <A HREF="https://">https://</A> and get ~90 KB/s.
</I>&gt;<i> Oh, and I almost forgot: (I can&#8217;t remember whether this has been reported but) there&#8217;s also a problem with delay_parameters, such that our software has to x2 any restriction that&#8217;s configured when generating the squid config.
</I>&gt;<i> So, if I want to configure a 56 kbps restriction our software actually writes:
</I>&gt;<i> delay_parameters 1 -1/-1 14336/14336
</I>&gt;<i> In order to achieve the correct limit (7 KB/s). Not sure if that could be related to this at all.
</I>&gt;<i> P.S. We&#8217;re pretty fond of delay_pools and their simplicity&#8212;including the fact that it can all be handled by Squid without any lower-level networking concerns.
</I>&gt;<i> On Mon, Apr 20, 2015 at 1:25 AM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;&gt;<i> On 17/04/2015 1:30 p.m., djch wrote:
</I>&gt;&gt;&gt;<i> I just wanted to revive this thread to note that:
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> - Delay pools apply just fine to HTTPS requests in Squid 2.7.
</I>&gt;&gt;&gt;<i> - Delay pools in Squid 3.4.x are also applied to HTTPS but the speed is not
</I>&gt;&gt;&gt;<i> correct. 
</I>&gt;&gt;&gt;<i>   - If I apply a 56 Kbps limit the HTTP download tops out at ~7 KB/s.
</I>&gt;&gt;<i> That *is* correct.
</I>&gt;&gt;<i>    56K *bits* /sec == 7K *Bytes* /sec.
</I>&gt;&gt;<i>    7x8 = 56
</I>&gt;&gt;&gt;<i> If I
</I>&gt;&gt;&gt;<i> download the same file from the same server via HTTPS it tops out at
</I>&gt;&gt;&gt;<i> ~90KB/s. If I download the same file over HTTPS with no delay pools
</I>&gt;&gt;&gt;<i> configured it tops at around 3MB/s.
</I>&gt;&gt;<i> Are you sure thats actually HTTPS ?
</I>&gt;&gt;<i> CONNECT tunnels these days could contain HTTP/2, SPDY, WebSockets or
</I>&gt;&gt;<i> data in some other (compressed?) format. Any of which achieve faster
</I>&gt;&gt;<i> percieved &quot;download&quot; than HTTP using the same basic bytes/sec data rate.
</I>&gt;&gt;<i> NP: squid-2.7 contains a CONNECT bug that prevents SPDY HTTP/2 and
</I>&gt;&gt;<i> Websockets working properly.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> So I guess that would make this a bug? Which I assume nobody wants to fix
</I>&gt;&gt;&gt;<i> 'cause they're going to be deprecated at some point soon?
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;<i> Its a matter of interest. With FOSS you have to cause someone to be
</I>&gt;&gt;<i> interested in fixing the bug. Best way to do that is to fix it yourself
</I>&gt;&gt;<i> and present a patch and get it through review to merge. Second best is
</I>&gt;&gt;<i> to find someone to pay to do all that. Or you can join the many people
</I>&gt;&gt;<i> who opted just to wait and pray someone else will give it to them free
</I>&gt;&gt;<i> one day.
</I>&gt;&gt;<i> There is another option with delay pools. The pooling system is *just* a
</I>&gt;&gt;<i> packet rate limiting system. The OS these days have several such QoS
</I>&gt;&gt;<i> systems built in that work far better than Squid algorithms (admittedly
</I>&gt;&gt;<i> not on a HTTP per-message basis). If you want total traffic control give
</I>&gt;&gt;<i> those a try.
</I>&gt;&gt;<i> Amos
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150428/ab4471f4/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150428/ab4471f4/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003174.html">[squid-users] Individual delay pools and youtube
</A></li>
	<LI>Next message (by thread): <A HREF="003319.html">[squid-users] Individual delay pools and youtube
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3315">[ date ]</a>
              <a href="thread.html#3315">[ thread ]</a>
              <a href="subject.html#3315">[ subject ]</a>
              <a href="author.html#3315">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
