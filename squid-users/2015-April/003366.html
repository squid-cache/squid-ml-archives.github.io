<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid-users Digest, Vol 8, Issue 52
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid-users%20Digest%2C%20Vol%208%2C%20Issue%2052&In-Reply-To=%3CCAKHWrNGCK_%2BV4o1m0zyzFAcXxPqeJAAHZGD3QExL07P8f66%2B6Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003257.html">
   <LINK REL="Next"  HREF="003245.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid-users Digest, Vol 8, Issue 52</H1>
    <B>kukuh amukti</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid-users%20Digest%2C%20Vol%208%2C%20Issue%2052&In-Reply-To=%3CCAKHWrNGCK_%2BV4o1m0zyzFAcXxPqeJAAHZGD3QExL07P8f66%2B6Q%40mail.gmail.com%3E"
       TITLE="[squid-users] squid-users Digest, Vol 8, Issue 52">kukuh.amukti at gmail.com
       </A><BR>
    <I>Fri Apr 24 02:27:13 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003257.html">[squid-users] HTTPS Filtering and SSL-Bump
</A></li>
        <LI>Next message (by thread): <A HREF="003245.html">[squid-users] Using Squid as a Transparent Proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3366">[ date ]</a>
              <a href="thread.html#3366">[ thread ]</a>
              <a href="subject.html#3366">[ subject ]</a>
              <a href="author.html#3366">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dear Amos,

i get error :
-- init_password: Wiping the computer password structure
 -- generate_new_password: Generating a new, random password for the
computer account
 -- generate_new_password:  Characters read from /dev/udandom = 90
 -- create_fake_krb5_conf: Created a fake krb5.conf file:
/tmp/.msktkrb5.conf-F6iL9e
 -- reload: Reloading Kerberos Context
 -- finalize_exec: SAM Account Name is: PROXYAGIT01-K$
 -- try_machine_keytab_princ: Trying to authenticate for PROXYAGIT01-K$
from local keytab...
 -- try_machine_keytab_princ: Error: krb5_get_init_creds_keytab failed
(Client not found in Kerberos database)
 -- try_machine_keytab_princ: Authentication with keytab failed
 -- try_machine_keytab_princ: Trying to authenticate for host/
proxyagit01.ag-it.com from local keytab...
 -- try_machine_keytab_princ: Error: krb5_get_init_creds_keytab failed
(Client not found in Kerberos database)
 -- try_machine_keytab_princ: Authentication with keytab failed
 -- try_machine_password: Trying to authenticate for PROXYAGIT01-K$ with
password.
 -- create_default_machine_password: Default machine password for
PROXYAGIT01-K$ is proxyagit01-k
 -- try_machine_password: Error: krb5_get_init_creds_keytab failed (Client
not found in Kerberos database)
 -- try_machine_password: Authentication with password failed
 -- try_user_creds: Checking if default ticket cache has tickets...
 -- finalize_exec: Authenticated using method 4

 -- ldap_connect: Connecting to LDAP server: svr-resdmn22.ag-it.com
try_tls=YES
 -- ldap_connect: Connecting to LDAP server: svr-resdmn22.ag-it.com
try_tls=NO





*SASL/GSSAPI authentication started Error: ldap_sasl_interactive_bind_s
failed (Local error) Error: ldap_connect failed --&gt; Is your kerberos ticket
expired? You might try re-&quot;kinit&quot;ing.  -- ~KRB5Context: Destroying Kerberos
Context*

in auth.log :
&quot; msktutil: GSSAPI Error: Unspecified GSS failure.  Minor
code may provide more information (Server not found in Kerberos database)&quot;

help me

thanks,
kukuhga

On Thu, Apr 23, 2015 at 4:41 PM, &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-request at lists.squid-cache.org</A>&gt;
wrote:

&gt;<i> Send squid-users mailing list submissions to
</I>&gt;<i>         <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>
</I>&gt;<i> To subscribe or unsubscribe via the World Wide Web, visit
</I>&gt;<i>         <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> or, via email, send a message with subject or body 'help' to
</I>&gt;<i>         <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-request at lists.squid-cache.org</A>
</I>&gt;<i>
</I>&gt;<i> You can reach the person managing the list at
</I>&gt;<i>         <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-owner at lists.squid-cache.org</A>
</I>&gt;<i>
</I>&gt;<i> When replying, please edit your Subject line so it is more specific
</I>&gt;<i> than &quot;Re: Contents of squid-users digest...&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Today's Topics:
</I>&gt;<i>
</I>&gt;<i>    1. Re: ERR_ONLY_IF_CACHED_MISS and cache digests problem
</I>&gt;<i>       (Victor Sudakov)
</I>&gt;<i>    2. GSSAPI problem when try create keytab using msktutil
</I>&gt;<i>       (kukuh amukti)
</I>&gt;<i>    3. Re: [squid ] externalAclLookup: 'wbinfo_group_helper' queue
</I>&gt;<i>       overload. (Jagannath Naidu)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ----------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> Message: 1
</I>&gt;<i> Date: Thu, 23 Apr 2015 14:35:24 +0600
</I>&gt;<i> From: Victor Sudakov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">sudakov at sibptus.tomsk.ru</A>&gt;
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>, Amos Jeffries
</I>&gt;<i>         &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
</I>&gt;<i> Subject: Re: [squid-users] ERR_ONLY_IF_CACHED_MISS and cache digests
</I>&gt;<i>         problem
</I>&gt;<i> Message-ID: &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">20150423083524.GA92752 at admin.sibptus.tomsk.ru</A>&gt;
</I>&gt;<i> Content-Type: text/plain; charset=us-ascii
</I>&gt;<i>
</I>&gt;<i> Amos Jeffries wrote:
</I>&gt;<i>
</I>&gt;<i> [dd]
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I dont think anything is wrong wth either. Its more a collision in how
</I>&gt;<i> &gt; the features work vs the protocols.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Cache Digests (CD) are exchanged periodically and updated approx hourly.
</I>&gt;<i> &gt; Also they are based on just the URL. So there is always a gap where they
</I>&gt;<i> &gt; may not be accurate for any highly volatile objects, and variant objects
</I>&gt;<i> &gt; (using Vary headers) will have a high false-positive rate.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; only-if-cached requires the *right now* state of the object to be fresh
</I>&gt;<i> &gt; and in cache. It takes account of both the URL and the entire HTTP
</I>&gt;<i> &gt; headers. So
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The ICP protocol used as a backup to confirm objects existence also
</I>&gt;<i> &gt; suffers the same URL basis problem as CD. They work fine for HTTP/1.0
</I>&gt;<i> &gt; but HTTP/1.1 features dont fare quite so well.
</I>&gt;<i>
</I>&gt;<i> Thank you Amos, now I understand the mechanics behind this. However,
</I>&gt;<i> I'd prefer that users do not receive this frustrating error in a setup
</I>&gt;<i> with has nothing inherently wrong about it (especially frustrating is
</I>&gt;<i> the fact that they receive the error from the wrong proxy server, not the
</I>&gt;<i> one they have configured in the browser settings).
</I>&gt;<i>
</I>&gt;<i> Do I understand correctly that the only way to avoid this error
</I>&gt;<i> message is to switch to HTCP (and ditch both ICP and CD)?
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
</I>&gt;<i> sip:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">sudakov at sibptus.tomsk.ru</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> Message: 2
</I>&gt;<i> Date: Thu, 23 Apr 2015 16:40:44 +0700
</I>&gt;<i> From: kukuh amukti &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">kukuh.amukti at gmail.com</A>&gt;
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: [squid-users] GSSAPI problem when try create keytab using
</I>&gt;<i>         msktutil
</I>&gt;<i> Message-ID:
</I>&gt;<i>         &lt;
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">CAKHWrNFg7vUzmDpDJSpQvMRgc4eTCFONYYUnijyNNZRO2U0zTw at mail.gmail.com</A>&gt;
</I>&gt;<i> Content-Type: text/plain; charset=&quot;utf-8&quot;
</I>&gt;<i>
</I>&gt;<i> Dear All,
</I>&gt;<i> i've building squid in W2K12 and there is no problem but when i try running
</I>&gt;<i> in W2K3,
</I>&gt;<i> i get problem when try create keytab with msktutil command to win server
</I>&gt;<i> 2003.
</I>&gt;<i> and when i run msktutil :
</I>&gt;<i>
</I>&gt;<i> msktutil -c -b &quot;OU=WSUS - Server,OU=Astragraphia-ITS&quot; -s
</I>&gt;<i> HTTP/proxyagit01.ag-it.com -k /etc/squid3/PROXY.keytab --computer-name
</I>&gt;<i> PROXYAGIT-01 --upn HTTP/proxyagit01.ag-it.com --server
</I>&gt;<i> svr-resdmn22.ag-it.com --verbose
</I>&gt;<i>
</I>&gt;<i> and get some error
</I>&gt;<i>
</I>&gt;<i>  -- init_password: Wiping the computer password structure
</I>&gt;<i>  -- generate_new_password: Generating a new, random password for the
</I>&gt;<i> computer account
</I>&gt;<i>  -- generate_new_password:  Characters read from /dev/udandom = 90
</I>&gt;<i>  -- create_fake_krb5_conf: Created a fake krb5.conf file:
</I>&gt;<i> /tmp/.msktkrb5.conf-F6iL9e
</I>&gt;<i>  -- reload: Reloading Kerberos Context
</I>&gt;<i>  -- finalize_exec: SAM Account Name is: PROXYAGIT01-K$
</I>&gt;<i>  -- try_machine_keytab_princ: Trying to authenticate for PROXYAGIT01-K$
</I>&gt;<i> from local keytab...
</I>&gt;<i>  -- try_machine_keytab_princ: Error: krb5_get_init_creds_keytab failed
</I>&gt;<i> (Client not found in Kerberos database)
</I>&gt;<i>  -- try_machine_keytab_princ: Authentication with keytab failed
</I>&gt;<i>  -- try_machine_keytab_princ: Trying to authenticate for host/
</I>&gt;<i> proxyagit01.ag-it.com from local keytab...
</I>&gt;<i>  -- try_machine_keytab_princ: Error: krb5_get_init_creds_keytab failed
</I>&gt;<i> (Client not found in Kerberos database)
</I>&gt;<i>  -- try_machine_keytab_princ: Authentication with keytab failed
</I>&gt;<i>  -- try_machine_password: Trying to authenticate for PROXYAGIT01-K$ with
</I>&gt;<i> password.
</I>&gt;<i>  -- create_default_machine_password: Default machine password for
</I>&gt;<i> PROXYAGIT01-K$ is proxyagit01-k
</I>&gt;<i>  -- try_machine_password: Error: krb5_get_init_creds_keytab failed (Client
</I>&gt;<i> not found in Kerberos database)
</I>&gt;<i>  -- try_machine_password: Authentication with password failed
</I>&gt;<i>  -- try_user_creds: Checking if default ticket cache has tickets...
</I>&gt;<i>  -- finalize_exec: Authenticated using method 4
</I>&gt;<i>
</I>&gt;<i>  -- ldap_connect: Connecting to LDAP server: svr-resdmn22.ag-it.com
</I>&gt;<i> try_tls=YES
</I>&gt;<i>  -- ldap_connect: Connecting to LDAP server: svr-resdmn22.ag-it.com
</I>&gt;<i> try_tls=NO
</I>&gt;<i> SASL/GSSAPI authentication started
</I>&gt;<i> Error: ldap_sasl_interactive_bind_s failed (Local error)
</I>&gt;<i> Error: ldap_connect failed
</I>&gt;<i> --&gt; Is your kerberos ticket expired? You might try re-&quot;kinit&quot;ing.
</I>&gt;<i>  -- ~KRB5Context: Destroying Kerberos Context
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> in auth.log  say &quot; msktutil: GSSAPI Error: Unspecified GSS failure.  Minor
</I>&gt;<i> code may provide more information (Server not found in Kerberos database)&quot;
</I>&gt;<i>
</I>&gt;<i> what should i do?
</I>&gt;<i>
</I>&gt;<i> thanks,
</I>&gt;<i> kukuhga
</I>&gt;<i> -------------- next part --------------
</I>&gt;<i> An HTML attachment was scrubbed...
</I>&gt;<i> URL: &lt;
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150423/95123d16/attachment-0001.html">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150423/95123d16/attachment-0001.html</A>
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> Message: 3
</I>&gt;<i> Date: Thu, 23 Apr 2015 15:11:09 +0530
</I>&gt;<i> From: Jagannath Naidu &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">jagannath.naidu at fosteringlinux.com</A>&gt;
</I>&gt;<i> To: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
</I>&gt;<i> Cc: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: Re: [squid-users] [squid ] externalAclLookup:
</I>&gt;<i>         'wbinfo_group_helper' queue overload.
</I>&gt;<i> Message-ID:
</I>&gt;<i>         &lt;CA+8bHvzhgS=-
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">u5zx1a82uWk0jC62qS1HmaUoawn7eW1W43ZHfA at mail.gmail.com</A>&gt;
</I>&gt;<i> Content-Type: text/plain; charset=&quot;utf-8&quot;
</I>&gt;<i>
</I>&gt;<i> Hi Amos,
</I>&gt;<i>
</I>&gt;<i> regrets, I am late.
</I>&gt;<i>
</I>&gt;<i> On 21 April 2015 at 09:15, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; On 20/04/2015 7:31 p.m., Jagannath Naidu wrote:
</I>&gt;<i> &gt; &gt; Hi,
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I am having this issue very frequently. Please help on this.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I get these errors randomly, mostly when usage is at very peak. (800
</I>&gt;<i> &gt; users)
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; /var/log/squid/cache.log
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; 2015/04/20 12:37:40| externalAclLookup: 'wbinfo_group_helper' queue
</I>&gt;<i> &gt; &gt; overload (ch=0x7fc99e2ce518)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; What do you think &quot;overload&quot; means?
</I>&gt;<i> &gt;  The helper is unable to cope with the traffic load being passed to it.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Here is the biggest hint:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; in /var/log/messages,  I get the following errors
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; pr 20 12:59:15 GGNPROXY01 winbindd[1910]:   winbindd: Exceeding 200
</I>&gt;<i> &gt; client
</I>&gt;<i> &gt; &gt; connections, no idle connection found
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; Then squid stops working. For squid to start work again, I have to
</I>&gt;<i> dlete
</I>&gt;<i> &gt; &gt; the cache and restart the squid &quot;squid -k reconfigure&quot;, and then squid
</I>&gt;<i> &gt; &gt; restart.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; What Squid version are you using?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; my squid version  squid-3.1.10-19.el6_4.x86_64
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; squid.conf
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; max_filedesc 17192
</I>&gt;<i> &gt; &gt; acl manager proto cache_object
</I>&gt;<i> &gt; &gt; acl localhost src 172.16.50.61/24
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; changed to &quot;acl localhost src 172.16.50.6*1*&quot; already
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; You have an entire /24 (256 IPs) assigned to this machine?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I think you need to remove that &quot;/24&quot; part if the *.61 is the local
</I>&gt;<i> &gt; machines *public* IP.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; http_access allow manager localhost
</I>&gt;<i> &gt; &gt; dns_nameservers 172.16.3.34 10.1.2.91
</I>&gt;<i> &gt; &gt; acl allowips src 172.16.58.187 172.16.16.192 172.16.58.113 172.16.58.63
</I>&gt;<i> &gt; &gt; 172.16.58.98 172.16.60.244 172.16.58.165 172.16.58.157
</I>&gt;<i> &gt; &gt; http_access allow allowips
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; auth_param basic realm Squid proxy-caching web server
</I>&gt;<i> &gt; &gt; auth_param basic credentialsttl 2 hours external_acl_type nt_group
</I>&gt;<i> ttl=0
</I>&gt;<i> &gt; &gt; children=60 %LOGIN /usr/lib64/squid/wbinfo_group.pl
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The above two very mangled config lines are useless. Remove them.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; acl localnet src 172.16.0.0/24
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> changed
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Its a bit strange that none of the localhost machine IPs
</I>&gt;<i> &gt; (172.16.50.0-172.16.50.255) are part of the LAN its plugged into
</I>&gt;<i> &gt; 172.16.0.0-172.16.0.255.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; acl localnet src fc00::/7 # RFC 4193 local private network range
</I>&gt;<i> &gt; &gt; acl localnet src fe80::/10 # RFC 4291 link-local (directly plugged)
</I>&gt;<i> &gt; machines
</I>&gt;<i> &gt; &gt; auth_param ntlm program /usr/bin/ntlm_auth --diagnostics
</I>&gt;<i> &gt; &gt; --helper-protocol=squid-2.5-ntlmssp --domain=HTMEDIA.NET
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Okay you have configured NTLM...
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; auth_param ntlm program /usr/bin/ntlm_auth
</I>&gt;<i> &gt; &gt; --helper-protocol=squid-2.5-ntlmssp --domain=HTMEDIA.NET
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ... but twice. With different settings. Only these last ones will have
</I>&gt;<i> &gt; any effect.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; auth_param ntlm children 600
</I>&gt;<i> &gt; &gt; auth_param ntlm keep_alive off
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; auth_param negotiate children 150
</I>&gt;<i> &gt; &gt; auth_param negotiate keep_alive off
</I>&gt;<i> &gt; &gt; visible_hostname GGNPROXY01.HTMEDIA.NET
</I>&gt;<i> &gt; &gt; external_acl_type wbinfo_group_helper ttl=0 children=40 %LOGIN
</I>&gt;<i> &gt; &gt; /usr/lib64/squid/wbinfo_group.pl -d
</I>&gt;<i> &gt; &gt; auth_param negotiate keep_alive off
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; You have several useless configuration lines for Negotiate auth which is
</I>&gt;<i> &gt; not being used in any way. Remove those.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; acl Safe_ports port 8080 #https
</I>&gt;<i> &gt; &gt; acl SSL_ports port 443
</I>&gt;<i> &gt; &gt; acl Safe_ports port 80          # http
</I>&gt;<i> &gt; &gt; acl Safe_ports port 21          # ftp
</I>&gt;<i> &gt; &gt; acl Safe_ports port 443 # https
</I>&gt;<i> &gt; &gt; acl Safe_ports port 70          # gopher
</I>&gt;<i> &gt; &gt; acl Safe_ports port 210         # wais
</I>&gt;<i> &gt; &gt; acl Safe_ports port 1025-65535  # unregistered ports
</I>&gt;<i> &gt; &gt; acl Safe_ports port 280         # http-mgmt
</I>&gt;<i> &gt; &gt; acl Safe_ports port 488         # gss-http
</I>&gt;<i> &gt; &gt; acl Safe_ports port 591         # filemaker
</I>&gt;<i> &gt; &gt; acl Safe_ports port 777         # multiling http
</I>&gt;<i> &gt; &gt; acl CONNECT method CONNECT
</I>&gt;<i> &gt; &gt; acl auth proxy_auth REQUIRED
</I>&gt;<i> &gt; &gt; acl google dstdomain -i &quot;/etc/squid/google_site.com&quot;
</I>&gt;<i> &gt; &gt; http_access allow google
</I>&gt;<i> &gt; &gt; acl sq1 external wbinfo_group_helper &quot;/etc/squid/HT/sq1&quot;
</I>&gt;<i> &gt; &gt; acl sq2 external wbinfo_group_helper &quot;/etc/squid/HT/sq2&quot;
</I>&gt;<i> &gt; &gt; acl sq3 external wbinfo_group_helper &quot;/etc/squid/HT/sq3&quot;
</I>&gt;<i> &gt; &gt; acl sq4 external wbinfo_group_helper &quot;/etc/squid/HT/sq4&quot;
</I>&gt;<i> &gt; &gt; acl sq5 external wbinfo_group_helper &quot;/etc/squid/HT/sq5&quot;
</I>&gt;<i> &gt; &gt; acl pro1 external wbinfo_group_helper &quot;/etc/squid/HT/pro1&quot;
</I>&gt;<i> &gt; &gt; acl pro2 external wbinfo_group_helper &quot;/etc/squid/HT/pro2&quot;
</I>&gt;<i> &gt; &gt; acl pro3 external wbinfo_group_helper &quot;/etc/squid/HT/pro3&quot;
</I>&gt;<i> &gt; &gt; acl pro4 external wbinfo_group_helper &quot;/etc/squid/HT/pro4&quot;
</I>&gt;<i> &gt; &gt; acl pro5 external wbinfo_group_helper &quot;/etc/squid/HT/pro5&quot;
</I>&gt;<i> &gt; &gt; acl pro6 external wbinfo_group_helper &quot;/etc/squid/HT/pro6&quot;
</I>&gt;<i> &gt; &gt; acl webvip external wbinfo_group_helper &quot;/etc/squid/HT/webvip&quot;
</I>&gt;<i> &gt; &gt; acl allgroup external wbinfo_group_helper &quot;/etc/squid/HT/allgreop&quot;
</I>&gt;<i> &gt; &gt; acl restricted external wbinfo_group_helper &quot;/etc/squid/HT/restricted&quot;
</I>&gt;<i> &gt; &gt; acl ad_auth proxy_auth REQUIRE
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; You already have an ACL named &quot;auth&quot; which performs authentication.
</I>&gt;<i> &gt; The above line is not useful. Remove it and replace all uses of
</I>&gt;<i> &gt; &quot;ad_auth&quot; ACL with &quot;auth&quot; ACL.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; acl allowwebsites dstdomain -i &quot;/blacklists/allowedwebsite/domains&quot;
</I>&gt;<i> &gt; &gt; acl allowwebsites_url url_regex -i &quot;/blacklists/allowedwebsite/url&quot;
</I>&gt;<i> &gt; &gt; http_access allow allowwebsites
</I>&gt;<i> &gt; &gt; http_access allow allowwebsites_url
</I>&gt;<i> &gt; &gt; acl shopping dstdomain -i &quot;/etc/squid/shopping.txt&quot;
</I>&gt;<i> &gt; &gt; acl social_networking dstdomain -i
</I>&gt;<i> &quot;/blacklists/social/social.networking&quot;
</I>&gt;<i> &gt; &gt; acl youtube dstdomain -i .youtube.com
</I>&gt;<i> &gt; &gt; http_access allow Safe_ports pro1 pro2 pro3 pro4 pro5 pro6 webvip
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Incorrect use of &quot;Safe_ports&quot; security check. Correct usage is to deny
</I>&gt;<i> &gt; access to all *unsafe* ports. They are unsafe because HTTP can be
</I>&gt;<i> &gt; smuggled within the ports native protocol to attack your proxy.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Once the correct security protections for Safe_port and CONNECT tunnels
</I>&gt;<i> &gt; have been moved up the top remove the &quot;Safe_ports&quot; check from this line.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This line is also very odd in another way. ACL tests in a single line
</I>&gt;<i> &gt; are AND'ed together - so this means the request must be from a user who
</I>&gt;<i> is:
</I>&gt;<i> &gt;   authenticated AND a member of group pro1 AND pro2 AND pro3 AND pro4
</I>&gt;<i> &gt; AND pro5 AND pro6 AND webvip
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This hints at what your main helper problem is. The above line requires
</I>&gt;<i> &gt; 7 group helper lookups *per request*. The winbind helper has a maximum
</I>&gt;<i> &gt; of 200 simultaneous connections. This line alone will limit your proxy
</I>&gt;<i> &gt; just under 30 new visitors per second (that becomes 60 lookups/sec
</I>&gt;<i> &gt; before queue overload).
</I>&gt;<i> &gt;  The helper result caching will help a lot, but you also have a LOT of
</I>&gt;<i> &gt; other group checks being made and 800 users.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; http_access allow youtube pro5
</I>&gt;<i> &gt; &gt; http_access allow youtube pro6
</I>&gt;<i> &gt; &gt; http_access allow youtube webvip
</I>&gt;<i> &gt; &gt; http_access deny youtube
</I>&gt;<i> &gt; &gt; http_access allow shopping pro5
</I>&gt;<i> &gt; &gt; http_access allow shopping pro6
</I>&gt;<i> &gt; &gt; http_access allow shopping webvip
</I>&gt;<i> &gt; &gt; http_access deny shopping
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Optimization hint:
</I>&gt;<i> &gt;  &quot;youtube&quot; and &quot;shopping&quot; have the same allow/deny criteria. It would be
</I>&gt;<i> &gt; worth combining them into one ACL.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; http_access allow social_networking pro2
</I>&gt;<i> &gt; &gt; http_access allow social_networking pro4
</I>&gt;<i> &gt; &gt; http_access allow social_networking pro6
</I>&gt;<i> &gt; &gt; http_access allow social_networking webvip
</I>&gt;<i> &gt; &gt; http_access deny social_networking
</I>&gt;<i> &gt; &gt; acl porn_site1   dstdomain &quot;/etc/squid/blacklists/porn/domains.txt&quot;
</I>&gt;<i> &gt; &gt; acl porn_site2   dstdom_regex -i
</I>&gt;<i> &quot;/etc/squid/blacklists/porn/expressions&quot;
</I>&gt;<i> &gt; &gt; acl porn_site3   dstdom_regex -i &quot;/etc/squid/blacklists/porn/urls.txt&quot;
</I>&gt;<i> &gt; &gt; acl audio_video1   dstdomain
</I>&gt;<i> &quot;/etc/squid/blacklists/audio-video/urls.txt&quot;
</I>&gt;<i> &gt; &gt; ###################### THERE ARE TOO MANY acls and http_access , so not
</I>&gt;<i> &gt; &gt; bothering with vast linux
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I will bet a lot of those ACLs are also calling the group helper too yes?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; http_access allow liquorinfo webvip
</I>&gt;<i> &gt; &gt; http_access deny liquorinfo
</I>&gt;<i> &gt; &gt; http_access allow ad_auth
</I>&gt;<i> &gt; &gt; http_access allow auth
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Once you have removed ad_auth ACL, this becomes:
</I>&gt;<i> &gt;  http_access allow auth
</I>&gt;<i> &gt;  http_access allow auth
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I hope you can see how redundant that is.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Also, its very likely that the &quot;allow auth&quot; is a useless operation after
</I>&gt;<i> &gt; a great many group checks have also performed authentication. That &quot;TOO
</I>&gt;<i> &gt; MANY acls and https_access&quot; list you omitted will be needed to determine
</I>&gt;<i> &gt; that.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; http_access allow sq1 sq2
</I>&gt;<i> &gt; &gt; acl NTLMUsers proxy_auth REQUIRED
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; You already have an ACL named &quot;auth&quot; which performs authentication.
</I>&gt;<i> &gt; The above line is not being used in any way. Remove it.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; http_access deny !Safe_ports
</I>&gt;<i> &gt; &gt; http_access deny CONNECT !SSL_ports
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; These are basic security protection against Denial of Service and other
</I>&gt;<i> &gt; types of protocol smuggling attacks. They only work when they are used
</I>&gt;<i> &gt; *above* your custom &quot;allow&quot; rules.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Move these two lines above your &quot;http_access allow google&quot; line.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; http_port 8080
</I>&gt;<i> &gt; &gt; hierarchy_stoplist cgi-bin ?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The above line is not useful these days. Remove it.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; cache_effective_user squid
</I>&gt;<i> &gt; &gt; cache_dir aufs /var/spool/squid 20384 32 512
</I>&gt;<i> &gt; &gt; cache_mem 50 MB
</I>&gt;<i> &gt; &gt; cache_replacement_policy heap LFUDA
</I>&gt;<i> &gt; &gt; cache_swap_low 85
</I>&gt;<i> &gt; &gt; cache_swap_high 95
</I>&gt;<i> &gt; &gt; maximum_object_size 5 MB
</I>&gt;<i> &gt; &gt; maximum_object_size_in_memory 50 KB
</I>&gt;<i> &gt; &gt; ipcache_size 5240
</I>&gt;<i> &gt; &gt; ipcache_low 90
</I>&gt;<i> &gt; &gt; ipcache_high 95
</I>&gt;<i> &gt; &gt; cache_mgr amit
</I>&gt;<i> &gt; &gt; acl SSL_ports port 443
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The above is a duplicate config line. Remove it.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; http_access allow CONNECT SSL_ports
</I>&gt;<i> &gt; &gt; coredump_dir /var/spool/squid
</I>&gt;<i> &gt; &gt; refresh_pattern ^ftp:           1440    20%     10080
</I>&gt;<i> &gt; &gt; refresh_pattern ^gopher:        1440    0%      1440
</I>&gt;<i> &gt; &gt; refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
</I>&gt;<i> &gt; &gt; refresh_pattern .               0       20%     4320
</I>&gt;<i> &gt; &gt; url_rewrite_program /usr/local/bin/squidGuard -c
</I>&gt;<i> &gt; &gt; /usr/local/squidGuard/squidGuard.conf
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Now, as to solving your problem:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 1) Clean up your config. Reduce the amount of redundant or unused
</I>&gt;<i> &gt; things. I've mentioned a few above.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 2) Run &quot;squid -k parse&quot; and fix any other problems it highlights.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 3) optimize your ACls and http_access rules. I've mentioned a few, such
</I>&gt;<i> &gt; as moving the main security checks to the top so DoS traffic does not
</I>&gt;<i> &gt; put load on the helpers and other ACLs.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I believe though that you will probably find Squid works much better
</I>&gt;<i> &gt; having the following access controls pattern:
</I>&gt;<i> &gt; &quot;
</I>&gt;<i> &gt;  http_access deny !Safe_ports
</I>&gt;<i> &gt;  http_access deny CONNECT !SSL_ports
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  # if they are not authenticated, they will not be in a group
</I>&gt;<i> &gt;  http_access deny !auth
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  # assuming that webvip are the group with full access?
</I>&gt;<i> &gt;  http_access allow webvip
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  # your long list of per-site group check ACLs go here
</I>&gt;<i> &gt;  ...
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  # this is where defining the LAN ranges correctly comes in.
</I>&gt;<i> &gt;  # note that users have authenticated simply to get near here
</I>&gt;<i> &gt;  http_access allow localnet
</I>&gt;<i> &gt;  http_access deny all
</I>&gt;<i> &gt; &quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 4) consider an upgrade to Squid 3.4+. The &quot;notes&quot; ACL type offers much
</I>&gt;<i> &gt; more efficient ACL testing with a custom group lookup helper. The all-of
</I>&gt;<i> &gt; and any-of ACL types can also much reduce your http_access lines.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; HTH
</I>&gt;<i> &gt; Amos
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; squid-users mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thank you Amos, I will check and will update the list.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Thanks &amp; Regards
</I>&gt;<i>
</I>&gt;<i> B Jagannath
</I>&gt;<i> Keen &amp; Able Computers Pvt. Ltd.
</I>&gt;<i> -------------- next part --------------
</I>&gt;<i> An HTML attachment was scrubbed...
</I>&gt;<i> URL: &lt;
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150423/4e7744c9/attachment.html">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150423/4e7744c9/attachment.html</A>
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> Subject: Digest Footer
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> End of squid-users Digest, Vol 8, Issue 52
</I>&gt;<i> ******************************************
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150424/38650b84/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150424/38650b84/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003257.html">[squid-users] HTTPS Filtering and SSL-Bump
</A></li>
	<LI>Next message (by thread): <A HREF="003245.html">[squid-users] Using Squid as a Transparent Proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3366">[ date ]</a>
              <a href="thread.html#3366">[ thread ]</a>
              <a href="subject.html#3366">[ subject ]</a>
              <a href="author.html#3366">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
