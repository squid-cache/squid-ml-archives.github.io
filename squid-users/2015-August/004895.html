<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Problems with Squid 3 Authentication on Samba 4
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problems%20with%20Squid%203%20Authentication%20on%20Samba%204&In-Reply-To=%3C55BD6C0E.3000109%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004894.html">
   <LINK REL="Next"  HREF="004896.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Problems with Squid 3 Authentication on Samba 4</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problems%20with%20Squid%203%20Authentication%20on%20Samba%204&In-Reply-To=%3C55BD6C0E.3000109%40treenet.co.nz%3E"
       TITLE="[squid-users] Problems with Squid 3 Authentication on Samba 4">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Aug  2 01:02:06 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004894.html">[squid-users] Problems with Squid 3 Authentication on Samba 4
</A></li>
        <LI>Next message (by thread): <A HREF="004896.html">[squid-users] Detecting clients flooding squid with failed request
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4895">[ date ]</a>
              <a href="thread.html#4895">[ thread ]</a>
              <a href="subject.html#4895">[ subject ]</a>
              <a href="author.html#4895">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2/08/2015 11:57 a.m., Marcio Demetrio Bacci wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I'm trying to authenticate the squid3 in Samba4. The part of Samba 4
</I>&gt;<i> authentication is OK, because with the commands wbinfo -i, getent passwd,
</I>&gt;<i> klist, kinit is all right and I can  get  the expected results. Also on the
</I>&gt;<i> command line can authenticate users (/usr /bin/ntlm_auth --username =
</I>&gt;<i> DomainUser), however, when using the squid does not.
</I>&gt;<i> 
</I>
That shows the helper is able to contact AD fine to do lookups in Basic
auth format. What it fails to tell is:

a) whether the browser is trying to use NTLM, Basic or both
b) whether the NTLM token assignment from AD to browser is working
c) whether the browser supports NTLM
d) whether the OS the browser is running on is NTLM-enabled
e) what NTLM v1 or v2 the OS the browser runs on supports
f) whether the OS the browser is running on is attached to the domain

Start by using the ntlm_auth helpers debug option. To see if there is
anything useful there.

Then move on to get debug out of Squid. Configure &quot;debug_options ALL,1
11,2 29,9 84,6&quot; in squid.conf to get a copy of the HTTP messages and the
auth helper activity in cache.log.

With that you can see the answer to (a), and the tokens that are being
passed around can be pasted to command line in for manual testing of the
helper with the same parameters Squid is using.


&gt;<i> I have already followed several tutorials, including to authenticate to AD,
</I>&gt;<i> as the Samba 4  is fully compatible with AD. Nothing works.
</I>&gt;<i> 
</I>&gt;<i> Follow my configuration file (squid.conf):
</I>&gt;<i> 
</I>
Looks okay to me. Though it does contain this oddity:

  auth_param ntlm children 30
  auth_param ntlm children 5

I suspect you meant the second one to be for basic auth.


You should also try using the hacky:

  auth_param ntlm keep_alive off

(required by older MSIE, some Firefox, and most Safari versions).


&gt;<i> I found that the Squid folder there is this file that does not know:
</I>&gt;<i> msntauth.conf, with the following contents:
</I>
msntauth.conf is the config file for the basic_msnt_auth helper.

&gt;<i> 
</I>&gt;<i> I'm using Debian 8 and Samba 4.1.17.
</I>&gt;<i> 
</I>&gt;<i> Do anybody have an idea?
</I>&gt;<i> 
</I>
I suspect the browser&lt;-&gt;Squid interaction is not doing what you think it
is. The above debugging will give you a better idea whats going on.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004894.html">[squid-users] Problems with Squid 3 Authentication on Samba 4
</A></li>
	<LI>Next message (by thread): <A HREF="004896.html">[squid-users] Detecting clients flooding squid with failed request
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4895">[ date ]</a>
              <a href="thread.html#4895">[ thread ]</a>
              <a href="subject.html#4895">[ subject ]</a>
              <a href="author.html#4895">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
