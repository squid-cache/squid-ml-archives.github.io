<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Detecting clients flooding squid with failed	request
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Detecting%20clients%20flooding%20squid%20with%20failed%0A%09request&In-Reply-To=%3C97817379-C4B6-40AE-B64D-904AA472C342%40getbusi.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004898.html">
   <LINK REL="Next"  HREF="004901.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Detecting clients flooding squid with failed	request</H1>
    <B>Dan Charlesworth</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Detecting%20clients%20flooding%20squid%20with%20failed%0A%09request&In-Reply-To=%3C97817379-C4B6-40AE-B64D-904AA472C342%40getbusi.com%3E"
       TITLE="[squid-users] Detecting clients flooding squid with failed	request">dan at getbusi.com
       </A><BR>
    <I>Mon Aug  3 07:25:50 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004898.html">[squid-users] Detecting clients flooding squid with failed	request
</A></li>
        <LI>Next message (by thread): <A HREF="004901.html">[squid-users] Detecting clients flooding squid with failed request
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4899">[ date ]</a>
              <a href="thread.html#4899">[ thread ]</a>
              <a href="subject.html#4899">[ subject ]</a>
              <a href="author.html#4899">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Antony. 

Fail2ban looks like a viable option though we would still need to write a regex definition to target this sort of behaviour. Their squid example targets aggressive hosts where my preference would be to target aggressive applications (that could be running on more than one host).

<A HREF="https://github.com/fail2ban/fail2ban/blob/master/config/filter.d/squid.conf">https://github.com/fail2ban/fail2ban/blob/master/config/filter.d/squid.conf</A>

In my case &#8220;raise the alarm&#8221; would probably mean send an email to somebody and there are lots of ways to do that programmatically.

Still open to any other ideas anyone has.

&gt;<i> On 3 Aug 2015, at 5:11 pm, Antony Stone &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">Antony.Stone at squid.open.source.it</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> On Monday 03 August 2015 at 08:06:35 (EU time), Dan Charlesworth wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> Probably a lot of forward proxy users here have encountered applications
</I>&gt;&gt;<i> which, if they can&#8217;t get their web requests through the proxy (because of
</I>&gt;&gt;<i> 407 Proxy Auth Required or whatever), just start aggressively, endlessly
</I>&gt;&gt;<i> spamming requests.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> A recent example would be AVG&#8217;s &#8220;cloud&#8221; features generating around 90
</I>&gt;&gt;<i> requests per second from one computer. Pretty annoying.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I was wondering if anyone here has any creative ideas for detecting when
</I>&gt;&gt;<i> this is happening programmatically?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> It&#8217;s obviously easy to spot as a human if you&#8217;re looking at the access log,
</I>&gt;&gt;<i> but it would be awesome if we could somehow parse some squidclient manager
</I>&gt;&gt;<i> output and/or the access logs and &#8220;raise the alarm&#8221; in some way.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Would love to hear anyone&#8217;s ideas about how the logic would work for
</I>&gt;&gt;<i> something like this.
</I>&gt;<i> 
</I>&gt;<i> Depending on what action you want for &quot;raising the alarm&quot;, I'm pretty sure 
</I>&gt;<i> fail2ban could be configured for this.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Antony.
</I>&gt;<i> 
</I>&gt;<i> -- 
</I>&gt;<i> Anyone that's normal doesn't really achieve much.
</I>&gt;<i> 
</I>&gt;<i> - Mark Blair, Australian rocket engineer
</I>&gt;<i> 
</I>&gt;<i>                                                   Please reply to the list;
</I>&gt;<i>                                                         please *don't* CC me.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004898.html">[squid-users] Detecting clients flooding squid with failed	request
</A></li>
	<LI>Next message (by thread): <A HREF="004901.html">[squid-users] Detecting clients flooding squid with failed request
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4899">[ date ]</a>
              <a href="thread.html#4899">[ thread ]</a>
              <a href="subject.html#4899">[ subject ]</a>
              <a href="author.html#4899">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
