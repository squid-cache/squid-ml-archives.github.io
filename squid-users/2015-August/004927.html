<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] I want to display indirect_client_address on error page.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20I%20want%20to%20display%20indirect_client_address%20on%0A%20error%20page.&In-Reply-To=%3C20150806.142748.68559068.asakura%40ioc.dnp.co.jp%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004925.html">
   <LINK REL="Next"  HREF="004933.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] I want to display indirect_client_address on error page.</H1>
    <B>Kazuhiro Asakura</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20I%20want%20to%20display%20indirect_client_address%20on%0A%20error%20page.&In-Reply-To=%3C20150806.142748.68559068.asakura%40ioc.dnp.co.jp%3E"
       TITLE="[squid-users] I want to display indirect_client_address on error page.">asakura at ioc.dnp.co.jp
       </A><BR>
    <I>Thu Aug  6 05:27:48 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004925.html">[squid-users] I want to display indirect_client_address on error page.
</A></li>
        <LI>Next message (by thread): <A HREF="004933.html">[squid-users] I want to display indirect_client_address on error page.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4927">[ date ]</a>
              <a href="thread.html#4927">[ thread ]</a>
              <a href="subject.html#4927">[ subject ]</a>
              <a href="author.html#4927">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thank you Amos,

From: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
&gt;<i> &gt; I use &quot;follow-x-forwarded-for&quot; feature, and logged end point IP address.
</I>&gt;<i> &gt; Also, I created customized error page for end user. but, env %i of
</I>&gt;<i> &gt; error page does not be translate to end point IP address.
</I>&gt;<i> 
</I>&gt;<i> More correctly it is the direct endpoint of the client TCP connection.
</I>&gt;<i> Not the chain of multiple TCP connections, which may include NAT or
</I>&gt;<i> other protocol translations between Squid and a user.
</I>
Sorry, My description not enough.

In this environment, BIG-IP exist between end point PC and Squid.
BIG-IP do NAT, and add X-FORWARDED-FOR header.
BIG-IP include IP address of endpoint PC for X-FORWARDED-FOR header.

So, I use follow-x-forwarded-for feature, and get endpoint PC IP address .

This time, endpoint PC IP address is written into Squid access.log.

Maybe, source code is below,

AccessLogEntry.cc
----
#if FOLLOW_X_FORWARDED_FOR
    if (Config.onoff.log_uses_indirect_client &amp;&amp; request)
        log_ip = request-&gt;indirect_client_addr;
    else
#endif
----

But, it is not assigned to environment variable of error page.

If environment variable of error page could support &quot;indirect_client_addr&quot;,
I would really appreciate it.

&gt;<i> &gt; I want to display the address of end point to error page.
</I>&gt;<i> &gt; If someone could suggest solution, I would really appreciate it.
</I>&gt;<i> 
</I>&gt;<i> The easiest approach I think would be to add a javascript snippet in
</I>&gt;<i> place of the %i code that locates the users IP address and displays it
</I>&gt;<i> to them.
</I>
I feel that way is difficult.
Because, solution of javascript only works JScript, or require STUN server.

&gt;<i> &gt; Sorry my poor English.
</I>&gt;<i>
</I>&gt;<i> Not a problem. Quite good compared to some.
</I>
I'm writing using Google translate.
I hope the feelings of my gratitude will reach you.

regards,
Kazuhiro

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004925.html">[squid-users] I want to display indirect_client_address on error page.
</A></li>
	<LI>Next message (by thread): <A HREF="004933.html">[squid-users] I want to display indirect_client_address on error page.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4927">[ date ]</a>
              <a href="thread.html#4927">[ thread ]</a>
              <a href="subject.html#4927">[ subject ]</a>
              <a href="author.html#4927">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
