<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] I want to display indirect_client_address on error page.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20I%20want%20to%20display%20indirect_client_address%20on%0A%20error%20page.&In-Reply-To=%3C55C34EFF.9050500%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004927.html">
   <LINK REL="Next"  HREF="004938.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] I want to display indirect_client_address on error page.</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20I%20want%20to%20display%20indirect_client_address%20on%0A%20error%20page.&In-Reply-To=%3C55C34EFF.9050500%40treenet.co.nz%3E"
       TITLE="[squid-users] I want to display indirect_client_address on error page.">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Aug  6 12:11:43 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004927.html">[squid-users] I want to display indirect_client_address on error page.
</A></li>
        <LI>Next message (by thread): <A HREF="004938.html">[squid-users] I want to display indirect_client_address on error page.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4933">[ date ]</a>
              <a href="thread.html#4933">[ thread ]</a>
              <a href="subject.html#4933">[ subject ]</a>
              <a href="author.html#4933">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 6/08/2015 5:27 p.m., Kazuhiro Asakura wrote:
&gt;<i> Thank you Amos,
</I>&gt;<i> 
</I>&gt;<i> From: Amos Jeffries
</I>&gt;&gt;&gt;<i> I use &quot;follow-x-forwarded-for&quot; feature, and logged end point IP address.
</I>&gt;&gt;&gt;<i> Also, I created customized error page for end user. but, env %i of
</I>&gt;&gt;&gt;<i> error page does not be translate to end point IP address.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> More correctly it is the direct endpoint of the client TCP connection.
</I>&gt;&gt;<i> Not the chain of multiple TCP connections, which may include NAT or
</I>&gt;&gt;<i> other protocol translations between Squid and a user.
</I>&gt;<i> 
</I>&gt;<i> Sorry, My description not enough.
</I>&gt;<i> 
</I>&gt;<i> In this environment, BIG-IP exist between end point PC and Squid.
</I>&gt;<i> BIG-IP do NAT, and add X-FORWARDED-FOR header.
</I>&gt;<i> BIG-IP include IP address of endpoint PC for X-FORWARDED-FOR header.
</I>&gt;<i> 
</I>&gt;<i> So, I use follow-x-forwarded-for feature, and get endpoint PC IP address .
</I>
Okay.

&gt;<i> 
</I>&gt;<i> This time, endpoint PC IP address is written into Squid access.log.
</I>&gt;<i> 
</I>&gt;<i> Maybe, source code is below,
</I>&gt;<i> 
</I>&gt;<i> AccessLogEntry.cc
</I>&gt;<i> ----
</I>&gt;<i> #if FOLLOW_X_FORWARDED_FOR
</I>&gt;<i>     if (Config.onoff.log_uses_indirect_client &amp;&amp; request)
</I>&gt;<i>         log_ip = request-&gt;indirect_client_addr;
</I>&gt;<i>     else
</I>&gt;<i> #endif
</I>&gt;<i> ----
</I>&gt;<i> 
</I>
Yes. Correct.

&gt;<i> But, it is not assigned to environment variable of error page.
</I>
Correct. That is a bug, but not easily solved.


&gt;<i> 
</I>&gt;<i> If environment variable of error page could support &quot;indirect_client_addr&quot;,
</I>&gt;<i> I would really appreciate it.
</I>&gt;<i> 
</I>
Understood.


&gt;&gt;&gt;<i> I want to display the address of end point to error page.
</I>&gt;&gt;&gt;<i> If someone could suggest solution, I would really appreciate it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The easiest approach I think would be to add a javascript snippet in
</I>&gt;&gt;<i> place of the %i code that locates the users IP address and displays it
</I>&gt;&gt;<i> to them.
</I>&gt;<i> 
</I>&gt;<i> I feel that way is difficult.
</I>&gt;<i> Because, solution of javascript only works JScript, or require STUN server.
</I>&gt;<i> 
</I>
STUN ? I dont understand why that would be relevant.

If the error message is really for client reading then their brower
already is aware of its own IP address and should be able to display
that with javascript/Jscript. All modern browsers have that capability.

If the error details is for your internal use and not the client, then
sending the IP in the body of an error page is the wrong thing to do. A
custom header would be better for most uses. X-Client-IP is used already
by some software.



Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004927.html">[squid-users] I want to display indirect_client_address on error page.
</A></li>
	<LI>Next message (by thread): <A HREF="004938.html">[squid-users] I want to display indirect_client_address on error page.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4933">[ date ]</a>
              <a href="thread.html#4933">[ thread ]</a>
              <a href="subject.html#4933">[ subject ]</a>
              <a href="author.html#4933">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
