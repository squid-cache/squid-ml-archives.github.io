<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] I want to display indirect_client_address on error page.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20I%20want%20to%20display%20indirect_client_address%20on%0A%20error%20page.&In-Reply-To=%3C20150807.185328.68556267.asakura%40ioc.dnp.co.jp%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004933.html">
   <LINK REL="Next"  HREF="004940.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] I want to display indirect_client_address on error page.</H1>
    <B>Kazuhiro Asakura</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20I%20want%20to%20display%20indirect_client_address%20on%0A%20error%20page.&In-Reply-To=%3C20150807.185328.68556267.asakura%40ioc.dnp.co.jp%3E"
       TITLE="[squid-users] I want to display indirect_client_address on error page.">asakura at ioc.dnp.co.jp
       </A><BR>
    <I>Fri Aug  7 09:53:28 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004933.html">[squid-users] I want to display indirect_client_address on error page.
</A></li>
        <LI>Next message (by thread): <A HREF="004940.html">[squid-users] I want to display indirect_client_address on error page.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4938">[ date ]</a>
              <a href="thread.html#4938">[ thread ]</a>
              <a href="subject.html#4938">[ subject ]</a>
              <a href="author.html#4938">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thank you Amos, again.

I will investigate solution of javascript again.

But, next week is holiday, Called &quot;O-bon&quot; in Japanese.
Maybe reply will late. please pardon.

&gt;<i> If the error details is for your internal use and not the client, then
</I>&gt;<i> sending the IP in the body of an error page is the wrong thing to do. A
</I>&gt;<i> custom header would be better for most uses. X-Client-IP is used already
</I>&gt;<i> by some software.
</I>
I use custom error page for Helpdesk work.
Our employee are low IT literacy. So, they can not confirm own
IP address by themselves.

regards,
Kazuhiro


From: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
Subject: Re: [squid-users] I want to display indirect_client_address on error page.
Date: Fri, 7 Aug 2015 00:11:43 +1200

&gt;<i> On 6/08/2015 5:27 p.m., Kazuhiro Asakura wrote:
</I>&gt;<i> &gt; Thank you Amos,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; From: Amos Jeffries
</I>&gt;<i> &gt;&gt;&gt; I use &quot;follow-x-forwarded-for&quot; feature, and logged end point IP address.
</I>&gt;<i> &gt;&gt;&gt; Also, I created customized error page for end user. but, env %i of
</I>&gt;<i> &gt;&gt;&gt; error page does not be translate to end point IP address.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; More correctly it is the direct endpoint of the client TCP connection.
</I>&gt;<i> &gt;&gt; Not the chain of multiple TCP connections, which may include NAT or
</I>&gt;<i> &gt;&gt; other protocol translations between Squid and a user.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Sorry, My description not enough.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; In this environment, BIG-IP exist between end point PC and Squid.
</I>&gt;<i> &gt; BIG-IP do NAT, and add X-FORWARDED-FOR header.
</I>&gt;<i> &gt; BIG-IP include IP address of endpoint PC for X-FORWARDED-FOR header.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; So, I use follow-x-forwarded-for feature, and get endpoint PC IP address .
</I>&gt;<i> 
</I>&gt;<i> Okay.
</I>&gt;<i> 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; This time, endpoint PC IP address is written into Squid access.log.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Maybe, source code is below,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; AccessLogEntry.cc
</I>&gt;<i> &gt; ----
</I>&gt;<i> &gt; #if FOLLOW_X_FORWARDED_FOR
</I>&gt;<i> &gt;     if (Config.onoff.log_uses_indirect_client &amp;&amp; request)
</I>&gt;<i> &gt;         log_ip = request-&gt;indirect_client_addr;
</I>&gt;<i> &gt;     else
</I>&gt;<i> &gt; #endif
</I>&gt;<i> &gt; ----
</I>&gt;<i> &gt; 
</I>&gt;<i> 
</I>&gt;<i> Yes. Correct.
</I>&gt;<i> 
</I>&gt;<i> &gt; But, it is not assigned to environment variable of error page.
</I>&gt;<i> 
</I>&gt;<i> Correct. That is a bug, but not easily solved.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; If environment variable of error page could support &quot;indirect_client_addr&quot;,
</I>&gt;<i> &gt; I would really appreciate it.
</I>&gt;<i> &gt; 
</I>&gt;<i> 
</I>&gt;<i> Understood.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt;&gt;&gt; I want to display the address of end point to error page.
</I>&gt;<i> &gt;&gt;&gt; If someone could suggest solution, I would really appreciate it.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; The easiest approach I think would be to add a javascript snippet in
</I>&gt;<i> &gt;&gt; place of the %i code that locates the users IP address and displays it
</I>&gt;<i> &gt;&gt; to them.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I feel that way is difficult.
</I>&gt;<i> &gt; Because, solution of javascript only works JScript, or require STUN server.
</I>&gt;<i> &gt; 
</I>&gt;<i> 
</I>&gt;<i> STUN ? I dont understand why that would be relevant.
</I>&gt;<i> 
</I>&gt;<i> If the error message is really for client reading then their brower
</I>&gt;<i> already is aware of its own IP address and should be able to display
</I>&gt;<i> that with javascript/Jscript. All modern browsers have that capability.
</I>&gt;<i> 
</I>&gt;<i> If the error details is for your internal use and not the client, then
</I>&gt;<i> sending the IP in the body of an error page is the wrong thing to do. A
</I>&gt;<i> custom header would be better for most uses. X-Client-IP is used already
</I>&gt;<i> by some software.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Amos
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004933.html">[squid-users] I want to display indirect_client_address on error page.
</A></li>
	<LI>Next message (by thread): <A HREF="004940.html">[squid-users] I want to display indirect_client_address on error page.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4938">[ date ]</a>
              <a href="thread.html#4938">[ thread ]</a>
              <a href="subject.html#4938">[ subject ]</a>
              <a href="author.html#4938">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
