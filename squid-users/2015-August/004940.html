<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] I want to display indirect_client_address on error page.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20I%20want%20to%20display%20indirect_client_address%20on%0A%20error%20page.&In-Reply-To=%3C55C4CB92.5070702%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004938.html">
   <LINK REL="Next"  HREF="004920.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] I want to display indirect_client_address on error page.</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20I%20want%20to%20display%20indirect_client_address%20on%0A%20error%20page.&In-Reply-To=%3C55C4CB92.5070702%40ngtech.co.il%3E"
       TITLE="[squid-users] I want to display indirect_client_address on error page.">eliezer at ngtech.co.il
       </A><BR>
    <I>Fri Aug  7 15:15:30 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004938.html">[squid-users] I want to display indirect_client_address on error page.
</A></li>
        <LI>Next message (by thread): <A HREF="004920.html">[squid-users] How can I capture post data?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4940">[ date ]</a>
              <a href="thread.html#4940">[ thread ]</a>
              <a href="subject.html#4940">[ subject ]</a>
              <a href="author.html#4940">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Does the client has the option to access some internal webserver which 
can reflect the IP address of the client?
If so.. you can redirect from an error page to it.

Eliezer

On 07/08/2015 12:53, Kazuhiro Asakura wrote:
&gt;<i> Thank you Amos, again.
</I>&gt;<i>
</I>&gt;<i> I will investigate solution of javascript again.
</I>&gt;<i>
</I>&gt;<i> But, next week is holiday, Called &quot;O-bon&quot; in Japanese.
</I>&gt;<i> Maybe reply will late. please pardon.
</I>&gt;<i>
</I>&gt;&gt;<i> If the error details is for your internal use and not the client, then
</I>&gt;&gt;<i> sending the IP in the body of an error page is the wrong thing to do. A
</I>&gt;&gt;<i> custom header would be better for most uses. X-Client-IP is used already
</I>&gt;&gt;<i> by some software.
</I>&gt;<i>
</I>&gt;<i> I use custom error page for Helpdesk work.
</I>&gt;<i> Our employee are low IT literacy. So, they can not confirm own
</I>&gt;<i> IP address by themselves.
</I>&gt;<i>
</I>&gt;<i> regards,
</I>&gt;<i> Kazuhiro
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> From: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
</I>&gt;<i> Subject: Re: [squid-users] I want to display indirect_client_address on error page.
</I>&gt;<i> Date: Fri, 7 Aug 2015 00:11:43 +1200
</I>&gt;<i>
</I>&gt;&gt;<i> On 6/08/2015 5:27 p.m., Kazuhiro Asakura wrote:
</I>&gt;&gt;&gt;<i> Thank you Amos,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> From: Amos Jeffries
</I>&gt;&gt;&gt;&gt;&gt;<i> I use &quot;follow-x-forwarded-for&quot; feature, and logged end point IP address.
</I>&gt;&gt;&gt;&gt;&gt;<i> Also, I created customized error page for end user. but, env %i of
</I>&gt;&gt;&gt;&gt;&gt;<i> error page does not be translate to end point IP address.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> More correctly it is the direct endpoint of the client TCP connection.
</I>&gt;&gt;&gt;&gt;<i> Not the chain of multiple TCP connections, which may include NAT or
</I>&gt;&gt;&gt;&gt;<i> other protocol translations between Squid and a user.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Sorry, My description not enough.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> In this environment, BIG-IP exist between end point PC and Squid.
</I>&gt;&gt;&gt;<i> BIG-IP do NAT, and add X-FORWARDED-FOR header.
</I>&gt;&gt;&gt;<i> BIG-IP include IP address of endpoint PC for X-FORWARDED-FOR header.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> So, I use follow-x-forwarded-for feature, and get endpoint PC IP address .
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Okay.
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> This time, endpoint PC IP address is written into Squid access.log.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Maybe, source code is below,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> AccessLogEntry.cc
</I>&gt;&gt;&gt;<i> ----
</I>&gt;&gt;&gt;<i> #if FOLLOW_X_FORWARDED_FOR
</I>&gt;&gt;&gt;<i>      if (Config.onoff.log_uses_indirect_client &amp;&amp; request)
</I>&gt;&gt;&gt;<i>          log_ip = request-&gt;indirect_client_addr;
</I>&gt;&gt;&gt;<i>      else
</I>&gt;&gt;&gt;<i> #endif
</I>&gt;&gt;&gt;<i> ----
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Yes. Correct.
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> But, it is not assigned to environment variable of error page.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Correct. That is a bug, but not easily solved.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> If environment variable of error page could support &quot;indirect_client_addr&quot;,
</I>&gt;&gt;&gt;<i> I would really appreciate it.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Understood.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> I want to display the address of end point to error page.
</I>&gt;&gt;&gt;&gt;&gt;<i> If someone could suggest solution, I would really appreciate it.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> The easiest approach I think would be to add a javascript snippet in
</I>&gt;&gt;&gt;&gt;<i> place of the %i code that locates the users IP address and displays it
</I>&gt;&gt;&gt;&gt;<i> to them.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I feel that way is difficult.
</I>&gt;&gt;&gt;<i> Because, solution of javascript only works JScript, or require STUN server.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> STUN ? I dont understand why that would be relevant.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If the error message is really for client reading then their brower
</I>&gt;&gt;<i> already is aware of its own IP address and should be able to display
</I>&gt;&gt;<i> that with javascript/Jscript. All modern browsers have that capability.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If the error details is for your internal use and not the client, then
</I>&gt;&gt;<i> sending the IP in the body of an error page is the wrong thing to do. A
</I>&gt;&gt;<i> custom header would be better for most uses. X-Client-IP is used already
</I>&gt;&gt;<i> by some software.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004938.html">[squid-users] I want to display indirect_client_address on error page.
</A></li>
	<LI>Next message (by thread): <A HREF="004920.html">[squid-users] How can I capture post data?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4940">[ date ]</a>
              <a href="thread.html#4940">[ thread ]</a>
              <a href="subject.html#4940">[ subject ]</a>
              <a href="author.html#4940">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
