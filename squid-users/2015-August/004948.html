<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Caching requests to a non standard http port help please.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Caching%20requests%20to%20a%20non%20standard%20http%20port%20help%0A%20please.&In-Reply-To=%3C55C823A5.30609%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004947.html">
   <LINK REL="Next"  HREF="004949.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Caching requests to a non standard http port help please.</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Caching%20requests%20to%20a%20non%20standard%20http%20port%20help%0A%20please.&In-Reply-To=%3C55C823A5.30609%40treenet.co.nz%3E"
       TITLE="[squid-users] Caching requests to a non standard http port help please.">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Aug 10 04:08:05 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004947.html">[squid-users] Caching requests to a non standard http port help	please.
</A></li>
        <LI>Next message (by thread): <A HREF="004949.html">[squid-users] Include XML-File in squid.conf (for ex. allowing	without authentication...)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4948">[ date ]</a>
              <a href="thread.html#4948">[ thread ]</a>
              <a href="subject.html#4948">[ subject ]</a>
              <a href="author.html#4948">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/08/2015 4:27 a.m., 1508 wrote:
&gt;<i> Hello Anthony,
</I>&gt;<i> 
</I>&gt;<i> Thank you for your reply.
</I>&gt;<i> 
</I>&gt;<i> My quest is to try and cache stuff from a site called Second Life.
</I>&gt;<i> 
</I>&gt;<i> My bandwidth is poor and I'm trying to cache large objects that regulary get
</I>&gt;<i> re-requested.
</I>&gt;<i> 
</I>&gt;<i> The thing is part of the url will change, however the content willl not.
</I>&gt;<i> 
</I>&gt;<i> Here are some examples of urls I am trying to cache:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://sim9077.agni.lindenlab.com:12046/cap/db301865-157f-89d3-a98f-34acc5c9537a">http://sim9077.agni.lindenlab.com:12046/cap/db301865-157f-89d3-a98f-34acc5c9537a</A>
</I>&gt;<i> <A HREF="http://sim17097.agni.lindenlab.com:12046/cap/db301865-157f-89d3-a98f-34acc5c9537a">http://sim17097.agni.lindenlab.com:12046/cap/db301865-157f-89d3-a98f-34acc5c9537a</A>
</I>&gt;<i> 
</I>&gt;<i> OK, some answers.
</I>&gt;<i> 
</I>&gt;<i> Port 10050 was an example. 
</I>&gt;<i> 
</I>&gt;<i> acl Safe_ports port 80		# http
</I>&gt;<i> acl Safe_ports port 443	# https
</I>&gt;<i> acl Safe_ports port 12043 # LL port
</I>&gt;<i> acl Safe_ports port 12046 # LL port
</I>&gt;<i> 
</I>
The definition for Safe_ports provided with clean installs contains the
entry:
  acl Safe_ports port 1025-65535

The only ports which are unsafe are those used by protocols such as
email where the syntax overlaps with HTTP in dangerous ways. High
numbered ports do not usually have that problem.


&gt;<i> I am trying to rewrite part of the URL because the same data gets fetched
</I>&gt;<i> from different computers. So
</I>&gt;<i> in the RLs above the same item can be sent twice.
</I>&gt;<i> 
</I>
DO NOT re-write the URL for that.

Instead use a Store-ID helper to set the internal Squid cache ID for the
object. They work very similar to url-rewriting, so you should be able
to adjust your helper easily.


&gt;<i> I cannot see how the standard configuration can assume part of a URL is a
</I>&gt;<i> wildcard.
</I>
Those URLs above are a perfect example of why you should not be
URL-rewriting. Or even assuming that they are the same object coming back.

For me the top URL produces a 404 message saying the thing does not
exist. The bottom one produces something else.

If you were re-writing (and caching) the bad hash to point at the top
server, all visitors would get the 404 message while it was
force-cached. Nobody would be able to get to the working second URL
server. Even if they explicitly asked for that second one.


With Store-ID the helper just tells Squid that both objects are to be
stored in the same cache location (a URI which you provide from the
helper). When anybody asks for one of those the cache location is
checked, and if not found the URL *they asked for* is fetched and cached.

So, visitors who ask for URL #1 will get 404 until somebody asks for URL
#2 and gets the object cached. After which both URLs work using the
stored data from URL #2.

Much nicer.


There is one huge requirement that you need to pay very close attention
to. For any two objects to be collapsed they need to have both semantic
and binary equivalence to each other. That means the use by the client
has to be the same, and the binary form of the object has to be storing
the same details.

For games and REST APIs (things like Second Life), what appears to you
to be the same URL re-fetched constantly may actually be a constantly
changing object with large amounts of game environment updates in it. Or
just different encodings of the object being requested by decoders.
Passing the wrong version of object out could break things in hidden
ways. Be VERY careful what objects you combine.



&gt;<i> 
</I>&gt;<i> I have managed to rewrite static URL domain names and just change a ? into a
</I>&gt;<i> / so items get stored OK.
</I>
Not okay. Items after the '?' are variable in what order they can exist
(different order, different cache location). And in what characters are
allowed to be used there.

 Absolutely dont do that unless you are in control of the origin server.
And then you can have the origin tell visitors URLs without the '?' in
the first place.


Hope this helps, and good luck.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004947.html">[squid-users] Caching requests to a non standard http port help	please.
</A></li>
	<LI>Next message (by thread): <A HREF="004949.html">[squid-users] Include XML-File in squid.conf (for ex. allowing	without authentication...)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4948">[ date ]</a>
              <a href="thread.html#4948">[ thread ]</a>
              <a href="subject.html#4948">[ subject ]</a>
              <a href="author.html#4948">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
