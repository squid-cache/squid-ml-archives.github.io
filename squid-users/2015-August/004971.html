<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Configuring squid reverse proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Configuring%20squid%20reverse%20proxy&In-Reply-To=%3CCAPzTSf_7Ath7YUTPtV4bFjrRUdKGGqJSOrBTc9HRPS89pT7nzA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004968.html">
   <LINK REL="Next"  HREF="004969.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Configuring squid reverse proxy</H1>
    <B>joseph jose</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Configuring%20squid%20reverse%20proxy&In-Reply-To=%3CCAPzTSf_7Ath7YUTPtV4bFjrRUdKGGqJSOrBTc9HRPS89pT7nzA%40mail.gmail.com%3E"
       TITLE="[squid-users] Configuring squid reverse proxy">joevypana at gmail.com
       </A><BR>
    <I>Wed Aug 12 13:16:39 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004968.html">[squid-users] Configuring squid reverse proxy
</A></li>
        <LI>Next message (by thread): <A HREF="004969.html">[squid-users] Configuring squid reverse proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4971">[ date ]</a>
              <a href="thread.html#4971">[ thread ]</a>
              <a href="subject.html#4971">[ subject ]</a>
              <a href="author.html#4971">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>thanks for the quick reply. Actually those lines are no commented out. and
ACL name is corrected.

The browser is on the proxy machine(10.0.0.1) who host file points
testsquid.com to 10.0.0.1 itself.

Squid which is in reverse mode listen to port 80 in 10.0.0.1 is grabbing
each request. but returning TCP_DENIED/403 for testsquid.com. Instead of
returning the webserver static index file

As you told i have one browser machine win7 machine. in which i edited host
file and set testsquid.com to 10.0.0.1(proxy machine ip)

But behaviour remains same.
below is my actual squid config

acl PURGE method purge
acl SSL_ports port 443 445 448 563 1024-65535
acl Safe_ports port 80
acl Safe_ports port 21
acl Safe_ports port 443
acl Safe_ports port 70
acl Safe_ports port 210
acl Safe_ports port 1025-65535
acl Safe_ports port 280
acl Safe_ports port 488
acl Safe_ports port 591
acl Safe_ports port 777
acl CONNECT method CONNECT
acl local_addresses dst &quot;/usr/local/squid/etc/local_addresses.conf&quot;
acl allowsquid dstdomain testsquid.com
httpd_suppress_version_string on
cache allow all
cache_effective_user nobody
cache_effective_group nobody
cache_log /usr/local/squid/var/logs/cache.1.100.log
cache_store_log none
half_closed_clients off
hierarchy_stoplist $ cgi ? &amp; ; .asp .shtml localhost
http_access allow manager localhost
http_access allow allowsquid
http_access allow manager cachemgr
http_access deny manager
http_access deny CONNECT !SSL_ports
http_access deny CONNECT local_addresses
http_access allow purge localhost
http_access allow purge cachemgr
http_access deny purge
http_access allow all
http_access allow manager localhost
http_access deny manager
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access deny all
http_reply_access allow all
log_icp_queries off
maximum_object_size 0 KB
maximum_object_size_in_memory 0 KB
request_header_max_size 64 KB
reply_header_max_size 64 KB
strip_query_terms off
uri_whitespace encode
visible_hostname squidproxy
icp_access allow all
http_port 10.0.0.1:80 accel defaultsite=testsquid.com
cache_peer 10.0.0.2 parent 80 0 no-query originserver name=squidtest
cache_peer_access squidtest allow allowsquid
cache_peer_access squidtest deny all
acl QUERY urlpath_regex cgi-bin \?
cache deny QUERY
refresh_pattern ^ftp: 1440 20% 10080
refresh_pattern ^gopher: 1440 0% 1440
refresh_pattern . 0 20% 4320

Is there anything faulty in my config?

Regards,

Joseph

On Wed, Aug 12, 2015 at 6:22 PM, Antony Stone &lt;
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">Antony.Stone at squid.open.source.it</A>&gt; wrote:

&gt;<i> On Wednesday 12 August 2015 at 14:38:55, joseph jose wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; Hi,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I have set up squid in reverse proxy mode to cache an apache webserver
</I>&gt;<i> &gt; hosted in linux vm.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; IP of my squid reverse proxy is 10.0.0.1 and 10.0.0.2 is the ip of
</I>&gt;<i> &gt; webserver which is also a linux vm
</I>&gt;<i>
</I>&gt;<i> Your squid server has only one interface and IP address?
</I>&gt;<i>
</I>&gt;<i> &gt; my config is as follows
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; #acl squidallow dstdomain testsquid.com
</I>&gt;<i> &gt; #
</I>&gt;<i> &gt; #
</I>&gt;<i> &gt; #http_port 10.0.0.1:80 accel defaultsite=testsquid.com
</I>&gt;<i> &gt; #
</I>&gt;<i> &gt; #
</I>&gt;<i> &gt; #cache_peer 10.0.0.2 parent 80 0 no-query originserver name=squidtest
</I>&gt;<i> &gt; #cache_peer_access squidtest allow allowsquid
</I>&gt;<i>
</I>&gt;<i> I sincerely hope you don't mean that these directives are all commented
</I>&gt;<i> out,
</I>&gt;<i> thus not having any effect?
</I>&gt;<i>
</I>&gt;<i> Even if they're not commented out, do you see the discrepancy between
</I>&gt;<i> &quot;squidallow&quot; in the first line and &quot;allowsquid&quot; in the last?
</I>&gt;<i>
</I>&gt;<i> &gt; In the squid proxy machine i have edited the host file and set
</I>&gt;<i> &gt; testsquid.com 10.0.0.1 (which is the ip of proxy machine itself), as
</I>&gt;<i> proxy
</I>&gt;<i> &gt; is configured in reverse mode, it is supposed to serve the static page
</I>&gt;<i> &gt; from webserver (10.0.0.2).
</I>&gt;<i>
</I>&gt;<i> What's more important than /etc/hosts on the squid server is what machine
</I>&gt;<i> you
</I>&gt;<i> are running the browser on, and what does *that* machine resolve
</I>&gt;<i> testsquid.com
</I>&gt;<i> to?
</I>&gt;<i>
</I>&gt;<i> &gt; But when i open browser and search for testsquid.com, squid is logging
</I>&gt;<i> &gt; request but returning a TCP_DENIED/403 status.
</I>&gt;<i>
</I>&gt;<i> Sounds like the browser is successfully seeing testsquid.com as 10.0.0.1,
</I>&gt;<i> then, however you should be careful about trying to run tests like this on
</I>&gt;<i> too
</I>&gt;<i> few machines - you should have the browser on one machine, squid on a
</I>&gt;<i> second,
</I>&gt;<i> and the web server on a third (no matter whether any of these are real
</I>&gt;<i> machines or VMs).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Antony.
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Users don't know what they want until they see what they get.
</I>&gt;<i>
</I>&gt;<i>                                                    Please reply to the
</I>&gt;<i> list;
</I>&gt;<i>                                                          please *don't* CC
</I>&gt;<i> me.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150812/54ab9220/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150812/54ab9220/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004968.html">[squid-users] Configuring squid reverse proxy
</A></li>
	<LI>Next message (by thread): <A HREF="004969.html">[squid-users] Configuring squid reverse proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4971">[ date ]</a>
              <a href="thread.html#4971">[ thread ]</a>
              <a href="subject.html#4971">[ subject ]</a>
              <a href="author.html#4971">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
