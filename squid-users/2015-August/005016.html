<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] peek and splice content inspection question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20peek%20and%20splice%20content%20inspection%20question&In-Reply-To=%3C55CE0071.7050606%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005006.html">
   <LINK REL="Next"  HREF="005017.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] peek and splice content inspection question</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20peek%20and%20splice%20content%20inspection%20question&In-Reply-To=%3C55CE0071.7050606%40measurement-factory.com%3E"
       TITLE="[squid-users] peek and splice content inspection question">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Aug 14 14:51:29 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005006.html">[squid-users] peek and splice content inspection question
</A></li>
        <LI>Next message (by thread): <A HREF="005017.html">[squid-users] peek and splice content inspection question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5016">[ date ]</a>
              <a href="thread.html#5016">[ thread ]</a>
              <a href="subject.html#5016">[ subject ]</a>
              <a href="author.html#5016">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 08/13/2015 10:31 PM, Amos Jeffries wrote:
&gt;<i> AFAICS it
</I>&gt;<i> is the backend AV library only scanning disk objects that causes the
</I>&gt;<i> whole issue. Otherwise the eCAP could be much, much faster.
</I>
The situation is more nuanced: eCAP supports asynchronous adapters. It
is possible to write a ClamAV adapter that writes messages to disk and
analyses them without blocking Squid. Doing so should eliminate most
overheads between Squid and ClamAV.

Factory ClamAV adapter can run in asynchronous mode, but threads are
only used for _analysis_ of written files. We have not optimized the
file writing part (yet?). Hopefully, using a RAM-based file system can
mitigate a large part of that performance damage (as well as address
some of the security concerns related to disk storage?).

A bigger performance problem, AFAICT, is that ClamAV does not support
incremental analysis. It waits for the entire file to be downloaded
first. This breaks the message delivery pipeline and increases
user-perceived response time. This problem cannot be solved outside the
ClamAV library.


Cheers,

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005006.html">[squid-users] peek and splice content inspection question
</A></li>
	<LI>Next message (by thread): <A HREF="005017.html">[squid-users] peek and splice content inspection question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5016">[ date ]</a>
              <a href="thread.html#5016">[ thread ]</a>
              <a href="subject.html#5016">[ subject ]</a>
              <a href="author.html#5016">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
