<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] FW: debian Jessie squid with auth (kerberos/ntlm/basic) ERROR type NTLM type 3
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FW%3A%20debian%20Jessie%20squid%20with%20auth%0A%20%28kerberos/ntlm/basic%29%20ERROR%20type%20NTLM%20type%203&In-Reply-To=%3C55D2F0D1.2010101%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005033.html">
   <LINK REL="Next"  HREF="005035.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] FW: debian Jessie squid with auth (kerberos/ntlm/basic) ERROR type NTLM type 3</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FW%3A%20debian%20Jessie%20squid%20with%20auth%0A%20%28kerberos/ntlm/basic%29%20ERROR%20type%20NTLM%20type%203&In-Reply-To=%3C55D2F0D1.2010101%40treenet.co.nz%3E"
       TITLE="[squid-users] FW: debian Jessie squid with auth (kerberos/ntlm/basic) ERROR type NTLM type 3">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Aug 18 08:46:09 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005033.html">[squid-users] FW: debian Jessie squid with auth (kerberos/ntlm/basic) ERROR type NTLM type 3
</A></li>
        <LI>Next message (by thread): <A HREF="005035.html">[squid-users] Squid 3.5.7 for Microsoft Windows 64-bit is available
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5034">[ date ]</a>
              <a href="thread.html#5034">[ thread ]</a>
              <a href="subject.html#5034">[ subject ]</a>
              <a href="author.html#5034">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 18/08/2015 8:00 p.m., L.P.H. van Belle wrote:
&gt;<i> Hai Amos, 
</I>&gt;<i> 
</I>&gt;<i> Thank you for your very clear responce.. few small questions..
</I>&gt;<i> 
</I>&gt;<i> Is there a way to setup the proxy for the following.
</I>&gt;<i> 1) use negotiate kerberos for auth, ( which is working already for all domain joined machines )
</I>&gt;<i> 2) use a fall back that works, for now basic ldap works for non windows machines, and domain joined machines.
</I>&gt;<i> 3) use any other fallback way for authentication users on windows machines, that are not in the domain.
</I>&gt;<i> 	and without modify-ing anything in windows. as these are often guest machines. 
</I>
All Squid can do is offer mechanisms. The client is required to respond
using the most secure that it can use.

Configuring auth schemes in this order:

 auth_param negotiate program ...
 auth_param basic program ...

Should meet your needs almost all the time. But it really depends on the
client following either the specs or your offered order. Not all do. And
some think &quot;Negotiate&quot; means &quot;Negotiate/NTLM&quot;, and/or try that before
Negotiate/Kerberos.


&gt;<i> 
</I>&gt;<i> Is a link to a radius server an option, dont have a radus jet, but can be installed. 
</I>&gt;<i> and radius is also comming for my wifi authentication. 
</I>&gt;<i> whould that fix my problem (3) above, in a authentication fallback setup. 
</I>
Basic auth RADIUS helper can use RADIUS as an authentication backend.
Other than that I'm not familiar with it.

&gt;<i> 
</I>&gt;&gt;<i> One puzzling thing is why Win7 client is trying to use NTLM in 
</I>&gt;&gt;<i> the first
</I>&gt;&gt;<i> place. NTLM is disabled by default in Vista and later due to 
</I>&gt;&gt;<i> its lack of
</I>&gt;&gt;<i> security.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Try adding &quot;auth_param negotiate keep_alive off&quot; to close connections
</I>&gt;&gt;<i> when Negotiate/NTLM is used and force the client to retry with other
</I>&gt;&gt;<i> auth credentials on a clean connection.
</I>&gt;<i> 
</I>&gt;<i> these : 
</I>&gt;&gt;&gt;<i> auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -s HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">hostname.fqdn at REALM</A>    
</I>&gt;<i> and 
</I>&gt;&gt;&gt;<i> auth_param negotiate program /usr/local/bin/negotiate_wrapper
</I>&gt;<i> These lines, work both for negotiate kerberos.  
</I>&gt;<i> The last, when useing : /usr/local/bin/negotiate_wrapper was tested with the parameter 
</I>&gt;<i> negotiate keep_alive off. 
</I>&gt;<i> 
</I>&gt;<i> Above works fine with the domain joined pc, but not with the &quot;non domain joined&quot; PC. 
</I>&gt;<i> the negotiate kerberos works very good, but the fall back not. ( as you explained ) 
</I>&gt;<i> 
</I>&gt;<i> I found that if i setup with only basic_ldap_auth, against the AD, then i can use both,
</I>&gt;<i> domain joined and not domain joined, but the first time it always gives a popup for authenticating. 
</I>

Take a look and see what its sending for Basic auth credentials on first
try.

You may need to use a Basic auth helper that allows stripping the
@DOMAIN part off the credentials received. I think some systems send the
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">user at DOMAIN</A> in Basic with the machine name as DOMAIN. That wont work
against any real DC server.



&gt;<i> If once authenticated, it keeps it authenticated, aka windows/IE keeps the login and password. 
</I>&gt;<i> even if i clear the history. 
</I>
For NTLM or Negotiate credentials being used. Then credentials once
authenticated are tied permanently to the TCP connection(s) they were
used on. You have to fully close all the affected TCP connections to
&quot;logout&quot;. The only reliable way to do that is shutdown the whole browser.

For Basic auth credentials being used. They are only accepted so long as
the auth backend keeps accepting them. HTTP actually requires the
browser/client to send credentials on every single request. Squid checks
these against the ones it seen being valid before, or once every
credentialsttl timeout it re-checks fully against the backend server.


&gt;<i> 
</I>&gt;<i> Why i dont want this... 
</I>&gt;<i> If a user is logging in the domain, and kerberos auth is used, then when going on internet, 
</I>&gt;<i> the &quot;correct&quot; aka logged in user, is always used. 
</I>&gt;<i> but when i use basic_ldap_auth, then it gives the user to put in an other username/password at popup, 
</I>&gt;<i> then it remembers the login and a user now is internetting with an other users name.
</I>&gt;<i> 
</I>&gt;<i> So, when im right, a fallback for all is not possible, due to NTLM auth? 
</I>&gt;<i> 
</I>
I dont see where NTLM comes into that.

&gt;<i>From your description fallback authentication *is* working. But with
</I>users able to send credentials that you dont want to allow their use of.

That is a different (authorization) problem to solve. By authenticating
successfully the user is &quot;proving&quot; that they are who they claim to be.
Although Basic auth could possibly be a lie with somebody elses valid
credentials.

It is up to your authorization system to determine if the sener of
credentials X:Y are still allowed to access anything, and what. Squid
ACLs primarily used for that, but also the AD server can reject re-login
verification after Basic auth credentialsttl by Squid helper - that will
probably result in more popups.


Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005033.html">[squid-users] FW: debian Jessie squid with auth (kerberos/ntlm/basic) ERROR type NTLM type 3
</A></li>
	<LI>Next message (by thread): <A HREF="005035.html">[squid-users] Squid 3.5.7 for Microsoft Windows 64-bit is available
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5034">[ date ]</a>
              <a href="thread.html#5034">[ thread ]</a>
              <a href="subject.html#5034">[ subject ]</a>
              <a href="author.html#5034">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
