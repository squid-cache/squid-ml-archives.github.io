<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid reverse proxy in http &gt; https mode
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20reverse%20proxy%20in%20http%20%3E%20https%20mode&In-Reply-To=%3C55D366F6.4010503%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005053.html">
   <LINK REL="Next"  HREF="005057.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid reverse proxy in http &gt; https mode</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20reverse%20proxy%20in%20http%20%3E%20https%20mode&In-Reply-To=%3C55D366F6.4010503%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid reverse proxy in http &gt; https mode">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Aug 18 17:10:14 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005053.html">[squid-users] Squid reverse proxy in http &gt; https mode
</A></li>
        <LI>Next message (by thread): <A HREF="005057.html">[squid-users] Squid 3.5.7, cache_swap_high, bug or not bug ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5060">[ date ]</a>
              <a href="thread.html#5060">[ thread ]</a>
              <a href="subject.html#5060">[ subject ]</a>
              <a href="author.html#5060">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 19/08/2015 3:18 a.m., Veiko Kukk wrote:
&gt;<i> Hi
</I>&gt;<i> 
</I>&gt;<i> I'm trying to get most optimized solution for caching objects of cloud
</I>&gt;<i> storage.
</I>&gt;<i> 
</I>&gt;<i> The data flow I'd like to achieve is: http client &lt;http&gt; squid reverse
</I>&gt;<i> mode cache &lt;https&gt; remote https storage server
</I>&gt;<i> 
</I>
Squid does support gatewaying HTTP to servers over TLS/SSL. That part is
just:
  cache_peer example.com parent 443 0 originserver ssl

That will effectively take <A HREF="http://">http://</A> or <A HREF="https://">https://</A> traffic and convert it to
solely <A HREF="https://">https://</A> for the origin server.


<A HREF="https://">https://</A> is forbidden to be sent around un-encrypted. So getting that
traffic to Squid un-encrypted is near impossible.


&gt;<i> Common scenarios/examples of accel mode http(s) port include opposite
</I>&gt;<i> direction of traffic encryption/decryption, client connecting via https
</I>&gt;<i> and backend servers (cache_peer) being http. In my case client connects
</I>&gt;<i> via localhost and to reduce cpu load, I'd like to have this connection
</I>&gt;<i> without encryption and start encryption only when data leaves local
</I>&gt;<i> squid to parent cache_peer, because this remote server speaks https only.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Is this possible with squid?
</I>&gt;<i> 
</I>
That is up to the client software, but in almost all cases no. You have
to have an HTTPS listening port.



&gt;<i> Another related question is: when cache_peer hostname is dns name that
</I>&gt;<i> resolves into multiple ip addresses, then how does squid act? Does it
</I>&gt;<i> resolve it once and use first ip addres or all addresses in round robin,
</I>&gt;<i> or does it resolve every time cache_peer is accessed?
</I>
It resolves AAAA and A once per DNS TTL as is proper to ensure it has an
up to date and accurate IP list.

IPv6 results are sorted for preference over IPv4 results. Unless
dns_v4_first is configured to reverse the preference order. In
accordance with BCP 177.

That cache_peer's IP list is appended to the full list of potential
destination IPs along with any other sources which may be used.

Then TCP connection setup is tried sequentially down the full list of
destinations. Whichever IP is listed first and responds is used.


&gt;<i> What happens if
</I>&gt;<i> one of the addresses is not accessible?
</I>
It gets marked as bad/unavailable and the next one on the available list
is tried.


&gt;<i> I have checked documentation but
</I>&gt;<i> did not find any explanation on that topic.
</I>
The DNS parts are simply how DNS is supposed to work. Nothing special
about Squid.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005053.html">[squid-users] Squid reverse proxy in http &gt; https mode
</A></li>
	<LI>Next message (by thread): <A HREF="005057.html">[squid-users] Squid 3.5.7, cache_swap_high, bug or not bug ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5060">[ date ]</a>
              <a href="thread.html#5060">[ thread ]</a>
              <a href="subject.html#5060">[ subject ]</a>
              <a href="author.html#5060">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
