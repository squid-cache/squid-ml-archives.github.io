<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid-users Digest, Vol 12, Issue 33
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid-users%20Digest%2C%20Vol%2012%2C%20Issue%2033&In-Reply-To=%3CE5924590149B4B46AA1B326C644B6064326195%40NABESITE.InterDigital.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005128.html">
   <LINK REL="Next"  HREF="005076.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid-users Digest, Vol 12, Issue 33</H1>
    <B>Du, Hongfei</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid-users%20Digest%2C%20Vol%2012%2C%20Issue%2033&In-Reply-To=%3CE5924590149B4B46AA1B326C644B6064326195%40NABESITE.InterDigital.com%3E"
       TITLE="[squid-users] squid-users Digest, Vol 12, Issue 33">Hongfei.Du at InterDigital.com
       </A><BR>
    <I>Wed Aug 19 11:45:28 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005128.html">[squid-users] can't get bump to work anymore on 3.5.7?
</A></li>
        <LI>Next message (by thread): <A HREF="005076.html">[squid-users] Squid + Mysql
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5075">[ date ]</a>
              <a href="thread.html#5075">[ thread ]</a>
              <a href="subject.html#5075">[ subject ]</a>
              <a href="author.html#5075">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Eliezer and Amos
Sure, I have posted this to the squid-dev list, which is more relevant to this issue.

Many thanks for Amos' comments, really helpful information. For clarification, here we look at the HTTP caching, and only look into the cache-dir selection algorithm rather than the peer selection algorithm at this stage, namely, we create three separate folders in /var/spool/cache1, /var/spool/cache2, /var/spool/cache3, and we intend to make squid intelligent enough to strictly put content(e.g. all elements from a single URL as defined from one of our subscriber user) into a specified folder, rather than following any build-in RR/LL rules which is based on the status(e.g., residual capacity) of the cache server itself. For the RR/LL source codes we are looking for, it is really for the cache-dir selection algorithm applied for local storage(the three folders as mentioned above.) Besides, refers to: &quot; There is algorithm(s) applied in layers to decide which type of storage area is use, then which one within the selected type is most appropriate. Based on object availability, cacheability, size, storage area speed, object popularity, and temporal relationships to others.&quot; , can you elaborate more on where we can look into this algorithm(s)?

Best Regards,

IDCC

Humphrey(Hongfei)


Hongfei Du
Staff Engineer (UK Software)
InterDigital UK, Inc.
Shoreditch Business Center
64 Great Eastern Street
London,  EC2A 3QR
T: +44 207.749.9140
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">Hongfei.Du at InterDigital.com</A>
www.InterDigital.com&lt;<A HREF="http://www.interdigital.com">http://www.interdigital.com</A>&gt;

[cid:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">image3d6f6e.BMP at 467ad0ef.48a6cd90</A>]

This e-mail is intended only for the use of the individual or entity to which it is addressed, and may contain information that is privileged, confidential and/or otherwise protected from disclosure to anyone other than its intended recipient. Unintended transmission shall not constitute waiver of any privilege or confidentiality obligation. If you received this communication in error, please do not review, copy or distribute it, notify me immediately by email, and delete the original message and any attachments. Unless expressly stated in this e-mail, nothing in this message or any attachment should be construed as a digital or electronic signature.


-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-request at lists.squid-cache.org</A>
Sent: Tuesday, August 18, 2015 1:00 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: squid-users Digest, Vol 12, Issue 33

Send squid-users mailing list submissions to
       <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>

To subscribe or unsubscribe via the World Wide Web, visit
       <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
or, via email, send a message with subject or body 'help' to
       <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-request at lists.squid-cache.org</A>

You can reach the person managing the list at
       <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-owner at lists.squid-cache.org</A>

When replying, please edit your Subject line so it is more specific than &quot;Re: Contents of squid-users digest...&quot;


Today's Topics:

  1. Re: Question on developing customized Cache Selection
     algorithm from Round Robin, Least Load (Amos Jeffries)


----------------------------------------------------------------------

Message: 1
Date: Tue, 18 Aug 2015 22:24:45 +1200
From: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Question on developing customized Cache
       Selection algorithm from Round Robin, Least Load
Message-ID: &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">55D307ED.3030500 at treenet.co.nz</A>&gt;
Content-Type: text/plain; charset=utf-8

On 18/08/2015 5:42 a.m., Du, Hongfei wrote:
&gt;<i> Hello
</I>&gt;<i> We are in an attempt to extend Squid Cache selection algorithm to make
</I>a more sophisticated, let&#8217;s say to add WRR or WFQ, a few questions to start with:
&gt;<i>
</I>
Like Eliezer said this is really a question for squid-dev mailing list where the developers hang out.

WRR (weighted round-robin) is already implemented and exactly how Squid cache_dir currently operate. The weighting is based on storage area available size and I/O loading.

WFQ (weighted fair queueing) is a queueing algorthm as the 'Q' says.
Caching != queueing. In fact a cache is so different from a queue that WFQ would badly affect performance if it were used to decide what storage an object went into.
In essence, the problem is that we cannot dictate what objects will be requested by clients. They want what they ask for. Squids duty is 1) to answer reliably and 2) fast as possible regardless of objects location.


&gt;<i> - As we probably has to rewrite new algorithm and recompile it, so
</I>does anyone know where(or which file) is the existing Round Robin or Least Load algorithm defined in source codes?

That depends on whether you mean the algorithm applied for local storage vs network sources, or the one(s) applied to individual caches for garbage collection.

&gt;<i>
</I>&gt;<i> - Is there straight forward method to tell/instruct squid to store
</I>content from network(e.g. an URL) in a predefined specific disk folder rather than using the selection algorithm itself?

Simply stated:
The URL and all other relevant details from the transaction are hashed to lookup an index to find the 32-bit 'sfileno' value which is a UID encoding the location of indexed objects in Squid local storage.

It _sounds_ simple enough, but those &quot;other relevant details&quot; is a massive complication. One single URL can potentially contain all possible objects that ever have or ever will exist on the Internet. Even considering storing things one file per URL dies a horrible death when it encounters popular modern websites.


Within Squid we refer to &quot;the HTTP cache&quot; as a single thing. But it is constructed of many storage areas. The individual cache_dirs and other places where HTTP objects might be found. Remote network sources are also accounted for.

There is algorithm(s) applied in layers to decide which type of storage area is use, then which one within the selected type is most appropriate. Based on object availability, cacheability, size, storage area speed, object popularity, and temporal relationships to others.
Then a sfileno is assigned if its local storage.

Then objects get moved between storage areas anyway based on need and popularity. And objects get removed from invdividual storage areas based on lack of popularity. Both of which affect future requests for them.

So the particulars of what you want to do matter, a lot.


FWIW, we have known outstanding needs for:

* updated cache_peer selection algorithms. Current Squid outgoing TCP connection failover works with a list of IPs that get tried until one succeeds. The old selection algorithms produce only a single IP rather than a preference-ordered set of peers to try.
- also none of the algorithms provide byte-base loading.

* ETag based cache index. For better performant If-Match/If-None-Match revalidation traffic.

* 206 partial object caching. Rock can store them, but no algorithms yet exist to properly manage the pieces of incomplete objects or aggregation from different transactions.

* per-area storage indexes, instead of a Big Global Index. Working towards 64-bit sfileno which are needed for some TB sized caches. Rock and Transients storage areas are done, but other caches still TODO.

* better HDD load detection. To inform the weighting of cache_dir seectio algorithms. This is a hardware driver related project.

* Support for ZFS and XFS dynamic inode sizing. This causes lots of issues with &quot;wrong&quot; disk storage under/over usage. Another hardware driver related project.


HTH
Amos


------------------------------

Subject: Digest Footer

_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


------------------------------

End of squid-users Digest, Vol 12, Issue 33
*******************************************
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image3d6f6e.BMP
Type: image/bmp
Size: 13078 bytes
Desc: image3d6f6e.BMP
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150819/cf86889a/attachment.bin">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150819/cf86889a/attachment.bin</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005128.html">[squid-users] can't get bump to work anymore on 3.5.7?
</A></li>
	<LI>Next message (by thread): <A HREF="005076.html">[squid-users] Squid + Mysql
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5075">[ date ]</a>
              <a href="thread.html#5075">[ thread ]</a>
              <a href="subject.html#5075">[ subject ]</a>
              <a href="author.html#5075">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
