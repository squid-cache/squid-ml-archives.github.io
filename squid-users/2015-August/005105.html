<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3.5.7, cache_swap_high, bug or not bug ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.7%2C%20cache_swap_high%2C%20bug%20or%20not%20bug%20%3F&In-Reply-To=%3C55D6D142.4030803%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005098.html">
   <LINK REL="Next"  HREF="005107.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3.5.7, cache_swap_high, bug or not bug ?</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.7%2C%20cache_swap_high%2C%20bug%20or%20not%20bug%20%3F&In-Reply-To=%3C55D6D142.4030803%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid 3.5.7, cache_swap_high, bug or not bug ?">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Aug 21 07:20:34 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005098.html">[squid-users] Squid 3.5.7, cache_swap_high, bug or not bug ?
</A></li>
        <LI>Next message (by thread): <A HREF="005107.html">[squid-users] Squid 3.5.7, cache_swap_high, bug or not bug ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5105">[ date ]</a>
              <a href="thread.html#5105">[ thread ]</a>
              <a href="subject.html#5105">[ subject ]</a>
              <a href="author.html#5105">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 21/08/2015 2:26 a.m., Stakres wrote:
&gt;<i> Hi Amos,
</I>&gt;<i> 
</I>&gt;<i> Any update ?
</I>&gt;<i> 
</I>
Spent the afternoon looking into it. There is now a patch in the bug
report with some experimental changes.

&gt;<i> This morning, it was crazy:
</I>&gt;<i> *Percent used: 100.76%*
</I>&gt;<i> How is it possible ?
</I>
It seems all that documentation about the watermarks I was reading was
b*sh*t. :-(

The actual code is purging no more than 80 objects per second. And like
the bug said, only gets that many if its actually over 100% filled already.

&gt;<i> 
</I>&gt;<i> Then the squid has crashed and it's now cleaning objects.
</I>&gt;<i> I can understand new objects could be added faster than the squid is able to
</I>&gt;<i> clean older objects, but it seems there is something wrong in the cleaning
</I>&gt;<i> process.
</I>&gt;<i> The wiki says &quot;/As swap utilization gets close to high-water mark object
</I>&gt;<i> eviction becomes more aggressive./&quot;. From my point of view the &quot;aggressive&quot;
</I>&gt;<i> is not aggressive enough... 
</I>&gt;<i> 
</I>&gt;<i> Possible to have a patch/workaround soon ?
</I>
Yeah 80 remove/sec is *way* to small for a proxy that can and probably
is handling ~2K add/sec.


In that experimental patch I've done a few things that you can help test
out:

* tripled the basic removal rate to 200/sec

* set the rate of purging to reach maximum speed at high watermark (as
previously documented).

- between those two adjustments is it fast enough? all it has to do is
counter the completely new additions rate. general traffic req/sec doing
replace on content does not matter.


* removed the limit on purges when cache is &gt;100% full, it just keeps
going until under-100% is reached or it cant go further. Squid service
is effectively paused until the cache is back within its size limit.
That may not be the best option, but its doable without a lot of change
all over the store code. Better tuning on the base removal rate should
avoid it happening in the first place.

- is that pause acceptibly small?


- do all these changes actually help in your situation any?

BTW, &quot;debug_options 47,3&quot; to get the purging event debug traces.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005098.html">[squid-users] Squid 3.5.7, cache_swap_high, bug or not bug ?
</A></li>
	<LI>Next message (by thread): <A HREF="005107.html">[squid-users] Squid 3.5.7, cache_swap_high, bug or not bug ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5105">[ date ]</a>
              <a href="thread.html#5105">[ thread ]</a>
              <a href="subject.html#5105">[ subject ]</a>
              <a href="author.html#5105">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
