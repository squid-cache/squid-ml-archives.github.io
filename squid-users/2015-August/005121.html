<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Using Squid as forward http proxy failing to complete request?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Using%20Squid%20as%20forward%20http%20proxy%20failing%20to%0A%20complete%20request%3F&In-Reply-To=%3C55D74A67.3000600%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005118.html">
   <LINK REL="Next"  HREF="005142.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Using Squid as forward http proxy failing to complete request?</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Using%20Squid%20as%20forward%20http%20proxy%20failing%20to%0A%20complete%20request%3F&In-Reply-To=%3C55D74A67.3000600%40treenet.co.nz%3E"
       TITLE="[squid-users] Using Squid as forward http proxy failing to complete request?">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Aug 21 15:57:27 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005118.html">[squid-users] Using Squid as forward http proxy failing to complete	request?
</A></li>
        <LI>Next message (by thread): <A HREF="005142.html">[squid-users] Using Squid as forward http proxy failing to complete request?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5121">[ date ]</a>
              <a href="thread.html#5121">[ thread ]</a>
              <a href="subject.html#5121">[ subject ]</a>
              <a href="author.html#5121">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 22/08/2015 1:39 a.m., asad wrote:
&gt;<i> I'm using Squid as local proxy.
</I>&gt;<i> 
</I>&gt;<i> I have the config file as below:-#
</I>&gt;<i> 
</I>&lt;snip&gt;
&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> *  cache_peer 10.1.2.3 parent 8080 0 no-query default
</I>&gt;<i> login=my_username:my_password    never_direct allow all*
</I>&gt;<i> 
</I>&lt;snip&gt;
&gt;<i> Now, I want to use it as forward proxy For that the configuration is shown
</I>&gt;<i> in the config file in ***bold-text***.
</I>

I'm not sure you are using the term &quot;forward proxy&quot; right.
&quot;forward-proxy&quot; is nowdays commonly also stated &quot;explicit proxy&quot;.


See this bit here:

   # Squid normally listens to port 3128
   http_port 3128

That bit alone, is what makes your Squid an explicit/forward-proxy.


Using cache_peer like shown above just relays traffic through a parent
proxy. Which in this case is also happens to be a forward/explicit proxy.

Using &quot;never_direct allow all&quot; forces only that parent proxy to be used.
No traffic may go anywhere but through a cache_peer.


&gt;<i> 
</I>&gt;<i> I have browsed tons of web-pages and all have said to include a line
</I>&gt;<i> similar to this. Beyond this configuration, I don't know what else to add
</I>&gt;<i> in order to make it work.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> One, thing under safe_port should I be changing the http port to &quot;8080&quot;
</I>&gt;<i> since my local machine is already behind another proxy.
</I>
No. The cache_peer details is all private between the two proxies. It
has no part in the traffic messages themselves.

&gt;<i> 
</I>&gt;<i> Also, I'm using domain authentication (NTLM) to connect to other proxy. Is
</I>&gt;<i> authentication configuration required beside what already done in config
</I>&gt;<i> file.
</I>&gt;<i> 
</I>
What those tutorials are not explaining is that the
&quot;login=my_username:my_password&quot; is sending Basic auth credentials to the
parent proxy.

Squid does not support using NTLM to authenticate its cache_peer TCP
connection.

The options available for cache_peer directive and what they do is
documented at &lt;<A HREF="http://www.squid-cache.org/Doc/config/cache_peer/">http://www.squid-cache.org/Doc/config/cache_peer/</A>&gt;


My suggestions for a fix:

You could use &quot;login=PASSTHRU connection-auth=on&quot; and not do anything
else with auth in your proxy. That way the client software can (try to)
authenticate to the parent proxy directly with NTLM.


Or, if the parent proxy accepts Negotiate/Kerberos auth you can use
&quot;login=NEGOTIATE&quot; and setup the necessary keytab for your proxy to
authenticate with.


Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005118.html">[squid-users] Using Squid as forward http proxy failing to complete	request?
</A></li>
	<LI>Next message (by thread): <A HREF="005142.html">[squid-users] Using Squid as forward http proxy failing to complete request?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5121">[ date ]</a>
              <a href="thread.html#5121">[ thread ]</a>
              <a href="subject.html#5121">[ subject ]</a>
              <a href="author.html#5121">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
