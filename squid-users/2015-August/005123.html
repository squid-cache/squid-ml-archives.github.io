<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] refresh_pattern and same objects
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20refresh_pattern%20and%20same%20objects&In-Reply-To=%3C55D752B4.3050204%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005115.html">
   <LINK REL="Next"  HREF="005124.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] refresh_pattern and same objects</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20refresh_pattern%20and%20same%20objects&In-Reply-To=%3C55D752B4.3050204%40treenet.co.nz%3E"
       TITLE="[squid-users] refresh_pattern and same objects">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Aug 21 16:32:52 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005115.html">[squid-users] refresh_pattern and same objects
</A></li>
        <LI>Next message (by thread): <A HREF="005124.html">[squid-users] refresh_pattern and same objects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5123">[ date ]</a>
              <a href="thread.html#5123">[ thread ]</a>
              <a href="subject.html#5123">[ subject ]</a>
              <a href="author.html#5123">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 21/08/2015 11:39 p.m., FredB wrote:
&gt;<i> Hi all,
</I>&gt;<i> 
</I>&gt;<i> I think I misunderstand something but why refresh pattern is not useless ?
</I>&gt;<i> I mean the objects are supposed to be delivered with instructions from the web server, lifetime, creation time, etc 
</I>&gt;<i> 
</I>
Well, we like it when they do. Since that makes things easy and
predictable. Especially for the third-party debugging. But no they are
not actually required to.

Still the HTTP freshness algorithm does have a certain fixed set of
parameters that are needed to caculate freshness for every response object.

In the absence of header values from the server the refresh_pattern
whose regex matches the URL provides the default values for the
parameters min/max-storage-time and lifetime-expectency-percent.



&gt;<i> I thought, and it seem I'm wrong ?, that squid check the HTTP header when the object seems expired (HEAD request), if yes the object should be refreshed, or not, when is life is ended ?
</I>&gt;<i> 
</I>
Sending a HEAD request would use an RTT of latency, plus server CPU
cycles just to figure out if another fetch was needed.

HTTP/1.0 has to work that way because it has no revalidation mechanism.

HTTP/1.1 revaidation collapses all that cost down into one with a
conditional-GET request (aka, IMS or INM). Which either updates just
headers, or headers+payload in one go.

Still, by not sending explicit values the server is offering cache admin
the privilege of deciding for themselves what type of storage profile to
use. refresh_pattern is the squid.conf mechanism for doing that.


&gt;<i> Force a long refresh pattern is not dangerous ? For example with some security files. 
</I>&gt;<i>  
</I>
HTTP specs permit up to 68 years storage for any given item. That is
imposed only by a need for age values to fit within a 32-bit integer.

Objects with security sentitive details MUST be labelled appropriately
as Expires:-1 and Cache-Control: private, no-store, no-transform -
whichever applies to that objects data.

Caches MUST obey those controls.

 &quot;MUST&quot; being the spec emphasis and meaning for mandatory requirement.

And the key reason why I go on so much about not using the override-*
and ignore-* options on refresh_pattern. Or at least targetting those
patterns VERY specifically at sites that are so broken there is no
choice. Every time they are used on an object it &quot;breaks the Internet&quot;
for someone, usually the admins own users/customers.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005115.html">[squid-users] refresh_pattern and same objects
</A></li>
	<LI>Next message (by thread): <A HREF="005124.html">[squid-users] refresh_pattern and same objects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5123">[ date ]</a>
              <a href="thread.html#5123">[ thread ]</a>
              <a href="subject.html#5123">[ subject ]</a>
              <a href="author.html#5123">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
