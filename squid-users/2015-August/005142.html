<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Using Squid as forward http proxy failing to complete request?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Using%20Squid%20as%20forward%20http%20proxy%20failing%20to%0A%20complete%20request%3F&In-Reply-To=%3C55DADA7E.5030105%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005121.html">
   <LINK REL="Next"  HREF="005273.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Using Squid as forward http proxy failing to complete request?</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Using%20Squid%20as%20forward%20http%20proxy%20failing%20to%0A%20complete%20request%3F&In-Reply-To=%3C55DADA7E.5030105%40treenet.co.nz%3E"
       TITLE="[squid-users] Using Squid as forward http proxy failing to complete request?">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Aug 24 08:49:02 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005121.html">[squid-users] Using Squid as forward http proxy failing to complete request?
</A></li>
        <LI>Next message (by thread): <A HREF="005273.html">[squid-users] Using Squid as forward http proxy failing to complete request?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5142">[ date ]</a>
              <a href="thread.html#5142">[ thread ]</a>
              <a href="subject.html#5142">[ subject ]</a>
              <a href="author.html#5142">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 24/08/2015 6:41 p.m., asad wrote:
&gt;<i> Amos, sorry for late reply. I wanted to test the config in office
</I>&gt;<i> environment, good news is that it worked:). Only two issues:-
</I>&gt;<i> 
</I>&gt;<i> 1) the client is repeatedly prompted for credentials when even in
</I>&gt;<i> background the website is loading.
</I>&gt;<i> 
</I>
Thats the way HTTP authentication is designed. Nothing can happen
without authentication credentials.

And HTTP is not aware what is displayed on the users screen (or not).
There is not even a real concept of &quot;user&quot; or &quot;screen&quot;. Just clients and
servers messaging each other.


&gt;<i> 2) It doesn't work for ssl websites. Does squid do MITM?
</I>&gt;<i> 
</I>
Yes, but MITM will not help you here.

Because the only case where HTTP authentication is possible with MITM is
when intercepting traffic destined to a forward-proxy. Your setup is
very close to that edge case, but the HTTPS CONNECT requests will still
be having the same user-end behaviour in either format.

There are three suspects for CONNECT not authentiation. In order of
likelihood they are;

1) on recent Squid you are probably running into one of the edge cases
where our fix for CVE-2015-5400 causes unwanted blocking. That makes two
that I've now found since the security fix went out.

But its worth double-checking that suspicion. Please check if your proxy
is actually relaying the CONNECT to its parent. And when the parent
replies 407 if proxy is sending the client a 502 or 407.

2) the client software just being broken when its asked to authenticate
for a CONNECT.

3) Needing to configure &quot;nonheirarchical_direct off&quot; so the CONNECT
actually get sent to the parent. This shows up as clients receiving 503
status responses generated by your proxy after CONNECT.

You can see the details clients are getting with this:
 squidclient -m CONNECT example.com:443


[pPS. *ssl* sites not working is good because SSLv2 and SSLv3 are
terribly broken security. *HTTPS* on the other hand ...]

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005121.html">[squid-users] Using Squid as forward http proxy failing to complete request?
</A></li>
	<LI>Next message (by thread): <A HREF="005273.html">[squid-users] Using Squid as forward http proxy failing to complete request?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5142">[ date ]</a>
              <a href="thread.html#5142">[ thread ]</a>
              <a href="subject.html#5142">[ subject ]</a>
              <a href="author.html#5142">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
