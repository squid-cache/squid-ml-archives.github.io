<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Change url_rewrite_program problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Change%20url_rewrite_program%20problem&In-Reply-To=%3C55DD0744.6030509%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005162.html">
   <LINK REL="Next"  HREF="005053.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Change url_rewrite_program problem</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Change%20url_rewrite_program%20problem&In-Reply-To=%3C55DD0744.6030509%40treenet.co.nz%3E"
       TITLE="[squid-users] Change url_rewrite_program problem">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Aug 26 00:24:36 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005162.html">[squid-users] Change url_rewrite_program problem
</A></li>
        <LI>Next message (by thread): <A HREF="005053.html">[squid-users] Squid reverse proxy in http &gt; https mode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5171">[ date ]</a>
              <a href="thread.html#5171">[ thread ]</a>
              <a href="subject.html#5171">[ subject ]</a>
              <a href="author.html#5171">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 26/08/2015 1:48 a.m., Hicham Berni wrote:
&gt;<i> Hi Eliezer,
</I>&gt;<i> 
</I>&gt;<i> Thanks you for feedback,
</I>&gt;<i> 
</I>&gt;<i>     &#8226; Squid version installed is2.6.STABLE21  and may be this version not
</I>&gt;<i> handling these requests correctly ?
</I>

This setup is very normal and these are teh simple its. So it should
work with your Squid. BUT, 2.6 is the very first version of Squid that
did virtual hosting in the modern way. Some parts have been improved in
the years since the feature was first added. So YMMV a little.


On the other hand 2.6 went EOL way, way, back in May 2008.

It only speaks HTTP/1.0 and a little bit of HTTP/1.1. Most of what
happens in The Internet these days will either break or bypass it.

The TLS/SSL parts of HTTPS are entirely offloaded to your system OpenSSL
library. So any failures there are outside Squid. It could simply be
that the library is trying to speak SSLv2 or some other ancient thing
that the browsers reject.

&gt;<i> 
</I>&gt;<i> setting for cache peer :
</I>&gt;<i> http_port 80 accel defaultsite=add.ptr.lu  vhost
</I>&gt;<i> https_port 443 cert=/root/add.ptr.lu.pem key=/root/add.ptr.lu.key accel
</I>&gt;<i> defaultsite=add.ptr.lu vhost
</I>&gt;<i> cache_peer 15.40.40.47 parent 8000 0 no-query originserver
</I>&gt;<i> front-end-https=on name=ProdAccel
</I>&gt;<i> cache_peer 15.40.40.47 parent 8001 0 no-query originserver name=TestAccel
</I>
There is some missing config:

 acl HTTPS proto HTTPS

 cache_peer_access ProdAccel allow HTTPS
 cache_peer_access ProdAccel deny all

 cache_peer_access TestAccel allow !HTTPS
 cache_peer_access TestAccel deny all

That will make the requests go to the right backend server. :-)

&gt;<i> 
</I>&gt;<i>     &#8226; From access logs, we do not see any TCP_DENIED log event for the '
</I>&gt;<i> add.ptr.lu' request.
</I>&gt;<i> 
</I>&gt;&gt;<i> 2015/06/12 17:11:36| Starting Squid Cache version 2.6.STABLE21 for
</I>&gt;<i> i686-redhat-linux-gnu... &gt; 2015/06/12 17:11:36| Process ID 3897 &gt; ... &gt;
</I>&gt;<i> 2015/06/12 17:11:36| Accepting accelerated HTTP connections at 0.0.0.0,
</I>&gt;<i> port 8000, FD 18. &gt; 2015/06/12 17:11:36| Accepting proxy HTTP connections
</I>&gt;<i> at 0.0.0.0, port 3128, FD 19. &gt; 2015/06/12 17:11:36| Accepting HTTPS
</I>&gt;<i> connections at 0.0.0.0, port 443, FD 20. &gt; 2015/06/12 17:11:36| Accepting
</I>&gt;<i> ICP messages at 0.0.0.0, port 3130, FD 21. &gt; 2015/06/12 17:11:36| WCCP
</I>&gt;<i> Disabled. &gt; 2015/06/12 17:11:36| Configuring Parent 158.64.50.47/8000/0 &gt;
</I>&gt;<i> 2015/06/12 17:11:36| Configuring Parent 158.64.50.47/8001/0
</I>
That is not the access.log transaction log. That is the cache.log debug
log for critical/important service failures. All that says is that your
Squid is running okay *as a program*.


&gt;<i> 
</I>&gt;<i>     &#8226; Port 8000 is the port using for backend  webserver
</I>&gt;<i>     &#8226; So I try to access from external , I try <A HREF="https://add.ptr.lu">https://add.ptr.lu</A> , I
</I>&gt;<i> receive a issue with new url <A HREF="https://add.ptr.lu:8000/register">https://add.ptr.lu:8000/register</A>
</I>&gt;<i> 
</I>&gt;<i>     So I supposed that it cannot return with this url
</I>&gt;<i> 
</I>
Your Squid is not listening on port 8000. You cannot make requests for
that URL and expect them to go through Squid.

The port 8000/8001 detail is just for the private TCP connection between
Squid and the peers. It is not part of the HTTP(S) messages or URLs.


You need the backend servers to accept and service
<A HREF="http://add.ptr.lu/register.">http://add.ptr.lu/register.</A> And generate relative-URLs.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005162.html">[squid-users] Change url_rewrite_program problem
</A></li>
	<LI>Next message (by thread): <A HREF="005053.html">[squid-users] Squid reverse proxy in http &gt; https mode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5171">[ date ]</a>
              <a href="thread.html#5171">[ thread ]</a>
              <a href="subject.html#5171">[ subject ]</a>
              <a href="author.html#5171">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
