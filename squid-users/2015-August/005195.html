<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Lots of &quot;Vary object loop!&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Lots%20of%20%22Vary%20object%20loop%21%22&In-Reply-To=%3C55DE1E48.1090900%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005194.html">
   <LINK REL="Next"  HREF="005196.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Lots of &quot;Vary object loop!&quot;</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Lots%20of%20%22Vary%20object%20loop%21%22&In-Reply-To=%3C55DE1E48.1090900%40treenet.co.nz%3E"
       TITLE="[squid-users] Lots of &quot;Vary object loop!&quot;">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Aug 26 20:15:04 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005194.html">[squid-users] Lots of &quot;Vary object loop!&quot;
</A></li>
        <LI>Next message (by thread): <A HREF="005196.html">[squid-users] Lots of &quot;Vary object loop!&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5195">[ date ]</a>
              <a href="thread.html#5195">[ thread ]</a>
              <a href="subject.html#5195">[ subject ]</a>
              <a href="author.html#5195">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 27/08/2015 7:53 a.m., Sebasti&#225;n Goicochea wrote:
&gt;<i> After I sent you my previous email, I continued investigating the
</I>&gt;<i> subject .. I made a change in the source code as follows:
</I>&gt;<i> 
</I>&gt;<i> File: /src/http.cc
</I>&gt;<i> 
</I>&gt;<i> HttpStateData::haveParsedReplyHeaders()
</I>&gt;<i> {
</I>&gt;<i>     .
</I>&gt;<i>     .
</I>&gt;<i> ##### THIS IS NEW STUFF ###########
</I>&gt;<i>     if (rep-&gt;header.has(HDR_VARY)) {
</I>&gt;<i>     rep-&gt;header.delById(HDR_VARY);
</I>&gt;<i>     debugs(11,3, &quot;Vary detected. Hack Cleaning it up&quot;);
</I>&gt;<i>     }
</I>&gt;<i> ##### END OF NEW STUFF ###########
</I>&gt;<i> 
</I>&gt;<i> #if X_ACCELERATOR_VARY
</I>&gt;<i>     if (rep-&gt;header.has(HDR_X_ACCELERATOR_VARY)) {
</I>&gt;<i>     rep-&gt;header.delById(HDR_X_ACCELERATOR_VARY);
</I>&gt;<i>     debugs(11,3, &quot;HDR_X_ACCELERATOR_VARY Vary detected. Hack Cleaning it
</I>&gt;<i> up&quot;);
</I>&gt;<i>     }
</I>&gt;<i> #endif
</I>&gt;<i>     .
</I>&gt;<i>     .
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Deleting Vary from the header at this point gives me hits in every
</I>&gt;<i> object I test (that previously didn't hit) .. web browser never receives
</I>&gt;<i> the Vary in the response header.
</I>&gt;<i> Now I read your answer and you say that this is a critical validity
</I>&gt;<i> check and that worries me. Taking away the vary altogether at this point
</I>&gt;<i> could lead to the problems that you described? If that is the case .. I
</I>&gt;<i> have to investigate other alternatives.
</I>&gt;<i> 
</I>
I'll have to look into that function when I'm back at the code later to
confirm this. But IIRC that function is acting directly on a freshly
received reply message. You are not removing the validity check, you are
removing Squids ability to see that it is a Vary object at all. So it is
never even cached as one.

The side effect of that is that clients asking for non-gzip can get the
cached gzip copy, etc. but at least its the same URL. So the security
risks are gone. But the user experience is not always good either way.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005194.html">[squid-users] Lots of &quot;Vary object loop!&quot;
</A></li>
	<LI>Next message (by thread): <A HREF="005196.html">[squid-users] Lots of &quot;Vary object loop!&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5195">[ date ]</a>
              <a href="thread.html#5195">[ thread ]</a>
              <a href="subject.html#5195">[ subject ]</a>
              <a href="author.html#5195">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
