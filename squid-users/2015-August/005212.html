<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Does anyone have a working Juniper SRX with tproxy	squid?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Does%20anyone%20have%20a%20working%20Juniper%20SRX%20with%20tproxy%0A%09squid%3F&In-Reply-To=%3C55DF4D56.2030903%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005271.html">
   <LINK REL="Next"  HREF="005220.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Does anyone have a working Juniper SRX with tproxy	squid?</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Does%20anyone%20have%20a%20working%20Juniper%20SRX%20with%20tproxy%0A%09squid%3F&In-Reply-To=%3C55DF4D56.2030903%40ngtech.co.il%3E"
       TITLE="[squid-users] Does anyone have a working Juniper SRX with tproxy	squid?">eliezer at ngtech.co.il
       </A><BR>
    <I>Thu Aug 27 17:48:06 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005271.html">[squid-users] Internet Explorer error with SSL bumping
</A></li>
        <LI>Next message (by thread): <A HREF="005220.html">[squid-users] cpu high 100%
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5212">[ date ]</a>
              <a href="thread.html#5212">[ thread ]</a>
              <a href="subject.html#5212">[ subject ]</a>
              <a href="author.html#5212">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am gathering information on different routing options for squid tproxy 
mode for quite some time.
I have a working settings for:
  - Cisco
  - Linux
  - FreeBSD
  - OpenBSD
  - Mikrotik

The topology I have tested it until now is at:
<A HREF="http://ngtech.co.il/squidblocker/topology1.png">http://ngtech.co.il/squidblocker/topology1.png</A>

The Edge router divert traffic to the squid instances using routing policy.

I have been reading about ways to make squid work with Juniper but they 
all use intercept mode and not tproxy.
A list of sources until now:
<A HREF="http://kb.juniper.net/InfoCenter/index?page=content&amp;id=KB23300">http://kb.juniper.net/InfoCenter/index?page=content&amp;id=KB23300</A>

<A HREF="https://andymillett.co.uk/2013/09/14/load-balancing-transparent-redirect-junos/">https://andymillett.co.uk/2013/09/14/load-balancing-transparent-redirect-junos/</A>

<A HREF="http://kb.juniper.net/InfoCenter/index?page=content&amp;id=KB21046">http://kb.juniper.net/InfoCenter/index?page=content&amp;id=KB21046</A>

<A HREF="http://forums.juniper.net/t5/SRX-Services-Gateway/SRX650-routing-instance-not-working/m-p/54130">http://forums.juniper.net/t5/SRX-Services-Gateway/SRX650-routing-instance-not-working/m-p/54130</A>

<A HREF="http://forums.juniper.net/t5/SRX-Services-Gateway/port-80-redirection-on-srx650-cluster/m-p/53010">http://forums.juniper.net/t5/SRX-Services-Gateway/port-80-redirection-on-srx650-cluster/m-p/53010</A>

<A HREF="http://serverfault.com/questions/442385/how-to-route-all-network-traffic-for-vlan-through-a-proxy-server-on-srx">http://serverfault.com/questions/442385/how-to-route-all-network-traffic-for-vlan-through-a-proxy-server-on-srx</A>

<A HREF="https://forum.ivorde.com/squid-http-s-transparent-proxy-with-juniper-srx-part-3-t14191.html">https://forum.ivorde.com/squid-http-s-transparent-proxy-with-juniper-srx-part-3-t14191.html</A>

<A HREF="http://kb.juniper.net/InfoCenter/index?page=content&amp;id=KB23895">http://kb.juniper.net/InfoCenter/index?page=content&amp;id=KB23895</A>
###END SOURCES

I know that on FreeBSD and Linux I must refer to route each packet by 
itself or to mark the connection.
On juniper SRX devices I do not know what to do exactly.
I have seen an option to disable the flowd which follows the tcp\udp 
flows and I am not sure it is a requirement.

My current vSRX settings are at:
<A HREF="http://paste.ngtech.co.il/pdsltlobf">http://paste.ngtech.co.il/pdsltlobf</A>

And the connection is being redirected from the client to the proxy and 
back from the proxy to the client.
The issue is that the traffic which flows from the internet back which 
suppose to be redirected into the proxy are flowing back to the client.

The issue as I identify it is that there is a routing decision based on 
some routing table.
The option I have seen here and there mentioned are to use a virtual router.

I am pretty sure there is some network admin here on the list which 
might have a clue about how to solve the reverse path traffic flow 
routing issue.

Thanks,
Eliezer


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005271.html">[squid-users] Internet Explorer error with SSL bumping
</A></li>
	<LI>Next message (by thread): <A HREF="005220.html">[squid-users] cpu high 100%
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5212">[ date ]</a>
              <a href="thread.html#5212">[ thread ]</a>
              <a href="subject.html#5212">[ subject ]</a>
              <a href="author.html#5212">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
