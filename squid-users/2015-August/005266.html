<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] High-Availability in Squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20High-Availability%20in%20Squid&In-Reply-To=%3C55E31418.7040409%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005261.html">
   <LINK REL="Next"  HREF="005274.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] High-Availability in Squid</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20High-Availability%20in%20Squid&In-Reply-To=%3C55E31418.7040409%40treenet.co.nz%3E"
       TITLE="[squid-users] High-Availability in Squid">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Aug 30 14:32:56 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005261.html">[squid-users] High-Availability in Squid
</A></li>
        <LI>Next message (by thread): <A HREF="005274.html">[squid-users] High-Availability in Squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5266">[ date ]</a>
              <a href="thread.html#5266">[ thread ]</a>
              <a href="subject.html#5266">[ subject ]</a>
              <a href="author.html#5266">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 30/08/2015 3:58 p.m., Ashish Mukherjee wrote:
&gt;<i> Why should Squid take care of HA though? Isn't it the responsibility of the
</I>&gt;<i> Website to ensure its uptime? Even if used as a reverse proxy, Apache may
</I>&gt;<i> do a better job at this, since one can do more sophisticated configurations
</I>&gt;<i> with mod_proxy.
</I>
The hint is in the name of that module: mod_*proxy*.

HA is an outcome of using any one or more of several _proxy features_.

Squid is a proxy. The purpose of mod_proxy is to hack/squash/ proxy
gateway capabilities (ie Squid functionality) into a piece of origin
server software (Apache).

Would you expect a dedicated/designed piece of proxy software or an
'other' software design with add-on tacked into it to actually be better
at the proxying functionality?

Sure you can use the other softwares add-on *if* it performs the
function correctly and sufficiently for your needs. But that does not
make it the function any less a proxy mechanism.

On the other end Browsers also have HA functionality they call &quot;Happy
Eyeballs&quot;. Varuous downloaders and app update serices try to do IP-based
filovers and recovery. And it call causes no end of trouble to the real
proxies in the middle just doing their job properly.

Amos

&gt;<i> 
</I>&gt;<i> On Sun, Aug 30, 2015 at 3:56 AM, Kinkie wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>   please see <A HREF="http://wiki.squid-cache.org/Features/MonitorUrl.">http://wiki.squid-cache.org/Features/MonitorUrl.</A>
</I>&gt;&gt;<i> It's available in squid 2.6 , and is one of the last few features who
</I>&gt;&gt;<i> haven't yet made it to Squid 3.X. If anyone is interested, code and
</I>&gt;&gt;<i> sponsorships are always welcome :)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Thu, Aug 27, 2015 at 12:10 PM, Imaginovskiy wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Hi all,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Bit of a strange one but I'm wondering if it's possible to have squid
</I>&gt;&gt;&gt;<i> redirect a site to a secondary backend server if the primary is down.
</I>
Yes it is. This is one of the core functionalities of proxying and so
well integrated there is *no* special configuration needed. In fact you
have to explicitly configure alternative if you want to avoid it.

&gt;&gt;&gt;<i> Have
</I>&gt;&gt;&gt;<i> been looking into this but haven't seen much similar to this. Currently I
</I>&gt;&gt;&gt;<i> have my setup along the lines of this;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Client -&gt; Squid -&gt; Backend1
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> but in the event that Backend1 is down, the following should be done;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Client -&gt; Squid -&gt; Backend2
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Is squid capable of monitoring connections to peer or redirecting based on
</I>&gt;&gt;&gt;<i> an ACL looking for some HTTP error code?
</I>
I would almost bet you already have it setup in your squid.conf:

 cache_peer Backend1.example.com ...
 cache_peer Backend2.example.com ...


Backend2 will be used only if Backend1 is detected as unavailable, or
starts getting overloaded/slow (yes the HA includes latency optimization
too), or starts returning some retriable status responses (most common
is 502).


Yes, simply the line order itself. Everything else is just tuning of the
HA parameters.

To prevent flapping there is a default of 10 requests that need to have
failed (in a row) before the 'dead' detection kicks in to send 100% to
Backend2. Those 10 will make TCP connect attempts to Backend1 before
retrying with Backend2 (if enough time remains in the forward_timeout).
That is configurable, see cache_peer documentation for timeouts and
failure options. background-ping may also be of interest to you.


You can improve further by using DNS-based HA availability. Pointing
each Backend1 and Backend2 domain names at multiple IPs. But be wary of
those Browsers and their (overly) &quot;Happy eyeballs&quot;.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005261.html">[squid-users] High-Availability in Squid
</A></li>
	<LI>Next message (by thread): <A HREF="005274.html">[squid-users] High-Availability in Squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5266">[ date ]</a>
              <a href="thread.html#5266">[ thread ]</a>
              <a href="subject.html#5266">[ subject ]</a>
              <a href="author.html#5266">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
