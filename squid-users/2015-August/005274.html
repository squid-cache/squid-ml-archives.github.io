<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] High-Availability in Squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20High-Availability%20in%20Squid&In-Reply-To=%3CCACgMzfw%3D9MhNzEftOWMstPzkSe4mN9hL9nO-648dkUdP0g2%3DNQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005266.html">
   <LINK REL="Next"  HREF="005279.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] High-Availability in Squid</H1>
    <B>Ashish Mukherjee</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20High-Availability%20in%20Squid&In-Reply-To=%3CCACgMzfw%3D9MhNzEftOWMstPzkSe4mN9hL9nO-648dkUdP0g2%3DNQ%40mail.gmail.com%3E"
       TITLE="[squid-users] High-Availability in Squid">ashish.mukherjee at gmail.com
       </A><BR>
    <I>Mon Aug 31 06:23:58 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005266.html">[squid-users] High-Availability in Squid
</A></li>
        <LI>Next message (by thread): <A HREF="005279.html">[squid-users] High-Availability in Squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5274">[ date ]</a>
              <a href="thread.html#5274">[ thread ]</a>
              <a href="subject.html#5274">[ subject ]</a>
              <a href="author.html#5274">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

Agree that Squid is a specialized proxy and more optimal architecture for
the purpose and trying to achieve HA on the Browser side is certainly a bad
idea.

Talking specifically of a reverse proxy scenario, whether one uses Squid or
Apache mod_proxy or something else may well depend upon what other features
are needed and the traffic volumes. In many reverse proxy environments
where more complex control is needed, mod_proxy seems to be often used with
modules like mod_rewrite. My understanding of Squid is that it does great
as a proxy but does not provide these features, as that is not its
purpose.  Does Squid have its own production level extensions for some
scenarios which may be typically addressed by Apache modules?

Thanks!

- Ashish

On Sun, Aug 30, 2015 at 8:02 PM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:

&gt;<i> On 30/08/2015 3:58 p.m., Ashish Mukherjee wrote:
</I>&gt;<i> &gt; Why should Squid take care of HA though? Isn't it the responsibility of
</I>&gt;<i> the
</I>&gt;<i> &gt; Website to ensure its uptime? Even if used as a reverse proxy, Apache may
</I>&gt;<i> &gt; do a better job at this, since one can do more sophisticated
</I>&gt;<i> configurations
</I>&gt;<i> &gt; with mod_proxy.
</I>&gt;<i>
</I>&gt;<i> The hint is in the name of that module: mod_*proxy*.
</I>&gt;<i>
</I>&gt;<i> HA is an outcome of using any one or more of several _proxy features_.
</I>&gt;<i>
</I>&gt;<i> Squid is a proxy. The purpose of mod_proxy is to hack/squash/ proxy
</I>&gt;<i> gateway capabilities (ie Squid functionality) into a piece of origin
</I>&gt;<i> server software (Apache).
</I>&gt;<i>
</I>&gt;<i> Would you expect a dedicated/designed piece of proxy software or an
</I>&gt;<i> 'other' software design with add-on tacked into it to actually be better
</I>&gt;<i> at the proxying functionality?
</I>&gt;<i>
</I>&gt;<i> Sure you can use the other softwares add-on *if* it performs the
</I>&gt;<i> function correctly and sufficiently for your needs. But that does not
</I>&gt;<i> make it the function any less a proxy mechanism.
</I>&gt;<i>
</I>&gt;<i> On the other end Browsers also have HA functionality they call &quot;Happy
</I>&gt;<i> Eyeballs&quot;. Varuous downloaders and app update serices try to do IP-based
</I>&gt;<i> filovers and recovery. And it call causes no end of trouble to the real
</I>&gt;<i> proxies in the middle just doing their job properly.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On Sun, Aug 30, 2015 at 3:56 AM, Kinkie wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; Hi,
</I>&gt;<i> &gt;&gt;   please see <A HREF="http://wiki.squid-cache.org/Features/MonitorUrl.">http://wiki.squid-cache.org/Features/MonitorUrl.</A>
</I>&gt;<i> &gt;&gt; It's available in squid 2.6 , and is one of the last few features who
</I>&gt;<i> &gt;&gt; haven't yet made it to Squid 3.X. If anyone is interested, code and
</I>&gt;<i> &gt;&gt; sponsorships are always welcome :)
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; On Thu, Aug 27, 2015 at 12:10 PM, Imaginovskiy wrote:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Hi all,
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Bit of a strange one but I'm wondering if it's possible to have squid
</I>&gt;<i> &gt;&gt;&gt; redirect a site to a secondary backend server if the primary is down.
</I>&gt;<i>
</I>&gt;<i> Yes it is. This is one of the core functionalities of proxying and so
</I>&gt;<i> well integrated there is *no* special configuration needed. In fact you
</I>&gt;<i> have to explicitly configure alternative if you want to avoid it.
</I>&gt;<i>
</I>&gt;<i> &gt;&gt;&gt; Have
</I>&gt;<i> &gt;&gt;&gt; been looking into this but haven't seen much similar to this.
</I>&gt;<i> Currently I
</I>&gt;<i> &gt;&gt;&gt; have my setup along the lines of this;
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Client -&gt; Squid -&gt; Backend1
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; but in the event that Backend1 is down, the following should be done;
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Client -&gt; Squid -&gt; Backend2
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Is squid capable of monitoring connections to peer or redirecting
</I>&gt;<i> based on
</I>&gt;<i> &gt;&gt;&gt; an ACL looking for some HTTP error code?
</I>&gt;<i>
</I>&gt;<i> I would almost bet you already have it setup in your squid.conf:
</I>&gt;<i>
</I>&gt;<i>  cache_peer Backend1.example.com ...
</I>&gt;<i>  cache_peer Backend2.example.com ...
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Backend2 will be used only if Backend1 is detected as unavailable, or
</I>&gt;<i> starts getting overloaded/slow (yes the HA includes latency optimization
</I>&gt;<i> too), or starts returning some retriable status responses (most common
</I>&gt;<i> is 502).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Yes, simply the line order itself. Everything else is just tuning of the
</I>&gt;<i> HA parameters.
</I>&gt;<i>
</I>&gt;<i> To prevent flapping there is a default of 10 requests that need to have
</I>&gt;<i> failed (in a row) before the 'dead' detection kicks in to send 100% to
</I>&gt;<i> Backend2. Those 10 will make TCP connect attempts to Backend1 before
</I>&gt;<i> retrying with Backend2 (if enough time remains in the forward_timeout).
</I>&gt;<i> That is configurable, see cache_peer documentation for timeouts and
</I>&gt;<i> failure options. background-ping may also be of interest to you.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> You can improve further by using DNS-based HA availability. Pointing
</I>&gt;<i> each Backend1 and Backend2 domain names at multiple IPs. But be wary of
</I>&gt;<i> those Browsers and their (overly) &quot;Happy eyeballs&quot;.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150831/818b0c6c/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150831/818b0c6c/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005266.html">[squid-users] High-Availability in Squid
</A></li>
	<LI>Next message (by thread): <A HREF="005279.html">[squid-users] High-Availability in Squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5274">[ date ]</a>
              <a href="thread.html#5274">[ thread ]</a>
              <a href="subject.html#5274">[ subject ]</a>
              <a href="author.html#5274">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
