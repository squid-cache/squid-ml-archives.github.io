<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] refresh_pattern and same objects
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20refresh_pattern%20and%20same%20objects&In-Reply-To=%3C55E4945C.8030209%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005284.html">
   <LINK REL="Next"  HREF="005100.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] refresh_pattern and same objects</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20refresh_pattern%20and%20same%20objects&In-Reply-To=%3C55E4945C.8030209%40treenet.co.nz%3E"
       TITLE="[squid-users] refresh_pattern and same objects">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Aug 31 17:52:28 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005284.html">[squid-users] refresh_pattern and same objects
</A></li>
        <LI>Next message (by thread): <A HREF="005100.html">[squid-users] refresh_pattern by type mime
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5289">[ date ]</a>
              <a href="thread.html#5289">[ thread ]</a>
              <a href="subject.html#5289">[ subject ]</a>
              <a href="author.html#5289">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/09/2015 4:01 a.m., FredB wrote:
&gt;<i> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'm thinking about something like this
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Sorry wrong move :)
</I>&gt;<i> 
</I>&gt;<i> So, What I meant was 
</I>&gt;<i> 
</I>&gt;<i> I'm thinking about something like this
</I>&gt;<i> 
</I>&gt;<i> # HTTP 1/1
</I>&gt;<i> # The refresh_pattern rules applied only to responses without an explicit expiration time
</I>&gt;<i> # min 1440 minutes
</I>&gt;<i> # Max 10080 minutes
</I>&gt;<i> 
</I>&gt;<i> # http 10080 / 60 / 24 H = 7 days
</I>&gt;<i> refresh_pattern ^http 1440 10% 10080
</I>
That will match almost everything and the rules below will remain unused.

&gt;<i> 
</I>&gt;<i> # All Files 30 days max
</I>&gt;<i> refresh_pattern -i \.(3gp|7z|ace|asx|bin|deb|divx|dvr-ms|ram|rpm|exe|inc|cab|qt)       43200 99% 43200 ignore-no-cache ignore-no-store reload-into-ims store-stale
</I>&gt;<i> refresh_pattern -i \.(rar|jar|gz|tgz|bz2|iso|m1v|m2(v|p)|mo(d|v)|arj|lha|lzh|zip|tar)  43200 99% 43200 ignore-no-cache ignore-no-store reload-into-ims store-stale
</I>&gt;<i> refresh_pattern -i \.(jp(e?g|e|2)|gif|pn[pg]|bm?|tiff?|ico|swf|dat|ad|txt|dll)         43200 99% 43200 ignore-no-cache ignore-no-store reload-into-ims store-stale
</I>&gt;<i> refresh_pattern -i \.(avi|ac4|mp(e?g|a|e|1|2|3|4)|mk(a|v)|ms(i|u|p)|og(x|v|a|g)|rm|r(a|p)m|snd|vob) 43200 99% 43200 ignore-no-cache ignore-no-store reload-into-ims store-stale
</I>&gt;<i> refresh_pattern -i \.(pp(t?x)|s|t)|pdf|rtf|wax|wm(a|v)|wmx|wpl|cb(r|z|t)|xl(s?x)|do(c?x)|flv|x-flv) 43200 99% 43200 ignore-no-cache ignore-no-store reload-into-ims store-stale
</I>&gt;<i> 
</I>&gt;<i> Maybe my values are too high ? 
</I>
I dont think so. The 99% is probably too low if anything. Try 1000%. It
will be capped by the min/max values anyway.


The problems I see there are more related to the overrides and the file
types listed;

* ignore-no-cache does absolutely nothing since 3.2. So remove it.

* ignore-no-store is dangerous. Particularly when used like this for
blanket &quot;file extension&quot; patterns.

The cases I have personally seen that you might run into serious trouble
with are .tiff files, TFF is a &quot;high quality&quot; format. At least its very
high in detail, and I've seen it used with only no-store protection to
send medical, mapping and hi-res photographic data around by software
where it is supposed to be one-use transmission. Caching that would be
both legally risky, and sometimes just waste space (app dependent).
 And with the .wm* formats, which are pretty much awash with DRM
encryption, maybe others in that set too. By caching them all you would
do is prevent users from being able to view the media.

The patterns will not match only file extensions. Any domain name that
starts with the character sequence will also match query-string segments
listing file types etc.


&gt;<i> 
</I>&gt;<i> About reload-into-ims if I understand right it translates &quot;Pragma: no-cache&quot; into &quot;If-Modified-Since&quot; if the object is cached and if there is no explicit expiration time, in real life this should be dangerous or annoying for users ?
</I>&gt;<i> 
</I>
Yes, relative to the fact its Cache-Contro: no-cache and/or max-age=0
from the client. Rather than Pragma.

&gt;<i> The context is many simultaneous users (thousands) with very different kind of profiles
</I>
I would use the above patterns but without the extra options, then add
them in one by one to see how the behaviour changes. Starting with the
ones on the right hand-side.

Trying to avoid override-no-store as long as possible, and target it to
problem sites when it is used.

And after placing this at the end of the patterns:

  (\?.*)?$


Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005284.html">[squid-users] refresh_pattern and same objects
</A></li>
	<LI>Next message (by thread): <A HREF="005100.html">[squid-users] refresh_pattern by type mime
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5289">[ date ]</a>
              <a href="thread.html#5289">[ thread ]</a>
              <a href="subject.html#5289">[ subject ]</a>
              <a href="author.html#5289">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
