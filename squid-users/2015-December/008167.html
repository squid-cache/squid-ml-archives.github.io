<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] rock storage integrity
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20rock%20storage%20integrity&In-Reply-To=%3C5661B8E2.3020308%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008165.html">
   <LINK REL="Next"  HREF="008171.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] rock storage integrity</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20rock%20storage%20integrity&In-Reply-To=%3C5661B8E2.3020308%40treenet.co.nz%3E"
       TITLE="[squid-users] rock storage integrity">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Dec  4 16:01:38 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008165.html">[squid-users] rock storage integrity
</A></li>
        <LI>Next message (by thread): <A HREF="008171.html">[squid-users] rock storage integrity
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8167">[ date ]</a>
              <a href="thread.html#8167">[ thread ]</a>
              <a href="subject.html#8167">[ subject ]</a>
              <a href="author.html#8167">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 5/12/2015 4:37 a.m., Hussam Al-Tayeb wrote:
&gt;<i> Hi. I am using squid with rock storage right now to cache computer
</I>&gt;<i> updates for my Linux computers. It works well.
</I>&gt;<i> Since this is a database, it is possible for part of the database to
</I>&gt;<i> get corrupted through a crash or incorrect poweroff?
</I>&gt;<i> I know from sql database that incorrect shutdowns can cause binary
</I>&gt;<i> corruption.
</I>&gt;<i> 
</I>&gt;<i> I had an incorrect poweroff yesterday but cache.log did not list
</I>&gt;<i> anything weird.
</I>
Such types of corruption only happen if files were actively in the
process of writing data when the power went out (read does not count).

The way Squid uses a separate memory cache as the front-line I/O area
and Diskers cache as a secondary the risks of that happening are a bit
lower than with DB services that process directly to disk.


Also, unless you tuned them to a different size the rock slots/cells are
sized to match the OS natural page sizes. So there is almost no delay in
the wrote(2) within which the corruption can happen.

Your underlying FS can also play a part in preventing the corruption.

&gt;<i> 
</I>&gt;<i> 2015/12/03 01:00:11| Store rebuilding is 0.31% complete
</I>&gt;<i> 2015/12/03 01:01:00| Finished rebuilding storage from disk.
</I>&gt;<i> 2015/12/03 01:01:00|    319999 Entries scanned
</I>&gt;<i> 2015/12/03 01:01:00|         0 Invalid entries.
</I>&gt;<i> 2015/12/03 01:01:00|         0 With invalid flags.
</I>&gt;<i> 2015/12/03 01:01:00|     55523 Objects loaded.
</I>&gt;<i> 2015/12/03 01:01:00|         0 Objects expired.
</I>&gt;<i> 2015/12/03 01:01:00|         0 Objects cancelled.
</I>&gt;<i> 2015/12/03 01:01:00|         0 Duplicate URLs purged.
</I>&gt;<i> 2015/12/03 01:01:00|         0 Swapfile clashes avoided.
</I>&gt;<i> 2015/12/03 01:01:00|   Took 49.94 seconds (1111.79 objects/sec).
</I>&gt;<i> 2015/12/03 01:01:00| Beginning Validation Procedure
</I>&gt;<i> 2015/12/03 01:01:00|   Completed Validation Procedure
</I>&gt;<i> 2015/12/03 01:01:00|   Validated 0 Entries
</I>&gt;<i> 2015/12/03 01:01:00|   store_swap_size = 3187216.00 KB
</I>&gt;<i> 
</I>&gt;<i> Nevertheless, what would be the best way to check if there was some
</I>&gt;<i> damage to the database (unusable slots/cells/whatever)?
</I>
Squid does that automatically on (every) startup. The log lines you
quote above are the scan happening and its results.

If Squid had found any corruption there would have been a non-0 value on
the lines:

&gt;<i> 2015/12/03 01:01:00|         0 Invalid entries.
</I>&gt;<i> 2015/12/03 01:01:00|         0 With invalid flags.
</I>
and possibly some WARNING notices above the &quot;Finished rebuilding&quot; line
if important problems were found.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008165.html">[squid-users] rock storage integrity
</A></li>
	<LI>Next message (by thread): <A HREF="008171.html">[squid-users] rock storage integrity
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8167">[ date ]</a>
              <a href="thread.html#8167">[ thread ]</a>
              <a href="subject.html#8167">[ subject ]</a>
              <a href="author.html#8167">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
