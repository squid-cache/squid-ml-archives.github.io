<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] How to limit user traffic quota? (GoGo net)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20How%20to%20limit%20user%20traffic%20quota%3F%20%28GoGo%20net%29&In-Reply-To=%3C5661BA6A.90009%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008166.html">
   <LINK REL="Next"  HREF="008146.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] How to limit user traffic quota? (GoGo net)</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20How%20to%20limit%20user%20traffic%20quota%3F%20%28GoGo%20net%29&In-Reply-To=%3C5661BA6A.90009%40treenet.co.nz%3E"
       TITLE="[squid-users] How to limit user traffic quota? (GoGo net)">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Dec  4 16:08:10 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008166.html">[squid-users] How to limit user traffic quota? (GoGo net)
</A></li>
        <LI>Next message (by thread): <A HREF="008146.html">[squid-users] Authentication Problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8168">[ date ]</a>
              <a href="thread.html#8168">[ thread ]</a>
              <a href="subject.html#8168">[ subject ]</a>
              <a href="author.html#8168">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 5/12/2015 4:57 a.m., GoGo net wrote:
&gt;<i> Limit rate is another direction to limit traffic, I will think about
</I>&gt;<i> it.
</I>&gt;<i> 
</I>&gt;<i> Currently, I prefer to use the script to monitor access.log, and I
</I>&gt;<i> find a problem today:
</I>&gt;<i> 
</I>&gt;<i> From [squid wiki](<A HREF="http://wiki.squid-cache.org/Features/LogFormat">http://wiki.squid-cache.org/Features/LogFormat</A>):
</I>&gt;<i> 
</I>&gt;&gt;<i> bytes The size is the amount of data delivered to the client. Mind
</I>&gt;&gt;<i> that this does not constitute the net object size, as headers are
</I>&gt;&gt;<i> also counted.
</I>&gt;<i> 
</I>&gt;<i> It seems that **bytes** only includes response size (including http
</I>&gt;<i> header). What I really want is counting both http-request and
</I>&gt;<i> http-response. Is there any way to enable http-request **bytes**
</I>&gt;<i> being logged in access.log?
</I>
You need to use the %st code in a custom log format.


PS. there is another problem you may not have noticed yet. The log
entries are only recorded at the *end* of each transaction. Which means
that all transactions started before the user hits their limit will be
allowed to continue consuming bandwidth until they exit naturally. At
which time the counted quota-spent value continues to go up past the
limit you set. CONNECT tunnels have indefinite lifetimes, some have been
seen lasting for weeks.

This is one of the reasons I recommend QoS controls external to Squid.
The OS can measure as each packet happens and terminate the over-quota
transactions at the TCP level.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008166.html">[squid-users] How to limit user traffic quota? (GoGo net)
</A></li>
	<LI>Next message (by thread): <A HREF="008146.html">[squid-users] Authentication Problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8168">[ date ]</a>
              <a href="thread.html#8168">[ thread ]</a>
              <a href="subject.html#8168">[ subject ]</a>
              <a href="author.html#8168">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
