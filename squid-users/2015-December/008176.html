<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid with NTLM auth behind netscaler
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20with%20NTLM%20auth%20behind%20netscaler&In-Reply-To=%3C5662828F.5090007%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008163.html">
   <LINK REL="Next"  HREF="008191.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid with NTLM auth behind netscaler</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20with%20NTLM%20auth%20behind%20netscaler&In-Reply-To=%3C5662828F.5090007%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid with NTLM auth behind netscaler">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Dec  5 06:22:07 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008163.html">[squid-users] Squid with NTLM auth behind netscaler
</A></li>
        <LI>Next message (by thread): <A HREF="008191.html">[squid-users] Squid with NTLM auth behind netscaler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8176">[ date ]</a>
              <a href="thread.html#8176">[ thread ]</a>
              <a href="subject.html#8176">[ subject ]</a>
              <a href="author.html#8176">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 5/12/2015 5:39 a.m., Fabio Bucci wrote:
&gt;<i> Thanks Amos.
</I>&gt;<i> Actually my load balancing is configured to perform round robin balancing
</I>&gt;<i> between the two nodes. I added a session persistance by source ip in order
</I>&gt;<i> to avoid to login again with some sites.
</I>&gt;<i> 
</I>&gt;<i> my squid.conf is very simple:
</I>&gt;<i> auth_param ntlm program /usr/bin/ntlm_auth
</I>&gt;<i> --helper-protocol=squid-2.5-ntlmssp
</I>&gt;<i> auth_param ntlm children 100
</I>&gt;<i> auth_param ntlm keep_alive off
</I>&gt;<i> 
</I>&gt;<i> acl auth proxy_auth REQUIRED
</I>&gt;<i> 
</I>&gt;<i> http_access allow auth
</I>&gt;<i> 
</I>
Okay. That *should* work. With some NTLM-specific caveats.


&gt;<i> forwarded_for on
</I>&gt;<i> follow_x_forwarded_for allow netscaler
</I>&gt;<i> 
</I>
If the LB is touching the traffic enough to add headers then it is a
proxy. NTLM does not work at all well through proxies. NTLM as a whole
is based on the assumption that there is one (and only one) TCP
connection between it and the proxy - the credentials are tied to the
TCP connection state.

There is one VERY slim hack that lets NTLM pass straight through a
frontend proxy/LB. That is by pinning the LB's inbound and outbound TCP
connections together. This is not just session persistence, but absolute
prohibition on any other traffic (even from other connections by the
same client) being sent to that outbound LB-&gt;proxy connection. Some LB
can do it, some can't.


I recommend advertising both/all proxy IPs to the clients and letting
each select the one(s) it wants to contact. That way the client can
perform NTLM directly to the Squid.


On the other hand NTLM was deprecated back in 2006, you should try
migrating to Negotiate/Kerberos. Kerberos is a bit of a learning curve
and can be tricky working with older client software. But is *way* more
efficient and friendlier to HTTP (but still not fully).


Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008163.html">[squid-users] Squid with NTLM auth behind netscaler
</A></li>
	<LI>Next message (by thread): <A HREF="008191.html">[squid-users] Squid with NTLM auth behind netscaler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8176">[ date ]</a>
              <a href="thread.html#8176">[ thread ]</a>
              <a href="subject.html#8176">[ subject ]</a>
              <a href="author.html#8176">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
