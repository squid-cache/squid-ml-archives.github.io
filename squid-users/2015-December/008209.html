<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid auth
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20auth&In-Reply-To=%3Cn47e38%249b7%241%40ger.gmane.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008208.html">
   <LINK REL="Next"  HREF="008210.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid auth</H1>
    <B>Markus Moeller</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20auth&In-Reply-To=%3Cn47e38%249b7%241%40ger.gmane.org%3E"
       TITLE="[squid-users] squid auth">huaraz at moeller.plus.com
       </A><BR>
    <I>Tue Dec  8 20:20:51 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008208.html">[squid-users] squid auth
</A></li>
        <LI>Next message (by thread): <A HREF="008210.html">[squid-users] squid auth
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8209">[ date ]</a>
              <a href="thread.html#8209">[ thread ]</a>
              <a href="subject.html#8209">[ subject ]</a>
              <a href="author.html#8209">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

   The issue appears if you use the same AD account for samba and the 
kerberos keytab creation.  As samba will reset the password of the AD 
account and thereby invalidate the extracted keytab.

Markus


&quot;Alex Samad&quot;  wrote in message 
news:CAJ+Q1PW9Ue4zdT9GCt-4MjW=UjDWyBOPc4AFrcjG=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">qFNEwMMGA at mail.gmail.com...</A>

Hi

So what your saying is I should install the mskutil and let it manage
the squid krb keytab file.


Could you possible help with the changed to the squid.conf file do I
leave as is and just add kerberos first ?


On 8 December 2015 at 20:03, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:
&gt;<i> On 8/12/2015 7:44 p.m., Alex Samad wrote:
</I>&gt;&gt;<i> Hi
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Currently using 3.1 (from centos 6)
</I>&gt;&gt;<i> I have setup squid to auth against MS AD
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have
</I>&gt;&gt;<i> # #######
</I>&gt;&gt;<i> # Negotiate
</I>&gt;&gt;<i> # #######
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # <A HREF="http://wiki.squid-cache.org/Features/Authentication">http://wiki.squid-cache.org/Features/Authentication</A>
</I>&gt;&gt;<i> # <A HREF="http://wiki.squid-cache.org/Features/NegotiateAuthentication">http://wiki.squid-cache.org/Features/NegotiateAuthentication</A>
</I>&gt;&gt;<i> auth_param negotiate program /usr/bin/ntlm_auth
</I>&gt;&gt;<i> --helper-protocol=gss-spnego --configfile /etc/samba/smb.conf-squid
</I>&gt;&gt;<i> auth_param negotiate children 10 startup=0 idle=3
</I>&gt;&gt;<i> auth_param negotiate keep_alive on
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # #######
</I>&gt;&gt;<i> # NTLM AUTH
</I>&gt;&gt;<i> # #######
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # ntlm auth
</I>&gt;&gt;<i> auth_param ntlm program /usr/bin/ntlm_auth
</I>&gt;&gt;<i> --helper-protocol=squid-2.5-ntlmssp --configfile
</I>&gt;&gt;<i> /etc/samba/smb.conf-squid
</I>&gt;&gt;<i> auth_param ntlm children 10
</I>&gt;&gt;<i> #auth_param ntlm children 10 startup=0 idle=3
</I>&gt;&gt;<i> #auth_param ntlm keep_alive
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # #######
</I>&gt;&gt;<i> # NTLM over basic
</I>&gt;&gt;<i> # #######
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # warning: basic authentication sends passwords plaintext
</I>&gt;&gt;<i> # a network sniffer can and will discover passwords
</I>&gt;&gt;<i> auth_param basic program /usr/bin/ntlm_auth
</I>&gt;&gt;<i> --helper-protocol=squid-2.5-basic --configfile
</I>&gt;&gt;<i> /etc/samba/smb.conf-squid
</I>&gt;&gt;<i> auth_param basic children 5
</I>&gt;&gt;<i> auth_param basic realm Squid proxy-caching web server
</I>&gt;&gt;<i> auth_param basic credentialsttl 2 hours
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I want to move towards using kerberos come to this page
</I>&gt;&gt;<i> <A HREF="http://wiki.squid-cache.org/ConfigExamples/Authenticate/Kerberos">http://wiki.squid-cache.org/ConfigExamples/Authenticate/Kerberos</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> worked through that, but i saw this
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Do not use this method if you run winbindd or other samba services as
</I>&gt;&gt;<i> samba will reset the machine password every x days and thereby makes
</I>&gt;&gt;<i> the keytab invalid !!
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> As I understand it that disclaimer applies only to the &quot;OR with Samba&quot;
</I>&gt;<i> instructions for keytab creation directly above it. The other two
</I>&gt;<i> methods should work.
</I>&gt;<i>
</I>&gt;<i> Also, it is just a disclaimer about a known problem. There is always the
</I>&gt;<i> option to setup a script that re-builds the keytab and reloads Squid
</I>&gt;<i> every X days when it changes.
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have winbindd running for my users list in linux
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> is there a way around this and if not how
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The initial mskutil method of keytab creation is both a way around it
</I>&gt;<i> and the preferred method of keytab creation.
</I>&gt;<i>
</I>&gt;<i> As you found elsewhere ...
</I>&gt;<i>
</I>&gt;&gt;<i> then found this one
</I>&gt;&gt;<i> <A HREF="http://wiki.squid-cache.org/ConfigExamples/Authenticate/WindowsActiveDirectory">http://wiki.squid-cache.org/ConfigExamples/Authenticate/WindowsActiveDirectory</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> but I am not using msktutil, i do have samba and the krb-workstation 
</I>&gt;&gt;<i> installed
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> mskutil is just a tool to generate keytabs and link the machine to
</I>&gt;<i> domain. I *think* it should still be usable even if you have Sambe, the
</I>&gt;<i> probem is just that if you let Samba know about the keytab and account
</I>&gt;<i> it will do the periodic updates.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A> 



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008208.html">[squid-users] squid auth
</A></li>
	<LI>Next message (by thread): <A HREF="008210.html">[squid-users] squid auth
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8209">[ date ]</a>
              <a href="thread.html#8209">[ thread ]</a>
              <a href="subject.html#8209">[ subject ]</a>
              <a href="author.html#8209">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
