<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Slow Squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Slow%20Squid&In-Reply-To=%3C5668B2A2.4000401%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008222.html">
   <LINK REL="Next"  HREF="008214.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Slow Squid</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Slow%20Squid&In-Reply-To=%3C5668B2A2.4000401%40treenet.co.nz%3E"
       TITLE="[squid-users] Slow Squid">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Dec  9 23:00:50 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008222.html">[squid-users] Slow Squid
</A></li>
        <LI>Next message (by thread): <A HREF="008214.html">[squid-users] ssl-bump splice on unsupported ciphers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8227">[ date ]</a>
              <a href="thread.html#8227">[ thread ]</a>
              <a href="subject.html#8227">[ subject ]</a>
              <a href="author.html#8227">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/12/2015 4:29 a.m., Patrick Flaherty wrote:
&gt;<i> Hi ,
</I>&gt;<i> 
</I>&gt;<i> I have changed my 3.5.11 squid.conf based on your excellent feedback Amos.
</I>&gt;<i> Please have a look at my edits to see if it is improved.
</I>&gt;<i> 
</I>&gt;<i> Thank You,
</I>&gt;<i> Patrick
</I>&gt;<i> 
</I>&gt;<i> # Squid Proxy Configuration
</I>&gt;<i> 
</I>&gt;<i> # listening port
</I>&gt;<i> http_port     3128
</I>&gt;<i> 
</I>&gt;<i> # max_filedesc
</I>&gt;<i> max_filedesc  2048
</I>&gt;<i> 
</I>
FYI: the directive name is actually &quot;max_filedescriptors&quot;. The
&quot;filedesc&quot; thing is a RHEL hack, Squid accepts it but only for backward
compatibility.


&gt;<i> # debug_options	ALL,2
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> # acl directives for ports and protocols
</I>&gt;<i> acl http      proto      http
</I>&gt;<i> acl https     proto      https
</I>&gt;<i> acl port_80   port       80
</I>&gt;<i> acl sslports  port       443
</I>&gt;<i> acl CONNECT   method     CONNECT
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> # acl and http_access (&quot;rmsc.txt&quot;)
</I>&gt;<i> acl whitelist dstdomain  &quot;c:/squid/etc/squid/rmsc.txt&quot;
</I>&gt;<i> http_access 	allow 	whitelist
</I>
This is no change from before. Everything matching whitelist is allowed.
No other rules about whitelist are reachable.


FYI:
Squid checks access controls from the top down, left to right.
The first non-matching ACL check on a line wins and no following ACLs
are checked.
The first fully matching line wins and no following lines are checked.


So;
* whenever &quot;allow localnet&quot; matches, the &quot;deny localnet&quot; line will not
be processed.
* whenever &quot;allow localnet&quot; does not match, the &quot;deny localnet&quot; line is
also a non-match.

Understand?


Also, if you are going to let &quot;anyone&quot; access the listed domains, at
least place the basic security protections in at the top. They protect
against abuses like people sending Spam or VPN tunnels through the proxy.

These ones that are set in the default squid.conf:
 http_access deny !Safe_ports
 http_access deny CONNECT !SSL_Ports

 ... then your whitelist rule:

  http_access allow whitelist


&gt;<i> http_access 	deny 	whitelist
</I>
&gt;<i> 
</I>&gt;<i> # network source of proxy traffic (Specific Network Example 192.168.1.0/24)
</I>&gt;<i> acl localnet  src        172.16.50.0/24
</I>&gt;<i> http_access allow localnet
</I>
Thats better.


&gt;<i> http_access deny localnet
</I>&gt;<i> 
</I>
Same as with whitelist rules above. Denying something has no effect if
you already allowed it.


&gt;<i> # dns servers (Change dns_nameservers to client dns servers for consistency
</I>&gt;<i> and better performance)
</I>&gt;<i> dns_nameservers 172.16.50.9 172.16.9.13
</I>&gt;<i> 
</I>
Or if your system registry settings are the same ones the clients are
using, remove the dns_nameservers entirely and Squid will use the
networks normal resolver(s).


&gt;<i> # cache web pages
</I>&gt;<i> cache_mem 512 MB
</I>&gt;<i> 
</I>&gt;<i> # roll log file daily and keep 30 days
</I>&gt;<i> logfile_rotate 30
</I>&gt;<i> 
</I>&gt;<i> # access log format         (Having one problem with the Default Squid log
</I>&gt;<i> and that is the timestamp being Epoch and not human readable on Windows
</I>&gt;<i> platform)
</I>&gt;<i> logformat squid %tl %6tr %&gt;a %Ss/%03&gt;Hs %&lt;st %rm %ru %un %Sh/%&lt;A %mt
</I>
The problem I pointed out was the *name* of the logformat.

 logformat something %tl %6tr %&gt;a %Ss/%03&gt;Hs %&lt;st %rm %ru %un %Sh/%&lt;A %mt
 access_log stdio:/var/log/squid/access.log something

(or whatever the local path equivalent needs to be).


Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008222.html">[squid-users] Slow Squid
</A></li>
	<LI>Next message (by thread): <A HREF="008214.html">[squid-users] ssl-bump splice on unsupported ciphers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8227">[ date ]</a>
              <a href="thread.html#8227">[ thread ]</a>
              <a href="subject.html#8227">[ subject ]</a>
              <a href="author.html#8227">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
