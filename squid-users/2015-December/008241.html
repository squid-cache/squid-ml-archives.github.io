<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid reverse proxy infront of exchange 2010
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20reverse%20proxy%20infront%20of%20exchange%202010&In-Reply-To=%3C6ede17791f7541fa080516d4ac0461cf%40dweimer.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008231.html">
   <LINK REL="Next"  HREF="008253.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid reverse proxy infront of exchange 2010</H1>
    <B>dweimer</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20reverse%20proxy%20infront%20of%20exchange%202010&In-Reply-To=%3C6ede17791f7541fa080516d4ac0461cf%40dweimer.net%3E"
       TITLE="[squid-users] squid reverse proxy infront of exchange 2010">dweimer at dweimer.net
       </A><BR>
    <I>Thu Dec 10 12:44:46 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008231.html">[squid-users] squid reverse proxy infront of exchange 2010
</A></li>
        <LI>Next message (by thread): <A HREF="008253.html">[squid-users] squid reverse proxy infront of exchange 2010
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8241">[ date ]</a>
              <a href="thread.html#8241">[ thread ]</a>
              <a href="subject.html#8241">[ subject ]</a>
              <a href="author.html#8241">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2015-12-09 11:29 pm, Alex Samad wrote:
&gt;<i> Hi
</I>&gt;<i> 
</I>&gt;<i> config
</I>&gt;<i> https_port 22.4.2.5:443 accel
</I>&gt;<i> cert=/etc/httpd/conf.d/office.abc.com.crt
</I>&gt;<i> key=/etc/httpd/conf.d/office.abc.com.key defaultsite=office.abc.com
</I>&gt;<i> options=NO_SSLv2,NO_SSLv3
</I>&gt;<i> dhparams=/etc/squid/squid-office-dhparams.pem
</I>&gt;<i> cipher=ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA
</I>&gt;<i> cache_peer 127.0.0.1 parent 443 0 proxy-only no-query no-digest
</I>&gt;<i> originserver login=PASS ssl sslflags=DONT_VERIFY_PEER
</I>&gt;<i> sslcert=/etc/httpd/conf.d/office.abc.com.crt
</I>&gt;<i> sslkey=/etc/httpd/conf.d/office.abc.com.key name=webServer
</I>&gt;<i> cache_peer 10.32.69.11 parent 443 0 proxy-only no-query no-digest
</I>&gt;<i> originserver login=PASS front-end-https=on ssl
</I>&gt;<i> sslflags=DONT_VERIFY_PEER sslcert=/etc/httpd/conf.d/office.abc.com.crt
</I>&gt;<i> sslkey=/etc/httpd/conf.d/office.abc.com.key name=exchangeServer
</I>&gt;<i> acl exch_domain dstdomain office.abc.com
</I>&gt;<i> acl exch_path urlpath_regex -i /exch(ange|web)
</I>&gt;<i> acl exch_path urlpath_regex -i /public
</I>&gt;<i> acl exch_path urlpath_regex -i /owa
</I>&gt;<i> acl exch_path urlpath_regex -i /ecp
</I>&gt;<i> acl exch_path urlpath_regex -i /microsoft-server-activesync
</I>&gt;<i> acl exch_path urlpath_regex -i /rpc
</I>&gt;<i> acl exch_path urlpath_regex -i /rpcwithcert
</I>&gt;<i> acl exch_path urlpath_regex -i /exadmin
</I>&gt;<i> acl exch_path urlpath_regex -i /ews
</I>&gt;<i> acl exch_path urlpath_regex -i /oab
</I>&gt;<i> acl exch_path urlpath_regex -i /autodiscover
</I>&gt;<i> cache_peer_access exchangeServer allow exch_domain exch_path
</I>&gt;<i> cache_peer_access webServer deny exch_domain exch_path
</I>&gt;<i> never_direct allow exch_domain exch_path
</I>&gt;<i> cache_mem 32 MB
</I>&gt;<i> maximum_object_size_in_memory 128 KB
</I>&gt;<i> access_log stdio:/var/log/squid/office-access.log squid
</I>&gt;<i> cache_log /var/log/squid/office-cache.log
</I>&gt;<i> cache_store_log stdio:/var/log/squid/office-cache_store.log
</I>&gt;<i> pid_filename /var/run/squid-office.pid
</I>&gt;<i> visible_hostname office.abc.com
</I>&gt;<i> deny_info TCP_RESET all
</I>&gt;<i> http_access allow all
</I>&gt;<i> miss_access allow all
</I>&gt;<i> icp_port 0
</I>&gt;<i> snmp_port 0
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> cache.log
</I>&gt;<i> Jan 01 10:33:35 1970/12/10 16:15:42 kid1| Process ID 5631
</I>&gt;<i> Jan 01 10:33:35 1970/12/10 16:15:42 kid1| Process Roles: worker
</I>&gt;<i> Jan 01 10:33:35 1970/12/10 16:15:42 kid1| With 1024 file descriptors 
</I>&gt;<i> available
</I>&gt;<i> Jan 01 10:33:35 1970/12/10 16:15:42 kid1| Initializing IP Cache...
</I>&gt;<i> Jan 01 10:33:35 1970/12/10 16:15:42 kid1| DNS Socket created at 
</I>&gt;<i> 0.0.0.0, FD 6
</I>&gt;<i> Jan 01 10:33:35 1970/12/10 16:15:42 kid1| Adding domain
</I>&gt;<i> yieldbroker.com from /etc/resolv.conf
</I>&gt;<i> Jan 01 10:33:35 1970/12/10 16:15:42 kid1| Adding nameserver
</I>&gt;<i> 10.32.20.100 from /etc/resolv.conf
</I>&gt;<i> Jan 01 10:33:35 1970/12/10 16:15:42 kid1| Adding nameserver
</I>&gt;<i> 10.32.20.102 from /etc/resolv.conf
</I>&gt;<i> Jan 01 10:33:35 1970/12/10 16:15:42 kid1| Logfile: opening log
</I>&gt;<i> stdio:/var/log/squid/office-access.log
</I>&gt;<i> Jan 01 10:33:35 1970/12/10 16:15:42 kid1| Local cache digest enabled;
</I>&gt;<i> rebuild/rewrite every 3600/3600 sec
</I>&gt;<i> Jan 01 10:33:35 1970/12/10 16:15:42 kid1| Logfile: opening log
</I>&gt;<i> stdio:/var/log/squid/office-cache_store.log
</I>&gt;<i> Jan 01 10:33:35 1970/12/10 16:15:42 kid1| Swap maxSize 0 + 32768 KB,
</I>&gt;<i> estimated 2520 objects
</I>&gt;<i> Jan 01 10:33:35 1970/12/10 16:15:42 kid1| Target number of buckets: 126
</I>&gt;<i> Jan 01 10:33:35 1970/12/10 16:15:42 kid1| Using 8192 Store buckets
</I>&gt;<i> Jan 01 10:33:35 1970/12/10 16:15:42 kid1| Max Mem  size: 32768 KB
</I>&gt;<i> Jan 01 10:33:35 1970/12/10 16:15:42 kid1| Max Swap size: 0 KB
</I>&gt;<i> Jan 01 10:33:35 1970/12/10 16:15:42 kid1| Using Least Load store dir 
</I>&gt;<i> selection
</I>&gt;<i> Jan 01 10:33:35 1970/12/10 16:15:42 kid1| Current Directory is 
</I>&gt;<i> /etc/squid
</I>&gt;<i> Jan 01 10:33:35 1970/12/10 16:15:42 kid1| Finished loading MIME types 
</I>&gt;<i> and icons.
</I>&gt;<i> Jan 01 10:33:35 1970/12/10 16:15:42 kid1| HTCP Disabled.
</I>&gt;<i> Jan 01 10:33:35 1970/12/10 16:15:42 kid1| Configuring Parent 
</I>&gt;<i> 127.0.0.1/443/0
</I>&gt;<i> Jan 01 10:33:35 1970/12/10 16:15:42 kid1| Configuring Parent 
</I>&gt;<i> 10.32.69.11/443/0
</I>&gt;<i> Jan 01 10:33:35 1970/12/10 16:15:42 kid1| Squid plugin modules loaded: 
</I>&gt;<i> 0
</I>&gt;<i> Jan 01 10:33:35 1970/12/10 16:15:42 kid1| Adaptation support is off.
</I>&gt;<i> Jan 01 10:33:35 1970/12/10 16:15:42 kid1| Accepting reverse-proxy
</I>&gt;<i> HTTPS Socket connections at local=202.74.32.15:443 remote=[::] FD 11
</I>&gt;<i> flags=9
</I>&gt;<i> Jan 01 10:33:35 1970/12/10 16:15:43 kid1| storeLateRelease: released 0 
</I>&gt;<i> objects
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> cache log
</I>&gt;<i> Dec 10 16:16:23 2015.225 RELEASE -1 FFFFFFFF
</I>&gt;<i> BE6736C8CD1A74A54575AF9880395D04   ?         ?         ?         ? ?/?
</I>&gt;<i> ?/? ? ?
</I>&gt;<i> Dec 10 16:16:34 2015.287 RELEASE -1 FFFFFFFF
</I>&gt;<i> 78C390A2D412F8E601035A2C1FD771C8   ?         ?         ?         ? ?/?
</I>&gt;<i> ?/? ? ?
</I>&gt;<i> Dec 10 16:16:34 2015.296 RELEASE -1 FFFFFFFF
</I>&gt;<i> A7D8B3751858C54225D29408B56FE42D   ?         ?         ?         ? ?/?
</I>&gt;<i> ?/? ? ?
</I>&gt;<i> Dec 10 16:16:37 2015.863 RELEASE -1 FFFFFFFF
</I>&gt;<i> 35992070307CD15EE743F71344E1C1AE   ?         ?         ?         ? ?/?
</I>&gt;<i> ?/? ? ?
</I>&gt;<i> Dec 10 16:16:37 2015.873 RELEASE -1 FFFFFFFF
</I>&gt;<i> 17EFD3BCAF4265B7CF7803AD0289DD7E   ?         ?         ?         ? ?/?
</I>&gt;<i> ?/? ? ?
</I>&gt;<i> Dec 10 16:16:49 2015.228 RELEASE -1 FFFFFFFF
</I>&gt;<i> 2666EC9714425D57FDC4CD15965D350B   ?         ?         ?         ? ?/?
</I>&gt;<i> ?/? ? ?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> access.logs
</I>&gt;<i> Dec 10 16:17:09 2015.706     13 192.168.56.1 TCP_MISS/200 6578 POST
</I>&gt;<i> <A HREF="https://office.abc.com/ews/exchange.asmx">https://office.abc.com/ews/exchange.asmx</A> - FIRSTUP_PARENT/10.32.69.11
</I>&gt;<i> text/xml
</I>&gt;<i> Dec 10 16:19:36 2015.447 206818 192.168.56.1 TCP_MISS/200 16532
</I>&gt;<i> RPC_OUT_DATA <A HREF="https://office.abc.com/rpc/rpcproxy.dll?">https://office.abc.com/rpc/rpcproxy.dll?</A> -
</I>&gt;<i> FIRSTUP_PARENT/10.32.69.11 application/rpc
</I>&gt;<i> Dec 10 16:19:36 2015.449 206862 192.168.56.1 TCP_MISS_ABORTED/502 4493
</I>&gt;<i> RPC_IN_DATA <A HREF="https://office.abc.com/rpc/rpcproxy.dll?">https://office.abc.com/rpc/rpcproxy.dll?</A> -
</I>&gt;<i> FIRSTUP_PARENT/10.32.69.11 text/html
</I>&gt;<i> Dec 10 16:19:36 2015.453 207197 192.168.56.1 TCP_MISS_ABORTED/000 0
</I>&gt;<i> RPC_IN_DATA <A HREF="https://office.abc.com/rpc/rpcproxy.dll?">https://office.abc.com/rpc/rpcproxy.dll?</A> -
</I>&gt;<i> FIRSTUP_PARENT/10.32.69.11 -
</I>&gt;<i> Dec 10 16:19:36 2015.453 207087 192.168.56.1 TCP_MISS_ABORTED/200
</I>&gt;<i> 48056 RPC_OUT_DATA <A HREF="https://office.abc.com/rpc/rpcproxy.dll?">https://office.abc.com/rpc/rpcproxy.dll?</A> -
</I>&gt;<i> FIRSTUP_PARENT/10.32.69.11 application/rpc
</I>&gt;<i> Dec 10 16:20:07 2015.305  24688 192.168.56.1 TCP_MISS_ABORTED/000 0
</I>&gt;<i> RPC_IN_DATA <A HREF="https://office.abc.com/rpc/rpcproxy.dll?">https://office.abc.com/rpc/rpcproxy.dll?</A> -
</I>&gt;<i> FIRSTUP_PARENT/10.32.69.11 -
</I>&gt;<i> Dec 10 16:20:07 2015.306  24654 192.168.56.1 TCP_MISS_ABORTED/200 2004
</I>&gt;<i> RPC_OUT_DATA <A HREF="https://office.abc.com/rpc/rpcproxy.dll?">https://office.abc.com/rpc/rpcproxy.dll?</A> -
</I>&gt;<i> FIRSTUP_PARENT/10.32.69.11 application/rpc
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> This is when I try and send an email with an attachment. An email with
</I>&gt;<i> no attached goes through no problem...
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> this config works with 3.1, not with 3.5 ..
</I>&gt;<i> 
</I>&gt;<i> still on .11 as I can't find centos 6 compile of .12
</I>&gt;<i> 
</I>&gt;<i> I think there is some issue with rpc sending or receiving ..
</I>&gt;<i> 
</I>&gt;<i> On 8 December 2015 at 19:34, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; 
</I>&gt;<i> wrote:
</I>&gt;&gt;<i> On 8/12/2015 7:35 p.m., Alex Samad wrote:
</I>&gt;&gt;&gt;<i> Hi
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Any suggestions on how to debug this... I wouldn't mind rolling
</I>&gt;&gt;&gt;<i> forward to 3.5 again
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Some ideas inline. The main ones are:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> * re-enable cache.log. It is not optional.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> * try an upgrade to 3.5.12. There were some regressions in the .10/.11
</I>&gt;&gt;<i> releases that can lead to really weird behaviour.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> On 2 December 2015 at 20:39, Alex Samad wrote:
</I>&gt;&gt;&gt;&gt;<i> Just to add to this I have a lot of these in the log file
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> TCP_MISS_ABORTED/000 0 RPC_IN_DATA
</I>&gt;&gt;&gt;&gt;<i> TCP_MISS_ABORTED/200 4322 RPC_OUT_DATA
</I>&gt;&gt;&gt;&gt;<i> TCP_MISS_ABORTED/000 0 RPC_IN_DATA https:
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> On 2 December 2015 at 17:24, Alex Samad wrote:
</I>&gt;&gt;&gt;&gt;&gt;<i> Hi
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> recently upgraded to squid-3.5.11-1.el6.x86_64 from the centos 6.7  
</I>&gt;&gt;&gt;&gt;&gt;<i> squid 3.1
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> I am now having problems with people who use active sync via this
</I>&gt;&gt;&gt;&gt;&gt;<i> connection . seems like emails with attachments aren't making it
</I>&gt;&gt;&gt;&gt;&gt;<i> through .
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> cache_peer 10.32.69.11 parent 443 0 proxy-only no-query no-digest
</I>&gt;&gt;&gt;&gt;&gt;<i> originserver login=PASS front-end-https=on ssl
</I>&gt;&gt;&gt;&gt;&gt;<i> sslflags=DONT_VERIFY_PEER 
</I>&gt;&gt;&gt;&gt;&gt;<i> sslcert=/etc/httpd/conf.d/office.yx.com.crt
</I>&gt;&gt;&gt;&gt;&gt;<i> sslkey=/etc/httpd/conf.d/office.yx.com.key name=exchangeServer
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> You could try changing these from login=PASS to login=PASSTHRU
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> cache_peer 127.0.0.1 parent 443 0 proxy-only no-query no-digest
</I>&gt;&gt;&gt;&gt;&gt;<i> originserver login=PASS ssl sslflags=DONT_VERIFY_PEER
</I>&gt;&gt;&gt;&gt;&gt;<i> sslcert=/etc/httpd/conf.d/office.yx.com.crt
</I>&gt;&gt;&gt;&gt;&gt;<i> sslkey=/etc/httpd/conf.d/office.yx.com.key name=webServer
</I>&gt;&gt;&gt;&gt;&gt;<i> c
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> # List of acceptable URLs to send to the Exchange server
</I>&gt;&gt;&gt;&gt;&gt;<i> acl exch_url url_regex -i office.yieldbroker.com/exchange
</I>&gt;&gt;&gt;&gt;&gt;<i> acl exch_url url_regex -i office.yieldbroker.com/exchweb
</I>&gt;&gt;&gt;&gt;&gt;<i> acl exch_url url_regex -i office.yieldbroker.com/public
</I>&gt;&gt;&gt;&gt;&gt;<i> acl exch_url url_regex -i office.yieldbroker.com/owa
</I>&gt;&gt;&gt;&gt;&gt;<i> acl exch_url url_regex -i office.yieldbroker.com/ecp
</I>&gt;&gt;&gt;&gt;&gt;<i> acl exch_url url_regex -i 
</I>&gt;&gt;&gt;&gt;&gt;<i> office.yieldbroker.com/microsoft-server-activesync
</I>&gt;&gt;&gt;&gt;&gt;<i> acl exch_url url_regex -i office.yieldbroker.com/rpc
</I>&gt;&gt;&gt;&gt;&gt;<i> acl exch_url url_regex -i office.yieldbroker.com/rpcwithcert
</I>&gt;&gt;&gt;&gt;&gt;<i> acl exch_url url_regex -i office.yieldbroker.com/exadmin
</I>&gt;&gt;&gt;&gt;&gt;<i> acl exch_url url_regex -i office.yieldbroker.com/oab
</I>&gt;&gt;&gt;&gt;&gt;<i> # added after
</I>&gt;&gt;&gt;&gt;&gt;<i> acl exch_url url_regex -i office.yieldbroker.com/ews
</I>&gt;&gt;&gt;&gt;&gt;<i> # Not configured on exchange 2010
</I>&gt;&gt;&gt;&gt;&gt;<i> #acl exch_url url_regex -i office.yieldbroker.com/autodiscover
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> # Send the Exchange URLs to the Exchange server
</I>&gt;&gt;&gt;&gt;&gt;<i> cache_peer_access exchangeServer allow exch_url
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> # Send everything else to the Apache
</I>&gt;&gt;&gt;&gt;&gt;<i> cache_peer_access webServer deny exch_url
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> # This is to protect Squid
</I>&gt;&gt;&gt;&gt;&gt;<i> never_direct allow exch_url
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> # Logging Configuration
</I>&gt;&gt;&gt;&gt;&gt;<i> redirect_rewrites_host_header off
</I>&gt;&gt;&gt;&gt;&gt;<i> cache_mem 32 MB
</I>&gt;&gt;&gt;&gt;&gt;<i> maximum_object_size_in_memory 128 KB
</I>&gt;&gt;&gt;&gt;&gt;<i> cache_log none
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> You should re-enable cache.log and fix any of the issues that are 
</I>&gt;&gt;<i> logged
</I>&gt;&gt;<i> there.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> cache_store_log none
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> access_log stdio:/var/log/squid/office-access.log squid
</I>&gt;&gt;&gt;&gt;&gt;<i> #access_log none
</I>&gt;&gt;&gt;&gt;&gt;<i> cache_log /var/log/squid/office-cache.log
</I>&gt;&gt;&gt;&gt;&gt;<i> #cache_log none
</I>&gt;&gt;&gt;&gt;&gt;<i> pid_filename /var/run/squid-office.pid
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> # Set the hostname so that we can see Squid in the path (Optional)
</I>&gt;&gt;&gt;&gt;&gt;<i> visible_hostname yieldbroker.com
</I>&gt;&gt;&gt;&gt;&gt;<i> deny_info TCP_RESET all
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> This could lead to strange behaviour. Particularly since &quot;deny all&quot; is
</I>&gt;&gt;<i> not being used in your http_access rules ...
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> # Allow everyone through, internal and external connections
</I>&gt;&gt;&gt;&gt;&gt;<i> http_access allow all
</I>&gt;&gt;&gt;&gt;&gt;<i> miss_access allow all
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> icp_port 0
</I>&gt;&gt;&gt;&gt;&gt;<i> snmp_port 0
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> via off
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> The previous setup had worked for at least 18 months.
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> Alex
</I>
On our Reverse proxy I ran into an issue uploading attachments to 
Exchange back end, a while back, turned out the solution was to lock it 
down so that the proxy only used ssl version 3 to connect to the 
Exchange server. This however did recently break after a windows update 
in Novemeber. Further investigation led to the particular cipher that 
was in use. After discovering this I was able to use the same cipher 
with TLSv1.0

Currently I am using TLSv1.0 with RC4-SHA cipher to talk to the Exchange 
server.

cache_peer 10.20.10.161 parent 443 0 ssl no-query proxy-only no-digest 
originserver \
  name=owa2010_parent sslcapath=/usr/local/share/certs 
sslflags=DONT_VERIFY_PEER  \
  login=PASSTHRU front-end-https=on connection-auth=on sslcipher=RC4-SHA 
sslversion=4

I am not however locking down the incoming connections to this setting, 
I am using the following for the https_port setting. This does pass PCI 
scans, in case anyone is wondering about the choice of cipher options, 
and you will notice the RC4 used to send traffic between the Proxy and 
Exchange is disabled as that doesn't meet current requirements.

https_port 10.50.20.12:443 accel defaultsite=mail.mydomain.com \
  cert=/certs/wildcard.certificate.crt \
  key=/certs/wildcard.certificate.key \
  
options=NO_SSLv2:NO_SSLv3:NO_TLSv1:SINGLE_DH_USE:CIPHER_SERVER_PREFERENCE 
\
  dhparams=/usr/local/etc/squid/dh.param \
  cipher=ALL:!aNULL:!eNULL:!LOW:!EXP:!ADH:+HIGH:+MEDIUM:!SSLv2:!RC4 \
  vhost


-- 
Thanks,
    Dean E. Weimer
    <A HREF="http://www.dweimer.net/">http://www.dweimer.net/</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008231.html">[squid-users] squid reverse proxy infront of exchange 2010
</A></li>
	<LI>Next message (by thread): <A HREF="008253.html">[squid-users] squid reverse proxy infront of exchange 2010
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8241">[ date ]</a>
              <a href="thread.html#8241">[ thread ]</a>
              <a href="subject.html#8241">[ subject ]</a>
              <a href="author.html#8241">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
