<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] delay syntax, speed and network
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20delay%20syntax%2C%20speed%20and%20network&In-Reply-To=%3C566999A3.5000402%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008238.html">
   <LINK REL="Next"  HREF="008249.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] delay syntax, speed and network</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20delay%20syntax%2C%20speed%20and%20network&In-Reply-To=%3C566999A3.5000402%40treenet.co.nz%3E"
       TITLE="[squid-users] delay syntax, speed and network">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Dec 10 15:26:27 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008238.html">[squid-users] delay syntax, speed and network
</A></li>
        <LI>Next message (by thread): <A HREF="008249.html">[squid-users] help change cache dir
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8245">[ date ]</a>
              <a href="thread.html#8245">[ thread ]</a>
              <a href="subject.html#8245">[ subject ]</a>
              <a href="author.html#8245">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/12/2015 11:38 p.m., Massimo.Sala wrote:
&gt;<i> 1) speed syntax
</I>&gt;<i> 
</I>&gt;<i> example :
</I>&gt;<i> 
</I>&gt;<i>         delay_parameters 1 -1/-1 1280000/1280000 128000/128000
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> The speed is bytes / sec.
</I>&gt;<i> 
</I>&gt;<i> Is it possible to use multipliers like K and M ?
</I>&gt;<i> 
</I>
No.

&gt;<i> Is it possible to use units, like bps ( bit per sec ) ?
</I>&gt;<i> 
</I>
No.

&gt;<i> 
</I>&gt;<i> It is wonderfoul to read :
</I>&gt;<i> 
</I>&gt;<i>         delay_parameters 1 -1/-1 10Mbps/10Mbps 1Mbps/1Mbps
</I>&gt;<i> 
</I>
That does look nice. If only that had any relation to what the delay
pool values mean.


Taking the 10MB one for an example. Translating it to the units as
defined would be: 10Mbps/10Mb


BUT, that the &quot;bps&quot; part is *not* the speed limit the client will go. It
is the speed the client gains more traffic capacity.

The correct units to represent this as a speed in metric is:
   10MBpsps/10MBps

If one were to write 1Mbps/10Mb for example, that client would be able
to go up to 10Mbps. Quite non-intuitive to what you would expect a
number saying &quot;1Mbps&quot; would do.

However that is the burst limit, so on *average* you would see them
going 1Mbps. Emphasis on average. For every second they go under 1Mbps
they are permitted an equal amount *over* 1Mbps, with an peak (burst)
speed of 10Mbps.




&gt;<i> 
</I>&gt;<i> 2) network
</I>&gt;<i> 
</I>&gt;<i> We have about 50 subnets, on different locations.
</I>&gt;<i> 
</I>&gt;<i> It is a &quot;hub&quot; topology : all the subnets are linked via WANs to our 
</I>&gt;<i> central location, where there is the IT centre.
</I>&gt;<i> 
</I>&gt;<i> From the IT centre we have the links to Internet, and the proxy server 
</I>&gt;<i> running squid ( forwarding, IT manager decision ).
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Our internal IP addressing is 10.0.0.0/8
</I>&gt;<i> 
</I>&gt;<i> 10.1.0.0 for the first site, 10.2.0.0 the 2nd, etc ...
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Goals :
</I>&gt;<i> 
</I>&gt;<i>         overall proxy bandwidth limit : none
</I>&gt;<i>         each site limit : 10 Mbps
</I>&gt;<i>         each pc client limit : 1 Mbps
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> My work-around is this, using class 3 for /16 networks :
</I>&gt;<i> 
</I>&gt;<i>         delay_class 1 3
</I>&gt;<i>         delay_parameters 1 -1/-1 1280000/1280000 128000/128000
</I>&gt;<i> 
</I>&gt;<i> but it is a &quot;fuzzy&quot; fitting : each remote site is seen by squid as N 
</I>&gt;<i> smaller networks, so the overall site limit is N * 10 Mbps ...
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Is it possible to match my goals ?
</I>
Using a class 5 pool and an externl_acl_type helper to classify each
request as to what site it is coming from and assign a unique tag=site
to each request.

However, you might as well use the tag= site classification to determine
a tcp_outgoing_tos/mark value to send to the underlying system QoS
functionality.

Delay pools is 1980's technology (as you might see from the fact that a
/16 is considered big enough to represent an entire network, lol).
Modern QoS can do a lot of things far better than Squid delay pools. Not
least of which is to add in all the non-HTTP traffic that goes nowhere
near Squid to the sites traffic speed accounting.


&gt;<i> 
</I>&gt;<i> Or I request a new class, where we can specify the netmask.
</I>&gt;<i> 
</I>
If you wish to supply a patch it will be considered. However, be aware
that delay pools is a very ancient and broken feature. I am wanting to
deprecate and remove it as soon as people will stop using it.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008238.html">[squid-users] delay syntax, speed and network
</A></li>
	<LI>Next message (by thread): <A HREF="008249.html">[squid-users] help change cache dir
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8245">[ date ]</a>
              <a href="thread.html#8245">[ thread ]</a>
              <a href="subject.html#8245">[ subject ]</a>
              <a href="author.html#8245">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
