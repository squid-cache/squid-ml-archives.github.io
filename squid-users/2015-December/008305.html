<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Fw: Squid 32-bit (2.7.2) much faster than 64-bit (3.5.11)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Fw%3A%20Squid%2032-bit%20%282.7.2%29%20much%20faster%20than%2064-bit%0A%20%283.5.11%29&In-Reply-To=%3C566E4FF7.5050900%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008295.html">
   <LINK REL="Next"  HREF="008293.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Fw: Squid 32-bit (2.7.2) much faster than 64-bit (3.5.11)</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Fw%3A%20Squid%2032-bit%20%282.7.2%29%20much%20faster%20than%2064-bit%0A%20%283.5.11%29&In-Reply-To=%3C566E4FF7.5050900%40treenet.co.nz%3E"
       TITLE="[squid-users] Fw: Squid 32-bit (2.7.2) much faster than 64-bit (3.5.11)">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Dec 14 05:13:27 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008295.html">[squid-users] Fw: Squid 32-bit (2.7.2) much faster than 64-bit (3.5.11)
</A></li>
        <LI>Next message (by thread): <A HREF="008293.html">[squid-users] blocking certain file types by content
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8305">[ date ]</a>
              <a href="thread.html#8305">[ thread ]</a>
              <a href="subject.html#8305">[ subject ]</a>
              <a href="author.html#8305">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 14/12/2015 3:37 a.m., Patrick Flaherty wrote:
&gt;<i> Without 'dns_v4_first', what is sitting on top of the IPv6 connection
</I>&gt;<i> timeout?
</I>
The processing order is:
  Select set of potential servers to contact,
  DNS lookups [ both A and AAAA in parallel],
  IP sorting order [v6 first],
  TCP connect(2) [which times out],
  ... repeat until TCP succeeds or runs out of possible server IPs.
  do HTTP stuff...


&gt;<i> Is it a DNS lookup? Regardless of it being IPv6 timing out or IPv6
</I>&gt;<i> timing out falling back on IPv4 and having success of a long process to
</I>&gt;<i> maybe should be logged as a warning?
</I>&gt;<i> 
</I>&gt;<i> Second question, without 'dns_v4_first', was I experiencing a IPv6 timeout
</I>&gt;<i> and it falling back on IPv4? Because it does ultimately work... just slow.
</I>
Yes. All the evidence suggests that you are/were.

When IPv4 is tried first (dns_v4_first on), then IPv6 is rarely tried at
all. So rarely affects the connections even though v6 connectivity
remains broken for your network, and when clients *do* try to connect to
v6-only services they have the same breakage.

It is quite common to have no route to some networks, broken links,
broken tunnels, or devices which are v4-only somewhere along the
Internet paths. Those events are signalled with ICMP (v4 or v6) packets.
So ICMP is *not* optional.

It is great that you have working v4, and a temporary workaround in
Squid for reducing the impact of the v6 breakage. Now please try to fix
the v6. Because a) the workaround really is temporary - it will
gradually stop working as more and more services need v6-only access,
and b) it will be affecting a lot of other v6 traffic attempts outside
of Squid.


&gt;<i> 
</I>&gt;<i> Third question if the answer to question 2 is yes, should the DNS IPv4
</I>&gt;<i> lookup (successful) be cached so that next time it is fast?
</I>
DNS results are always cached. And before you get to it - yes the cache
is also updated with good/bad flags of which IPs are connecting
successfully and which are failing, in order to skip the fail ones on
later attempts.

I think DNS is a red-herring, those processes seem to be working just
fine. dns_v4_first just happens to be an option that makes the next
stages of Squid (after DNS) use IPv4 instead of IPv6, which reveals or
hides the network layer problems at the later TCP connect stage.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008295.html">[squid-users] Fw: Squid 32-bit (2.7.2) much faster than 64-bit (3.5.11)
</A></li>
	<LI>Next message (by thread): <A HREF="008293.html">[squid-users] blocking certain file types by content
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8305">[ date ]</a>
              <a href="thread.html#8305">[ thread ]</a>
              <a href="subject.html#8305">[ subject ]</a>
              <a href="author.html#8305">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
