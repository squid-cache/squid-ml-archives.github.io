<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] blocking certain file types by content
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20blocking%20certain%20file%20types%20by%20content&In-Reply-To=%3C566E5A3C.2070001%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008304.html">
   <LINK REL="Next"  HREF="008308.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] blocking certain file types by content</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20blocking%20certain%20file%20types%20by%20content&In-Reply-To=%3C566E5A3C.2070001%40treenet.co.nz%3E"
       TITLE="[squid-users] blocking certain file types by content">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Dec 14 05:57:16 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008304.html">[squid-users] blocking certain file types by content
</A></li>
        <LI>Next message (by thread): <A HREF="008308.html">[squid-users] blocking certain file types by content
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8306">[ date ]</a>
              <a href="thread.html#8306">[ thread ]</a>
              <a href="subject.html#8306">[ subject ]</a>
              <a href="author.html#8306">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 14/12/2015 10:39 a.m., Markus wrote:
&gt;<i> Yuri Voinov wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> Think more. ALL ICAP solutions checks content. Diladele is not only solution which checks content.
</I>&gt;<i> [...]
</I>&gt;<i> 
</I>&gt;&gt;<i> You really think executable files can have only known extension?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> My way of thinking was like that:
</I>&gt;<i> instead of testing with AV each .exe or .zip file better block it out
</I>&gt;<i> (except for whitelist domains). Because testing with AV needs CPU/RAM.
</I>&gt;<i> But as we already established - executables can be downloaded as JPG
</I>&gt;<i> /TXT or whatever. If so - AV makes only sense if we test every kind of
</I>&gt;<i> extensions/streams. Right?
</I>
Correct.

&gt;<i> 
</I>&gt;<i> let's consider such possible case:
</I>&gt;<i> 
</I>&gt;<i> here we have putty.exe (without virus ;-) , but saved as txt file:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://6web.pl/~mserafin/putty.txt">http://6web.pl/~mserafin/putty.txt</A>
</I>&gt;<i> 
</I>&gt;<i> now we can just download it and change extension for exe. My question is -
</I>&gt;<i> can ICAP-Clamav detect that it's windows executable and block it?
</I>&gt;<i> (even without testing against viruses)?
</I>

You are making the mistake of thinking of
&quot;<A HREF="http://6web.pl/~mserafin/putty.txt">http://6web.pl/~mserafin/putty.txt</A>&quot; as a file. There is no concept of
&quot;file&quot; in HTTP and thus also no &quot;file extension&quot;.
It might be one for this case, but while it is in HTTP it ceases acting
like one.

The reality is that &quot;<A HREF="http://6web.pl/~mserafin/putty.txt">http://6web.pl/~mserafin/putty.txt</A>&quot; is just a
resource locator;
 * It has no guaranteed relationship to the actual delivered content
type, and
 * there may be a file involved - or not, and
 * any file which is involved may exist at that location on the server -
or somewhere else (even another server), and
 * the response to that URL may be a singular object, multi-part
response with multiple objects, a 206 partial object or network
generated 3xx-5xx objects.


&gt;<i> 
</I>&gt;<i> and here more complicated case:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://6web.pl/~mserafin/putty_zip.txt">http://6web.pl/~mserafin/putty_zip.txt</A>   (it's a regular ZIP file with
</I>&gt;<i> putty.exe inside)
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Can ICAP-Clamav deal with it?
</I>
Good question. For the two simplistic cases you describe the answer is
probably yes - if we assume the responses are whole files.

Clamav insists on saving objects to disk to scan them fully, or at least
the initial bytes of the object. It is a little restricted in that way.

Other AV might do better with the more complicated HTTP response cases,
or they might not. I'm not familiar with how each works. I just know
that clamav is designed as a file-based scanner. Other AV have
designed-in ICAP services, so may work better (but costly).

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008304.html">[squid-users] blocking certain file types by content
</A></li>
	<LI>Next message (by thread): <A HREF="008308.html">[squid-users] blocking certain file types by content
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8306">[ date ]</a>
              <a href="thread.html#8306">[ thread ]</a>
              <a href="subject.html#8306">[ subject ]</a>
              <a href="author.html#8306">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
