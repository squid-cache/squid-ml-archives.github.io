<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] blocking certain file types by content
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20blocking%20certain%20file%20types%20by%20content&In-Reply-To=%3C566E898C.3080405%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008306.html">
   <LINK REL="Next"  HREF="008296.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] blocking certain file types by content</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20blocking%20certain%20file%20types%20by%20content&In-Reply-To=%3C566E898C.3080405%40gmail.com%3E"
       TITLE="[squid-users] blocking certain file types by content">yvoinov at gmail.com
       </A><BR>
    <I>Mon Dec 14 09:19:08 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008306.html">[squid-users] blocking certain file types by content
</A></li>
        <LI>Next message (by thread): <A HREF="008296.html">[squid-users] Direct Access without Proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8308">[ date ]</a>
              <a href="thread.html#8308">[ thread ]</a>
              <a href="subject.html#8308">[ subject ]</a>
              <a href="author.html#8308">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256
 


14.12.15 11:57, Amos Jeffries &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> On 14/12/2015 10:39 a.m., Markus wrote:
</I>&gt;&gt;<i> Yuri Voinov wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Think more. ALL ICAP solutions checks content. Diladele is not only
</I>solution which checks content.
&gt;&gt;<i> [...]
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> You really think executable files can have only known extension?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> My way of thinking was like that:
</I>&gt;&gt;<i> instead of testing with AV each .exe or .zip file better block it out
</I>&gt;&gt;<i> (except for whitelist domains). Because testing with AV needs CPU/RAM.
</I>&gt;&gt;<i> But as we already established - executables can be downloaded as JPG
</I>&gt;&gt;<i> /TXT or whatever. If so - AV makes only sense if we test every kind of
</I>&gt;&gt;<i> extensions/streams. Right?
</I>&gt;<i>
</I>&gt;<i> Correct.
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> let's consider such possible case:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> here we have putty.exe (without virus ;-) , but saved as txt file:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="http://6web.pl/~mserafin/putty.txt">http://6web.pl/~mserafin/putty.txt</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> now we can just download it and change extension for exe. My question
</I>is -
&gt;&gt;<i> can ICAP-Clamav detect that it's windows executable and block it?
</I>&gt;&gt;<i> (even without testing against viruses)?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> You are making the mistake of thinking of
</I>&gt;<i> &quot;<A HREF="http://6web.pl/~mserafin/putty.txt">http://6web.pl/~mserafin/putty.txt</A>&quot; as a file. There is no concept of
</I>&gt;<i> &quot;file&quot; in HTTP and thus also no &quot;file extension&quot;.
</I>&gt;<i> It might be one for this case, but while it is in HTTP it ceases acting
</I>&gt;<i> like one.
</I>&gt;<i>
</I>&gt;<i> The reality is that &quot;<A HREF="http://6web.pl/~mserafin/putty.txt">http://6web.pl/~mserafin/putty.txt</A>&quot; is just a
</I>&gt;<i> resource locator;
</I>&gt;<i>  * It has no guaranteed relationship to the actual delivered content
</I>&gt;<i> type, and
</I>&gt;<i>  * there may be a file involved - or not, and
</I>&gt;<i>  * any file which is involved may exist at that location on the server -
</I>&gt;<i> or somewhere else (even another server), and
</I>&gt;<i>  * the response to that URL may be a singular object, multi-part
</I>&gt;<i> response with multiple objects, a 206 partial object or network
</I>&gt;<i> generated 3xx-5xx objects.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> and here more complicated case:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="http://6web.pl/~mserafin/putty_zip.txt">http://6web.pl/~mserafin/putty_zip.txt</A>   (it's a regular ZIP file with
</I>&gt;&gt;<i> putty.exe inside)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Can ICAP-Clamav deal with it?
</I>&gt;<i>
</I>&gt;<i> Good question. For the two simplistic cases you describe the answer is
</I>&gt;<i> probably yes - if we assume the responses are whole files.
</I>&gt;<i>
</I>&gt;<i> Clamav insists on saving objects to disk to scan them fully, or at least
</I>&gt;<i> the initial bytes of the object. It is a little restricted in that way.
</I>&gt;<i>
</I>&gt;<i> Other AV might do better with the more complicated HTTP response cases,
</I>&gt;<i> or they might not. I'm not familiar with how each works. I just know
</I>&gt;<i> that clamav is designed as a file-based scanner. Other AV have
</I>No. Clamav use INSTREAM API for scanning. I-CAP based squidclamav
utilizes it for years.
&gt;<i>
</I>&gt;<i> designed-in ICAP services, so may work better (but costly).
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBCAAGBQJWbomMAAoJENNXIZxhPexGdEAH/ixLaaqMjogpgd0cnVqQELTs
GCQAbHKb0IEujv7ZNGRr00DeUiPMA7AlZ4FzC7G/MZmV8hI4RU7m6f3negJUpeIf
w20gcq6MCc1lorHB5emvaYw2RLbDAiiLdVzcNBDWbntqjRyd3FiOPcf+w27ch47R
8gaDIyViqs/ndJOp85AtjTMifWR7KCE61utKS4+VBO44KHdPbiZXa6PnzsLUdeYq
+iXrxWzjTduf8iq1QkL8z6Ms1Gk0ApwtSemJD8sJCR7drOfj5azepOFhQNIvwS1Z
YUMH/AyBpsPTpy+TG3vEJfloppztm6l1gT4nppFN4HaJHFmMXoj0Wn0MB5AYNeQ=
=AnSo
-----END PGP SIGNATURE-----


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008306.html">[squid-users] blocking certain file types by content
</A></li>
	<LI>Next message (by thread): <A HREF="008296.html">[squid-users] Direct Access without Proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8308">[ date ]</a>
              <a href="thread.html#8308">[ thread ]</a>
              <a href="subject.html#8308">[ subject ]</a>
              <a href="author.html#8308">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
