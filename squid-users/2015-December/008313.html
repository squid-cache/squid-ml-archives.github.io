<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Peek and splice without replacing the certificates
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Peek%20and%20splice%20without%20replacing%20the%20certificates&In-Reply-To=%3C566EF3BA.4030900%40urlfilterdb.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008311.html">
   <LINK REL="Next"  HREF="008316.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Peek and splice without replacing the certificates</H1>
    <B>Marcus Kool</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Peek%20and%20splice%20without%20replacing%20the%20certificates&In-Reply-To=%3C566EF3BA.4030900%40urlfilterdb.com%3E"
       TITLE="[squid-users] Peek and splice without replacing the certificates">marcus.kool at urlfilterdb.com
       </A><BR>
    <I>Mon Dec 14 16:52:10 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008311.html">[squid-users] Peek and splice without replacing the certificates
</A></li>
        <LI>Next message (by thread): <A HREF="008316.html">[squid-users] Peek and splice without replacing the certificates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8313">[ date ]</a>
              <a href="thread.html#8313">[ thread ]</a>
              <a href="subject.html#8313">[ subject ]</a>
              <a href="author.html#8313">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

On 12/14/2015 06:43 AM, &#1055;&#1072;&#1088;&#1092;&#1077;&#1085;&#1086;&#1074;&#1080;&#1095; &#1053;.&#1040;. wrote:
&gt;<i> Hello! Show you how to use Squid in transparent mode for tracking HTTPS without replacing the certificates?
</I>&gt;<i> My squid.conf: <A HREF="http://pastebin.ru/AWU8LXvK.">http://pastebin.ru/AWU8LXvK.</A> If such a configuration file
</I>&gt;<i> to use version 3.5.8 squid compiled using Libressl, everything works
</I>&gt;<i> fine. But if you use version 3.5.9 and above, Squid begins to &quot;terminated&quot; in
</I>&gt;<i> the number of clients above 20. Moreover, interrupted for no apparent reason and messages in the logs. Also tested versions&gt; = 4.0, the effect is the same - Squid &quot;terminated&quot;. How to overcome the problem? Correct any
</I>&gt;<i> configuration I have? Thank you in advance. PS .: Sorry for my english
</I>
Depending on how you define &quot;tracking&quot; ...

Your squid config has:

acl blocked ssl::server_name  &quot;/etc/squid/blocked_https.txt&quot;
acl step1 at_step SslBump1
ssl_bump peek step1
ssl_bump terminate blocked
ssl_bump splice all

So it seems that you want to peek and block a few sites based on the SNI and splice all other allowed sites.
When you splice, the TLS/SSL connection is untouched so the original certificates of the webservers are used.
I am not 100% sure, but it seems that to configure sslbump, one must define a fake CA certificate to tell Squid to do sslbumping.
But since you never bump (only terminate or splice) the fake CA certificate is never used.

To debug the sslbump feature you need to set
debug_options ALL,1 33,9 83,9
and carefully look at cache.log to see what is going wrong.

Marcus

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008311.html">[squid-users] Peek and splice without replacing the certificates
</A></li>
	<LI>Next message (by thread): <A HREF="008316.html">[squid-users] Peek and splice without replacing the certificates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8313">[ date ]</a>
              <a href="thread.html#8313">[ thread ]</a>
              <a href="subject.html#8313">[ subject ]</a>
              <a href="author.html#8313">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
