<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Time for cache synchronization between siblings
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Time%20for%20cache%20synchronization%20between%20siblings&In-Reply-To=%3C5670928C.8050805%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008340.html">
   <LINK REL="Next"  HREF="008369.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Time for cache synchronization between siblings</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Time%20for%20cache%20synchronization%20between%20siblings&In-Reply-To=%3C5670928C.8050805%40treenet.co.nz%3E"
       TITLE="[squid-users] Time for cache synchronization between siblings">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Dec 15 22:22:04 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008340.html">[squid-users] Time for cache synchronization between siblings
</A></li>
        <LI>Next message (by thread): <A HREF="008369.html">[squid-users] Time for cache synchronization between siblings
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8357">[ date ]</a>
              <a href="thread.html#8357">[ thread ]</a>
              <a href="subject.html#8357">[ subject ]</a>
              <a href="author.html#8357">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 16/12/2015 7:16 a.m., Sreenath BH wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I have a setup with three squid peers (siblings in squid.conf) and
</I>&gt;<i> three upstream servers(peers with parent and originserver in
</I>&gt;<i> squid.conf).
</I>&gt;<i> 
</I>&gt;<i> I am using htcp for the three squid siblings.
</I>&gt;<i> How much time does it take for one squid server to 'know' that another
</I>&gt;<i> peer has a particular object cached? I see digests exchanged between
</I>&gt;<i> the siblings, as logged in cache.log.
</I>
When both HTCP an dDgests are active between siblings the maximum time
is however long it takes for the HTCP packet to reach the sibling, be
parsed, looked up in the cache and response to get back.

Digests are used to short-circuit the ICP or HTCP process. If the digest
contains an entry for the URL the peer will be selected as a possible
destination server. Regardless of whether the object stored for that URL
is the same one the client is fetching.

Digests are updated every digest_rebuild_period (default 1 hr). You can
disable digests with either &quot;digest_generation off&quot; or per-peer with the
cache_peer no-digest option.


&gt;<i> 
</I>&gt;<i> I have been able to make a request to one sibling and it resulted in a
</I>&gt;<i> sibling_hit.
</I>&gt;<i> 
</I>&gt;<i> How I do this test is this:
</I>&gt;<i> 1. bring up all siblings
</I>&gt;<i> 2. issue a request to one server (sibling 1)
</I>&gt;<i> 3. Make sure it is cached in sibling 1
</I>&gt;<i> 4. Wait for some time (I don't know how long to wait)
</I>
Until the log of sibling1 contains a digest fetch from sibling2. A
restart of sibling2 will make that happen faster.

&gt;<i> 5. Make same request to another sibling, say sibling 2
</I>&gt;<i> 6. Check if it went to upstream server for the request or it was a sibling hit.
</I>&gt;<i> 
</I>&gt;<i> My problem is that the sibling hits seem to be random. I am  not able
</I>&gt;<i> to figure out exactly
</I>&gt;<i> how log it takes for the cache information to propagate to all siblings.
</I>
Digest is a old algorithm designed as an optimization of ICP, and
likewise is based on URL alone - which is great for HTTP/1.0 traffic. In
modern HTTP/1.1 traffic the Vary headers have a big part to play and
HTCP with full-header lookups works much better.

I suggest trying with only HTCP (digests disabled) and see if your
performance improves at all. YMMV though.

Be aware that there is no guarantee that any object is still in cache,
even with the more reliable HTCP on-demand lookups. Any object could be
dropped from sibling1 cache picoseconds after the &quot;i have it&quot; reply
started being formed for delivery to sibling2 (before it even hits the
wire on its way back).

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008340.html">[squid-users] Time for cache synchronization between siblings
</A></li>
	<LI>Next message (by thread): <A HREF="008369.html">[squid-users] Time for cache synchronization between siblings
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8357">[ date ]</a>
              <a href="thread.html#8357">[ thread ]</a>
              <a href="subject.html#8357">[ subject ]</a>
              <a href="author.html#8357">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
