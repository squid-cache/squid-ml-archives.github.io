<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid 3.5.12 and ecap
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%203.5.12%20and%20ecap&In-Reply-To=%3C1439477184.2010950.1450270031133.JavaMail.yahoo%40mail.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008361.html">
   <LINK REL="Next"  HREF="008338.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid 3.5.12 and ecap</H1>
    <B>behrad eslami</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%203.5.12%20and%20ecap&In-Reply-To=%3C1439477184.2010950.1450270031133.JavaMail.yahoo%40mail.yahoo.com%3E"
       TITLE="[squid-users] squid 3.5.12 and ecap">behrad_es at yahoo.com
       </A><BR>
    <I>Wed Dec 16 12:47:11 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008361.html">[squid-users] squid 3.5.12 and ecap
</A></li>
        <LI>Next message (by thread): <A HREF="008338.html">[squid-users] Installing Squid as a service on Oracle Linux 7.2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8366">[ date ]</a>
              <a href="thread.html#8366">[ thread ]</a>
              <a href="subject.html#8366">[ subject ]</a>
              <a href="author.html#8366">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi&#160;
thanks for you response. I compiled squid on debian jessie 


    On Wednesday, December 16, 2015 6:38 AM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:
 

 On 16/12/2015 12:53 a.m., behrad eslami wrote:
&gt;<i> Hi I add simple rule to ecap module and deny some url. I forground
</I>&gt;<i> (squid -N -d10) all things work well. when i run service wtih mutiple
</I>&gt;<i> workers, after a while some url not filter and user can open them in
</I>&gt;<i> browsers. I compile Squid 3.5.12 and libecpa 1.0.0. squid compiled
</I>&gt;<i> with below options:
</I>&gt;<i> '--build=x86_64-linux-gnu' '--prefix=/usr' '--includedir=${prefix}/include' '--mandir=${prefix}/share/man' '--infodir=${prefix}/share/info' '--sysconfdir=/etc' '--localstatedir=/var' '--libexecdir=${prefix}/lib/squid3' '--srcdir=.' '--disable-maintainer-mode' '--disable-dependency-tracking' '--disable-silent-rules' '--datadir=/usr/share/squid3' '--sysconfdir=/etc/squid3' '--mandir=/usr/share/man' '--enable-inline' '--disable-arch-native' '--enable-async-io=8' '--enable-storeio=aufs,rock' '--enable-removal-policies=lru,heap' '--enable-delay-pools' '--enable-cache-digests' '--enable-follow-x-forwarded-for' '--enable-eui' '--enable-icmp' '--enable-zph-qos' '--enable-ecap' '--disable-auto-locale' '--disable-translation' '--with-swapdir=/var/spool/squid3' '--with-logdir=/var/log/squid3' '--with-pidfile=/var/run/squid3.pid' '--with-filedescriptors=65536' '--with-large-files' '--with-default-user=proxy' '--enable-build-info= linux' '--enable-linux-netfilter' 'build_alias=x86_64-linux-gnu
</I>' 'CFLAGS=-g -O2 -fPIE -fstack-protector-strong -Wformat -Werror=format-security -Wall' 'LDFLAGS=-fPIE -pie -Wl,-z,relro -Wl,-z,now' 'CPPFLAGS=-D_FORTIFY_SOURCE=2' 'CXXFLAGS=-g -O2 -fPIE -fstack-protector-strong -Wformat -Werror=format-security' '--disable-ipv6' '--disable-wccp' '--disable-auth-basic' '--disable-auth-digest' '--disable-auth-negotiate' '--disable-auth-ntlm' '--disable-external-acl-helpers' '--disable-url-rewrite-helpers' '--disable-storeid-rewrite-helpers' '--without-mit-krb5' '--without-heimdal-krb5' '--without-gnugss' '--disable-unlinkd' '--disable-ident-lookups' '--disable-esi' '--disable-select' '--disable-poll' '--disable-kqueue' '--disable-devpoll' '--enable-epoll'
&gt;<i> 
</I>
This looks like Debian based build settings. With a bunch of extra
things disabled. What OS is this being used on?

NP: you can use --disable-auth to do all of the --disable-auth-*
settings in one simpler option.


&gt;<i> and my ecap config is:
</I>&gt;<i> icap_enable on
</I>&gt;<i> icap_send_client_ip on
</I>&gt;<i> icap_client_username_encode on
</I>
None of that is eCAP configuration. The 'i' (not 'e') at the start of
the directive names should give it away.

This is the eCAP part:

&gt;<i> loadable_modules /usr/local/lib/ecap_adapter_MY_processing.so
</I>&gt;<i> ecap_enable on
</I>&gt;<i> ecap_service ecapModifier respmod_precache \
</I>&gt;<i>&#160; &#160; &#160; uri=<A HREF="ecap://www.deltaglobal.net/adapter_My_processing&#160;">ecap://www.deltaglobal.net/adapter_My_processing&#160;</A> \
</I>&gt;<i>&#160; &#160; &#160; &#160; victim=sadeghsalehi\
</I>&gt;<i>&#160; &#160; &#160; &#160; replacement=***
</I>&gt;<i> adaptation_access ecapModifier allow all
</I>&gt;<i> loadable_modules /usr/local/lib/ecap_adapter_My_request.so
</I>&gt;<i> ecap_enable onecap_service eReqmod reqmod_precache bypass=1&#160; <A HREF="ecap://e-cap.org/ecap/services/My/request">ecap://e-cap.org/ecap/services/My/request</A>
</I>&gt;<i> adaptation_access&#160; eReqmod&#160; allow all
</I>
Looks correct, and should be working.

Notice that you have &quot;bypass=1&quot; configured, so any problem down to just
a long delay in processing time can cause the second eCAP module to be
bypassed and do nothing.

Your config looks fine. You will need to dig down into what the module
is actually doing and what it is having trouble with.

NP: -N is no just foreground, but also disables all multi-process
activity by the workers. Perhapse there is a problem with the ecap
module being either loaded and/or used by multiple processes simultaneously.

Amos

_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20151216/71f16ea1/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20151216/71f16ea1/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008361.html">[squid-users] squid 3.5.12 and ecap
</A></li>
	<LI>Next message (by thread): <A HREF="008338.html">[squid-users] Installing Squid as a service on Oracle Linux 7.2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8366">[ date ]</a>
              <a href="thread.html#8366">[ thread ]</a>
              <a href="subject.html#8366">[ subject ]</a>
              <a href="author.html#8366">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
