<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSTP_DUPLEX_POST method
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSTP_DUPLEX_POST%20method&In-Reply-To=%3C241CD68BD7EF6D4D8CE0A53F4166F57E3A7861CC%40exchange.jurox%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008326.html">
   <LINK REL="Next"  HREF="008388.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSTP_DUPLEX_POST method</H1>
    <B>Wayne Gillan</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSTP_DUPLEX_POST%20method&In-Reply-To=%3C241CD68BD7EF6D4D8CE0A53F4166F57E3A7861CC%40exchange.jurox%3E"
       TITLE="[squid-users] SSTP_DUPLEX_POST method">wayne.gillan at jurox.com.au
       </A><BR>
    <I>Thu Dec 17 03:57:25 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008326.html">[squid-users] SSTP_DUPLEX_POST method
</A></li>
        <LI>Next message (by thread): <A HREF="008388.html">[squid-users] SSTP_DUPLEX_POST method
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8377">[ date ]</a>
              <a href="thread.html#8377">[ thread ]</a>
              <a href="subject.html#8377">[ subject ]</a>
              <a href="author.html#8377">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Yes SSTP is a type of SSL VPN. Why behind a reverse proxy? Well just like other SSL services I need to share port 443 with one public IP address.

I've run packet captures on the client, vpn server and squid. The request is getting through ok and the vpn server is sending a reply. But squid is not forwarding the reply to the client I believe. Here's some snippets of the squid log:

2015/12/17 14:26:48.550| http.cc(762) processReplyHeader: HTTP Server REPLY:
---------
HTTP/1.1 200
Content-Length: 18446744073709551615
Server: Microsoft-HTTPAPI/2.0
Date: Thu, 17 Dec 2015 03:26:48 GMT
----------
2015/12/17 14:26:48.556| client_side.cc(1377) sendStartOfMessage: HTTP Client local=ip.of.squid:443 remote=1.2.3.4:44582 FD 9 flags=1
2015/12/17 14:26:48.556| client_side.cc(1378) sendStartOfMessage: HTTP Client REPLY:
---------
HTTP/1.1 200 OK
Content-Length: 18446744073709551615
Server: Microsoft-HTTPAPI/2.0
Date: Thu, 17 Dec 2015 03:26:48 GMT
X-Cache: MISS from 
X-Cache-Lookup: MISS from :443
Connection: keep-alive
----------
2015/12/17 14:26:48.557| client_side_reply.cc(1114) storeNotOKTransferDone: storeNotOKTransferDone  out.size=240 expectedLength=-9223372036854775569
2015/12/17 14:26:48.557| client_side.cc(1827) stopSending: sending error (local=ip.of.squid:443 remote=1.2.3.4:44582 FD 9 flags=1): STREAM_UNPLANNED_COMPLETE; old receiving error: none

2015/12/17 14:26:48.673| Server.cc(362) sentRequestBody: sentRequestBody called
2015/12/17 14:26:48.673| Server.cc(423) sendMoreRequestBody: will wait for more request body bytes or eof


Seems like the large value of the Content-Length header field is causing issues. Squid waits for more data but the server never sends it because it's waiting for something from the client. 

Is there any way to make squid just pass traffic exactly as it comes in?


-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Eliezer Croitoru
Sent: Tuesday, 15 December 2015 6:23 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] SSTP_DUPLEX_POST method

Isn't SSTP is some kind of secure VPN service? which is based on SSL?
Why would you want to put a reverse proxy in front of a VPN service? 
There are many things to do in the IP level but not much to do in the HTTP level.

Eliezer

On 15/12/2015 07:20, Wayne Gillan wrote:
&gt;<i> Hi all,
</I>&gt;<i>
</I>&gt;<i> I am trying to configure squid as a reverse proxy in front of a Microsoft SSTP VPN server but squid does not appear to be forwarding the requests. I think it may have something to do with this custom verb/method that Microsoft use. <A HREF="Seehttps://msdn.microsoft.com/en-us/library/cc247364.aspx.">Seehttps://msdn.microsoft.com/en-us/library/cc247364.aspx.</A> Should it work ok? I am running 3.1.19.
</I>&gt;<i>
</I>&gt;<i> Thank you,
</I>&gt;<i> Wayne
</I>
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>

______________________________________________________________________
This email has been scanned by the Symantec Email Security.cloud service.
For more information please visit <A HREF="http://www.symanteccloud.com">http://www.symanteccloud.com</A> ______________________________________________________________________

______________________________________________________________________
This email is confidential.  If you are not the intended recipient, you must not disclose  or  use the  information  contained in it.
If you have received this email in error,  please notify us immediately by return email and delete the email and any attachments.
Any personal views/ opinions expressed by the writer may not necessarily reflect the views/ opinions of the company.
______________________________________________________________________
This email has been scanned by the Symantec Email Security.cloud service.
For more information please visit <A HREF="http://www.symanteccloud.com">http://www.symanteccloud.com</A>
______________________________________________________________________
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008326.html">[squid-users] SSTP_DUPLEX_POST method
</A></li>
	<LI>Next message (by thread): <A HREF="008388.html">[squid-users] SSTP_DUPLEX_POST method
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8377">[ date ]</a>
              <a href="thread.html#8377">[ thread ]</a>
              <a href="subject.html#8377">[ subject ]</a>
              <a href="author.html#8377">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
