<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Fwd: Squid configuration advise
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Fwd%3A%20Squid%20configuration%20advise&In-Reply-To=%3CCAA-A7MqBmfW_veL0EpAS5EtioNygKfM8EY%3D4rwOnygnS4Q9%2Baw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008405.html">
   <LINK REL="Next"  HREF="008402.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Fwd: Squid configuration advise</H1>
    <B>Jean Christophe Ventura</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Fwd%3A%20Squid%20configuration%20advise&In-Reply-To=%3CCAA-A7MqBmfW_veL0EpAS5EtioNygKfM8EY%3D4rwOnygnS4Q9%2Baw%40mail.gmail.com%3E"
       TITLE="[squid-users] Fwd: Squid configuration advise">ventura.jeanchristophe at gmail.com
       </A><BR>
    <I>Sat Dec 19 20:32:11 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008405.html">[squid-users] Fwd: Squid configuration advise
</A></li>
        <LI>Next message (by thread): <A HREF="008402.html">[squid-users] Fwd: Squid configuration advise
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8407">[ date ]</a>
              <a href="thread.html#8407">[ thread ]</a>
              <a href="subject.html#8407">[ subject ]</a>
              <a href="author.html#8407">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ok thanks for your info

2015-12-19 21:02 GMT+01:00 Yuri Voinov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A>&gt;:

&gt;<i>
</I>&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i> Hash: SHA256
</I>&gt;<i>
</I>&gt;<i> My best result I can achieve this day with 3.5.12 is:
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://i.imgur.com/Lm6MkwH.png">http://i.imgur.com/Lm6MkwH.png</A>
</I>&gt;<i>
</I>&gt;<i> Maximum hit level is 50-55%. With VERY complex configuration.
</I>&gt;<i>
</I>&gt;<i> With old good 3.4.14 I achieved cache hit over 86%, but this is in the
</I>&gt;<i> past.
</I>&gt;<i>
</I>&gt;<i> 20.12.15 1:59, Jean Christophe Ventura &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;<i> &gt; Reading the mailing list i know that sslbump is the question to get a
</I>&gt;<i> more
</I>&gt;<i> &gt; usefull hit.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; But this proxy infrastructure isn't acting as my company proxy but isp
</I>&gt;<i> &gt; proxy for the company client and i cann't go to this way without some guy
</I>&gt;<i> &gt; like lawers/security guys :)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I know there is no magic button to get the full internet at home ;) but
</I>&gt;<i> at
</I>&gt;<i> &gt; least my job with this project constraint is to get the best i can :)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 2015-12-19 20:51 GMT+01:00 Yuri Voinov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A>&gt;
</I>&gt;<i> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A>&gt;:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt; I'm sorry that upset. :)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 20.12.15 0:56, Jean Christophe Ventura &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;<i> &gt; &gt;&gt;&gt; Hi,
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; I'm currently working to migrate RHEL5 2.7 Squid to RHEL7 3.3.
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; I have migrated the config files to be 3.3 compliant (CIDR, remove of
</I>&gt;<i> &gt; &gt;&gt;&gt; deprecated function,change cache from UFS to AUFS) without any change
</I>&gt;<i> &gt; &gt;&gt;&gt; (cache mem, policy, smp)
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; The new platform is a 4 node R610 (24 proc hyperthreading activate)
</I>&gt;<i> &gt; &gt;&gt;&gt; with 48GB of RAM, only 143GB disk in RAID for OS and cache. Each node
</I>&gt;<i> &gt; &gt;&gt;&gt; is connected to the network using 2x1Gbit bonding 2/3 level (some
</I>&gt;<i> &gt; &gt;&gt;&gt; network port are available on the server).
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; bandwidth allocated for Internet users 400Mbit
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; The difference between the old plateform and the new one doesn't seem
</I>&gt;<i> &gt; &gt;&gt;&gt; to be very fantastic :P
</I>&gt;<i> &gt; &gt;&gt;&gt; I have read the mailing list history alot.
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; Squid release:
</I>&gt;<i> &gt; &gt;&gt;&gt; So i know 3.3 isn't anymore maintain but this infrastructure will be
</I>&gt;<i> &gt; &gt;&gt;&gt; not maintain by myself and i don't think that people behind will do
</I>&gt;<i> &gt; &gt;&gt;&gt; the update them self
</I>&gt;<i> &gt; &gt;&gt;&gt; If a official repository exist, maybe this question will be reopen
</I>&gt;<i> &gt; &gt;&gt;&gt; (from what i have read it's more some of you build packages from
</I>&gt;<i> &gt; &gt;&gt;&gt; source and give them to people)
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; Squid auth:
</I>&gt;<i> &gt; &gt;&gt;&gt; It's transparent/basic auth only filtering some ip with acl.
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; Squid bandwidth:
</I>&gt;<i> &gt; &gt;&gt;&gt; Currently a squid node treat something like 30/50Mbit (information
</I>&gt;<i> &gt; &gt;&gt;&gt; recovered using iftop)
</I>&gt;<i> &gt; &gt;&gt;&gt; From previous viewed mail i think it's normal for a non-smp
</I>&gt;<i> configuration
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; Squid measure:
</I>&gt;<i> &gt; &gt;&gt;&gt; [<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at xxxx</A> ~]# squidclient mgr:5min | grep 'client_http.requests'
</I>&gt;<i> &gt; &gt;&gt;&gt; client_http.requests = 233.206612/sec
</I>&gt;<i> &gt; &gt;&gt;&gt; other info
</I>&gt;<i> &gt; &gt;&gt;&gt; Cache information for squid:
</I>&gt;<i> &gt; &gt;&gt;&gt;         Hits as % of all requests:      5min: 6.8%, 60min: 7.1%
</I>&gt;<i> &gt; &gt;&gt;&gt;         Hits as % of bytes sent:        5min: 4.7%, 60min: 4.4%
</I>&gt;<i> &gt; &gt;&gt;&gt;         Memory hits as % of hit requests:       5min: 21.4%, 60min:
</I>&gt;<i> 21.5%
</I>&gt;<i> &gt; &gt;&gt;&gt;         Disk hits as % of hit requests: 5min: 34.7%, 60min: 30.8%
</I>&gt;<i> &gt; &gt;&gt;&gt;         Storage Swap size:      9573016 KB
</I>&gt;<i> &gt; &gt;&gt;&gt;         Storage Swap capacity:  91.3% used,  8.7% free
</I>&gt;<i> &gt; &gt;&gt;&gt;         Storage Mem size:       519352 KB
</I>&gt;<i> &gt; &gt;&gt;&gt;         Storage Mem capacity:   99.1% used,  0.9% free
</I>&gt;<i> &gt; &gt;&gt;&gt;         Mean Object Size:       47.71 KB
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; Now question and advise :
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; This metrics seem too low for me. anyone of you agree ?
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; 4 node x 50Mbit node= 200Mbit
</I>&gt;<i> &gt; &gt;&gt;&gt; To treat the maxbandwidth (400Mbit) + the lost of one host i need to
</I>&gt;<i> &gt; &gt;&gt;&gt; configure 4 thread by node.
</I>&gt;<i> &gt; &gt;&gt;&gt; Is there any reason or brillant idea for more (i will have some core
</I>&gt;<i> &gt; &gt;&gt;&gt; still available) ? calculation too empirical ?
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; This url <A HREF="http://wiki.squid-cache.org/ConfigExamples/SmpCarpCluster">http://wiki.squid-cache.org/ConfigExamples/SmpCarpCluster</A>
</I>&gt;<i> &gt; &gt;&gt;&gt; seem to be a good start :P
</I>&gt;<i> &gt; &gt;&gt;&gt; Using this method i can interconnect each proxy to share their cache
</I>&gt;<i> &gt; &gt;&gt;&gt; (maybe using dedicated network port). Usefull or not ? may this
</I>&gt;<i> &gt; &gt;&gt;&gt; increase the hit ratio ? if this idea is'nt stupid interconnet using
</I>&gt;<i> &gt; &gt;&gt;&gt; the frontend only or directy to each ?
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; For now i have :
</I>&gt;<i> &gt; &gt;&gt;&gt; - 100GB of disk available for cache
</I>&gt;<i> &gt; &gt;&gt;&gt; - 40GB   of RAM (let 8 for OS + squid disk cache related ram usage)
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; 1 front with the RAM cache and 4 back with disk cache.
</I>&gt;<i> &gt; &gt;&gt;&gt; AUFS or ROCK cache? mix of them ? 50% each ? maybe another rules ?
</I>&gt;<i> &gt; &gt;&gt;&gt; (i think it's will be linked to the cache content but any advise or
</I>&gt;<i> &gt; &gt;&gt;&gt; method is welcome)
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; I can get more speed and/or space for disk cache using SAN, do you
</I>&gt;<i> &gt; &gt;&gt;&gt; know if the data is sequential or random ?
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; Any advise/rules to increase the hit ratio ? :)
</I>&gt;<i> &gt; &gt;&gt;&gt; Any general advise/rules ?
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; Thanks for your help
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; Jean Christophe VENTURA
</I>&gt;<i> &gt; &gt;&gt;&gt; _______________________________________________
</I>&gt;<i> &gt; &gt;&gt;&gt; squid-users mailing list
</I>&gt;<i> &gt; &gt;&gt;&gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt; &gt;&gt;&gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt; squid-users mailing list
</I>&gt;<i> &gt;&gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt;&gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -----BEGIN PGP SIGNATURE-----
</I>&gt;<i> Version: GnuPG v2
</I>&gt;<i>
</I>&gt;<i> iQEcBAEBCAAGBQJWdbe9AAoJENNXIZxhPexGnnMIAJCpFZJVppW4auNDES0Z1SOX
</I>&gt;<i> Essle25MJ1yKh3BkkkRhJa4pJjCa/9fYrnTwOTQ3IFDvuILbesjxxtIBkbBjEvzi
</I>&gt;<i> Ka5oHoKokN8/9kMwDjBUYUua8aHqDhPaQ197bD6HZTzX5nzq3DU3Wnoa8jkyLSX9
</I>&gt;<i> LJiNbdYhvbJN4CH3ui8Q0JOKlTbYM43Jc0mTfW/K3Rv2Yv68EzYTwx7OeniXyMNO
</I>&gt;<i> SitP72nntqntAOL48s9stG9vr3j0bPZRu/ejcW4LoTbj719nuhSYeB7a0mTgStZp
</I>&gt;<i> Y1Elcm61cTefFgG9Cvggnr8mkp1AionnZHffPmkaZDzuParz6UMsHcCKmZFH4BE=
</I>&gt;<i> =y1hW
</I>&gt;<i> -----END PGP SIGNATURE-----
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20151219/d4a2db4e/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20151219/d4a2db4e/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008405.html">[squid-users] Fwd: Squid configuration advise
</A></li>
	<LI>Next message (by thread): <A HREF="008402.html">[squid-users] Fwd: Squid configuration advise
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8407">[ date ]</a>
              <a href="thread.html#8407">[ thread ]</a>
              <a href="subject.html#8407">[ subject ]</a>
              <a href="author.html#8407">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
