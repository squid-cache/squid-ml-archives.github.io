<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Fwd: Squid authentication on the origin server during	SslBumping
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Fwd%3A%20Squid%20authentication%20on%20the%20origin%20server%20during%0A%09SslBumping&In-Reply-To=%3CCAODHJdwZ71CwEFCzv2M65mrdFjm4LjKPcJ7g4eEb75%2BGFWvRfw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008443.html">
   <LINK REL="Next"  HREF="008451.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Fwd: Squid authentication on the origin server during	SslBumping</H1>
    <B>Alexei Mayanov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Fwd%3A%20Squid%20authentication%20on%20the%20origin%20server%20during%0A%09SslBumping&In-Reply-To=%3CCAODHJdwZ71CwEFCzv2M65mrdFjm4LjKPcJ7g4eEb75%2BGFWvRfw%40mail.gmail.com%3E"
       TITLE="[squid-users] Fwd: Squid authentication on the origin server during	SslBumping">piphonom at gmail.com
       </A><BR>
    <I>Mon Dec 28 14:34:51 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008443.html">[squid-users] Squid 3.5.x Certificate validator + SslBump memory	leak
</A></li>
        <LI>Next message (by thread): <A HREF="008451.html">[squid-users] Fwd: Squid authentication on the origin server during SslBumping
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8446">[ date ]</a>
              <a href="thread.html#8446">[ thread ]</a>
              <a href="subject.html#8446">[ subject ]</a>
              <a href="author.html#8446">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello!
Sorry if my question is repeated, but I didn't find any answer.
We have the remote web server where only authenticated users have
access to it. Authentication is made by X509 certificates.
I want that  authentication to remote web server will be transparent
for our local network users. For this I'm trying to setup Squid in
transparent mode with SSL bumping.
Is it possible to setup Squid to authenticate himself on the remote
origin by X509 certificate?

I try to setup Squid 3.5.12 to make SSL bumping and authenticate
himself on the origin by the X509 certificate. But unsuccessfull.
There is part of my test config for ssl bumping:

#bumping
https_port 3131 intercept ssl-bump generate-host-certificates=on
dynamic_cert_mem_cache_size=4MB cert=/home/user/squiddata/myCA.pem
ssl_bump peek all
ssl_bump bump all
sslcrtd_program /usr/lib/squid/ssl_crtd -s /home/user/squiddata/ssl_db
-M 4MB
sslcrtd_children 5
sslproxy_client_certificate /home/user/squiddata/client.crt          #
certificate to authenticate server on the Origin. Is it right?
sslproxy_client_key /home/user/squiddata/.key
 # apropreate key
sslproxy_cafile /etc/ssl/certs/ca-certificates.crt
       # CAs bundle
acl SSLERR ssl_error X509_V_ERR_DEPTH_ZERO_SELF_SIGNED_CERT
X509_V_ERR_SELF_SIGNED_CERT_IN_CHAIN
sslproxy_cert_error allow SSLERR
sslproxy_cert_error deny all

But I get the following error:

Error negotiating SSL on FD 12: error:1407743E:SSL
routines:SSL23_GET_SERVER_HELLO:tlsv1 alert inappropriate fallback
(1/-1/0)
1450974176.611     45 192.168.1.114 TAG_NONE/200 0 CONNECT &lt;remote
ip&gt;:443 - ORIGINAL_DST/&lt;remote ip&gt; -
Error negotiating SSL connection on FD 10: error:140A1175:SSL
routines:SSL_BYTES_TO_CIPHER_LIST:inappropriate fallback (1/-1)

Seems remote server can't authenticate Squid.

SSL bumping with only remote server verification works well.

Thanks for advance.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008443.html">[squid-users] Squid 3.5.x Certificate validator + SslBump memory	leak
</A></li>
	<LI>Next message (by thread): <A HREF="008451.html">[squid-users] Fwd: Squid authentication on the origin server during SslBumping
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8446">[ date ]</a>
              <a href="thread.html#8446">[ thread ]</a>
              <a href="subject.html#8446">[ subject ]</a>
              <a href="author.html#8446">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
