<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] login expired
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20login%20expired&In-Reply-To=%3C54D5C95D.3050101%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001981.html">
   <LINK REL="Next"  HREF="002258.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] login expired</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20login%20expired&In-Reply-To=%3C54D5C95D.3050101%40treenet.co.nz%3E"
       TITLE="[squid-users] login expired">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Feb  7 08:14:21 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="001981.html">[squid-users] login expired
</A></li>
        <LI>Next message (by thread): <A HREF="002258.html">[squid-users] login expired
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1983">[ date ]</a>
              <a href="thread.html#1983">[ thread ]</a>
              <a href="subject.html#1983">[ subject ]</a>
              <a href="author.html#1983">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 7/02/2015 7:32 p.m., Ignazio Raia wrote:
&gt;<i> Good morning Amos,
</I>&gt;<i> here is my squid.conf, basic_db_auth script and the shell test. 
</I>&gt;<i> thanks a lot for your interesting and help.
</I>&gt;<i> 
</I>&gt;<i> TEST MADE FROM VIA ssh CONNECTION TO MY LAMP &amp; SQUID SERVER (ssh
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ignazio at 192.168.2.1</A>)
</I>&gt;<i> $ sudo /usr/lib/squid3/basic_db_auth --user root --password rootpasswd --md5
</I>&gt;<i> --cond &quot;1&quot; --persis
</I>
NP: missing 't' on --persist, but that seems not to matter for your perl
version.


&gt;<i> 
</I>&gt;<i> ignazio 12345678	(wrong password)
</I>&gt;<i> ERR login failure
</I>&gt;<i> 
</I>&gt;<i> ignazio mypassword	(right password)
</I>&gt;<i> OK
</I>&gt;<i> 
</I>&gt;<i> # MY SQUID.CONF
</I>&gt;<i> # OPTIONS FOR AUTHENTICATION
</I>&gt;<i> auth_param basic program /usr/lib/squid3/basic_db_auth --user root
</I>&gt;<i> --password rootpasswd -md5 --cond &quot;1&quot; --persis 
</I>
Missing '-' on --md5 could be the problem.

If it remains after fixing that '-', try running your manual test again
but this time after &quot;su squid&quot; or &quot;su proxy&quot;, whatever Squid is using.
The results may differ.

If that works, look around for things like SELinux or Apparmor
preventing the database connection being setup.


&gt;<i> #auth_param basic program /usr/lib/squid3/basic_ncsa_auth
</I>&gt;<i> /etc/squid3/squid.pass
</I>&gt;<i> 
</I>&gt;<i> auth_param basic children 5
</I>&gt;<i> auth_param basic realm Squid Proxy Web Server
</I>&gt;<i> auth_param basic credentialsttl 60 seconds
</I>&gt;<i> #authenticate_cache_garbage_interval 1 hour
</I>&gt;<i> #authenticate_ttl 60 seconds
</I>&gt;<i> 
</I>&gt;<i> # MY ACCESS CONTROLS
</I>&gt;<i> #
</I>&gt;<i> -----------------------------------------------------------------------------
</I>&gt;<i> acl localnet src 192.168.2.0/24 #my localnet
</I>&gt;<i> acl SSL_ports port 443
</I>&gt;<i> acl Safe_ports port 80 # http
</I>&gt;<i> acl Safe_ports port 21 # ftp
</I>&gt;<i> acl Safe_ports port 443 # https
</I>&gt;<i> acl Safe_ports port 70 # gopher 
</I>&gt;<i> acl Safe_ports port 210 # wais
</I>&gt;<i> acl Safe_ports port 1025-65535 # unregistered ports
</I>&gt;<i> acl Safe_ports port 280 # http-mgmt
</I>&gt;<i> acl Safe_ports port 488 # gss-http
</I>&gt;<i> acl Safe_ports port 591 # filemaker
</I>&gt;<i> acl Safe_ports port 777 # multiling http
</I>&gt;<i> acl CONNECT method CONNECT
</I>&gt;<i> acl password proxy_auth REQUIRED
</I>&gt;<i> 
</I>&gt;<i> #  TAG: MY http_access
</I>&gt;<i> http_access deny !password
</I>&gt;<i> http_access deny !Safe_ports
</I>
I would swap the order of those two. So if someone nasty starts
hammering way at port 25 for example, the auth helper wont get the load.

Maybe even moving the CONNECT !SSL_Ports above the auth check too, but
that depends on whether you really want your localhost manager to have
unrestricted CONNECT tunnel abilities.

&gt;<i> http_access allow localhost manager
</I>&gt;<i> http_access deny CONNECT !SSL_ports
</I>&gt;<i> http_access deny manager
</I>&gt;<i> http_access allow localnet
</I>&gt;<i> http_access allow localhost
</I>&gt;<i> http_access deny all
</I>&gt;<i> 
</I>
Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="001981.html">[squid-users] login expired
</A></li>
	<LI>Next message (by thread): <A HREF="002258.html">[squid-users] login expired
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1983">[ date ]</a>
              <a href="thread.html#1983">[ thread ]</a>
              <a href="subject.html#1983">[ subject ]</a>
              <a href="author.html#1983">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
