<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] 2.7.9 to 3.5 CentOS No-Cache
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%202.7.9%20to%203.5%20CentOS%20No-Cache&In-Reply-To=%3C54DD4FA6.3070600%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002167.html">
   <LINK REL="Next"  HREF="002184.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] 2.7.9 to 3.5 CentOS No-Cache</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%202.7.9%20to%203.5%20CentOS%20No-Cache&In-Reply-To=%3C54DD4FA6.3070600%40treenet.co.nz%3E"
       TITLE="[squid-users] 2.7.9 to 3.5 CentOS No-Cache">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Feb 13 01:13:10 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="002167.html">[squid-users] 2.7.9 to 3.5 CentOS No-Cache
</A></li>
        <LI>Next message (by thread): <A HREF="002184.html">[squid-users] requested url could not be retrieved/tweak the way it	resolves dns
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2169">[ date ]</a>
              <a href="thread.html#2169">[ thread ]</a>
              <a href="subject.html#2169">[ subject ]</a>
              <a href="author.html#2169">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 13/02/2015 1:24 p.m., Tory M Blue wrote:
&gt;<i> Greetings all, been a bit.
</I>&gt;<i> 
</I>&gt;<i> So I'm working on a new server config and loaded the latest 3.5 and have
</I>&gt;<i> tweaked my 2.7 configs a bit. Things are working but I've got one that I
</I>&gt;<i> can't figure out.
</I>&gt;<i> 
</I>&gt;<i> I have a test that insures that objects with an explicit &quot;
</I>&gt;<i> Cache-Control: no-cache&quot; header are NOT cached by Squid.
</I>
Your test is wrong. What the HTTP/1.1 specification says about no-cache
is that it has three forms of behaviour:

 1) when Cache-Control:no-cache is sent by a client it means do not
deliver cached contect in the response.

 2) when Cache-Control:no-cache is sent by the server it means the
content *can* be cached but must be revalidated before each use.
 - its effectively an alias for Cache-Control:must-revalidate

 3) when Cache-Control:no-cache=&quot;Hello&quot; is sent by the server it means
the header &quot;Hello: ...&quot; must not be delivered on HIT responses, if
possible a revalidation should take place.



PS. since you are testing HTTP behaviour you may also need to be aware
that authenticated and Cache-Control:private=&quot;Set-Cookie&quot; responses have
similar cacheability in HTTP/1.1.
 Responses with confidential data *can* be cached if it also contains
controls to ensure the origin server has explicit involvement in each
HIT determination.


&gt;<i> This is done by
</I>&gt;<i> keeping a special hit counter on the server and counting origin requests. A
</I>&gt;<i> unique URL is fetched exactly 10 times, and all of them are asserted to be
</I>&gt;<i> cache misses (both Squid headers must be MISS). At the end, the hit counter
</I>&gt;<i> is tested and made sure it equals the number of requests (10).&quot;
</I>&gt;<i> 
</I>&gt;<i> I'm getting a fail when testing against 3.5, meaning it's providing a cache
</I>&gt;<i> object
</I>&gt;<i> 
</I>&gt;<i> Miss with no-cache                  | FAIL    &lt;------
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Running test: Miss with no-cache...
</I>&gt;<i> Resetting hit counter...
</I>&gt;<i> Fetching URL:
</I>&gt;<i> <A HREF="http://10.13.5.222/admin/squid_test.php?action=reset_hit_count&amp;random=0.385536803712753">http://10.13.5.222/admin/squid_test.php?action=reset_hit_count&amp;random=0.385536803712753</A>
</I>&gt;<i> HTTP 200: 200 OK
</I>&gt;<i> X-Cache: MISS from dev-centOS
</I>&gt;<i> X-Cache-Lookup: MISS from dev-centOS:80
</I>&gt;<i> Fetching URL:
</I>&gt;<i> <A HREF="http://10.13.5.222/admin/squid_test.php?action=simple&amp;type=no_cache&amp;random=0.0843643311677589">http://10.13.5.222/admin/squid_test.php?action=simple&amp;type=no_cache&amp;random=0.0843643311677589</A>
</I>&gt;<i> HTTP 200: 200 OK
</I>&gt;<i> X-Cache: MISS from dev-centOS
</I>&gt;<i> X-Cache-Lookup: MISS from dev-centOS:80
</I>&gt;<i> Fetching URL:
</I>&gt;<i> <A HREF="http://10.13.5.222/admin/squid_test.php?action=simple&amp;type=no_cache&amp;random=0.0843643311677589">http://10.13.5.222/admin/squid_test.php?action=simple&amp;type=no_cache&amp;random=0.0843643311677589</A>
</I>&gt;<i> HTTP 200: 200 OK
</I>&gt;<i> X-Cache: MISS from dev-centOS
</I>&gt;<i> X-Cache-Lookup: HIT from dev-centOS:80 *&lt;&#8212;&#8212; Shows a hit (this should be 10
</I>&gt;<i> misses , a hit should never happen)*
</I>
... those headers lie sometimes with HTTP/1.1. That in particular is a
REFRESH (near-HIT), not a full HIT.

&gt;<i> 
</I>&gt;<i> *Test fails*
</I>&gt;<i> 
</I>

Your test should probably be passing anyway. The server should still be
counting the refresh queries and get to 10. Checking for the value of
the Squid headers is the problem.

A small update to your test so that the server sends back its counter in
a custom header for each response would be a better verification of
correctness and should pass.


&gt;<i> w/ 2.7.9 config
</I>&gt;<i> Miss with no-cache                  | Pass
</I>&gt;<i> 
</I>&gt;<i> Running test: Miss with no-cache...
</I>&gt;<i> Resetting hit counter...
</I>&gt;<i> Fetching URL:
</I>&gt;<i> <A HREF="http://devcache01.eng.admission.net/admin/squid_test.php?action=reset_hit_count&amp;random=0.671442807268036">http://devcache01.eng.admission.net/admin/squid_test.php?action=reset_hit_count&amp;random=0.671442807268036</A>
</I>&gt;<i> HTTP 200: 200 OK
</I>&gt;<i> X-Cache: MISS from dev-cache
</I>&gt;<i> X-Cache-Lookup: MISS from dev-cache:80
</I>&gt;<i> 
</I>&gt;<i> *I get 10 of the above responses (test passes).*
</I>&gt;<i> 
</I>&gt;<i> I'm wondering what I'm missing, 3.5 should be fully http 1.1 compliant
</I>&gt;<i> meaning that there should not be any squid directives guiding this (nor can
</I>&gt;<i> I find any). If the client sends a &quot;Cache-Control: no-cache&quot; it should be
</I>&gt;<i> honored natively ya?
</I>
It is HTTP/1.1 software and implements the Cache-Control:no-cache
feature closely according to RFC.


Squid-2.7 is HTTP/1.0 software which does not implement the HTTP/1.1
Cache-Control:no-cache feature (or many others either).

Instead it contains a custom hack that treats Cache-Control:no-cache as
if it were Cache-Control:no-store because that is the closest safe
mapping into HTTP/1.0 behaviour where revalidation does not exist.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="002167.html">[squid-users] 2.7.9 to 3.5 CentOS No-Cache
</A></li>
	<LI>Next message (by thread): <A HREF="002184.html">[squid-users] requested url could not be retrieved/tweak the way it	resolves dns
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2169">[ date ]</a>
              <a href="thread.html#2169">[ thread ]</a>
              <a href="subject.html#2169">[ subject ]</a>
              <a href="author.html#2169">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
