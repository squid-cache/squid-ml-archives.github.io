<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Add header to SSL requests to my own domain using my domains certs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Add%20header%20to%20SSL%20requests%20to%20my%20own%20domain%20using%0A%20my%20domains%20certs&In-Reply-To=%3CCA%2BNB0u-y1k7UVNr1TDqXv3ACrBqsjcoteuW_2%3Dw2%2BQRiaQFEFw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002229.html">
   <LINK REL="Next"  HREF="002272.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Add header to SSL requests to my own domain using my domains certs</H1>
    <B>James Beecham</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Add%20header%20to%20SSL%20requests%20to%20my%20own%20domain%20using%0A%20my%20domains%20certs&In-Reply-To=%3CCA%2BNB0u-y1k7UVNr1TDqXv3ACrBqsjcoteuW_2%3Dw2%2BQRiaQFEFw%40mail.gmail.com%3E"
       TITLE="[squid-users] Add header to SSL requests to my own domain using my domains certs">james.d.beecham at gmail.com
       </A><BR>
    <I>Mon Feb 16 02:38:49 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="002229.html">[squid-users] Add header to SSL requests to my own domain using my domains certs
</A></li>
        <LI>Next message (by thread): <A HREF="002272.html">[squid-users] Add header to SSL requests to my own domain using my domains certs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2230">[ date ]</a>
              <a href="thread.html#2230">[ thread ]</a>
              <a href="subject.html#2230">[ subject ]</a>
              <a href="author.html#2230">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Amos,

Thank you for your reply.

The information I need to apply to the header is client specific, ex their
internal ip address.

The issue I am facing is that the network that is hosting the web services
is different from the network that the clients are accessing it from. So my
Squid instances live at the client site and they access the web services
out of a data center.

I need to know the clients internal ip at the data center for a number of
reasons. Therefore if I am understanding your suggestion correctly the
reverse ssl proxy would not work as the squid reverse proxy needs to be on
the same internal network/vlan as the destination host to function?
<A HREF="http://wiki.squid-cache.org/ConfigExamples/Reverse/SslWithWildcardCertifiate">http://wiki.squid-cache.org/ConfigExamples/Reverse/SslWithWildcardCertifiate</A>

Essentially what I have is the clients internal ip at the client site,
which with HTTP only used to allow me the pack the internal ip into the
HTTP header via 'request_header_add'. Now, I still need to get the internal
ip into the HTTPS request so that the web services can operate as normal.
Whether the clients internal ip is in the header or apart of each request
(query param) doesnt really matter, just how can I get the internal ip to
the server without disrupting the normal browsing activity of our users?

Please let me know if I have misunderstood your suggestion about the
reverse proxy. FWIW we use nginx as a reverse proxy at the datacenter to
load balance and handle certain API endpoints.

Thanks,

James



On Sun, Feb 15, 2015 at 4:45 PM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:

&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i> Hash: SHA1
</I>&gt;<i>
</I>&gt;<i> On 16/02/2015 11:46 a.m., Yuri Voinov wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 16.02.15 4:40, James Beecham &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;<i> &gt;&gt; Hi Yuri,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; Thank you.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; Are these HTTPS CONNECT requests coming over port 80? If not
</I>&gt;<i> &gt;&gt; would I need
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; It depends. In different configurations uses different ports. In
</I>&gt;<i> &gt; transparent interception mode your absolutely need separate ports
</I>&gt;<i> &gt; for HTTP/HTTPS. In forwarding mode you cah use one port, but with
</I>&gt;<i> &gt; SSL parameters.
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> And James, since you are domain admin the question becomes why are you
</I>&gt;<i> not running a reverse-proxy &quot;https_port 443&quot; with your domain cert to
</I>&gt;<i> receive the HTTPS traffic and forward it to the origin servers?
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i> -----BEGIN PGP SIGNATURE-----
</I>&gt;<i> Version: GnuPG v2.0.22 (MingW32)
</I>&gt;<i>
</I>&gt;<i> iQEcBAEBAgAGBQJU4T2TAAoJELJo5wb/XPRjAmAIAK5HfCAwSMUCXIeFNIPzppBG
</I>&gt;<i> 24i0loL2Bhg9z/J9ec0iENOEO4XV0LPkNQT2UmyRxO4HZis5Su3Hc8R50tG6mrPf
</I>&gt;<i> EdU1H+nTUTygGQkm3nK7OmfdbSy/kV6aXmLM4pToYwwV3j15GDlW0wA0DN9JZhIG
</I>&gt;<i> WIBfwb+fCcjD5FJq9HWdGajeWgT9yuT54ufqrRJyjnq2LQMW8q7kbxrr6ue9eZxZ
</I>&gt;<i> 9Fsz1GnoneHO5nQ1BHbp/rTo+GCEfZLO+r87/6tCcYkYmtKsvP6kI7fCCSE1X0N6
</I>&gt;<i> bjUj1iya5Ec92PsPc2ubmemTBIL/P572nO15fKesxlSYWCsdkpsbA0bygiksbZI=
</I>&gt;<i> =ZEKG
</I>&gt;<i> -----END PGP SIGNATURE-----
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150215/889530b2/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150215/889530b2/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="002229.html">[squid-users] Add header to SSL requests to my own domain using my domains certs
</A></li>
	<LI>Next message (by thread): <A HREF="002272.html">[squid-users] Add header to SSL requests to my own domain using my domains certs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2230">[ date ]</a>
              <a href="thread.html#2230">[ thread ]</a>
              <a href="subject.html#2230">[ subject ]</a>
              <a href="author.html#2230">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
