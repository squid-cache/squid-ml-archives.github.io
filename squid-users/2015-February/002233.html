<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Error when using peek/splice/terminate with Squid	3.5.1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Error%20when%20using%20peek/splice/terminate%20with%20Squid%0A%093.5.1&In-Reply-To=%3CDBXPR04MB493572511458A97F114279B862E0%40DBXPR04MB493.eurprd04.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002231.html">
   <LINK REL="Next"  HREF="002273.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Error when using peek/splice/terminate with Squid	3.5.1</H1>
    <B>John Killimangalam Jacob</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Error%20when%20using%20peek/splice/terminate%20with%20Squid%0A%093.5.1&In-Reply-To=%3CDBXPR04MB493572511458A97F114279B862E0%40DBXPR04MB493.eurprd04.prod.outlook.com%3E"
       TITLE="[squid-users] Error when using peek/splice/terminate with Squid	3.5.1">jkillimangalam at in.rm.com
       </A><BR>
    <I>Mon Feb 16 05:54:36 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="002231.html">[squid-users] syslog using squid-3.4.8
</A></li>
        <LI>Next message (by thread): <A HREF="002273.html">[squid-users] Error when using peek/splice/terminate with Squid 3.5.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2233">[ date ]</a>
              <a href="thread.html#2233">[ thread ]</a>
              <a href="subject.html#2233">[ subject ]</a>
              <a href="author.html#2233">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi All,

I am trying to configure an intercept proxy with peek/splice/terminate features in Squid 3.5.1 on CentOS 7 - 64 bit. I wanted to peak at steps 1 and step 2 and to decide on terminate on step 3 based on the SNI and server certificate values. It is working only for <A HREF="https://www.google.com,">https://www.google.com,</A> but lot of other ssl sites (likes of <A HREF="https://www.yahoo.com">https://www.yahoo.com</A> etc) are not getting loaded logging an &quot; Error negotiating SSL on FD 36: error:140920E3:SSL routines:SSL3_GET_SERVER_HELLO:parse tlsext  &quot;  in the cache.log (trying the same sites using openssl s_client command works). I was wondering if it has to do anything with my config or open ssl (version 1.0.1e) or anything else. The web sites are being accessed from a windows 7 workstation with IE 8 and Firefox 35.0.1 . Below is the squid.config section for peek and splice I am using.

acl step1 at_step  SslBump1
acl step2 at_step  SslBump2
acl step3 at_step  SslBump3


external_acl_type SSL_URL_Filter %SRC %ssl::&gt;sni %ssl::&lt;cert_subject &lt;/path/to/urlfilterscript&gt;

acl URL_Allowed external SSL_URL_Filter


ssl_bump peek step1 all

ssl_bump peek step2 all

ssl_bump terminate step3 !URL_Allowed

ssl_bump splice step3 all

# Squid normally listens to port 3128
http_port 3128
http_port 3129 intercept
https_port 3130 intercept ssl-bump cert=/tmp/sslcertificates/server.cert.pem key=/tmp/sslcertificates/server.key.pem

Thanks in Advance,
John

Visit our Website at www.rmesi.co.in&lt;<A HREF="http://www.rmesi.co.in">http://www.rmesi.co.in</A>&gt;

This message is confidential and should not be copied or disclosed to anyone. If this email has come to you in error, please delete it, along with any attachments. Any views or opinions presented are only those of the author and not those of RMESI. RMESI accepts no liability for any loss or damage which may be caused by software viruses and it is your responsibility to ensure that this email and any attachments are free of viruses when you receive it. You may use and apply this email and the information contained in it for the intended purpose only and RMESI shall not be liable in any way in respect of use for any other purpose. In respect of all other matters, to the fullest extent permitted by applicable law, RMESI disclaims all responsibility and liability for the contents of this email (including any attachments). Please note that RMESI may intercept incoming and outgoing email communications.

RM Education Solutions India Pvt Ltd (CIN: U72200KL2003PTC015931) is a company registered in India with its registered office at B-5 Gayatri Building, Technopark Campus, Trivandrum, Kerala, 695 581.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150216/aa3ad62b/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150216/aa3ad62b/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="002231.html">[squid-users] syslog using squid-3.4.8
</A></li>
	<LI>Next message (by thread): <A HREF="002273.html">[squid-users] Error when using peek/splice/terminate with Squid 3.5.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2233">[ date ]</a>
              <a href="thread.html#2233">[ thread ]</a>
              <a href="subject.html#2233">[ subject ]</a>
              <a href="author.html#2233">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
