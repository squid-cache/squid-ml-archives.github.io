<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] OOKLA speedtest can't upload with squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20OOKLA%20speedtest%20can%27t%20upload%20with%20squid&In-Reply-To=%3CCAMXC%3DWtfPFjqMBnqwZSY5%2Bc9d-eK2_mvFcRUAveB%2BgG1z1-WMQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002278.html">
   <LINK REL="Next"  HREF="002286.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] OOKLA speedtest can't upload with squid</H1>
    <B>Alfredo Rezinovsky</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20OOKLA%20speedtest%20can%27t%20upload%20with%20squid&In-Reply-To=%3CCAMXC%3DWtfPFjqMBnqwZSY5%2Bc9d-eK2_mvFcRUAveB%2BgG1z1-WMQ%40mail.gmail.com%3E"
       TITLE="[squid-users] OOKLA speedtest can't upload with squid">alfrenovsky at gmail.com
       </A><BR>
    <I>Mon Feb 16 21:30:18 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="002278.html">[squid-users] reverse-proxy with client certificates pass-thru
</A></li>
        <LI>Next message (by thread): <A HREF="002286.html">[squid-users] OOKLA speedtest can't upload with squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2270">[ date ]</a>
              <a href="thread.html#2270">[ thread ]</a>
              <a href="subject.html#2270">[ subject ]</a>
              <a href="author.html#2270">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm using a custom compiled version
Squid Cache: Version 3.5.1-20150206-r13746
Service Name: squid
configure options:  '--disable-auth' '--disable-auto-locale'
'--disable-cache-digests' '--disable-cpu-profiling'
'--disable-debug-cbdata' '--disable-delay-pools' '--disable-devpoll'
'--disable-ecap' '--disable-esi' '--disable-eui'
'--disable-external-acl-helpers' '--disable-follow-x-forwarded-for'
'--disable-forw-via-db' '--enable-gnuregex' '--disable-htcp'
'--disable-icap-client' '--disable-ident-lookups' '--enable-internal-dns'
'--disable-ipf-transparent' '--disable-ipfw-transparent' '--disable-ipv6'
'--disable-leakfinder' '--disable-pf-transparent' '--disable-poll'
'--disable-select' '--disable-snmp' '--enable-ssl' '--disable-stacktraces'
'--disable-translation' '--disable-url-rewrite-helpers' '--disable-wccp'
'--disable-wccpv2' '--disable-win32-service' '--disable-x-accelerator-vary'
'--disable-icmp' '--disable-storeid-rewrite-helpers' '--enable-async-io'
'--enable-disk-io' '--enable-epoll' '--enable-http-violations'
'--enable-inline' '--enable-kill-parent-hack' '--enable-linux-netfilter'
'--enable-log-daemon-helpers' '--enable-removal-policies'
'--enable-storeio' '--enable-unlinkd' '--enable-x-accelerator-vary'
'--enable-zph-qos' '--with-default-user=nobody' '--with-pthreads'
'--with-included-ltdl' '--with-netfilter-conntrack' '--disable-arch-native'
--enable-ltdl-convenience

I tried to simplify my squid.conf to this:

http_port 3128 transparent
http_access allow all
strip_query_terms off
access_log stdio:/var/log/squid/access.log
cache deny all

And still can't do an upload test with ookla products.

When accessing <A HREF="http://www.speed.com.do">http://www.speed.com.do</A> I get this access.log

1424121146.052    358 10.55.127.10 TCP_MISS/304 251 GET
<A HREF="http://www.speed.com.do/">http://www.speed.com.do/</A> - ORIGINAL_DST/200.88.127.14 -
1424121149.705    190 10.55.127.10 TCP_MISS/200 3743 GET
<A HREF="http://www.speed.com.do/settings.xml?x=1424121149355">http://www.speed.com.do/settings.xml?x=1424121149355</A> - ORIGINAL_DST/
200.88.127.14 application/xml
1424121150.334    385 10.55.127.10 TCP_MISS/200 519 GET
<A HREF="http://api.ookla.com/ipaddress.php">http://api.ookla.com/ipaddress.php</A> - ORIGINAL_DST/72.21.92.82 text/html
1424121168.694    587 10.55.127.10 TCP_MISS/200 363 GET
<A HREF="http://www.speed.com.do/speedtest/latency.txt?x=1424121168097">http://www.speed.com.do/speedtest/latency.txt?x=1424121168097</A> -
ORIGINAL_DST/200.88.127.14 text/plain
1424121168.982    184 10.55.127.10 TCP_MISS/200 363 GET
<A HREF="http://www.speed.com.do/speedtest/latency.txt?x=1424121168744">http://www.speed.com.do/speedtest/latency.txt?x=1424121168744</A> -
ORIGINAL_DST/200.88.127.14 text/plain
1424121169.212    191 10.55.127.10 TCP_MISS/200 363 GET
<A HREF="http://www.speed.com.do/speedtest/latency.txt?x=1424121169010">http://www.speed.com.do/speedtest/latency.txt?x=1424121169010</A> -
ORIGINAL_DST/200.88.127.14 text/plain
1424121169.458    186 10.55.127.10 TCP_MISS/200 363 GET
<A HREF="http://www.speed.com.do/speedtest/latency.txt?x=1424121169260">http://www.speed.com.do/speedtest/latency.txt?x=1424121169260</A> -
ORIGINAL_DST/200.88.127.14 text/plain
1424121169.721    188 10.55.127.10 TCP_MISS/200 363 GET
<A HREF="http://www.speed.com.do/speedtest/latency.txt?x=1424121169526">http://www.speed.com.do/speedtest/latency.txt?x=1424121169526</A> -
ORIGINAL_DST/200.88.127.14 text/plain
1424121169.977    177 10.55.127.10 TCP_MISS/200 363 GET
<A HREF="http://www.speed.com.do/speedtest/latency.txt?x=1424121169793">http://www.speed.com.do/speedtest/latency.txt?x=1424121169793</A> -
ORIGINAL_DST/200.88.127.14 text/plain
1424121170.305    212 10.55.127.10 TCP_MISS/200 363 GET
<A HREF="http://www.speed.com.do/speedtest/latency.txt?x=1424121170011">http://www.speed.com.do/speedtest/latency.txt?x=1424121170011</A> -
ORIGINAL_DST/200.88.127.14 text/plain
1424121170.532    180 10.55.127.10 TCP_MISS/200 363 GET
<A HREF="http://www.speed.com.do/speedtest/latency.txt?x=1424121170344">http://www.speed.com.do/speedtest/latency.txt?x=1424121170344</A> -
ORIGINAL_DST/200.88.127.14 text/plain
1424121170.777    178 10.55.127.10 TCP_MISS/200 363 GET
<A HREF="http://www.speed.com.do/speedtest/latency.txt?x=1424121170593">http://www.speed.com.do/speedtest/latency.txt?x=1424121170593</A> -
ORIGINAL_DST/200.88.127.14 text/plain
1424121171.034    200 10.55.127.10 TCP_MISS/200 363 GET
<A HREF="http://www.speed.com.do/speedtest/latency.txt?x=1424121170826">http://www.speed.com.do/speedtest/latency.txt?x=1424121170826</A> -
ORIGINAL_DST/200.88.127.14 text/plain
1424121175.336   3733 10.55.127.10 TCP_MISS/200 1118375 GET
<A HREF="http://www.speed.com.do/speedtest/random750x750.jpg?x=1424121171593&amp;y=1">http://www.speed.com.do/speedtest/random750x750.jpg?x=1424121171593&amp;y=1</A> -
ORIGINAL_DST/200.88.127.14 image/jpeg
1424121177.454   5846 10.55.127.10 TCP_MISS/200 1118375 GET
<A HREF="http://www.speed.com.do/speedtest/random750x750.jpg?x=1424121171593&amp;y=2">http://www.speed.com.do/speedtest/random750x750.jpg?x=1424121171593&amp;y=2</A> -
ORIGINAL_DST/200.88.127.14 image/jpeg
1424121185.545   8021 10.55.127.10 TCP_MISS/200 1986647 GET
<A HREF="http://www.speed.com.do/speedtest/random1000x1000.jpg?x=1424121177504&amp;y=2">http://www.speed.com.do/speedtest/random1000x1000.jpg?x=1424121177504&amp;y=2</A> -
ORIGINAL_DST/200.88.127.14 image/jpeg
1424121188.656  11135 10.55.127.10 TCP_MISS/200 1986647 GET
<A HREF="http://www.speed.com.do/speedtest/random1000x1000.jpg?x=1424121177504&amp;y=1">http://www.speed.com.do/speedtest/random1000x1000.jpg?x=1424121177504&amp;y=1</A> -
ORIGINAL_DST/200.88.127.14 image/jpeg
1424121191.109    377 10.55.127.10 TCP_MISS/500 1564 POST
<A HREF="http://www.speed.com.do/speedtest/upload.asp?x=0.5987499579787254">http://www.speed.com.do/speedtest/upload.asp?x=0.5987499579787254</A> -
ORIGINAL_DST/200.88.127.14 text/html
1424121191.134    399 10.55.127.10 TCP_MISS/500 1557 POST
<A HREF="http://www.speed.com.do/speedtest/upload.asp?x=0.8488976825028658">http://www.speed.com.do/speedtest/upload.asp?x=0.8488976825028658</A> -
ORIGINAL_DST/200.88.127.14 text/html

If I do a traffic analisys in the internet traffic I can see the server
sends squid an Internal Server Error (500) at the middle of the POST
(BEFORE the POST is complete).

The error comes from the server. But this doesn't happens in squid 3.4 or
with a direct connection.

The POST content-length is 26761 So I don't think buffers may be a problem.

&#191;Any clue?

-- 
Alfrenovsky
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150216/0fc93356/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150216/0fc93356/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="002278.html">[squid-users] reverse-proxy with client certificates pass-thru
</A></li>
	<LI>Next message (by thread): <A HREF="002286.html">[squid-users] OOKLA speedtest can't upload with squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2270">[ date ]</a>
              <a href="thread.html#2270">[ thread ]</a>
              <a href="subject.html#2270">[ subject ]</a>
              <a href="author.html#2270">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
