<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Add header to SSL requests to my own domain using my domains certs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Add%20header%20to%20SSL%20requests%20to%20my%20own%20domain%20using%0A%20my%20domains%20certs&In-Reply-To=%3C54E268B1.9070203%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002230.html">
   <LINK REL="Next"  HREF="002231.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Add header to SSL requests to my own domain using my domains certs</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Add%20header%20to%20SSL%20requests%20to%20my%20own%20domain%20using%0A%20my%20domains%20certs&In-Reply-To=%3C54E268B1.9070203%40treenet.co.nz%3E"
       TITLE="[squid-users] Add header to SSL requests to my own domain using my domains certs">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Feb 16 22:01:21 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="002230.html">[squid-users] Add header to SSL requests to my own domain using my domains certs
</A></li>
        <LI>Next message (by thread): <A HREF="002231.html">[squid-users] syslog using squid-3.4.8
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2272">[ date ]</a>
              <a href="thread.html#2272">[ thread ]</a>
              <a href="subject.html#2272">[ subject ]</a>
              <a href="author.html#2272">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 16/02/2015 3:38 p.m., James Beecham wrote:
&gt;<i> Hi Amos,
</I>&gt;<i> 
</I>&gt;<i> Thank you for your reply.
</I>&gt;<i> 
</I>&gt;<i> The information I need to apply to the header is client specific,
</I>&gt;<i> ex their internal ip address.
</I>&gt;<i> 
</I>&gt;<i> The issue I am facing is that the network that is hosting the web
</I>&gt;<i> services is different from the network that the clients are
</I>&gt;<i> accessing it from. So my Squid instances live at the client site
</I>&gt;<i> and they access the web services out of a data center.
</I>&gt;<i> 
</I>&gt;<i> I need to know the clients internal ip at the data center for a
</I>&gt;<i> number of reasons. Therefore if I am understanding your suggestion
</I>&gt;<i> correctly the reverse ssl proxy would not work as the squid reverse
</I>&gt;<i> proxy needs to be on the same internal network/vlan as the
</I>&gt;<i> destination host to function? 
</I>&gt;<i> <A HREF="http://wiki.squid-cache.org/ConfigExamples/Reverse/SslWithWildcardCertifiate">http://wiki.squid-cache.org/ConfigExamples/Reverse/SslWithWildcardCertifiate</A>
</I>
No.
&gt;<i> 
</I>Reverse-proxy only needs is that the client looking up the domain
in DNS finds where it is and the cert it offers is valid for the domain.

The connection between the proxy and origin server is
explicitly/manually configured at the proxy so does not matter where
its going to.

Think of how the major CDN operators put their gateway proxies out
around the world in or near ISP networks then do something special
from that proxy to where the hosted site actually is.

&gt;<i> 
</I>&gt;<i> Essentially what I have is the clients internal ip at the client
</I>&gt;<i> site, which with HTTP only used to allow me the pack the internal
</I>&gt;<i> ip into the HTTP header via 'request_header_add'. Now, I still need
</I>&gt;<i> to get the internal ip into the HTTPS request so that the web
</I>&gt;<i> services can operate as normal. Whether the clients internal ip is
</I>&gt;<i> in the header or apart of each request (query param) doesnt really
</I>&gt;<i> matter, just how can I get the internal ip to the server without
</I>&gt;<i> disrupting the normal browsing activity of our users?
</I>

This is what the X-Forwarded-For/Forwarded HTTP headers are for.
Set &quot;forwarded_for on&quot; in squid.conf of the gateway proxy the clients
connect to, and the same or &quot;forwarded_for transparent&quot; on any
internal squid proxies it goes across within your network.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJU4miwAAoJELJo5wb/XPRjasUH/jf6ZHo75tqmKdW/gQcYtHKl
Et38pBbvXXIJ9/+DE/DvrW/t4LJU1tuxFk/uplwvORqOyZ2VNy/mxp1Omf3NMKoG
SfUo3LTOqlvIAtI1oHZYadS9qEsIDxSGDJ0HFeag7z9wj4acOeUnVSBLUueyV5TK
ouspgmpuS3GCCqMWjWsEkdUKqDXC+ThyUeF7w0ABfZIXoJPtC2Q++7UznQm840ad
lV4lLx/vxbXSEFlR+YEZXJwEBUwcKr9uUDVru7Rn4LfIZ9KRr6gVbzwzFMuilY0P
GmMJBYMDZZSezvtVA2vAR99KbDpUSC/8seGL2VrXZxNndh8eSmK5kprlUvwIC1w=
=Ra8E
-----END PGP SIGNATURE-----

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="002230.html">[squid-users] Add header to SSL requests to my own domain using my domains certs
</A></li>
	<LI>Next message (by thread): <A HREF="002231.html">[squid-users] syslog using squid-3.4.8
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2272">[ date ]</a>
              <a href="thread.html#2272">[ thread ]</a>
              <a href="subject.html#2272">[ subject ]</a>
              <a href="author.html#2272">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
