<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] reverse-proxy with client certificates pass-thru
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20reverse-proxy%20with%20client%20certificates%20pass-thru&In-Reply-To=%3C54E27073.8010301%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002244.html">
   <LINK REL="Next"  HREF="002278.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] reverse-proxy with client certificates pass-thru</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20reverse-proxy%20with%20client%20certificates%20pass-thru&In-Reply-To=%3C54E27073.8010301%40treenet.co.nz%3E"
       TITLE="[squid-users] reverse-proxy with client certificates pass-thru">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Feb 16 22:34:27 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="002244.html">[squid-users] reverse-proxy with client certificates pass-thru
</A></li>
        <LI>Next message (by thread): <A HREF="002278.html">[squid-users] reverse-proxy with client certificates pass-thru
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2274">[ date ]</a>
              <a href="thread.html#2274">[ thread ]</a>
              <a href="subject.html#2274">[ subject ]</a>
              <a href="author.html#2274">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 17/02/2015 3:16 a.m., Martin Fuchs wrote:
&gt;<i> Hi !
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> I'm looking for a possibility to tell squid to pass a certificate presented
</I>&gt;<i> by the client to a cache peer.
</I>&gt;<i> 
</I>&gt;<i> Since i did not find anything, i decided to ask here ;-)
</I>&gt;<i> 
</I>&gt;<i> I saw that it's possibe to let squid pass a client crtificate tot he cache
</I>&gt;<i> peer, but this would not work for out purposes.
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> It's an apple mobile device management system which needs to authenticate
</I>&gt;<i> the clients by their certificates.
</I>&gt;<i> 
</I>&gt;<i> Does anyone have apple remote profile-management running thru a
</I>&gt;<i> reverse-proxy with squid ?
</I>
Reverse proxy terminate the HTTPS connection. The client cert only
applies to validate the connection between client and Squid, and Squid
does not have the clients private key needed to encrypt traffic from
that client.

There is splice mode in 3.5. Which is to say &quot;dont bump that traffic&quot;.

The proper setup is for the proxy to have a cert representing itself
which it uses to validate the HTTPS with backend service. But I dont
know enough about the Apple system to say if that works like its
supposed to or if they are tying the cert to what data is accessible.


&gt;<i> 
</I>&gt;<i> This dirctive alone does not work:
</I>&gt;<i> 
</I>&gt;<i> cache_peer xx.xx.xx.xx parent 443 0 proxy-only no-query no-digest
</I>&gt;<i> originserver login=PASSTHRU ssl sslflags=DONT_VERIFY_PEER front-end-https=on
</I>&gt;<i> name=MDM_HOST_443
</I>

PS. DONT_VERIFY_PEER is evil. It basically tells Squid not to care what
the encryption is doing on the connection. You may as well be using
plain-text for all the security offers now.

The correct configuration is to have the remote peers CA (and CA chain)
configured as trusted for this peer. Adding that CA to the system
trusted CA set works but is risky, adding it just for those connections
with cache_peer sslcafile=/sslcapath= option is best.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="002244.html">[squid-users] reverse-proxy with client certificates pass-thru
</A></li>
	<LI>Next message (by thread): <A HREF="002278.html">[squid-users] reverse-proxy with client certificates pass-thru
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2274">[ date ]</a>
              <a href="thread.html#2274">[ thread ]</a>
              <a href="subject.html#2274">[ subject ]</a>
              <a href="author.html#2274">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
