<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] can squid handle indirect request from clients ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20can%20squid%20handle%20indirect%20request%20from%20clients%20%3F&In-Reply-To=%3C000001d04b1e%24eed171b0%24cc745510%24%40netstream.ps%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002284.html">
   <LINK REL="Next"  HREF="002305.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] can squid handle indirect request from clients ?</H1>
    <B>snakeeyes</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20can%20squid%20handle%20indirect%20request%20from%20clients%20%3F&In-Reply-To=%3C000001d04b1e%24eed171b0%24cc745510%24%40netstream.ps%3E"
       TITLE="[squid-users] can squid handle indirect request from clients ?">ahmed.zaeem at netstream.ps
       </A><BR>
    <I>Wed Feb 18 02:02:19 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="002284.html">[squid-users] can squid handle indirect request from clients ?
</A></li>
        <LI>Next message (by thread): <A HREF="002305.html">[squid-users] can squid handle indirect request from clients ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2300">[ date ]</a>
              <a href="thread.html#2300">[ thread ]</a>
              <a href="subject.html#2300">[ subject ]</a>
              <a href="author.html#2300">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Amos,

Lets forget the authentication now  I don&#8217;t need it now  I will use the ACL Rules on squid only

Wt I need to configure squid so that it handle requests from HAproxy ?


Note that I see traffic in tcpdump , but no log in access.log 

cheers

-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Amos Jeffries
Sent: Monday, February 16, 2015 5:24 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] can squid handle indirect request from clients ?

On 17/02/2015 11:21 p.m., snakeeyes wrote:
&gt;<i> Hi Guys,
</I>&gt;<i> 
</I>&gt;<i> I wanted to ask .
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> If I have as topology below :
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> Client====&gt;(HAPRoxy  or redirector )==&gt;squid with ACLs &amp; basic ncsa 
</I>&gt;<i> authentication
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> The client when it ask google.com
</I>&gt;<i> 
</I>&gt;<i> It will passs thorugh the HAproxy , and it will direct the request to 
</I>&gt;<i> the squid
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> Example =&gt;
</I>&gt;<i> 
</I>&gt;<i> Client go to google.com:80 , the HPA proxy will send it 
</I>&gt;<i> google.com:3128 to the ip of squid.
</I>&gt;<i> 
</I>
So google are hosting their public web services on port 3128 now? I very much doubt that.

Perhapse you are using HAproxy to receive remotely NAT'ed traffic because it does not complain like Squid?
 If so; the NAT lies are still there, just not being *mentioned* by the HAproxy receiver. Them Squid complaints are designed to protect the *entire Internet* (your LAN included) against NAT system misconfiguration problems.



&gt;<i> 
</I>&gt;<i> How let squid handle this task ???
</I>&gt;<i> 
</I>&gt;<i> I trid to to do natting any port 80 ==&gt;3128  , but it failed !!!
</I>&gt;<i> 
</I>
Yeah. Dont do that.

&gt;<i> Any suggestion ? or  even is it possible ?
</I>&gt;<i> 
</I>&gt;<i> Not I have ACLS and authentication @ squid , will it work ???
</I>&gt;<i> 
</I>
Chaining proxies is perfectly fine in HTTP. You just have to know how the HTTP auth framework operates.

 - WWW-Auth* headers are about user accessing the origin server resources.

 - Proxy-Auth* headers are about a client accessing a proxy.

The small difference in meaning between &quot;client&quot; (the initiating endpoint of a TCP connection) and &quot;user&quot; (the person using some device) matters a lot here.

So...

On the HAproxy-&gt;Squid connection, the client is *HAproxy*. Any Proxy-Auth credentials received are considered by Squid to belong to HAProxy itself. Where HAProxy gets them is its own business.

   But be clear, there is no &quot;user&quot; to Squid,
   just a client and that is _HAproxy_ in this setup.

So to perform auth in this setup all you need is to be able to configure HAProxy to send the right credentials on each request. Since HTTP has stateless auth they can be different client credentials representing some different &quot;user&quot; for each request if you want that.

Contact the HAProxy support for help on how to configure it to send credentials to Squid.


NP: if you have Squid-3.5 you can use the PROXY protocol between HAproxy and Squid to relay the end-client TCP connection details down the chain far better than X-Forwarded-For.

Amos
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="002284.html">[squid-users] can squid handle indirect request from clients ?
</A></li>
	<LI>Next message (by thread): <A HREF="002305.html">[squid-users] can squid handle indirect request from clients ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2300">[ date ]</a>
              <a href="thread.html#2300">[ thread ]</a>
              <a href="subject.html#2300">[ subject ]</a>
              <a href="author.html#2300">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
