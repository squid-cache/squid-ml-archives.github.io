<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] assertion failed: client_side.cc:1515:	&quot;connIsUsable(http-&gt;getConn())
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20assertion%20failed%3A%20client_side.cc%3A1515%3A%0A%09%22connIsUsable%28http-%3EgetConn%28%29%29&In-Reply-To=%3CCAN8nrKCq%2BZRQb6E178MsVfdqFrwfiAKiwY6XSJ9mo%3Dni2hbO5g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002118.html">
   <LINK REL="Next"  HREF="002344.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] assertion failed: client_side.cc:1515:	&quot;connIsUsable(http-&gt;getConn())</H1>
    <B>Dan Charlesworth</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20assertion%20failed%3A%20client_side.cc%3A1515%3A%0A%09%22connIsUsable%28http-%3EgetConn%28%29%29&In-Reply-To=%3CCAN8nrKCq%2BZRQb6E178MsVfdqFrwfiAKiwY6XSJ9mo%3Dni2hbO5g%40mail.gmail.com%3E"
       TITLE="[squid-users] assertion failed: client_side.cc:1515:	&quot;connIsUsable(http-&gt;getConn())">dan at getbusi.com
       </A><BR>
    <I>Fri Feb 20 03:34:48 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="002118.html">[squid-users] assertion failed: client_side.cc:1515:	&quot;connIsUsable(http-&gt;getConn())
</A></li>
        <LI>Next message (by thread): <A HREF="002344.html">[squid-users] assertion failed: client_side.cc:1515:	&quot;connIsUsable(http-&gt;getConn())
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2343">[ date ]</a>
              <a href="thread.html#2343">[ thread ]</a>
              <a href="subject.html#2343">[ subject ]</a>
              <a href="author.html#2343">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Installed v3.4.12 and almost went a whole day without this crash.
Ended up rearing its head during a spike in traffic after lunch. Seems
to be more prone to occurring when the HTTP requests per second
reaches about 100.

I have a script running that runs a squid reload whenever this crash
occurs and that seems to limit the impact (downtime) to a few
seconds&#8212;but occasionally Squid seems to get deadlocked by the crash
and needs to be killed (sometimes with -9) before it can be restarted.

In lieu of being able to diagnose and fix this, does anyone have any
other creative ideas as to limiting its impact?

Thanks
Dan


On 12 February 2015 at 09:51, Dan Charlesworth &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">dan at getbusi.com</A>&gt; wrote:
&gt;<i> Hey Eliezer
</I>&gt;<i>
</I>&gt;<i> With the response_size_100 ACL definition:
</I>&gt;<i> - 100 tells the external ACL the limit in MB
</I>&gt;<i> - 192.168.0.10 tells the external ACL the squid IP
</I>&gt;<i>
</I>&gt;<i> I think one or both of these is only needed to build the deny page. You can&#8217;t use deny_info with reply_body_max_size so we had to customise the ERR_TOO_BIG source to do a redirect to our own page.
</I>&gt;<i>
</I>&gt;<i> The http_access allow line is because result caching cannot alter the EXT_LOG for fast ACLs as cache lookups include the EXT_LOG, so we need to check the result twice to alter the EXT_LOG and then have the result cached against the altered EXT_LOG.
</I>&gt;<i>
</I>&gt;<i> Cheers
</I>&gt;<i> Dan
</I>&gt;<i>
</I>&gt;&gt;<i> On 11 Feb 2015, at 11:09 pm, Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hey Dan,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> First I must admit that this squid.conf is quite complicated but kind of self explanatory.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have tried to understand the next lines:
</I>&gt;&gt;<i> # File size (download) restrictions
</I>&gt;&gt;<i> acl response_size_100 external response_size_type 100 192.168.0.10
</I>&gt;&gt;<i> http_access allow response_size_100 response_size_100
</I>&gt;&gt;<i> reply_body_max_size 100 MB response_size_100
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> But I am unsure how it works with external_acl exactly.
</I>&gt;&gt;<i> If you wish to deny 100MB size files you should have only one rule for the reply body max size, what are the others for exactly?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Eliezer
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * I might missing some concepts some sorry in advance.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 11/02/2015 00:30, Dan Charlesworth wrote:
</I>&gt;&gt;&gt;<i> Hi Eliezer
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Took a while to get this up&#8212;sorry about that. Here&#8217;s an example of a production config of ours (with some confidential stuff necessarily taken out/edited):
</I>&gt;&gt;&gt;<i> <A HREF="https://gist.github.com/djch/92cf44440b04afbd7917">https://gist.github.com/djch/92cf44440b04afbd7917</A>  &lt;<A HREF="https://gist.github.com/djch/92cf44440b04afbd7917">https://gist.github.com/djch/92cf44440b04afbd7917</A>&gt;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Let me know if there&#8217;s any other info I can provide that might point towards the cause of this crash.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> And thanks again for taking a look.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="002118.html">[squid-users] assertion failed: client_side.cc:1515:	&quot;connIsUsable(http-&gt;getConn())
</A></li>
	<LI>Next message (by thread): <A HREF="002344.html">[squid-users] assertion failed: client_side.cc:1515:	&quot;connIsUsable(http-&gt;getConn())
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2343">[ date ]</a>
              <a href="thread.html#2343">[ thread ]</a>
              <a href="subject.html#2343">[ subject ]</a>
              <a href="author.html#2343">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
