<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] &quot;Valid document was not found in the cache&quot; forwarded to clients
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%22Valid%20document%20was%20not%20found%20in%20the%20cache%22%0A%20forwarded%20to%20clients&In-Reply-To=%3C54E728A6.4010606%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002357.html">
   <LINK REL="Next"  HREF="002366.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] &quot;Valid document was not found in the cache&quot; forwarded to clients</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%22Valid%20document%20was%20not%20found%20in%20the%20cache%22%0A%20forwarded%20to%20clients&In-Reply-To=%3C54E728A6.4010606%40treenet.co.nz%3E"
       TITLE="[squid-users] &quot;Valid document was not found in the cache&quot; forwarded to clients">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Feb 20 12:29:26 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="002357.html">[squid-users] &quot;Valid document was not found in the cache&quot; forwarded	to clients
</A></li>
        <LI>Next message (by thread): <A HREF="002366.html">[squid-users] &quot;Valid document was not found in the cache&quot; forwarded to clients
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2365">[ date ]</a>
              <a href="thread.html#2365">[ thread ]</a>
              <a href="subject.html#2365">[ subject ]</a>
              <a href="author.html#2365">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 20/02/2015 10:55 p.m., Corentin Delcourt wrote:
&gt;<i> Hello list.
</I>&gt;<i> 
</I>&gt;<i> I described this issue a few days ago on IRC and no-one could help me,
</I>&gt;<i> so I am now turning to you. Here's my problem:
</I>&gt;<i> 
</I>&gt;<i> I run two squid servers, siblings with each other, let's call them A and
</I>&gt;<i> B. When clients send requests to A, and A thinks B has the resource
</I>&gt;<i> cached, but in reality B doesn't,
</I>
Use HTCP protocol between the peers, far less false positives than ICP
or digest.


&gt;<i> the client will get a 504 error with
</I>&gt;<i> the message: &#8220;Valid document was not found in the cache and
</I>&gt;<i> &#8216;only-if-cached&#8217; directive was specified.&#8221; Vice versa if clients send
</I>&gt;<i> requests to B.
</I>&gt;<i> 
</I>&gt;<i> I believe that A should catch this error and fetch the resource
</I>&gt;<i> directly, but instead it forwards it to the client, and I cannot figure
</I>&gt;<i> out why. I am not using allow-miss.
</I>
It should be but there are conditions to that:

* another source of the URL is actually accessible (think IPv6-only
websites, routing outages, DNS lookup failures, Path-MTU failures,
traffic blackholes, etc)

* there is time remaining within the forward_timeout for the alterative
route to be contacted. If the timeout occurs the last error state
encountered will be reported, if there is no earlier error the timeout
itself is mentioned.

* the 504 is not being cached. That error response is one which is
allowed to be cached by proxies if it gets delivered with cacheability
headers. NP: It could be cached and delivered by either proxy, so even
coming from the other one *it* may still have been cached and what
caused the &quot;HIT&quot; to be identified.


&gt;<i> 
</I>&gt;<i> What confuses me even more is that this didn't happen a month ago, with
</I>&gt;<i> the same setup.
</I>&gt;<i> 
</I>
... what version of Squid?
... and is it the same setup AND version(s) of Squid from a month ago?


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="002357.html">[squid-users] &quot;Valid document was not found in the cache&quot; forwarded	to clients
</A></li>
	<LI>Next message (by thread): <A HREF="002366.html">[squid-users] &quot;Valid document was not found in the cache&quot; forwarded to clients
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2365">[ date ]</a>
              <a href="thread.html#2365">[ thread ]</a>
              <a href="subject.html#2365">[ subject ]</a>
              <a href="author.html#2365">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
