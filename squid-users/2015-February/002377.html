<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] One Squid proxy for multi-tenant environment
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20One%20Squid%20proxy%20for%20multi-tenant%20environment&In-Reply-To=%3C54E7C98C.4050305%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002372.html">
   <LINK REL="Next"  HREF="002383.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] One Squid proxy for multi-tenant environment</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20One%20Squid%20proxy%20for%20multi-tenant%20environment&In-Reply-To=%3C54E7C98C.4050305%40treenet.co.nz%3E"
       TITLE="[squid-users] One Squid proxy for multi-tenant environment">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Feb 20 23:55:56 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="002372.html">[squid-users] One Squid proxy for multi-tenant environment
</A></li>
        <LI>Next message (by thread): <A HREF="002383.html">[squid-users] One Squid proxy for multi-tenant environment
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2377">[ date ]</a>
              <a href="thread.html#2377">[ thread ]</a>
              <a href="subject.html#2377">[ subject ]</a>
              <a href="author.html#2377">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 21/02/2015 4:57 a.m., maxt wrote:
&gt;<i> I'm just wondering if it is possible to do the following:
</I>&gt;<i> 
</I>&gt;<i> Have one Squid proxy that covers multiple domains/tenants.  Each tenant
</I>&gt;<i> would have their own specific whitelist and blacklist of sites.  Each tenant
</I>&gt;<i> would have their own customized/branded block page that would have
</I>&gt;<i> instructions for requesting a site be whitelisted.
</I>
Sort of. We are partway there with SMP support. There are two easy-ish
ways it can be done:


1) 3.2+ SMP worker per tenant.

NP: There is still crossover with things like shared memory (if you
choose to leabve it enabled) and cachemgr reports.


Add this line to squid.conf between the &quot;http_access CONNECT !SSL_ports&quot;
and &quot;http_access deny all&quot; lines:

 include /etc/squid/client-${processs_number}.conf


All the client-specific configuration then goes in the numbered
client-N.conf files. You may need to shuffle things like the default
refresh_patterns around so they are below the include (so not overriding
the client settings).

There is still some crossover with settings that can only be set once
per proxy instance (PID file etc). Those need to be set in the main
squid.conf, which you can also use to set local network defaults
different from the hard coded ones, or override some client abilities.


2) 3.5+ named service per tenant

This is not really single-proxy but allows you to run separate
instances/services per-tenant from one installed Squid. It does not have
any of the crossover issues the above (which may be either Pro or Con
for your needs).

 In squid.conf put this:

   include /etc/squid/client-${service_name}.conf

Service name much only be alphanumeric characters.

Same caveats apply about shuffling things around within squid.conf so
they dont collide with the per-client settings.

 Run Squid using:

   squid -n &lt;some_name&gt; ...

Note that is a lower case 'n', upper case is very different.


HTH
Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="002372.html">[squid-users] One Squid proxy for multi-tenant environment
</A></li>
	<LI>Next message (by thread): <A HREF="002383.html">[squid-users] One Squid proxy for multi-tenant environment
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2377">[ date ]</a>
              <a href="thread.html#2377">[ thread ]</a>
              <a href="subject.html#2377">[ subject ]</a>
              <a href="author.html#2377">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
