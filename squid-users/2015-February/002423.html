<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Need better debug_options values to track down cache MISSes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Need%20better%20debug_options%20values%20to%20track%20down%0A%20cache%20MISSes&In-Reply-To=%3C54EC9675.3020908%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002422.html">
   <LINK REL="Next"  HREF="002425.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Need better debug_options values to track down cache MISSes</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Need%20better%20debug_options%20values%20to%20track%20down%0A%20cache%20MISSes&In-Reply-To=%3C54EC9675.3020908%40gmail.com%3E"
       TITLE="[squid-users] Need better debug_options values to track down cache MISSes">yvoinov at gmail.com
       </A><BR>
    <I>Tue Feb 24 15:19:17 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="002422.html">[squid-users] Need better debug_options values to track down	cache MISSes
</A></li>
        <LI>Next message (by thread): <A HREF="002425.html">[squid-users] Need better debug_options values to track down cache MISSes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2423">[ date ]</a>
              <a href="thread.html#2423">[ thread ]</a>
              <a href="subject.html#2423">[ subject ]</a>
              <a href="author.html#2423">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1


24.02.15 21:14, Greg &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> Hi all,
</I>&gt;<i> 
</I>&gt;<i> so, there's my proxy problem I couldn't crack, even after spending
</I>&gt;<i> 2+ days tweaking-googling-debugging. :(
</I>&gt;<i> 
</I>&gt;<i> The problem: my _new_ Squid installation (Ubuntu 14 LTS with Squid
</I>&gt;<i> 3.3.8) won't cache most pages the old Squid does (old Fedora with
</I>&gt;<i> Squid 3.1.15).
</I>
Both versions are antique.

Man, you change one rancid meat to another rancid meat.

Just FYI - current Squid version at least 3.4.12. Oh, this branch is
already deprecated... shit, current version is 3.5.2!

This must be your starting point.
&gt;<i> 
</I>&gt;<i> Infos: - Simple reverse proxy, port 80 only, one uplink straight to
</I>&gt;<i> the app servers. (The old one points to a load balancer. For
</I>&gt;<i> testing purposes and seeing the mail on &quot;Thu, 4 Apr 2013 16:54:10
</I>&gt;<i> -0700&quot;, I'm pointing the new one to a specific app server.) -
</I>&gt;<i> Pretty standard configuration, standard refresh_patterns. (I'd be 
</I>&gt;<i> surprised if it was a config problem since ICOs are cached well.) -
</I>&gt;<i> I have disk caching on the new one, the disk cache has been
</I>&gt;<i> initialised with -z. - The old one has a very relaxed iptables, the
</I>&gt;<i> new one has ufw, later set to allow port 80 and 22 only for
</I>&gt;<i> incoming connections. - Clocks are in sync using ntpd - the old one
</I>&gt;<i> has +20min delay (ie. shows a later time than now). Since it's the
</I>&gt;<i> live one, it's working and it handles a lot of load well, I haven't
</I>&gt;<i> dared to correct it. - The new Squid gives HITs for favicon.ico and
</I>&gt;<i> RSS feeds only - these have different headers and mimetypes
</I>&gt;<i> compared to HTML files (and that's by design). - This new server
</I>&gt;<i> seems to save accessed HTML files in the disk cache but still gives
</I>&gt;<i> X-Cache-Lookup:MISS for all of them later. - I debugged using
</I>&gt;<i> debug_options and logging: headers look okay (Cache-Control,
</I>&gt;<i> Pragma, Vary - pasted below), stale/fresh calculation looks okay
</I>&gt;<i> (pages are deemed fresh). - The best I got so far is this:
</I>&gt;<i> &quot;client_side_reply.cc(1618) identifyFoundObject:
</I>&gt;<i> clientProcessRequest2: StoreEntry is NULL -  MISS&quot;, even for pages
</I>&gt;<i> I see in the disk cache. - I don't want to use overriding in
</I>&gt;<i> refresh_patterns, because I don't understand the problem yet, I
</I>&gt;<i> don't know what problem would this hack hide (and for how long). -
</I>&gt;<i> I don't want to move away from the current platform and version if 
</I>&gt;<i> possible because this has LTS support and we'll have many proxy
</I>&gt;<i> servers if we finally figure out the right config. - Strange thing,
</I>&gt;<i> the old proxy seems to return stuff with HTTP/1.0 and the new one
</I>&gt;<i> with HTTP/1.1 in the same browser. No idea why.
</I>&gt;<i> 
</I>&gt;<i> What I've tried: - Compared my squid.conf files - nothing special. 
</I>&gt;<i> - Googling and mailing list archives - only found common MISS
</I>&gt;<i> problems that don't apply to my case. - Have even experimented
</I>&gt;<i> removing max-age from the headers sent by the server and only
</I>&gt;<i> featuring public, also set Last-Modified 10 minutes in the past -
</I>&gt;<i> no change. - I've only moved one low-traffic live site to the new
</I>&gt;<i> proxy so I can test the old one and the new with the same app
</I>&gt;<i> server engine. - I know of Vary:Accept-Encoding issues with
</I>&gt;<i> testing, so I test in the same browser, clearing the cache before
</I>&gt;<i> the second page access. With this, I see HITs on the old server and
</I>&gt;<i> MISS for the new. - Heavy logging and debugging, checking out HTTP
</I>&gt;<i> headers too - seems okay. The same HTTP headers yield in HITs on
</I>&gt;<i> the old server and MISS on the new one.
</I>&gt;<i> 
</I>&gt;<i> I've collected some resources: - Old server squid.conf -
</I>&gt;<i> <A HREF="http://pastebin.com/h0C7t96n">http://pastebin.com/h0C7t96n</A> - New server squid.conf -
</I>&gt;<i> <A HREF="http://pastebin.com/KaHDVWYt">http://pastebin.com/KaHDVWYt</A> - Examples that gets cached on both
</I>&gt;<i> servers - <A HREF="http://pastebin.com/Be4RqVLq">http://pastebin.com/Be4RqVLq</A> ,
</I>&gt;<i> <A HREF="http://pastebin.com/yVDeuyQp">http://pastebin.com/yVDeuyQp</A> - Example that gets cached on the old
</I>&gt;<i> server but is a MISS on the new one - <A HREF="http://pastebin.com/VvTU6ieR">http://pastebin.com/VvTU6ieR</A>
</I>&gt;<i> vs <A HREF="http://pastebin.com/ysKJwbmh">http://pastebin.com/ysKJwbmh</A> - Old server firewall settings -
</I>&gt;<i> <A HREF="http://pastebin.com/v688dDMU">http://pastebin.com/v688dDMU</A> - New server firewall settings -
</I>&gt;<i> <A HREF="http://pastebin.com/HyzGdjb4">http://pastebin.com/HyzGdjb4</A>
</I>&gt;<i> 
</I>&gt;<i> Any tips, hints? This is driving me crazy!
</I>&gt;<i> 
</I>&gt;<i> Best regards, Greg
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________ squid-users mailing
</I>&gt;<i> list <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> 
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2

iQEcBAEBAgAGBQJU7JZ1AAoJENNXIZxhPexGvCgH/0RdkThse93Y3rzakMIN2dTC
btiS46wVFqIm/vDtDoIS3qjHiqNn3Q1Xz7LQkUcJSbhkrTwTQFELLOKHWxDsQTan
Ar2cVWKVwACR+xaW4gcNFBarWxOPnG9Wbe2eDh2CskcSu2rHE4busd9eOyMnFkAk
GSEypJliKa+vyfK0QbUK/o3xJh9C9ROyPbZ4K4VG7ioke29jUfr7sPhPCIAknwcX
HHuOLc5lUb5bfbdxY//StrPSe1EagoFj8ykoQbmKjv/FXkkF4Epte9GXi5atz6LL
T7AhqZzPD4YQanROxtCw/jW8cglI62c1O8WbpREmf5z7aXrKaNxkYInmGAI3E7Y=
=7xak
-----END PGP SIGNATURE-----

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="002422.html">[squid-users] Need better debug_options values to track down	cache MISSes
</A></li>
	<LI>Next message (by thread): <A HREF="002425.html">[squid-users] Need better debug_options values to track down cache MISSes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2423">[ date ]</a>
              <a href="thread.html#2423">[ thread ]</a>
              <a href="subject.html#2423">[ subject ]</a>
              <a href="author.html#2423">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
