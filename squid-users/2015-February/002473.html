<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Unable to get TPROXY working with squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Unable%20to%20get%20TPROXY%20working%20with%20squid&In-Reply-To=%3CCAKL8bP5fniDHdBDzdKn_vhafZgKfz8inqwXtCQihx66B0N2BFg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002479.html">
   <LINK REL="Next"  HREF="002476.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Unable to get TPROXY working with squid</H1>
    <B>Carvaka Guru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Unable%20to%20get%20TPROXY%20working%20with%20squid&In-Reply-To=%3CCAKL8bP5fniDHdBDzdKn_vhafZgKfz8inqwXtCQihx66B0N2BFg%40mail.gmail.com%3E"
       TITLE="[squid-users] Unable to get TPROXY working with squid">carvakaguru at gmail.com
       </A><BR>
    <I>Thu Feb 26 23:41:02 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="002479.html">[squid-users] Different squid-3.5.2 compile error on OpenBSD 5.6
</A></li>
        <LI>Next message (by thread): <A HREF="002476.html">[squid-users] Unable to get TPROXY working with squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2473">[ date ]</a>
              <a href="thread.html#2473">[ thread ]</a>
              <a href="subject.html#2473">[ subject ]</a>
              <a href="author.html#2473">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am building a simple linux firewall router with eth1 LAN port and eth0
WAN port. I have squid3 running on it that I have built with netfilter
enabled. The linux version running on the firewall is debian wheezy which
has iptables with TPROXY and socket support.

By setting up the iptables to send traffic to squid3 using the original nat
prerouting REDIRECT method everything works fine but I can't get the TPROXY
method to work. I followed all the steps outlined in
<A HREF="http://wiki.squid-cache.org/Features/Tproxy4">http://wiki.squid-cache.org/Features/Tproxy4</A> but no traffic gets to squid3.
In fact all HTTP traffic goes into some hole as soon as I issue the
following two routing commands -

ip rule add fwmark 1 lookup 100
ip route add local 0.0.0.0/0 dev lo table 100

Without these two commands the HTTP traffic goes through but never gets
routed to squid3.

I think the &quot;ip route&quot; command is the culprit but I don't know why or how
to change it?

Any suggestions, help would be much appreciated.

Thanks,
carvaka
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150226/b75978d1/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150226/b75978d1/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="002479.html">[squid-users] Different squid-3.5.2 compile error on OpenBSD 5.6
</A></li>
	<LI>Next message (by thread): <A HREF="002476.html">[squid-users] Unable to get TPROXY working with squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2473">[ date ]</a>
              <a href="thread.html#2473">[ thread ]</a>
              <a href="subject.html#2473">[ subject ]</a>
              <a href="author.html#2473">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
