From eliezer at ngtech.co.il  Thu Jan  1 01:48:51 2015
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Thu, 01 Jan 2015 03:48:51 +0200
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <HKNPR04MB1933D74D5F5A53D56ED20C8E85F0@HKNPR04MB193.apcprd04.prod.outlook.com>
References: <54A2A4AB.1000003@gmail.com> <54A2AF50.2070103@treenet.co.nz>
 <HKNPR04MB1933D74D5F5A53D56ED20C8E85F0@HKNPR04MB193.apcprd04.prod.outlook.com>
Message-ID: <54A4A783.3010502@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hey James,

I would also appreciate any code that does what you have mentioned.
I can latter write a simple IP\IP_MASK based acl external_acl helper
that can help managing the bump\un-bumped live using some database.

Eliezer

On 12/31/2014 01:11 PM, James Harper wrote:
> I can post it if anyone is interested, although it would require a
> bit of work to be completely useful.
> 
> James

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUpKeCAAoJENxnfXtQ8ZQUCJ0H/iYz+Rk4svlKp+YX2AxhbpCt
cgJfXJR+Ps8fRy9m0Ge7h/L38DdMphDuM8PSv25w/z7Pf0zO+zxHH0sXDGl8m2Ip
gOlM0ZfcTGNc2RDEqEeSoSpMkIKrq1tB440yWIh3kFvFYNafQuVtcKPc4RKpiVXS
ZWCteoUt+YQE74aZEqkohuXeNn0Xq3hXGOUj/vsbIctzCUjGZ2NmMA+IGMvTHeXV
aLkQI8oM61y4bEXpAqUHbyb6fLf+7+kWkYKxAYbop2DVSoOicQ8l9RgOwyZZgGIk
fdgXdXiBRK5XSdzk/Kix2CuYJbSyCrT7+CmfncGdtdrTLC3CwjlV+GNP4m105/g=
=jZfn
-----END PGP SIGNATURE-----


From yvoinov at gmail.com  Thu Jan  1 22:17:52 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Fri, 02 Jan 2015 04:17:52 +0600
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
Message-ID: <54A5C790.4040205@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
BTW,

gents.

Detecting non-HTTPS connections over 443 port is real problem.

This technique is used in some IM apps, cloud apps and other ways.

To catch them I need to review cache.log in realtime, snoop raw IP flow,
manually add URL regexp to non-bumping ACL.

And this is common task. Exclusion list (which is grows continiously) is
bad idea.

I think, a good idea to complete external ACL helper and include it in
Squid distributive.

If helper cah learning in conjunction with SQLite DB - it solves one of
our bump problems.

WBR, Yuri
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUpcePAAoJENNXIZxhPexGge0IALIoTdhXhuFOLlFePRnTnN04
G2nyFYGPCYDZnctX5rAJkmuA1xPP8C4Gt6PgHJLhplRwpkci0z6zOXqCqBMse2Gr
8Hrky+bAyvx+b5Nzq8qz8BB+z1wZmkod+k2uC5QhAq/lJM9rX5CSvloBIHmeA8yh
pBF1qvxmrBmhA0knP49qXBMP9ttA0f2V58kCa7K1zrjcODHbjyHJSXb0d8Yad1Mq
DeihkSnGU/pD1EACtHLjYcSd26O+aCWi3bzucPE64CRCi9t6mClgTnUrAGkrhP7k
CKfZOVTfE3wIYn4p5h9MAFyGrWwNLtfXWsCFC89YPPpzvyhHDREE7xIC5xzVAQ8=
=Snbm
-----END PGP SIGNATURE-----



From eliezer at ngtech.co.il  Fri Jan  2 00:21:07 2015
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Fri, 02 Jan 2015 02:21:07 +0200
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <54A5C790.4040205@gmail.com>
References: <54A5C790.4040205@gmail.com>
Message-ID: <54A5E473.4040807@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hey Yuri,

You would want to avoid sqlite as far as you can due to it's Whole DB
file LOCK nature.

Eliezer

On 01/02/2015 12:17 AM, Yuri Voinov wrote:
> If helper cah learning in conjunction with SQLite DB - it solves
> one of our bump problems.
> 
> WBR, Yuri

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUpeRyAAoJENxnfXtQ8ZQUo20H/RDiRjjoMdReNANKQzFvWdfL
NirhMqmpyfEmjZ8iw9AX8oOxG1x6aJ8ARxVPwCAXj8ZPiOlFT8LqNBDNMBTmwL8b
pbug0n2RTaWrBqKMezXc/3uL56rAty/Zn/IdRLyy/+kuLLMA5niMFd9DcaTz/5Mp
Gmrn/xaBtjiY4o5ZV9gbAGiGwyrmJstcqr07RKFlT8b8cqcENQTlCBBieu6/7K0D
r96AZYCCgKx1GJQpAk27TbTg+g7FpPelb5NqhaVBMJc0RR7TNBzSApqbJZFHntzZ
Bn0W6b2Z6cYJ1Z4Bn/lA1GBfDaTJzqz7nV/xIUdtuLtrjPUX0BR7BVB7D8MPtvU=
=duMj
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Fri Jan  2 03:33:38 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 02 Jan 2015 16:33:38 +1300
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <54A5E473.4040807@ngtech.co.il>
References: <54A5C790.4040205@gmail.com> <54A5E473.4040807@ngtech.co.il>
Message-ID: <54A61192.7040208@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 2/01/2015 1:21 p.m., Eliezer Croitoru wrote:
> Hey Yuri,
> 
> You would want to avoid sqlite as far as you can due to it's Whole
> DB file LOCK nature.

Indeed. My experience with SQLite has been that it is vastly slower
than other DB options even a remote SQL database.

FWIW other Squid helpers written in C/C++ use BerkleyDB, and if
written in Perl use the DBI module for generic SQL DB's.

There is also the option of not using a DB at all in the initial
version. Squid has a cache of previous helper results which it uses
instead of calling the helper repeatedly for the same input.


Yuri, regarding Squid packaged helpers...

Distribution of any code within the Squid package requires:

 1) copyright under GPLv2+ or a GPL compatible license (such as Public
Domain, or BSD 3-clause license).

 2) compliance with the Squid coding and documentation guidelines.
  - One guideline is that the code be as portable as possible. So take
that into consideration with scripts.


* I also request authors/submitters of new helpers to please provide
at least 1 years support for it. Both in assistance of the community
here in squid-users learning how to use the helper, and in support
maintaining its code through its early period when most bugs are found.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUphGSAAoJELJo5wb/XPRj600H/i23sN/OgYocxWTAZ3/3lvM/
I/Z7KA/JTBCsVbWybO9WlNHZQkm9cE+F4H2a62Aw6MVojYERq7+p30/sB29GxGhS
05+JwpzvQ+bQfDgAi8fp4XPSnjuSBjA7MdQPUf6sAH8qFfOtuLYX3DBFKVGA77dY
mLxLsZcozJyqzMbwA55A4nU5sOBZo0je9LMdYXt0ag05RVVLRz4baGKKmZIH6rd2
HbZ5O2glTHhOv1UJ/oHoeX0LD3U1bg88iUD455/SEYwOgR56D0E6XfnK8MWYgYy7
7tsj1FkkVBxQKso6YT8+rD1czR1+eyQa4MT92nWMUBxsOmNifS4ujkhO1zZNIGQ=
=yJ2S
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Fri Jan  2 03:38:50 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 02 Jan 2015 16:38:50 +1300
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <54A61192.7040208@treenet.co.nz>
References: <54A5C790.4040205@gmail.com> <54A5E473.4040807@ngtech.co.il>
 <54A61192.7040208@treenet.co.nz>
Message-ID: <54A612CA.6000102@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 2/01/2015 4:33 p.m., Amos Jeffries wrote:
> 
> Yuri, regarding Squid packaged helpers...
> 

Opps sorry that should have been directed at James or anyone wishing
to bundle his helper with Squid.


> Distribution of any code within the Squid package requires:
> 
> 1) copyright under GPLv2+ or a GPL compatible license (such as
> Public Domain, or BSD 3-clause license).
> 
> 2) compliance with the Squid coding and documentation guidelines. -
> One guideline is that the code be as portable as possible. So take 
> that into consideration with scripts.
> 
> 
> * I also request authors/submitters of new helpers to please
> provide at least 1 years support for it. Both in assistance of the
> community here in squid-users learning how to use the helper, and
> in support maintaining its code through its early period when most
> bugs are found.
> 

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUphLKAAoJELJo5wb/XPRjcR4IAM+oU38WD75nhjqZL88adyfC
9GkmtXuKRUSErHMNdllBuedLdg0d1ws4PDS/u3MqNoGiNKb5EXxdX1Uu508ym9E2
dmFqatGSsjYyhOFkFx3saFCSm1bX2w+dcJDlp9c30YKRAuTQfABicYg1b+y6CU6S
RU1yRZpSAkzE/8bjl1iufNHf6CJ2BiIVFLmyf6SpDPvYOzMTQ3S8pGbslvi3H2Dd
1MkU1caInOhSifNvKpXUx8CcODBkCI4F7GXO/kNxmNEOHp0OD0xempa3sgUjmsIJ
rzLdnt84MeG1LRSJONajJshLp72FemQOl19KjfgmSO97EnhSKMFk2cTOlEuMKN4=
=fMGW
-----END PGP SIGNATURE-----


From hack.back at hotmail.com  Fri Jan  2 13:21:53 2015
From: hack.back at hotmail.com (HackXBack)
Date: Fri, 2 Jan 2015 05:21:53 -0800 (PST)
Subject: [squid-users] FATAL: Ipc::Mem::Segment::open failed to shm_open
 "(2) No such file or directory"
Message-ID: <1420204913650-4668906.post@n4.nabble.com>

after adding rock storage to my system i got this error

Squid Cache: Version 3.4.10

 FATAL: Ipc::Mem::Segment::open failed to shm_open "(2) No such file or
directory"

cache_dir rock /cache01/rock 50000 max-size=31744
cache_dir aufs /cache01/aufs 2000000 4808 256 min-size=31745

cache_dir rock /cache02/rock 50000 max-size=31744
cache_dir aufs /cache02/aufs 2000000 4808 256 min-size=31745

cache_dir rock /cache03/rock 50000 max-size=31744
cache_dir aufs /cache03/aufs 2000000 4808 256 min-size=31745

cache_dir rock /cache04/rock 50000 max-size=31744
cache_dir aufs /cache04/aufs 2000000 4808 256 min-size=31745

cache_dir rock /cache05/rock 50000 max-size=31744
cache_dir aufs /cache05/aufs 2000000 4808 256 min-size=31745




--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/FATAL-Ipc-Mem-Segment-open-failed-to-shm-open-2-No-such-file-or-directory-tp4668906.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From hack.back at hotmail.com  Fri Jan  2 14:09:56 2015
From: hack.back at hotmail.com (HackXBack)
Date: Fri, 2 Jan 2015 06:09:56 -0800 (PST)
Subject: [squid-users] FATAL: Ipc::Mem::Segment::open failed to shm_open
 "(2) No such file or directory"
In-Reply-To: <1420204913650-4668906.post@n4.nabble.com>
References: <1420204913650-4668906.post@n4.nabble.com>
Message-ID: <1420207796613-4668907.post@n4.nabble.com>

now i got 

FATAL: Rock cache_dir at /cache01/rock/rock failed to open db file: (11)
Resource temporarily unavailable




--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/FATAL-Ipc-Mem-Segment-open-failed-to-shm-open-2-No-such-file-or-directory-tp4668906p4668907.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From hack.back at hotmail.com  Fri Jan  2 15:20:47 2015
From: hack.back at hotmail.com (HackXBack)
Date: Fri, 2 Jan 2015 07:20:47 -0800 (PST)
Subject: [squid-users] FATAL: Ipc::Mem::Segment::open failed to shm_open
 "(2) No such file or directory"
In-Reply-To: <1420207796613-4668907.post@n4.nabble.com>
References: <1420204913650-4668906.post@n4.nabble.com>
 <1420207796613-4668907.post@n4.nabble.com>
Message-ID: <1420212047250-4668908.post@n4.nabble.com>

the problem was in putting max-size option before min-size , so this is how i
fixed it..


now in cache.log
i see multiple times of
 Finished rebuilding storage from disk. 
after every start and in nature it must be 1 time so why this happen thats
because of rock type or what ?

2015/01/02 17:19:28 kid4|   Took 6.75 seconds (  0.00 objects/sec).
2015/01/02 17:19:28 kid4| Beginning Validation Procedure
2015/01/02 17:19:28 kid4|   Completed Validation Procedure
2015/01/02 17:19:28 kid4|   Validated 0 Entries
2015/01/02 17:19:28 kid4|   store_swap_size = 16.00 KB
2015/01/02 17:19:29 kid3| Finished rebuilding storage from disk.
2015/01/02 17:19:29 kid3|   1651612 Entries scanned
2015/01/02 17:19:29 kid3|         0 Invalid entries.
2015/01/02 17:19:29 kid3|         0 With invalid flags.
2015/01/02 17:19:29 kid3|         0 Objects loaded.
2015/01/02 17:19:29 kid3|         0 Objects expired.
2015/01/02 17:19:29 kid3|         0 Objects cancelled.
2015/01/02 17:19:29 kid3|         0 Duplicate URLs purged.
2015/01/02 17:19:29 kid3|         0 Swapfile clashes avoided.
2015/01/02 17:19:29 kid3|   Took 7.05 seconds (  0.00 objects/sec).
2015/01/02 17:19:29 kid3| Beginning Validation Procedure
2015/01/02 17:19:29 kid3|   Completed Validation Procedure
2015/01/02 17:19:29 kid3|   Validated 0 Entries
2015/01/02 17:19:29 kid3|   store_swap_size = 16.00 KB
2015/01/02 17:19:29 kid2| Finished rebuilding storage from disk.
2015/01/02 17:19:29 kid2|   1651612 Entries scanned
2015/01/02 17:19:29 kid2|         0 Invalid entries.
2015/01/02 17:19:29 kid2|         0 With invalid flags.
2015/01/02 17:19:29 kid2|         0 Objects loaded.
2015/01/02 17:19:29 kid2|         0 Objects expired.
2015/01/02 17:19:29 kid2|         0 Objects cancelled.
2015/01/02 17:19:29 kid2|         0 Duplicate URLs purged.
2015/01/02 17:19:29 kid2|         0 Swapfile clashes avoided.
2015/01/02 17:19:29 kid2|   Took 7.01 seconds (  0.00 objects/sec).
2015/01/02 17:19:29 kid2| Beginning Validation Procedure
2015/01/02 17:19:29 kid2|   Completed Validation Procedure
2015/01/02 17:19:29 kid2|   Validated 0 Entries
2015/01/02 17:19:29 kid2|   store_swap_size = 16.00 KB
2015/01/02 17:19:29 kid4| storeLateRelease: released 0 objects
2015/01/02 17:19:29 kid5| Finished rebuilding storage from disk.
2015/01/02 17:19:29 kid5|   1651612 Entries scanned
2015/01/02 17:19:29 kid5|         0 Invalid entries.
2015/01/02 17:19:29 kid5|         0 With invalid flags.
2015/01/02 17:19:29 kid5|         0 Objects loaded.
2015/01/02 17:19:29 kid5|         0 Objects expired.
2015/01/02 17:19:29 kid5|         0 Objects cancelled.
2015/01/02 17:19:29 kid5|         0 Duplicate URLs purged.
2015/01/02 17:19:29 kid5|         0 Swapfile clashes avoided.
2015/01/02 17:19:29 kid5|   Took 7.17 seconds (  0.00 objects/sec).
2015/01/02 17:19:29 kid5| Beginning Validation Procedure
2015/01/02 17:19:29 kid5|   Completed Validation Procedure
2015/01/02 17:19:29 kid5|   Validated 0 Entries
2015/01/02 17:19:29 kid5|   store_swap_size = 16.00 KB
2015/01/02 17:19:29 kid3| storeLateRelease: released 0 objects
2015/01/02 17:19:29 kid5| storeLateRelease: released 0 objects
2015/01/02 17:19:29 kid2| storeLateRelease: released 0 objects




--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/FATAL-Ipc-Mem-Segment-open-failed-to-shm-open-2-No-such-file-or-directory-tp4668906p4668908.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From rousskov at measurement-factory.com  Fri Jan  2 17:34:55 2015
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 02 Jan 2015 10:34:55 -0700
Subject: [squid-users] FATAL: Ipc::Mem::Segment::open failed to shm_open
 "(2) No such file or directory"
In-Reply-To: <1420212047250-4668908.post@n4.nabble.com>
References: <1420204913650-4668906.post@n4.nabble.com>
 <1420207796613-4668907.post@n4.nabble.com>
 <1420212047250-4668908.post@n4.nabble.com>
Message-ID: <54A6D6BF.7080708@measurement-factory.com>

On 01/02/2015 08:20 AM, HackXBack wrote:

> now in cache.log i see multiple times of
>  Finished rebuilding storage from disk. 
> after every start and in nature it must be 1 time so why this happen thats
> because of rock type or what ?

Each disker maintains an index of its disk, so you should see one such
message for each disker process/kid.

Someday, somebody will polish these messages to make them more compact
(at most one line at debugging level 1 is needed in most cases).


HTH,

Alex.
P.S. Please do not misinterpret this message as an implicit endorsement
of your rock/aufs combination.


> 2015/01/02 17:19:28 kid4|   Took 6.75 seconds (  0.00 objects/sec).
> 2015/01/02 17:19:28 kid4| Beginning Validation Procedure
> 2015/01/02 17:19:28 kid4|   Completed Validation Procedure
> 2015/01/02 17:19:28 kid4|   Validated 0 Entries
> 2015/01/02 17:19:28 kid4|   store_swap_size = 16.00 KB
> 2015/01/02 17:19:29 kid3| Finished rebuilding storage from disk.
> 2015/01/02 17:19:29 kid3|   1651612 Entries scanned
> 2015/01/02 17:19:29 kid3|         0 Invalid entries.
> 2015/01/02 17:19:29 kid3|         0 With invalid flags.
> 2015/01/02 17:19:29 kid3|         0 Objects loaded.
> 2015/01/02 17:19:29 kid3|         0 Objects expired.
> 2015/01/02 17:19:29 kid3|         0 Objects cancelled.
> 2015/01/02 17:19:29 kid3|         0 Duplicate URLs purged.
> 2015/01/02 17:19:29 kid3|         0 Swapfile clashes avoided.
> 2015/01/02 17:19:29 kid3|   Took 7.05 seconds (  0.00 objects/sec).
> 2015/01/02 17:19:29 kid3| Beginning Validation Procedure
> 2015/01/02 17:19:29 kid3|   Completed Validation Procedure
> 2015/01/02 17:19:29 kid3|   Validated 0 Entries
> 2015/01/02 17:19:29 kid3|   store_swap_size = 16.00 KB
> 2015/01/02 17:19:29 kid2| Finished rebuilding storage from disk.
> 2015/01/02 17:19:29 kid2|   1651612 Entries scanned
> 2015/01/02 17:19:29 kid2|         0 Invalid entries.
> 2015/01/02 17:19:29 kid2|         0 With invalid flags.
> 2015/01/02 17:19:29 kid2|         0 Objects loaded.
> 2015/01/02 17:19:29 kid2|         0 Objects expired.
> 2015/01/02 17:19:29 kid2|         0 Objects cancelled.
> 2015/01/02 17:19:29 kid2|         0 Duplicate URLs purged.
> 2015/01/02 17:19:29 kid2|         0 Swapfile clashes avoided.
> 2015/01/02 17:19:29 kid2|   Took 7.01 seconds (  0.00 objects/sec).
> 2015/01/02 17:19:29 kid2| Beginning Validation Procedure
> 2015/01/02 17:19:29 kid2|   Completed Validation Procedure
> 2015/01/02 17:19:29 kid2|   Validated 0 Entries
> 2015/01/02 17:19:29 kid2|   store_swap_size = 16.00 KB
> 2015/01/02 17:19:29 kid4| storeLateRelease: released 0 objects
> 2015/01/02 17:19:29 kid5| Finished rebuilding storage from disk.
> 2015/01/02 17:19:29 kid5|   1651612 Entries scanned
> 2015/01/02 17:19:29 kid5|         0 Invalid entries.
> 2015/01/02 17:19:29 kid5|         0 With invalid flags.
> 2015/01/02 17:19:29 kid5|         0 Objects loaded.
> 2015/01/02 17:19:29 kid5|         0 Objects expired.
> 2015/01/02 17:19:29 kid5|         0 Objects cancelled.
> 2015/01/02 17:19:29 kid5|         0 Duplicate URLs purged.
> 2015/01/02 17:19:29 kid5|         0 Swapfile clashes avoided.
> 2015/01/02 17:19:29 kid5|   Took 7.17 seconds (  0.00 objects/sec).
> 2015/01/02 17:19:29 kid5| Beginning Validation Procedure
> 2015/01/02 17:19:29 kid5|   Completed Validation Procedure
> 2015/01/02 17:19:29 kid5|   Validated 0 Entries
> 2015/01/02 17:19:29 kid5|   store_swap_size = 16.00 KB
> 2015/01/02 17:19:29 kid3| storeLateRelease: released 0 objects
> 2015/01/02 17:19:29 kid5| storeLateRelease: released 0 objects
> 2015/01/02 17:19:29 kid2| storeLateRelease: released 0 objects



From francisuk1989 at gmail.com  Fri Jan  2 22:34:54 2015
From: francisuk1989 at gmail.com (francisuk24)
Date: Fri, 2 Jan 2015 14:34:54 -0800 (PST)
Subject: [squid-users] how to allow teamviewer specific user
In-Reply-To: <1420199145672-4668905.post@n4.nabble.com>
References: <1420199145672-4668905.post@n4.nabble.com>
Message-ID: <1420238094093-4668910.post@n4.nabble.com>

Hello,
When i had squid 3.1 when i was running ubuntu server 12.04 x64, It did have
alot of none working/errors with ACL list but since i upgraded my server to
centos 7 x64, It gived me squid 3.3.8 and it all worked fine, However that
been said, It could of been the Ubuntu side.



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/how-to-allow-teamviewer-specific-user-tp4668905p4668910.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From Jason_Haar at trimble.com  Sat Jan  3 07:59:32 2015
From: Jason_Haar at trimble.com (Jason Haar)
Date: Sat, 3 Jan 2015 20:59:32 +1300
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <HKNPR04MB1933D74D5F5A53D56ED20C8E85F0@HKNPR04MB193.apcprd04.prod.outlook.com>
References: <54A2A4AB.1000003@gmail.com> <54A2AF50.2070103@treenet.co.nz>
 <HKNPR04MB1933D74D5F5A53D56ED20C8E85F0@HKNPR04MB193.apcprd04.prod.outlook.com>
Message-ID: <54A7A164.8010400@trimble.com>

On 01/01/15 00:11, James Harper wrote:
> The helper connects to the IP:port and tries to obtain the certificate, and then caches the result (in an sqlite database). If it can't do so within a fairly short time it returns failure (but keeps trying a bit longer and caches it for next time). Alternatively if the IP used to be SSL but is now timing out it returns the previously cached value. Negative results are cached for an increasing amount of time each time it fails, on the basis that it probably isn't SSL.
That sounds great James! I'd certainly like to take a look at it too

However, you say "SSL"  - did you mean "HTTPS"? ie discovering a ip:port
is a IMAPS server doesn't really help squid talk to it - surely you want
to discover HTTPS servers - and everything else should be
pass-through/splice?

-- 
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1



From yvoinov at gmail.com  Sat Jan  3 08:45:07 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Sat, 03 Jan 2015 14:45:07 +0600
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <54A7A164.8010400@trimble.com>
References: <54A2A4AB.1000003@gmail.com> <54A2AF50.2070103@treenet.co.nz>
 <HKNPR04MB1933D74D5F5A53D56ED20C8E85F0@HKNPR04MB193.apcprd04.prod.outlook.com>
 <54A7A164.8010400@trimble.com>
Message-ID: <54A7AC13.4020001@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Term "HTTPS" often uses as "Any connect over 443 port"....

03.01.2015 13:59, Jason Haar ?????:
> On 01/01/15 00:11, James Harper wrote:
>> The helper connects to the IP:port and tries to obtain the
certificate, and then caches the result (in an sqlite database). If it
can't do so within a fairly short time it returns failure (but keeps
trying a bit longer and caches it for next time). Alternatively if the
IP used to be SSL but is now timing out it returns the previously cached
value. Negative results are cached for an increasing amount of time each
time it fails, on the basis that it probably isn't SSL.
> That sounds great James! I'd certainly like to take a look at it too
>
> However, you say "SSL"  - did you mean "HTTPS"? ie discovering a ip:port
> is a IMAPS server doesn't really help squid talk to it - surely you want
> to discover HTTPS servers - and everything else should be
> pass-through/splice?
>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUp6wSAAoJENNXIZxhPexGb8MH/irRYZBuoGjHZrpcI6kweMGv
YqSjFYUasZ/hlDoN6bbJUKqAfeos0am0OuTy2FxOmA0YVxIEz6sJKj9FzeMJtOSW
NTZk7IJ7mT6aRg+hKfW3JCEl68RcLb0J/eSNvG6QR6HcqHQODiEE489zcq+o+yn0
Z45P1WwgQLv6PIIeNXnM7nFtA0ce3D54agu/fr7zC3c1Z72A04BMU0W4dFC9M6Ob
T2NQz2CsSp+nIDFZjHTaZuBmw5ZjMtrsoO79FT5GyX1lT+tCR9angtI+TYSSis15
o+/aw1U+yWScZXhdNUz/gjWLbW8WL/9ygVY43Y2laPII+WdlFhaJozEhr5h1e+A=
=2f0+
-----END PGP SIGNATURE-----



From hack.back at hotmail.com  Sat Jan  3 11:13:37 2015
From: hack.back at hotmail.com (HackXBack)
Date: Sat, 3 Jan 2015 03:13:37 -0800 (PST)
Subject: [squid-users] not correct round-roubin
Message-ID: <1420283617965-4668914.post@n4.nabble.com>

hello minds,
after adding rock option to my squid

cache_dir aufs /cache01/aufs/1 400000 961 256 min-size=31745
cache_dir aufs /cache01/aufs/2 400000 961 256 min-size=31745



cache_dir aufs /cache02/aufs/1 400000 961 256 min-size=31745
cache_dir aufs /cache02/aufs/2 400000 961 256 min-size=31745



cache_dir aufs /cache03/aufs/1 400000 961 256 min-size=31745
cache_dir aufs /cache03/aufs/2 400000 961 256 min-size=31745
cache_dir aufs /cache03/aufs/3 400000 961 256 min-size=31745


cache_dir aufs /cache04/aufs/1 400000 961 256 min-size=31745
cache_dir aufs /cache04/aufs/2 400000 961 256 min-size=31745
cache_dir aufs /cache04/aufs/3 400000 961 256 min-size=31745


cache_dir aufs /cache05/aufs/1 400000 961 256 min-size=31745
cache_dir aufs /cache05/aufs/2 400000 961 256 min-size=31745
cache_dir aufs /cache05/aufs/3 400000 961 256 min-size=31745


cache_dir rock /cache01/rock 50000 max-size=31744
cache_dir rock /cache02/rock 50000 max-size=31744
cache_dir rock /cache03/rock 50000 max-size=31744
cache_dir rock /cache04/rock 50000 max-size=31744
cache_dir rock /cache05/rock 50000 max-size=31744




not correct round-roubin when i check this command

root at issa:~# df -h
Filesystem                                              Size  Used Avail
Use% Mounted on
rootfs                                                  212G  4.2G  197G  
3% /
udev                                                     10M     0   10M  
0% /dev
tmpfs                                                   3.2G  276K  3.2G  
1% /run
/dev/disk/by-uuid/bfae05ad-9281-447b-9640-89c8f9047536  212G  4.2G  197G  
3% /
tmpfs                                                   5.0M     0  5.0M  
0% /run/lock
tmpfs                                                   8.1G  1.1G  7.1G 
14% /run/shm
/dev/sda1                                               2.8T   25G  2.8T  
1% /cache01
/dev/sdb1                                               2.8T  2.6G  2.8T  
1% /cache02
/dev/sdc1                                               2.8T  1.5G  2.8T  
1% /cache03
/dev/sdd1                                               2.8T  1.1G  2.8T  
1% /cache04
/dev/sde1                                               2.8T  967M  2.8T  
1% /cache05




--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/not-correct-round-roubin-tp4668914.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From doug1234 at digcorp.net  Sun Jan  4 20:17:20 2015
From: doug1234 at digcorp.net (Douglas Davenport)
Date: Sun, 4 Jan 2015 15:17:20 -0500
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <54A7AC13.4020001@gmail.com>
References: <54A2A4AB.1000003@gmail.com> <54A2AF50.2070103@treenet.co.nz>
 <HKNPR04MB1933D74D5F5A53D56ED20C8E85F0@HKNPR04MB193.apcprd04.prod.outlook.com>
 <54A7A164.8010400@trimble.com> <54A7AC13.4020001@gmail.com>
Message-ID: <CAOsHgtvHt7BshV-4nVr9Bh-VPj44wNmYNm2cor=NbBDOs=kBkw@mail.gmail.com>

I saw a very similar feature in ufdbGuard which is a URL filter implemented
as a Squid Redirector. They have a feature which probes the destination
server for a valid HTTPS cert in parallel to the user's connection and
terminates it if it turns out not to be a valid HTTPS cert. Their code is
open source, maybe this could be helpful in creating such a helper?

http://www.urlfilterdb.com/home.html

On Sat, Jan 3, 2015 at 3:45 AM, Yuri Voinov <yvoinov at gmail.com> wrote:

>
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Term "HTTPS" often uses as "Any connect over 443 port"....
>
> 03.01.2015 13:59, Jason Haar ?????:
> > On 01/01/15 00:11, James Harper wrote:
> >> The helper connects to the IP:port and tries to obtain the
> certificate, and then caches the result (in an sqlite database). If it
> can't do so within a fairly short time it returns failure (but keeps
> trying a bit longer and caches it for next time). Alternatively if the
> IP used to be SSL but is now timing out it returns the previously cached
> value. Negative results are cached for an increasing amount of time each
> time it fails, on the basis that it probably isn't SSL.
> > That sounds great James! I'd certainly like to take a look at it too
> >
> > However, you say "SSL"  - did you mean "HTTPS"? ie discovering a ip:port
> > is a IMAPS server doesn't really help squid talk to it - surely you want
> > to discover HTTPS servers - and everything else should be
> > pass-through/splice?
> >
>
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2
>
> iQEcBAEBAgAGBQJUp6wSAAoJENNXIZxhPexGb8MH/irRYZBuoGjHZrpcI6kweMGv
> YqSjFYUasZ/hlDoN6bbJUKqAfeos0am0OuTy2FxOmA0YVxIEz6sJKj9FzeMJtOSW
> NTZk7IJ7mT6aRg+hKfW3JCEl68RcLb0J/eSNvG6QR6HcqHQODiEE489zcq+o+yn0
> Z45P1WwgQLv6PIIeNXnM7nFtA0ce3D54agu/fr7zC3c1Z72A04BMU0W4dFC9M6Ob
> T2NQz2CsSp+nIDFZjHTaZuBmw5ZjMtrsoO79FT5GyX1lT+tCR9angtI+TYSSis15
> o+/aw1U+yWScZXhdNUz/gjWLbW8WL/9ygVY43Y2laPII+WdlFhaJozEhr5h1e+A=
> =2f0+
> -----END PGP SIGNATURE-----
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150104/a3bf9234/attachment.htm>

From yvoinov at gmail.com  Sun Jan  4 20:26:32 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 05 Jan 2015 02:26:32 +0600
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <CAOsHgtvHt7BshV-4nVr9Bh-VPj44wNmYNm2cor=NbBDOs=kBkw@mail.gmail.com>
References: <54A2A4AB.1000003@gmail.com> <54A2AF50.2070103@treenet.co.nz>
 <HKNPR04MB1933D74D5F5A53D56ED20C8E85F0@HKNPR04MB193.apcprd04.prod.outlook.com>
 <54A7A164.8010400@trimble.com> <54A7AC13.4020001@gmail.com>
 <CAOsHgtvHt7BshV-4nVr9Bh-VPj44wNmYNm2cor=NbBDOs=kBkw@mail.gmail.com>
Message-ID: <54A9A1F8.1090202@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
To return to Earth:

I think, a good idea is built-in (ma be, in ssl_crtd?) functionality to
check 443 port connection for "Is an HTTPS inside?" and if no, do not
bump by default.

This is so simple and fast, is it? And we can have some config option to
disable this function.......Or not.....

;)

05.01.2015 2:17, Douglas Davenport ?????:
> I saw a very similar feature in ufdbGuard which is a URL filter implemented as a Squid Redirector. They
have a feature which probes the destination server for a valid HTTPS
cert in parallel to the user's connection and terminates it if it turns
out not to be a valid HTTPS cert. Their code is open source, maybe this
could be helpful in creating such a helper?
>
> http://www.urlfilterdb.com/home.html
>
> On Sat, Jan 3, 2015 at 3:45 AM, Yuri Voinov <yvoinov at gmail.com
<mailto:yvoinov at gmail.com>> wrote:
>
>
> Term "HTTPS" often uses as "Any connect over 443 port"....
>
> 03.01.2015 13:59, Jason Haar ?????:
> > On 01/01/15 00:11, James Harper wrote:
> >> The helper connects to the IP:port and tries to obtain the
> certificate, and then caches the result (in an sqlite database). If it
> can't do so within a fairly short time it returns failure (but keeps
> trying a bit longer and caches it for next time). Alternatively if the
> IP used to be SSL but is now timing out it returns the previously cached
> value. Negative results are cached for an increasing amount of time each
> time it fails, on the basis that it probably isn't SSL.
> > That sounds great James! I'd certainly like to take a look at it too
>
> > However, you say "SSL"  - did you mean "HTTPS"? ie discovering a ip:port
> > is a IMAPS server doesn't really help squid talk to it - surely you want
> > to discover HTTPS servers - and everything else should be
> > pass-through/splice?
>
>
>
>     _______________________________________________
>     squid-users mailing list
>     squid-users at lists.squid-cache.org
<mailto:squid-users at lists.squid-cache.org>
>     http://lists.squid-cache.org/listinfo/squid-users
>
>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUqaH3AAoJENNXIZxhPexG+VAH/3+fQfAUA1IdCXTdvZXjR2Ih
2AAa2d/mPOQtk1RNTk7PUxp1tIuUVt054euuwnhxItGSIb6OB7U2fTHK1k3BF+ta
BG6fyghpKYFBHJkloYX6m45g7K3vgpKEjVPDQZuaUz1CBZ67ie/ThngxmgNwFqaO
HbDvcX6FnvYeplRDrsx8DATD7fqujw5wy6ZI+23bXAOf4j7PO6zwIeoh4hSkMhr/
7ZRBYv2T6iYh+sL3XiYgVh9fWcGy2O2ovJLW/2AA4YXnlEAGLgbgVZCiF6jIdomn
iSiel6enLOCDneLsMcW1h+n7HNTTpv6N2D5ATMEcf8kz3ACmH99mBhk2bh9jQ94=
=Iw5c
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150105/69a505dd/attachment.htm>

From yvoinov at gmail.com  Sun Jan  4 21:29:31 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 05 Jan 2015 03:29:31 +0600
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <CAOsHgtvHt7BshV-4nVr9Bh-VPj44wNmYNm2cor=NbBDOs=kBkw@mail.gmail.com>
References: <54A2A4AB.1000003@gmail.com> <54A2AF50.2070103@treenet.co.nz>
 <HKNPR04MB1933D74D5F5A53D56ED20C8E85F0@HKNPR04MB193.apcprd04.prod.outlook.com>
 <54A7A164.8010400@trimble.com> <54A7AC13.4020001@gmail.com>
 <CAOsHgtvHt7BshV-4nVr9Bh-VPj44wNmYNm2cor=NbBDOs=kBkw@mail.gmail.com>
Message-ID: <54A9B0BB.1050509@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
As I can see, we have two major problems with SSL Bump now.

1. Stupid apps and it's stupid developers - like ICQ and other stupid IM
- which is hope 443 port is never be blocked due to using for
logons/internet banking etc.
This stupid way broke standards (?) and make us crazy. Now single
solution is catch them manually and pass it without bumping. This is the
simplest problem. And I hope it will be solved in core - i.e. in Squid
directly.

2. SSL Pinned sites. We cannot do with them anything excluding sniff it
and pass by IP without bump.

First problems seems to solve easy. Either by helper, or by squid - no
matter. It's really simple. Just check SSL cert on server side - and
make decision - to bump, or not to bump.

The second problem seems difficult and now I can't see any reasonable
solution, excluding sniffer/manual add to acl.

Any ideas? Will be write helper?

WBR, Yuri

05.01.2015 2:17, Douglas Davenport ?????:
> I saw a very similar feature in ufdbGuard which is a URL filter implemented as a Squid Redirector. They
have a feature which probes the destination server for a valid HTTPS
cert in parallel to the user's connection and terminates it if it turns
out not to be a valid HTTPS cert. Their code is open source, maybe this
could be helpful in creating such a helper?
>
> http://www.urlfilterdb.com/home.html
>
> On Sat, Jan 3, 2015 at 3:45 AM, Yuri Voinov <yvoinov at gmail.com
<mailto:yvoinov at gmail.com>> wrote:
>
>
> Term "HTTPS" often uses as "Any connect over 443 port"....
>
> 03.01.2015 13:59, Jason Haar ?????:
> > On 01/01/15 00:11, James Harper wrote:
> >> The helper connects to the IP:port and tries to obtain the
> certificate, and then caches the result (in an sqlite database). If it
> can't do so within a fairly short time it returns failure (but keeps
> trying a bit longer and caches it for next time). Alternatively if the
> IP used to be SSL but is now timing out it returns the previously cached
> value. Negative results are cached for an increasing amount of time each
> time it fails, on the basis that it probably isn't SSL.
> > That sounds great James! I'd certainly like to take a look at it too
>
> > However, you say "SSL"  - did you mean "HTTPS"? ie discovering a ip:port
> > is a IMAPS server doesn't really help squid talk to it - surely you want
> > to discover HTTPS servers - and everything else should be
> > pass-through/splice?
>
>
>
>     _______________________________________________
>     squid-users mailing list
>     squid-users at lists.squid-cache.org
<mailto:squid-users at lists.squid-cache.org>
>     http://lists.squid-cache.org/listinfo/squid-users
>
>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUqbC7AAoJENNXIZxhPexGwwkH/j8XR2fQ4v/r3M2zFuDuhVsP
JZMM93IvZrGYRzJjAmmwg7ZUoYdwWWEaXoY6GygO+RdZESWfPvh00cSsxwRKfmvm
2s7sLDKlPnfUsf9fyWnihCtJg9hETZTsvUqK9I+iopiM1DHq/qwX3Pjkb2e2T45u
JuqU5ySBZPEt6G1gRn/+F2EyHdhWpa9OOtfeTAt4/oaJIuLoHP7855fif/1eg59U
QlISZkLjDcL4DqEVM+9UJh9TSN+dawj/Ks+3b+MT8sA/xvVdOyqhLMqnm4MPadSv
yvK5nQWW4rkfHOJ1zwWq3hAMLjCIXjY4q1NxNQAxdK5ESZvszecvXg3JMKo/THw=
=Ygen
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150105/d437b16d/attachment.htm>

From doug1234 at digcorp.net  Mon Jan  5 01:07:12 2015
From: doug1234 at digcorp.net (Douglas Davenport)
Date: Sun, 4 Jan 2015 20:07:12 -0500
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <54A9B0BB.1050509@gmail.com>
References: <54A2A4AB.1000003@gmail.com> <54A2AF50.2070103@treenet.co.nz>
 <HKNPR04MB1933D74D5F5A53D56ED20C8E85F0@HKNPR04MB193.apcprd04.prod.outlook.com>
 <54A7A164.8010400@trimble.com> <54A7AC13.4020001@gmail.com>
 <CAOsHgtvHt7BshV-4nVr9Bh-VPj44wNmYNm2cor=NbBDOs=kBkw@mail.gmail.com>
 <54A9B0BB.1050509@gmail.com>
Message-ID: <CAOsHgtsrTZ9kqhcWcJwVnhnbA8L9eX0DZJfdbM+zB4tw-0LVZg@mail.gmail.com>

Seems to me it would be more useful as an external ACL so that a decision
could be made based on other factors eg src or dstdomain whether to deny or
allow the un-bumpable connection.

On Sun, Jan 4, 2015 at 4:29 PM, Yuri Voinov <yvoinov at gmail.com> wrote:

>
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> As I can see, we have two major problems with SSL Bump now.
>
> 1. Stupid apps and it's stupid developers - like ICQ and other stupid IM -
> which is hope 443 port is never be blocked due to using for logons/internet
> banking etc.
> This stupid way broke standards (?) and make us crazy. Now single solution
> is catch them manually and pass it without bumping. This is the simplest
> problem. And I hope it will be solved in core - i.e. in Squid directly.
>
> 2. SSL Pinned sites. We cannot do with them anything excluding sniff it
> and pass by IP without bump.
>
> First problems seems to solve easy. Either by helper, or by squid - no
> matter. It's really simple. Just check SSL cert on server side - and make
> decision - to bump, or not to bump.
>
> The second problem seems difficult and now I can't see any reasonable
> solution, excluding sniffer/manual add to acl.
>
> Any ideas? Will be write helper?
>
> WBR, Yuri
>
> 05.01.2015 2:17, Douglas Davenport ?????:
> > I saw a very similar feature in ufdbGuard which is a URL filter
> implemented as a Squid Redirector. They have a feature which probes the
> destination server for a valid HTTPS cert in parallel to the user's
> connection and terminates it if it turns out not to be a valid HTTPS cert.
> Their code is open source, maybe this could be helpful in creating such a
> helper?
> >
> > http://www.urlfilterdb.com/home.html
> >
> > On Sat, Jan 3, 2015 at 3:45 AM, Yuri Voinov <yvoinov at gmail.com
> <mailto:yvoinov at gmail.com> <yvoinov at gmail.com>> wrote:
> >
> >
> > Term "HTTPS" often uses as "Any connect over 443 port"....
> >
> > 03.01.2015 13:59, Jason Haar ?????:
> > > On 01/01/15 00:11, James Harper wrote:
> > >> The helper connects to the IP:port and tries to obtain the
> > certificate, and then caches the result (in an sqlite database). If it
> > can't do so within a fairly short time it returns failure (but keeps
> > trying a bit longer and caches it for next time). Alternatively if the
> > IP used to be SSL but is now timing out it returns the previously cached
> > value. Negative results are cached for an increasing amount of time each
> > time it fails, on the basis that it probably isn't SSL.
> > > That sounds great James! I'd certainly like to take a look at it too
> >
> > > However, you say "SSL"  - did you mean "HTTPS"? ie discovering a
> ip:port
> > > is a IMAPS server doesn't really help squid talk to it - surely you
> want
> > > to discover HTTPS servers - and everything else should be
> > > pass-through/splice?
> >
> >
> >
> >     _______________________________________________
> >     squid-users mailing list
> >     squid-users at lists.squid-cache.org
> <mailto:squid-users at lists.squid-cache.org>
> <squid-users at lists.squid-cache.org>
> >     http://lists.squid-cache.org/listinfo/squid-users
> >
> >
>
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2
>
> iQEcBAEBAgAGBQJUqbC7AAoJENNXIZxhPexGwwkH/j8XR2fQ4v/r3M2zFuDuhVsP
> JZMM93IvZrGYRzJjAmmwg7ZUoYdwWWEaXoY6GygO+RdZESWfPvh00cSsxwRKfmvm
> 2s7sLDKlPnfUsf9fyWnihCtJg9hETZTsvUqK9I+iopiM1DHq/qwX3Pjkb2e2T45u
> JuqU5ySBZPEt6G1gRn/+F2EyHdhWpa9OOtfeTAt4/oaJIuLoHP7855fif/1eg59U
> QlISZkLjDcL4DqEVM+9UJh9TSN+dawj/Ks+3b+MT8sA/xvVdOyqhLMqnm4MPadSv
> yvK5nQWW4rkfHOJ1zwWq3hAMLjCIXjY4q1NxNQAxdK5ESZvszecvXg3JMKo/THw=
> =Ygen
> -----END PGP SIGNATURE-----
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150104/02a4e313/attachment.htm>

From eliezer at ngtech.co.il  Mon Jan  5 02:44:15 2015
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Mon, 05 Jan 2015 04:44:15 +0200
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <CAOsHgtsrTZ9kqhcWcJwVnhnbA8L9eX0DZJfdbM+zB4tw-0LVZg@mail.gmail.com>
References: <54A2A4AB.1000003@gmail.com> <54A2AF50.2070103@treenet.co.nz>
 <HKNPR04MB1933D74D5F5A53D56ED20C8E85F0@HKNPR04MB193.apcprd04.prod.outlook.com>
 <54A7A164.8010400@trimble.com> <54A7AC13.4020001@gmail.com>
 <CAOsHgtvHt7BshV-4nVr9Bh-VPj44wNmYNm2cor=NbBDOs=kBkw@mail.gmail.com>
 <54A9B0BB.1050509@gmail.com>
 <CAOsHgtsrTZ9kqhcWcJwVnhnbA8L9eX0DZJfdbM+zB4tw-0LVZg@mail.gmail.com>
Message-ID: <54A9FA7F.2020600@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hey Thread(Jason,Yuri,Douglas...),

There are couple aspects about the ssl and connections in general and
as we talk about ssl port I first would like to put couple things on
the table.

* Squid is a http caching proxy and there for every feature which is
out of the http related scope should not be handled by squid at all.
* Any squid operation is an application level and there for is limited
by the software(kernel + squid).
* There is a difference between servers taking a load of 1k requests
per second to a SMB which handles about 50 requests per second.

In general it's better to not intercept a connection which is not
bump-able.
The decision about if to DROP\REJECT or ACCEPT the connection should
better not involve squid in general if possible.
Squid offers a very nice interface but if you compare the Linux kernel
forwarding capabilities compared to squid you would see that squid is
very limited in the userspace.

So in a case the helper only needs to "know" if the connection is
bump-able there are other alternatives in the Linux kernel!!
And if you need logs.. you can use the *helper*(which one you ever
choose to work with) to log...

So now for the real thing:
My opinion about external_acl vs other solutions is that if squid with
an external_acl works for you and you understand what it means from
performance and security aspects try it, test it and then use it.

But if your squid load is high and in the case squid slows down the
bumped connections too much(compared to linux forwarding) I would try
to use something like NFQUEUE to just test if the connection is
bump-able or not by IP and DST PORT.

 * some information about NFQUEUE
https://home.regit.org/netfilter-en/using-nfqueue-and-libnetfilter_queue/
http://suricata-ids.org/

* Some examples:
https://www.wzdftpd.net/redmine/projects/nfqueue-bindings/repository/entry/examples/rewrite.py
http://danmcinerney.org/reliable-dns-spoofing-with-python-scapy-nfqueue/
http://5d4a.wordpress.com/2011/08/25/having-fun-with-nfqueue-and-scapy/

A squid helper is nice but... a NFQUEUE helper that can verify if to
FORWARD or BUMP the connection would be a better suited solution to my
opinion.

All The Bests,
Eliezer Croitoru

On 01/05/2015 03:07 AM, Douglas Davenport wrote:
> Seems to me it would be more useful as an external ACL so that a
> decision could be made based on other factors eg src or dstdomain
> whether to deny or allow the un-bumpable connection.

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUqfp/AAoJENxnfXtQ8ZQUSwoH/icug7X4oexKW1hewZ+u6mUd
/MTS+0pfrcl3ZiKi3oNcYBbnI+o1oqDVgYdW2XKpeWuUaZpvDF0NsIsO0Aj+0kjy
BccCiofUQABKPuG2MtM4ODMUbouoob3eBWdVmbbRr3KWyAu0aPnjMHUWX5QeSAif
8FF38xQvnR4EOLi7UmT8UOV4iugloxg8feDjIxRcRPJalfAGrOyfGmFYuxoFELjg
7XMTTLkJW2DuteIl4M1cdKRSJKt/CUKah3z5D3EyDBQcHhV4xDUk3ncTLXXr1cZH
kLnkFQWC2Jq43S2zEin7STJE3zumWu/YN/s2Wj3oAmyPAQBAlkNpHB4VPoF9w+c=
=L6HT
-----END PGP SIGNATURE-----


From Jason_Haar at trimble.com  Mon Jan  5 03:19:26 2015
From: Jason_Haar at trimble.com (Jason Haar)
Date: Mon, 5 Jan 2015 16:19:26 +1300
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <54A9FA7F.2020600@ngtech.co.il>
References: <54A2A4AB.1000003@gmail.com> <54A2AF50.2070103@treenet.co.nz>
 <HKNPR04MB1933D74D5F5A53D56ED20C8E85F0@HKNPR04MB193.apcprd04.prod.outlook.com>
 <54A7A164.8010400@trimble.com> <54A7AC13.4020001@gmail.com>
 <CAOsHgtvHt7BshV-4nVr9Bh-VPj44wNmYNm2cor=NbBDOs=kBkw@mail.gmail.com>
 <54A9B0BB.1050509@gmail.com>
 <CAOsHgtsrTZ9kqhcWcJwVnhnbA8L9eX0DZJfdbM+zB4tw-0LVZg@mail.gmail.com>
 <54A9FA7F.2020600@ngtech.co.il>
Message-ID: <54AA02BE.7040309@trimble.com>

On 05/01/15 15:44, Eliezer Croitoru wrote:
> A squid helper is nice but... a NFQUEUE helper that can verify if to
> FORWARD or BUMP the connection would be a better suited solution to my
> opinion.
Not sure if you're ignoring the ssl-peek work, but squid still needs to
be able to "peek" in order for squid to know the actual HTTPS server
name the client is connecting to before it's able to call any external
helper/etc. As that involves understanding SSL (which is a huge chunk of
code) - that means it's not appropriate for a kernel solution - it has
to be done at Layer-7 (ie squid - but not some app called by squid as
that's too late to see the data it needs)

eg after hearing how James Harper wrote his own external "https-tester"
script, I've written my own and have been merrily testing it under
squid-3.4.10 (ie not 3.5 with "peek"). In proxy-mode it works great, the
"https-tester" script is passed the DNS name and port, it manually uses
curl to test that to ensure it's a real HTTPS server and returns OK,
else it returns ERR - making squid fall-back on passthrough/splice mode.
That means it can detect non-SSL apps, as well as client-cert protected
HTTPS webservers (which you also have to drop back to splice with - you
can never successfully MiTM a client-cert based SSL session).

However, the moment you try to do transparent https proxy, things break.
In that case, squid-3.4 only sees the destination IP, and "https_tester"
can only try to "curl -k https://ip.add.ress:port/" - which only works
for *some* webservers. A lot have WAFs on them and righteously ditch the
incoming connection when they recognise the client (my script) doesn't
know what their hostname is. eg any HTTPS site using cloudfront.net is
in that category. Of course it still works - but in passthrough mode -
which isn't the outcome we're after.

I'm going to have to look at squid-3.5 ;-)

-- 
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1



From yvoinov at gmail.com  Mon Jan  5 08:40:54 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 05 Jan 2015 14:40:54 +0600
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <54A9FA7F.2020600@ngtech.co.il>
References: <54A2A4AB.1000003@gmail.com> <54A2AF50.2070103@treenet.co.nz>
 <HKNPR04MB1933D74D5F5A53D56ED20C8E85F0@HKNPR04MB193.apcprd04.prod.outlook.com>
 <54A7A164.8010400@trimble.com> <54A7AC13.4020001@gmail.com>
 <CAOsHgtvHt7BshV-4nVr9Bh-VPj44wNmYNm2cor=NbBDOs=kBkw@mail.gmail.com>
 <54A9B0BB.1050509@gmail.com>
 <CAOsHgtsrTZ9kqhcWcJwVnhnbA8L9eX0DZJfdbM+zB4tw-0LVZg@mail.gmail.com>
 <54A9FA7F.2020600@ngtech.co.il>
Message-ID: <54AA4E16.8010707@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Sounds good,

but server world is not end on Linux. ;)

Now exists another *NIX systems. And will exists further.

Also. I have an idea, gents.

Do we can easy and quickly detect SSL Pinned destinations? And remember
it, for example, in database?

In another words - both problems is similar. Either non-HTTPS traffic
over 443 port, or pinned certs.

Can we detect both of them automatically and add to exclude list?

WBR, Yuri

05.01.2015 8:44, Eliezer Croitoru ?????:
> Hey Thread(Jason,Yuri,Douglas...),
>
> There are couple aspects about the ssl and connections in general and
> as we talk about ssl port I first would like to put couple things on
> the table.
>
> * Squid is a http caching proxy and there for every feature which is
> out of the http related scope should not be handled by squid at all.
> * Any squid operation is an application level and there for is limited
> by the software(kernel + squid).
> * There is a difference between servers taking a load of 1k requests
> per second to a SMB which handles about 50 requests per second.
>
> In general it's better to not intercept a connection which is not
> bump-able.
> The decision about if to DROP\REJECT or ACCEPT the connection should
> better not involve squid in general if possible.
> Squid offers a very nice interface but if you compare the Linux kernel
> forwarding capabilities compared to squid you would see that squid is
> very limited in the userspace.
>
> So in a case the helper only needs to "know" if the connection is
> bump-able there are other alternatives in the Linux kernel!!
> And if you need logs.. you can use the *helper*(which one you ever
> choose to work with) to log...
>
> So now for the real thing:
> My opinion about external_acl vs other solutions is that if squid with
> an external_acl works for you and you understand what it means from
> performance and security aspects try it, test it and then use it.
>
> But if your squid load is high and in the case squid slows down the
> bumped connections too much(compared to linux forwarding) I would try
> to use something like NFQUEUE to just test if the connection is
> bump-able or not by IP and DST PORT.
>
>  * some information about NFQUEUE
> https://home.regit.org/netfilter-en/using-nfqueue-and-libnetfilter_queue/
> http://suricata-ids.org/
>
> * Some examples:
>
https://www.wzdftpd.net/redmine/projects/nfqueue-bindings/repository/entry/examples/rewrite.py
> http://danmcinerney.org/reliable-dns-spoofing-with-python-scapy-nfqueue/
> http://5d4a.wordpress.com/2011/08/25/having-fun-with-nfqueue-and-scapy/
>
> A squid helper is nice but... a NFQUEUE helper that can verify if to
> FORWARD or BUMP the connection would be a better suited solution to my
> opinion.
>
> All The Bests,
> Eliezer Croitoru
>
> On 01/05/2015 03:07 AM, Douglas Davenport wrote:
> > Seems to me it would be more useful as an external ACL so that a
> > decision could be made based on other factors eg src or dstdomain
> > whether to deny or allow the un-bumpable connection.
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUqk4WAAoJENNXIZxhPexGWNoH/Ak2w0TZ+fU2Jy1bIOgWP82V
P5UJmB3DDSRwrqi4Y/bfUDGT1V3Cbjn8/RRTqTl7lSbBwGpSd8wSLGSTua6mqMY6
OIedOB7oBrJ9p8d1F7//ZsBrvGHequnD7Zp1DvBXVcptcVvFi56oAeFNjhRk1tcN
8EX2mkvgrDye7o7RRXPw1ukxbAJ0883A+gO3XpSARMUQEhsXJFFoygHUo7OIjdr+
oBrv/aypN8VOFvkHj50vDwtt4Rq7PPDYJRtHms2cIGsjK4+P1Rt1lxhr0GC/qbtZ
rfqIvP5LRmkID/lvHFhWC38APdjsgCcTICuJoPgKGDPX9YMAWtKdznu2XYpHNfw=
=LZkA
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150105/f666862b/attachment.htm>

From james at ejbdigital.com.au  Mon Jan  5 09:19:30 2015
From: james at ejbdigital.com.au (James Harper)
Date: Mon, 5 Jan 2015 09:19:30 +0000
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <54A7A164.8010400@trimble.com>
References: <54A2A4AB.1000003@gmail.com> <54A2AF50.2070103@treenet.co.nz>
 <HKNPR04MB1933D74D5F5A53D56ED20C8E85F0@HKNPR04MB193.apcprd04.prod.outlook.com>
 <54A7A164.8010400@trimble.com>
Message-ID: <HKNPR04MB193E7317B5C197CD5AC59CCE8580@HKNPR04MB193.apcprd04.prod.outlook.com>

> 
> On 01/01/15 00:11, James Harper wrote:
> > The helper connects to the IP:port and tries to obtain the certificate, and
> then caches the result (in an sqlite database). If it can't do so within a fairly
> short time it returns failure (but keeps trying a bit longer and caches it for
> next time). Alternatively if the IP used to be SSL but is now timing out it
> returns the previously cached value. Negative results are cached for an
> increasing amount of time each time it fails, on the basis that it probably isn't
> SSL.
> That sounds great James! I'd certainly like to take a look at it too
> 
> However, you say "SSL"  - did you mean "HTTPS"? ie discovering a ip:port
> is a IMAPS server doesn't really help squid talk to it - surely you want
> to discover HTTPS servers - and everything else should be
> pass-through/splice?
> 

Yes. That would be required for completeness, although maybe the certificate info would still be useful even if the underlying protocol wasn't http...

James

From eliezer at ngtech.co.il  Mon Jan  5 09:59:16 2015
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Mon, 05 Jan 2015 11:59:16 +0200
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <54AA4E16.8010707@gmail.com>
References: <54A2A4AB.1000003@gmail.com> <54A2AF50.2070103@treenet.co.nz>
 <HKNPR04MB1933D74D5F5A53D56ED20C8E85F0@HKNPR04MB193.apcprd04.prod.outlook.com>
 <54A7A164.8010400@trimble.com> <54A7AC13.4020001@gmail.com>
 <CAOsHgtvHt7BshV-4nVr9Bh-VPj44wNmYNm2cor=NbBDOs=kBkw@mail.gmail.com>
 <54A9B0BB.1050509@gmail.com>
 <CAOsHgtsrTZ9kqhcWcJwVnhnbA8L9eX0DZJfdbM+zB4tw-0LVZg@mail.gmail.com>
 <54A9FA7F.2020600@ngtech.co.il> <54AA4E16.8010707@gmail.com>
Message-ID: <54AA6074.7080105@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hey Yuri,

Indeed there are other *NIX systems and for each and every one of them
there is a solution in need.

SSL Pinned destinations cannot be identified automatically since the
are pinned inside a software and the certificate will not show
anything about that.
The basic tests we can do are:
- - The host is using ssl or tls or not at all(based on the selective
answer of the service)
- -
- - If the connection is using tls\ssl then inspect the components of
the certificate(such as rootCA validation against the local machine
certificates DB)

Depend on the goal of the certificate validation the decision will be
made to either allow the connection "uninspected" or to "bump" it as
is without any smart identification.

If indeed there is a database
sqlite3\mysql\postgres\redis\memcached\others it can be used in the
iptables level.
Also a point in this DB and this cache is that it will be persistent
so what so ever the *NIX system is there is an option once the IP +
port was tagged as non-bump-able it is better be in the FIREWALL level
override better then squid external_acl.
Reason: If the kernel does what it needs to do then squid should not
touch the packets.
It's not always right but it's a point in the issue.
I still do not know how to work with NFQUEUE and I am sure that there
is an option to make a fast decision and if not then let the
connection be BUMPED.

I have written a small golang script that can check couple things
about the ssl session at:
http://www1.ngtech.co.il/squid/ssl_helpers/ssl_validator.go

Besides this helper there is another script which do couple things in
another level.

##########
If any thing will be decided for squid internals it will be after a
proof of concept that we can implement together.
Can we take this thread to storm and put on the table a proof of
concept logic for ssl inspection\bumping and bypassing?

Eliezer

On 01/05/2015 10:40 AM, Yuri Voinov wrote:
> Sounds good,
> 
> but server world is not end on Linux. ;)
> 
> Now exists another *NIX systems. And will exists further.
> 
> Also. I have an idea, gents.
> 
> Do we can easy and quickly detect SSL Pinned destinations? And
> remember it, for example, in database?
> 
> In another words - both problems is similar. Either non-HTTPS
> traffic over 443 port, or pinned certs.
> 
> Can we detect both of them automatically and add to exclude list?
> 
> WBR, Yuri

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUqmB0AAoJENxnfXtQ8ZQUPKkH/RQmpV8bVcQ1HKMWYLgzDIY1
qcW5AtSsiuuSQsDjew336/jE6WajfT3e5jKvvEKnLc993klJJcxlpETMRfqA+ekK
nMnycoMGSX66bgnKb/TX2PBdUNqYj3WsC5ujDyQ/37VBYY7NNIc95VR5W460jj+F
X9/sErTOsgy2/cYJ3Mz1+sHzH/IleehnosAtWaPBqXPCvi8Q4ud+SUFa8O3xgTPG
7BMM26prgMT0C8mpC/GRnMydEn4Pir3E5FEgkNZmMB7ZeQuHp0ZVKwUzvHqW/WP3
7pUydl3JKn1KP4bo1gXNO5m1Bf+X3xa9OiUTbzZ7VFrVPxXa7gOVKgZdCWpktcg=
=K9bZ
-----END PGP SIGNATURE-----


From ag4ve.us at gmail.com  Mon Jan  5 10:56:27 2015
From: ag4ve.us at gmail.com (shawn wilson)
Date: Mon, 5 Jan 2015 05:56:27 -0500
Subject: [squid-users] More extensible helper facility [was: Squid 3 SSL
 bump: Google drive application could not connect}
Message-ID: <CAH_OBieC_y=FwaTPFYczMErHFjR6fcD5H9iMOAYdRiEi9mjLeg@mail.gmail.com>

Wouldn't it be better to have a pipe option (a helper with persistence -
I'm thinking of postfix options here) and a totally separate project to
handle encryption and mitm? If you had something independent to help, you
might be able to detect other protocols and handle them properly vs
different projects having different levels of bump-ability.

Not sure if we just need a better pipe facility and some script with
sslstrip and openssl could handle the rest (I think that's doable) or if
more would be required.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150105/f02752e6/attachment.htm>

From yvoinov at gmail.com  Mon Jan  5 11:46:33 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 05 Jan 2015 17:46:33 +0600
Subject: [squid-users] More extensible helper facility [was: Squid 3 SSL
 bump: Google drive application could not connect}
In-Reply-To: <CAH_OBieC_y=FwaTPFYczMErHFjR6fcD5H9iMOAYdRiEi9mjLeg@mail.gmail.com>
References: <CAH_OBieC_y=FwaTPFYczMErHFjR6fcD5H9iMOAYdRiEi9mjLeg@mail.gmail.com>
Message-ID: <54AA7999.6010608@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Don't think so.

AFAIK, the firewall-based/external router solution will be
OS/infrastructure-specific. Also, separate subsystem also will be heavy
and KISS-aware. I.e crutch. :)

So, I think all we need - good fast and scalable helper for external ACL
handling. May be with database. BerkeleyDB, for example.

BTW, I will prefer to keep ssl_crtd certs also in indexed database.

So, logically to have all this functionality either in ssl_crtd, or as
advanced helper. This vill be OS-specific aware and can be useful in any
usecases.


05.01.2015 16:56, shawn wilson ?????:
>
> Wouldn't it be better to have a pipe option (a helper with persistence
- I'm thinking of postfix options here) and a totally separate project
to handle encryption and mitm? If you had something independent to help,
you might be able to detect other protocols and handle them properly vs
different projects having different levels of bump-ability.
>
> Not sure if we just need a better pipe facility and some script with
sslstrip and openssl could handle the rest (I think that's doable) or if
more would be required.
>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUqnmZAAoJENNXIZxhPexGB80IAKD+Jw9XP3Dj2EdXUTKQbGrK
GFNm+IdctED2kRlnNXcVwWCZRHQdTjCn6VFqCnCd2RJ9q4IAR9KjyQrpxydX/q5P
is5HvuIDGvjLOkyIqLYulWdsnXBBFJ71oA2vqlVjRvMpLJDQfUoCFhbcEk/9TVy0
yGq6wDCLTl4R8qkCjTaWsLFtS9RVITzDaeSY7n0lmqhgLSddailRhHbu4eJs4PWK
z0E2dicP60Qq3qPB5eQatE3NM83AuJFQmAoNyMeoN7ovIbJ+32ARbP++H7mUdtTe
bhY6buAWzv3Rl5ItJA7jqWSEkMdGReTxGyG2VfkYJjN0W/FqNpUvdDB3LwkMdBI=
=ogt3
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150105/911397c4/attachment.htm>

From marcus.kool at urlfilterdb.com  Mon Jan  5 11:51:28 2015
From: marcus.kool at urlfilterdb.com (Marcus Kool)
Date: Mon, 05 Jan 2015 09:51:28 -0200
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <54AA6074.7080105@ngtech.co.il>
References: <54A2A4AB.1000003@gmail.com> <54A2AF50.2070103@treenet.co.nz>
 <HKNPR04MB1933D74D5F5A53D56ED20C8E85F0@HKNPR04MB193.apcprd04.prod.outlook.com>
 <54A7A164.8010400@trimble.com> <54A7AC13.4020001@gmail.com>
 <CAOsHgtvHt7BshV-4nVr9Bh-VPj44wNmYNm2cor=NbBDOs=kBkw@mail.gmail.com>
 <54A9B0BB.1050509@gmail.com>
 <CAOsHgtsrTZ9kqhcWcJwVnhnbA8L9eX0DZJfdbM+zB4tw-0LVZg@mail.gmail.com>
 <54A9FA7F.2020600@ngtech.co.il> <54AA4E16.8010707@gmail.com>
 <54AA6074.7080105@ngtech.co.il>
Message-ID: <54AA7AC0.7000707@urlfilterdb.com>

Much of the discussion so far has been about bumping traffic on port 443,
bumping SSL-encapsulated HTTP traffic and not bumping (allowing)
other traffic.  Since port 443 is used for many protocols, it is in many
cases dangerous to allow non-bumpable traffic: SSH tunnels using port 443
are common, so are VPNs.  Do you know a security officer who does not want
to block an SSH tunnel, or an app that can share corporate documents
on public websites?  If there is not more attention to these kinds of
applications that use port 443 to circumvent corporate firewalls,
Squid will be doomed to be used only in environments where the priority
for security is low to non-existent.  Just type "punching holes in corporate
firewalls" or "ssh tunnel proxy" in Google to see how easy it is to use an
SSH tunnel.

I am the author of ufdbGuard, a filter for Squid and besides filtering
based on URLs, ufdbGuard also probes port 443 to see what kind of traffic
the server is expecting.  By using probes, ufdbGuard can detect SSH tunnels,
popular chat protocols, etc. but it is not a 100% guaranteed solution
because ufdbGuard cannot not see the traffic that flows through the proxy,
i.e. there is not yet an interface for this type of traffic inspection.

Marcus


On 01/05/2015 07:59 AM, Eliezer Croitoru wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Hey Yuri,
>
> Indeed there are other *NIX systems and for each and every one of them
> there is a solution in need.
>
> SSL Pinned destinations cannot be identified automatically since the
> are pinned inside a software and the certificate will not show
> anything about that.
> The basic tests we can do are:
> - - The host is using ssl or tls or not at all(based on the selective
> answer of the service)
> - -
> - - If the connection is using tls\ssl then inspect the components of
> the certificate(such as rootCA validation against the local machine
> certificates DB)
>
> Depend on the goal of the certificate validation the decision will be
> made to either allow the connection "uninspected" or to "bump" it as
> is without any smart identification.
>
> If indeed there is a database
> sqlite3\mysql\postgres\redis\memcached\others it can be used in the
> iptables level.
> Also a point in this DB and this cache is that it will be persistent
> so what so ever the *NIX system is there is an option once the IP +
> port was tagged as non-bump-able it is better be in the FIREWALL level
> override better then squid external_acl.
> Reason: If the kernel does what it needs to do then squid should not
> touch the packets.
> It's not always right but it's a point in the issue.
> I still do not know how to work with NFQUEUE and I am sure that there
> is an option to make a fast decision and if not then let the
> connection be BUMPED.
>
> I have written a small golang script that can check couple things
> about the ssl session at:
> http://www1.ngtech.co.il/squid/ssl_helpers/ssl_validator.go
>
> Besides this helper there is another script which do couple things in
> another level.
>
> ##########
> If any thing will be decided for squid internals it will be after a
> proof of concept that we can implement together.
> Can we take this thread to storm and put on the table a proof of
> concept logic for ssl inspection\bumping and bypassing?
>
> Eliezer
>
> On 01/05/2015 10:40 AM, Yuri Voinov wrote:
>> Sounds good,
>>
>> but server world is not end on Linux. ;)
>>
>> Now exists another *NIX systems. And will exists further.
>>
>> Also. I have an idea, gents.
>>
>> Do we can easy and quickly detect SSL Pinned destinations? And
>> remember it, for example, in database?
>>
>> In another words - both problems is similar. Either non-HTTPS
>> traffic over 443 port, or pinned certs.
>>
>> Can we detect both of them automatically and add to exclude list?
>>
>> WBR, Yuri
>
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1
>
> iQEcBAEBAgAGBQJUqmB0AAoJENxnfXtQ8ZQUPKkH/RQmpV8bVcQ1HKMWYLgzDIY1
> qcW5AtSsiuuSQsDjew336/jE6WajfT3e5jKvvEKnLc993klJJcxlpETMRfqA+ekK
> nMnycoMGSX66bgnKb/TX2PBdUNqYj3WsC5ujDyQ/37VBYY7NNIc95VR5W460jj+F
> X9/sErTOsgy2/cYJ3Mz1+sHzH/IleehnosAtWaPBqXPCvi8Q4ud+SUFa8O3xgTPG
> 7BMM26prgMT0C8mpC/GRnMydEn4Pir3E5FEgkNZmMB7ZeQuHp0ZVKwUzvHqW/WP3
> 7pUydl3JKn1KP4bo1gXNO5m1Bf+X3xa9OiUTbzZ7VFrVPxXa7gOVKgZdCWpktcg=
> =K9bZ
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


From yvoinov at gmail.com  Mon Jan  5 12:46:51 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 05 Jan 2015 18:46:51 +0600
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <54AA7AC0.7000707@urlfilterdb.com>
References: <54A2A4AB.1000003@gmail.com> <54A2AF50.2070103@treenet.co.nz>
 <HKNPR04MB1933D74D5F5A53D56ED20C8E85F0@HKNPR04MB193.apcprd04.prod.outlook.com>
 <54A7A164.8010400@trimble.com> <54A7AC13.4020001@gmail.com>
 <CAOsHgtvHt7BshV-4nVr9Bh-VPj44wNmYNm2cor=NbBDOs=kBkw@mail.gmail.com>
 <54A9B0BB.1050509@gmail.com>
 <CAOsHgtsrTZ9kqhcWcJwVnhnbA8L9eX0DZJfdbM+zB4tw-0LVZg@mail.gmail.com>
 <54A9FA7F.2020600@ngtech.co.il> <54AA4E16.8010707@gmail.com>
 <54AA6074.7080105@ngtech.co.il> <54AA7AC0.7000707@urlfilterdb.com>
Message-ID: <54AA87BB.3060205@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
I think,

non-HTTP/HTTPS security issues is never ever Squid function.

Squid is not all-in-one-security-solution. It's only HTTP proxy.

For others security breches (i.e SSH tunnels, various browser
tunnel-related plugins, Tor etc., ) we have another tools. Cisco NBAR
proticol discovery, other DPI solution.

AFAIK, primitive Cisco extended ACL + tcpiputils.com and simple sniffer
can make miracles.

Following I offer to retirn to the Earth and limit our functionality as
I said before. Just HTTP/HTTPS over 443 port.

I understand that exists wonderful and overall solutions like ufdbGuard.
But we talk not about it.

05.01.2015 17:51, Marcus Kool ?????:
> Much of the discussion so far has been about bumping traffic on port 443,
> bumping SSL-encapsulated HTTP traffic and not bumping (allowing)
> other traffic.  Since port 443 is used for many protocols, it is in many
> cases dangerous to allow non-bumpable traffic: SSH tunnels using port 443
> are common, so are VPNs.  Do you know a security officer who does not want
> to block an SSH tunnel, or an app that can share corporate documents
> on public websites?  If there is not more attention to these kinds of
> applications that use port 443 to circumvent corporate firewalls,
> Squid will be doomed to be used only in environments where the priority
> for security is low to non-existent.  Just type "punching holes in
corporate
> firewalls" or "ssh tunnel proxy" in Google to see how easy it is to use an
> SSH tunnel.
>
> I am the author of ufdbGuard, a filter for Squid and besides filtering
> based on URLs, ufdbGuard also probes port 443 to see what kind of traffic
> the server is expecting.  By using probes, ufdbGuard can detect SSH
tunnels,
> popular chat protocols, etc. but it is not a 100% guaranteed solution
> because ufdbGuard cannot not see the traffic that flows through the proxy,
> i.e. there is not yet an interface for this type of traffic inspection.
>
> Marcus
>
>
> On 01/05/2015 07:59 AM, Eliezer Croitoru wrote:
> Hey Yuri,
>
> Indeed there are other *NIX systems and for each and every one of them
> there is a solution in need.
>
> SSL Pinned destinations cannot be identified automatically since the
> are pinned inside a software and the certificate will not show
> anything about that.
> The basic tests we can do are:
> - The host is using ssl or tls or not at all(based on the selective
> answer of the service)
> -
> - If the connection is using tls\ssl then inspect the components of
> the certificate(such as rootCA validation against the local machine
> certificates DB)
>
> Depend on the goal of the certificate validation the decision will be
> made to either allow the connection "uninspected" or to "bump" it as
> is without any smart identification.
>
> If indeed there is a database
> sqlite3\mysql\postgres\redis\memcached\others it can be used in the
> iptables level.
> Also a point in this DB and this cache is that it will be persistent
> so what so ever the *NIX system is there is an option once the IP +
> port was tagged as non-bump-able it is better be in the FIREWALL level
> override better then squid external_acl.
> Reason: If the kernel does what it needs to do then squid should not
> touch the packets.
> It's not always right but it's a point in the issue.
> I still do not know how to work with NFQUEUE and I am sure that there
> is an option to make a fast decision and if not then let the
> connection be BUMPED.
>
> I have written a small golang script that can check couple things
> about the ssl session at:
> http://www1.ngtech.co.il/squid/ssl_helpers/ssl_validator.go
>
> Besides this helper there is another script which do couple things in
> another level.
>
> ##########
> If any thing will be decided for squid internals it will be after a
> proof of concept that we can implement together.
> Can we take this thread to storm and put on the table a proof of
> concept logic for ssl inspection\bumping and bypassing?
>
> Eliezer
>
> On 01/05/2015 10:40 AM, Yuri Voinov wrote:
> >>> Sounds good,
> >>>
> >>> but server world is not end on Linux. ;)
> >>>
> >>> Now exists another *NIX systems. And will exists further.
> >>>
> >>> Also. I have an idea, gents.
> >>>
> >>> Do we can easy and quickly detect SSL Pinned destinations? And
> >>> remember it, for example, in database?
> >>>
> >>> In another words - both problems is similar. Either non-HTTPS
> >>> traffic over 443 port, or pinned certs.
> >>>
> >>> Can we detect both of them automatically and add to exclude list?
> >>>
> >>> WBR, Yuri
>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUqoe7AAoJENNXIZxhPexGJqoH/2byMvv1s1Qgk5Wh1EwB8ai/
B6wsw6IvHitGvkrS77OEkEtZYjMsbTEv7XEpZuBvsylIGTr8Zp9amyjcTLOG/A+2
3L4FwlC2QHj6plf4owN5i3ydKwByZP4qRw97Ydg6rsXM/UpD3ePZl9tWf4TVZDLf
4bv7EErFYN4tnVjsDEKYWfwfbvJkbbOwt/v1LHTyhyhJiP4Q+bQW3iqGfsgyaMbW
3frxeuZrjNikH3OC9eqFI+bY41n4IUkz5pKdItqzTCEDAo6NghJJrACeG+jQA2+Q
3WotAv33ErIe7DiRKgBmSRGbzfe5Cbgd4LVn5BUUbsDboRaVb6NrIu2kwzE03OY=
=nev9
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150105/90bc952a/attachment.htm>

From yvoinov at gmail.com  Mon Jan  5 13:11:04 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 05 Jan 2015 19:11:04 +0600
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <54AA7AC0.7000707@urlfilterdb.com>
References: <54A2A4AB.1000003@gmail.com> <54A2AF50.2070103@treenet.co.nz>
 <HKNPR04MB1933D74D5F5A53D56ED20C8E85F0@HKNPR04MB193.apcprd04.prod.outlook.com>
 <54A7A164.8010400@trimble.com> <54A7AC13.4020001@gmail.com>
 <CAOsHgtvHt7BshV-4nVr9Bh-VPj44wNmYNm2cor=NbBDOs=kBkw@mail.gmail.com>
 <54A9B0BB.1050509@gmail.com>
 <CAOsHgtsrTZ9kqhcWcJwVnhnbA8L9eX0DZJfdbM+zB4tw-0LVZg@mail.gmail.com>
 <54A9FA7F.2020600@ngtech.co.il> <54AA4E16.8010707@gmail.com>
 <54AA6074.7080105@ngtech.co.il> <54AA7AC0.7000707@urlfilterdb.com>
Message-ID: <54AA8D68.6020903@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
And also:

don't forget about bogus homebrew internet-bankings. Which is uses bogus
SSL-certs with bogus GOST realisations. And bogus Java-based clients.
All of them also uses 443 port. And often HTTPS with homebrew bogus
features.

We don't know, how to bump it.

What about it? Pass-through? Pass-through.

This is clean exclusion.

So don't worry about SSH/Tor. To block them we will be use another
solutions. DPI. And not always technical. Revoke administrative rights
from clients is basics of security, like physical access to
infrastructure. If they can't install Tor/SSH - why we can worry about
this traffic?

We have (and can solve) two simple problems. HTTP over 443 port. And SSL
Pinning. That's all, folks.

05.01.2015 17:51, Marcus Kool ?????:
> Much of the discussion so far has been about bumping traffic on port 443,
> bumping SSL-encapsulated HTTP traffic and not bumping (allowing)
> other traffic.  Since port 443 is used for many protocols, it is in many
> cases dangerous to allow non-bumpable traffic: SSH tunnels using port 443
> are common, so are VPNs.  Do you know a security officer who does not want
> to block an SSH tunnel, or an app that can share corporate documents
> on public websites?  If there is not more attention to these kinds of
> applications that use port 443 to circumvent corporate firewalls,
> Squid will be doomed to be used only in environments where the priority
> for security is low to non-existent.  Just type "punching holes in
corporate
> firewalls" or "ssh tunnel proxy" in Google to see how easy it is to use an
> SSH tunnel.
>
> I am the author of ufdbGuard, a filter for Squid and besides filtering
> based on URLs, ufdbGuard also probes port 443 to see what kind of traffic
> the server is expecting.  By using probes, ufdbGuard can detect SSH
tunnels,
> popular chat protocols, etc. but it is not a 100% guaranteed solution
> because ufdbGuard cannot not see the traffic that flows through the proxy,
> i.e. there is not yet an interface for this type of traffic inspection.
>
> Marcus
>
>
> On 01/05/2015 07:59 AM, Eliezer Croitoru wrote:
> Hey Yuri,
>
> Indeed there are other *NIX systems and for each and every one of them
> there is a solution in need.
>
> SSL Pinned destinations cannot be identified automatically since the
> are pinned inside a software and the certificate will not show
> anything about that.
> The basic tests we can do are:
> - The host is using ssl or tls or not at all(based on the selective
> answer of the service)
> -
> - If the connection is using tls\ssl then inspect the components of
> the certificate(such as rootCA validation against the local machine
> certificates DB)
>
> Depend on the goal of the certificate validation the decision will be
> made to either allow the connection "uninspected" or to "bump" it as
> is without any smart identification.
>
> If indeed there is a database
> sqlite3\mysql\postgres\redis\memcached\others it can be used in the
> iptables level.
> Also a point in this DB and this cache is that it will be persistent
> so what so ever the *NIX system is there is an option once the IP +
> port was tagged as non-bump-able it is better be in the FIREWALL level
> override better then squid external_acl.
> Reason: If the kernel does what it needs to do then squid should not
> touch the packets.
> It's not always right but it's a point in the issue.
> I still do not know how to work with NFQUEUE and I am sure that there
> is an option to make a fast decision and if not then let the
> connection be BUMPED.
>
> I have written a small golang script that can check couple things
> about the ssl session at:
> http://www1.ngtech.co.il/squid/ssl_helpers/ssl_validator.go
>
> Besides this helper there is another script which do couple things in
> another level.
>
> ##########
> If any thing will be decided for squid internals it will be after a
> proof of concept that we can implement together.
> Can we take this thread to storm and put on the table a proof of
> concept logic for ssl inspection\bumping and bypassing?
>
> Eliezer
>
> On 01/05/2015 10:40 AM, Yuri Voinov wrote:
> >>> Sounds good,
> >>>
> >>> but server world is not end on Linux. ;)
> >>>
> >>> Now exists another *NIX systems. And will exists further.
> >>>
> >>> Also. I have an idea, gents.
> >>>
> >>> Do we can easy and quickly detect SSL Pinned destinations? And
> >>> remember it, for example, in database?
> >>>
> >>> In another words - both problems is similar. Either non-HTTPS
> >>> traffic over 443 port, or pinned certs.
> >>>
> >>> Can we detect both of them automatically and add to exclude list?
> >>>
> >>> WBR, Yuri
>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUqo1oAAoJENNXIZxhPexGCqQIAKbEd2gclvG8FZHDS5RwotFa
wPA+I+uLv0nfUO9whuWkJQmhCpCd0cPpyn1KVxiLe8g0CfcOu15uFZJGCOOdVjDV
NGPsuZLZPMrhKPmZaRy4YmMw2zpbQTQXGtHmoFA2GPNaIXyG5fEAyZ1oDYTyOuz5
djlAka3A01FE24TLT1mWREQEqb1YEtEwrzPyo5I/p5XEpnyR22ByA7Pam7cEsMXf
+lVJSLAzcIrT6j+wp1PoJuHEUDkDlhl8aRuL3VndMk6MLkZ6TA7HLRFLx8FGzAmC
0fu6yEthb3QSrNnqTd0Lk22N/WTl3E0M4pYOsChSRlHByEV9RN1OiSryOAkodGU=
=XVuO
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150105/4859a76c/attachment.htm>

From vdoctor at neuf.fr  Mon Jan  5 13:20:46 2015
From: vdoctor at neuf.fr (Stakres)
Date: Mon, 5 Jan 2015 05:20:46 -0800 (PST)
Subject: [squid-users] Squid 2.7,
 3.4 and 3.5 Videos/Music/Images/Libraris/CDNs Booster
In-Reply-To: <1419155198462-4668803.post@n4.nabble.com>
References: <1418374260739-4668683.post@n4.nabble.com>
 <004501d01673$0f445150$2dccf3f0$@netstream.ps>
 <1418415837677-4668693.post@n4.nabble.com>
 <1418628416193-4668707.post@n4.nabble.com>
 <1418825003303-4668738.post@n4.nabble.com>
 <1419155198462-4668803.post@n4.nabble.com>
Message-ID: <1420464046420-4668929.post@n4.nabble.com>

Hi All,

Advanced Caching Add-On for Linux Squid Proxy Cache for Videos, Music,
Images, Libraries and CDNs.

By default your existing Squid Proxy Cache cannot properly cache most
popular multi-media websites like YouTube, Netflix, Facebook, DailyMotion,
Vimeo, Vevo, Google Maps & Apps, Apple, Tumblr, Yandex, etc...
Now there is a quick and easy solution within 5 minutes you can load this
Squid add-on to significantly improve the caching possibilities and
performance of your Squid Proxy Cache.
More than *600+ websites* are already supported and can be cached
automatically in order to get the best out of your existing Internet
bandwidth.

List of all supported web sites (600+)
<http://www.unveiltech.com/videosboost.php>  
SquidVideoBooster works with Squid v2.7, v3.4 and v3.5.

New version 2.24 including new websites - January 5th 2015.
More details on  https://svb.unveiltech.com <https://svb.unveiltech.com>  

Enjoy 

Bye Fred



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-2-7-3-4-and-3-5-Videos-Music-Images-Libraries-CDNs-Booster-tp4668683p4668929.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From priyaiitmandi at gmail.com  Mon Jan  5 13:27:22 2015
From: priyaiitmandi at gmail.com (Priya Agarwal)
Date: Mon, 5 Jan 2015 18:57:22 +0530
Subject: [squid-users] Squid Source Code: What files/functions receive/send
	packets from/to hardware
Message-ID: <CALTPfpHJ_CX8T7YiwU0knvAyQD72VA5HZqYsdPvBqi4ABtkMPQ@mail.gmail.com>

Hi.

I am Priya. I want to modify the squid code only in places where it is
actually communicating with the hardware to send or receive packets. I do
not intent to change its functionality or how it works.

I am facing some difficulty in understanding the full code. If I could get
some hints on for e.g. which functions/files are involved receiving and
storing the packet data, or which structures hold the received/sent data
etc., my work would become more streamlined.

My purpose is to add some extra code wherever the application wants to send
or receive the packets.

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150105/66dbd29a/attachment.htm>

From yvoinov at gmail.com  Mon Jan  5 13:28:44 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 05 Jan 2015 19:28:44 +0600
Subject: [squid-users] Squid 2.7,
 3.4 and 3.5 Videos/Music/Images/Libraris/CDNs Booster
In-Reply-To: <1420464046420-4668929.post@n4.nabble.com>
References: <1418374260739-4668683.post@n4.nabble.com>
 <004501d01673$0f445150$2dccf3f0$@netstream.ps>
 <1418415837677-4668693.post@n4.nabble.com>
 <1418628416193-4668707.post@n4.nabble.com>
 <1418825003303-4668738.post@n4.nabble.com>
 <1419155198462-4668803.post@n4.nabble.com>
 <1420464046420-4668929.post@n4.nabble.com>
Message-ID: <54AA918C.10300@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
This is not right.

We HAVE good cache solution in our current Squid proxy.

It named storeid_file_rewrite. And it built in Squid by default.

All we need - right config for it.

We have it. It's quick and easy solution with half-dozen regular
expressions. And we achieve 70% hit-ratio for dynamic content.

So, we don't need any hardcoded commercial analogue.

Bye.

05.01.2015 19:20, Stakres ?????:
> Hi All,
>
> Advanced Caching Add-On for Linux Squid Proxy Cache for Videos, Music,
> Images, Libraries and CDNs.
>
> By default your existing Squid Proxy Cache cannot properly cache most
> popular multi-media websites like YouTube, Netflix, Facebook, DailyMotion,
> Vimeo, Vevo, Google Maps & Apps, Apple, Tumblr, Yandex, etc...
> Now there is a quick and easy solution within 5 minutes you can load this
> Squid add-on to significantly improve the caching possibilities and
> performance of your Squid Proxy Cache.
> More than *600+ websites* are already supported and can be cached
> automatically in order to get the best out of your existing Internet
> bandwidth.
>
> List of all supported web sites (600+)
> <http://www.unveiltech.com/videosboost.php> 
> SquidVideoBooster works with Squid v2.7, v3.4 and v3.5.
>
> New version 2.24 including new websites - January 5th 2015.
> More details on  https://svb.unveiltech.com <https://svb.unveiltech.com> 
>
> Enjoy
>
> Bye Fred
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-2-7-3-4-and-3-5-Videos-Music-Images-Libraries-CDNs-Booster-tp4668683p4668929.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUqpGMAAoJENNXIZxhPexGat8IAIScZYH+UIDJQ7DdT8Mps6el
dki8rA4A/cDNQk3KRigkHngN2UJIoTtGGj6/jr9UibgcSBc1X7P/xyyjtIdzYxpp
8JNI4mbEzQOiyVsxvH3L0ymd4ZKqSKhRoN7ePc8vO6+9Tm8AJm6wVc9Ozaa8D0Tw
gEhtmIdA1qnSZTbbqUprj8Jzbf4Y2LkwuD9DOmnTNWDqyVkuYruwbJ81asSr0/eA
9eQoB4AU9holURXpZL+j678/QxNvum5Vb39A9BEUL0sLcoIlb0hi37Gf1yCd3A/w
sM9AhN1QetvCkkc+RU6H4Fc6+hgOOifeWkltDhk2bVP28kEoLWn1cxAlPOTFWBE=
=SrAY
-----END PGP SIGNATURE-----



From vdoctor at neuf.fr  Mon Jan  5 13:47:22 2015
From: vdoctor at neuf.fr (Stakres)
Date: Mon, 5 Jan 2015 05:47:22 -0800 (PST)
Subject: [squid-users] Squid 2.7,
 3.4 and 3.5 Videos/Music/Images/Libraris/CDNs Booster
In-Reply-To: <54AA918C.10300@gmail.com>
References: <1418374260739-4668683.post@n4.nabble.com>
 <004501d01673$0f445150$2dccf3f0$@netstream.ps>
 <1418415837677-4668693.post@n4.nabble.com>
 <1418628416193-4668707.post@n4.nabble.com>
 <1418825003303-4668738.post@n4.nabble.com>
 <1419155198462-4668803.post@n4.nabble.com>
 <1420464046420-4668929.post@n4.nabble.com> <54AA918C.10300@gmail.com>
Message-ID: <1420465642362-4668933.post@n4.nabble.com>

Hi Yuri,

Does the "we don't need" means "you don't need" or do you speak for all
users of Squid ?

We have done tons of tests with the "storeid_file_rewrite", sorry to tell
you it does not achieve 70% because:
- The prog you provide is nude, I mean there is 1 example only
- Admins have to check hundred of websites to correctly add them into the
process
- All do not know Perl langage
- Many websites are specific in their URLs like YouTube, Akamai, etc...

So, I perfectly understand the "/we don't need any hardcoded commercial
analogue./" but correct me if I'm wrong you're not alone on the planet,
correct ?
There are admins looking for a complete solution because they have no free
time to spend by doing the de-duplication by themselves. My message is to
inform them, if you're not interested no problem but some want to be
updated.

Thanks in advance to keep my post safe.
If this type of message is not accepted in this forum, ok just let me know.

Bye Fred




--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-2-7-3-4-and-3-5-Videos-Music-Images-Libraries-CDNs-Booster-tp4668683p4668933.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From yvoinov at gmail.com  Mon Jan  5 13:52:10 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 05 Jan 2015 19:52:10 +0600
Subject: [squid-users] Squid 2.7,
 3.4 and 3.5 Videos/Music/Images/Libraris/CDNs Booster
In-Reply-To: <1420465642362-4668933.post@n4.nabble.com>
References: <1418374260739-4668683.post@n4.nabble.com>
 <004501d01673$0f445150$2dccf3f0$@netstream.ps>
 <1418415837677-4668693.post@n4.nabble.com>
 <1418628416193-4668707.post@n4.nabble.com>
 <1418825003303-4668738.post@n4.nabble.com>
 <1419155198462-4668803.post@n4.nabble.com>
 <1420464046420-4668929.post@n4.nabble.com> <54AA918C.10300@gmail.com>
 <1420465642362-4668933.post@n4.nabble.com>
Message-ID: <54AA970A.9080604@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Sure :)

do not be offended. :)

But regexp is great, is it? ;)

05.01.2015 19:47, Stakres ?????:
> Hi Yuri,
>
> Does the "we don't need" means "you don't need" or do you speak for all
> users of Squid ?
>
> We have done tons of tests with the "storeid_file_rewrite", sorry to tell
> you it does not achieve 70% because:
> - The prog you provide is nude, I mean there is 1 example only
> - Admins have to check hundred of websites to correctly add them into the
> process
> - All do not know Perl langage
> - Many websites are specific in their URLs like YouTube, Akamai, etc...
>
> So, I perfectly understand the "/we don't need any hardcoded commercial
> analogue./" but correct me if I'm wrong you're not alone on the planet,
> correct ?
> There are admins looking for a complete solution because they have no free
> time to spend by doing the de-duplication by themselves. My message is to
> inform them, if you're not interested no problem but some want to be
> updated.
>
> Thanks in advance to keep my post safe.
> If this type of message is not accepted in this forum, ok just let me
know.
>
> Bye Fred
>
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-2-7-3-4-and-3-5-Videos-Music-Images-Libraries-CDNs-Booster-tp4668683p4668933.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUqpcKAAoJENNXIZxhPexGa4AH/0WI05O24H29GvSAFIz/RuJ8
iHyHOxRI57atWCfauzetlOqw448a4JsDOSP4srShQ1e+xs+3pCkGN9+7MN5DuXPt
GZafTEkaCbtRg28sTFPFenf6NeRCk4xNjWQOXSvnphok3BwQOk6O752XeK44Ktna
VRtz3pXGUJw6+1LcwuqmeieMmA1N+zQRSiflmgyIq8EDvrX7va57f5A9UZBLt/vA
mFDCI3wTPlIEXkSY1qsuDaSj4vLHKrSSxDiVkSpNyOD9xQ1bkDvlxHzZ2/9iMa7X
tV+6Kpp7Bc6wPg8VUlRXYD1/2C9lRYmc6HYjLGiFEckPhSgZukeC/M8N86ssBFA=
=6m45
-----END PGP SIGNATURE-----



From yvoinov at gmail.com  Mon Jan  5 13:54:35 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 05 Jan 2015 19:54:35 +0600
Subject: [squid-users] Squid 2.7,
 3.4 and 3.5 Videos/Music/Images/Libraris/CDNs Booster
In-Reply-To: <1420465642362-4668933.post@n4.nabble.com>
References: <1418374260739-4668683.post@n4.nabble.com>
 <004501d01673$0f445150$2dccf3f0$@netstream.ps>
 <1418415837677-4668693.post@n4.nabble.com>
 <1418628416193-4668707.post@n4.nabble.com>
 <1418825003303-4668738.post@n4.nabble.com>
 <1419155198462-4668803.post@n4.nabble.com>
 <1420464046420-4668929.post@n4.nabble.com> <54AA918C.10300@gmail.com>
 <1420465642362-4668933.post@n4.nabble.com>
Message-ID: <54AA979B.7060803@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Just look at this one:

^http:\/\/[^\.]+\.c\.youtube\.com\/videoplayback\?.*?id=([^&]+)&.*?itag=([^&]+)&.*?range=([^&]+).*   
http://video-srv.youtube.com.SQUIDINTERNAL/$1&$2&$3
^https:\/\/[^\.]+\.c\.youtube\.com\/videoplayback\?.*?id=([^&]+)&.*?itag=([^&]+)&.*?range=([^&]+).*   
https://video-srv.youtube.com.SQUIDINTERNAL/$1&$2&$3
^http:\/\/[a-zA-Z0-9\-\_\.]+\.ytimg\.com\/(.*\.jpg|.*\.gif|.*\.js)/   
http://cdn.ytimg.SQUIDINTERNAL/$1
^https:\/\/[a-zA-Z0-9\-\_\.]+\.ytimg\.com\/(.*\.jpg|.*\.gif|.*\.js)/   
https://cdn.ytimg.SQUIDINTERNAL/$1
^http:\/\/(.*?)\/(ads)\?(?:.*?)$    http://$1/$2
^https:\/\/(.*?)\/(ads)\?(?:.*?)$    https://$1/$2
^http:\/\/(?:(?:[A-Za-z]+[0-9-.]+)*?)\.(.*?)\.(.*?)\/(.*?)\.(.*?)\?(?:.*?)$   
http://cdn.$1.$2.SQUIDINTERNAL/$3.$4
^https:\/\/(?:(?:[A-Za-z]+[0-9-.]+)*?)\.(.*?)\.(.*?)\/(.*?)\.(.*?)\?(?:.*?)$   
https://cdn.$1.$2.SQUIDINTERNAL/$3.$4
^http:\/\/(?:(?:[A-Za-z]+[0-9-.]+)*?)\.(.*?)\.(.*?)\/(.*?)\.(.{3,5})$       
http://cdn.$1.$2.SQUIDINTERNAL/$3.$4
^https:\/\/(?:(?:[A-Za-z]+[0-9-.]+)*?)\.(.*?)\.(.*?)\/(.*?)\.(.{3,5})$       
https://cdn.$1.$2.SQUIDINTERNAL/$3.$4
^http:\/\/(?:(?:[A-Za-z]+[0-9-.]+)*?)\.(.*?)\.(.*?)\/(.*?)$           
http://cdn.$1.$2.SQUIDINTERNAL/$3
^https:\/\/(?:(?:[A-Za-z]+[0-9-.]+)*?)\.(.*?)\.(.*?)\/(.*?)$           
https://cdn.$1.$2.SQUIDINTERNAL/$3
^http:\/\/(.*?)\/(.*?)\.(jp(?:e?g|e|2)|gif|png|tiff?|bmp|ico|flv)\?(?:.*?)$   
http://$1/$2.$3
^https:\/\/(.*?)\/(.*?)\.(jp(?:e?g|e|2)|gif|png|tiff?|bmp|ico|flv)\?(?:.*?)$   
https://$1/$2.$3
^http:\/\/(.*?)\/(.*?)\;(?:.*?)$                        http://$1/$2
^https:\/\/(.*?)\/(.*?)\;(?:.*?)$                        https://$1/$2

This is my config for store_url_rewrite.

Just check it.

After that we talk about "70%" again, ok? ;)

05.01.2015 19:47, Stakres ?????:
> Hi Yuri,
>
> Does the "we don't need" means "you don't need" or do you speak for all
> users of Squid ?
>
> We have done tons of tests with the "storeid_file_rewrite", sorry to tell
> you it does not achieve 70% because:
> - The prog you provide is nude, I mean there is 1 example only
> - Admins have to check hundred of websites to correctly add them into the
> process
> - All do not know Perl langage
> - Many websites are specific in their URLs like YouTube, Akamai, etc...
>
> So, I perfectly understand the "/we don't need any hardcoded commercial
> analogue./" but correct me if I'm wrong you're not alone on the planet,
> correct ?
> There are admins looking for a complete solution because they have no free
> time to spend by doing the de-duplication by themselves. My message is to
> inform them, if you're not interested no problem but some want to be
> updated.
>
> Thanks in advance to keep my post safe.
> If this type of message is not accepted in this forum, ok just let me
know.
>
> Bye Fred
>
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-2-7-3-4-and-3-5-Videos-Music-Images-Libraries-CDNs-Booster-tp4668683p4668933.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUqpeaAAoJENNXIZxhPexG4vcH/iTSvdThJzvLimkbmHut7wX0
iKUr4foJV5dtnwtkQ7oE1wmMML+ev0jyTNWDj0g+hEBJKrvxw0Yrsw6OjcE14fra
1hQir07wW9G0rgJKjQKISItelL+6uwHRfatWb7eJdbI+hZRTO4VEygbZO1JtT+P9
l+vGzAcj7rQ0KEu36bg+uYm9daWqt9cj0uLttd8rrld34Oa40CVY4NYbkzUht9sQ
Aqz5nGvo/vY127Ij+oeZ3X82TUAjhg09VORZisFhha3/cgOR5WIcnFnhLvocikUc
Xf2IN4B1/JrgcTPxcDreFhtnAmxAEncYn8sEvzuFbO08tNAN3Ieny880aTstEmQ=
=4cl5
-----END PGP SIGNATURE-----



From vdoctor at neuf.fr  Mon Jan  5 14:02:49 2015
From: vdoctor at neuf.fr (Stakres)
Date: Mon, 5 Jan 2015 06:02:49 -0800 (PST)
Subject: [squid-users] Squid 2.7,
 3.4 and 3.5 Videos/Music/Images/Libraris/CDNs Booster
In-Reply-To: <54AA979B.7060803@gmail.com>
References: <1418374260739-4668683.post@n4.nabble.com>
 <004501d01673$0f445150$2dccf3f0$@netstream.ps>
 <1418415837677-4668693.post@n4.nabble.com>
 <1418628416193-4668707.post@n4.nabble.com>
 <1418825003303-4668738.post@n4.nabble.com>
 <1419155198462-4668803.post@n4.nabble.com>
 <1420464046420-4668929.post@n4.nabble.com> <54AA918C.10300@gmail.com>
 <1420465642362-4668933.post@n4.nabble.com> <54AA979B.7060803@gmail.com>
Message-ID: <1420466569640-4668936.post@n4.nabble.com>

Yuri,

Do not worry, I need more ot be offended 
Yes regexp is great but this is not clear for all, I mean they have to
understand regexp and speak Perl...

Nice to see you reach 70% with your rules, I really doubt about the 70% with
those simple rules but I'm ready to believe you.
Maybe you could use our plugin for some tests, maybe you'll reach 80+% and
maybe you'll abandon your script... 

Bye Fred



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-2-7-3-4-and-3-5-Videos-Music-Images-Libraries-CDNs-Booster-tp4668683p4668936.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From yvoinov at gmail.com  Mon Jan  5 14:09:48 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 05 Jan 2015 20:09:48 +0600
Subject: [squid-users] Squid 2.7,
 3.4 and 3.5 Videos/Music/Images/Libraris/CDNs Booster
In-Reply-To: <1420466569640-4668936.post@n4.nabble.com>
References: <1418374260739-4668683.post@n4.nabble.com>
 <004501d01673$0f445150$2dccf3f0$@netstream.ps>
 <1418415837677-4668693.post@n4.nabble.com>
 <1418628416193-4668707.post@n4.nabble.com>
 <1418825003303-4668738.post@n4.nabble.com>
 <1419155198462-4668803.post@n4.nabble.com>
 <1420464046420-4668929.post@n4.nabble.com> <54AA918C.10300@gmail.com>
 <1420465642362-4668933.post@n4.nabble.com> <54AA979B.7060803@gmail.com>
 <1420466569640-4668936.post@n4.nabble.com>
Message-ID: <54AA9B2C.4060601@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
May be.

Now on my production server hit ratio is:

http://i.imgur.com/7E6RXq7.png

Yes, regular expressions takes long time to debug for me. :) Also, this
is not at all - I also use very custom refresh_pattern rules. Which is
violates HTTP. ;)

BTW, 80% and above hit ratio is my aim too. WIll be interested in to
check your solution.

05.01.2015 20:02, Stakres ?????:
> Yuri,
>
> Do not worry, I need more ot be offended
> Yes regexp is great but this is not clear for all, I mean they have to
> understand regexp and speak Perl...
>
> Nice to see you reach 70% with your rules, I really doubt about the
70% with
> those simple rules but I'm ready to believe you.
> Maybe you could use our plugin for some tests, maybe you'll reach 80+% and
> maybe you'll abandon your script...
>
> Bye Fred
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-2-7-3-4-and-3-5-Videos-Music-Images-Libraries-CDNs-Booster-tp4668683p4668936.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUqpssAAoJENNXIZxhPexGTa4IAKI7cFNqmWVif//7YXcPgvjP
g3NhTTbPJdyr1FLVEE0Q3+27PBKyZMxge8tAg0WLz8hVr4wtr74+MwVq4YIyYCUX
siWEOBnWtfktY4usPXOBAPcfQwVnwSQkFPFFrA4AAz0suro9ZPSi/pU8+N8w54YT
6waUWQb570RI5+xhEAS+ZJGSkuSmY9/g97phupm0LMkQec3DWMXMYT/2shOwqHlH
LSg/f033MrBNhZw86Bik/sLiQQrGhZxwYJrO0YZ4zQn4heX3jobcrlbcVEqt4LCe
JVujdhczyRMuHRnakfPJNcYxpEToN29nI9dXgirBK4rCP7KHhxjBCvGCTVSozsQ=
=cFwM
-----END PGP SIGNATURE-----



From marcus.kool at urlfilterdb.com  Mon Jan  5 14:10:04 2015
From: marcus.kool at urlfilterdb.com (Marcus Kool)
Date: Mon, 05 Jan 2015 12:10:04 -0200
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <54AA8D68.6020903@gmail.com>
References: <54A2A4AB.1000003@gmail.com> <54A2AF50.2070103@treenet.co.nz>
 <HKNPR04MB1933D74D5F5A53D56ED20C8E85F0@HKNPR04MB193.apcprd04.prod.outlook.com>
 <54A7A164.8010400@trimble.com> <54A7AC13.4020001@gmail.com>
 <CAOsHgtvHt7BshV-4nVr9Bh-VPj44wNmYNm2cor=NbBDOs=kBkw@mail.gmail.com>
 <54A9B0BB.1050509@gmail.com>
 <CAOsHgtsrTZ9kqhcWcJwVnhnbA8L9eX0DZJfdbM+zB4tw-0LVZg@mail.gmail.com>
 <54A9FA7F.2020600@ngtech.co.il> <54AA4E16.8010707@gmail.com>
 <54AA6074.7080105@ngtech.co.il> <54AA7AC0.7000707@urlfilterdb.com>
 <54AA8D68.6020903@gmail.com>
Message-ID: <54AA9B3C.7000604@urlfilterdb.com>



On 01/05/2015 11:11 AM, Yuri Voinov wrote:
>
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> And also:
>
> don't forget about bogus homebrew internet-bankings. Which is uses bogus SSL-certs with bogus GOST realisations. And bogus Java-based clients. All of them also uses 443 port. And often HTTPS with
> homebrew bogus features.
>
> We don't know, how to bump it.
>
> What about it? Pass-through? Pass-through.
>
> This is clean exclusion.
>
> So don't worry about SSH/Tor. To block them we will be use another solutions. DPI. And not always technical. Revoke administrative rights from clients is basics of security, like physical access to
> infrastructure. If they can't install Tor/SSH - why we can worry about this traffic?
>
> We have (and can solve) two simple problems. HTTP over 443 port. And SSL Pinning. That's all, folks.

It is clear what *you* want.
You prefer  Squid + HTTP filter + Cisco/DPI + tcputils + sniffer + manual maintenance of ACLs/exclude list


> 05.01.2015 17:51, Marcus Kool ?????:
>> Much of the discussion so far  has been about bumping traffic on port 443,
>  > bumping SSL-encapsulated HTTP traffic and not bumping (allowing)
>  > other traffic.  Since port 443 is used for many protocols, it is in many
>  > cases dangerous to allow non-bumpable traffic: SSH tunnels using port 443
>  > are common, so are VPNs.  Do you know a security officer who does not want
>  > to block an SSH tunnel, or an app that can share corporate documents
>  > on public websites?  If there is not more attention to these kinds of
>  > applications that use port 443 to circumvent corporate firewalls,
>  > Squid will be doomed to be used only in environments where the priority
>  > for security is low to non-existent.  Just type "punching holes in corporate
>  > firewalls" or "ssh tunnel proxy" in Google to see how easy it is to use an
>  > SSH tunnel.
>  >
>  > I am the author of ufdbGuard, a filter for Squid and besides filtering
>  > based on URLs, ufdbGuard also probes port 443 to see what kind of traffic
>  > the server is expecting.  By using probes, ufdbGuard can detect SSH tunnels,
>  > popular chat protocols, etc. but it is not a 100% guaranteed solution
>  > because ufdbGuard cannot not see the traffic that flows through the proxy,
>  > i.e. there is not yet an interface for this type of traffic inspection.
>  >
>  > Marcus
>  >
>  >
>  > On 01/05/2015 07:59 AM, Eliezer Croitoru wrote:
>  > Hey Yuri,
>  >
>  > Indeed there are other *NIX systems and for each and every one of them
>  > there is a solution in need.
>  >
>  > SSL Pinned destinations cannot be identified automatically since the
>  > are pinned inside a software and the certificate will not show
>  > anything about that.
>  > The basic tests we can do are:
>  > - The host is using ssl or tls or not at all(based on the selective
>  > answer of the service)
>  > -
>  > - If the connection is using tls\ssl then inspect the components of
>  > the certificate(such as rootCA validation against the local machine
>  > certificates DB)
>  >
>  > Depend on the goal of the certificate validation the decision will be
>  > made to either allow the connection "uninspected" or to "bump" it as
>  > is without any smart identification.
>  >
>  > If indeed there is a database
>  > sqlite3\mysql\postgres\redis\memcached\others it can be used in the
>  > iptables level.
>  > Also a point in this DB and this cache is that it will be persistent
>  > so what so ever the *NIX system is there is an option once the IP +
>  > port was tagged as non-bump-able it is better be in the FIREWALL level
>  > override better then squid external_acl.
>  > Reason: If the kernel does what it needs to do then squid should not
>  > touch the packets.
>  > It's not always right but it's a point in the issue.
>  > I still do not know how to work with NFQUEUE and I am sure that there
>  > is an option to make a fast decision and if not then let the
>  > connection be BUMPED.
>  >
>  > I have written a small golang script that can check couple things
>  > about the ssl session at:
>  > http://www1.ngtech.co.il/squid/ssl_helpers/ssl_validator.go
>  >
>  > Besides this helper there is another script which do couple things in
>  > another level.
>  >
>  > ##########
>  > If any thing will be decided for squid internals it will be after a
>  > proof of concept that we can implement together.
>  > Can we take this thread to storm and put on the table a proof of
>  > concept logic for ssl inspection\bumping and bypassing?
>  >
>  > Eliezer
>  >
>  > On 01/05/2015 10:40 AM, Yuri Voinov wrote:
>  > >>> Sounds good,
>  > >>>
>  > >>> but server world is not end on Linux. ;)
>  > >>>
>  > >>> Now exists another *NIX systems. And will exists further.
>  > >>>
>  > >>> Also. I have an idea, gents.
>  > >>>
>  > >>> Do we can easy and quickly detect SSL Pinned destinations? And
>  > >>> remember it, for example, in database?
>  > >>>
>  > >>> In another words - both problems is similar. Either non-HTTPS
>  > >>> traffic over 443 port, or pinned certs.
>  > >>>
>  > >>> Can we detect both of them automatically and add to exclude list?
>  > >>>
>  > >>> WBR, Yuri
>  >
>  >> _______________________________________________
>  >> squid-users mailing list
>  >> squid-users at lists.squid-cache.org
>  >> http://lists.squid-cache.org/listinfo/squid-users
>  >>
>  > _______________________________________________
>  > squid-users mailing list
>  > squid-users at lists.squid-cache.org
>  > http://lists.squid-cache.org/listinfo/squid-users
>
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2
>
> iQEcBAEBAgAGBQJUqo1oAAoJENNXIZxhPexGCqQIAKbEd2gclvG8FZHDS5RwotFa
> wPA+I+uLv0nfUO9whuWkJQmhCpCd0cPpyn1KVxiLe8g0CfcOu15uFZJGCOOdVjDV
> NGPsuZLZPMrhKPmZaRy4YmMw2zpbQTQXGtHmoFA2GPNaIXyG5fEAyZ1oDYTyOuz5
> djlAka3A01FE24TLT1mWREQEqb1YEtEwrzPyo5I/p5XEpnyR22ByA7Pam7cEsMXf
> +lVJSLAzcIrT6j+wp1PoJuHEUDkDlhl8aRuL3VndMk6MLkZ6TA7HLRFLx8FGzAmC
> 0fu6yEthb3QSrNnqTd0Lk22N/WTl3E0M4pYOsChSRlHByEV9RN1OiSryOAkodGU=
> =XVuO
> -----END PGP SIGNATURE-----
>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


From doug1234 at digcorp.net  Mon Jan  5 14:38:14 2015
From: doug1234 at digcorp.net (Douglas Davenport)
Date: Mon, 5 Jan 2015 09:38:14 -0500
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <54AA9B3C.7000604@urlfilterdb.com>
References: <54A2A4AB.1000003@gmail.com> <54A2AF50.2070103@treenet.co.nz>
 <HKNPR04MB1933D74D5F5A53D56ED20C8E85F0@HKNPR04MB193.apcprd04.prod.outlook.com>
 <54A7A164.8010400@trimble.com> <54A7AC13.4020001@gmail.com>
 <CAOsHgtvHt7BshV-4nVr9Bh-VPj44wNmYNm2cor=NbBDOs=kBkw@mail.gmail.com>
 <54A9B0BB.1050509@gmail.com>
 <CAOsHgtsrTZ9kqhcWcJwVnhnbA8L9eX0DZJfdbM+zB4tw-0LVZg@mail.gmail.com>
 <54A9FA7F.2020600@ngtech.co.il> <54AA4E16.8010707@gmail.com>
 <54AA6074.7080105@ngtech.co.il> <54AA7AC0.7000707@urlfilterdb.com>
 <54AA8D68.6020903@gmail.com> <54AA9B3C.7000604@urlfilterdb.com>
Message-ID: <CAOsHgtvAT30b19yq=6B5jWeLAgJ3+9fFjAjv0LXcx=aJA6+6Bw@mail.gmail.com>

Marcus, not to distract from the very important main points being discussed
here but I have to question your last line:
"i.e. there is not yet an interface for this type of traffic inspection."

Is that not the whole point of Squid's ICAP interface and HTTPS bumping? Or
do you just mean that ufdbguard doesn't utilize that yet. If so you might
want to consider adding that functionality...




On Mon, Jan 5, 2015 at 9:10 AM, Marcus Kool <marcus.kool at urlfilterdb.com>
wrote:

>
>
> On 01/05/2015 11:11 AM, Yuri Voinov wrote:
>
>>
>> -----BEGIN PGP SIGNED MESSAGE-----
>> Hash: SHA1
>>
>> And also:
>>
>> don't forget about bogus homebrew internet-bankings. Which is uses bogus
>> SSL-certs with bogus GOST realisations. And bogus Java-based clients. All
>> of them also uses 443 port. And often HTTPS with
>> homebrew bogus features.
>>
>> We don't know, how to bump it.
>>
>> What about it? Pass-through? Pass-through.
>>
>> This is clean exclusion.
>>
>> So don't worry about SSH/Tor. To block them we will be use another
>> solutions. DPI. And not always technical. Revoke administrative rights from
>> clients is basics of security, like physical access to
>> infrastructure. If they can't install Tor/SSH - why we can worry about
>> this traffic?
>>
>> We have (and can solve) two simple problems. HTTP over 443 port. And SSL
>> Pinning. That's all, folks.
>>
>
> It is clear what *you* want.
> You prefer  Squid + HTTP filter + Cisco/DPI + tcputils + sniffer + manual
> maintenance of ACLs/exclude list
>
>
>
>  05.01.2015 17:51, Marcus Kool ?????:
>>
>>> Much of the discussion so far  has been about bumping traffic on port
>>> 443,
>>>
>>  > bumping SSL-encapsulated HTTP traffic and not bumping (allowing)
>>  > other traffic.  Since port 443 is used for many protocols, it is in
>> many
>>  > cases dangerous to allow non-bumpable traffic: SSH tunnels using port
>> 443
>>  > are common, so are VPNs.  Do you know a security officer who does not
>> want
>>  > to block an SSH tunnel, or an app that can share corporate documents
>>  > on public websites?  If there is not more attention to these kinds of
>>  > applications that use port 443 to circumvent corporate firewalls,
>>  > Squid will be doomed to be used only in environments where the priority
>>  > for security is low to non-existent.  Just type "punching holes in
>> corporate
>>  > firewalls" or "ssh tunnel proxy" in Google to see how easy it is to
>> use an
>>  > SSH tunnel.
>>  >
>>  > I am the author of ufdbGuard, a filter for Squid and besides filtering
>>  > based on URLs, ufdbGuard also probes port 443 to see what kind of
>> traffic
>>  > the server is expecting.  By using probes, ufdbGuard can detect SSH
>> tunnels,
>>  > popular chat protocols, etc. but it is not a 100% guaranteed solution
>>  > because ufdbGuard cannot not see the traffic that flows through the
>> proxy,
>>  > i.e. there is not yet an interface for this type of traffic inspection.
>>  >
>>  > Marcus
>>  >
>>  >
>>  > On 01/05/2015 07:59 AM, Eliezer Croitoru wrote:
>>  > Hey Yuri,
>>  >
>>  > Indeed there are other *NIX systems and for each and every one of them
>>  > there is a solution in need.
>>  >
>>  > SSL Pinned destinations cannot be identified automatically since the
>>  > are pinned inside a software and the certificate will not show
>>  > anything about that.
>>  > The basic tests we can do are:
>>  > - The host is using ssl or tls or not at all(based on the selective
>>  > answer of the service)
>>  > -
>>  > - If the connection is using tls\ssl then inspect the components of
>>  > the certificate(such as rootCA validation against the local machine
>>  > certificates DB)
>>  >
>>  > Depend on the goal of the certificate validation the decision will be
>>  > made to either allow the connection "uninspected" or to "bump" it as
>>  > is without any smart identification.
>>  >
>>  > If indeed there is a database
>>  > sqlite3\mysql\postgres\redis\memcached\others it can be used in the
>>  > iptables level.
>>  > Also a point in this DB and this cache is that it will be persistent
>>  > so what so ever the *NIX system is there is an option once the IP +
>>  > port was tagged as non-bump-able it is better be in the FIREWALL level
>>  > override better then squid external_acl.
>>  > Reason: If the kernel does what it needs to do then squid should not
>>  > touch the packets.
>>  > It's not always right but it's a point in the issue.
>>  > I still do not know how to work with NFQUEUE and I am sure that there
>>  > is an option to make a fast decision and if not then let the
>>  > connection be BUMPED.
>>  >
>>  > I have written a small golang script that can check couple things
>>  > about the ssl session at:
>>  > http://www1.ngtech.co.il/squid/ssl_helpers/ssl_validator.go
>>  >
>>  > Besides this helper there is another script which do couple things in
>>  > another level.
>>  >
>>  > ##########
>>  > If any thing will be decided for squid internals it will be after a
>>  > proof of concept that we can implement together.
>>  > Can we take this thread to storm and put on the table a proof of
>>  > concept logic for ssl inspection\bumping and bypassing?
>>  >
>>  > Eliezer
>>  >
>>  > On 01/05/2015 10:40 AM, Yuri Voinov wrote:
>>  > >>> Sounds good,
>>  > >>>
>>  > >>> but server world is not end on Linux. ;)
>>  > >>>
>>  > >>> Now exists another *NIX systems. And will exists further.
>>  > >>>
>>  > >>> Also. I have an idea, gents.
>>  > >>>
>>  > >>> Do we can easy and quickly detect SSL Pinned destinations? And
>>  > >>> remember it, for example, in database?
>>  > >>>
>>  > >>> In another words - both problems is similar. Either non-HTTPS
>>  > >>> traffic over 443 port, or pinned certs.
>>  > >>>
>>  > >>> Can we detect both of them automatically and add to exclude list?
>>  > >>>
>>  > >>> WBR, Yuri
>>  >
>>  >> _______________________________________________
>>  >> squid-users mailing list
>>  >> squid-users at lists.squid-cache.org
>>  >> http://lists.squid-cache.org/listinfo/squid-users
>>  >>
>>  > _______________________________________________
>>  > squid-users mailing list
>>  > squid-users at lists.squid-cache.org
>>  > http://lists.squid-cache.org/listinfo/squid-users
>>
>> -----BEGIN PGP SIGNATURE-----
>> Version: GnuPG v2
>>
>> iQEcBAEBAgAGBQJUqo1oAAoJENNXIZxhPexGCqQIAKbEd2gclvG8FZHDS5RwotFa
>> wPA+I+uLv0nfUO9whuWkJQmhCpCd0cPpyn1KVxiLe8g0CfcOu15uFZJGCOOdVjDV
>> NGPsuZLZPMrhKPmZaRy4YmMw2zpbQTQXGtHmoFA2GPNaIXyG5fEAyZ1oDYTyOuz5
>> djlAka3A01FE24TLT1mWREQEqb1YEtEwrzPyo5I/p5XEpnyR22ByA7Pam7cEsMXf
>> +lVJSLAzcIrT6j+wp1PoJuHEUDkDlhl8aRuL3VndMk6MLkZ6TA7HLRFLx8FGzAmC
>> 0fu6yEthb3QSrNnqTd0Lk22N/WTl3E0M4pYOsChSRlHByEV9RN1OiSryOAkodGU=
>> =XVuO
>> -----END PGP SIGNATURE-----
>>
>>
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>>
>>  _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150105/e9382b7d/attachment.htm>

From yvoinov at gmail.com  Mon Jan  5 14:48:24 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 05 Jan 2015 20:48:24 +0600
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <CAOsHgtvAT30b19yq=6B5jWeLAgJ3+9fFjAjv0LXcx=aJA6+6Bw@mail.gmail.com>
References: <54A2A4AB.1000003@gmail.com> <54A2AF50.2070103@treenet.co.nz>
 <HKNPR04MB1933D74D5F5A53D56ED20C8E85F0@HKNPR04MB193.apcprd04.prod.outlook.com>
 <54A7A164.8010400@trimble.com> <54A7AC13.4020001@gmail.com>
 <CAOsHgtvHt7BshV-4nVr9Bh-VPj44wNmYNm2cor=NbBDOs=kBkw@mail.gmail.com>
 <54A9B0BB.1050509@gmail.com>
 <CAOsHgtsrTZ9kqhcWcJwVnhnbA8L9eX0DZJfdbM+zB4tw-0LVZg@mail.gmail.com>
 <54A9FA7F.2020600@ngtech.co.il> <54AA4E16.8010707@gmail.com>
 <54AA6074.7080105@ngtech.co.il> <54AA7AC0.7000707@urlfilterdb.com>
 <54AA8D68.6020903@gmail.com> <54AA9B3C.7000604@urlfilterdb.com>
 <CAOsHgtvAT30b19yq=6B5jWeLAgJ3+9fFjAjv0LXcx=aJA6+6Bw@mail.gmail.com>
Message-ID: <54AAA438.7010000@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Wait a minute, gents.

What about ICAP? What I skipped?

05.01.2015 20:38, Douglas Davenport ?????:
> Marcus, not to distract from the very important main points being discussed here but I have to
question your last line:
> "i.e. there is not yet an interface for this type of traffic inspection."
>
> Is that not the whole point of Squid's ICAP interface and HTTPS
bumping? Or do you just mean that ufdbguard doesn't utilize that yet. If
so you might want to consider adding that functionality...
>
>
>
>
> On Mon, Jan 5, 2015 at 9:10 AM, Marcus Kool
<marcus.kool at urlfilterdb.com <mailto:marcus.kool at urlfilterdb.com>> wrote:
>
>
>
>     On 01/05/2015 11:11 AM, Yuri Voinov wrote:
>
>
> And also:
>
> don't forget about bogus homebrew internet-bankings. Which is uses
bogus SSL-certs with bogus GOST realisations. And bogus Java-based
clients. All of them also uses 443 port. And often HTTPS with
> homebrew bogus features.
>
> We don't know, how to bump it.
>
> What about it? Pass-through? Pass-through.
>
> This is clean exclusion.
>
> So don't worry about SSH/Tor. To block them we will be use another
solutions. DPI. And not always technical. Revoke administrative rights
from clients is basics of security, like physical access to
> infrastructure. If they can't install Tor/SSH - why we can worry about
this traffic?
>
> We have (and can solve) two simple problems. HTTP over 443 port. And
SSL Pinning. That's all, folks.
>
>
> >     It is clear what *you* want.
> >     You prefer  Squid + HTTP filter + Cisco/DPI + tcputils + sniffer
+ manual maintenance of ACLs/exclude list
>
>
>
> 05.01.2015 17:51, Marcus Kool ?????:
>
>     Much of the discussion so far  has been about bumping traffic on
port 443,
>
>  > bumping SSL-encapsulated HTTP traffic and not bumping (allowing)
>  > other traffic.  Since port 443 is used for many protocols, it is in
many
>  > cases dangerous to allow non-bumpable traffic: SSH tunnels using
port 443
>  > are common, so are VPNs.  Do you know a security officer who does
not want
>  > to block an SSH tunnel, or an app that can share corporate documents
>  > on public websites?  If there is not more attention to these kinds of
>  > applications that use port 443 to circumvent corporate firewalls,
>  > Squid will be doomed to be used only in environments where the priority
>  > for security is low to non-existent.  Just type "punching holes in
corporate
>  > firewalls" or "ssh tunnel proxy" in Google to see how easy it is to
use an
>  > SSH tunnel.
>
>  > I am the author of ufdbGuard, a filter for Squid and besides filtering
>  > based on URLs, ufdbGuard also probes port 443 to see what kind of
traffic
>  > the server is expecting.  By using probes, ufdbGuard can detect SSH
tunnels,
>  > popular chat protocols, etc. but it is not a 100% guaranteed solution
>  > because ufdbGuard cannot not see the traffic that flows through the
proxy,
>  > i.e. there is not yet an interface for this type of traffic inspection.
>
>  > Marcus
>
>
>  > On 01/05/2015 07:59 AM, Eliezer Croitoru wrote:
>  > Hey Yuri,
>
>  > Indeed there are other *NIX systems and for each and every one of them
>  > there is a solution in need.
>
>  > SSL Pinned destinations cannot be identified automatically since the
>  > are pinned inside a software and the certificate will not show
>  > anything about that.
>  > The basic tests we can do are:
>  > - The host is using ssl or tls or not at all(based on the selective
>  > answer of the service)
>  > -
>  > - If the connection is using tls\ssl then inspect the components of
>  > the certificate(such as rootCA validation against the local machine
>  > certificates DB)
>
>  > Depend on the goal of the certificate validation the decision will be
>  > made to either allow the connection "uninspected" or to "bump" it as
>  > is without any smart identification.
>
>  > If indeed there is a database
>  > sqlite3\mysql\postgres\redis\memcached\others it can be used in the
>  > iptables level.
>  > Also a point in this DB and this cache is that it will be persistent
>  > so what so ever the *NIX system is there is an option once the IP +
>  > port was tagged as non-bump-able it is better be in the FIREWALL level
>  > override better then squid external_acl.
>  > Reason: If the kernel does what it needs to do then squid should not
>  > touch the packets.
>  > It's not always right but it's a point in the issue.
>  > I still do not know how to work with NFQUEUE and I am sure that there
>  > is an option to make a fast decision and if not then let the
>  > connection be BUMPED.
>
>  > I have written a small golang script that can check couple things
>  > about the ssl session at:
>  > http://www1.ngtech.co.il/squid/ssl_helpers/ssl_validator.go
<http://www1.ngtech.co.il/squid/ssl_helpers/ssl_validator.go>
>
>  > Besides this helper there is another script which do couple things in
>  > another level.
>
>  > ##########
>  > If any thing will be decided for squid internals it will be after a
>  > proof of concept that we can implement together.
>  > Can we take this thread to storm and put on the table a proof of
>  > concept logic for ssl inspection\bumping and bypassing?
>
>  > Eliezer
>
>  > On 01/05/2015 10:40 AM, Yuri Voinov wrote:
>  > >>> Sounds good,
>  > >>>
>  > >>> but server world is not end on Linux. ;)
>  > >>>
>  > >>> Now exists another *NIX systems. And will exists further.
>  > >>>
>  > >>> Also. I have an idea, gents.
>  > >>>
>  > >>> Do we can easy and quickly detect SSL Pinned destinations? And
>  > >>> remember it, for example, in database?
>  > >>>
>  > >>> In another words - both problems is similar. Either non-HTTPS
>  > >>> traffic over 443 port, or pinned certs.
>  > >>>
>  > >>> Can we detect both of them automatically and add to exclude list?
>  > >>>
>  > >>> WBR, Yuri
>
>  >> _______________________________________________
>  >> squid-users mailing list
>  >> squid-users at lists.squid-cache.org
<mailto:squid-users at lists.squid-cache.org>
>  >> http://lists.squid-cache.org/listinfo/squid-users
<http://lists.squid-cache.org/listinfo/squid-users>
>  >>
>  > _______________________________________________
>  > squid-users mailing list
>  > squid-users at lists.squid-cache.org
<mailto:squid-users at lists.squid-cache.org>
>  > http://lists.squid-cache.org/listinfo/squid-users
<http://lists.squid-cache.org/listinfo/squid-users>
>
>
>
>
>         _______________________________________________
>         squid-users mailing list
>         squid-users at lists.squid-cache.org
<mailto:squid-users at lists.squid-cache.org>
>         http://lists.squid-cache.org/listinfo/squid-users
<http://lists.squid-cache.org/listinfo/squid-users>
>
>     _______________________________________________
>     squid-users mailing list
>     squid-users at lists.squid-cache.org
<mailto:squid-users at lists.squid-cache.org>
>     http://lists.squid-cache.org/listinfo/squid-users
<http://lists.squid-cache.org/listinfo/squid-users>
>
>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUqqQ3AAoJENNXIZxhPexGfpUIAISbpvePCM5J4Bo+M7V2tnp5
V62ELnU6ScjRtHgdOt3ywkb54fuXpqoGEG+jqbNhzEtc4K3P3Ek3sHfximEJ04Ut
EtH3K2WGqvmBGyogK0PI0pNp9oBwpEgDPKPmHaPj5qoCHaSmNaJkD6jmQ24T6B6R
yjnxu5gdUKnf+MF2Tnuui9QJtxy/Gsgn1Eef0DOr7B7fxiqFV6+SR+G9DjHYWJNV
Jx3f7iG1uJsuUCZQOI7i8NhaRYaDuMaxNaMVcniiKY6NEMAFSetxsvlURqv2gLKN
DNdtvXiLpbydkK5LaFQNi+meMILcEKjXPZ/aK9WVehR2lIy2hzWC6PbSVdN/eC8=
=BWP9
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150105/e0612b7d/attachment.htm>

From marcus.kool at urlfilterdb.com  Mon Jan  5 15:15:19 2015
From: marcus.kool at urlfilterdb.com (Marcus Kool)
Date: Mon, 05 Jan 2015 13:15:19 -0200
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <CAOsHgtvAT30b19yq=6B5jWeLAgJ3+9fFjAjv0LXcx=aJA6+6Bw@mail.gmail.com>
References: <54A2A4AB.1000003@gmail.com> <54A2AF50.2070103@treenet.co.nz>
 <HKNPR04MB1933D74D5F5A53D56ED20C8E85F0@HKNPR04MB193.apcprd04.prod.outlook.com>
 <54A7A164.8010400@trimble.com> <54A7AC13.4020001@gmail.com>
 <CAOsHgtvHt7BshV-4nVr9Bh-VPj44wNmYNm2cor=NbBDOs=kBkw@mail.gmail.com>
 <54A9B0BB.1050509@gmail.com>
 <CAOsHgtsrTZ9kqhcWcJwVnhnbA8L9eX0DZJfdbM+zB4tw-0LVZg@mail.gmail.com>
 <54A9FA7F.2020600@ngtech.co.il> <54AA4E16.8010707@gmail.com>
 <54AA6074.7080105@ngtech.co.il> <54AA7AC0.7000707@urlfilterdb.com>
 <54AA8D68.6020903@gmail.com> <54AA9B3C.7000604@urlfilterdb.com>
 <CAOsHgtvAT30b19yq=6B5jWeLAgJ3+9fFjAjv0LXcx=aJA6+6Bw@mail.gmail.com>
Message-ID: <54AAAA87.1080204@urlfilterdb.com>



On 01/05/2015 12:38 PM, Douglas Davenport wrote:
> Marcus, not to distract from the very important main points being discussed here but I have to question your last line:
> "i.e. there is not yet an interface for this type of traffic inspection."
>
> Is that not the whole point of Squid's ICAP interface and HTTPS bumping? Or do you just mean that ufdbguard doesn't utilize that yet. If so you might want to consider adding that functionality...

ICAP does
    HTTP filtering based on URL and HTTP content
    port-443 filtering based on FQDN  (ICAP server only receives "CONNECT <FQDN>:443")
    port-443 filtering based on HTTP content _if_ Squid uses sslbump

ICAP does _not_
    port-443 filtering for non-HTTP protocols

ICAP was designed for HTTP-based content modification.
There is no industry standard for filtering non-HTTP data.
I have discussed this subject twice with the Squid development team
but there is currently no sponsor to implement a new protocol to filter
non-HTTP data in Squid.

Marcus


>
>
> On Mon, Jan 5, 2015 at 9:10 AM, Marcus Kool <marcus.kool at urlfilterdb.com <mailto:marcus.kool at urlfilterdb.com>> wrote:
>
>
>
>     On 01/05/2015 11:11 AM, Yuri Voinov wrote:
>
>
>         -----BEGIN PGP SIGNED MESSAGE-----
>         Hash: SHA1
>
>         And also:
>
>         don't forget about bogus homebrew internet-bankings. Which is uses bogus SSL-certs with bogus GOST realisations. And bogus Java-based clients. All of them also uses 443 port. And often HTTPS with
>         homebrew bogus features.
>
>         We don't know, how to bump it.
>
>         What about it? Pass-through? Pass-through.
>
>         This is clean exclusion.
>
>         So don't worry about SSH/Tor. To block them we will be use another solutions. DPI. And not always technical. Revoke administrative rights from clients is basics of security, like physical
>         access to
>         infrastructure. If they can't install Tor/SSH - why we can worry about this traffic?
>
>         We have (and can solve) two simple problems. HTTP over 443 port. And SSL Pinning. That's all, folks.
>
>
>     It is clear what *you* want.
>     You prefer  Squid + HTTP filter + Cisco/DPI + tcputils + sniffer + manual maintenance of ACLs/exclude list
>
>
>
>         05.01.2015 17:51, Marcus Kool ?????:
>
>             Much of the discussion so far  has been about bumping traffic on port 443,
>
>           > bumping SSL-encapsulated HTTP traffic and not bumping (allowing)
>           > other traffic.  Since port 443 is used for many protocols, it is in many
>           > cases dangerous to allow non-bumpable traffic: SSH tunnels using port 443
>           > are common, so are VPNs.  Do you know a security officer who does not want
>           > to block an SSH tunnel, or an app that can share corporate documents
>           > on public websites?  If there is not more attention to these kinds of
>           > applications that use port 443 to circumvent corporate firewalls,
>           > Squid will be doomed to be used only in environments where the priority
>           > for security is low to non-existent.  Just type "punching holes in corporate
>           > firewalls" or "ssh tunnel proxy" in Google to see how easy it is to use an
>           > SSH tunnel.
>           >
>           > I am the author of ufdbGuard, a filter for Squid and besides filtering
>           > based on URLs, ufdbGuard also probes port 443 to see what kind of traffic
>           > the server is expecting.  By using probes, ufdbGuard can detect SSH tunnels,
>           > popular chat protocols, etc. but it is not a 100% guaranteed solution
>           > because ufdbGuard cannot not see the traffic that flows through the proxy,
>           > i.e. there is not yet an interface for this type of traffic inspection.
>           >
>           > Marcus
>           >
>           >
>           > On 01/05/2015 07:59 AM, Eliezer Croitoru wrote:
>           > Hey Yuri,
>           >
>           > Indeed there are other *NIX systems and for each and every one of them
>           > there is a solution in need.
>           >
>           > SSL Pinned destinations cannot be identified automatically since the
>           > are pinned inside a software and the certificate will not show
>           > anything about that.
>           > The basic tests we can do are:
>           > - The host is using ssl or tls or not at all(based on the selective
>           > answer of the service)
>           > -
>           > - If the connection is using tls\ssl then inspect the components of
>           > the certificate(such as rootCA validation against the local machine
>           > certificates DB)
>           >
>           > Depend on the goal of the certificate validation the decision will be
>           > made to either allow the connection "uninspected" or to "bump" it as
>           > is without any smart identification.
>           >
>           > If indeed there is a database
>           > sqlite3\mysql\postgres\redis\__memcached\others it can be used in the
>           > iptables level.
>           > Also a point in this DB and this cache is that it will be persistent
>           > so what so ever the *NIX system is there is an option once the IP +
>           > port was tagged as non-bump-able it is better be in the FIREWALL level
>           > override better then squid external_acl.
>           > Reason: If the kernel does what it needs to do then squid should not
>           > touch the packets.
>           > It's not always right but it's a point in the issue.
>           > I still do not know how to work with NFQUEUE and I am sure that there
>           > is an option to make a fast decision and if not then let the
>           > connection be BUMPED.
>           >
>           > I have written a small golang script that can check couple things
>           > about the ssl session at:
>           > http://www1.ngtech.co.il/__squid/ssl_helpers/ssl___validator.go <http://www1.ngtech.co.il/squid/ssl_helpers/ssl_validator.go>
>           >
>           > Besides this helper there is another script which do couple things in
>           > another level.
>           >
>           > ##########
>           > If any thing will be decided for squid internals it will be after a
>           > proof of concept that we can implement together.
>           > Can we take this thread to storm and put on the table a proof of
>           > concept logic for ssl inspection\bumping and bypassing?
>           >
>           > Eliezer
>           >
>           > On 01/05/2015 10:40 AM, Yuri Voinov wrote:
>           > >>> Sounds good,
>           > >>>
>           > >>> but server world is not end on Linux. ;)
>           > >>>
>           > >>> Now exists another *NIX systems. And will exists further.
>           > >>>
>           > >>> Also. I have an idea, gents.
>           > >>>
>           > >>> Do we can easy and quickly detect SSL Pinned destinations? And
>           > >>> remember it, for example, in database?
>           > >>>
>           > >>> In another words - both problems is similar. Either non-HTTPS
>           > >>> traffic over 443 port, or pinned certs.
>           > >>>
>           > >>> Can we detect both of them automatically and add to exclude list?
>           > >>>
>           > >>> WBR, Yuri
>           >
>           >> _________________________________________________
>           >> squid-users mailing list
>           >> squid-users at lists.squid-cache.__org <mailto:squid-users at lists.squid-cache.org>
>           >> http://lists.squid-cache.org/__listinfo/squid-users <http://lists.squid-cache.org/listinfo/squid-users>
>           >>
>           > _________________________________________________
>           > squid-users mailing list
>           > squid-users at lists.squid-cache.__org <mailto:squid-users at lists.squid-cache.org>
>           > http://lists.squid-cache.org/__listinfo/squid-users <http://lists.squid-cache.org/listinfo/squid-users>
>
>         -----BEGIN PGP SIGNATURE-----
>         Version: GnuPG v2
>
>         iQEcBAEBAgAGBQJUqo1oAAoJENNXIZ__xhPexGCqQIAKbEd2gclvG8FZHDS5Rw__otFa
>         wPA+I+__uLv0nfUO9whuWkJQmhCpCd0cPpyn1K__VxiLe8g0CfcOu15uFZJGCOOdVjDV
>         NGPsuZLZPMrhKPmZaRy4YmMw2zpbQT__QXGtHmoFA2GPNaIXyG5fEAyZ1oDYTy__Ouz5
>         djlAka3A01FE24TLT1mWREQEqb1YEt__EwrzPyo5I/__p5XEpnyR22ByA7Pam7cEsMXf
>         +lVJSLAzcIrT6j+__wp1PoJuHEUDkDlhl8aRuL3VndMk6ML__kZ6TA7HLRFLx8FGzAmC
>         0fu6yEthb3QSrNnqTd0Lk22N/__WTl3E0M4pYOsChSRlHByEV9RN1OiSr__yOAkodGU=
>         =XVuO
>         -----END PGP SIGNATURE-----
>
>
>
>         _________________________________________________
>         squid-users mailing list
>         squid-users at lists.squid-cache.__org <mailto:squid-users at lists.squid-cache.org>
>         http://lists.squid-cache.org/__listinfo/squid-users <http://lists.squid-cache.org/listinfo/squid-users>
>
>     _________________________________________________
>     squid-users mailing list
>     squid-users at lists.squid-cache.__org <mailto:squid-users at lists.squid-cache.org>
>     http://lists.squid-cache.org/__listinfo/squid-users <http://lists.squid-cache.org/listinfo/squid-users>
>
>


From yvoinov at gmail.com  Mon Jan  5 15:18:48 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 05 Jan 2015 21:18:48 +0600
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <54AAAA87.1080204@urlfilterdb.com>
References: <54A2A4AB.1000003@gmail.com> <54A2AF50.2070103@treenet.co.nz>
 <HKNPR04MB1933D74D5F5A53D56ED20C8E85F0@HKNPR04MB193.apcprd04.prod.outlook.com>
 <54A7A164.8010400@trimble.com> <54A7AC13.4020001@gmail.com>
 <CAOsHgtvHt7BshV-4nVr9Bh-VPj44wNmYNm2cor=NbBDOs=kBkw@mail.gmail.com>
 <54A9B0BB.1050509@gmail.com>
 <CAOsHgtsrTZ9kqhcWcJwVnhnbA8L9eX0DZJfdbM+zB4tw-0LVZg@mail.gmail.com>
 <54A9FA7F.2020600@ngtech.co.il> <54AA4E16.8010707@gmail.com>
 <54AA6074.7080105@ngtech.co.il> <54AA7AC0.7000707@urlfilterdb.com>
 <54AA8D68.6020903@gmail.com> <54AA9B3C.7000604@urlfilterdb.com>
 <CAOsHgtvAT30b19yq=6B5jWeLAgJ3+9fFjAjv0LXcx=aJA6+6Bw@mail.gmail.com>
 <54AAAA87.1080204@urlfilterdb.com>
Message-ID: <54AAAB58.6040306@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
We haven't filtering non_HTTP over port-443. Just recognize and pass.

05.01.2015 21:15, Marcus Kool ?????:
>
>
> On 01/05/2015 12:38 PM, Douglas Davenport wrote:
>> Marcus, not to distract from the very important main points being
discussed here but I have to question your last line:
>> "i.e. there is not yet an interface for this type of traffic inspection."
>>
>> Is that not the whole point of Squid's ICAP interface and HTTPS
bumping? Or do you just mean that ufdbguard doesn't utilize that yet. If
so you might want to consider adding that functionality...
>
> ICAP does
>    HTTP filtering based on URL and HTTP content
>    port-443 filtering based on FQDN  (ICAP server only receives
"CONNECT <FQDN>:443")
>    port-443 filtering based on HTTP content _if_ Squid uses sslbump
>
> ICAP does _not_
>    port-443 filtering for non-HTTP protocols
>
> ICAP was designed for HTTP-based content modification.
> There is no industry standard for filtering non-HTTP data.
> I have discussed this subject twice with the Squid development team
> but there is currently no sponsor to implement a new protocol to filter
> non-HTTP data in Squid.
>
> Marcus
>
>
>>
>>
>> On Mon, Jan 5, 2015 at 9:10 AM, Marcus Kool
<marcus.kool at urlfilterdb.com <mailto:marcus.kool at urlfilterdb.com>> wrote:
>>
>>
>>
>>     On 01/05/2015 11:11 AM, Yuri Voinov wrote:
>>
>>
> And also:
>
> don't forget about bogus homebrew internet-bankings. Which is uses
bogus SSL-certs with bogus GOST realisations. And bogus Java-based
clients. All of them also uses 443 port. And often HTTPS with
> homebrew bogus features.
>
> We don't know, how to bump it.
>
> What about it? Pass-through? Pass-through.
>
> This is clean exclusion.
>
> So don't worry about SSH/Tor. To block them we will be use another
solutions. DPI. And not always technical. Revoke administrative rights
from clients is basics of security, like physical
> access to
> infrastructure. If they can't install Tor/SSH - why we can worry about
this traffic?
>
> We have (and can solve) two simple problems. HTTP over 443 port. And
SSL Pinning. That's all, folks.
>
>
> >>     It is clear what *you* want.
> >>     You prefer  Squid + HTTP filter + Cisco/DPI + tcputils +
sniffer + manual maintenance of ACLs/exclude list
>
>
>
> 05.01.2015 17:51, Marcus Kool ?????:
>
>     Much of the discussion so far  has been about bumping traffic on
port 443,
>
>   > bumping SSL-encapsulated HTTP traffic and not bumping (allowing)
>   > other traffic.  Since port 443 is used for many protocols, it is
in many
>   > cases dangerous to allow non-bumpable traffic: SSH tunnels using
port 443
>   > are common, so are VPNs.  Do you know a security officer who does
not want
>   > to block an SSH tunnel, or an app that can share corporate documents
>   > on public websites?  If there is not more attention to these kinds of
>   > applications that use port 443 to circumvent corporate firewalls,
>   > Squid will be doomed to be used only in environments where the
priority
>   > for security is low to non-existent.  Just type "punching holes in
corporate
>   > firewalls" or "ssh tunnel proxy" in Google to see how easy it is
to use an
>   > SSH tunnel.
>
>   > I am the author of ufdbGuard, a filter for Squid and besides filtering
>   > based on URLs, ufdbGuard also probes port 443 to see what kind of
traffic
>   > the server is expecting.  By using probes, ufdbGuard can detect
SSH tunnels,
>   > popular chat protocols, etc. but it is not a 100% guaranteed solution
>   > because ufdbGuard cannot not see the traffic that flows through
the proxy,
>   > i.e. there is not yet an interface for this type of traffic
inspection.
>
>   > Marcus
>
>
>   > On 01/05/2015 07:59 AM, Eliezer Croitoru wrote:
>   > Hey Yuri,
>
>   > Indeed there are other *NIX systems and for each and every one of them
>   > there is a solution in need.
>
>   > SSL Pinned destinations cannot be identified automatically since the
>   > are pinned inside a software and the certificate will not show
>   > anything about that.
>   > The basic tests we can do are:
>   > - The host is using ssl or tls or not at all(based on the selective
>   > answer of the service)
>   > -
>   > - If the connection is using tls\ssl then inspect the components of
>   > the certificate(such as rootCA validation against the local machine
>   > certificates DB)
>
>   > Depend on the goal of the certificate validation the decision will be
>   > made to either allow the connection "uninspected" or to "bump" it as
>   > is without any smart identification.
>
>   > If indeed there is a database
>   > sqlite3\mysql\postgres\redis\__memcached\others it can be used in the
>   > iptables level.
>   > Also a point in this DB and this cache is that it will be persistent
>   > so what so ever the *NIX system is there is an option once the IP +
>   > port was tagged as non-bump-able it is better be in the FIREWALL level
>   > override better then squid external_acl.
>   > Reason: If the kernel does what it needs to do then squid should not
>   > touch the packets.
>   > It's not always right but it's a point in the issue.
>   > I still do not know how to work with NFQUEUE and I am sure that there
>   > is an option to make a fast decision and if not then let the
>   > connection be BUMPED.
>
>   > I have written a small golang script that can check couple things
>   > about the ssl session at:
>   > http://www1.ngtech.co.il/__squid/ssl_helpers/ssl___validator.go
<http://www1.ngtech.co.il/squid/ssl_helpers/ssl_validator.go>
>
>   > Besides this helper there is another script which do couple things in
>   > another level.
>
>   > ##########
>   > If any thing will be decided for squid internals it will be after a
>   > proof of concept that we can implement together.
>   > Can we take this thread to storm and put on the table a proof of
>   > concept logic for ssl inspection\bumping and bypassing?
>
>   > Eliezer
>
>   > On 01/05/2015 10:40 AM, Yuri Voinov wrote:
>   > >>> Sounds good,
>   > >>>
>   > >>> but server world is not end on Linux. ;)
>   > >>>
>   > >>> Now exists another *NIX systems. And will exists further.
>   > >>>
>   > >>> Also. I have an idea, gents.
>   > >>>
>   > >>> Do we can easy and quickly detect SSL Pinned destinations? And
>   > >>> remember it, for example, in database?
>   > >>>
>   > >>> In another words - both problems is similar. Either non-HTTPS
>   > >>> traffic over 443 port, or pinned certs.
>   > >>>
>   > >>> Can we detect both of them automatically and add to exclude list?
>   > >>>
>   > >>> WBR, Yuri
>
>   >> _________________________________________________
>   >> squid-users mailing list
>   >> squid-users at lists.squid-cache.__org
<mailto:squid-users at lists.squid-cache.org>
>   >> http://lists.squid-cache.org/__listinfo/squid-users
<http://lists.squid-cache.org/listinfo/squid-users>
>   >>
>   > _________________________________________________
>   > squid-users mailing list
>   > squid-users at lists.squid-cache.__org
<mailto:squid-users at lists.squid-cache.org>
>   > http://lists.squid-cache.org/__listinfo/squid-users
<http://lists.squid-cache.org/listinfo/squid-users>
>
>>
>>
>>
>>         _________________________________________________
>>         squid-users mailing list
>>         squid-users at lists.squid-cache.__org
<mailto:squid-users at lists.squid-cache.org>
>>         http://lists.squid-cache.org/__listinfo/squid-users
<http://lists.squid-cache.org/listinfo/squid-users>
>>
>>     _________________________________________________
>>     squid-users mailing list
>>     squid-users at lists.squid-cache.__org
<mailto:squid-users at lists.squid-cache.org>
>>     http://lists.squid-cache.org/__listinfo/squid-users
<http://lists.squid-cache.org/listinfo/squid-users>
>>
>>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUqqtYAAoJENNXIZxhPexG/ycH/2TMGOJIxoRgX4UjYzqDN2MX
Fv69+gewkPAGwVU5WTOPujW40OykH+mmKP3bFqGHWPhmcNZCkLhSILGPzjeHCeGY
6vliHNgrNtrOW3wkVJcwlmKGs+LAR+52L9lXSOW/xZtYY3ExRQESvfQp2egTvedi
iYGto9m6o5DRXRB0381eUB0BxdJusPTCYdHbN0bl3Ae/YdAs7IGNdBYJtPtjRf0n
5G1NaYBF3Av/4jI6/pCewEbY7jdJa/GJPqP7SNjvVQKAj0wieu9fEWSQTt8VbClw
IjLjYNCxXv/hhrwaX8cKFNQk6ICIS5r/HcJQvpM+q9YQ0LU9dDT6c9SUV3O6bAw=
=l9by
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150105/9641bafd/attachment.htm>

From priyaiitmandi at gmail.com  Mon Jan  5 15:32:50 2015
From: priyaiitmandi at gmail.com (Priya Agarwal)
Date: Mon, 5 Jan 2015 21:02:50 +0530
Subject: [squid-users] Squid Source Code: What files/functions receive/send
	packets from/to hardware
Message-ID: <CALTPfpH1w+HMME9XU3Z_G9_7H+1KDtPzURJ4dOHrwgKeJfu8zw@mail.gmail.com>

Hi.

I am Priya. I want to modify the squid code only in places where it is
actually communicating with the hardware to send or receive packets. I do
not intent to change its functionality or how it works.

I am facing some difficulty in understanding the full code. If I could get
some hints on for e.g. which functions/files are involved receiving and
storing the packet data, or which structures hold the received/sent data
etc., my work would become more streamlined.

My purpose is to add some extra code wherever the application wants to send
or receive the packets.

Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150105/63814020/attachment.htm>

From squid3 at treenet.co.nz  Mon Jan  5 16:22:43 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 06 Jan 2015 05:22:43 +1300
Subject: [squid-users] Squid Source Code: What files/functions
 receive/send packets from/to hardware
In-Reply-To: <CALTPfpHJ_CX8T7YiwU0knvAyQD72VA5HZqYsdPvBqi4ABtkMPQ@mail.gmail.com>
References: <CALTPfpHJ_CX8T7YiwU0knvAyQD72VA5HZqYsdPvBqi4ABtkMPQ@mail.gmail.com>
Message-ID: <54AABA53.1080408@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 6/01/2015 2:27 a.m., Priya Agarwal wrote:
> Hi.
> 
> I am Priya. I want to modify the squid code only in places where it
> is actually communicating with the hardware to send or receive
> packets. I do not intent to change its functionality or how it
> works.
> 

Squid does not communicate with the hardware. Squid communicates with
the OS networking stack. The OS does the packeting/unpacketing.


> I am facing some difficulty in understanding the full code. If I
> could get some hints on for e.g. which functions/files are involved
> receiving and storing the packet data, or which structures hold the
> received/sent data etc., my work would become more streamlined.

:-) nobody knows the full code anymore. Not even me, the current
Project maintainer. Though if you would explain what you are trying to
achieve I can point you in the right direction. Or maybe somebody in
squid-dev mailing list (where the dev team hang out and discuss code).

> 
> My purpose is to add some extra code wherever the application wants
> to send or receive the packets.

What exactly are you wanting to make Squid do?
 "some extra code" is kind of weak on detail.

Cheers
Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUqrpSAAoJELJo5wb/XPRjxZMIAJR8aMSP9Uzts8Jh318jtzhM
SaCUakiRwqYUttm+bua9+QcPc43AH8pcE+Bm5M95gWg7LjPli8zE9AJlCfzDV7ZW
KZu8fCqfEjgEEgwrWLHpT4jOLsdQSxKcZ9ftwgRIxlxaKPiUa2Hrap/BgUWEmaQh
X1Fi3wxrnPIek/gJQsYRgvQzJyx/S04EX8088dXz7xjyu+16fnDj0H0KdzQxgJZ4
KthXx3PZ6S741pvrY7F4Sb9ozydfg+8tSXb9X0Bzxyl5cK4Mde95rGwfts+x/QEj
fk+EGHGUZjjNtcfo473QugPB5YepLH0uh3dxssNQjxhLykuSoFiATpKDRH5IcMw=
=tu2O
-----END PGP SIGNATURE-----


From eliezer at ngtech.co.il  Mon Jan  5 16:28:54 2015
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Mon, 05 Jan 2015 18:28:54 +0200
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <54AAAB58.6040306@gmail.com>
References: <54A2A4AB.1000003@gmail.com> <54A2AF50.2070103@treenet.co.nz>
 <HKNPR04MB1933D74D5F5A53D56ED20C8E85F0@HKNPR04MB193.apcprd04.prod.outlook.com>
 <54A7A164.8010400@trimble.com> <54A7AC13.4020001@gmail.com>
 <CAOsHgtvHt7BshV-4nVr9Bh-VPj44wNmYNm2cor=NbBDOs=kBkw@mail.gmail.com>
 <54A9B0BB.1050509@gmail.com>
 <CAOsHgtsrTZ9kqhcWcJwVnhnbA8L9eX0DZJfdbM+zB4tw-0LVZg@mail.gmail.com>
 <54A9FA7F.2020600@ngtech.co.il> <54AA4E16.8010707@gmail.com>
 <54AA6074.7080105@ngtech.co.il> <54AA7AC0.7000707@urlfilterdb.com>
 <54AA8D68.6020903@gmail.com> <54AA9B3C.7000604@urlfilterdb.com>
 <CAOsHgtvAT30b19yq=6B5jWeLAgJ3+9fFjAjv0LXcx=aJA6+6Bw@mail.gmail.com>
 <54AAAA87.1080204@urlfilterdb.com> <54AAAB58.6040306@gmail.com>
Message-ID: <54AABBC6.7090309@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 01/05/2015 05:18 PM, Yuri Voinov wrote:
> We haven't filtering non_HTTP over port-443. Just recognize and
> pass.

So let's separate security which is one of the goals of squid and
which some like and other don't.

For now squid 3.4 is stable and 3.5 is in beta and trunk is not for
the public use.
In 3.5 there will be present a new feature which called peek and
splice that can give an interface to squid and the admin which will
allow the admin to know couple things about the connection from squid
and specifically first the client TLS request.
Once squid bumped a connection there are couple steps until the
connection is fully established between the client and the server:
- - receive the TCP connection from client
- - BUMP server or client FIRST
- - determine what certificate to send to the client based on the server
initial ssl response
- - fake it
- - send to the client
- - MITM between two tls connections on the proxy while inspecting the
content in the software layer.

Peek and splice will add another step between the first part to the
second and which will allow SNI usage.
All the above is to allow better BUMPING.
There might be or will be probably an interface that will identify or
will try to identify inside the current stages of the connection
bumping if the connection is indeed a TLS or another one.
The first step of peek and splice can identify if the connection from
the client side has started using a valid TLS\SSL headers.

Leaving all the BUMPING yes or no You(Yuri) need a very specific tool
or want a very specific tool.
The basic interface of the external_acl can provide enough data on the
connection in order to enforce some rules.
You can either use the client IP address or just the destination IP
and PORT.

I cannot speak for the squid project but I am almost sure that the
squid project will not provide you with an official helper and will
not support it.
However squid external_acl is there especially to help others achieve
what they want using a variety of parameters from squid internals.
The external_acl interface provides internal caching which supports
caching ttl with different values for the two options either allow(OK)
or DENY(ERR).

My suggestions stays, don't use sqlite if possible.
There is a sketch for a helper like you seems to want.
Take the glove and write a pesudo code for the helper idea based on
the assumptions:
- - There is a DB which can store timestamps, ip, port, result of test, etc
- - There is a way to check if the certificate is valid and the server
works with TLS\SSL
- - There is no way for the helper to know that a certificate is pined
- - There is a way to add static records to the DB(web interface, cli)
- - All the requests will come from the proxy IP address and can by some
be identified as an attack.
- - ufdbguard does not provide your needs since it uses url_rewrite
interface and doesn't have the needed functionalities for you.

The best I have seen until now was the python helper.
If in couple(4-5) month nobody will do something with this I will see
then what can be done with this if at all.

Elizer
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUqrvGAAoJENxnfXtQ8ZQUIDsH/iw82UdjIvwk/bycmuvTIgi2
FjgdXHcOP1EFi1aC6utgZ3ab8GVaOhV8PJpLpFSD3ZLbrFXfLg9c3ubY6EMHVxWz
HNgYBQ/MetSCTHwNKiKHiu8pqy0CR9aTth91KwArrWtXYBqeGyCVCRvyccHc07u4
QVE3rUTNX0ICAgvfrhyUsjgjZVUCRC1dvZT7c2aVeowR1qyvfpK2JRVJSuaUI2oU
HS2516qxzxHvyxJjjz1Cypn06BPiCp2wItIPdX9biEXid2DCJsGGrd9hjhkoZtgH
AiAf7mpFnWZybw4934S1ubUE5x59v8rzpZiuVTE/iSIpVzAci2moeijqosL2yEg=
=7quC
-----END PGP SIGNATURE-----


From steve at opendium.com  Mon Jan  5 16:29:42 2015
From: steve at opendium.com (Steve Hill)
Date: Mon, 05 Jan 2015 16:29:42 +0000
Subject: [squid-users] Debugging slow access
In-Reply-To: <54887E44.30905@treenet.co.nz>
References: <5488724B.9080304@opendium.com> <54887E44.30905@treenet.co.nz>
Message-ID: <54AABBF6.4070305@opendium.com>

On 10.12.14 17:09, Amos Jeffries wrote:

>> I'm looking for advice on figuring out what is causing intermittent
>> high CPU usage.

It appears that the connections gradually gain more and more notes with 
the key "token" (and values containing Kerberos tokens).  I haven't been 
able to reproduce the problem reliably enough to determine if this is 
the root of the high CPU usage problem, but it certainly doesn't look right:

When an ACL is executed that requires the login name (e.g. the 
proxy_auth ACL, or an external ACL using the %LOGIN format specifier), 
Acl.cc:AuthenticateAcl() is called.  This, in turn, calls
UserRequest.cc:tryToAuthenticateAndSetAuthUser(), which calls 
UserRequest.cc:authTryGetUser().  Here we get a call to 
Notes.cc:appendNewOnly() which appends all the notes from 
checklist->auth_user_request->user()->notes.

I can see the appendNewOnly() call sometimes ends up appending a large 
number of "token" notes (I've observed requests with a couple of hundred 
"token" notes attached to them) - the number of notes increases each 
time a Kerberos authentication is performed.  My suspicion is that this 
growth is unbounded and in some cases the number of notes could become 
large enough to be a significant performance hit.

A couple of questions spring to mind:

1. HelperReply.cc:parse() calls notes.add("token",authToken.content()) 
(i.e. it adds a token rather than replacing an existing one).  As far as 
I can tell, Squid only ever uses the first "token" note, so maybe we 
should be removing the old notes when we add a new one?

[Actually, on closer inspection, NotePairs::add() appends to the end of 
the list but NotePairs::findFirst() finds the note closest to the start 
of the list.  Unless I'm missing something, this means the newer "token" 
notes are added but never used?]

2. I'm not sure on how the ACL checklists and User objects are shared 
between connections/requests and how they are supposed to persist.  It 
seems to me that there is something wrong with the sharing/persistence 
if we're accumulating so many "token" notes.  As well as the performance 
problems, there could be some race conditions lurking here?

-- 
  - Steve Hill
    Technical Director
    Opendium Limited     http://www.opendium.com

Direct contacts:
    Instant messager: xmpp:steve at opendium.com
    Email:            steve at opendium.com
    Phone:            sip:steve at opendium.com

Sales / enquiries contacts:
    Email:            sales at opendium.com
    Phone:            +44-1792-824568 / sip:sales at opendium.com

Support contacts:
    Email:            support at opendium.com
    Phone:            +44-1792-825748 / sip:support at opendium.com


From eliezer at ngtech.co.il  Mon Jan  5 16:35:46 2015
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Mon, 05 Jan 2015 18:35:46 +0200
Subject: [squid-users] Debugging slow access
In-Reply-To: <54AABBF6.4070305@opendium.com>
References: <5488724B.9080304@opendium.com> <54887E44.30905@treenet.co.nz>
 <54AABBF6.4070305@opendium.com>
Message-ID: <54AABD62.7020707@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hey Steve,

Can you share the "squid -v" output and the OS you are using?

Eliezer

On 01/05/2015 06:29 PM, Steve Hill wrote:
> On 10.12.14 17:09, Amos Jeffries wrote:
> 
>>> I'm looking for advice on figuring out what is causing
>>> intermittent high CPU usage.
> 
> It appears that the connections gradually gain more and more notes
> with the key "token" (and values containing Kerberos tokens).  I
> haven't been able to reproduce the problem reliably enough to
> determine if this is the root of the high CPU usage problem, but it
> certainly doesn't look right:
> 
> When an ACL is executed that requires the login name (e.g. the 
> proxy_auth ACL, or an external ACL using the %LOGIN format
> specifier), Acl.cc:AuthenticateAcl() is called.  This, in turn,
> calls UserRequest.cc:tryToAuthenticateAndSetAuthUser(), which
> calls UserRequest.cc:authTryGetUser().  Here we get a call to 
> Notes.cc:appendNewOnly() which appends all the notes from 
> checklist->auth_user_request->user()->notes.
> 
> I can see the appendNewOnly() call sometimes ends up appending a
> large number of "token" notes (I've observed requests with a couple
> of hundred "token" notes attached to them) - the number of notes
> increases each time a Kerberos authentication is performed.  My
> suspicion is that this growth is unbounded and in some cases the
> number of notes could become large enough to be a significant
> performance hit.
> 
> A couple of questions spring to mind:
> 
> 1. HelperReply.cc:parse() calls
> notes.add("token",authToken.content()) (i.e. it adds a token rather
> than replacing an existing one).  As far as I can tell, Squid only
> ever uses the first "token" note, so maybe we should be removing
> the old notes when we add a new one?
> 
> [Actually, on closer inspection, NotePairs::add() appends to the
> end of the list but NotePairs::findFirst() finds the note closest
> to the start of the list.  Unless I'm missing something, this means
> the newer "token" notes are added but never used?]
> 
> 2. I'm not sure on how the ACL checklists and User objects are
> shared between connections/requests and how they are supposed to
> persist.  It seems to me that there is something wrong with the
> sharing/persistence if we're accumulating so many "token" notes.
> As well as the performance problems, there could be some race
> conditions lurking here?

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUqr1iAAoJENxnfXtQ8ZQUkiYH/0CQXQAZNWiGfMj4razjcgRg
VXa8/GzvnkacAqUfGPtIxGqxzfjXg8Q9aP5bOrGI/3jBXUVT2bjzfO62wYkRnb7q
U/bgV5XXIiFjGYpgMDonXYBr1IAHkr18a+aH21b17nVkTKx32P0jPxncPEBliLnD
wAHGQox/DfMKyGkZBgvLDJ+Ol83V1iwCEzuRXTcR7L9jLKbB27RGN/3SUetNcvM1
04bTY0eCtO0tocIlNNci76U1Mb9RyL1RKuDUg+AlbnxP4mhWqd8X/OA8LtiqA7hQ
9CVIvXVwG4SZI5Ut5e96uJvbzjoSxbzjmkORx+s2/jJ7vOCAXgYuRaEDngci9VY=
=d44w
-----END PGP SIGNATURE-----


From yvoinov at gmail.com  Mon Jan  5 16:37:34 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 05 Jan 2015 22:37:34 +0600
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <54AABBC6.7090309@ngtech.co.il>
References: <54A2A4AB.1000003@gmail.com> <54A2AF50.2070103@treenet.co.nz>
 <HKNPR04MB1933D74D5F5A53D56ED20C8E85F0@HKNPR04MB193.apcprd04.prod.outlook.com>
 <54A7A164.8010400@trimble.com> <54A7AC13.4020001@gmail.com>
 <CAOsHgtvHt7BshV-4nVr9Bh-VPj44wNmYNm2cor=NbBDOs=kBkw@mail.gmail.com>
 <54A9B0BB.1050509@gmail.com>
 <CAOsHgtsrTZ9kqhcWcJwVnhnbA8L9eX0DZJfdbM+zB4tw-0LVZg@mail.gmail.com>
 <54A9FA7F.2020600@ngtech.co.il> <54AA4E16.8010707@gmail.com>
 <54AA6074.7080105@ngtech.co.il> <54AA7AC0.7000707@urlfilterdb.com>
 <54AA8D68.6020903@gmail.com> <54AA9B3C.7000604@urlfilterdb.com>
 <CAOsHgtvAT30b19yq=6B5jWeLAgJ3+9fFjAjv0LXcx=aJA6+6Bw@mail.gmail.com>
 <54AAAA87.1080204@urlfilterdb.com> <54AAAB58.6040306@gmail.com>
 <54AABBC6.7090309@ngtech.co.il>
Message-ID: <54AABDCE.5090008@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Agreed.

I'm expert on shell, not Perl/Python. :)

But will try to make some useful with it.

05.01.2015 22:28, Eliezer Croitoru ?????:
> On 01/05/2015 05:18 PM, Yuri Voinov wrote:
> > We haven't filtering non_HTTP over port-443. Just recognize and
> > pass.
>
> So let's separate security which is one of the goals of squid and
> which some like and other don't.
>
> For now squid 3.4 is stable and 3.5 is in beta and trunk is not for
> the public use.
> In 3.5 there will be present a new feature which called peek and
> splice that can give an interface to squid and the admin which will
> allow the admin to know couple things about the connection from squid
> and specifically first the client TLS request.
> Once squid bumped a connection there are couple steps until the
> connection is fully established between the client and the server:
> - receive the TCP connection from client
> - BUMP server or client FIRST
> - determine what certificate to send to the client based on the server
> initial ssl response
> - fake it
> - send to the client
> - MITM between two tls connections on the proxy while inspecting the
> content in the software layer.
>
> Peek and splice will add another step between the first part to the
> second and which will allow SNI usage.
> All the above is to allow better BUMPING.
> There might be or will be probably an interface that will identify or
> will try to identify inside the current stages of the connection
> bumping if the connection is indeed a TLS or another one.
> The first step of peek and splice can identify if the connection from
> the client side has started using a valid TLS\SSL headers.
>
> Leaving all the BUMPING yes or no You(Yuri) need a very specific tool
> or want a very specific tool.
> The basic interface of the external_acl can provide enough data on the
> connection in order to enforce some rules.
> You can either use the client IP address or just the destination IP
> and PORT.
>
> I cannot speak for the squid project but I am almost sure that the
> squid project will not provide you with an official helper and will
> not support it.
> However squid external_acl is there especially to help others achieve
> what they want using a variety of parameters from squid internals.
> The external_acl interface provides internal caching which supports
> caching ttl with different values for the two options either allow(OK)
> or DENY(ERR).
>
> My suggestions stays, don't use sqlite if possible.
> There is a sketch for a helper like you seems to want.
> Take the glove and write a pesudo code for the helper idea based on
> the assumptions:
> - There is a DB which can store timestamps, ip, port, result of test, etc
> - There is a way to check if the certificate is valid and the server
> works with TLS\SSL
> - There is no way for the helper to know that a certificate is pined
> - There is a way to add static records to the DB(web interface, cli)
> - All the requests will come from the proxy IP address and can by some
> be identified as an attack.
> - ufdbguard does not provide your needs since it uses url_rewrite
> interface and doesn't have the needed functionalities for you.
>
> The best I have seen until now was the python helper.
> If in couple(4-5) month nobody will do something with this I will see
> then what can be done with this if at all.
>
> Elizer
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUqr3NAAoJENNXIZxhPexG5UoIAKxANAcs77iuSQlNOmbO9D4B
xip3QbFhug2/LayR+Wa1Vd3UBUfkSUUdvvqedXRc6KKfCqxa5BECTYSpM0qT/L+h
WasstLpV/Mm2seYRK/CUJbmAJDps6mAgB8MdU1Kq9XWUVYGuGHXnWa220sU/TuhW
wD55VRDScX7cELOQyv4kCr/3mqobLD0KLAMwpDwtxel88eE9NYFW1OcIyM2XHtJd
ouY/hM6sAlYusXITrQrbOy7Sw5yT6DjY+sm6NYx7NCpDyKZTZemU0QVN9hEG6H0s
AmPi0m3OedUAmh83rXMS47+GyzIq3yxIqe52qOsFSsA5PoK/l93zqRivvUUTxyQ=
=sq3n
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150105/fde093b7/attachment.htm>

From steve at opendium.com  Mon Jan  5 17:48:54 2015
From: steve at opendium.com (Steve Hill)
Date: Mon, 05 Jan 2015 17:48:54 +0000
Subject: [squid-users] Debugging slow access
In-Reply-To: <54AABD62.7020707@ngtech.co.il>
References: <5488724B.9080304@opendium.com> <54887E44.30905@treenet.co.nz>
 <54AABBF6.4070305@opendium.com> <54AABD62.7020707@ngtech.co.il>
Message-ID: <54AACE86.5080708@opendium.com>

On 05.01.15 16:35, Eliezer Croitoru wrote:

> Can you share the "squid -v" output and the OS you are using?

Scientific Linux 6.6, see below for the squid -v output.

I've now more or less confirmed that this is the cause of my performance 
problems - every so often I see Squid using all the CPU whilst servicing 
very few requests.  Most of the CPU time is being used by the 
appendNewOnly() function.  For example, 228 milliseconds for 
appendNewOnly() to process a request with 2687 "token" notes attached to 
it, and this can happen more than once per request.


Squid Cache: Version 3.4.10
configure options:  '--build=x86_64-redhat-linux-gnu' 
'--host=x86_64-redhat-linux-gnu' '--target=x86_64-redhat-linux-gnu' 
'--program-prefix=' '--prefix=/usr' '--exec-prefix=/usr' 
'--bindir=/usr/bin' '--sbindir=/usr/sbin' '--sysconfdir=/etc' 
'--datadir=/usr/share' '--includedir=/usr/include' '--libdir=/usr/lib64' 
'--libexecdir=/usr/libexec' '--sharedstatedir=/var/lib' 
'--mandir=/usr/share/man' '--infodir=/usr/share/info' 
'--exec_prefix=/usr' '--libexecdir=/usr/lib64/squid' 
'--localstatedir=/var' '--datadir=/usr/share/squid' 
'--sysconfdir=/etc/squid' '--with-logdir=$(localstatedir)/log/squid' 
'--with-pidfile=$(localstatedir)/run/squid.pid' 
'--disable-dependency-tracking' '--enable-arp-acl' 
'--enable-follow-x-forwarded-for' '--enable-auth' 
'--enable-auth-basic-helpers=LDAP,MSNT,NCSA,PAM,SMB,YP,getpwnam,multi-domain-NTLM,SASL,DB,POP3,squid_radius_auth' 
'--enable-auth-ntlm-helpers=smb_lm,no_check,fakeauth' 
'--enable-auth-digest-helpers=password,ldap,eDirectory' 
'--enable-auth-negotiate-helpers=squid_kerb_auth' 
'--enable-external-acl-helpers=file_userip,LDAP_group,unix_group,wbinfo_group' 
'--enable-cache-digests' '--enable-cachemgr-hostname=localhost' 
'--enable-delay-pools' '--enable-epoll' '--enable-icap-client' 
'--enable-ident-lookups' '--enable-linux-netfilter' 
'--enable-referer-log' '--enable-removal-policies=heap,lru' 
'--enable-snmp' '--enable-ssl' '--enable-storeio=aufs,diskd,ufs,rock' 
'--enable-useragent-log' '--enable-wccpv2' '--enable-esi' '--with-aio' 
'--with-default-user=squid' '--with-filedescriptors=16384' '--with-dl' 
'--with-openssl' '--with-pthreads' 'build_alias=x86_64-redhat-linux-gnu' 
'host_alias=x86_64-redhat-linux-gnu' 
'target_alias=x86_64-redhat-linux-gnu' 'CFLAGS=-fPIE -Os -g -pipe 
-fsigned-char -O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions 
-fstack-protector --param=ssp-buffer-size=4 -m64 -mtune=generic' 
'LDFLAGS=-pie' 'CXXFLAGS=-fPIE -O2 -g -pipe -Wall 
-Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector 
--param=ssp-buffer-size=4 -m64 -mtune=generic' 
'PKG_CONFIG_PATH=/usr/lib64/pkgconfig:/usr/share/pkgconfig' 
--enable-ltdl-convenience


-- 
  - Steve Hill
    Technical Director
    Opendium Limited     http://www.opendium.com

Direct contacts:
    Instant messager: xmpp:steve at opendium.com
    Email:            steve at opendium.com
    Phone:            sip:steve at opendium.com

Sales / enquiries contacts:
    Email:            sales at opendium.com
    Phone:            +44-1792-824568 / sip:sales at opendium.com

Support contacts:
    Email:            support at opendium.com
    Phone:            +44-1792-825748 / sip:support at opendium.com


From squid3 at treenet.co.nz  Mon Jan  5 18:43:05 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 06 Jan 2015 07:43:05 +1300
Subject: [squid-users] Squid Source Code: What files/functions
 receive/send packets from/to hardware
In-Reply-To: <CALTPfpEWb4CKDyAS7Y5xdL1RKtxi3ANd=kpALFRiFyXtgSLW9w@mail.gmail.com>
References: <CALTPfpHJ_CX8T7YiwU0knvAyQD72VA5HZqYsdPvBqi4ABtkMPQ@mail.gmail.com>	<54AABA53.1080408@treenet.co.nz>
 <CALTPfpEWb4CKDyAS7Y5xdL1RKtxi3ANd=kpALFRiFyXtgSLW9w@mail.gmail.com>
Message-ID: <54AADB39.1010200@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 6/01/2015 6:01 a.m., Priya Agarwal wrote:
> Thank you for the reply.
> 
> I do not intend to change its functionality. I just want to make it
> run on a processor (Freescale's T4240). For that it has to use some
> new architectural features (Data Path Acceleration Architecture)
> which are a part of the processor.
> 
> For e.g. suppose squid was merely swapping ipv4/mac src and dest
> addresses( just an example! ) in the packet header and sends it
> back. So I don't want to change what it does, I just want squid to
> send whatever data it has prepared to a memory location. Basically
> instead of receiving and sending to OS Stack, I want to it read and
> write from memory.  (Further details : This memory is basically a
> memory-mapped device which is further responsible for transmitting
> the frame to a network interface, ethernet)
> 
> So maybe if I could know where in the source code does it
> communicate with the OS stack.

Ah, that kind of packet handling is all much, much lower level than Squid.

Squid uses functions provided by the POSIX system API with socket
handles/"filedescriptors".

http://man7.org/linux/man-pages/man7/socket.7.html
http://man7.org/linux/man-pages/man2/read.2.html
http://man7.org/linux/man-pages/man2/write.2.html

The functions in src/fd.cc are where that happens, the lowest
networking-I/O level of Squid.


NP: If you want to take this further and/or discuss any other feature
additions/changes I encourage you to sign up to squid-dev mailing list
and discuss it with the whole dev team. This list is for general user
discussions, (though sometimes code talk from someone doing bug
investigations does slip in).

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUqts4AAoJELJo5wb/XPRjJu4IANCAhXt7PM48xHkERw/mz/sa
heSoEC7nJXaLpRz9JSq085UY2F0p55/GH0Gdh+XLq0h6kMLZB8qYTify0WMp18Jj
sfVOhuURZVdabS5ldW2ZrqftsqCt5eu3JvgHtQ+ewp8RhN5OI6OTQbCL9sf6llWY
Vqm1gno2IymyjcsuPYzpDv7sw7M3odJSETAD2eh6E3r+++uN1q5R4JZ7GZt5mgaE
tIJF0DyOlhAfAJIniCImZ0MDqWHLWjrzLWZRazHg4zA025TinDxkjy+qfHnjYfDc
oIFh9t/mtSbHPnBiZmsyUDOfl/wB0EOMuXEItoLGgBLh/71huVf2QRmfXUr6qS8=
=oajV
-----END PGP SIGNATURE-----


From eliezer at ngtech.co.il  Mon Jan  5 20:11:10 2015
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Mon, 05 Jan 2015 22:11:10 +0200
Subject: [squid-users] Debugging slow access
In-Reply-To: <54AACE86.5080708@opendium.com>
References: <5488724B.9080304@opendium.com> <54887E44.30905@treenet.co.nz>
 <54AABBF6.4070305@opendium.com> <54AABD62.7020707@ngtech.co.il>
 <54AACE86.5080708@opendium.com>
Message-ID: <54AAEFDE.3080700@ngtech.co.il>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Did you had the chance to take look at bug 3997:
http://bugs.squid-cache.org/show_bug.cgi?id=3997

The issue is being tested and there is something that causing it and
from my understanding squid does something wrong but I cannot confirm
it as the source.
If you can add the new details about the issue in the bug report it
will help a lot.

Eliezer

On 01/05/2015 07:48 PM, Steve Hill wrote:
> On 05.01.15 16:35, Eliezer Croitoru wrote:
> 
>> Can you share the "squid -v" output and the OS you are using?
> 
> Scientific Linux 6.6, see below for the squid -v output.
> 
> I've now more or less confirmed that this is the cause of my
> performance problems - every so often I see Squid using all the CPU
> whilst servicing very few requests.  Most of the CPU time is being
> used by the appendNewOnly() function.  For example, 228
> milliseconds for appendNewOnly() to process a request with 2687
> "token" notes attached to it, and this can happen more than once
> per request.
> 
> 
> Squid Cache: Version 3.4.10 configure options:
> '--build=x86_64-redhat-linux-gnu' '--host=x86_64-redhat-linux-gnu'
> '--target=x86_64-redhat-linux-gnu' '--program-prefix='
> '--prefix=/usr' '--exec-prefix=/usr' '--bindir=/usr/bin'
> '--sbindir=/usr/sbin' '--sysconfdir=/etc' '--datadir=/usr/share'
> '--includedir=/usr/include' '--libdir=/usr/lib64' 
> '--libexecdir=/usr/libexec' '--sharedstatedir=/var/lib' 
> '--mandir=/usr/share/man' '--infodir=/usr/share/info' 
> '--exec_prefix=/usr' '--libexecdir=/usr/lib64/squid' 
> '--localstatedir=/var' '--datadir=/usr/share/squid' 
> '--sysconfdir=/etc/squid'
> '--with-logdir=$(localstatedir)/log/squid' 
> '--with-pidfile=$(localstatedir)/run/squid.pid' 
> '--disable-dependency-tracking' '--enable-arp-acl' 
> '--enable-follow-x-forwarded-for' '--enable-auth' 
> '--enable-auth-basic-helpers=LDAP,MSNT,NCSA,PAM,SMB,YP,getpwnam,multi-domain-NTLM,SASL,DB,POP3,squid_radius_auth'
>
> 
'--enable-auth-ntlm-helpers=smb_lm,no_check,fakeauth'
> '--enable-auth-digest-helpers=password,ldap,eDirectory' 
> '--enable-auth-negotiate-helpers=squid_kerb_auth' 
> '--enable-external-acl-helpers=file_userip,LDAP_group,unix_group,wbinfo_group'
>
> 
'--enable-cache-digests' '--enable-cachemgr-hostname=localhost'
> '--enable-delay-pools' '--enable-epoll' '--enable-icap-client' 
> '--enable-ident-lookups' '--enable-linux-netfilter' 
> '--enable-referer-log' '--enable-removal-policies=heap,lru' 
> '--enable-snmp' '--enable-ssl'
> '--enable-storeio=aufs,diskd,ufs,rock' '--enable-useragent-log'
> '--enable-wccpv2' '--enable-esi' '--with-aio' 
> '--with-default-user=squid' '--with-filedescriptors=16384'
> '--with-dl' '--with-openssl' '--with-pthreads'
> 'build_alias=x86_64-redhat-linux-gnu' 
> 'host_alias=x86_64-redhat-linux-gnu' 
> 'target_alias=x86_64-redhat-linux-gnu' 'CFLAGS=-fPIE -Os -g -pipe 
> -fsigned-char -O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2
> -fexceptions -fstack-protector --param=ssp-buffer-size=4 -m64
> -mtune=generic' 'LDFLAGS=-pie' 'CXXFLAGS=-fPIE -O2 -g -pipe -Wall 
> -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector 
> --param=ssp-buffer-size=4 -m64 -mtune=generic' 
> 'PKG_CONFIG_PATH=/usr/lib64/pkgconfig:/usr/share/pkgconfig' 
> --enable-ltdl-convenience

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBAgAGBQJUqu/eAAoJENxnfXtQ8ZQUaBAH/146ro2Zhu05/d1hMdMo4e9V
6vreXFmlaNYhoP+/drvefLhSN53TtFtKkhcvnM5IZOQoVSS/Sv8pe/uQ04Z7LksM
kfB24SP/rSM8l1QFTH+v0usdUDbm/uLZk5BYvxCI2zoJCQ/PW4v4gFAepUyKqOFH
I9fjg168wn9bdKe+jtQ5d1y5jkYewBe8ijfwIeUVcHHwnK2q/38V/61JmdGLpjGW
cBmxTujLPpufSgP2fUXIdinM1ZRWoINh5OXVJuzj8DO2BJCVf37btW4Xv8BrpSuK
2qbKHR+k+wpJUhbd29lqpHYxHal6PhN4dHA++G/zM5c97CxHTSdf6QKO5R462HY=
=vKmo
-----END PGP SIGNATURE-----


From yvoinov at gmail.com  Tue Jan  6 09:55:49 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Tue, 06 Jan 2015 15:55:49 +0600
Subject: [squid-users] Squid 3.4.10 sometimes catch assertion without core
Message-ID: <54ABB125.60406@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Hi gents,

I observe assertion. Time to time, with irregular interval and witout
visible reasons:

2015/01/06 15:52:10 kid1| storeLateRelease: released 0 objects
2015/01/06 15:52:11 kid1| assertion failed: comm.cc:178:
"fd_table[conn->fd].halfClosedReader != NULL"
2015/01/06 15:52:15 kid1| Set Current Directory to /var/core

Core dump not produced.

What is it may be?

WBR, Yuri
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUq7ElAAoJENNXIZxhPexG78QH/1TveV/2keFBHctUYpE1dBFf
H5m41QCOn0bqyDKTcPNApoc1drzO3f/BLrZBqf1SGifG5jJP6n3wUvXK5FLTQgiO
z4qE9baSMRbDpgtqMXAADVMZrD7zjJ0svWVTmnrYLBFrkFTPzxCEwUcX8Osy8zHK
WD9tJYa6+Au8Z4GQmFn19PamvDLNIHwxfeuPM1NFMKIQJFw9SYh3KmTo6MImCnSh
d4+b/MfdQ7DeNdSn8Q+ISKWab5afSEsEEmwl//4dAw5Do6B3ZG8za2eINbK7xpB5
alq8QYGI3vFH4aE5HhWViJohp9JNPXwqz0tia/yjXUnZxevi6Pqxd3S3pjdwAIA=
=Momr
-----END PGP SIGNATURE-----



From Jason_Haar at trimble.com  Tue Jan  6 09:59:48 2015
From: Jason_Haar at trimble.com (Jason Haar)
Date: Tue, 6 Jan 2015 22:59:48 +1300
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <54AABBC6.7090309@ngtech.co.il>
References: <54A2A4AB.1000003@gmail.com> <54A2AF50.2070103@treenet.co.nz>
 <HKNPR04MB1933D74D5F5A53D56ED20C8E85F0@HKNPR04MB193.apcprd04.prod.outlook.com>
 <54A7A164.8010400@trimble.com> <54A7AC13.4020001@gmail.com>
 <CAOsHgtvHt7BshV-4nVr9Bh-VPj44wNmYNm2cor=NbBDOs=kBkw@mail.gmail.com>
 <54A9B0BB.1050509@gmail.com>
 <CAOsHgtsrTZ9kqhcWcJwVnhnbA8L9eX0DZJfdbM+zB4tw-0LVZg@mail.gmail.com>
 <54A9FA7F.2020600@ngtech.co.il> <54AA4E16.8010707@gmail.com>
 <54AA6074.7080105@ngtech.co.il> <54AA7AC0.7000707@urlfilterdb.com>
 <54AA8D68.6020903@gmail.com> <54AA9B3C.7000604@urlfilterdb.com>
 <CAOsHgtvAT30b19yq=6B5jWeLAgJ3+9fFjAjv0LXcx=aJA6+6Bw@mail.gmail.com>
 <54AAAA87.1080204@urlfilterdb.com> <54AAAB58.6040306@gmail.com>
 <54AABBC6.7090309@ngtech.co.il>
Message-ID: <54ABB214.7020107@trimble.com>

On 06/01/15 05:28, Eliezer Croitoru wrote:
> In 3.5 there will be present a new feature which called peek and
> splice that can give an interface to squid and the admin which will
> allow the admin to know couple things about the connection from squid
> and specifically first the client TLS request.
Is there an example document showing just how to do this? Looking at the
current docs, I can't quite figure out how to layer them all together to
achieve what I'd imagine 99% of sysadmins wanting to do ssl-bump need to
do. Even squid-3.4 works very well without peek/splice - if you are
using it as a formal proxy. But it all falls apart with transparent tcp
443 - as squid only has the dst IP...

What I'd like to do is to use peek to grab the SSL server name the
client sends so that  it is available to acls (and external acl calls -
and logging?) as if the client had gone "CONNECT server.name:443"?

A quick sniff with wireshark shows Firefox (as an example) sends the
server name as a client SNI request in the first "real" packet (ie after
the 3-way), so that smells to my naive understanding as "good for a
peek" - and should allow squid to do an initial chat with the client,
get the SNI, then dupe with the real server, then decide if to splice or
bump the rest? Clients that don't support SNI will probably have to be
spliced - I don't care - I'm only interested in running AV scanners and
porn filters over HTTPS requests from web browsers - the 0.1% remaining
SSL traffic can slip through the cracks for all I care ;-)
 

-- 
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1



From yvoinov at gmail.com  Tue Jan  6 11:27:25 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Tue, 06 Jan 2015 17:27:25 +0600
Subject: [squid-users] MD5_CTX strikes back
Message-ID: <54ABC69D.6020807@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Hi gents,

old good bug returns.

When build with Solaris Studio, I've got this error:

libtool: compile:  /bin/CC -DHAVE_CONFIG_H -I../.. -I../../include
-I../../lib -I../../src -I../../include -I/usr/include/gssapi
-I/usr/include/kerberosv5 -I../../libltdl -I/usr/sfw/include
-I/usr/include/gssapi -I/usr/include/kerberosv5 -D_REENTRANT -lpthread
-DSOLARIS2=10 -xarch=generic64 -xO4 -xtarget=native -m64 -c
Intercept.cc  -KPIC -DPIC -o .libs/Intercept.o
CC: Warning: -xarch=generic64 is deprecated, use -m64 to create 64-bit
programs
"/usr/include/sys/md5.h", line 62: Error: Multiple declaration for MD5_CTX.
1 Error(s) detected.
Makefile:814: recipe for target 'Intercept.lo' failed
make[3]: *** [Intercept.lo] Error 1
make[3]: Leaving directory '/patch/squid-3.4.10/src/ip'
Makefile:7091: recipe for target 'all-recursive' failed
make[2]: *** [all-recursive] Error 1
make[2]: Leaving directory '/patch/squid-3.4.10/src'
Makefile:6036: recipe for target 'all' failed
make[1]: *** [all] Error 2
make[1]: Leaving directory '/patch/squid-3.4.10/src'
Makefile:562: recipe for target 'all-recursive' failed
make: *** [all-recursive] Error 1

This if configure and build with openssl 0.9.8.

With openssl 1.0.0 another error:

libtool: compile:  /bin/CC -DHAVE_CONFIG_H -I../.. -I../../include
-I../../lib -I../../src -I../../include -I/usr/include/gssapi
-I/usr/include/kerberosv5 -I../../libltdl -I/opt/csw/include
-I/usr/include/gssapi -I/usr/include/kerberosv5 -D_REENTRANT -lpthread
-DSOLARIS2=10 -xarch=generic64 -xO4 -xtarget=native -m64 -c PortCfg.cc 
-KPIC -DPIC -o .libs/PortCfg.o
CC: Warning: -xarch=generic64 is deprecated, use -m64 to create 64-bit
programs
"../../src/ssl/gadgets.h", line 79: Error: Different types for "?:"
(extern "C" void(*)(x509_st*) and void(*)(x509_st*)).
"../../src/ssl/gadgets.h", line 79: Warning (Anachronism): Formal
argument func of type extern "C" void(*)(void*) in call to
sk_pop_free(stack_st*, extern "C" void(*)(void*)) is being passed
void(*)(void*).
"../../src/ssl/gadgets.h", line 115: Error: Different types for "?:"
(extern "C" void(*)(X509_crl_st*) and void(*)(X509_crl_st*)).
"../../src/ssl/gadgets.h", line 115: Warning (Anachronism): Formal
argument func of type extern "C" void(*)(void*) in call to
sk_pop_free(stack_st*, extern "C" void(*)(void*)) is being passed
void(*)(void*).
"../../src/ssl/gadgets.h", line 118: Error: Different types for "?:"
(extern "C" void(*)(X509_name_st*) and void(*)(X509_name_st*)).
"../../src/ssl/gadgets.h", line 118: Warning (Anachronism): Formal
argument func of type extern "C" void(*)(void*) in call to
sk_pop_free(stack_st*, extern "C" void(*)(void*)) is being passed
void(*)(void*).
3 Error(s) and 3 Warning(s) detected.
Makefile:767: recipe for target 'PortCfg.lo' failed
make[3]: *** [PortCfg.lo] Error 1
make[3]: Leaving directory '/patch/squid-3.4.10/src/anyp'
Makefile:7091: recipe for target 'all-recursive' failed
make[2]: *** [all-recursive] Error 1
make[2]: Leaving directory '/patch/squid-3.4.10/src'
Makefile:6036: recipe for target 'all' failed
make[1]: *** [all] Error 2
make[1]: Leaving directory '/patch/squid-3.4.10/src'
Makefile:562: recipe for target 'all-recursive' failed
make: *** [all-recursive] Error 1

It is treated, doctor? :)

I remember, this problem was on Squid 2, 8-10 years ago. And was solved.

And this annoying warning:

CC: Warning: -xarch=generic64 is deprecated, use -m64 to create 64-bit
programs

in that configuration specified -m64 explicity:

./configure '--prefix=/usr/local/squid' '--enable-translation'
'--enable-external-acl-helpers=none' '--enable-icap-client'
'--enable-ipf-transparent' '--enable-storeio=diskd'
'--enable-removal-policies=lru,heap' '--enable-devpoll' '--disable-wccp'
'--enable-wccpv2' '--enable-http-violations'
'--enable-follow-x-forwarded-for' '--enable-arp-acl' '--enable-htcp'
'--enable-cache-digests' '--with-dl' '--enable-auth-negotiate=none'
'--disable-auth-digest' '--disable-auth-ntlm' '--enable-auth-basic=none'
'--disable-url-rewrite-helpers' '--enable-storeid-rewrite-helpers=file'
'--enable-log-daemon-helpers=file' '--enable-ssl' '--enable-ssl-crtd'
'--with-openssl=/opt/csw' '--enable-zph-qos'
'--with-filedescriptors=131072' '--disable-snmp'
'--disable-strict-error-checking'
'--with-build-environment=POSIX_V6_LP64_OFF64' 'CFLAGS=-xO4
-xtarget=native -m64' 'CXXFLAGS=-xO4 -xtarget=native -m64'
--enable-build-info="Intercept/WCCPv2/SSL/CRTD/DISKD/64/CC Production"

WBR, Yuri
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUq8acAAoJENNXIZxhPexG2uMH/36KiXwo4IUkdERkLKNJNmN0
JILUdEo/orJu0eq3TPDJ46VMlC9pb7wuHWMSLkA7bT5zDcZ6vLIl2wUjD15Xq13l
bv7VXWrw8w6A7jp0FiEiY+lK0DVG06Bfe8mGHVDLAo9MuWMLiG5S7O/iRnwZh+SI
9cnkftWFExStLFZSQWmTjoMiFBBXMN8ZWC2jnW6lZjRO4Fux3ZCYV1L6C5WCRzuD
W2SoAVyYrIlJqDBY20IIk45zM92jw0YOJ/hKEnnufdEFjGC8Qmw6wSkY4SZ/yi5h
nJm930EOIwW3RpWTxWZBBIWvZMmWU42ntsshm90WeuFZHq7JH0feeYpzp5M0p1U=
=WmJF
-----END PGP SIGNATURE-----




From steve at opendium.com  Tue Jan  6 12:15:48 2015
From: steve at opendium.com (Steve Hill)
Date: Tue, 06 Jan 2015 12:15:48 +0000
Subject: [squid-users] Debugging slow access
In-Reply-To: <54AAD4D9.8030403@treenet.co.nz>
References: <5488724B.9080304@opendium.com> <54887E44.30905@treenet.co.nz>
 <54AABBF6.4070305@opendium.com> <54AAD4D9.8030403@treenet.co.nz>
Message-ID: <54ABD1F4.1030803@opendium.com>

On 05.01.15 18:15, Amos Jeffries wrote:

> Can you try making the constructor at the top of src/HelperReply.cc
> look like this and see if it resolves the problem?
>
> HelperReply::HelperReply(char *buf, size_t len) :
>          result(HelperReply::Unknown),
>          notes(),
>          whichServer(NULL)
> {
>      assert(notes.empty());
>      parse(buf,len);
> }

This didn't help I'm afraid.

Some further debugging so far today:
The notes in HelperReply are indeed empty when the token is added.

However, Auth::Negotiate::UserRequest::HandleReply() appends the reply 
notes to auth_user_request.  It fetches a cached user record from 
proxy_auth_username_cache and then calls absorb() to merge 
auth_user_request with the cached user record.  This ends up adding the 
new Negotiate token into the cached record.  This keeps happening for 
each new request and the cached user record gradually accumulates tokens.

As far as I can see, tokens are only ever read from the helper's reply 
notes, not the user's notes, so maybe the tokens never need to be 
appended to auth_user_request in the first place?

Alternatively, A->absorb(B) could be altered to remove any notes from A 
that have the same keys as B's notes, before using appendNewOnly() to 
merge them?

-- 
  - Steve Hill
    Technical Director
    Opendium Limited     http://www.opendium.com

Direct contacts:
    Instant messager: xmpp:steve at opendium.com
    Email:            steve at opendium.com
    Phone:            sip:steve at opendium.com

Sales / enquiries contacts:
    Email:            sales at opendium.com
    Phone:            +44-1792-824568 / sip:sales at opendium.com

Support contacts:
    Email:            support at opendium.com
    Phone:            +44-1792-825748 / sip:support at opendium.com


From Jerome.Vernet at belambra.fr  Tue Jan  6 12:38:05 2015
From: Jerome.Vernet at belambra.fr (Vernet Jerome)
Date: Tue, 6 Jan 2015 13:38:05 +0100
Subject: [squid-users] Growing cache.log
Message-ID: <30F6B89CD3037744A6C17325D90A6F6107596F01@cordelia.ad2003.intra>

Hi,

Since yesterday, my Squid cache.log grow very fast, about 250Mb per hour. Lot of messages like this one:

2015/01/06 13:16:31| WARNING: unparseable HTTP header field {24eb927c; put_2588=48b1dcc8-a78f-4800-9595-62f724eb927c; put_2261=48b1dcc8-a78f-4800-9595-62f724eb927c; put_2616=48b1dcc8-a78f-4800-9595-62f724eb927c; put_2554=48b1dcc8-a78f-4800-9595-62f724eb927c; put_2556=48b1dcc8-a78f-4800-9595-62f724eb927c; put_2618=48b1dcc8-a78f-4800-9595-62f724eb927c; put_2650=80b864ea-dfe2-4835-a873-5613e0a33cc7; put_3105=1493c585fea-b33b5cd2-910a-4fc3-a6d2-5d8d1991f95e; put_3470=rOmY83fj5OYxSa5ijLx2; put_2909=1709bdb9520f10329958d1e869962e1f; put_3734=44209251ce644a0c; put_3176=74i}

Or
2015/01/06 13:34:43| tunnelConnectTimeout(): tunnelState->servers is NULL

Any idea what's going on ? How can I suppress these warning ?

My Squid version:
Squid Cache: Version 3.1.23
configure options:  '--build=i486-linux-gnu' '--prefix=/usr' '--includedir=${prefix}/include' '--mandir=${prefix}/share/man' '--infodir=${prefix}/share/info' '--sysconfdir=/etc' '--localstatedir=/var' '--libexecdir=${prefix}/lib/squid3' '--disable-maintainer-mode' '--disable-dependency-tracking' '--disable-silent-rules' '--srcdir=.' '--datadir=/usr/share/squid3' '--sysconfdir=/etc/squid3' '--mandir=/usr/share/man' '--with-cppunit-basedir=/usr' '--enable-inline' '--enable-async-io=8' '--enable-storeio=ufs,aufs,diskd' '--enable-removal-policies=lru,heap' '--enable-delay-pools' '--enable-cache-digests' '--enable-underscores' '--enable-icap-client' '--enable-follow-x-forwarded-for' '--enable-auth=basic,digest,ntlm,negotiate' '--enable-basic-auth-helpers=LDAP,MSNT,NCSA,PAM,SASL,SMB,YP,,getpwnam,squid_radius_auth,multi-domain-NTLM' '--enable-ntlm-auth-helpers=smb_lm,' '--enable-digest-auth-helpers=ldap,password' '--enable-negotiate-auth-helpers=squid_kerb_auth' '--enable-external-acl-helpers=ip_user,ldap_group,session,unix_group,wbinfo_group' '--enable-arp-acl' '--enable-esi' '--disable-translation' '--with-logdir=/var/log/squid3' '--with-pidfile=/var/run/squid3.pid' '--with-filedescriptors=65536' '--with-large-files' '--with-default-user=proxy' '--enable-linux-netfilter' 'build_alias=i486-linux-gnu' 'CFLAGS=-g -O2 -g -Wall -O2' 'LDFLAGS=' 'CPPFLAGS=' 'CXXFLAGS=-g -O2 -g -Wall -O2' --with-squid=/home/sysres01/squid3/squid-3.1.23

squid.conf: debug_options ALL,1 33,0 29,1

Thanks,

JV





From steve at opendium.com  Tue Jan  6 12:41:43 2015
From: steve at opendium.com (Steve Hill)
Date: Tue, 06 Jan 2015 12:41:43 +0000
Subject: [squid-users] Debugging slow access
In-Reply-To: <54AAEFDE.3080700@ngtech.co.il>
References: <5488724B.9080304@opendium.com> <54887E44.30905@treenet.co.nz>
 <54AABBF6.4070305@opendium.com> <54AABD62.7020707@ngtech.co.il>
 <54AACE86.5080708@opendium.com> <54AAEFDE.3080700@ngtech.co.il>
Message-ID: <54ABD807.7070501@opendium.com>

On 05.01.15 20:11, Eliezer Croitoru wrote:

> Did you had the chance to take look at bug 3997:
> http://bugs.squid-cache.org/show_bug.cgi?id=3997

This could quite likely be the same issue.  See my other post this 
morning for details, but I've pretty much tracked this down to the 
Negotiate tokens being appended to user cache records in an unbounded 
way.  Eventually you end up with so many tokens (several thousand) that 
the majority of the CPU time is spent traversing the tokens.  A quick 
look at the NTLM code suggests that this would behave in the same way.

The question now is what the "correct" way is to fix it - we could 
specifically avoid appending "token" notes in the Negotiate/NTLM code, 
or we could do something more generic in the absorb() method.  (My 
preference is the latter unless anyone can think why it would be a bad 
idea).

-- 
  - Steve Hill
    Technical Director
    Opendium Limited     http://www.opendium.com

Direct contacts:
    Instant messager: xmpp:steve at opendium.com
    Email:            steve at opendium.com
    Phone:            sip:steve at opendium.com

Sales / enquiries contacts:
    Email:            sales at opendium.com
    Phone:            +44-1792-824568 / sip:sales at opendium.com

Support contacts:
    Email:            support at opendium.com
    Phone:            +44-1792-825748 / sip:support at opendium.com


From steve at opendium.com  Tue Jan  6 17:11:50 2015
From: steve at opendium.com (Steve Hill)
Date: Tue, 06 Jan 2015 17:11:50 +0000
Subject: [squid-users] Debugging slow access
In-Reply-To: <54ABD1F4.1030803@opendium.com>
References: <5488724B.9080304@opendium.com> <54887E44.30905@treenet.co.nz>
 <54AABBF6.4070305@opendium.com> <54AAD4D9.8030403@treenet.co.nz>
 <54ABD1F4.1030803@opendium.com>
Message-ID: <54AC1756.8080002@opendium.com>

On 06.01.15 12:15, Steve Hill wrote:

> Alternatively, A->absorb(B) could be altered to remove any notes from A
> that have the same keys as B's notes, before using appendNewOnly() to
> merge them?

I've implemented this for now in the attached patch and am currently 
testing it.  Initial results suggest it resolves the problem.

It introduces a new method, NotePairs::appendAndReplace(), which 
iterates through the source NotePairs and removes any NotePairs in the 
destination that have the same key, then calls append().

This is not the most efficient way of erasing the notes, because Squid's 
Vector template doesn't appear to have an erase() method.

-- 
  - Steve Hill
    Technical Director
    Opendium Limited     http://www.opendium.com

Direct contacts:
    Instant messager: xmpp:steve at opendium.com
    Email:            steve at opendium.com
    Phone:            sip:steve at opendium.com

Sales / enquiries contacts:
    Email:            sales at opendium.com
    Phone:            +44-1792-824568 / sip:sales at opendium.com

Support contacts:
    Email:            support at opendium.com
    Phone:            +44-1792-825748 / sip:support at opendium.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: squid-notes.patch
Type: text/x-patch
Size: 1984 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150106/19c2e058/attachment.bin>

From richter at richtercloud.de  Tue Jan  6 19:39:15 2015
From: richter at richtercloud.de (Karl-Philipp Richter)
Date: Tue, 06 Jan 2015 19:39:15 +0000
Subject: [squid-users] Is it possible to configure a transparent caching
 proxy without iptables?
Message-ID: <4ttzti1jd6u8.ma9n39-474mo1gy5k3k5m@api.elasticemail.com>

Hi together,
I'm having trouble figuring a way to configure a `squid` 3.4.10 instance
running in a Debian 7 chroot as a transparent caching proxy because I
only find configuration examples involving `iptables` which on the one
hand is very useful because it allows setups which work independently of
environment variables and program settings on the other hand requires
access to kernel module loading and unloading. It might be the case that
the latter is considered an acceptable tradeoff for the advantages of
the former.

That leads me to the question whether it is at all possible to configure
a `squid` instance to store data of requests from within a local network
to the outside (of the local network) in order to avoid to fetch them
again and again from the outside (a caching proxy AFAIK, but I'm
clearifying in order to avoid confusion). Of course this would require
the setup of an environment variable, like `http_proxy` on Linux, or
even individual program settings with all the disadvantages of extended
maintenance necessity.

What would be the case it I had access to `iptables` on the client and
not on the machine where `squid` is running. After setting `http_port
3128 transparent` in `squid.conf` I'm getting access denial errors due
to forwarding loops

    2015/01/06 20:35:34 kid1| WARNING: Forwarding loop detected for:
    GET / HTTP/1.1
    Accept-Encoding: identity
    Host: google.com
    User-Agent: Python-urllib/3.4
    Via: 1.1 diskstation (squid/3.4.10)
    X-Forwarded-For: 192.168.178.22
    Cache-Control: max-age=259200
    Connection: keep-alive

but that's just an example to avoid questions like "What have you tried
so far". I'm more looking for an abstract, general answer.

Best regards,
Kalle


From eliezer at ngtech.co.il  Wed Jan  7 13:17:29 2015
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Wed, 07 Jan 2015 15:17:29 +0200
Subject: [squid-users] Debugging slow access
In-Reply-To: <54AC1756.8080002@opendium.com>
References: <5488724B.9080304@opendium.com> <54887E44.30905@treenet.co.nz>
 <54AABBF6.4070305@opendium.com> <54AAD4D9.8030403@treenet.co.nz>
 <54ABD1F4.1030803@opendium.com> <54AC1756.8080002@opendium.com>
Message-ID: <54AD31E9.2030309@ngtech.co.il>

Hey Steve,

First of all thanks for all the notes.
You made it possible to look at the bug before I understood how to 
reproduce it.
I would like for the record to make sure we can reproduce it just for 
the tests list that I will add later to newer releases.
Can you give me the details about any testing environment?

Eliezer

On 06/01/2015 19:11, Steve Hill wrote:
>
> I've implemented this for now in the attached patch and am currently
> testing it.  Initial results suggest it resolves the problem.
>
> It introduces a new method, NotePairs::appendAndReplace(), which
> iterates through the source NotePairs and removes any NotePairs in the
> destination that have the same key, then calls append().
>
> This is not the most efficient way of erasing the notes, because Squid's
> Vector template doesn't appear to have an erase() method.




From eliezer at ngtech.co.il  Wed Jan  7 13:19:51 2015
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Wed, 07 Jan 2015 15:19:51 +0200
Subject: [squid-users] Growing cache.log
In-Reply-To: <30F6B89CD3037744A6C17325D90A6F6107596F01@cordelia.ad2003.intra>
References: <30F6B89CD3037744A6C17325D90A6F6107596F01@cordelia.ad2003.intra>
Message-ID: <54AD3277.9010708@ngtech.co.il>

Hey (Is it Jerome? or Vernet?),

Is there a chance you can test it with a newer version of squid?
What OS are you using?
Can you share your squid.conf?

Eliezer

On 06/01/2015 14:38, Vernet Jerome wrote:
> Hi,
>
> Since yesterday, my Squid cache.log grow very fast, about 250Mb per hour. Lot of messages like this one:
>
> 2015/01/06 13:16:31| WARNING: unparseable HTTP header field {24eb927c; put_2588=48b1dcc8-a78f-4800-9595-62f724eb927c; put_2261=48b1dcc8-a78f-4800-9595-62f724eb927c; put_2616=48b1dcc8-a78f-4800-9595-62f724eb927c; put_2554=48b1dcc8-a78f-4800-9595-62f724eb927c; put_2556=48b1dcc8-a78f-4800-9595-62f724eb927c; put_2618=48b1dcc8-a78f-4800-9595-62f724eb927c; put_2650=80b864ea-dfe2-4835-a873-5613e0a33cc7; put_3105=1493c585fea-b33b5cd2-910a-4fc3-a6d2-5d8d1991f95e; put_3470=rOmY83fj5OYxSa5ijLx2; put_2909=1709bdb9520f10329958d1e869962e1f; put_3734=44209251ce644a0c; put_3176=74i}
>
> Or
> 2015/01/06 13:34:43| tunnelConnectTimeout(): tunnelState->servers is NULL
>
> Any idea what's going on ? How can I suppress these warning ?




From squid3 at treenet.co.nz  Wed Jan  7 13:45:53 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 08 Jan 2015 02:45:53 +1300
Subject: [squid-users] Growing cache.log
In-Reply-To: <30F6B89CD3037744A6C17325D90A6F6107596F01@cordelia.ad2003.intra>
References: <30F6B89CD3037744A6C17325D90A6F6107596F01@cordelia.ad2003.intra>
Message-ID: <54AD3891.504@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 7/01/2015 1:38 a.m., Vernet Jerome wrote:
> Hi,
> 
> Since yesterday, my Squid cache.log grow very fast, about 250Mb
> per hour. Lot of messages like this one:
> 
> 2015/01/06 13:16:31| WARNING: unparseable HTTP header field 
> {24eb927c; put_2588=48b1dcc8-a78f-4800-9595-62f724eb927c; 
> put_2261=48b1dcc8-a78f-4800-9595-62f724eb927c; 
> put_2616=48b1dcc8-a78f-4800-9595-62f724eb927c; 
> put_2554=48b1dcc8-a78f-4800-9595-62f724eb927c; 
> put_2556=48b1dcc8-a78f-4800-9595-62f724eb927c; 
> put_2618=48b1dcc8-a78f-4800-9595-62f724eb927c; 
> put_2650=80b864ea-dfe2-4835-a873-5613e0a33cc7; 
> put_3105=1493c585fea-b33b5cd2-910a-4fc3-a6d2-5d8d1991f95e; 
> put_3470=rOmY83fj5OYxSa5ijLx2; 
> put_2909=1709bdb9520f10329958d1e869962e1f;
> put_3734=44209251ce644a0c; put_3176=74i}
> 
> Or 2015/01/06 13:34:43| tunnelConnectTimeout():
> tunnelState->servers is NULL
> 
> Any idea what's going on ? How can I suppress these warning ?


http://wiki.squid-cache.org/KnowledgeBase/UnparseableHeader

These messages show up when relaxed_header_parser is set to "warn". In
other words; you explicitly configured Squid to log those events.

http://www.squid-cache.org/Doc/config/relaxed_header_parser/


> 
> My Squid version: Squid Cache: Version 3.1.23 configure options:


PS. please upgrade your Squid. 3.1 series is two years past its
end-of-life support.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUrTiRAAoJELJo5wb/XPRj7I4IALl8YcJXPnh9gCZBZ7eWMLqy
BvUYK7LySSzOZK7hiNDMbgjem47LdcyzW+zLcxDUmW8O0m3ggINYCuzQ/iB4hXtx
uru81RpJABr9uRPPszzftGhBHDQOcuiP4sCGprgG/sIh2CGwMf6SIBCZq2KJ2J/0
Ss6wCP/2B1XdWqJJy39uG4tkgyrFvF0OQIVjmWTwpSXwCk19h5n2v6cPqXF0XsZT
/7ft5jF63B4o78F9lgTZx3pYF2jKB4ZGoTp7lDhPCNQi2Panu7OIWBRTZMA4D1Yu
iG57+Y/ME0fMc804E6c2/eZPtk83riS72BmBsoXszI9qIM9JXdjDWOdJO6+Pk5I=
=X9lY
-----END PGP SIGNATURE-----


From chris at ceegeebee.com  Thu Jan  8 04:47:39 2015
From: chris at ceegeebee.com (Chris Bennett)
Date: Thu, 8 Jan 2015 15:17:39 +1030
Subject: [squid-users] how to obtain info about actual active downloads?
In-Reply-To: <544E4977.3050705@hanzlici.cz>
References: <544E4977.3050705@hanzlici.cz>
Message-ID: <20150108044739.GA23887@cgb-linux.rcmb.lan>

I am very late on this thread (christmas catchup :))

But since it wasn't mentioned by others, and I find it very useful, I
use sqtop [1].  Screenshot on main page gives you an indication of
what it can tell you.

Regards,

Chris

[1] http://code.google.com/p/sqtop/


From sima_yi at operamail.com  Thu Jan  8 05:34:35 2015
From: sima_yi at operamail.com (PSA4444)
Date: Wed, 7 Jan 2015 21:34:35 -0800 (PST)
Subject: [squid-users] Squid mirror ngtech is down
Message-ID: <1420695275214-4668969.post@n4.nabble.com>

This squid mirror http://www1.ngtech.co.il/rpm/centos/6/SRPMS/ is down,
giving 404 errors.

Is there an alternate mirror for the pre-built squid binaries for CentOS6? 



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-mirror-ngtech-is-down-tp4668969.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From sima_yi at operamail.com  Thu Jan  8 05:37:13 2015
From: sima_yi at operamail.com (Sima Yi)
Date: Thu, 08 Jan 2015 05:37:13 +0000
Subject: [squid-users] Squid mirror ngtech is down
Message-ID: <1420695433.1421403.211046321.66482346@webmail.messagingengine.com>

This squid mirror http://www1.ngtech.co.il/rpm/centos/6/SRPMS/ is down,
giving 404 errors.

Is there an alternate mirror for the pre-built squid binaries for
CentOS6? 

-- 
Cheers,

Sima

-- 
http://www.fastmail.com - Same, same, but different...



From chris at ceegeebee.com  Thu Jan  8 05:41:57 2015
From: chris at ceegeebee.com (Chris Bennett)
Date: Thu, 8 Jan 2015 16:11:57 +1030
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <54A5C790.4040205@gmail.com>
References: <54A5C790.4040205@gmail.com>
Message-ID: <20150108054157.GB23887@cgb-linux.rcmb.lan>

Interesting thread so far.  Has anyone thought of using Bro-IDS as a
feedback loop for some of this advanced logic for bypassing bumping?
Bro performs passive reconnaissance, generates very useful logs for
any payloads it can decode, and is extendable.

e.g. ssl.log may contain something like this for a mail.google connection (it's
usually TSV, I've added headers for readability)

ts                    1420695401.142980
uid                   CPy8RndJtKO7AWuba
id.orig_h             10.0.3.54
id.orig_p             49471
id.resp_h             216.58.220.101
id.resp_p             443
version               TLSv10
cipher                TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA
server_name           mail.google.com
session_id            b9be0d07db3c10511d673d8537c7809eddbee60a6601a7a23f67d97ab23fc6e8
subject               CN=mail.google.com,O=Google Inc,L=Mountain View,ST=California,C=US
issuer_subject        CN=Google Internet Authority G2,O=Google Inc,C=US
not_valid_before      1418172300.000000
not_valid_after       1425907800.000000
last_alert            -
client_subject        -
client_issuer_subject -
cert_hash             7081464425ab98aef8f5818ebd40fec9
validation_status     ok

I like the active external acl solution since it meets a need, but
there is overhead.  I'm not quite sure what Bro logs for non-HTTPS
443 traffic, but I thought I'd chime in with the above idea if anyone
wants to expand on it further :)

Regards,

Chris


From eliezer at ngtech.co.il  Thu Jan  8 06:14:17 2015
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Thu, 08 Jan 2015 08:14:17 +0200
Subject: [squid-users] Squid mirror ngtech is down
In-Reply-To: <1420695433.1421403.211046321.66482346@webmail.messagingengine.com>
References: <1420695433.1421403.211046321.66482346@webmail.messagingengine.com>
Message-ID: <54AE2039.5000300@ngtech.co.il>

On 08/01/2015 07:37, Sima Yi wrote:
> This squid mirrorhttp://www1.ngtech.co.il/rpm/centos/6/SRPMS/  is down,
> giving 404 errors.
>
> Is there an alternate mirror for the pre-built squid binaries for
> CentOS6?

Sorry for the inconvenience, I had an issue with one of my services in 
the last day.
It's now back on and the next release is on the way.

Thanks,
Eliezer



From Florian.Huber at frauscher.com  Thu Jan  8 06:24:43 2015
From: Florian.Huber at frauscher.com (Florian Huber)
Date: Thu, 8 Jan 2015 06:24:43 +0000
Subject: [squid-users] FTP: Deny Upload
Message-ID: <c868e8c7b4694628ac4bbd82cc25e8e3@mxs02.frauscher.intern>

Hi List!

Is there a way to deny FTP Uploads only?
I managed to block FTP at whole but that is cutting the user experience. I want to avoid uploads only.

Thanks in advance
Florian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150108/4cfea9f2/attachment.htm>

From sima_yi at operamail.com  Thu Jan  8 06:28:53 2015
From: sima_yi at operamail.com (PSA4444)
Date: Wed, 7 Jan 2015 22:28:53 -0800 (PST)
Subject: [squid-users] Squid mirror ngtech is down
In-Reply-To: <54AE2039.5000300@ngtech.co.il>
References: <1420695433.1421403.211046321.66482346@webmail.messagingengine.com>
 <54AE2039.5000300@ngtech.co.il>
Message-ID: <1420698533000-4668974.post@n4.nabble.com>

Ah, working now.  Thanks for fixing it.





--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-mirror-ngtech-is-down-tp4668970p4668974.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From Jason_Haar at trimble.com  Thu Jan  8 06:33:42 2015
From: Jason_Haar at trimble.com (Jason Haar)
Date: Thu, 8 Jan 2015 19:33:42 +1300
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <20150108054157.GB23887@cgb-linux.rcmb.lan>
References: <54A5C790.4040205@gmail.com>
 <20150108054157.GB23887@cgb-linux.rcmb.lan>
Message-ID: <54AE24C6.2070004@trimble.com>

On 08/01/15 18:41, Chris Bennett wrote:
> Interesting thread so far.  Has anyone thought of using Bro-IDS as a
> feedback loop for some of this advanced logic for bypassing bumping?

The external acl method mentioned earlier probably out-does using some
NIDS feedback loop. In my testing it causes squid to block that new
connection until it returns, and that means your external acl script can
simply attempt a SSL transaction against the end-server and in realtime
figure out that it's SSL or not. And then cache it, blah, blah blah.

The advantage is that it will do a lookup on new HTTPS sessions and
potentially have the answer immediately (ie it can bump on first
attempt), whereas a NIDS would only find out the answer after squid has
defaulted to passthrough/splice mode, so it would only work properly on
future connections to that site.

> I like the active external acl solution since it meets a need, but
> there is overhead.  I'm not quite sure what Bro logs for non-HTTPS
> 443 traffic, but I thought I'd chime in with the above idea if anyone
> wants to expand on it further :)

If you think the external acl method is too expensive to run, how do you
expect to feed this NIDS data back into squid? I think you'd find you'd
need an external acl check to do that bit anyway :-)

-- 
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1



From Jerome.Vernet at belambra.fr  Thu Jan  8 08:28:10 2015
From: Jerome.Vernet at belambra.fr (Vernet Jerome)
Date: Thu, 8 Jan 2015 09:28:10 +0100
Subject: [squid-users] Growing cache.log
In-Reply-To: <54AD3277.9010708@ngtech.co.il>
References: <30F6B89CD3037744A6C17325D90A6F6107596F01@cordelia.ad2003.intra>
 <54AD3277.9010708@ngtech.co.il>
Message-ID: <30F6B89CD3037744A6C17325D90A6F61075971DD@cordelia.ad2003.intra>

Hello,



-----Message d'origine-----
De : squid-users [mailto:squid-users-bounces at lists.squid-cache.org] De la part de Eliezer Croitoru
Envoy? : mercredi 7 janvier 2015 14:20
? : squid-users at lists.squid-cache.org
Objet : Re: [squid-users] Growing cache.log

>Hey (Is it Jerome? or Vernet?),

Jerome
>Is there a chance you can test it with a newer version of squid?
Unfortunatly not easy. I tried several time but was never able to make newer version of Squid working in our production environnement. Either Authentification not working or ACL not working, I don't know.... I upgraded from 3.1.3 to 3.1.23 .

>What OS are you using?
Debian Squeeze

>Can you share your squid.conf?

http_port 3128
cache_peer 127.0.0.1 parent 8080 7 no-query no-digest no-netdb-exchange
acl NOBELAMBRA url_regex -i "/etc/squid3/nocache.url"
cache deny NOBELAMBRA
cache_mem 512 MB
cache_swap_low 90
cache_swap_high 95
maximum_object_size 32 MB
minimum_object_size 0 KB
maximum_object_size_in_memory  256 KB
# 256 KB
ipcache_size 4096
ipcache_low 90
ipcache_high 95
fqdncache_size 4096
cache_replacement_policy heap LFUDA
memory_replacement_policy heap LFUDA
cache_dir ufs /var/spool/squid3 3120 16 256
cache_access_log /var/log/squid3/access.log
cache_log /var/log/squid3/cache.log
cache_store_log none
emulate_httpd_log off
log_mime_hdrs off
debug_options ALL,1 33,0 29,1
log_fqdn on
client_netmask 255.255.255.255
#ftp_user proxy at vvf-vacances.com
#ftp_list_width 128
#ftp_passive on
#ftp_sanitycheck on
dns_retransmit_interval 2 seconds
#JV 18/10/2011 pour corsica
dns_timeout 20 secondes
auth_param basic program /usr/bin/ntlm_auth --helper-protocol=squid-2.5-basic
auth_param basic children 10
#JV 07/05/2013 8 a 10
auth_param basic realm AD2003.INTRA
auth_param basic credentialsttl 4 hours
auth_param basic casesensitive off
external_acl_type ad_group %LOGIN /usr/lib/squid3/wbinfo_group.pl
authenticate_cache_garbage_interval 1 hour
authenticate_ttl 1 hour
authenticate_ip_ttl 3600 seconds
request_header_max_size 200 KB
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern .               0       20%     4320
quick_abort_min -1 KB
quick_abort_max 128 KB
quick_abort_pct 95
negative_ttl 1 minutes
positive_dns_ttl 6 hours
negative_dns_ttl 2 minute
range_offset_limit 0 KB
connect_timeout 4 minute
request_timeout 5 minutes
persistent_request_timeout 60 second
shutdown_lifetime 10 seconds
#acl all src all
acl manager proto cache_object
acl localhost src 127.0.0.1/32
acl to_localhost dst 127.0.0.0/8
acl SSL_ports port 443          # https
acl SSL_ports port 8000                 # https
acl SSL_ports port 8080         # https
acl SSL_ports port 873          # rsync
acl Safe_ports port 80 4280             # http
acl Safe_ports port 8000 8080   # http
acl Safe_ports port 443 563     # https, snews
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl Safe_ports port 631         # cups
acl Safe_ports port 873         # rsync
acl Safe_ports port 901         # SWAT
acl purge method PURGE
acl CONNECT method CONNECT
http_access allow manager localhost
http_access deny manager
http_access allow purge localhost
http_access deny purge
http_access deny CONNECT !SSL_ports
http_access allow CONNECT SSL_ports
acl proxy dst 192.168.1.5/32
http_access allow proxy
http_access deny to_localhost
acl Authenticated proxy_auth REQUIRED
acl directaccess external ad_group www-directaccess
acl activefilter external ad_group www-activefilter
acl directurls dstdomain "/etc/squid3/directurls"
http_access allow directurls
always_direct allow directurls
http_access allow localhost
acl restrictedfilter01 external ad_group www-restricted01
acl restrictedfilter02 external ad_group www-restricted02
acl goodsites01 url_regex "/etc/squid3/contentlist01"
acl goodsites02 url_regex "/etc/squid3/contentlist02"
http_access deny !Safe_ports activefilter
http_access deny !Safe_ports restrictedfilter01
http_access deny !Safe_ports restrictedfilter02
http_access allow goodsites01 restrictedfilter01
http_access allow goodsites02 restrictedfilter02
http_access allow directaccess
always_direct allow directaccess
http_access allow activefilter
http_access allow directaccess SSL_ports
http_access allow activefilter SSL_ports
http_access deny restrictedfilter01
http_access deny restrictedfilter02
http_access deny !Authenticated !localhost
http_access deny all
http_access deny all
http_reply_access allow all
icp_access allow all
#cache_peer_access puck allow activefilter
#cache_peer_access puck deny all
reply_header_max_size 20 KB
cache_mgr exploitation_dsi at belambra.fr
cache_effective_user proxy
cache_effective_group proxy
visible_hostname belambra
cachemgr_passwd proxyvvfmgr all
always_direct allow localhost
always_direct allow directurls
never_direct allow activefilter
forwarded_for off
never_direct deny all
error_directory /var/hera/squiderrors
coredump_dir /var/spool/squid3
client_persistent_connections on
server_persistent_connections on
detect_broken_pconn on
pipeline_prefetch on

Eliezer


From Jerome.Vernet at belambra.fr  Thu Jan  8 08:32:32 2015
From: Jerome.Vernet at belambra.fr (Vernet Jerome)
Date: Thu, 8 Jan 2015 09:32:32 +0100
Subject: [squid-users] Growing cache.log
In-Reply-To: <54AD3891.504@treenet.co.nz>
References: <30F6B89CD3037744A6C17325D90A6F6107596F01@cordelia.ad2003.intra>
 <54AD3891.504@treenet.co.nz>
Message-ID: <30F6B89CD3037744A6C17325D90A6F61075971E1@cordelia.ad2003.intra>

Hi



-----Message d'origine-----
De : squid-users [mailto:squid-users-bounces at lists.squid-cache.org] De la part de Amos Jeffries
Envoy? : mercredi 7 janvier 2015 14:46
? : squid-users at lists.squid-cache.org
Objet : Re: [squid-users] Growing cache.log



>http://wiki.squid-cache.org/KnowledgeBase/UnparseableHeader

>These messages show up when relaxed_header_parser is set to "warn". In other words; you explicitly configured Squid to log those events.

>http://www.squid-cache.org/Doc/config/relaxed_header_parser/

So I have to add to squid.conf this line (wich is NOT in my squid.conf, should be default to on not warn).?
relaxed_header_parser on

> 
> My Squid version: Squid Cache: Version 3.1.23 configure options:

>PS. please upgrade your Squid. 3.1 series is two years past its end-of-life support.

Not easy for me. I never succeeded to upgrade.... I may try now to use an Appliance embedding Squid like Trend Solutions.

Jerome


From chris at ceegeebee.com  Thu Jan  8 08:56:06 2015
From: chris at ceegeebee.com (Chris Bennett)
Date: Thu, 8 Jan 2015 19:26:06 +1030
Subject: [squid-users] Squid 3 SSL bump: Google drive application could
 not connect
In-Reply-To: <54AE24C6.2070004@trimble.com>
References: <54A5C790.4040205@gmail.com>
 <20150108054157.GB23887@cgb-linux.rcmb.lan>
 <54AE24C6.2070004@trimble.com>
Message-ID: <20150108085606.GA27876@cgb-linux.rcmb.lan>

Hi Jason,

> If you think the external acl method is too expensive to run, how do you
> expect to feed this NIDS data back into squid? I think you'd find you'd
> need an external acl check to do that bit anyway :-)

I should have been clearer - my use of the term feedback loop was
meant to imply that this was an out-of-band method of populating a
cache of valid HTTPS IP addresses (as well as the any SNI and even
'Application name') for HTTPS, and observed non-HTTPS traffic over 443
and any other ports.  This may compliment any active external acl
style checking.

Was just thinking out loud - probably a crazy idea if every seriously
considered :)

Regards,

Chris


From yvoinov at gmail.com  Thu Jan  8 10:06:11 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 08 Jan 2015 16:06:11 +0600
Subject: [squid-users] how to obtain info about actual active downloads?
In-Reply-To: <20150108044739.GA23887@cgb-linux.rcmb.lan>
References: <544E4977.3050705@hanzlici.cz>
 <20150108044739.GA23887@cgb-linux.rcmb.lan>
Message-ID: <54AE5693.40003@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Cool,

but could not compile.

Configure with errors:

checking for cerrno... yes
checking climits usability... yes
checking climits presence... yes
checking for climits... yes
checking for gethostbyname... no
configure: error: Unable to find some C functions


08.01.2015 10:47, Chris Bennett ?????:


-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUrlaPAAoJENNXIZxhPexGsdoH/2ngcCioJGxX/ugg1v3ifepx
64PVtht28nVdCUG04cXAiyJCEK5KDYJQ1vV1hPAFB8di7vWMuWHTyssPnvQeQlWI
XXQEF6CUpYZhtMrPgFy6ZMLDtQC74E/+/r2hCDjUWzgMqs0Phsmvx2VraFGid9tZ
2t/7rV9AgFX4DxIGkOZPOBDU+R2COTqDAOc38pQIUZ1N6qMnvCev1cpBiY6il5Rh
rrbfP0ggFp7WS2iDax1G2aH7BN+zvE23hBBfzX5Z22UwO0XqHtYZzsmD03Sb7sW+
CoxjfVnKmPAXdZCUmGnkcxoIoPk9phXRiIzqshOsHYf6MV6LJblc5aPWk2Hqc6s=
=wpXC
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150108/75117c78/attachment.htm>

From yvoinov at gmail.com  Thu Jan  8 10:06:11 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 08 Jan 2015 16:06:11 +0600
Subject: [squid-users] how to obtain info about actual active downloads?
In-Reply-To: <20150108044739.GA23887@cgb-linux.rcmb.lan>
References: <544E4977.3050705@hanzlici.cz>
 <20150108044739.GA23887@cgb-linux.rcmb.lan>
Message-ID: <54AE5693.5020408@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Cool,

but could not compile.

Configure with errors:

checking for cerrno... yes
checking climits usability... yes
checking climits presence... yes
checking for climits... yes
checking for gethostbyname... no
configure: error: Unable to find some C functions


08.01.2015 10:47, Chris Bennett ?????:
> I am very late on this thread (christmas catchup :))
>
> But since it wasn't mentioned by others, and I find it very useful, I
> use sqtop [1].  Screenshot on main page gives you an indication of
> what it can tell you.
>
> Regards,
>
> Chris
>
> [1] http://code.google.com/p/sqtop/
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUrlaTAAoJENNXIZxhPexGwKEIALeV/DPRvjeOiiDy/jFeHkYK
F2HCgelCqSL1nUw0Mm2DpRuJ/5dgxJeBm5cOXJqgEoSZBymt0C9mjKQJsxzNeQ4E
X8rxxLr9iYhZoZjK5qiyAdU+6PJ7vaE0YkfVfsWlaW+CUi1ZVpAm+ijUaX+jSa0y
8r4HOH57onZdmXNWJKYX4DW/DO1r8e9nc0dUZUTC+4Am0DiED8upuNTVqtQM/uD3
wkqML+te6xixqj78jtIPBHeXunhpwzIrVG61RpKM6PCKZd/ScEAmyvZ8zPooRFxf
hcfjNHGNbhqtanA2vfn9/oTQnB3zZ9WsUJp+5MppEajPQF4uYZn01kfU5jS84tg=
=W05a
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150108/6f9d561e/attachment.htm>

From chris at ceegeebee.com  Thu Jan  8 11:21:38 2015
From: chris at ceegeebee.com (Chris Bennett)
Date: Thu, 8 Jan 2015 21:51:38 +1030
Subject: [squid-users] how to obtain info about actual active downloads?
In-Reply-To: <54AE5693.40003@gmail.com>
References: <544E4977.3050705@hanzlici.cz>
 <20150108044739.GA23887@cgb-linux.rcmb.lan>
 <54AE5693.40003@gmail.com>
Message-ID: <20150108112138.GB27876@cgb-linux.rcmb.lan>

> Configure with errors:
> 
> checking for cerrno... yes
> checking climits usability... yes
> checking climits presence... yes
> checking for climits... yes
> checking for gethostbyname... no
> configure: error: Unable to find some C functions

You probably need gcc-c++ installed.

What distro are you using?  I've just successfully compiled it on
clean CentOS 6 and 7 machines and the only requirements for
compilation were gcc-c++ and ncurses-devel 

  ie. yum install gcc-c++ ncurses-devel

Regards,

Chris


From yvoinov at gmail.com  Thu Jan  8 11:25:04 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 08 Jan 2015 17:25:04 +0600
Subject: [squid-users] how to obtain info about actual active downloads?
In-Reply-To: <20150108112138.GB27876@cgb-linux.rcmb.lan>
References: <544E4977.3050705@hanzlici.cz>
 <20150108044739.GA23887@cgb-linux.rcmb.lan> <54AE5693.40003@gmail.com>
 <20150108112138.GB27876@cgb-linux.rcmb.lan>
Message-ID: <54AE6910.1010000@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 

08.01.2015 17:21, Chris Bennett ?????:
>> Configure with errors:
>>
>> checking for cerrno... yes
>> checking climits usability... yes
>> checking climits presence... yes
>> checking for climits... yes
>> checking for gethostbyname... no
>> configure: error: Unable to find some C functions
>
> You probably need gcc-c++ installed.
I've installed it. :) I've compiled Squid in the past on this server :)

root @ ktulhu /var/adm # pkgutil -l CSWg++
CSWgawk
CSWgcc4core
CSWgcc4g++
CSWgcpio
CSWgd
CSWggettext-data
CSWggettextrt
CSWggrep
CSWgio-fam-backend
CSWglib2
CSWgm4
CSWgmake
CSWgnupg
CSWgsed
CSWgtar

>
>
> What distro are you using?  I've just successfully compiled it on
Solaris 10 u11. :) Yeah, it still using. :)

>
> clean CentOS 6 and 7 machines and the only requirements for
> compilation were gcc-c++ and ncurses-devel
>
>   ie. yum install gcc-c++ ncurses-devel
It installed:

root @ ktulhu /var/adm # pkgutil -l CSWncurse
CSWncurses

:)

>
>
> Regards,
>
> Chris

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUrmkQAAoJENNXIZxhPexGq/4H/R5cz79PPOPnEPMet7UjSr+N
z7WwwV5H0mXi5bPHlTIrlQcH6Qb4vcO4o9QBudrIU3bf9oZviNlWblV5tzB7ywia
pV09cs0Wbqlbtqa+18I4RIumQ5Q7aBqj0OswMoku3mg3MD8JvfIlcGzH58YIqcM5
aLI48cqJpxDuAywNRNs/VXlP8uQb0K+AsJuf2dJmQy9dj218L+LDzsHdLzzvX8NH
ZHrcSf/RMeeTFtelC+xS9U9iTbfF/30f5j1pN038DgD2yGOhuyyn0HuC/YGlFtmI
n7glkUdeestBik0xs1DSL1AfQEDxwXucl8qEjtofNnlfpBIzxX3oZD28mmU4NDY=
=kZg3
-----END PGP SIGNATURE-----



From yvoinov at gmail.com  Thu Jan  8 11:34:52 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 08 Jan 2015 17:34:52 +0600
Subject: [squid-users] how to obtain info about actual active downloads?
In-Reply-To: <20150108112138.GB27876@cgb-linux.rcmb.lan>
References: <544E4977.3050705@hanzlici.cz>
 <20150108044739.GA23887@cgb-linux.rcmb.lan> <54AE5693.40003@gmail.com>
 <20150108112138.GB27876@cgb-linux.rcmb.lan>
Message-ID: <54AE6B5C.20600@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
No,

the same error with ncurses-dev.


08.01.2015 17:21, Chris Bennett ?????:
>> Configure with errors:
>>
>> checking for cerrno... yes
>> checking climits usability... yes
>> checking climits presence... yes
>> checking for climits... yes
>> checking for gethostbyname... no
>> configure: error: Unable to find some C functions
>
> You probably need gcc-c++ installed.
>
> What distro are you using?  I've just successfully compiled it on
> clean CentOS 6 and 7 machines and the only requirements for
> compilation were gcc-c++ and ncurses-devel
>
>   ie. yum install gcc-c++ ncurses-devel
>
> Regards,
>
> Chris

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUrmtbAAoJENNXIZxhPexGLskH/RR2wgzthJyjAMiiCUSGVae4
LsNYsIFnsbSnBWctis/XN+peigChhaRuSYO/djxYsFkdv0sOLXUM8b+cBpuZqwb6
BdzX39PayNHr63J4sPocQ+GMVyONe8mpYkSj5Uxxh2z4n7kr1JQEOdW1jkdfz4ff
YT3xl/Gv7xjpqNZ+kVqHc/S3KZa7ErvtAjoEzIBnWvCduUeOQlcnJahed8HQgxds
XglApxuZWKDva/gzldMJlc16kfAFoJl+iWbpYTe3T7ntwAWTzdJjqi5VZ8dVqZ0N
FfShrC4r/ngqYETbFpLhCVU5lb3DmvoUR/eQNXcrgq9DFsMZOg4+7pxLOcIrywY=
=Pbhu
-----END PGP SIGNATURE-----



From jpotter833 at because.org.uk  Thu Jan  8 13:19:55 2015
From: jpotter833 at because.org.uk (Mr J Potter)
Date: Thu, 8 Jan 2015 13:19:55 +0000
Subject: [squid-users] Issues with SSL from specific sites,
Message-ID: <CAMyAEHukiOHmanAuU1-3owN2iB_GGSm9fSvVOS3HNE6zPDpo_A@mail.gmail.com>

Hi all,

I have a weird problem connecting to one specific domain:

https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.0.5/es5-shim.min.js

this site works fine if I connect directly, but if I go via my squid
instance, it fails (see below).

I have squid 3.3.11 with optional SSL-bump set up and working fine for the
most part, but it will not allow me onto this one domain. Its not in any
filtered list (I've connected out SSLBump and all filtering/redirecting on
my test server).

It says unavailable to establish SSL connection... one point is when I
connect to this site via chrome it tells me the encryption method is
outdated - is squid refusing to connect due to this?

thanks in advance for any help.

root at dirvish:~# wget
https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.0.5/es5-shim.min.js -dv
Setting --verbose (verbose) to 1
DEBUG output created by Wget 1.13.4 on linux-gnu.

URI encoding = `UTF-8'
URI encoding = `UTF-8'
--2015-01-08 13:14:56--
https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.0.5/es5-shim.min.js
Resolving dirvish (dirvish)... 10.15.244.47
Caching dirvish => 10.15.244.47
Connecting to dirvish (dirvish)|10.15.244.47|:3128... connected.
Created socket 4.
Releasing 0x000000000171a990 (new refcount 1).

---request begin---
CONNECT cdnjs.cloudflare.com:443 HTTP/1.1
User-Agent: Wget/1.13.4 (linux-gnu)

---request end---
proxy responded with: [HTTP/1.1 503 Service Unavailable
Server: squid/3.3.11
Mime-Version: 1.0
Date: Thu, 08 Jan 2015 13:14:57 GMT
Content-Type: text/html
Content-Length: 3129
X-Squid-Error: ERR_CONNECT_FAIL 101
Vary: Accept-Language
Content-Language: en

]
Proxy tunneling failed: Service UnavailableUnable to establish SSL
connection.
root at dirvish:~#

squid config:
cache_effective_user proxy
shutdown_lifetime 2 seconds

cache_peer courage.bristol-cyps.org.uk  parent    3128  0  round-robin

forwarded_for off

#url_rewrite_program /usr/bin/squidGuard -c
/var/lib/squidguard/squidGuard.conf

#auth_param ntlm program /usr/bin/ntlm_auth
--helper-protocol=squid-2.5-ntlmssp
#auth_param ntlm children 30 startup=5 idle=10
#auth_param ntlm keep_alive on

#acl authdUsers proxy_auth REQUIRED

acl unchecked_sites dstdomain
"/var/lib/squidguard/db/BEC/alwaysAllowed/domains"
acl unchecked_regex dstdom_regex
"/var/lib/squidguard/db/BEC/alwaysAllowed/regex"

acl bumpedDomains dstdomain .google.com .youtube.com
acl localDomains dstdomain .bec.lan .bcc.lan .because.org.uk
acl directDomains dstdomain .gcsepod.com .cloudflare.com

#acl localhost src 127.0.0.0/8
acl localnet src 10.0.0.0/8     # RFC1918 possible internal network
acl localnet src 172.16.0.0/12  # RFC1918 possible internal network
acl localnet src 192.168.0.0/16 # RFC1918 possible internal network
acl localnet src fc00::/7       # RFC 4193 local private network range
acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged)
machines
acl HTTPS proto HTTPS

acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 81          # Jamie 'Fish lips' Oliver
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 4433        ## VPN
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl CONNECT method CONNECT

#
# Recommended minimum Access Permission configuration:
#
# Only allow cachemgr access from localhost
http_access allow localhost manager
http_access deny manager

# Deny requests to certain unsafe ports
http_access deny !Safe_ports

# Deny CONNECT to other than secure SSL ports
http_access deny CONNECT !SSL_ports

# We strongly recommend the following be uncommented to protect innocent
# web applications running on the proxy server who think the only
# one who can access services on "localhost" is a local user
http_access deny to_localhost

#
# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
#

# Example rule allowing access from your local networks.
# Adapt localnet in the ACL section to list your (internal) IP networks
# from where browsing should be allowed
http_access allow unchecked_sites
http_access allow localhost
#http_access allow authdUsers
http_access allow localnet
#http_access deny all

always_direct allow localDomains
always_direct allow directDomains
#always_direct allow bumpedDomains
#always_direct deny HTTPS
#always_direct allow bumpedDomains
#always_direct allow HTTPS
#always_direct allow bumpedDomains
always_direct deny all
#never_direct allow all
#always_direct deny all

strip_query_terms off

#logformat squid      %ts.%03tu %6tr %>A %Ss/%03>Hs %<st %rm %ru %[un
%Sh/%<a %mt
#logformat common     %>a %[ui %[un [%tl] "%rm %ru HTTP/%rv" %>Hs %<st
%Ss:%Sh
access_log daemon:/var/log/squid/access.log common
#access_log syslog:local4 common

dns_nameservers 10.15.244.8 10.15.244.13
append_domain .because.org.uk

# Squid normally listens to port 3128
http_port 3128
icp_port 3130

# Uncomment and adjust the following to add a disk cache directory.
#cache_dir ufs /var/spool/squid3/cache/ 1000 16 256
max_filedesc 4096

cache_mem 2048 MB

# Leave coredumps in the first cache dir
coredump_dir /var/log/squid3

# Add any of your own refresh_pattern entries above these.
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320

acl swingbin snmp_community swingbin
snmp_access allow swingbin all
snmp_port 3401


-------

build script::
./configure \
                --prefix=/usr \
                --datadir=/usr/share/squid3 \
                --sysconfdir=/etc/squid3 \
                --mandir=/usr/share/man \
                --enable-inline \
                --enable-async-io=8 \
                --enable-storeio="ufs,aufs,diskd,rock" \
                --enable-removal-policies="lru,heap" \
                --enable-delay-pools \
                --enable-cache-digests \
                --enable-underscores \
                --enable-icap-client \
                --enable-follow-x-forwarded-for \

--enable-auth-basic="DB,fake,getpwnam,LDAP,MSNT,MSNT-multi-domain,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB"
\
                --enable-auth-digest="file,LDAP" \
                --enable-auth-negotiate="kerberos,wrapper" \
                --enable-auth-ntlm="fake,smb_lm" \

--enable-external-acl-helpers="file_userip,kerberos_ldap_group,LDAP_group,session,SQL_session,unix_group,wbinfo_group"
\
                --enable-url-rewrite-helpers="fake" \
                --enable-eui \
                --enable-esi \
                --enable-icmp \
                --enable-zph-qos \
                --disable-translation \
                --with-swapdir=/var/spool/squid3 \
                --with-logdir=/var/log/squid3 \
                --with-pidfile=/var/run/squid3.pid \
                --with-filedescriptors=65536 \
                --with-large-files \
                --with-default-user=proxy \
                --enable-ssl --enable-ssl-crtd



thanks,

Jim Potter
Network Manager
Brislington Enterprise College
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150108/ba9fbb42/attachment.htm>

From squid3 at treenet.co.nz  Thu Jan  8 18:55:22 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 09 Jan 2015 07:55:22 +1300
Subject: [squid-users] FTP: Deny Upload
In-Reply-To: <c868e8c7b4694628ac4bbd82cc25e8e3@mxs02.frauscher.intern>
References: <c868e8c7b4694628ac4bbd82cc25e8e3@mxs02.frauscher.intern>
Message-ID: <54AED29A.6020509@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 8/01/2015 7:24 p.m., Florian Huber wrote:
> Hi List!
> 
> Is there a way to deny FTP Uploads only? I managed to block FTP at
> whole but that is cutting the user experience. I want to avoid
> uploads only.

What is an FTP upload when its dressed up in HTTP ?

Hint: CONNECT. Same as FTP download.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUrtKaAAoJELJo5wb/XPRje4cH+weDcZWmB8sMb1o90RI0MaUk
JqHwCBSiYGA9Qkjgur9sCb6udgxy+aFw+g7MANg+tgWEjr3Y7LvbHX59nJSyn7Rq
dMLjFmq6xHK4yYloziXNJCJORJW0s7hWiZ7O1CbyDXO3PsPs0ouqQiFBUdAD0I7o
UPPopMnVQUcX8KRRp8NDeS3/wH7SYjjx/yqPK9TESHo/X+Pb231wVdf0iG0nO7Wx
TXDTyE1g1owW0mPcSfGlBxtFXUwrIinzy7Rqh2GIFzYJbq69e3pig3kcewGLNmL/
kcR3HX/p9Kg8xa/pjoVU/x7PJcTEUVPIOE/bNzYIC57o4/0ujAGme85x7DCa4ng=
=FT3g
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Thu Jan  8 18:58:56 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 09 Jan 2015 07:58:56 +1300
Subject: [squid-users] Issues with SSL from specific sites,
In-Reply-To: <CAMyAEHukiOHmanAuU1-3owN2iB_GGSm9fSvVOS3HNE6zPDpo_A@mail.gmail.com>
References: <CAMyAEHukiOHmanAuU1-3owN2iB_GGSm9fSvVOS3HNE6zPDpo_A@mail.gmail.com>
Message-ID: <54AED370.5070709@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 9/01/2015 2:19 a.m., Mr J Potter wrote:
> Hi all,
> 
> I have a weird problem connecting to one specific domain:
> 
> https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.0.5/es5-shim.min.js
>
>  this site works fine if I connect directly, but if I go via my
> squid instance, it fails (see below).
> 
> I have squid 3.3.11 with optional SSL-bump set up and working fine
> for the most part, but it will not allow me onto this one domain.
> Its not in any filtered list (I've connected out SSLBump and all
> filtering/redirecting on my test server).
> 
> It says unavailable to establish SSL connection... one point is
> when I connect to this site via chrome it tells me the encryption
> method is outdated - is squid refusing to connect due to this?

More likely Chrome is complaining about Squid bumping in its way. The
bumped certs created by 3.3 use an older easily bumped format.

Our standing recommendation for bumping is to always use the latest
Squid release if you encounter problems. SSL-bump is effectively going
through an arms race with HTTPS - each Squid series has different
capabilities to get around HTTPS protections that "suddenly" become
popular as the previous series SSL-bump feature began to be used.


> 
> thanks in advance for any help.
> 
> root at dirvish:~# wget 
> https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.0.5/es5-shim.min.js
> -dv


Squidclient gives me this:

Resolving cdnjs.cloudflare.com ...
Connecting... cdnjs.cloudflare.com (198.41.215.184:443)
Connected to: cdnjs.cloudflare.com (198.41.215.184:443)
X.509 TLS handshake ...
VERIFY DATUM: The certificate is NOT trusted. The certificate issuer
is unknown.
WARNING: Insecure Connection
TLS Session info:
(TLS1.2)-(ECDHE-RSA-SECP256R1)-(AES-128-GCM)


The certificate issues being unknown is a problem. The modern browsers
all go into a major panic over that kind of thing.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUrtNvAAoJELJo5wb/XPRjUi8H/1qSmezU5kWr0qV4N38I7DMA
aPlZphIi/vwE91b23nqNok+YC3e31owrNh/C/L8q7OkIynhQ0UtVuJOMrXl8wVSF
tfMtbIXDBPOmoLDlYrZwXDRgtooENawHce70hnD0MjvsWUtfpudBhaXx8zumbf1w
EYxUc80pTiqc2qO1DShiaQmRFrW/7SEwxNixaCY1hUHyMFFeK4KUd4bbBNC8f0Wu
djmeEqcd3HbMJyIlgm6EA0o1LGlMqPytcxI4ZN2aiiXYlEslew2kAW4euVhG4zAK
CZGzhkA4kBtsqvgE2Tx5vJPLXrk+peALJa479Coq6fSUuxsZPjtzdkygazLSXQU=
=jiwY
-----END PGP SIGNATURE-----


From dougs at dawnsign.com  Thu Jan  8 19:10:25 2015
From: dougs at dawnsign.com (Doug Sampson)
Date: Thu, 8 Jan 2015 19:10:25 +0000
Subject: [squid-users] Memory Leak Squid 3.4.9 on FreeBSD 10.0 x64
In-Reply-To: <86iogtp7ao.fsf@gmail.com>
References: <86iogtp7ao.fsf@gmail.com>
Message-ID: <E6B2517F8D6DBF4CABB8F38ACA367E78343B4E87@Draco.dawnsign.com>

> Hi,
> 
> I have the similar problem on FreeBSD 10.1-STABLE #1 r275861 with
> squid-3.4.10. I also applied MEMPOOLS=1 when starting squid. I
> experience the process slowing down and unacceptable performance.
> 
> Squid is configured to use kerberos and ntlm authentication and lap
> group authentication. other settings:
> 
> cache_replacement_policy heap LFUDA
> cache_mem 4096 MB
> maximum_object_size 32 MB
> cache_dir diskd /usr/local/squid/cache 32768 32 256
> 
> I have seen the following errors in cache.log:
> 
> FATAL: Received Segment Violation...dying.
> FATAL: Received Bus Error...dying.
> 
> after this the squid restarts. The system has 10GB of memory and is
> working as internal cache for ~600 users.
> 
> Please point me in the right direction. I have no problem running
> squid33-3.3.13 on FreeBSD 9.3-STABLE #0 r270210.
> 
> Thank you very much.
> 
> Regards,
> 
> lk

Man, I empathize with you. Have you tried running Squid 3.4.x on FreeBSD 9.3? Sometimes I wonder if it's FreeBSD 10.x that's causing the issue...

I tried the shell variable MEMPOOLS=1 and that quickly made the situation a lot worse. Swap space would get filled up very quickly and the system would slow down quickly before crashing.

Any other ideas?

~Doug

From yvoinov at gmail.com  Thu Jan  8 21:29:14 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Fri, 09 Jan 2015 03:29:14 +0600
Subject: [squid-users] Memory Leak Squid 3.4.9 on FreeBSD 10.0 x64
In-Reply-To: <E6B2517F8D6DBF4CABB8F38ACA367E78343B4E87@Draco.dawnsign.com>
References: <86iogtp7ao.fsf@gmail.com>
 <E6B2517F8D6DBF4CABB8F38ACA367E78343B4E87@Draco.dawnsign.com>
Message-ID: <54AEF6AA.1080308@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
I mean,

cache_mem is too big.

First, 600 users is not very big installation to do huge memory cache.
1-2 Gb will be ehough. With fast disk cache.

Second - 4 Gb ram is near 32-bit address limit. Possible 32-bit library
or somewhat meets this limit.

Is OS and Squid completely 64-bit?

09.01.2015 1:10, Doug Sampson ?????:
>> Hi,
>>
>> I have the similar problem on FreeBSD 10.1-STABLE #1 r275861 with
>> squid-3.4.10. I also applied MEMPOOLS=1 when starting squid. I
>> experience the process slowing down and unacceptable performance.
>>
>> Squid is configured to use kerberos and ntlm authentication and lap
>> group authentication. other settings:
>>
>> cache_replacement_policy heap LFUDA
>> cache_mem 4096 MB
>> maximum_object_size 32 MB
>> cache_dir diskd /usr/local/squid/cache 32768 32 256
>>
>> I have seen the following errors in cache.log:
>>
>> FATAL: Received Segment Violation...dying.
>> FATAL: Received Bus Error...dying.
>>
>> after this the squid restarts. The system has 10GB of memory and is
>> working as internal cache for ~600 users.
>>
>> Please point me in the right direction. I have no problem running
>> squid33-3.3.13 on FreeBSD 9.3-STABLE #0 r270210.
>>
>> Thank you very much.
>>
>> Regards,
>>
>> lk
>
> Man, I empathize with you. Have you tried running Squid 3.4.x on
FreeBSD 9.3? Sometimes I wonder if it's FreeBSD 10.x that's causing the
issue...
>
> I tried the shell variable MEMPOOLS=1 and that quickly made the
situation a lot worse. Swap space would get filled up very quickly and
the system would slow down quickly before crashing.
>
> Any other ideas?
>
> ~Doug
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUrvaqAAoJENNXIZxhPexGTigIAKCNyOeAD03un/vxFINUN2Yb
0cZLNzSjIDkzhepXkfQo2yazcTSoGoJ5QFSwMj9yljFCve2JjTj1O6KT4JxbOzvG
vMpEqY6KjuCsENU8vm6lBq+D7PmtZw20V+nofA1V3y1L9CGCuygVTe33FuWNIVwA
VQKmhV+0IaG8vIdHgKtYKUK9n4zV48DAPurpjTf4UotzD0+BYef/BOatrQ1HGp9/
z6cmqB9FGIxOk5MZIgeer/3bjkYng7Q60zm7pHnMFhb265+0bsMzkvGl/PMvzKib
ASRdTqy+rZiE/Y48KfcjTjY4Eyvk69U3I5iuu7xU+CvawMsBhifRn79A7e0eHTQ=
=gLo3
-----END PGP SIGNATURE-----



From ludovit.koren at gmail.com  Thu Jan  8 22:23:32 2015
From: ludovit.koren at gmail.com (Ludovit Koren)
Date: Thu, 08 Jan 2015 23:23:32 +0100
Subject: [squid-users] Memory Leak Squid 3.4.9 on FreeBSD 10.0 x64
In-Reply-To: <E6B2517F8D6DBF4CABB8F38ACA367E78343B4E87@Draco.dawnsign.com>
 (Doug Sampson's message of "Thu, 8 Jan 2015 19:10:25 +0000")
References: <86iogtp7ao.fsf@gmail.com>
 <E6B2517F8D6DBF4CABB8F38ACA367E78343B4E87@Draco.dawnsign.com>
Message-ID: <86ioggap3v.fsf@gmail.com>

>>>>> Doug Sampson <dougs at dawnsign.com> writes:

    >> Hi,
    >> 
    >> I have the similar problem on FreeBSD 10.1-STABLE #1 r275861 with
    >> squid-3.4.10. I also applied MEMPOOLS=1 when starting squid. I
    >> experience the process slowing down and unacceptable performance.
    >> 
    >> Squid is configured to use kerberos and ntlm authentication and lap
    >> group authentication. other settings:
    >> 
    >> cache_replacement_policy heap LFUDA
    >> cache_mem 4096 MB
    >> maximum_object_size 32 MB
    >> cache_dir diskd /usr/local/squid/cache 32768 32 256
    >> 
    >> I have seen the following errors in cache.log:
    >> 
    >> FATAL: Received Segment Violation...dying.
    >> FATAL: Received Bus Error...dying.
    >> 
    >> after this the squid restarts. The system has 10GB of memory and is
    >> working as internal cache for ~600 users.
    >> 
    >> Please point me in the right direction. I have no problem running
    >> squid33-3.3.13 on FreeBSD 9.3-STABLE #0 r270210.
    >> 
    >> Thank you very much.
    >> 
    >> Regards,
    >> 
    >> lk

    > Man, I empathize with you. Have you tried running Squid 3.4.x on
    > FreeBSD 9.3? Sometimes I wonder if it's FreeBSD 10.x that's causing
    > the issue...

I am running FreeBSD 9.3-STABLE #1 r274084 with Squid 3.4.9 as a cache
in DMZ without authentication. There are no problems.

lk

    > I tried the shell variable MEMPOOLS=1 and that quickly made the
    > situation a lot worse. Swap space would get filled up very quickly and
    > the system would slow down quickly before crashing.

    > Any other ideas?

    > ~Doug



From squid3 at treenet.co.nz  Fri Jan  9 01:12:38 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 09 Jan 2015 14:12:38 +1300
Subject: [squid-users] Memory Leak Squid 3.4.9 on FreeBSD 10.0 x64
In-Reply-To: <E6B2517F8D6DBF4CABB8F38ACA367E78343B4E87@Draco.dawnsign.com>
References: <86iogtp7ao.fsf@gmail.com>
 <E6B2517F8D6DBF4CABB8F38ACA367E78343B4E87@Draco.dawnsign.com>
Message-ID: <54AF2B06.6030505@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 9/01/2015 8:10 a.m., Doug Sampson wrote:
>> Hi,
>> 
>> I have the similar problem on FreeBSD 10.1-STABLE #1 r275861
>> with squid-3.4.10. I also applied MEMPOOLS=1 when starting squid.
>> I experience the process slowing down and unacceptable
>> performance.
>> 
>> Squid is configured to use kerberos and ntlm authentication and
>> lap group authentication. other settings:
>> 

~14 MB for Squid process memory.

>> cache_replacement_policy heap LFUDA cache_mem 4096 MB

+ 4096 MB for RAM cache
+ 60 MB for RAM cache index

>> maximum_object_size 32 MB cache_dir diskd /usr/local/squid/cache
>> 32768 32 256

+ 540 MB for disk cache index

+ (600 * 16 * 0.5) MB for each active client connection state.
  ==> 4800 MB

  NP: modern web browsers open up to 8 parallel connections to load a
page ("happy eyeballs" makes that 16 TCP sockets) per client ==> ~8 MB
per active client.

Grand total:
  => 9.5 GB of RAM just for Squid.

.. then there is whatever memory the helper programs, other software
on the server and operating system all need.


>> 
>> I have seen the following errors in cache.log:
>> 
>> FATAL: Received Segment Violation...dying. FATAL: Received Bus
>> Error...dying.

need a backtrace to tell what the "Segment Violation" is about.

"Bus Error" is your CPU or RAM futzing up. The OS or hardware is
broken. Quite possibly this is the result of runnign out of RAM and
swap space.

>> 
>> after this the squid restarts. The system has 10GB of memory and
>> is working as internal cache for ~600 users.
>> 
>> Please point me in the right direction. I have no problem
>> running squid33-3.3.13 on FreeBSD 9.3-STABLE #0 r270210.
>> 
>> Thank you very much.
>> 
>> Regards,
>> 
>> lk
> 
> Man, I empathize with you. Have you tried running Squid 3.4.x on
> FreeBSD 9.3? Sometimes I wonder if it's FreeBSD 10.x that's causing
> the issue...
> 
> I tried the shell variable MEMPOOLS=1 and that quickly made the
> situation a lot worse. Swap space would get filled up very quickly
> and the system would slow down quickly before crashing.
> 

All MEMPOOLS=1 does is make Squid internally recycle the memory that
gets free'd. Re-using it for other objects of the same type that are
allocated right after its free'd. So new memory only gets allocated
once the recycling "pool" for an object type is empty, everything
allocated so far actively in use.

The main point of using MEMPOOLS=1 is a debugging aid to track down
leaks, by a) reduced OS allocator calls making frequent ones obvious,
and b) the mgr:mem report more clearly listing what objects are being
free'd (chunked pool contains recycled objects) and which are not
(pool always empty).



Steve Hill has come up with some patches that resolve memory issues
with the new 3.4 helper annotations feature when using Negotiate or
NTMLM auth helpers. For authenticated clients with long connection
times or high traffic volumes the state can accumulate up to quite
large amounts of memory. see the "Debugging slow proxy" thread of
earlier this week.

HTH
Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUrysEAAoJELJo5wb/XPRjFFMH/RNhVzPWfFixDDarpHUFQMoE
6QLkaD5wwQfRp3xfBW/QfZ9vvu04zptFOvNr4766jGsh9RSGZdNZwgPc9pCADDrv
Xs0HCO1VDMxGoBjFfaS2XJ5DLX2zQdbYlZKb0yghxXSYzg0ZZEhmsKO8r1Exp8j7
KO95yP3z/8agmwXbU2sJ1esqRC7IfW2sF/DtU8cPTzUf0cKEyjGoCbVrNAN1qKUH
jLf1iw8sNr3xGwFG/WmQmKpYTsXInSp4GmwXgCSQ0T5DCLVDtWuvnXpobxR8iuSW
zIX/CDKTe58lfVP4EXdzJNBgiuEiVZaRccynbk2L8HRvJ8kt9Pk50P5tWXM5FMw=
=lv6G
-----END PGP SIGNATURE-----


From chris at ceegeebee.com  Fri Jan  9 03:55:54 2015
From: chris at ceegeebee.com (Chris Bennett)
Date: Fri, 9 Jan 2015 14:25:54 +1030
Subject: [squid-users] how to obtain info about actual active downloads?
In-Reply-To: <54AE6910.1010000@gmail.com>
References: <544E4977.3050705@hanzlici.cz>
 <20150108044739.GA23887@cgb-linux.rcmb.lan>
 <54AE5693.40003@gmail.com>
 <20150108112138.GB27876@cgb-linux.rcmb.lan>
 <54AE6910.1010000@gmail.com>
Message-ID: <20150109035554.GC27876@cgb-linux.rcmb.lan>

> Solaris 10 u11. :) Yeah, it still using. :)

I can only suggest standard troubleshooting processes for when a
package isn't compiling - config.log should give you hints at what
could be wrong.  Feel free to send me config.log offlist if you want.
No guarantees on being able to help you :)

Regards,

Chris


From chris at ceegeebee.com  Fri Jan  9 04:00:30 2015
From: chris at ceegeebee.com (Chris Bennett)
Date: Fri, 9 Jan 2015 14:30:30 +1030
Subject: [squid-users] how to obtain info about actual active downloads?
In-Reply-To: <1420728648447.15556@diladele.com>
References: <544E4977.3050705@hanzlici.cz>
 <20150108044739.GA23887@cgb-linux.rcmb.lan>
 <54AE5693.40003@gmail.com>
 <20150108112138.GB27876@cgb-linux.rcmb.lan>
 <54AE6B5C.20600@gmail.com> <1420728648447.15556@diladele.com>
Message-ID: <20150109040030.GD27876@cgb-linux.rcmb.lan>

Hi Rafael,

> If you'd dump your mindset on how you'd like to see it ideally I
> could take a look in qlproxy 4.2 when we redesign our reports
> subsystem.  Milestone is -
> https://github.com/ra-at-diladele-com/qlproxy_external/milestones/4.2

sqtop shows active sessions through the proxy per client, along with a
report of current and average throughput per client.  That is really
useful for knowing what's consuming data *right now* compared to any
historical report, since historical reports usually only acocunt for
data when a connection has ended.

Regards,

Chris


From rafael.akchurin at diladele.com  Fri Jan  9 08:22:05 2015
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Fri, 9 Jan 2015 08:22:05 +0000
Subject: [squid-users] how to obtain info about actual active downloads?
In-Reply-To: <20150109040030.GD27876@cgb-linux.rcmb.lan>
References: <544E4977.3050705@hanzlici.cz>
 <20150108044739.GA23887@cgb-linux.rcmb.lan> <54AE5693.40003@gmail.com>
 <20150108112138.GB27876@cgb-linux.rcmb.lan> <54AE6B5C.20600@gmail.com>
 <1420728648447.15556@diladele.com>, <20150109040030.GD27876@cgb-linux.rcmb.lan>
Message-ID: <1420791726066.45639@diladele.com>

Hello Chris,

The ICAP session is happening inlined with HTTP(S) sessions (i.e. the proxy user will not get any bytes until ICAP server tells Squid to proceed). In this sense looking at sessions from ICAP is almost the same (or even better) as having this info from within Squid's logs (as if I am not mistaken the data get's written to the log *after* each session is completed).

The active sessions per client is already present (with some history back log).. from your description I see that the current and average throughput per client is missing. May I assume  that you'd like to see for each active proxy client the number of bytes retrieved during last 1, 5, 30 minutes/seconds or so? Sorry if I completely misunderstood your notice.

Raf.



________________________________________
From: Chris Bennett <chris at ceegeebee.com>
Sent: Friday, January 9, 2015 5:00 AM
To: Rafael Akchurin
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] how to obtain info about actual active downloads?

Hi Rafael,

> If you'd dump your mindset on how you'd like to see it ideally I
> could take a look in qlproxy 4.2 when we redesign our reports
> subsystem.  Milestone is -
> https://github.com/ra-at-diladele-com/qlproxy_external/milestones/4.2

sqtop shows active sessions through the proxy per client, along with a
report of current and average throughput per client.  That is really
useful for knowing what's consuming data *right now* compared to any
historical report, since historical reports usually only acocunt for
data when a connection has ended.

Regards,

Chris


From yvoinov at gmail.com  Fri Jan  9 08:36:13 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Fri, 09 Jan 2015 14:36:13 +0600
Subject: [squid-users] Why 3.5.0.4 generates mimicked certs with server IP
	only when bumping?
Message-ID: <54AF92FD.3050702@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Hi,

gents.

I've try to test last daily-generated 3.5.0.4 and meet different
behaviour (different from 3.4.10).

All squid-generated mimicked certs contains in CN only server IP, not
hostname.

Following, all client browsers are unhappy. :)

What I'm doing wrong?

WBR, Yuri
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUr5L9AAoJENNXIZxhPexGbmkIAIoOowXF6BrUtIoXDcV3LpZW
lM5p6PzZBQ9Nby3VG3EwWUWGHa7LRa8VEg7WZOpZ8uH1JNw8Y+Xt9jgARph/3hgR
A5YBm+PIvXf1zpFmKUzcLuCPo0PR5RE8UojFtFpMVLAQ7R6OdxcGy36eQJngPzEU
0OzbmMXNGvaRlr3lzPkyU6HiWXGSNZe/E/c1lLLzpviIO9KBAHjbDRdhEMgNmIOg
yBdVI4/A7s8kkwZBWVBryUStA+GEE08lo+Q4aKBT0WOhribQbLBVXBMfLbGwhSLX
rsHKrHU9sGOkc9URP8aZRbghS4BHqh2meci24PBToCYDRKBTzkJhdJ1fuxEmQxs=
=zYwD
-----END PGP SIGNATURE-----




From chris at ceegeebee.com  Fri Jan  9 09:52:16 2015
From: chris at ceegeebee.com (Chris Bennett)
Date: Fri, 9 Jan 2015 20:22:16 +1030
Subject: [squid-users] how to obtain info about actual active downloads?
In-Reply-To: <1420791726066.45639@diladele.com>
References: <544E4977.3050705@hanzlici.cz>
 <20150108044739.GA23887@cgb-linux.rcmb.lan>
 <54AE5693.40003@gmail.com>
 <20150108112138.GB27876@cgb-linux.rcmb.lan>
 <54AE6B5C.20600@gmail.com> <1420728648447.15556@diladele.com>
 <20150109040030.GD27876@cgb-linux.rcmb.lan>
 <1420791726066.45639@diladele.com>
Message-ID: <20150109095216.GE27876@cgb-linux.rcmb.lan>

Hi Rafael,

> as if I am not mistaken the data get's written to the log
> *after* each session is completed

You are correct about squids access_log file, but sqtop uses squid's
manager interface to report on active HTTP(S) connections.  i.e for
the download of a large (1GB) file, sqtop will report that item,
attributed to the IP & user (if known) that originated the request,
for the whole duration of the download, including current and average
speed.  It answers the question "who is using proxy bandwidth *right
now*?" compared to other reports that analyse logs and report on
historical usage.

The screenshot on sqtop's page should give you an idea of what it
presents:
  http://sqtop.googlecode.com/svn/wiki/images/scr1_ui_big.png

Hopefully that makes it clearer?

Regards,

Chris


From rafael.akchurin at diladele.com  Fri Jan  9 10:07:41 2015
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Fri, 9 Jan 2015 10:07:41 +0000
Subject: [squid-users] how to obtain info about actual active downloads?
In-Reply-To: <20150109095216.GE27876@cgb-linux.rcmb.lan>
References: <544E4977.3050705@hanzlici.cz>
 <20150108044739.GA23887@cgb-linux.rcmb.lan> <54AE5693.40003@gmail.com>
 <20150108112138.GB27876@cgb-linux.rcmb.lan> <54AE6B5C.20600@gmail.com>
 <1420728648447.15556@diladele.com>
 <20150109040030.GD27876@cgb-linux.rcmb.lan>
 <1420791726066.45639@diladele.com>, <20150109095216.GE27876@cgb-linux.rcmb.lan>
Message-ID: <1420798061905.61137@diladele.com>

Hello Chris,

Perfect!!

I will see how this can be integrated in Surfing Now as it seems the squid manager interface make this info directly usable.
Added issue for this https://github.com/ra-at-diladele-com/qlproxy_external/issues/716.

Thanks a lot!

Best regards,
Rafael

________________________________________
From: Chris Bennett <chris at ceegeebee.com>
Sent: Friday, January 9, 2015 10:52 AM
To: Rafael Akchurin
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] how to obtain info about actual active downloads?

Hi Rafael,

> as if I am not mistaken the data get's written to the log
> *after* each session is completed

You are correct about squids access_log file, but sqtop uses squid's
manager interface to report on active HTTP(S) connections.  i.e for
the download of a large (1GB) file, sqtop will report that item,
attributed to the IP & user (if known) that originated the request,
for the whole duration of the download, including current and average
speed.  It answers the question "who is using proxy bandwidth *right
now*?" compared to other reports that analyse logs and report on
historical usage.

The screenshot on sqtop's page should give you an idea of what it
presents:
  http://sqtop.googlecode.com/svn/wiki/images/scr1_ui_big.png

Hopefully that makes it clearer?

Regards,

Chris

From squid3 at treenet.co.nz  Fri Jan  9 10:41:06 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 09 Jan 2015 23:41:06 +1300
Subject: [squid-users] Why 3.5.0.4 generates mimicked certs with server
 IP only when bumping?
In-Reply-To: <54AF92FD.3050702@gmail.com>
References: <54AF92FD.3050702@gmail.com>
Message-ID: <54AFB042.4000509@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 9/01/2015 9:36 p.m., Yuri Voinov wrote:
> 
> Hi,
> 
> gents.
> 
> I've try to test last daily-generated 3.5.0.4 and meet different 
> behaviour (different from 3.4.10).
> 
> All squid-generated mimicked certs contains in CN only server IP,
> not hostname.
> 
> Following, all client browsers are unhappy. :)
> 
> What I'm doing wrong?

What are you doing? specific squid.conf details please.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUr7BBAAoJELJo5wb/XPRjJmkIAM7nPsD9TpaY7IRjZpZvMAvN
gumxxZ7B2PvxnIEsXY1ZGq24PvVEDQ0U/j9soaBlmLQNLLo8+Yi0Kb842z0CvVgu
ihCWy1YZMnYsxwIYPRfV0iIYG7r48bKp2UG2FuRfiae94naEPxslyIdQ6UZzK6JZ
ihBIZgM+oErlWdihrkmaNwqJeLXNYVfwXePVF+xQoDmctkg4TwvLHQPqM0CIaMCk
AQF6vcCRGCjmVxgmB8y6qTz/GzwU3zY5zHRQQ8lU9OXoQmykKKjqqUE2w7ivY6Oz
8EYNYWP1moSc3PV0GFOykkYaZEKi2nCU+n0/8vYtsAQbtWM9sBOl5Ea+vcF4Xdc=
=JNAU
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Fri Jan  9 10:43:12 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 09 Jan 2015 23:43:12 +1300
Subject: [squid-users] FTP: Deny Upload
In-Reply-To: <260598f2de524fb3baf6c30f6b0db341@mxs01.frauscher.intern>
References: <c868e8c7b4694628ac4bbd82cc25e8e3@mxs02.frauscher.intern>
 <54AED29A.6020509@treenet.co.nz>
 <260598f2de524fb3baf6c30f6b0db341@mxs01.frauscher.intern>
Message-ID: <54AFB0C0.3050903@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 9/01/2015 7:33 p.m., Florian Huber wrote:
> So there is no way to distinguish between up and download?

Correct. At least if its being transferred as FTP.

If it is being translated to HTTP *by the client* then it should be
using PUT/POST requests to ftp:// URLs.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUr7C/AAoJELJo5wb/XPRjF/sH/0iGkMx7nQ/mA0LyIVN2ycVO
Ay192zjmaApewIfujBEn5IvEFOtAmhau4eoAbv4Gh4pmh/HaSqVMi7hePOt6k5eT
vYGvRb2eWLusCfjhxL3AUk1fKdYczfCWy7bzs8nvDWzJsZEkUiMSi7aUdO26wzff
DcnsRDcW2X8rHE6zC/HoCzyuMffCXFU6D739BIxLdk0FKkrRZRmoiLrFBVBi7C9b
OWmh3PVQSFD8QiDfbkEY0P7tBy5gQGFsiECSjxDW/fR4CjMYO2/vmtnop1Etgw7y
/hfc8US7W06hdsbZbX50YtESqMuIp2OranCVyDfdaRt2wwvcvyVh4w5fnjL6x7A=
=CMap
-----END PGP SIGNATURE-----


From yvoinov at gmail.com  Fri Jan  9 10:45:42 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Fri, 09 Jan 2015 16:45:42 +0600
Subject: [squid-users] Why 3.5.0.4 generates mimicked certs with server
 IP only when bumping?
In-Reply-To: <54AFB042.4000509@treenet.co.nz>
References: <54AF92FD.3050702@gmail.com> <54AFB042.4000509@treenet.co.nz>
Message-ID: <54AFB156.5030502@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
I have working production 3.4.10 with working ssl bumping.

Config was the same as working 3.4.10. I've just want to take a look on
new release.

in squid.documented said, than backward compatibility server-first and
none options for ssl_bump are kept.

But:

Neither works with old syntax, nor new.

Looks like target https hosts not resolved and bump got only IP.

09.01.2015 16:41, Amos Jeffries ?????:
> On 9/01/2015 9:36 p.m., Yuri Voinov wrote:
>
> > Hi,
>
> > gents.
>
> > I've try to test last daily-generated 3.5.0.4 and meet different
> > behaviour (different from 3.4.10).
>
> > All squid-generated mimicked certs contains in CN only server IP,
> > not hostname.
>
> > Following, all client browsers are unhappy. :)
>
> > What I'm doing wrong?
>
> What are you doing? specific squid.conf details please.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUr7FWAAoJENNXIZxhPexGJuIH/2BO2NpSaIbKLKx86AAGiQt1
GWVk1jb+YeYsOyRR/Caw5nBApGe9ZteYD0tD9zqaHtz/eIIUdv9XORQxWvxtXtpH
z4p7aFzEFRhZ4/3FMwKVtvZaJa5FZLqUVQXSL96kGOtKuXS40Un7gAUNggejuhrm
ZrfUdD7kXycy9Y0GvRmhAIr+BjjuwzujkBqWk2R4ooPf5HSHmDSiG+dqhheIO/dO
LShUco13el3ucLxrumPHSCUDUpSyPLPlvj4p9tyKJURoVv6v7bepCP7AYhA5YV1S
EvJo8AAdLZTkVcbnTjiuqjB28F3dkB0LKvSJOSCNPIWcueX6X3Y8a5VR2+igANk=
=510Q
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150109/7218c074/attachment.htm>

From squid3 at treenet.co.nz  Fri Jan  9 10:57:26 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 09 Jan 2015 23:57:26 +1300
Subject: [squid-users] Why 3.5.0.4 generates mimicked certs with server
 IP only when bumping?
In-Reply-To: <54AFB156.5030502@gmail.com>
References: <54AF92FD.3050702@gmail.com> <54AFB042.4000509@treenet.co.nz>
 <54AFB156.5030502@gmail.com>
Message-ID: <54AFB416.1040500@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 9/01/2015 11:45 p.m., Yuri Voinov wrote:
> 
> I have working production 3.4.10 with working ssl bumping.
> 
> Config was the same as working 3.4.10. I've just want to take a
> look on new release.
> 
> in squid.documented said, than backward compatibility server-first
> and none options for ssl_bump are kept.
> 
> But:
> 
> Neither works with old syntax, nor new.
> 
> Looks like target https hosts not resolved and bump got only IP.

The config values are still accepted, but there is an extra bumping
stage now before the SNI is available.

You are wanting to peek at stage 1 (to get the client SNI details) and
server-first/splice at stage 2 (using the domain). Otherwise All Squid
works with when intercepting are the TCP IPs.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUr7QWAAoJELJo5wb/XPRjH3UH/RgN6NVH76gyTpHjR5sEWwJe
fXWo9LA2sxr/eNGsRLs6/6/LpETVLW7Zq5hGJ8eq6EzHs/htYfCD5nsJHFmPUsRs
Jln8LiifwCvb7aErH9oeIgjnexC2qAjuAvDZIWpntVFUPwg7R52/CyMZbLMk6czm
egQNVBjBPzbI4dYgBJwwdyUMbr8zDpDq4z0QL+4ESKt87KKpTvupUhByJ8mdv1Gw
cZgTaqG2fC5GCuJ2dajuv8iKtVR1Ij6+iFYmz9dzWu+T3CQds4uTTWkuumjlI3L9
4UOf/T8mgMks9HQZ+muGltnmVdM0M7Mc3JexB1JKK4ELUmswN1oTDEdUOiMTLTE=
=qZfl
-----END PGP SIGNATURE-----


From yvoinov at gmail.com  Fri Jan  9 11:02:41 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Fri, 09 Jan 2015 17:02:41 +0600
Subject: [squid-users] Why 3.5.0.4 generates mimicked certs with server
 IP only when bumping?
In-Reply-To: <54AFB416.1040500@treenet.co.nz>
References: <54AF92FD.3050702@gmail.com> <54AFB042.4000509@treenet.co.nz>
 <54AFB156.5030502@gmail.com> <54AFB416.1040500@treenet.co.nz>
Message-ID: <54AFB551.2070903@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Ok,

does it mean, that I can't using old bump configuration?

So, the right config for 3.5.x must contains what?

The IP's against server hostnames in mimicking certificates is
equivalence no bump. Every stupid browser will be cry on it.

WBR, Yuri

09.01.2015 16:57, Amos Jeffries ?????:
> On 9/01/2015 11:45 p.m., Yuri Voinov wrote:
>
> > I have working production 3.4.10 with working ssl bumping.
>
> > Config was the same as working 3.4.10. I've just want to take a
> > look on new release.
>
> > in squid.documented said, than backward compatibility server-first
> > and none options for ssl_bump are kept.
>
> > But:
>
> > Neither works with old syntax, nor new.
>
> > Looks like target https hosts not resolved and bump got only IP.
>
> The config values are still accepted, but there is an extra bumping
> stage now before the SNI is available.
>
> You are wanting to peek at stage 1 (to get the client SNI details) and
> server-first/splice at stage 2 (using the domain). Otherwise All Squid
> works with when intercepting are the TCP IPs.
>
> Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUr7VRAAoJENNXIZxhPexGbG8IAKSt9K/SX6BigfQXAhMTXmCB
gGiRmVl2IP3dyZ9cOMSbYnBJpjo3p+STQ9JwKurV0+u+gnK3/DqcLpAz3N4nn+sI
+BYsjR3O+o/Kv3ExD5fihL9cXnliTQ4+YrAwwfnFODsHSd/l3KpbrHBvb+9J4Rwq
fSuLkwM8DkcVwVcfq4FB0gBkPzYcY14McuDrU8o0kWt88W4E+IzIOceGTODZ8zaL
UnvJU0fa7wO5AnD55jbrfOpk9xfu7NCbLGVWYP0G3m7y3ZwpCbSR082BbiVmgWC8
4R+djVw0aw4eKFTr2G1SXFVDxZ5vYRUIKB6Sl0VtA2YFA4YakTO4PyUQejWkohw=
=Wl6n
-----END PGP SIGNATURE-----



From Rutvik.Chowdary at unisys.com  Fri Jan  9 17:03:40 2015
From: Rutvik.Chowdary at unisys.com (Chowdhary, Rutvik non Unisys)
Date: Fri, 9 Jan 2015 17:03:40 +0000
Subject: [squid-users] Squid Windows Installation
Message-ID: <336a64110d804c1aa23d78b634edcc9c@US-EXCH13-1.na.uis.unisys.com>

Hello!.

I am completely new to the Squid Software.

I need information (steps/guidance) how to install the latest version of squid on windows server 2008.

If this is not the right contact, please help with correct contact for this Query


Thanks,
Rutvik Chowdhary  |  Windows Engineering                                                                      [cid:image001.gif at 01CBDA94.F5EF5970]

Contact Number:-  201-283-2329 | Eagan MN 55121



THIS COMMUNICATION MAY CONTAIN CONFIDENTIAL AND/OR OTHERWISE PROPRIETARY MATERIAL and is thus for use only by the intended recipient. If you received this in error, please contact the sender and delete the e-mail and its attachments from all computers.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150109/ccefd23e/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.gif
Type: image/gif
Size: 2554 bytes
Desc: image001.gif
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150109/ccefd23e/attachment.gif>

From bradley.lemon at zenergyok.com  Fri Jan  9 18:22:30 2015
From: bradley.lemon at zenergyok.com (bradley.lemon at zenergyok.com)
Date: Fri, 9 Jan 2015 18:22:30 +0000
Subject: [squid-users] 100Mbps Connection Issues
In-Reply-To: <D0D1A54F.489FE%bradley.lemon@zenergyok.com>
References: <D0D1A54F.489FE%bradley.lemon@zenergyok.com>
Message-ID: <D0D577E8.48DF0%bradley.lemon@zenergyok.com>

I have a VM that is running Ubuntu 14.04 LTS 2.5G RAM 32-bit, that is serving up our Squid proxy 3.3. We recently upgraded our internet connecting to 100Mbps/100Mbps+. When running a speed test from the server, the results are 100Mbps/100Mbps+. But when running the speed test from a proxy client, the results are only 85Mbps/50Mbps. I have tried ?Delay Pools?, and also created a fresh install physical server with two NIC?s (one public facing, one private) getting the same results. Speeds hit 85Mbps/50Mbps, then abruptly stop and bounce of those numbers.

Please advise, Thank you
Bradley Lemon


________________________________

This e-mail transmission (and/or the documents accompanying it) is intended only for the use of the individual(s) or entity to which it is addressed, and may contain information that is PRIVILEGED, CONFIDENTIAL and exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, distribution, copying or the taking of any action in reliance on the contents of this information is strictly prohibited. If you have received this e-mail in error, please notify us immediately, and delete the e-mail and the accompanying documents, if any, without saving. Thank you.


From acrow at integrafin.co.uk  Fri Jan  9 18:46:35 2015
From: acrow at integrafin.co.uk (Alex Crow)
Date: Fri, 09 Jan 2015 18:46:35 +0000
Subject: [squid-users] 100Mbps Connection Issues
In-Reply-To: <D0D577E8.48DF0%bradley.lemon@zenergyok.com>
References: <D0D1A54F.489FE%bradley.lemon@zenergyok.com>
 <D0D577E8.48DF0%bradley.lemon@zenergyok.com>
Message-ID: <54B0220B.3040203@integrafin.co.uk>

Speed tests will always enforce "nocache" so you will always see 
overhead from a speed test site.

That's just the way proxies work. You can't make a single, "new" 
download any quicker that it would be, and since it has a flag telling 
Squid not to cache it, Squid has to go the the trouble of both 
retrieving the content and then passing it on to the client.

Those figures are very good so I'd not actually worry about them. Using 
delay pools will show "bouncy" performance as it's based on buckets - 
when the bucket of data is empty the server have to start refilling it 
before anything comes back to your client.

Cheers

Alex


On 09/01/15 18:22, bradley.lemon at zenergyok.com wrote:
> I have a VM that is running Ubuntu 14.04 LTS 2.5G RAM 32-bit, that is serving up our Squid proxy 3.3. We recently upgraded our internet connecting to 100Mbps/100Mbps+. When running a speed test from the server, the results are 100Mbps/100Mbps+. But when running the speed test from a proxy client, the results are only 85Mbps/50Mbps. I have tried ?Delay Pools?, and also created a fresh install physical server with two NIC?s (one public facing, one private) getting the same results. Speeds hit 85Mbps/50Mbps, then abruptly stop and bounce of those numbers.
>
> Please advise, Thank you
> Bradley Lemon
>
>
> ________________________________
>
> This e-mail transmission (and/or the documents accompanying it) is intended only for the use of the individual(s) or entity to which it is addressed, and may contain information that is PRIVILEGED, CONFIDENTIAL and exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, distribution, copying or the taking of any action in reliance on the contents of this information is strictly prohibited. If you have received this e-mail in error, please notify us immediately, and delete the e-mail and the accompanying documents, if any, without saving. Thank you.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>



From yvoinov at gmail.com  Fri Jan  9 19:51:25 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Sat, 10 Jan 2015 01:51:25 +0600
Subject: [squid-users] Why 3.5.0.4 generates mimicked certs with server
 IP only when bumping?
In-Reply-To: <54AFB416.1040500@treenet.co.nz>
References: <54AF92FD.3050702@gmail.com> <54AFB042.4000509@treenet.co.nz>
 <54AFB156.5030502@gmail.com> <54AFB416.1040500@treenet.co.nz>
Message-ID: <54B0313D.5070500@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
How can that be?

All HSTS sites cry with 3.5 bump option - they don't like host IP as CN,
other sites behaviour depending they (and browsers) settings.

Is it possible to keep server-first behaviour in 3.5.x ?

WBR, Yuri

09.01.2015 16:57, Amos Jeffries ?????:
> On 9/01/2015 11:45 p.m., Yuri Voinov wrote:
>
> > I have working production 3.4.10 with working ssl bumping.
>
> > Config was the same as working 3.4.10. I've just want to take a
> > look on new release.
>
> > in squid.documented said, than backward compatibility server-first
> > and none options for ssl_bump are kept.
>
> > But:
>
> > Neither works with old syntax, nor new.
>
> > Looks like target https hosts not resolved and bump got only IP.
>
> The config values are still accepted, but there is an extra bumping
> stage now before the SNI is available.
>
> You are wanting to peek at stage 1 (to get the client SNI details) and
> server-first/splice at stage 2 (using the domain). Otherwise All Squid
> works with when intercepting are the TCP IPs.
>
> Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUsDE9AAoJENNXIZxhPexGl+MH/2wEV5rEDSb6eQ5KRbHI8ZJ4
WV0fdTg7yFR+bfWCUYzjVovQhrx0gaIFLNWvuwDbc62zJJnvADQuAzu7chouafkP
wpGuBjjp3jYZWa1TlZN4XoDeK2THswXau/5kY9P7IKKAJu9VjhjII803ywn5C8DW
48NQWU0Uhs86Tr6XAuaRzUYZK6lht0VcJFKiftmKmOE7Rl7+Yy/Kak1zXxLh8mzX
a8N0DSsSlBqIm7s8yngwWQuf8rQ0tlwrKWNSpCL3xD6Wk0MFwhRqe6Vbncj4sbff
p0OifMf0YD5sbytsUq4OO5HOdO7WPu+foB2AMKSiou5cDMqz5Vcnw0mD35t25Fg=
=OEZu
-----END PGP SIGNATURE-----



From rafael.akchurin at diladele.com  Fri Jan  9 20:02:48 2015
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Fri, 9 Jan 2015 20:02:48 +0000
Subject: [squid-users] Squid Windows Installation
In-Reply-To: <336a64110d804c1aa23d78b634edcc9c@US-EXCH13-1.na.uis.unisys.com>
References: <336a64110d804c1aa23d78b634edcc9c@US-EXCH13-1.na.uis.unisys.com>
Message-ID: <AM3PR04MB450BC9119AE81D44E7E8F918F440@AM3PR04MB450.eurprd04.prod.outlook.com>

Hello Rutvik,

Please see http://squid.diladele.com/. This is not the *latest* squid  (and btw *not an official one*) but we are doing what we can. Hopefully 3.5 will soon run as MSI on Windows for the benefits of all community.

Best regards,
Raf

From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Chowdhary, Rutvik non Unisys
Sent: Friday, January 9, 2015 6:04 PM
To: squid-users at lists.squid-cache.org
Subject: [squid-users] Squid Windows Installation

Hello!.

I am completely new to the Squid Software.

I need information (steps/guidance) how to install the latest version of squid on windows server 2008.

If this is not the right contact, please help with correct contact for this Query


Thanks,
Rutvik Chowdhary  |  Windows Engineering                                                                      [cid:image001.gif at 01CBDA94.F5EF5970]

Contact Number:-  201-283-2329 | Eagan MN 55121



THIS COMMUNICATION MAY CONTAIN CONFIDENTIAL AND/OR OTHERWISE PROPRIETARY MATERIAL and is thus for use only by the intended recipient. If you received this in error, please contact the sender and delete the e-mail and its attachments from all computers.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150109/677da5c1/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.gif
Type: image/gif
Size: 2554 bytes
Desc: image001.gif
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150109/677da5c1/attachment.gif>

From mattatrmc at gmail.com  Fri Jan  9 20:19:17 2015
From: mattatrmc at gmail.com (mattatrmc)
Date: Fri, 9 Jan 2015 12:19:17 -0800 (PST)
Subject: [squid-users] Help getting Squid 3.4 Transparent Proxy to Work
Message-ID: <1420834757923-4669007.post@n4.nabble.com>

Hello Everyone,

I'm not to this forum and using Squid.  I've downloaded and installed Squid
3.4 on OpenBSD.  I'm currently attempting to get the program to run as a
transparent proxy.  I'm currently getting the following error message, and
I'm not quite sure what is causing it, I've verified that my certificates
are correct.  Any help would be very much appreciated.

FATAL: No valid signing SSL certificate configured for http_port
0.0.0.0:3128

Thanks,

Matt



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Help-getting-Squid-3-4-Transparent-Proxy-to-Work-tp4669007.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From yvoinov at gmail.com  Fri Jan  9 20:56:34 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Sat, 10 Jan 2015 02:56:34 +0600
Subject: [squid-users] Help getting Squid 3.4 Transparent Proxy to Work
In-Reply-To: <1420834757923-4669007.post@n4.nabble.com>
References: <1420834757923-4669007.post@n4.nabble.com>
Message-ID: <54B04082.8030300@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Matt,

you need self-signed root CA certificate with private key to HTTPS
interception work with ssl-bump.

Config lines must looks like this:

http_port 3127
http_port 3128 intercept

https_port 3129 intercept ssl-bump generate-host-certificates=on
dynamic_cert_mem_cache_size=4MB cert=/usr/local/squid/etc/rootCA.crt
key=/usr/local/squid/etc/rootCA.key capath=/etc/opt/csw/ssl/certs

WBR, Yuri

10.01.2015 2:19, mattatrmc ?????:
> Hello Everyone,
>
> I'm not to this forum and using Squid.  I've downloaded and installed
Squid
> 3.4 on OpenBSD.  I'm currently attempting to get the program to run as a
> transparent proxy.  I'm currently getting the following error message, and
> I'm not quite sure what is causing it, I've verified that my certificates
> are correct.  Any help would be very much appreciated.
>
> FATAL: No valid signing SSL certificate configured for http_port
> 0.0.0.0:3128
>
> Thanks,
>
> Matt
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/Help-getting-Squid-3-4-Transparent-Proxy-to-Work-tp4669007.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUsECBAAoJENNXIZxhPexG+lUH/3JeVd7YIaLzbCY3o4k852gt
qBkt0Jk8IRKDaMmxeLcTu7drVz3FWp7Hk7kQneWNWoywSGEXgQzwCRGDMxx2aPjH
+35XiX39rSUx9/H6v6kOLtjLqmRaLSB95jnZUbFtBjVXdhpm3+BLwrTGf8j1WwVu
G5YPJigRCLAabXU3v9iIMn5qQ/awKm0+N1P3D+vvDpsvkTufbAEgijjAEmyAJZyM
/KRvh2OlEqox7rp0V7RGupUa629Oeze8/Dy3wAVWUTaloE3bUFK0avSalpcpfvgC
vktLeM2e5JIrTWY0p565SDnAdxIFL4f97z0N963xi4D8B0upp4lx2Fa8i/p/FZE=
=UfJb
-----END PGP SIGNATURE-----



From yvoinov at gmail.com  Fri Jan  9 21:01:20 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Sat, 10 Jan 2015 03:01:20 +0600
Subject: [squid-users] Squid Windows Installation
In-Reply-To: <AM3PR04MB450BC9119AE81D44E7E8F918F440@AM3PR04MB450.eurprd04.prod.outlook.com>
References: <336a64110d804c1aa23d78b634edcc9c@US-EXCH13-1.na.uis.unisys.com>
 <AM3PR04MB450BC9119AE81D44E7E8F918F440@AM3PR04MB450.eurprd04.prod.outlook.com>
Message-ID: <54B041A0.4090601@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Raf,

this version doesn't work with SSL-bump (I've tested, now it runs on my
notebook ;)) and yes, this is not latest version. :)  Also I miss
storeid helper (it is absent in this release).

I've tried to build 3.5.0.4 with MinGW on Windows 7, but I did not get. :)

But Diladele squid is nice try, I've changed old Squid 2 from Guido to
this version. ;)

WBR, Yuri

10.01.2015 2:02, Rafael Akchurin ?????:
>
> Hello Rutvik,
>
> 
>
> Please see http://squid.diladele.com/. This is not the **latest**
squid  (and btw **not an official one**) but we are doing what we can.
Hopefully 3.5 will soon run as MSI on Windows for the benefits of all
community.
>
> 
>
> Best regards,
>
> Raf
>
> 
>
> *From:* squid-users [mailto:squid-users-bounces at lists.squid-cache.org]
*On Behalf Of *Chowdhary, Rutvik non Unisys
> *Sent:* Friday, January 9, 2015 6:04 PM
> *To:* squid-users at lists.squid-cache.org
> *Subject:* [squid-users] Squid Windows Installation
>
> 
>
> Hello!.
>
> 
>
> I am completely new to the Squid Software.
>
> 
>
> I need information (steps/guidance) how to install the latest version
of squid on windows server 2008.
>
> 
>
> If this is not the right contact, please help with correct contact for
this Query
>
> 
>
> */Thanks,/*
>
> */Rutvik Chowdhary/*  |  Windows
Engineering                                                                     
cid:image001.gif at 01CBDA94.F5EF5970
>
> Contact Number:-  201-283-2329 | Eagan MN 55121
>
>    
>
> THIS COMMUNICATION MAY CONTAIN CONFIDENTIAL AND/OR OTHERWISE
PROPRIETARY MATERIAL and is thus for use only by the intended recipient.
If you received this in error, please contact the sender and delete the
e-mail and its attachments from all computers.
>
>    
>
> 
>
> 
>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUsEGgAAoJENNXIZxhPexGXnkH/i2gPXbR5mRfX0CV5XgFQDLn
+2SaDL4fPNozN1UbOnHXUlevtYcI7UVXzPs7/h0YTJH2gCb5c+tdr1PjlBSS/f/c
/6OgenLxJWOaU+j+p/2t+qdgNMZqdLobZQVwU0ib0UcTfgRuDhv0/h68Bh5Nz/4G
JHQGbhjeDe289PmxRYty19+XiWQK6WSQWhZKKPXdPO4gdLVtxfYtDws4hbXew2y0
5FYXX5Qgkm5fN3fGPPakJYEyUqUi3mTxlrwPBa79ulmACntee2jQkl0dwAzsN4Rt
k4jaFW26Erv+JMkMvUtX6em1o0HaNbgGZksEFB6cXnHpQxhI0eIrym9lyUgU1g8=
=EqPy
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150110/818385ef/attachment.htm>

From rafael.akchurin at diladele.com  Fri Jan  9 21:32:40 2015
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Fri, 9 Jan 2015 21:32:40 +0000
Subject: [squid-users] Squid Windows Installation
In-Reply-To: <54B041A0.4090601@gmail.com>
References: <336a64110d804c1aa23d78b634edcc9c@US-EXCH13-1.na.uis.unisys.com>
 <AM3PR04MB450BC9119AE81D44E7E8F918F440@AM3PR04MB450.eurprd04.prod.outlook.com>
 <54B041A0.4090601@gmail.com>
Message-ID: <AM3PR04MB450C392A996B316C1A3D6668F440@AM3PR04MB450.eurprd04.prod.outlook.com>

Hello Yuri,

The build from December 22 does work with SSLBump when running it as explicit proxy. I am able to see the blocked page from HTTPS searches on Google for example.
Of course I test with ICAP server but all builtin ACLs, SquidGuard and other filters should also be able to get the HTTPS contents as it *is* bumped.

We are working on 3.5 but far from the end yet :)

Best regards,
Raf

From: Yuri Voinov [mailto:yvoinov at gmail.com]
Sent: Friday, January 9, 2015 10:01 PM
To: squid-users at lists.squid-cache.org; Rafael Akchurin
Subject: Re: [squid-users] Squid Windows Installation


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Raf,

this version doesn't work with SSL-bump (I've tested, now it runs on my notebook ;)) and yes, this is not latest version. :)  Also I miss storeid helper (it is absent in this release).

I've tried to build 3.5.0.4 with MinGW on Windows 7, but I did not get. :)

But Diladele squid is nice try, I've changed old Squid 2 from Guido to this version. ;)

WBR, Yuri

10.01.2015 2:02, Rafael Akchurin ?????:
>

      > Hello Rutvik,

      >

      >

      >

      > Please see http://squid.diladele.com/. This is not the
      **latest** squid  (and btw **not an official one**) but we are
      doing what we can. Hopefully 3.5 will soon run as MSI on Windows
      for the benefits of all community.

      >

      >

      >

      > Best regards,

      >

      > Raf

      >

      >

      >

      > *From:* squid-users
      [mailto:squid-users-bounces at lists.squid-cache.org] *On Behalf Of
      *Chowdhary, Rutvik non Unisys

      > *Sent:* Friday, January 9, 2015 6:04 PM

      > *To:* squid-users at lists.squid-cache.org<mailto:squid-users at lists.squid-cache.org>

      > *Subject:* [squid-users] Squid Windows Installation

      >

      >

      >

      > Hello!.

      >

      >

      >

      > I am completely new to the Squid Software.

      >

      >

      >

      > I need information (steps/guidance) how to install the latest
      version of squid on windows server 2008.

      >

      >

      >

      > If this is not the right contact, please help with correct
      contact for this Query

      >

      >

      >

      > */Thanks,/*

      >

      > */Rutvik Chowdhary/*  |  Windows
      Engineering
      cid:image001.gif at 01CBDA94.F5EF5970

      >

      > Contact Number:-  201-283-2329 | Eagan MN 55121

      >

      >

      >

      > THIS COMMUNICATION MAY CONTAIN CONFIDENTIAL AND/OR OTHERWISE
      PROPRIETARY MATERIAL and is thus for use only by the intended
      recipient. If you received this in error, please contact the
      sender and delete the e-mail and its attachments from all
      computers.

      >

      >

      >

      >

      >

      >

      >

      >

      >

      > _______________________________________________

      > squid-users mailing list

      > squid-users at lists.squid-cache.org<mailto:squid-users at lists.squid-cache.org>

      > http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2

iQEcBAEBAgAGBQJUsEGgAAoJENNXIZxhPexGXnkH/i2gPXbR5mRfX0CV5XgFQDLn
+2SaDL4fPNozN1UbOnHXUlevtYcI7UVXzPs7/h0YTJH2gCb5c+tdr1PjlBSS/f/c
/6OgenLxJWOaU+j+p/2t+qdgNMZqdLobZQVwU0ib0UcTfgRuDhv0/h68Bh5Nz/4G
JHQGbhjeDe289PmxRYty19+XiWQK6WSQWhZKKPXdPO4gdLVtxfYtDws4hbXew2y0
5FYXX5Qgkm5fN3fGPPakJYEyUqUi3mTxlrwPBa79ulmACntee2jQkl0dwAzsN4Rt
k4jaFW26Erv+JMkMvUtX6em1o0HaNbgGZksEFB6cXnHpQxhI0eIrym9lyUgU1g8=
=EqPy
-----END PGP SIGNATURE-----
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150109/bae2366b/attachment.htm>

From mattatrmc at gmail.com  Sat Jan 10 00:21:58 2015
From: mattatrmc at gmail.com (mattatrmc)
Date: Fri, 9 Jan 2015 16:21:58 -0800 (PST)
Subject: [squid-users] Help getting Squid 3.4 Transparent Proxy to Work
In-Reply-To: <54B04082.8030300@gmail.com>
References: <1420834757923-4669007.post@n4.nabble.com>
 <54B04082.8030300@gmail.com>
Message-ID: <1420849318411-4669011.post@n4.nabble.com>

Thanks for the quick reply Yuri,

I made a few changes to make sure that I was doing the right thing with
respect what port I'm using, and this is my current configuration.  Both my
certificate as well as my key are in the same file, which from my
understanding should work, however I'm sure I'm missing something

# Squid normally listens to port 3128
http_port 3127
http_port 3128 intercept
https_port 3129 intercept ssl-bump generate-host-certificates=on
dynamic_cert_mem_cache_size=4MB cert=/usr/local/squid/ssl_cert/myCA.pem

#enables SSL Bumping

always_direct allow all
ssl_bump client-first all
#the following options are dangerous and shouldn't always be used
sslproxy_cert_error allow all
sslproxy_flags DONT_VERIFY_PEER 
sslcrtd_program /usr/local/squid/libexec/ssl_crtd -s
/usr/local/squid/var/lib/ssl_db -M 4MB
sslcrtd_children 5



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Help-getting-Squid-3-4-Transparent-Proxy-to-Work-tp4669007p4669011.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From yvoinov at gmail.com  Sat Jan 10 08:41:21 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Sat, 10 Jan 2015 14:41:21 +0600
Subject: [squid-users] Squid Windows Installation
In-Reply-To: <AM3PR04MB450C392A996B316C1A3D6668F440@AM3PR04MB450.eurprd04.prod.outlook.com>
References: <336a64110d804c1aa23d78b634edcc9c@US-EXCH13-1.na.uis.unisys.com>
 <AM3PR04MB450BC9119AE81D44E7E8F918F440@AM3PR04MB450.eurprd04.prod.outlook.com>
 <54B041A0.4090601@gmail.com>
 <AM3PR04MB450C392A996B316C1A3D6668F440@AM3PR04MB450.eurprd04.prod.outlook.com>
Message-ID: <54B0E5B1.50907@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Hmmmmm,

The config looks like this:

http_port 3128 ssl-bump generate-host-certificates=on
dynamic_cert_mem_cache_size=4MB cert=/etc/squid/rootCA.crt
key=/etc/squid/rootCA.key
sslproxy_flags DONT_VERIFY_PEER
sslproxy_cafile /etc/ssl/certs/ca-bundle.trust.crt
sslcrtd_program /lib/squid/ssl_crtd -s /var/cache/squid_ssldb -M 4MB

Correct?

I think so, it must work.

What I'm skip?

10.01.2015 3:32, Rafael Akchurin ?????:
>
> Hello Yuri,
>
> 
>
> The build from December 22 does work with SSLBump when running it as
explicit proxy. I am able to see the blocked page from HTTPS searches on
Google for example.
>
> Of course I test with ICAP server but all builtin ACLs, SquidGuard and
other filters should also be able to get the HTTPS contents as it **is**
bumped.
>
> 
>
> We are working on 3.5 but far from the end yet :)
>
> 
>
> Best regards,
>
> Raf
>
> 
>
> *From:*Yuri Voinov [mailto:yvoinov at gmail.com]
> *Sent:* Friday, January 9, 2015 10:01 PM
> *To:* squid-users at lists.squid-cache.org; Rafael Akchurin
> *Subject:* Re: [squid-users] Squid Windows Installation
>
> 
>
>
> Raf,
>
> this version doesn't work with SSL-bump (I've tested, now it runs on
my notebook ;)) and yes, this is not latest version. :)  Also I miss
storeid helper (it is absent in this release).
>
> I've tried to build 3.5.0.4 with MinGW on Windows 7, but I did not get. :)
>
> But Diladele squid is nice try, I've changed old Squid 2 from Guido to
this version. ;)
>
> WBR, Yuri
>
> 10.01.2015 2:02, Rafael Akchurin ?????:
>
>
>       > Hello Rutvik,
>
>
>
>
>
>
>
>       > Please see http://squid.diladele.com/. This is not the
>
>       **latest** squid  (and btw **not an official one**) but we are
>
>       doing what we can. Hopefully 3.5 will soon run as MSI on Windows
>
>       for the benefits of all community.
>
>
>
>
>
>
>
>       > Best regards,
>
>
>
>       > Raf
>
>
>
>
>
>
>
>       > *From:* squid-users
>
>       [mailto:squid-users-bounces at lists.squid-cache.org] *On Behalf Of
>
>       *Chowdhary, Rutvik non Unisys
>
>       > *Sent:* Friday, January 9, 2015 6:04 PM
>
>       > *To:* squid-users at lists.squid-cache.org
<mailto:squid-users at lists.squid-cache.org>
>
>       > *Subject:* [squid-users] Squid Windows Installation
>
>
>
>
>
>
>
>       > Hello!.
>
>
>
>
>
>
>
>       > I am completely new to the Squid Software.
>
>
>
>
>
>
>
>       > I need information (steps/guidance) how to install the latest
>
>       version of squid on windows server 2008.
>
>
>
>
>
>
>
>       > If this is not the right contact, please help with correct
>
>       contact for this Query
>
>
>
>
>
>
>
>       > */Thanks,/*
>
>
>
>       > */Rutvik Chowdhary/*  |  Windows
>
>      
Engineering                                                                    

>
>       cid:image001.gif at 01CBDA94.F5EF5970
>
>
>
>       > Contact Number:-  201-283-2329 | Eagan MN 55121
>
>
>
>
>
>
>
>       > THIS COMMUNICATION MAY CONTAIN CONFIDENTIAL AND/OR OTHERWISE
>
>       PROPRIETARY MATERIAL and is thus for use only by the intended
>
>       recipient. If you received this in error, please contact the
>
>       sender and delete the e-mail and its attachments from all
>
>       computers.
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>
>       > _______________________________________________
>
>       > squid-users mailing list
>
>       > squid-users at lists.squid-cache.org
<mailto:squid-users at lists.squid-cache.org>
>
>       > http://lists.squid-cache.org/listinfo/squid-users
>
>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUsOWwAAoJENNXIZxhPexGFvsIAJ59qpyVmv7BWTRPPCI4rmEG
cf7cMFRNYS9hBzI2efzsyu2MJVlHNBPGZRub/q22VmzrC+ZsLBga+WvP0Ug8K0+N
i+lyJvtSbF3//PVxsd2thE3znf0jtgnoHDpZ6KV+z6xjMBySmez6aZ/aGK85rwAA
2XwiP749Z4HFZ+NDDdjMLzsV6A7HFUNZTUE8eiIvglRV5cmaHSBw4fi/ylevINZ4
ps+m152TegC56BSizQzrYI/ANwqm4qjvYnc5OMzm8aWk0ltIoNDmuzLQLCIL96zD
kHBueObAP2snIz7Zlaqm1L1iStZ1Y7Wnr3Pg4OQGDRYGwPHqCMQN+6MYsSbUpbs=
=Ts9s
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150110/069e51bf/attachment.htm>

From mailmegoodies at gmail.com  Sat Jan 10 13:45:49 2015
From: mailmegoodies at gmail.com (Prasad Yalla)
Date: Sat, 10 Jan 2015 19:15:49 +0530
Subject: [squid-users] strip Referer header based in source
Message-ID: <CAD1jQj6C+kYJK+95bp=HvvH2s1Yj8xP7QtqLyBWzVFQMXidBqw@mail.gmail.com>

I have a requirement to remove Referer header when a certain of my sites
make a reference and not all.
I managed to remove Referer selectively based on the destination domain,
but how do I do it based on the originating site?
Here is how it did for destination domain:

acl referer_allowdst dstdomain google.com
header_access Referer deny referer_allowdst

When i use srcdomain here it doesn't work. This is an urgent requirement,
can someone help me with this please?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150110/a5617398/attachment.htm>

From yvoinov at gmail.com  Sat Jan 10 22:06:42 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Sun, 11 Jan 2015 04:06:42 +0600
Subject: [squid-users] strip Referer header based in source
In-Reply-To: <CAD1jQj6C+kYJK+95bp=HvvH2s1Yj8xP7QtqLyBWzVFQMXidBqw@mail.gmail.com>
References: <CAD1jQj6C+kYJK+95bp=HvvH2s1Yj8xP7QtqLyBWzVFQMXidBqw@mail.gmail.com>
Message-ID: <54B1A272.80602@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
http://wiki.squid-cache.org/SquidFaq/SquidAcl#Differences_between_.27.27src.27.27_and_.27.27srcdomain.27.27_ACL_types

For the /srcdomain/ ACL type, Squid does a reverse lookup of the
client's IP address and checks the result with the domains given on the
/acl <http://www.eu.squid-cache.org/Doc/config/acl>/ line. With the/src/
ACL type, Squid converts hostnames to IP addresses at startup and then
only compares the client's IP address. The /src/ ACL is preferred
over/srcdomain/ because it does not require address-to-name lookups for
each request.


10.01.2015 19:45, Prasad Yalla ?????:
> I have a requirement to remove Referer header when a certain of my sites make a reference and not all.
> I managed to remove Referer selectively based on the destination
domain, but how do I do it based on the originating site?
> Here is how it did for destination domain:
>
> acl referer_allowdst dstdomain google.com <http://google.com>
> header_access Referer deny referer_allowdst
>
> When i use srcdomain here it doesn't work. This is an urgent
requirement, can someone help me with this please?
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUsaJyAAoJENNXIZxhPexG3xQH/je1rGfb0MfMzYbmHSMD2SL0
Y2mc7hccrmoYpRTwjOCK1NmEvoenj3J6stbKGDidoB+BYhuUjt5/xJ+HDA3MjC7C
q+zpt4SdumnXBWiK+tn/RP/pK/TnjqOWcnEpnvctdpXbjJuhUvwf3pZ9/7EG1wPs
R86T8RURbKEBo1IfeSbQrjNWwxt93bt6bOjrRmnc1QEkh8TC+bNGYdug2RM3TkMl
+FBJUL7H/bmlile1vRUot/jEWNWGPP4GyP8rZhp0UcCzepCIX0QW8SepefSmwkQk
lavMU/hrHoIZQdioZkAw/s0uDxr2U3Z4zUg9kiQt58vC3DuWM96jqWndP1TkTug=
=02mh
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150111/fcfb0c8c/attachment.htm>

From mailmegoodies at gmail.com  Sun Jan 11 13:22:02 2015
From: mailmegoodies at gmail.com (Prasad Yalla)
Date: Sun, 11 Jan 2015 18:52:02 +0530
Subject: [squid-users] strip Referer header based in source
In-Reply-To: <54B1A272.80602@gmail.com>
References: <CAD1jQj6C+kYJK+95bp=HvvH2s1Yj8xP7QtqLyBWzVFQMXidBqw@mail.gmail.com>
 <54B1A272.80602@gmail.com>
Message-ID: <CAD1jQj5EXE8Zz_XgGzAEXov0giV9_F45snyAp-+MKJ3Xm2u4MA@mail.gmail.com>

Putting src tries to match IP of the PC from which the request originated.
But thanks, I got this figured out with the referer_regex acl, it looks
something like this:

acl referer_allowsrc referer_regex -i  ^http://testing.abc.com  [here
testing.abc.com is the referring site]
header_access Referer deny referer_allowsrc

this strips the reference header whenever there is testing.abc.com in the
reference header.

On Sun, Jan 11, 2015 at 3:36 AM, Yuri Voinov <yvoinov at gmail.com> wrote:

>
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
>
> http://wiki.squid-cache.org/SquidFaq/SquidAcl#Differences_between_.27.27src.27.27_and_.27.27srcdomain.27.27_ACL_types
>
> For the /srcdomain/ ACL type, Squid does a reverse lookup of the client's
> IP address and checks the result with the domains given on the /acl
> <http://www.eu.squid-cache.org/Doc/config/acl>
> <http://www.eu.squid-cache.org/Doc/config/acl>/ line. With the/src/ ACL
> type, Squid converts hostnames to IP addresses at startup and then only
> compares the client's IP address. The /src/ ACL is preferred
> over/srcdomain/ because it does not require address-to-name lookups for
> each request.
>
>
> 10.01.2015 19:45, Prasad Yalla ?????:
> > I have a requirement to remove Referer header when a certain of my sites
> make a reference and not all.
> > I managed to remove Referer selectively based on the destination domain,
> but how do I do it based on the originating site?
> > Here is how it did for destination domain:
> >
> > acl referer_allowdst dstdomain google.com <http://google.com>
> <http://google.com>
> > header_access Referer deny referer_allowdst
> >
> > When i use srcdomain here it doesn't work. This is an urgent
> requirement, can someone help me with this please?
> >
> >
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
>
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2
>
> iQEcBAEBAgAGBQJUsaJyAAoJENNXIZxhPexG3xQH/je1rGfb0MfMzYbmHSMD2SL0
> Y2mc7hccrmoYpRTwjOCK1NmEvoenj3J6stbKGDidoB+BYhuUjt5/xJ+HDA3MjC7C
> q+zpt4SdumnXBWiK+tn/RP/pK/TnjqOWcnEpnvctdpXbjJuhUvwf3pZ9/7EG1wPs
> R86T8RURbKEBo1IfeSbQrjNWwxt93bt6bOjrRmnc1QEkh8TC+bNGYdug2RM3TkMl
> +FBJUL7H/bmlile1vRUot/jEWNWGPP4GyP8rZhp0UcCzepCIX0QW8SepefSmwkQk
> lavMU/hrHoIZQdioZkAw/s0uDxr2U3Z4zUg9kiQt58vC3DuWM96jqWndP1TkTug=
> =02mh
> -----END PGP SIGNATURE-----
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150111/f0f86d55/attachment.htm>

From hack.back at hotmail.com  Mon Jan 12 09:41:26 2015
From: hack.back at hotmail.com (HackXBack)
Date: Mon, 12 Jan 2015 01:41:26 -0800 (PST)
Subject: [squid-users] ssl cert wiki
Message-ID: <1421055686052-4669016.post@n4.nabble.com>

hello,
according to this chapter
http://wiki.squid-cache.org/ConfigExamples/Reverse/SslWithWildcardCertifiate
i bought signed  certificate 
but no one accept  rsa:1024 
so i generate the key with rsa:2048
after i got my crt from them
https_port 443 cert=/usr/newrprgate/CertAuth/signed.crt
key=/usr/newrprgate/CertAuth/testkey.pem 

but i got error in browser 
Error code: sec_error_inadequate_key_usage
so what could be the problem ?



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/ssl-cert-wiki-tp4669016.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From simon at baladia.gov.kw  Mon Jan 12 06:41:21 2015
From: simon at baladia.gov.kw (Simon Dcunha)
Date: Mon, 12 Jan 2015 09:41:21 +0300 (AST)
Subject: [squid-users] site cannot be accessed
Message-ID: <1878891668.20418.1421044881847.JavaMail.zimbra@baladia.gov.kw>


Dear All,

I have squid-3.1.10-22.el6_5.x86_64 running on centos 6.5 64 bit for quite sometime and working fine
just a couple of days back some users reported an issue

i have a intranet site which just stopped working .
if I uncheck the proxy option in the browser the site works fine
the above users also use internet and is working fine

I am using the pac file to bypass local sites and the local intranet websites are alredy added in the pac file

also i am quite sure the above intranet website were working before 

the squid log shows 
------------
1421053747.139  70984 172.16.6.21 TCP_MISS/000 0 GET http://10.101.101.10/ - DIRECT/10.101.101.10 -
1421053779.524  32021 172.16.6.21 TCP_MISS/000 0 GET http://10.101.101.10/ - DIRECT/10.101.101.10 -
----------

appreciate your advice and concern

regards

simon

-- 
---------
Network Administrator
Kuwait Municipality!!!

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.



From natxo.asenjo at gmail.com  Mon Jan 12 09:53:44 2015
From: natxo.asenjo at gmail.com (Natxo Asenjo)
Date: Mon, 12 Jan 2015 10:53:44 +0100
Subject: [squid-users] site cannot be accessed
In-Reply-To: <1878891668.20418.1421044881847.JavaMail.zimbra@baladia.gov.kw>
References: <1878891668.20418.1421044881847.JavaMail.zimbra@baladia.gov.kw>
Message-ID: <CAHBEJzXz=1ORBBMmzJrHq5sC82Em2Pcn2xxjbQ0a8UjQXfUeVg@mail.gmail.com>

On Mon, Jan 12, 2015 at 7:41 AM, Simon Dcunha <simon at baladia.gov.kw> wrote:

>
if I uncheck the proxy option in the browser the site works fine
> the above users also use internet and is working fine
>
> I am using the pac file to bypass local sites and the local intranet
> websites are alredy added in the pac file
>
> also i am quite sure the above intranet website were working before
>

There is something wrong with the pac file then, because the intranet sites
are being accessed through the proxy.

I do not use pac files so I cannot help you there, but that is where I
would look now. Good luck!

-- 
regards,
natxo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150112/3ea5e22b/attachment.htm>

From eliezer at ngtech.co.il  Mon Jan 12 10:03:00 2015
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Mon, 12 Jan 2015 12:03:00 +0200
Subject: [squid-users] ssl cert wiki
In-Reply-To: <1421055686052-4669016.post@n4.nabble.com>
References: <1421055686052-4669016.post@n4.nabble.com>
Message-ID: <54B39BD4.2030005@ngtech.co.il>

Just to make sure I understand it right.
The certificate is for a reverse proxy?

Eliezer

On 12/01/2015 11:41, HackXBack wrote:
> hello,
> according to this chapter
> http://wiki.squid-cache.org/ConfigExamples/Reverse/SslWithWildcardCertifiate
> i bought signed  certificate
> but no one accept  rsa:1024
> so i generate the key with rsa:2048
> after i got my crt from them
> https_port 443 cert=/usr/newrprgate/CertAuth/signed.crt
> key=/usr/newrprgate/CertAuth/testkey.pem
>
> but i got error in browser
> Error code: sec_error_inadequate_key_usage
> so what could be the problem ?




From hack.back at hotmail.com  Mon Jan 12 10:12:01 2015
From: hack.back at hotmail.com (HackXBack)
Date: Mon, 12 Jan 2015 02:12:01 -0800 (PST)
Subject: [squid-users] ssl cert wiki
In-Reply-To: <1421055686052-4669016.post@n4.nabble.com>
References: <1421055686052-4669016.post@n4.nabble.com>
Message-ID: <1421057521579-4669020.post@n4.nabble.com>

yes you are right



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/ssl-cert-wiki-tp4669016p4669020.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From shozii1 at yahoo.com  Mon Jan 12 10:18:06 2015
From: shozii1 at yahoo.com (***some text missing***)
Date: Mon, 12 Jan 2015 10:18:06 +0000 (UTC)
Subject: [squid-users] site cannot be accessed
In-Reply-To: <1878891668.20418.1421044881847.JavaMail.zimbra@baladia.gov.kw>
References: <1878891668.20418.1421044881847.JavaMail.zimbra@baladia.gov.kw>
Message-ID: <392294731.845905.1421057886713.JavaMail.yahoo@jws10630.mail.bf1.yahoo.com>


Share your PAC file please.
Regards,Sarfraz??? ?? ?? ?? ?? ?
      From: Simon Dcunha <simon at baladia.gov.kw>
 To: squid-users <squid-users at squid-cache.org> 
 Sent: Monday, January 12, 2015 11:41 AM
 Subject: [squid-users] site cannot be accessed
   

Dear All,

I have squid-3.1.10-22.el6_5.x86_64 running on centos 6.5 64 bit for quite sometime and working fine
just a couple of days back some users reported an issue

i have a intranet site which just stopped working .
if I uncheck the proxy option in the browser the site works fine
the above users also use internet and is working fine

I am using the pac file to bypass local sites and the local intranet websites are alredy added in the pac file

also i am quite sure the above intranet website were working before 

the squid log shows 
------------
1421053747.139? 70984 172.16.6.21 TCP_MISS/000 0 GET http://10.101.101.10/ - DIRECT/10.101.101.10 -
1421053779.524? 32021 172.16.6.21 TCP_MISS/000 0 GET http://10.101.101.10/ - DIRECT/10.101.101.10 -
----------

appreciate your advice and concern

regards

simon

-- 
---------
Network Administrator
Kuwait Municipality!!!

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users


  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150112/f31f0450/attachment.htm>

From eliezer at ngtech.co.il  Mon Jan 12 10:46:35 2015
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Mon, 12 Jan 2015 12:46:35 +0200
Subject: [squid-users] ssl cert wiki
In-Reply-To: <1421055686052-4669016.post@n4.nabble.com>
References: <1421055686052-4669016.post@n4.nabble.com>
Message-ID: <54B3A60B.1080006@ngtech.co.il>

Can you try to use openssl s_client?
an exapmple:
"openssl s_client -connect facebook.com:443"

Eliezer


On 12/01/2015 11:41, HackXBack wrote:
> hello,
> according to this chapter
> http://wiki.squid-cache.org/ConfigExamples/Reverse/SslWithWildcardCertifiate
> i bought signed  certificate
> but no one accept  rsa:1024
> so i generate the key with rsa:2048
> after i got my crt from them
> https_port 443 cert=/usr/newrprgate/CertAuth/signed.crt
> key=/usr/newrprgate/CertAuth/testkey.pem
>
> but i got error in browser
> Error code: sec_error_inadequate_key_usage
> so what could be the problem ?




From hack.back at hotmail.com  Mon Jan 12 10:50:34 2015
From: hack.back at hotmail.com (HackXBack)
Date: Mon, 12 Jan 2015 02:50:34 -0800 (PST)
Subject: [squid-users] ssl cert wiki
In-Reply-To: <54B3A60B.1080006@ngtech.co.il>
References: <1421055686052-4669016.post@n4.nabble.com>
 <54B3A60B.1080006@ngtech.co.il>
Message-ID: <1421059834126-4669023.post@n4.nabble.com>

openssl s_client -connect facebook.com:443
CONNECTED(00000003)
depth=1 C = US, O = DigiCert Inc, OU = www.digicert.com, CN = DigiCert High
Assurance CA-3
verify error:num=20:unable to get local issuer certificate
verify return:0
---
Certificate chain
 0 s:/C=US/ST=CA/L=Menlo Park/O=Facebook, Inc./CN=*.facebook.com
   i:/C=US/O=DigiCert Inc/OU=www.digicert.com/CN=DigiCert High Assurance
CA-3
 1 s:/C=US/O=DigiCert Inc/OU=www.digicert.com/CN=DigiCert High Assurance
CA-3
   i:/C=US/O=DigiCert Inc/OU=www.digicert.com/CN=DigiCert High Assurance EV
Root CA
---
Server certificate
-----BEGIN CERTIFICATE-----
MIIFOzCCBCOgAwIBAgIQAXFSvMdg7cYV3Y5PV8hsDzANBgkqhkiG9w0BAQUFADBm
MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3
d3cuZGlnaWNlcnQuY29tMSUwIwYDVQQDExxEaWdpQ2VydCBIaWdoIEFzc3VyYW5j
ZSBDQS0zMB4XDTE0MDgyODAwMDAwMFoXDTE1MTAyODEyMDAwMFowYTELMAkGA1UE
BhMCVVMxCzAJBgNVBAgTAkNBMRMwEQYDVQQHEwpNZW5sbyBQYXJrMRcwFQYDVQQK
Ew5GYWNlYm9vaywgSW5jLjEXMBUGA1UEAwwOKi5mYWNlYm9vay5jb20wWTATBgcq
hkjOPQIBBggqhkjOPQMBBwNCAATY0d01veJZtvubH1QVjNu/Tli9R764EPwi6dKe
mPhJKiX7lEbkQpmEUBxfAf0UJTFcTtlk/cUMs0bSobxwtIeOo4ICszCCAq8wHwYD
VR0jBBgwFoAUUOpzidsp+xCPnuUBINTeeZlIg/cwHQYDVR0OBBYEFEMJk0D6EUsw
M+zyh26NcRjPiryOMIIBCgYDVR0RBIIBATCB/oIOKi5mYWNlYm9vay5jb22CDGZh
Y2Vib29rLmNvbYILKi5mYnNieC5jb22CCyouZmJjZG4ubmV0gg4qLnh4LmZiY2Ru
Lm5ldIIOKi54eS5mYmNkbi5uZXSCBmZiLmNvbYIIKi5mYi5jb22CGCouZmFjZWJv
b2tjb3Jld3d3aS5vbmlvboIWZmFjZWJvb2tjb3Jld3d3aS5vbmlvboIWZmJjZG4y
M2Rzc3IzanFucS5vbmlvboIWZmJzYngycTRtdmNsNjNwdy5vbmlvboIQKi5tLmZh
Y2Vib29rLmNvbYIPKi5tZXNzZW5nZXIuY29tgg1tZXNzZW5nZXIuY29tMA4GA1Ud
DwEB/wQEAwIDiDAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwYQYDVR0f
BFowWDAqoCigJoYkaHR0cDovL2NybDMuZGlnaWNlcnQuY29tL2NhMy1nMjkuY3Js
MCqgKKAmhiRodHRwOi8vY3JsNC5kaWdpY2VydC5jb20vY2EzLWcyOS5jcmwwQgYD
VR0gBDswOTA3BglghkgBhv1sAQEwKjAoBggrBgEFBQcCARYcaHR0cHM6Ly93d3cu
ZGlnaWNlcnQuY29tL0NQUzB7BggrBgEFBQcBAQRvMG0wJAYIKwYBBQUHMAGGGGh0
dHA6Ly9vY3NwLmRpZ2ljZXJ0LmNvbTBFBggrBgEFBQcwAoY5aHR0cDovL2NhY2Vy
dHMuZGlnaWNlcnQuY29tL0RpZ2lDZXJ0SGlnaEFzc3VyYW5jZUNBLTMuY3J0MAwG
A1UdEwEB/wQCMAAwDQYJKoZIhvcNAQEFBQADggEBAJLCX8dGEOeYrtzO+3yobUf+
2sRpf5JnDPYs/D583ZDvIR2CC1j6BEZu7s0t8F3UwmZyFtYX+oF0eXTk5CK3LPOl
WBEkO0qefB5vuHir2Iwdi3ojSg9FUHNNTKb2nOCv9tIvtSz0ME2J2mGnIQhYjV6i
TnyRl2XAxGHej1uxpFhlHVwom7Bh/jliZGxqsB8s5NDMPByuYFO9lzT9THFvkhab
fCYW/jVGQ7GYVR0xbAXERppKvYAHtuCpoBx26tx/ecO9cG36dGzqSjUefAHqmJML
eSM0nWdjg8K5LolKyUKrrtBRYUIq9DGkROr9LAftTCKs8RZ40Ge3iV/0POlr6FI=
-----END CERTIFICATE-----
subject=/C=US/ST=CA/L=Menlo Park/O=Facebook, Inc./CN=*.facebook.com
issuer=/C=US/O=DigiCert Inc/OU=www.digicert.com/CN=DigiCert High Assurance
CA-3
---
No client certificate CA names sent
---
SSL handshake has read 3459 bytes and written 434 bytes
---
New, TLSv1/SSLv3, Cipher is ECDHE-ECDSA-AES128-GCM-SHA256
Server public key is 256 bit
Secure Renegotiation IS supported
Compression: NONE
Expansion: NONE
SSL-Session:
    Protocol  : TLSv1.2
    Cipher    : ECDHE-ECDSA-AES128-GCM-SHA256
    Session-ID:
3629803712A85282C5F5F7CB236A68B6AD8C7106A03742AFD89B8D3546ED0254
    Session-ID-ctx:
    Master-Key:
50F406618339C5DDD75160F035E874306ADD1A0B786A7B1371467F0EC6259FA78D2678B31083A4EAFC286DB0B6565FBB
    Key-Arg   : None
    PSK identity: None
    PSK identity hint: None
    SRP username: None
    TLS session ticket lifetime hint: 86000 (seconds)
    TLS session ticket:
    0000 - 70 3b 0a 20 e0 1b 8a 09-6c 07 4c 69 a4 9d af 51   p;.
....l.Li...Q
    0010 - 74 d0 0e a9 c2 9d c2 08-17 0c 78 bb 5d ea d8 1a  
t.........x.]...
    0020 - 25 de 4e d1 b8 d1 cd b4-20 7a 8a dc 4a 4c dc e2   %.N.....
z..JL..
    0030 - f6 94 f3 41 4b c3 9e 57-19 30 72 38 2e ea d3 58  
...AK..W.0r8...X
    0040 - 16 c7 de 39 a8 f9 11 80-62 60 87 0d 08 b7 2d 56  
...9....b`....-V
    0050 - 2d 9b 0b ac f7 81 8a 22-bb 42 8b 53 71 d4 26 7a  
-......".B.Sq.&z
    0060 - 8d ef ea 6c de bc d6 2c-15 cc ff 69 3c 34 16 41  
...l...,...i<4.A
    0070 - 3c 2e f7 84 4f b8 a5 7b-35 80 e3 df ee 74 d7 58  
<...O..{5....t.X
    0080 - 38 d3 59 aa 84 03 4c ff-f0 22 ff 04 05 b3 3b a3  
8.Y...L.."....;.
    0090 - 7e f9 ae 9f 07 0b dd 0e-86 71 c7 35 44 6f 3e 80  
~........q.5Do>.
    00a0 - bf 43 2c 4f f1 42 dc 09-a8 34 35 9c 1e be 35 a2  
.C,O.B...45...5.

    Start Time: 1421085027
    Timeout   : 300 (sec)
    Verify return code: 20 (unable to get local issuer certificate)
---





--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/ssl-cert-wiki-tp4669016p4669023.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From yvoinov at gmail.com  Mon Jan 12 10:55:03 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 12 Jan 2015 16:55:03 +0600
Subject: [squid-users] ssl cert wiki
In-Reply-To: <1421059834126-4669023.post@n4.nabble.com>
References: <1421055686052-4669016.post@n4.nabble.com>
 <54B3A60B.1080006@ngtech.co.il> <1421059834126-4669023.post@n4.nabble.com>
Message-ID: <54B3A807.3060002@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
You need to specify -CAPath with trusted root CA's from openssl
installation to avoid error 20. :)

But looks like openssl connect works.

12.01.2015 16:50, HackXBack ?????:
> openssl s_client -connect facebook.com:443
> CONNECTED(00000003)
> depth=1 C = US, O = DigiCert Inc, OU = www.digicert.com, CN = DigiCert
High
> Assurance CA-3
> verify error:num=20:unable to get local issuer certificate
> verify return:0
> ---
> Certificate chain
>  0 s:/C=US/ST=CA/L=Menlo Park/O=Facebook, Inc./CN=*.facebook.com
>    i:/C=US/O=DigiCert Inc/OU=www.digicert.com/CN=DigiCert High Assurance
> CA-3
>  1 s:/C=US/O=DigiCert Inc/OU=www.digicert.com/CN=DigiCert High Assurance
> CA-3
>    i:/C=US/O=DigiCert Inc/OU=www.digicert.com/CN=DigiCert High
Assurance EV
> Root CA
> ---
> Server certificate
> -----BEGIN CERTIFICATE-----
> MIIFOzCCBCOgAwIBAgIQAXFSvMdg7cYV3Y5PV8hsDzANBgkqhkiG9w0BAQUFADBm
> MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3
> d3cuZGlnaWNlcnQuY29tMSUwIwYDVQQDExxEaWdpQ2VydCBIaWdoIEFzc3VyYW5j
> ZSBDQS0zMB4XDTE0MDgyODAwMDAwMFoXDTE1MTAyODEyMDAwMFowYTELMAkGA1UE
> BhMCVVMxCzAJBgNVBAgTAkNBMRMwEQYDVQQHEwpNZW5sbyBQYXJrMRcwFQYDVQQK
> Ew5GYWNlYm9vaywgSW5jLjEXMBUGA1UEAwwOKi5mYWNlYm9vay5jb20wWTATBgcq
> hkjOPQIBBggqhkjOPQMBBwNCAATY0d01veJZtvubH1QVjNu/Tli9R764EPwi6dKe
> mPhJKiX7lEbkQpmEUBxfAf0UJTFcTtlk/cUMs0bSobxwtIeOo4ICszCCAq8wHwYD
> VR0jBBgwFoAUUOpzidsp+xCPnuUBINTeeZlIg/cwHQYDVR0OBBYEFEMJk0D6EUsw
> M+zyh26NcRjPiryOMIIBCgYDVR0RBIIBATCB/oIOKi5mYWNlYm9vay5jb22CDGZh
> Y2Vib29rLmNvbYILKi5mYnNieC5jb22CCyouZmJjZG4ubmV0gg4qLnh4LmZiY2Ru
> Lm5ldIIOKi54eS5mYmNkbi5uZXSCBmZiLmNvbYIIKi5mYi5jb22CGCouZmFjZWJv
> b2tjb3Jld3d3aS5vbmlvboIWZmFjZWJvb2tjb3Jld3d3aS5vbmlvboIWZmJjZG4y
> M2Rzc3IzanFucS5vbmlvboIWZmJzYngycTRtdmNsNjNwdy5vbmlvboIQKi5tLmZh
> Y2Vib29rLmNvbYIPKi5tZXNzZW5nZXIuY29tgg1tZXNzZW5nZXIuY29tMA4GA1Ud
> DwEB/wQEAwIDiDAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwYQYDVR0f
> BFowWDAqoCigJoYkaHR0cDovL2NybDMuZGlnaWNlcnQuY29tL2NhMy1nMjkuY3Js
> MCqgKKAmhiRodHRwOi8vY3JsNC5kaWdpY2VydC5jb20vY2EzLWcyOS5jcmwwQgYD
> VR0gBDswOTA3BglghkgBhv1sAQEwKjAoBggrBgEFBQcCARYcaHR0cHM6Ly93d3cu
> ZGlnaWNlcnQuY29tL0NQUzB7BggrBgEFBQcBAQRvMG0wJAYIKwYBBQUHMAGGGGh0
> dHA6Ly9vY3NwLmRpZ2ljZXJ0LmNvbTBFBggrBgEFBQcwAoY5aHR0cDovL2NhY2Vy
> dHMuZGlnaWNlcnQuY29tL0RpZ2lDZXJ0SGlnaEFzc3VyYW5jZUNBLTMuY3J0MAwG
> A1UdEwEB/wQCMAAwDQYJKoZIhvcNAQEFBQADggEBAJLCX8dGEOeYrtzO+3yobUf+
> 2sRpf5JnDPYs/D583ZDvIR2CC1j6BEZu7s0t8F3UwmZyFtYX+oF0eXTk5CK3LPOl
> WBEkO0qefB5vuHir2Iwdi3ojSg9FUHNNTKb2nOCv9tIvtSz0ME2J2mGnIQhYjV6i
> TnyRl2XAxGHej1uxpFhlHVwom7Bh/jliZGxqsB8s5NDMPByuYFO9lzT9THFvkhab
> fCYW/jVGQ7GYVR0xbAXERppKvYAHtuCpoBx26tx/ecO9cG36dGzqSjUefAHqmJML
> eSM0nWdjg8K5LolKyUKrrtBRYUIq9DGkROr9LAftTCKs8RZ40Ge3iV/0POlr6FI=
> -----END CERTIFICATE-----
> subject=/C=US/ST=CA/L=Menlo Park/O=Facebook, Inc./CN=*.facebook.com
> issuer=/C=US/O=DigiCert Inc/OU=www.digicert.com/CN=DigiCert High Assurance
> CA-3
> ---
> No client certificate CA names sent
> ---
> SSL handshake has read 3459 bytes and written 434 bytes
> ---
> New, TLSv1/SSLv3, Cipher is ECDHE-ECDSA-AES128-GCM-SHA256
> Server public key is 256 bit
> Secure Renegotiation IS supported
> Compression: NONE
> Expansion: NONE
> SSL-Session:
>     Protocol  : TLSv1.2
>     Cipher    : ECDHE-ECDSA-AES128-GCM-SHA256
>     Session-ID:
> 3629803712A85282C5F5F7CB236A68B6AD8C7106A03742AFD89B8D3546ED0254
>     Session-ID-ctx:
>     Master-Key:
>
50F406618339C5DDD75160F035E874306ADD1A0B786A7B1371467F0EC6259FA78D2678B31083A4EAFC286DB0B6565FBB
>     Key-Arg   : None
>     PSK identity: None
>     PSK identity hint: None
>     SRP username: None
>     TLS session ticket lifetime hint: 86000 (seconds)
>     TLS session ticket:
>     0000 - 70 3b 0a 20 e0 1b 8a 09-6c 07 4c 69 a4 9d af 51   p;.
> ....l.Li...Q
>     0010 - 74 d0 0e a9 c2 9d c2 08-17 0c 78 bb 5d ea d8 1a 
> t.........x.]...
>     0020 - 25 de 4e d1 b8 d1 cd b4-20 7a 8a dc 4a 4c dc e2   %.N.....
> z..JL..
>     0030 - f6 94 f3 41 4b c3 9e 57-19 30 72 38 2e ea d3 58 
> ...AK..W.0r8...X
>     0040 - 16 c7 de 39 a8 f9 11 80-62 60 87 0d 08 b7 2d 56 
> ...9....b`....-V
>     0050 - 2d 9b 0b ac f7 81 8a 22-bb 42 8b 53 71 d4 26 7a 
> -......".B.Sq.&z
>     0060 - 8d ef ea 6c de bc d6 2c-15 cc ff 69 3c 34 16 41 
> ...l...,...i<4.A
>     0070 - 3c 2e f7 84 4f b8 a5 7b-35 80 e3 df ee 74 d7 58 
> <...O..{5....t.X
>     0080 - 38 d3 59 aa 84 03 4c ff-f0 22 ff 04 05 b3 3b a3 
> 8.Y...L.."....;.
>     0090 - 7e f9 ae 9f 07 0b dd 0e-86 71 c7 35 44 6f 3e 80 
> ~........q.5Do>.
>     00a0 - bf 43 2c 4f f1 42 dc 09-a8 34 35 9c 1e be 35 a2 
> .C,O.B...45...5.
>
>     Start Time: 1421085027
>     Timeout   : 300 (sec)
>     Verify return code: 20 (unable to get local issuer certificate)
> ---
>
>
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/ssl-cert-wiki-tp4669016p4669023.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUs6gHAAoJENNXIZxhPexGCuMH/irKA7ONKqoZxggAiQERyct+
XtCqaaHkrPMmbq/tCFereYElVXhKwAoZmjaI/lvBOxHE7P4cQqbiOTJoRzyKoD4Q
ek/9vRN/SMbjGSdQNGy73aJDH8vKZg3vcXviO/bvfjbVO3/b7x6eqZdphJvfjCOG
XoEmaWNRP/xe+335Db31ww1mbKOiJChaaJF/Wl460zPPTN+b8yGOyu95rm7Xc6LY
KJELRJ4S/hNEta9o/i8v9sLSSlvAqlgWJgBGW6vNCQ+4pZ3nBhiR5T5dqqekONRy
pJemiS/KRRONrMDPeZiwkinj/EQbO53Hu5lyQ2ANdYcMPNCT3N/z2LVerxCIQj4=
=SC7Z
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150112/f103561f/attachment.htm>

From hack.back at hotmail.com  Mon Jan 12 10:55:05 2015
From: hack.back at hotmail.com (HackXBack)
Date: Mon, 12 Jan 2015 02:55:05 -0800 (PST)
Subject: [squid-users] ssl cert wiki
In-Reply-To: <54B3A807.3060002@gmail.com>
References: <1421055686052-4669016.post@n4.nabble.com>
 <54B3A60B.1080006@ngtech.co.il> <1421059834126-4669023.post@n4.nabble.com>
 <54B3A807.3060002@gmail.com>
Message-ID: <1421060105110-4669025.post@n4.nabble.com>

what you mean by specify -CAPath with trusted root CA's



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/ssl-cert-wiki-tp4669016p4669025.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From yvoinov at gmail.com  Mon Jan 12 11:01:30 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 12 Jan 2015 17:01:30 +0600
Subject: [squid-users] ssl cert wiki
In-Reply-To: <1421060105110-4669025.post@n4.nabble.com>
References: <1421055686052-4669016.post@n4.nabble.com>
 <54B3A60B.1080006@ngtech.co.il> <1421059834126-4669023.post@n4.nabble.com>
 <54B3A807.3060002@gmail.com> <1421060105110-4669025.post@n4.nabble.com>
Message-ID: <54B3A98A.7030403@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
http://i.imgur.com/uFKQz5b.png

You got an error 20 because of your openssl client does not see any CA
certs.

To avoid that need to specify CA's.

openssl s_client -connect facebook.com:443 -CApath
<here_is_path_where_your_openssl_root_CA's_installed>

12.01.2015 16:55, HackXBack ?????:
> what you mean by specify -CAPath with trusted root CA's
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/ssl-cert-wiki-tp4669016p4669025.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUs6mKAAoJENNXIZxhPexGbfUIAMIKMABo2wd8JMFtbja7UxyX
FmpdYrDbOz24S7pOmFAhhvla9XzbtYlMNmr/z/XN5ZZvPIBhv72Uo5YFNG6h/rMa
c6pbPw9Gg3iEv4UQm9ZZWvtpHkGNX6sc0aR0Gx59dRhfxpXHIbOHrceYwAONIYfl
+7hIF4Kx9qQRXmBuw/x2prQHrVVqUuA3r5hhbh9cVfktvoDIcEaV8/z+hdzuhS8k
8vZP60PsoTDuMH8GQrAecJixTVDKvhZcAPJuZzuLIw0L7WLMcmMV2xZVyZ2h3dv7
YUOsVuyiCKE5bdh6DcifAs7p/gQQNdlH9Dx3NYWww4bBXLXI57R7J00VnUV/tzg=
=Vv7Y
-----END PGP SIGNATURE-----



From hack.back at hotmail.com  Mon Jan 12 11:00:03 2015
From: hack.back at hotmail.com (HackXBack)
Date: Mon, 12 Jan 2015 03:00:03 -0800 (PST)
Subject: [squid-users] ssl cert wiki
In-Reply-To: <1421055686052-4669016.post@n4.nabble.com>
References: <1421055686052-4669016.post@n4.nabble.com>
Message-ID: <1421060403756-4669027.post@n4.nabble.com>

in this case the clear question is what https_port line must contain ?




--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/ssl-cert-wiki-tp4669016p4669027.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From eugene at zhegan.in  Mon Jan 12 11:03:17 2015
From: eugene at zhegan.in (Eugene M. Zheganin)
Date: Mon, 12 Jan 2015 16:03:17 +0500
Subject: [squid-users] 3.3.x -> 3.4.x: huge performance regression
In-Reply-To: <CAA7Uhc=efu5SjYw_X4Lp3AY938bAT+5EMOnHsR6xx_oS=0qsuQ@mail.gmail.com>
References: <5447486B.3010205@norma.perm.ru> <5448C7FB.1080104@ngtech.co.il>
 <1FCF9DA5B29068478ECF15896F19F0840138A509A8@Y011008.bk.fin.local>
 <544A4390.3090903@norma.perm.ru> <544A4AD5.6040804@ngtech.co.il>
 <CAFKaCCSS_Mo0MWfxtM_Zp3fs-8iVrZcE7-EaO9x4aC+iVjYn8Q@mail.gmail.com>
 <CAA7UhcmzjjT=nyu-Ep6CUn09-GAE=f2DjEJxS1KQVk3K7zAeqw@mail.gmail.com>
 <544BD4DC.7070900@ngtech.co.il>
 <CAA7UhckbzXbgwT7kVwjm2R=-aeCmX-YwpVxNZZDodWtaorF9BA@mail.gmail.com>
 <CAA7Uhc=efu5SjYw_X4Lp3AY938bAT+5EMOnHsR6xx_oS=0qsuQ@mail.gmail.com>
Message-ID: <54B3A9F5.5050804@zhegan.in>

Hi.

Just to point this out in the correct thread - to all the people who
replied here - Steve Hill has provided a patch for a 3.4.x that solves
the most performance degradation issue. 3.4.x is still performing poorly
comparing to the 3.3.x branch, but I guess this is due to major code
changes. As of now my largest production installation (1.2K clients,
300-400 active usernames) is running 3.4.9.

Thanks.
Eugene.



From hack.back at hotmail.com  Mon Jan 12 11:02:19 2015
From: hack.back at hotmail.com (HackXBack)
Date: Mon, 12 Jan 2015 03:02:19 -0800 (PST)
Subject: [squid-users] ssl cert wiki
In-Reply-To: <54B3A98A.7030403@gmail.com>
References: <1421055686052-4669016.post@n4.nabble.com>
 <54B3A60B.1080006@ngtech.co.il> <1421059834126-4669023.post@n4.nabble.com>
 <54B3A807.3060002@gmail.com> <1421060105110-4669025.post@n4.nabble.com>
 <54B3A98A.7030403@gmail.com>
Message-ID: <1421060539233-4669029.post@n4.nabble.com>

openssl s_client -connect facebook.com:443 -CApath /var/squid/ssl_db/certs
CONNECTED(00000003)
depth=2 C = US, O = DigiCert Inc, OU = www.digicert.com, CN = DigiCert High
Assurance EV Root CA
verify return:1
depth=1 C = US, O = DigiCert Inc, OU = www.digicert.com, CN = DigiCert High
Assurance CA-3
verify return:1
depth=0 C = US, ST = CA, L = Menlo Park, O = "Facebook, Inc.", CN =
*.facebook.com
verify return:1
---
Certificate chain
 0 s:/C=US/ST=CA/L=Menlo Park/O=Facebook, Inc./CN=*.facebook.com
   i:/C=US/O=DigiCert Inc/OU=www.digicert.com/CN=DigiCert High Assurance
CA-3
 1 s:/C=US/O=DigiCert Inc/OU=www.digicert.com/CN=DigiCert High Assurance
CA-3
   i:/C=US/O=DigiCert Inc/OU=www.digicert.com/CN=DigiCert High Assurance EV
Root CA
---
Server certificate
-----BEGIN CERTIFICATE-----
MIIFOzCCBCOgAwIBAgIQAXFSvMdg7cYV3Y5PV8hsDzANBgkqhkiG9w0BAQUFADBm
MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3
d3cuZGlnaWNlcnQuY29tMSUwIwYDVQQDExxEaWdpQ2VydCBIaWdoIEFzc3VyYW5j
ZSBDQS0zMB4XDTE0MDgyODAwMDAwMFoXDTE1MTAyODEyMDAwMFowYTELMAkGA1UE
BhMCVVMxCzAJBgNVBAgTAkNBMRMwEQYDVQQHEwpNZW5sbyBQYXJrMRcwFQYDVQQK
Ew5GYWNlYm9vaywgSW5jLjEXMBUGA1UEAwwOKi5mYWNlYm9vay5jb20wWTATBgcq
hkjOPQIBBggqhkjOPQMBBwNCAATY0d01veJZtvubH1QVjNu/Tli9R764EPwi6dKe
mPhJKiX7lEbkQpmEUBxfAf0UJTFcTtlk/cUMs0bSobxwtIeOo4ICszCCAq8wHwYD
VR0jBBgwFoAUUOpzidsp+xCPnuUBINTeeZlIg/cwHQYDVR0OBBYEFEMJk0D6EUsw
M+zyh26NcRjPiryOMIIBCgYDVR0RBIIBATCB/oIOKi5mYWNlYm9vay5jb22CDGZh
Y2Vib29rLmNvbYILKi5mYnNieC5jb22CCyouZmJjZG4ubmV0gg4qLnh4LmZiY2Ru
Lm5ldIIOKi54eS5mYmNkbi5uZXSCBmZiLmNvbYIIKi5mYi5jb22CGCouZmFjZWJv
b2tjb3Jld3d3aS5vbmlvboIWZmFjZWJvb2tjb3Jld3d3aS5vbmlvboIWZmJjZG4y
M2Rzc3IzanFucS5vbmlvboIWZmJzYngycTRtdmNsNjNwdy5vbmlvboIQKi5tLmZh
Y2Vib29rLmNvbYIPKi5tZXNzZW5nZXIuY29tgg1tZXNzZW5nZXIuY29tMA4GA1Ud
DwEB/wQEAwIDiDAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwYQYDVR0f
BFowWDAqoCigJoYkaHR0cDovL2NybDMuZGlnaWNlcnQuY29tL2NhMy1nMjkuY3Js
MCqgKKAmhiRodHRwOi8vY3JsNC5kaWdpY2VydC5jb20vY2EzLWcyOS5jcmwwQgYD
VR0gBDswOTA3BglghkgBhv1sAQEwKjAoBggrBgEFBQcCARYcaHR0cHM6Ly93d3cu
ZGlnaWNlcnQuY29tL0NQUzB7BggrBgEFBQcBAQRvMG0wJAYIKwYBBQUHMAGGGGh0
dHA6Ly9vY3NwLmRpZ2ljZXJ0LmNvbTBFBggrBgEFBQcwAoY5aHR0cDovL2NhY2Vy
dHMuZGlnaWNlcnQuY29tL0RpZ2lDZXJ0SGlnaEFzc3VyYW5jZUNBLTMuY3J0MAwG
A1UdEwEB/wQCMAAwDQYJKoZIhvcNAQEFBQADggEBAJLCX8dGEOeYrtzO+3yobUf+
2sRpf5JnDPYs/D583ZDvIR2CC1j6BEZu7s0t8F3UwmZyFtYX+oF0eXTk5CK3LPOl
WBEkO0qefB5vuHir2Iwdi3ojSg9FUHNNTKb2nOCv9tIvtSz0ME2J2mGnIQhYjV6i
TnyRl2XAxGHej1uxpFhlHVwom7Bh/jliZGxqsB8s5NDMPByuYFO9lzT9THFvkhab
fCYW/jVGQ7GYVR0xbAXERppKvYAHtuCpoBx26tx/ecO9cG36dGzqSjUefAHqmJML
eSM0nWdjg8K5LolKyUKrrtBRYUIq9DGkROr9LAftTCKs8RZ40Ge3iV/0POlr6FI=
-----END CERTIFICATE-----
subject=/C=US/ST=CA/L=Menlo Park/O=Facebook, Inc./CN=*.facebook.com
issuer=/C=US/O=DigiCert Inc/OU=www.digicert.com/CN=DigiCert High Assurance
CA-3
---
No client certificate CA names sent
---
SSL handshake has read 3458 bytes and written 434 bytes
---
New, TLSv1/SSLv3, Cipher is ECDHE-ECDSA-AES128-GCM-SHA256
Server public key is 256 bit
Secure Renegotiation IS supported
Compression: NONE
Expansion: NONE
SSL-Session:
    Protocol  : TLSv1.2
    Cipher    : ECDHE-ECDSA-AES128-GCM-SHA256
    Session-ID:
7889C9EF07503180C1460C0FED8AD06672776F9E89CE7246B932EF762B64116A
    Session-ID-ctx:
    Master-Key:
1B524B777BFC4D636D9C0A2BE1A89E58EB50B7C3B405CA4E0BF575B9119AD6CD858C0DD2B1ADC6AB617361CA29CC0938
    Key-Arg   : None
    PSK identity: None
    PSK identity hint: None
    SRP username: None
    TLS session ticket lifetime hint: 86000 (seconds)
    TLS session ticket:
    0000 - 70 3b 0a 20 10 0d 49 b8-dc d4 e7 d6 60 9e 86 49   p;.
..I.....`..I
    0010 - f3 28 e5 e5 e5 5a fd d6-43 54 88 7f b5 52 24 30  
.(...Z..CT...R$0
    0020 - 93 ea 69 3c 67 56 1d 74-ac b6 f2 b9 af 9e 44 ea  
..i<gV.t......D.
    0030 - 1e a1 83 73 bb 77 1b 0d-9f 25 f4 bc 28 cf e8 0b  
...s.w...%..(...
    0040 - bb b1 bc 24 0a c2 eb b2-27 e2 e1 e2 63 c3 ee d5  
...$....'...c...
    0050 - 84 84 d0 a1 1c 65 e4 ae-11 11 56 66 24 81 30 7c  
.....e....Vf$.0|
    0060 - 5e 4f 02 f4 88 b1 e8 be-c9 ef 29 77 c7 ea 65 16  
^O........)w..e.
    0070 - dd 6b 58 2a 2c 12 f3 2e-39 1e 85 e9 41 43 54 9b  
.kX*,...9...ACT.
    0080 - 5c e1 f1 81 0d 85 6d e5-a1 4d dc 19 91 d1 51 c3  
\.....m..M....Q.
    0090 - 1b 8c e9 de 16 39 cb 10-ec 23 75 8c 41 d1 33 55  
.....9...#u.A.3U
    00a0 - 19 ff 10 4b bf 26 f1 4d-ff 3d 57 94 1a b8 07 3c  
...K.&.M.=W....<

    Start Time: 1421085813
    Timeout   : 300 (sec)
    Verify return code: 0 (ok)
---




--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/ssl-cert-wiki-tp4669016p4669029.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From yvoinov at gmail.com  Mon Jan 12 11:05:39 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 12 Jan 2015 17:05:39 +0600
Subject: [squid-users] ssl cert wiki
In-Reply-To: <1421060539233-4669029.post@n4.nabble.com>
References: <1421055686052-4669016.post@n4.nabble.com>
 <54B3A60B.1080006@ngtech.co.il> <1421059834126-4669023.post@n4.nabble.com>
 <54B3A807.3060002@gmail.com> <1421060105110-4669025.post@n4.nabble.com>
 <54B3A98A.7030403@gmail.com> <1421060539233-4669029.post@n4.nabble.com>
Message-ID: <54B3AA83.9040102@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Yep, openssl is ok and works.

12.01.2015 17:02, HackXBack ?????:
> openssl s_client -connect facebook.com:443 -CApath /var/squid/ssl_db/certs
> CONNECTED(00000003)
> depth=2 C = US, O = DigiCert Inc, OU = www.digicert.com, CN = DigiCert
High
> Assurance EV Root CA
> verify return:1
> depth=1 C = US, O = DigiCert Inc, OU = www.digicert.com, CN = DigiCert
High
> Assurance CA-3
> verify return:1
> depth=0 C = US, ST = CA, L = Menlo Park, O = "Facebook, Inc.", CN =
> *.facebook.com
> verify return:1
> ---
> Certificate chain
>  0 s:/C=US/ST=CA/L=Menlo Park/O=Facebook, Inc./CN=*.facebook.com
>    i:/C=US/O=DigiCert Inc/OU=www.digicert.com/CN=DigiCert High Assurance
> CA-3
>  1 s:/C=US/O=DigiCert Inc/OU=www.digicert.com/CN=DigiCert High Assurance
> CA-3
>    i:/C=US/O=DigiCert Inc/OU=www.digicert.com/CN=DigiCert High
Assurance EV
> Root CA
> ---
> Server certificate
> -----BEGIN CERTIFICATE-----
> MIIFOzCCBCOgAwIBAgIQAXFSvMdg7cYV3Y5PV8hsDzANBgkqhkiG9w0BAQUFADBm
> MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3
> d3cuZGlnaWNlcnQuY29tMSUwIwYDVQQDExxEaWdpQ2VydCBIaWdoIEFzc3VyYW5j
> ZSBDQS0zMB4XDTE0MDgyODAwMDAwMFoXDTE1MTAyODEyMDAwMFowYTELMAkGA1UE
> BhMCVVMxCzAJBgNVBAgTAkNBMRMwEQYDVQQHEwpNZW5sbyBQYXJrMRcwFQYDVQQK
> Ew5GYWNlYm9vaywgSW5jLjEXMBUGA1UEAwwOKi5mYWNlYm9vay5jb20wWTATBgcq
> hkjOPQIBBggqhkjOPQMBBwNCAATY0d01veJZtvubH1QVjNu/Tli9R764EPwi6dKe
> mPhJKiX7lEbkQpmEUBxfAf0UJTFcTtlk/cUMs0bSobxwtIeOo4ICszCCAq8wHwYD
> VR0jBBgwFoAUUOpzidsp+xCPnuUBINTeeZlIg/cwHQYDVR0OBBYEFEMJk0D6EUsw
> M+zyh26NcRjPiryOMIIBCgYDVR0RBIIBATCB/oIOKi5mYWNlYm9vay5jb22CDGZh
> Y2Vib29rLmNvbYILKi5mYnNieC5jb22CCyouZmJjZG4ubmV0gg4qLnh4LmZiY2Ru
> Lm5ldIIOKi54eS5mYmNkbi5uZXSCBmZiLmNvbYIIKi5mYi5jb22CGCouZmFjZWJv
> b2tjb3Jld3d3aS5vbmlvboIWZmFjZWJvb2tjb3Jld3d3aS5vbmlvboIWZmJjZG4y
> M2Rzc3IzanFucS5vbmlvboIWZmJzYngycTRtdmNsNjNwdy5vbmlvboIQKi5tLmZh
> Y2Vib29rLmNvbYIPKi5tZXNzZW5nZXIuY29tgg1tZXNzZW5nZXIuY29tMA4GA1Ud
> DwEB/wQEAwIDiDAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwYQYDVR0f
> BFowWDAqoCigJoYkaHR0cDovL2NybDMuZGlnaWNlcnQuY29tL2NhMy1nMjkuY3Js
> MCqgKKAmhiRodHRwOi8vY3JsNC5kaWdpY2VydC5jb20vY2EzLWcyOS5jcmwwQgYD
> VR0gBDswOTA3BglghkgBhv1sAQEwKjAoBggrBgEFBQcCARYcaHR0cHM6Ly93d3cu
> ZGlnaWNlcnQuY29tL0NQUzB7BggrBgEFBQcBAQRvMG0wJAYIKwYBBQUHMAGGGGh0
> dHA6Ly9vY3NwLmRpZ2ljZXJ0LmNvbTBFBggrBgEFBQcwAoY5aHR0cDovL2NhY2Vy
> dHMuZGlnaWNlcnQuY29tL0RpZ2lDZXJ0SGlnaEFzc3VyYW5jZUNBLTMuY3J0MAwG
> A1UdEwEB/wQCMAAwDQYJKoZIhvcNAQEFBQADggEBAJLCX8dGEOeYrtzO+3yobUf+
> 2sRpf5JnDPYs/D583ZDvIR2CC1j6BEZu7s0t8F3UwmZyFtYX+oF0eXTk5CK3LPOl
> WBEkO0qefB5vuHir2Iwdi3ojSg9FUHNNTKb2nOCv9tIvtSz0ME2J2mGnIQhYjV6i
> TnyRl2XAxGHej1uxpFhlHVwom7Bh/jliZGxqsB8s5NDMPByuYFO9lzT9THFvkhab
> fCYW/jVGQ7GYVR0xbAXERppKvYAHtuCpoBx26tx/ecO9cG36dGzqSjUefAHqmJML
> eSM0nWdjg8K5LolKyUKrrtBRYUIq9DGkROr9LAftTCKs8RZ40Ge3iV/0POlr6FI=
> -----END CERTIFICATE-----
> subject=/C=US/ST=CA/L=Menlo Park/O=Facebook, Inc./CN=*.facebook.com
> issuer=/C=US/O=DigiCert Inc/OU=www.digicert.com/CN=DigiCert High Assurance
> CA-3
> ---
> No client certificate CA names sent
> ---
> SSL handshake has read 3458 bytes and written 434 bytes
> ---
> New, TLSv1/SSLv3, Cipher is ECDHE-ECDSA-AES128-GCM-SHA256
> Server public key is 256 bit
> Secure Renegotiation IS supported
> Compression: NONE
> Expansion: NONE
> SSL-Session:
>     Protocol  : TLSv1.2
>     Cipher    : ECDHE-ECDSA-AES128-GCM-SHA256
>     Session-ID:
> 7889C9EF07503180C1460C0FED8AD06672776F9E89CE7246B932EF762B64116A
>     Session-ID-ctx:
>     Master-Key:
>
1B524B777BFC4D636D9C0A2BE1A89E58EB50B7C3B405CA4E0BF575B9119AD6CD858C0DD2B1ADC6AB617361CA29CC0938
>     Key-Arg   : None
>     PSK identity: None
>     PSK identity hint: None
>     SRP username: None
>     TLS session ticket lifetime hint: 86000 (seconds)
>     TLS session ticket:
>     0000 - 70 3b 0a 20 10 0d 49 b8-dc d4 e7 d6 60 9e 86 49   p;.
> ..I.....`..I
>     0010 - f3 28 e5 e5 e5 5a fd d6-43 54 88 7f b5 52 24 30 
> .(...Z..CT...R$0
>     0020 - 93 ea 69 3c 67 56 1d 74-ac b6 f2 b9 af 9e 44 ea 
> ..i<gV.t......D.
>     0030 - 1e a1 83 73 bb 77 1b 0d-9f 25 f4 bc 28 cf e8 0b 
> ...s.w...%..(...
>     0040 - bb b1 bc 24 0a c2 eb b2-27 e2 e1 e2 63 c3 ee d5 
> ...$....'...c...
>     0050 - 84 84 d0 a1 1c 65 e4 ae-11 11 56 66 24 81 30 7c 
> .....e....Vf$.0|
>     0060 - 5e 4f 02 f4 88 b1 e8 be-c9 ef 29 77 c7 ea 65 16 
> ^O........)w..e.
>     0070 - dd 6b 58 2a 2c 12 f3 2e-39 1e 85 e9 41 43 54 9b 
> .kX*,...9...ACT.
>     0080 - 5c e1 f1 81 0d 85 6d e5-a1 4d dc 19 91 d1 51 c3 
> \.....m..M....Q.
>     0090 - 1b 8c e9 de 16 39 cb 10-ec 23 75 8c 41 d1 33 55 
> .....9...#u.A.3U
>     00a0 - 19 ff 10 4b bf 26 f1 4d-ff 3d 57 94 1a b8 07 3c 
> ...K.&.M.=W....<
>
>     Start Time: 1421085813
>     Timeout   : 300 (sec)
>     Verify return code: 0 (ok)
> ---
>
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/ssl-cert-wiki-tp4669016p4669029.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUs6qDAAoJENNXIZxhPexGclQH/2gg5FGwO1hiFB8r+gCrk2vr
Vyz6tDX3wecDsQM/IZQnvmp04q6t+3cghIb8kTUo8sUnx2yMOoj+Xe9G333lrAgI
P9SE85uqGCtAWDMezSwSCqtaB7q1NUefmQGB73DdGOKzzm7tW+frCop6qbdK0rF9
SSWrc3C2ezIACOa7X3I185LLsUBkDEIylBcxEDf1g+bDo6LCK58NxOejOjeL9do6
Y7Kz4sANs4d2m29NCW4dc5fpqoR/lBIQJe+7fqJPyl1/PFJATnSpUkKiBy/MG6/H
a7IKtWam+w6sAtj4qBIdm1SUG8oKBoONjWFsxE47NuL3xFc22mmzUoE3DZFVcYA=
=W3Y2
-----END PGP SIGNATURE-----



From eliezer at ngtech.co.il  Mon Jan 12 11:05:48 2015
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Mon, 12 Jan 2015 13:05:48 +0200
Subject: [squid-users] ssl cert wiki
In-Reply-To: <1421060539233-4669029.post@n4.nabble.com>
References: <1421055686052-4669016.post@n4.nabble.com>
 <54B3A60B.1080006@ngtech.co.il> <1421059834126-4669023.post@n4.nabble.com>
 <54B3A807.3060002@gmail.com> <1421060105110-4669025.post@n4.nabble.com>
 <54B3A98A.7030403@gmail.com> <1421060539233-4669029.post@n4.nabble.com>
Message-ID: <54B3AA8C.3000301@ngtech.co.il>

Are you using the command with facebook.com???
You should use your own server...

Eliezer

On 12/01/2015 13:02, HackXBack wrote:
> openssl s_client -connect facebook.com:443 -CApath /var/squid/ssl_db/certs
> CONNECTED(00000003)
> depth=2 C = US, O = DigiCert Inc, OU =www.digicert.com, CN = DigiCert High
> Assurance EV Root CA
> verify return:1
> depth=1 C = US, O = DigiCert Inc, OU =www.digicert.com, CN = DigiCert High
> Assurance CA-3
> verify return:1
> depth=0 C = US, ST = CA, L = Menlo Park, O = "Facebook, Inc.", CN =
> *.facebook.com
> verify return:1




From hack.back at hotmail.com  Mon Jan 12 11:05:10 2015
From: hack.back at hotmail.com (HackXBack)
Date: Mon, 12 Jan 2015 03:05:10 -0800 (PST)
Subject: [squid-users] ssl cert wiki
In-Reply-To: <54B3AA83.9040102@gmail.com>
References: <1421055686052-4669016.post@n4.nabble.com>
 <54B3A60B.1080006@ngtech.co.il> <1421059834126-4669023.post@n4.nabble.com>
 <54B3A807.3060002@gmail.com> <1421060105110-4669025.post@n4.nabble.com>
 <54B3A98A.7030403@gmail.com> <1421060539233-4669029.post@n4.nabble.com>
 <54B3AA83.9040102@gmail.com>
Message-ID: <1421060710890-4669032.post@n4.nabble.com>

okay great so what is my issue ?



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/ssl-cert-wiki-tp4669016p4669032.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From hack.back at hotmail.com  Mon Jan 12 11:07:28 2015
From: hack.back at hotmail.com (HackXBack)
Date: Mon, 12 Jan 2015 03:07:28 -0800 (PST)
Subject: [squid-users] ssl cert wiki
In-Reply-To: <1421060710890-4669032.post@n4.nabble.com>
References: <1421055686052-4669016.post@n4.nabble.com>
 <54B3A60B.1080006@ngtech.co.il> <1421059834126-4669023.post@n4.nabble.com>
 <54B3A807.3060002@gmail.com> <1421060105110-4669025.post@n4.nabble.com>
 <54B3A98A.7030403@gmail.com> <1421060539233-4669029.post@n4.nabble.com>
 <54B3AA83.9040102@gmail.com> <1421060710890-4669032.post@n4.nabble.com>
Message-ID: <1421060848926-4669033.post@n4.nabble.com>

i dont know where you take me but my problem is not in any command !
i used trusted cert that got it from trusted CA
but when i use it in https_port the browser give error like i mentioned in
my first post



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/ssl-cert-wiki-tp4669016p4669033.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From yvoinov at gmail.com  Mon Jan 12 11:16:32 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 12 Jan 2015 17:16:32 +0600
Subject: [squid-users] ssl cert wiki
In-Reply-To: <1421060848926-4669033.post@n4.nabble.com>
References: <1421055686052-4669016.post@n4.nabble.com>
 <54B3A60B.1080006@ngtech.co.il> <1421059834126-4669023.post@n4.nabble.com>
 <54B3A807.3060002@gmail.com> <1421060105110-4669025.post@n4.nabble.com>
 <54B3A98A.7030403@gmail.com> <1421060539233-4669029.post@n4.nabble.com>
 <54B3AA83.9040102@gmail.com> <1421060710890-4669032.post@n4.nabble.com>
 <1421060848926-4669033.post@n4.nabble.com>
Message-ID: <54B3AD10.1080809@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
May I take a look on your squid.conf?

Looks like you incorrect configure your proxy.

12.01.2015 17:07, HackXBack ?????:
> i dont know where you take me but my problem is not in any command !
> i used trusted cert that got it from trusted CA
> but when i use it in https_port the browser give error like i mentioned in
> my first post
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/ssl-cert-wiki-tp4669016p4669033.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUs60QAAoJENNXIZxhPexGrxMH/RLL6UL/8CEoBGmLHYd0pXrP
QxhZYUtJAbYfSLvufzVRiFpzw2mrBquSTx6MZXKFoociJ4Q0gZAf4JCSqeVJTymB
O8/mxoD1tnUdx9GBMbNNztrR1eedvXRS+VurVHSRO5Ga9vl7FXJ7PBwj+RL0JN8N
XRQq0RYRHA80vU6MMyHjl5PuJa/qeZcjsq8qNsiK7Z3TbD32jBMWKfNH4scfOrDw
8qIE/Ev0z0x3iEZduzgU8FvEhNVF95oSvW7zyZeN79vDC0kxZoY4Ns590eF9pDoS
vYNgBRJCKR10N0CIrUIQW1MksYTp2AEg4v7eII+6hJka/7wO6+K/dbHSToqx1os=
=i5G9
-----END PGP SIGNATURE-----



From hack.back at hotmail.com  Mon Jan 12 11:20:03 2015
From: hack.back at hotmail.com (HackXBack)
Date: Mon, 12 Jan 2015 03:20:03 -0800 (PST)
Subject: [squid-users] ssl cert wiki
In-Reply-To: <54B3AD10.1080809@gmail.com>
References: <54B3A60B.1080006@ngtech.co.il>
 <1421059834126-4669023.post@n4.nabble.com> <54B3A807.3060002@gmail.com>
 <1421060105110-4669025.post@n4.nabble.com> <54B3A98A.7030403@gmail.com>
 <1421060539233-4669029.post@n4.nabble.com> <54B3AA83.9040102@gmail.com>
 <1421060710890-4669032.post@n4.nabble.com>
 <1421060848926-4669033.post@n4.nabble.com> <54B3AD10.1080809@gmail.com>
Message-ID: <1421061603806-4669035.post@n4.nabble.com>

https_port 3127 intercept ssl-bump generate-host-certificates=on
dynamic_cert_mem_cache_size=4MB cert=/etc/squid/ssl_cert/CA.pem
key=/etc/squid/ssl_cert/testkey.pem
http_port  3129
http_port  3128 intercept



where CA.pem is from trusted CA authoroties



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/ssl-cert-wiki-tp4669016p4669035.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From yvoinov at gmail.com  Mon Jan 12 11:28:41 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 12 Jan 2015 17:28:41 +0600
Subject: [squid-users] ssl cert wiki
In-Reply-To: <1421061603806-4669035.post@n4.nabble.com>
References: <54B3A60B.1080006@ngtech.co.il>
 <1421059834126-4669023.post@n4.nabble.com> <54B3A807.3060002@gmail.com>
 <1421060105110-4669025.post@n4.nabble.com> <54B3A98A.7030403@gmail.com>
 <1421060539233-4669029.post@n4.nabble.com> <54B3AA83.9040102@gmail.com>
 <1421060710890-4669032.post@n4.nabble.com>
 <1421060848926-4669033.post@n4.nabble.com> <54B3AD10.1080809@gmail.com>
 <1421061603806-4669035.post@n4.nabble.com>
Message-ID: <54B3AFE9.3010701@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
The similar like me config. It is HTTP/HTTPS interception proxy, right?

Try to create your own self-signed CA certificate (without CN field,
leave it empty), and try to connect via browser. Don't forget to install
publick key from your certificate to browser.


12.01.2015 17:20, HackXBack ?????:
> https_port 3127 intercept ssl-bump generate-host-certificates=on
> dynamic_cert_mem_cache_size=4MB cert=/etc/squid/ssl_cert/CA.pem
> key=/etc/squid/ssl_cert/testkey.pem
> http_port  3129
> http_port  3128 intercept
>
>
>
> where CA.pem is from trusted CA authoroties
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/ssl-cert-wiki-tp4669016p4669035.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUs6/pAAoJENNXIZxhPexGq64H/0GZj3Pq4l2IUl8IpvHCwYif
5RfvArlNnuVIuD7xsz+ycFrGXTTnv+BzMiB7jVth7a+IlQ/Nk1ED3kW2wySrCGDC
nCa8D2EFFG+grik0Aa89mZjfN4voj4v+6DqiLgXMecX2bj6civ6xziEcaypKefKr
ukkiZUvPSlkku2HtHkyZd+P/myP+YLpJJ1Iufye9/flnmk6fozo9uWaCpYe44pwt
YpRXjTEztxJxiOzS4uePnM3NCUd8TimVlTO29TwkU4CZaK4ReoNBQerunidOUIxJ
W7kAq+vGEpje/OZDKzo5sS5sR+yF5cDJ3mWJMdiCS7LGsYCR5TgvWn5MZ43iLmk=
=C7yc
-----END PGP SIGNATURE-----



From hack.back at hotmail.com  Mon Jan 12 11:28:09 2015
From: hack.back at hotmail.com (HackXBack)
Date: Mon, 12 Jan 2015 03:28:09 -0800 (PST)
Subject: [squid-users] ssl cert wiki
In-Reply-To: <54B3AFE9.3010701@gmail.com>
References: <54B3A807.3060002@gmail.com>
 <1421060105110-4669025.post@n4.nabble.com> <54B3A98A.7030403@gmail.com>
 <1421060539233-4669029.post@n4.nabble.com> <54B3AA83.9040102@gmail.com>
 <1421060710890-4669032.post@n4.nabble.com>
 <1421060848926-4669033.post@n4.nabble.com> <54B3AD10.1080809@gmail.com>
 <1421061603806-4669035.post@n4.nabble.com> <54B3AFE9.3010701@gmail.com>
Message-ID: <1421062089504-4669037.post@n4.nabble.com>

if it is self-signed CA certificate + import to browser
then it will worked
but if it is Trusted CA cert it giving me error like i said in first post



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/ssl-cert-wiki-tp4669016p4669037.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From yvoinov at gmail.com  Mon Jan 12 11:33:47 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 12 Jan 2015 17:33:47 +0600
Subject: [squid-users] ssl cert wiki
In-Reply-To: <1421062089504-4669037.post@n4.nabble.com>
References: <54B3A807.3060002@gmail.com>
 <1421060105110-4669025.post@n4.nabble.com> <54B3A98A.7030403@gmail.com>
 <1421060539233-4669029.post@n4.nabble.com> <54B3AA83.9040102@gmail.com>
 <1421060710890-4669032.post@n4.nabble.com>
 <1421060848926-4669033.post@n4.nabble.com> <54B3AD10.1080809@gmail.com>
 <1421061603806-4669035.post@n4.nabble.com> <54B3AFE9.3010701@gmail.com>
 <1421062089504-4669037.post@n4.nabble.com>
Message-ID: <54B3B11B.1090803@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
AFAIK,

you can't be use SERVER certificate (almost signed trusted CA) for SSL
bumping. You need root CA exactly. Self-signed root CA.


12.01.2015 17:28, HackXBack ?????:
> if it is self-signed CA certificate + import to browser
> then it will worked
> but if it is Trusted CA cert it giving me error like i said in first post
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/ssl-cert-wiki-tp4669016p4669037.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUs7EaAAoJENNXIZxhPexG79wIALm1VlLikdmesRdPRF5KdVDs
f35RAwsisSQo/r8gFsjGYE5UV5sHWukP12xXgMfeAqwxS7F6TuTdQuiz4zQGKcJH
VASZ84kcM6QBCRTXEBahm4qO/H4RC/E5SvSk22plNmMeEMYuyCa0CHuXNCW4kXAI
HdbM7t07dloj3qvNKkmzoaDcSio0NkuqGsm30cEcXiNEqnlgJySnGmilptCma7DN
LeJwRoUiBRdxEie4/s8uAOjvFZFUIX1QcH613KRxxm/qcOC/5im/PFw2HZXxuyRI
WKZ2CSswJhip23BP5AA2A0z0Fv4Gpi4NnG8ii3FtnZFbl1Qn6Hcy6tRkJfUoi1k=
=2d0o
-----END PGP SIGNATURE-----



From eugene at zhegan.in  Mon Jan 12 11:35:48 2015
From: eugene at zhegan.in (Eugene M. Zheganin)
Date: Mon, 12 Jan 2015 16:35:48 +0500
Subject: [squid-users] 3.3.x -> 3.4.x: huge performance regression
In-Reply-To: <54B3A9F5.5050804@zhegan.in>
References: <5447486B.3010205@norma.perm.ru> <5448C7FB.1080104@ngtech.co.il>
 <1FCF9DA5B29068478ECF15896F19F0840138A509A8@Y011008.bk.fin.local>
 <544A4390.3090903@norma.perm.ru> <544A4AD5.6040804@ngtech.co.il>
 <CAFKaCCSS_Mo0MWfxtM_Zp3fs-8iVrZcE7-EaO9x4aC+iVjYn8Q@mail.gmail.com>
 <CAA7UhcmzjjT=nyu-Ep6CUn09-GAE=f2DjEJxS1KQVk3K7zAeqw@mail.gmail.com>
 <544BD4DC.7070900@ngtech.co.il>
 <CAA7UhckbzXbgwT7kVwjm2R=-aeCmX-YwpVxNZZDodWtaorF9BA@mail.gmail.com>
 <CAA7Uhc=efu5SjYw_X4Lp3AY938bAT+5EMOnHsR6xx_oS=0qsuQ@mail.gmail.com>
 <54B3A9F5.5050804@zhegan.in>
Message-ID: <54B3B194.6030408@zhegan.in>

Hi.

On 12.01.2015 16:03, Eugene M. Zheganin wrote:
> Hi.
>
> Just to point this out in the correct thread - to all the people who
> replied here - Steve Hill has provided a patch for a 3.4.x that solves
> the most performance degradation issue. 3.4.x is still performing poorly
> comparing to the 3.3.x branch, but I guess this is due to major code
> changes. As of now my largest production installation (1.2K clients,
> 300-400 active usernames) is running 3.4.9.
... and massively leaking, yeah.

Eugene.


From eugene at zhegan.in  Mon Jan 12 11:41:55 2015
From: eugene at zhegan.in (Eugene M. Zheganin)
Date: Mon, 12 Jan 2015 16:41:55 +0500
Subject: [squid-users] Memory Leak Squid 3.4.9 on FreeBSD 10.0 x64
In-Reply-To: <54AF2B06.6030505@treenet.co.nz>
References: <86iogtp7ao.fsf@gmail.com>
 <E6B2517F8D6DBF4CABB8F38ACA367E78343B4E87@Draco.dawnsign.com>
 <54AF2B06.6030505@treenet.co.nz>
Message-ID: <54B3B303.2080906@zhegan.in>

Hi.

On 09.01.2015 06:12, Amos Jeffries wrote:
> Grand total:
>   => 9.5 GB of RAM just for Squid.
>
> .. then there is whatever memory the helper programs, other software
> on the server and operating system all need.
>
I'm now also having a strong impression that squid is leaking memory.
Now, when 3.4.x is able to handle hundreds of users during several hours
I notice that it's memory usage is constantly increasing. My patience
always ends at the point of 1.5 Gigs memory usage, where server memory
starts to be exhausted (squid is running with lots of other stuff) and I
restart it. This is happening on exactly the same config the 3.3.13 was
running, so ... I have cache_mem set to 512 megs, diskd, medium sized
cache_dir and lots of users. Is something changed drastically in 3.4.x
comparing to the 3.3.13, or is it, as it seems, a memory leak ?

Thanks.
Eugene.


From eugene at zhegan.in  Mon Jan 12 11:43:47 2015
From: eugene at zhegan.in (Eugene M. Zheganin)
Date: Mon, 12 Jan 2015 16:43:47 +0500
Subject: [squid-users] Memory Leak Squid 3.4.9 on FreeBSD 10.0 x64
In-Reply-To: <E6B2517F8D6DBF4CABB8F38ACA367E78343B4E87@Draco.dawnsign.com>
References: <86iogtp7ao.fsf@gmail.com>
 <E6B2517F8D6DBF4CABB8F38ACA367E78343B4E87@Draco.dawnsign.com>
Message-ID: <54B3B373.9080103@zhegan.in>

Hi.

On 09.01.2015 00:10, Doug Sampson wrote:
> Man, I empathize with you. Have you tried running Squid 3.4.x on
> FreeBSD 9.3? Sometimes I wonder if it's FreeBSD 10.x that's causing
> the issue...
It's not. FreeBSD 9.x branch was a crappy release from it's start.

Eugene.


From yvoinov at gmail.com  Mon Jan 12 11:48:11 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 12 Jan 2015 17:48:11 +0600
Subject: [squid-users] Memory Leak Squid 3.4.9 on FreeBSD 10.0 x64
In-Reply-To: <54B3B303.2080906@zhegan.in>
References: <86iogtp7ao.fsf@gmail.com>
 <E6B2517F8D6DBF4CABB8F38ACA367E78343B4E87@Draco.dawnsign.com>
 <54AF2B06.6030505@treenet.co.nz> <54B3B303.2080906@zhegan.in>
Message-ID: <54B3B47B.1010300@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Looks like an OS-specific issue.

I don't see any memory leaking on my boxes (running Solaris 10, yes ;)).
Moreover, helpers is corrrectly got an release memory.

12.01.2015 17:41, Eugene M. Zheganin ?????:
> Hi.
>
> On 09.01.2015 06:12, Amos Jeffries wrote:
>> Grand total:
>>   => 9.5 GB of RAM just for Squid.
>>
>> .. then there is whatever memory the helper programs, other software
>> on the server and operating system all need.
>>
> I'm now also having a strong impression that squid is leaking memory.
> Now, when 3.4.x is able to handle hundreds of users during several hours
> I notice that it's memory usage is constantly increasing. My patience
> always ends at the point of 1.5 Gigs memory usage, where server memory
> starts to be exhausted (squid is running with lots of other stuff) and I
> restart it. This is happening on exactly the same config the 3.3.13 was
> running, so ... I have cache_mem set to 512 megs, diskd, medium sized
> cache_dir and lots of users. Is something changed drastically in 3.4.x
> comparing to the 3.3.13, or is it, as it seems, a memory leak ?
>
> Thanks.
> Eugene.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUs7R6AAoJENNXIZxhPexGrKwH/1T9k9zGwgEqQeg/6+u1z1bV
kShvT7TOVNGXHMXWEka2NWjn/o973nHRAUbwBd6MUMsRSd0o3hOBYnVByYAI/6UM
X/CmZpADcTMS/WSAFIrSlqj/Ml1HOafOQcmMrxw6h5jJ9qoO/O8oPHGiBpiAIjGh
eMtwX0qiyfx+Xy8ncYUial/JtQPm3jsxBuCofBHatqeAA9vPyng+a+e/C4MKILX/
D4EbzCGd8CBzH8vKGkPIwUKbXJ3j79yf7ve+u+YREX/DuJ68uroHJEOo8lNnHr+/
cVoJ70C3Nju0ZYE2Dme8kYJ7764k+K4sdlD10mBXroMxqgBoUZTqIl+Tx/G8o5c=
=E/KG
-----END PGP SIGNATURE-----



From eliezer at ngtech.co.il  Mon Jan 12 11:53:20 2015
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Mon, 12 Jan 2015 13:53:20 +0200
Subject: [squid-users] ssl cert wiki
In-Reply-To: <1421061603806-4669035.post@n4.nabble.com>
References: <54B3A60B.1080006@ngtech.co.il>
 <1421059834126-4669023.post@n4.nabble.com> <54B3A807.3060002@gmail.com>
 <1421060105110-4669025.post@n4.nabble.com> <54B3A98A.7030403@gmail.com>
 <1421060539233-4669029.post@n4.nabble.com> <54B3AA83.9040102@gmail.com>
 <1421060710890-4669032.post@n4.nabble.com>
 <1421060848926-4669033.post@n4.nabble.com> <54B3AD10.1080809@gmail.com>
 <1421061603806-4669035.post@n4.nabble.com>
Message-ID: <54B3B5B0.8000809@ngtech.co.il>

Hey,

This is not a reverse proxy...
It's a ssl-bump server and which you cannot use any bought certificate 
for it.

Eliezer

On 12/01/2015 13:20, HackXBack wrote:
> https_port 3127 intercept ssl-bump generate-host-certificates=on
> dynamic_cert_mem_cache_size=4MB cert=/etc/squid/ssl_cert/CA.pem
> key=/etc/squid/ssl_cert/testkey.pem
> http_port  3129
> http_port  3128 intercept




From yvoinov at gmail.com  Mon Jan 12 11:54:32 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 12 Jan 2015 17:54:32 +0600
Subject: [squid-users] ssl cert wiki
In-Reply-To: <54B3B5B0.8000809@ngtech.co.il>
References: <54B3A60B.1080006@ngtech.co.il>
 <1421059834126-4669023.post@n4.nabble.com> <54B3A807.3060002@gmail.com>
 <1421060105110-4669025.post@n4.nabble.com> <54B3A98A.7030403@gmail.com>
 <1421060539233-4669029.post@n4.nabble.com> <54B3AA83.9040102@gmail.com>
 <1421060710890-4669032.post@n4.nabble.com>
 <1421060848926-4669033.post@n4.nabble.com> <54B3AD10.1080809@gmail.com>
 <1421061603806-4669035.post@n4.nabble.com> <54B3B5B0.8000809@ngtech.co.il>
Message-ID: <54B3B5F8.6000402@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Yep :)

12.01.2015 17:53, Eliezer Croitoru ?????:
> Hey,
>
> This is not a reverse proxy...
> It's a ssl-bump server and which you cannot use any bought certificate
for it.
>
> Eliezer
>
> On 12/01/2015 13:20, HackXBack wrote:
>> https_port 3127 intercept ssl-bump generate-host-certificates=on
>> dynamic_cert_mem_cache_size=4MB cert=/etc/squid/ssl_cert/CA.pem
>> key=/etc/squid/ssl_cert/testkey.pem
>> http_port  3129
>> http_port  3128 intercept
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUs7X4AAoJENNXIZxhPexGbDoH/injg/fGQ7q4dlzSGxE6yrS7
AsWDlaJBJrHP9K36+PdhegzCxBAHbUCH9A+PeAxsmfk2qkUC8L1mTHbKi1SNtz61
9PDhKP6UvUKl6X+73lEJCzcq637Y977B+wPS1mY7ORQMw5n0t4lLE5dei5Jn7eK0
w8CIFs7j9v47uq/lcr4Uieaus8g1tKci/z2o9G2Xzvry6KWyLhQsZqOUwmVqTCwx
8ityt1txEvcJnU91XIK5hLrkPivUps/jsZeeSGzYcQEviXPEw3FP0bTs20xipyyR
F/YG1/VBPDSsVuFs9BHBcMkNo+sOX3yjavRky5sR2iWvoVPAXRM3w9UU6zxnjFU=
=SCHb
-----END PGP SIGNATURE-----



From eugene at zhegan.in  Mon Jan 12 12:06:44 2015
From: eugene at zhegan.in (Eugene M. Zheganin)
Date: Mon, 12 Jan 2015 17:06:44 +0500
Subject: [squid-users] Memory Leak Squid 3.4.9 on FreeBSD 10.0 x64
In-Reply-To: <54B3B303.2080906@zhegan.in>
References: <86iogtp7ao.fsf@gmail.com>
 <E6B2517F8D6DBF4CABB8F38ACA367E78343B4E87@Draco.dawnsign.com>
 <54AF2B06.6030505@treenet.co.nz> <54B3B303.2080906@zhegan.in>
Message-ID: <54B3B8D4.20702@zhegan.in>

Hi.

On 12.01.2015 16:41, Eugene M. Zheganin wrote:
> I'm now also having a strong impression that squid is leaking memory.
> Now, when 3.4.x is able to handle hundreds of users during several
> hours I notice that it's memory usage is constantly increasing. My
> patience always ends at the point of 1.5 Gigs memory usage, where
> server memory starts to be exhausted (squid is running with lots of
> other stuff) and I restart it. This is happening on exactly the same
> config the 3.3.13 was running, so ... I have cache_mem set to 512
> megs, diskd, medium sized cache_dir and lots of users. Is something
> changed drastically in 3.4.x comparing to the 3.3.13, or is it, as it
> seems, a memory leak ?
Squid 3.4 on FreeBSD is by default compiling with the
--enable-debug-cbdata option and when 45th log selector is at it's
default 1, cache.log is filling with CBData memory leaking alarms. Here
is the list for the last 40 minutes, sorted with the occurrence count:

104136 Checklist.cc:160
81438 Checklist.cc:187
177226 Checklist.cc:320
84861 Checklist.cc:45
89151 CommCalls.cc:21
22069 DiskIO/DiskDaemon/DiskdIOStrategy.cc:353
 120 UserRequest.cc:166
  29 UserRequest.cc:172
55814 clientStream.cc:235
5966 client_side_reply.cc:93
4516 client_side_request.cc:134
5568 dns_internal.cc:1131
4859 dns_internal.cc:1140
  86 event.cc:90
7770 external_acl.cc:1426
1548 fqdncache.cc:340
7467 helper.cc:856
39905 ipcache.cc:353
11880 store.cc:1611
181959 store_client.cc:154
256951 store_client.cc:337
6835 ufs/UFSStoreState.cc:333

are those all false alarms ?

Thanks.
Eugene.


From yvoinov at gmail.com  Mon Jan 12 12:15:06 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 12 Jan 2015 18:15:06 +0600
Subject: [squid-users] Memory Leak Squid 3.4.9 on FreeBSD 10.0 x64
In-Reply-To: <54B3B8D4.20702@zhegan.in>
References: <86iogtp7ao.fsf@gmail.com>
 <E6B2517F8D6DBF4CABB8F38ACA367E78343B4E87@Draco.dawnsign.com>
 <54AF2B06.6030505@treenet.co.nz> <54B3B303.2080906@zhegan.in>
 <54B3B8D4.20702@zhegan.in>
Message-ID: <54B3BACA.7030001@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Yep.

Memory leaking - if it really it - will be occurs on all platforms.

If not - this is OS-specific issue. libc, malloc library problem. But
not squid itself.


12.01.2015 18:06, Eugene M. Zheganin ?????:


-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUs7rFAAoJENNXIZxhPexG7EYIAKfrJU2JU6gulc11PMnuNrq1
P0lMm5WYTh2joRj6j3mCsiMR8FyolOQCxT298wY3/zXlY4bvluuwwqJ9hW4JiuMn
RGXK5iJvGg8zr0yABiDoNXFLgUMVdW8NqibSfecRds7ZZkjEhnn8tUO+2jU03ZBy
dZzg7TavNOeRextBJCaknr4IKwvoQWQsiparTF91wJSg9YfQ7oHsWellTlbI7uPC
r/2opE2nOtKF+PEbspmzXgzt76RBe1xNM4dWikbeZOPzXvg0n7Iwbhd6TSTfWLS0
Wb4HAPB7qVJ52Nx3lYjFYHrIMqKClrj+ETQVJp7CKOZCxP25jMyF+F1Oa9d9ZxE=
=mVwt
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150112/0f72fc01/attachment.htm>

From yvoinov at gmail.com  Mon Jan 12 12:15:05 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 12 Jan 2015 18:15:05 +0600
Subject: [squid-users] Memory Leak Squid 3.4.9 on FreeBSD 10.0 x64
In-Reply-To: <54B3B8D4.20702@zhegan.in>
References: <86iogtp7ao.fsf@gmail.com>
 <E6B2517F8D6DBF4CABB8F38ACA367E78343B4E87@Draco.dawnsign.com>
 <54AF2B06.6030505@treenet.co.nz> <54B3B303.2080906@zhegan.in>
 <54B3B8D4.20702@zhegan.in>
Message-ID: <54B3BAC9.1020702@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Yep.

Memory leaking - if it really it - will be occurs on all platforms.

If not - this is OS-specific issue. libc, malloc library problem. But
not squid itself.


12.01.2015 18:06, Eugene M. Zheganin ?????:
> Hi.
>
> On 12.01.2015 16:41, Eugene M. Zheganin wrote:
>> I'm now also having a strong impression that squid is leaking memory.
>> Now, when 3.4.x is able to handle hundreds of users during several
>> hours I notice that it's memory usage is constantly increasing. My
>> patience always ends at the point of 1.5 Gigs memory usage, where
>> server memory starts to be exhausted (squid is running with lots of
>> other stuff) and I restart it. This is happening on exactly the same
>> config the 3.3.13 was running, so ... I have cache_mem set to 512
>> megs, diskd, medium sized cache_dir and lots of users. Is something
>> changed drastically in 3.4.x comparing to the 3.3.13, or is it, as it
>> seems, a memory leak ?
> Squid 3.4 on FreeBSD is by default compiling with the
> --enable-debug-cbdata option and when 45th log selector is at it's
> default 1, cache.log is filling with CBData memory leaking alarms. Here
> is the list for the last 40 minutes, sorted with the occurrence count:
>
> 104136 Checklist.cc:160
> 81438 Checklist.cc:187
> 177226 Checklist.cc:320
> 84861 Checklist.cc:45
> 89151 CommCalls.cc:21
> 22069 DiskIO/DiskDaemon/DiskdIOStrategy.cc:353
>  120 UserRequest.cc:166
>   29 UserRequest.cc:172
> 55814 clientStream.cc:235
> 5966 client_side_reply.cc:93
> 4516 client_side_request.cc:134
> 5568 dns_internal.cc:1131
> 4859 dns_internal.cc:1140
>   86 event.cc:90
> 7770 external_acl.cc:1426
> 1548 fqdncache.cc:340
> 7467 helper.cc:856
> 39905 ipcache.cc:353
> 11880 store.cc:1611
> 181959 store_client.cc:154
> 256951 store_client.cc:337
> 6835 ufs/UFSStoreState.cc:333
>
> are those all false alarms ?
>
> Thanks.
> Eugene.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUs7rJAAoJENNXIZxhPexGmk0IAJmEmfJ1aBLL9DlrrnHM95JU
8VeGgsQi/wVpAjS2z1JA5eDJZ6WY5tBycVkJsKK0SBaHXrFjTHQkEUuy4iFQLpkV
q8xZ4Y/X0rKJ6ayy6XSHaEd4wznlthteCTI5ImTW9fiL7PXfW7mci+o2g6lUPNa7
edtep7gp04ICmkLdq1F6P5InxksoLpc1iavV281SRowPDv151TFlZ5cn0A3fmqIv
J/Pi19ss3vabiU3VXEvhiA5duxtx2lIs+BMZpU2Q3L9nQhvUf2pa8xMRBRF95RCd
8Pagb7Exzc/0/2JIjt8oCeV60Rr7xOUcwoxOXRC/4EBxzTWBH7FOkrnmBpVGNnM=
=NJuF
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150112/f9cc68ba/attachment.htm>

From squid3 at treenet.co.nz  Mon Jan 12 14:06:37 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 13 Jan 2015 03:06:37 +1300
Subject: [squid-users] Memory Leak Squid 3.4.9 on FreeBSD 10.0 x64
In-Reply-To: <54B3BAC9.1020702@gmail.com>
References: <86iogtp7ao.fsf@gmail.com>
 <E6B2517F8D6DBF4CABB8F38ACA367E78343B4E87@Draco.dawnsign.com>
 <54AF2B06.6030505@treenet.co.nz> <54B3B303.2080906@zhegan.in>
 <54B3B8D4.20702@zhegan.in> <54B3BAC9.1020702@gmail.com>
Message-ID: <54B3D4ED.2050608@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 13/01/2015 1:15 a.m., Yuri Voinov wrote:
> 
> Yep.
> 
> Memory leaking - if it really it - will be occurs on all
> platforms.
> 
> If not - this is OS-specific issue. libc, malloc library problem.
> But not squid itself.
> 

By definition a memory leak is memory which is "forgotten" /
dereference by the application (squid) without correctly calling
free/delete to release the memory back to the OS.

I am confident that those types of leaks do not exist at al in Squid 3.4.

These rounds of mmory exhaustion problems are caused by pseudo-leaks,
where Squid incorrectly holds onto memory (has not forgotten it
though) far longer than it should be.

> 
> 12.01.2015 18:06, Eugene M. Zheganin ?????:
>> Hi.
> 
>> On 12.01.2015 16:41, Eugene M. Zheganin wrote:
>>> I'm now also having a strong impression that squid is leaking
>>> memory. Now, when 3.4.x is able to handle hundreds of users
>>> during several hours I notice that it's memory usage is
>>> constantly increasing. My patience always ends at the point of
>>> 1.5 Gigs memory usage, where server memory starts to be
>>> exhausted (squid is running with lots of other stuff) and I
>>> restart it. This is happening on exactly the same config the
>>> 3.3.13 was running, so ... I have cache_mem set to 512 megs,
>>> diskd, medium sized cache_dir and lots of users. Is something 
>>> changed drastically in 3.4.x comparing to the 3.3.13, or is it,
>>> as it seems, a memory leak ?
>> Squid 3.4 on FreeBSD is by default compiling with the 
>> --enable-debug-cbdata option and when 45th log selector is at
>> it's default 1, cache.log is filling with CBData memory leaking
>> alarms. Here is the list for the last 40 minutes, sorted with the
>> occurrence count:
> 
>> 104136 Checklist.cc:160 81438 Checklist.cc:187 177226
>> Checklist.cc:320 84861 Checklist.cc:45 89151 CommCalls.cc:21 
>> 22069 DiskIO/DiskDaemon/DiskdIOStrategy.cc:353 120
>> UserRequest.cc:166 29 UserRequest.cc:172 55814
>> clientStream.cc:235 5966 client_side_reply.cc:93 4516
>> client_side_request.cc:134 5568 dns_internal.cc:1131 4859
>> dns_internal.cc:1140 86 event.cc:90 7770 external_acl.cc:1426 
>> 1548 fqdncache.cc:340 7467 helper.cc:856 39905 ipcache.cc:353 
>> 11880 store.cc:1611 181959 store_client.cc:154 256951
>> store_client.cc:337 6835 ufs/UFSStoreState.cc:333
> 
>> are those all false alarms ?

Those have been confirmed as false alerts. The C-style code releases
locks first while still holding a pointer (and logs the warning about
leak) then frees that pointer (outside the cbdata code) ... the C++
code does it the other way around with cbdata code doing free before
releasing the final lock.

I am back at the head-scratching stage about where those cbdata issues
are coming from.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUs9TrAAoJELJo5wb/XPRjHMsIAL48yDQP91+DaX3F1ctY4uYw
hFMMiSL48rd/4KYvwXs+7Cy2HEzcF7mMQpkcY92MdX0PYtsTAIDnP5Cggm56knqB
aV4UtwgethI5qvcJlGRXrCpsmqEYjvC4w7PEdvEBRyzAZTv9g36hWMMc9IZtMX6R
Yqga9pnUPvIl1Cm1e/5eD/kPfxJm4KMdBrW1jRyhD9z515F+1rko5rD0wIGZBomn
KFi/ieb52JPa5+nZLKgn3q/8EQyvsVC56J0UeuZwPj1qrZE13fLAEawydxyv9/PJ
RbTaoYAOzcXTTwylOrTRntnwZr+qN5pSr7eUVYv+XdEoVHrII49RlwtB6qJrUfM=
=ychL
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Mon Jan 12 14:20:05 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 13 Jan 2015 03:20:05 +1300
Subject: [squid-users] ssl cert wiki
In-Reply-To: <1421060403756-4669027.post@n4.nabble.com>
References: <1421055686052-4669016.post@n4.nabble.com>
 <1421060403756-4669027.post@n4.nabble.com>
Message-ID: <54B3D815.4020500@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 13/01/2015 12:00 a.m., HackXBack wrote:
> in this case the clear question is what https_port line must
> contain ?
> 

The basic config for a reverse proxy is supposed to be just this:

  https_port 443 accel no-vhost \
    defaultdomain=example.com \
    cert=/path/to/example.com_cert.pem


That means: configured as a reverse-proxy accepting encrypted traffic
on port 443 for the domain example.com, with the encryption keys (both
private and public/certificate) in the given .PEM format file.


PS. For proxies that support "no-vhost" it is required. Otherwise just
omit that option.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUs9gVAAoJELJo5wb/XPRjIsQIALG1Ehyy1ZNQvLlOl0ZATh58
2vxQjSGtIKvpXY0rKYW5qb9alL5iEDFDi/Ae/T3O5NyXJyURyxVziFD2OdEq1OXI
kNmwnD0dZE1cB55bRRtbatIs5znYzLj7+By9AWbnOgbV5bjvVuojPxHeGHPdtI8v
rvj4hC/4DiyOS5xGz29roOwd+iEsYjxi1nLsygKGZTM5DZOeAR6CSiwZV+kuOr2c
WDptdVUJIsJ4SenuVvUN6vhIt0SaFvtP2PO5Q8toGe6sqLpazo+LurrhCi8uY1Dm
Tvo+PNXSc6gcnuTSVbFVKNFq0gz0A8KK4I1AAB0fbzW5le7YH/fTJYg8xz88iNU=
=XEon
-----END PGP SIGNATURE-----


From hack.back at hotmail.com  Mon Jan 12 14:20:39 2015
From: hack.back at hotmail.com (HackXBack)
Date: Mon, 12 Jan 2015 06:20:39 -0800 (PST)
Subject: [squid-users] ssl cert wiki
In-Reply-To: <1421055686052-4669016.post@n4.nabble.com>
References: <1421055686052-4669016.post@n4.nabble.com>
Message-ID: <1421072439964-4669050.post@n4.nabble.com>

how it didnt work while i found articles in google saying that it work for
them
like this one:
http://www.linuxquestions.org/questions/linux-server-73/ssl-intermediate-chain-warning-917476/



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/ssl-cert-wiki-tp4669016p4669050.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From eliezer at ngtech.co.il  Mon Jan 12 16:04:30 2015
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Mon, 12 Jan 2015 18:04:30 +0200
Subject: [squid-users] ssl cert wiki
In-Reply-To: <1421072439964-4669050.post@n4.nabble.com>
References: <1421055686052-4669016.post@n4.nabble.com>
 <1421072439964-4669050.post@n4.nabble.com>
Message-ID: <54B3F08E.2080400@ngtech.co.il>

Hey hack,

 From the comments in the past I am unsure what you are after...
If you are using ssl-bump you should first learn about how ssl works and 
about the differences between encrypted traffic to verification of a 
public key.
I must admit that these topic are not marked as an easy one.
Since these topics are a part of the LPIC-3 303 exam this means it one 
of the most advanced topics there are in the linux world.

The link you mentioned is talking about a situation of a reverse proxy 
which is very different from the ssl-bump way of action.
Notice that the only reason that https_port is being used for ssl-bump 
is a technical one.

Regards,
Eliezer

On 12/01/2015 16:20, HackXBack wrote:
> how it didnt work while i found articles in google saying that it work for
> them
> like this one:
> http://www.linuxquestions.org/questions/linux-server-73/ssl-intermediate-chain-warning-917476/
>




From simon at baladia.gov.kw  Tue Jan 13 04:22:02 2015
From: simon at baladia.gov.kw (Simon Dcunha)
Date: Tue, 13 Jan 2015 07:22:02 +0300 (AST)
Subject: [squid-users] {Disarmed} Re:  site cannot be accessed
In-Reply-To: <889324251.20747.1421122851568.JavaMail.zimbra@baladia.gov.kw>
References: <1878891668.20418.1421044881847.JavaMail.zimbra@baladia.gov.kw>
 <392294731.845905.1421057886713.JavaMail.yahoo@jws10630.mail.bf1.yahoo.com>
Message-ID: <26363080.20756.1421122922366.JavaMail.zimbra@baladia.gov.kw>

Dear Sarfraz, 
appreciate your immediate reply 

Heres attached is my pac file 
i am accessing the 10.101.101.10 server 

regards 

simon 
---------------- 






From: "***some text missing***" <shozii1 at yahoo.com> 
To: "simon" <simon at baladia.gov.kw>, "squid-users" <squid-users at squid-cache.org> 
Sent: Monday, January 12, 2015 1:18:06 PM 
Subject: {Disarmed} Re: [squid-users] site cannot be accessed 


Share your PAC file please. 

Regards, 
Sarfraz 


From: Simon Dcunha <simon at baladia.gov.kw> 
To: squid-users <squid-users at squid-cache.org> 
Sent: Monday, January 12, 2015 11:41 AM 
Subject: [squid-users] site cannot be accessed 


Dear All, 

I have squid-3.1.10-22.el6_5.x86_64 running on centos 6.5 64 bit for quite sometime and working fine 
just a couple of days back some users reported an issue 

i have a intranet site which just stopped working . 
if I uncheck the proxy option in the browser the site works fine 
the above users also use internet and is working fine 

I am using the pac file to bypass local sites and the local intranet websites are alredy added in the pac file 

also i am quite sure the above intranet website were working before 

the squid log shows 
------------ 
1421053747.139 70984 172.16.6.21 TCP_MISS/000 0 GET MailScanner warning: numerical links are often malicious: http://10.101.101.10/ - DIRECT/10.101.101.10 - 
1421053779.524 32021 172.16.6.21 TCP_MISS/000 0 GET MailScanner warning: numerical links are often malicious: http://10.101.101.10/ - DIRECT/10.101.101.10 - 
---------- 

appreciate your advice and concern 

regards 

simon 

-- 
--------- 
Network Administrator 
Kuwait Municipality!!! 

-- 
This message has been scanned for viruses and 
dangerous content by MailScanner, and is 
believed to be clean. 

_______________________________________________ 
squid-users mailing list 
squid-users at lists.squid-cache.org 
http://lists.squid-cache.org/listinfo/squid-users 



-- 
This message has been scanned for viruses and 
dangerous content by MailScanner , and is 
believed to be clean. 

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150113/0f480324/attachment.htm>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: pac.txt
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150113/0f480324/attachment.txt>

From eliezer at ngtech.co.il  Tue Jan 13 07:30:08 2015
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Tue, 13 Jan 2015 09:30:08 +0200
Subject: [squid-users] {Disarmed} Re:  site cannot be accessed
In-Reply-To: <26363080.20756.1421122922366.JavaMail.zimbra@baladia.gov.kw>
References: <1878891668.20418.1421044881847.JavaMail.zimbra@baladia.gov.kw>
 <392294731.845905.1421057886713.JavaMail.yahoo@jws10630.mail.bf1.yahoo.com>
 <26363080.20756.1421122922366.JavaMail.zimbra@baladia.gov.kw>
Message-ID: <54B4C980.6040600@ngtech.co.il>

Hey,

Did you had the chance to see this page:
http://findproxyforurl.com/example-pac-file/

Eliezer

On 13/01/2015 06:22, Simon Dcunha wrote:
> Dear Sarfraz,
> appreciate your immediate reply
>
> Heres attached is my pac file
> i am accessing the 10.101.101.10 server
>
> regards
>
> simon
> ----------------
>
>
>
>
>
>
> From: "***some text missing***" <shozii1 at yahoo.com>
> To: "simon" <simon at baladia.gov.kw>, "squid-users" <squid-users at squid-cache.org>
> Sent: Monday, January 12, 2015 1:18:06 PM
> Subject: {Disarmed} Re: [squid-users] site cannot be accessed
>
>
> Share your PAC file please.
>
> Regards,
> Sarfraz
>
>
> From: Simon Dcunha <simon at baladia.gov.kw>
> To: squid-users <squid-users at squid-cache.org>
> Sent: Monday, January 12, 2015 11:41 AM
> Subject: [squid-users] site cannot be accessed
>
>
> Dear All,
>
> I have squid-3.1.10-22.el6_5.x86_64 running on centos 6.5 64 bit for quite sometime and working fine
> just a couple of days back some users reported an issue
>
> i have a intranet site which just stopped working .
> if I uncheck the proxy option in the browser the site works fine
> the above users also use internet and is working fine
>
> I am using the pac file to bypass local sites and the local intranet websites are alredy added in the pac file
>
> also i am quite sure the above intranet website were working before
>
> the squid log shows
> ------------
> 1421053747.139 70984 172.16.6.21 TCP_MISS/000 0 GET MailScanner warning: numerical links are often malicious: http://10.101.101.10/ - DIRECT/10.101.101.10 -
> 1421053779.524 32021 172.16.6.21 TCP_MISS/000 0 GET MailScanner warning: numerical links are often malicious: http://10.101.101.10/ - DIRECT/10.101.101.10 -
> ----------
>
> appreciate your advice and concern
>
> regards
>
> simon
>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>




From informatica at riberadelduero.es  Tue Jan 13 09:45:49 2015
From: informatica at riberadelduero.es (=?iso-8859-1?Q?C=E9sar_S=E1nchez_Pascual?=)
Date: Tue, 13 Jan 2015 10:45:49 +0100
Subject: [squid-users] tcp_miss_aborted only with some sites
Message-ID: <001c01d02f15$b68a9ae0$239fd0a0$@riberadelduero.es>

Hi, 

I have installed squid 3.3.8 o a Ubuntu 14 server edition.

It runs ok except with some sites. In access.log appears an error:

Example:
TCP_MISS_ABORTED/000 GET http://www.magrama.gob.es/es -
HIER_DIRECT/93.188.53.33

Two examples of sites that causes this error in log are:

www.calidadpascual.com
www.magrama.gov.es

I have tried with a direct connection (not using proxy) and the web runs. 

If anyone can help, I appreciate that. I have been looking for this issue
some days without success.

Thanks, 



From squid3 at treenet.co.nz  Tue Jan 13 10:20:26 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 13 Jan 2015 23:20:26 +1300
Subject: [squid-users] tcp_miss_aborted only with some sites
In-Reply-To: <001c01d02f15$b68a9ae0$239fd0a0$@riberadelduero.es>
References: <001c01d02f15$b68a9ae0$239fd0a0$@riberadelduero.es>
Message-ID: <54B4F16A.4030608@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 13/01/2015 10:45 p.m., C?sar S?nchez Pascual wrote:
> Hi,
> 
> I have installed squid 3.3.8 o a Ubuntu 14 server edition.
> 
> It runs ok except with some sites. In access.log appears an error:
> 
> Example: TCP_MISS_ABORTED/000 GET http://www.magrama.gob.es/es - 
> HIER_DIRECT/93.188.53.33
> 

The client chose to disconnect from Squid before the server
93.188.53.33 sent anything back.

This is usually seen when the traffic travels over networks containing
hardware with broken ECN or TCP Window scaling functionality, or
networks where ICMP is blocked.

The ICMP blocking problem is particularly bad if the traffic is
delivered over a tunnel or VPN link somewhere. As those types of
network connection have non-1500 MTU values that need working ICMP for
path-MTU discovery.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUtPFpAAoJELJo5wb/XPRj5ecH/R8cTxAJDEOwXgxG+NJHaCf5
5rJFdq9whKMf5ZMvpj9gwROBklaeVQbkSmQvBLDDj6GeY5sqIY49Rp1B0YaAFV9e
+HSUbZ1eTvGA+hlCUzUkJRnLg8ExkWqHVa//b1tzE1/s9CKqnHZIzomRTxp1Uoh8
u3vTclROfNHP3rHQ2RCdBtqmCI1QKpSYojWV5FrtDzK9Jj8IqjZf0xtuZEEgax1t
eHtRvAY7DvgWTIB0zp8zsM8tAYbJBMx7WHvb4WE2H+OeXgDc0zlxbzkXeN7U6WXA
C/BgL1+C74tr3vtgrd3iIFPsqxnRPqbjIb2MV/4j5mnb0jsa9+271f7DCT+8Ves=
=GIgP
-----END PGP SIGNATURE-----


From lars at lhanke.de  Tue Jan 13 10:30:55 2015
From: lars at lhanke.de (Dr. Lars Hanke)
Date: Tue, 13 Jan 2015 11:30:55 +0100
Subject: [squid-users] Traffic prioritizing
Message-ID: <54B4F3DF.3060307@lhanke.de>

I want to prioritize traffic of some subnets over the the rest to avoid 
leisure traffic killing critical business traffic over a slow network 
connection. This of course would be a task for tools like tc, but behind 
the proxy the information of the original IP is lost.

I do not want to statically limit the bandwidth of the non-priority 
traffic. I just want the priority traffic to receive a major share of 
the bandwidth, if it actually requires it. I'm not sure whether 
delay_pools can do that.

Any ideas how to accomplish this?


From eliezer at ngtech.co.il  Tue Jan 13 10:37:07 2015
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Tue, 13 Jan 2015 12:37:07 +0200
Subject: [squid-users] Traffic prioritizing
In-Reply-To: <54B4F3DF.3060307@lhanke.de>
References: <54B4F3DF.3060307@lhanke.de>
Message-ID: <54B4F553.2010303@ngtech.co.il>

Hey Dr,

There are couple aspects to the issue.
The options are:
- TOS marking of specific connections
- TPROXY(leaving the src IP the same)
- delay_pools

If you have a shaping setup in place or device that is capable of 
traffic shaping based on TOS marking you can take a look at this option.

Eliezer

On 13/01/2015 12:30, Dr. Lars Hanke wrote:
> I want to prioritize traffic of some subnets over the the rest to avoid
> leisure traffic killing critical business traffic over a slow network
> connection. This of course would be a task for tools like tc, but behind
> the proxy the information of the original IP is lost.
>
> I do not want to statically limit the bandwidth of the non-priority
> traffic. I just want the priority traffic to receive a major share of
> the bandwidth, if it actually requires it. I'm not sure whether
> delay_pools can do that.
>
> Any ideas how to accomplish this?




From yvoinov at gmail.com  Tue Jan 13 10:41:42 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Tue, 13 Jan 2015 16:41:42 +0600
Subject: [squid-users] Traffic prioritizing
In-Reply-To: <54B4F3DF.3060307@lhanke.de>
References: <54B4F3DF.3060307@lhanke.de>
Message-ID: <54B4F666.6000706@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Cisco QoS?

13.01.2015 16:30, Dr. Lars Hanke ?????:
> I want to prioritize traffic of some subnets over the the rest to avoid leisure traffic killing
critical business traffic over a slow network connection. This of course
would be a task for tools like tc, but behind the proxy the information
of the original IP is lost.
>
> I do not want to statically limit the bandwidth of the non-priority
traffic. I just want the priority traffic to receive a major share of
the bandwidth, if it actually requires it. I'm not sure whether
delay_pools can do that.
>
> Any ideas how to accomplish this?
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUtPZmAAoJENNXIZxhPexGtz0H/1H3JTC1Bborp671jbmtrXG/
Lbv3u8BYXU1HcSLwHKdnWMiyP+y/7jmjysIGuIVpT0fWQxNFOrDxtitQV6+r8quD
FfyTCAJJfzp3ijMyz+PUpdSA6Uewkvv1hPeFfksq0JIfNmATUShDM0abD8AnUW2M
CumJzgAki04WCpkw5CFoMLZpfYWQwWsJHuitD5Y/mD6veAu4js/7F0Joox7avkKo
8AUkxAa5kC0mryzSy+qXZT8Ma4QiKyJIbPcm7lAb//dxcDu6MaAo0hCI0dDgkzLn
A4OSrJPwhrpQCxma2R6X8X+TlhuciG/u0OOUbQzVfkLqKgurEiYim5EAW0s5hsA=
=nbTo
-----END PGP SIGNATURE-----



From squid3 at treenet.co.nz  Tue Jan 13 10:41:52 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 13 Jan 2015 23:41:52 +1300
Subject: [squid-users] Traffic prioritizing
In-Reply-To: <54B4F3DF.3060307@lhanke.de>
References: <54B4F3DF.3060307@lhanke.de>
Message-ID: <54B4F670.10501@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 13/01/2015 11:30 p.m., Dr. Lars Hanke wrote:
> I want to prioritize traffic of some subnets over the the rest to
> avoid leisure traffic killing critical business traffic over a slow
> network connection. This of course would be a task for tools like
> tc, but behind the proxy the information of the original IP is
> lost.
> 
> I do not want to statically limit the bandwidth of the
> non-priority traffic. I just want the priority traffic to receive a
> major share of the bandwidth, if it actually requires it. I'm not
> sure whether delay_pools can do that.
> 
> Any ideas how to accomplish this?

Best way is to use the tcp_outgoing_tos and ACLs to emit TOS values
for the traffic as it flows so tools like tc etc can do the management
without direct access to the client IP.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUtPZwAAoJELJo5wb/XPRj63EH/jyBifroBQ/lX0qYIr3Z4roF
OUGN7Acdit+yHetiDARyOB27DcXmuCL8qiS9IJkc7b/PiYzufqaPdy5ngjIRNbBE
yOCwznwPky12m5eooQBJ0upI5tqUxyDuPi3c99uQxbVgfcrYVoospoQ4HR54fhDC
Y4k77WmluSPNBWz8RThyrR65y+nZNoHIXqIxHy7ojJ0exYxB06NK402bN0HLpyS1
YeJMir+YxK9E9bSPOzDPABBgO9VSTzd1XhLDgn80DmTxbR/J/Enu/oWmPB8pa0KE
4JE8wPnhT2GT+9W5Sbmi5AyI9Ge4B0mkpHTqs75VHzkpTq74wOVA61Qouek+7Ss=
=qEbh
-----END PGP SIGNATURE-----


From yvoinov at gmail.com  Tue Jan 13 10:44:30 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Tue, 13 Jan 2015 16:44:30 +0600
Subject: [squid-users] Traffic prioritizing
In-Reply-To: <54B4F670.10501@treenet.co.nz>
References: <54B4F3DF.3060307@lhanke.de> <54B4F670.10501@treenet.co.nz>
Message-ID: <54B4F70E.1020404@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Amos,

TOS without infrastructure support does not effect.

Routers/switches must be configured to understand packet labeling.

This is not trivial task and cannot be solve without touch network
equipment.

13.01.2015 16:41, Amos Jeffries ?????:
> On 13/01/2015 11:30 p.m., Dr. Lars Hanke wrote:
> > I want to prioritize traffic of some subnets over the the rest to
> > avoid leisure traffic killing critical business traffic over a slow
> > network connection. This of course would be a task for tools like
> > tc, but behind the proxy the information of the original IP is
> > lost.
>
> > I do not want to statically limit the bandwidth of the
> > non-priority traffic. I just want the priority traffic to receive a
> > major share of the bandwidth, if it actually requires it. I'm not
> > sure whether delay_pools can do that.
>
> > Any ideas how to accomplish this?
>
> Best way is to use the tcp_outgoing_tos and ACLs to emit TOS values
> for the traffic as it flows so tools like tc etc can do the management
> without direct access to the client IP.
>
> Amos
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUtPcOAAoJENNXIZxhPexGBloH/1DPIhu30ybLMnCk0jnNRwoY
60dqrD2XR6IKi7s7H5aIxbTIvlrUbQSm9qvExjxXh5WtyisQj+bPE+jmInbVa/ED
f5k8JZdghoS0UWZCFK3dkDbYmnxk3LoYG+YAlWVrXBroANR4vfxuTZ+CRYQv6ufs
wU/Y+jBVcdzH6hMZQgrIocqhkaeczWmUFngVyi9KyE7cEB8AGohckHD1kpwqQXay
b5aWL4WquJnjy/iXXyBgHTkWBBIOGKCccD3DWqQ3cyXHbrU5lim01fD75ncLwqBJ
UuaTjkVd1OViJYsNBIcYY92IlBQ8t1dIAyQ4uj1yp7RvIxtdqXuT8KCSI9kS3R4=
=5ONt
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150113/7938d21d/attachment.htm>

From eliezer at ngtech.co.il  Tue Jan 13 14:37:09 2015
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Tue, 13 Jan 2015 16:37:09 +0200
Subject: [squid-users] {Disarmed} Re:  site cannot be accessed
In-Reply-To: <26363080.20756.1421122922366.JavaMail.zimbra@baladia.gov.kw>
References: <1878891668.20418.1421044881847.JavaMail.zimbra@baladia.gov.kw>
 <392294731.845905.1421057886713.JavaMail.yahoo@jws10630.mail.bf1.yahoo.com>
 <26363080.20756.1421122922366.JavaMail.zimbra@baladia.gov.kw>
Message-ID: <54B52D95.5050309@ngtech.co.il>

Hey,

Since you provided the pac file I had the chance to convert it into a 
more suitable format to my flavor.

Can you try the wpad file at:
http://www1.ngtech.co.il/tests/wpad.dat

Eliezer

On 13/01/2015 06:22, Simon Dcunha wrote:
> Dear Sarfraz,
> appreciate your immediate reply
>
> Heres attached is my pac file
> i am accessing the 10.101.101.10 server
>
> regards
>
> simon
> ----------------
>




From lars at lhanke.de  Tue Jan 13 14:44:17 2015
From: lars at lhanke.de (Dr. Lars Hanke)
Date: Tue, 13 Jan 2015 15:44:17 +0100
Subject: [squid-users] Traffic prioritizing
In-Reply-To: <54B4F553.2010303@ngtech.co.il>
References: <54B4F3DF.3060307@lhanke.de> <54B4F553.2010303@ngtech.co.il>
Message-ID: <54B52F41.2070508@lhanke.de>

Hi Eliezer:

> There are couple aspects to the issue.
> The options are:
> - TOS marking of specific connections
> - TPROXY(leaving the src IP the same)
> - delay_pools
>
> If you have a shaping setup in place or device that is capable of
> traffic shaping based on TOS marking you can take a look at this option.

TOS marking essentially will mark the GET/POST requests, right? However, 
the size/number of these requests does not correlate well with the 
download bandwidth. 100 AJAX requests may be much less than a single GET 
for some PDF.

Setting up a TPROXY configuration might be interesting, since my current 
transparent proxy appears to have issues with some special devices.

However, it all boils down to limit the outgoing bandwidth. Of course I 
could police incoming packets, but when they arrive the bandwidth is 
wasted already. If dropped, the server will resend and eat my bandwidth 
again.

So my idea was that Squid should have all data required about streams 
any may be the most suitable instance to take action, e.g. delay ACK and 
new requests. delay_pools in general look like the right choice, but I 
could not see a function similar to HTB or HFSC, which both would do the 
trick.

So it could be that I think too complicated, or that I miss something, 
or that there is simply no solution, yet.

If the latter is true, I'll try experimenting with the TOS solution. 
Joined with outgoing ACK throtteling it might work.

Appreciating your comments,
  - lars.

> On 13/01/2015 12:30, Dr. Lars Hanke wrote:
>> I want to prioritize traffic of some subnets over the the rest to avoid
>> leisure traffic killing critical business traffic over a slow network
>> connection. This of course would be a task for tools like tc, but behind
>> the proxy the information of the original IP is lost.
>>
>> I do not want to statically limit the bandwidth of the non-priority
>> traffic. I just want the priority traffic to receive a major share of
>> the bandwidth, if it actually requires it. I'm not sure whether
>> delay_pools can do that.
>>
>> Any ideas how to accomplish this?
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From bpk678 at gmail.com  Tue Jan 13 15:11:10 2015
From: bpk678 at gmail.com (Brendan Kearney)
Date: Tue, 13 Jan 2015 10:11:10 -0500
Subject: [squid-users] {Disarmed} Re:  site cannot be accessed
In-Reply-To: <54B4C980.6040600@ngtech.co.il>
References: <1878891668.20418.1421044881847.JavaMail.zimbra@baladia.gov.kw>
 <392294731.845905.1421057886713.JavaMail.yahoo@jws10630.mail.bf1.yahoo.com>
 <26363080.20756.1421122922366.JavaMail.zimbra@baladia.gov.kw>
 <54B4C980.6040600@ngtech.co.il>
Message-ID: <1421161870.15067.3.camel@desktop.bpk2.com>

On Tue, 2015-01-13 at 09:30 +0200, Eliezer Croitoru wrote:
> Hey,
> 
> Did you had the chance to see this page:
> http://findproxyforurl.com/example-pac-file/
> 
> Eliezer
> 
> On 13/01/2015 06:22, Simon Dcunha wrote:
> > Dear Sarfraz,
> > appreciate your immediate reply
> >
> > Heres attached is my pac file
> > i am accessing the 10.101.101.10 server
> >
> > regards
> >
> > simon
> > ----------------
> >
> >
> >
> >
> >
> >
> > From: "***some text missing***" <shozii1 at yahoo.com>
> > To: "simon" <simon at baladia.gov.kw>, "squid-users" <squid-users at squid-cache.org>
> > Sent: Monday, January 12, 2015 1:18:06 PM
> > Subject: {Disarmed} Re: [squid-users] site cannot be accessed
> >
> >
> > Share your PAC file please.
> >
> > Regards,
> > Sarfraz
> >
> >
> > From: Simon Dcunha <simon at baladia.gov.kw>
> > To: squid-users <squid-users at squid-cache.org>
> > Sent: Monday, January 12, 2015 11:41 AM
> > Subject: [squid-users] site cannot be accessed
> >
> >
> > Dear All,
> >
> > I have squid-3.1.10-22.el6_5.x86_64 running on centos 6.5 64 bit for quite sometime and working fine
> > just a couple of days back some users reported an issue
> >
> > i have a intranet site which just stopped working .
> > if I uncheck the proxy option in the browser the site works fine
> > the above users also use internet and is working fine
> >
> > I am using the pac file to bypass local sites and the local intranet websites are alredy added in the pac file
> >
> > also i am quite sure the above intranet website were working before
> >
> > the squid log shows
> > ------------
> > 1421053747.139 70984 172.16.6.21 TCP_MISS/000 0 GET MailScanner warning: numerical links are often malicious: http://10.101.101.10/ - DIRECT/10.101.101.10 -
> > 1421053779.524 32021 172.16.6.21 TCP_MISS/000 0 GET MailScanner warning: numerical links are often malicious: http://10.101.101.10/ - DIRECT/10.101.101.10 -
> > ----------
> >
> > appreciate your advice and concern
> >
> > regards
> >
> > simon
> >
> >
> >
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
> >
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

an example pac file i started with...
-------------- next part --------------
A non-text attachment was scrubbed...
Name: example_proxy.pac
Type: text/x-matlab
Size: 5270 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150113/41a09e0d/attachment.bin>

From wrkilu at wp.pl  Tue Jan 13 21:28:06 2015
From: wrkilu at wp.pl (Robert)
Date: Tue, 13 Jan 2015 22:28:06 +0100
Subject: [squid-users] Only TCP_MISS
Message-ID: <54b58de63a4078.25464105@wp.pl>

Hi,

I think my Squid doesn't cache. I have Ubuntu 14, I installed Squid from packages (3.3.8) and now from source (3.4.10). In both cases I used just basic configuration like that basic from installing from source. I typed in webbrowser proxy manually and in access.log I get still e.g.:

1421183358.241    528 10.59.1.9 TCP_MISS/200 5430 CONNECT tools.google.com:443 - HIER_DIRECT/2607:f8b0:400d:c06::8b -
1421183397.402 313700 10.59.1.9 TCP_MISS/200 10327 CONNECT s-static.ak.facebook.com:443 - HIER_DIRECT/2600:1404:14:189::236 -
1421183413.126    114 10.59.1.9 TCP_MISS/200 1701 GET http://finance.services.appex.bing.com/Market.svc/AppTileV2? - HIER_DIRECT/23.220.100.184 application/xml
1421183413.136    121 10.59.1.9 TCP_MISS/200 1657 GET http://en-us.appex-rf.msn.com/cgtile/v1/en-US/News/Today.xml - HIER_DIRECT/23.220.100.184 application/xml
1421183413.145    129 10.59.1.9 TCP_MISS/200 1593 GET http://en-us.appex-rf.msn.com/cgtile/v1/en-US/HealthAndFitness/Home.xml? - HIER_DIRECT/23.220.100.184 application/xml
1421183413.147    131 10.59.1.9 TCP_MISS/200 305 GET http://service.weather.microsoft.com/appex/DesktopTile/PreInstallLiveTile? - HIER_DIRECT/23.220.115.174 -
1421183413.216     88 10.59.1.9 TCP_MISS/200 1554 GET http://en-us.appex-rf.msn.com/cgtile/v1/en-US/Sports/Today.xml? - HIER_DIRECT/23.220.100.184 application/xml
1421183413.322    185 10.59.1.9 TCP_MISS_ABORTED/503 1541 GET http://www.amazon.com/gp/am/metro/application/livetileRedirect? - HIER_DIRECT/205.251.242.103 text/html
1421183415.611    132 10.59.1.9 TCP_MISS/206 8526 GET http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87i9P.jpg? - HIER_DIRECT/23.220.133.211 image/jpeg
1421183416.619     34 10.59.1.9 TCP_MISS/206 834 GET http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87i9P.jpg? - HIER_DIRECT/23.220.133.211 image/jpeg
1421183417.094     76 10.59.1.9 TCP_MISS/206 11123 GET http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA86gtq.jpg? - HIER_DIRECT/23.220.133.211 image/jpeg
1421183418.269     52 10.59.1.9 TCP_MISS/206 4882 GET http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87zJF.jpg? - HIER_DIRECT/23.220.133.211 image/jpeg
I don't have any TCP_HIT :( , so what is going on ? why Squid doesn't work ? :(
 
Please help me
Robert
 





From simon at baladia.gov.kw  Wed Jan 14 02:48:56 2015
From: simon at baladia.gov.kw (Simon Dcunha)
Date: Wed, 14 Jan 2015 05:48:56 +0300 (AST)
Subject: [squid-users] {Disarmed} Re:  site cannot be accessed
In-Reply-To: <1920083839.21046.1421203717575.JavaMail.zimbra@baladia.gov.kw>
References: <1878891668.20418.1421044881847.JavaMail.zimbra@baladia.gov.kw>
 <392294731.845905.1421057886713.JavaMail.yahoo@jws10630.mail.bf1.yahoo.com>
 <26363080.20756.1421122922366.JavaMail.zimbra@baladia.gov.kw>
 <54B4C980.6040600@ngtech.co.il>
 <758286236.20821.1421134884695.JavaMail.zimbra@baladia.gov.kw>
 <54B52A57.6050505@ngtech.co.il>
Message-ID: <1849969204.21047.1421203736177.JavaMail.zimbra@baladia.gov.kw>

Dear eliezer,

Sorry for the mail and apologize..
infact i did miss to add the public list email
i will check the the wpad file and let you know


regards

simon

----- Original Message -----
From: "Eliezer Croitoru" <eliezer at ngtech.co.il>
To: "simon" <simon at baladia.gov.kw>
Sent: Tuesday, January 13, 2015 5:23:19 PM
Subject: Re: [squid-users] {Disarmed} Re:  site cannot be accessed

I have no problem answering you privately but I am almost sure that the 
mail was destined to the public list.
If you wish I can compose a pac file that will demonstrate the basics 
for your needs.

Elizer

On 13/01/2015 09:41, Simon Dcunha wrote:
> appreciate if someone can advise and help me
>
>
> regards
>
> simon



-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.



From informatica at riberadelduero.es  Wed Jan 14 07:36:33 2015
From: informatica at riberadelduero.es (=?utf-8?Q?C=C3=A9sar_S=C3=A1nchez_Pascual?=)
Date: Wed, 14 Jan 2015 08:36:33 +0100
Subject: [squid-users] tcp_miss_aborted only with some sites
Message-ID: <008c01d02fcc$d25082f0$76f188d0$@riberadelduero.es>

Thanks Amos for your immediate answer,

If the problem is about this ICMP traffic, the problem is in the proxy. the users can visit this sites normally if don't use the proxy. There is no VPNs and tunnels.

I'm going to analyze this version of Ubuntu server about this issue.

Thanks a lot, I was blocked.


On 13/01/2015 10:45 p.m., C?sar wrote:
> Hi,
> 
> I have installed squid 3.3.8 o a Ubuntu 14 server edition.
> 
> It runs ok except with some sites. In access.log appears an error:
> 
> Example: TCP_MISS_ABORTED/000 GET http://www.magrama.gob.es/es - 
> HIER_DIRECT/93.188.53.33
> 

The client chose to disconnect from Squid before the server
93.188.53.33 sent anything back.

This is usually seen when the traffic travels over networks containing
hardware with broken ECN or TCP Window scaling functionality, or
networks where ICMP is blocked.

The ICMP blocking problem is particularly bad if the traffic is
delivered over a tunnel or VPN link somewhere. As those types of
network connection have non-1500 MTU values that need working ICMP for
path-MTU discovery.

Amos



From squid3 at treenet.co.nz  Wed Jan 14 09:17:10 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 14 Jan 2015 22:17:10 +1300
Subject: [squid-users] Only TCP_MISS
In-Reply-To: <54b58de63a4078.25464105@wp.pl>
References: <54b58de63a4078.25464105@wp.pl>
Message-ID: <54B63416.4060308@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 14/01/2015 10:28 a.m., Robert wrote:
> Hi,
> 
> I think my Squid doesn't cache. I have Ubuntu 14, I installed Squid
> from packages (3.3.8) and now from source (3.4.10). In both cases I
> used just basic configuration like that basic from installing from
> source. I typed in webbrowser proxy manually and in access.log I
> get still e.g.:
> 
> 1421183358.241    528 10.59.1.9 TCP_MISS/200 5430 CONNECT
> tools.google.com:443 - HIER_DIRECT/2607:f8b0:400d:c06::8b - 
> 1421183397.402 313700 10.59.1.9 TCP_MISS/200 10327 CONNECT
> s-static.ak.facebook.com:443 - HIER_DIRECT/2600:1404:14:189::236 -

CONNECT tunnels are not cacheable.

> 1421183413.126    114 10.59.1.9 TCP_MISS/200 1701 GET
> http://finance.services.appex.bing.com/Market.svc/AppTileV2? -
> HIER_DIRECT/23.220.100.184 application/xml 1421183413.136    121
> 10.59.1.9 TCP_MISS/200 1657 GET
> http://en-us.appex-rf.msn.com/cgtile/v1/en-US/News/Today.xml -
> HIER_DIRECT/23.220.100.184 application/xml 1421183413.145    129
> 10.59.1.9 TCP_MISS/200 1593 GET
> http://en-us.appex-rf.msn.com/cgtile/v1/en-US/HealthAndFitness/Home.xml?
> - HIER_DIRECT/23.220.100.184 application/xml 1421183413.147    131
> 10.59.1.9 TCP_MISS/200 305 GET
> http://service.weather.microsoft.com/appex/DesktopTile/PreInstallLiveTile?
> - HIER_DIRECT/23.220.115.174 - 1421183413.216     88 10.59.1.9
> TCP_MISS/200 1554 GET
> http://en-us.appex-rf.msn.com/cgtile/v1/en-US/Sports/Today.xml? -
> HIER_DIRECT/23.220.100.184 application/xml

There are no repeat requests in the above trace. Thus no way to tell
whether a HIT was even possible.

Without query string details the only testable URI was the
News/Today.xml and that says:

* its cacheable for only 6 minutes 5 seconds. Squid will use a
revalidation contitional request to update it on repeat visitors
outside that time...

* The ETag used to identify the reply object uniquely is constantly
changing even when the reply object has *not* changed. So even if
Squid does cache one reply the next update/revalidation check will
says the object changed - which is a MISS instead of REFRESH. Causing...

* An If-None-Match conditional request returned the full content
unchanged.

* An If-Modified-Since conditional request returned the full content
unchanged.

All of that means Squid only ever gets told by the server to discard
its cached content and waste bandwidth re-downloading it. IMHO these
are signs of a rather badly designed site.


> 1421183413.322    185 10.59.1.9 TCP_MISS_ABORTED/503 1541 GET
> http://www.amazon.com/gp/am/metro/application/livetileRedirect? -
> HIER_DIRECT/205.251.242.103 text/html

> 1421183415.611    132 10.59.1.9 TCP_MISS/206 8526 GET
> http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87i9P.jpg? -
> HIER_DIRECT/23.220.133.211 image/jpeg 1421183416.619     34
> 10.59.1.9 TCP_MISS/206 834 GET
> http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87i9P.jpg? -
> HIER_DIRECT/23.220.133.211 image/jpeg 1421183417.094     76
> 10.59.1.9 TCP_MISS/206 11123 GET
> http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA86gtq.jpg? -
> HIER_DIRECT/23.220.133.211 image/jpeg 1421183418.269     52
> 10.59.1.9 TCP_MISS/206 4882 GET
> http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87zJF.jpg? -
> HIER_DIRECT/23.220.133.211 image/jpeg

Partial messages (206) from servers are not cacheable by Squid. And
again the non-logged query parameters may make what appears to be
identical requests actually quite different.

> I don't have any TCP_HIT :( , so what is going on ? why Squid
> doesn't work ? :(
> 

For testing configure:
  strip_query_terms off

Also, how are you doing the testing?
HTTP clients are able to send explicit instructions to proxies
forbidding the use of cache. The curl tools do that by default, and
also the browser "Refresh" or "Reload" buttons.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUtjQWAAoJELJo5wb/XPRjGGYH/ijB2EHSEdaxl9r4tT5dyHjv
3H4cdiUhchEFO2MsGvUOaL4qooO1bJr//IbroLVPmMDy4xHGLMLfk9pxeRFEvt0o
KB01vDSA3Fx75swxTvnKNroteyMd2RMAvkrbmMwKKTiE+Uva/aGxFC4YyPjSLJ4n
kP5BCs1MCq5h+gbUX/spLvRb069GwKXJTIEG5/J01Tv2eD5JqHLJaDFPqjwF3NgS
7zSIk79y8kHruDVnEStSW9ZGDXThRfGtXuMzwXXoFha8DM4VQXr3KiggxJR7F+3t
z9kVQmhSz0Q1PW9t+VTCJdIagEy/M4aR4OrnBN8Rp1sYNDxkjauKeceV5J7KxFs=
=9u9h
-----END PGP SIGNATURE-----


From mattatrmc at gmail.com  Wed Jan 14 16:00:22 2015
From: mattatrmc at gmail.com (mattatrmc)
Date: Wed, 14 Jan 2015 08:00:22 -0800 (PST)
Subject: [squid-users] Configuring the sslbump
In-Reply-To: <CA++fYEjLGBG3pDiveBiLz0dgwPJWg=x4LhTenGQngwp9nWfkFA@mail.gmail.com>
References: <CA++fYEiTvtuwhGuxpkC+rt=22OiFS=7GA_vOMzhzx4Rb_beH8w@mail.gmail.com>
 <CA++fYEjLGBG3pDiveBiLz0dgwPJWg=x4LhTenGQngwp9nWfkFA@mail.gmail.com>
Message-ID: <1421251222361-4669069.post@n4.nabble.com>

Hey Sven,

I'm running into the same problem at the moment, did you have to add that
code to get the program to work, or did you make a new certificate with an
address in the NS.

Thanks,

Matt



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Configuring-the-sslbump-tp4668620p4669069.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From eliezer at ngtech.co.il  Wed Jan 14 16:39:24 2015
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Wed, 14 Jan 2015 18:39:24 +0200
Subject: [squid-users] Squid 3.4.10 RPMs release for CentOS 32 and 64 bit.
In-Reply-To: <54885AAB.2000504@treenet.co.nz>
References: <54885AAB.2000504@treenet.co.nz>
Message-ID: <54B69BBC.8010606@ngtech.co.il>

Published at: http://www1.ngtech.co.il/wpe/?p=8

I am happy to release the new RPMs of squid 3.4.10 and 3.5.0.4 beta for 
Centos 6.6 64bit and 32bit .

The new release includes couple bug fixes and improvements.
The links to the RPMs are at the bottom of the article.

?What if a human would act as a proxy server??


One of the hardest jobs on the planet earth would be a ?proxy? that 
needs to connect between a requester and the right response. The proxy 
would need first to identify the request and understand it properly and 
then needs to decide what to lookup in the database for a corresponding 
response.
It's a very messy job since the source IP and all the request 
characteristics should be answered. In many cases the request will not 
give enough information about the wanted response and the user will need 
to request another time for the requested data. I would assume that it 
would require some buildings to be populated with lots of ?proxies? to 
fulfill all humans web requests. But the reality is not that far from 
this fantasy.
If you would look at the world you would see that lots of humans just 
act as a simple proxy between someone to somebody else or something 
else. A nice example would be when you go to a wood store to buy some 
woods for a fire. If this would be your first time you would not know 
the prices and wood kinds while the wood-shop guy would know more then 
you. He then acts as a proxy between your mind and his to understand the 
different kinds of wood that can fulfill your needs while giving you the 
prices.
And while writing I am thinking about it again, and one of the hardest 
jobs there are in the market is the ?Match Maker?. Just to illustrate 
that a human would have been a proxy and a ?Match Maker?. Actually a 
?Match Maker? job would be to take two different minds and put them 
together while understanding them both enough to make them both happy 
about the meetings.
So how would a ?Match Maker? would act if he was a proxy? He would need 
to fetch or get from the clients information about their wishes and 
analyze their requests to find a matching pair. From the requester side 
he needs something, a companion.
But from the ?Match Maker? point of view there is a need to actually 
find a match which would stick for a very long time and that would not 
cause harm while building love and harmony. I am not a ?Match Maker? but 
I do believe that a simple piece of software can help the human which 
actually needs help from others to do other tasks which a proxy cannot 
do good enough.

* Any notes and comments are wanted and welcome!

For this release I am attaching a video link about DDos and the 
vulnerabilities of the Linux kernel:

- DDoS protection using Netfilter iptables from Jesper Dangaard Brouer
http://www.youtube.com/watch?v=7_8ic1AaRso

Or a local mirror and presentation file at:
http://www1.ngtech.co.il/squid/videos/Jesper Dangaard Brouer - DDoS 
protection using Netfilter_iptables_BklSqr9t4uA.mp4

http://www1.ngtech.co.il/squid/videos/DDoS_protection_Jesper_Brouer/iptables-ddos-mitigation_JesperBrouer.pdf

This release repository is at:
http://www1.ngtech.co.il/rpm/centos/6/x86_64/

This release files are:
http://www1.ngtech.co.il/repo/centos/6/x86_64/squid-3.4.10-1.el6.x86_64.rpm
http://www1.ngtech.co.il/repo/centos/6/x86_64/squid-helpers-3.4.10-1.el6.x86_64.rpm
http://www1.ngtech.co.il/repo/centos/6/x86_64/squid-debuginfo-3.4.10-1.el6.x86_64.rpm

The beta repository was move to:
http://www1.ngtech.co.il/repo/centos/6/beta/x86_64/

The beta release files are:
http://www1.ngtech.co.il/repo/centos/6/beta/x86_64/squid-3.5.0.4-1.el6.x86_64.rpm
http://www1.ngtech.co.il/repo/centos/6/beta/x86_64/squid-helpers-3.5.0.4-1.el6.x86_64.rpm
http://www1.ngtech.co.il/repo/centos/6/beta/x86_64/squid-debuginfo-3.5.0.4-1.el6.x86_64.rpm

To Each and everyone of them there is an *asc* file which contains MD5 
SHA1 SHA2 SHA256 SHA384 SHA512 TIGER hashes.

All The Bests,
Eliezer Croitoru



From wrkilu at wp.pl  Wed Jan 14 22:44:14 2015
From: wrkilu at wp.pl (Robert)
Date: Wed, 14 Jan 2015 23:44:14 +0100
Subject: [squid-users] Odp: Re:  Only TCP_MISS
Message-ID: <54b6f13ee45455.19980433@wp.pl>

Dnia ?roda, 14 Stycznia 2015 10:17 Amos Jeffries <squid3 at treenet.co.nz> napisa?(a)
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> On 14/01/2015 10:28 a.m., Robert wrote:
> > Hi,
> >
> > I think my Squid doesn't cache. I have Ubuntu 14, I installed Squid
> > from packages (3.3.8) and now from source (3.4.10). In both cases I
> > used just basic configuration like that basic from installing from
> > source. I typed in webbrowser proxy manually and in access.log I
> > get still e.g.:
> >
> > 1421183358.241    528 10.59.1.9 TCP_MISS/200 5430 CONNECT
> > tools.google.com:443 - HIER_DIRECT/2607:f8b0:400d:c06::8b -
> > 1421183397.402 313700 10.59.1.9 TCP_MISS/200 10327 CONNECT
> > s-static.ak.facebook.com:443 - HIER_DIRECT/2600:1404:14:189::236 -
> CONNECT tunnels are not cacheable.
> > 1421183413.126    114 10.59.1.9 TCP_MISS/200 1701 GET
> > http://finance.services.appex.bing.com/Market.svc/AppTileV2? -
> > HIER_DIRECT/23.220.100.184 application/xml 1421183413.136    121
> > 10.59.1.9 TCP_MISS/200 1657 GET
> > http://en-us.appex-rf.msn.com/cgtile/v1/en-US/News/Today.xml -
> > HIER_DIRECT/23.220.100.184 application/xml 1421183413.145    129
> > 10.59.1.9 TCP_MISS/200 1593 GET
> > http://en-us.appex-rf.msn.com/cgtile/v1/en-US/HealthAndFitness/Home.xml?
> > - HIER_DIRECT/23.220.100.184 application/xml 1421183413.147    131
> > 10.59.1.9 TCP_MISS/200 305 GET
> > http://service.weather.microsoft.com/appex/DesktopTile/PreInstallLiveTile?
> > - HIER_DIRECT/23.220.115.174 - 1421183413.216     88 10.59.1.9
> > TCP_MISS/200 1554 GET
> > http://en-us.appex-rf.msn.com/cgtile/v1/en-US/Sports/Today.xml? -
> > HIER_DIRECT/23.220.100.184 application/xml
> There are no repeat requests in the above trace. Thus no way to tell
> whether a HIT was even possible.
> Without query string details the only testable URI was the
> News/Today.xml and that says:
> * its cacheable for only 6 minutes 5 seconds. Squid will use a
> revalidation contitional request to update it on repeat visitors
> outside that time...
> * The ETag used to identify the reply object uniquely is constantly
> changing even when the reply object has *not* changed. So even if
> Squid does cache one reply the next update/revalidation check will
> says the object changed - which is a MISS instead of REFRESH. Causing...
> * An If-None-Match conditional request returned the full content
> unchanged.
> * An If-Modified-Since conditional request returned the full content
> unchanged.
> All of that means Squid only ever gets told by the server to discard
> its cached content and waste bandwidth re-downloading it. IMHO these
> are signs of a rather badly designed site.
> > 1421183413.322    185 10.59.1.9 TCP_MISS_ABORTED/503 1541 GET
> > http://www.amazon.com/gp/am/metro/application/livetileRedirect? -
> > HIER_DIRECT/205.251.242.103 text/html
> > 1421183415.611    132 10.59.1.9 TCP_MISS/206 8526 GET
> > http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87i9P.jpg? -
> > HIER_DIRECT/23.220.133.211 image/jpeg 1421183416.619     34
> > 10.59.1.9 TCP_MISS/206 834 GET
> > http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87i9P.jpg? -
> > HIER_DIRECT/23.220.133.211 image/jpeg 1421183417.094     76
> > 10.59.1.9 TCP_MISS/206 11123 GET
> > http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA86gtq.jpg? -
> > HIER_DIRECT/23.220.133.211 image/jpeg 1421183418.269     52
> > 10.59.1.9 TCP_MISS/206 4882 GET
> http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87zJF.jpg? -
> > HIER_DIRECT/23.220.133.211 image/jpeg
> Partial messages (206) from servers are not cacheable by Squid. And
> again the non-logged query parameters may make what appears to be
> identical requests actually quite different.
> > I don't have any TCP_HIT :( , so what is going on ? why Squid
> > doesn't work ? :(
> >
> For testing configure:
>   strip_query_terms off
> Also, how are you doing the testing?
> HTTP clients are able to send explicit instructions to proxies
> forbidding the use of cache. The curl tools do that by default, and
> also the browser "Refresh" or "Reload" buttons.
>  

1. ok , so testing I do by surfing on two sites wp.pl and kosmos.pl , if you think they are wrong please give me samples of sites which will be good for testing 
2. I'm testing by going few time through the same links and also using refresh , and I get most :
TCP_MISS/200
sometimes:
TCP_REFRESH_UNMODIFIED/304 






From squid3 at treenet.co.nz  Thu Jan 15 05:12:13 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 15 Jan 2015 18:12:13 +1300
Subject: [squid-users] [squid-announce] Squid 3.4.11 is available
Message-ID: <54B74C2D.5000502@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

The Squid HTTP Proxy team is very pleased to announce the availability
of the Squid-3.4.11 release!


This release is a bug fix release resolving several issues found in
the prior Squid releases.


The major changes to be aware of:


* "Deleting first fs left psstate->servers pointing to uninitialized
memory"

This obscurely named bug takes the appearance of randomly appearing
high CPU consumption and hanging worker, less commonly a direct crash.
It is not the only cause of overly high CPU usage, but is the major
one now known about in 3.4 series.

This affects all Squid configured with a large number of peers or when
contacting domains with many advertised IP addresses (such as Google
or Facebook).


* Bug #3760: squidclient ignores --disable-ipv6

The squidclient tool would mysteriously attempt to use IPv6 and abort
regardless of IP version probles successfully detecting that protocol
being disabled.

It turns out that Squid has not been correctly filtering out IPv6
results presented by the operating system getaddrinfo() API in the
event that the administrator disabled IPv6 in Squid but not the
operating sytem.

This affects DNS resolution of all domain names when starting and
configuring Squid, but not for regular proxy operational DNS queries.


* Bug #4057: Avoid on-exit crashes when adaptation is enabled.

As the name describes, Squid 3.4.5 and later will crash when shutting
down (or reconfiguring) if adpatation is configued.


* Bug #3754: configure doesnt detect IPFilter 5.1.2 system headers

The Solaris 10 operating system broken IPFilter, both the one built
into Solaris 10 and the publicly available external sources for the tools.

This Squid release includes a hack to workaround that system breakage
and allow Squids part of the IPFilter mechanisms to build and work again.



 All users of Squid are urged to upgrade to this release as soon as
possible.


 See the ChangeLog for the full list of changes in this and earlier
 releases.

Please refer to the release notes at
http://www.squid-cache.org/Versions/v3/3.4/RELEASENOTES.html
when you are ready to make the switch to Squid-3.4

Upgrade tip:
  "squid -k parse" is starting to display even more
   useful hints about squid.conf changes.

This new release can be downloaded from our HTTP or FTP servers

 http://www.squid-cache.org/Versions/v3/3.4/
 ftp://ftp.squid-cache.org/pub/squid/
 ftp://ftp.squid-cache.org/pub/archive/3.4/

or the mirrors. For a list of mirror sites see

 http://www.squid-cache.org/Download/http-mirrors.html
 http://www.squid-cache.org/Download/mirrors.html

If you encounter any issues with this release please file a bug report.
http://bugs.squid-cache.org/


Amos Jeffries
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUt0wtAAoJELJo5wb/XPRjD3gIAJR51FyrE+fnQZ3Nf37A3e5U
sLvcpQClEj9wLPKdg95x+3ocOjvFlRRZgNgTREH50VhGWBooAv5jBgrwnFZ697J5
ikMm9v37R/aTB1rZfsbXswEsedJlb4KqSraiqly963Eicn20uMnEE9NYUHyMlXoW
UeMD6lkRWay5KQZ2LUiyX9Hloiy50qRjuM01QEmeO+p3Lj6X7EqD4u5+zGj5fc23
52HGudftsyOo2Lqv1fmnR3eJMp+6oHD2xqDJB1Nb5Ayngry2ceOTlhD15ZwOcIfK
Xytii0TmLdfnh0Nkg4TWKcPajfCcUJVYVzPW4sQa5d7ZyV3bAa3hVeujqfvRfN0=
=UMfa
-----END PGP SIGNATURE-----
_______________________________________________
squid-announce mailing list
squid-announce at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-announce

From rafael.akchurin at diladele.com  Thu Jan  8 14:50:49 2015
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Thu, 8 Jan 2015 14:50:49 +0000
Subject: [squid-users] how to obtain info about actual active downloads?
In-Reply-To: <54AE6B5C.20600@gmail.com>
References: <544E4977.3050705@hanzlici.cz>
 <20150108044739.GA23887@cgb-linux.rcmb.lan> <54AE5693.40003@gmail.com>
 <20150108112138.GB27876@cgb-linux.rcmb.lan>,<54AE6B5C.20600@gmail.com>
Message-ID: <1420728648447.15556@diladele.com>

Hello all,

Sorry to jump on the running train :) having all ICAPed connections in our ICAP server (qlproxyd) we generate something like this for the Surfing Now page. As we are mostly interested in web filtering stuff the size may not be correct but I presume this can be adjusted to show what you need in the next version.

If you'd dump your mindset on how you'd like to see it ideally I could take a look in qlproxy 4.2 when we redesign our reports subsystem.
Milestone is - https://github.com/ra-at-diladele-com/qlproxy_external/milestones/4.2

The current view is attached.

Raf

________________________________________
From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Yuri Voinov <yvoinov at gmail.com>
Sent: Thursday, January 8, 2015 12:34 PM
To: Chris Bennett
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] how to obtain info about actual active downloads?

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

No,

the same error with ncurses-dev.


08.01.2015 17:21, Chris Bennett ?????:
>> Configure with errors:
>>
>> checking for cerrno... yes
>> checking climits usability... yes
>> checking climits presence... yes
>> checking for climits... yes
>> checking for gethostbyname... no
>> configure: error: Unable to find some C functions
>
> You probably need gcc-c++ installed.
>
> What distro are you using?  I've just successfully compiled it on
> clean CentOS 6 and 7 machines and the only requirements for
> compilation were gcc-c++ and ncurses-devel
>
>   ie. yum install gcc-c++ ncurses-devel
>
> Regards,
>
> Chris

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2

iQEcBAEBAgAGBQJUrmtbAAoJENNXIZxhPexGLskH/RR2wgzthJyjAMiiCUSGVae4
LsNYsIFnsbSnBWctis/XN+peigChhaRuSYO/djxYsFkdv0sOLXUM8b+cBpuZqwb6
BdzX39PayNHr63J4sPocQ+GMVyONe8mpYkSj5Uxxh2z4n7kr1JQEOdW1jkdfz4ff
YT3xl/Gv7xjpqNZ+kVqHc/S3KZa7ErvtAjoEzIBnWvCduUeOQlcnJahed8HQgxds
XglApxuZWKDva/gzldMJlc16kfAFoJl+iWbpYTe3T7ntwAWTzdJjqi5VZ8dVqZ0N
FfShrC4r/ngqYETbFpLhCVU5lb3DmvoUR/eQNXcrgq9DFsMZOg4+7pxLOcIrywY=
=Pbhu
-----END PGP SIGNATURE-----

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
A non-text attachment was scrubbed...
Name: surfing_now.png
Type: image/png
Size: 389645 bytes
Desc: surfing_now.png
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150108/f99ae24a/attachment.png>

From lameventanas at gmail.com  Thu Jan 15 10:00:18 2015
From: lameventanas at gmail.com (Alan)
Date: Thu, 15 Jan 2015 19:00:18 +0900
Subject: [squid-users] Compiling Squid without log messages
Message-ID: <CAFKaCCQkw4XBU+yf2V+NxS4dewd8v54=-Phk9EQSOUk6Wk7YVg@mail.gmail.com>

Hello,

I want to have a minimal Squid installation.
So I compiled disabling everything I don't need.
The resulting /usr/sbin/squid is 3.4 Mb.

Since I don't need logging, I decided to remove that as well, but its
not easy to do with sed since sometimes log messages span multiple
lines.

So I changed the definition for debugs() in Debug.h like this:


 /* Debug stream */
+#ifdef NODEBUG
+#define debugs(SECTION, LEVEL, CONTENT) ((void)0)
+#else
 #define debugs(SECTION, LEVEL, CONTENT) \
    do { \
         if ((Debug::level = (LEVEL)) <= Debug::Levels[SECTION]) { \
@@ -116,6 +119,7 @@
             Debug::finishDebug(); \
         } \
    } while (/*CONSTCOND*/ 0)
+#endif


And compiled with -DNODEBUG.
The resulting binary is 2.1 Mb, a 60% size reduction!

But it doesn't work properly, and since there is no log, its hard to debug.

A trace shows it accepts requests, makes them to the HTTP server, but
after that it closes the connection to the HTTP client.

Any ideas?


From squid3 at treenet.co.nz  Thu Jan 15 10:59:10 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 15 Jan 2015 23:59:10 +1300
Subject: [squid-users] Compiling Squid without log messages
In-Reply-To: <CAFKaCCQkw4XBU+yf2V+NxS4dewd8v54=-Phk9EQSOUk6Wk7YVg@mail.gmail.com>
References: <CAFKaCCQkw4XBU+yf2V+NxS4dewd8v54=-Phk9EQSOUk6Wk7YVg@mail.gmail.com>
Message-ID: <54B79D7E.5090206@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 15/01/2015 11:00 p.m., Alan wrote:
> Hello,
> 
> I want to have a minimal Squid installation. So I compiled
> disabling everything I don't need. The resulting /usr/sbin/squid is
> 3.4 Mb.
> 
> Since I don't need logging, I decided to remove that as well, but
> its not easy to do with sed since sometimes log messages span
> multiple lines.
> 
> So I changed the definition for debugs() in Debug.h like this:
> 
> 
> /* Debug stream */ +#ifdef NODEBUG +#define debugs(SECTION, LEVEL,
> CONTENT) ((void)0) +#else #define debugs(SECTION, LEVEL, CONTENT)
> \ do { \ if ((Debug::level = (LEVEL)) <= Debug::Levels[SECTION]) {
> \ @@ -116,6 +119,7 @@ Debug::finishDebug(); \ } \ } while
> (/*CONSTCOND*/ 0) +#endif
> 
> 
> And compiled with -DNODEBUG. The resulting binary is 2.1 Mb, a 60%
> size reduction!
> 
> But it doesn't work properly, and since there is no log, its hard
> to debug.
> 
> A trace shows it accepts requests, makes them to the HTTP server,
> but after that it closes the connection to the HTTP client.
> 
> Any ideas?

Well ... take a guess where to look :-P

If you are disabling anything via manual alteration of the code
instead of the ./configure --disable options (you mention using sed)
then one of the things you *do* need is the debugs() logging.

cache.log / debugs() is not just for debugging either. It is also for
recording major/critical events that you as administrator really,
really need to be made aware of.



Though, on the diagnosis I suggest at least trying with a macro name
other than "NODEBUG". For some reason that macro is used to disable
the assertion handling.


Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUt519AAoJELJo5wb/XPRjjDcH/jw+0nRZEfpu4ydg7M0q73PY
IVZFWXO6jc1WPKBoix7QoOiRDE95/umt5vKtMo9EkENhTLyPIwcggfql8aDhQYv2
uqR0To+wXECK9N6FfYentOFAONayeI2ecKy1Ttp+SMkjbg5xTzVwDZcyyQkxpiFE
uTa8um39PS7hSr255+WNA6wcsmDpa8B3BOioSp8TDUnOu/ImnH7A8XI2MfsjicTH
S8ijQ6eFP6YcAOrzPF8eJbWP3gqZVSyA7C815ZdiySRgwF34ym24RhoGx0yi+nqE
QrIunGZH6gMZsypeqW6I3TwWfYmYEqYTvASZyUA2MA7bU0GTuJtkJWR7cTnJ8Mg=
=4Xlr
-----END PGP SIGNATURE-----


From yvoinov at gmail.com  Thu Jan 15 11:00:35 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 15 Jan 2015 17:00:35 +0600
Subject: [squid-users] How to know, which CA certificate is absent?
Message-ID: <54B79DD3.1040302@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Hi gents,

I have question.

Look:

2015/01/15 16:48:50 kid1| clientNegotiateSSL: Error negotiating SSL
connection on FD 209: error:14094418:SSL routines:SSL3_READ_BYTES:tlsv1
alert unknown ca (1/0)
2015/01/15 16:50:50 kid1| clientNegotiateSSL: Error negotiating SSL
connection on FD 216: error:14094418:SSL routines:SSL3_READ_BYTES:tlsv1
alert unknown ca (1/0)
2015/01/15 16:52:51 kid1| clientNegotiateSSL: Error negotiating SSL
connection on FD 42: error:14094418:SSL routines:SSL3_READ_BYTES:tlsv1
alert unknown ca (1/0)
2015/01/15 16:54:54 kid1| clientNegotiateSSL: Error negotiating SSL
connection on FD 107: error:14094418:SSL routines:SSL3_READ_BYTES:tlsv1
alert unknown ca (1/0)

Question is: How to debug SSL bump to know, which intermediate
certificate is absent in capath to get and install it to avoid this
annoying messages?

WBR, Yuri
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUt53TAAoJENNXIZxhPexGOjQIALajScJu2Q0yItmB+tyeo8rn
sSslibis5GiMrUaN/KlAMD8IN9g8AMPi9NIZKOR8BUqFJFvhcUZknFUpWkWu6Ceb
eQPO3qTBZUUjsNch/eILaXTaq+eOhWBsrHi639vvyxTz+uwzHVMTgA8K3OH62bJ9
L9Ew/dI+mgkRMBKMgakr6J4IdyrjNSBQN2ln8fiKyRJFygej0VFLjfUllYb4OC9i
QsgXLPBYo6k2S+LCNGZefkS3AvydqhicedhYo+hP2IRd7/9Pmk4gDTpYc1v0vXXa
kNOv/HfZn1nVXJNjLH2Pf/7+aZKwDBlKRYMl68TL8mDpZbXG0l2vpIHhNwXElbg=
=aDgE
-----END PGP SIGNATURE-----



From squid3 at treenet.co.nz  Thu Jan 15 11:10:06 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 16 Jan 2015 00:10:06 +1300
Subject: [squid-users] How to know, which CA certificate is absent?
In-Reply-To: <54B79DD3.1040302@gmail.com>
References: <54B79DD3.1040302@gmail.com>
Message-ID: <54B7A00E.9040408@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 16/01/2015 12:00 a.m., Yuri Voinov wrote:
> 
> Hi gents,
> 
> I have question.
> 
> Look:
> 
> 2015/01/15 16:48:50 kid1| clientNegotiateSSL: Error negotiating
> SSL connection on FD 209: error:14094418:SSL
> routines:SSL3_READ_BYTES:tlsv1 alert unknown ca (1/0) 2015/01/15
> 16:50:50 kid1| clientNegotiateSSL: Error negotiating SSL connection
> on FD 216: error:14094418:SSL routines:SSL3_READ_BYTES:tlsv1 alert
> unknown ca (1/0) 2015/01/15 16:52:51 kid1| clientNegotiateSSL:
> Error negotiating SSL connection on FD 42: error:14094418:SSL
> routines:SSL3_READ_BYTES:tlsv1 alert unknown ca (1/0) 2015/01/15
> 16:54:54 kid1| clientNegotiateSSL: Error negotiating SSL connection
> on FD 107: error:14094418:SSL routines:SSL3_READ_BYTES:tlsv1 alert
> unknown ca (1/0)
> 
> Question is: How to debug SSL bump to know, which intermediate 
> certificate is absent in capath to get and install it to avoid
> this annoying messages?

The message is generated by OpenSSL and is all we get given.

AFAIK a manual test using the openssl command line tool is needed to
find out more.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUt6AOAAoJELJo5wb/XPRjcAIH/15EyfBYzgVQMjDRo2tcopuK
fs/gxnizA0ZMgcZrbszbqJpnFyLgwX1FPpJRYcJNVDrEk5XTUee4bwPcMEj9UgzD
oHHt2yLWIBC3kXVFlCiA1U49PStkF6zfs9hkVG6FZ5FBCUJFwIBaUouSwOcK+P48
v92KeMjtdfw8PuVGXKTeZXWpJ4tW+68KRdSrqEkdKxoaMIn/JrzzPBD56ageE852
ekRLCp1Mpq1okEvjbQK9UubpT5mJ4o31WZ+ayEStDqosqe4EYj+w+uPRE8Pi/uGl
XdZTOlEBrWlQ0Lc1vKa7AWMcvB21GuZvIWeq+9sgKoNB+bKgzApmSDVWSKd3sZI=
=o8wN
-----END PGP SIGNATURE-----


From yvoinov at gmail.com  Thu Jan 15 11:14:19 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 15 Jan 2015 17:14:19 +0600
Subject: [squid-users] How to know, which CA certificate is absent?
In-Reply-To: <54B7A00E.9040408@treenet.co.nz>
References: <54B79DD3.1040302@gmail.com> <54B7A00E.9040408@treenet.co.nz>
Message-ID: <54B7A10B.1060803@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Is it possible to know though URL, wich is got an error?

Because of messsage not informative itself.

15.01.2015 17:10, Amos Jeffries ?????:
> On 16/01/2015 12:00 a.m., Yuri Voinov wrote:
>
> > Hi gents,
>
> > I have question.
>
> > Look:
>
> > 2015/01/15 16:48:50 kid1| clientNegotiateSSL: Error negotiating
> > SSL connection on FD 209: error:14094418:SSL
> > routines:SSL3_READ_BYTES:tlsv1 alert unknown ca (1/0) 2015/01/15
> > 16:50:50 kid1| clientNegotiateSSL: Error negotiating SSL connection
> > on FD 216: error:14094418:SSL routines:SSL3_READ_BYTES:tlsv1 alert
> > unknown ca (1/0) 2015/01/15 16:52:51 kid1| clientNegotiateSSL:
> > Error negotiating SSL connection on FD 42: error:14094418:SSL
> > routines:SSL3_READ_BYTES:tlsv1 alert unknown ca (1/0) 2015/01/15
> > 16:54:54 kid1| clientNegotiateSSL: Error negotiating SSL connection
> > on FD 107: error:14094418:SSL routines:SSL3_READ_BYTES:tlsv1 alert
> > unknown ca (1/0)
>
> > Question is: How to debug SSL bump to know, which intermediate
> > certificate is absent in capath to get and install it to avoid
> > this annoying messages?
>
> The message is generated by OpenSSL and is all we get given.
>
> AFAIK a manual test using the openssl command line tool is needed to
> find out more.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUt6ELAAoJENNXIZxhPexGHi0IALp9w7bNWyXZ2dlaK4/Gxx2R
4l/FkP54lYhP6IASFbUqBFTdIL6HqRorlnrB0+Dk2FfaR6T316OMmC6fBXMCE3WO
gbpdFwp5hX3EE3IqV4pSzYW0EWkVQ9oJ/NIBVj3NzHm1S4UQqGuGi+3NwbMuH1hX
YfZCYgEJrrpSQrcy908VyAKqbjeiSxRdtKMpu4MUPP9y+Z/iQ3HJYIff5clLbS+c
TaWr17Epk/Mhg+YzFG+2isLlzXakhVcyHx13sJtY8dzaRhk8yav5Fo0qroRKlYzA
QPsy2BcBziah6XV2E5Dk+Hfevir01gGijXy0MCDVXJds8rAGcLPO1AXlm6PedlE=
=Bn++
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150115/ebd1c8a4/attachment.htm>

From squid3 at treenet.co.nz  Thu Jan 15 11:23:25 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 16 Jan 2015 00:23:25 +1300
Subject: [squid-users] How to know, which CA certificate is absent?
In-Reply-To: <54B7A10B.1060803@gmail.com>
References: <54B79DD3.1040302@gmail.com> <54B7A00E.9040408@treenet.co.nz>
 <54B7A10B.1060803@gmail.com>
Message-ID: <54B7A32D.90603@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 16/01/2015 12:14 a.m., Yuri Voinov wrote:
> 
> Is it possible to know though URL, wich is got an error?
> 

There is no URL involved.

All that has happened is that the client opened a TCP connection to
Squid then the TLS started happening on that connection ... and fails.

Which is why I recommend the openssl command line tool, use it to
connect to Squid and it should report whats going on.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUt6MtAAoJELJo5wb/XPRj54YIAJbbFZd2uRdai4yuW1KEhFZm
6k5ufzoDSXdxTluv+pnBfVK6rM3bAnZ0WxZLk5Ml1ysuAbFrCyJ9th+dkqQoDdpx
x56TgFSP9INEdnAbEajH6tmWKFiumI0YnWfA++me3kZYKvR0143a0ZQIpQ7T3G1C
oru7SPob5/Y9lFeS2DgETEeaPtYr46xdIqZN4p6bVHrWvd0QBuIwGfG3HAyms7mW
ueo0FkdFb06Vq+HhgLPv4796lcWct/o85+9wU0yU4UsM6Gu/zHvB3UgA++lDnVax
FziVemEakheG+vyGRpcApUoGKxRWs22Q5a4bmJRbOT9VpiamLdbdpU0chhbyzJs=
=NR3D
-----END PGP SIGNATURE-----


From wrkilu at wp.pl  Thu Jan 15 11:44:48 2015
From: wrkilu at wp.pl (Robert)
Date: Thu, 15 Jan 2015 12:44:48 +0100
Subject: [squid-users] Odp:  Odp: Re:  Only TCP_MISS
Message-ID: <54b7a830ae6eb9.15478870@wp.pl>

[...]
 
> > 1421183413.322    185 10.59.1.9 TCP_MISS_ABORTED/503 1541 GET
> > > http://www.amazon.com/gp/am/metro/application/livetileRedirect? -
> > > HIER_DIRECT/205.251.242.103 text/html
> > > 1421183415.611    132 10.59.1.9 TCP_MISS/206 8526 GET
> > > http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87i9P.jpg? -
> > > HIER_DIRECT/23.220.133.211 image/jpeg 1421183416.619     34
> > > 10.59.1.9 TCP_MISS/206 834 GET
> > > http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87i9P.jpg? -
> > > HIER_DIRECT/23.220.133.211 image/jpeg 1421183417.094     76
> > > 10.59.1.9 TCP_MISS/206 11123 GET
> > > http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA86gtq.jpg? -
> > > HIER_DIRECT/23.220.133.211 image/jpeg 1421183418.269     52
> > > 10.59.1.9 TCP_MISS/206 4882 GET
> > http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87zJF.jpg? -
> > > HIER_DIRECT/23.220.133.211 image/jpeg
> > Partial messages (206) from servers are not cacheable by Squid. And
> > again the non-logged query parameters may make what appears to be
> > identical requests actually quite different.
> > > I don't have any TCP_HIT :( , so what is going on ? why Squid
> > > doesn't work ? :(
> > >
> > For testing configure:
> >   strip_query_terms off
> > Also, how are you doing the testing?
> > HTTP clients are able to send explicit instructions to proxies
> > forbidding the use of cache. The curl tools do that by default, and
> > also the browser "Refresh" or "Reload" buttons.
> > 
>  
> 1. ok , so testing I do by surfing on two sites wp.pl and kosmos.pl , if you think they are wrong please give me samples of sites which will be good for testing
> 2. I'm testing by going few time through the same links and also using refresh , and I get most :
> TCP_MISS/200
> sometimes:
> TCP_REFRESH_UNMODIFIED/304
>  
>  
>  


Could somebody help me and answer ? 

Best question in my situation now is: on which sites I can test Squid to see TCP_HIT messages in log?





From yvoinov at gmail.com  Thu Jan 15 11:54:00 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 15 Jan 2015 17:54:00 +0600
Subject: [squid-users] Odp:  Odp: Re:  Only TCP_MISS
In-Reply-To: <54b7a830ae6eb9.15478870@wp.pl>
References: <54b7a830ae6eb9.15478870@wp.pl>
Message-ID: <54B7AA58.2090707@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
This URL

http://www.squid-cache.org/Images/img4.jpg

produces HIT on second query.

15.01.2015 17:44, Robert ?????:
> [...]
> 
>>> 1421183413.322    185 10.59.1.9 TCP_MISS_ABORTED/503 1541 GET
>>>> http://www.amazon.com/gp/am/metro/application/livetileRedirect? -
>>>> HIER_DIRECT/205.251.242.103 text/html
>>>> 1421183415.611    132 10.59.1.9 TCP_MISS/206 8526 GET
>>>> http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87i9P.jpg? -
>>>> HIER_DIRECT/23.220.133.211 image/jpeg 1421183416.619     34
>>>> 10.59.1.9 TCP_MISS/206 834 GET
>>>> http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87i9P.jpg? -
>>>> HIER_DIRECT/23.220.133.211 image/jpeg 1421183417.094     76
>>>> 10.59.1.9 TCP_MISS/206 11123 GET
>>>> http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA86gtq.jpg? -
>>>> HIER_DIRECT/23.220.133.211 image/jpeg 1421183418.269     52
>>>> 10.59.1.9 TCP_MISS/206 4882 GET
>>> http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87zJF.jpg? -
>>>> HIER_DIRECT/23.220.133.211 image/jpeg
>>> Partial messages (206) from servers are not cacheable by Squid. And
>>> again the non-logged query parameters may make what appears to be
>>> identical requests actually quite different.
>>>> I don't have any TCP_HIT :( , so what is going on ? why Squid
>>>> doesn't work ? :(
>>>>
>>> For testing configure:
>>>   strip_query_terms off
>>> Also, how are you doing the testing?
>>> HTTP clients are able to send explicit instructions to proxies
>>> forbidding the use of cache. The curl tools do that by default, and
>>> also the browser "Refresh" or "Reload" buttons.
>>>
>> 
>> 1. ok , so testing I do by surfing on two sites wp.pl and kosmos.pl ,
if you think they are wrong please give me samples of sites which will
be good for testing
>> 2. I'm testing by going few time through the same links and also
using refresh , and I get most :
>> TCP_MISS/200
>> sometimes:
>> TCP_REFRESH_UNMODIFIED/304
>> 
>> 
>> 
>
>
> Could somebody help me and answer ?
>
> Best question in my situation now is: on which sites I can test Squid
to see TCP_HIT messages in log?
>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUt6pYAAoJENNXIZxhPexGDzMIAKZLfHQ4PGAjra7yNar8zB98
FZyMh+45N+HHHrhAvf0+7XOH2Vpfd76AW94oDRLXPxkAtVbVgFhLv1e9N3NXrnzE
eGiC7SdkJxCqr0Yp26FFPokWxloNmvCiIcJxN3dSCGAiwULbt3+XqDZqszFD6eS7
Ha7RCcyZhzq3USxzs+9g3zJ6HobMSp8v/wCK59OZclBGLf7qZ9naa8yuCnIt4OB/
yqo82vv57+fAzu5WUGmxE2kRRFiyCv3QncWmRStrHoR40VJLNPoKqMVA7i2vmFlg
06btRQrtGEx870uMW89H8Ip0PwMNEgvfYT4FcRKDj1hGekD4/4OvsQF5zk3SXbM=
=zdvp
-----END PGP SIGNATURE-----



From yvoinov at gmail.com  Thu Jan 15 11:56:13 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 15 Jan 2015 17:56:13 +0600
Subject: [squid-users] How to know, which CA certificate is absent?
In-Reply-To: <54B7A32D.90603@treenet.co.nz>
References: <54B79DD3.1040302@gmail.com> <54B7A00E.9040408@treenet.co.nz>
 <54B7A10B.1060803@gmail.com> <54B7A32D.90603@treenet.co.nz>
Message-ID: <54B7AADD.1030206@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
I.e,

easy way to identify problem URL does not exists. Excluding user complaints.

Right?

I thinking about correllation analyses between access.log and cache.log. ;)


15.01.2015 17:23, Amos Jeffries ?????:
> On 16/01/2015 12:14 a.m., Yuri Voinov wrote:
>
> > Is it possible to know though URL, wich is got an error?
>
>
> There is no URL involved.
>
> All that has happened is that the client opened a TCP connection to
> Squid then the TLS started happening on that connection ... and fails.
>
> Which is why I recommend the openssl command line tool, use it to
> connect to Squid and it should report whats going on.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUt6rdAAoJENNXIZxhPexGaagH/1hSevSrH9QsTm+N8TGgjz/Z
oMxWzhbsGYBjwQpk91lkqxl9V8vJkeXPTloSPjo3tEUqWq03KW1wkh7+4ImqwQ2x
hvNmtkRntnJDYDyHvQQZeA+98kUoJKCp70Ac/Z2Ap7Dforz9Rd+PlYT18iru86D3
LyyqQ0zYtbH8qLipGy8VV8m0SttU826OVHDzCO+8JJv7pjmrge7RvkkLpLtCu3wJ
j6GYWQzz9P8rUNEOBMcy6filthcAAOiXiIWcT452lhzpAabA4FsNxgIbW8mOrfNo
Fmbg1c/JE/7H+XQ/yIgs+UCQU2OY+Z+uQczUuToYvWvcGzCKJUUPJExl+gBaabU=
=OSul
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150115/1dfc8b58/attachment.htm>

From squid3 at treenet.co.nz  Thu Jan 15 12:02:11 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 16 Jan 2015 01:02:11 +1300
Subject: [squid-users] Traffic prioritizing
In-Reply-To: <54B52F41.2070508@lhanke.de>
References: <54B4F3DF.3060307@lhanke.de> <54B4F553.2010303@ngtech.co.il>
 <54B52F41.2070508@lhanke.de>
Message-ID: <54B7AC43.4000204@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 14/01/2015 3:44 a.m., Dr. Lars Hanke wrote:
> Hi Eliezer:
> 
>> There are couple aspects to the issue. The options are: - TOS
>> marking of specific connections - TPROXY(leaving the src IP the
>> same) - delay_pools
>> 
>> If you have a shaping setup in place or device that is capable
>> of traffic shaping based on TOS marking you can take a look at
>> this option.
> 
> TOS marking essentially will mark the GET/POST requests, right?
> However, the size/number of these requests does not correlate well
> with the download bandwidth. 100 AJAX requests may be much less
> than a single GET for some PDF.

The TOS marking is *set* when the request starts. But it remains in
use until the transaction finishes and the next begins. QoS policy
should be able to do things like associate incoming packets on the
connection to the assigned flow.

> 
> Setting up a TPROXY configuration might be interesting, since my
> current transparent proxy appears to have issues with some special
> devices.
> 
> However, it all boils down to limit the outgoing bandwidth. Of
> course I could police incoming packets, but when they arrive the
> bandwidth is wasted already. If dropped, the server will resend and
> eat my bandwidth again.
> 
> So my idea was that Squid should have all data required about
> streams any may be the most suitable instance to take action, e.g.
> delay ACK and new requests. delay_pools in general look like the
> right choice, but I could not see a function similar to HTB or
> HFSC, which both would do the trick.

Squid knows only what is at the HTTP level and some IP:port etc
details that TCP provides. All of the overheads are unknown to Squid.

The delay pools in Squid are a mix of both HTB and HFSC. The
delay_pool_access directive does HFSC-like selection of what pool to
apply each transaction to. Then the pool bandwidth is managed with HTB
algorithm using delay_parameters and a fixed 1 second refresh cycle,
and applied only to the HTTP reply messages. Thus only a *speed*
limiter, they slow download traffic but do not quota control it nor
account for uploads.

> 
> So it could be that I think too complicated, or that I miss
> something, or that there is simply no solution, yet.
> 
> If the latter is true, I'll try experimenting with the TOS
> solution. Joined with outgoing ACK throtteling it might work.
> 

I realy do think that is better, as it manages both request and reply
packets. More importantly its applied to the actual *packets* instead
of just the reply/download payload segments.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUt6xCAAoJELJo5wb/XPRj10QH/i4oc83HAvtx2/r3zVlU5TW5
Pjh9T5hmiZnVh+wyfYFpJplyi5n1u0MrW12WyUOltDo/Wfyn4Ae/ZaqV9tG50uaY
VPaQCGTpHhXvWS51tc9CUWlmfzkBGbqgQo8Re3gLpi++GjrgCyts4m0hzu/7/mhA
frv0UEY7/3+JEe7jevWJ5w25VRORPvfaVWRwDYNtuKWTZZFxRA8qt0EQWc9cYuSS
inSgOFvxvVvNOc1RKPmeud2RSFt/zGPoUZtzCSFDNabCLKYuzK33v60nd4EgX4cm
3/WXYlJhUjXvNCThNZjZca2eTrPT3lbBWTd265j9pi43AosBf9Cnrw+vHwB2iSw=
=FuaY
-----END PGP SIGNATURE-----


From gehrer-alexander at kwa.de  Thu Jan 15 12:43:28 2015
From: gehrer-alexander at kwa.de (gehrer.a)
Date: Thu, 15 Jan 2015 04:43:28 -0800 (PST)
Subject: [squid-users] ntlm: No such file or directory
Message-ID: <1421325808887-4669085.post@n4.nabble.com>

Try on a pfsense with squid 3.4.10 an ntlm-authentication.
In my suid.conf:
/auth_param ntlm program /usr/local/bin/ntlm_auth
--helper-protocol=squid-2.5-ntlmssp/
When I restart squid I always see this in my syslog:

Jan 15 13:38:35 pf4322 squid: auth_param ntlm program
/usr/local/bin/ntlm_auth: (2) No such file or directory

But the path to ntlm_auth is right! I can start /usr/local/bin/ntlm_auth
from the shell. So what file or directory does he means?

Thanks very much in advance

Alex



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/ntlm-No-such-file-or-directory-tp4669085.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From yvoinov at gmail.com  Thu Jan 15 12:50:32 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 15 Jan 2015 18:50:32 +0600
Subject: [squid-users] Too much assertion failed: comm.cc:178:
 "fd_table[conn->fd].halfClosedReader != NULL"
Message-ID: <54B7B798.1050908@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Hi gents,

Sometimes I have too much assertions:

2015/01/08 09:40:39 kid1| assertion failed: comm.cc:178:
"fd_table[conn->fd].halfClosedReader != NULL"

Core dump not produced but Squid restarts. So, I can't get stack trace.

When I set hals_closed_clients to on, I've got much more assertions:

2015/01/15 18:41:31 kid1| assertion failed: comm.cc:1823: "isOpen(fd) &&
!commHasHalfClosedMonitor(fd)"

What can be wrong? This is very annoying behaviour. Also memory cache is
often cold after restarts and hit ratio is degrades.

This looks similar adaptation bug 4057, but it is closed in 3.4.11. This
behaviour depends half-closed connections, but how?

And how to troubleshoot?

WBR, Yuri


-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUt7eXAAoJENNXIZxhPexGGTsH/0QbaUVC+HY9+Czd1EkGKkBE
2iZSk6pmRZkV+1NlRJeaVKCAuBrRADEqKoCEYFqJD9IAFcXYa9fNDfYP5jeOrbb9
fKZ3cGqWjDuWx4jm0Y/gu/knamHtSSD3ZFIEOpUUCzEMcRVnQNjQ2K+5zgFr/aIA
QX6huBLl5MZR+TE7k1gLrAFw8Y0EZG1UGsolo4hX/h3tpqDQGazIr+5M6xmIotXT
k1jJmaa06cfMR6nYwjPNPjWo+CvLLjpsGcgRyJ9qs2FCODpEyR09QXs7a64sD7fI
KTtge3BSz5+Wbz4vePO/o4IoP3nJk1GBSzRfiJLNXef5VWAXFr89ykjErVPFb2w=
=HuN3
-----END PGP SIGNATURE-----




From squid3 at treenet.co.nz  Thu Jan 15 13:03:43 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 16 Jan 2015 02:03:43 +1300
Subject: [squid-users] ntlm: No such file or directory
In-Reply-To: <1421325808887-4669085.post@n4.nabble.com>
References: <1421325808887-4669085.post@n4.nabble.com>
Message-ID: <54B7BAAF.20209@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 16/01/2015 1:43 a.m., gehrer.a wrote:
> Try on a pfsense with squid 3.4.10 an ntlm-authentication. In my
> suid.conf: /auth_param ntlm program /usr/local/bin/ntlm_auth 
> --helper-protocol=squid-2.5-ntlmssp/ When I restart squid I always
> see this in my syslog:
> 
> Jan 15 13:38:35 pf4322 squid: auth_param ntlm program 
> /usr/local/bin/ntlm_auth: (2) No such file or directory
> 
> But the path to ntlm_auth is right! I can start
> /usr/local/bin/ntlm_auth from the shell. So what file or directory
> does he means?

It means what you thought it did. However there are a few reasons why
Squid may be unable to see a file there:

Is Squid running within a chroot? that including if squid.conf
contains the "chroot_dir" config directive. The path must exist inside
the chroot area.

Are there SELinux or Apparmor running on this machine? Several OS
distros enable those system protectinos by default, and with settings
that forbid Squid to access anywhere outside its own directories.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUt7qvAAoJELJo5wb/XPRjuWYIALWCKyqOHvLamz04kfQ79uje
50W4dp5koUGPo20LTcbIe+v25GEsWN5DQHSxRwcmdrLScri8wQFXyMqgUdKwvQW9
20ob368S99vt65RCiWHvI0GZTL8ynrzNEgoayzPGXyK+2kYbbF5wLvuK8i+6n47k
qknAZF1C84MyRiJW32GE111muL3yfWJnKMB2viiicvgs8rQUe1Et5eqyC50RvdFZ
kFpcSSoziaQY5VZ9Uscyx2h+eY7Jnn9TVXVaOC2hJNX5zf9SvygXckp0rt0Xk8ET
gFZVX0HJWSCIqry/8vX+bdL4TqMSs9eKWOeaAP7ewbsZ0z0IqK70V15hv908yHM=
=PdPY
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Thu Jan 15 13:14:48 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 16 Jan 2015 02:14:48 +1300
Subject: [squid-users] Too much assertion failed: comm.cc:178:
 "fd_table[conn->fd].halfClosedReader != NULL"
In-Reply-To: <54B7B798.1050908@gmail.com>
References: <54B7B798.1050908@gmail.com>
Message-ID: <54B7BD48.7050200@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 16/01/2015 1:50 a.m., Yuri Voinov wrote:
> 
> Hi gents,
> 
> Sometimes I have too much assertions:
> 
> 2015/01/08 09:40:39 kid1| assertion failed: comm.cc:178: 
> "fd_table[conn->fd].halfClosedReader != NULL"
> 
> Core dump not produced but Squid restarts. So, I can't get stack
> trace.
> 
> When I set hals_closed_clients to on, I've got much more
> assertions:
> 
> 2015/01/15 18:41:31 kid1| assertion failed: comm.cc:1823:
> "isOpen(fd) && !commHasHalfClosedMonitor(fd)"
> 
> What can be wrong? This is very annoying behaviour. Also memory
> cache is often cold after restarts and hit ratio is degrades.
> 
> This looks similar adaptation bug 4057, but it is closed in 3.4.11.
> This behaviour depends half-closed connections, but how?
> 
> And how to troubleshoot?

A) running Squid under GDB. There are instructions in
<http://wiki.squid-cache.org/SquidFaq/BugReporting> on how to do that
even if you are debugging a production server that needs no downtime.

OR,

B) finding out how to enable core dumps in your OS. The assertion
handling calls abort() which will generate a core file if the OS
allows them to be created.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEbBAEBAgAGBQJUt71IAAoJELJo5wb/XPRjVJEH+OPwizmwffDGN4nrKW/OwfI3
X4Pu15cXgie+6WWBsVBuz7FHlOv846oL6B2oSGHWTcAy2iR9E1+BZc/BtcIR+hZ+
vxjSmisDT7h9NvynVelrA4yqw2hrZeVVSNyuaaLk1ks2tvTYb6ms7EldGN2TKDUg
Q1aXgofE4p+5mXrZB8vEnJrU4CrXp/8pGJ6+YM4tQhDcI+fvcy4rSi7lTxbbxXnL
jsSLSnq9rNXKtBB3Ig6gVF3nQhwhl0IpGw571ORAuRQ7uvDC5d/fT/uNOpWfOFA5
4H1VR8RY/IddxEkhqdbnkYn6fGzk6qyOV3ZQKQi8p2mcyuNGfpAKbD9ZC+v28A==
=uSQr
-----END PGP SIGNATURE-----


From yvoinov at gmail.com  Thu Jan 15 13:23:48 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 15 Jan 2015 19:23:48 +0600
Subject: [squid-users] Too much assertion failed: comm.cc:178:
 "fd_table[conn->fd].halfClosedReader != NULL"
In-Reply-To: <54B7BD48.7050200@treenet.co.nz>
References: <54B7B798.1050908@gmail.com> <54B7BD48.7050200@treenet.co.nz>
Message-ID: <54B7BF64.8030605@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Core dumps is configured after OS installation - over 4 years ago. For
another processes they produces ok.

System has modular mebugger (MDB), but this is production system and
undesirable to run key service under debugger.

The same time this case is difficult to reproduce on test system.

Looks like assertion produces one of clients within irregular intervals.

I'll try to use DTrace to catch assertion live.

15.01.2015 19:14, Amos Jeffries ?????:
> On 16/01/2015 1:50 a.m., Yuri Voinov wrote:
>
> > Hi gents,
>
> > Sometimes I have too much assertions:
>
> > 2015/01/08 09:40:39 kid1| assertion failed: comm.cc:178:
> > "fd_table[conn->fd].halfClosedReader != NULL"
>
> > Core dump not produced but Squid restarts. So, I can't get stack
> > trace.
>
> > When I set hals_closed_clients to on, I've got much more
> > assertions:
>
> > 2015/01/15 18:41:31 kid1| assertion failed: comm.cc:1823:
> > "isOpen(fd) && !commHasHalfClosedMonitor(fd)"
>
> > What can be wrong? This is very annoying behaviour. Also memory
> > cache is often cold after restarts and hit ratio is degrades.
>
> > This looks similar adaptation bug 4057, but it is closed in 3.4.11.
> > This behaviour depends half-closed connections, but how?
>
> > And how to troubleshoot?
>
> A) running Squid under GDB. There are instructions in
> <http://wiki.squid-cache.org/SquidFaq/BugReporting> on how to do that
> even if you are debugging a production server that needs no downtime.
>
> OR,
>
> B) finding out how to enable core dumps in your OS. The assertion
> handling calls abort() which will generate a core file if the OS
> allows them to be created.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUt79kAAoJENNXIZxhPexGu3wH/28qhMz9SRRdv4M/NnZascGH
J2pgn03D7RI7C/rHY0fn9TeojoTFE1WLNEBkj+n3ufU7jp44eBZ1X1ZImS1Of/jc
5qmKaWc9vAIfRjX1J5Wvyn0Z6p5P0HqBO7WLE6kSBK6M+s9JkcCC49zZS0qp+pOd
U5tuNT1CqX3B1VkdDLbBMDxxGDKTTTt76CRhiF5bn/8GfdTL2/aPrhEpiKzRBK3W
b0azWyIKs39QzWwPTbkFk47Xidz3xFFXAl0bGuWnJg38fgRW/S6tlHUu8J0n+PCO
e4rXODf/X1EADWIZJMe7tUoKgk5o3AUSm4ZgnggMQj4y+MQFw//xrkczSVoJCOM=
=RvbX
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150115/c211b9f3/attachment.htm>

From fredbmail at free.fr  Thu Jan 15 13:30:14 2015
From: fredbmail at free.fr (FredB)
Date: Thu, 15 Jan 2015 14:30:14 +0100 (CET)
Subject: [squid-users] Too much assertion failed: comm.cc:178:
 "fd_table[conn->fd].halfClosedReader != NULL"
In-Reply-To: <54B7B798.1050908@gmail.com>
Message-ID: <1606632701.283672344.1421328614767.JavaMail.root@zimbra4-e1.priv.proxad.net>

> 
> When I set hals_closed_clients to on, I've got much more assertions:
> 
> 2015/01/15 18:41:31 kid1| assertion failed: comm.cc:1823: "isOpen(fd)
> &&
> !commHasHalfClosedMonitor(fd)"
> 

There is a problem with one assertion (or both)  
Bug: http://bugs.squid-cache.org/show_bug.cgi?id=4156
Without half_closed_clients no crash for me 
Perhaps a problem in client_side.cc with the call commMarkHalfClosed(io.conn->fd), but I don't know I didn't take time to investigate.

Quickly (very quickly I'm not sure) tested in 3.5 and the bug seems gone



----

Regards,

Fred

http://numsys.eu
http://e2guardian.org



From eugene at zhegan.in  Thu Jan 15 13:31:27 2015
From: eugene at zhegan.in (Eugene M. Zheganin)
Date: Thu, 15 Jan 2015 18:31:27 +0500
Subject: [squid-users] Memory Leak Squid 3.4.9 on FreeBSD 10.0 x64
In-Reply-To: <54B3D4ED.2050608@treenet.co.nz>
References: <86iogtp7ao.fsf@gmail.com>
 <E6B2517F8D6DBF4CABB8F38ACA367E78343B4E87@Draco.dawnsign.com>
 <54AF2B06.6030505@treenet.co.nz> <54B3B303.2080906@zhegan.in>
 <54B3B8D4.20702@zhegan.in> <54B3BAC9.1020702@gmail.com>
 <54B3D4ED.2050608@treenet.co.nz>
Message-ID: <54B7C12F.4060903@zhegan.in>

Hi.

On 12.01.2015 19:06, Amos Jeffries wrote:
>
> I am confident that those types of leaks do not exist at al in Squid 3.4.
>
> These rounds of mmory exhaustion problems are caused by pseudo-leaks,
> where Squid incorrectly holds onto memory (has not forgotten it
> though) far longer than it should be.
>
Could you please clarify for me what is the "Long Strings" pool and how
can I manage it's size ?
After start the largest consuming pool is the mem_node one, but it
usually stops increasing after a few days (somewhere around the
cache_memory border - don't know if it's it, or just a coincedence).
"Long Strings", however, keep raising and raising, and after some days
it becomes the largest one.

I'm using the following settings:
cache_mem 512 MB
cache_dir diskd /var/squid/cache 1100 16 256

after few days SNMP reports that the clients amount is around 1700.

Thanks.
Eugene.


From yvoinov at gmail.com  Thu Jan 15 13:34:01 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 15 Jan 2015 19:34:01 +0600
Subject: [squid-users] Too much assertion failed: comm.cc:178:
 "fd_table[conn->fd].halfClosedReader != NULL"
In-Reply-To: <1606632701.283672344.1421328614767.JavaMail.root@zimbra4-e1.priv.proxad.net>
References: <1606632701.283672344.1421328614767.JavaMail.root@zimbra4-e1.priv.proxad.net>
Message-ID: <54B7C1C9.9020000@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
With half_closed_clients by default (.i.e. off), the problem presist,
but catch a bit another assertion.

15.01.2015 19:30, FredB ?????:
>>
>> When I set hals_closed_clients to on, I've got much more assertions:
>>
>> 2015/01/15 18:41:31 kid1| assertion failed: comm.cc:1823: "isOpen(fd)
>> &&
>> !commHasHalfClosedMonitor(fd)"
>>
>
> There is a problem with one assertion (or both) 
> Bug: http://bugs.squid-cache.org/show_bug.cgi?id=4156
> Without half_closed_clients no crash for me
> Perhaps a problem in client_side.cc with the call
commMarkHalfClosed(io.conn->fd), but I don't know I didn't take time to
investigate.
>
> Quickly (very quickly I'm not sure) tested in 3.5 and the bug seems gone
>
>
>
> ----
>
> Regards,
>
> Fred
>
> http://numsys.eu
> http://e2guardian.org
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUt8HJAAoJENNXIZxhPexGHKwIAKM2FJTQwZ/LLTr8qfmqzefO
ACrMNhJK5uIYcpeZa/9O4qtGn7Fm54sN5g1+KiY3CqwQXD3VnFPOCW7saHNUHK8+
jQmZHFL0Nta2TkIDthX24Oy6WOrUOQ06UO2V43eBorh8CZj7ns5iZVAhjgYWOqPC
hchsxPkYfbgx/iCFGPSkTfwRM4Jh3R0E+U6tH3hwqTAObXy9AYWhOCIt/ZnOJhvQ
oGPxJAwINxZ6QMkMuI5S5BJLv0pzBD+oltdvKE/aHxC+61AZhp1KtH7qk1EZ1yMe
p5iqQkEE0i4UeDkIwdChNWPms8VvrJ9W291AdZhcVSea41jOctaV4eOiUUuEPdc=
=XtOP
-----END PGP SIGNATURE-----



From fredbmail at free.fr  Thu Jan 15 13:44:26 2015
From: fredbmail at free.fr (FredB)
Date: Thu, 15 Jan 2015 14:44:26 +0100 (CET)
Subject: [squid-users] Too much assertion failed: comm.cc:178:
 "fd_table[conn->fd].halfClosedReader != NULL"
In-Reply-To: <54B7C1C9.9020000@gmail.com>
Message-ID: <2085638210.283705724.1421329466451.JavaMail.root@zimbra4-e1.priv.proxad.net>


> Hash: SHA1
>  
> With half_closed_clients by default (.i.e. off), the problem presist,
> but catch a bit another assertion.
> 

FI, I noticed a change between 3.3.x and 3.4

 fd_table[io.conn->fd].flags.socket_eof = 1;

Becomes 

  fd_table[io.conn->fd].flags.socket_eof = true;

But as I said I haven't taken a look deeply

----

Regards,

Fred

http://numsys.eu
http://e2guardian.org




From fredbmail at free.fr  Thu Jan 15 13:48:22 2015
From: fredbmail at free.fr (FredB)
Date: Thu, 15 Jan 2015 14:48:22 +0100 (CET)
Subject: [squid-users] Too much assertion failed: comm.cc:178:
 "fd_table[conn->fd].halfClosedReader != NULL"
In-Reply-To: <2085638210.283705724.1421329466451.JavaMail.root@zimbra4-e1.priv.proxad.net>
Message-ID: <1214265593.283713682.1421329702443.JavaMail.root@zimbra4-e1.priv.proxad.net>


> 
> FI, I noticed a change between 3.3.x and 3.4
> 
>  fd_table[io.conn->fd].flags.socket_eof = 1;
> 
> Becomes
> 
>   fd_table[io.conn->fd].flags.socket_eof = true;
> 
> But as I said I haven't taken a look deeply


Sorry I forgot: in client_side.cc just before commMarkHalfClosed(io.conn->fd);


----

Regards,

Fred

http://numsys.eu
http://e2guardian.org


From fredbmail at free.fr  Thu Jan 15 15:15:17 2015
From: fredbmail at free.fr (FredB)
Date: Thu, 15 Jan 2015 16:15:17 +0100 (CET)
Subject: [squid-users] Squid 3.4.10 sometimes catch assertion without
 core
In-Reply-To: <54ABB125.60406@gmail.com>
Message-ID: <1884842564.283911173.1421334917045.JavaMail.root@zimbra4-e1.priv.proxad.net>




> 2015/01/06 15:52:10 kid1| storeLateRelease: released 0 objects
> 2015/01/06 15:52:11 kid1| assertion failed: comm.cc:178:
> "fd_table[conn->fd].halfClosedReader != NULL"
> 2015/01/06 15:52:15 kid1| Set Current Directory to /var/core
> 
> Core dump not produced.
> 

Are you sure about the rights/path of /var/core ? Squid user can write in this directory ?
If needed you can change the path with coredump_dir /something in squid.conf

Also take care at ulimit 

http://wiki.squid-cache.org/SquidFaq/BugReporting

Personally, I'm using ulimit -c unlimited in (squid) start up script

----

Regards,

Fred

http://numsys.eu
http://e2guardian.org







From yvoinov at gmail.com  Thu Jan 15 15:20:53 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 15 Jan 2015 21:20:53 +0600
Subject: [squid-users] Squid 3.4.10 sometimes catch assertion without
 core
In-Reply-To: <1884842564.283911173.1421334917045.JavaMail.root@zimbra4-e1.priv.proxad.net>
References: <1884842564.283911173.1421334917045.JavaMail.root@zimbra4-e1.priv.proxad.net>
Message-ID: <54B7DAD5.8030607@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Absolutely sure.

root @ proxyhost /var/core # coreadm
     global core file pattern: /var/core/core.%f.%p
     global core file content: default
       init core file pattern: /var/core/core.%f.%p
       init core file content: default
            global core dumps: enabled
       per-process core dumps: enabled
      global setid core dumps: disabled
 per-process setid core dumps: disabled
     global core dump logging: enabled

As I said, other processes produces core dumps without any problems.

15.01.2015 21:15, FredB ?????:
>
>
>
>> 2015/01/06 15:52:10 kid1| storeLateRelease: released 0 objects
>> 2015/01/06 15:52:11 kid1| assertion failed: comm.cc:178:
>> "fd_table[conn->fd].halfClosedReader != NULL"
>> 2015/01/06 15:52:15 kid1| Set Current Directory to /var/core
>>
>> Core dump not produced.
>>
>
> Are you sure about the rights/path of /var/core ? Squid user can write
in this directory ?
> If needed you can change the path with coredump_dir /something in
squid.conf
>
> Also take care at ulimit
>
> http://wiki.squid-cache.org/SquidFaq/BugReporting
>
> Personally, I'm using ulimit -c unlimited in (squid) start up script
>
> ----
>
> Regards,
>
> Fred
>
> http://numsys.eu
> http://e2guardian.org
>
>
>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUt9rVAAoJENNXIZxhPexG+BcIAK/gu0MDZLwiflbyLrN959Xx
YnxcWBK6wuP6L9PC9trEIwsT9dgENsEQauX0a9OG25qihaXjA5qKIv9WPtuANUaY
29N6Ak93Vqq3WK1CvgzdcUSExq/H3Imc24JnDxsEXk9M899HbobHqyf2A5evLosL
NR75lYhMaJuGBOr5dA5D2VYJRrFhl263fZOkC3KJ+pleswkjgDPnjsmMysTZ1P/x
Mc7SeHb2dqOigPq8ZjDXmxF2t9czRL/dQyWzY2H66LB9Z5ij+Fo/pLOIJu36qiV5
cJsepLyeWBQxBiiCsAHSoGCAmkfW3d1MWvBi2pr1hRepHyccUYbySHiKBPeP+Cs=
=n8pd
-----END PGP SIGNATURE-----



From yvoinov at gmail.com  Thu Jan 15 15:22:39 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 15 Jan 2015 21:22:39 +0600
Subject: [squid-users] Squid 3.4.10 sometimes catch assertion without
 core
In-Reply-To: <1884842564.283911173.1421334917045.JavaMail.root@zimbra4-e1.priv.proxad.net>
References: <1884842564.283911173.1421334917045.JavaMail.root@zimbra4-e1.priv.proxad.net>
Message-ID: <54B7DB3F.4010002@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 

15.01.2015 21:15, FredB ?????:
>
>
>
>> 2015/01/06 15:52:10 kid1| storeLateRelease: released 0 objects
>> 2015/01/06 15:52:11 kid1| assertion failed: comm.cc:178:
>> "fd_table[conn->fd].halfClosedReader != NULL"
>> 2015/01/06 15:52:15 kid1| Set Current Directory to /var/core
>>
>> Core dump not produced.
>>
>
> Are you sure about the rights/path of /var/core ? Squid user can write
in this directory ?
> If needed you can change the path with coredump_dir /something in
squid.conf
>
> Also take care at ulimit
>
> http://wiki.squid-cache.org/SquidFaq/BugReporting
>
> Personally, I'm using ulimit -c unlimited in (squid) start up script
Squid not required unlimited limits to startup and normal work. In my
SMF startup method uses 128K values to limit filedescriptors during
startup. System hard limits are above this value.

>
>
> ----
>
> Regards,
>
> Fred
>
> http://numsys.eu
> http://e2guardian.org
>
>
>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUt9s/AAoJENNXIZxhPexG7j0H/3Yv14bF0N701fOnCtJir0xS
otaZRCmEUSS1q8TkpGNaWGnCSRXhtnnOStT6Z9yjdy1Pm6diiz2Qoamme8mVyUSb
JyJS7urB3jbFC/UG48dg+tSBsA3jQdNdqpMGRGk1yIDVGLLTlfthK25nQleXGpUX
JGJGC3cuah766gD0ycMNfjWNpDdI8U6/Wl/UlWAtC0yR0Ihu6cArJQT61JLG54ki
0yeMr4fhFz3g3Sjhk2WRMiWFh0EDO9vQCJ9NPoDV5s9pFoL5hyaMgvnsBBydQhrk
6RUUMnINX+DRFJQdk2bC65jlpPGLtm35fvjXnKX9v9PBE8YRjU8Eo3IpLI+QLow=
=P7t/
-----END PGP SIGNATURE-----



From fredbmail at free.fr  Thu Jan 15 15:26:37 2015
From: fredbmail at free.fr (FredB)
Date: Thu, 15 Jan 2015 16:26:37 +0100 (CET)
Subject: [squid-users] Squid 3.4.10 sometimes catch assertion without
 core
In-Reply-To: <54B7DAD5.8030607@gmail.com>
Message-ID: <1304472342.283944725.1421335597687.JavaMail.root@zimbra4-e1.priv.proxad.net>


> 
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>  
> Absolutely sure.
> 
> root @ proxyhost /var/core # coreadm
>      global core file pattern: /var/core/core.%f.%p
>      global core file content: default
>        init core file pattern: /var/core/core.%f.%p
>        init core file content: default
>             global core dumps: enabled
>        per-process core dumps: enabled
>       global setid core dumps: disabled
>  per-process setid core dumps: disabled
>      global core dump logging: enabled
> 
> As I said, other processes produces core dumps without any problems.
> 

Sun OS ? processes running as root or with user account ?
And about ulimit ? the core size could be huge

----

Regards,

Fred

http://numsys.eu
http://e2guardian.org


From fredbmail at free.fr  Thu Jan 15 15:29:24 2015
From: fredbmail at free.fr (FredB)
Date: Thu, 15 Jan 2015 16:29:24 +0100 (CET)
Subject: [squid-users] Squid 3.4.10 sometimes catch assertion without
 core
In-Reply-To: <54B7DB3F.4010002@gmail.com>
Message-ID: <888488195.283956315.1421335764490.JavaMail.root@zimbra4-e1.priv.proxad.net>


> Squid not required unlimited limits to startup and normal work. In my
> SMF startup method uses 128K values to limit filedescriptors during
> startup. System hard limits are above this value.
> 

ulimit -c is only about core 



From yvoinov at gmail.com  Thu Jan 15 15:29:59 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 15 Jan 2015 21:29:59 +0600
Subject: [squid-users] Squid 3.4.10 sometimes catch assertion without
 core
In-Reply-To: <1304472342.283944725.1421335597687.JavaMail.root@zimbra4-e1.priv.proxad.net>
References: <1304472342.283944725.1421335597687.JavaMail.root@zimbra4-e1.priv.proxad.net>
Message-ID: <54B7DCF7.6060203@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Solaris 10. Initially squid runs by root. Squid 3 cannot be run via su -
squid -c "".

root @ proxyhost /var/core # ulimit
unlimited

In /var mountpoint I have 13 Gb free space:

rpool/ROOT/s10x_u11wos_24a/var   571M  13.3G   571M  /var

:)

I'm neither idiot nor newbi. :)

These obvious things I can't be seen. :)

15.01.2015 21:26, FredB ?????:
>
>>
>> -----BEGIN PGP SIGNED MESSAGE-----
>> Hash: SHA1
>> 
>> Absolutely sure.
>>
>> root @ proxyhost /var/core # coreadm
>>      global core file pattern: /var/core/core.%f.%p
>>      global core file content: default
>>        init core file pattern: /var/core/core.%f.%p
>>        init core file content: default
>>             global core dumps: enabled
>>        per-process core dumps: enabled
>>       global setid core dumps: disabled
>>  per-process setid core dumps: disabled
>>      global core dump logging: enabled
>>
>> As I said, other processes produces core dumps without any problems.
>>
>
> Sun OS ? processes running as root or with user account ?
> And about ulimit ? the core size could be huge
>
> ----
>
> Regards,
>
> Fred
>
> http://numsys.eu
> http://e2guardian.org
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUt9z3AAoJENNXIZxhPexGr40H/2zHOswwS3q6CStwcHLP/saS
jeXb/b5exIFHjeyDNeFcABHiUzoTNvGgNA57h4YCjD+S5MVUXNL9yfurWDsFZ4j0
lEA2O7jj4hDh2vPKPnraTS1VbyUf3jXvHa7fAU0Qjwpu5r3lZ6pwxnZ0vRuxSUU1
tVPbKricoI6IqosE7XZqTCG86Nfuawvoz3jgXaJwAfHrOz7Bgeu5qKbbjwuWq6fH
+ajjd5BMdgdfY54RLhUflwa7EGeCiEmEGiBDqlmOrJOZ3/90GtBDnb4alZkduUM2
Q1UfbV+TKQ7LGGubVWxi25tcMlnZayfpHmLyiErUZTyNE48R2EZRIBKSaKY8nlw=
=c/rk
-----END PGP SIGNATURE-----



From yvoinov at gmail.com  Thu Jan 15 15:31:30 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 15 Jan 2015 21:31:30 +0600
Subject: [squid-users] Squid 3.4.10 sometimes catch assertion without
 core
In-Reply-To: <888488195.283956315.1421335764490.JavaMail.root@zimbra4-e1.priv.proxad.net>
References: <888488195.283956315.1421335764490.JavaMail.root@zimbra4-e1.priv.proxad.net>
Message-ID: <54B7DD52.9080407@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
He does not even attempt to write the dump.

Just restarts, write to /var/adm/messages and squid.log and restarts.

15.01.2015 21:29, FredB ?????:
>
>> Squid not required unlimited limits to startup and normal work. In my
>> SMF startup method uses 128K values to limit filedescriptors during
>> startup. System hard limits are above this value.
>>
>
> ulimit -c is only about core
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUt91SAAoJENNXIZxhPexGweAH/1TWBRoWiczKuSPcDhgsIZpt
DLOuYP4Oy8P2Fgk6yYJzok+sCWvsO2pgkawCJVZa2fzowUxQIqIL4oYBLjFR12Dt
caOmLZ8+oIDxQNuUFBOdGsGaRu8KAH7yCoT70LJRCUNPEFRrSwMblORZBViENQCd
6T6xywK51gAgLkoXdIYgN1ZcJf3NhHlfiE2ARdV4V6pIxwZk9giTwl01sYjQ4rK6
bZMu/XJ2B58ReX0qX43gcjUfJJLEPJKN/0DdiijtCf/qDj4DlQl35Nc1LYC5vhxt
SKdUs97h2nHeizZWNraJfrdrcewH7iEWrGsnuVVOrlikTR14Rjp/xh6ocxeVf5g=
=QRb/
-----END PGP SIGNATURE-----



From fredbmail at free.fr  Thu Jan 15 15:41:03 2015
From: fredbmail at free.fr (FredB)
Date: Thu, 15 Jan 2015 16:41:03 +0100 (CET)
Subject: [squid-users] Squid 3.4.10 sometimes catch assertion without
 core
In-Reply-To: <54B7DCF7.6060203@gmail.com>
Message-ID: <1865158585.283987042.1421336463783.JavaMail.root@zimbra4-e1.priv.proxad.net>



> root @ proxyhost /var/core # ulimit
> unlimited
> 

This is not related with ulimit -c , please take a look at ulimit -a 
"ulimit -c ulimited" in statupt script only set your core file size to unlimited 


From yvoinov at gmail.com  Thu Jan 15 15:43:30 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 15 Jan 2015 21:43:30 +0600
Subject: [squid-users] Squid 3.4.10 sometimes catch assertion without
 core
In-Reply-To: <888488195.283956315.1421335764490.JavaMail.root@zimbra4-e1.priv.proxad.net>
References: <888488195.283956315.1421335764490.JavaMail.root@zimbra4-e1.priv.proxad.net>
Message-ID: <54B7E022.2040803@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
What I observed myself:

This event correlates with users network activity and massive cached
content output during peak hours.

In other hours it does not occurs.

I've checked all network infrastructure, configurations and see no stranges.

I can't see any direct correlations with other system behaviour.

15.01.2015 21:29, FredB ?????:
>
>> Squid not required unlimited limits to startup and normal work. In my
>> SMF startup method uses 128K values to limit filedescriptors during
>> startup. System hard limits are above this value.
>>
>
> ulimit -c is only about core
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUt+AiAAoJENNXIZxhPexGOZkH+gJvSymRiq8Ib/S5xo/FFN+1
TMBgtTl3jBB5SLOSwG0A99dpEoMo4lZgM8KuMcFHC4uZN5vYt09zafMejyvCV4A3
G5aR3JmHJBGhEBOBBNbAEwWN1wk9nOMZl1ylHEHyhAzyra6i8xUnIwvfqJkcHbWi
FJeQjnJOgVDcuGDU3w36A37WNyKEZmBEHC0XAyBGAOJxBxG+MeriRp8sgDmhboZW
v+pIVedL5lzH0SABUnHFKJhlwHfX+mFP/LkptdWXVY7iIyQJD5Vmupf2VHvgNQBf
UVuYoujI3oJGSUnoXxHwNUS6OVUSVTS2+0L0Y7i/Z89oNFeu9O3EPBFsUiMfDlc=
=n3qS
-----END PGP SIGNATURE-----



From yvoinov at gmail.com  Thu Jan 15 15:47:37 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 15 Jan 2015 21:47:37 +0600
Subject: [squid-users] Squid 3.4.10 sometimes catch assertion without
 core
In-Reply-To: <1865158585.283987042.1421336463783.JavaMail.root@zimbra4-e1.priv.proxad.net>
References: <1865158585.283987042.1421336463783.JavaMail.root@zimbra4-e1.priv.proxad.net>
Message-ID: <54B7E119.8040106@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
This is not core file size issue, Fred.

In SunOS core dumps produces by kernel, with uid=0.

Root has unlimited limits set by default.

On this server was running Squid 2 over three years and problems with
dumps never occurred.

So, the problem not in system settings.

I'll try to catch problem tommorrow, using DTrace, diring peak hours.

Let's see on this.

15.01.2015 21:41, FredB ?????:
>
>
>> root @ proxyhost /var/core # ulimit
>> unlimited
>>
>
> This is not related with ulimit -c , please take a look at ulimit -a
> "ulimit -c ulimited" in statupt script only set your core file size to
unlimited
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUt+EZAAoJENNXIZxhPexG9MwH/RjQZnXKlJ+ypKieOPkEzgrI
TnCsPyPWEN+fgXDfkKCcNp3Vrn00MSnMUIBByVS7OoJLYOOdsol0ekuqOmDhPIyx
NfTPWCWu/vJe2bRmPbB8YmbvfrC5cTSYWzcF4vb+Lc91F1md1Cq88PKsvwesz1sA
gEOmcpHIiPcreFUXC/gulIKUzb9QZ8NFJHqyHkiKOVejVpOXrhA6s8H48RR1xczp
nMA1x2RaaZNOZjVP7d6eTqvHcn+lq67mqC+yVwFr7dANGoz6yn6ylFKUFB9LSHw/
nGO8vS8FQNetk9U/Qw5ePL0Cl7+DYdV6VNMkuiakDWSzTtoL5XxX21pJVVnsPxM=
=Sdvj
-----END PGP SIGNATURE-----



From gecom at tubosider.it  Thu Jan 15 15:58:49 2015
From: gecom at tubosider.it (masterx81)
Date: Thu, 15 Jan 2015 07:58:49 -0800 (PST)
Subject: [squid-users] Squid and site ryanair.com
Message-ID: <1421337529987-4669105.post@n4.nabble.com>

Hi!
I have squid/3.3.13 on a centos 6.5, configured with ntlm and kerberos auth.
I'm having throubles to get work the http site ryanair.com.
The dynamic content of the page (the find flights button and the calendars,
that as far i can see are js+css) are not working (the calendars does not
open and the button doesn't highlight on mouse move). I've also tried to put
an exception for the dstdomain ryanair.com before the auth, and i have the
same problem.
On access.log i get only DENIED on:

1421337197.667      0 172.16.2.210 TCP_DENIED/407 3944 CONNECT
s-static.ak.facebook.com:443 - HIER_NONE/- text/html
1421337195.919      0 172.16.2.210 TCP_DENIED/407 3908 CONNECT
apis.google.com:443 - HIER_NONE/- text/html

there was also a DENIED on:
1421337020.420      0 172.16.2.210 TCP_DENIED/407 4354 GET
http://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.3.6/slick.css -
HIER_NONE/- text/html

I've tried to bypass also auth on dstdomain cloudflare.com, now i get a MISS
on that instead of a DENIED, but the page still not work.

If i bypass totally the proxy the site works. 

Can someone explain me how to get around this?
Really thanks!



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-and-site-ryanair-com-tp4669105.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From fredbmail at free.fr  Thu Jan 15 16:07:14 2015
From: fredbmail at free.fr (FredB)
Date: Thu, 15 Jan 2015 17:07:14 +0100 (CET)
Subject: [squid-users] Squid 3.4.10 sometimes catch assertion without
 core
In-Reply-To: <54B7E119.8040106@gmail.com>
Message-ID: <623138265.284060470.1421338034925.JavaMail.root@zimbra4-e1.priv.proxad.net>



> This is not core file size issue, Fred.
> 
> In SunOS core dumps produces by kernel, with uid=0.
> 
> Root has unlimited limits set by default.
> 
> On this server was running Squid 2 over three years and problems with
> dumps never occurred.
> 
> So, the problem not in system settings.
> 
> I'll try to catch problem tommorrow, using DTrace, diring peak hours.
> 
> Let's see on this.
> 


Ok no problem, this was just to say that there are some different ulimit parameters
and "unlimited limits" is not specific enough (as you can see with ulimit -a)
I'm thinking about that because in my bug report, half_closed_client on, I have a core and this core was only generated with this ulimit command in startup script.

After Dtrace return, maybe you should open a bug report.

Fred


From yvoinov at gmail.com  Thu Jan 15 16:10:40 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 15 Jan 2015 22:10:40 +0600
Subject: [squid-users] Squid 3.4.10 sometimes catch assertion without
 core
In-Reply-To: <623138265.284060470.1421338034925.JavaMail.root@zimbra4-e1.priv.proxad.net>
References: <623138265.284060470.1421338034925.JavaMail.root@zimbra4-e1.priv.proxad.net>
Message-ID: <54B7E680.7040807@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
It's opened already,

we need only details and confirmation.

http://bugs.squid-cache.org/show_bug.cgi?id=3775

Amos believe this is the same bug.

Will explore.
 
15.01.2015 22:07, FredB ?????:
>
>
>> This is not core file size issue, Fred.
>>
>> In SunOS core dumps produces by kernel, with uid=0.
>>
>> Root has unlimited limits set by default.
>>
>> On this server was running Squid 2 over three years and problems with
>> dumps never occurred.
>>
>> So, the problem not in system settings.
>>
>> I'll try to catch problem tommorrow, using DTrace, diring peak hours.
>>
>> Let's see on this.
>>
>
>
> Ok no problem, this was just to say that there are some different
ulimit parameters
> and "unlimited limits" is not specific enough (as you can see with
ulimit -a)
> I'm thinking about that because in my bug report, half_closed_client
on, I have a core and this core was only generated with this ulimit
command in startup script.
>
> After Dtrace return, maybe you should open a bug report.
>
> Fred
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUt+Z/AAoJENNXIZxhPexG2NkIAMFgJtahJybtaUNCKtG3nkjX
6vpV4nY6YfPLmaSlEfwzF6omE48F7lJ8Vm5VA5mFL+vtuqtsGAsa+d+paf/+2/Gy
nW1sxMGfGuGBxs5IAe1EwVXqSYkif3KhMxin7BCoZDtJep6CHU2cW4RhqULXlWao
I5E6N4w5tfUQ5YS6hFwbwJn+ZlZ0Q9VoJojkloPcvxZuBjx4E+/rbtircuZ1b8+s
mCFKpx5UmJy4pWA7u7jJJG+2lTvpliWotVtBUmjHnaKMrEHIazEAjXkeTECUDMSY
C+9/Z2wgIPCSmwOh8pD2MmpnosVwb2MFQTymxMCVi8Z57m5vG2sduqHeyGbJl4U=
=usGj
-----END PGP SIGNATURE-----



From gecom at tubosider.it  Thu Jan 15 17:36:06 2015
From: gecom at tubosider.it (masterx81)
Date: Thu, 15 Jan 2015 09:36:06 -0800 (PST)
Subject: [squid-users] Squid and site ryanair.com
In-Reply-To: <1421337529987-4669105.post@n4.nabble.com>
References: <1421337529987-4669105.post@n4.nabble.com>
Message-ID: <1421343366034-4669108.post@n4.nabble.com>

I've also tried to add the domain ryanair.com to the domains that return
DIRECT on the wpad file (for bypass squid), but also in this way that things
on the site doesn't work.
They work only if i disable totally the proxy.
Any ideas? Thanks!



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-and-site-ryanair-com-tp4669105p4669108.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From yvoinov at gmail.com  Thu Jan 15 19:08:07 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Fri, 16 Jan 2015 01:08:07 +0600
Subject: [squid-users] Squid and site ryanair.com
In-Reply-To: <1421343366034-4669108.post@n4.nabble.com>
References: <1421337529987-4669105.post@n4.nabble.com>
 <1421343366034-4669108.post@n4.nabble.com>
Message-ID: <54B81017.6080503@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Just tested on my proxy.

All works like charm.

May be, you block some JS?

15.01.2015 23:36, masterx81 ?????:
> I've also tried to add the domain ryanair.com to the domains that return
> DIRECT on the wpad file (for bypass squid), but also in this way that
things
> on the site doesn't work.
> They work only if i disable totally the proxy.
> Any ideas? Thanks!
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-and-site-ryanair-com-tp4669105p4669108.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUuBAXAAoJENNXIZxhPexGK1YH/RG2lLAf+6/r3Qbkby4Ny3O6
9xZ05W7J2hGBh2Ew37iHTCxiQ7pJq5bnl53L5TlQzQCYcpudv6icdYa8gfMSi4tX
bdKZCIClLO9j1uQ3Cd76L35oigzzJOgqZIAqyfFuqCDVXKdNWPLKul4GEGaS0Scb
+BOW9n3rstZaximkP56oDRCjZzOgnfPcukKoccMYvDCPX4Yd8lWGu20vsIaYQ6OT
X+HtvkeQheLONijRrngxIqBCjpiTruv/JtO669HDaEhELRohkhzYSRSCL8gutY2j
2aKV0pAVk9wcfW8iNa3qT4UUvpTkq4ywvu6IgogQ73PxqTHy5zxIVWq9mikXvzw=
=X3XR
-----END PGP SIGNATURE-----



From wrkilu at wp.pl  Thu Jan 15 21:07:45 2015
From: wrkilu at wp.pl (Robert)
Date: Thu, 15 Jan 2015 22:07:45 +0100
Subject: [squid-users] Odp: Re:  Odp:  Odp: Re:  Only TCP_MISS
Message-ID: <54b82c21500954.90609165@wp.pl>

Dnia Czwartek, 15 Stycznia 2015 12:54 Yuri Voinov <yvoinov at gmail.com> napisa?(a)
>  
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>  
> This URL
>  
> http://www.squid-cache.org/Images/img4.jpg
>  
> produces HIT on second query.
>  
>  

Ok, this is working - give TCP_MEM_HIT/200

But can anybody explain me why such a images are not cached ?
1421355736.332 341144 10.59.1.9 TCP_MISS/200 9228 CONNECT api.instagram.com:443 - HIER_DIRECT/107.23.224.121 -
1421355736.332  14042 10.59.1.9 TCP_MISS/200 255 CONNECT www.facebook.com:443 - HIER_DIRECT/2a03:2880:f000:1:face:b00c:0:1 -
1421355736.577   1980 10.59.1.9 TCP_MISS/200 62566 GET http://www.blogojciec.pl/wp-content/uploads/2014/11/8334168249_1b5c1a6e7a_k-726x400.jpg - HIER_DIRECT/185.23.21.14 image/jpeg
1421355736.828    738 10.59.1.9 TCP_MISS/200 48321 GET http://www.blogojciec.pl/wp-content/uploads/2014/11/2335080161_6c96f831b1_b-726x400.jpg - HIER_DIRECT/185.23.21.14 image/jpeg
1421355737.010   3036 10.59.1.9 TCP_MISS/200 124617 GET http://www.blogojciec.pl/wp-content/uploads/2014/11/277485096_a64e491f09_o-726x400.jpg - HIER_DIRECT/185.23.21.14 image/jpeg
1421355737.461    376 10.59.1.9 TCP_MISS/200 627 GET http://www.blogojciec.pl/wp-content/themes/rigel/images/main_slider_bg.png - HIER_DIRECT/185.23.21.14 image/png
1421355737.842    357 10.59.1.9 TCP_MISS/200 447 GET http://www.blogojciec.pl/wp-content/plugins/facebook-page-promoter-lightbox/includes/front/scs/blank.gif - HIER_DIRECT/185.23.21.14 image/gif
1421355738.547   1695 10.59.1.9 TCP_MISS/200 138449 GET http://www.blogojciec.pl/wp-content/uploads/2013/09/DSC_1397.jpg - HIER_DIRECT/185.23.21.14 image/jpeg
1421355738.819   2937 10.59.1.9 TCP_MISS/200 143772 GET http://www.blogojciec.pl/wp-content/uploads/2014/11/6947435171_465587a2d4_k-726x400.jpg - HIER_DIRECT/185.23.21.14 image/jpeg
1421355741.078   7149 10.59.1.9 TCP_MISS/200 384465 GET http://www.blogojciec.pl/wp-content/uploads/2014/11/AMNESTY_STOP_1-716x400.png - HIER_DIRECT/185.23.21.14 image/png
1421355741.339 240241 10.59.1.9 TCP_MISS/200 5106 CONNECT clients2.google.com:443 - HIER_DIRECT/2607:f8b0:4002:c07::8a -
1421355744.032   7405 10.59.1.9 TCP_MISS/200 538419 GET http://www.blogojciec.pl/wp-content/uploads/2014/11/Rachels-header-with-Ben-added-and-name-726x400.png - HIER_DIRECT/185.23.21.14 image/png
1421355744.092   8379 10.59.1.9 TCP_MISS/200 470427 GET http://www.blogojciec.pl/wp-content/uploads/2014/11/poland-726x400.png - HIER_DIRECT/185.23.21.14 image/png
1421355746.084   1964 10.59.1.9 TCP_MISS/200 60489 GET http://www.blogojciec.pl/wp-content/uploads/2015/01/4815760850_4b06e8e3d1_b-960x430.jpg - HIER_DIRECT/185.23.21.14 image/jpeg
1421355746.333 351147 10.59.1.9 TCP_MISS/200 9257 CONNECT api.instagram.com:443 - HIER_DIRECT/107.23.224.121 -
1421355746.333  20041 10.59.1.9 TCP_MISS/200 173 CONNECT fbstatic-a.akamaihd.net:443 - HIER_DIRECT/2600:1404:14::17dc:64b3 -
1421355746.333  20039 10.59.1.9 TCP_MISS/200 173 CONNECT fbstatic-a.akamaihd.net:443 - HIER_DIRECT/2600:1404:14::17dc:64b3 -
1421355746.507   2373 10.59.1.9 TCP_MISS/200 152416 GET http://www.blogojciec.pl/wp-content/uploads/2014/03/4957524690_62271cbc0f_o-e1409310201525-960x430.jpg - HIER_DIRECT/185.23.21.14 image/jpeg
1421355747.597   3462 10.59.1.9 TCP_MISS/200 207217 GET http://www.blogojciec.pl/wp-content/uploads/2014/05/sad.jpg - HIER_DIRECT/185.23.21.14 image/jpeg
1421355747.698   1184 10.59.1.9 TCP_MISS/200 61353 GET http://www.blogojciec.pl/wp-content/uploads/2014/12/6697132255_2ddb665dd7_o-800x430.jpg - HIER_DIRECT/185.23.21.14 image/jpeg
1421355748.101   2006 10.59.1.9 TCP_MISS/200 62702 GET http://www.blogojciec.pl/wp-content/uploads/2015/01/1902628132_1dc03a6544_b-960x430.jpg - HIER_DIRECT/185.23.21.14 image/jpeg
1421355750.199   6060 10.59.1.9 TCP_MISS/200 87128 GET http://www.blogojciec.pl/wp-content/uploads/2014/06/kitchenok.jpg - HIER_DIRECT/185.23.21.14 image/jpeg
1421355750.357   2745 10.59.1.9 TCP_MISS/200 91760 GET http://www.blogojciec.pl/wp-content/uploads/2014/12/14296826765_557697dc2a_k-960x430.jpg - HIER_DIRECT/185.23.21.14 image/jpeg
1421355750.542   6399 10.59.1.9 TCP_MISS/200 174792 GET http://www.blogojciec.pl/wp-content/uploads/2014/05/spiderman.jpg - HIER_DIRECT/185.23.21.14 image/jpeg
^C

My testing was:
- first I opened this blog site in Chrome
- then I opened it in IE

so why ?



>  
> 15.01.2015 17:44, Robert &#x43F;&#x438;&#x448;&#x435;&#x442;:
> > [...]
> >
> >>> 1421183413.322    185 10.59.1.9 TCP_MISS_ABORTED/503 1541 GET
> >>>> http://www.amazon.com/gp/am/metro/application/livetileRedirect? -
> >>>> HIER_DIRECT/205.251.242.103 text/html
> >>>> 1421183415.611    132 10.59.1.9 TCP_MISS/206 8526 GET
> >>>> http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87i9P.jpg? -
> >>>> HIER_DIRECT/23.220.133.211 image/jpeg 1421183416.619     34
> >>>> 10.59.1.9 TCP_MISS/206 834 GET
> >>>> http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87i9P.jpg? -
> >>>> HIER_DIRECT/23.220.133.211 image/jpeg 1421183417.094     76
> >>>> 10.59.1.9 TCP_MISS/206 11123 GET
> >>>> http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA86gtq.jpg? -
> >>>> HIER_DIRECT/23.220.133.211 image/jpeg 1421183418.269     52
> >>>> 10.59.1.9 TCP_MISS/206 4882 GET
> >>> http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87zJF.jpg? -
> >>>> HIER_DIRECT/23.220.133.211 image/jpeg
> >>> Partial messages (206) from servers are not cacheable by Squid. And
> >>> again the non-logged query parameters may make what appears to be
> >>> identical requests actually quite different.
> >>>> I don't have any TCP_HIT :( , so what is going on ? why Squid
> >>>> doesn't work ? :(
> >>>>
> >>> For testing configure:
> >>>   strip_query_terms off
> >>> Also, how are you doing the testing?
> >>> HTTP clients are able to send explicit instructions to proxies
> >>> forbidding the use of cache. The curl tools do that by default, and
> >>> also the browser "Refresh" or "Reload" buttons.
> >>>
> >>
> >> 1. ok , so testing I do by surfing on two sites wp.pl and kosmos.pl ,
> if you think they are wrong please give me samples of sites which will
> be good for testing
> >> 2. I'm testing by going few time through the same links and also
> using refresh , and I get most :
> >> TCP_MISS/200
> >> sometimes:
> >> TCP_REFRESH_UNMODIFIED/304
> >>
> >>
> >>
> >
> >
> > Could somebody help me and answer ?
> >
> > Best question in my situation now is: on which sites I can test Squid
> to see TCP_HIT messages in log?
> >
> >
> >
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
>  
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2
>  
> iQEcBAEBAgAGBQJUt6pYAAoJENNXIZxhPexGDzMIAKZLfHQ4PGAjra7yNar8zB98
> FZyMh+45N+HHHrhAvf0+7XOH2Vpfd76AW94oDRLXPxkAtVbVgFhLv1e9N3NXrnzE
> eGiC7SdkJxCqr0Yp26FFPokWxloNmvCiIcJxN3dSCGAiwULbt3+XqDZqszFD6eS7
> Ha7RCcyZhzq3USxzs+9g3zJ6HobMSp8v/wCK59OZclBGLf7qZ9naa8yuCnIt4OB/
> yqo82vv57+fAzu5WUGmxE2kRRFiyCv3QncWmRStrHoR40VJLNPoKqMVA7i2vmFlg
> 06btRQrtGEx870uMW89H8Ip0PwMNEgvfYT4FcRKDj1hGekD4/4OvsQF5zk3SXbM=
> =zdvp
> -----END PGP SIGNATURE-----
>  
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>  


 





From yvoinov at gmail.com  Thu Jan 15 21:15:43 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Fri, 16 Jan 2015 03:15:43 +0600
Subject: [squid-users] Odp: Re:  Odp:  Odp: Re:  Only TCP_MISS
In-Reply-To: <54b82c21500954.90609165@wp.pl>
References: <54b82c21500954.90609165@wp.pl>
Message-ID: <54B82DFF.3040204@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
:)

First reason - HTTP headers. I.e, no cache. etc. You can override them
with refresh_patterns violations. :)

Second - dynamic generated content required some special works to be cached.
Note: not all dynamic content can be easy cached.
 
:)

16.01.2015 3:07, Robert ?????:
> Dnia Czwartek, 15 Stycznia 2015 12:54 Yuri Voinov <yvoinov at gmail.com> napisa?(a)
>> 
> This URL
> 
> http://www.squid-cache.org/Images/img4.jpg
> 
> produces HIT on second query.
> 
> 
>
> > Ok, this is working - give TCP_MEM_HIT/200
>
> > But can anybody explain me why such a images are not cached ?
> > 1421355736.332 341144 10.59.1.9 TCP_MISS/200 9228 CONNECT
api.instagram.com:443 - HIER_DIRECT/107.23.224.121 -
> > 1421355736.332  14042 10.59.1.9 TCP_MISS/200 255 CONNECT
www.facebook.com:443 - HIER_DIRECT/2a03:2880:f000:1:face:b00c:0:1 -
> > 1421355736.577   1980 10.59.1.9 TCP_MISS/200 62566 GET
http://www.blogojciec.pl/wp-content/uploads/2014/11/8334168249_1b5c1a6e7a_k-726x400.jpg
- HIER_DIRECT/185.23.21.14 image/jpeg
> > 1421355736.828    738 10.59.1.9 TCP_MISS/200 48321 GET
http://www.blogojciec.pl/wp-content/uploads/2014/11/2335080161_6c96f831b1_b-726x400.jpg
- HIER_DIRECT/185.23.21.14 image/jpeg
> > 1421355737.010   3036 10.59.1.9 TCP_MISS/200 124617 GET
http://www.blogojciec.pl/wp-content/uploads/2014/11/277485096_a64e491f09_o-726x400.jpg
- HIER_DIRECT/185.23.21.14 image/jpeg
> > 1421355737.461    376 10.59.1.9 TCP_MISS/200 627 GET
http://www.blogojciec.pl/wp-content/themes/rigel/images/main_slider_bg.png
- HIER_DIRECT/185.23.21.14 image/png
> > 1421355737.842    357 10.59.1.9 TCP_MISS/200 447 GET
http://www.blogojciec.pl/wp-content/plugins/facebook-page-promoter-lightbox/includes/front/scs/blank.gif
- HIER_DIRECT/185.23.21.14 image/gif
> > 1421355738.547   1695 10.59.1.9 TCP_MISS/200 138449 GET
http://www.blogojciec.pl/wp-content/uploads/2013/09/DSC_1397.jpg -
HIER_DIRECT/185.23.21.14 image/jpeg
> > 1421355738.819   2937 10.59.1.9 TCP_MISS/200 143772 GET
http://www.blogojciec.pl/wp-content/uploads/2014/11/6947435171_465587a2d4_k-726x400.jpg
- HIER_DIRECT/185.23.21.14 image/jpeg
> > 1421355741.078   7149 10.59.1.9 TCP_MISS/200 384465 GET
http://www.blogojciec.pl/wp-content/uploads/2014/11/AMNESTY_STOP_1-716x400.png
- HIER_DIRECT/185.23.21.14 image/png
> > 1421355741.339 240241 10.59.1.9 TCP_MISS/200 5106 CONNECT
clients2.google.com:443 - HIER_DIRECT/2607:f8b0:4002:c07::8a -
> > 1421355744.032   7405 10.59.1.9 TCP_MISS/200 538419 GET
http://www.blogojciec.pl/wp-content/uploads/2014/11/Rachels-header-with-Ben-added-and-name-726x400.png
- HIER_DIRECT/185.23.21.14 image/png
> > 1421355744.092   8379 10.59.1.9 TCP_MISS/200 470427 GET
http://www.blogojciec.pl/wp-content/uploads/2014/11/poland-726x400.png -
HIER_DIRECT/185.23.21.14 image/png
> > 1421355746.084   1964 10.59.1.9 TCP_MISS/200 60489 GET
http://www.blogojciec.pl/wp-content/uploads/2015/01/4815760850_4b06e8e3d1_b-960x430.jpg
- HIER_DIRECT/185.23.21.14 image/jpeg
> > 1421355746.333 351147 10.59.1.9 TCP_MISS/200 9257 CONNECT
api.instagram.com:443 - HIER_DIRECT/107.23.224.121 -
> > 1421355746.333  20041 10.59.1.9 TCP_MISS/200 173 CONNECT
fbstatic-a.akamaihd.net:443 - HIER_DIRECT/2600:1404:14::17dc:64b3 -
> > 1421355746.333  20039 10.59.1.9 TCP_MISS/200 173 CONNECT
fbstatic-a.akamaihd.net:443 - HIER_DIRECT/2600:1404:14::17dc:64b3 -
> > 1421355746.507   2373 10.59.1.9 TCP_MISS/200 152416 GET
http://www.blogojciec.pl/wp-content/uploads/2014/03/4957524690_62271cbc0f_o-e1409310201525-960x430.jpg
- HIER_DIRECT/185.23.21.14 image/jpeg
> > 1421355747.597   3462 10.59.1.9 TCP_MISS/200 207217 GET
http://www.blogojciec.pl/wp-content/uploads/2014/05/sad.jpg -
HIER_DIRECT/185.23.21.14 image/jpeg
> > 1421355747.698   1184 10.59.1.9 TCP_MISS/200 61353 GET
http://www.blogojciec.pl/wp-content/uploads/2014/12/6697132255_2ddb665dd7_o-800x430.jpg
- HIER_DIRECT/185.23.21.14 image/jpeg
> > 1421355748.101   2006 10.59.1.9 TCP_MISS/200 62702 GET
http://www.blogojciec.pl/wp-content/uploads/2015/01/1902628132_1dc03a6544_b-960x430.jpg
- HIER_DIRECT/185.23.21.14 image/jpeg
> > 1421355750.199   6060 10.59.1.9 TCP_MISS/200 87128 GET
http://www.blogojciec.pl/wp-content/uploads/2014/06/kitchenok.jpg -
HIER_DIRECT/185.23.21.14 image/jpeg
> > 1421355750.357   2745 10.59.1.9 TCP_MISS/200 91760 GET
http://www.blogojciec.pl/wp-content/uploads/2014/12/14296826765_557697dc2a_k-960x430.jpg
- HIER_DIRECT/185.23.21.14 image/jpeg
> > 1421355750.542   6399 10.59.1.9 TCP_MISS/200 174792 GET
http://www.blogojciec.pl/wp-content/uploads/2014/05/spiderman.jpg -
HIER_DIRECT/185.23.21.14 image/jpeg
> > ^C
>
> > My testing was:
> > - first I opened this blog site in Chrome
> > - then I opened it in IE
>
> > so why ?
>
>
>
> 
> 15.01.2015 17:44, Robert &#x43F;&#x438;&#x448;&#x435;&#x442;:
> >>> [...]
> >>>
> >>>>> 1421183413.322    185 10.59.1.9 TCP_MISS_ABORTED/503 1541 GET
> >>>>>> http://www.amazon.com/gp/am/metro/application/livetileRedirect? -
> >>>>>> HIER_DIRECT/205.251.242.103 text/html
> >>>>>> 1421183415.611    132 10.59.1.9 TCP_MISS/206 8526 GET
> >>>>>> http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87i9P.jpg? -
> >>>>>> HIER_DIRECT/23.220.133.211 image/jpeg 1421183416.619     34
> >>>>>> 10.59.1.9 TCP_MISS/206 834 GET
> >>>>>> http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87i9P.jpg? -
> >>>>>> HIER_DIRECT/23.220.133.211 image/jpeg 1421183417.094     76
> >>>>>> 10.59.1.9 TCP_MISS/206 11123 GET
> >>>>>> http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA86gtq.jpg? -
> >>>>>> HIER_DIRECT/23.220.133.211 image/jpeg 1421183418.269     52
> >>>>>> 10.59.1.9 TCP_MISS/206 4882 GET
> >>>>> http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87zJF.jpg? -
> >>>>>> HIER_DIRECT/23.220.133.211 image/jpeg
> >>>>> Partial messages (206) from servers are not cacheable by Squid. And
> >>>>> again the non-logged query parameters may make what appears to be
> >>>>> identical requests actually quite different.
> >>>>>> I don't have any TCP_HIT :( , so what is going on ? why Squid
> >>>>>> doesn't work ? :(
> >>>>>>
> >>>>> For testing configure:
> >>>>>   strip_query_terms off
> >>>>> Also, how are you doing the testing?
> >>>>> HTTP clients are able to send explicit instructions to proxies
> >>>>> forbidding the use of cache. The curl tools do that by default, and
> >>>>> also the browser "Refresh" or "Reload" buttons.
> >>>>>
> >>>>
> >>>> 1. ok , so testing I do by surfing on two sites wp.pl and kosmos.pl ,
> if you think they are wrong please give me samples of sites which will
> be good for testing
> >>>> 2. I'm testing by going few time through the same links and also
> using refresh , and I get most :
> >>>> TCP_MISS/200
> >>>> sometimes:
> >>>> TCP_REFRESH_UNMODIFIED/304
> >>>>
> >>>>
> >>>>
> >>>
> >>>
> >>> Could somebody help me and answer ?
> >>>
> >>> Best question in my situation now is: on which sites I can test Squid
> to see TCP_HIT messages in log?
> >>>
> >>>
> >>>
> >>> _______________________________________________
> >>> squid-users mailing list
> >>> squid-users at lists.squid-cache.org
> >>> http://lists.squid-cache.org/listinfo/squid-users
> 
>> 
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>> 
>
>
> 
>
>
>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUuC3/AAoJENNXIZxhPexG7hIIAMEPJarZgNthsTdjludWKPOi
a4B3x7VAR3OYlkkSj0aU78Tw3IE0I+oSLSYB7Xg+V5iehh0xmDQrh3j92q3+OEeP
0nHavqjwEpD9y7LqUJxTd8K798CmudZEQcdLshrGdFghWNnPI8VueYW8lemQ5tAO
sTbwqHIDc848hs3B+cBXKEtSRgtRgFsEDjOwvVeiMVZeATWnYB/0R6eyizjvOqpl
nLeQrJ/IhPz2DB515+KY05T0ZoRc+6IjCXAl8LZnspvTSSoYgh75DGiVXvIpzCSl
Me52dZfLjtegtlAXObrCGS/2U3w2xdrE8YWul0tm85/9NCQU0Cj0UXpsAMj67qg=
=cHeB
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150116/deedad8c/attachment.htm>

From yvoinov at gmail.com  Thu Jan 15 21:16:59 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Fri, 16 Jan 2015 03:16:59 +0600
Subject: [squid-users] Odp: Re:  Odp:  Odp: Re:  Only TCP_MISS
In-Reply-To: <54b82c21500954.90609165@wp.pl>
References: <54b82c21500954.90609165@wp.pl>
Message-ID: <54B82E4B.1000402@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Oh,

of course - you must to warm up cache first also.

:)

16.01.2015 3:07, Robert ?????:
> Dnia Czwartek, 15 Stycznia 2015 12:54 Yuri Voinov <yvoinov at gmail.com> napisa?(a)
>> 
> This URL
> 
> http://www.squid-cache.org/Images/img4.jpg
> 
> produces HIT on second query.
> 
> 
>
> > Ok, this is working - give TCP_MEM_HIT/200
>
> > But can anybody explain me why such a images are not cached ?
> > 1421355736.332 341144 10.59.1.9 TCP_MISS/200 9228 CONNECT
api.instagram.com:443 - HIER_DIRECT/107.23.224.121 -
> > 1421355736.332  14042 10.59.1.9 TCP_MISS/200 255 CONNECT
www.facebook.com:443 - HIER_DIRECT/2a03:2880:f000:1:face:b00c:0:1 -
> > 1421355736.577   1980 10.59.1.9 TCP_MISS/200 62566 GET
http://www.blogojciec.pl/wp-content/uploads/2014/11/8334168249_1b5c1a6e7a_k-726x400.jpg
- HIER_DIRECT/185.23.21.14 image/jpeg
> > 1421355736.828    738 10.59.1.9 TCP_MISS/200 48321 GET
http://www.blogojciec.pl/wp-content/uploads/2014/11/2335080161_6c96f831b1_b-726x400.jpg
- HIER_DIRECT/185.23.21.14 image/jpeg
> > 1421355737.010   3036 10.59.1.9 TCP_MISS/200 124617 GET
http://www.blogojciec.pl/wp-content/uploads/2014/11/277485096_a64e491f09_o-726x400.jpg
- HIER_DIRECT/185.23.21.14 image/jpeg
> > 1421355737.461    376 10.59.1.9 TCP_MISS/200 627 GET
http://www.blogojciec.pl/wp-content/themes/rigel/images/main_slider_bg.png
- HIER_DIRECT/185.23.21.14 image/png
> > 1421355737.842    357 10.59.1.9 TCP_MISS/200 447 GET
http://www.blogojciec.pl/wp-content/plugins/facebook-page-promoter-lightbox/includes/front/scs/blank.gif
- HIER_DIRECT/185.23.21.14 image/gif
> > 1421355738.547   1695 10.59.1.9 TCP_MISS/200 138449 GET
http://www.blogojciec.pl/wp-content/uploads/2013/09/DSC_1397.jpg -
HIER_DIRECT/185.23.21.14 image/jpeg
> > 1421355738.819   2937 10.59.1.9 TCP_MISS/200 143772 GET
http://www.blogojciec.pl/wp-content/uploads/2014/11/6947435171_465587a2d4_k-726x400.jpg
- HIER_DIRECT/185.23.21.14 image/jpeg
> > 1421355741.078   7149 10.59.1.9 TCP_MISS/200 384465 GET
http://www.blogojciec.pl/wp-content/uploads/2014/11/AMNESTY_STOP_1-716x400.png
- HIER_DIRECT/185.23.21.14 image/png
> > 1421355741.339 240241 10.59.1.9 TCP_MISS/200 5106 CONNECT
clients2.google.com:443 - HIER_DIRECT/2607:f8b0:4002:c07::8a -
> > 1421355744.032   7405 10.59.1.9 TCP_MISS/200 538419 GET
http://www.blogojciec.pl/wp-content/uploads/2014/11/Rachels-header-with-Ben-added-and-name-726x400.png
- HIER_DIRECT/185.23.21.14 image/png
> > 1421355744.092   8379 10.59.1.9 TCP_MISS/200 470427 GET
http://www.blogojciec.pl/wp-content/uploads/2014/11/poland-726x400.png -
HIER_DIRECT/185.23.21.14 image/png
> > 1421355746.084   1964 10.59.1.9 TCP_MISS/200 60489 GET
http://www.blogojciec.pl/wp-content/uploads/2015/01/4815760850_4b06e8e3d1_b-960x430.jpg
- HIER_DIRECT/185.23.21.14 image/jpeg
> > 1421355746.333 351147 10.59.1.9 TCP_MISS/200 9257 CONNECT
api.instagram.com:443 - HIER_DIRECT/107.23.224.121 -
> > 1421355746.333  20041 10.59.1.9 TCP_MISS/200 173 CONNECT
fbstatic-a.akamaihd.net:443 - HIER_DIRECT/2600:1404:14::17dc:64b3 -
> > 1421355746.333  20039 10.59.1.9 TCP_MISS/200 173 CONNECT
fbstatic-a.akamaihd.net:443 - HIER_DIRECT/2600:1404:14::17dc:64b3 -
> > 1421355746.507   2373 10.59.1.9 TCP_MISS/200 152416 GET
http://www.blogojciec.pl/wp-content/uploads/2014/03/4957524690_62271cbc0f_o-e1409310201525-960x430.jpg
- HIER_DIRECT/185.23.21.14 image/jpeg
> > 1421355747.597   3462 10.59.1.9 TCP_MISS/200 207217 GET
http://www.blogojciec.pl/wp-content/uploads/2014/05/sad.jpg -
HIER_DIRECT/185.23.21.14 image/jpeg
> > 1421355747.698   1184 10.59.1.9 TCP_MISS/200 61353 GET
http://www.blogojciec.pl/wp-content/uploads/2014/12/6697132255_2ddb665dd7_o-800x430.jpg
- HIER_DIRECT/185.23.21.14 image/jpeg
> > 1421355748.101   2006 10.59.1.9 TCP_MISS/200 62702 GET
http://www.blogojciec.pl/wp-content/uploads/2015/01/1902628132_1dc03a6544_b-960x430.jpg
- HIER_DIRECT/185.23.21.14 image/jpeg
> > 1421355750.199   6060 10.59.1.9 TCP_MISS/200 87128 GET
http://www.blogojciec.pl/wp-content/uploads/2014/06/kitchenok.jpg -
HIER_DIRECT/185.23.21.14 image/jpeg
> > 1421355750.357   2745 10.59.1.9 TCP_MISS/200 91760 GET
http://www.blogojciec.pl/wp-content/uploads/2014/12/14296826765_557697dc2a_k-960x430.jpg
- HIER_DIRECT/185.23.21.14 image/jpeg
> > 1421355750.542   6399 10.59.1.9 TCP_MISS/200 174792 GET
http://www.blogojciec.pl/wp-content/uploads/2014/05/spiderman.jpg -
HIER_DIRECT/185.23.21.14 image/jpeg
> > ^C
>
> > My testing was:
> > - first I opened this blog site in Chrome
> > - then I opened it in IE
>
> > so why ?
>
>
>
> 
> 15.01.2015 17:44, Robert &#x43F;&#x438;&#x448;&#x435;&#x442;:
> >>> [...]
> >>>
> >>>>> 1421183413.322    185 10.59.1.9 TCP_MISS_ABORTED/503 1541 GET
> >>>>>> http://www.amazon.com/gp/am/metro/application/livetileRedirect? -
> >>>>>> HIER_DIRECT/205.251.242.103 text/html
> >>>>>> 1421183415.611    132 10.59.1.9 TCP_MISS/206 8526 GET
> >>>>>> http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87i9P.jpg? -
> >>>>>> HIER_DIRECT/23.220.133.211 image/jpeg 1421183416.619     34
> >>>>>> 10.59.1.9 TCP_MISS/206 834 GET
> >>>>>> http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87i9P.jpg? -
> >>>>>> HIER_DIRECT/23.220.133.211 image/jpeg 1421183417.094     76
> >>>>>> 10.59.1.9 TCP_MISS/206 11123 GET
> >>>>>> http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA86gtq.jpg? -
> >>>>>> HIER_DIRECT/23.220.133.211 image/jpeg 1421183418.269     52
> >>>>>> 10.59.1.9 TCP_MISS/206 4882 GET
> >>>>> http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87zJF.jpg? -
> >>>>>> HIER_DIRECT/23.220.133.211 image/jpeg
> >>>>> Partial messages (206) from servers are not cacheable by Squid. And
> >>>>> again the non-logged query parameters may make what appears to be
> >>>>> identical requests actually quite different.
> >>>>>> I don't have any TCP_HIT :( , so what is going on ? why Squid
> >>>>>> doesn't work ? :(
> >>>>>>
> >>>>> For testing configure:
> >>>>>   strip_query_terms off
> >>>>> Also, how are you doing the testing?
> >>>>> HTTP clients are able to send explicit instructions to proxies
> >>>>> forbidding the use of cache. The curl tools do that by default, and
> >>>>> also the browser "Refresh" or "Reload" buttons.
> >>>>>
> >>>>
> >>>> 1. ok , so testing I do by surfing on two sites wp.pl and kosmos.pl ,
> if you think they are wrong please give me samples of sites which will
> be good for testing
> >>>> 2. I'm testing by going few time through the same links and also
> using refresh , and I get most :
> >>>> TCP_MISS/200
> >>>> sometimes:
> >>>> TCP_REFRESH_UNMODIFIED/304
> >>>>
> >>>>
> >>>>
> >>>
> >>>
> >>> Could somebody help me and answer ?
> >>>
> >>> Best question in my situation now is: on which sites I can test Squid
> to see TCP_HIT messages in log?
> >>>
> >>>
> >>>
> >>> _______________________________________________
> >>> squid-users mailing list
> >>> squid-users at lists.squid-cache.org
> >>> http://lists.squid-cache.org/listinfo/squid-users
> 
>> 
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>> 
>
>
> 
>
>
>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUuC5LAAoJENNXIZxhPexGZ3cH/0LiLHVd/anFEUiuFtHLBcoU
GkPzjbTg5UWxDi3I/yvrVbdxBZ+N7VJI3mt8246Rxhf89LgaLNIMp/dE7QvZiau+
kR2K45xVUQQW6Fi/P5BDz0ntR/FU5q9/qr3gYZjtRhYoCaFTdQWBYB4e+MHwaqCE
8Nd2jXnWkqOaOy2XObZCDIp+93L35iVI3luvuRQHbdAZrOtc5wgD7rFNXY+GdN7E
YsjEsm2XNaS5vt/B2ZJbk0NWLSf1MTkOBSTb4Z1QVQhhbeMZ9OjzIrEiYabDat5Z
/2VI5c4RwF322YMt+FdpWHFR/QS8+p1/Bik2gkSiCv8WXtwXPUiYgLIF+6RMWec=
=VZif
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150116/76a13f69/attachment.htm>

From wrkilu at wp.pl  Thu Jan 15 21:35:45 2015
From: wrkilu at wp.pl (Robert)
Date: Thu, 15 Jan 2015 22:35:45 +0100
Subject: [squid-users] Odp: Re: Odp: Re:  Odp:  Odp: Re:  Only TCP_MISS
Message-ID: <54b832b15a6526.29168957@wp.pl>

Dnia Czwartek, 15 Stycznia 2015 22:16 Yuri Voinov <yvoinov at gmail.com> napisa?(a)
>  -----BEGIN PGP SIGNED MESSAGE----- 
>  Hash: SHA1 
>   
>  Oh,
>  
>  of course - you must to warm up cache first also.
>  
>  :)
>  

1. warm up cache
What the hell is that ? ;) , no Squid installation guide says about it, please give me link to some (simple) guide to warm up my swap to cache as much as possible

2. "First reason - HTTP headers. I.e, no cache. etc. You can override them with refresh_patterns violations. :)"
Again, please tell me what refresh_patterns should I set to increase as most caching , also with headers caching if this is possible

3. I did next text with site pkp.pl:
1421356447.223    193 10.59.1.9 TCP_MISS/200 4657 GET http://rozklad-pkp.pl/img/content/icons/disab.png - HIER_DIRECT/213.199.225.44 image/png
1421356447.270    200 10.59.1.9 TCP_MISS/200 4505 GET http://rozklad-pkp.pl/img/content/icons/direct.png - HIER_DIRECT/213.199.225.44 image/png
1421356447.274    961 10.59.1.9 TCP_MISS/200 80175 GET http://rozklad-pkp.pl/css/lato-bold-webfont.woff - HIER_DIRECT/213.199.225.44 text/plain
1421356447.297    190 10.59.1.9 TCP_MISS/200 1683 GET http://rozklad-pkp.pl/img/content/icons/arrow-down-3.png - HIER_DIRECT/213.199.225.44 image/png
1421356447.442    198 10.59.1.9 TCP_MISS/200 1732 GET http://rozklad-pkp.pl/img/content/icons/main/plus.png - HIER_DIRECT/213.199.225.44 image/png
1421356447.455    193 10.59.1.9 TCP_MISS/200 1834 GET http://rozklad-pkp.pl/img/header/search.png - HIER_DIRECT/213.199.225.44 image/png
1421356447.476    209 10.59.1.9 TCP_MISS/200 1665 GET http://rozklad-pkp.pl/img/content/icons/main/from.png - HIER_DIRECT/213.199.225.44 image/png
1421356447.502    228 10.59.1.9 TCP_MISS/200 1641 GET http://rozklad-pkp.pl/img/content/icons/main/cal.png - HIER_DIRECT/213.199.225.44 image/png
1421356447.525      2 10.59.1.9 TCP_MEM_HIT/200 46701 GET http://rozklad-pkp.pl/img/content/icons/map/mapa3.png - HIER_NONE/- image/png
1421356447.530    246 10.59.1.9 TCP_MISS/200 1666 GET http://rozklad-pkp.pl/img/content/icons/main/to.png - HIER_DIRECT/213.199.225.44 image/png
1421356447.569    266 10.59.1.9 TCP_MISS/200 1735 GET http://rozklad-pkp.pl/img/content/icons/arrow-up-2.png - HIER_DIRECT/213.199.225.44 image/png
1421356447.901    445 10.59.1.9 TCP_MISS/200 8944 GET http://rozklad-pkp.pl/img/content/bg/bn-na.png - HIER_DIRECT/213.199.225.44 image/png
1421356447.932    471 10.59.1.9 TCP_MISS/200 7638 GET http://rozklad-pkp.pl/img/content/bg/bn-na_780.png - HIER_DIRECT/213.199.225.44 image/png
1421356447.959    478 10.59.1.9 TCP_MISS/200 6506 GET http://rozklad-pkp.pl/img/content/bg/bn-na_480.png - HIER_DIRECT/213.199.225.44 image/png
1421356448.457    916 10.59.1.9 TCP_MISS/200 1573 GET http://rozklad-pkp.pl/img/content/icons/main/minus.png - HIER_DIRECT/213.199.225.44 image/png
1421356448.477    932 10.59.1.9 TCP_MISS/200 1786 GET http://rozklad-pkp.pl/hafas-res/img/sel_prod_ice.gif - HIER_DIRECT/213.199.225.44 image/gif
1421356448.552    979 10.59.1.9 TCP_MISS/200 1771 GET http://rozklad-pkp.pl/hafas-res/img/sel_prod_ic.gif - HIER_DIRECT/213.199.225.44 image/gif
1421356448.586   1281 10.59.1.9 TCP_MISS/200 672 GET http://bbcdn-bbnaut.ibillboard.com/server-static-files/bbnaut-b.swf - HIER_DIRECT/194.213.222.30 application/x-shockwave-flash
1421356448.668    741 10.59.1.9 TCP_MISS/200 1823 GET http://rozklad-pkp.pl/hafas-res/img/sel_prod_ir-d.gif - HIER_DIRECT/213.199.225.44 image/gif
1421356448.694    757 10.59.1.9 TCP_MISS/200 1868 GET http://rozklad-pkp.pl/hafas-res/img/sel_prod_re-rb.gif - HIER_DIRECT/213.199.225.44 image/gif
1421356448.956    467 10.59.1.9 TCP_MISS/200 9284 GET http://rozklad-pkp.pl/img/content/banners/banner3.jpg - HIER_DIRECT/213.199.225.44 image/jpeg
1421356448.973    477 10.59.1.9 TCP_MISS/200 4047 GET http://rozklad-pkp.pl/img/content/icons/arrow-up-4.png - HIER_DIRECT/213.199.225.44 image/png
1421356448.976    417 10.59.1.9 TCP_MISS/200 636 GET http://rozklad-pkp.pl/css/images/ui-bg_flat_75_ffffff_40x100.png - HIER_DIRECT/213.199.225.44 image/png
1421356449.045    324 10.59.1.9 TCP_MISS/200 5414 GET http://rozklad-pkp.pl/img/content/icons/bullet-active.png - HIER_DIRECT/213.199.225.44 image/png
1421356449.064    338 10.59.1.9 TCP_MISS/200 4736 GET http://rozklad-pkp.pl/img/content/icons/bullet.png - HIER_DIRECT/213.199.225.44 image/png
1421356449.110    917 10.59.1.9 TCP_MISS/200 16451 GET http://rozklad-pkp.pl/img/content/banners/banner2.jpg - HIER_DIRECT/213.199.225.44 image/jpeg
1421356449.321    179 10.59.1.9 TCP_MISS/200 1594 GET http://rozklad-pkp.pl/favicon.ico - HIER_DIRECT/213.199.225.44 image/vnd.microsoft.icon
1421356449.658    348 10.59.1.9 TCP_MISS/304 167 GET http://bbnaut.ibillboard.com/g/ca2 - HIER_DIRECT/62.209.227.210 -


.. and once again I see many picture files not cached , why ? 








From squid3 at treenet.co.nz  Fri Jan 16 01:55:46 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 16 Jan 2015 14:55:46 +1300
Subject: [squid-users] Squid and site ryanair.com
In-Reply-To: <1421343366034-4669108.post@n4.nabble.com>
References: <1421337529987-4669105.post@n4.nabble.com>
 <1421343366034-4669108.post@n4.nabble.com>
Message-ID: <54B86FA2.10909@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 16/01/2015 6:36 a.m., masterx81 wrote:
> I've also tried to add the domain ryanair.com to the domains that
> return DIRECT on the wpad file (for bypass squid), but also in this
> way that things on the site doesn't work.

I guess that means that your PAC file is broken,
 or your client is not using the PAC bypass like you think it was,
 or maybe not using the updated PAC.

DIRECT means not to even send the request to the proxy. Squid has
absolutely nothing to do with traffic going DIRECT in PAC.

> They work only if i disable totally the proxy. Any ideas? Thanks!
> 

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUuG+iAAoJELJo5wb/XPRj7ngH/3TALe/KhpLz7k9mWiZiTFyR
SMrQ2Wg+9o7TT15HmU9muGCpbUhlfgc1W5jp7Kt+ExmJxdyKOLjuqGhAhLOHalB/
U/xnd09JQP83j13IyPveEu3393o8wEASfnBFWvzKTekENdtale6ZY2paQHusgXra
d8JYNiKQwfP3CkQdbFkUwSnryVb8YFf+lyGYv2gJLq5vvX6eqmxCCS6dD8PdB4Y3
t0IH6JIxGxF8XWEZu8C5JJK4qzK5NCFxXW7wLcuuHUJbeyywfvgYHyJyOYRdPDL8
o1O5TX39U17CNJujYBSEXfrojxju1P+zsxrsD14PW4I2kCG3woi/qMWVl9KjuW0=
=14/t
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Fri Jan 16 02:15:26 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 16 Jan 2015 15:15:26 +1300
Subject: [squid-users] Odp: Re:  Odp:  Odp: Re:  Only TCP_MISS
In-Reply-To: <54b82c21500954.90609165@wp.pl>
References: <54b82c21500954.90609165@wp.pl>
Message-ID: <54B8743E.2010202@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 16/01/2015 10:07 a.m., Robert wrote:
> Dnia Czwartek, 15 Stycznia 2015 12:54 Yuri Voinov
> <yvoinov at gmail.com> napisa?(a)
>> 
> This URL
> 
> http://www.squid-cache.org/Images/img4.jpg
> 
> produces HIT on second query.
> 
> 
> 
>> Ok, this is working - give TCP_MEM_HIT/200
> 
>> But can anybody explain me why such a images are not cached ? 
>> 1421355736.332 341144 10.59.1.9 TCP_MISS/200 9228 CONNECT
>> api.instagram.com:443 - HIER_DIRECT/107.23.224.121 - 
>> 1421355736.332  14042 10.59.1.9 TCP_MISS/200 255 CONNECT
>> www.facebook.com:443 - HIER_DIRECT/2a03:2880:f000:1:face:b00c:0:1
>> - 1421355736.577   1980 10.59.1.9 TCP_MISS/200 62566 GET
>> http://www.blogojciec.pl/wp-content/uploads/2014/11/8334168249_1b5c1a6e7a_k-726x400.jpg
>> - HIER_DIRECT/185.23.21.14 image/jpeg 1421355736.828    738
>> 10.59.1.9 TCP_MISS/200 48321 GET
>> http://www.blogojciec.pl/wp-content/uploads/2014/11/2335080161_6c96f831b1_b-726x400.jpg
>> - HIER_DIRECT/185.23.21.14 image/jpeg 1421355737.010   3036
>> 10.59.1.9 TCP_MISS/200 124617 GET
>> http://www.blogojciec.pl/wp-content/uploads/2014/11/277485096_a64e491f09_o-726x400.jpg
>> - HIER_DIRECT/185.23.21.14 image/jpeg 1421355737.461    376
>> 10.59.1.9 TCP_MISS/200 627 GET
>> http://www.blogojciec.pl/wp-content/themes/rigel/images/main_slider_bg.png
>> - HIER_DIRECT/185.23.21.14 image/png 1421355737.842    357
>> 10.59.1.9 TCP_MISS/200 447 GET
>> http://www.blogojciec.pl/wp-content/plugins/facebook-page-promoter-lightbox/includes/front/scs/blank.gif
>> - HIER_DIRECT/185.23.21.14 image/gif 1421355738.547   1695
>> 10.59.1.9 TCP_MISS/200 138449 GET
>> http://www.blogojciec.pl/wp-content/uploads/2013/09/DSC_1397.jpg
>> - HIER_DIRECT/185.23.21.14 image/jpeg 1421355738.819   2937
>> 10.59.1.9 TCP_MISS/200 143772 GET
>> http://www.blogojciec.pl/wp-content/uploads/2014/11/6947435171_465587a2d4_k-726x400.jpg
>> - HIER_DIRECT/185.23.21.14 image/jpeg 1421355741.078   7149
>> 10.59.1.9 TCP_MISS/200 384465 GET
>> http://www.blogojciec.pl/wp-content/uploads/2014/11/AMNESTY_STOP_1-716x400.png
>> - HIER_DIRECT/185.23.21.14 image/png 1421355741.339 240241
>> 10.59.1.9 TCP_MISS/200 5106 CONNECT clients2.google.com:443 -
>> HIER_DIRECT/2607:f8b0:4002:c07::8a - 1421355744.032   7405
>> 10.59.1.9 TCP_MISS/200 538419 GET
>> http://www.blogojciec.pl/wp-content/uploads/2014/11/Rachels-header-with-Ben-added-and-name-726x400.png
>> - HIER_DIRECT/185.23.21.14 image/png 1421355744.092   8379
>> 10.59.1.9 TCP_MISS/200 470427 GET
>> http://www.blogojciec.pl/wp-content/uploads/2014/11/poland-726x400.png
>> - HIER_DIRECT/185.23.21.14 image/png 1421355746.084   1964
>> 10.59.1.9 TCP_MISS/200 60489 GET
>> http://www.blogojciec.pl/wp-content/uploads/2015/01/4815760850_4b06e8e3d1_b-960x430.jpg
>> - HIER_DIRECT/185.23.21.14 image/jpeg 1421355746.333 351147
>> 10.59.1.9 TCP_MISS/200 9257 CONNECT api.instagram.com:443 -
>> HIER_DIRECT/107.23.224.121 - 1421355746.333  20041 10.59.1.9
>> TCP_MISS/200 173 CONNECT fbstatic-a.akamaihd.net:443 -
>> HIER_DIRECT/2600:1404:14::17dc:64b3 - 1421355746.333  20039
>> 10.59.1.9 TCP_MISS/200 173 CONNECT fbstatic-a.akamaihd.net:443 -
>> HIER_DIRECT/2600:1404:14::17dc:64b3 - 1421355746.507   2373
>> 10.59.1.9 TCP_MISS/200 152416 GET
>> http://www.blogojciec.pl/wp-content/uploads/2014/03/4957524690_62271cbc0f_o-e1409310201525-960x430.jpg
>> - HIER_DIRECT/185.23.21.14 image/jpeg 1421355747.597   3462
>> 10.59.1.9 TCP_MISS/200 207217 GET
>> http://www.blogojciec.pl/wp-content/uploads/2014/05/sad.jpg -
>> HIER_DIRECT/185.23.21.14 image/jpeg 1421355747.698   1184
>> 10.59.1.9 TCP_MISS/200 61353 GET
>> http://www.blogojciec.pl/wp-content/uploads/2014/12/6697132255_2ddb665dd7_o-800x430.jpg
>> - HIER_DIRECT/185.23.21.14 image/jpeg 1421355748.101   2006
>> 10.59.1.9 TCP_MISS/200 62702 GET
>> http://www.blogojciec.pl/wp-content/uploads/2015/01/1902628132_1dc03a6544_b-960x430.jpg
>> - HIER_DIRECT/185.23.21.14 image/jpeg 1421355750.199   6060
>> 10.59.1.9 TCP_MISS/200 87128 GET
>> http://www.blogojciec.pl/wp-content/uploads/2014/06/kitchenok.jpg
>> - HIER_DIRECT/185.23.21.14 image/jpeg 1421355750.357   2745
>> 10.59.1.9 TCP_MISS/200 91760 GET
>> http://www.blogojciec.pl/wp-content/uploads/2014/12/14296826765_557697dc2a_k-960x430.jpg
>> - HIER_DIRECT/185.23.21.14 image/jpeg 1421355750.542   6399
>> 10.59.1.9 TCP_MISS/200 174792 GET
>> http://www.blogojciec.pl/wp-content/uploads/2014/05/spiderman.jpg
>> - HIER_DIRECT/185.23.21.14 image/jpeg ^C
> 
>> My testing was: - first I opened this blog site in Chrome - then
>> I opened it in IE
> 
>> so why ?


The site is using HTTP header "Vary: User-Agent".

So each time you change browser Squid has to discard its content and
fetch new ones. There is nothing that can be done about that short of
getting the website itself fixed.

FYI: I checked these URLs with the tool you can find at
http://redbot.org/. Simply pick a URL you think should be cached, and
paste it into the redbot tool. It runs a series of tests and lists all
the HTTP problems it can find.


For testing ensure that you;
* use only one browser at a time
 - two is fine overall, BUT only use one for a series of tests before
switching and repeating the whole series. if you switch in the middle
of the series or after only one request things liek Vary in HTTP will
make your test shave garbage results (eg. constant MISS you are seeing).

* make several requests in a row from your chosen browser *without*
using the refresh/reload button (instead click in address bar and
press enter).

* clear the *browser* cach if you like between requests to see what
Squid does with multiple clients.



Also, please note that several different result tags/codes (HIT,
REFRESH, SWAPFAIL, SHARED, STALE, OFFLINE, etc) are all "cache hits".
See
<http://wiki.squid-cache.org/SquidFaq/SquidLogs#Squid_result_codes>
for details on what the tags all mean.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUuHQ9AAoJELJo5wb/XPRjlH4IAMyzMsSIXsym+bjDJG2NThyf
lUCsrvFUKxE10WBc32tjzyArjM/Ve+YT2zUvjHWYkgd+/YSH+3IvwpFd4jplaUWZ
H5faFquaK/75uOtGPSyZxrjaLOCo0F/HNO4U/7XQrULpFpSJolDFDmCASW3wtO9a
LdH+7J1SwP+jz1jQ2h02oyqkuxdg8669ZDzxcztkSJnZwP3GSg0R4IjWE2hb/HKK
DstGLlLJUgeJtor0KJAN459IOHE5pv590gGuWQdGZO0abANphDdWdKdve2ClVn5B
MTR70O+LuRwkfSdsC9FqUd5fMs8dQv8YQ1ue/7le/ypx/X6UpkHYKqOlAlB46MM=
=deb/
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Fri Jan 16 03:10:14 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 16 Jan 2015 16:10:14 +1300
Subject: [squid-users] Odp: Re: Odp: Re:  Odp:  Odp: Re:  Only TCP_MISS
In-Reply-To: <54b832b15a6526.29168957@wp.pl>
References: <54b832b15a6526.29168957@wp.pl>
Message-ID: <54B88116.1010600@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 16/01/2015 10:35 a.m., Robert wrote:
> Dnia Czwartek, 15 Stycznia 2015 22:16 Yuri Voinov napisa?(a)
>> Oh,
>> 
>> of course - you must to warm up cache first also.
>> 
>> :)
>> 
> 
> 1. warm up cache What the hell is that ? ;) , no Squid installation
> guide says about it, please give me link to some (simple) guide to
> warm up my swap to cache as much as possible
> 

Squid of course *does not* come bundled with an installed copy of the
entire Internet.

A freshly installed or restarted[1] proxy has a cache in state called
"cold". Each repeat fetch for a URL "warms" it.URL which are often
requested are called "hot".

You have to make one request where a MISS is guaranteed. That request
tells Squid whether to cache the reply for *future* use. All that
first request will tell you is whether the URL is possible to fetch.
Nothing about caching in access.log.

To know if a reply has been cached requires at least a second request.
That ones access.log details say whether *it* was a hit or miss or
refresh.


[1] disk cache persist across restart. So simply restarting Squid
resets to either cold or warm states depending on disk usage. Usually
the hottest objects will be exclusively in RAM and the latest copy
need fetching from the network on restart - this ensures that hot
objects are always up to date and accurate.


> 2. "First reason - HTTP headers. I.e, no cache. etc. You can
> override them with refresh_patterns violations. :)" Again, please
> tell me what refresh_patterns should I set to increase as most
> caching , also with headers caching if this is possible
> 

Please don't go that way. At least not now. So far it has been your
testing methodology which is broken, not the sites operation. (Except
that one doing Vary:User-Agent and nothing can be done in squid.conf
about that.)

Many of the refresh_pattern override/ignore options *break* HTTP and
are only to be used if you understand the impact of what that use
means, with a specific broken website that requires it. You need to
know exactly *what* is broken about the website to be able to
configure the overrides correctly for it.


If you want better caching, ensure that you have the latest Squid
available. We are constantly searching out ways to safely improve the
amount Squid can store and remove the need for those overrides to
exist at all.



> 3. I did next text with site pkp.pl: 1421356447.223    193
> 10.59.1.9 TCP_MISS/200 4657 GET
> http://rozklad-pkp.pl/img/content/icons/disab.png -
> HIER_DIRECT/213.199.225.44 image/png 1421356447.270    200
> 10.59.1.9 TCP_MISS/200 4505 GET
> http://rozklad-pkp.pl/img/content/icons/direct.png -
> HIER_DIRECT/213.199.225.44 image/png 1421356447.274    961
> 10.59.1.9 TCP_MISS/200 80175 GET
> http://rozklad-pkp.pl/css/lato-bold-webfont.woff -
> HIER_DIRECT/213.199.225.44 text/plain 1421356447.297    190
> 10.59.1.9 TCP_MISS/200 1683 GET
> http://rozklad-pkp.pl/img/content/icons/arrow-down-3.png -
> HIER_DIRECT/213.199.225.44 image/png 1421356447.442    198
> 10.59.1.9 TCP_MISS/200 1732 GET
> http://rozklad-pkp.pl/img/content/icons/main/plus.png -
> HIER_DIRECT/213.199.225.44 image/png 1421356447.455    193
> 10.59.1.9 TCP_MISS/200 1834 GET
> http://rozklad-pkp.pl/img/header/search.png -
> HIER_DIRECT/213.199.225.44 image/png 1421356447.476    209
> 10.59.1.9 TCP_MISS/200 1665 GET
> http://rozklad-pkp.pl/img/content/icons/main/from.png -
> HIER_DIRECT/213.199.225.44 image/png 1421356447.502    228
> 10.59.1.9 TCP_MISS/200 1641 GET
> http://rozklad-pkp.pl/img/content/icons/main/cal.png -
> HIER_DIRECT/213.199.225.44 image/png 1421356447.525      2
> 10.59.1.9 TCP_MEM_HIT/200 46701 GET
> http://rozklad-pkp.pl/img/content/icons/map/mapa3.png - HIER_NONE/-
> image/png 1421356447.530    246 10.59.1.9 TCP_MISS/200 1666 GET
> http://rozklad-pkp.pl/img/content/icons/main/to.png -
> HIER_DIRECT/213.199.225.44 image/png 1421356447.569    266
> 10.59.1.9 TCP_MISS/200 1735 GET
> http://rozklad-pkp.pl/img/content/icons/arrow-up-2.png -
> HIER_DIRECT/213.199.225.44 image/png 1421356447.901    445
> 10.59.1.9 TCP_MISS/200 8944 GET
> http://rozklad-pkp.pl/img/content/bg/bn-na.png -
> HIER_DIRECT/213.199.225.44 image/png 1421356447.932    471
> 10.59.1.9 TCP_MISS/200 7638 GET
> http://rozklad-pkp.pl/img/content/bg/bn-na_780.png -
> HIER_DIRECT/213.199.225.44 image/png 1421356447.959    478
> 10.59.1.9 TCP_MISS/200 6506 GET
> http://rozklad-pkp.pl/img/content/bg/bn-na_480.png -
> HIER_DIRECT/213.199.225.44 image/png 1421356448.457    916
> 10.59.1.9 TCP_MISS/200 1573 GET
> http://rozklad-pkp.pl/img/content/icons/main/minus.png -
> HIER_DIRECT/213.199.225.44 image/png 1421356448.477    932
> 10.59.1.9 TCP_MISS/200 1786 GET
> http://rozklad-pkp.pl/hafas-res/img/sel_prod_ice.gif -
> HIER_DIRECT/213.199.225.44 image/gif 1421356448.552    979
> 10.59.1.9 TCP_MISS/200 1771 GET
> http://rozklad-pkp.pl/hafas-res/img/sel_prod_ic.gif -
> HIER_DIRECT/213.199.225.44 image/gif 1421356448.586   1281
> 10.59.1.9 TCP_MISS/200 672 GET
> http://bbcdn-bbnaut.ibillboard.com/server-static-files/bbnaut-b.swf
> - HIER_DIRECT/194.213.222.30 application/x-shockwave-flash 
> 1421356448.668    741 10.59.1.9 TCP_MISS/200 1823 GET
> http://rozklad-pkp.pl/hafas-res/img/sel_prod_ir-d.gif -
> HIER_DIRECT/213.199.225.44 image/gif 1421356448.694    757
> 10.59.1.9 TCP_MISS/200 1868 GET
> http://rozklad-pkp.pl/hafas-res/img/sel_prod_re-rb.gif -
> HIER_DIRECT/213.199.225.44 image/gif 1421356448.956    467
> 10.59.1.9 TCP_MISS/200 9284 GET
> http://rozklad-pkp.pl/img/content/banners/banner3.jpg -
> HIER_DIRECT/213.199.225.44 image/jpeg 1421356448.973    477
> 10.59.1.9 TCP_MISS/200 4047 GET
> http://rozklad-pkp.pl/img/content/icons/arrow-up-4.png -
> HIER_DIRECT/213.199.225.44 image/png 1421356448.976    417
> 10.59.1.9 TCP_MISS/200 636 GET
> http://rozklad-pkp.pl/css/images/ui-bg_flat_75_ffffff_40x100.png -
> HIER_DIRECT/213.199.225.44 image/png 1421356449.045    324
> 10.59.1.9 TCP_MISS/200 5414 GET
> http://rozklad-pkp.pl/img/content/icons/bullet-active.png -
> HIER_DIRECT/213.199.225.44 image/png 1421356449.064    338
> 10.59.1.9 TCP_MISS/200 4736 GET
> http://rozklad-pkp.pl/img/content/icons/bullet.png -
> HIER_DIRECT/213.199.225.44 image/png 1421356449.110    917
> 10.59.1.9 TCP_MISS/200 16451 GET
> http://rozklad-pkp.pl/img/content/banners/banner2.jpg -
> HIER_DIRECT/213.199.225.44 image/jpeg 1421356449.321    179
> 10.59.1.9 TCP_MISS/200 1594 GET http://rozklad-pkp.pl/favicon.ico -
> HIER_DIRECT/213.199.225.44 image/vnd.microsoft.icon 1421356449.658
> 348 10.59.1.9 TCP_MISS/304 167 GET
> http://bbnaut.ibillboard.com/g/ca2 - HIER_DIRECT/62.209.227.210 -
> 
> 
> .. and once again I see many picture files not cached , why ?

The servers clock is out of sync. And there is again only one fetch
for each object in your log so no way to know if they are cold
requests or whats going on. bit of a mstery even why mapa3.png *does* HIT.


Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUuIEWAAoJELJo5wb/XPRjAxkH/2C9fzceKXb/OQ+I912SRZjm
QbQ+4WgN/1MAw4PLatu9NIhQGC2rnh3cipnQX5dbYA8iqlocWjkt6mvkhW3kJMfE
4FDjJChaewQ0VkduLQF6bKFrND9rG7mCXnxNcWneLrtEFOzIEn9uB8phiVRWS9mZ
zXerPWjW2aqOJ+aVPMxUROAFIhpJot6s0c8unFXSQ3jqDidqgiPeFWp56o45bDdt
LSm79pU1dadcFsGxN84xKsKIDDvSmJSHLDJ78v4ixlUna5saRuPgSj2v+Zd4a/Sg
ki4+tDnT3NCz7jMnZqmBhHXfXWlqPVacBFC6jYoWQ1od5kCZfeiqaMMQDeMhvjY=
=K81h
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Fri Jan 16 03:53:23 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 16 Jan 2015 16:53:23 +1300
Subject: [squid-users] Squid and site ryanair.com
In-Reply-To: <1421337529987-4669105.post@n4.nabble.com>
References: <1421337529987-4669105.post@n4.nabble.com>
Message-ID: <54B88B33.5010701@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 16/01/2015 4:58 a.m., masterx81 wrote:
> Hi! I have squid/3.3.13 on a centos 6.5, configured with ntlm and
> kerberos auth. I'm having throubles to get work the http site
> ryanair.com. The dynamic content of the page (the find flights
> button and the calendars, that as far i can see are js+css) are not
> working (the calendars does not open and the button doesn't
> highlight on mouse move). I've also tried to put an exception for
> the dstdomain ryanair.com before the auth, and i have the same
> problem. On access.log i get only DENIED on:
> 
> 1421337197.667      0 172.16.2.210 TCP_DENIED/407 3944 CONNECT 
> s-static.ak.facebook.com:443 - HIER_NONE/- text/html 1421337195.919
> 0 172.16.2.210 TCP_DENIED/407 3908 CONNECT apis.google.com:443 -
> HIER_NONE/- text/html

Notice how neither of those are "ryanair.com"...

> 
> there was also a DENIED on: 1421337020.420      0 172.16.2.210
> TCP_DENIED/407 4354 GET 
> http://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.3.6/slick.css
> - HIER_NONE/- text/html
> 
> I've tried to bypass also auth on dstdomain cloudflare.com, now i
> get a MISS on that instead of a DENIED, but the page still not
> work.
> 

As you may have noticed by now the "page" is composed of many very
different complicated pieces. Any one of the other pieces may be
breaking it.

As a whole it looks like whatever browser you are using not supporting
login to a proxy with the auth schemes you chose to use.

Note that Squid is part of the network, the buttons and JS/CSS not
working properly has nothing to do with Squid unless the UA is failing
to fetch the JS/CSS objects or XHR transactions themelves from the
network/Squid. Which will show up in the browser developer tools
"network" panel, and in traffic traces.

HTH
Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUuIszAAoJELJo5wb/XPRjQUwH/Ah1DXFtVLteLQopqLX9hDKC
BaHpyntPruiNG/8kkXqHwZCvVPHMuJSOmbv7pYyyt9L374Nz9QoywfufgaWU8Juc
PSv2lPZwLKcYG6MyFeLSwfsSsDFR4h2zY8/itdEwi9p3DXmu8apsx2IoLsu5AVY7
BZpKwsXXqYMRGoEDnQoq2m0tlnsgpAxTr0CRrmYDS5DCydV3+asQiUUPijbL5i83
vUhEYYy9OfhFwy0Qo6YCMC0TfdC+PhejElU1ZK5tz9Bd5IBbOZH14KICzrCInwUT
i6uQ3m+8vHx89CMj9rG9IXjHQTubCglwBj8tSy/Hio+hKre63inMTHLkI+/zna8=
=tA2X
-----END PGP SIGNATURE-----


From yvoinov at gmail.com  Fri Jan 16 09:41:59 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Fri, 16 Jan 2015 15:41:59 +0600
Subject: [squid-users] Odp: Re: Odp: Re:  Odp:  Odp: Re:  Only TCP_MISS
In-Reply-To: <54b832b15a6526.29168957@wp.pl>
References: <54b832b15a6526.29168957@wp.pl>
Message-ID: <54B8DCE7.1090703@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 

16.01.2015 3:35, Robert ?????:
> Dnia Czwartek, 15 Stycznia 2015 22:16 Yuri Voinov <yvoinov at gmail.com> napisa?(a)
>>  -----BEGIN PGP SIGNED MESSAGE-----
>>  Hash: SHA1
>>  
>>  Oh,
>> 
>>  of course - you must to warm up cache first also.
>> 
>>  :)
>> 
>
> 1. warm up cache
> What the hell is that ? ;) , no Squid installation guide says about
it, please give me link to some (simple) guide to warm up my swap to
cache as much as possible
This is obvious thing. To do that you need to permit cache work some
days or some month with normal load - to fill cache_dir and/or memory cache.
>
>
> 2. "First reason - HTTP headers. I.e, no cache. etc. You can override
them with refresh_patterns violations. :)"
> Again, please tell me what refresh_patterns should I set to increase
as most caching , also with headers caching if this is possible
http://www.squid-cache.org/Doc/config/refresh_pattern/
>
>
> 3. I did next text with site pkp.pl:
> 1421356447.223    193 10.59.1.9 TCP_MISS/200 4657 GET
http://rozklad-pkp.pl/img/content/icons/disab.png -
HIER_DIRECT/213.199.225.44 image/png
> 1421356447.270    200 10.59.1.9 TCP_MISS/200 4505 GET
http://rozklad-pkp.pl/img/content/icons/direct.png -
HIER_DIRECT/213.199.225.44 image/png
> 1421356447.274    961 10.59.1.9 TCP_MISS/200 80175 GET
http://rozklad-pkp.pl/css/lato-bold-webfont.woff -
HIER_DIRECT/213.199.225.44 text/plain
> 1421356447.297    190 10.59.1.9 TCP_MISS/200 1683 GET
http://rozklad-pkp.pl/img/content/icons/arrow-down-3.png -
HIER_DIRECT/213.199.225.44 image/png
> 1421356447.442    198 10.59.1.9 TCP_MISS/200 1732 GET
http://rozklad-pkp.pl/img/content/icons/main/plus.png -
HIER_DIRECT/213.199.225.44 image/png
> 1421356447.455    193 10.59.1.9 TCP_MISS/200 1834 GET
http://rozklad-pkp.pl/img/header/search.png - HIER_DIRECT/213.199.225.44
image/png
> 1421356447.476    209 10.59.1.9 TCP_MISS/200 1665 GET
http://rozklad-pkp.pl/img/content/icons/main/from.png -
HIER_DIRECT/213.199.225.44 image/png
> 1421356447.502    228 10.59.1.9 TCP_MISS/200 1641 GET
http://rozklad-pkp.pl/img/content/icons/main/cal.png -
HIER_DIRECT/213.199.225.44 image/png
> 1421356447.525      2 10.59.1.9 TCP_MEM_HIT/200 46701 GET
http://rozklad-pkp.pl/img/content/icons/map/mapa3.png - HIER_NONE/-
image/png
> 1421356447.530    246 10.59.1.9 TCP_MISS/200 1666 GET
http://rozklad-pkp.pl/img/content/icons/main/to.png -
HIER_DIRECT/213.199.225.44 image/png
> 1421356447.569    266 10.59.1.9 TCP_MISS/200 1735 GET
http://rozklad-pkp.pl/img/content/icons/arrow-up-2.png -
HIER_DIRECT/213.199.225.44 image/png
> 1421356447.901    445 10.59.1.9 TCP_MISS/200 8944 GET
http://rozklad-pkp.pl/img/content/bg/bn-na.png -
HIER_DIRECT/213.199.225.44 image/png
> 1421356447.932    471 10.59.1.9 TCP_MISS/200 7638 GET
http://rozklad-pkp.pl/img/content/bg/bn-na_780.png -
HIER_DIRECT/213.199.225.44 image/png
> 1421356447.959    478 10.59.1.9 TCP_MISS/200 6506 GET
http://rozklad-pkp.pl/img/content/bg/bn-na_480.png -
HIER_DIRECT/213.199.225.44 image/png
> 1421356448.457    916 10.59.1.9 TCP_MISS/200 1573 GET
http://rozklad-pkp.pl/img/content/icons/main/minus.png -
HIER_DIRECT/213.199.225.44 image/png
> 1421356448.477    932 10.59.1.9 TCP_MISS/200 1786 GET
http://rozklad-pkp.pl/hafas-res/img/sel_prod_ice.gif -
HIER_DIRECT/213.199.225.44 image/gif
> 1421356448.552    979 10.59.1.9 TCP_MISS/200 1771 GET
http://rozklad-pkp.pl/hafas-res/img/sel_prod_ic.gif -
HIER_DIRECT/213.199.225.44 image/gif
> 1421356448.586   1281 10.59.1.9 TCP_MISS/200 672 GET
http://bbcdn-bbnaut.ibillboard.com/server-static-files/bbnaut-b.swf -
HIER_DIRECT/194.213.222.30 application/x-shockwave-flash
> 1421356448.668    741 10.59.1.9 TCP_MISS/200 1823 GET
http://rozklad-pkp.pl/hafas-res/img/sel_prod_ir-d.gif -
HIER_DIRECT/213.199.225.44 image/gif
> 1421356448.694    757 10.59.1.9 TCP_MISS/200 1868 GET
http://rozklad-pkp.pl/hafas-res/img/sel_prod_re-rb.gif -
HIER_DIRECT/213.199.225.44 image/gif
> 1421356448.956    467 10.59.1.9 TCP_MISS/200 9284 GET
http://rozklad-pkp.pl/img/content/banners/banner3.jpg -
HIER_DIRECT/213.199.225.44 image/jpeg
> 1421356448.973    477 10.59.1.9 TCP_MISS/200 4047 GET
http://rozklad-pkp.pl/img/content/icons/arrow-up-4.png -
HIER_DIRECT/213.199.225.44 image/png
> 1421356448.976    417 10.59.1.9 TCP_MISS/200 636 GET
http://rozklad-pkp.pl/css/images/ui-bg_flat_75_ffffff_40x100.png -
HIER_DIRECT/213.199.225.44 image/png
> 1421356449.045    324 10.59.1.9 TCP_MISS/200 5414 GET
http://rozklad-pkp.pl/img/content/icons/bullet-active.png -
HIER_DIRECT/213.199.225.44 image/png
> 1421356449.064    338 10.59.1.9 TCP_MISS/200 4736 GET
http://rozklad-pkp.pl/img/content/icons/bullet.png -
HIER_DIRECT/213.199.225.44 image/png
> 1421356449.110    917 10.59.1.9 TCP_MISS/200 16451 GET
http://rozklad-pkp.pl/img/content/banners/banner2.jpg -
HIER_DIRECT/213.199.225.44 image/jpeg
> 1421356449.321    179 10.59.1.9 TCP_MISS/200 1594 GET
http://rozklad-pkp.pl/favicon.ico - HIER_DIRECT/213.199.225.44
image/vnd.microsoft.icon
> 1421356449.658    348 10.59.1.9 TCP_MISS/304 167 GET
http://bbnaut.ibillboard.com/g/ca2 - HIER_DIRECT/62.209.227.210 -
>
>
> .. and once again I see many picture files not cached , why ?
It can be because no-cache pragma presist in HTTP header in server
reply. You can check server headers and possibility of caching (or
needful using HTTP-violates refresh_pattern directives) with this tool:

https://redbot.org/
>
>
>
>
>
>
>
WBR, Yuri
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUuNznAAoJENNXIZxhPexGeBIH/3TDNCJLSNqnJHHw7V8l4d3k
jRXa3CfS+yLnjhd8PzeSoYsP39lg/5c+m2VgtpflDpJbZfPQQ1jqaEp64BVTops9
2HT7GQQ7nHNokioU7fa5m6vxVQ0kdmBVGuEUXfo9fZkL0JyeMg8c3I+/FUJJKIVJ
LbFMvC2haX2KOrANf7tiWLD0oj/gXpcQzVCUaoYg55uXCPTjXauuqPbMYGi/ReKg
lCX3JLnkU00+QR/cQRNBxbJDGC0vi7OusCAfYc4xS2S5IixBa+CqSRyHJlWEtqDK
LaJNEUkk8r9YUY6qQfg1wrxuM9kiNb8MZB5PJZn+swTlw3JHgOiOOpTBSxdkQLQ=
=FmMz
-----END PGP SIGNATURE-----



From markus.rietzler at fv.nrw.de  Fri Jan 16 10:51:48 2015
From: markus.rietzler at fv.nrw.de (Rietzler, Markus (RZF, SG 324 / <RIETZLER_SOFTWARE>))
Date: Fri, 16 Jan 2015 10:51:48 +0000
Subject: [squid-users] ntlm: No such file or directory
In-Reply-To: <54B7BAAF.20209@treenet.co.nz>
References: <1421325808887-4669085.post@n4.nabble.com>
 <54B7BAAF.20209@treenet.co.nz>
Message-ID: <1FCF9DA5B29068478ECF15896F19F084014AF0C19A@Y011008.bk.fin.local>

tow more additions:

check the user squid is running, is this user able to access ntlm_auth.
we also had to correct access rights for

/var/lib/samba/winbindd_privilege

so that our squid-user "www" will be able to use it...

markus

> -----Urspr?ngliche Nachricht-----
> Von: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] Im
> Auftrag von Amos Jeffries
> Gesendet: Donnerstag, 15. Januar 2015 14:04
> An: squid-users at lists.squid-cache.org
> Betreff: Re: [squid-users] ntlm: No such file or directory
> 
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> On 16/01/2015 1:43 a.m., gehrer.a wrote:
> > Try on a pfsense with squid 3.4.10 an ntlm-authentication. In my
> > suid.conf: /auth_param ntlm program /usr/local/bin/ntlm_auth
> > --helper-protocol=squid-2.5-ntlmssp/ When I restart squid I always
> > see this in my syslog:
> >
> > Jan 15 13:38:35 pf4322 squid: auth_param ntlm program
> > /usr/local/bin/ntlm_auth: (2) No such file or directory
> >
> > But the path to ntlm_auth is right! I can start
> > /usr/local/bin/ntlm_auth from the shell. So what file or directory
> > does he means?
> 
> It means what you thought it did. However there are a few reasons why
> Squid may be unable to see a file there:
> 
> Is Squid running within a chroot? that including if squid.conf
> contains the "chroot_dir" config directive. The path must exist inside
> the chroot area.
> 
> Are there SELinux or Apparmor running on this machine? Several OS
> distros enable those system protectinos by default, and with settings
> that forbid Squid to access anywhere outside its own directories.
> 
> Amos
> 
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2.0.22 (MingW32)
> 
> iQEcBAEBAgAGBQJUt7qvAAoJELJo5wb/XPRjuWYIALWCKyqOHvLamz04kfQ79uje
> 50W4dp5koUGPo20LTcbIe+v25GEsWN5DQHSxRwcmdrLScri8wQFXyMqgUdKwvQW9
> 20ob368S99vt65RCiWHvI0GZTL8ynrzNEgoayzPGXyK+2kYbbF5wLvuK8i+6n47k
> qknAZF1C84MyRiJW32GE111muL3yfWJnKMB2viiicvgs8rQUe1Et5eqyC50RvdFZ
> kFpcSSoziaQY5VZ9Uscyx2h+eY7Jnn9TVXVaOC2hJNX5zf9SvygXckp0rt0Xk8ET
> gFZVX0HJWSCIqry/8vX+bdL4TqMSs9eKWOeaAP7ewbsZ0z0IqK70V15hv908yHM=
> =PdPY
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

From squid3 at treenet.co.nz  Fri Jan 16 13:16:11 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 17 Jan 2015 02:16:11 +1300
Subject: [squid-users] ntlm: No such file or directory
In-Reply-To: <1FCF9DA5B29068478ECF15896F19F084014AF0C19A@Y011008.bk.fin.local>
References: <1421325808887-4669085.post@n4.nabble.com>
 <54B7BAAF.20209@treenet.co.nz>
 <1FCF9DA5B29068478ECF15896F19F084014AF0C19A@Y011008.bk.fin.local>
Message-ID: <54B90F1B.4080002@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 16/01/2015 11:51 p.m., Rietzler, Markus (RZF, SG 324 /
<RIETZLER_SOFTWARE>) wrote:
> tow more additions:
> 
> check the user squid is running, is this user able to access
> ntlm_auth. we also had to correct access rights for
> 
> /var/lib/samba/winbindd_privilege
> 
> so that our squid-user "www" will be able to use it...

FYI: You should never have to touch the pivileges on the
/var/lib/samba/winbindd_privilege directory. In fact if you do Samba
will at some point reset them to correct values and Squid access
breaks again.

What is *required* is that 1) the Squid user account be a member of
the Samba winbindd_priv group which has read access to that path and
2) the cache_effective_group parameter is *absent* from squid.conf.
Using that directive will remove the group membership permissions
required for winbind access.

NP: the RHEL official packages for years had a patch which hard-coded
a value for cache_effective_group which made it impossible to
integrate Squid and Samba winbind in the correct way. A custom built
package is required to get around that.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUuQ8bAAoJELJo5wb/XPRj2RMH+wavFBqNPU+as7OysRJjhTtw
vWemsV569Lk5hNs2iuW/s7B/jaiE/rIwDUnEhRGCW4imVXtHytjFWBAQoK5re63a
lAfB70RJaoyom+Fj89B2TUtLHQ+8bWESzVHdFzmg4sSmh+DCqHWgi5QjJ6DMSyvG
OCn4AYwWDvYloPBJCZ2IvOK52Ig5YBzvCCPOsxDFNO4EYZu/Rsmy1M8Fqj0SgFVW
zkkqYaSQq5aznjLO2G+UYTGFcFG6Zh/0akELmGBYJsc2vjERLBmvMkFnpAOYPLbh
dA0tFI+ei6+M35dU5IKpxIBHknTfY5bH6HgKcMP0zAv7LnLkfDbf2gG2ia4AKEQ=
=f3e5
-----END PGP SIGNATURE-----


From wrkilu at wp.pl  Fri Jan 16 16:17:47 2015
From: wrkilu at wp.pl (Robert)
Date: Fri, 16 Jan 2015 17:17:47 +0100
Subject: [squid-users] Odp: Re: Odp: Re: Odp: Re: Odp: Odp: Re: Only TCP_MISS
Message-ID: <54b939ab7ccbd7.20296153@wp.pl>

Dnia Pi?tek, 16 Stycznia 2015 04:10 Amos Jeffries <squid3 at treenet.co.nz> napisa?(a)
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>  
> On 16/01/2015 10:35 a.m., Robert wrote:
> > Dnia Czwartek, 15 Stycznia 2015 22:16 Yuri Voinov napisa?(a)
> >> Oh,
> >>
> >> of course - you must to warm up cache first also.
> >>
> >> :)
> >>
> >
> > 1. warm up cache What the hell is that ? ;) , no Squid installation
> > guide says about it, please give me link to some (simple) guide to
> > warm up my swap to cache as much as possible
> >
>  
> Squid of course *does not* come bundled with an installed copy of the
> entire Internet.
>  
> A freshly installed or restarted[1] proxy has a cache in state called
> "cold". Each repeat fetch for a URL "warms" it.URL which are often
> requested are called "hot".
>  
> You have to make one request where a MISS is guaranteed. That request
> tells Squid whether to cache the reply for *future* use. All that
> first request will tell you is whether the URL is possible to fetch.
> Nothing about caching in access.log.
>  
> To know if a reply has been cached requires at least a second request.
> That ones access.log details say whether *it* was a hit or miss or
> refresh.
>  
>  
> [1] disk cache persist across restart. So simply restarting Squid
> resets to either cold or warm states depending on disk usage. Usually
> the hottest objects will be exclusively in RAM and the latest copy
> need fetching from the network on restart - this ensures that hot
> objects are always up to date and accurate.
>  
>  
> > 2. "First reason - HTTP headers. I.e, no cache. etc. You can
> > override them with refresh_patterns violations. :)" Again, please
> > tell me what refresh_patterns should I set to increase as most
> > caching , also with headers caching if this is possible
> >
>  
> Please don't go that way. At least not now. So far it has been your
> testing methodology which is broken, not the sites operation. (Except
> that one doing Vary:User-Agent and nothing can be done in squid.conf
> about that.)
>  
> Many of the refresh_pattern override/ignore options *break* HTTP and
> are only to be used if you understand the impact of what that use
> means, with a specific broken website that requires it. You need to
> know exactly *what* is broken about the website to be able to
> configure the overrides correctly for it.
>  
>  
> If you want better caching, ensure that you have the latest Squid
> available. We are constantly searching out ways to safely improve the
> amount Squid can store and remove the need for those overrides to
> exist at all.
>  
>  
>  
> > 3. I did next text with site pkp.pl: 1421356447.223    193
> > 10.59.1.9 TCP_MISS/200 4657 GET
> > http://rozklad-pkp.pl/img/content/icons/disab.png -
> > HIER_DIRECT/213.199.225.44 image/png 1421356447.270    200
> > 10.59.1.9 TCP_MISS/200 4505 GET
> > http://rozklad-pkp.pl/img/content/icons/direct.png -
> > HIER_DIRECT/213.199.225.44 image/png 1421356447.274    961
> > 10.59.1.9 TCP_MISS/200 80175 GET
> > http://rozklad-pkp.pl/css/lato-bold-webfont.woff -
> > HIER_DIRECT/213.199.225.44 text/plain 1421356447.297    190
> > 10.59.1.9 TCP_MISS/200 1683 GET
> > http://rozklad-pkp.pl/img/content/icons/arrow-down-3.png -
> > HIER_DIRECT/213.199.225.44 image/png 1421356447.442    198
> > 10.59.1.9 TCP_MISS/200 1732 GET
> > http://rozklad-pkp.pl/img/content/icons/main/plus.png -
> > HIER_DIRECT/213.199.225.44 image/png 1421356447.455    193
> > 10.59.1.9 TCP_MISS/200 1834 GET
> > http://rozklad-pkp.pl/img/header/search.png -
> > HIER_DIRECT/213.199.225.44 image/png 1421356447.476    209
> > 10.59.1.9 TCP_MISS/200 1665 GET
> > http://rozklad-pkp.pl/img/content/icons/main/from.png -
> > HIER_DIRECT/213.199.225.44 image/png 1421356447.502    228
> > 10.59.1.9 TCP_MISS/200 1641 GET
> > http://rozklad-pkp.pl/img/content/icons/main/cal.png -
> > HIER_DIRECT/213.199.225.44 image/png 1421356447.525      2
> > 10.59.1.9 TCP_MEM_HIT/200 46701 GET
> > http://rozklad-pkp.pl/img/content/icons/map/mapa3.png - HIER_NONE/-
> > image/png 1421356447.530    246 10.59.1.9 TCP_MISS/200 1666 GET
> > http://rozklad-pkp.pl/img/content/icons/main/to.png -
> > HIER_DIRECT/213.199.225.44 image/png 1421356447.569    266
> > 10.59.1.9 TCP_MISS/200 1735 GET
> > http://rozklad-pkp.pl/img/content/icons/arrow-up-2.png -
> > HIER_DIRECT/213.199.225.44 image/png 1421356447.901    445
> > 10.59.1.9 TCP_MISS/200 8944 GET
> > http://rozklad-pkp.pl/img/content/bg/bn-na.png -
> > HIER_DIRECT/213.199.225.44 image/png 1421356447.932    471
> > 10.59.1.9 TCP_MISS/200 7638 GET
> > http://rozklad-pkp.pl/img/content/bg/bn-na_780.png -
> > HIER_DIRECT/213.199.225.44 image/png 1421356447.959    478
> > 10.59.1.9 TCP_MISS/200 6506 GET
> > http://rozklad-pkp.pl/img/content/bg/bn-na_480.png -
> > HIER_DIRECT/213.199.225.44 image/png 1421356448.457    916
> > 10.59.1.9 TCP_MISS/200 1573 GET
> > http://rozklad-pkp.pl/img/content/icons/main/minus.png -
> > HIER_DIRECT/213.199.225.44 image/png 1421356448.477    932
> > 10.59.1.9 TCP_MISS/200 1786 GET
> > http://rozklad-pkp.pl/hafas-res/img/sel_prod_ice.gif -
> > HIER_DIRECT/213.199.225.44 image/gif 1421356448.552    979
> > 10.59.1.9 TCP_MISS/200 1771 GET
> > http://rozklad-pkp.pl/hafas-res/img/sel_prod_ic.gif -
> > HIER_DIRECT/213.199.225.44 image/gif 1421356448.586   1281
> > 10.59.1.9 TCP_MISS/200 672 GET
> > http://bbcdn-bbnaut.ibillboard.com/server-static-files/bbnaut-b.swf
> > - HIER_DIRECT/194.213.222.30 application/x-shockwave-flash
> > 1421356448.668    741 10.59.1.9 TCP_MISS/200 1823 GET
> > http://rozklad-pkp.pl/hafas-res/img/sel_prod_ir-d.gif -
> > HIER_DIRECT/213.199.225.44 image/gif 1421356448.694    757
> > 10.59.1.9 TCP_MISS/200 1868 GET
> > http://rozklad-pkp.pl/hafas-res/img/sel_prod_re-rb.gif -
> > HIER_DIRECT/213.199.225.44 image/gif 1421356448.956    467
> > 10.59.1.9 TCP_MISS/200 9284 GET
> > http://rozklad-pkp.pl/img/content/banners/banner3.jpg -
> > HIER_DIRECT/213.199.225.44 image/jpeg 1421356448.973    477
> > 10.59.1.9 TCP_MISS/200 4047 GET
> > http://rozklad-pkp.pl/img/content/icons/arrow-up-4.png -
> > HIER_DIRECT/213.199.225.44 image/png 1421356448.976    417
> > 10.59.1.9 TCP_MISS/200 636 GET
> > http://rozklad-pkp.pl/css/images/ui-bg_flat_75_ffffff_40x100.png -
> > HIER_DIRECT/213.199.225.44 image/png 1421356449.045    324
> > 10.59.1.9 TCP_MISS/200 5414 GET
> > http://rozklad-pkp.pl/img/content/icons/bullet-active.png -
> > HIER_DIRECT/213.199.225.44 image/png 1421356449.064    338
> > 10.59.1.9 TCP_MISS/200 4736 GET
> > http://rozklad-pkp.pl/img/content/icons/bullet.png -
> > HIER_DIRECT/213.199.225.44 image/png 1421356449.110    917
> > 10.59.1.9 TCP_MISS/200 16451 GET
> > http://rozklad-pkp.pl/img/content/banners/banner2.jpg -
> > HIER_DIRECT/213.199.225.44 image/jpeg 1421356449.321    179
> > 10.59.1.9 TCP_MISS/200 1594 GET http://rozklad-pkp.pl/favicon.ico -
> > HIER_DIRECT/213.199.225.44 image/vnd.microsoft.icon 1421356449.658
> > 348 10.59.1.9 TCP_MISS/304 167 GET
> > http://bbnaut.ibillboard.com/g/ca2 - HIER_DIRECT/62.209.227.210 -
> >
> >
> > .. and once again I see many picture files not cached , why ?
>  
> The servers clock is out of sync. And there is again only one fetch
> for each object in your log so no way to know if they are cold
> requests or whats going on. bit of a mstery even why mapa3.png *does* HIT.
>  
>  
> Amos
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2.0.22 (MingW32)
>  
> iQEcBAEBAgAGBQJUuIEWAAoJELJo5wb/XPRjAxkH/2C9fzceKXb/OQ+I912SRZjm
> QbQ+4WgN/1MAw4PLatu9NIhQGC2rnh3cipnQX5dbYA8iqlocWjkt6mvkhW3kJMfE
> 4FDjJChaewQ0VkduLQF6bKFrND9rG7mCXnxNcWneLrtEFOzIEn9uB8phiVRWS9mZ
> zXerPWjW2aqOJ+aVPMxUROAFIhpJot6s0c8unFXSQ3jqDidqgiPeFWp56o45bDdt
> LSm79pU1dadcFsGxN84xKsKIDDvSmJSHLDJ78v4ixlUna5saRuPgSj2v+Zd4a/Sg
> ki4+tDnT3NCz7jMnZqmBhHXfXWlqPVacBFC6jYoWQ1od5kCZfeiqaMMQDeMhvjY=
> =K81h
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>  

Ok, yours answer and Yuri's are comprehensive for me. Now I know that not every element from site can be cached and also testing of caching have to be done in proper way. After reading this whole thread everybody will know about them.

Even I tested (in one browser) with clearing cache in it some site and I got well caching in Squid (TCP_HITs and TCP_MEM_HITs)

So.. Squid v.3.3.8 on Ubuntu14 is good and works well and so on.. :)

Thank you very much to all for answers, I think this thread will be helpful for others.
Cheers!





 





From sam at idsdoc.com  Fri Jan 16 18:15:01 2015
From: sam at idsdoc.com (Samuel Anderson)
Date: Fri, 16 Jan 2015 11:15:01 -0700
Subject: [squid-users] whitelists and active directory help
Message-ID: <CAP6yRXgc5i-3Y=iJK8WW_Cmw+V0dt0rEzsdkaudgq7ySGb4UkA@mail.gmail.com>

Hello All,

I'm attempting to create way to grant users access to different categories
using active directory. Currently what I have works but if a website is not
listed in any of the whitelists it will allow traffic to that website. If I
add a (http_access deny all) at the end, then nothing works. What I would
like is for a user to only have access to whitlists that they are a member
of. I'll have around 50 categories in the end. This is just a small sample.

Thanks,


acl NEWS external ldap_group NEWS
acl SHOPPING external ldap_group SHOPPING
acl SOCIALNETWORKING external ldap_group SOCIALNETWORKING
acl RELIGION external ldap_group RELIGION
acl SPORTNEWS external ldap_group SPORTNEWS

acl rule1 url_regex -i "/etc/squid3/whitelists/news/domains"
acl rule2 url_regex -i "/etc/squid3/whitelists/shopping/domains"
acl rule3 url_regex -i "/etc/squid3/whitelists/socialnetworking/domains"
acl rule4 url_regex -i "/etc/squid3/whitelists/religion/domains"
acl rule5 url_regex -i "/etc/squid3/whitelists/sportnews/domains"


http_access deny rule1 !NEWS all
http_access deny rule2 !SHOPPING all
http_access deny rule3 !SOCIALNETWORKING all
http_access deny rule4 !RELIGION all
http_access deny rule5 !SPORTNEWS all
http_access allow all

-- 
CONFIDENTIALITY NOTICE:
This e-mail and any attachments are confidential. If you are not an 
intended recipient, please contact the sender to report the error and 
delete all copies of this message from your system.  Any unauthorized 
review, use, disclosure or distribution is prohibited.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150116/9dc4a352/attachment.htm>

From hdiaz at ggm.mx  Fri Jan 16 20:36:41 2015
From: hdiaz at ggm.mx (Horacio Diaz Requejo)
Date: Fri, 16 Jan 2015 20:36:41 +0000
Subject: [squid-users] whitelists and active directory help
In-Reply-To: <CAP6yRXgc5i-3Y=iJK8WW_Cmw+V0dt0rEzsdkaudgq7ySGb4UkA@mail.gmail.com>
References: <CAP6yRXgc5i-3Y=iJK8WW_Cmw+V0dt0rEzsdkaudgq7ySGb4UkA@mail.gmail.com>
Message-ID: <962DDC515AB6094490E32929BEF385B207AFD7@GGM-S8EX01.ggm.corp>

Hi Samuel ?!!

  The way i?m doing this is creating two text files for each group. One with the authorized usernames to use this group, and another with the authorized domains.

acl pag-gm-ventas dstdomain "/etc/squid/acl/pag-gm-ventas"
acl usu-gm-ventas proxy_auth "/etc/squid/acl/usu-gm-ventas"
acl pag-gm-servicio dstdomain "/etc/squid/acl/pag-gm-servicio"
acl usu-gm-servicio proxy_auth "/etc/squid/acl/usu-gm-servicio"

http_access allow usu-gm-ventas pag-gm-ventas
http_access allow usu-gm-servicio pag-gm-servicio

http_access deny all

  Everything else is denied.

Regards

Horacio D?az-Requejo

De: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] En nombre de Samuel Anderson
Enviado el: viernes, 16 de enero de 2015 12:15 p.m.
Para: squid-users at squid-cache.org
Asunto: [squid-users] whitelists and active directory help

Hello All,

I'm attempting to create way to grant users access to different categories using active directory. Currently what I have works but if a website is not listed in any of the whitelists it will allow traffic to that website. If I add a (http_access deny all) at the end, then nothing works. What I would like is for a user to only have access to whitlists that they are a member of. I'll have around 50 categories in the end. This is just a small sample.

Thanks,


acl NEWS external ldap_group NEWS
acl SHOPPING external ldap_group SHOPPING
acl SOCIALNETWORKING external ldap_group SOCIALNETWORKING
acl RELIGION external ldap_group RELIGION
acl SPORTNEWS external ldap_group SPORTNEWS

acl rule1 url_regex -i "/etc/squid3/whitelists/news/domains"
acl rule2 url_regex -i "/etc/squid3/whitelists/shopping/domains"
acl rule3 url_regex -i "/etc/squid3/whitelists/socialnetworking/domains"
acl rule4 url_regex -i "/etc/squid3/whitelists/religion/domains"
acl rule5 url_regex -i "/etc/squid3/whitelists/sportnews/domains"


http_access deny rule1 !NEWS all
http_access deny rule2 !SHOPPING all
http_access deny rule3 !SOCIALNETWORKING all
http_access deny rule4 !RELIGION all
http_access deny rule5 !SPORTNEWS all
http_access allow all






CONFIDENTIALITY NOTICE:
This e-mail and any attachments are confidential. If you are not an intended recipient, please contact the sender to report the error and delete all copies of this message from your system.  Any unauthorized review, use, disclosure or distribution is prohibited.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150116/44702046/attachment.htm>

From yvoinov at gmail.com  Fri Jan 16 21:25:39 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Sat, 17 Jan 2015 03:25:39 +0600
Subject: [squid-users] In what condition are the prospects GZip/deflate
 runtime support in Squid?
Message-ID: <54B981D3.3090809@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Hi gents,

anybody knows - In what condition are the prospects GZip/deflate runtime
support in Squid?

eCAP is so problematic solution, squid 3.4.x cannot build with libecap
and gzip module (seems abandoned).

The headers manipulation is dirty hack and not solves completely.

Is there is hope? Or no?

WBR, Yuri

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUuYHSAAoJENNXIZxhPexGeWEH/Rj/oRqsVQgofs7BQosO9ijD
Y7xeXA4WF+CbXzFoUyVOuCFErwjzS0GjTZkrWTaXVpvY2fzZ+l4S7Fk+qoOIgelG
gkRlz18RK3Ub1fbzLLtBqT4cgnQdAbzSXMXsiJyK7FmZG79AkveecZaeNgmsLbtX
smT1M9Pm0Z18bPukxFICblRw2p/DNcSJ2f29IcDJ4CurvqeTVq+6tWUGxtyV/JHJ
8tQwly/QcZYR8X80dSSyYFkb5X+RWh8BM8O+ghKuLRqjNxgzSa17G3kT5lkKRWHp
EMKaMLv81v8TVjHaaswHXgZSfKHF5SLR3EwviDqTM6mHuG2yO3iQXpCOjxPKmQM=
=/ZXF
-----END PGP SIGNATURE-----



From squid3 at treenet.co.nz  Sat Jan 17 01:03:14 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 17 Jan 2015 14:03:14 +1300
Subject: [squid-users] whitelists and active directory help
In-Reply-To: <CAP6yRXgc5i-3Y=iJK8WW_Cmw+V0dt0rEzsdkaudgq7ySGb4UkA@mail.gmail.com>
References: <CAP6yRXgc5i-3Y=iJK8WW_Cmw+V0dt0rEzsdkaudgq7ySGb4UkA@mail.gmail.com>
Message-ID: <54B9B4D2.5060304@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 17/01/2015 7:15 a.m., Samuel Anderson wrote:
> Hello All,
> 
> I'm attempting to create way to grant users access to different
> categories using active directory. Currently what I have works but
> if a website is not listed in any of the whitelists it will allow
> traffic to that website. If I add a (http_access deny all) at the
> end, then nothing works. What I would like is for a user to only
> have access to whitlists that they are a member of. I'll have
> around 50 categories in the end. This is just a small sample.
> 
> Thanks,
> 

You have omitted it but if I assume you are using the usual
external_acl_type definitin with %LOGIN, then it actually returns 3
states; a match, non-match and missing-auth result.

The !group construction matches true for both of the later two
non-match and missing-auth results.

So your config below will deny any users access when they are still
un-authenticated in a way that prevents authentication.

> 
> acl NEWS external ldap_group NEWS acl SHOPPING external ldap_group
> SHOPPING acl SOCIALNETWORKING external ldap_group SOCIALNETWORKING 
> acl RELIGION external ldap_group RELIGION acl SPORTNEWS external
> ldap_group SPORTNEWS
> 
> acl rule1 url_regex -i "/etc/squid3/whitelists/news/domains" acl
> rule2 url_regex -i "/etc/squid3/whitelists/shopping/domains" acl
> rule3 url_regex -i
> "/etc/squid3/whitelists/socialnetworking/domains" acl rule4
> url_regex -i "/etc/squid3/whitelists/religion/domains" acl rule5
> url_regex -i "/etc/squid3/whitelists/sportnews/domains"
> 

If those are truely just domains use the dstdomain ACL type instead of
the dangerous and relatively slow url_regex.


You need to ensure valid auth credentials exist before doing anything
with !group.

  acl authed proxy_auth REQUIRED
  http_access deny !authed

> 
> http_access deny rule1 !NEWS all http_access deny rule2 !SHOPPING
> all http_access deny rule3 !SOCIALNETWORKING all http_access deny
> rule4 !RELIGION all http_access deny rule5 !SPORTNEWS all

and restrict the allow to some condition where you know exactly what
traffic is actually allowed. localnet is the usual ACL to permit
defined LAN clients.

> http_access allow all
> 


Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUubTRAAoJELJo5wb/XPRj4XQIAL7Ni3HDRjp8RyHoOoilRmRE
XGYHLSBIXCBvdi/J/snbff6XexDYrKDsX2Gy9dwXPGagwyZ52EU3f8OKi32HMZA5
1l7oKBLymulP1zJI8nljPVjZweoNjvHb6JFDTj6pxawZ/Ab9dbFCyZDIImfFqis8
wyxQWT4EzWwQNxV+G0tpTtH3QSrRNk8Q9WmDJ8+lEd9kulLJQWr1NIc1pf6b3Hh2
M5gR9SvmNDfy+RuoRZ/SfVSSdoXpEHWijvm2p3VbgoGjfdwKSmXLflm0aVT5nTPc
TCLp+ZGYEmx0hKdybFR5m5Ql+5MPrjANejpEuVmclXPT8MH6OsKQfvu8bVAGDxE=
=rqy3
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Sat Jan 17 01:04:58 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 17 Jan 2015 14:04:58 +1300
Subject: [squid-users] In what condition are the prospects GZip/deflate
 runtime support in Squid?
In-Reply-To: <54B981D3.3090809@gmail.com>
References: <54B981D3.3090809@gmail.com>
Message-ID: <54B9B53A.5080308@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 17/01/2015 10:25 a.m., Yuri Voinov wrote:
> 
> Hi gents,
> 
> anybody knows - In what condition are the prospects GZip/deflate
> runtime support in Squid?
> 
> eCAP is so problematic solution, squid 3.4.x cannot build with
> libecap and gzip module (seems abandoned).
> 
> The headers manipulation is dirty hack and not solves completely.
> 
> Is there is hope? Or no?

Some,  it's low in the dev team priority list so need somebody to pay
to raise it higher or present a patch adding it.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUubU6AAoJELJo5wb/XPRjl4QH/2nrJT8bXbvKcra9SR927Mz7
TT+56hodAl2BfSrsO07p32F/sQbZpmEvP9jmW4v6+pdAbgBKDVjyYyybhN/7Z1BU
B3P/FsMGlUlOG5o2FSVk/6L8/fLXH6ZLxQYlFq1JSzIYmeZdcsaQgnQPoS5uePVu
w8byj5EtPSUgftrBLb5pRwsDYxdSIUPsGBEP0A8OfF7Jx4lSsXcKGLeN2xd5ixOL
agM4Uo7DMd92e24+RYXlAqFqb9hKp4HbyzE9qghvTHfk2oyCakzrbHVld0kistai
XITfQwOfX56spW1mVvZ52QZ0LLvh9C6bFwvLzlc5xbs4tANOemys0KsV1aqNwU0=
=5o51
-----END PGP SIGNATURE-----


From chris_sda7 at yahoo.com  Sat Jan 17 07:58:20 2015
From: chris_sda7 at yahoo.com (Christopher Venters)
Date: Sat, 17 Jan 2015 07:58:20 +0000 (UTC)
Subject: [squid-users] Squid not redirecting traffic to the internet
Message-ID: <92961952.2554499.1421481500035.JavaMail.yahoo@jws106118.mail.bf1.yahoo.com>

Greetings,
The following is my squid.conf:
acl to_localhost dst 127.0.0.0/8 0.0.0.0/32 ::1acl localnet src 10.0.0.0/8 ? ? ? ? ? ? # RFC1918 possible internal networkacl localnet src 172.16.0.0/12 ? ? ? ? ?# RFC1918 possible internal networkacl localnet src 192.168.0.0/16 # RFC1918 possible internal networkacl localnet src fc00::/7 ? ? ? ? ? ? ? # RFC 4193 local private network rangeacl localnet src fe80::/10 ? ? ? ? ? ? ?# RFC 4291 link-local (directly plugged) machinesacl SSL_ports port 443acl Safe_ports port 80 ? ? ? ? ? ? ? ? ? # httpacl Safe_ports port 21 ? ? ? ? ? ? ? ? ? # ftpacl Safe_ports port 443 ? ? ????????? ? # httpsacl Safe_ports port 70 ? ? ? ? ? ? ? ? ? # gopheracl Safe_ports port 210 ? ? ? ????????? # waisacl Safe_ports port 1025-65535 ? # unregistered portsacl Safe_ports port 280 ? ? ? ? ? ? ? ? # http-mgmtacl Safe_ports port 488 ? ? ? ? ? ? ? ? # gss-httpacl Safe_ports port 591 ? ? ? ? ? ? ? ? # filemakeracl Safe_ports port 777 ? ? ????????? ? # multiling httpacl CONNECT method CONNECThttp_access allow manager localhosthttp_access deny managerhttp_access deny !Safe_portshttp_access deny CONNECT !SSL_portshttp_access allow localnethttp_access allow localhosthttp_access allow allvisible_hostname Squid_Boxhttp_port 3128 interceptwccp2_router 172.16.1.1wccp2_forwarding_method grewccp2_return_method grewccp2_assignment_method hashwccp2_service standard 0hierarchy_stoplist cgi-bin ?coredump_dir /var/spool/squidrefresh_pattern ^ftp: ? ? ? ? ? 1440 ? ?20% ? ? 10080refresh_pattern ^gopher: ? ? ? ?1440 ? ?0% ? ? ?1440refresh_pattern -i (/cgi-bin/|\?) 0 ? ? 0% ? ? ?0refresh_pattern . ? ? ? ? ? ? ? 0 ? ? ? 20% ? ? 4320--
Tunnel config:
DEVICE=tun0TYPE=GREDEVICETYPE=tunnelBOOTPROTO=noneMY_INNER_IPADDR=10.0.0.50# MY_OUTER_IPADDR=10.0.0.51PEER_OUTER_IPADDR=172.16.1.1PEER_INNER_IPADDR=10.0.0.51NETMASK=255.255.255.0ONBOOT=yesIPV6INIT=noUSERCTL=no--
After starting squid & running a tcpdump, I get the following & 172.16.1.200 is not getting out the the internet.
[root at Squid_Box ~]# tcpdump -i tun0tcpdump: verbose output suppressed, use -v or -vv for full protocol decodelistening on tun0, link-type LINUX_SLL (Linux cooked), capture size 65535 bytes17:50:46.033624 IP 172.16.1.200.53123 > 72.21.91.29.http: Flags [S], seq 3999260288, win 8192, options [mss 1460,nop,nop,sackOK], length 017:50:46.284319 IP 172.16.1.200.53124 > 72.21.91.29.http: Flags [S], seq 593798473, win 8192, options [mss 1460,nop,nop,sackOK], length 017:50:46.461485 IP 172.16.1.200.53125 > 64.233.171.104.http: Flags [S], seq 2397006369, win 8192, options [mss 1460,nop,wscale 8,nop,nop,sackOK], length 017:50:46.741693 IP 172.16.1.200.53126 > 64.233.171.104.http: Flags [S], seq 1663740355, win 8192, options [mss 1460,nop,wscale 8,nop,nop,sackOK], length 0--
Any assistance will be greatly appreciated.
Thanks Much


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150117/963b646e/attachment.htm>

From squid3 at treenet.co.nz  Sat Jan 17 08:11:04 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 17 Jan 2015 21:11:04 +1300
Subject: [squid-users] [squid-announce] Squid 3.5.1 is available
Message-ID: <54BA1918.7020308@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

The Squid HTTP Proxy team is very pleased to announce the availability
of the Squid-3.5.1 release!


This release is we believe, stable enough for general production use.

Support for Squid-3.4 bug fixes has now officially ceased. Bugs in 3.4
will continue to be fixed, however the fixes will be added to the 3.5
series. All users of Squid-3.4 are encouraged to plan for upgrades.


A short list of the major new features is:

 * Collapsed Forwarding (ported from Squid-2.7)
 * eCAP version 1.0 support
 * SSL peek-n-splice
 * Authentication helper query extensions (see auth_param)
 * Caching large (>32KB) objects in Rock storage
 * Extended cache HIT/MISS decision control (see send_hit, store_miss)
 * Support named services
 * Upgraded squidclient tool
 * Helper support for concurrency channels
 * Native FTP protocol relay
 * Initial support for PROXY protocol
 * Basic authentication MSNT helper changes

Several features have been removed in 3.5:

 * COSS storage type has been superceded by Rock storage type.
 * dnsserver helper has been superceded by DNS internal client.
 * DNS helper API has been superceded by DNS internal client.

Further details can be found in the release notes or the wiki.
http://www.squid-cache.org/Versions/v3/3.5/RELEASENOTES.html
http://wiki.squid-cache.org/Squid-3.5


Please be aware that for the SSL-Bump peek-n-splice feature the
ssl_bump directive configuration has changed. Some testers have found
it may require manual attention to redesign the bumping configuratio
on upgrade. Squid does perform auto-upgrade as best it can, but the
result may not meet the intended policy behaviour.
 http://www.squid-cache.org/Doc/config/ssl_bump/


Please remember to run "squid -k parse" when testing upgrade to a new
version of Squid. It will audit your configuration files and report
any identifiable issues the new release will have in your installation
before you "press go".

Squid is beginning to enforce stricter configuration file syntax and
case sensitivity in 3.5.


All feature additions are considered *experimental* until they have
survived at least one series of releases in general production use.
Please be aware of that when rolling out features which are new in
this series. Not all use-cases have been well tested yet and some may
not even have been implemented. Assistance is still needed despite the
releases general stability level.


Plans for the next series of releases is already well underway. Our
future release plans and upcoming features can be found at:
http://wiki.squid-cache.org/RoadMap/Squid3


 See the ChangeLog for the full list of changes in this and earlier
 releases.

 All users of Squid-3.5 beta releases are urged to upgrade to this
release as soon as possible.


Please refer to the release notes at
http://www.squid-cache.org/Versions/v3/3.5/RELEASENOTES.html
when you are ready to make the switch to Squid-3.5

This new release can be downloaded from our HTTP or FTP servers

 http://www.squid-cache.org/Versions/v3/3.5/
 ftp://ftp.squid-cache.org/pub/squid/
 ftp://ftp.squid-cache.org/pub/archive/3.5/

or the mirrors. For a list of mirror sites see

 http://www.squid-cache.org/Download/http-mirrors.html
 http://www.squid-cache.org/Download/mirrors.html

If you encounter any issues with this release please file a bug report.
http://bugs.squid-cache.org/


Amos Jeffries

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUuhkXAAoJELJo5wb/XPRj3aMH/2o9/6gjr+H+kkEpkRZASZQT
m51kl4x0Z520PPpq4apLSGc/92Hj1D0Ac9q7/HFBlNORSrOQdq/gBhLTcdUwo0to
kGVgGt0dYQttMBR7So3EsZ0na1RQFKAdod+tzuLjm20UAobGHy/YUYnv0Xtqb+mm
4bTZYPFQkMpOzFLcn4ulQk165dFv6QgHgrxCscZG7nVqngl1RQBD2ry0j7q20iUm
rsAzR3bR7oWYS9vZd72AgYK3sHd9XkF0vhD/qO0dzDzQH/dXvI1DP1doEZ5KCSdK
28uDRtUNvUklDSRJCwnWMjElliq6Sa9uUc+Wcz+8elgJ0HIgeTQFBZrsmhrHp4o=
=injD
-----END PGP SIGNATURE-----
_______________________________________________
squid-announce mailing list
squid-announce at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-announce

From simon at baladia.gov.kw  Sat Jan 17 08:37:29 2015
From: simon at baladia.gov.kw (Simon Dcunha)
Date: Sat, 17 Jan 2015 11:37:29 +0300 (AST)
Subject: [squid-users] proxy pac files issues
Message-ID: <458908434.21886.1421483849189.JavaMail.zimbra@baladia.gov.kw>

Dear Guys,

Let me revise my posts incase i was not very clear

I need all my hosts on private IPs for example
10.0.0.0/8
172.16.0.0/16
192.168.0.0/16
to be accessed without my squid proxy since they are on my local intranet
but I have see that some hosts on the above ips are still accessed through the squid proxy as the squid access .log file shows the logs and the pac.access file does not show any information
below is my newest pac file i have .
----------------
function FindProxyForURL(url, host) {
 
// If the requested website is hosted within the internal network, send direct.
    if (isPlainHostName(host) ||
        shExpMatch(host, "*.local") ||
        isInNet(dnsResolve(host), "10.0.0.0", "255.0.0.0") ||
        isInNet(dnsResolve(host), "172.16.0.0",  "255.255.0.0") ||
        isInNet(dnsResolve(host), "192.168.0.0",  "255.255.0.0") ||
        isInNet(dnsResolve(host), "127.0.0.0", "255.255.255.0"))
        return "DIRECT";


    return "PROXY 172.16.110.253:80";
 
}

--------------------------
right now I have no hosts on 192.168 network but maybe a need arise latter to use the 192.168 network so would not have to add this network

also the Add Handler command in httpd.conf is there
Just wondering what is wrong .

appreciate your help and advice

regards


simon


-- 
---------
Network Administrator
Kuwait Municipality!!!

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.



From yvoinov at gmail.com  Sat Jan 17 11:51:23 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Sat, 17 Jan 2015 17:51:23 +0600
Subject: [squid-users] proxy pac files issues
In-Reply-To: <458908434.21886.1421483849189.JavaMail.zimbra@baladia.gov.kw>
References: <458908434.21886.1421483849189.JavaMail.zimbra@baladia.gov.kw>
Message-ID: <54BA4CBB.9050206@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Hi Simon.

This is my working configuration.

On proxy web server:

# To httpd.conf
    # Add WPAD type
    AddType application/x-ns-proxy-autoconfig .dat

# Or to mime.types
application/x-ns-proxy-autoconfig         dat

WPAD file must be placed in proxy web root (in my case port 8080):

http://<proxyhostname_or_ip>:8080/wpad.dat

and wpad.dat contains:

function FindProxyForURL(url, host) {
    if (shExpMatch( host, "10.0.*" ) ||
    shExpMatch( host, "192.168.*" ) ||
        shExpMatch( host, "127.*" ) ||
        shExpMatch( host, "localhost" ) ||
        isPlainHostName( host )) {
        return "DIRECT";
    }
    else
    {
      return "PROXY <proxy_IP>:3128";
    }
}

Just correct proxy IP, web listening port and private networks in function.

Crosscheck it with yours,

WBR, Yuri

17.01.2015 14:37, Simon Dcunha ?????:
> Dear Guys,
>
> Let me revise my posts incase i was not very clear
>
> I need all my hosts on private IPs for example
> 10.0.0.0/8
> 172.16.0.0/16
> 192.168.0.0/16
> to be accessed without my squid proxy since they are on my local intranet
> but I have see that some hosts on the above ips are still accessed
through the squid proxy as the squid access .log file shows the logs and
the pac.access file does not show any information
> below is my newest pac file i have .
> ----------------
> function FindProxyForURL(url, host) {
> 
> // If the requested website is hosted within the internal network,
send direct.
>     if (isPlainHostName(host) ||
>         shExpMatch(host, "*.local") ||
>         isInNet(dnsResolve(host), "10.0.0.0", "255.0.0.0") ||
>         isInNet(dnsResolve(host), "172.16.0.0",  "255.255.0.0") ||
>         isInNet(dnsResolve(host), "192.168.0.0",  "255.255.0.0") ||
>         isInNet(dnsResolve(host), "127.0.0.0", "255.255.255.0"))
>         return "DIRECT";
>
>
>     return "PROXY 172.16.110.253:80";
> 
> }
>
> --------------------------
> right now I have no hosts on 192.168 network but maybe a need arise
latter to use the 192.168 network so would not have to add this network
>
> also the Add Handler command in httpd.conf is there
> Just wondering what is wrong .
>
> appreciate your help and advice
>
> regards
>
>
> simon
>
>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUuky6AAoJENNXIZxhPexGtc0IAJxx7igaEgI+UUmBhc547VjQ
5HDWXFengYk7ijtF7SJCYiNKqsJIbYJjOwRnHr5Jgd4PD+G9h1JCYmb4Ba+6GE1L
a3OLDyoyGIU8K/xQQhHconZj2QLQYuTwgEk1YguECs3MR0jqKj715OfxfCQgMkw9
j83fmUGeg0T+KfGciNauf+H3c1jkIM8qRwQQpBrmjXC3hBkE4/rz7aJ++21YlcEr
wRC5lOYX8NqBdblzsmS1+xCZLyBjBnANZCFbIr/HpqJD0PbOI8uox369oK3TJ4Rs
77grMDGtUp2O3AbmeoZRO1z9jcW0Ifmp+qehsPDZH8CbSHC19XCDKgA/uSwicqg=
=R621
-----END PGP SIGNATURE-----



From simon at baladia.gov.kw  Sat Jan 17 11:45:54 2015
From: simon at baladia.gov.kw (Simon Dcunha)
Date: Sat, 17 Jan 2015 14:45:54 +0300 (AST)
Subject: [squid-users] proxy pac files issues
In-Reply-To: <54BA4CBB.9050206@gmail.com>
References: <458908434.21886.1421483849189.JavaMail.zimbra@baladia.gov.kw>
 <54BA4CBB.9050206@gmail.com>
Message-ID: <615568189.21897.1421495154269.JavaMail.zimbra@baladia.gov.kw>

Dear Yuri,


Thanks for the quick reply
really apprecite
i will check it out tomorrow and let you know

once again thanks a lot and god bless U


regards

simon


----- Original Message -----
From: "Yuri Voinov" <yvoinov at gmail.com>
To: squid-users at lists.squid-cache.org
Sent: Saturday, January 17, 2015 2:51:23 PM
Subject: Re: [squid-users] proxy pac files issues

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Hi Simon.

This is my working configuration.

On proxy web server:

# To httpd.conf
    # Add WPAD type
    AddType application/x-ns-proxy-autoconfig .dat

# Or to mime.types
application/x-ns-proxy-autoconfig         dat

WPAD file must be placed in proxy web root (in my case port 8080):

http://<proxyhostname_or_ip>:8080/wpad.dat

and wpad.dat contains:

function FindProxyForURL(url, host) {
    if (shExpMatch( host, "10.0.*" ) ||
    shExpMatch( host, "192.168.*" ) ||
        shExpMatch( host, "127.*" ) ||
        shExpMatch( host, "localhost" ) ||
        isPlainHostName( host )) {
        return "DIRECT";
    }
    else
    {
      return "PROXY <proxy_IP>:3128";
    }
}

Just correct proxy IP, web listening port and private networks in function.

Crosscheck it with yours,

WBR, Yuri

17.01.2015 14:37, Simon Dcunha ?????:
> Dear Guys,
>
> Let me revise my posts incase i was not very clear
>
> I need all my hosts on private IPs for example
> 10.0.0.0/8
> 172.16.0.0/16
> 192.168.0.0/16
> to be accessed without my squid proxy since they are on my local intranet
> but I have see that some hosts on the above ips are still accessed
through the squid proxy as the squid access .log file shows the logs and
the pac.access file does not show any information
> below is my newest pac file i have .
> ----------------
> function FindProxyForURL(url, host) {
> 
> // If the requested website is hosted within the internal network,
send direct.
>     if (isPlainHostName(host) ||
>         shExpMatch(host, "*.local") ||
>         isInNet(dnsResolve(host), "10.0.0.0", "255.0.0.0") ||
>         isInNet(dnsResolve(host), "172.16.0.0",  "255.255.0.0") ||
>         isInNet(dnsResolve(host), "192.168.0.0",  "255.255.0.0") ||
>         isInNet(dnsResolve(host), "127.0.0.0", "255.255.255.0"))
>         return "DIRECT";
>
>
>     return "PROXY 172.16.110.253:80";
> 
> }
>
> --------------------------
> right now I have no hosts on 192.168 network but maybe a need arise
latter to use the 192.168 network so would not have to add this network
>
> also the Add Handler command in httpd.conf is there
> Just wondering what is wrong .
>
> appreciate your help and advice
>
> regards
>
>
> simon
>
>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUuky6AAoJENNXIZxhPexGtc0IAJxx7igaEgI+UUmBhc547VjQ
5HDWXFengYk7ijtF7SJCYiNKqsJIbYJjOwRnHr5Jgd4PD+G9h1JCYmb4Ba+6GE1L
a3OLDyoyGIU8K/xQQhHconZj2QLQYuTwgEk1YguECs3MR0jqKj715OfxfCQgMkw9
j83fmUGeg0T+KfGciNauf+H3c1jkIM8qRwQQpBrmjXC3hBkE4/rz7aJ++21YlcEr
wRC5lOYX8NqBdblzsmS1+xCZLyBjBnANZCFbIr/HpqJD0PbOI8uox369oK3TJ4Rs
77grMDGtUp2O3AbmeoZRO1z9jcW0Ifmp+qehsPDZH8CbSHC19XCDKgA/uSwicqg=
=R621
-----END PGP SIGNATURE-----

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.



From eliezer at ngtech.co.il  Sat Jan 17 19:34:44 2015
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Sat, 17 Jan 2015 21:34:44 +0200
Subject: [squid-users] Squid not redirecting traffic to the internet
In-Reply-To: <92961952.2554499.1421481500035.JavaMail.yahoo@jws106118.mail.bf1.yahoo.com>
References: <92961952.2554499.1421481500035.JavaMail.yahoo@jws106118.mail.bf1.yahoo.com>
Message-ID: <54BAB954.7060207@ngtech.co.il>

Hey Christopher,

The email looks a bit messy and so I and I assume others couldn't 
understand it.
You can paste the config file content at:
http://pastie.org/

And please first describe the issue and later add more technical data 
such as config and dumps.

All The Bests,
Eliezer

On 17/01/2015 09:58, Christopher Venters wrote:
> Greetings,
> The following is my squid.conf:
> acl to_localhost dst 127.0.0.0/8 0.0.0.0/32 ::1acl localnet src 10.0.0.0/8             # RFC1918 possible internal networkacl localnet src 172.16.0.0/12          # RFC1918 possible internal networkacl localnet src 192.168.0.0/16 # RFC1918 possible internal networkacl localnet src fc00::/7               # RFC 4193 local private network rangeacl localnet src fe80::/10              # RFC 4291 link-local (directly plugged) machinesacl SSL_ports port 443acl Safe_ports port 80                   # httpacl Safe_ports port 21                   # ftpacl Safe_ports port 443                 # httpsacl Safe_ports port 70                   # gopheracl Safe_ports port 210                 # waisacl Safe_ports port 1025-65535   # unregistered portsacl Safe_ports port 280                 # http-mgmtacl Safe_ports port 488                 # gss-httpacl Safe_ports port 591                 # filemakeracl Safe_ports port 777                 # multiling httpacl CONNECT method CONNECThttp_access allow ma
nager localhosthttp_access deny managerhttp_access deny !Safe_portshttp_access deny CONNECT !SSL_portshttp_access allow localnethttp_access allow localhosthttp_access allow allvisible_hostname Squid_Boxhttp_port 3128 interceptwccp2_router 172.16.1.1wccp2_forwarding_method grewccp2_return_method grewccp2_assignment_method hashwccp2_service standard 0hierarchy_stoplist cgi-bin ?coredump_dir/var/spool/squidrefresh_pattern ^ftp:           1440    20%     10080refresh_pattern ^gopher:        1440    0%      1440refresh_pattern -i (/cgi-bin/|\?) 0     0%      0refresh_pattern .               0       20%     4320--
> Tunnel config:
> DEVICE=tun0TYPE=GREDEVICETYPE=tunnelBOOTPROTO=noneMY_INNER_IPADDR=10.0.0.50# MY_OUTER_IPADDR=10.0.0.51PEER_OUTER_IPADDR=172.16.1.1PEER_INNER_IPADDR=10.0.0.51NETMASK=255.255.255.0ONBOOT=yesIPV6INIT=noUSERCTL=no--
> After starting squid & running a tcpdump, I get the following & 172.16.1.200 is not getting out the the internet.
> [root at Squid_Box ~]# tcpdump -i tun0tcpdump: verbose output suppressed, use -v or -vv for full protocol decodelistening on tun0, link-type LINUX_SLL (Linux cooked), capture size 65535 bytes17:50:46.033624 IP 172.16.1.200.53123 > 72.21.91.29.http: Flags [S], seq 3999260288, win 8192, options [mss 1460,nop,nop,sackOK], length 017:50:46.284319 IP 172.16.1.200.53124 > 72.21.91.29.http: Flags [S], seq 593798473, win 8192, options [mss 1460,nop,nop,sackOK], length 017:50:46.461485 IP 172.16.1.200.53125 > 64.233.171.104.http: Flags [S], seq 2397006369, win 8192, options [mss 1460,nop,wscale 8,nop,nop,sackOK], length 017:50:46.741693 IP 172.16.1.200.53126 > 64.233.171.104.http: Flags [S], seq 1663740355, win 8192, options [mss 1460,nop,wscale 8,nop,nop,sackOK], length 0--
> Any assistance will be greatly appreciated.
> Thanks Much
>




From Jason_Haar at trimble.com  Sat Jan 17 21:23:32 2015
From: Jason_Haar at trimble.com (Jason Haar)
Date: Sun, 18 Jan 2015 10:23:32 +1300
Subject: [squid-users] proxy pac files issues
In-Reply-To: <458908434.21886.1421483849189.JavaMail.zimbra@baladia.gov.kw>
References: <458908434.21886.1421483849189.JavaMail.zimbra@baladia.gov.kw>
Message-ID: <54BAD2D4.7060903@trimble.com>

I just tested your WPAD script using the wonderful "pactester" and it
seems fine - it returned DIRECT/PROXY exactly as you intended. ie
there's nothing wrong with that WPAD

You say the clients seem to be going through the proxy for even internal
hosts? So that smells like WPAD being fundamentally broken - which
doesn't correlate with the above test result. So look again with a
packet sniffer. Bring up wireshark on a client and start the browser, go
to an internal site, stop the sniffer and review the download of the
WPAD file. I assume you are relying on DNS to point client at the WPAD,
but could you be a Windows shop and you've forgotten you also had WPAD
via DHCP and that points at a different/old WPAD file (ie one without
exceptions)?

Also test with Firefox: it has the "purest" WPAD support IMHO. If it
works in Firefox and not in MSIE/Chrome, then it's not a WPAD problem
(I'm not sure about me mentioning Chrome, it's just that I know Google
designed Chrome to use the same OS settings that MSIE does when it can -
so any bug/issue with those libraries could affect Chrome if they affect
MSIE)


-- 
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1



From Jason_Haar at trimble.com  Sun Jan 18 01:59:35 2015
From: Jason_Haar at trimble.com (Jason Haar)
Date: Sun, 18 Jan 2015 14:59:35 +1300
Subject: [squid-users] [squid-announce] Squid 3.5.1 is available
In-Reply-To: <54BA1918.7020308@treenet.co.nz>
References: <54BA1918.7020308@treenet.co.nz>
Message-ID: <54BB1387.7070800@trimble.com>

On 17/01/15 21:11, Amos Jeffries wrote:
> The Squid HTTP Proxy team is very pleased to announce the availability
> of the Squid-3.5.1 release!
>
> ...
>  * SSL peek-n-splice

Hi there

Could the documentation for peek-n-splice include an example showing how
to use it? The current http://www.squid-cache.org/Doc/config/ssl_bump/
still really refers to the 3.4 method (eg the examples don't include any
mention of SslBump1,SslBump2,etc)

I think most people wanting to use it would want to know how to make
squid figure out if the newly "proposed" session is talking to a HTTPS
server, then to bump that and splice anything else. So having the usage
example reflecting that makes sense

-- 
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1



From dan at getbusi.com  Sun Jan 18 03:48:17 2015
From: dan at getbusi.com (Dan Charlesworth)
Date: Sat, 17 Jan 2015 19:48:17 -0800 (PST)
Subject: [squid-users] [squid-announce] Squid 3.5.1 is available
In-Reply-To: <54BB1387.7070800@trimble.com>
References: <54BB1387.7070800@trimble.com>
Message-ID: <1421552897374.380d3f1c@Nodemailer>

Yeah. I definitely don't have my head around the new peek and splice directives and would appreciate some examples.

On Sun, Jan 18, 2015 at 12:59 PM, Jason Haar <Jason_Haar at trimble.com>
wrote:

> On 17/01/15 21:11, Amos Jeffries wrote:
>> The Squid HTTP Proxy team is very pleased to announce the availability
>> of the Squid-3.5.1 release!
>>
>> ...
>>  * SSL peek-n-splice
> Hi there
> Could the documentation for peek-n-splice include an example showing how
> to use it? The current http://www.squid-cache.org/Doc/config/ssl_bump/
> still really refers to the 3.4 method (eg the examples don't include any
> mention of SslBump1,SslBump2,etc)
> I think most people wanting to use it would want to know how to make
> squid figure out if the newly "proposed" session is talking to a HTTPS
> server, then to bump that and splice anything else. So having the usage
> example reflecting that makes sense
> -- 
> Cheers
> Jason Haar
> Corporate Information Security Manager, Trimble Navigation Ltd.
> Phone: +1 408 481 8171
> PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150117/a477c2ad/attachment.htm>

From yvoinov at gmail.com  Sun Jan 18 10:08:38 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Sun, 18 Jan 2015 16:08:38 +0600
Subject: [squid-users] [squid-announce] Squid 3.5.1 is available
In-Reply-To: <1421552897374.380d3f1c@Nodemailer>
References: <54BB1387.7070800@trimble.com> <1421552897374.380d3f1c@Nodemailer>
Message-ID: <54BB8626.4040503@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Furthermore - where is 3.5.1 itself?

http://i.imgur.com/UWuMTjy.png

I don't see any.

18.01.2015 9:48, Dan Charlesworth ?????:
> Yeah. I definitely don't have my head around the new peek and splice directives and would appreciate
some examples.
>
>
> 
>
>
> On Sun, Jan 18, 2015 at 12:59 PM, Jason Haar <Jason_Haar at trimble.com
<mailto:Jason_Haar at trimble.com>> wrote:
>
>     On 17/01/15 21:11, Amos Jeffries wrote:
>     > The Squid HTTP Proxy team is very pleased to announce the
availability
>     > of the Squid-3.5.1 release!
>     >
>     > ...
>     > * SSL peek-n-splice
>
>     Hi there
>
>     Could the documentation for peek-n-splice include an example
showing how
>     to use it? The current http://www.squid-cache.org/Doc/config/ssl_bump/
>     still really refers to the 3.4 method (eg the examples don't
include any
>     mention of SslBump1,SslBump2,etc)
>
>     I think most people wanting to use it would want to know how to make
>     squid figure out if the newly "proposed" session is talking to a HTTPS
>     server, then to bump that and splice anything else. So having the
usage
>     example reflecting that makes sense
>
>     --
>     Cheers
>
>     Jason Haar
>     Corporate Information Security Manager, Trimble Navigation Ltd.
>     Phone: +1 408 481 8171
>     PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1
>
>     _______________________________________________
>     squid-users mailing list
>     squid-users at lists.squid-cache.org
>     http://lists.squid-cache.org/listinfo/squid-users
>
>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUu4YmAAoJENNXIZxhPexG1mQH/1HIwrU2+IxICDBwi1HjdO94
2jYYC0VROscRRwCJV/rRAAeluOb3JfoHc/dxKwLBpgBV/CVzdlhJiqJd+IiO7n1M
Qot7jS88UJkmZfFp1URiY6SOMvq/xA1SFbJauKPnHx0bN1GX5sgEEohWsbtH1OkL
Vifcmxgi1NTNh971uLvx4FdpQuhurDejItS3J1gl/ih4cBrAgWoKl792gNdEaB7T
rNu0CtVrBGlIpDxL778ylgPenotcdwtsEYD1ThNzNw4Ar8P8AA9AebI6fcK4eSlE
ror2iaGCA/GpzTwv1KsFrSn2V7/37As/aP5rYCkYGx8bFU2MrCoYN/NYMpX5IxM=
=g3rT
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150118/95b7b476/attachment.htm>

From simon at baladia.gov.kw  Sun Jan 18 07:35:03 2015
From: simon at baladia.gov.kw (Simon Dcunha)
Date: Sun, 18 Jan 2015 10:35:03 +0300 (AST)
Subject: [squid-users] proxy pac files issues
In-Reply-To: <1747679724.22137.1421566429809.JavaMail.zimbra@baladia.gov.kw>
References: <458908434.21886.1421483849189.JavaMail.zimbra@baladia.gov.kw>
 <54BA4CBB.9050206@gmail.com>
 <1122100555.21975.1421548200446.JavaMail.zimbra@baladia.gov.kw>
Message-ID: <399018259.22138.1421566503536.JavaMail.zimbra@baladia.gov.kw>

Dear All,

Appreciate all your help and concerns and replies .
first of all i do apologize for the all the posts
the issue is been solved

actually there was 2 issues . 

first since I am running apache as a virtual web server on my squid proxy server the pac file was i did edited was in the root web directory 
it should be in the virtual web directory

second the network adresss schema was wrong with subnet mask...
so i used wildcard for the 10,172.16 n 192.168 network like 10* , 172.16* n 192.168* and now its works fine

once again sorry and do appreciate all you guys help

regards

simon

----- Original Message -----
From: "simon" <simon at baladia.gov.kw>
To: "Yuri Voinov" <yvoinov at gmail.com>
Sent: Sunday, January 18, 2015 5:30:00 AM
Subject: Re: [squid-users] proxy pac files issues

Dear Yuri and guys,

I have in my httpd.conf the below
-------------
AddType application/x-ns-proxy-autoconfig .pac

------------

and in my web server root i have a file named proxy.pac with the contents 
as i mentioned earlier in my post
just wanted to know does the naming of the file make any problem

appreciate your advise

regards

simon






----- Original Message -----
From: "Yuri Voinov" <yvoinov at gmail.com>
To: squid-users at lists.squid-cache.org
Sent: Saturday, January 17, 2015 2:51:23 PM
Subject: Re: [squid-users] proxy pac files issues

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Hi Simon.

This is my working configuration.

On proxy web server:

# To httpd.conf
    # Add WPAD type
    AddType application/x-ns-proxy-autoconfig .dat

# Or to mime.types
application/x-ns-proxy-autoconfig         dat

WPAD file must be placed in proxy web root (in my case port 8080):

http://<proxyhostname_or_ip>:8080/wpad.dat

and wpad.dat contains:

function FindProxyForURL(url, host) {
    if (shExpMatch( host, "10.0.*" ) ||
    shExpMatch( host, "192.168.*" ) ||
        shExpMatch( host, "127.*" ) ||
        shExpMatch( host, "localhost" ) ||
        isPlainHostName( host )) {
        return "DIRECT";
    }
    else
    {
      return "PROXY <proxy_IP>:3128";
    }
}

Just correct proxy IP, web listening port and private networks in function.

Crosscheck it with yours,

WBR, Yuri

17.01.2015 14:37, Simon Dcunha ?????:
> Dear Guys,
>
> Let me revise my posts incase i was not very clear
>
> I need all my hosts on private IPs for example
> 10.0.0.0/8
> 172.16.0.0/16
> 192.168.0.0/16
> to be accessed without my squid proxy since they are on my local intranet
> but I have see that some hosts on the above ips are still accessed
through the squid proxy as the squid access .log file shows the logs and
the pac.access file does not show any information
> below is my newest pac file i have .
> ----------------
> function FindProxyForURL(url, host) {
> 
> // If the requested website is hosted within the internal network,
send direct.
>     if (isPlainHostName(host) ||
>         shExpMatch(host, "*.local") ||
>         isInNet(dnsResolve(host), "10.0.0.0", "255.0.0.0") ||
>         isInNet(dnsResolve(host), "172.16.0.0",  "255.255.0.0") ||
>         isInNet(dnsResolve(host), "192.168.0.0",  "255.255.0.0") ||
>         isInNet(dnsResolve(host), "127.0.0.0", "255.255.255.0"))
>         return "DIRECT";
>
>
>     return "PROXY 172.16.110.253:80";
> 
> }
>
> --------------------------
> right now I have no hosts on 192.168 network but maybe a need arise
latter to use the 192.168 network so would not have to add this network
>
> also the Add Handler command in httpd.conf is there
> Just wondering what is wrong .
>
> appreciate your help and advice
>
> regards
>
>
> simon
>
>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUuky6AAoJENNXIZxhPexGtc0IAJxx7igaEgI+UUmBhc547VjQ
5HDWXFengYk7ijtF7SJCYiNKqsJIbYJjOwRnHr5Jgd4PD+G9h1JCYmb4Ba+6GE1L
a3OLDyoyGIU8K/xQQhHconZj2QLQYuTwgEk1YguECs3MR0jqKj715OfxfCQgMkw9
j83fmUGeg0T+KfGciNauf+H3c1jkIM8qRwQQpBrmjXC3hBkE4/rz7aJ++21YlcEr
wRC5lOYX8NqBdblzsmS1+xCZLyBjBnANZCFbIr/HpqJD0PbOI8uox369oK3TJ4Rs
77grMDGtUp2O3AbmeoZRO1z9jcW0Ifmp+qehsPDZH8CbSHC19XCDKgA/uSwicqg=
=R621
-----END PGP SIGNATURE-----

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.



From squid3 at treenet.co.nz  Sun Jan 18 10:50:35 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 18 Jan 2015 23:50:35 +1300
Subject: [squid-users] proxy pac files issues
In-Reply-To: <399018259.22138.1421566503536.JavaMail.zimbra@baladia.gov.kw>
References: <458908434.21886.1421483849189.JavaMail.zimbra@baladia.gov.kw>
 <54BA4CBB.9050206@gmail.com>
 <1122100555.21975.1421548200446.JavaMail.zimbra@baladia.gov.kw>
 <399018259.22138.1421566503536.JavaMail.zimbra@baladia.gov.kw>
Message-ID: <54BB8FFB.5030904@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 18/01/2015 8:35 p.m., Simon Dcunha wrote:
> Dear All,
> 
> Appreciate all your help and concerns and replies . first of all i
> do apologize for the all the posts the issue is been solved
> 
> actually there was 2 issues .
> 
> first since I am running apache as a virtual web server on my squid
> proxy server the pac file was i did edited was in the root web
> directory it should be in the virtual web directory
> 
> second the network adresss schema was wrong with subnet mask... so
> i used wildcard for the 10,172.16 n 192.168 network like 10* ,
> 172.16* n 192.168* and now its works fine
> 

One last thing. Please take care that the patterns you mention above
are not also matching in the ranges 100/8 ... 109/* and 172.160/16 ..
172.169/16. Almost all of possible IPv4 space is now allocated and
chances of encountering traffic in those ranges is actually quite high.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUu4/6AAoJELJo5wb/XPRjcV0H/AkqJsyZiZ3GDH5uSs7NDb4m
H0yt3AcoS2K+pVSO81x4oQeMpZ2uD4wbiXUVuIjxZoccAUOYVSaFKP3xkN0S74pQ
5kpfrMRKMHZg7Dj2Gt1tyvrTvWazXu9vrrlDGp2lQYbkNaVfHySBjg6xXBtuN2kp
5xz6Mk2IT1B2RTMwQ2pi5mQsq7WMcGpX9tBJBT3FD4KZPpMcVHoyCGFQz9OUptPz
L9U0Mj5ejka4Ku0yeJZNeuxaYhSCj6b+8rYlDQjLstSBcL3z4rfi7T3H7siQ5WQe
/701DA8qCRD8P/jussrM6LmRm9P8BvllRSZwi/1EXeZoch962Sklh5Hi9Egq8A0=
=EKJe
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Sun Jan 18 10:51:23 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 18 Jan 2015 23:51:23 +1300
Subject: [squid-users] [squid-announce] Squid 3.5.1 is available
In-Reply-To: <54BB8626.4040503@gmail.com>
References: <54BB1387.7070800@trimble.com> <1421552897374.380d3f1c@Nodemailer>
 <54BB8626.4040503@gmail.com>
Message-ID: <54BB902B.2060807@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 18/01/2015 11:08 p.m., Yuri Voinov wrote:
> 
> Furthermore - where is 3.5.1 itself?
> 
> http://i.imgur.com/UWuMTjy.png
> 
> I don't see any.

Ah. That page is now fixed.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUu5ArAAoJELJo5wb/XPRjWpsH/jJ+Y9EkqrriCXkDKVkviOx/
QEKSJx+PZ4lKeqU1KoTkb3SFVYLm8+WCWlOFYRX/FN1DV8AXeTBdbo/QDjEN1zvs
SeyRa8qas0psHuNMHPo3AMsJJrbAGRjxDVJcr71m0pykCB+yRL0hpZFwQ64IDjld
oQEsnaCybKvJxM+vjrOEQ4eLAA2NPCLWzpDEQeACrq4u8q3yn4XeyF6ApwQDN5th
FaNtvAd3H+Olypf3mL9XSdwdHzG+QH5N+s3EbFJkvheqEXwjeP+PFF5k6+8M3/bT
uO9oQ5qWdGbxFI3okR6Huax0F8xzTLvXsj0ENijQ9QEB+TjP9fTnA6ssoO3i5LA=
=Nziv
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Sun Jan 18 10:59:47 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 18 Jan 2015 23:59:47 +1300
Subject: [squid-users] [squid-announce] Squid 3.5.1 is available
In-Reply-To: <1421552897374.380d3f1c@Nodemailer>
References: <54BB1387.7070800@trimble.com> <1421552897374.380d3f1c@Nodemailer>
Message-ID: <54BB9223.50406@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 18/01/2015 4:48 p.m., Dan Charlesworth wrote:
> Yeah. I definitely don't have my head around the new peek and
> splice directives and would appreciate some examples.
> 
> On Sun, Jan 18, 2015 at 12:59 PM, Jason Haar wrote:
> 
>> On 17/01/15 21:11, Amos Jeffries wrote:
>>> The Squid HTTP Proxy team is very pleased to announce the
>>> availability of the Squid-3.5.1 release!
>>> 
>>> ... * SSL peek-n-splice
>> Hi there Could the documentation for peek-n-splice include an
>> example showing how to use it? The current
>> http://www.squid-cache.org/Doc/config/ssl_bump/ still really
>> refers to the 3.4 method (eg the examples don't include any 
>> mention of SslBump1,SslBump2,etc) I think most people wanting to
>> use it would want to know how to make squid figure out if the
>> newly "proposed" session is talking to a HTTPS server, then to
>> bump that and splice anything else. So having the usage example
>> reflecting that makes sense

Some basic examples are detailed in the section titled "Examples" on
http://wiki.squid-cache.org/Features/SslPeekAndSplice

They will not work if you cut-n-paste without understanding what needs
to be done to make them work. But then, this is a dangerous feature to
be using so cut-n-paste config is not a great idea.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUu5IjAAoJELJo5wb/XPRjgZAH/09jA1n1h9PJtpAB4bKJybmp
cCNql5b1sqAACc1fhiOEbLiAKMeOyYof4kZDmeub0O+Zat6RdMFQderlGNP7U/bh
7STF60TODLqSZsddgYsWLgtTa4DKOPlGVP9NEh9dX4A75RKaCLFSEgzvKiMm0JhQ
cGRJokHrbmEga2apqa/LkwinD6Spo5sEuM9qf6Hlgt2dJ2ukeIXF7UdBvE3vurEe
ChBd1/PMunARhGlfXbdUY2Nd488E6+gKeVaZfdS/T09BBMqMu790g944ocPFt6gL
LTtApvY3UeVGJYYl5egFq3a9jK9/8iE88hvIGTsPsEjJK1EzCIPIkORQo42q2bg=
=VhOA
-----END PGP SIGNATURE-----


From squid at proxyplayer.co.uk  Sun Jan 18 14:39:03 2015
From: squid at proxyplayer.co.uk (squid at proxyplayer.co.uk)
Date: Sun, 18 Jan 2015 14:39:03 +0000
Subject: [squid-users] google always requesting captach through transparent
	proxy
In-Reply-To: <54BB9223.50406@treenet.co.nz>
References: <54BB1387.7070800@trimble.com>
 <1421552897374.380d3f1c@Nodemailer> <54BB9223.50406@treenet.co.nz>
Message-ID: <20150118143903.2020441id44pq553@webmail-srv2.servage.net>

Google is requesting a captcha everytime I request a page as it is  
saying that my computer is doing something weird (via a proxy).

How can I get rid of this message from Google. I tried redirecting  
directly but it makes no difference. It seems like Google is pickingup  
a lack of headers as an issue.

auth_param basic realm AAA proxy server
auth_param basic credentialsttl 2 hours
auth_param basic program /usr/lib64/squid/ncsa_auth /etc/squid/squid_passwd
authenticate_cache_garbage_interval 1 hour
authenticate_ip_ttl 2 hours
acl manager proto cache_object
acl localhost src 127.0.0.1/32
acl to_localhost dst 127.0.0.0/8
acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl Safe_ports port 1863         # MSN messenger
acl ncsa_users proxy_auth REQUIRED
acl CONNECT method CONNECT
http_access deny manager
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access deny to_localhost
http_access allow localhost
http_access allow ncsa_users
http_access deny all
icp_access allow all
http_port 8080
http_port 80
access_log /var/log/squid/access.log squid
cache_log /var/log/squid/cache.log
buffered_logs on
half_closed_clients off
visible_hostname AAAProxyServer
log_icp_queries off
dns_nameservers 208.67.222.222 208.67.220.220
hosts_file /etc/hosts
memory_pools off
client_db off
delay_pools 1
delay_class 1 2
delay_parameters 1 -1/-1 400000/400000
acl google1 dstdomain .google.com
acl google2 dstdomain .google.co.uk
always_direct allow google1 google2
via off
forwarded_for off
follow_x_forwarded_for deny all
cache_mem 512 MB



From squid3 at treenet.co.nz  Sun Jan 18 14:48:53 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 19 Jan 2015 03:48:53 +1300
Subject: [squid-users] google always requesting captach through
 transparent proxy
In-Reply-To: <20150118143903.2020441id44pq553@webmail-srv2.servage.net>
References: <54BB1387.7070800@trimble.com> <1421552897374.380d3f1c@Nodemailer>
 <54BB9223.50406@treenet.co.nz>
 <20150118143903.2020441id44pq553@webmail-srv2.servage.net>
Message-ID: <54BBC7D5.8040508@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 19/01/2015 3:39 a.m., squid at proxyplayer.co.uk wrote:
> Google is requesting a captcha everytime I request a page as it is 
> saying that my computer is doing something weird (via a proxy).

What *exactly* is it saying?

> 
> How can I get rid of this message from Google. I tried redirecting 
> directly but it makes no difference. It seems like Google is
> pickingup a lack of headers as an issue.

 acl google dstdom_regex -i google
 http_access deny google

but I suspect maybe you might not actually like the results of what
you are asking for.

> 
> auth_param basic realm AAA proxy server auth_param basic
> credentialsttl 2 hours auth_param basic program
> /usr/lib64/squid/ncsa_auth /etc/squid/squid_passwd 
> authenticate_cache_garbage_interval 1 hour authenticate_ip_ttl 2
> hours acl manager proto cache_object acl localhost src
> 127.0.0.1/32 acl to_localhost dst 127.0.0.0/8 acl SSL_ports port
> 443 acl Safe_ports port 80          # http acl Safe_ports port 21
> # ftp acl Safe_ports port 443         # https acl Safe_ports port
> 70          # gopher acl Safe_ports port 210         # wais acl
> Safe_ports port 1025-65535  # unregistered ports acl Safe_ports
> port 280         # http-mgmt acl Safe_ports port 488         #
> gss-http acl Safe_ports port 591         # filemaker acl Safe_ports
> port 777         # multiling http acl Safe_ports port 1863
> # MSN messenger acl ncsa_users proxy_auth REQUIRED acl CONNECT
> method CONNECT http_access deny manager http_access deny
> !Safe_ports http_access deny CONNECT !SSL_ports http_access deny
> to_localhost http_access allow localhost http_access allow
> ncsa_users http_access deny all icp_access allow all http_port
> 8080 http_port 80 access_log /var/log/squid/access.log squid 
> cache_log /var/log/squid/cache.log buffered_logs on 
> half_closed_clients off visible_hostname AAAProxyServer 
> log_icp_queries off dns_nameservers 208.67.222.222 208.67.220.220 
> hosts_file /etc/hosts memory_pools off client_db off delay_pools 1 
> delay_class 1 2 delay_parameters 1 -1/-1 400000/400000

I assume this following bit of config is what you meant by "I tried
redirecting directly".

> acl google1 dstdomain .google.com acl google2 dstdomain
> .google.co.uk always_direct allow google1 google2

What it tells Squid is not to use a cache_peer connection if the URL
domain name is BOTH *.google.com AND *.google.co.uk.

So as you should be able to see it is not possible for teh domain to
match two different values simultaneously. And you are not useing
cache_peer ayway so even if/when the directive matches it has no effect.


> via off forwarded_for off follow_x_forwarded_for deny all cache_mem
> 512 MB
> 

PS. you config is showing a lot of directives that have been obsolete
for several years now. If your Squid version is so old that it will
accept the above config, then its time to consider an upgrade.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUu8fVAAoJELJo5wb/XPRj2GoIAJbO3LxR1L6NmgdnDTH3RvTh
sxsp+Oq0jXj8SjOx5bwSrlrzF84mZFtXjHyEM0iWEwpWGGw6IVQ7JrHIv5sOXI5A
g39yIoqHdKGIhxJE6w5hFefpgfXCAFCQ0lGRCYEFya9+dtno1XPIWlHny0M3/aJD
r24ipb6mffvQ+bvrD9yO1lJK4EaZQmrmp4L5sxEPiUGWunKagZpQIs+xfXwYbf8+
WSmtRdA5lkAGd8ylW/y35SApulU7MxRT+d/hKON/Blwfg1eCKk7dY+VXqp/a0GFH
OOursNxUZHx9PG1FXxHtEjXbDCQfUqw8/jux3DJPpELbe1gr51YJElgI0PQZIro=
=pq+8
-----END PGP SIGNATURE-----


From simon at baladia.gov.kw  Sun Jan 18 15:13:12 2015
From: simon at baladia.gov.kw (Simon Dcunha)
Date: Sun, 18 Jan 2015 18:13:12 +0300 (AST)
Subject: [squid-users] proxy pac files issues
In-Reply-To: <1527752778.22190.1421593953933.JavaMail.zimbra@baladia.gov.kw>
References: <458908434.21886.1421483849189.JavaMail.zimbra@baladia.gov.kw>
 <54BA4CBB.9050206@gmail.com>
 <1122100555.21975.1421548200446.JavaMail.zimbra@baladia.gov.kw>
 <399018259.22138.1421566503536.JavaMail.zimbra@baladia.gov.kw>
 <54BB8FFB.5030904@treenet.co.nz>
Message-ID: <728025420.22191.1421593992347.JavaMail.zimbra@baladia.gov.kw>

Dear Amos ,

Thanks for the tip 
you are absolutely right
but since I am also a network admin i will see that any new networks are only in the 10* or 172.16*
we dont use 192.168* network 
once again thanks and appreciate your concern and highlighting the cons..


Thanks & regards
God Bless U

simon

----- Original Message -----
From: "Amos Jeffries" <squid3 at treenet.co.nz>
To: squid-users at lists.squid-cache.org
Sent: Sunday, January 18, 2015 1:50:35 PM
Subject: Re: [squid-users] proxy pac files issues

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 18/01/2015 8:35 p.m., Simon Dcunha wrote:
> Dear All,
> 
> Appreciate all your help and concerns and replies . first of all i
> do apologize for the all the posts the issue is been solved
> 
> actually there was 2 issues .
> 
> first since I am running apache as a virtual web server on my squid
> proxy server the pac file was i did edited was in the root web
> directory it should be in the virtual web directory
> 
> second the network adresss schema was wrong with subnet mask... so
> i used wildcard for the 10,172.16 n 192.168 network like 10* ,
> 172.16* n 192.168* and now its works fine
> 

One last thing. Please take care that the patterns you mention above
are not also matching in the ranges 100/8 ... 109/* and 172.160/16 ..
172.169/16. Almost all of possible IPv4 space is now allocated and
chances of encountering traffic in those ranges is actually quite high.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUu4/6AAoJELJo5wb/XPRjcV0H/AkqJsyZiZ3GDH5uSs7NDb4m
H0yt3AcoS2K+pVSO81x4oQeMpZ2uD4wbiXUVuIjxZoccAUOYVSaFKP3xkN0S74pQ
5kpfrMRKMHZg7Dj2Gt1tyvrTvWazXu9vrrlDGp2lQYbkNaVfHySBjg6xXBtuN2kp
5xz6Mk2IT1B2RTMwQ2pi5mQsq7WMcGpX9tBJBT3FD4KZPpMcVHoyCGFQz9OUptPz
L9U0Mj5ejka4Ku0yeJZNeuxaYhSCj6b+8rYlDQjLstSBcL3z4rfi7T3H7siQ5WQe
/701DA8qCRD8P/jussrM6LmRm9P8BvllRSZwi/1EXeZoch962Sklh5Hi9Egq8A0=
=EKJe
-----END PGP SIGNATURE-----
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.



From mattatrmc at gmail.com  Sun Jan 18 18:51:13 2015
From: mattatrmc at gmail.com (Matt Bowman)
Date: Sun, 18 Jan 2015 13:51:13 -0500
Subject: [squid-users] Squid 3.5.1 install
Message-ID: <682504C5-9325-4638-8603-5353C4CE71AC@gmail.com>

Hey guys,

I just tried compiling the latest version of squid 3.5.1 with OpenSSL enabled and am receiving compile errors.  Has anyone else run into this problem?

Thanks,

Matt

Sent from my iPhone

From mattatrmc at gmail.com  Sun Jan 18 19:28:00 2015
From: mattatrmc at gmail.com (Matthew Bowman)
Date: Sun, 18 Jan 2015 14:28:00 -0500
Subject: [squid-users] Squid 3.5.1 Install
Message-ID: <3A15FB58-097C-4F2F-A89A-9D0D3470078A@gmail.com>

Hey guys,

I just tried compiling the latest version of squid 3.5.1 with OpenSSL enabled and am receiving compile errors.  Has anyone else run into this problem?

Thanks,

Matt

From yvoinov at gmail.com  Sun Jan 18 19:52:40 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 19 Jan 2015 01:52:40 +0600
Subject: [squid-users] Squid 3.5.1 Install
In-Reply-To: <3A15FB58-097C-4F2F-A89A-9D0D3470078A@gmail.com>
References: <3A15FB58-097C-4F2F-A89A-9D0D3470078A@gmail.com>
Message-ID: <54BC0F08.3010001@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Yep.

Show us compilation options and provide details your build environment.


19.01.2015 1:28, Matthew Bowman ?????:
> Hey guys,
>
> I just tried compiling the latest version of squid 3.5.1 with OpenSSL
enabled and am receiving compile errors.  Has anyone else run into this
problem?
>
> Thanks,
>
> Matt
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUvA8HAAoJENNXIZxhPexGmM4H/2nYbas4Rra/qEC7yBXQxta/
xKGmagp6eq3+tgMKqB3oohfoWq4lGII2j1JofiJSRnxqb5e82BtDwO8Q+U3r3vut
cYDf9dgUfkuYVZtgvKmbGnp9Ffih49iaiQ8Vp42an0VQ7XS1tKysonK0mbCjm0UE
zAnYgZpd1WXj8AoS3MT3adyMaAW2kXb/OlH5eK+b11v3ugavmctKPX0G1emvR1D9
+Hgd1PMUjg0vG2XKDO9O+ncNoDN9RacEkVE8ZNpO693u+zN9Bb/6/5Ee7n9Nz1uU
jnqIDYSLFj3Mhfewfk8uzmkcYeF8Vwwa43orioC5UeRN4XK5LfeR3BSZex5f6Mw=
=UoJ9
-----END PGP SIGNATURE-----



From yvoinov at gmail.com  Sun Jan 18 20:00:57 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 19 Jan 2015 02:00:57 +0600
Subject: [squid-users] Squid 3.5.1 Install
In-Reply-To: <3A15FB58-097C-4F2F-A89A-9D0D3470078A@gmail.com>
References: <3A15FB58-097C-4F2F-A89A-9D0D3470078A@gmail.com>
Message-ID: <54BC10F9.1000808@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
I've fight errors with specify '--with-openssl=/opt/csw' and also 
'LIBOPENSSL_CFLAGS=-I/opt/csw/include/openssl',
'CPPFLAGS=-I/opt/csw/include' options.

To specify right path to my OpenSSL with correct 32/64 bit. :)

19.01.2015 1:28, Matthew Bowman ?????:
> Hey guys,
>
> I just tried compiling the latest version of squid 3.5.1 with OpenSSL
enabled and am receiving compile errors.  Has anyone else run into this
problem?
>
> Thanks,
>
> Matt
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUvBD5AAoJENNXIZxhPexGCygH/j5ryH0WqK1z6TbKWev7a09O
04Y6vQQed1K+ZQN9GyPHspGLmFiiL1XCkfE3wmvdpEwiQJkEm93La2TdlX5iQzrd
TB/8lt1xUJaRatnKST3w1me0Y6mibHWARiU0dTvD9wwJEVJC8iZj+Ak46NiQxk2V
DFhYMqoUvVA/yD2YHrpV8nxq/RPlvCJ+EduQy5GB0yIyrc/KgSVFVZJbouXrEFcW
8e5XcA1o5iz/z3XDDLVozjjnuhE3S2ItwW1kIagnDH13iBoYT67i7jZYDMLb/Tqe
AxupjKcre+nNLDQ2QLFyl3DWW2DtCwMtIv6YpwcWA6lNQwEDMXr5XYvRHuuFjmk=
=vDgj
-----END PGP SIGNATURE-----



From gkinkie at gmail.com  Sun Jan 18 20:02:20 2015
From: gkinkie at gmail.com (Kinkie)
Date: Sun, 18 Jan 2015 21:02:20 +0100
Subject: [squid-users] Squid 3.5.1 install
In-Reply-To: <682504C5-9325-4638-8603-5353C4CE71AC@gmail.com>
References: <682504C5-9325-4638-8603-5353C4CE71AC@gmail.com>
Message-ID: <CA+Y8hcMcuEk1GrqtM3Cp4K_bZnHxfB8AzT_zVDkfh-BttYRcZg@mail.gmail.com>

Hi Matt,
  could you share the last 20 lines of the build output, and what
environment you are building on?
The developers regularly test builds on 15 or so different OSes (see
http://build.squid-cache.org) but yours may be different.
You may also want to check the squid wiki for details on how to set up
a build environment.

On Sun, Jan 18, 2015 at 7:51 PM, Matt Bowman <mattatrmc at gmail.com> wrote:
> Hey guys,
>
> I just tried compiling the latest version of squid 3.5.1 with OpenSSL enabled and am receiving compile errors.  Has anyone else run into this problem?
>
> Thanks,
>
> Matt
>
> Sent from my iPhone
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



-- 
    Francesco


From mattatrmc at gmail.com  Sun Jan 18 20:06:50 2015
From: mattatrmc at gmail.com (mattatrmc)
Date: Sun, 18 Jan 2015 12:06:50 -0800 (PST)
Subject: [squid-users] Squid 3.5.1 install
In-Reply-To: <CA+Y8hcMcuEk1GrqtM3Cp4K_bZnHxfB8AzT_zVDkfh-BttYRcZg@mail.gmail.com>
References: <682504C5-9325-4638-8603-5353C4CE71AC@gmail.com>
 <CA+Y8hcMcuEk1GrqtM3Cp4K_bZnHxfB8AzT_zVDkfh-BttYRcZg@mail.gmail.com>
Message-ID: <1421611610142-4669151.post@n4.nabble.com>

hey Francessco,

I actually tried to troubleshoot the problem on my own while I was waiting
to hear from other people.  I'm using OpenBSD 5.6, which I would assume
would be one of the OS's trialled by the developers.

It turns out my mistake was with the --with-openssl switch I wasn't
specifying the location which by default is different for my OS.  

Thanks for getting back to me, I'll have to make sure to drink less coffee
when I work in the future

Matt



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-3-5-1-install-tp4669146p4669151.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From mattatrmc at gmail.com  Sun Jan 18 20:07:41 2015
From: mattatrmc at gmail.com (mattatrmc)
Date: Sun, 18 Jan 2015 12:07:41 -0800 (PST)
Subject: [squid-users] Squid 3.5.1 Install
In-Reply-To: <54BC0F08.3010001@gmail.com>
References: <682504C5-9325-4638-8603-5353C4CE71AC@gmail.com>
 <54BC0F08.3010001@gmail.com>
Message-ID: <1421611661052-4669152.post@n4.nabble.com>

Thanks for the reply Yuri,

I actually just sorted out my issue? it turns out that OpenBSD installs
OpenSSL to a different location then the default for squid. Once I changed
the path to  where OpenSSL is on my machine it compiled.  It is
/usr/local/ssl

Matt



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-3-5-1-install-tp4669146p4669152.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From odhiambo at gmail.com  Sun Jan 18 21:03:11 2015
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Mon, 19 Jan 2015 00:03:11 +0300
Subject: [squid-users] [squid-announce] Squid 3.5.1 is available
In-Reply-To: <54BB9223.50406@treenet.co.nz>
References: <54BB1387.7070800@trimble.com> <1421552897374.380d3f1c@Nodemailer>
 <54BB9223.50406@treenet.co.nz>
Message-ID: <CAAdA2WP_WZDSMMO66NqPBJfajvg7PRhvs8waKoObX20c6QVwRA@mail.gmail.com>

When compiling, I get the following error:

configure: error: Basic auth helper MSNT ... not found

I have removed MSNT from my configure parameters, but still not go...

On 18 January 2015 at 13:59, Amos Jeffries <squid3 at treenet.co.nz> wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 18/01/2015 4:48 p.m., Dan Charlesworth wrote:
> > Yeah. I definitely don't have my head around the new peek and
> > splice directives and would appreciate some examples.
> >
> > On Sun, Jan 18, 2015 at 12:59 PM, Jason Haar wrote:
> >
> >> On 17/01/15 21:11, Amos Jeffries wrote:
> >>> The Squid HTTP Proxy team is very pleased to announce the
> >>> availability of the Squid-3.5.1 release!
> >>>
> >>> ... * SSL peek-n-splice
> >> Hi there Could the documentation for peek-n-splice include an
> >> example showing how to use it? The current
> >> http://www.squid-cache.org/Doc/config/ssl_bump/ still really
> >> refers to the 3.4 method (eg the examples don't include any
> >> mention of SslBump1,SslBump2,etc) I think most people wanting to
> >> use it would want to know how to make squid figure out if the
> >> newly "proposed" session is talking to a HTTPS server, then to
> >> bump that and splice anything else. So having the usage example
> >> reflecting that makes sense
>
> Some basic examples are detailed in the section titled "Examples" on
> http://wiki.squid-cache.org/Features/SslPeekAndSplice
>
> They will not work if you cut-n-paste without understanding what needs
> to be done to make them work. But then, this is a dangerous feature to
> be using so cut-n-paste config is not a great idea.
>
> Amos
>
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2.0.22 (MingW32)
>
> iQEcBAEBAgAGBQJUu5IjAAoJELJo5wb/XPRjgZAH/09jA1n1h9PJtpAB4bKJybmp
> cCNql5b1sqAACc1fhiOEbLiAKMeOyYof4kZDmeub0O+Zat6RdMFQderlGNP7U/bh
> 7STF60TODLqSZsddgYsWLgtTa4DKOPlGVP9NEh9dX4A75RKaCLFSEgzvKiMm0JhQ
> cGRJokHrbmEga2apqa/LkwinD6Spo5sEuM9qf6Hlgt2dJ2ukeIXF7UdBvE3vurEe
> ChBd1/PMunARhGlfXbdUY2Nd488E6+gKeVaZfdS/T09BBMqMu790g944ocPFt6gL
> LTtApvY3UeVGJYYl5egFq3a9jK9/8iE88hvIGTsPsEjJK1EzCIPIkORQo42q2bg=
> =VhOA
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>



-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254733744121/+254722743223
"I can't hear you -- I'm using the scrambler."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150119/8fbb62db/attachment.htm>

From jbhasin83 at gmail.com  Sun Jan 18 22:32:02 2015
From: jbhasin83 at gmail.com (Jatin Bhasin)
Date: Mon, 19 Jan 2015 09:32:02 +1100
Subject: [squid-users] Squid SSL Bump Certificates
Message-ID: <CAGRJihW7Kb0sazqQdcgDua0HOA5i+wyjAXNeOqPcGMremxA7MQ@mail.gmail.com>

Hello,

I am using squid 3.4.9 with SSL Bump feature. I am using the following
https_port directive.

https_port 8090 tproxy ssl-bump generate-host-certificates=on
dynamic_cert_mem_cache_size=16MB cert=Certficate key=Key


I am unable to find out where all the certificates are being stored. I
was wondering if I could do the following if I am able to find the
location where squid stores these certificates:

1) Expiration Dates on the certificates
2) Common name mismatches
3) Self Signed Certificates

Also I would like to know if squid checks for Revocation Status
(CRL/OCSP) of the certificate.


Thanks,


From jbhasin83 at gmail.com  Sun Jan 18 22:32:02 2015
From: jbhasin83 at gmail.com (Jatin Bhasin)
Date: Mon, 19 Jan 2015 09:32:02 +1100
Subject: [squid-users] Squid SSL Bump Certificates
Message-ID: <CAGRJihW7Kb0sazqQdcgDua0HOA5i+wyjAXNeOqPcGMremxA7MQ@mail.gmail.com>

Hello,

I am using squid 3.4.9 with SSL Bump feature. I am using the following
https_port directive.

https_port 8090 tproxy ssl-bump generate-host-certificates=on
dynamic_cert_mem_cache_size=16MB cert=Certficate key=Key


I am unable to find out where all the certificates are being stored. I
was wondering if I could do the following if I am able to find the
location where squid stores these certificates:

1) Expiration Dates on the certificates
2) Common name mismatches
3) Self Signed Certificates

Also I would like to know if squid checks for Revocation Status
(CRL/OCSP) of the certificate.


Thanks,


From squid3 at treenet.co.nz  Mon Jan 19 02:22:58 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 19 Jan 2015 15:22:58 +1300
Subject: [squid-users] [squid-announce] Squid 3.5.1 is available
In-Reply-To: <CAAdA2WP_WZDSMMO66NqPBJfajvg7PRhvs8waKoObX20c6QVwRA@mail.gmail.com>
References: <54BB1387.7070800@trimble.com> <1421552897374.380d3f1c@Nodemailer>
 <54BB9223.50406@treenet.co.nz>
 <CAAdA2WP_WZDSMMO66NqPBJfajvg7PRhvs8waKoObX20c6QVwRA@mail.gmail.com>
Message-ID: <54BC6A82.9070808@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 19/01/2015 10:03 a.m., Odhiambo Washington wrote:
> When compiling, I get the following error:
> 
> configure: error: Basic auth helper MSNT ... not found
> 

- From the release announcement:
"
 * Basic authentication MSNT helper changes
...

Further details can be found in the release notes
"

In particular
<http://www.squid-cache.org/Versions/v3/3.5/RELEASENOTES.html#ss2.8>

In short: the helper called "MSNT" is renamed and deprecated.


> I have removed MSNT from my configure parameters, but still not
> go...

You need to wipe the build directory and re-run ./configure from a
clean location after changing the helper parameter(s).

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUvGqCAAoJELJo5wb/XPRjrQAH/20LD7e1UjdkmGDo+pbVqZwH
GIJRkPIAXuCjebRvtIcDl7s5NmVxS3iqMg4bfvn3RPH3/aUScjFIjsiDrhV5HEuh
hDFkRzhG6ud8MBU3SNMtG7FljaRD9U4H4cNgOEmEpNbmIm7vOcHY9csoNXSBdYcS
0GXJugCz1yNVkuXtFnnOTMaFa0r5zuqRSgCCFA3CzcCDgcTSuQo/CF69JrgC6fg7
zeJDQMVjIkwVNGNbY3hgFgkNrGJyTSxwbFSPYKLwzrZKpBh//LzIvOydAPT3p4F7
Hi25TmtbAkbZNkR/EfCJKIWcBShMNgObHU9GXxvzjvsTwmdAiUiAgTDwtJ8p4ZI=
=gZmB
-----END PGP SIGNATURE-----


From squid at proxyplayer.co.uk  Mon Jan 19 03:30:45 2015
From: squid at proxyplayer.co.uk (squid at proxyplayer.co.uk)
Date: Mon, 19 Jan 2015 03:30:45 +0000
Subject: [squid-users] google always requesting captach through
 transparent proxy
In-Reply-To: <54BBC7D5.8040508@treenet.co.nz>
References: <54BB1387.7070800@trimble.com>
 <1421552897374.380d3f1c@Nodemailer> <54BB9223.50406@treenet.co.nz>
 <20150118143903.2020441id44pq553@webmail-srv2.servage.net>
 <54BBC7D5.8040508@treenet.co.nz>
Message-ID: <20150119033045.199712tcod5b9mqu@webmail-srv2.servage.net>

Quoting Amos Jeffries <squid3 at treenet.co.nz>:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 19/01/2015 3:39 a.m., squid at proxyplayer.co.uk wrote:
>> Google is requesting a captcha everytime I request a page as it is
>> saying that my computer is doing something weird (via a proxy).
>
> What *exactly* is it saying?
>

Your systems have detected unusual traffic from your computer network.
Some computers it presents a captcha, on others it just plain refuses  
to show search results.
>>
>> How can I get rid of this message from Google. I tried redirecting
>> directly but it makes no difference. It seems like Google is
>> pickingup a lack of headers as an issue.
>
>  acl google dstdom_regex -i google
>  http_access deny google
>
> but I suspect maybe you might not actually like the results of what
> you are asking for.

What's the best directive to use to make sure that google doesn't go  
through the proxy at all?
acl google dstdom_regex -i google
?




From Jason_Haar at trimble.com  Mon Jan 19 04:26:30 2015
From: Jason_Haar at trimble.com (Jason Haar)
Date: Mon, 19 Jan 2015 17:26:30 +1300
Subject: [squid-users] google always requesting captach through
 transparent proxy
In-Reply-To: <20150119033045.199712tcod5b9mqu@webmail-srv2.servage.net>
References: <54BB1387.7070800@trimble.com> <1421552897374.380d3f1c@Nodemailer>
 <54BB9223.50406@treenet.co.nz>
 <20150118143903.2020441id44pq553@webmail-srv2.servage.net>
 <54BBC7D5.8040508@treenet.co.nz>
 <20150119033045.199712tcod5b9mqu@webmail-srv2.servage.net>
Message-ID: <54BC8776.9060800@trimble.com>

On 19/01/15 16:30, squid at proxyplayer.co.uk wrote:
> Your systems have detected unusual traffic from your computer network.
> Some computers it presents a captcha, on others it just plain refuses
> to show search results.


Umm, your email address is "proxyplayer.co.uk". That isn't some kind of
anonymizing service is it? Google will force Captcha onto anyone using
their services that come from a known proxy network (such as Tor), so
could that be the reason?

This is really something you'd need to ask Google (I appreciate that is
nearly impossible). All I can say is that most of us squid users don't
see what you are seeing


-- 
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1



From makleking at ya.ru  Mon Jan 19 04:37:58 2015
From: makleking at ya.ru (=?koi8-r?B?7cnIwcnM?=)
Date: Mon, 19 Jan 2015 12:37:58 +0800
Subject: [squid-users] external_acl_type SPACE IN LOGIN
Message-ID: <10948011421642278@web23j.yandex.ru>

An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150119/3be82653/attachment.htm>

From vdoctor at neuf.fr  Mon Jan 19 08:23:37 2015
From: vdoctor at neuf.fr (Stakres)
Date: Mon, 19 Jan 2015 00:23:37 -0800 (PST)
Subject: [squid-users] Squid 2.7,
 3.4 and 3.5 Videos/Music/Images/Libraris/CDNs Booster
In-Reply-To: <1420470567538-4668941.post@n4.nabble.com>
References: <004501d01673$0f445150$2dccf3f0$@netstream.ps>
 <1418415837677-4668693.post@n4.nabble.com>
 <1418628416193-4668707.post@n4.nabble.com>
 <1418825003303-4668738.post@n4.nabble.com>
 <1419155198462-4668803.post@n4.nabble.com>
 <1420464046420-4668929.post@n4.nabble.com> <54AA918C.10300@gmail.com>
 <1420465642362-4668933.post@n4.nabble.com> <54AA979B.7060803@gmail.com>
 <1420470567538-4668941.post@n4.nabble.com>
Message-ID: <1421655817441-4669159.post@n4.nabble.com>

Hi All,

Advanced Caching Add-On for Linux Squid Proxy Cache v2.7, v3.4 and v3.5 with
Videos, Music, Images, Libraries and CDNs.

New  version 2.27 <https://sourceforge.net/projects/squidvideosbooster>  
including new websites - January 19th 2015.
More details on https://svb.unveiltech.com

Enjoy 

Bye Fred 



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-2-7-3-4-and-3-5-Videos-Music-Images-Libraries-CDNs-Booster-tp4668683p4669159.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From lameventanas at gmail.com  Mon Jan 19 09:05:25 2015
From: lameventanas at gmail.com (Alan)
Date: Mon, 19 Jan 2015 18:05:25 +0900
Subject: [squid-users] Compiling Squid without log messages
In-Reply-To: <54B79D7E.5090206@treenet.co.nz>
References: <CAFKaCCQkw4XBU+yf2V+NxS4dewd8v54=-Phk9EQSOUk6Wk7YVg@mail.gmail.com>
 <54B79D7E.5090206@treenet.co.nz>
Message-ID: <CAFKaCCSeK1dbMsrjV9NkDQ+TKLuNkKddN4aUA45JjRn7v2D18A@mail.gmail.com>

On Thu, Jan 15, 2015 at 7:59 PM, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 15/01/2015 11:00 p.m., Alan wrote:
>> Hello,
>>
>> I want to have a minimal Squid installation. So I compiled
>> disabling everything I don't need. The resulting /usr/sbin/squid is
>> 3.4 Mb.
>>
>> Since I don't need logging, I decided to remove that as well, but
>> its not easy to do with sed since sometimes log messages span
>> multiple lines.
>>
>> So I changed the definition for debugs() in Debug.h like this:
>>
>>
>> /* Debug stream */ +#ifdef NODEBUG +#define debugs(SECTION, LEVEL,
>> CONTENT) ((void)0) +#else #define debugs(SECTION, LEVEL, CONTENT)
>> \ do { \ if ((Debug::level = (LEVEL)) <= Debug::Levels[SECTION]) {
>> \ @@ -116,6 +119,7 @@ Debug::finishDebug(); \ } \ } while
>> (/*CONSTCOND*/ 0) +#endif
>>
>>
>> And compiled with -DNODEBUG. The resulting binary is 2.1 Mb, a 60%
>> size reduction!
>>
>> But it doesn't work properly, and since there is no log, its hard
>> to debug.
>>
>> A trace shows it accepts requests, makes them to the HTTP server,
>> but after that it closes the connection to the HTTP client.
>>
>> Any ideas?
>
> Well ... take a guess where to look :-P
>
> If you are disabling anything via manual alteration of the code
> instead of the ./configure --disable options (you mention using sed)
> then one of the things you *do* need is the debugs() logging.
>
> cache.log / debugs() is not just for debugging either. It is also for
> recording major/critical events that you as administrator really,
> really need to be made aware of.
>
>
>
> Though, on the diagnosis I suggest at least trying with a macro name
> other than "NODEBUG". For some reason that macro is used to disable
> the assertion handling.

Hi Amos,

It seems that there is an assert() that is setting something, instead
of just checking something.
I can reproduce the problem *without* redefining debugs(), just by
compiling with NODEBUG.
So now I can provide you a cache.log in case you think it would help.

And on the other hand, I get a fully functional Squid by using a
different macro name, like you suggested.

Regards,

Alan


From wmunny at mail.com  Mon Jan 19 09:36:18 2015
From: wmunny at mail.com (wmunny william)
Date: Mon, 19 Jan 2015 10:36:18 +0100
Subject: [squid-users] Squid 3.5.1 100% CPU
Message-ID: <trinity-95cb6039-612b-4292-8e23-e41b9af5ad2a-1421660177900@3capp-mailcom-lxa04>

Hello,

I'm trying to test Squid 3.5.1 configured with digest authentication, and with high load Squid eats 100% CPU 
I had no problem with 3.4 and the patch from your previous message ( http://www.mail-archive.com/squid-users at lists.squid-cache.org/msg00925.html )

The problem is gone with BASIC authentication, Maybe this patch is also needed for Squid 3.5.1 ? How I can apply it ?

Please advise, thank you

WM


From hack.back at hotmail.com  Mon Jan 19 09:45:49 2015
From: hack.back at hotmail.com (HackXBack)
Date: Mon, 19 Jan 2015 01:45:49 -0800 (PST)
Subject: [squid-users] BUG 3279: HTTP reply without Date
Message-ID: <1421660749199-4669162.post@n4.nabble.com>

upgrade 3.4.10 to 3.5.1
the i got in cache.log

2015/01/19 11:42:51 kid1| Could not parse headers from on disk object
2015/01/19 11:42:51 kid1| BUG 3279: HTTP reply without Date:
2015/01/19 11:42:51 kid1| StoreEntry->key: 3F1BFB2CD5FB823D1095CC84E254DA12
2015/01/19 11:42:51 kid1| StoreEntry->next: 0x3148dc18
2015/01/19 11:42:51 kid1| StoreEntry->mem_obj: 0x457cc2b0
2015/01/19 11:42:51 kid1| StoreEntry->timestamp: -1
2015/01/19 11:42:51 kid1| StoreEntry->lastref: 1421685771
2015/01/19 11:42:51 kid1| StoreEntry->expires: -1
2015/01/19 11:42:51 kid1| StoreEntry->lastmod: -1
2015/01/19 11:42:51 kid1| StoreEntry->swap_file_sz: 0
2015/01/19 11:42:51 kid1| StoreEntry->refcount: 1
2015/01/19 11:42:51 kid1| StoreEntry->flags: PRIVATE,FWD_HDR_WAIT,VALIDATED
2015/01/19 11:42:51 kid1| StoreEntry->swap_dirn: -1
2015/01/19 11:42:51 kid1| StoreEntry->swap_filen: -1
2015/01/19 11:42:51 kid1| StoreEntry->lock_count: 2
2015/01/19 11:42:51 kid1| StoreEntry->mem_status: 0
2015/01/19 11:42:51 kid1| StoreEntry->ping_status: 2
2015/01/19 11:42:51 kid1| StoreEntry->store_status: 1
2015/01/19 11:42:51 kid1| StoreEntry->swap_status: 0



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/BUG-3279-HTTP-reply-without-Date-tp4669162.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From squid3 at treenet.co.nz  Mon Jan 19 10:11:43 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 19 Jan 2015 23:11:43 +1300
Subject: [squid-users] Squid 3.5.1 100% CPU
In-Reply-To: <trinity-95cb6039-612b-4292-8e23-e41b9af5ad2a-1421660177900@3capp-mailcom-lxa04>
References: <trinity-95cb6039-612b-4292-8e23-e41b9af5ad2a-1421660177900@3capp-mailcom-lxa04>
Message-ID: <54BCD85F.3040001@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 19/01/2015 10:36 p.m., wmunny william wrote:
> Hello,
> 
> I'm trying to test Squid 3.5.1 configured with digest
> authentication, and with high load Squid eats 100% CPU I had no
> problem with 3.4 and the patch from your previous message (
> http://www.mail-archive.com/squid-users at lists.squid-cache.org/msg00925.html
> )
> 
> The problem is gone with BASIC authentication, Maybe this patch is
> also needed for Squid 3.5.1 ? How I can apply it ?

The fix did not quite make it into the release.

Please use the patch for bug 3997 at
<http://www.squid-cache.org/Versions/v3/3.5/changesets/>, or the
latest 3.5 snapshot bundle which has it included.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUvNheAAoJELJo5wb/XPRjvjQIAKespxNSf6DQC1HhExivks7/
K8hEpJpwqeaDkgHPvXDKuG4L2Bvxejy1JkRLqPEPtKy/NItiw998LXG86y32PxBJ
8Mg9EMrdFE6cISeuoecad09sxlopLCTnESBUUae6BM/J/VoPp2ADmKBMWk3msU28
aCqOsh9bU5Bq5Saw97nIoQC6T0PmsAkYefDsD3w1byJIp31YCw/OicWZGtwA/sA5
CjL0ZZynq8N0C8YpOzre8GlOm9M0PGcJgxdQbclTEjmtgUiK8cACmscDtQvfUinC
MDdnS5UWtAYnpT52zQTG2Pq2Y+8RstCDUTOKXx3O6ugQPks99ARpS1tP2b92RKg=
=8Aan
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Mon Jan 19 10:14:01 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 19 Jan 2015 23:14:01 +1300
Subject: [squid-users] Compiling Squid without log messages
In-Reply-To: <CAFKaCCSeK1dbMsrjV9NkDQ+TKLuNkKddN4aUA45JjRn7v2D18A@mail.gmail.com>
References: <CAFKaCCQkw4XBU+yf2V+NxS4dewd8v54=-Phk9EQSOUk6Wk7YVg@mail.gmail.com>	<54B79D7E.5090206@treenet.co.nz>
 <CAFKaCCSeK1dbMsrjV9NkDQ+TKLuNkKddN4aUA45JjRn7v2D18A@mail.gmail.com>
Message-ID: <54BCD8E9.9040608@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 19/01/2015 10:05 p.m., Alan wrote:
> Hi Amos,
> 
> It seems that there is an assert() that is setting something,
> instead of just checking something. I can reproduce the problem
> *without* redefining debugs(), just by compiling with NODEBUG. So
> now I can provide you a cache.log in case you think it would help.
> 
> And on the other hand, I get a fully functional Squid by using a 
> different macro name, like you suggested.
> 

Thank you for finding this. Although what version of Squid are you
talking about so I can track it down?

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUvNjpAAoJELJo5wb/XPRjnFAIAOC0oe57xp/vW1FvZmmIEtVo
scXLB5BZai0teqJmw3+XQQtFE4M8FdcWW0uySsXZ4EdKVZyVjji8oJ44+wJkJiFj
KgfAR66n4byozY3pCBp0h6/L0rSL1iznJc9T+Xr9wWl10xt5CG3RZfP7QmopDs1y
bCNqhx77fMvZotjGrtOn6KghpHldeOz9Z1WgcgkeV9zEmb37ZFj49zqlgd/ycnn4
M69htY29JgW6yJl/vrgWQX+pNPxO1/OBwZmY10nSkq02T4agJ2ubj4RwDoBQBtHL
nnXlE4grl4pX1cuNDt5T8EoLc4fNNhVZESoSiqqB03IQHFnCyFIDPBQRwmi6WRE=
=wZjY
-----END PGP SIGNATURE-----


From markus.rietzler at fv.nrw.de  Mon Jan 19 11:45:40 2015
From: markus.rietzler at fv.nrw.de (Rietzler, Markus (RZF, SG 324 / <RIETZLER_SOFTWARE>))
Date: Mon, 19 Jan 2015 11:45:40 +0000
Subject: [squid-users] Squid 3.5.1 100% CPU
In-Reply-To: <54BCD85F.3040001@treenet.co.nz>
References: <trinity-95cb6039-612b-4292-8e23-e41b9af5ad2a-1421660177900@3capp-mailcom-lxa04>
 <54BCD85F.3040001@treenet.co.nz>
Message-ID: <1FCF9DA5B29068478ECF15896F19F084014AF0C5E4@Y011008.bk.fin.local>

we just compiled and activated squid 3.5.1. everything works. no 100% peaks!

thanxs

markus

> -----Urspr?ngliche Nachricht-----
> Von: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] Im
> Auftrag von Amos Jeffries
> Gesendet: Montag, 19. Januar 2015 11:12
> An: squid-users at lists.squid-cache.org
> Betreff: Re: [squid-users] Squid 3.5.1 100% CPU
> 
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> On 19/01/2015 10:36 p.m., wmunny william wrote:
> > Hello,
> >
> > I'm trying to test Squid 3.5.1 configured with digest
> > authentication, and with high load Squid eats 100% CPU I had no
> > problem with 3.4 and the patch from your previous message (
> > http://www.mail-archive.com/squid-users at lists.squid-
> cache.org/msg00925.html
> > )
> >
> > The problem is gone with BASIC authentication, Maybe this patch is
> > also needed for Squid 3.5.1 ? How I can apply it ?
> 
> The fix did not quite make it into the release.
> 
> Please use the patch for bug 3997 at
> <http://www.squid-cache.org/Versions/v3/3.5/changesets/>, or the
> latest 3.5 snapshot bundle which has it included.
> 
> Amos
> 
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2.0.22 (MingW32)
> 
> iQEcBAEBAgAGBQJUvNheAAoJELJo5wb/XPRjvjQIAKespxNSf6DQC1HhExivks7/
> K8hEpJpwqeaDkgHPvXDKuG4L2Bvxejy1JkRLqPEPtKy/NItiw998LXG86y32PxBJ
> 8Mg9EMrdFE6cISeuoecad09sxlopLCTnESBUUae6BM/J/VoPp2ADmKBMWk3msU28
> aCqOsh9bU5Bq5Saw97nIoQC6T0PmsAkYefDsD3w1byJIp31YCw/OicWZGtwA/sA5
> CjL0ZZynq8N0C8YpOzre8GlOm9M0PGcJgxdQbclTEjmtgUiK8cACmscDtQvfUinC
> MDdnS5UWtAYnpT52zQTG2Pq2Y+8RstCDUTOKXx3O6ugQPks99ARpS1tP2b92RKg=
> =8Aan
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

From fredbmail at free.fr  Mon Jan 19 12:14:30 2015
From: fredbmail at free.fr (FredB)
Date: Mon, 19 Jan 2015 13:14:30 +0100 (CET)
Subject: [squid-users] Squid 3.5.1 100% CPU
In-Reply-To: <54BCD85F.3040001@treenet.co.nz>
Message-ID: <1891098264.293297423.1421669670129.JavaMail.root@zimbra4-e1.priv.proxad.net>


> > 
> > I'm trying to test Squid 3.5.1 configured with digest
> > authentication, and with high load Squid eats 100% CPU I had no
> > problem with 3.4 and the patch from your previous message (
> > http://www.mail-archive.com/squid-users at lists.squid-cache.org/msg00925.html
> > )
> > 
> > The problem is gone with BASIC authentication, Maybe this patch is
> > also needed for Squid 3.5.1 ? How I can apply it ?
> 
> The fix did not quite make it into the release.
> 
> Please use the patch for bug 3997 at
> <http://www.squid-cache.org/Versions/v3/3.5/changesets/>, or the
> latest 3.5 snapshot bundle which has it included.
> 


Hello all,

Unfortunately the problem still present with latest snapshot, there is a ldap request for each GET or CONNECT and with heavy load this is really problematic.
You can take a look at my bug rapport, there is a temporary solution for 3.5, but I guess it's better to stay with 3.4 with my patch (if you suffer from bug 4066 of course) for the moment.

----

Regards,

Fred

http://numsys.eu
http://e2guardian.org 


From squid3 at treenet.co.nz  Mon Jan 19 12:29:27 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 20 Jan 2015 01:29:27 +1300
Subject: [squid-users] Squid 3.5.1 install
In-Reply-To: <1421611610142-4669151.post@n4.nabble.com>
References: <682504C5-9325-4638-8603-5353C4CE71AC@gmail.com>
 <CA+Y8hcMcuEk1GrqtM3Cp4K_bZnHxfB8AzT_zVDkfh-BttYRcZg@mail.gmail.com>
 <1421611610142-4669151.post@n4.nabble.com>
Message-ID: <54BCF8A7.6080903@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 19/01/2015 9:06 a.m., mattatrmc wrote:
> hey Francessco,
> 
> I actually tried to troubleshoot the problem on my own while I was
> waiting to hear from other people.  I'm using OpenBSD 5.6, which I
> would assume would be one of the OS's trialled by the developers.
> 
> It turns out my mistake was with the --with-openssl switch I
> wasn't specifying the location which by default is different for my
> OS.
> 
> Thanks for getting back to me, I'll have to make sure to drink less
> coffee when I work in the future

We have wiki pages to help people with this type of problem:
http://wiki.squid-cache.org/KnowledgeBase/OpenBsd

if you let us all know what the issue and fix were that page can be
updated for others.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUvPilAAoJELJo5wb/XPRjXjwIAL1TARWyMzJNrcwMefDpALDS
mAxjEYCFsDL6SquOnf8753JzpWRa/AVZHwsyuqTbOkfopigptXCWOP5sPEHwu0wZ
PNUVqpA2m7WPXZxMalLl/qnRU4iNtqLbayD95O8Z9I0TCRHTfsSxPILSdYKeaxHA
my3XtCZ57/zuxxrJyr7oeKagledEtFi56Fa9FnuxBaVw5ylYGG0ZjYQsqVWQa83a
Kgo6arialu2rRUvIJxiTbRKMeQkrJtjbDZWi9Ve6az381S1fioQfkysfcYcTw1g0
1KYZUQ2965nlM+mcWNoV0fKH2xBvaRzHdPjX/iRPMe1k9VE2xtbR2Uns2mfBh4M=
=PUfd
-----END PGP SIGNATURE-----


From squid at proxyplayer.co.uk  Mon Jan 19 13:12:37 2015
From: squid at proxyplayer.co.uk (squid at proxyplayer.co.uk)
Date: Mon, 19 Jan 2015 13:12:37 +0000
Subject: [squid-users] google always requesting captach through
 transparent proxy
In-Reply-To: <54BC8776.9060800@trimble.com>
References: <54BB1387.7070800@trimble.com>
 <1421552897374.380d3f1c@Nodemailer> <54BB9223.50406@treenet.co.nz>
 <20150118143903.2020441id44pq553@webmail-srv2.servage.net>
 <54BBC7D5.8040508@treenet.co.nz>
 <20150119033045.199712tcod5b9mqu@webmail-srv2.servage.net>
 <54BC8776.9060800@trimble.com>
Message-ID: <20150119131237.15032ceufkcp2c3p@webmail-srv2.servage.net>

Quoting Jason Haar <Jason_Haar at trimble.com>:

> On 19/01/15 16:30, squid at proxyplayer.co.uk wrote:
>> Your systems have detected unusual traffic from your computer network.
>> Some computers it presents a captcha, on others it just plain refuses
>> to show search results.
>
>
> Umm, your email address is "proxyplayer.co.uk". That isn't some kind of
> anonymizing service is it? Google will force Captcha onto anyone using
> their services that come from a known proxy network (such as Tor), so
> could that be the reason?
>

I don't think that's the reason as with another server with 2.6 it  
works fine with Google.
It's only since the upgrade of squid so must be something in the config.



From odhiambo at gmail.com  Mon Jan 19 13:26:16 2015
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Mon, 19 Jan 2015 16:26:16 +0300
Subject: [squid-users] [squid-announce] Squid 3.5.1 is available
In-Reply-To: <54BC6A82.9070808@treenet.co.nz>
References: <54BB1387.7070800@trimble.com> <1421552897374.380d3f1c@Nodemailer>
 <54BB9223.50406@treenet.co.nz>
 <CAAdA2WP_WZDSMMO66NqPBJfajvg7PRhvs8waKoObX20c6QVwRA@mail.gmail.com>
 <54BC6A82.9070808@treenet.co.nz>
Message-ID: <CAAdA2WMxWnYhsusm=LwJ+QanNEePyzM+mc5ar8zTp-MD6yzffQ@mail.gmail.com>

I removed that MSNT from my configure options but I still get the error.

To be honest, I don't know what to do next.



On 19 January 2015 at 05:22, Amos Jeffries <squid3 at treenet.co.nz> wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 19/01/2015 10:03 a.m., Odhiambo Washington wrote:
> > When compiling, I get the following error:
> >
> > configure: error: Basic auth helper MSNT ... not found
> >
>
> - From the release announcement:
> "
>  * Basic authentication MSNT helper changes
> ...
>
> Further details can be found in the release notes
> "
>
> In particular
> <http://www.squid-cache.org/Versions/v3/3.5/RELEASENOTES.html#ss2.8>
>
> In short: the helper called "MSNT" is renamed and deprecated.
>
>
> > I have removed MSNT from my configure parameters, but still not
> > go...
>
> You need to wipe the build directory and re-run ./configure from a
> clean location after changing the helper parameter(s).
>
> Amos
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2.0.22 (MingW32)
>
> iQEcBAEBAgAGBQJUvGqCAAoJELJo5wb/XPRjrQAH/20LD7e1UjdkmGDo+pbVqZwH
> GIJRkPIAXuCjebRvtIcDl7s5NmVxS3iqMg4bfvn3RPH3/aUScjFIjsiDrhV5HEuh
> hDFkRzhG6ud8MBU3SNMtG7FljaRD9U4H4cNgOEmEpNbmIm7vOcHY9csoNXSBdYcS
> 0GXJugCz1yNVkuXtFnnOTMaFa0r5zuqRSgCCFA3CzcCDgcTSuQo/CF69JrgC6fg7
> zeJDQMVjIkwVNGNbY3hgFgkNrGJyTSxwbFSPYKLwzrZKpBh//LzIvOydAPT3p4F7
> Hi25TmtbAkbZNkR/EfCJKIWcBShMNgObHU9GXxvzjvsTwmdAiUiAgTDwtJ8p4ZI=
> =gZmB
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>



-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254733744121/+254722743223
"I can't hear you -- I'm using the scrambler."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150119/209f3db8/attachment.htm>

From yvoinov at gmail.com  Mon Jan 19 13:33:29 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 19 Jan 2015 19:33:29 +0600
Subject: [squid-users] google always requesting captach through
 transparent proxy
In-Reply-To: <20150119131237.15032ceufkcp2c3p@webmail-srv2.servage.net>
References: <54BB1387.7070800@trimble.com> <1421552897374.380d3f1c@Nodemailer>
 <54BB9223.50406@treenet.co.nz>
 <20150118143903.2020441id44pq553@webmail-srv2.servage.net>
 <54BBC7D5.8040508@treenet.co.nz>
 <20150119033045.199712tcod5b9mqu@webmail-srv2.servage.net>
 <54BC8776.9060800@trimble.com>
 <20150119131237.15032ceufkcp2c3p@webmail-srv2.servage.net>
Message-ID: <54BD07A9.8050204@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Jason,

How long these problems by Google?

Also, possible you use collapsing forwarding, or something like in your
Squid configuration?

May be, you usr HTTP headers manipulation, which can confusing Google?

Generally, show us squid.conf.

Moreover, what is your external IP? Is it can be blacklisted for any
reason. Did your check it?

To troubleshoot similar problem SA usually uses sufficiently large
checklist.

We have not enough data to telepathically guess your real problem. Based
on the above, we can make some guesses, no more.

WBR, Yuri

19.01.2015 19:12, squid at proxyplayer.co.uk ?????:
> Quoting Jason Haar <Jason_Haar at trimble.com>:
>
>> On 19/01/15 16:30, squid at proxyplayer.co.uk wrote:
>>> Your systems have detected unusual traffic from your computer network.
>>> Some computers it presents a captcha, on others it just plain refuses
>>> to show search results.
>>
>>
>> Umm, your email address is "proxyplayer.co.uk". That isn't some kind of
>> anonymizing service is it? Google will force Captcha onto anyone using
>> their services that come from a known proxy network (such as Tor), so
>> could that be the reason?
>>
>
> I don't think that's the reason as with another server with 2.6 it
works fine with Google.
> It's only since the upgrade of squid so must be something in the config.
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUvQepAAoJENNXIZxhPexGdwUH/A/JVUoqUMrPWpT7bUGglwUF
2TaUcvQX5vXDEghLoeO4rB0wqxaj5FiuSV7NJj15GiG22FooR7nXV5I5rlNi89jy
LGhs1ib6GWzlWe3T05zzKGT5vpnn6KFB2cLLgfwoh/Jo8x9ta9o3L+GnkvSIYN2U
bPYHNrJhmbS0XRk3lauTrb3ZZw6tI48r0ipDXniPZ07YZpb0263iZKZ+TmeufeFr
Jsgv60XSaKLqt6xUZjd2Aa5qUcHIxVdQs+XOoazMZn7AMGcCsyqh/lhtXBG3VKaJ
2r1bpu1iMkJufHIKAobLgAqM2kUdd0jFBb2S7U6QLZisCRyVD2QKBdYJ4ouogyE=
=Kraj
-----END PGP SIGNATURE-----




From eliezer at ngtech.co.il  Mon Jan 19 13:56:48 2015
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Mon, 19 Jan 2015 15:56:48 +0200
Subject: [squid-users] [squid-announce] Squid 3.5.1 is available
In-Reply-To: <CAAdA2WMxWnYhsusm=LwJ+QanNEePyzM+mc5ar8zTp-MD6yzffQ@mail.gmail.com>
References: <54BB1387.7070800@trimble.com> <1421552897374.380d3f1c@Nodemailer>
 <54BB9223.50406@treenet.co.nz>
 <CAAdA2WP_WZDSMMO66NqPBJfajvg7PRhvs8waKoObX20c6QVwRA@mail.gmail.com>
 <54BC6A82.9070808@treenet.co.nz>
 <CAAdA2WMxWnYhsusm=LwJ+QanNEePyzM+mc5ar8zTp-MD6yzffQ@mail.gmail.com>
Message-ID: <54BD0D20.7080005@ngtech.co.il>

On 19/01/2015 15:26, Odhiambo Washington wrote:
> I removed that MSNT from my configure options but I still get the error.
>
> To be honest, I don't know what to do next.
What configure options have you used? what OS?
Have you tried compiling squid only with "./configure" empty? no 
arguments at all?

Eliezer




From hack.back at hotmail.com  Mon Jan 19 13:56:51 2015
From: hack.back at hotmail.com (HackXBack)
Date: Mon, 19 Jan 2015 05:56:51 -0800 (PST)
Subject: [squid-users] [squid-announce] Squid 3.5.1 is available
In-Reply-To: <54BA1918.7020308@treenet.co.nz>
References: <54BA1918.7020308@treenet.co.nz>
Message-ID: <1421675811595-4669172.post@n4.nabble.com>

after upgrading to 3.5.1 i have bug

BUG 3279: HTTP reply without Date 

how to solve it ??



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/squid-announce-Squid-3-5-1-is-available-tp4669129p4669172.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From yvoinov at gmail.com  Mon Jan 19 14:12:03 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 19 Jan 2015 20:12:03 +0600
Subject: [squid-users] [squid-announce] Squid 3.5.1 is available
In-Reply-To: <1421675811595-4669172.post@n4.nabble.com>
References: <54BA1918.7020308@treenet.co.nz>
 <1421675811595-4669172.post@n4.nabble.com>
Message-ID: <54BD10B3.4040408@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
http://bugs.squid-cache.org/show_bug.cgi?id=3279

Bug looks open. What answer do you expect to get?


19.01.2015 19:56, HackXBack ?????:
> after upgrading to 3.5.1 i have bug
>
> BUG 3279: HTTP reply without Date
>
> how to solve it ??
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/squid-announce-Squid-3-5-1-is-available-tp4669129p4669172.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUvRCzAAoJENNXIZxhPexGwbkIAIQj3NwlwEye6x39lhEUX4kB
zeRHfTFfLb+qvM4GdHFb2vOkxVp4C2fANGNlZ/ctZ/Js13dJIm/KA14HTJiwQfMI
6PrzgbpmqtyUP51nK4+DoT8XoTSBLb1CjgZ7XDXUsXznnpjkGyMFcn6hNs1SJTh1
pb08cNZ92STNYzmA4hqicA/TtM0SovgpqRf55jQ6sRBrwYuzD8gnUqfv5qciXjm6
BSpnqiPazX9bEQYE5+cIJSmzELoAyuATO5z9lu8Zpen6ZbGwLJEI45vF4XVMFQbk
Z9Sk891FTjJ8vTbSxMjZ8Uy4kNVxMm90G88WFdfmy5oq8COXlm8UG79iCBK9p2Y=
=TcYi
-----END PGP SIGNATURE-----



From odhiambo at gmail.com  Mon Jan 19 14:13:11 2015
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Mon, 19 Jan 2015 17:13:11 +0300
Subject: [squid-users] [squid-announce] Squid 3.5.1 is available
In-Reply-To: <54BD0D20.7080005@ngtech.co.il>
References: <54BB1387.7070800@trimble.com> <1421552897374.380d3f1c@Nodemailer>
 <54BB9223.50406@treenet.co.nz>
 <CAAdA2WP_WZDSMMO66NqPBJfajvg7PRhvs8waKoObX20c6QVwRA@mail.gmail.com>
 <54BC6A82.9070808@treenet.co.nz>
 <CAAdA2WMxWnYhsusm=LwJ+QanNEePyzM+mc5ar8zTp-MD6yzffQ@mail.gmail.com>
 <54BD0D20.7080005@ngtech.co.il>
Message-ID: <CAAdA2WPg88u3i-D1mbcO1MJ6_a4a9Q0iOG0jMaxoJzTGTvTF1g@mail.gmail.com>

On 19 January 2015 at 16:56, Eliezer Croitoru <eliezer at ngtech.co.il> wrote:

> On 19/01/2015 15:26, Odhiambo Washington wrote:
>
>> I removed that MSNT from my configure options but I still get the error.
>>
>> To be honest, I don't know what to do next.
>>
> What configure options have you used? what OS?
> Have you tried compiling squid only with "./configure" empty? no arguments
> at all?
> <http://lists.squid-cache.org/listinfo/squid-users>
>

These ...on FreeBSD 9.3-RELEASE.

And to be honest, I actually don't need these auth modules...


./configure --prefix=/opt/squid35 \
        --enable-removal-policies="lru heap" \
        --disable-epoll \
        --enable-auth \
        --enable-auth-basic="DB NCSA PAM MSNT PAM POP3 SSPI" \
        --enable-external-acl-helpers="session unix_group file_userip" \
        --enable-auth-ntlm="smb_lm SSPI" \
        --enable-auth-negotiate="SSPI kerberos" \
        --with-pthreads \
        --enable-storeio="ufs diskd aufs" \
        --enable-delay-pools \
        --enable-snmp  \
        --with-openssl=/usr \
        --enable-forw-via-db \
        --enable-cache-digests \
        --enable-wccpv2 \
        --enable-follow-x-forwarded-for \
        --with-large-files \
        --enable-large-cache-files \
        --enable-error_default_language=English \
        --enable-esi \
        --enable-kqueue \
        --enable-icap-client \
        --enable-kill-parent-hack \
        --enable-ssl \
        --enable-leakfinder \
        --enable-ssl-crtd \
        --enable-url-rewrite-helpers \
        --enable-xmalloc-statistics \
        --enable-stacktraces \
        --enable-zph-qos \
        --enable-eui \
        --enable-pf-transparent \
        --enable-ipf-transparent



-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254733744121/+254722743223
"I can't hear you -- I'm using the scrambler."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150119/3be2e1f5/attachment.htm>

From hack.back at hotmail.com  Mon Jan 19 14:12:08 2015
From: hack.back at hotmail.com (HackXBack)
Date: Mon, 19 Jan 2015 06:12:08 -0800 (PST)
Subject: [squid-users] [squid-announce] Squid 3.5.1 is available
In-Reply-To: <54BA1918.7020308@treenet.co.nz>
References: <54BA1918.7020308@treenet.co.nz>
Message-ID: <1421676728406-4669175.post@n4.nabble.com>

i used this patch 
http://bugs.squid-cache.org/attachment.cgi?id=3044
from here 
http://bugs.squid-cache.org/show_bug.cgi?id=3279
but the bug still there !!




--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/squid-announce-Squid-3-5-1-is-available-tp4669129p4669175.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From hack.back at hotmail.com  Mon Jan 19 14:13:03 2015
From: hack.back at hotmail.com (HackXBack)
Date: Mon, 19 Jan 2015 06:13:03 -0800 (PST)
Subject: [squid-users] BUG 3279: HTTP reply without Date
In-Reply-To: <1421660749199-4669162.post@n4.nabble.com>
References: <1421660749199-4669162.post@n4.nabble.com>
Message-ID: <1421676783077-4669176.post@n4.nabble.com>

this patch didnt solve the problem 

http://bugs.squid-cache.org/show_bug.cgi?id=3279



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/BUG-3279-HTTP-reply-without-Date-tp4669162p4669176.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From hack.back at hotmail.com  Mon Jan 19 14:18:46 2015
From: hack.back at hotmail.com (HackXBack)
Date: Mon, 19 Jan 2015 06:18:46 -0800 (PST)
Subject: [squid-users] BUG 3279: HTTP reply without Date
In-Reply-To: <1421676783077-4669176.post@n4.nabble.com>
References: <1421660749199-4669162.post@n4.nabble.com>
 <1421676783077-4669176.post@n4.nabble.com>
Message-ID: <1421677126564-4669177.post@n4.nabble.com>

how it is stable version and cant start at all !! every start crash and keep
restarting automatically !!
this bug is not happen with me only it happen with every one i know he have
squid !!



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/BUG-3279-HTTP-reply-without-Date-tp4669162p4669177.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From yvoinov at gmail.com  Mon Jan 19 14:30:51 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 19 Jan 2015 20:30:51 +0600
Subject: [squid-users] BUG 3279: HTTP reply without Date
In-Reply-To: <1421676783077-4669176.post@n4.nabble.com>
References: <1421660749199-4669162.post@n4.nabble.com>
 <1421676783077-4669176.post@n4.nabble.com>
Message-ID: <54BD151B.8010609@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Write about it to Bugzilla, not here.

Did your read list description?

19.01.2015 20:13, HackXBack ?????:
> this patch didnt solve the problem
>
> http://bugs.squid-cache.org/show_bug.cgi?id=3279
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/BUG-3279-HTTP-reply-without-Date-tp4669162p4669176.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUvRUbAAoJENNXIZxhPexGjLUIAKXJ2Mdvxt4rjM8++ca9FVwi
Dk4WT7An7lAuyOM73Up52SvSdmDXB5iGpA0K4bEnzUbXzz9OXXyaDpygfC95s9A8
dvG4UZbs9Fx9h1XQ2kxzwUqzWNaEOBJHEE9BJLquiYcK8VmeWtyGH1Td9dVFgh4c
R8fDKtVUbVgfQWtVqphAcCyJFVXlDdZLC2lfVzLE0fKLunT9VNCEyW8qOyiC/y4A
0fPEbJEg8U+QeH74ujeS+RPph+fZpSmrWfhqfH83hHdIND2U5hXfeBNos3+qnzk2
WaUAWt82X6ADok9mex8x/sm4ve33Dbb9RFUkz4sfCHKmmoSrPbLXBJWxtdgp0N8=
=kmqS
-----END PGP SIGNATURE-----



From yvoinov at gmail.com  Mon Jan 19 14:32:13 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 19 Jan 2015 20:32:13 +0600
Subject: [squid-users] BUG 3279: HTTP reply without Date
In-Reply-To: <1421677126564-4669177.post@n4.nabble.com>
References: <1421660749199-4669162.post@n4.nabble.com>
 <1421676783077-4669176.post@n4.nabble.com>
 <1421677126564-4669177.post@n4.nabble.com>
Message-ID: <54BD156D.300@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Easier. Emotions do not help solve any problem.

19.01.2015 20:18, HackXBack ?????:
> how it is stable version and cant start at all !! every start crash and keep
> restarting automatically !!
> this bug is not happen with me only it happen with every one i know he
have
> squid !!
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/BUG-3279-HTTP-reply-without-Date-tp4669162p4669177.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUvRVsAAoJENNXIZxhPexGTZIH/jMmBp++Up+DDSN9vC7ovKtr
qNjl2koV6KU9PZLaqAhkDxvTIW56eVd5KlJB7BbzBffo5A9JrriqfiSJ4vBqYtf4
84yqEkizmZD6oOVB0E5S4pOM2UV+C2kR5sf/67FFjWSrTfTg/8kma+oKkofrYR+3
qucO5ZDiOHmmaevA+nuERMefHrJTEc9M9V1Zbc7IWeQY8RDf2U/a5bgqqtkMoMIt
bTRJdvCHXFHtZFx6954kZdBAh+IHtEdvcwOWr0vZ1/MraiwcIIufmmzrMVXhBGeF
OJkci3JT4/ubvOq0V3mWUQgJcF1gNgQ9kdZ5yaXNQOq45tBjSCjqylJhI+Fj2yQ=
=Nn1d
-----END PGP SIGNATURE-----



From hack.back at hotmail.com  Mon Jan 19 14:36:13 2015
From: hack.back at hotmail.com (HackXBack)
Date: Mon, 19 Jan 2015 06:36:13 -0800 (PST)
Subject: [squid-users] BUG 3279: HTTP reply without Date
In-Reply-To: <54BD156D.300@gmail.com>
References: <1421660749199-4669162.post@n4.nabble.com>
 <1421676783077-4669176.post@n4.nabble.com>
 <1421677126564-4669177.post@n4.nabble.com> <54BD156D.300@gmail.com>
Message-ID: <1421678173928-4669180.post@n4.nabble.com>

I think the solution is to go back to 3.4
Thanks 



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/BUG-3279-HTTP-reply-without-Date-tp4669162p4669180.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From yvoinov at gmail.com  Mon Jan 19 14:45:36 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 19 Jan 2015 20:45:36 +0600
Subject: [squid-users] BUG 3279: HTTP reply without Date
In-Reply-To: <1421678173928-4669180.post@n4.nabble.com>
References: <1421660749199-4669162.post@n4.nabble.com>
 <1421676783077-4669176.post@n4.nabble.com>
 <1421677126564-4669177.post@n4.nabble.com> <54BD156D.300@gmail.com>
 <1421678173928-4669180.post@n4.nabble.com>
Message-ID: <54BD1890.2070708@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
I think, now 3.5.1 is not ready for production use yet. Just for testing.

19.01.2015 20:36, HackXBack ?????:
> I think the solution is to go back to 3.4
> Thanks
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/BUG-3279-HTTP-reply-without-Date-tp4669162p4669180.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUvRiQAAoJENNXIZxhPexGWH4H/AyqwgGlfaTucmfpz+P57R17
ISOy1YCCEVIG1CvCBJun6L+FimCzNg7eKByFWP6HZ6bjQyelRZ7qoUbOSAZCDcjx
u1gHoFJ3KTqlQGwrNMcpRn3GGnxADQpbG9FUfLB719+xmtKx0SBnXbNrasOPAJKv
+LYvLV7+2AwphFln4vbK+mNQVJT0rxVYQ1+MrnajAWP9sOFmMc3ODD3jj+xN/lmn
koJ4AM2gqtoYqLLdzlN/4o9UxSqkU7AVyj2R0wtds1YPc8t8aPlABGYosxCDp5GD
LbS4vg3YKlfyROHsFJRan5Z1SKqO3PCEAcKG0WT/LJViH+QujC/bWWztMa1Skbo=
=AxdZ
-----END PGP SIGNATURE-----



From odhiambo at gmail.com  Mon Jan 19 14:49:36 2015
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Mon, 19 Jan 2015 17:49:36 +0300
Subject: [squid-users] Squid 3.4.11 crashing on FreeBSD 10 (64-bit)
Message-ID: <CAAdA2WMni5HVEveBHGaXx1YXRAbWAmbQUfXfOiM=oSrqc4VWAw@mail.gmail.com>

I have installed squid on FreeBSD and it's crashing with errors as seen
from http://pastebin.com/yC6YZ7Bg.

My squid.conf is seen at http://pastebin.com/hJpPXJ0K

I am using the Squid in a tranparent proxy mode with PF firewall.

Squid is installed from FreeBSD ports:

root at mail:/usr/local/etc/squid # squid -v
Squid Cache: Version 3.4.11
configure options:  '--with-default-user=squid' '--bindir=/usr/local/sbin'
'--sbindir=/usr/local/sbin' '--datadir=/usr/local/etc/squid' '--libexe
cdir=/usr/local/libexec/squid' '--localstatedir=/var'
'--sysconfdir=/usr/local/etc/squid' '--with-logdir=/var/log/squid'
'--with-pidfile=/var/run
/squid/squid.pid' '--with-swapdir=/var/squid/cache' '--enable-auth'
'--enable-build-info' '--enable-loadable-modules'
'--enable-removal-policies=
lru heap' '--disable-epoll' '--disable-linux-netfilter'
'--disable-linux-tproxy' '--disable-translation' '--disable-arch-native'
'--enable-eui' '
--enable-cache-digests' '--enable-delay-pools' '--disable-ecap'
'--disable-esi' '--enable-follow-x-forwarded-for' '--enable-htcp'
'--enable-icap-
client' '--enable-icmp' '--enable-ident-lookups' '--enable-ipv6'
'--enable-kqueue' '--with-large-files' '--enable-http-violations'
'--enable-snmp
' '--enable-ssl' '--enable-ssl-crtd' '--disable-stacktraces'
'--disable-ipf-transparent' '--disable-ipfw-transparent'
'--enable-pf-transparent' '
--with-nat-devpf' '--enable-forw-via-db' '--enable-wccp' '--enable-wccpv2'
'--enable-auth-basic=DB MSNT MSNT-multi-domain NCSA PAM POP3 RADIUS fa
ke getpwnam NIS' '--enable-auth-digest=file'
'--enable-external-acl-helpers=file_userip time_quota unix_group
SQL_session' '--enable-auth-negotia
te=kerberos wrapper' '--enable-auth-ntlm=fake smb_lm' '--enable-storeio=ufs
aufs diskd' '--enable-disk-io=AIO Blocking IpcIo Mmapped DiskThreads
DiskDaemon' '--enable-log-daemon-helpers=file'
'--enable-url-rewrite-helpers=fake' '--enable-storeid-rewrite-helpers=file'
'--with-openssl=/usr'
'--disable-optimizations' '--enable-debug-cbdata' '--prefix=/usr/local'
'--mandir=/usr/local/man' '--infodir=/usr/local/info/' '--build=amd64-por
tbld-freebsd10.1' 'build_alias=amd64-portbld-freebsd10.1' 'CC=clang'
'CFLAGS=-pipe -march=native  -I/usr/include -g -fstack-protector -fno-strict
-aliasing' 'LDFLAGS= -pthread -Wl,-rpath,/usr/lib:/usr/local/lib -L/usr/lib
-fstack-protector' 'LIBS=' 'CPPFLAGS=' 'CXX=clang++' 'CXXFLAGS=-pipe
-march=native -I/usr/include -g -fstack-protector -fno-strict-aliasing
 -Wno-unused-private-field' 'CPP=clang-cpp' --enable-ltdl-convenience


I appreciate any pointers.

-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254733744121/+254722743223
"I can't hear you -- I'm using the scrambler."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150119/c82cd3c4/attachment.htm>

From fredbmail at free.fr  Mon Jan 19 14:55:45 2015
From: fredbmail at free.fr (FredB)
Date: Mon, 19 Jan 2015 15:55:45 +0100 (CET)
Subject: [squid-users] Squid 3.5.1 100% CPU
In-Reply-To: <1891098264.293297423.1421669670129.JavaMail.root@zimbra4-e1.priv.proxad.net>
Message-ID: <802674590.293654842.1421679345981.JavaMail.root@zimbra4-e1.priv.proxad.net>



, but I guess it's better to stay with 3.4 with my patch (if
> you suffer from bug 4066 of course) for the moment.
> 
> ----

I'm speaking only about DIGEST identification, of course



From yvoinov at gmail.com  Mon Jan 19 14:55:46 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 19 Jan 2015 20:55:46 +0600
Subject: [squid-users] Squid 3.4.11 crashing on FreeBSD 10 (64-bit)
In-Reply-To: <CAAdA2WMni5HVEveBHGaXx1YXRAbWAmbQUfXfOiM=oSrqc4VWAw@mail.gmail.com>
References: <CAAdA2WMni5HVEveBHGaXx1YXRAbWAmbQUfXfOiM=oSrqc4VWAw@mail.gmail.com>
Message-ID: <54BD1AF2.4070003@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Your use CLang. This is the single point.

You can get any effects. Looks like this is not Squid problem. Just system.

19.01.2015 20:49, Odhiambo Washington ?????:
> I have installed squid on FreeBSD and it's crashing with errors as seen from
http://pastebin.com/yC6YZ7Bg.
>
> My squid.conf is seen at http://pastebin.com/hJpPXJ0K
>
> I am using the Squid in a tranparent proxy mode with PF firewall.
>
> Squid is installed from FreeBSD ports:
>
> root at mail:/usr/local/etc/squid # squid -v
> Squid Cache: Version 3.4.11
> configure options:  '--with-default-user=squid'
'--bindir=/usr/local/sbin' '--sbindir=/usr/local/sbin'
'--datadir=/usr/local/etc/squid' '--libexe
> cdir=/usr/local/libexec/squid' '--localstatedir=/var'
'--sysconfdir=/usr/local/etc/squid' '--with-logdir=/var/log/squid'
'--with-pidfile=/var/run
> /squid/squid.pid' '--with-swapdir=/var/squid/cache' '--enable-auth'
'--enable-build-info' '--enable-loadable-modules'
'--enable-removal-policies=
> lru heap' '--disable-epoll' '--disable-linux-netfilter'
'--disable-linux-tproxy' '--disable-translation' '--disable-arch-native'
'--enable-eui' '
> --enable-cache-digests' '--enable-delay-pools' '--disable-ecap'
'--disable-esi' '--enable-follow-x-forwarded-for' '--enable-htcp'
'--enable-icap-
> client' '--enable-icmp' '--enable-ident-lookups' '--enable-ipv6'
'--enable-kqueue' '--with-large-files' '--enable-http-violations'
'--enable-snmp
> ' '--enable-ssl' '--enable-ssl-crtd' '--disable-stacktraces'
'--disable-ipf-transparent' '--disable-ipfw-transparent'
'--enable-pf-transparent' '
> --with-nat-devpf' '--enable-forw-via-db' '--enable-wccp'
'--enable-wccpv2' '--enable-auth-basic=DB MSNT MSNT-multi-domain NCSA
PAM POP3 RADIUS fa
> ke getpwnam NIS' '--enable-auth-digest=file'
'--enable-external-acl-helpers=file_userip time_quota unix_group
SQL_session' '--enable-auth-negotia
> te=kerberos wrapper' '--enable-auth-ntlm=fake smb_lm'
'--enable-storeio=ufs aufs diskd' '--enable-disk-io=AIO Blocking IpcIo
Mmapped DiskThreads
> DiskDaemon' '--enable-log-daemon-helpers=file'
'--enable-url-rewrite-helpers=fake'
'--enable-storeid-rewrite-helpers=file' '--with-openssl=/usr'
> '--disable-optimizations' '--enable-debug-cbdata'
'--prefix=/usr/local' '--mandir=/usr/local/man'
'--infodir=/usr/local/info/' '--build=amd64-por
> tbld-freebsd10.1' 'build_alias=amd64-portbld-freebsd10.1' 'CC=clang'
'CFLAGS=-pipe -march=native  -I/usr/include -g -fstack-protector -fno-strict
> -aliasing' 'LDFLAGS= -pthread -Wl,-rpath,/usr/lib:/usr/local/lib
-L/usr/lib -fstack-protector' 'LIBS=' 'CPPFLAGS=' 'CXX=clang++'
'CXXFLAGS=-pipe
> -march=native -I/usr/include -g -fstack-protector
-fno-strict-aliasing  -Wno-unused-private-field' 'CPP=clang-cpp'
--enable-ltdl-convenience
>
>
> I appreciate any pointers.
>
> --
> Best regards,
> Odhiambo WASHINGTON,
> Nairobi,KE
> +254733744121/+254722743223
> "I can't hear you -- I'm using the scrambler."
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUvRrxAAoJENNXIZxhPexGDDMIAIodEIz3KZU7BJUDk6BYN9CT
9r/cGXQsY8JdTQS8wPrzJWCWa/0qzutaVjNIGBWpKmw8vzDaKkf+poKPXGD2u0Gl
TCzMCuJwALiNFDXTFyWtoBEnTiyAMKF60ZB6y6YQu5fk7sbOx3FS9dWxAj56ITPJ
QorcAARGURe4pSn5GrMWPrwS/dm2hxXGP0yIdrz7fQkN+pwC4lln/TKYYupcLHnt
ODnD/H5gYjXjbv78WbOg/yCc3nKUOgH3WONftMY+ouWZufy5jMkq40xSyy8CZZkF
CINMWy6zK2nwZX04gUuivGhCmQab23zRX4inWDGNoOHdz+PT+/BkCfkR/cUg5lc=
=UEnO
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150119/ca5b4434/attachment.htm>

From hack.back at hotmail.com  Mon Jan 19 14:53:20 2015
From: hack.back at hotmail.com (HackXBack)
Date: Mon, 19 Jan 2015 06:53:20 -0800 (PST)
Subject: [squid-users] BUG 3279: HTTP reply without Date
In-Reply-To: <1421660749199-4669162.post@n4.nabble.com>
References: <1421660749199-4669162.post@n4.nabble.com>
Message-ID: <1421679200468-4669184.post@n4.nabble.com>

after downgrade to 3.4.11 the problem still here !!
dont say i need to install fresh system ????????



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/BUG-3279-HTTP-reply-without-Date-tp4669162p4669184.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From fredbmail at free.fr  Mon Jan 19 14:59:07 2015
From: fredbmail at free.fr (FredB)
Date: Mon, 19 Jan 2015 15:59:07 +0100 (CET)
Subject: [squid-users] BUG 3279: HTTP reply without Date
In-Reply-To: <1421679200468-4669184.post@n4.nabble.com>
Message-ID: <70481285.293664240.1421679547599.JavaMail.root@zimbra4-e1.priv.proxad.net>





----- Mail original -----
> De: "HackXBack" <hack.back at hotmail.com>
> ?: squid-users at lists.squid-cache.org
> Envoy?: Lundi 19 Janvier 2015 15:53:20
> Objet: Re: [squid-users] BUG 3279: HTTP reply without Date
> 
> after downgrade to 3.4.11 the problem still here !!
> dont say i need to install fresh system ????????
> 
> 
> 


Format/remove your cache and retry after a Squid -z

----

Regards,

Fred

http://numsys.eu
http://e2guardian.org


From yvoinov at gmail.com  Mon Jan 19 15:10:37 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 19 Jan 2015 21:10:37 +0600
Subject: [squid-users] BUG 3279: HTTP reply without Date
In-Reply-To: <70481285.293664240.1421679547599.JavaMail.root@zimbra4-e1.priv.proxad.net>
References: <70481285.293664240.1421679547599.JavaMail.root@zimbra4-e1.priv.proxad.net>
Message-ID: <54BD1E6D.7030507@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Wow,

3.4.x and 3.5 has incompatible cache format???

19.01.2015 20:59, FredB ?????:
>
>
>
>
> ----- Mail original -----
>> De: "HackXBack" <hack.back at hotmail.com>
>> ?: squid-users at lists.squid-cache.org
>> Envoy?: Lundi 19 Janvier 2015 15:53:20
>> Objet: Re: [squid-users] BUG 3279: HTTP reply without Date
>>
>> after downgrade to 3.4.11 the problem still here !!
>> dont say i need to install fresh system ????????
>>
>>
>>
>
>
> Format/remove your cache and retry after a Squid -z
>
> ----
>
> Regards,
>
> Fred
>
> http://numsys.eu
> http://e2guardian.org
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUvR5tAAoJENNXIZxhPexG99sIAMt+/YW5i6yorVinQJC5QfkY
weQZzPoHUYdz5obKDxsxPX1Fl8HmROQ4mJe+uYj4ZpTsctxRccwruJOUf3Zz1pU0
luS1cvd4oa6XZIN4awWKVtWyxk3z6lE49uX0XpL3mHBJJNz21vTi217VNzjxBlgc
Xwo+XwRH5zOGlOCmpss1fw/VpEPcxDE/WLoir+Qf6zH7E+5+Mj56Fv0CImJN/4W5
mD4eZmruim287RgmS7eZXpgL8jN3lXCuJRhXE7FDsqFbWO8/zJ/jn2lq9E6LSor3
sB0WGyb8ZBdsdIxiCemqUV2aJkvvRPmneHij0TTpZxFXMXAnxHkmv+SgGyfPiiA=
=ZB+n
-----END PGP SIGNATURE-----



From fredbmail at free.fr  Mon Jan 19 15:14:04 2015
From: fredbmail at free.fr (FredB)
Date: Mon, 19 Jan 2015 16:14:04 +0100 (CET)
Subject: [squid-users] BUG 3279: HTTP reply without Date
In-Reply-To: <54BD1E6D.7030507@gmail.com>
Message-ID: <216789922.293694425.1421680444617.JavaMail.root@zimbra4-e1.priv.proxad.net>


> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>  
> Wow,
> 
> 3.4.x and 3.5 has incompatible cache format???
> 

No, I'm just thinking about cache corruption, this could explain that the problem still present with 3.4 returns  
It's just an idea.

----

Regards,

Fred

http://numsys.eu
http://e2guardian.org


From yvoinov at gmail.com  Mon Jan 19 15:15:08 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 19 Jan 2015 21:15:08 +0600
Subject: [squid-users] BUG 3279: HTTP reply without Date
In-Reply-To: <216789922.293694425.1421680444617.JavaMail.root@zimbra4-e1.priv.proxad.net>
References: <216789922.293694425.1421680444617.JavaMail.root@zimbra4-e1.priv.proxad.net>
Message-ID: <54BD1F7C.6090703@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Yep, agreed. It is possible.


19.01.2015 21:14, FredB ?????:
>
>> -----BEGIN PGP SIGNED MESSAGE-----
>> Hash: SHA1
>> 
>> Wow,
>>
>> 3.4.x and 3.5 has incompatible cache format???
>>
>
> No, I'm just thinking about cache corruption, this could explain that
the problem still present with 3.4 returns 
> It's just an idea.
>
> ----
>
> Regards,
>
> Fred
>
> http://numsys.eu
> http://e2guardian.org
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUvR98AAoJENNXIZxhPexGJ1AIAIpYdL2DvowAyNfIgo+Z63B3
t1h0Pwgv8SAYsHRPZ+Nc2F6LNlDBbIMH1GAsdShlboZWc3xTsZW+oBWpgInBklme
bqJQda2JKX3JdK80s7PQ52iq3xzo4pbYNvt2dSLk0hCl2ooXxFYEO4ITbw5jgy7b
WbiUDc5f4zwvlEFoMXgczM7/84VlOew5ekAaj9HT3Bo5lP0QI0cT1AsJBWNwDcCc
HTovkCEZ9sZa6vCj4XtxX7Tet6I8OtJhcONqFzat1RD4ke75VyT0FFajBM3iFueY
hVvYSEzyAA9Xedbw9F0CBVdIrcH9coQeMJVViEidJgoD1gwd244VX67poZFR1d4=
=GcLr
-----END PGP SIGNATURE-----



From odhiambo at gmail.com  Mon Jan 19 15:20:48 2015
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Mon, 19 Jan 2015 18:20:48 +0300
Subject: [squid-users] Squid 3.4.11 crashing on FreeBSD 10 (64-bit)
In-Reply-To: <54BD1AF2.4070003@gmail.com>
References: <CAAdA2WMni5HVEveBHGaXx1YXRAbWAmbQUfXfOiM=oSrqc4VWAw@mail.gmail.com>
 <54BD1AF2.4070003@gmail.com>
Message-ID: <CAAdA2WOxhvDBwCtg5qit_aj2G0GVjarJqBWC+nd_buRQ0yrBZw@mail.gmail.com>

On 19 January 2015 at 17:55, Yuri Voinov <yvoinov at gmail.com> wrote:

>
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Your use CLang. This is the single point.
>
> You can get any effects. Looks like this is not Squid problem. Just
> system.
>


Are you insinuating that Squid-3.x is not supposed to run on FreeBSD 10
because of the CLANG thing?

Do you have a little howto on how I can compile it using gcc (I have gcc49
installed) ?

This squid is running, disobeying my time-based ACLs, crashing as seen in
cache.log and ... just annoying but I need a proxy by all means! It kinda
puts me in the proverbial between a rock & hard place.


-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254733744121/+254722743223
"I can't hear you -- I'm using the scrambler."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150119/3d6bc07c/attachment.htm>

From squid3 at treenet.co.nz  Mon Jan 19 15:24:44 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 20 Jan 2015 04:24:44 +1300
Subject: [squid-users] BUG 3279: HTTP reply without Date
In-Reply-To: <1421678173928-4669180.post@n4.nabble.com>
References: <1421660749199-4669162.post@n4.nabble.com>
 <1421676783077-4669176.post@n4.nabble.com>
 <1421677126564-4669177.post@n4.nabble.com> <54BD156D.300@gmail.com>
 <1421678173928-4669180.post@n4.nabble.com>
Message-ID: <54BD21BC.30503@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 20/01/2015 3:36 a.m., HackXBack wrote:
> I think the solution is to go back to 3.4

If you note the "BUG 3279" is reported by people since 3.2 series. So
3.4 is also seeing it when built and used in the same way. It seems to
be most common on AUFS caches and FreeBSD 9.x using diskd. Made worse
if the upstream servers are HTTP/1.0 or Squid is dealing with cache
corruption from a previous crash.

NOTE: Bug 3279 is not a fatal bug since Squid-3.3, it *just* happens
to get logged alongside the bugs which are from fatal crashes.

Question is where did Squid get this HTTP Response with no Date:
header ? Date is a mandatory header in HTTP.


That also answers your somewhat angry question about how we/I can say
3.5 is stable ...

 For Squid the .1 means that all 3.5 related major/critical/blocker
severity bugs in the *new* code got fixed and *no* new 3.5 bugs at all
reported in that new code for the 14 days leading up to the release.
Fact is there are only 4 unresolved bugs so far known in the new 3.5
code and none of them are more than minor annoyances.

 Squid-3.5 technically passed those criteria 4 weeks ago, but I made
the call to wait on starting the final 14-day no-new-issues countdown
until Jan when I started seeing people were back from their holidays.


PS. see how I keep stressing _new_ in the criteria for stability? we
know Squid has bugs (hundreds of them, thousands even) in the old code
going back decades. The entire Squid-3.x lifecycle is so far one long
ongoing process of replacing that old buggy code with better tested
and more stable code.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUvSG7AAoJELJo5wb/XPRj2sAIAJyirH4KajHG1OqDmZK4NFRH
LQB1MuS4kw93UR7XgI1x5LmWo0YqOggwywE95qRgaXq296wJUz7jW09ilcOHKBBh
GxIDMZ3IA38N7lDPzReacKT9n3iAUKaPhS7xaTwbuMd1vAO9wTtPjyZSq1uARXE8
88giEzTTGsGhRbKqDAKnEuzuDEJoozhF99D5GeFPZpWydXReUnpxOyLNb9c9wtz9
6jkfqeQ7q/Kvmqq4/V+7R6w8s2QWw/xfdxIrGbilBGai2xA7UhdgjbcfrHsgStAO
apywdclHE0hx9+cQgQeCw1scR/4cKnw1+dJJ8dgj7NQU4wcgCV3Bdm2jDbTypQI=
=V26s
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Mon Jan 19 15:30:25 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 20 Jan 2015 04:30:25 +1300
Subject: [squid-users] BUG 3279: HTTP reply without Date
In-Reply-To: <54BD1F7C.6090703@gmail.com>
References: <216789922.293694425.1421680444617.JavaMail.root@zimbra4-e1.priv.proxad.net>
 <54BD1F7C.6090703@gmail.com>
Message-ID: <54BD2311.4030707@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 20/01/2015 4:15 a.m., Yuri Voinov wrote:
> 
> Yep, agreed. It is possible.
> 
> 

That is exactly his particular problem. "Bug 3279" messages are just
the warning that an invalid object was found very late in the process.
It gets replaced with an error and delivered to the cilent.

The crashes are something else. Possibly another side effect of the
same basic cause. Just being logged together seems to confuse people.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUvSMRAAoJELJo5wb/XPRjSFAIALVsXsaJvvGLBNZWybDcvX5k
M7zGSD0ZegU2+wYnZTzCzNK8AeJuuOdSRJKfbvUtwkSrzPz0wp1mf7YMkw1ZVDI/
mWpK8X40zS+3nfKX2bM6e0x8884y/cU89VX1lydDwMioVLAtxbFj9COe7r6Fg2+E
vUaLbxaolTgjo9NAh4yJc+GsRGAeQBmwSCq2QU0AOZYuNM7W6lBVv1J9iPhYQFM+
aE5iVwTb+8S/2Y+qX8ciOtmVdade+mJI6Cz7jtMOu1a9rcWNX/XR5qSxPIxy2Xeh
LpZEki6ERKINJ7b6Lwp5m/MpRjIo7UVoA3z0eHkYnfqsYqZkKy49aNE+DqJKX3Q=
=4ueS
-----END PGP SIGNATURE-----


From odhiambo at gmail.com  Mon Jan 19 15:48:43 2015
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Mon, 19 Jan 2015 18:48:43 +0300
Subject: [squid-users] [squid-announce] Squid 3.5.1 is available
In-Reply-To: <CAAdA2WPg88u3i-D1mbcO1MJ6_a4a9Q0iOG0jMaxoJzTGTvTF1g@mail.gmail.com>
References: <54BB1387.7070800@trimble.com> <1421552897374.380d3f1c@Nodemailer>
 <54BB9223.50406@treenet.co.nz>
 <CAAdA2WP_WZDSMMO66NqPBJfajvg7PRhvs8waKoObX20c6QVwRA@mail.gmail.com>
 <54BC6A82.9070808@treenet.co.nz>
 <CAAdA2WMxWnYhsusm=LwJ+QanNEePyzM+mc5ar8zTp-MD6yzffQ@mail.gmail.com>
 <54BD0D20.7080005@ngtech.co.il>
 <CAAdA2WPg88u3i-D1mbcO1MJ6_a4a9Q0iOG0jMaxoJzTGTvTF1g@mail.gmail.com>
Message-ID: <CAAdA2WOnF+jdzGVLw+k5e-DN2e-pmvKpHAZvjK6G0s1bNvchJg@mail.gmail.com>

On 19 January 2015 at 17:13, Odhiambo Washington <odhiambo at gmail.com> wrote:

>
>
> On 19 January 2015 at 16:56, Eliezer Croitoru <eliezer at ngtech.co.il>
> wrote:
>
>> On 19/01/2015 15:26, Odhiambo Washington wrote:
>>
>>> I removed that MSNT from my configure options but I still get the error.
>>>
>>> To be honest, I don't know what to do next.
>>>
>> What configure options have you used? what OS?
>> Have you tried compiling squid only with "./configure" empty? no
>> arguments at all?
>> <http://lists.squid-cache.org/listinfo/squid-users>
>>
>
> These ...on FreeBSD 9.3-RELEASE.
>
> And to be honest, I actually don't need these auth modules...
>
>
> ./configure --prefix=/opt/squid35 \
>         --enable-removal-policies="lru heap" \
>         --disable-epoll \
>         --enable-auth \
>         --enable-auth-basic="DB NCSA PAM MSNT PAM POP3 SSPI" \
>         --enable-external-acl-helpers="session unix_group file_userip" \
>         --enable-auth-ntlm="smb_lm SSPI" \
>         --enable-auth-negotiate="SSPI kerberos" \
>         --with-pthreads \
>         --enable-storeio="ufs diskd aufs" \
>         --enable-delay-pools \
>         --enable-snmp  \
>         --with-openssl=/usr \
>         --enable-forw-via-db \
>         --enable-cache-digests \
>         --enable-wccpv2 \
>         --enable-follow-x-forwarded-for \
>         --with-large-files \
>         --enable-large-cache-files \
>         --enable-error_default_language=English \
>         --enable-esi \
>         --enable-kqueue \
>         --enable-icap-client \
>         --enable-kill-parent-hack \
>         --enable-ssl \
>         --enable-leakfinder \
>         --enable-ssl-crtd \
>         --enable-url-rewrite-helpers \
>         --enable-xmalloc-statistics \
>         --enable-stacktraces \
>         --enable-zph-qos \
>         --enable-eui \
>         --enable-pf-transparent \
>         --enable-ipf-transparent
>
>
I need glasses, or maybe googles:)

I see all this time I was removing MSNT from the end of this line:

 --enable-auth-basic="DB NCSA PAM MSNT PAM POP3 SSPI" while

..while there is another one tucked in the in the middle.  I am sorry for
the noise!


However, what should I change this line to?

  --enable-auth-ntlm="smb_lm SSPI"

Or, assuming I still wanted MSNT, what should I have in my configure
options?

According to <
http://www.squid-cache.org/Versions/v3/3.5/RELEASENOTES.html#ss2.8>

the helper called "MSNT" is renamed and deprecated.

What is the name to include in

 --enable-auth-ntlm="........"



-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254733744121/+254722743223
"I can't hear you -- I'm using the scrambler."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150119/0804dad1/attachment.htm>

From squid3 at treenet.co.nz  Mon Jan 19 15:54:54 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 20 Jan 2015 04:54:54 +1300
Subject: [squid-users] Squid 3.5.1 100% CPU
In-Reply-To: <802674590.293654842.1421679345981.JavaMail.root@zimbra4-e1.priv.proxad.net>
References: <802674590.293654842.1421679345981.JavaMail.root@zimbra4-e1.priv.proxad.net>
Message-ID: <54BD28CE.3000300@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 20/01/2015 3:55 a.m., FredB wrote:
> 
> 
> , but I guess it's better to stay with 3.4 with my patch (if
>> you suffer from bug 4066 of course) for the moment.
>> 
>> ----
> 
> I'm speaking only about DIGEST identification, of course
> 

Aye sorry I got my mail threads a bit mixed up there.

Digest is helped, but nowhere near fixed by that bug 3997 fix.


PS. FredB can you try to catch me in a day or two on IRC again to go
over your Digest patches? I decided to go with them, but had something
to query first (cant recall rright now, maybe by the time we meet up).

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUvSjNAAoJELJo5wb/XPRj6rsIAJjBpETr5dscPnPwATuFUgBl
K7XWTWXGSgGhurNKY2UxY1afB1PbKMgoWrHIysNzI1bXWz54hPF5uE1Yo2e6mPmb
qOIhksf0TqJU+/O9POCIa6iQ5Xt12f4k227d9Ty3RRGFIYSCaUx/bhDSMXU6+Buh
nyEX6uMl/CWHbSaTBh9gZQjS68VAOI3jpFRsUNesPAJowLVnBfrCeN9uh5OkPdvE
gmJGpgSp00iB0YW/h2MKYVGg8HwdN1/D7hlfXfpoX+19WPVO5jieUP9GNDrH+pM3
dFHEjLUuzZbZsbOnCuVZYf9y12oDyakeNvHg/oeYHfe/KCA0+KqeEvHFtT9VqAc=
=4Ex0
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Mon Jan 19 16:11:29 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 20 Jan 2015 05:11:29 +1300
Subject: [squid-users] Squid 3.4.11 crashing on FreeBSD 10 (64-bit)
In-Reply-To: <CAAdA2WOxhvDBwCtg5qit_aj2G0GVjarJqBWC+nd_buRQ0yrBZw@mail.gmail.com>
References: <CAAdA2WMni5HVEveBHGaXx1YXRAbWAmbQUfXfOiM=oSrqc4VWAw@mail.gmail.com>
 <54BD1AF2.4070003@gmail.com>
 <CAAdA2WOxhvDBwCtg5qit_aj2G0GVjarJqBWC+nd_buRQ0yrBZw@mail.gmail.com>
Message-ID: <54BD2CB1.5040206@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 20/01/2015 4:20 a.m., Odhiambo Washington wrote:
> On 19 January 2015 at 17:55, Yuri Voinov wrote:
> 
>> Your use CLang. This is the single point.
>> 
>> You can get any effects. Looks like this is not Squid problem.
>> Just system.
>> 
> 
> 
> Are you insinuating that Squid-3.x is not supposed to run on
> FreeBSD 10 because of the CLANG thing?
> 

We build test Squid on Clang for FreeBSD 10 (no longer GCC). So it
should build and run fine. (Though our FreeBSD 10 tests are failing on
man(8) page creation recently).

Your build parameter 'CPP=clang-cpp' seems unusual. We do not use/need
that for the integration testing builds. Just CC=clang CXX=clang++.
The toolchain naturally takes care of the rest.

Only the FreeBSD 9.x have clang build issues from the GCC->clang
transitional bugs coming at it from all sides (kernel, compiler, and
Squid).


> Do you have a little howto on how I can compile it using gcc (I
> have gcc49 installed) ?

At the simplest:

 mkdir _build && \
 cd _build && \
 ../configure && \
 make install

The squid default paths etc were all designed for FreeBSD environment.

> 
> This squid is running, disobeying my time-based ACLs, crashing as
> seen in cache.log and ... just annoying but I need a proxy by all
> means! It kinda puts me in the proverbial between a rock & hard
> place.
> 


If you are using diskd cache_dir on FreeBSD 10 there are known crashes
from that in 9/10. Until that is figured out shifting to ufs or aufs
is best.


Since it is a crash, backtrace is critical to figuring out what is
actually going on.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUvSywAAoJELJo5wb/XPRjXzcIALlLN2vv/Ev+l0fibkRwDpab
m2RWtxzuwNJ958PO92akm4kkJN/0eZojl1lP7Tp8YPVzuIvcTKQ8z+LfhmV7f6Tp
/1KA9vqXE+QtZCbPTl1TRv0ar7bwtMGvD12fs8eeApqshesbm9m/mo7eAHNTqMfE
gTTJ5IjsCGimxK5b+zOrseOm3Syf1o757E7/3XB26gRhorzdj8Zjvzj7mt41jR6x
PlyJybHp/RTt1meZSQQIMUvXdEAOPSAb1kY+R7KY5jqpFdtN3yijDc25lWdpjCub
aY2sv+lf5YNeOXlXO/dBicQRQJ0W9H2V4X5lc/qit3YTuIdJx+DHS8qknBzBqv4=
=eiso
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Mon Jan 19 16:19:55 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 20 Jan 2015 05:19:55 +1300
Subject: [squid-users] [squid-announce] Squid 3.5.1 is available
In-Reply-To: <CAAdA2WOnF+jdzGVLw+k5e-DN2e-pmvKpHAZvjK6G0s1bNvchJg@mail.gmail.com>
References: <54BB1387.7070800@trimble.com> <1421552897374.380d3f1c@Nodemailer>
 <54BB9223.50406@treenet.co.nz>
 <CAAdA2WP_WZDSMMO66NqPBJfajvg7PRhvs8waKoObX20c6QVwRA@mail.gmail.com>
 <54BC6A82.9070808@treenet.co.nz>
 <CAAdA2WMxWnYhsusm=LwJ+QanNEePyzM+mc5ar8zTp-MD6yzffQ@mail.gmail.com>
 <54BD0D20.7080005@ngtech.co.il>
 <CAAdA2WPg88u3i-D1mbcO1MJ6_a4a9Q0iOG0jMaxoJzTGTvTF1g@mail.gmail.com>
 <CAAdA2WOnF+jdzGVLw+k5e-DN2e-pmvKpHAZvjK6G0s1bNvchJg@mail.gmail.com>
Message-ID: <54BD2EAB.7040801@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 20/01/2015 4:48 a.m., Odhiambo Washington wrote:
> On 19 January 2015 at 17:13, Odhiambo Washington
> <odhiambo at gmail.com> wrote:
> 
>> 
>> 
>> On 19 January 2015 at 16:56, Eliezer Croitoru
>> <eliezer at ngtech.co.il> wrote:
>> 
>>> On 19/01/2015 15:26, Odhiambo Washington wrote:
>>> 
>>>> I removed that MSNT from my configure options but I still get
>>>> the error.
>>>> 
>>>> To be honest, I don't know what to do next.
>>>> 
>>> What configure options have you used? what OS? Have you tried
>>> compiling squid only with "./configure" empty? no arguments at
>>> all? <http://lists.squid-cache.org/listinfo/squid-users>
>>> 
>> 
>> These ...on FreeBSD 9.3-RELEASE.
>> 
>> And to be honest, I actually don't need these auth modules...
>> 
>> 
>> ./configure --prefix=/opt/squid35 \ 
>> --enable-removal-policies="lru heap" \ --disable-epoll \ 
>> --enable-auth \

- --enable-auth is unnecessary. This directive exists for use of its
- --disable form.

>> --enable-auth-basic="DB NCSA PAM MSNT PAM POP3 SSPI" \ 
>> --enable-external-acl-helpers="session unix_group file_userip" \ 
>> --enable-auth-ntlm="smb_lm SSPI" \ --enable-auth-negotiate="SSPI
>> kerberos" \ --with-pthreads \ --enable-storeio="ufs diskd aufs"
>> \ --enable-delay-pools \ --enable-snmp  \ --with-openssl=/usr \ 
>> --enable-forw-via-db \ --enable-cache-digests \ --enable-wccpv2
>> \ --enable-follow-x-forwarded-for \ --with-large-files \ 
>> --enable-large-cache-files \ 
>> --enable-error_default_language=English \

- --enable-error_default_language=English

directive has never existed. "error_default_language" is a squid.conf
option and its default value is always "en" (ISO code for English
language).


>> --enable-esi \ --enable-kqueue \ --enable-icap-client \ 
>> --enable-kill-parent-hack \ --enable-ssl \ --enable-leakfinder \ 
>> --enable-ssl-crtd \ --enable-url-rewrite-helpers \ 
>> --enable-xmalloc-statistics \ --enable-stacktraces \ 
>> --enable-zph-qos \ --enable-eui \ --enable-pf-transparent \ 
>> --enable-ipf-transparent
>> 
>> 
> I need glasses, or maybe googles:)
> 
> I see all this time I was removing MSNT from the end of this line:
> 
> --enable-auth-basic="DB NCSA PAM MSNT PAM POP3 SSPI" while
> 
> ..while there is another one tucked in the in the middle.  I am
> sorry for the noise!
> 
> 
> However, what should I change this line to?
> 
> --enable-auth-ntlm="smb_lm SSPI"
> 

Thats no change since 3.4. This directive is unrelated to the *Basic*
auth helper change.


> Or, assuming I still wanted MSNT, what should I have in my
> configure options?

  --enable-auth-basic="DB NCSA PAM POP3 SSPI SMB_LM"

I see now that it is different casing to the NTLM one. Sorry.


Though we have deprecated both of the SMB LM helpers. So removing from
both the Basic and NTLM helper list now if you dont need it would be
good for future builds.


Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUvS6rAAoJELJo5wb/XPRjGbkIAMtHn6vGzRVgNgXrNN2amltC
iSScRmXH6+i72w8QOxhoDh+cJWYSu8UJqL1REV3HfsWJTRx6eRj100B80U7d7cRC
RSz2sPNE4raooTCskgvdcKOHMVYKRmbBT+O4hMpTIS8+WlwlS22M5yfexVudW3QV
WUblYWQ9bA2p+za7H7rIAeK3ORJwugYsAprhq9c+Mk7Ml4EOHRudsCv91LW5DbVS
jmnAlapzgm7keiz8BCjggLFFB2AFfi/wkgqx66oIb1jmRV7ZjiU5SsGctwfNYgRp
EIB8tDYYojQ80P908eBJZT9yzYOF50NYuSrs4VYn9dcVeBOB1SHU/ByY8KBKbV8=
=4W7y
-----END PGP SIGNATURE-----


From fredbmail at free.fr  Mon Jan 19 16:25:15 2015
From: fredbmail at free.fr (FredB)
Date: Mon, 19 Jan 2015 17:25:15 +0100 (CET)
Subject: [squid-users] Squid 3.5.1 100% CPU
In-Reply-To: <54BD28CE.3000300@treenet.co.nz>
Message-ID: <2040572485.293860639.1421684715656.JavaMail.root@zimbra4-e1.priv.proxad.net>


> Aye sorry I got my mail threads a bit mixed up there.
> 
> Digest is helped, but nowhere near fixed by that bug 3997 fix.
> 
> 
> PS. FredB can you try to catch me in a day or two on IRC again to go
> over your Digest patches? I decided to go with them, but had
> something
> to query first (cant recall rright now, maybe by the time we meet
> up).
> 
> Amos
> 


Ok I will try soon - this week I hope - , FYI I posted some useful (I guess ...) informations in bug report.
There are two separate bugs, only one concern the 100 % CPU http://bugs.squid-cache.org/show_bug.cgi?id=4066#c9 and only with 3.5

About the original problem, you send to me a question http://bugs.squid-cache.org/show_bug.cgi?id=4066#c6 and I answered here http://bugs.squid-cache.org/show_bug.cgi?id=4066#c7
I guess the first problem can be resolved now, and for the second I found where the problem is (Comment 11) it seems not really complex.  


----

Regards,

Fred

http://numsys.eu
http://e2guardian.org


From odhiambo at gmail.com  Mon Jan 19 16:51:50 2015
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Mon, 19 Jan 2015 19:51:50 +0300
Subject: [squid-users] Squid 3.4.11 crashing on FreeBSD 10 (64-bit)
In-Reply-To: <54BD2CB1.5040206@treenet.co.nz>
References: <CAAdA2WMni5HVEveBHGaXx1YXRAbWAmbQUfXfOiM=oSrqc4VWAw@mail.gmail.com>
 <54BD1AF2.4070003@gmail.com>
 <CAAdA2WOxhvDBwCtg5qit_aj2G0GVjarJqBWC+nd_buRQ0yrBZw@mail.gmail.com>
 <54BD2CB1.5040206@treenet.co.nz>
Message-ID: <CAAdA2WPceDYjSs3hU2XfGvK06TsRzGPgdsKmYRDdM=Bw4BCphg@mail.gmail.com>

On 19 January 2015 at 19:11, Amos Jeffries <squid3 at treenet.co.nz> wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 20/01/2015 4:20 a.m., Odhiambo Washington wrote:
> > On 19 January 2015 at 17:55, Yuri Voinov wrote:
> >
> >> Your use CLang. This is the single point.
> >>
> >> You can get any effects. Looks like this is not Squid problem.
> >> Just system.
> >>
> >
> >
> > Are you insinuating that Squid-3.x is not supposed to run on
> > FreeBSD 10 because of the CLANG thing?
> >
>
> We build test Squid on Clang for FreeBSD 10 (no longer GCC). So it
> should build and run fine. (Though our FreeBSD 10 tests are failing on
> man(8) page creation recently).
>

In the FreeBSD 10 ports, there is still 3.4.10, but I changed the version
to 3.4.11 and it did not grok!


>
> Your build parameter 'CPP=clang-cpp' seems unusual. We do not use/need
> that for the integration testing builds. Just CC=clang CXX=clang++.
> The toolchain naturally takes care of the rest.
>

A relic I forgot in my make.conf while struggling with FreeBSD 10. Thanks
for catching that.

I removed it and recompiled:

root at mail:/usr/ports/www/squid # squid -v
Squid Cache: Version 3.4.11
configure options:  '--with-default-user=squid' '--bindir=/usr/local/sbin'
'--sbindir=/usr/local/sbin' '--datadir=/usr/local/etc/squid'
'--libexecdir=/usr/local/libexec/squid' '--localstatedir=/var'
'--sysconfdir=/usr/local/etc/squid' '--with-logdir=/var/log/squid'
'--with-pidfile=/var/run/squid/squid.pid' '--with-swapdir=/var/squid/cache'
'--enable-auth' '--enable-build-info' '--enable-loadable-modules'
'--enable-removal-policies=lru heap' '--disable-epoll'
'--disable-linux-netfilter' '--disable-linux-tproxy'
'--disable-translation' '--disable-arch-native' '--enable-eui' '
--enable-cache-digests' '--enable-delay-pools' '--disable-ecap'
'--disable-esi' '--enable-follow-x-forwarded-for' '--enable-htcp'
'--enable-icap-client' '--enable-icmp' '--enable-ident-lookups'
'--enable-ipv6' '--enable-kqueue' '--with-large-files'
'--enable-http-violations' '--enable-snmp ' '--enable-ssl'
'--enable-ssl-crtd' '--disable-stacktraces' '--disable-ipf-transparent'
'--disable-ipfw-transparent' '--enable-pf-transparent' ' --with-nat-devpf'
'--enable-forw-via-db' '--enable-wccp' '--enable-wccpv2'
'--enable-auth-basic=DB MSNT MSNT-multi-domain NCSA PAM POP3 RADIUS fake
getpwnam NIS' '--enable-auth-digest=file'
'--enable-external-acl-helpers=file_userip time_quota unix_group
SQL_session' '--enable-auth-negotia
te=kerberos wrapper' '--enable-auth-ntlm=fake smb_lm' '--enable-storeio=ufs
aufs diskd' '--enable-disk-io=AIO Blocking IpcIo Mmapped DiskThreads
DiskDaemon' '--enable-log-daemon-helpers=file'
'--enable-url-rewrite-helpers=fake' '--enable-storeid-rewrite-helpers=file'
'--with-openssl=/usr' '--disable-optimizations' '--enable-debug-cbdata'
'--prefix=/usr/local' '--mandir=/usr/local/man'
'--infodir=/usr/local/info/' '--build=amd64-portbld-freebsd10.1'
'build_alias=amd64-portbld-freebsd10.1' 'CC=cc' 'CFLAGS=-pipe -march=native
 -I/usr/include -g -fstack-protector -fno-strict-aliasing' 'LDFLAGS=
-pthread -Wl,-rpath,/usr/lib:/usr/local/lib -L/usr/lib -fstack-protector'
'LIBS=' 'CPPFLAGS=' 'CXX=c++' 'CXXFLAGS=-pipe -march=native -I/usr/include
-g -fstack-protector -fno-strict-aliasing  -Wno-unused-private-field'
'CPP=cpp' --enable-ltdl-convenience

However this has not changed the continuous crashing I am seeing cache.log




>
> Only the FreeBSD 9.x have clang build issues from the GCC->clang
> transitional bugs coming at it from all sides (kernel, compiler, and
> Squid).


>
> > Do you have a little howto on how I can compile it using gcc (I
> > have gcc49 installed) ?
>
> At the simplest:
>
>  mkdir _build && \
>  cd _build && \
>  ../configure && \
>  make install
>
> The squid default paths etc were all designed for FreeBSD environment.
>

That has failed to work for me on this FreeBSD 10.


> >
> > This squid is running, disobeying my time-based ACLs, crashing as
> > seen in cache.log and ... just annoying but I need a proxy by all
> > means! It kinda puts me in the proverbial between a rock & hard
> > place.
> >
>
>
> If you are using diskd cache_dir on FreeBSD 10 there are known crashes
> from that in 9/10. Until that is figured out shifting to ufs or aufs
> is best.
>


I use aufs.



>
> Since it is a crash, backtrace is critical to figuring out what is
> actually going on.
>

Does the following help?

Script started on Mon Jan 19 19:49:30 2015
root at mail:/usr/local/squid/logs # gdb /usr/local/sbin/squid squid.core
GNU gdb 6.1.1 [FreeBSD]
Copyright 2004 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "amd64-marcel-freebsd"...
Core was generated by `squid'.
Program terminated with signal 11, Segmentation fault.
Reading symbols from /usr/lib/librt.so.1...done.
Loaded symbols for /usr/lib/librt.so.1
Reading symbols from /usr/local/lib/libnettle.so.4...done.
Loaded symbols for /usr/local/lib/libnettle.so.4
Reading symbols from /usr/lib/libssl.so.7...done.
Loaded symbols for /usr/lib/libssl.so.7
Reading symbols from /usr/lib/libgssapi.so.10...done.
Loaded symbols for /usr/lib/libgssapi.so.10
Reading symbols from /usr/lib/libgssapi_krb5.so.10...done.
Loaded symbols for /usr/lib/libgssapi_krb5.so.10
Reading symbols from /usr/lib/libheimntlm.so.11...done.
Loaded symbols for /usr/lib/libheimntlm.so.11
Reading symbols from /usr/lib/libkrb5.so.11...done.
Loaded symbols for /usr/lib/libkrb5.so.11
Reading symbols from /usr/lib/libhx509.so.11...done.
Loaded symbols for /usr/lib/libhx509.so.11
Reading symbols from /usr/lib/libcom_err.so.5...done.
Loaded symbols for /usr/lib/libcom_err.so.5
Reading symbols from /lib/libcrypto.so.7...done.
Loaded symbols for /lib/libcrypto.so.7
Reading symbols from /usr/lib/libasn1.so.11...done.
Loaded symbols for /usr/lib/libasn1.so.11
Reading symbols from /usr/lib/libwind.so.11...done.
Loaded symbols for /usr/lib/libwind.so.11
Reading symbols from /usr/lib/libheimbase.so.11...done.
Loaded symbols for /usr/lib/libheimbase.so.11
Reading symbols from /usr/lib/libroken.so.11...done.
Loaded symbols for /usr/lib/libroken.so.11
Reading symbols from /lib/libcrypt.so.5...done.
Loaded symbols for /lib/libcrypt.so.5
Reading symbols from /lib/libm.so.5...done.
Loaded symbols for /lib/libm.so.5
Reading symbols from /usr/lib/libc++.so.1...done.
Loaded symbols for /usr/lib/libc++.so.1
Reading symbols from /lib/libcxxrt.so.1...done.
Loaded symbols for /lib/libcxxrt.so.1
Reading symbols from /lib/libgcc_s.so.1...done.
Loaded symbols for /lib/libgcc_s.so.1
Reading symbols from /lib/libthr.so.3...done.
Loaded symbols for /lib/libthr.so.3
Reading symbols from /lib/libc.so.7...done.
Loaded symbols for /lib/libc.so.7
Reading symbols from /usr/lib/private/libheimipcc.so.11...done.
Loaded symbols for /usr/lib/private/libheimipcc.so.11
Reading symbols from /libexec/ld-elf.so.1...done.
Loaded symbols for /libexec/ld-elf.so.1
#0  0x0000000803a30469 in swapcontext () from /lib/libthr.so.3
[New Thread 804ff5000 (LWP 100336/squid)]
[New Thread 804ff4c00 (LWP 100335/squid)]
[New Thread 804ff4800 (LWP 100334/squid)]
[New Thread 804ff4400 (LWP 100333/squid)]
[New Thread 804ff4000 (LWP 100332/squid)]
[New Thread 804ff3c00 (LWP 100331/squid)]
[New Thread 804ff3800 (LWP 100330/squid)]
[New Thread 804ff3400 (LWP 100329/squid)]
[New Thread 804ff3000 (LWP 100328/squid)]
[New Thread 804ff2c00 (LWP 100327/squid)]
[New Thread 804ff2800 (LWP 100326/squid)]
[New Thread 804ff2400 (LWP 100325/squid)]
[New Thread 804ff2000 (LWP 100324/squid)]
[New Thread 804ff1c00 (LWP 100323/squid)]
[New Thread 804ff1800 (LWP 100322/squid)]
[New Thread 804ff1400 (LWP 100321/squid)]
[New Thread 804806400 (LWP 100230/squid)]
(gdb) bt
#0  0x0000000803a30469 in swapcontext () from /lib/libthr.so.3
#1  0x0000000803a30062 in sigaction () from /lib/libthr.so.3
#2  <signal handler called>
#3  0x0000000803d6b04a in kevent () from /lib/libc.so.7
#4  0x000000000086335c in Comm::DoSelect (msec=981) at ModKqueue.cc:264
#5  0x00000000007eca54 in CommSelectEngine::checkEvents
(this=0x7fffffffe970, timeout=981) at comm.cc:2058
#6  0x000000000060795a in EventLoop::checkEngine (this=0x7fffffffe990,
engine=0x7fffffffe970, primary=true) at EventLoop.cc:55
#7  0x0000000000607cd9 in EventLoop::runOnce (this=0x7fffffffe990) at
EventLoop.cc:129
#8  0x0000000000607b62 in EventLoop::run (this=0x7fffffffe990) at
EventLoop.cc:99
#9  0x00000000006a75c6 in SquidMain (argc=2, argv=0x7fffffffebb8) at
main.cc:1528
#10 0x00000000006a69ea in SquidMainSafe (argc=2, argv=0x7fffffffebb8)
at main.cc:1260
#11 0x00000000006a69c2 in main (argc=2, argv=0x7fffffffebb8) at main.cc:1252
(gdb) quit
root at mail:/usr/local/squid/logs # exit
exit








-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254733744121/+254722743223
"I can't hear you -- I'm using the scrambler."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150119/ddc85df1/attachment.htm>

From eliezer at ngtech.co.il  Mon Jan 19 16:53:00 2015
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Mon, 19 Jan 2015 18:53:00 +0200
Subject: [squid-users] [squid-announce] Squid 3.5.1 is available
In-Reply-To: <1421675811595-4669172.post@n4.nabble.com>
References: <54BA1918.7020308@treenet.co.nz>
 <1421675811595-4669172.post@n4.nabble.com>
Message-ID: <54BD366C.8020808@ngtech.co.il>

On 19/01/2015 15:56, HackXBack wrote:
> after upgrading to 3.5.1 i have bug
>
> BUG 3279: HTTP reply without Date
>
> how to solve it ??

To make sure I understand the issue:
Is it crashing squid? or just shows a warning in the logs?

Thanks,
Eliezer




From yvoinov at gmail.com  Mon Jan 19 16:57:44 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 19 Jan 2015 22:57:44 +0600
Subject: [squid-users] Squid 3.4.11 crashing on FreeBSD 10 (64-bit)
In-Reply-To: <CAAdA2WPceDYjSs3hU2XfGvK06TsRzGPgdsKmYRDdM=Bw4BCphg@mail.gmail.com>
References: <CAAdA2WMni5HVEveBHGaXx1YXRAbWAmbQUfXfOiM=oSrqc4VWAw@mail.gmail.com>
 <54BD1AF2.4070003@gmail.com>
 <CAAdA2WOxhvDBwCtg5qit_aj2G0GVjarJqBWC+nd_buRQ0yrBZw@mail.gmail.com>
 <54BD2CB1.5040206@treenet.co.nz>
 <CAAdA2WPceDYjSs3hU2XfGvK06TsRzGPgdsKmYRDdM=Bw4BCphg@mail.gmail.com>
Message-ID: <54BD3788.3070005@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
The problem can be anywhere in self-made software.

In libc.so. In ANY of system or related libraries.

Debugging core or crash dump is the single way to know, whats wrong.

19.01.2015 22:51, Odhiambo Washington ?????:
>
>
> On 19 January 2015 at 19:11, Amos Jeffries <squid3 at treenet.co.nz
<mailto:squid3 at treenet.co.nz>> wrote:
>
>     -----BEGIN PGP SIGNED MESSAGE-----
>     Hash: SHA1
>
>     On 20/01/2015 4:20 a.m., Odhiambo Washington wrote:
>     > On 19 January 2015 at 17:55, Yuri Voinov wrote:
>     >
>     >> Your use CLang. This is the single point.
>     >>
>     >> You can get any effects. Looks like this is not Squid problem.
>     >> Just system.
>     >>
>     >
>     >
>     > Are you insinuating that Squid-3.x is not supposed to run on
>     > FreeBSD 10 because of the CLANG thing?
>     >
>
>     We build test Squid on Clang for FreeBSD 10 (no longer GCC). So it
>     should build and run fine. (Though our FreeBSD 10 tests are failing on
>     man(8) page creation recently).
>
>
> In the FreeBSD 10 ports, there is still 3.4.10, but I changed the
version to 3.4.11 and it did not grok!
> 
>
>
>     Your build parameter 'CPP=clang-cpp' seems unusual. We do not use/need
>     that for the integration testing builds. Just CC=clang CXX=clang++.
>     The toolchain naturally takes care of the rest.
>
>
> A relic I forgot in my make.conf while struggling with FreeBSD 10.
Thanks for catching that.
>
> I removed it and recompiled:
>
> root at mail:/usr/ports/www/squid # squid -v
> Squid Cache: Version 3.4.11
> configure options:  '--with-default-user=squid'
'--bindir=/usr/local/sbin' '--sbindir=/usr/local/sbin'
'--datadir=/usr/local/etc/squid' '--libexecdir=/usr/local/libexec/squid'
'--localstatedir=/var' '--sysconfdir=/usr/local/etc/squid'
'--with-logdir=/var/log/squid' '--with-pidfile=/var/run/squid/squid.pid'
'--with-swapdir=/var/squid/cache' '--enable-auth' '--enable-build-info'
'--enable-loadable-modules' '--enable-removal-policies=lru heap'
'--disable-epoll' '--disable-linux-netfilter' '--disable-linux-tproxy'
'--disable-translation' '--disable-arch-native' '--enable-eui' '
> --enable-cache-digests' '--enable-delay-pools' '--disable-ecap'
'--disable-esi' '--enable-follow-x-forwarded-for' '--enable-htcp'
'--enable-icap-client' '--enable-icmp' '--enable-ident-lookups'
'--enable-ipv6' '--enable-kqueue' '--with-large-files'
'--enable-http-violations' '--enable-snmp ' '--enable-ssl'
'--enable-ssl-crtd' '--disable-stacktraces' '--disable-ipf-transparent'
'--disable-ipfw-transparent' '--enable-pf-transparent' '
--with-nat-devpf' '--enable-forw-via-db' '--enable-wccp'
'--enable-wccpv2' '--enable-auth-basic=DB MSNT MSNT-multi-domain NCSA
PAM POP3 RADIUS fake getpwnam NIS' '--enable-auth-digest=file'
'--enable-external-acl-helpers=file_userip time_quota unix_group
SQL_session' '--enable-auth-negotia
> te=kerberos wrapper' '--enable-auth-ntlm=fake smb_lm'
'--enable-storeio=ufs aufs diskd' '--enable-disk-io=AIO Blocking IpcIo
Mmapped DiskThreads DiskDaemon' '--enable-log-daemon-helpers=file'
'--enable-url-rewrite-helpers=fake'
'--enable-storeid-rewrite-helpers=file' '--with-openssl=/usr'
'--disable-optimizations' '--enable-debug-cbdata' '--prefix=/usr/local'
'--mandir=/usr/local/man' '--infodir=/usr/local/info/'
'--build=amd64-portbld-freebsd10.1'
'build_alias=amd64-portbld-freebsd10.1' 'CC=cc' 'CFLAGS=-pipe
-march=native  -I/usr/include -g -fstack-protector -fno-strict-aliasing'
'LDFLAGS= -pthread -Wl,-rpath,/usr/lib:/usr/local/lib -L/usr/lib
-fstack-protector' 'LIBS=' 'CPPFLAGS=' 'CXX=c++' 'CXXFLAGS=-pipe
-march=native -I/usr/include -g -fstack-protector -fno-strict-aliasing 
-Wno-unused-private-field' 'CPP=cpp' --enable-ltdl-convenience
>
> However this has not changed the continuous crashing I am seeing cache.log
>
>
> 
>
>
>     Only the FreeBSD 9.x have clang build issues from the GCC->clang
>     transitional bugs coming at it from all sides (kernel, compiler, and
>     Squid).
>
>
>
>     > Do you have a little howto on how I can compile it using gcc (I
>     > have gcc49 installed) ?
>
>     At the simplest:
>
>      mkdir _build && \
>      cd _build && \
>      ../configure && \
>      make install
>
>     The squid default paths etc were all designed for FreeBSD environment.
>
>
> That has failed to work for me on this FreeBSD 10.
>
>
>     >
>     > This squid is running, disobeying my time-based ACLs, crashing as
>     > seen in cache.log and ... just annoying but I need a proxy by all
>     > means! It kinda puts me in the proverbial between a rock & hard
>     > place.
>     >
>
>
>     If you are using diskd cache_dir on FreeBSD 10 there are known crashes
>     from that in 9/10. Until that is figured out shifting to ufs or aufs
>     is best.
>
>
>
> I use aufs.
>
> 
>
>
>     Since it is a crash, backtrace is critical to figuring out what is
>     actually going on.
>
>
> Does the following help?
>
> Script started on Mon Jan 19 19:49:30 2015
> root at mail:/usr/local/squid/logs # gdb /usr/local/sbin/squid squid.core
> GNU gdb 6.1.1 [FreeBSD]
> Copyright 2004 Free Software Foundation, Inc.
> GDB is free software, covered by the GNU General Public License, and
you are
> welcome to change it and/or distribute copies of it under certain
conditions.
> Type "show copying" to see the conditions.
> There is absolutely no warranty for GDB.  Type "show warranty" for
details.
> This GDB was configured as "amd64-marcel-freebsd"...
> Core was generated by `squid'.
> Program terminated with signal 11, Segmentation fault.
> Reading symbols from /usr/lib/librt.so.1...done.
> Loaded symbols for /usr/lib/librt.so.1
> Reading symbols from /usr/local/lib/libnettle.so.4...done.
> Loaded symbols for /usr/local/lib/libnettle.so.4
> Reading symbols from /usr/lib/libssl.so.7...done.
> Loaded symbols for /usr/lib/libssl.so.7
> Reading symbols from /usr/lib/libgssapi.so.10...done.
> Loaded symbols for /usr/lib/libgssapi.so.10
> Reading symbols from /usr/lib/libgssapi_krb5.so.10...done.
> Loaded symbols for /usr/lib/libgssapi_krb5.so.10
> Reading symbols from /usr/lib/libheimntlm.so.11...done.
> Loaded symbols for /usr/lib/libheimntlm.so.11
> Reading symbols from /usr/lib/libkrb5.so.11...done.
> Loaded symbols for /usr/lib/libkrb5.so.11
> Reading symbols from /usr/lib/libhx509.so.11...done.
> Loaded symbols for /usr/lib/libhx509.so.11
> Reading symbols from /usr/lib/libcom_err.so.5...done.
> Loaded symbols for /usr/lib/libcom_err.so.5
> Reading symbols from /lib/libcrypto.so.7...done.
> Loaded symbols for /lib/libcrypto.so.7
> Reading symbols from /usr/lib/libasn1.so.11...done.
> Loaded symbols for /usr/lib/libasn1.so.11
> Reading symbols from /usr/lib/libwind.so.11...done.
> Loaded symbols for /usr/lib/libwind.so.11
> Reading symbols from /usr/lib/libheimbase.so.11...done.
> Loaded symbols for /usr/lib/libheimbase.so.11
> Reading symbols from /usr/lib/libroken.so.11...done.
> Loaded symbols for /usr/lib/libroken.so.11
> Reading symbols from /lib/libcrypt.so.5...done.
> Loaded symbols for /lib/libcrypt.so.5
> Reading symbols from /lib/libm.so.5...done.
> Loaded symbols for /lib/libm.so.5
> Reading symbols from /usr/lib/libc++.so.1...done.
> Loaded symbols for /usr/lib/libc++.so.1
> Reading symbols from /lib/libcxxrt.so.1...done.
> Loaded symbols for /lib/libcxxrt.so.1
> Reading symbols from /lib/libgcc_s.so.1...done.
> Loaded symbols for /lib/libgcc_s.so.1
> Reading symbols from /lib/libthr.so.3...done.
> Loaded symbols for /lib/libthr.so.3
> Reading symbols from /lib/libc.so.7...done.
> Loaded symbols for /lib/libc.so.7
> Reading symbols from /usr/lib/private/libheimipcc.so.11...done.
> Loaded symbols for /usr/lib/private/libheimipcc.so.11
> Reading symbols from /libexec/ld-elf.so.1...done.
> Loaded symbols for /libexec/ld-elf.so.1
> #0  0x0000000803a30469 in swapcontext () from /lib/libthr.so.3
> [New Thread 804ff5000 (LWP 100336/squid)]
> [New Thread 804ff4c00 (LWP 100335/squid)]
> [New Thread 804ff4800 (LWP 100334/squid)]
> [New Thread 804ff4400 (LWP 100333/squid)]
> [New Thread 804ff4000 (LWP 100332/squid)]
> [New Thread 804ff3c00 (LWP 100331/squid)]
> [New Thread 804ff3800 (LWP 100330/squid)]
> [New Thread 804ff3400 (LWP 100329/squid)]
> [New Thread 804ff3000 (LWP 100328/squid)]
> [New Thread 804ff2c00 (LWP 100327/squid)]
> [New Thread 804ff2800 (LWP 100326/squid)]
> [New Thread 804ff2400 (LWP 100325/squid)]
> [New Thread 804ff2000 (LWP 100324/squid)]
> [New Thread 804ff1c00 (LWP 100323/squid)]
> [New Thread 804ff1800 (LWP 100322/squid)]
> [New Thread 804ff1400 (LWP 100321/squid)]
> [New Thread 804806400 (LWP 100230/squid)]
> (gdb) bt
> #0  0x0000000803a30469 in swapcontext () from /lib/libthr.so.3
> #1  0x0000000803a30062 in sigaction () from /lib/libthr.so.3
> #2  <signal handler called>
> #3  0x0000000803d6b04a in kevent () from /lib/libc.so.7
> #4  0x000000000086335c in Comm::DoSelect (msec=981) at ModKqueue.cc:264
> #5  0x00000000007eca54 in CommSelectEngine::checkEvents
(this=0x7fffffffe970, timeout=981) at comm.cc:2058
> #6  0x000000000060795a in EventLoop::checkEngine (this=0x7fffffffe990,
engine=0x7fffffffe970, primary=true) at EventLoop.cc:55
> #7  0x0000000000607cd9 in EventLoop::runOnce (this=0x7fffffffe990) at
EventLoop.cc:129
> #8  0x0000000000607b62 in EventLoop::run (this=0x7fffffffe990) at
EventLoop.cc:99
> #9  0x00000000006a75c6 in SquidMain (argc=2, argv=0x7fffffffebb8) at
main.cc:1528
> #10 0x00000000006a69ea in SquidMainSafe (argc=2, argv=0x7fffffffebb8)
at main.cc:1260
> #11 0x00000000006a69c2 in main (argc=2, argv=0x7fffffffebb8) at
main.cc:1252
> (gdb) quit
> root at mail:/usr/local/squid/logs # exit
> exit
>
>
>
>
>
>
>
> --
> Best regards,
> Odhiambo WASHINGTON,
> Nairobi,KE
> +254733744121/+254722743223
> "I can't hear you -- I'm using the scrambler."
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUvTeGAAoJENNXIZxhPexGsSsH/3pbmsRSMxhMAGHEACiYSWHE
j1nXWxyMs7AzX6XEHnCRpLef8sIV+YiTALHvIoyOMhR+LYfZBRrKLCvkr/i38vjR
ITS288ZwCIXxggDL+ilPnEqZ9riyObxyyvlMD9YpJkuIiip/zkPguw6hzj6uNLsS
BAkYBsSM6TvxeYkn27kctupSoc7wXj18zOiFF9YNjcoxc9nCbxiFWbZLvrdXOoKE
OccTzmlGXlgrQxdylOeBUcXnMa9dL/I1Ousxc9DbgDLt1v46XfIrFBf8IQJmnKtr
6KUgLql97ahsFwqUf3h33xgOvlNGwzRTAGNfvktaZHFwkFlmHqll1Z+nvaFrp2s=
=PbnD
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150119/3ba03c47/attachment.htm>

From gecom at tubosider.it  Mon Jan 19 18:29:07 2015
From: gecom at tubosider.it (masterx81)
Date: Mon, 19 Jan 2015 10:29:07 -0800 (PST)
Subject: [squid-users] Squid and site ryanair.com
In-Reply-To: <1421337529987-4669105.post@n4.nabble.com>
References: <1421337529987-4669105.post@n4.nabble.com>
Message-ID: <1421692147100-4669201.post@n4.nabble.com>

Still have problems... I've tried in different ways and i'm unable to get it
work...
This is my config:

#
# Recommended minimum configuration:
#

### cache manager
cache_mgr cachemgr at domain.com

visible_hostname        Serv07.domain.com

authenticate_ip_ttl 1 hour

### negotiate kerberos and ntlm authentication
auth_param negotiate program /usr/local/bin/negotiate_wrapper -d --ntlm
/usr/bin/ntlm_auth --helper-protocol=squid-2.5-ntlmssp --domain=DOMAIN
--kerberos /usr/local/bin/squid_kerb_auth -s GSS_C_NO_NAME
auth_param negotiate children 50
auth_param negotiate keep_alive off

### pure ntlm authentication
auth_param ntlm program /usr/bin/ntlm_auth -d
--helper-protocol=squid-2.5-ntlmssp --domain=DOMAIN
auth_param ntlm children 50
auth_param ntlm keep_alive off

### provide basic authentication via ldap for clients not authenticated via
kerberos/ntlm
auth_param basic program /usr/local/squid/libexec/basic_ldap_auth -v 3 -R -b
"dc=domain,dc=local" -D squid at domain.local -W /etc/squid/ldappass.txt -d -f
sAMAccountName=%s -h srv-dc1.domain.local
auth_param basic children 50 
#startup=0 idle=1
auth_param basic realm Proxy Domain
##auth_param basic credentialsttl 1 minute
##auth_param basic casesensitive off

### Kerb authorization
#external_acl_type memberof ttl=30 %LOGIN
/usr/lib64/squid/ext_kerberos_ldap_group_acl -d -g "%g" -D "DOMAIN.LOCAL"

### ldap authorisation
external_acl_type memberof ttl=30 %LOGIN
/usr/local/squid/libexec/ext_ldap_group_acl -v 3 -R -K -b
"dc=domain,dc=local" -D squid at domain.local -W /etc/squid/ldappass.txt -f
"(&(objectclass=person)(sAMAccountName=%v)(memberof=cn=%g,ou=SQUID,ou=OU
Domain,dc=domain,dc=local))" -h srv-dc1.domain.local

### acl for proxy auth and ldap authorizations
acl auth proxy_auth REQUIRED
#   aclname             acltype  typename activedirectorygroup
acl InternetBloccato    external memberof "/etc/squid/Internet_bloccato.txt"
acl InternetCentralino  external memberof
"/etc/squid/Internet_centralino.txt"
acl InternetLimitato    external memberof "/etc/squid/Internet_limitato.txt"
acl InternetLibero      external memberof "/etc/squid/Internet_libero.txt"
acl InternetVIP         external memberof "/etc/squid/Internet_VIP.txt"

acl consentiti_tutti    dstdomain "/etc/squid/block/consentiti_tutti.txt"

acl consentiti          dstdomain "/etc/squid/block/consentiti.txt"
acl nonconsentiti       dstdomain "/etc/squid/block/nonconsentiti.txt"

acl bypass dstdomain .sistri.it

acl windowsupdate dstdomain windowsupdate.microsoft.com
acl windowsupdate dstdomain .update.microsoft.com
acl windowsupdate dstdomain download.windowsupdate.com
acl windowsupdate dstdomain redir.metaservices.microsoft.com
acl windowsupdate dstdomain images.metaservices.microsoft.com
acl windowsupdate dstdomain c.microsoft.com
acl windowsupdate dstdomain www.download.windowsupdate.com
acl windowsupdate dstdomain wustat.windows.com
acl windowsupdate dstdomain crl.microsoft.com

acl java_jvm browser Java/1.4 Java/1.5 Java/1.6 Java/1.7 Java/1.8


## Disable ssl interception for dropbox.com and hotmail.com (and localhost)
acl no_ssl_interception dstdomain .dropbox.com .hotmail.com .sistri.it
.office365.com .officineciola.it .adobe.com .adobelogin.com
ssl_bump none localhost
ssl_bump none no_ssl_interception
## Add the rest of your ssl-bump rules below
## e.g ssl_bump server-first all
## etc

### squid defaults
#acl manager proto cache_object
#acl localhost src 127.0.0.1/32 ::1
#acl to_localhost dst 127.0.0.0/8 0.0.0.0/32 ::1
acl SSL_ports port 443
acl SSL_ports port 7071
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http

acl CONNECT method CONNECT
acl wuCONNECT dstdomain www.update.microsoft.com

http_access allow CONNECT wuCONNECT
http_access allow windowsupdate

http_access allow java_jvm

http_access allow localhost

# Permetti FTP
acl ftp proto FTP
acl ftp_port port 21
http_access allow ftp_port CONNECT
http_access allow ftp

# ACL per limiti utenti Internet_limitato
acl giorni time T W H

# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
ftp_epsv off


#
# Recommended minimum Access Permission configuration:
#
# Deny requests to certain unsafe ports
http_access deny !Safe_ports


# Only allow cachemgr access from localhost
http_access allow localhost manager
http_access deny manager

# We strongly recommend the following be uncommented to protect innocent
# web applications running on the proxy server who think the only
# one who can access services on "localhost" is a local user
#http_access deny to_localhost

#
# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
#


### http_access rules

http_access allow bypass
always_direct allow bypass

# allow unrestricted access to prioritysites
http_access allow consentiti_tutti
# enforce authentication, order of rules is important for authorization
levels
http_access deny !auth
# prevent access to basic auth prompt for BlockedAccess users
http_access deny  InternetBloccato all

# Permetto l'accesso VIP
http_access allow InternetVIP auth

http_access deny  nonconsentiti
http_access allow consentiti

#http_access allow consentiti_tutti
http_access deny  InternetCentralino all

http_access allow InternetLibero auth

http_access deny giorni

http_access allow InternetLimitato auth


# DO NOT REMOVE THE FOLLOWING LINE
http_access deny all


# Definisco i limiti di banda
#delay_pools 1
#delay_class 1 1

#delay_access 1 allow InternetLimitato InternetLibero InternetCentralino
!CONNECT

#delay_parameters 1 500000/500000



### logging
# don't log allowedsites, prioritysites, AnonymousAccess
access_log /var/log/squid/access.log squid
#!allowedsites !prioritysites !AnonymousAccess
cache_log /var/log/squid/cache.log
cache_store_log /var/log/squid/store.log
cache_swap_log /var/log/squid/swap.log

logfile_rotate 10

# Squid normally listens to port 3128
http_port 8080

# Uncomment and adjust the following to add a disk cache directory.
#cache_dir ufs /var/spool/squid 100 16 256

# Leave coredumps in the first cache dir
coredump_dir /var/spool/squid

#
# Add any of your own refresh_pattern entries above these.
#
refresh_pattern ^ftp:		1440	20%	10080	
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
refresh_pattern .		0	20%	4320

#
maximum_object_size 3000 KB

#cache_effective_user squid
#cache_effective_group squid

Any ideas why i can't get it work?
Thanks!



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-and-site-ryanair-com-tp4669105p4669201.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From gecom at tubosider.it  Mon Jan 19 18:31:06 2015
From: gecom at tubosider.it (masterx81)
Date: Mon, 19 Jan 2015 10:31:06 -0800 (PST)
Subject: [squid-users] Squid and site ryanair.com
In-Reply-To: <54B81017.6080503@gmail.com>
References: <1421337529987-4669105.post@n4.nabble.com>
 <1421343366034-4669108.post@n4.nabble.com> <54B81017.6080503@gmail.com>
Message-ID: <1421692266175-4669202.post@n4.nabble.com>

No JS blocking... I've problems only with this site....
Now i'm duplicating the squid VM to try to debug better on an isolated
enviroment.
I've posted my squid.conf, maybe someone see something wrong that i not
see... 



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-and-site-ryanair-com-tp4669105p4669202.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From gecom at tubosider.it  Mon Jan 19 18:33:33 2015
From: gecom at tubosider.it (masterx81)
Date: Mon, 19 Jan 2015 10:33:33 -0800 (PST)
Subject: [squid-users] Squid and site ryanair.com
In-Reply-To: <54B88B33.5010701@treenet.co.nz>
References: <1421337529987-4669105.post@n4.nabble.com>
 <54B88B33.5010701@treenet.co.nz>
Message-ID: <1421692413846-4669203.post@n4.nabble.com>

I'm using chrome as browser, and i not find the developer/network trafic
section where check if there is something that the browser can't get...



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-and-site-ryanair-com-tp4669105p4669203.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From hack.back at hotmail.com  Mon Jan 19 18:37:04 2015
From: hack.back at hotmail.com (HackXBack)
Date: Mon, 19 Jan 2015 10:37:04 -0800 (PST)
Subject: [squid-users] BUG 3279: HTTP reply without Date
In-Reply-To: <54BD2311.4030707@treenet.co.nz>
References: <1421660749199-4669162.post@n4.nabble.com>
 <1421679200468-4669184.post@n4.nabble.com>
 <70481285.293664240.1421679547599.JavaMail.root@zimbra4-e1.priv.proxad.net>
 <54BD1E6D.7030507@gmail.com>
 <216789922.293694425.1421680444617.JavaMail.root@zimbra4-e1.priv.proxad.net>
 <54BD1F7C.6090703@gmail.com> <54BD2311.4030707@treenet.co.nz>
Message-ID: <1421692624238-4669204.post@n4.nabble.com>

Dear Amos , you said no one report like this bug since 14 days 
you didnt checked my report ?

http://squid-web-proxy-cache.1019090.n4.nabble.com/another-squid-3-5-0-4-bug-restart-automatically-td4668851.html

its here !! 
DATE : Dec 29, 2014; 12:21am

sorry for being silly , but i lost 6 terra byte data today 




--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/BUG-3279-HTTP-reply-without-Date-tp4669162p4669204.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From gecom at tubosider.it  Mon Jan 19 18:42:27 2015
From: gecom at tubosider.it (masterx81)
Date: Mon, 19 Jan 2015 10:42:27 -0800 (PST)
Subject: [squid-users] Squid and site ryanair.com
In-Reply-To: <54B88B33.5010701@treenet.co.nz>
References: <1421337529987-4669105.post@n4.nabble.com>
 <54B88B33.5010701@treenet.co.nz>
Message-ID: <1421692947043-4669205.post@n4.nabble.com>

Found it!
I get the following errors:
(index):6 GET
http://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.3.6/slick.css 
(index):240 GET
http://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.5/require.min.js 
(index):250 Uncaught ReferenceError: require is not defined(index):250
(anonymous function)

But if i "open" the "cloudflare.com" domain to bypass the authentication
schemes i get a TCP_MISS/503 to the same resource, and the browser can't get
it....



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-and-site-ryanair-com-tp4669105p4669205.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From squid3 at treenet.co.nz  Tue Jan 20 01:55:58 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 20 Jan 2015 14:55:58 +1300
Subject: [squid-users] BUG 3279: HTTP reply without Date
In-Reply-To: <1421692624238-4669204.post@n4.nabble.com>
References: <1421660749199-4669162.post@n4.nabble.com>
 <1421679200468-4669184.post@n4.nabble.com>
 <70481285.293664240.1421679547599.JavaMail.root@zimbra4-e1.priv.proxad.net>
 <54BD1E6D.7030507@gmail.com>
 <216789922.293694425.1421680444617.JavaMail.root@zimbra4-e1.priv.proxad.net>
 <54BD1F7C.6090703@gmail.com> <54BD2311.4030707@treenet.co.nz>
 <1421692624238-4669204.post@n4.nabble.com>
Message-ID: <54BDB5AE.4050405@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 20/01/2015 7:37 a.m., HackXBack wrote:
> Dear Amos , you said no one report like this bug since 14 days you
> didnt checked my report ?
> 
> http://squid-web-proxy-cache.1019090.n4.nabble.com/another-squid-3-5-0-4-bug-restart-automatically-td4668851.html
>
>  its here !! DATE : Dec 29, 2014; 12:21am
> 

The two listed in that log are as I said both existing since 3.2
series. So the problem is not in the 3.5 new features.

* an object 000004AB is recorded in the cache index journal witha disk
location but not existing on disk. Squid removes its meta data about
that object and continues as if it was never found. No bug, just a
warning.

* an object in memory ("swap_filen: -1") is found not to have a Date:
header (bug 3279). Squid adds a Date header with the current time, and
continues using it. Again just a warning.

* something bad in the logics caused Squid to fail an assertion test.
Whatever that was is bug 3483. An apparently "empty" bit of memory
needing to be used to store a new server reply somehow already
contains data.


> sorry for being silly , but i lost 6 terra byte data today
> 

Understood. Those two bugs 3279 and 3483 are very frustrating. If your
experience is anything like the rest of ours now the bug goes back
into hiding.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUvbWtAAoJELJo5wb/XPRjUhwIANy/fkc4xd5RETQ0Q1ROWyPT
3/u4HbE99AgmuoZY9BKhFUFWl8soGnG/J9umQq8zvsli7l5GmEiKbP9ithjLO8Lw
Q2eefOhfKYT9y6Ca1KUeIiCVhhco1I6doXiFpKiWmJ0G05ggh9CkhoIPT6zExBl+
EeBzC8wreVKK/A3bVvwaHrayV48SHlDtOr2MqPDZswl+0M3fIzrKLswVyEJnTFnu
Tc2hffwU1Zm+5I2sn5fXptLpVv44D9soiR28JAhA3TyEN2S6wxxjmgry0PTxNK16
zJm+FDfVUyprcreK+FWzRe40R00MWpm4LUxQ62Cw/qNLqO3+I9pCqIpsAlE69ew=
=8tEZ
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Tue Jan 20 02:00:19 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 20 Jan 2015 15:00:19 +1300
Subject: [squid-users] Squid and site ryanair.com
In-Reply-To: <1421692947043-4669205.post@n4.nabble.com>
References: <1421337529987-4669105.post@n4.nabble.com>
 <54B88B33.5010701@treenet.co.nz> <1421692947043-4669205.post@n4.nabble.com>
Message-ID: <54BDB6B3.9010409@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 20/01/2015 7:42 a.m., masterx81 wrote:
> Found it! I get the following errors: (index):6 GET 
> http://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.3.6/slick.css
>  (index):240 GET 
> http://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.5/require.min.js
>  (index):250 Uncaught ReferenceError: require is not
> defined(index):250 (anonymous function)
> 
> But if i "open" the "cloudflare.com" domain to bypass the
> authentication schemes i get a TCP_MISS/503 to the same resource,
> and the browser can't get it....
> 

So, a bug in Chrome?

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUvbazAAoJELJo5wb/XPRjjm4H/1oobeLhIXrsYp8IeHCokAWj
CSmuyP/jzHiyCB8nFay0GMsL33saBuUfPGIydGL4YRu7oKsDHz9XT2OwwQkOf1WA
ILeexazY29P8F4zGZ9voNiatM5ixaHLJGSRG2vo91p9MkFpmVPD0l45nxYg3S+Dq
+bS+XdAHPoK4OPxRtSFPSHJg9ZLnJwdUuvQHQskV3Fn/NLTb2hDsY/bZmkqidomL
g3QpNZGBQmWcDbcMHy2FO/bRiaif81FWwCuGCgIEQ5vMBTcnif6EW8tTCSiP5BNJ
uIMUDUeMGJ/CLFT61r8rkNpQXjA89NLREfW8qMd5gBtNbn58yU+Ln5pNSux1V/Y=
=6pW9
-----END PGP SIGNATURE-----


From eliezer at ngtech.co.il  Tue Jan 20 02:45:01 2015
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Tue, 20 Jan 2015 04:45:01 +0200
Subject: [squid-users] BUG 3279: HTTP reply without Date
In-Reply-To: <54BDB5AE.4050405@treenet.co.nz>
References: <1421660749199-4669162.post@n4.nabble.com>
 <1421679200468-4669184.post@n4.nabble.com>
 <70481285.293664240.1421679547599.JavaMail.root@zimbra4-e1.priv.proxad.net>
 <54BD1E6D.7030507@gmail.com>
 <216789922.293694425.1421680444617.JavaMail.root@zimbra4-e1.priv.proxad.net>
 <54BD1F7C.6090703@gmail.com> <54BD2311.4030707@treenet.co.nz>
 <1421692624238-4669204.post@n4.nabble.com> <54BDB5AE.4050405@treenet.co.nz>
Message-ID: <54BDC12D.9010403@ngtech.co.il>

Hey,

After reviewing bugs 3279 and 3483 I am pretty sure we can draw a path 
that will help with this issue by minimizing couple culprits.

HackXBack? is it?
I have seen couple snippets from your squid.conf but I want to build a 
new picture.
I feel sorry for you that you lost so much data but before you jump into 
the water and push the power button again on the service I would like to 
make a suggestion:
- Try to run the service for 48-72 hours on ram ONLY and see if you are 
having any issues.

Now a question? are you using SMP by any chance? here your squid.conf 
will help to understand what is your setup.
If you can get some details on the machine using lspci, dmesg or other 
tools it would help to understand the issue more.

If you do wish to at-least find the main cause to the issue don't try to 
just "fix" the issue.
First start with basic tests and make sure that the service is stable to 
run a period of 48-72 hours straight with no reconfiguring and\or restarts.
Once we will get there with little steps we might be able to even solve 
the issue.

All The Bests,
Eliezer

On 20/01/2015 03:55, Amos Jeffries wrote:
>
>> >sorry for being silly , but i lost 6 terra byte data today
>> >
> Understood. Those two bugs 3279 and 3483 are very frustrating. If your
> experience is anything like the rest of ours now the bug goes back
> into hiding.
>
> Amos




From squid at proxyplayer.co.uk  Tue Jan 20 03:10:57 2015
From: squid at proxyplayer.co.uk (squid at proxyplayer.co.uk)
Date: Tue, 20 Jan 2015 03:10:57 +0000
Subject: [squid-users] google always requesting captach through
 transparent proxy
In-Reply-To: <54BD07A9.8050204@gmail.com>
References: <54BB1387.7070800@trimble.com>
 <1421552897374.380d3f1c@Nodemailer> <54BB9223.50406@treenet.co.nz>
 <20150118143903.2020441id44pq553@webmail-srv2.servage.net>
 <54BBC7D5.8040508@treenet.co.nz>
 <20150119033045.199712tcod5b9mqu@webmail-srv2.servage.net>
 <54BC8776.9060800@trimble.com>
 <20150119131237.15032ceufkcp2c3p@webmail-srv2.servage.net>
 <54BD07A9.8050204@gmail.com>
Message-ID: <20150120031057.21453grzvv6qruwx@webmail-srv2.servage.net>


>
> How long these problems by Google?
For a couple months now.
>
> Also, possible you use collapsing forwarding, or something like in your
> Squid configuration?
squid.conf is in the original email. Should I reattach?
>
> May be, you usr HTTP headers manipulation, which can confusing Google?
>
> Generally, show us squid.conf.
>
> Moreover, what is your external IP? Is it can be blacklisted for any
> reason. Did your check it?
It's not blacklisted.




From wmunny at mail.com  Tue Jan 20 08:54:59 2015
From: wmunny at mail.com (wmunny william)
Date: Tue, 20 Jan 2015 09:54:59 +0100
Subject: [squid-users] Squid 3.5.1 100% CPU
In-Reply-To: <1891098264.293297423.1421669670129.JavaMail.root@zimbra4-e1.priv.proxad.net>
References: <1891098264.293297423.1421669670129.JavaMail.root@zimbra4-e1.priv.proxad.net>
Message-ID: <trinity-416c2228-8a01-4664-9c3c-aa665b6238f8-1421744099010@3capp-mailcom-lxa02>



>
> 
> 
> Hello all,
> 
> Unfortunately the problem still present with latest snapshot, there is a ldap request for each GET or CONNECT and with heavy load this is really problematic.
> You can take a look at my bug rapport, there is a temporary solution for 3.5, but I guess it's better to stay with 3.4 with my patch (if you suffer from bug 4066 of course) for the moment.
> 


Hello,

Fred what should I do exactly ? Sorry I'm a little bit lost 

Thanks 


From fredbmail at free.fr  Tue Jan 20 09:23:13 2015
From: fredbmail at free.fr (FredB)
Date: Tue, 20 Jan 2015 10:23:13 +0100 (CET)
Subject: [squid-users] Squid 3.5.1 100% CPU
In-Reply-To: <trinity-416c2228-8a01-4664-9c3c-aa665b6238f8-1421744099010@3capp-mailcom-lxa02>
Message-ID: <1843882185.295299547.1421745793429.JavaMail.root@zimbra4-e1.priv.proxad.net>



> 
> 
> Hello,
> 
> Fred what should I do exactly ? Sorry I'm a little bit lost
> 
> Thanks
> 

Hmm, You can still use your 3.4.x version + my patch, but I think it should be better to use the latest 3.4 snapshot there are some interesting bug-fixes and the patch was pushed by Amos yesterday.

http://www.squid-cache.org/Versions/v3/3.4/changesets/

About Squid 3.5 wait for the moment, the 100 % CPU bug is present and I will make deep tests to be sure that there is nothing else.
When this bug will be fixed and my tests (with High load) are all ok I will post a message here, don't worry about that. 

FYI: A old bug still present with DIGEST (no matter the version) check_nonce_count is broken, my advice is to use check_nonce_count off and nonce_max_count with high value (like 500000) The nc-value is the hexadecimal count of the number of requests (including the current request) the value is needed to be RFC complaint.

https://www.ietf.org/rfc/rfc2617.txt
http://www.squid-cache.org/Doc/config/auth_param/


----

Regards,

Fred

http://numsys.eu
http://e2guardian.org


From sis at open.ch  Tue Jan 20 10:31:59 2015
From: sis at open.ch (=?iso-8859-1?Q?Simon_St=E4heli?=)
Date: Tue, 20 Jan 2015 11:31:59 +0100
Subject: [squid-users] benefits of using ext_kerberos_ldap_group_acl instead
	of ext_ldap_group_acl
Message-ID: <1EC53106-F880-4828-89AD-C3CEE0BC03ED@open.ch>

Are there any other benefits in using ext_kerberos_ldap_group_acl instead of ext_ldap_group_acl except the "Netbios name to Kerberos domain name? mappings provided by the -N option. As far as I can tell, this mapping can also easily be done by writing you own helper perl script which is doing the mapping and finally feeds the more common ext_ldap_group_acl helper.

Thanks,
Simon
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4030 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150120/8b66a98e/attachment.bin>

From squid3 at treenet.co.nz  Tue Jan 20 11:26:20 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 21 Jan 2015 00:26:20 +1300
Subject: [squid-users] benefits of using ext_kerberos_ldap_group_acl
 instead of ext_ldap_group_acl
In-Reply-To: <1EC53106-F880-4828-89AD-C3CEE0BC03ED@open.ch>
References: <1EC53106-F880-4828-89AD-C3CEE0BC03ED@open.ch>
Message-ID: <54BE3B5C.8040800@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 20/01/2015 11:31 p.m., Simon St?heli wrote:
> Are there any other benefits in using ext_kerberos_ldap_group_acl
> instead of ext_ldap_group_acl except the "Netbios name to Kerberos
> domain name? mappings provided by the -N option. As far as I can
> tell, this mapping can also easily be done by writing you own
> helper perl script which is doing the mapping and finally feeds the
> more common ext_ldap_group_acl helper.
> 

Whatever floats your boat. The point of the Addon/Plugin/helpers API
is that you can use scripts if thy serve your needs better.

All the usual Open Source benefits of "many eyeballs" and somebody
else doing code maintenance for you applies to using a bundled helper
over a custom written one.

Beyond that the kerberos helper also provides automatic detection of
which LDAP server to use via mutiple auto-configuration methods.

If you can demonstrate that the ext_kerberos_ldap_group_acl does
provides a superset of the functionality of ext_ldap_group_acl helper
then I can de-duplicate the two helpers.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUvjtbAAoJELJo5wb/XPRjb1sH/2mO/l+k7jTdFr5CBfrBjXr8
hp8ECHtKkpHvhiinKadcQd69ZYz0bqYmKQ4AX44XaTKTgc2ctKeywuDBRtSVnMwH
KrSFY+YUhxpje7hRIwtoloVtPcT+JawUbnvGaAGtcbLNypkT1VEICBA/5QJbSWUH
Uc+6szgksFWbDldl7kGYd42e7ZE8CdfcjzYqROaFxTglTKgEpqNvaY7KrNx2cZ+c
5Kx4C6LzKrHML28TsWurWBpS3NVkUveFBLqkD8hY8QULolKleSFkHfuHn/S4gXGf
IkyNDtEBbdFPKIQw5bkBvzpAWKxSn2fWsq4GW2AJeCcKiJVHDLqwTVQ4vIddsY8=
=BbhE
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Tue Jan 20 12:17:28 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 21 Jan 2015 01:17:28 +1300
Subject: [squid-users] Squid 3.4.11 crashing on FreeBSD 10 (64-bit)
In-Reply-To: <CAAdA2WPceDYjSs3hU2XfGvK06TsRzGPgdsKmYRDdM=Bw4BCphg@mail.gmail.com>
References: <CAAdA2WMni5HVEveBHGaXx1YXRAbWAmbQUfXfOiM=oSrqc4VWAw@mail.gmail.com>
 <54BD1AF2.4070003@gmail.com>
 <CAAdA2WOxhvDBwCtg5qit_aj2G0GVjarJqBWC+nd_buRQ0yrBZw@mail.gmail.com>
 <54BD2CB1.5040206@treenet.co.nz>
 <CAAdA2WPceDYjSs3hU2XfGvK06TsRzGPgdsKmYRDdM=Bw4BCphg@mail.gmail.com>
Message-ID: <54BE4758.2080102@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

I have just fixed a few clang detected build errors and 3.5 is now
building cleanly here on FreeBSD 10 with the default Clang.

Please try to build the latest 3.5 snapshot (which will be labeled
r13735 or higher). It should build fine with either the system default
clang compiler or your GCC 4.9 install, but not with the system
default GCC 4.4.


> (gdb) bt #0  0x0000000803a30469 in swapcontext () from
> /lib/libthr.so.3 #1  0x0000000803a30062 in sigaction () from
> /lib/libthr.so.3 #2  <signal handler called> #3  0x0000000803d6b04a
> in kevent () from /lib/libc.so.7 #4  0x000000000086335c in
> Comm::DoSelect (msec=981) at ModKqueue.cc:264


Looks like a bug in the system threading library. Though why Squid is
triggering it is unknown. Maybe related to the two GCC versions with
different libc perhapse?

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUvkdXAAoJELJo5wb/XPRjlvAIAMFp6QV6Dq+IEzUfdrh510F0
u2w/qba0om8a/9V3VnO5H1fHt4uIiHD9Nfph0jqhpkNPP34grO5CFOJRTIRwgni7
9GO2Dq6UKYFz2onkoQlm2Oa/72LEsBupWThL2chlsowztedhObIHAt4qUqLCbTo4
ogwIvf30wFQ4xTYMj1KLmFjbUYM/EIag+c9A67w7RB1kxQqtIHxdwQYrRbjli66s
6D6FYoFZ3BwlulWylNqjB8z98ah0/wn761rcrt2jYmAmM8OvYrezspn5BviAF6YP
1m/skvaEIFP3i3wJZUSY5AoD3EFYAZp0PJL6zXaXKhhERCjZ4/ekiA5rjlqnSZo=
=pv6K
-----END PGP SIGNATURE-----


From sis at open.ch  Tue Jan 20 12:38:56 2015
From: sis at open.ch (Simon Staeheli)
Date: Tue, 20 Jan 2015 13:38:56 +0100
Subject: [squid-users]
 =?utf-8?q?benefits_of_using_ext=5Fkerberos=5Fldap?=
 =?utf-8?q?=5Fgroup=5Facl__instead_of_ext=5Fldap=5Fgroup=5Facl?=
Message-ID: <5ef9162d0bea9bc93fe70fcfcc95a484@open.ch>

> Whatever floats your boat. The point of the Addon/Plugin/helpers API
> is that you can use scripts if thy serve your needs better.
> 
> All the usual Open Source benefits of "many eyeballs" and somebody
> else doing code maintenance for you applies to using a bundled helper
> over a custom written one.
> 
> Beyond that the kerberos helper also provides automatic detection of
> which LDAP server to use via mutiple auto-configuration methods.
> 
> If you can demonstrate that the ext_kerberos_ldap_group_acl does
> provides a superset of the functionality of ext_ldap_group_acl helper
> then I can de-duplicate the two helpers.
> 
> Amos

Thanks for the hint regarding automatic detection of LDAP servers. I am 
just trying to find what the differences between the two helpers are and 
which one does fit my needs better. Any others?

Do you know anything about the feature in ext_kerberos_ldap_group_acl 
mentioned by Markus Moeller in an earlier post?

"I have a new method in my squid 3.4 patch which uses the Group
Information MS is putting in the ticket. This would eliminate the ldap
lookup completely." 
(http://www.squid-cache.org/mail-archive/squid-users/201309/0046.html)

Simon







From squid3 at treenet.co.nz  Tue Jan 20 13:10:10 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 21 Jan 2015 02:10:10 +1300
Subject: [squid-users] benefits of using ext_kerberos_ldap_group_acl
 instead of ext_ldap_group_acl
In-Reply-To: <5ef9162d0bea9bc93fe70fcfcc95a484@open.ch>
References: <5ef9162d0bea9bc93fe70fcfcc95a484@open.ch>
Message-ID: <54BE53B2.9070200@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 21/01/2015 1:38 a.m., Simon Staeheli wrote:
>> Whatever floats your boat. The point of the Addon/Plugin/helpers
>> API is that you can use scripts if thy serve your needs better.
>> 
>> All the usual Open Source benefits of "many eyeballs" and
>> somebody else doing code maintenance for you applies to using a
>> bundled helper over a custom written one.
>> 
>> Beyond that the kerberos helper also provides automatic detection
>> of which LDAP server to use via mutiple auto-configuration
>> methods.
>> 
>> If you can demonstrate that the ext_kerberos_ldap_group_acl does 
>> provides a superset of the functionality of ext_ldap_group_acl
>> helper then I can de-duplicate the two helpers.
>> 
>> Amos
> 
> Thanks for the hint regarding automatic detection of LDAP servers.
> I am just trying to find what the differences between the two
> helpers are and which one does fit my needs better. Any others?
> 

Nothing I can pick out easily.

> Do you know anything about the feature in
> ext_kerberos_ldap_group_acl mentioned by Markus Moeller in an
> earlier post?
> 
> "I have a new method in my squid 3.4 patch which uses the Group 
> Information MS is putting in the ticket. This would eliminate the
> ldap lookup completely." 
> (http://www.squid-cache.org/mail-archive/squid-users/201309/0046.html)
>
> 
I think that refers to a work in progress. Markus maintains the
un-bundled version of his helpers a little in advance of what has made
it into the Squid stable branch. Some of what is available in his
helper downloads is only in the Squid-3.HEAD alpha development code so
far.

I am working on obsoleting the need for external group helpers. From
3.5 auth helpers can deliver to Squid a set of group= kv-pair in their
response. Those can be used with the note ACL type to check group
names without any external_acl_type helper lookup (making group checks
possible in 'fast' access controls).

Markus joined me in this project and his latest kerberos auth helper
(in 3.HEAD and his versions - *not* the 3.5 bundled version) produces
group= kv-pair. Unfortunately they are in the obscure S-*-*-* registry
ID format MS uses. The external_acl_type helper interface cannot yet
be passed notes to decipher that to a known group name.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUvlOyAAoJELJo5wb/XPRjZskH/3VQdCv4juTHZ0QAOyQvCdLP
L1ZRDF/ix4MkVIsblsPL20G1KznKRbDBdDZ+DWM4lHDp7m1rwXD972GUmI7JZQDV
VvjQVMrXfZ3h8VcwpzPXKKiIOJp3+P5e7XpVDQGYAzOBJjnvs2OsIKGGsGwo4kXE
lElRU9WbspurY4ic07hjSCcM3VAdWMtIy8FVoq2bdegH6qor1dGeoVIMYVnSOBUG
9gTqWBYxkltI5S19f6zWjk2Kscn7ZYWvPezN38NHouL4ueM0rAHxvUNP2ueudUwR
tZBavBNpiCJ08dXbhU1nUivyTQX99w8t0VMmYeomTc2Q7znofsX0FefFRFZ1GcY=
=Yg6k
-----END PGP SIGNATURE-----


From odhiambo at gmail.com  Tue Jan 20 13:16:59 2015
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Tue, 20 Jan 2015 16:16:59 +0300
Subject: [squid-users] Squid 3.4.11 crashing on FreeBSD 10 (64-bit)
In-Reply-To: <54BE4758.2080102@treenet.co.nz>
References: <CAAdA2WMni5HVEveBHGaXx1YXRAbWAmbQUfXfOiM=oSrqc4VWAw@mail.gmail.com>
 <54BD1AF2.4070003@gmail.com>
 <CAAdA2WOxhvDBwCtg5qit_aj2G0GVjarJqBWC+nd_buRQ0yrBZw@mail.gmail.com>
 <54BD2CB1.5040206@treenet.co.nz>
 <CAAdA2WPceDYjSs3hU2XfGvK06TsRzGPgdsKmYRDdM=Bw4BCphg@mail.gmail.com>
 <54BE4758.2080102@treenet.co.nz>
Message-ID: <CAAdA2WPCK+qu5Z8fA13_7yNNPxDi_k-0=sSUcDYqOsOT++Fp6w@mail.gmail.com>

On 20 January 2015 at 15:17, Amos Jeffries <squid3 at treenet.co.nz> wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> I have just fixed a few clang detected build errors and 3.5 is now
> building cleanly here on FreeBSD 10 with the default Clang.
>
> Please try to build the latest 3.5 snapshot (which will be labeled
> r13735 or higher). It should build fine with either the system default
> clang compiler or your GCC 4.9 install, but not with the system
> default GCC 4.4.
>
>
I will check on that.
However, I earlier today managed to compile 3.5.0.4 using clang. The
problem I have been facing now is about 'forwarding loop detected' over and
over... checking on my PF rules hasn't yielded anything.
And I am now wondering why 3.4.11 wasn't seeing these forwarding loops..



> > (gdb) bt #0  0x0000000803a30469 in swapcontext () from
> > /lib/libthr.so.3 #1  0x0000000803a30062 in sigaction () from
> > /lib/libthr.so.3 #2  <signal handler called> #3  0x0000000803d6b04a
> > in kevent () from /lib/libc.so.7 #4  0x000000000086335c in
> > Comm::DoSelect (msec=981) at ModKqueue.cc:264
>
>
> Looks like a bug in the system threading library. Though why Squid is
> triggering it is unknown. Maybe related to the two GCC versions with
> different libc perhapse?
>

I only have one gcc version on my system -gcc49



-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254733744121/+254722743223
"I can't hear you -- I'm using the scrambler."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150120/c9d6747d/attachment.htm>

From bpk678 at gmail.com  Tue Jan 20 13:32:15 2015
From: bpk678 at gmail.com (Brendan Kearney)
Date: Tue, 20 Jan 2015 08:32:15 -0500
Subject: [squid-users] benefits of using ext_kerberos_ldap_group_acl
 instead of ext_ldap_group_acl
In-Reply-To: <54BE53B2.9070200@treenet.co.nz>
References: <5ef9162d0bea9bc93fe70fcfcc95a484@open.ch>
 <54BE53B2.9070200@treenet.co.nz>
Message-ID: <1421760735.2688.2.camel@desktop.bpk2.com>

On Wed, 2015-01-21 at 02:10 +1300, Amos Jeffries wrote:
> On 21/01/2015 1:38 a.m., Simon Staeheli wrote:
> >> Whatever floats your boat. The point of the Addon/Plugin/helpers
> >> API is that you can use scripts if thy serve your needs better.
> >> 
> >> All the usual Open Source benefits of "many eyeballs" and
> >> somebody else doing code maintenance for you applies to using a
> >> bundled helper over a custom written one.
> >> 
> >> Beyond that the kerberos helper also provides automatic detection
> >> of which LDAP server to use via mutiple auto-configuration
> >> methods.
> >> 
> >> If you can demonstrate that the ext_kerberos_ldap_group_acl does 
> >> provides a superset of the functionality of ext_ldap_group_acl
> >> helper then I can de-duplicate the two helpers.
> >> 
> >> Amos
> > 
> > Thanks for the hint regarding automatic detection of LDAP servers.
> > I am just trying to find what the differences between the two
> > helpers are and which one does fit my needs better. Any others?
> > 
> 
> Nothing I can pick out easily.
> 
> > Do you know anything about the feature in
> > ext_kerberos_ldap_group_acl mentioned by Markus Moeller in an
> > earlier post?
> > 
> > "I have a new method in my squid 3.4 patch which uses the Group 
> > Information MS is putting in the ticket. This would eliminate the
> > ldap lookup completely." 
> > (http://www.squid-cache.org/mail-archive/squid-users/201309/0046.html)
> >
> > 
> I think that refers to a work in progress. Markus maintains the
> un-bundled version of his helpers a little in advance of what has made
> it into the Squid stable branch. Some of what is available in his
> helper downloads is only in the Squid-3.HEAD alpha development code so
> far.
> 
> I am working on obsoleting the need for external group helpers. From
> 3.5 auth helpers can deliver to Squid a set of group= kv-pair in their
> response. Those can be used with the note ACL type to check group
> names without any external_acl_type helper lookup (making group checks
> possible in 'fast' access controls).

will the 'fast' acl's (or the underlying code) use the kerberos keytab
as an option for authentication to ldap?  this will remove the
credentials from a plain text file on the filesystem.

> Markus joined me in this project and his latest kerberos auth helper
> (in 3.HEAD and his versions - *not* the 3.5 bundled version) produces
> group= kv-pair. Unfortunately they are in the obscure S-*-*-* registry
> ID format MS uses. The external_acl_type helper interface cannot yet
> be passed notes to decipher that to a known group name.
> 
> Amos
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users





From squid3 at treenet.co.nz  Tue Jan 20 13:48:44 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 21 Jan 2015 02:48:44 +1300
Subject: [squid-users] benefits of using ext_kerberos_ldap_group_acl
 instead of ext_ldap_group_acl
In-Reply-To: <1421760735.2688.2.camel@desktop.bpk2.com>
References: <5ef9162d0bea9bc93fe70fcfcc95a484@open.ch>	
 <54BE53B2.9070200@treenet.co.nz> <1421760735.2688.2.camel@desktop.bpk2.com>
Message-ID: <54BE5CBC.8020607@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 21/01/2015 2:32 a.m., Brendan Kearney wrote:
> On Wed, 2015-01-21 at 02:10 +1300, Amos Jeffries wrote:
>> On 21/01/2015 1:38 a.m., Simon Staeheli wrote:
>>>> Whatever floats your boat. The point of the
>>>> Addon/Plugin/helpers API is that you can use scripts if thy
>>>> serve your needs better.
>>>> 
>>>> All the usual Open Source benefits of "many eyeballs" and 
>>>> somebody else doing code maintenance for you applies to using
>>>> a bundled helper over a custom written one.
>>>> 
>>>> Beyond that the kerberos helper also provides automatic
>>>> detection of which LDAP server to use via mutiple
>>>> auto-configuration methods.
>>>> 
>>>> If you can demonstrate that the ext_kerberos_ldap_group_acl
>>>> does provides a superset of the functionality of
>>>> ext_ldap_group_acl helper then I can de-duplicate the two
>>>> helpers.
>>>> 
>>>> Amos
>>> 
>>> Thanks for the hint regarding automatic detection of LDAP
>>> servers. I am just trying to find what the differences between
>>> the two helpers are and which one does fit my needs better. Any
>>> others?
>>> 
>> 
>> Nothing I can pick out easily.
>> 
>>> Do you know anything about the feature in 
>>> ext_kerberos_ldap_group_acl mentioned by Markus Moeller in an 
>>> earlier post?
>>> 
>>> "I have a new method in my squid 3.4 patch which uses the Group
>>>  Information MS is putting in the ticket. This would eliminate
>>> the ldap lookup completely." 
>>> (http://www.squid-cache.org/mail-archive/squid-users/201309/0046.html)
>>>
>>>
>>
>>> 
I think that refers to a work in progress. Markus maintains the
>> un-bundled version of his helpers a little in advance of what has
>> made it into the Squid stable branch. Some of what is available
>> in his helper downloads is only in the Squid-3.HEAD alpha
>> development code so far.
>> 
>> I am working on obsoleting the need for external group helpers.
>> From 3.5 auth helpers can deliver to Squid a set of group=
>> kv-pair in their response. Those can be used with the note ACL
>> type to check group names without any external_acl_type helper
>> lookup (making group checks possible in 'fast' access controls).
> 
> will the 'fast' acl's (or the underlying code) use the kerberos
> keytab as an option for authentication to ldap?  this will remove
> the credentials from a plain text file on the filesystem.

'fast' ACLs are limited to what state Squid has in memory at the point
in time when they are checked. There is no possibility of asynchronous
lookups, I/O, or filesystem access.

The note ACL compares a text string loaded from squid.conf (the ACL
defined value to match) with a text string kv-pair returned by the a
helper. In this case a "group=X" kv-pair from auth helper. It is up to
the helper what it uses to produce that kv-pair. I believe Markus
helper pulls the group field(s) directly from the keytab.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUvly7AAoJELJo5wb/XPRjQxsIAJIv8mVOlhzgIow7QxXS96q0
VZOT8BQFtKhPlB/pCIQztj1FKBIsnBB7TET41PBzjGe8wrpjJmLBuOCTIStx5j8I
dAVt9Rp0W7ILPx57vgnewAqoESRVIJtedSgAzblCX2bt3PIhJVECGH95JLIVSzDq
h1e1v0gy7evwJMkE+a9i6j3jCiFeYqnM3TTpVcxJRC0vRVIuyegBnqvLTWqX0sIT
Kmej+sDjPvQ+Jgub/V++JR4NMzXZy8H/oYgfcQaNVilxzANEsKEcmGhYg20FLEJv
5j4Q1a5k7MKeFSA3YwRFtIS/Jze7ji0K41O3kQYlZuHBe0xGnT5+rVD103fmlVs=
=m1FO
-----END PGP SIGNATURE-----


From odhiambo at gmail.com  Tue Jan 20 17:11:25 2015
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Tue, 20 Jan 2015 20:11:25 +0300
Subject: [squid-users] Squid 3.4.11 crashing on FreeBSD 10 (64-bit)
In-Reply-To: <CAAdA2WPCK+qu5Z8fA13_7yNNPxDi_k-0=sSUcDYqOsOT++Fp6w@mail.gmail.com>
References: <CAAdA2WMni5HVEveBHGaXx1YXRAbWAmbQUfXfOiM=oSrqc4VWAw@mail.gmail.com>
 <54BD1AF2.4070003@gmail.com>
 <CAAdA2WOxhvDBwCtg5qit_aj2G0GVjarJqBWC+nd_buRQ0yrBZw@mail.gmail.com>
 <54BD2CB1.5040206@treenet.co.nz>
 <CAAdA2WPceDYjSs3hU2XfGvK06TsRzGPgdsKmYRDdM=Bw4BCphg@mail.gmail.com>
 <54BE4758.2080102@treenet.co.nz>
 <CAAdA2WPCK+qu5Z8fA13_7yNNPxDi_k-0=sSUcDYqOsOT++Fp6w@mail.gmail.com>
Message-ID: <CAAdA2WPZvmEmxeOUUFzmhWsEE0a1-V6F=duUtKPJRcaU-M4-Pw@mail.gmail.com>

On 20 January 2015 at 16:16, Odhiambo Washington <odhiambo at gmail.com> wrote:

>
>
> On 20 January 2015 at 15:17, Amos Jeffries <squid3 at treenet.co.nz> wrote:
>
>> -----BEGIN PGP SIGNED MESSAGE-----
>> Hash: SHA1
>>
>> I have just fixed a few clang detected build errors and 3.5 is now
>> building cleanly here on FreeBSD 10 with the default Clang.
>>
>> Please try to build the latest 3.5 snapshot (which will be labeled
>> r13735 or higher). It should build fine with either the system default
>> clang compiler or your GCC 4.9 install, but not with the system
>> default GCC 4.4.
>>
>>
> I will check on that.
> However, I earlier today managed to compile 3.5.0.4 using clang. The
> problem I have been facing now is about 'forwarding loop detected' over and
> over... checking on my PF rules hasn't yielded anything.
> And I am now wondering why 3.4.11 wasn't seeing these forwarding loops..
>
>
>
>> > (gdb) bt #0  0x0000000803a30469 in swapcontext () from
>> > /lib/libthr.so.3 #1  0x0000000803a30062 in sigaction () from
>> > /lib/libthr.so.3 #2  <signal handler called> #3  0x0000000803d6b04a
>> > in kevent () from /lib/libc.so.7 #4  0x000000000086335c in
>> > Comm::DoSelect (msec=981) at ModKqueue.cc:264
>>
>>
>> Looks like a bug in the system threading library. Though why Squid is
>> triggering it is unknown. Maybe related to the two GCC versions with
>> different libc perhapse?
>>
>
> I only have one gcc version on my system -gcc49
>
>
>
root at mail:/home/wash/ILI/Squid/3.5/squid-3.5.1-20150120-r13736 #
/opt/squid35/sbin/squid -v
Squid Cache: Version 3.5.1-20150120-r13736
Service Name: squid
configure options:  '--prefix=/opt/squid35' '--enable-removal-policies=lru
heap' '--disable-epoll' '--enable-auth' '--enable-auth-basic=DB NCSA PAM
PAM POP3 SSPI' '--enable-external-acl-helpers=session unix_group
file_userip' '--enable-auth-negotiate=kerberos' '--with-pthreads'
'--enable-storeio=ufs diskd rock aufs' '--enable-delay-pools'
'--enable-snmp' '--with-openssl=/usr' '--enable-forw-via-db'
'--enable-cache-digests' '--enable-wccpv2'
'--enable-follow-x-forwarded-for' '--with-large-files'
'--enable-large-cache-files' '--enable-esi' '--enable-kqueue'
'--enable-icap-client' '--enable-kill-parent-hack' '--enable-ssl'
'--enable-leakfinder' '--enable-ssl-crtd' '--enable-url-rewrite-helpers'
'--enable-xmalloc-statistics' '--enable-stacktraces' '--enable-zph-qos'
'--enable-eui' '--enable-pf-transparent' 'CC=clang' 'CXX=clang++'
--enable-ltdl-convenience


1. I see these in cache.log


2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
2015/01/20 20:00:18| Logfile: opening log
stdio:/usr/local/squid/logs/access.log


But then I have no joy because of "2015/01/20 20:03:55| WARNING: Forwarding
loop detected for:.."

I am almost thinking FreeBSD 9.3 would be better... I haven't seen so much
grief.


ADDENDUM:
When compiled with --enable-ipf-transparent, it fails to compile as follows:



root at mail:/home/wash/ILI/Squid/3.5/squid-3.5.1-20150120-r13736 # make
Making all in compat
depbase=`echo assert.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`; /bin/sh
../libtool  --tag=CXX    --mode=compile clang++ -DHAVE_CONFIG_H    -I..
-I../include  -I../lib -I../src  -I../include  -I/usr/include
 -I/usr/include  -I../libltdl -I/usr/include -I/usr/local/include/libxml2
 -I/usr/local/include/libxml2  -Werror -Qunused-arguments  -D_REENTRANT -g
-O2 -march=native -I/usr/local/include -MT assert.lo -MD -MP -MF
$depbase.Tpo -c -o assert.lo assert.cc && mv -f $depbase.Tpo
$depbase.Plolibtool: compile:  clang++ -DHAVE_CONFIG_H -I.. -I../include
-I../lib -I../src -I../include -I/usr/include -I/usr/include -I../libltdl
-I/usr/include -I/usr/local/include/libxml2 -I/usr/local/include/libxml2
-Werror -Qunused-arguments -D_REENTRANT -g -O2 -march=native
-I/usr/local/include -MT assert.lo -MD -MP -MF .deps/assert.Tpo -c
assert.cc  -fPIC -DPIC -o .libs/assert.o
In file included from assert.cc:9:
In file included from ../include/squid.h:43:
../compat/compat.h:49:57: error: expected value in expression
#if IPF_TRANSPARENT && USE_SOLARIS_IPFILTER_MINOR_T_HACK
                                                        ^
1 error generated.
*** Error code 1

Stop.
make[1]: stopped in
/usr/home/wash/ILI/Squid/3.5/squid-3.5.1-20150120-r13736/compat
*** Error code 1

Stop.
make: stopped in /usr/home/wash/ILI/Squid/3.5/squid-3.5.1-20150120-r13736







-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254733744121/+254722743223
"I can't hear you -- I'm using the scrambler."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150120/102365b8/attachment.htm>

From yvoinov at gmail.com  Tue Jan 20 18:28:31 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Wed, 21 Jan 2015 00:28:31 +0600
Subject: [squid-users] Squid 3.4.11 crashing on FreeBSD 10 (64-bit)
In-Reply-To: <CAAdA2WPZvmEmxeOUUFzmhWsEE0a1-V6F=duUtKPJRcaU-M4-Pw@mail.gmail.com>
References: <CAAdA2WMni5HVEveBHGaXx1YXRAbWAmbQUfXfOiM=oSrqc4VWAw@mail.gmail.com>
 <54BD1AF2.4070003@gmail.com>
 <CAAdA2WOxhvDBwCtg5qit_aj2G0GVjarJqBWC+nd_buRQ0yrBZw@mail.gmail.com>
 <54BD2CB1.5040206@treenet.co.nz>
 <CAAdA2WPceDYjSs3hU2XfGvK06TsRzGPgdsKmYRDdM=Bw4BCphg@mail.gmail.com>
 <54BE4758.2080102@treenet.co.nz>
 <CAAdA2WPCK+qu5Z8fA13_7yNNPxDi_k-0=sSUcDYqOsOT++Fp6w@mail.gmail.com>
 <CAAdA2WPZvmEmxeOUUFzmhWsEE0a1-V6F=duUtKPJRcaU-M4-Pw@mail.gmail.com>
Message-ID: <54BE9E4F.90102@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 

20.01.2015 23:11, Odhiambo Washington ?????:
>
>
> On 20 January 2015 at 16:16, Odhiambo Washington <odhiambo at gmail.com
<mailto:odhiambo at gmail.com>> wrote:
>
>
>
>     On 20 January 2015 at 15:17, Amos Jeffries <squid3 at treenet.co.nz
<mailto:squid3 at treenet.co.nz>> wrote:
>
>         -----BEGIN PGP SIGNED MESSAGE-----
>         Hash: SHA1
>
>         I have just fixed a few clang detected build errors and 3.5 is now
>         building cleanly here on FreeBSD 10 with the default Clang.
>
>         Please try to build the latest 3.5 snapshot (which will be labeled
>         r13735 or higher). It should build fine with either the system
default
>         clang compiler or your GCC 4.9 install, but not with the system
>         default GCC 4.4.
>
>
>     I will check on that.
>     However, I earlier today managed to compile 3.5.0.4 using clang.
The problem I have been facing now is about 'forwarding loop detected'
over and over... checking on my PF rules hasn't yielded anything.
>     And I am now wondering why 3.4.11 wasn't seeing these forwarding
loops..
May be, It has another configuration? I.e - has not redirectors, or
web-server on another port, or another NAT settings?
>
>
>
>
>         > (gdb) bt #0  0x0000000803a30469 in swapcontext () from
>         > /lib/libthr.so.3 #1  0x0000000803a30062 in sigaction () from
>         > /lib/libthr.so.3 #2  <signal handler called> #3 
0x0000000803d6b04a
>         > in kevent () from /lib/libc.so.7 #4  0x000000000086335c in
>         > Comm::DoSelect (msec=981) at ModKqueue.cc:264
>
>
>         Looks like a bug in the system threading library. Though why
Squid is
>         triggering it is unknown. Maybe related to the two GCC
versions with
>         different libc perhapse?
>
>
>     I only have one gcc version on my system -gcc49
>
>
>
> root at mail:/home/wash/ILI/Squid/3.5/squid-3.5.1-20150120-r13736 #
/opt/squid35/sbin/squid -v
> Squid Cache: Version 3.5.1-20150120-r13736
> Service Name: squid
> configure options:  '--prefix=/opt/squid35'
'--enable-removal-policies=lru heap' '--disable-epoll' '--enable-auth'
'--enable-auth-basic=DB NCSA PAM PAM POP3 SSPI'
'--enable-external-acl-helpers=session unix_group file_userip'
'--enable-auth-negotiate=kerberos' '--with-pthreads'
'--enable-storeio=ufs diskd rock aufs' '--enable-delay-pools'
'--enable-snmp' '--with-openssl=/usr' '--enable-forw-via-db'
'--enable-cache-digests' '--enable-wccpv2'
'--enable-follow-x-forwarded-for' '--with-large-files'
'--enable-large-cache-files' '--enable-esi' '--enable-kqueue'
'--enable-icap-client' '--enable-kill-parent-hack' '--enable-ssl'
'--enable-leakfinder' '--enable-ssl-crtd' '--enable-url-rewrite-helpers'
'--enable-xmalloc-statistics' '--enable-stacktraces' '--enable-zph-qos'
'--enable-eui' '--enable-pf-transparent' 'CC=clang' 'CXX=clang++'
--enable-ltdl-convenience
>
>
> 1. I see these in cache.log
>
>
> 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
> 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
> 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
> 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
> 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
> 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
> 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
> 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
> 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
> 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
> 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
> 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
> 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
> 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
> 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
permitted
> 2015/01/20 20:00:18| Logfile: opening log
stdio:/usr/local/squid/logs/access.log
>
>
> But then I have no joy because of "2015/01/20 20:03:55| WARNING:
Forwarding loop detected for:.."
Forwarding loop is squid.conf issue, not squid itself. More often you
using one port for proxying and web-server on proxy at the same time.
Either NAT or squid/web server/redirector(s) program configuration.

>
> I am almost thinking FreeBSD 9.3 would be better... I haven't seen so
much grief.
>
>
> ADDENDUM:
> When compiled with --enable-ipf-transparent, it fails to compile as
follows:
You have not IP Filter in FreeBSD. Just IPFW and PF. AFAIK today IP
Filter is absent in xBSD.
>
>
>
> root at mail:/home/wash/ILI/Squid/3.5/squid-3.5.1-20150120-r13736 # make
> Making all in compat
> depbase=`echo assert.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`; /bin/sh
../libtool  --tag=CXX    --mode=compile clang++ -DHAVE_CONFIG_H    -I..
-I../include  -I../lib -I../src  -I../include  -I/usr/include 
-I/usr/include  -I../libltdl -I/usr/include
-I/usr/local/include/libxml2  -I/usr/local/include/libxml2  -Werror
-Qunused-arguments  -D_REENTRANT -g -O2 -march=native
-I/usr/local/include -MT assert.lo -MD -MP -MF $depbase.Tpo -c -o
assert.lo assert.cc && mv -f $depbase.Tpo $depbase.Plolibtool: compile: 
clang++ -DHAVE_CONFIG_H -I.. -I../include -I../lib -I../src -I../include
-I/usr/include -I/usr/include -I../libltdl -I/usr/include
-I/usr/local/include/libxml2 -I/usr/local/include/libxml2 -Werror
-Qunused-arguments -D_REENTRANT -g -O2 -march=native
-I/usr/local/include -MT assert.lo -MD -MP -MF .deps/assert.Tpo -c
assert.cc  -fPIC -DPIC -o .libs/assert.o
> In file included from assert.cc:9:
> In file included from ../include/squid.h:43:
> ../compat/compat.h:49:57: error: expected value in expression
> #if IPF_TRANSPARENT && USE_SOLARIS_IPFILTER_MINOR_T_HACK
>                                                         ^
As I said above....
> 1 error generated.
> *** Error code 1
>
> Stop.
> make[1]: stopped in
/usr/home/wash/ILI/Squid/3.5/squid-3.5.1-20150120-r13736/compat
> *** Error code 1
>
> Stop.
> make: stopped in /usr/home/wash/ILI/Squid/3.5/squid-3.5.1-20150120-r13736
>
>
>
>
>
>
>
> --
> Best regards,
> Odhiambo WASHINGTON,
> Nairobi,KE
> +254733744121/+254722743223
> "I can't hear you -- I'm using the scrambler."
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUvp5OAAoJENNXIZxhPexGA4wIALBZdePahHHA6VU0KZQtEDA0
mCx6UexDoKg6NBab3hIj0o31B8m9komaRAnHscaCnZtx9z3dBqity4Ej/8wjad0r
8r5W3X9OX4Ppi6Pg92Dz/0MkRJmzHtT9LdsEtdD/wehCT7OUxc0+kiYEPRUSQS0T
K9nEXhqfBmUGwlpEvmaIwLdX351v3fpRMNEBrvd/PShlOVAMdX6++P9R8aXlK8yx
8aMKhy6SIQHttJDXjqB+Jcr6QKzXHujAhZ73ydT4Ar2/Ec1yzYnNpGCdetA8uhoV
7QNpoww9SPdnf1oQOXzaw6XBoczZRc7MXZunFhwnrFVksNutt6eJyBeWId835oQ=
=mSFc
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150121/045cf682/attachment.htm>

From squid3 at treenet.co.nz  Tue Jan 20 18:50:27 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 21 Jan 2015 07:50:27 +1300
Subject: [squid-users] Squid 3.4.11 crashing on FreeBSD 10 (64-bit)
In-Reply-To: <CAAdA2WPZvmEmxeOUUFzmhWsEE0a1-V6F=duUtKPJRcaU-M4-Pw@mail.gmail.com>
References: <CAAdA2WMni5HVEveBHGaXx1YXRAbWAmbQUfXfOiM=oSrqc4VWAw@mail.gmail.com>
 <54BD1AF2.4070003@gmail.com>
 <CAAdA2WOxhvDBwCtg5qit_aj2G0GVjarJqBWC+nd_buRQ0yrBZw@mail.gmail.com>
 <54BD2CB1.5040206@treenet.co.nz>
 <CAAdA2WPceDYjSs3hU2XfGvK06TsRzGPgdsKmYRDdM=Bw4BCphg@mail.gmail.com>
 <54BE4758.2080102@treenet.co.nz>
 <CAAdA2WPCK+qu5Z8fA13_7yNNPxDi_k-0=sSUcDYqOsOT++Fp6w@mail.gmail.com>
 <CAAdA2WPZvmEmxeOUUFzmhWsEE0a1-V6F=duUtKPJRcaU-M4-Pw@mail.gmail.com>
Message-ID: <54BEA373.6050403@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 21/01/2015 6:11 a.m., Odhiambo Washington wrote:
> On 20 January 2015 at 16:16, Odhiambo Washington wrote:
> 
> 1. I see these in cache.log
> 
> 
> 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation
> not permitted 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1)
> Operation not permitted 2015/01/20 20:00:18| WARNING: no_suid:
> setuid(0): (1) Operation not permitted 2015/01/20 20:00:18|
> WARNING: no_suid: setuid(0): (1) Operation not permitted 2015/01/20
> 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not permitted 
> 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation
> not permitted 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1)
> Operation not permitted 2015/01/20 20:00:18| WARNING: no_suid:
> setuid(0): (1) Operation not permitted 2015/01/20 20:00:18|
> WARNING: no_suid: setuid(0): (1) Operation not permitted 2015/01/20
> 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not permitted 
> 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation
> not permitted 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1)
> Operation not permitted 2015/01/20 20:00:18| WARNING: no_suid:
> setuid(0): (1) Operation not permitted 2015/01/20 20:00:18|
> WARNING: no_suid: setuid(0): (1) Operation not permitted 2015/01/20
> 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not permitted

Not to worry about. An artifact of how Squid runs helpers vs BSD
default permissions for fork()ed processes. Squid is just unable to
drop root permissions silently (for now) because the OS already did it.

> 2015/01/20 20:00:18| Logfile: opening log 
> stdio:/usr/local/squid/logs/access.log
> 
> 
> But then I have no joy because of "2015/01/20 20:03:55| WARNING:
> Forwarding loop detected for:.."
> 
> I am almost thinking FreeBSD 9.3 would be better... I haven't seen
> so much grief.

I am beginning to wonder if the PF version may has changed in FreeBSD.

In OpenBSD (4.6 IIRC) PF went from a version where rdr-to rules worked
to one where only divert-to would work reliably and rdr-to only
sometimes. It may be that the changover has finally hit FreeBSD.

> ADDENDUM: When compiled with --enable-ipf-transparent, it fails to
> compile as follows:
> 

As Yuri said, PF --enable-pf-transparent (no 'I') or IPFW
- --enable-ipfw-transparent (note the 'W') for FreeBSD.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUvqNzAAoJELJo5wb/XPRjywsH/RY9myLQSx/FaQf6gmWykbd7
/bNXzg0JxoiUar56gYseUk6yEp9YhtSpAFEFnVaen7ee/4xNW7o8Tv7R0gTrcqWy
lTUFtuPRyP3EQ7tsYNjLgF2dYYX4Eb1E1zDVCmdUHtvG/d7YTnC9LgLYrNqgF9v6
Bgck0S2aC2Q4vdsn34LsjbgKmtnpqr+47I4Eco5TfyHZvsCHp2EUb0RwgA/hus8E
Q0x6Jnmv1idIywsuLXhCbPtsriWXJf38cDtOs6UNFmAo0fr762oBH94i2xXIDb1Y
8qZzOGS09G93qWn027UZmqWHlcH8p3c0fo17LqXekcrBGW2gxd82+ABvbH6JZBk=
=tAVB
-----END PGP SIGNATURE-----


From odhiambo at gmail.com  Tue Jan 20 19:33:20 2015
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Tue, 20 Jan 2015 22:33:20 +0300
Subject: [squid-users] Squid 3.4.11 crashing on FreeBSD 10 (64-bit)
In-Reply-To: <54BE9E4F.90102@gmail.com>
References: <CAAdA2WMni5HVEveBHGaXx1YXRAbWAmbQUfXfOiM=oSrqc4VWAw@mail.gmail.com>
 <54BD1AF2.4070003@gmail.com>
 <CAAdA2WOxhvDBwCtg5qit_aj2G0GVjarJqBWC+nd_buRQ0yrBZw@mail.gmail.com>
 <54BD2CB1.5040206@treenet.co.nz>
 <CAAdA2WPceDYjSs3hU2XfGvK06TsRzGPgdsKmYRDdM=Bw4BCphg@mail.gmail.com>
 <54BE4758.2080102@treenet.co.nz>
 <CAAdA2WPCK+qu5Z8fA13_7yNNPxDi_k-0=sSUcDYqOsOT++Fp6w@mail.gmail.com>
 <CAAdA2WPZvmEmxeOUUFzmhWsEE0a1-V6F=duUtKPJRcaU-M4-Pw@mail.gmail.com>
 <54BE9E4F.90102@gmail.com>
Message-ID: <CAAdA2WMeeZCO8LVNStG3rRjtE=R8WO1O2fRcx2Sk0bE6js6urw@mail.gmail.com>

Yuri,

You need a sane MuA.

What you have makes life quite difficult for me reading your responses. And
I read from gmail web UI.

Just to answer you..


On 20 January 2015 at 21:28, Yuri Voinov <yvoinov at gmail.com> wrote:

>
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
>
> 20.01.2015 23:11, Odhiambo Washington ?????:
> >
> >
> > On 20 January 2015 at 16:16, Odhiambo Washington <odhiambo at gmail.com
> <mailto:odhiambo at gmail.com> <odhiambo at gmail.com>> wrote:
> >
> >
> >
> >     On 20 January 2015 at 15:17, Amos Jeffries <squid3 at treenet.co.nz
> <mailto:squid3 at treenet.co.nz> <squid3 at treenet.co.nz>> wrote:
> >
> >         -----BEGIN PGP SIGNED MESSAGE-----
> >         Hash: SHA1
> >
> >         I have just fixed a few clang detected build errors and 3.5 is
> now
> >         building cleanly here on FreeBSD 10 with the default Clang.
> >
> >         Please try to build the latest 3.5 snapshot (which will be
> labeled
> >         r13735 or higher). It should build fine with either the system
> default
> >         clang compiler or your GCC 4.9 install, but not with the system
> >         default GCC 4.4.
> >
> >
> >     I will check on that.
> >     However, I earlier today managed to compile 3.5.0.4 using clang. The
> problem I have been facing now is about 'forwarding loop detected' over and
> over... checking on my PF rules hasn't yielded anything.
> >     And I am now wondering why 3.4.11 wasn't seeing these forwarding
> loops..
> May be, It has another configuration? I.e - has not redirectors, or
> web-server on another port, or another NAT settings?
>




>
> >
> >
> >
> >
> >         > (gdb) bt #0  0x0000000803a30469 in swapcontext () from
> >         > /lib/libthr.so.3 #1  0x0000000803a30062 in sigaction () from
> >         > /lib/libthr.so.3 #2  <signal handler called> #3
> 0x0000000803d6b04a
> >         > in kevent () from /lib/libc.so.7 #4  0x000000000086335c in
> >         > Comm::DoSelect (msec=981) at ModKqueue.cc:264
> >
> >
> >         Looks like a bug in the system threading library. Though why
> Squid is
> >         triggering it is unknown. Maybe related to the two GCC versions
> with
> >         different libc perhapse?
> >
> >
> >     I only have one gcc version on my system -gcc49
> >
> >
> >
> > root at mail:/home/wash/ILI/Squid/3.5/squid-3.5.1-20150120-r13736 #
> /opt/squid35/sbin/squid -v
> > Squid Cache: Version 3.5.1-20150120-r13736
> > Service Name: squid
> > configure options:  '--prefix=/opt/squid35'
> '--enable-removal-policies=lru heap' '--disable-epoll' '--enable-auth'
> '--enable-auth-basic=DB NCSA PAM PAM POP3 SSPI'
> '--enable-external-acl-helpers=session unix_group file_userip'
> '--enable-auth-negotiate=kerberos' '--with-pthreads' '--enable-storeio=ufs
> diskd rock aufs' '--enable-delay-pools' '--enable-snmp'
> '--with-openssl=/usr' '--enable-forw-via-db' '--enable-cache-digests'
> '--enable-wccpv2' '--enable-follow-x-forwarded-for' '--with-large-files'
> '--enable-large-cache-files' '--enable-esi' '--enable-kqueue'
> '--enable-icap-client' '--enable-kill-parent-hack' '--enable-ssl'
> '--enable-leakfinder' '--enable-ssl-crtd' '--enable-url-rewrite-helpers'
> '--enable-xmalloc-statistics' '--enable-stacktraces' '--enable-zph-qos'
> '--enable-eui' '--enable-pf-transparent' 'CC=clang' 'CXX=clang++'
> --enable-ltdl-convenience
> >
> >
> > 1. I see these in cache.log
> >
> >
> > 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
> permitted
> > 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
> permitted
> > 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
> permitted
> > 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
> permitted
> > 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
> permitted
> > 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
> permitted
> > 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
> permitted
> > 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
> permitted
> > 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
> permitted
> > 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
> permitted
> > 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
> permitted
> > 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
> permitted
> > 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
> permitted
> > 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
> permitted
> > 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not
> permitted
> > 2015/01/20 20:00:18| Logfile: opening log
> stdio:/usr/local/squid/logs/access.log
> >
> >
> > But then I have no joy because of "2015/01/20 20:03:55| WARNING:
> Forwarding loop detected for:.."
> Forwarding loop is squid.conf issue, not squid itself. More often you
> using one port for proxying and web-server on proxy at the same time.
> Either NAT or squid/web server/redirector(s) program configuration.
>

None of those. I read the HOWTO very well. I use Squid+IPFilter on several
FreeBSD servers already. My configs are fine. I run squid on 13128 which is
different than what I run web server on. No port conflict.


>
>
> >
> > I am almost thinking FreeBSD 9.3 would be better... I haven't seen so
> much grief.
> >
> >
> > ADDENDUM:
> > When compiled with --enable-ipf-transparent, it fails to compile as
> follows:
> You have not IP Filter in FreeBSD. Just IPFW and PF. AFAIK today IP Filter
> is absent in xBSD.
>

 I will check that. Anyway, I did not compile it eventually. I am working
with PF and have configured it proerly (I believe) yet I still have this
agony.




>
> >
> >
> >
> > root at mail:/home/wash/ILI/Squid/3.5/squid-3.5.1-20150120-r13736 # make
> > Making all in compat
> > depbase=`echo assert.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`; /bin/sh
> ../libtool  --tag=CXX    --mode=compile clang++ -DHAVE_CONFIG_H    -I..
> -I../include  -I../lib -I../src  -I../include  -I/usr/include
> -I/usr/include  -I../libltdl -I/usr/include -I/usr/local/include/libxml2
> -I/usr/local/include/libxml2  -Werror -Qunused-arguments  -D_REENTRANT -g
> -O2 -march=native -I/usr/local/include -MT assert.lo -MD -MP -MF
> $depbase.Tpo -c -o assert.lo assert.cc && mv -f $depbase.Tpo
> $depbase.Plolibtool: compile:  clang++ -DHAVE_CONFIG_H -I.. -I../include
> -I../lib -I../src -I../include -I/usr/include -I/usr/include -I../libltdl
> -I/usr/include -I/usr/local/include/libxml2 -I/usr/local/include/libxml2
> -Werror -Qunused-arguments -D_REENTRANT -g -O2 -march=native
> -I/usr/local/include -MT assert.lo -MD -MP -MF .deps/assert.Tpo -c
> assert.cc  -fPIC -DPIC -o .libs/assert.o
> > In file included from assert.cc:9:
> > In file included from ../include/squid.h:43:
> > ../compat/compat.h:49:57: error: expected value in expression
> > #if IPF_TRANSPARENT && USE_SOLARIS_IPFILTER_MINOR_T_HACK
> >                                                         ^
> As I said above....
>

Sure.


-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254733744121/+254722743223
"I can't hear you -- I'm using the scrambler."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150120/1b4d104f/attachment.htm>

From odhiambo at gmail.com  Tue Jan 20 19:39:29 2015
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Tue, 20 Jan 2015 22:39:29 +0300
Subject: [squid-users] Squid 3.4.11 crashing on FreeBSD 10 (64-bit)
In-Reply-To: <54BEA373.6050403@treenet.co.nz>
References: <CAAdA2WMni5HVEveBHGaXx1YXRAbWAmbQUfXfOiM=oSrqc4VWAw@mail.gmail.com>
 <54BD1AF2.4070003@gmail.com>
 <CAAdA2WOxhvDBwCtg5qit_aj2G0GVjarJqBWC+nd_buRQ0yrBZw@mail.gmail.com>
 <54BD2CB1.5040206@treenet.co.nz>
 <CAAdA2WPceDYjSs3hU2XfGvK06TsRzGPgdsKmYRDdM=Bw4BCphg@mail.gmail.com>
 <54BE4758.2080102@treenet.co.nz>
 <CAAdA2WPCK+qu5Z8fA13_7yNNPxDi_k-0=sSUcDYqOsOT++Fp6w@mail.gmail.com>
 <CAAdA2WPZvmEmxeOUUFzmhWsEE0a1-V6F=duUtKPJRcaU-M4-Pw@mail.gmail.com>
 <54BEA373.6050403@treenet.co.nz>
Message-ID: <CAAdA2WOHdW5kyQ4Cbdd6sU15fGs_X38DgjULbhm1p=WO0=W9iQ@mail.gmail.com>

On 20 January 2015 at 21:50, Amos Jeffries <squid3 at treenet.co.nz> wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 21/01/2015 6:11 a.m., Odhiambo Washington wrote:
> > On 20 January 2015 at 16:16, Odhiambo Washington wrote:
> >
> > 1. I see these in cache.log
> >
> >
> > 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation
> > not permitted 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1)
> > Operation not permitted 2015/01/20 20:00:18| WARNING: no_suid:
> > setuid(0): (1) Operation not permitted 2015/01/20 20:00:18|
> > WARNING: no_suid: setuid(0): (1) Operation not permitted 2015/01/20
> > 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not permitted
> > 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation
> > not permitted 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1)
> > Operation not permitted 2015/01/20 20:00:18| WARNING: no_suid:
> > setuid(0): (1) Operation not permitted 2015/01/20 20:00:18|
> > WARNING: no_suid: setuid(0): (1) Operation not permitted 2015/01/20
> > 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not permitted
> > 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1) Operation
> > not permitted 2015/01/20 20:00:18| WARNING: no_suid: setuid(0): (1)
> > Operation not permitted 2015/01/20 20:00:18| WARNING: no_suid:
> > setuid(0): (1) Operation not permitted 2015/01/20 20:00:18|
> > WARNING: no_suid: setuid(0): (1) Operation not permitted 2015/01/20
> > 20:00:18| WARNING: no_suid: setuid(0): (1) Operation not permitted
>
> Not to worry about. An artifact of how Squid runs helpers vs BSD
> default permissions for fork()ed processes. Squid is just unable to
> drop root permissions silently (for now) because the OS already did it.
>


Okay.


>
> > 2015/01/20 20:00:18| Logfile: opening log
> > stdio:/usr/local/squid/logs/access.log
> >
> >
> > But then I have no joy because of "2015/01/20 20:03:55| WARNING:
> > Forwarding loop detected for:.."
> >
> > I am almost thinking FreeBSD 9.3 would be better... I haven't seen
> > so much grief.
>
> I am beginning to wonder if the PF version may has changed in FreeBSD.
>

Perhaps I should check, because I am finding it very weird.


>
> In OpenBSD (4.6 IIRC) PF went from a version where rdr-to rules worked
> to one where only divert-to would work reliably and rdr-to only
> sometimes. It may be that the changover has finally hit FreeBSD.
>

The OpenBSD one is quite different from the FreeBSD one. They 'parted' ways
in development/syntax.


>
> > ADDENDUM: When compiled with --enable-ipf-transparent, it fails to
> > compile as follows:
> >
>
> As Yuri said, PF --enable-pf-transparent (no 'I') or IPFW
> - --enable-ipfw-transparent (note the 'W') for FreeBSD.
>

I know this. I was just mentioning. I think I believe Yuri that IPFilter
isn't in FreeBSD.
I think I am going to have to suck it in, because I am happy with it in
many servers, working nicely with Squid.



-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254733744121/+254722743223
"I can't hear you -- I'm using the scrambler."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150120/f71481e0/attachment.htm>

From cinaed.simson at gmail.com  Tue Jan 20 19:54:08 2015
From: cinaed.simson at gmail.com (Cinaed Simson)
Date: Tue, 20 Jan 2015 11:54:08 -0800
Subject: [squid-users] how to configure squid for svn
Message-ID: <54BEB260.7050007@GMail.COM>

Hi - I'm looking for information on how to configure squid-3.4.5 for SVN.

I found this in the SVN FAQ

   extension methods REPORT MERGE MKACTIVITY CHECKOUT

and placed it near the top of squid.conf but it didn't work - squid
didn't like it.

I couldn't find any information in the squid wiki.

-- Ken


From alex.hha at gmail.com  Tue Jan 20 20:14:54 2015
From: alex.hha at gmail.com (Alex Domoradov)
Date: Tue, 20 Jan 2015 22:14:54 +0200
Subject: [squid-users] how to configure squid for svn
In-Reply-To: <54BEB260.7050007@GMail.COM>
References: <54BEB260.7050007@GMail.COM>
Message-ID: <CAK90gp6AV39FUJGf53sSR7cJBqDK-UGEYq1fqA=j8RsNvpNaRA@mail.gmail.com>

AFAIK

squid wouldn't work with mod_dav_svn

On Tue, Jan 20, 2015 at 9:54 PM, Cinaed Simson <cinaed.simson at gmail.com>
wrote:

> Hi - I'm looking for information on how to configure squid-3.4.5 for SVN.
>
> I found this in the SVN FAQ
>
>    extension methods REPORT MERGE MKACTIVITY CHECKOUT
>
> and placed it near the top of squid.conf but it didn't work - squid
> didn't like it.
>
> I couldn't find any information in the squid wiki.
>
> -- Ken
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150120/b7b1faa4/attachment.htm>

From eliezer at ngtech.co.il  Wed Jan 21 01:12:45 2015
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Wed, 21 Jan 2015 03:12:45 +0200
Subject: [squid-users] Squid 3.4.11 crashing on FreeBSD 10 (64-bit)
In-Reply-To: <CAAdA2WOHdW5kyQ4Cbdd6sU15fGs_X38DgjULbhm1p=WO0=W9iQ@mail.gmail.com>
References: <CAAdA2WMni5HVEveBHGaXx1YXRAbWAmbQUfXfOiM=oSrqc4VWAw@mail.gmail.com>
 <54BD1AF2.4070003@gmail.com>
 <CAAdA2WOxhvDBwCtg5qit_aj2G0GVjarJqBWC+nd_buRQ0yrBZw@mail.gmail.com>
 <54BD2CB1.5040206@treenet.co.nz>
 <CAAdA2WPceDYjSs3hU2XfGvK06TsRzGPgdsKmYRDdM=Bw4BCphg@mail.gmail.com>
 <54BE4758.2080102@treenet.co.nz>
 <CAAdA2WPCK+qu5Z8fA13_7yNNPxDi_k-0=sSUcDYqOsOT++Fp6w@mail.gmail.com>
 <CAAdA2WPZvmEmxeOUUFzmhWsEE0a1-V6F=duUtKPJRcaU-M4-Pw@mail.gmail.com>
 <54BEA373.6050403@treenet.co.nz>
 <CAAdA2WOHdW5kyQ4Cbdd6sU15fGs_X38DgjULbhm1p=WO0=W9iQ@mail.gmail.com>
Message-ID: <54BEFD0D.8010100@ngtech.co.il>

On 20/01/2015 21:39, Odhiambo Washington wrote:
> I know this. I was just mentioning. I think I believe Yuri that IPFilter
> isn't in FreeBSD.
> I think I am going to have to suck it in, because I am happy with it in
> many servers, working nicely with Squid.

Hey,

 From the FreeBSD handbook a list of firewalls:
https://www.freebsd.org/doc/handbook/firewalls.html

I was just recently testing couple things with FBSD firewalls and I am 
curios on how would the firewall(pf,ipfw,others...) rules look like for 
tproxy and intercept.

Thanks,
Eliezer



From squid3 at treenet.co.nz  Wed Jan 21 04:35:58 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 21 Jan 2015 17:35:58 +1300
Subject: [squid-users] how to configure squid for svn
In-Reply-To: <CAK90gp6AV39FUJGf53sSR7cJBqDK-UGEYq1fqA=j8RsNvpNaRA@mail.gmail.com>
References: <54BEB260.7050007@GMail.COM>
 <CAK90gp6AV39FUJGf53sSR7cJBqDK-UGEYq1fqA=j8RsNvpNaRA@mail.gmail.com>
Message-ID: <54BF2CAE.1090200@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 21/01/2015 9:14 a.m., Alex Domoradov wrote:
> AFAIK
> 
> squid wouldn't work with mod_dav_svn
> 
> On Tue, Jan 20, 2015 at 9:54 PM, Cinaed Simson wrote:
> 
>> Hi - I'm looking for information on how to configure squid-3.4.5
>> for SVN.
>> 
>> I found this in the SVN FAQ
>> 
>> extension methods REPORT MERGE MKACTIVITY CHECKOUT
>> 
>> and placed it near the top of squid.conf but it didn't work -
>> squid didn't like it.
>> 
>> I couldn't find any information in the squid wiki.

There is nothing needed to be configured. Squid-3 accepts HTTP
extension methods by default. The problem -if you are having one- is
elsewhere.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUvyyuAAoJELJo5wb/XPRj1q4H/igAkz1ROB9ZvA4Od4PrTC1Z
WNZRA9fZIfA/Q+KceIEuGIxWQV1wJer8EtoGSoge5xmzkF2TZPwhbdixhQo2PhHV
MiQ9fUpDlTXdRL0pdS05ReDvMOm86YJHFNb/9vZn7ze7jSpl1bUX57Sid4punujS
LZXe2FSTvoe0c5SklnHLOmYCW8VJWp7wKR+LOHyG32YiZYUG0CTM4E6oXJA/5vxY
CkYVR5ojHa13hr2QCuvotKZtpp225O1vggLRMkx0oGBNvnmzdswu5JoSGUZUo2rx
FB/nB0lYLuBUyXF39Jh+s0KbgyOup+nqhN3QOXJGAXCh9hcUSNjB4U7gpT2Szv8=
=mS54
-----END PGP SIGNATURE-----


From cinaed.simson at gmail.com  Wed Jan 21 05:51:19 2015
From: cinaed.simson at gmail.com (Cinaed Simson)
Date: Tue, 20 Jan 2015 21:51:19 -0800
Subject: [squid-users] how to configure squid for svn
In-Reply-To: <CAK90gp6AV39FUJGf53sSR7cJBqDK-UGEYq1fqA=j8RsNvpNaRA@mail.gmail.com>
References: <54BEB260.7050007@GMail.COM>
 <CAK90gp6AV39FUJGf53sSR7cJBqDK-UGEYq1fqA=j8RsNvpNaRA@mail.gmail.com>
Message-ID: <54BF3E57.9050909@GMail.COM>

Hi - thanks for the reply.

I misread the FAQ - by configuring the server it actually meant
configuring the client to access the server using the file

  ~/.subversion/servers

For example,

[global]
# http-proxy-exceptions = *.exception.com, www.internal-site.org
http-proxy-host = address
http-proxy-port = port
# http-proxy-username = defaultusername
# http-proxy-password = defaultpassword
# http-compression = no


On 01/20/2015 12:14 PM, Alex Domoradov wrote:
> AFAIK
> 
> squid wouldn't work with mod_dav_svn
> 
> On Tue, Jan 20, 2015 at 9:54 PM, Cinaed Simson <cinaed.simson at gmail.com>
> wrote:
> 
>> Hi - I'm looking for information on how to configure squid-3.4.5 for SVN.
>>
>> I found this in the SVN FAQ
>>
>>    extension methods REPORT MERGE MKACTIVITY CHECKOUT
>>
>> and placed it near the top of squid.conf but it didn't work - squid
>> didn't like it.
>>
>> I couldn't find any information in the squid wiki.
>>
>> -- Ken
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>>
> 



From steve at opendium.com  Wed Jan 21 06:50:33 2015
From: steve at opendium.com (Steve Hill)
Date: Wed, 21 Jan 2015 06:50:33 +0000
Subject: [squid-users] ssl_crtd
Message-ID: <54BF4C39.7000109@opendium.com>


At the moment I'm running Squid 3.4 with bump-server-first using the
internal certificate generation stuff (i.e. not ssl_crtd).  I can't find
a lot of information about using/not using ssl_crtd so I was wondering
if anyone can give me a run-down of the pros and cons of using it
instead of the internal cert generator?

Thanks.

-- 

 - Steve Hill
   Technical Director
   Opendium Limited     http://www.opendium.com

Direct contacts:
   Instant messager: xmpp:steve at opendium.com
   Email:            steve at opendium.com
   Phone:            sip:steve at opendium.com

Sales / enquiries contacts:
   Email:            sales at opendium.com
   Phone:            +44-1792-825748 / sip:sales at opendium.com

Support contacts:
   Email:            support at opendium.com
   Phone:            +44-1792-824568 / sip:support at opendium.com


From sis at open.ch  Wed Jan 21 07:12:38 2015
From: sis at open.ch (Simon Staeheli)
Date: Wed, 21 Jan 2015 08:12:38 +0100
Subject: [squid-users]
 =?utf-8?q?benefits_of_using_ext=5Fkerberos=5Fldap?=
 =?utf-8?q?=5Fgroup=5Facl__instead_of_ext=5Fldap=5Fgroup=5Facl?=
Message-ID: <dcf9752032bc4d72284b6aa5086d30ea@open.ch>

> I think that refers to a work in progress. Markus maintains the
> un-bundled version of his helpers a little in advance of what has made
> it into the Squid stable branch. Some of what is available in his
> helper downloads is only in the Squid-3.HEAD alpha development code so
> far.
> 
> I am working on obsoleting the need for external group helpers. From
> 3.5 auth helpers can deliver to Squid a set of group= kv-pair in their
> response. Those can be used with the note ACL type to check group
> names without any external_acl_type helper lookup (making group checks
> possible in 'fast' access controls).
> 
> Markus joined me in this project and his latest kerberos auth helper
> (in 3.HEAD and his versions - *not* the 3.5 bundled version) produces
> group= kv-pair. Unfortunately they are in the obscure S-*-*-* registry
> ID format MS uses. The external_acl_type helper interface cannot yet
> be passed notes to decipher that to a known group name.
> 
> Amos

This sounds like an awesome feature. Have you got an idea when this 
functionality will be added to the stable branch? Something like 'this 
year', 'next year' or later?


From yvoinov at gmail.com  Wed Jan 21 08:35:12 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Wed, 21 Jan 2015 14:35:12 +0600
Subject: [squid-users] Squid project site not available
Message-ID: <54BF64C0.8050403@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
http://i.imgur.com/j7oeNyV.png
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUv2S+AAoJENNXIZxhPexGWg8H/3vpf9mQdV60eX5ot5m0zSwZ
+5bmQmv7+Z8hf4n7Sy/6NGuaDv3bTU9xvp4Kjod6OZn2itNjhOTFKHtc2FV6n6PJ
DRKLugRQuUSil4tx+QQPJptmX8uJVRuORgPH0K5mBcejc2dMVnN2nJSUZozwa3Vb
GEetF1Ccu7HCZq+nwKJU+Fn4GbCU+oVOT5UpKC5dpi0u8PXT2yotUUxLD8+WPlrP
HT5lb/YaMReXWPmbAxkplgV3UmbBt4A87MCNDZypLK7bZfoEYhs0w/tyYC2vk3/w
btcm07u/0Sj7INsaiaLkBrVwYnY8ASMZ7deWhYmgOjB7AkljJTpApjzyqnwdtYU=
=gCCn
-----END PGP SIGNATURE-----



From yvoinov at gmail.com  Wed Jan 21 08:35:12 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Wed, 21 Jan 2015 14:35:12 +0600
Subject: [squid-users] Squid project site not available
Message-ID: <54BF64C0.4090004@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
http://i.imgur.com/j7oeNyV.png
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUv2S4AAoJENNXIZxhPexGVXoH/jiJnsC3eqmwExFwmZTxZ9Jc
6zslBmW9FUsaEJ6zp4XLhGJieTF63BMAjiBEtB00ctEpfwc7fRU7bnVw+O08gfYF
6v8dfPiZqMzz3FT8N30YVQOCX8lBZ2GjsialbOlKt9h94aQJLKFXlgt1PZ5prc24
0MVdv2d0yVBVv+dckZVXrlRNR1fkQ9RMRetEDCgE4YdFpd8bTBz6gq0mVc2LoR52
C11n2e1fPOmmPfStP58MwBEOG613/XGDHDWPb8ADCVQ/8yhcECsyhNxcMhar1dj8
Ndvhz/R5qkIRFpbzQnGodYeK0UG93KT/HQyqQVv57fBhc89K9iR6GaX0C9NtAQQ=
=3hKD
-----END PGP SIGNATURE-----



From Jason_Haar at trimble.com  Wed Jan 21 08:40:07 2015
From: Jason_Haar at trimble.com (Jason Haar)
Date: Wed, 21 Jan 2015 21:40:07 +1300
Subject: [squid-users] ssl-bump doesn't like valid web server
Message-ID: <54BF65E7.2080708@trimble.com>

Hi there

I'm running squid-3.4.10 on CentOS-6 and just got hit with ssl-bump
blocking/warning access to a website which I can't figure out why

It's https://myaccount.snap.net.nz/. Signed by a couple of layers of
intermediary certs, but seems fine (works direct with FF/Chrome/MSIE).
curl on the squid server has no trouble accessing it (using default
/etc/pki/tls/certs/ca-bundle.crt), but ssl_crtd creates a fake cert for
it as follows.

Any ideas what's up?

Thanks!


Signature Algorithm: sha1WithRSAEncryption
        Issuer: C=NZ, ST=...., CN=Not trusted by "Squid CA"
        Validity
            Not Before: Sep 22 08:36:12 2014 GMT
            Not After : Nov 22 22:46:24 2017 GMT
        Subject: serialNumber=TDtNUZuQo4Ts9hs8qd1ksekvefvr7hdo,
OU=GT11048499, OU=See www.rapidssl.com/resources/cps (c)14, OU=Domain
Control Validated - RapidSSL(R), CN=*.snap.net.nz
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: (2048 bit)


-- 
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1



From squid3 at treenet.co.nz  Wed Jan 21 09:07:32 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 21 Jan 2015 22:07:32 +1300
Subject: [squid-users] benefits of using ext_kerberos_ldap_group_acl
 instead of ext_ldap_group_acl
In-Reply-To: <dcf9752032bc4d72284b6aa5086d30ea@open.ch>
References: <dcf9752032bc4d72284b6aa5086d30ea@open.ch>
Message-ID: <54BF6C54.9080302@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 21/01/2015 8:12 p.m., Simon Staeheli wrote:
>> I think that refers to a work in progress. Markus maintains the 
>> un-bundled version of his helpers a little in advance of what has
>> made it into the Squid stable branch. Some of what is available
>> in his helper downloads is only in the Squid-3.HEAD alpha
>> development code so far.
>> 
>> I am working on obsoleting the need for external group helpers.
>> From 3.5 auth helpers can deliver to Squid a set of group=
>> kv-pair in their response. Those can be used with the note ACL
>> type to check group names without any external_acl_type helper
>> lookup (making group checks possible in 'fast' access controls).
>> 
>> Markus joined me in this project and his latest kerberos auth
>> helper (in 3.HEAD and his versions - *not* the 3.5 bundled
>> version) produces group= kv-pair. Unfortunately they are in the
>> obscure S-*-*-* registry ID format MS uses. The external_acl_type
>> helper interface cannot yet be passed notes to decipher that to a
>> known group name.
>> 
>> Amos
> 
> This sounds like an awesome feature. Have you got an idea when
> this functionality will be added to the stable branch? Something
> like 'this year', 'next year' or later?

The annotatinos and notes are in 3.5 already. The bundled helpers a
year or so away.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUv2xUAAoJELJo5wb/XPRjjmIH/jHg9TEcfrEBagibMrX2ND1q
GX5JbUqYw9zhq9FE8HB7bafcifq/6nfhyxxgvvD8S9PIhLNX3Lf8BJUmrImnrHHi
8j09N7TSkoSYZMs5lnBzF3Jpn0xestgFpKYel2m8GGqoqNhcos53ayYljCTdtN78
6ZKRAMsdBprB2nePvvf393SZ67ng4PZLBE7184wUAiWJQxa8bGkA6ZujAL/r96n8
u5rQiDlehlvcqoZXSzzot5aCNa8RjzvMHwJk45nN3CyDRPRsQg6y07OqBQUC1Xpk
emcLE7Gr5jZSK31LcUgs6fzRAED60UaecCyvp0VENM8ehFG/pdsG1hE2MmGhpm0=
=ky5g
-----END PGP SIGNATURE-----


From steve at opendium.com  Wed Jan 21 09:21:28 2015
From: steve at opendium.com (Steve Hill)
Date: Wed, 21 Jan 2015 09:21:28 +0000
Subject: [squid-users] ssl-bump doesn't like valid web server
In-Reply-To: <54BF65E7.2080708@trimble.com>
References: <54BF65E7.2080708@trimble.com>
Message-ID: <54BF6F98.7010302@opendium.com>

On 21.01.15 08:40, Jason Haar wrote:

> I'm running squid-3.4.10 on CentOS-6 and just got hit with ssl-bump
> blocking/warning access to a website which I can't figure out why

Probably not very helpful, but it works for me (squid-3.4.10, Scientific 
Linux 6.6, bump-server-first, but not using ssl_crtd).  I also can't see 
anything wrong with the certificate chain.

-- 
  - Steve Hill
    Technical Director
    Opendium Limited     http://www.opendium.com

Direct contacts:
    Instant messager: xmpp:steve at opendium.com
    Email:            steve at opendium.com
    Phone:            sip:steve at opendium.com

Sales / enquiries contacts:
    Email:            sales at opendium.com
    Phone:            +44-1792-824568 / sip:sales at opendium.com

Support contacts:
    Email:            support at opendium.com
    Phone:            +44-1792-825748 / sip:support at opendium.com


From npf-mlists at eurotux.com  Wed Jan 21 16:05:26 2015
From: npf-mlists at eurotux.com (Nuno Fernandes)
Date: Wed, 21 Jan 2015 16:05:26 +0000
Subject: [squid-users] Internal error on squid_peer_access configuration
Message-ID: <3716648.SDxR4Xqsfh@xeon.lan>

Hello,

I have a squid 3.3.10-20131120-r12658 with the following configuration 
(redacted):

acl localnet src 10.10.5.0/24
acl serverbox src 10.10.5.2/32

# squid.out
cache_peer 127.0.0.1 parent 8081 0 no-query no-digest default name=out
cache_peer_access out deny all

# Dansguardian
cache_peer 127.0.0.2 parent 8080 0 no-query no-digest default 
login=*:nopassword name=dansguardian
cache_peer_access dansguardian allow all

http_access allow localnet


I would like that serverbox goes to squid.out parent and all other users 
trough dansguardian.
If i add to the configuration:

cache_peer_access out allow serverbox
cache_peer_access dansguardian deny serverbox

i get in the logs an internal error:

1421855467.158      0 10.10.5.2 TCP_MISS/500 4062 GET 
http://ftp.cixug.es/CentOS/5.11/addons/i386/repodata/primary.sqlite.bz2 - 
HIER_NONE/- text/html

Any ideas on how can i achieve this?


Thanks,
Nuno Fernandes


From thane at SDF.ORG  Wed Jan 21 17:11:22 2015
From: thane at SDF.ORG (thane at SDF.ORG)
Date: Wed, 21 Jan 2015 18:11:22 +0100
Subject: [squid-users] Squid as reverse proxy and image theft protection
Message-ID: <55c552eea13cf0d5f87fb607cf4b9fe8.squirrel@wm.sdf.org>

Dear all,

we configured Squid 3.4.9 as Reverse Proxy/Accellerator versus some
virtual machines located geographically in different country integrating
it with a Geo DNS solution to routing the various user requests to the
Squid Reverse Proxy nearest to them. These virtual machines hosts a J2EE
Web Portal.

This Reverse Proxy provides to the users a huge amount of images and
reduce a lot the download time for that countries away from the primary
data center (see China, India, etc.). These images are at the moment
freely accessible without authentication.

The portal behind squid uses a custom authentication form where the user
insert his "Username" and "Password" in an HTTP Form and these credentials
are routed to a J2EE Servlet (through an HTTP Post) that perform various
authentication checks and release a cookie to grant the session to the
other dynamic contents.

We would like to understand if there are possible solutions to protect the
images on the Squid Reverse Proxy and makes them only available after the
user is authenticated.

Another possible workaround is perform some random scramble of the image
URL but continuing to permitting the caching of the sames.

Thanks and best regards,
Guido M.



From c-d.hailfinger.devel.2006 at gmx.net  Wed Jan 21 18:00:47 2015
From: c-d.hailfinger.devel.2006 at gmx.net (Carl-Daniel Hailfinger)
Date: Wed, 21 Jan 2015 19:00:47 +0100
Subject: [squid-users] Local port number logging woes
Message-ID: <54BFE94F.5050602@gmx.net>

Hi,

I'm using cascaded/hierarchical Squid instances, one per machine. To get
the ability to correlate access.log entries between instances, I have
extended the default squid log format by %>p and %<lp .
For correlation, I use the following two sets of information:
The parent proxy uses "URL", "timestamp", "client source port".
The child proxy uses "URL", "timestamp", "local port number of the last
server or peer connection".
Even with some slight timing variations due to caching/lookups/network,
the child proxy local port number of the last peer connection and the
parent proxy client source port help tremendously matching those entries
against each other.

This works great except for one oddity: Quite a few Squid log entries of
the child proxy have "0" as local port number of the last server or peer
connection. I have absolutely no idea why that would be the case. AFAICS
cached entries have "-" as local port number and that's fine because it
means there was no associated parent proxy connection.

Am I doing something wrong? Are there any cases where the log format
code %<lp would legitimately yield 0?

Regards,
Carl-Daniel


From eliezer at ngtech.co.il  Wed Jan 21 18:39:52 2015
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Wed, 21 Jan 2015 20:39:52 +0200
Subject: [squid-users] ssl-bump doesn't like valid web server
In-Reply-To: <54BF6F98.7010302@opendium.com>
References: <54BF65E7.2080708@trimble.com> <54BF6F98.7010302@opendium.com>
Message-ID: <54BFF278.7080007@ngtech.co.il>

On 21/01/2015 11:21, Steve Hill wrote:
> but not using ssl_crtd
What are using if not ssl_crtd?

Eliezer



From Jason_Haar at trimble.com  Wed Jan 21 20:21:59 2015
From: Jason_Haar at trimble.com (Jason Haar)
Date: Thu, 22 Jan 2015 09:21:59 +1300
Subject: [squid-users] ssl-bump doesn't like valid web server
In-Reply-To: <54BF6F98.7010302@opendium.com>
References: <54BF65E7.2080708@trimble.com> <54BF6F98.7010302@opendium.com>
Message-ID: <54C00A67.8080802@trimble.com>

On 21/01/15 22:21, Steve Hill wrote:
> Probably not very helpful, but it works for me (squid-3.4.10,
> Scientific Linux 6.6, bump-server-first, but not using ssl_crtd).  I
> also can't see anything wrong with the certificate chain.
Found the problem. It's only occurring via transparent https - not
explicit proxy-bumping of https

The index.txt file shows two entries for the same site.

V    171122224624Z        7D33A943166DE91162FDEEA69C6E6D7E62054DC3   
unknown   
/serialNumber=TDtNUZuQo4Ts9hs8qd1ksekvefvr7hdo/OU=GT11048499/OU=See
www.rapidssl.com/resources/cps (c)14/OU=Domain Control Validated -
RapidSSL(R)/CN=*.snap.net.nz+Sign=signTrusted
V    171122224624Z        231617D3B75F4C18A238EF42EAFC568BF27A3485   
unknown   
/serialNumber=TDtNUZuQo4Ts9hs8qd1ksekvefvr7hdo/OU=GT11048499/OU=See
www.rapidssl.com/resources/cps (c)14/OU=Domain Control Validated -
RapidSSL(R)/CN=*.snap.net.nz+Sign=signUntrusted


The "signUntrusted" would be via starting the cert learning process with
an IP address, whereas the first would have been via knowing in advance
it was myaccount.snap.net.nz

So what's the root cause? Is this an example of why the peek/splice
feature of 3.5 is so important to the success of transparent HTTPS
bumping? (ie is it because there wasn't a SNI hostname)


-- 
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1



From huaraz at moeller.plus.com  Wed Jan 21 21:03:42 2015
From: huaraz at moeller.plus.com (Markus Moeller)
Date: Wed, 21 Jan 2015 21:03:42 -0000
Subject: [squid-users] benefits of using ext_kerberos_ldap_group_acl
	instead of ext_ldap_group_acl
In-Reply-To: <54BE53B2.9070200@treenet.co.nz>
References: <5ef9162d0bea9bc93fe70fcfcc95a484@open.ch>
 <54BE53B2.9070200@treenet.co.nz>
Message-ID: <m9p47l$7d4$1@ger.gmane.org>

>
>
>"Amos Jeffries"  wrote in message news:54BE53B2.9070200 at treenet.co.nz...
>
>-----BEGIN PGP SIGNED MESSAGE-----
>Hash: SHA1
>
>On 21/01/2015 1:38 a.m., Simon Staeheli wrote:
>>> Whatever floats your boat. The point of the Addon/Plugin/helpers
>>> API is that you can use scripts if thy serve your needs better.
>>>
>>> All the usual Open Source benefits of "many eyeballs" and
>>> somebody else doing code maintenance for you applies to using a
>>> bundled helper over a custom written one.
>>>
>>> Beyond that the kerberos helper also provides automatic detection
>>> of which LDAP server to use via mutiple auto-configuration
>>> methods.
>>>
>>> If you can demonstrate that the ext_kerberos_ldap_group_acl does
>>> provides a superset of the functionality of ext_ldap_group_acl
>>> helper then I can de-duplicate the two helpers.
>>>
>>> Amos
>>
>> Thanks for the hint regarding automatic detection of LDAP servers.
>> I am just trying to find what the differences between the two
>> helpers are and which one does fit my needs better. Any others?
>>
>
>Nothing I can pick out easily.
>
>> Do you know anything about the feature in
>> ext_kerberos_ldap_group_acl mentioned by Markus Moeller in an
>> earlier post?
>>
>> "I have a new method in my squid 3.4 patch which uses the Group
>> Information MS is putting in the ticket. This would eliminate the
>> ldap lookup completely."
>> (http://www.squid-cache.org/mail-archive/squid-users/201309/0046.html)
>>
>>
>I think that refers to a work in progress. Markus maintains the
>un-bundled version of his helpers a little in advance of what has made
>it into the Squid stable branch. Some of what is available in his
>helper downloads is only in the Squid-3.HEAD alpha development code so
>far.
>
>I am working on obsoleting the need for external group helpers. From
>3.5 auth helpers can deliver to Squid a set of group= kv-pair in their
>response. Those can be used with the note ACL type to check group
>names without any external_acl_type helper lookup (making group checks
>possible in 'fast' access controls).
>
>Markus joined me in this project and his latest kerberos auth helper
>(in 3.HEAD and his versions - *not* the 3.5 bundled version) produces
>group= kv-pair. Unfortunately they are in the obscure S-*-*-* registry
>ID format MS uses. The external_acl_type helper interface cannot yet
>be passed notes to decipher that to a known group name.
>

The Kerberos authentication helper extracts the Microsoft authorisation data 
from the Kerberos ticket. This so called  PAC data contains the AD Security 
Groups a user belongs too ( even over a forest/domain as far as I recall and 
nested groups).   The format of the authorisation data is the AD objectsid 
which the helper returns in base64  encoding.  So now instead of querying 
LDAP an external helper just need to compare the base64 encoded SID with a 
predefined SID.  You just have to know the SID when you setup the 
configuration in the same way as you have to know the AD group name with an 
ldap helper.

>From a Unix system you can easily get the object sid if you know the 
groupname. e.g.

# kinit markus at WIN2003R2.HOME
# ldapsearch -LLL -H ldap://w2k3r2.win2003r2.home -s sub -b 
DC=WIN2003R2,DC=HOME "(CN=SOCKS_ALLOW)" objectsid
SASL/GSSAPI authentication started
SASL username: markus at WIN2003R2.HOME
SASL SSF: 56
SASL data security layer installed.
dn: CN=SOCKS_ALLOW,OU=Groups,DC=win2003r2,DC=home
objectSid:: AQUAAAAAAAUVAAAAploCbWTufUFPWoiaiwQAAA==

Any ldap browser like ldapadmin can also show the objectsid.

I have also a tool which I can provide to convert a SID into a base64 value

Examples:

# ./convert_sid S-1-5-21-1828870822-1098772068-2592627279-1163
base64 encoded: AQUAAAAAAAUVAAAAploCbWTufUFPWoiaiwQAAA==
hexadecimal: 01 05 00 00 00 00 00 05 15 00 00 00 a6 5a 02 6d 64 ee 7d 41 4f 
5a 88 9a 8b 04 00 00
SID: S-1-5-21-1828870822-1098772068-2592627279-1163

# ./convert_sid AQUAAAAAAAUVAAAAploCbWTufUFPWoiaiwQAAA==
base64 encoded: AQUAAAAAAAUVAAAAploCbWTufUFPWoiaiwQAAA==
hexadecimal: 01 05 00 00 00 00 00 05 15 00 00 00 a6 5a 02 6d 64 ee 7d 41 4f 
5a 88 9a 8b 04 00 00
SID: S-1-5-21-1828870822-1098772068-2592627279-1163

# ./convert_sid 01 05 00 00 00 00 00 05 15 00 00 00 a6 5a 02 6d 64 ee 7d 41 
4f 5a 88 9a 8b 04 00 00
base64 encoded: AQUAAAAAAAUVAAAAploCbWTufUFPWoiaiwQAAA==
hexadecimal: 01 05 00 00 00 00 00 05 15 00 00 00 a6 5a 02 6d 64 ee 7d 41 4f 
5a 88 9a 8b 04 00 00
SID: S-1-5-21-1828870822-1098772068-2592627279-1163


Please let me know if you have questions, comments or ideas

Regards
Markus


>Amos
>
>-----BEGIN PGP SIGNATURE-----
>Version: GnuPG v2.0.22 (MingW32)
>
>iQEcBAEBAgAGBQJUvlOyAAoJELJo5wb/XPRjZskH/3VQdCv4juTHZ0QAOyQvCdLP
>L1ZRDF/ix4MkVIsblsPL20G1KznKRbDBdDZ+DWM4lHDp7m1rwXD972GUmI7JZQDV
>VvjQVMrXfZ3h8VcwpzPXKKiIOJp3+P5e7XpVDQGYAzOBJjnvs2OsIKGGsGwo4kXE
>lElRU9WbspurY4ic07hjSCcM3VAdWMtIy8FVoq2bdegH6qor1dGeoVIMYVnSOBUG
>9gTqWBYxkltI5S19f6zWjk2Kscn7ZYWvPezN38NHouL4ueM0rAHxvUNP2ueudUwR
>tZBavBNpiCJ08dXbhU1nUivyTQX99w8t0VMmYeomTc2Q7znofsX0FefFRFZ1GcY=
>=Yg6k
>-----END PGP SIGNATURE-----
>_______________________________________________
>squid-users mailing list
>squid-users at lists.squid-cache.org
>http://lists.squid-cache.org/listinfo/squid-users




From huaraz at moeller.plus.com  Wed Jan 21 21:07:59 2015
From: huaraz at moeller.plus.com (Markus Moeller)
Date: Wed, 21 Jan 2015 21:07:59 -0000
Subject: [squid-users] benefits of using ext_kerberos_ldap_group_acl
	instead of ext_ldap_group_acl
In-Reply-To: <54BE3B5C.8040800@treenet.co.nz>
References: <1EC53106-F880-4828-89AD-C3CEE0BC03ED@open.ch>
 <54BE3B5C.8040800@treenet.co.nz>
Message-ID: <m9p4fk$b9o$1@ger.gmane.org>

>
>
>"Amos Jeffries"  wrote in message news:54BE3B5C.8040800 at treenet.co.nz...
>
>-----BEGIN PGP SIGNED MESSAGE-----
>Hash: SHA1
>
>On 20/01/2015 11:31 p.m., Simon St?heli wrote:
>> Are there any other benefits in using ext_kerberos_ldap_group_acl
>> instead of ext_ldap_group_acl except the "Netbios name to Kerberos
>> domain name? mappings provided by the -N option. As far as I can
>> tell, this mapping can also easily be done by writing you own
>> helper perl script which is doing the mapping and finally feeds the
>> more common ext_ldap_group_acl helper.
>>
>
>Whatever floats your boat. The point of the Addon/Plugin/helpers API
>is that you can use scripts if thy serve your needs better.
>
>All the usual Open Source benefits of "many eyeballs" and somebody
>else doing code maintenance for you applies to using a bundled helper
>over a custom written one.
>
>Beyond that the kerberos helper also provides automatic detection of
>which LDAP server to use via mutiple auto-configuration methods.
>

The idea of the helper was to automate most of the configuration ( ignoring 
some performance ) and avoid using a username/password, support users from 
multiple domains. Secondly I wanted check for nested groups which was not 
available in the existing helper and thirdly I also check now against the 
primary group of the user.

>If you can demonstrate that the ext_kerberos_ldap_group_acl does
>provides a superset of the functionality of ext_ldap_group_acl helper
>then I can de-duplicate the two helpers.
>
>Amos

Regards
Markus

>
>-----BEGIN PGP SIGNATURE-----
>Version: GnuPG v2.0.22 (MingW32)
>
>iQEcBAEBAgAGBQJUvjtbAAoJELJo5wb/XPRjb1sH/2mO/l+k7jTdFr5CBfrBjXr8
>hp8ECHtKkpHvhiinKadcQd69ZYz0bqYmKQ4AX44XaTKTgc2ctKeywuDBRtSVnMwH
>KrSFY+YUhxpje7hRIwtoloVtPcT+JawUbnvGaAGtcbLNypkT1VEICBA/5QJbSWUH
>Uc+6szgksFWbDldl7kGYd42e7ZE8CdfcjzYqROaFxTglTKgEpqNvaY7KrNx2cZ+c
>5Kx4C6LzKrHML28TsWurWBpS3NVkUveFBLqkD8hY8QULolKleSFkHfuHn/S4gXGf
>IkyNDtEBbdFPKIQw5bkBvzpAWKxSn2fWsq4GW2AJeCcKiJVHDLqwTVQ4vIddsY8=
>=BbhE
>-----END PGP SIGNATURE-----
>_______________________________________________
>squid-users mailing list
>squid-users at lists.squid-cache.org
>http://lists.squid-cache.org/listinfo/squid-users 




From marcus.kool at urlfilterdb.com  Wed Jan 21 21:11:44 2015
From: marcus.kool at urlfilterdb.com (Marcus Kool)
Date: Wed, 21 Jan 2015 19:11:44 -0200
Subject: [squid-users] tcp_outgoing_address and ICAP server
Message-ID: <54C01610.2050609@urlfilterdb.com>

I am using Squid 3.4.9 and have an issue with tcp_outgoing_address.

The Squid server is connceted to the internet with multiple NICs and uses
    tcp_outgoing_address a.public.IP.address

and also want to use an ICAP server on the same host using

icap_service  reqmod_urlfilterdb   reqmod_precache   icap://a.local.ip.address:1344/reqmod_icapd  bypass=off  routing=on  on-overload=wait ipv6=off

It seems that Squid binds the connection to the ICAP server the same way it binds
connections to webservers using the rule with tcp_outgoing_address
and that it not desired nor workable.

I tried

acl myicaphost dst a.local.ip.address
tcp_outgoing_address a.public.IP.address !myicaphost

but Squid issues the following errors:
2015/01/21 21:58:32 kid1| WARNING: myicaphost ACL is used in context without an HTTP request. Assuming mismatch.
2015/01/21 21:58:32 kid1| commBind: Cannot bind socket FD 10 to XX.XX.XX.XX: (99) Cannot assign requested address
2015/01/21 21:58:32 kid1| essential ICAP service is down after an options fetch failure: icap://XX.XX.XX.XX:1344/reqmod_icapd [down,!opt]

So the question is how to send web traffic over a specific NIC and traffic to the ICAP server over an other (default?) NIC ?

 From the comments in squid.conf.documented it seems that tcp_outgoing_address is used for traffix to websites so it seems that
the socket to the ICAP server should not be subject to the logic of tcp_outgoing_address.  Is this correct ?

Marcus



From jeg1972 at gmail.com  Wed Jan 21 21:41:28 2015
From: jeg1972 at gmail.com (John Gardner)
Date: Wed, 21 Jan 2015 21:41:28 +0000
Subject: [squid-users] Issues with CMS Redirects and Squid as Reverse Proxy
Message-ID: <CAFFsz+LWvtzVbaoChhdCSAZbxQWjXoLhYKq+=7boB93e+cNFWQ@mail.gmail.com>

We have a Squid 3.4 server configured as a Reverse Proxy on Oracle
Linux 6.  It is working correctly for most sites, those which are HTTP
all the way through to the peer, Those which are HTTPS all the way
through to the peer and those which have SSL offloaded at the external
interface on Squid.  We have however come across a problem when using
a proprietary Content Management System.  In this CMS, you set each
page to show how it should be served i.e. HTTP or HTTPS.  If traffic
comes into the CMS with HTTP and it's set for HTTPS, the CMS tries to
re-write/force the URL so that it comes back with https:// at the
start.

The problem is that, this appears to come through Squid as an
indefinite loop and the page fails.  When connecting a Browser
directly to the CMS server, and using the same site and page settings,
it works, but when going through squid, it doesn't.  Now, I'm willing
to believe that the CMS is affecting the HTTP traffic so that it is
not strict and that Squid then fails as it it doesn't know how to
handle it, but I thought I would post here and see if anyone could
help.

Our config is the following (with obfuscation);

http_port 10.x.x.42:80 accel defaultsite=server_2.bl.co.uk
https_port 10.x.x.42:443 accel cert=/usr/newrprgate/CertAuth/www/s.crt
key=/usr/newrprgate/CertAuth/www/southtynesidehomes_key.pem
cipher=ALL:!aNULL:!ADH:!eNULL:!LOW:!EXP:RC4+RSA:+HIGH:+MEDIUM
options=NO_SSLv2,NO_SSLv3 defaultsite=server_2.bl.co.uk
cache_peer 10.x.x.202 parent 80 0 no-query originserver name=server_2_http
cache_peer 10.x.x.202 parent 443 0 no-query originserver login=PASS
connection-auth=on ssl
sslcert=/usr/newrprgate/CertAuth/www/peer_keys/www.pem sslversion=1
sslflags=DONT_VERIFY_PEER front-end-https name=server_2_https
acl sites_server_2 dstdomain www.s.org.uk
cache_peer_access server_2_http allow sites_server_2
cache_peer_access server_2_https allow sites_server_2
cache_peer_access server_2_http deny all
cache_peer_access server_2_https deny all

I have switched full logging on and the output is shown below;




----------
2015/01/13 20:54:38.697 kid1| http.cc(2219) sendRequest: HTTP Server
local=10.x.x.40:35186 remote=10.x.x.202:80 FD 34 flags=1
2015/01/13 20:54:38.697 kid1| http.cc(2220) sendRequest: HTTP Server REQUEST:
---------
GET /article/9842/About-us HTTP/1.1
Host: www.s.org.uk
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36
(KHTML, like Gecko) Chrome/39.0.2171.95 Safari/537.36
Referer: http://www.s.org.uk/article/11445/Publications
Accept-Encoding: gzip, deflate, sdch
Accept-Language: en-GB,en-US;q=0.8,en;q=0.6
Cookie: ASP.NET_SessionId=krnzwqana4w3gz452ogmtki4; mode=0;
clientvars=dca8813b-feb8-4398-ab5f-11fa4cf5bc1b
Via: 1.1 servername.bl.co.uk (squid)
Surrogate-Capability: servername.bl.co.uk="Surrogate/1.0 ESI/1.0"
X-Forwarded-For: 92.237.143.136
Cache-Control: max-age=259200
Connection: keep-alive


----------
2015/01/13 20:54:38.732 kid1| ctx: enter level  0:
'https://www.s.org.uk/article/9842/About-us'
2015/01/13 20:54:38.732 kid1| http.cc(749) processReplyHeader: HTTP
Server local=10.x.x.40:35186 remote=10.x.x.202:80 FD 34 flags=1
2015/01/13 20:54:38.732 kid1| http.cc(750) processReplyHeader: HTTP
Server REPLY:
---------
HTTP/1.1 302 Found
Cache-Control: private
Content-Length: 176
Content-Type: text/html; charset=utf-8
Location: https://www.s.org.uk/article/9842/About-us
Server: Microsoft-IIS/7.5
Set-Cookie: clientvars=dca8813b-feb8-4398-ab5f-11fa4cf5bc1b;
expires=Thu, 15-Jan-2015 21:03:45 GMT; path=/; HttpOnly
X-Powered-By: ASP.NET
Date: Tue, 13 Jan 2015 21:03:44 GMT

<html><head><title>Object moved</title></head><body>
<h2>Object moved to <a
href="https://www.s.org.uk/article/9842/About-us">here</a>.</h2>
</body></html>

----------
2015/01/13 20:54:38.732 kid1| ctx: exit level  0
2015/01/13 20:54:38.732 kid1| client_side.cc(1459) sendStartOfMessage:
HTTP Client local=10.x.x.42:443 remote=92.237.143.136:54310 FD 30
flags=1
2015/01/13 20:54:38.732 kid1| client_side.cc(1460) sendStartOfMessage:
HTTP Client REPLY:
---------
HTTP/1.1 302 Found
Cache-Control: private
Content-Length: 176
Content-Type: text/html; charset=utf-8
Location: https://www.s.org.uk/article/9842/About-us
Server: Microsoft-IIS/7.5
Set-Cookie: clientvars=dca8813b-feb8-4398-ab5f-11fa4cf5bc1b;
expires=Thu, 15-Jan-2015 21:03:45 GMT; path=/; HttpOnly
X-Powered-By: ASP.NET
Date: Tue, 13 Jan 2015 21:03:44 GMT
X-Cache: MISS from servername.bl.co.uk
X-Cache-Lookup: MISS from servername.bl.co.uk:80
Via: 1.1 servername.bl.co.uk (squid)
Connection: keep-alive


----------
2015/01/13 20:54:38.773 kid1| client_side.cc(2407) parseHttpRequest:
HTTP Client local=10.x.x.42:443 remote=92.237.143.136:54307 FD 28
flags=1
2015/01/13 20:54:38.773 kid1| client_side.cc(2408) parseHttpRequest:
HTTP Client REQUEST:
---------
GET /article/9842/About-us HTTP/1.1
Host: www.s.org.uk
Connection: keep-alive
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36
(KHTML, like Gecko) Chrome/39.0.2171.95 Safari/537.36
Referer: http://www.s.org.uk/article/11445/Publications
Accept-Encoding: gzip, deflate, sdch
Accept-Language: en-GB,en-US;q=0.8,en;q=0.6
Cookie: ASP.NET_SessionId=krnzwqana4w3gz452ogmtki4; mode=0;
clientvars=dca8813b-feb8-4398-ab5f-11fa4cf5bc1b


----------
2015/01/13 20:54:38.774 kid1| http.cc(2219) sendRequest: HTTP Server
local=10.x.x.40:35186 remote=10.x.x.202:80 FD 34 flags=1
2015/01/13 20:54:38.774 kid1| http.cc(2220) sendRequest: HTTP Server REQUEST:
---------
GET /article/9842/About-us HTTP/1.1
Host: www.s.org.uk
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36
(KHTML, like Gecko) Chrome/39.0.2171.95 Safari/537.36
Referer: http://www.s.org.uk/article/11445/Publications
Accept-Encoding: gzip, deflate, sdch
Accept-Language: en-GB,en-US;q=0.8,en;q=0.6
Cookie: ASP.NET_SessionId=krnzwqana4w3gz452ogmtki4; mode=0;
clientvars=dca8813b-feb8-4398-ab5f-11fa4cf5bc1b
Via: 1.1 servername.bl.co.uk (squid)
Surrogate-Capability: servername.bl.co.uk="Surrogate/1.0 ESI/1.0"
X-Forwarded-For: 92.237.143.136
Cache-Control: max-age=259200
Connection: keep-alive


----------
2015/01/13 20:54:38.806 kid1| ctx: enter level  0:
'https://www.s.org.uk/article/9842/About-us'
2015/01/13 20:54:38.806 kid1| http.cc(749) processReplyHeader: HTTP
Server local=10.x.x.40:35186 remote=10.x.x.202:80 FD 34 flags=1
2015/01/13 20:54:38.806 kid1| http.cc(750) processReplyHeader: HTTP
Server REPLY:
---------
HTTP/1.1 302 Found
Cache-Control: private
Content-Length: 176
Content-Type: text/html; charset=utf-8
Location: https://www.s.org.uk/article/9842/About-us
Server: Microsoft-IIS/7.5
Set-Cookie: clientvars=dca8813b-feb8-4398-ab5f-11fa4cf5bc1b;
expires=Thu, 15-Jan-2015 21:03:45 GMT; path=/; HttpOnly
X-Powered-By: ASP.NET
Date: Tue, 13 Jan 2015 21:03:44 GMT

<html><head><title>Object moved</title></head><body>
<h2>Object moved to <a
href="https://www.s.org.uk/article/9842/About-us">here</a>.</h2>
</body></html>

----------
2015/01/13 20:54:38.806 kid1| ctx: exit level  0
2015/01/13 20:54:38.806 kid1| client_side.cc(1459) sendStartOfMessage:
HTTP Client local=10.x.x.42:443 remote=92.237.143.136:54307 FD 28
flags=1
2015/01/13 20:54:38.806 kid1| client_side.cc(1460) sendStartOfMessage:
HTTP Client REPLY:
---------
HTTP/1.1 302 Found
Cache-Control: private
Content-Length: 176
Content-Type: text/html; charset=utf-8
Location: https://www.s.org.uk/article/9842/About-us
Server: Microsoft-IIS/7.5
Set-Cookie: clientvars=dca8813b-feb8-4398-ab5f-11fa4cf5bc1b;
expires=Thu, 15-Jan-2015 21:03:45 GMT; path=/; HttpOnly
X-Powered-By: ASP.NET
Date: Tue, 13 Jan 2015 21:03:44 GMT
X-Cache: MISS from servername.bl.co.uk
X-Cache-Lookup: MISS from servername.bl.co.uk:80
Via: 1.1 servername.bl.co.uk (squid)
Connection: keep-alive


----------
2015/01/13 20:54:38.850 kid1| client_side.cc(2407) parseHttpRequest:
HTTP Client local=10.x.x.42:443 remote=92.237.143.136:54306 FD 32
flags=1
2015/01/13 20:54:38.850 kid1| client_side.cc(2408) parseHttpRequest:
HTTP Client REQUEST:
---------
GET /article/9842/About-us HTTP/1.1
Host: www.s.org.uk
Connection: keep-alive
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36
(KHTML, like Gecko) Chrome/39.0.2171.95 Safari/537.36
Referer: http://www.s.org.uk/article/11445/Publications
Accept-Encoding: gzip, deflate, sdch
Accept-Language: en-GB,en-US;q=0.8,en;q=0.6
Cookie: ASP.NET_SessionId=krnzwqana4w3gz452ogmtki4; mode=0;
clientvars=dca8813b-feb8-4398-ab5f-11fa4cf5bc1b


----------
2015/01/13 20:54:38.850 kid1| http.cc(2219) sendRequest: HTTP Server
local=10.x.x.40:35186 remote=10.x.x.202:80 FD 34 flags=1
2015/01/13 20:54:38.850 kid1| http.cc(2220) sendRequest: HTTP Server REQUEST:
---------
GET /article/9842/About-us HTTP/1.1
Host: www.s.org.uk
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36
(KHTML, like Gecko) Chrome/39.0.2171.95 Safari/537.36
Referer: http://www.s.org.uk/article/11445/Publications
Accept-Encoding: gzip, deflate, sdch
Accept-Language: en-GB,en-US;q=0.8,en;q=0.6
Cookie: ASP.NET_SessionId=krnzwqana4w3gz452ogmtki4; mode=0;
clientvars=dca8813b-feb8-4398-ab5f-11fa4cf5bc1b
Via: 1.1 servername.bl.co.uk (squid)
Surrogate-Capability: servername.bl.co.uk="Surrogate/1.0 ESI/1.0"
X-Forwarded-For: 92.237.143.136
Cache-Control: max-age=259200
Connection: keep-alive


----------
2015/01/13 20:54:38.881 kid1| ctx: enter level  0:
'https://www.s.org.uk/article/9842/About-us'
2015/01/13 20:54:38.881 kid1| http.cc(749) processReplyHeader: HTTP
Server local=10.x.x.40:35186 remote=10.x.x.202:80 FD 34 flags=1
2015/01/13 20:54:38.881 kid1| http.cc(750) processReplyHeader: HTTP
Server REPLY:
---------
HTTP/1.1 302 Found
Cache-Control: private
Content-Length: 176
Content-Type: text/html; charset=utf-8
Location: https://www.s.org.uk/article/9842/About-us
Server: Microsoft-IIS/7.5
Set-Cookie: clientvars=dca8813b-feb8-4398-ab5f-11fa4cf5bc1b;
expires=Thu, 15-Jan-2015 21:03:45 GMT; path=/; HttpOnly
X-Powered-By: ASP.NET
Date: Tue, 13 Jan 2015 21:03:44 GMT

<html><head><title>Object moved</title></head><body>
<h2>Object moved to <a
href="https://www.s.org.uk/article/9842/About-us">here</a>.</h2>
</body></html>

----------
2015/01/13 20:54:38.881 kid1| ctx: exit level  0
2015/01/13 20:54:38.881 kid1| client_side.cc(1459) sendStartOfMessage:
HTTP Client local=10.x.x.42:443 remote=92.237.143.136:54306 FD 32
flags=1
2015/01/13 20:54:38.881 kid1| client_side.cc(1460) sendStartOfMessage:
HTTP Client REPLY:
---------
HTTP/1.1 302 Found
Cache-Control: private
Content-Length: 176
Content-Type: text/html; charset=utf-8
Location: https://www.s.org.uk/article/9842/About-us
Server: Microsoft-IIS/7.5
Set-Cookie: clientvars=dca8813b-feb8-4398-ab5f-11fa4cf5bc1b;
expires=Thu, 15-Jan-2015 21:03:45 GMT; path=/; HttpOnly
X-Powered-By: ASP.NET
Date: Tue, 13 Jan 2015 21:03:44 GMT
X-Cache: MISS from servername.bl.co.uk
X-Cache-Lookup: MISS from servername.bl.co.uk:80
Via: 1.1 servername.bl.co.uk (squid)
Connection: keep-alive


----------
2015/01/13 20:54:38.930 kid1| client_side.cc(2407) parseHttpRequest:
HTTP Client local=10.x.x.42:443 remote=92.237.143.136:54308 FD 25
flags=1
2015/01/13 20:54:38.930 kid1| client_side.cc(2408) parseHttpRequest:
HTTP Client REQUEST:
---------
GET /article/9842/About-us HTTP/1.1
Host: www.s.org.uk
Connection: keep-alive
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36
(KHTML, like Gecko) Chrome/39.0.2171.95 Safari/537.36
Referer: http://www.s.org.uk/article/11445/Publications
Accept-Encoding: gzip, deflate, sdch
Accept-Language: en-GB,en-US;q=0.8,en;q=0.6
Cookie: ASP.NET_SessionId=krnzwqana4w3gz452ogmtki4; mode=0;
clientvars=dca8813b-feb8-4398-ab5f-11fa4cf5bc1b


I'd greatly appreciated it if someone could cast their eyes over the
logs and see if anything pops out as to why this infinite loop is
displayed by Squid.

Thanks very much in advance.

John


From squid3 at treenet.co.nz  Thu Jan 22 03:40:55 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 22 Jan 2015 16:40:55 +1300
Subject: [squid-users] Squid as reverse proxy and image theft protection
In-Reply-To: <55c552eea13cf0d5f87fb607cf4b9fe8.squirrel@wm.sdf.org>
References: <55c552eea13cf0d5f87fb607cf4b9fe8.squirrel@wm.sdf.org>
Message-ID: <54C07147.5030902@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 22/01/2015 6:11 a.m., thane at SDF.ORG wrote:
> Dear all,
> 
> we configured Squid 3.4.9 as Reverse Proxy/Accellerator versus
> some virtual machines located geographically in different country
> integrating it with a Geo DNS solution to routing the various user
> requests to the Squid Reverse Proxy nearest to them. These virtual
> machines hosts a J2EE Web Portal.
> 
> This Reverse Proxy provides to the users a huge amount of images
> and reduce a lot the download time for that countries away from the
> primary data center (see China, India, etc.). These images are at
> the moment freely accessible without authentication.
> 
> The portal behind squid uses a custom authentication form where the
> user insert his "Username" and "Password" in an HTTP Form and these
> credentials are routed to a J2EE Servlet (through an HTTP Post)
> that perform various authentication checks and release a cookie to
> grant the session to the other dynamic contents.
> 
> We would like to understand if there are possible solutions to
> protect the images on the Squid Reverse Proxy and makes them only
> available after the user is authenticated.

An external_acl_type helper that checks the Cookie header contents
against the backend auth system and informs Squid about OK/ERR will do
that for you.


> 
> Another possible workaround is perform some random scramble of the
> image URL but continuing to permitting the caching of the sames.

That is not possible while caching.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUwHFHAAoJELJo5wb/XPRjV48IALCdLQ2Yb1tQabzLpyEi+rmE
WlBGqaKMsKGZBEtPhvys6yvS1Nr7Isc5qaF/g/KuJhWT5NKy5OOYAP3nvrLDu8NB
BT9YcRcHAHLRtfFoSAxYxlYYOwdY7TQsyx70XtQhcnqFtZqQWpLraTUXvpKdoVul
J0q0C+ZpqsurTlZTJG9s1sz/75bESTbpY5lmq0uqIA77FiMe9pwrUcYgdWx/9yMr
VdH6O+iO18PCPAPw9cVRrQHZNQ3i9fw/KfJ0Wj9CUOPu367Jd4JLdYEeKPYsGuHc
Syz/1PV9S+QPSiYkvpdHvMg00HzO7sWSRq0WBdJlBWTXw61vSgJMsvhOgnjJlp8=
=KQEL
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Thu Jan 22 04:16:13 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 22 Jan 2015 17:16:13 +1300
Subject: [squid-users] Issues with CMS Redirects and Squid as Reverse
 Proxy
In-Reply-To: <CAFFsz+LWvtzVbaoChhdCSAZbxQWjXoLhYKq+=7boB93e+cNFWQ@mail.gmail.com>
References: <CAFFsz+LWvtzVbaoChhdCSAZbxQWjXoLhYKq+=7boB93e+cNFWQ@mail.gmail.com>
Message-ID: <54C0798D.7070105@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 22/01/2015 10:41 a.m., John Gardner wrote:
> We have a Squid 3.4 server configured as a Reverse Proxy on Oracle 
> Linux 6.  It is working correctly for most sites, those which are
> HTTP all the way through to the peer, Those which are HTTPS all the
> way through to the peer and those which have SSL offloaded at the
> external interface on Squid.  We have however come across a problem
> when using a proprietary Content Management System.  In this CMS,
> you set each page to show how it should be served i.e. HTTP or
> HTTPS.  If traffic comes into the CMS with HTTP and it's set for
> HTTPS, the CMS tries to re-write/force the URL so that it comes
> back with https:// at the start.
> 
> The problem is that, this appears to come through Squid as an 
> indefinite loop and the page fails.  When connecting a Browser 
> directly to the CMS server, and using the same site and page
> settings, it works, but when going through squid, it doesn't.  Now,
> I'm willing to believe that the CMS is affecting the HTTP traffic
> so that it is not strict and that Squid then fails as it it doesn't
> know how to handle it, but I thought I would post here and see if
> anyone could help.
> 
> Our config is the following (with obfuscation);
> 
> http_port 10.x.x.42:80 accel defaultsite=server_2.bl.co.uk 
> https_port 10.x.x.42:443 accel
> cert=/usr/newrprgate/CertAuth/www/s.crt 
> key=/usr/newrprgate/CertAuth/www/southtynesidehomes_key.pem 
> cipher=ALL:!aNULL:!ADH:!eNULL:!LOW:!EXP:RC4+RSA:+HIGH:+MEDIUM 
> options=NO_SSLv2,NO_SSLv3 defaultsite=server_2.bl.co.uk cache_peer
> 10.x.x.202 parent 80 0 no-query originserver name=server_2_http 
> cache_peer 10.x.x.202 parent 443 0 no-query originserver
> login=PASS connection-auth=on ssl 
> sslcert=/usr/newrprgate/CertAuth/www/peer_keys/www.pem
> sslversion=1 sslflags=DONT_VERIFY_PEER front-end-https
> name=server_2_https acl sites_server_2 dstdomain www.s.org.uk 
> cache_peer_access server_2_http allow sites_server_2 
> cache_peer_access server_2_https allow sites_server_2 
> cache_peer_access server_2_http deny all cache_peer_access
> server_2_https deny all

For a backend CMS like that you need to add protocol type to the peer
selection criteria:

 acl HTTPS proto HTTPS

 cache_peer_access server_2_http allow sites_server_2 !HTTPS
 cache_peer_access server_2_http deny all

 cache_peer_access server_2_https allow sites_server_2 HTTPS
 cache_peer_access server_2_https deny all


PS. It is long past time to seriously look at verifying the peer
connection traffic. All you need is to set sslcafile= (or sslcapath=
if there are multiple) with the peer CA cert and drop the sslversion=1
and sslflags=DONT_VERIFY_PEER parameters.


Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUwHmNAAoJELJo5wb/XPRjUFEIAKHLNgt+nceH49NHYVGWFifJ
jXZPihncq76xquM9Qe2rUMnW7TqW1jxNmyrofScx0l1chlm2GX8xYcPh72E0cog8
p0XEBt/D0Q0ydaN5PDa5ouDY2gJVps2lTeLY5/nmciBZbzlMW5tzwiL0fAkyYVSf
MdP8tn2TM1sC8cdMHMZ6aIu79/h9RbqslFlOoqaNa1yrH4PefIp3Csoa28CnrZ2B
WHtQN4eI0zsYvGNEvOI2gWBlK3ygQCf9ks3T9Df3n6MBglldsu44CcA7/zDdXW+G
iSdUXSw17M0gZUTMN1jf77ehf8FGKxBtiqqU1FzO2Yswucuqz4RvxPP32J+ZcEI=
=lA68
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Thu Jan 22 04:22:18 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 22 Jan 2015 17:22:18 +1300
Subject: [squid-users] Local port number logging woes
In-Reply-To: <54BFE94F.5050602@gmx.net>
References: <54BFE94F.5050602@gmx.net>
Message-ID: <54C07AFA.1060709@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 22/01/2015 7:00 a.m., Carl-Daniel Hailfinger wrote:
> Hi,
> 
> I'm using cascaded/hierarchical Squid instances, one per machine.
> To get the ability to correlate access.log entries between
> instances, I have extended the default squid log format by %>p and
> %<lp . For correlation, I use the following two sets of
> information: The parent proxy uses "URL", "timestamp", "client
> source port". The child proxy uses "URL", "timestamp", "local port
> number of the last server or peer connection". Even with some
> slight timing variations due to caching/lookups/network, the child
> proxy local port number of the last peer connection and the parent
> proxy client source port help tremendously matching those entries 
> against each other.
> 
> This works great except for one oddity: Quite a few Squid log
> entries of the child proxy have "0" as local port number of the
> last server or peer connection. I have absolutely no idea why that
> would be the case. AFAICS cached entries have "-" as local port
> number and that's fine because it means there was no associated
> parent proxy connection.
> 
> Am I doing something wrong? Are there any cases where the log
> format code %<lp would legitimately yield 0?

It is possible for connections which were never completely setup. The
server/peer details will all be known, but the local TCP details will
not be set by completion of the TCP handshake.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUwHr6AAoJELJo5wb/XPRj1e0H/R732wuWifxxJjiQuGQJxaej
vc8c07NS02slvpVSDvLNjyOAMPl++oBgCEvy4EBHiWkR1MP/N7z4Utj4FS1c1HQA
rEJqA0UCe8cnm6V/8zjrEd3l+N+zYx5oj/P4Yv97TmQlmLeMLeVZyaeJcOfMarKo
yS9Tdyy7NIuQioTzFKfZ/1mclJeAKJ1fY2QLjzIWzekDh0NNvmX/3W3NEuFf1fsR
cuYQ4vbTliCbkuugtvmJm/GOATAl3jNvP+pJp+5s1JPe+dYFlqj2All/eR2stai4
ElJaHQm5f2GgU3g/kuZvSHiXuMkMEmwvGj+pwlSu5+Okdi0XpMKx03BnRqPPJTQ=
=SKrI
-----END PGP SIGNATURE-----


From steve at opendium.com  Thu Jan 22 07:20:05 2015
From: steve at opendium.com (Steve Hill)
Date: Thu, 22 Jan 2015 07:20:05 +0000
Subject: [squid-users] ssl-bump doesn't like valid web server
In-Reply-To: <54BFF278.7080007@ngtech.co.il>
References: <54BF65E7.2080708@trimble.com> <54BF6F98.7010302@opendium.com>
 <54BFF278.7080007@ngtech.co.il>
Message-ID: <54C0A4A5.5060607@opendium.com>

On 21/01/15 18:39, Eliezer Croitoru wrote:

>> but not using ssl_crtd
> What are using if not ssl_crtd?

Squid generates the certificates internally if ssl_crtd isn't turned on
at compile time.  I've not seen any information explaining the pros and
cons of each approach (I'd welcome any input!).


-- 

 - Steve Hill
   Technical Director
   Opendium Limited     http://www.opendium.com

Direct contacts:
   Instant messager: xmpp:steve at opendium.com
   Email:            steve at opendium.com
   Phone:            sip:steve at opendium.com

Sales / enquiries contacts:
   Email:            sales at opendium.com
   Phone:            +44-1792-825748 / sip:sales at opendium.com

Support contacts:
   Email:            support at opendium.com
   Phone:            +44-1792-824568 / sip:support at opendium.com


From squid3 at treenet.co.nz  Thu Jan 22 08:14:10 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 22 Jan 2015 21:14:10 +1300
Subject: [squid-users] ssl-bump doesn't like valid web server
In-Reply-To: <54C0A4A5.5060607@opendium.com>
References: <54BF65E7.2080708@trimble.com> <54BF6F98.7010302@opendium.com>
 <54BFF278.7080007@ngtech.co.il> <54C0A4A5.5060607@opendium.com>
Message-ID: <54C0B152.3@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 22/01/2015 8:20 p.m., Steve Hill wrote:
> On 21/01/15 18:39, Eliezer Croitoru wrote:
> 
>>> but not using ssl_crtd
>> What are using if not ssl_crtd?
> 
> Squid generates the certificates internally if ssl_crtd isn't
> turned on at compile time.  I've not seen any information
> explaining the pros and cons of each approach (I'd welcome any
> input!).
> 

Squid only *generates* server certificates using that helper. If you
are seeing the log lines "Generating SSL certificate" they are
incorrect when not using the helper.

The non-helper bumping is limited to using the configured http(s)_port
cert= and key= contents. In essence only doing client-first or
peek+splice SSL-bumping styles.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUwLFSAAoJELJo5wb/XPRj8OQIAIRtSks7fQaXRZYvMLhrT3EL
Kn+AKOg1opYqjmQyIZIWOZYTW61675deiPkQUxjWj//4hU9QegKwsmyDpfyqjOkq
GfCbR8mQxu6Z4h/+ECYMmKpj7/iXlmMz9ri9fRxjaDqNJdQWnRPrUkJeKvD6hTM5
x9P6TBYiOeVCg5yySUheLH335z3akrjKKYlML3nJzDuzHhP7lObzhjjbfZqJC6rr
6l5aSfaTA7Oh9wbeSCLBu71IDGAlFgzt9iC0gNefG9tqlcofxWBZNRrs2JGdzmQG
lHnbwof5t/hQVpo+tiZY8ZqYxcmWtjIu/hvzBnRjbs6eUr+F0mCdWexgGh6Ts+A=
=IOlx
-----END PGP SIGNATURE-----


From thane at SDF.ORG  Thu Jan 22 09:25:53 2015
From: thane at SDF.ORG (thane at SDF.ORG)
Date: Thu, 22 Jan 2015 10:25:53 +0100
Subject: [squid-users] Squid as reverse proxy and image theft protection
In-Reply-To: <54C07147.5030902@treenet.co.nz>
References: <55c552eea13cf0d5f87fb607cf4b9fe8.squirrel@wm.sdf.org>
 <54C07147.5030902@treenet.co.nz>
Message-ID: <40a2d01dac7c40dd5fc254d5ba228056.squirrel@wm.sdf.org>

Dear Jeffries,

I thank you for your answer. Is possible in your opinion manage also
Cookie with an expiration time? Because if I understood correctly your
suggestion works great until the users share with some attacker the
cookie. The attacker could reuse this cookie to download freely the images
from the site. Right?

Thanks and best regards,
Guido.

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 22/01/2015 6:11 a.m., thane at SDF.ORG wrote:
>> Dear all,
>>
>> we configured Squid 3.4.9 as Reverse Proxy/Accellerator versus
>> some virtual machines located geographically in different country
>> integrating it with a Geo DNS solution to routing the various user
>> requests to the Squid Reverse Proxy nearest to them. These virtual
>> machines hosts a J2EE Web Portal.
>>
>> This Reverse Proxy provides to the users a huge amount of images
>> and reduce a lot the download time for that countries away from the
>> primary data center (see China, India, etc.). These images are at
>> the moment freely accessible without authentication.
>>
>> The portal behind squid uses a custom authentication form where the
>> user insert his "Username" and "Password" in an HTTP Form and these
>> credentials are routed to a J2EE Servlet (through an HTTP Post)
>> that perform various authentication checks and release a cookie to
>> grant the session to the other dynamic contents.
>>
>> We would like to understand if there are possible solutions to
>> protect the images on the Squid Reverse Proxy and makes them only
>> available after the user is authenticated.
>
> An external_acl_type helper that checks the Cookie header contents
> against the backend auth system and informs Squid about OK/ERR will do
> that for you.
>
>
>>
>> Another possible workaround is perform some random scramble of the
>> image URL but continuing to permitting the caching of the sames.
>
> That is not possible while caching.
>
> Amos
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2.0.22 (MingW32)
>
> iQEcBAEBAgAGBQJUwHFHAAoJELJo5wb/XPRjV48IALCdLQ2Yb1tQabzLpyEi+rmE
> WlBGqaKMsKGZBEtPhvys6yvS1Nr7Isc5qaF/g/KuJhWT5NKy5OOYAP3nvrLDu8NB
> BT9YcRcHAHLRtfFoSAxYxlYYOwdY7TQsyx70XtQhcnqFtZqQWpLraTUXvpKdoVul
> J0q0C+ZpqsurTlZTJG9s1sz/75bESTbpY5lmq0uqIA77FiMe9pwrUcYgdWx/9yMr
> VdH6O+iO18PCPAPw9cVRrQHZNQ3i9fw/KfJ0Wj9CUOPu367Jd4JLdYEeKPYsGuHc
> Syz/1PV9S+QPSiYkvpdHvMg00HzO7sWSRq0WBdJlBWTXw61vSgJMsvhOgnjJlp8=
> =KQEL
> -----END PGP SIGNATURE-----
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>




From squid3 at treenet.co.nz  Thu Jan 22 09:55:36 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 22 Jan 2015 22:55:36 +1300
Subject: [squid-users] Squid as reverse proxy and image theft protection
In-Reply-To: <40a2d01dac7c40dd5fc254d5ba228056.squirrel@wm.sdf.org>
References: <55c552eea13cf0d5f87fb607cf4b9fe8.squirrel@wm.sdf.org>
 <54C07147.5030902@treenet.co.nz>
 <40a2d01dac7c40dd5fc254d5ba228056.squirrel@wm.sdf.org>
Message-ID: <54C0C918.30506@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 22/01/2015 10:25 p.m., thane at SDF.ORG wrote:
> Dear Jeffries,
> 
> I thank you for your answer. Is possible in your opinion manage
> also Cookie with an expiration time? Because if I understood
> correctly your suggestion works great until the users share with
> some attacker the cookie. The attacker could reuse this cookie to
> download freely the images from the site. Right?
> 

It can do whatever you code the helper to do. Squid can only pass the
Cookie header (as a whole) to the helper and use its result as to
whether to accept of deny the request.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUwMkYAAoJELJo5wb/XPRj/4UH/RfVN21VIqQgVASNc2fxpJkC
XPDI0jzHpwhYvfiqAsWmbQDeaKvwUSVEd0CX/gg8cM/4TmrF1IWgp+hhP/lUCwyV
sPlyY4Df7cNonkfDpmOm0+gZdK99gB+F56cwkitvdfg15y1NbDdvxMg+1E+/LavO
B3kkEZRphNek6rGf3fgM2sSzEmWDtjhFqPdqx5nIJyRbqTWBfM862ay7aLMyiGDE
WiIMlsSr5RYAg+BopOPguE8rj+FW0fzxbDKFD2F4H06AClPKC6nAYP2NKwd0fNhw
rEk8w4xuuRsei6K1b7LUVDRLWtRHTeijD6O3sbmm4gIcOb1s79kV0uUjSvVGhZI=
=Z/UM
-----END PGP SIGNATURE-----


From hack.back at hotmail.com  Thu Jan 22 12:17:33 2015
From: hack.back at hotmail.com (HackXBack)
Date: Thu, 22 Jan 2015 04:17:33 -0800 (PST)
Subject: [squid-users] FATAL: The ssl_crtd helpers are crashing too rapidly,
	need help!
Message-ID: <1421929053162-4669257.post@n4.nabble.com>

hello,
every day i found this error and my cache stop

then i remove the ssl database then restart squid

next day the problem happen again , 
am using squid 3.4.11

what may cause this problem ?

thanks.



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/FATAL-The-ssl-crtd-helpers-are-crashing-too-rapidly-need-help-tp4669257.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From yvoinov at gmail.com  Thu Jan 22 12:32:57 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 22 Jan 2015 18:32:57 +0600
Subject: [squid-users] FATAL: The ssl_crtd helpers are crashing too
 rapidly, need help!
In-Reply-To: <1421929053162-4669257.post@n4.nabble.com>
References: <1421929053162-4669257.post@n4.nabble.com>
Message-ID: <54C0EDF9.4060401@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Many?

This can be word length of 32/64 bits issue.

Check with file and ldd utilities your ssl_crtd openssl, openssl
libraries and correct LD_LIBRARY_PATH if necessary.
22.01.2015 18:17, HackXBack ?????:
> hello,
> every day i found this error and my cache stop
>
> then i remove the ssl database then restart squid
>
> next day the problem happen again ,
> am using squid 3.4.11
>
> what may cause this problem ?
>
> thanks.
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/FATAL-The-ssl-crtd-helpers-are-crashing-too-rapidly-need-help-tp4669257.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUwO35AAoJENNXIZxhPexGUfoH/jCvqnPNWuWW1OyB80UE+gje
mco9BCIjLcSGjeUb/8vEdV62tHg1PQg3SeLK5kR/J/qAP7tbr2+wxXjl8Day2oaa
AVBz5n7XjBP/8Gz7TaE7n+6W6BNc/+imTB/4LWiQquxxbp1b3XziQFY2MwSqa4FT
FS8apQjvI6IE6yhx50Umi49Y92AjDT6E6FAHwpcJWiVzc+okN/DpxCvtnVOsbh9h
Ej1f2llY3FXnZddttJSsorGvlVfHrCSZglnfJyB2S+QjS59j3OVXrgZuAVbRP7CW
bd0NhrnnfRvZvIsR+UBvKENRxCDQ9kjSsks9nP/RklxjrkntvzqVLwM/vOnHSZc=
=9Z3k
-----END PGP SIGNATURE-----



From frank at undermydesk.org  Thu Jan 22 15:32:10 2015
From: frank at undermydesk.org (Frank Reppin)
Date: Thu, 22 Jan 2015 16:32:10 +0100
Subject: [squid-users] squid-3.5.x / Ipc::Mem::Segment::create failed to
 shm_open(/squid-cf__metadata.shm): (38) Function not implemented
Message-ID: <54C117FA.8080201@undermydesk.org>

Hi all,

we're following 3.4.x (currently 3.4.11) closely and decided
to upgrade to 3.5.1 in a test environment today:

Environment (test+production) is linux vserver based:

   host system:     Debian Wheezy 7.8 x64
   guest system:    Debian Wheezy 7.8 x64
   kernel+vs patch: 3.14.27-vs2.3.6.14

and squid (all 3.3.x and all 3.4.x) worked without
any flaws so far (without any special tricks)...
... except 3.5.x which now dies after emitting:

   Ipc::Mem::Segment::create failed to 
shm_open(/squid-cf__metadata.shm): (38) Function not implemented

straight after starting up.

We've read through

   http://www.squid-cache.org/Versions/v3/3.5/squid-3.5.1-RELEASENOTES.html

but cannot spot any fundamental change there (which might
cause the aforementioned issue).
We also tend to not think that this is caused by running
squid within a linux vserver context (because it used to
work since years this way).

The squid in question is compiled like:

frank at testbed:~# /usr/local/squid-3.5.1/sbin/squid -v
Squid Cache: Version 3.5.1
Service Name: squid
configure options:  '--prefix=/usr/local/squid-3.5.1' 
'--localstatedir=/var' '--with-pidfile=/var/run/squid3.pid' 
'--with-swapdir=/var/spool/squid3' '--with-logdir=/var/log/squid3' 
'--with-filedescriptors=65536' '--disable-maintainer-mode' 
'--disable-dependency-tracking' '--disable-translation' '--enable-auth' 
'--enable-auth-basic' '--enable-auth-digest' '--enable-auth-negotiate' 
'--enable-auth-ntlm' '--enable-cache-digests' '--enable-delay-pools' 
'--enable-esi' '--enable-external-acl-helpers' 
'--enable-follow-x-forwarded-for' '--enable-icmp' '--enable-inline' 
'--enable-linux-netfilter' '--enable-log-daemon-helpers' 
'--enable-removal-policies=heap,lru' '--enable-snmp' '--with-openssl' 
'--enable-ssl-crtd' '--enable-storeio=aufs,diskd,ufs' 
'--enable-url-rewrite-helpers' '--enable-zph-qos' '--with-large-files' 
'--with-default-user=proxy'


We'd appreciate any hints! :)

TIA and cheers,
frank\


-- 
43rd Law of Computing:
         Anything that can go wr
fortune: Segmentation violation -- Core dumped


From frank at undermydesk.org  Thu Jan 22 16:34:56 2015
From: frank at undermydesk.org (Frank Reppin)
Date: Thu, 22 Jan 2015 17:34:56 +0100
Subject: [squid-users] SOLVED / Re: squid-3.5.x / Ipc::Mem::Segment::create
 failed to shm_open(/squid-cf__metadata.shm): (38) Function not implemented
In-Reply-To: <54C117FA.8080201@undermydesk.org>
References: <54C117FA.8080201@undermydesk.org>
Message-ID: <54C126B0.1020002@undermydesk.org>

Hi all,

ok - got it sorted after digging through older
linux vserver irclogs...

Solution was to add:

   none /dev/shm tmpfs rw,nosuid,nodev,noexec 0 0

to '/etc/vservers/testbed/fstab' and to obviously
restart the vserver afterwards.

It now starts up just fine (and seems to work).


cheers,
frank\

-- 
43rd Law of Computing:
         Anything that can go wr
fortune: Segmentation violation -- Core dumped


From c-d.hailfinger.devel.2006 at gmx.net  Thu Jan 22 17:03:36 2015
From: c-d.hailfinger.devel.2006 at gmx.net (Carl-Daniel Hailfinger)
Date: Thu, 22 Jan 2015 18:03:36 +0100
Subject: [squid-users] Local port number logging woes
In-Reply-To: <54C07AFA.1060709@treenet.co.nz>
References: <54BFE94F.5050602@gmx.net> <54C07AFA.1060709@treenet.co.nz>
Message-ID: <54C12D68.4040704@gmx.net>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi Amos,

thanks a lot for your answer.

On 22.01.2015 05:22, Amos Jeffries wrote:
> On 22/01/2015 7:00 a.m., Carl-Daniel Hailfinger wrote:
> > I'm using cascaded/hierarchical Squid instances, one per machine.
> > [...]
>
> > This works great except for one oddity: Quite a few Squid log
> > entries of the child proxy have "0" as local port number of the
> > last server or peer connection. I have absolutely no idea why that
> > would be the case. AFAICS cached entries have "-" as local port
> > number and that's fine because it means there was no associated
> > parent proxy connection.
>
> > Am I doing something wrong? Are there any cases where the log
> > format code %<lp would legitimately yield 0?
>
> It is possible for connections which were never completely setup. The
> server/peer details will all be known, but the local TCP details will
> not be set by completion of the TCP handshake.

Ah, that may explain it. So this would only happen if the TCP connection
to the parent proxy can't be established completely.
A colleague of mine thought it might be related to parent proxy
connection keepalive. I'll forward your answer.

Thanks again!

Regards,
Carl-Daniel
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iD8DBQFUwS1oRdNMz2eF/AERAv8kAJsF0XuTwBJvcy74MRpFrdJ7P5klQwCgnrg6
LEP4EkBarBc9qByymqo1hD0=
=fgvz
-----END PGP SIGNATURE-----




From odhiambo at gmail.com  Fri Jan 23 11:37:45 2015
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Fri, 23 Jan 2015 14:37:45 +0300
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
Message-ID: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>

So for the past few days I have been struggling with Squid in intercept
mode on FreeBSD-10.1.

Using the same squid.conf for Squid-3.4.10 and Squid-3.5.1 and the same
Firewall rules (I have tested with IPFilter and PF and these rules work
with Squid-2.7.9 on several FreeBSD boxes that I have):

1. Squid-3.5.1 has completely refused to play along - always complaining
about "loop detected" and hence denying all requests
2. Squid-3.4.10 plays along, BUT has so much complaints in cache.log as
below:

2015/01/23 13:26:43| Set Current Directory to /usr/local/squid/logs
2015/01/23 13:26:43| Set Current Directory to /usr/local/squid/logs
2015/01/23 13:26:43| Starting Squid Cache version 3.4.10 for
amd64-portbld-freebsd10.1...
2015/01/23 13:26:43| Process ID 15770
2015/01/23 13:26:43| Process Roles: master worker
2015/01/23 13:26:43| With 114417 file descriptors available
2015/01/23 13:26:43| Initializing IP Cache...
2015/01/23 13:26:43| DNS Socket created at [::], FD 5
2015/01/23 13:26:43| DNS Socket created at 0.0.0.0, FD 6
2015/01/23 13:26:43| Adding domain ili.or.ug from /etc/resolv.conf
2015/01/23 13:26:43| Adding nameserver 127.0.0.1 from /etc/resolv.conf
2015/01/23 13:26:43| helperOpenServers: Starting 5/15 'ssl_crtd' processes
2015/01/23 13:26:43| helperOpenServers: Starting 10/15 'ut-squidbooster'
processes
2015/01/23 13:26:43| Logfile: opening log
stdio:/usr/local/squid/logs/access.log
2015/01/23 13:26:43| Local cache digest enabled; rebuild/rewrite every
3600/3600 sec
2015/01/23 13:26:43| Store logging disabled
2015/01/23 13:26:43| Swap maxSize 104857600 + 131072 KB, estimated 8076051
objects
2015/01/23 13:26:43| Target number of buckets: 403802
2015/01/23 13:26:43| Using 524288 Store buckets
2015/01/23 13:26:43| Max Mem  size: 131072 KB
2015/01/23 13:26:43| Max Swap size: 104857600 KB
2015/01/23 13:26:43| Rebuilding storage in /usr/local/squid/cache (dirty
log)
2015/01/23 13:26:43| Using Least Load store dir selection
2015/01/23 13:26:43| Set Current Directory to /usr/local/squid/logs
2015/01/23 13:26:43| Finished loading MIME types and icons.
2015/01/23 13:26:43| HTCP Disabled.
2015/01/23 13:26:43| Pinger socket opened on FD 45
2015/01/23 13:26:43| Squid plugin modules loaded: 0
2015/01/23 13:26:43| Adaptation support is off.
2015/01/23 13:26:43| Accepting NAT intercepted HTTP Socket connections at
local=[::]:13128 remote=[::] FD 40 flags=41
2015/01/23 13:26:43| Accepting HTTP Socket connections at local=[::]:13127
remote=[::] FD 41 flags=9
2015/01/23 13:26:43| Accepting NAT intercepted SSL bumped HTTPS Socket
connections at local=[::]:13129 remote=[::] FD 42 flags=41
2015/01/23 13:26:43| Accepting ICP messages on [::]:3130
2015/01/23 13:26:43| Sending ICP messages from [::]:3130
2015/01/23 13:26:43| pinger: Initialising ICMP pinger ...
2015/01/23 13:26:43| pinger: ICMP socket opened.
2015/01/23 13:26:43| pinger: ICMPv6 socket opened
2015/01/23 13:26:43| Store rebuilding is 50.88% complete
2015/01/23 13:26:43| Done reading /usr/local/squid/cache swaplog (7861
entries)
2015/01/23 13:26:43| Finished rebuilding storage from disk.
2015/01/23 13:26:43|      7845 Entries scanned
2015/01/23 13:26:43|         0 Invalid entries.
2015/01/23 13:26:43|         0 With invalid flags.
2015/01/23 13:26:43|      7829 Objects loaded.
2015/01/23 13:26:43|         0 Objects expired.
2015/01/23 13:26:43|        16 Objects cancelled.
2015/01/23 13:26:43|         0 Duplicate URLs purged.
2015/01/23 13:26:43|         0 Swapfile clashes avoided.
2015/01/23 13:26:43|   Took 0.05 seconds (168735.72 objects/sec).
2015/01/23 13:26:43| Beginning Validation Procedure
2015/01/23 13:26:43|   Completed Validation Procedure
2015/01/23 13:26:43|   Validated 7829 Entries
2015/01/23 13:26:43|   store_swap_size = 457188.00 KB
2015/01/23 13:26:44| storeLateRelease: released 0 objects
2015/01/23 13:26:47| CBDATA memory leak. cbdata=0x804ce9b78
dns_internal.cc:1131
2015/01/23 13:26:47| CBDATA memory leak. cbdata=0x804b1d7d8 ipcache.cc:353
2015/01/23 13:26:47| CBDATA memory leak. cbdata=0x8048b2698 Checklist.cc:45
2015/01/23 13:26:47| CBDATA memory leak. cbdata=0x804b1d7d8 Checklist.cc:160
2015/01/23 13:26:47| CBDATA memory leak. cbdata=0x804b1b618 helper.cc:856
2015/01/23 13:26:47| CBDATA memory leak. cbdata=0x804b1d7d8 redirect.cc:176
2015/01/23 13:26:47| CBDATA memory leak. cbdata=0x8049e9498
store_client.cc:337
2015/01/23 13:26:48| CBDATA memory leak. cbdata=0x804ce9b78 ipcache.cc:353
2015/01/23 13:26:48| CBDATA memory leak. cbdata=0x8048b27d8 Checklist.cc:45
2015/01/23 13:26:48| CBDATA memory leak. cbdata=0x8094c8058
store_client.cc:154
2015/01/23 13:26:48| CBDATA memory leak. cbdata=0x8049e9498
store_client.cc:337
2015/01/23 13:26:48| CBDATA memory leak. cbdata=0x8049e9498
store_client.cc:337
2015/01/23 13:26:48| CBDATA memory leak. cbdata=0x8094c6058 CommCalls.cc:21
2015/01/23 13:26:48| CBDATA memory leak. cbdata=0x8094c8058
store_client.cc:154
2015/01/23 13:26:48| CBDATA memory leak. cbdata=0x8049e9498
store_client.cc:337
2015/01/23 13:26:48| CBDATA memory leak. cbdata=0x804ab8458 CommCalls.cc:21
2015/01/23 13:26:48| CBDATA memory leak. cbdata=0x8094c8058
store_client.cc:154
2015/01/23 13:26:48| CBDATA memory leak. cbdata=0x8049e9498
store_client.cc:337
2015/01/23 13:26:48| CBDATA memory leak. cbdata=0x804b1d718
clientStream.cc:235
2015/01/23 13:26:48| CBDATA memory leak. cbdata=0x8048b2558 Checklist.cc:320

I am running squid like:
/usr/local/sbin/squid -f /usr/local/etc/squid/squid.conf -N

I do not see any coredumps with this scenario even when I run with -NCd1

For the time being I have opted to run squid with cache_log set to
/dev/null. Not elegant at all.

So my questions:

Is anyone else here successfully running squid (3.4.10 or 3.5.x) in
intercept mode on FreeBSD 10.x using either PF or IPFilter?

I'd really love to compare notes. Maybe that will help clear my current
brain-lock!

Technically, I have reached my /etc on this one.

My squid.conf is available at http://pastebin.com/L16cDmRp





-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254733744121/+254722743223
"I can't hear you -- I'm using the scrambler."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150123/4b89184e/attachment.htm>

From yvoinov at gmail.com  Fri Jan 23 11:57:56 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Fri, 23 Jan 2015 17:57:56 +0600
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
Message-ID: <54C23744.9000800@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
redirection loop can only occurs when reqwiter or NAT misconfigured.

On early Squid versions to avoid loops was used:

# Rewriter cycle workaround
url_rewrite_access deny localhost

rule.

Somewhere in your configuration occurs redirector looping.

But I can't see URL rewriter in your config. This is looped configuration?

23.01.2015 17:37, Odhiambo Washington ?????:
> So for the past few days I have been struggling with Squid in intercept mode on FreeBSD-10.1.
>
> Using the same squid.conf for Squid-3.4.10 and Squid-3.5.1 and the
same Firewall rules (I have tested with IPFilter and PF and these rules
work with Squid-2.7.9 on several FreeBSD boxes that I have):
>
> 1. Squid-3.5.1 has completely refused to play along - always
complaining about "loop detected" and hence denying all requests
> 2. Squid-3.4.10 plays along, BUT has so much complaints in cache.log
as below:
>
> 2015/01/23 13:26:43| Set Current Directory to /usr/local/squid/logs
> 2015/01/23 13:26:43| Set Current Directory to /usr/local/squid/logs
> 2015/01/23 13:26:43| Starting Squid Cache version 3.4.10 for
amd64-portbld-freebsd10.1...
> 2015/01/23 13:26:43| Process ID 15770
> 2015/01/23 13:26:43| Process Roles: master worker
> 2015/01/23 13:26:43| With 114417 file descriptors available
> 2015/01/23 13:26:43| Initializing IP Cache...
> 2015/01/23 13:26:43| DNS Socket created at [::], FD 5
> 2015/01/23 13:26:43| DNS Socket created at 0.0.0.0, FD 6
> 2015/01/23 13:26:43| Adding domain ili.or.ug <http://ili.or.ug> from
/etc/resolv.conf
> 2015/01/23 13:26:43| Adding nameserver 127.0.0.1 from /etc/resolv.conf
> 2015/01/23 13:26:43| helperOpenServers: Starting 5/15 'ssl_crtd' processes
> 2015/01/23 13:26:43| helperOpenServers: Starting 10/15
'ut-squidbooster' processes
> 2015/01/23 13:26:43| Logfile: opening log
stdio:/usr/local/squid/logs/access.log
> 2015/01/23 13:26:43| Local cache digest enabled; rebuild/rewrite every
3600/3600 sec
> 2015/01/23 13:26:43| Store logging disabled
> 2015/01/23 13:26:43| Swap maxSize 104857600 + 131072 KB, estimated
8076051 objects
> 2015/01/23 13:26:43| Target number of buckets: 403802
> 2015/01/23 13:26:43| Using 524288 Store buckets
> 2015/01/23 13:26:43| Max Mem  size: 131072 KB
> 2015/01/23 13:26:43| Max Swap size: 104857600 KB
> 2015/01/23 13:26:43| Rebuilding storage in /usr/local/squid/cache
(dirty log)
> 2015/01/23 13:26:43| Using Least Load store dir selection
> 2015/01/23 13:26:43| Set Current Directory to /usr/local/squid/logs
> 2015/01/23 13:26:43| Finished loading MIME types and icons.
> 2015/01/23 13:26:43| HTCP Disabled.
> 2015/01/23 13:26:43| Pinger socket opened on FD 45
> 2015/01/23 13:26:43| Squid plugin modules loaded: 0
> 2015/01/23 13:26:43| Adaptation support is off.
> 2015/01/23 13:26:43| Accepting NAT intercepted HTTP Socket connections
at local=[::]:13128 remote=[::] FD 40 flags=41
> 2015/01/23 13:26:43| Accepting HTTP Socket connections at
local=[::]:13127 remote=[::] FD 41 flags=9
> 2015/01/23 13:26:43| Accepting NAT intercepted SSL bumped HTTPS Socket
connections at local=[::]:13129 remote=[::] FD 42 flags=41
> 2015/01/23 13:26:43| Accepting ICP messages on [::]:3130
> 2015/01/23 13:26:43| Sending ICP messages from [::]:3130
> 2015/01/23 13:26:43| pinger: Initialising ICMP pinger ...
> 2015/01/23 13:26:43| pinger: ICMP socket opened.
> 2015/01/23 13:26:43| pinger: ICMPv6 socket opened
> 2015/01/23 13:26:43| Store rebuilding is 50.88% complete
> 2015/01/23 13:26:43| Done reading /usr/local/squid/cache swaplog (7861
entries)
> 2015/01/23 13:26:43| Finished rebuilding storage from disk.
> 2015/01/23 13:26:43|      7845 Entries scanned
> 2015/01/23 13:26:43|         0 Invalid entries.
> 2015/01/23 13:26:43|         0 With invalid flags.
> 2015/01/23 13:26:43|      7829 Objects loaded.
> 2015/01/23 13:26:43|         0 Objects expired.
> 2015/01/23 13:26:43|        16 Objects cancelled.
> 2015/01/23 13:26:43|         0 Duplicate URLs purged.
> 2015/01/23 13:26:43|         0 Swapfile clashes avoided.
> 2015/01/23 13:26:43|   Took 0.05 seconds (168735.72 objects/sec).
> 2015/01/23 13:26:43| Beginning Validation Procedure
> 2015/01/23 13:26:43|   Completed Validation Procedure
> 2015/01/23 13:26:43|   Validated 7829 Entries
> 2015/01/23 13:26:43|   store_swap_size = 457188.00 KB
> 2015/01/23 13:26:44| storeLateRelease: released 0 objects
> 2015/01/23 13:26:47| CBDATA memory leak. cbdata=0x804ce9b78
dns_internal.cc:1131
> 2015/01/23 13:26:47| CBDATA memory leak. cbdata=0x804b1d7d8 ipcache.cc:353
> 2015/01/23 13:26:47| CBDATA memory leak. cbdata=0x8048b2698
Checklist.cc:45
> 2015/01/23 13:26:47| CBDATA memory leak. cbdata=0x804b1d7d8
Checklist.cc:160
> 2015/01/23 13:26:47| CBDATA memory leak. cbdata=0x804b1b618 helper.cc:856
> 2015/01/23 13:26:47| CBDATA memory leak. cbdata=0x804b1d7d8
redirect.cc:176
> 2015/01/23 13:26:47| CBDATA memory leak. cbdata=0x8049e9498
store_client.cc:337
> 2015/01/23 13:26:48| CBDATA memory leak. cbdata=0x804ce9b78 ipcache.cc:353
> 2015/01/23 13:26:48| CBDATA memory leak. cbdata=0x8048b27d8
Checklist.cc:45
> 2015/01/23 13:26:48| CBDATA memory leak. cbdata=0x8094c8058
store_client.cc:154
> 2015/01/23 13:26:48| CBDATA memory leak. cbdata=0x8049e9498
store_client.cc:337
> 2015/01/23 13:26:48| CBDATA memory leak. cbdata=0x8049e9498
store_client.cc:337
> 2015/01/23 13:26:48| CBDATA memory leak. cbdata=0x8094c6058
CommCalls.cc:21
> 2015/01/23 13:26:48| CBDATA memory leak. cbdata=0x8094c8058
store_client.cc:154
> 2015/01/23 13:26:48| CBDATA memory leak. cbdata=0x8049e9498
store_client.cc:337
> 2015/01/23 13:26:48| CBDATA memory leak. cbdata=0x804ab8458
CommCalls.cc:21
> 2015/01/23 13:26:48| CBDATA memory leak. cbdata=0x8094c8058
store_client.cc:154
> 2015/01/23 13:26:48| CBDATA memory leak. cbdata=0x8049e9498
store_client.cc:337
> 2015/01/23 13:26:48| CBDATA memory leak. cbdata=0x804b1d718
clientStream.cc:235
> 2015/01/23 13:26:48| CBDATA memory leak. cbdata=0x8048b2558
Checklist.cc:320
>
> I am running squid like:
> /usr/local/sbin/squid -f /usr/local/etc/squid/squid.conf -N
>
> I do not see any coredumps with this scenario even when I run with -NCd1
>
> For the time being I have opted to run squid with cache_log set to
/dev/null. Not elegant at all.
>
> So my questions:
>
> Is anyone else here successfully running squid (3.4.10 or 3.5.x) in
intercept mode on FreeBSD 10.x using either PF or IPFilter?
>
> I'd really love to compare notes. Maybe that will help clear my
current brain-lock!
>
> Technically, I have reached my /etc on this one.
>
> My squid.conf is available at http://pastebin.com/L16cDmRp
>
>
>
>
>
> --
> Best regards,
> Odhiambo WASHINGTON,
> Nairobi,KE
> +254733744121/+254722743223
> "I can't hear you -- I'm using the scrambler."
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUwjdEAAoJENNXIZxhPexGgB0IALoQUrOwWHmn75BZxXtFynCs
KspBiPlLnCx0o/bv5mjmyeQChEeH/vAelMupIAvfF7tHnfX1No7JJ6zXuULNfkka
0rvBVpbqqP6XZwVnS8Bfqwan4za7nvt5g3Fasj0Qw/bx9n0QF9roUOsPr7QeudmM
SoKE45QXsoaznW8+ObE+oRM4108qpEDZb6IuWTAO7hFu4hyctvAw6LcAU718gu43
AW8D2RrSGQaKoE75ah+PblopkjjoQxj1ycg0lgbt5h37DiNuP7flN5VSz/vahbkg
Z27L/PWRipmblfp2fsoHWJjNBCgd8fcfbdRifPD/gMSs23de/FAGUu6liMNdaqU=
=Qy97
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150123/b7a2e312/attachment.htm>

From odhiambo at gmail.com  Fri Jan 23 12:10:37 2015
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Fri, 23 Jan 2015 15:10:37 +0300
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <54C23744.9000800@gmail.com>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
 <54C23744.9000800@gmail.com>
Message-ID: <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>

On 23 January 2015 at 14:57, Yuri Voinov <yvoinov at gmail.com> wrote:

>
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> redirection loop can only occurs when reqwiter or NAT misconfigured.
>
> On early Squid versions to avoid loops was used:
>
> # Rewriter cycle workaround
> url_rewrite_access deny localhost
>
> rule.
>
> Somewhere in your configuration occurs redirector looping.
>
> But I can't see URL rewriter in your config. This is looped configuration?
>


Hi Yuri,

That is the squid.conf that is causing the looping with squid-3.5.1.
With squid-3.4.10 it is causing the errors I posted ..

My PF firewall rules are simple. Available at
http://41.190.203.157/~wash/pf.conf.txt. with the main rule for
interception being:

rdr on $int_if proto tcp from $int_network to any port 80 -> $int_addr
port 13128



-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254733744121/+254722743223
"I can't hear you -- I'm using the scrambler."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150123/98c8c9b8/attachment.htm>

From yvoinov at gmail.com  Fri Jan 23 12:13:59 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Fri, 23 Jan 2015 18:13:59 +0600
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
 <54C23744.9000800@gmail.com>
 <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>
Message-ID: <54C23B07.20405@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Did you have any service can listen port 80 on your host? I.e. web-server?

23.01.2015 18:10, Odhiambo Washington ?????:
>
>
> On 23 January 2015 at 14:57, Yuri Voinov <yvoinov at gmail.com
<mailto:yvoinov at gmail.com>> wrote:
>
>
>     -----BEGIN PGP SIGNED MESSAGE-----
>     Hash: SHA1
>     
>     redirection loop can only occurs when reqwiter or NAT misconfigured.
>
>     On early Squid versions to avoid loops was used:
>
>     # Rewriter cycle workaround
>     url_rewrite_access deny localhost
>
>     rule.
>
>     Somewhere in your configuration occurs redirector looping.
>
>     But I can't see URL rewriter in your config. This is looped
configuration?
>
>
>
> Hi Yuri,
>
> That is the squid.conf that is causing the looping with squid-3.5.1.
> With squid-3.4.10 it is causing the errors I posted ..
>
> My PF firewall rules are simple. Available at
http://41.190.203.157/~wash/pf.conf.txt. with the main rule for
interception being:
>
> rdr on $int_if proto tcp from $int_network to any port 80 -> $int_addr
port 13128
>
>
> --
> Best regards,
> Odhiambo WASHINGTON,
> Nairobi,KE
> +254733744121/+254722743223
> "I can't hear you -- I'm using the scrambler."

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUwjsHAAoJENNXIZxhPexGS3AH/AqPOZ7XNYgjC3pmO6RpgFA6
ZM662ly9DqX7XQ3Hcin+qBODHUF3whTamSvo1oDFHpMdxlxbPnyydJF90b6erIA0
Pbx2rtBvaDrvDdRQSzbMGbw4tvDgW5M02f8SiwmzxUKMlZ9DsVMhgpO6ybLXQhfu
AmB+GLPyRdgznc20DT2sxULywFgqpUbepcdppRFz+0Enz/u8qkvsoiG2D86bAuy0
RjK+J0F/SOBqgWNCe234yQoK/hwEP+Ih8tZ+XQX5KRsC9TM9gyXrdQ2vlrZC7KJr
UWm+w16hmMY1u/vqL7jTilwkSCvQOaifNaKVN6oNBYPZ7An4ONA6W04tpSFO+do=
=ztU7
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150123/a4ef67e7/attachment.htm>

From odhiambo at gmail.com  Fri Jan 23 12:16:27 2015
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Fri, 23 Jan 2015 15:16:27 +0300
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <54C23B07.20405@gmail.com>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
 <54C23744.9000800@gmail.com>
 <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>
 <54C23B07.20405@gmail.com>
Message-ID: <CAAdA2WPp9C-c9ZvW=v6_+Fm34NxZcVB2tmLpYqcHUdaUsx+cGg@mail.gmail.com>

On 23 January 2015 at 15:13, Yuri Voinov <yvoinov at gmail.com> wrote:

>
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Did you have any service can listen port 80 on your host? I.e. web-server?
>
>
Yes. There is a webserver on the same host, listening on both 80 and 443.




-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254733744121/+254722743223
"I can't hear you -- I'm using the scrambler."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150123/b070967f/attachment.htm>

From yvoinov at gmail.com  Fri Jan 23 12:17:53 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Fri, 23 Jan 2015 18:17:53 +0600
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <CAAdA2WPp9C-c9ZvW=v6_+Fm34NxZcVB2tmLpYqcHUdaUsx+cGg@mail.gmail.com>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
 <54C23744.9000800@gmail.com>
 <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>
 <54C23B07.20405@gmail.com>
 <CAAdA2WPp9C-c9ZvW=v6_+Fm34NxZcVB2tmLpYqcHUdaUsx+cGg@mail.gmail.com>
Message-ID: <54C23BF1.1030608@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Here is it.

There is your loop reason.

23.01.2015 18:16, Odhiambo Washington ?????:
>
>
> On 23 January 2015 at 15:13, Yuri Voinov <yvoinov at gmail.com
<mailto:yvoinov at gmail.com>> wrote:
>
>
>     -----BEGIN PGP SIGNED MESSAGE-----
>     Hash: SHA1
>     
>     Did you have any service can listen port 80 on your host? I.e.
web-server?
>
>
> Yes. There is a webserver on the same host, listening on both 80 and 443.
> 
>
>
>
> --
> Best regards,
> Odhiambo WASHINGTON,
> Nairobi,KE
> +254733744121/+254722743223
> "I can't hear you -- I'm using the scrambler."

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUwjvxAAoJENNXIZxhPexG8jgH/2pKS/zYWnCdnxIzmMiYi90V
W8Q6xbPgJ0uhe4w364LtdJadDCHXBEfNX6ONhfXcm4nwYKmSLEft1dWckW2B3lga
md2RWCvrI/AQ7jxstvxPBB0NSWk+tlvFJyTgwm6ot5/ABjl8foH786RmdtyT6eQy
oaiCKKIVp5mz2105Fn5dmFVOhKJI1MC+7pqv2w0CrHsz2HDmpH96bryog/k3ircK
EMKZbpHIg8rSxdOHQgAg5tHFJi3ekpLBlCGcXp232EHT3xzmFLJz6YKyBbq9sf5L
e5NoaquUqW5rP083gxPwTcNcwosEmASOX9+Ey0ZqE4KMvAX+k2Hu3Fq2XBOPXJQ=
=SAmZ
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150123/b7ffa3af/attachment.htm>

From odhiambo at gmail.com  Fri Jan 23 12:42:26 2015
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Fri, 23 Jan 2015 15:42:26 +0300
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <54C23BF1.1030608@gmail.com>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
 <54C23744.9000800@gmail.com>
 <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>
 <54C23B07.20405@gmail.com>
 <CAAdA2WPp9C-c9ZvW=v6_+Fm34NxZcVB2tmLpYqcHUdaUsx+cGg@mail.gmail.com>
 <54C23BF1.1030608@gmail.com>
Message-ID: <CAAdA2WP2S_TpgK-q+vAwE5ejVxn7F2ipAoKoM1WF0C9rnV=Aaw@mail.gmail.com>

On 23 January 2015 at 15:17, Yuri Voinov <yvoinov at gmail.com> wrote:

>
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Here is it.
>
> There is your loop reason.
>
>
root at mail:/usr/src # svn
Type 'svn help' for usage.
root at mail:/usr/src # sockstat -l | grep 80
www      httpd      55941 3  tcp6   *:80                  *:*
www      httpd      55941 4  tcp4   *:80                  *:*
www      httpd      55941 5  tcp6   *:8080                *:*
www      httpd      55941 6  tcp4   *:8080                *:*
www      httpd      69148 3  tcp6   *:80                  *:*
www      httpd      69148 4  tcp4   *:80                  *:*
www      httpd      69148 5  tcp6   *:8080                *:*
www      httpd      69148 6  tcp4   *:8080                *:*
www      httpd      69145 3  tcp6   *:80                  *:*
www      httpd      69145 4  tcp4   *:80                  *:*
www      httpd      69145 5  tcp6   *:8080                *:*
www      httpd      69145 6  tcp4   *:8080                *:*
www      httpd      69142 3  tcp6   *:80                  *:*
www      httpd      69142 4  tcp4   *:80                  *:*
www      httpd      69142 5  tcp6   *:8080                *:*
www      httpd      69142 6  tcp4   *:8080                *:*
www      httpd      11049 3  tcp6   *:80                  *:*
www      httpd      11049 4  tcp4   *:80                  *:*
www      httpd      11049 5  tcp6   *:8080                *:*
www      httpd      11049 6  tcp4   *:8080                *:*
www      httpd      11044 3  tcp6   *:80                  *:*
www      httpd      11044 4  tcp4   *:80                  *:*
www      httpd      11044 5  tcp6   *:8080                *:*
www      httpd      11044 6  tcp4   *:8080                *:*
www      httpd      993   3  tcp6   *:80                  *:*
www      httpd      993   4  tcp4   *:80                  *:*
www      httpd      993   5  tcp6   *:8080                *:*
www      httpd      993   6  tcp4   *:8080                *:*
www      httpd      991   3  tcp6   *:80                  *:*
www      httpd      991   4  tcp4   *:80                  *:*
www      httpd      991   5  tcp6   *:8080                *:*
www      httpd      991   6  tcp4   *:8080                *:*
www      httpd      990   3  tcp6   *:80                  *:*
www      httpd      990   4  tcp4   *:80                  *:*
www      httpd      990   5  tcp6   *:8080                *:*
www      httpd      990   6  tcp4   *:8080                *:*
www      httpd      989   3  tcp6   *:80                  *:*
www      httpd      989   4  tcp4   *:80                  *:*
www      httpd      989   5  tcp6   *:8080                *:*
www      httpd      989   6  tcp4   *:8080                *:*
root     httpd      912   3  tcp6   *:80                  *:*
root     httpd      912   4  tcp4   *:80                  *:*
root     httpd      912   5  tcp6   *:8080                *:*
root     httpd      912   6  tcp4   *:8080                *:*
root at mail:/usr/src # /usr/local/etc/rc.d/apache24 stop
Stopping apache24.
Waiting for PIDS: 912.
root at mail:/usr/src # sockstat -l | grep 80
root at mail:/usr/src #

Here is an attempt to address the problem based on your observation:

1. I killed the httpd so that there is nothing listening on port 80.
2. Started squid-3.5.1 and cache log was clean. However access is DENIED to
all requests so no one can browse!

Seems we're headed somewhere.
However, I have other servers running squid-2.7.9 and there is a webserver
on the same machine (gateway) and they play along nicely!







-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254733744121/+254722743223
"I can't hear you -- I'm using the scrambler."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150123/4c4733e7/attachment.htm>

From yvoinov at gmail.com  Fri Jan 23 12:47:02 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Fri, 23 Jan 2015 18:47:02 +0600
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <CAAdA2WP2S_TpgK-q+vAwE5ejVxn7F2ipAoKoM1WF0C9rnV=Aaw@mail.gmail.com>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
 <54C23744.9000800@gmail.com>
 <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>
 <54C23B07.20405@gmail.com>
 <CAAdA2WPp9C-c9ZvW=v6_+Fm34NxZcVB2tmLpYqcHUdaUsx+cGg@mail.gmail.com>
 <54C23BF1.1030608@gmail.com>
 <CAAdA2WP2S_TpgK-q+vAwE5ejVxn7F2ipAoKoM1WF0C9rnV=Aaw@mail.gmail.com>
Message-ID: <54C242C6.3030804@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Once more. You CANNOT have neither web-server nor other service with
listening port 80 on the same host as transparent Squid proxy. This is
one and only reason you have looping.

Look. On my transparent 3.4.11 (which was early 2.7) IPFilter redirects
80 port to proxy. My web server on the same host listens only 8080, 8088
and 8888 ports. No one service except NAT is using 80 port.

And finally I have no looping 4 years.

Obvious, is it?

23.01.2015 18:42, Odhiambo Washington ?????:
>
>
> On 23 January 2015 at 15:17, Yuri Voinov <yvoinov at gmail.com
<mailto:yvoinov at gmail.com>> wrote:
>
>
>     -----BEGIN PGP SIGNED MESSAGE-----
>     Hash: SHA1
>     
>     Here is it.
>
>     There is your loop reason.
>
>
> root at mail:/usr/src # svn
> Type 'svn help' for usage.
> root at mail:/usr/src # sockstat -l | grep 80
> www      httpd      55941 3  tcp6   *:80                  *:*
> www      httpd      55941 4  tcp4   *:80                  *:*
> www      httpd      55941 5  tcp6   *:8080                *:*
> www      httpd      55941 6  tcp4   *:8080                *:*
> www      httpd      69148 3  tcp6   *:80                  *:*
> www      httpd      69148 4  tcp4   *:80                  *:*
> www      httpd      69148 5  tcp6   *:8080                *:*
> www      httpd      69148 6  tcp4   *:8080                *:*
> www      httpd      69145 3  tcp6   *:80                  *:*
> www      httpd      69145 4  tcp4   *:80                  *:*
> www      httpd      69145 5  tcp6   *:8080                *:*
> www      httpd      69145 6  tcp4   *:8080                *:*
> www      httpd      69142 3  tcp6   *:80                  *:*
> www      httpd      69142 4  tcp4   *:80                  *:*
> www      httpd      69142 5  tcp6   *:8080                *:*
> www      httpd      69142 6  tcp4   *:8080                *:*
> www      httpd      11049 3  tcp6   *:80                  *:*
> www      httpd      11049 4  tcp4   *:80                  *:*
> www      httpd      11049 5  tcp6   *:8080                *:*
> www      httpd      11049 6  tcp4   *:8080                *:*
> www      httpd      11044 3  tcp6   *:80                  *:*
> www      httpd      11044 4  tcp4   *:80                  *:*
> www      httpd      11044 5  tcp6   *:8080                *:*
> www      httpd      11044 6  tcp4   *:8080                *:*
> www      httpd      993   3  tcp6   *:80                  *:*
> www      httpd      993   4  tcp4   *:80                  *:*
> www      httpd      993   5  tcp6   *:8080                *:*
> www      httpd      993   6  tcp4   *:8080                *:*
> www      httpd      991   3  tcp6   *:80                  *:*
> www      httpd      991   4  tcp4   *:80                  *:*
> www      httpd      991   5  tcp6   *:8080                *:*
> www      httpd      991   6  tcp4   *:8080                *:*
> www      httpd      990   3  tcp6   *:80                  *:*
> www      httpd      990   4  tcp4   *:80                  *:*
> www      httpd      990   5  tcp6   *:8080                *:*
> www      httpd      990   6  tcp4   *:8080                *:*
> www      httpd      989   3  tcp6   *:80                  *:*
> www      httpd      989   4  tcp4   *:80                  *:*
> www      httpd      989   5  tcp6   *:8080                *:*
> www      httpd      989   6  tcp4   *:8080                *:*
> root     httpd      912   3  tcp6   *:80                  *:*
> root     httpd      912   4  tcp4   *:80                  *:*
> root     httpd      912   5  tcp6   *:8080                *:*
> root     httpd      912   6  tcp4   *:8080                *:*
> root at mail:/usr/src # /usr/local/etc/rc.d/apache24 stop
> Stopping apache24.
> Waiting for PIDS: 912.
> root at mail:/usr/src # sockstat -l | grep 80
> root at mail:/usr/src #
>
> Here is an attempt to address the problem based on your observation:
>
> 1. I killed the httpd so that there is nothing listening on port 80.
> 2. Started squid-3.5.1 and cache log was clean. However access is
DENIED to all requests so no one can browse!
>
> Seems we're headed somewhere.
> However, I have other servers running squid-2.7.9 and there is a
webserver on the same machine (gateway) and they play along nicely!
>
>
>
>
>
>
>
> --
> Best regards,
> Odhiambo WASHINGTON,
> Nairobi,KE
> +254733744121/+254722743223
> "I can't hear you -- I'm using the scrambler."

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUwkLFAAoJENNXIZxhPexGjuMIAIay48OKf1zy1MShsK5cC+di
EjbEupjWlzjzEZ3jthg7drnNdnHvR2iXUtBujNzs7ed1iQUxspaOtUQRgqNTHufs
rgYk+e7yK9Iz33p3T9jNzK9HIJMLNgjcFolI3eTrdMBlj6ujra0L1CDrYnz1ZFEz
/4FrHSwHcEeiCVdnj74nDYFxR29uhCrYjehtsnNDKkmipXhjiFzriORYNT0t3j7D
q6HiVDiSJyNtdKYuOXRnmFMfYMQlCj2iQZsWfNmFAaMmxmaRjvHH81UBB45hjMUw
t5C8YCI/wcyrLJ3BqrXiQZjZawbWhvfI449mGG/uSocq5QGqK2qtQsCKrSgf4cw=
=+rLY
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150123/ff758856/attachment.htm>

From squid3 at treenet.co.nz  Fri Jan 23 13:07:34 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 24 Jan 2015 02:07:34 +1300
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <54C242C6.3030804@gmail.com>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
 <54C23744.9000800@gmail.com>
 <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>
 <54C23B07.20405@gmail.com>
 <CAAdA2WPp9C-c9ZvW=v6_+Fm34NxZcVB2tmLpYqcHUdaUsx+cGg@mail.gmail.com>
 <54C23BF1.1030608@gmail.com>
 <CAAdA2WP2S_TpgK-q+vAwE5ejVxn7F2ipAoKoM1WF0C9rnV=Aaw@mail.gmail.com>
 <54C242C6.3030804@gmail.com>
Message-ID: <54C24796.5010601@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 24/01/2015 1:47 a.m., Yuri Voinov wrote:
> 
> Once more. You CANNOT have neither web-server nor other service
> with listening port 80 on the same host as transparent Squid proxy.
> This is one and only reason you have looping.
> 

That is not correct. It can be done, but depends on how the firewall
operates and what ruleset is used.

One has to intercept traffic transiting the machine, but ignore
traffic destined *to* or *from* the local machines running processes.

> Look. On my transparent 3.4.11 (which was early 2.7) IPFilter
> redirects 80 port to proxy. My web server on the same host listens
> only 8080, 8088 and 8888 ports. No one service except NAT is using
> 80 port.
> 
> And finally I have no looping 4 years.
> 
> Obvious, is it?
> 

Maybe there was, maybe there wasn't.

Squid-2.7 ignored a lot of NAT related errors and even silently did
some Very Bad Things(tm) - none of which Squid-3.2+ will allow to
happen anymore.


Odhiambo:
I suspect it might be related to your use of "rdr" firewall rules. In
OpenBSD PF at least rdr rules do not work properly and divert-to rules
needs to be used instead (divert-to can be used for either TPROXY or
NAT Squid listening ports on BSD).

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUwkeWAAoJELJo5wb/XPRjImUIANjXvqdDsm7FUGmSG0lCikPS
EBl2xGqatglZnQOQQ1KnVX4oLtcDqtFUaAMNUedGrQc0JNsGHIIOqNioehJuTSko
ET/gYf6otuqGyjGz2CZIXcoaFUOwXNd7jkt8jx3n4k5D0HemfOYH//bAdMRarNuZ
NV7YPoWOxjYQHFvBE2fFCDl9yslXSYrvBbCJxueFVTkI0SQ1NoRtotaOeOZFe9hy
Y1zWihly/5koQfTg99tYCuUpNgRYuNslRaSYSfx1PTFQQTTYkw20OeYES6ZFxMp1
jt2vARsvxePndzVFT+rmadoQQDgCk6NbwON4LpexoulhJcGzuH5xb6z1CQaZvE0=
=Joqh
-----END PGP SIGNATURE-----


From odhiambo at gmail.com  Fri Jan 23 13:13:24 2015
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Fri, 23 Jan 2015 16:13:24 +0300
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <54C242C6.3030804@gmail.com>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
 <54C23744.9000800@gmail.com>
 <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>
 <54C23B07.20405@gmail.com>
 <CAAdA2WPp9C-c9ZvW=v6_+Fm34NxZcVB2tmLpYqcHUdaUsx+cGg@mail.gmail.com>
 <54C23BF1.1030608@gmail.com>
 <CAAdA2WP2S_TpgK-q+vAwE5ejVxn7F2ipAoKoM1WF0C9rnV=Aaw@mail.gmail.com>
 <54C242C6.3030804@gmail.com>
Message-ID: <CAAdA2WNp0j9UZVgekJTRbYhu1KqHVoM=snGT=SxF5frCX_nGng@mail.gmail.com>

On 23 January 2015 at 15:47, Yuri Voinov <yvoinov at gmail.com> wrote:

>
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Once more. You CANNOT have neither web-server nor other service with
> listening port 80 on the same host as transparent Squid proxy. This is one
> and only reason you have looping.
>
> Look. On my transparent 3.4.11 (which was early 2.7) IPFilter redirects 80
> port to proxy. My web server on the same host listens only 8080, 8088 and
> 8888 ports. No one service except NAT is using 80 port.
>
> And finally I have no looping 4 years.
>
> Obvious, is it?
>
>
Not so obvious.

I have a several servers with Apache listening on 80,443 which don't have
this problem!
I can give you access to one of them to see for yourself if you need to
believe.

Anyway, this still doesn't help me. After changing my apache to port 8080
and firing up squid-3.5.1, I get access denied for all requests:
http://pastebin.com/1fMSE1U9




-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254733744121/+254722743223
"I can't hear you -- I'm using the scrambler."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150123/2f974262/attachment.htm>

From odhiambo at gmail.com  Fri Jan 23 13:20:59 2015
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Fri, 23 Jan 2015 16:20:59 +0300
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <54C24796.5010601@treenet.co.nz>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
 <54C23744.9000800@gmail.com>
 <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>
 <54C23B07.20405@gmail.com>
 <CAAdA2WPp9C-c9ZvW=v6_+Fm34NxZcVB2tmLpYqcHUdaUsx+cGg@mail.gmail.com>
 <54C23BF1.1030608@gmail.com>
 <CAAdA2WP2S_TpgK-q+vAwE5ejVxn7F2ipAoKoM1WF0C9rnV=Aaw@mail.gmail.com>
 <54C242C6.3030804@gmail.com> <54C24796.5010601@treenet.co.nz>
Message-ID: <CAAdA2WO9EHWOmtpztKii3VOu_soyZjwSBcjE-xqifLR3aWnRtw@mail.gmail.com>

On 23 January 2015 at 16:07, Amos Jeffries <squid3 at treenet.co.nz> wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 24/01/2015 1:47 a.m., Yuri Voinov wrote:
> >
> > Once more. You CANNOT have neither web-server nor other service
> > with listening port 80 on the same host as transparent Squid proxy.
> > This is one and only reason you have looping.
> >
>
> That is not correct. It can be done, but depends on how the firewall
> operates and what ruleset is used.
>
> One has to intercept traffic transiting the machine, but ignore
> traffic destined *to* or *from* the local machines running processes.
>
> > Look. On my transparent 3.4.11 (which was early 2.7) IPFilter
> > redirects 80 port to proxy. My web server on the same host listens
> > only 8080, 8088 and 8888 ports. No one service except NAT is using
> > 80 port.
> >
> > And finally I have no looping 4 years.
> >
> > Obvious, is it?
> >
>
> Maybe there was, maybe there wasn't.
>
> Squid-2.7 ignored a lot of NAT related errors and even silently did
> some Very Bad Things(tm) - none of which Squid-3.2+ will allow to
> happen anymore.
>
>
> Odhiambo:
> I suspect it might be related to your use of "rdr" firewall rules. In
> OpenBSD PF at least rdr rules do not work properly and divert-to rules
> needs to be used instead (divert-to can be used for either TPROXY or
> NAT Squid listening ports on BSD).
>


I am thinking Squid-3.2+ is evil :-)

Anyway, my PF rules are here : http://pastebin.com/pKv1jN2v
And my IPFilter rules are here: http://pastebin.com/JQ77X01H

I need to figure out why squid is DENYing all access ..


-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254733744121/+254722743223
"I can't hear you -- I'm using the scrambler."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150123/e9a3992d/attachment.htm>

From freebsd at lidstrom.eu  Fri Jan 23 13:25:51 2015
From: freebsd at lidstrom.eu (=?UTF-8?B?SGVucmlrIExpZHN0csO2bQ==?=)
Date: Fri, 23 Jan 2015 14:25:51 +0100
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <CAAdA2WNp0j9UZVgekJTRbYhu1KqHVoM=snGT=SxF5frCX_nGng@mail.gmail.com>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
 <54C23744.9000800@gmail.com>
 <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>
 <54C23B07.20405@gmail.com>
 <CAAdA2WPp9C-c9ZvW=v6_+Fm34NxZcVB2tmLpYqcHUdaUsx+cGg@mail.gmail.com>
 <54C23BF1.1030608@gmail.com>
 <CAAdA2WP2S_TpgK-q+vAwE5ejVxn7F2ipAoKoM1WF0C9rnV=Aaw@mail.gmail.com>
 <54C242C6.3030804@gmail.com>
 <CAAdA2WNp0j9UZVgekJTRbYhu1KqHVoM=snGT=SxF5frCX_nGng@mail.gmail.com>
Message-ID: <54C24BDF.2020909@lidstrom.eu>



On 01/23/15 14:13, Odhiambo Washington wrote:
> 
> 
> On 23 January 2015 at 15:47, Yuri Voinov <yvoinov at gmail.com
> <mailto:yvoinov at gmail.com>> wrote:
> 
> 
>     -----BEGIN PGP SIGNED MESSAGE-----
>     Hash: SHA1
>      
>     Once more. You CANNOT have neither web-server nor other service with
>     listening port 80 on the same host as transparent Squid proxy. This
>     is one and only reason you have looping.
> 
>     Look. On my transparent 3.4.11 (which was early 2.7) IPFilter
>     redirects 80 port to proxy. My web server on the same host listens
>     only 8080, 8088 and 8888 ports. No one service except NAT is using
>     80 port.
> 
>     And finally I have no looping 4 years.
> 
>     Obvious, is it?
> 
> 
> Not so obvious.
> 
> I have a several servers with Apache listening on 80,443 which don't
> have this problem!
> I can give you access to one of them to see for yourself if you need to
> believe.
> 
> Anyway, this still doesn't help me. After changing my apache to port
> 8080 and firing up squid-3.5.1, I get access denied for all
> requests: http://pastebin.com/1fMSE1U9
> 
> 
> 
> 
> -- 
> Best regards,
> Odhiambo WASHINGTON,
> Nairobi,KE
> +254733744121/+254722743223
> "I can't hear you -- I'm using the scrambler."
> 

My workaround at home (since Squid changed it's intercept/transparent
code a while back) is to rdr to a small squid server running on firewall
machine, then cache_peer all traffic to my real squid machine.

/Henrik



From yvoinov at gmail.com  Fri Jan 23 13:29:50 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Fri, 23 Jan 2015 19:29:50 +0600
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <54C24BDF.2020909@lidstrom.eu>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
 <54C23744.9000800@gmail.com>
 <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>
 <54C23B07.20405@gmail.com>
 <CAAdA2WPp9C-c9ZvW=v6_+Fm34NxZcVB2tmLpYqcHUdaUsx+cGg@mail.gmail.com>
 <54C23BF1.1030608@gmail.com>
 <CAAdA2WP2S_TpgK-q+vAwE5ejVxn7F2ipAoKoM1WF0C9rnV=Aaw@mail.gmail.com>
 <54C242C6.3030804@gmail.com>
 <CAAdA2WNp0j9UZVgekJTRbYhu1KqHVoM=snGT=SxF5frCX_nGng@mail.gmail.com>
 <54C24BDF.2020909@lidstrom.eu>
Message-ID: <54C24CCE.8080300@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
This looks like not optimal solution, Henrik.

A long time ago, when I meet similar issue, I've draw request way on my
proxy host and find cycling configuration.

It was chain NAT->proxy->redirector->NAT->proxy

To break it I completely differentiate service ports. On my system NAT
not permit to have listening services under rdr rules.

23.01.2015 19:25, Henrik Lidstr?m ?????:
>
>
> On 01/23/15 14:13, Odhiambo Washington wrote:
>>
>>
>> On 23 January 2015 at 15:47, Yuri Voinov <yvoinov at gmail.com
>> <mailto:yvoinov at gmail.com>> wrote:
>>
>>
>>     -----BEGIN PGP SIGNED MESSAGE-----
>>     Hash: SHA1
>>     
>>     Once more. You CANNOT have neither web-server nor other service with
>>     listening port 80 on the same host as transparent Squid proxy. This
>>     is one and only reason you have looping.
>>
>>     Look. On my transparent 3.4.11 (which was early 2.7) IPFilter
>>     redirects 80 port to proxy. My web server on the same host listens
>>     only 8080, 8088 and 8888 ports. No one service except NAT is using
>>     80 port.
>>
>>     And finally I have no looping 4 years.
>>
>>     Obvious, is it?
>>
>>
>> Not so obvious.
>>
>> I have a several servers with Apache listening on 80,443 which don't
>> have this problem!
>> I can give you access to one of them to see for yourself if you need to
>> believe.
>>
>> Anyway, this still doesn't help me. After changing my apache to port
>> 8080 and firing up squid-3.5.1, I get access denied for all
>> requests: http://pastebin.com/1fMSE1U9
>>
>>
>>
>>
>> --
>> Best regards,
>> Odhiambo WASHINGTON,
>> Nairobi,KE
>> +254733744121/+254722743223
>> "I can't hear you -- I'm using the scrambler."
>>
>
> My workaround at home (since Squid changed it's intercept/transparent
> code a while back) is to rdr to a small squid server running on firewall
> machine, then cache_peer all traffic to my real squid machine.
>
> /Henrik
>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUwkzOAAoJENNXIZxhPexGOMoH/1zSZC4n+KHC0Bpvf8mMhCNg
sOhxhmcVGCb3EwF9xNWZXYUib5u2kS8jOjYfmrC9XdUxx3Ba34xcb4IuME2RGw0K
ihayTF4eZ421B71CRF+Y7ZRUxDXjI+HIy4IyuD3KApg6qA5js8rKhZQ23dL/Ws14
RA2n5M1+8oNXbAFQS55HFvvYgyEuypistm4fjQy3cY5YBJ2z8faeAVEoQxv+smQf
IUMkqEHtBGORI4RBgZzZ2Q0SLSCc5s+wYdiOm1ARTYITVHZ7Vw1QsMRD5g2UP9H9
pDl4KnGCVCpL0U263W3N8HnVj91EqLJw6Ls4khHdQLiuifIGRMw7YBdyA1hX9JA=
=YaMn
-----END PGP SIGNATURE-----



From squid3 at treenet.co.nz  Fri Jan 23 13:29:50 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 24 Jan 2015 02:29:50 +1300
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <CAAdA2WNp0j9UZVgekJTRbYhu1KqHVoM=snGT=SxF5frCX_nGng@mail.gmail.com>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
 <54C23744.9000800@gmail.com>
 <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>
 <54C23B07.20405@gmail.com>
 <CAAdA2WPp9C-c9ZvW=v6_+Fm34NxZcVB2tmLpYqcHUdaUsx+cGg@mail.gmail.com>
 <54C23BF1.1030608@gmail.com>
 <CAAdA2WP2S_TpgK-q+vAwE5ejVxn7F2ipAoKoM1WF0C9rnV=Aaw@mail.gmail.com>
 <54C242C6.3030804@gmail.com>
 <CAAdA2WNp0j9UZVgekJTRbYhu1KqHVoM=snGT=SxF5frCX_nGng@mail.gmail.com>
Message-ID: <54C24CCE.4020605@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 24/01/2015 2:13 a.m., Odhiambo Washington wrote:
> On 23 January 2015 at 15:47, Yuri Voinov <yvoinov at gmail.com>
> wrote:
> 
>> 
>> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
>> 
>> Once more. You CANNOT have neither web-server nor other service
>> with listening port 80 on the same host as transparent Squid
>> proxy. This is one and only reason you have looping.
>> 
>> Look. On my transparent 3.4.11 (which was early 2.7) IPFilter
>> redirects 80 port to proxy. My web server on the same host
>> listens only 8080, 8088 and 8888 ports. No one service except NAT
>> is using 80 port.
>> 
>> And finally I have no looping 4 years.
>> 
>> Obvious, is it?
>> 
>> 
> Not so obvious.
> 
> I have a several servers with Apache listening on 80,443 which
> don't have this problem! I can give you access to one of them to
> see for yourself if you need to believe.
> 
> Anyway, this still doesn't help me. After changing my apache to
> port 8080 and firing up squid-3.5.1, I get access denied for all
> requests: http://pastebin.com/1fMSE1U9
> 


Aha, here is the heart of problem:

2015/01/23 15:59:34.455| client_side.cc(2320) parseHttpRequest: HTTP
Client local=127.0.0.1:13128 remote=192.168.2.165:54234 FD 14 flags=33


The local= value shows what the machine NAT system told Squid the
original destination IP of the client connection was.

Resulting in the to_localhost ACL denying the client access through
the proxy.


Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUwkzOAAoJELJo5wb/XPRjQzwH/j4f+BBj90f6o08d1b+SvBNl
WuzsF6xif4MJfDsjf8+GNV50i+cvkhB5XPjVOXxPJcr3oQTHoi73FOzNnSRMo7zD
5Wyl+mih/rPyb2F2UNRCroNIMLvbdvlFcAo4LcUYikeQDrjHkGj56IrjJEqoEAPg
rXAGH8ON4r1hAnlB+V7dD5eXOUZcCZnaW3y97VzqVzKoe1XEbQniy9J02EmR831s
UBYyROveCXY3jHpXpsX+7VR2aVDZ52qht/REfEtLZu1pc4Ksc0s/mp/Sx6rQKsE6
++Zf0fpTw/nX97n3slHxBkZtUV4yEvcByE6+wgpx8CNqth3AxYJtIv23J/PD0qU=
=sFTR
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Fri Jan 23 13:40:30 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 24 Jan 2015 02:40:30 +1300
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <CAAdA2WO9EHWOmtpztKii3VOu_soyZjwSBcjE-xqifLR3aWnRtw@mail.gmail.com>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
 <54C23744.9000800@gmail.com>
 <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>
 <54C23B07.20405@gmail.com>
 <CAAdA2WPp9C-c9ZvW=v6_+Fm34NxZcVB2tmLpYqcHUdaUsx+cGg@mail.gmail.com>
 <54C23BF1.1030608@gmail.com>
 <CAAdA2WP2S_TpgK-q+vAwE5ejVxn7F2ipAoKoM1WF0C9rnV=Aaw@mail.gmail.com>
 <54C242C6.3030804@gmail.com> <54C24796.5010601@treenet.co.nz>
 <CAAdA2WO9EHWOmtpztKii3VOu_soyZjwSBcjE-xqifLR3aWnRtw@mail.gmail.com>
Message-ID: <54C24F4E.50600@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 24/01/2015 2:20 a.m., Odhiambo Washington wrote:
> On 23 January 2015 at 16:07, Amos Jeffries <squid3 at treenet.co.nz>
> wrote:
> 
>> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
>> 
>> On 24/01/2015 1:47 a.m., Yuri Voinov wrote:
>>> 
>>> Once more. You CANNOT have neither web-server nor other
>>> service with listening port 80 on the same host as transparent
>>> Squid proxy. This is one and only reason you have looping.
>>> 
>> 
>> That is not correct. It can be done, but depends on how the
>> firewall operates and what ruleset is used.
>> 
>> One has to intercept traffic transiting the machine, but ignore 
>> traffic destined *to* or *from* the local machines running
>> processes.
>> 
>>> Look. On my transparent 3.4.11 (which was early 2.7) IPFilter 
>>> redirects 80 port to proxy. My web server on the same host
>>> listens only 8080, 8088 and 8888 ports. No one service except
>>> NAT is using 80 port.
>>> 
>>> And finally I have no looping 4 years.
>>> 
>>> Obvious, is it?
>>> 
>> 
>> Maybe there was, maybe there wasn't.
>> 
>> Squid-2.7 ignored a lot of NAT related errors and even silently
>> did some Very Bad Things(tm) - none of which Squid-3.2+ will
>> allow to happen anymore.
>> 
>> 
>> Odhiambo: I suspect it might be related to your use of "rdr"
>> firewall rules. In OpenBSD PF at least rdr rules do not work
>> properly and divert-to rules needs to be used instead (divert-to
>> can be used for either TPROXY or NAT Squid listening ports on
>> BSD).
>> 
> 
> 
> I am thinking Squid-3.2+ is evil :-)
> 
> Anyway, my PF rules are here : http://pastebin.com/pKv1jN2v And my
> IPFilter rules are here: http://pastebin.com/JQ77X01H
> 
> I need to figure out why squid is DENYing all access ..
> 

Can you update me on what the squid -v output is from the Squid build
you are having issues with pleae?

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUwk9OAAoJELJo5wb/XPRjvncIAOAp0zReRGxQdsAw5KmvSQaY
/wgL0sU9xEVHNDIaMZqzdKKphsPUa8/ILiND1mZF3Wg2fiZ8vEj/BvAnOutKAggL
hZdx+tz/C8ZAIVw0WuY+GobY2tiKrwvU/HuP4zu8yd086xbqJkSrV4SeyW4Zw0uc
ZEziWHezR47S1TvCVCjNc/4dIsuvdiQ2Q9T7EPpEqUZXyaVkrULIzyC3VJQ6xklt
q95xN9ce6NvWcXTFfkVV0D+Y6xY8VQgllvauRZI45J4KzEST65hmhoybNoJQADyb
x1OjbFqudNZFeU5ItrkRSd1g1HYuQUl97ae5IiyIlfMuzb2oounE9t4qZc1/yZY=
=w4Lh
-----END PGP SIGNATURE-----


From odhiambo at gmail.com  Fri Jan 23 13:45:51 2015
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Fri, 23 Jan 2015 16:45:51 +0300
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <54C24CCE.4020605@treenet.co.nz>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
 <54C23744.9000800@gmail.com>
 <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>
 <54C23B07.20405@gmail.com>
 <CAAdA2WPp9C-c9ZvW=v6_+Fm34NxZcVB2tmLpYqcHUdaUsx+cGg@mail.gmail.com>
 <54C23BF1.1030608@gmail.com>
 <CAAdA2WP2S_TpgK-q+vAwE5ejVxn7F2ipAoKoM1WF0C9rnV=Aaw@mail.gmail.com>
 <54C242C6.3030804@gmail.com>
 <CAAdA2WNp0j9UZVgekJTRbYhu1KqHVoM=snGT=SxF5frCX_nGng@mail.gmail.com>
 <54C24CCE.4020605@treenet.co.nz>
Message-ID: <CAAdA2WOwjuWEuj9Dje4xRyE3cSuECX0K1Oq2kY6vyL-9ktAsuQ@mail.gmail.com>

On 23 January 2015 at 16:29, Amos Jeffries <squid3 at treenet.co.nz> wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 24/01/2015 2:13 a.m., Odhiambo Washington wrote:
> > On 23 January 2015 at 15:47, Yuri Voinov <yvoinov at gmail.com>
> > wrote:
> >
> >>
> >> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
> >>
> >> Once more. You CANNOT have neither web-server nor other service
> >> with listening port 80 on the same host as transparent Squid
> >> proxy. This is one and only reason you have looping.
> >>
> >> Look. On my transparent 3.4.11 (which was early 2.7) IPFilter
> >> redirects 80 port to proxy. My web server on the same host
> >> listens only 8080, 8088 and 8888 ports. No one service except NAT
> >> is using 80 port.
> >>
> >> And finally I have no looping 4 years.
> >>
> >> Obvious, is it?
> >>
> >>
> > Not so obvious.
> >
> > I have a several servers with Apache listening on 80,443 which
> > don't have this problem! I can give you access to one of them to
> > see for yourself if you need to believe.
> >
> > Anyway, this still doesn't help me. After changing my apache to
> > port 8080 and firing up squid-3.5.1, I get access denied for all
> > requests: http://pastebin.com/1fMSE1U9
> >
>
>
> Aha, here is the heart of problem:
>
> 2015/01/23 15:59:34.455| client_side.cc(2320) parseHttpRequest: HTTP
> Client local=127.0.0.1:13128 remote=192.168.2.165:54234 FD 14 flags=33
>
>
> The local= value shows what the machine NAT system told Squid the
> original destination IP of the client connection was.
>
> Resulting in the to_localhost ACL denying the client access through
> the proxy.
>
>
So the simple solution would be to change what in my squid.conf -
http://pastebin.com/L16cDmRp



-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254733744121/+254722743223
"I can't hear you -- I'm using the scrambler."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150123/727746de/attachment.htm>

From odhiambo at gmail.com  Fri Jan 23 13:47:07 2015
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Fri, 23 Jan 2015 16:47:07 +0300
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <54C24F4E.50600@treenet.co.nz>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
 <54C23744.9000800@gmail.com>
 <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>
 <54C23B07.20405@gmail.com>
 <CAAdA2WPp9C-c9ZvW=v6_+Fm34NxZcVB2tmLpYqcHUdaUsx+cGg@mail.gmail.com>
 <54C23BF1.1030608@gmail.com>
 <CAAdA2WP2S_TpgK-q+vAwE5ejVxn7F2ipAoKoM1WF0C9rnV=Aaw@mail.gmail.com>
 <54C242C6.3030804@gmail.com> <54C24796.5010601@treenet.co.nz>
 <CAAdA2WO9EHWOmtpztKii3VOu_soyZjwSBcjE-xqifLR3aWnRtw@mail.gmail.com>
 <54C24F4E.50600@treenet.co.nz>
Message-ID: <CAAdA2WNoZDEL8SjwoAuBYP7kW+BM5mWehU_aSm6XWz7JQDwmYA@mail.gmail.com>

On 23 January 2015 at 16:40, Amos Jeffries <squid3 at treenet.co.nz> wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 24/01/2015 2:20 a.m., Odhiambo Washington wrote:
> > On 23 January 2015 at 16:07, Amos Jeffries <squid3 at treenet.co.nz>
> > wrote:
> >
> >> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
> >>
> >> On 24/01/2015 1:47 a.m., Yuri Voinov wrote:
> >>>
> >>> Once more. You CANNOT have neither web-server nor other
> >>> service with listening port 80 on the same host as transparent
> >>> Squid proxy. This is one and only reason you have looping.
> >>>
> >>
> >> That is not correct. It can be done, but depends on how the
> >> firewall operates and what ruleset is used.
> >>
> >> One has to intercept traffic transiting the machine, but ignore
> >> traffic destined *to* or *from* the local machines running
> >> processes.
> >>
> >>> Look. On my transparent 3.4.11 (which was early 2.7) IPFilter
> >>> redirects 80 port to proxy. My web server on the same host
> >>> listens only 8080, 8088 and 8888 ports. No one service except
> >>> NAT is using 80 port.
> >>>
> >>> And finally I have no looping 4 years.
> >>>
> >>> Obvious, is it?
> >>>
> >>
> >> Maybe there was, maybe there wasn't.
> >>
> >> Squid-2.7 ignored a lot of NAT related errors and even silently
> >> did some Very Bad Things(tm) - none of which Squid-3.2+ will
> >> allow to happen anymore.
> >>
> >>
> >> Odhiambo: I suspect it might be related to your use of "rdr"
> >> firewall rules. In OpenBSD PF at least rdr rules do not work
> >> properly and divert-to rules needs to be used instead (divert-to
> >> can be used for either TPROXY or NAT Squid listening ports on
> >> BSD).
> >>
> >
> >
> > I am thinking Squid-3.2+ is evil :-)
> >
> > Anyway, my PF rules are here : http://pastebin.com/pKv1jN2v And my
> > IPFilter rules are here: http://pastebin.com/JQ77X01H
> >
> > I need to figure out why squid is DENYing all access ..
> >
>
> Can you update me on what the squid -v output is from the Squid build
> you are having issues with pleae?
>
> Amos
>

root at mail:/usr/src # /opt/squid35/sbin/squid -v
Squid Cache: Version 3.5.1-20150120-r13736
Service Name: squid
configure options:  '--prefix=/opt/squid35' '--enable-removal-policies=lru
heap' '--disable-epoll' '--enable-auth' '--enable-auth-basic=DB NCSA PAM
PAM POP3 SSPI' '--enable-external-acl-helpers=session unix_group
file_userip' '--enable-auth-negotiate=kerberos' '--with-pthreads'
'--enable-storeio=ufs diskd rock aufs' '--enable-delay-pools'
'--enable-snmp' '--with-openssl=/usr' '--enable-forw-via-db'
'--enable-cache-digests' '--enable-wccpv2'
'--enable-follow-x-forwarded-for' '--with-large-files'
'--enable-large-cache-files' '--enable-esi' '--enable-kqueue'
'--enable-icap-client' '--enable-kill-parent-hack' '--enable-ssl'
'--enable-leakfinder' '--enable-ssl-crtd' '--enable-url-rewrite-helpers'
'--enable-xmalloc-statistics' '--enable-stacktraces' '--enable-zph-qos'
'--enable-eui' '--enable-pf-transparent' 'CC=clang' 'CXX=clang++'
--enable-ltdl-convenience


-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254733744121/+254722743223
"I can't hear you -- I'm using the scrambler."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150123/2623cb85/attachment.htm>

From hack.back at hotmail.com  Fri Jan 23 13:49:18 2015
From: hack.back at hotmail.com (HackXBack)
Date: Fri, 23 Jan 2015 05:49:18 -0800 (PST)
Subject: [squid-users] FATAL: The ssl_crtd helpers are crashing too
 rapidly, need help!
In-Reply-To: <1421929053162-4669257.post@n4.nabble.com>
References: <1421929053162-4669257.post@n4.nabble.com>
Message-ID: <1422020958267-4669280.post@n4.nabble.com>

Dear Yuri ,
i didnt understand what you said.
but i put cronjob to that every 6 hours to remove ssl_crtd database then
create it.
because i cant know till now what is the problem and why every 10-20 hours
the ssl_crtd helpers are crashing too rapidly ...
Still need help to find the issue
by the way i linked to this server more than 1500 customer that have
certificates installed on there laptops and mobiles.
maybe ssl_crtd database cant handle this huge number ?



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/FATAL-The-ssl-crtd-helpers-are-crashing-too-rapidly-need-help-tp4669257p4669280.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From squid3 at treenet.co.nz  Fri Jan 23 13:53:13 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 24 Jan 2015 02:53:13 +1300
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <CAAdA2WNoZDEL8SjwoAuBYP7kW+BM5mWehU_aSm6XWz7JQDwmYA@mail.gmail.com>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
 <54C23744.9000800@gmail.com>
 <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>
 <54C23B07.20405@gmail.com>
 <CAAdA2WPp9C-c9ZvW=v6_+Fm34NxZcVB2tmLpYqcHUdaUsx+cGg@mail.gmail.com>
 <54C23BF1.1030608@gmail.com>
 <CAAdA2WP2S_TpgK-q+vAwE5ejVxn7F2ipAoKoM1WF0C9rnV=Aaw@mail.gmail.com>
 <54C242C6.3030804@gmail.com> <54C24796.5010601@treenet.co.nz>
 <CAAdA2WO9EHWOmtpztKii3VOu_soyZjwSBcjE-xqifLR3aWnRtw@mail.gmail.com>
 <54C24F4E.50600@treenet.co.nz>
 <CAAdA2WNoZDEL8SjwoAuBYP7kW+BM5mWehU_aSm6XWz7JQDwmYA@mail.gmail.com>
Message-ID: <54C25249.5060704@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 24/01/2015 2:47 a.m., Odhiambo Washington wrote:
> On 23 January 2015 at 16:40, Amos Jeffries <squid3 at treenet.co.nz>
> wrote:
> 
>> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
>> 
>> On 24/01/2015 2:20 a.m., Odhiambo Washington wrote:
>>> On 23 January 2015 at 16:07, Amos Jeffries
>>> <squid3 at treenet.co.nz> wrote:
>>> 
>>>> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
>>>> 
>>>> On 24/01/2015 1:47 a.m., Yuri Voinov wrote:
>>>>> 
>>>>> Once more. You CANNOT have neither web-server nor other 
>>>>> service with listening port 80 on the same host as
>>>>> transparent Squid proxy. This is one and only reason you
>>>>> have looping.
>>>>> 
>>>> 
>>>> That is not correct. It can be done, but depends on how the 
>>>> firewall operates and what ruleset is used.
>>>> 
>>>> One has to intercept traffic transiting the machine, but
>>>> ignore traffic destined *to* or *from* the local machines
>>>> running processes.
>>>> 
>>>>> Look. On my transparent 3.4.11 (which was early 2.7)
>>>>> IPFilter redirects 80 port to proxy. My web server on the
>>>>> same host listens only 8080, 8088 and 8888 ports. No one
>>>>> service except NAT is using 80 port.
>>>>> 
>>>>> And finally I have no looping 4 years.
>>>>> 
>>>>> Obvious, is it?
>>>>> 
>>>> 
>>>> Maybe there was, maybe there wasn't.
>>>> 
>>>> Squid-2.7 ignored a lot of NAT related errors and even
>>>> silently did some Very Bad Things(tm) - none of which
>>>> Squid-3.2+ will allow to happen anymore.
>>>> 
>>>> 
>>>> Odhiambo: I suspect it might be related to your use of "rdr" 
>>>> firewall rules. In OpenBSD PF at least rdr rules do not work 
>>>> properly and divert-to rules needs to be used instead
>>>> (divert-to can be used for either TPROXY or NAT Squid
>>>> listening ports on BSD).
>>>> 
>>> 
>>> 
>>> I am thinking Squid-3.2+ is evil :-)
>>> 
>>> Anyway, my PF rules are here : http://pastebin.com/pKv1jN2v And
>>> my IPFilter rules are here: http://pastebin.com/JQ77X01H
>>> 
>>> I need to figure out why squid is DENYing all access ..
>>> 
>> 
>> Can you update me on what the squid -v output is from the Squid
>> build you are having issues with pleae?
>> 
>> Amos
>> 
> 
> root at mail:/usr/src # /opt/squid35/sbin/squid -v Squid Cache:
> Version 3.5.1-20150120-r13736 Service Name: squid configure
> options:  '--prefix=/opt/squid35' '--enable-removal-policies=lru 
> heap' '--disable-epoll' '--enable-auth' '--enable-auth-basic=DB
> NCSA PAM PAM POP3 SSPI' '--enable-external-acl-helpers=session
> unix_group file_userip' '--enable-auth-negotiate=kerberos'
> '--with-pthreads' '--enable-storeio=ufs diskd rock aufs'
> '--enable-delay-pools' '--enable-snmp' '--with-openssl=/usr'
> '--enable-forw-via-db' '--enable-cache-digests' '--enable-wccpv2' 
> '--enable-follow-x-forwarded-for' '--with-large-files' 
> '--enable-large-cache-files' '--enable-esi' '--enable-kqueue' 
> '--enable-icap-client' '--enable-kill-parent-hack' '--enable-ssl' 
> '--enable-leakfinder' '--enable-ssl-crtd'
> '--enable-url-rewrite-helpers' '--enable-xmalloc-statistics'
> '--enable-stacktraces' '--enable-zph-qos' '--enable-eui'
> '--enable-pf-transparent' 'CC=clang' 'CXX=clang++' 
> --enable-ltdl-convenience
> 

Okay. Can you explicitly add --disable-ipf-transparent
- --disable-ipfw-transparent and see if that helps.

Also in squid.conf adding debugs_options ALL,1 89,9  will show just
the NAT lookup results where things are going wrong.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUwlJHAAoJELJo5wb/XPRjpDYIAN2BdWscIrwu+eq0I/JuQP1k
XkXWeKm+yDMIbEZCxf6KALBUiVKsvzEyvDJGoKYR7gPDIoYUD1vvviwYWoL5qo5V
yTP/Te8QyXiwgOzR4+ol9aisS4RvxgALvX75UlVV521qUl97fMcD/VUNqvRYSbaN
6p/RA3GEcTwxeP8HeXNz5mvai9Ja2Pr6cJzUJa2fkEQkIptfYW7GNoMPBNuQDbGl
4cJe8GkqNdyb782BByp/k8AOBKHHZPIJm7PV8VN2PJfMXTgwkmrtKouenWetkh1+
BUlqr8IgZF6kYDk23/T9C6vWE68qO0nJvf0rrnADx4Fw28nDEXbu/oQK2qx/cdY=
=o2Sg
-----END PGP SIGNATURE-----


From yvoinov at gmail.com  Fri Jan 23 14:05:30 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Fri, 23 Jan 2015 20:05:30 +0600
Subject: [squid-users] FATAL: The ssl_crtd helpers are crashing too
 rapidly, need help!
In-Reply-To: <1422020958267-4669280.post@n4.nabble.com>
References: <1421929053162-4669257.post@n4.nabble.com>
 <1422020958267-4669280.post@n4.nabble.com>
Message-ID: <54C2552A.40709@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Now understand.

I.e. you have issue after time, yes? Squid starts nornally and after
hours or days you have problems with ssl_crtd, yes?

23.01.2015 19:49, HackXBack ?????:
> Dear Yuri ,
> i didnt understand what you said.
> but i put cronjob to that every 6 hours to remove ssl_crtd database then
> create it.
> because i cant know till now what is the problem and why every 10-20 hours
> the ssl_crtd helpers are crashing too rapidly ...
> Still need help to find the issue
> by the way i linked to this server more than 1500 customer that have
> certificates installed on there laptops and mobiles.
> maybe ssl_crtd database cant handle this huge number ?
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/FATAL-The-ssl-crtd-helpers-are-crashing-too-rapidly-need-help-tp4669257p4669280.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUwlUqAAoJENNXIZxhPexGzwEH/3v+dtnchW3w6BxeDAMi89FH
C5toZcH6DaBfpYe4ELbnCvmnS5NIwwFtHDZqrprOgy6st2pOccC7cMUwS3qnqkw+
tXLjJkzM7zlMxqBwNuH0VxoADujNSdaT/MQUnr0gKwyLMP/6aIh3MrE9q0lVgjJb
SR37AH2WlAfpbCdFubzEB96KiVOf+KGvGx47gyyMr9u7Fd/G1nPfnr10FQTmCodF
HLS2ZWJgKxoOlnn13qzpujMuKh3rpcrd8wYmrjCcDnAw2sEezNHyZ3242w14YDgL
3Fwv9ZN8SfzjMl3uY2WYm96EaCwbza1sncu6ZtZ11P0tFAuF7JvN7ZM9RTgSjDQ=
=lAs1
-----END PGP SIGNATURE-----



From odhiambo at gmail.com  Fri Jan 23 14:11:48 2015
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Fri, 23 Jan 2015 17:11:48 +0300
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <54C25249.5060704@treenet.co.nz>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
 <54C23744.9000800@gmail.com>
 <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>
 <54C23B07.20405@gmail.com>
 <CAAdA2WPp9C-c9ZvW=v6_+Fm34NxZcVB2tmLpYqcHUdaUsx+cGg@mail.gmail.com>
 <54C23BF1.1030608@gmail.com>
 <CAAdA2WP2S_TpgK-q+vAwE5ejVxn7F2ipAoKoM1WF0C9rnV=Aaw@mail.gmail.com>
 <54C242C6.3030804@gmail.com> <54C24796.5010601@treenet.co.nz>
 <CAAdA2WO9EHWOmtpztKii3VOu_soyZjwSBcjE-xqifLR3aWnRtw@mail.gmail.com>
 <54C24F4E.50600@treenet.co.nz>
 <CAAdA2WNoZDEL8SjwoAuBYP7kW+BM5mWehU_aSm6XWz7JQDwmYA@mail.gmail.com>
 <54C25249.5060704@treenet.co.nz>
Message-ID: <CAAdA2WMJ1mAOTeSU+0GdxKjRtiojUOEOBTLsqpU-KgYckGxaPw@mail.gmail.com>

On 23 January 2015 at 16:53, Amos Jeffries <squid3 at treenet.co.nz> wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 24/01/2015 2:47 a.m., Odhiambo Washington wrote:
> > On 23 January 2015 at 16:40, Amos Jeffries <squid3 at treenet.co.nz>
> > wrote:
> >
> >> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
> >>
> >> On 24/01/2015 2:20 a.m., Odhiambo Washington wrote:
> >>> On 23 January 2015 at 16:07, Amos Jeffries
> >>> <squid3 at treenet.co.nz> wrote:
> >>>
> >>>> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
> >>>>
> >>>> On 24/01/2015 1:47 a.m., Yuri Voinov wrote:
> >>>>>
> >>>>> Once more. You CANNOT have neither web-server nor other
> >>>>> service with listening port 80 on the same host as
> >>>>> transparent Squid proxy. This is one and only reason you
> >>>>> have looping.
> >>>>>
> >>>>
> >>>> That is not correct. It can be done, but depends on how the
> >>>> firewall operates and what ruleset is used.
> >>>>
> >>>> One has to intercept traffic transiting the machine, but
> >>>> ignore traffic destined *to* or *from* the local machines
> >>>> running processes.
> >>>>
> >>>>> Look. On my transparent 3.4.11 (which was early 2.7)
> >>>>> IPFilter redirects 80 port to proxy. My web server on the
> >>>>> same host listens only 8080, 8088 and 8888 ports. No one
> >>>>> service except NAT is using 80 port.
> >>>>>
> >>>>> And finally I have no looping 4 years.
> >>>>>
> >>>>> Obvious, is it?
> >>>>>
> >>>>
> >>>> Maybe there was, maybe there wasn't.
> >>>>
> >>>> Squid-2.7 ignored a lot of NAT related errors and even
> >>>> silently did some Very Bad Things(tm) - none of which
> >>>> Squid-3.2+ will allow to happen anymore.
> >>>>
> >>>>
> >>>> Odhiambo: I suspect it might be related to your use of "rdr"
> >>>> firewall rules. In OpenBSD PF at least rdr rules do not work
> >>>> properly and divert-to rules needs to be used instead
> >>>> (divert-to can be used for either TPROXY or NAT Squid
> >>>> listening ports on BSD).
> >>>>
> >>>
> >>>
> >>> I am thinking Squid-3.2+ is evil :-)
> >>>
> >>> Anyway, my PF rules are here : http://pastebin.com/pKv1jN2v And
> >>> my IPFilter rules are here: http://pastebin.com/JQ77X01H
> >>>
> >>> I need to figure out why squid is DENYing all access ..
> >>>
> >>
> >> Can you update me on what the squid -v output is from the Squid
> >> build you are having issues with pleae?
> >>
> >> Amos
> >>
> >
> > root at mail:/usr/src # /opt/squid35/sbin/squid -v Squid Cache:
> > Version 3.5.1-20150120-r13736 Service Name: squid configure
> > options:  '--prefix=/opt/squid35' '--enable-removal-policies=lru
> > heap' '--disable-epoll' '--enable-auth' '--enable-auth-basic=DB
> > NCSA PAM PAM POP3 SSPI' '--enable-external-acl-helpers=session
> > unix_group file_userip' '--enable-auth-negotiate=kerberos'
> > '--with-pthreads' '--enable-storeio=ufs diskd rock aufs'
> > '--enable-delay-pools' '--enable-snmp' '--with-openssl=/usr'
> > '--enable-forw-via-db' '--enable-cache-digests' '--enable-wccpv2'
> > '--enable-follow-x-forwarded-for' '--with-large-files'
> > '--enable-large-cache-files' '--enable-esi' '--enable-kqueue'
> > '--enable-icap-client' '--enable-kill-parent-hack' '--enable-ssl'
> > '--enable-leakfinder' '--enable-ssl-crtd'
> > '--enable-url-rewrite-helpers' '--enable-xmalloc-statistics'
> > '--enable-stacktraces' '--enable-zph-qos' '--enable-eui'
> > '--enable-pf-transparent' 'CC=clang' 'CXX=clang++'
> > --enable-ltdl-convenience
> >
>
> Okay. Can you explicitly add --disable-ipf-transparent
> - --disable-ipfw-transparent and see if that helps.
>
> Also in squid.conf adding debugs_options ALL,1 89,9  will show just
> the NAT lookup results where things are going wrong.
>

So, before I recompile, we can look at the debug output:

2015/01/23 17:07:45| storeLateRelease: released 0 objects
2015/01/23 17:07:46.959| Intercept.cc(362) Lookup: address BEGIN:
me/client= 192.168.2.254:13128, destination/me= 192.168.2.115:58632
2015/01/23 17:07:46.959| Intercept.cc(293) PfInterception: address NAT
divert-to: local=192.168.2.254:13128 remote=192.168.2.115:58632 FD 14 flag
s=33
2015/01/23 17:07:49.179| Intercept.cc(362) Lookup: address BEGIN:
me/client= 192.168.2.254:13128, destination/me= 192.168.2.254:39850
2015/01/23 17:07:49.179| Intercept.cc(293) PfInterception: address NAT
divert-to: local=192.168.2.254:13128 remote=192.168.2.254:39850 FD 18 flag
s=33
2015/01/23 17:07:49.179| WARNING: Forwarding loop detected for:
GET
/crx/blobs/QwAAAHF3InbmK-wFIemaY3I3BCPg-PjQGwE5gQ9QUn12pYvFn6PDmZgXxNF7VvigznwvJ8WaXIAcdCCqy0GvWdiTCOtn1gMu-J79t3vAXEydkC0WAMZSmuVMGd3ZQxF_Ho
se6F8g4c8bJYmPZA/extension_1_4_6_758.crx HTTP/1.1
Accept: */*
Accept-Encoding: identity
If-Unmodified-Since: Sun, 01 Apr 2007 07:00:00 GMT
Range: bytes=3436183-3841157
User-Agent: Microsoft BITS/7.5
Host: cache.pack.google.com
Via: 1.1 aardvark (squid)
X-Forwarded-For: 192.168.2.115
Cache-Control: max-age=259200
Connection: keep-alive


2015/01/23 17:07:49.260| Intercept.cc(362) Lookup: address BEGIN:
me/client= 192.168.2.254:13128, destination/me= 192.168.2.115:58634
2015/01/23 17:07:49.260| Intercept.cc(293) PfInterception: address NAT
divert-to: local=192.168.2.254:13128 remote=192.168.2.115:58634 FD 14 flag
s=33
2015/01/23 17:07:49.260| WARNING: Forwarding loop detected for:
GET
/crx/blobs/QwAAAHF3InbmK-wFIemaY3I3BCPg-PjQGwE5gQ9QUn12pYvFn6PDmZgXxNF7VvigznwvJ8WaXIAcdCCqy0GvWdiTCOtn1gMu-J79t3vAXEydkC0WAMZSmuVMGd3ZQxF_Ho
se6F8g4c8bJYmPZA/extension_1_4_6_758.crx HTTP/1.1
Accept: */*
Accept-Encoding: identity
If-Unmodified-Since: Sun, 01 Apr 2007 07:00:00 GMT
Range: bytes=3436183-3841157
User-Agent: Microsoft BITS/7.5
Host: cache.pack.google.com
Via: 1.1 aardvark (squid)
X-Forwarded-For: 192.168.2.115
Cache-Control: max-age=259200
Connection: keep-alive


2015/01/23 17:07:49.350| Intercept.cc(362) Lookup: address BEGIN:
me/client= 192.168.2.254:13128, destination/me= 192.168.2.115:58636
2015/


So there must be a way to deal with this loop in PF




-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254733744121/+254722743223
"I can't hear you -- I'm using the scrambler."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150123/acbb717d/attachment.htm>

From squid3 at treenet.co.nz  Fri Jan 23 14:33:24 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 24 Jan 2015 03:33:24 +1300
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <CAAdA2WMJ1mAOTeSU+0GdxKjRtiojUOEOBTLsqpU-KgYckGxaPw@mail.gmail.com>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
 <54C23744.9000800@gmail.com>
 <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>
 <54C23B07.20405@gmail.com>
 <CAAdA2WPp9C-c9ZvW=v6_+Fm34NxZcVB2tmLpYqcHUdaUsx+cGg@mail.gmail.com>
 <54C23BF1.1030608@gmail.com>
 <CAAdA2WP2S_TpgK-q+vAwE5ejVxn7F2ipAoKoM1WF0C9rnV=Aaw@mail.gmail.com>
 <54C242C6.3030804@gmail.com> <54C24796.5010601@treenet.co.nz>
 <CAAdA2WO9EHWOmtpztKii3VOu_soyZjwSBcjE-xqifLR3aWnRtw@mail.gmail.com>
 <54C24F4E.50600@treenet.co.nz>
 <CAAdA2WNoZDEL8SjwoAuBYP7kW+BM5mWehU_aSm6XWz7JQDwmYA@mail.gmail.com>
 <54C25249.5060704@treenet.co.nz>
 <CAAdA2WMJ1mAOTeSU+0GdxKjRtiojUOEOBTLsqpU-KgYckGxaPw@mail.gmail.com>
Message-ID: <54C25BB4.6020906@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 24/01/2015 3:11 a.m., Odhiambo Washington wrote:
> On 23 January 2015 at 16:53, Amos Jeffries <squid3 at treenet.co.nz>
> wrote:
> 
>> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
>> 
>> On 24/01/2015 2:47 a.m., Odhiambo Washington wrote:
>>> On 23 January 2015 at 16:40, Amos Jeffries
>>> <squid3 at treenet.co.nz> wrote:
>>> 
>>>> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
>>>> 
>>>> On 24/01/2015 2:20 a.m., Odhiambo Washington wrote:
>>>>> On 23 January 2015 at 16:07, Amos Jeffries 
>>>>> <squid3 at treenet.co.nz> wrote:
>>>>> 
>>>>>> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
>>>>>> 
>>>>>> On 24/01/2015 1:47 a.m., Yuri Voinov wrote:
>>>>>>> 
>>>>>>> Once more. You CANNOT have neither web-server nor
>>>>>>> other service with listening port 80 on the same host
>>>>>>> as transparent Squid proxy. This is one and only reason
>>>>>>> you have looping.
>>>>>>> 
>>>>>> 
>>>>>> That is not correct. It can be done, but depends on how
>>>>>> the firewall operates and what ruleset is used.
>>>>>> 
>>>>>> One has to intercept traffic transiting the machine, but 
>>>>>> ignore traffic destined *to* or *from* the local
>>>>>> machines running processes.
>>>>>> 
>>>>>>> Look. On my transparent 3.4.11 (which was early 2.7) 
>>>>>>> IPFilter redirects 80 port to proxy. My web server on
>>>>>>> the same host listens only 8080, 8088 and 8888 ports.
>>>>>>> No one service except NAT is using 80 port.
>>>>>>> 
>>>>>>> And finally I have no looping 4 years.
>>>>>>> 
>>>>>>> Obvious, is it?
>>>>>>> 
>>>>>> 
>>>>>> Maybe there was, maybe there wasn't.
>>>>>> 
>>>>>> Squid-2.7 ignored a lot of NAT related errors and even 
>>>>>> silently did some Very Bad Things(tm) - none of which 
>>>>>> Squid-3.2+ will allow to happen anymore.
>>>>>> 
>>>>>> 
>>>>>> Odhiambo: I suspect it might be related to your use of
>>>>>> "rdr" firewall rules. In OpenBSD PF at least rdr rules do
>>>>>> not work properly and divert-to rules needs to be used
>>>>>> instead (divert-to can be used for either TPROXY or NAT
>>>>>> Squid listening ports on BSD).
>>>>>> 
>>>>> 
>>>>> 
>>>>> I am thinking Squid-3.2+ is evil :-)
>>>>> 
>>>>> Anyway, my PF rules are here : http://pastebin.com/pKv1jN2v
>>>>> And my IPFilter rules are here:
>>>>> http://pastebin.com/JQ77X01H
>>>>> 
>>>>> I need to figure out why squid is DENYing all access ..
>>>>> 
>>>> 
>>>> Can you update me on what the squid -v output is from the
>>>> Squid build you are having issues with pleae?
>>>> 
>>>> Amos
>>>> 
>>> 
>>> root at mail:/usr/src # /opt/squid35/sbin/squid -v Squid Cache: 
>>> Version 3.5.1-20150120-r13736 Service Name: squid configure 
>>> options:  '--prefix=/opt/squid35'
>>> '--enable-removal-policies=lru heap' '--disable-epoll'
>>> '--enable-auth' '--enable-auth-basic=DB NCSA PAM PAM POP3 SSPI'
>>> '--enable-external-acl-helpers=session unix_group file_userip'
>>> '--enable-auth-negotiate=kerberos' '--with-pthreads'
>>> '--enable-storeio=ufs diskd rock aufs' '--enable-delay-pools'
>>> '--enable-snmp' '--with-openssl=/usr' '--enable-forw-via-db'
>>> '--enable-cache-digests' '--enable-wccpv2' 
>>> '--enable-follow-x-forwarded-for' '--with-large-files' 
>>> '--enable-large-cache-files' '--enable-esi' '--enable-kqueue' 
>>> '--enable-icap-client' '--enable-kill-parent-hack'
>>> '--enable-ssl' '--enable-leakfinder' '--enable-ssl-crtd' 
>>> '--enable-url-rewrite-helpers' '--enable-xmalloc-statistics' 
>>> '--enable-stacktraces' '--enable-zph-qos' '--enable-eui' 
>>> '--enable-pf-transparent' 'CC=clang' 'CXX=clang++' 
>>> --enable-ltdl-convenience
>>> 
>> 
>> Okay. Can you explicitly add --disable-ipf-transparent -
>> --disable-ipfw-transparent and see if that helps.
>> 
>> Also in squid.conf adding debugs_options ALL,1 89,9  will show
>> just the NAT lookup results where things are going wrong.
>> 
> 
> So, before I recompile, we can look at the debug output:
> 
> 2015/01/23 17:07:45| storeLateRelease: released 0 objects 
> 2015/01/23 17:07:46.959| Intercept.cc(362) Lookup: address BEGIN: 
> me/client= 192.168.2.254:13128, destination/me=
> 192.168.2.115:58632 2015/01/23 17:07:46.959| Intercept.cc(293)
> PfInterception: address NAT divert-to: local=192.168.2.254:13128
> remote=192.168.2.115:58632 FD 14 flag s=33


Arggg..   Add --with-nat-devpf to your build options in FreeBSD.

http://www.squid-cache.org/Versions/v3/3.4/RELEASENOTES.html#ss2.4

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUwlu0AAoJELJo5wb/XPRjUnIH/3Y60zIs+2VCRy5SBONGopQa
lYn+c735DrbL8bgeyNiWHzRL+Uo6djE8ou9tqBeAaoJ0mrNJ7znONPib65Y9gcSD
fv3apNi59GL+U5/lUK7dSF3zBYwx9CVVg0CFeVzb9hbrHGFPMtt8qtKK553861kL
BWTXWVt3zHJo9RIsrPdyZxvPu0QcW3l+IM5zMDpPX6jTesCZjtEfr6x30j5VPDzF
CWSj1OA1gYX2j9O+aoQwMc2X72J55XbZNtBhtRJNEFVO71NDKd2h2mGHbp0e3qaf
BI8Ki0GEEofWHizk40Bw3obCVwLwjGn6+UdoxAZqzn4AcXDTT75dzCQBfTdqFgs=
=nKS1
-----END PGP SIGNATURE-----


From yvoinov at gmail.com  Fri Jan 23 14:58:41 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Fri, 23 Jan 2015 20:58:41 +0600
Subject: [squid-users] FATAL: The ssl_crtd helpers are crashing too
 rapidly, need help!
In-Reply-To: <1422020958267-4669280.post@n4.nabble.com>
References: <1421929053162-4669257.post@n4.nabble.com>
 <1422020958267-4669280.post@n4.nabble.com>
Message-ID: <54C261A1.3020300@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
I've seen this problem on my 3.4.11 build.

With much smaller counts of certificates.

Looks like a bug.

23.01.2015 19:49, HackXBack ?????:
> Dear Yuri ,
> i didnt understand what you said.
> but i put cronjob to that every 6 hours to remove ssl_crtd database then
> create it.
> because i cant know till now what is the problem and why every 10-20 hours
> the ssl_crtd helpers are crashing too rapidly ...
> Still need help to find the issue
> by the way i linked to this server more than 1500 customer that have
> certificates installed on there laptops and mobiles.
> maybe ssl_crtd database cant handle this huge number ?
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/FATAL-The-ssl-crtd-helpers-are-crashing-too-rapidly-need-help-tp4669257p4669280.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUwmGhAAoJENNXIZxhPexGxkkIAKa0Sp+GNjvx66tp1W+s1U4N
TpmEXcYxnTBC54WPUoh8n50BVwOVGQa4W+agp13y5ecYAgT67CSlroN3qEX8b0lo
Ij3saXpOxHs+dcOvD7EE6X//KBN2UiWrbw8kH/ZuN2qW91GgfJUt2/i134e6AEXw
dMqpAkNmS42rH+JuJkBN6dg1P/+PKY/bxZ5KGD7HBk7gwbCDEil62VDab8GqFUzz
BAPAvsLkjnzuCx8BChQW/xUePaWu5lU9fXUHJT0gPdInkTRs4Hzo72ROM72FPl9q
UQCiTbMfYuzvA/ovEMD7itDLoJL9Cq5bTFnQeoDYIRcVV4m9dwhh8I25YfQZAew=
=mwAN
-----END PGP SIGNATURE-----



From odhiambo at gmail.com  Fri Jan 23 15:29:05 2015
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Fri, 23 Jan 2015 18:29:05 +0300
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <54C25BB4.6020906@treenet.co.nz>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
 <54C23744.9000800@gmail.com>
 <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>
 <54C23B07.20405@gmail.com>
 <CAAdA2WPp9C-c9ZvW=v6_+Fm34NxZcVB2tmLpYqcHUdaUsx+cGg@mail.gmail.com>
 <54C23BF1.1030608@gmail.com>
 <CAAdA2WP2S_TpgK-q+vAwE5ejVxn7F2ipAoKoM1WF0C9rnV=Aaw@mail.gmail.com>
 <54C242C6.3030804@gmail.com> <54C24796.5010601@treenet.co.nz>
 <CAAdA2WO9EHWOmtpztKii3VOu_soyZjwSBcjE-xqifLR3aWnRtw@mail.gmail.com>
 <54C24F4E.50600@treenet.co.nz>
 <CAAdA2WNoZDEL8SjwoAuBYP7kW+BM5mWehU_aSm6XWz7JQDwmYA@mail.gmail.com>
 <54C25249.5060704@treenet.co.nz>
 <CAAdA2WMJ1mAOTeSU+0GdxKjRtiojUOEOBTLsqpU-KgYckGxaPw@mail.gmail.com>
 <54C25BB4.6020906@treenet.co.nz>
Message-ID: <CAAdA2WOxz9UApjGTZVbV7KhxV+s+B1pvY0S2vpg42Kk=bN7gtg@mail.gmail.com>

On 23 January 2015 at 17:33, Amos Jeffries <squid3 at treenet.co.nz> wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 24/01/2015 3:11 a.m., Odhiambo Washington wrote:
> > On 23 January 2015 at 16:53, Amos Jeffries <squid3 at treenet.co.nz>
> > wrote:
> >
> >> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
> >>
> >> On 24/01/2015 2:47 a.m., Odhiambo Washington wrote:
> >>> On 23 January 2015 at 16:40, Amos Jeffries
> >>> <squid3 at treenet.co.nz> wrote:
> >>>
> >>>> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
> >>>>
> >>>> On 24/01/2015 2:20 a.m., Odhiambo Washington wrote:
> >>>>> On 23 January 2015 at 16:07, Amos Jeffries
> >>>>> <squid3 at treenet.co.nz> wrote:
> >>>>>
> >>>>>> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
> >>>>>>
> >>>>>> On 24/01/2015 1:47 a.m., Yuri Voinov wrote:
> >>>>>>>
> >>>>>>> Once more. You CANNOT have neither web-server nor
> >>>>>>> other service with listening port 80 on the same host
> >>>>>>> as transparent Squid proxy. This is one and only reason
> >>>>>>> you have looping.
> >>>>>>>
> >>>>>>
> >>>>>> That is not correct. It can be done, but depends on how
> >>>>>> the firewall operates and what ruleset is used.
> >>>>>>
> >>>>>> One has to intercept traffic transiting the machine, but
> >>>>>> ignore traffic destined *to* or *from* the local
> >>>>>> machines running processes.
> >>>>>>
> >>>>>>> Look. On my transparent 3.4.11 (which was early 2.7)
> >>>>>>> IPFilter redirects 80 port to proxy. My web server on
> >>>>>>> the same host listens only 8080, 8088 and 8888 ports.
> >>>>>>> No one service except NAT is using 80 port.
> >>>>>>>
> >>>>>>> And finally I have no looping 4 years.
> >>>>>>>
> >>>>>>> Obvious, is it?
> >>>>>>>
> >>>>>>
> >>>>>> Maybe there was, maybe there wasn't.
> >>>>>>
> >>>>>> Squid-2.7 ignored a lot of NAT related errors and even
> >>>>>> silently did some Very Bad Things(tm) - none of which
> >>>>>> Squid-3.2+ will allow to happen anymore.
> >>>>>>
> >>>>>>
> >>>>>> Odhiambo: I suspect it might be related to your use of
> >>>>>> "rdr" firewall rules. In OpenBSD PF at least rdr rules do
> >>>>>> not work properly and divert-to rules needs to be used
> >>>>>> instead (divert-to can be used for either TPROXY or NAT
> >>>>>> Squid listening ports on BSD).
> >>>>>>
> >>>>>
> >>>>>
> >>>>> I am thinking Squid-3.2+ is evil :-)
> >>>>>
> >>>>> Anyway, my PF rules are here : http://pastebin.com/pKv1jN2v
> >>>>> And my IPFilter rules are here:
> >>>>> http://pastebin.com/JQ77X01H
> >>>>>
> >>>>> I need to figure out why squid is DENYing all access ..
> >>>>>
> >>>>
> >>>> Can you update me on what the squid -v output is from the
> >>>> Squid build you are having issues with pleae?
> >>>>
> >>>> Amos
> >>>>
> >>>
> >>> root at mail:/usr/src # /opt/squid35/sbin/squid -v Squid Cache:
> >>> Version 3.5.1-20150120-r13736 Service Name: squid configure
> >>> options:  '--prefix=/opt/squid35'
> >>> '--enable-removal-policies=lru heap' '--disable-epoll'
> >>> '--enable-auth' '--enable-auth-basic=DB NCSA PAM PAM POP3 SSPI'
> >>> '--enable-external-acl-helpers=session unix_group file_userip'
> >>> '--enable-auth-negotiate=kerberos' '--with-pthreads'
> >>> '--enable-storeio=ufs diskd rock aufs' '--enable-delay-pools'
> >>> '--enable-snmp' '--with-openssl=/usr' '--enable-forw-via-db'
> >>> '--enable-cache-digests' '--enable-wccpv2'
> >>> '--enable-follow-x-forwarded-for' '--with-large-files'
> >>> '--enable-large-cache-files' '--enable-esi' '--enable-kqueue'
> >>> '--enable-icap-client' '--enable-kill-parent-hack'
> >>> '--enable-ssl' '--enable-leakfinder' '--enable-ssl-crtd'
> >>> '--enable-url-rewrite-helpers' '--enable-xmalloc-statistics'
> >>> '--enable-stacktraces' '--enable-zph-qos' '--enable-eui'
> >>> '--enable-pf-transparent' 'CC=clang' 'CXX=clang++'
> >>> --enable-ltdl-convenience
> >>>
> >>
> >> Okay. Can you explicitly add --disable-ipf-transparent -
> >> --disable-ipfw-transparent and see if that helps.
> >>
> >> Also in squid.conf adding debugs_options ALL,1 89,9  will show
> >> just the NAT lookup results where things are going wrong.
> >>
> >
> > So, before I recompile, we can look at the debug output:
> >
> > 2015/01/23 17:07:45| storeLateRelease: released 0 objects
> > 2015/01/23 17:07:46.959| Intercept.cc(362) Lookup: address BEGIN:
> > me/client= 192.168.2.254:13128, destination/me=
> > 192.168.2.115:58632 2015/01/23 17:07:46.959| Intercept.cc(293)
> > PfInterception: address NAT divert-to: local=192.168.2.254:13128
> > remote=192.168.2.115:58632 FD 14 flag s=33
>
>
> Arggg..   Add --with-nat-devpf to your build options in FreeBSD.
>
> http://www.squid-cache.org/Versions/v3/3.4/RELEASENOTES.html#ss2.4
>
> Amos
>
>

Done that and now, debug shows:

2015/01/23 18:15:47.498| Intercept.cc(362) Lookup: address BEGIN:
me/client= 192.168.2.254:13128, destination/me= 192.168.2.2:58541
2015/01/23 18:15:47.498| Intercept.cc(337) PfInterception: address NAT:
local=190.93.244.112:80 remote=192.168.2.2:58541 FD 35 flags=33
2015/01/23 18:15:47.500| Intercept.cc(362) Lookup: address BEGIN:
me/client= 192.168.2.254:13128, destination/me= 192.168.2.2:58542
2015/01/23 18:15:47.500| Intercept.cc(337) PfInterception: address NAT:
local=190.93.244.112:80 remote=192.168.2.2:58542 FD 37 flags=33
2015/01/23 18:15:47.501| Intercept.cc(362) Lookup: address BEGIN:
me/client= 192.168.2.254:13128, destination/me= 192.168.2.2:58543
2015/01/23 18:15:47.501| Intercept.cc(337) PfInterception: address NAT:
local=190.93.244.112:80 remote=192.168.2.2:58543 FD 39 flags=33
2015/01/23 18:15:48.033| Intercept.cc(362) Lookup: address BEGIN:
me/client= 192.168.2.254:13128, destination/me= 192.168.2.2:58544
2015/01/23 18:15:48.033| Intercept.cc(337) PfInterception: address NAT:
local=196.0.3.114:80 remote=192.168.2.2:58544 FD 51 flags=33
2015/01/23 18:15:48.033| Intercept.cc(362) Lookup: address BEGIN:
me/client= 192.168.2.254:13128, destination/me= 192.168.2.2:58545
2015/01/23 18:15:48.033| Intercept.cc(337) PfInterception: address NAT:
local=108.168.145.227:80 remote=192.168.2.2:58545 FD 52 flags=33
2015/01/23 18:15:48.034| Intercept.cc(362) Lookup: address BEGIN:
me/client= 192.168.2.254:13128, destination/me= 192.168.2.2:58546
2015/01/23 18:15:48.034| Intercept.cc(337) PfInterception: address NAT:
local=108.168.145.227:80 remote=192.168.2.2:58546 FD 53 flags=33
2015/01/23 18:15:48.034| Intercept.cc(362) Lookup: address BEGIN:
me/client= 192.168.2.254:13128, destination/me= 192.168.2.2:58547
2015/01/23 18:15:48.034| Intercept.cc(337) PfInterception: address NAT:
local=108.168.145.227:80 remote=192.168.2.2:58547 FD 54 flags=33
2015/01/23 18:15:48.035| Intercept.cc(362) Lookup: address BEGIN:
me/client= 192.168.2.254:13128, destination/me= 192.168.2.2:58548
2015/01/23 18:15:48.035| Intercept.cc(337) PfInterception: address NAT:
local=108.168.145.227:80 remote=192.168.2.2:58548 FD 55 flags=33
2015/01/23 18:15:48.035| Intercept.cc(362) Lookup: address BEGIN:
me/client= 192.168.2.254:13128, destination/me= 192.168.2.2:58549

And the good news is that squid-3.5.1 is now allowing client PCs to browse.
Thank you for that.

I still have issues to raise (though my small brain is now so saturated):


Here is what I use:

./configure --prefix=/opt/squid35 \
        --enable-removal-policies="lru heap" \
        --disable-epoll \
        --enable-auth \
        --enable-auth-basic="DB NCSA PAM PAM POP3 SSPI" \
        --enable-external-acl-helpers="session unix_group file_userip" \
        --enable-auth-negotiate="kerberos" \
        --with-pthreads \
        --enable-storeio="ufs diskd rock aufs" \
        --enable-delay-pools \
        --enable-snmp  \
        --with-openssl=/usr \
        --enable-forw-via-db \
        --enable-cache-digests \
        --enable-wccpv2 \
        --enable-follow-x-forwarded-for \
        --with-large-files \
        --enable-large-cache-files \
        --enable-esi \
        --enable-kqueue \
        --enable-icap-client \
        --enable-kill-parent-hack \
        --enable-ssl \
        --enable-leakfinder \
        --enable-ssl-crtd \
        --enable-url-rewrite-helpers \
        --enable-xmalloc-statistics \
        --enable-stacktraces \
        --enable-zph-qos \
        --enable-eui \
        --with-nat-devpf \
        --enable-pf-transparent \
        --enable-ipf-transparent


It seems I have to remove --enable-ipf-transparent otherwise the build
fails. I was thinking I could have both of --enable-ipf-transparent and
 --enable-ipf-transparent so that I can be able to use either PF or
IPFilter - whichever I want.


Are those two mutually exclusive? When I have the two, the build fails with:

root at mail:/usr/home/wash/squid-3.5.1-20150120-r13736 # gmake
Making all in compat
gmake[1]: Entering directory
'/usr/home/wash/squid-3.5.1-20150120-r13736/compat'
depbase=`echo assert.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../libtool  --tag=CXX   --mode=compile clang++ -DHAVE_CONFIG_H
-I.. -I../include -I../lib -I../src -I../include  -I/usr/include
 -I/usr/include  -I../libltdl -I/usr/include -I/usr/local/include/libxml2
 -I/usr/local/include/libxml2  -Werror -Qunused-arguments  -D_REENTRANT -g
-O2  -march=native -I/usr/local/include -MT assert.lo -MD -MP -MF
$depbase.Tpo -c -o assert.lo assert.cc &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  clang++ -DHAVE_CONFIG_H -I.. -I../include -I../lib
-I../src -I../include -I/usr/include -I/usr/include -I../libltdl
-I/usr/include -I/usr/local/include/libxml2 -I/usr/local/include/libxml2
-Werror -Qunused-arguments -D_REENTRANT -g -O2 -march=native
-I/usr/local/include -MT assert.lo -MD -MP -MF .deps/assert.Tpo -c
assert.cc  -fPIC -DPIC -o .libs/assert.o
In file included from assert.cc:9:
In file included from ../include/squid.h:43:
../compat/compat.h:49:57: error: expected value in expression
#if IPF_TRANSPARENT && USE_SOLARIS_IPFILTER_MINOR_T_HACK
                                                        ^
1 error generated.
Makefile:921: recipe for target 'assert.lo' failed
gmake[1]: *** [assert.lo] Error 1
gmake[1]: Leaving directory
'/usr/home/wash/squid-3.5.1-20150120-r13736/compat'
Makefile:567: recipe for target 'all-recursive' failed
gmake: *** [all-recursive] Error 1
root at mail:/usr/home/wash/squid-3.5.1-20150120-r13736



-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254733744121/+254722743223
"I can't hear you -- I'm using the scrambler."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150123/424986ce/attachment.htm>

From yvoinov at gmail.com  Fri Jan 23 15:42:32 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Fri, 23 Jan 2015 21:42:32 +0600
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <CAAdA2WOxz9UApjGTZVbV7KhxV+s+B1pvY0S2vpg42Kk=bN7gtg@mail.gmail.com>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
 <54C23744.9000800@gmail.com>
 <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>
 <54C23B07.20405@gmail.com>
 <CAAdA2WPp9C-c9ZvW=v6_+Fm34NxZcVB2tmLpYqcHUdaUsx+cGg@mail.gmail.com>
 <54C23BF1.1030608@gmail.com>
 <CAAdA2WP2S_TpgK-q+vAwE5ejVxn7F2ipAoKoM1WF0C9rnV=Aaw@mail.gmail.com>
 <54C242C6.3030804@gmail.com> <54C24796.5010601@treenet.co.nz>
 <CAAdA2WO9EHWOmtpztKii3VOu_soyZjwSBcjE-xqifLR3aWnRtw@mail.gmail.com>
 <54C24F4E.50600@treenet.co.nz>
 <CAAdA2WNoZDEL8SjwoAuBYP7kW+BM5mWehU_aSm6XWz7JQDwmYA@mail.gmail.com>
 <54C25249.5060704@treenet.co.nz>
 <CAAdA2WMJ1mAOTeSU+0GdxKjRtiojUOEOBTLsqpU-KgYckGxaPw@mail.gmail.com>
 <54C25BB4.6020906@treenet.co.nz>
 <CAAdA2WOxz9UApjGTZVbV7KhxV+s+B1pvY0S2vpg42Kk=bN7gtg@mail.gmail.com>
Message-ID: <54C26BE8.7060000@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Yep, they are mutually exclusive.
23.01.2015 21:29, Odhiambo Washington ?????:
>
>
> On 23 January 2015 at 17:33, Amos Jeffries <squid3 at treenet.co.nz
<mailto:squid3 at treenet.co.nz>> wrote:
>
>     -----BEGIN PGP SIGNED MESSAGE-----
>     Hash: SHA1
>
>     On 24/01/2015 3:11 a.m., Odhiambo Washington wrote:
>     > On 23 January 2015 at 16:53, Amos Jeffries <squid3 at treenet.co.nz
<mailto:squid3 at treenet.co.nz>>
>     > wrote:
>     >
>     >> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
>     >>
>     >> On 24/01/2015 2:47 a.m., Odhiambo Washington wrote:
>     >>> On 23 January 2015 at 16:40, Amos Jeffries
>     >>> <squid3 at treenet.co.nz <mailto:squid3 at treenet.co.nz>> wrote:
>     >>>
>     >>>> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
>     >>>>
>     >>>> On 24/01/2015 2:20 a.m., Odhiambo Washington wrote:
>     >>>>> On 23 January 2015 at 16:07, Amos Jeffries
>     >>>>> <squid3 at treenet.co.nz <mailto:squid3 at treenet.co.nz>> wrote:
>     >>>>>
>     >>>>>> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
>     >>>>>>
>     >>>>>> On 24/01/2015 1:47 a.m., Yuri Voinov wrote:
>     >>>>>>>
>     >>>>>>> Once more. You CANNOT have neither web-server nor
>     >>>>>>> other service with listening port 80 on the same host
>     >>>>>>> as transparent Squid proxy. This is one and only reason
>     >>>>>>> you have looping.
>     >>>>>>>
>     >>>>>>
>     >>>>>> That is not correct. It can be done, but depends on how
>     >>>>>> the firewall operates and what ruleset is used.
>     >>>>>>
>     >>>>>> One has to intercept traffic transiting the machine, but
>     >>>>>> ignore traffic destined *to* or *from* the local
>     >>>>>> machines running processes.
>     >>>>>>
>     >>>>>>> Look. On my transparent 3.4.11 (which was early 2.7)
>     >>>>>>> IPFilter redirects 80 port to proxy. My web server on
>     >>>>>>> the same host listens only 8080, 8088 and 8888 ports.
>     >>>>>>> No one service except NAT is using 80 port.
>     >>>>>>>
>     >>>>>>> And finally I have no looping 4 years.
>     >>>>>>>
>     >>>>>>> Obvious, is it?
>     >>>>>>>
>     >>>>>>
>     >>>>>> Maybe there was, maybe there wasn't.
>     >>>>>>
>     >>>>>> Squid-2.7 ignored a lot of NAT related errors and even
>     >>>>>> silently did some Very Bad Things(tm) - none of which
>     >>>>>> Squid-3.2+ will allow to happen anymore.
>     >>>>>>
>     >>>>>>
>     >>>>>> Odhiambo: I suspect it might be related to your use of
>     >>>>>> "rdr" firewall rules. In OpenBSD PF at least rdr rules do
>     >>>>>> not work properly and divert-to rules needs to be used
>     >>>>>> instead (divert-to can be used for either TPROXY or NAT
>     >>>>>> Squid listening ports on BSD).
>     >>>>>>
>     >>>>>
>     >>>>>
>     >>>>> I am thinking Squid-3.2+ is evil :-)
>     >>>>>
>     >>>>> Anyway, my PF rules are here : http://pastebin.com/pKv1jN2v
>     >>>>> And my IPFilter rules are here:
>     >>>>> http://pastebin.com/JQ77X01H
>     >>>>>
>     >>>>> I need to figure out why squid is DENYing all access ..
>     >>>>>
>     >>>>
>     >>>> Can you update me on what the squid -v output is from the
>     >>>> Squid build you are having issues with pleae?
>     >>>>
>     >>>> Amos
>     >>>>
>     >>>
>     >>> root at mail:/usr/src # /opt/squid35/sbin/squid -v Squid Cache:
>     >>> Version 3.5.1-20150120-r13736 Service Name: squid configure
>     >>> options:  '--prefix=/opt/squid35'
>     >>> '--enable-removal-policies=lru heap' '--disable-epoll'
>     >>> '--enable-auth' '--enable-auth-basic=DB NCSA PAM PAM POP3 SSPI'
>     >>> '--enable-external-acl-helpers=session unix_group file_userip'
>     >>> '--enable-auth-negotiate=kerberos' '--with-pthreads'
>     >>> '--enable-storeio=ufs diskd rock aufs' '--enable-delay-pools'
>     >>> '--enable-snmp' '--with-openssl=/usr' '--enable-forw-via-db'
>     >>> '--enable-cache-digests' '--enable-wccpv2'
>     >>> '--enable-follow-x-forwarded-for' '--with-large-files'
>     >>> '--enable-large-cache-files' '--enable-esi' '--enable-kqueue'
>     >>> '--enable-icap-client' '--enable-kill-parent-hack'
>     >>> '--enable-ssl' '--enable-leakfinder' '--enable-ssl-crtd'
>     >>> '--enable-url-rewrite-helpers' '--enable-xmalloc-statistics'
>     >>> '--enable-stacktraces' '--enable-zph-qos' '--enable-eui'
>     >>> '--enable-pf-transparent' 'CC=clang' 'CXX=clang++'
>     >>> --enable-ltdl-convenience
>     >>>
>     >>
>     >> Okay. Can you explicitly add --disable-ipf-transparent -
>     >> --disable-ipfw-transparent and see if that helps.
>     >>
>     >> Also in squid.conf adding debugs_options ALL,1 89,9  will show
>     >> just the NAT lookup results where things are going wrong.
>     >>
>     >
>     > So, before I recompile, we can look at the debug output:
>     >
>     > 2015/01/23 17:07:45| storeLateRelease: released 0 objects
>     > 2015/01/23 17:07:46.959| Intercept.cc(362) Lookup: address BEGIN:
>     > me/client= 192.168.2.254:13128 <http://192.168.2.254:13128>,
destination/me=
>     > 192.168.2.115:58632 <http://192.168.2.115:58632> 2015/01/23
17:07:46.959| Intercept.cc(293)
>     > PfInterception: address NAT divert-to: local=192.168.2.254:13128
<http://192.168.2.254:13128>
>     > remote=192.168.2.115:58632 <http://192.168.2.115:58632> FD 14
flag s=33
>
>
>     Arggg..   Add --with-nat-devpf to your build options in FreeBSD.
>
>     http://www.squid-cache.org/Versions/v3/3.4/RELEASENOTES.html#ss2.4
>
>     Amos
>
>
>
> Done that and now, debug shows:
>
> 2015/01/23 18:15:47.498| Intercept.cc(362) Lookup: address BEGIN:
me/client= 192.168.2.254:13128 <http://192.168.2.254:13128>,
destination/me= 192.168.2.2:58541 <http://192.168.2.2:58541>
> 2015/01/23 18:15:47.498| Intercept.cc(337) PfInterception: address
NAT: local=190.93.244.112:80 <http://190.93.244.112:80>
remote=192.168.2.2:58541 <http://192.168.2.2:58541> FD 35 flags=33
> 2015/01/23 18:15:47.500| Intercept.cc(362) Lookup: address BEGIN:
me/client= 192.168.2.254:13128 <http://192.168.2.254:13128>,
destination/me= 192.168.2.2:58542 <http://192.168.2.2:58542>
> 2015/01/23 18:15:47.500| Intercept.cc(337) PfInterception: address
NAT: local=190.93.244.112:80 <http://190.93.244.112:80>
remote=192.168.2.2:58542 <http://192.168.2.2:58542> FD 37 flags=33
> 2015/01/23 18:15:47.501| Intercept.cc(362) Lookup: address BEGIN:
me/client= 192.168.2.254:13128 <http://192.168.2.254:13128>,
destination/me= 192.168.2.2:58543 <http://192.168.2.2:58543>
> 2015/01/23 18:15:47.501| Intercept.cc(337) PfInterception: address
NAT: local=190.93.244.112:80 <http://190.93.244.112:80>
remote=192.168.2.2:58543 <http://192.168.2.2:58543> FD 39 flags=33
> 2015/01/23 18:15:48.033| Intercept.cc(362) Lookup: address BEGIN:
me/client= 192.168.2.254:13128 <http://192.168.2.254:13128>,
destination/me= 192.168.2.2:58544 <http://192.168.2.2:58544>
> 2015/01/23 18:15:48.033| Intercept.cc(337) PfInterception: address
NAT: local=196.0.3.114:80 <http://196.0.3.114:80>
remote=192.168.2.2:58544 <http://192.168.2.2:58544> FD 51 flags=33
> 2015/01/23 18:15:48.033| Intercept.cc(362) Lookup: address BEGIN:
me/client= 192.168.2.254:13128 <http://192.168.2.254:13128>,
destination/me= 192.168.2.2:58545 <http://192.168.2.2:58545>
> 2015/01/23 18:15:48.033| Intercept.cc(337) PfInterception: address
NAT: local=108.168.145.227:80 <http://108.168.145.227:80>
remote=192.168.2.2:58545 <http://192.168.2.2:58545> FD 52 flags=33
> 2015/01/23 18:15:48.034| Intercept.cc(362) Lookup: address BEGIN:
me/client= 192.168.2.254:13128 <http://192.168.2.254:13128>,
destination/me= 192.168.2.2:58546 <http://192.168.2.2:58546>
> 2015/01/23 18:15:48.034| Intercept.cc(337) PfInterception: address
NAT: local=108.168.145.227:80 <http://108.168.145.227:80>
remote=192.168.2.2:58546 <http://192.168.2.2:58546> FD 53 flags=33
> 2015/01/23 18:15:48.034| Intercept.cc(362) Lookup: address BEGIN:
me/client= 192.168.2.254:13128 <http://192.168.2.254:13128>,
destination/me= 192.168.2.2:58547 <http://192.168.2.2:58547>
> 2015/01/23 18:15:48.034| Intercept.cc(337) PfInterception: address
NAT: local=108.168.145.227:80 <http://108.168.145.227:80>
remote=192.168.2.2:58547 <http://192.168.2.2:58547> FD 54 flags=33
> 2015/01/23 18:15:48.035| Intercept.cc(362) Lookup: address BEGIN:
me/client= 192.168.2.254:13128 <http://192.168.2.254:13128>,
destination/me= 192.168.2.2:58548 <http://192.168.2.2:58548>
> 2015/01/23 18:15:48.035| Intercept.cc(337) PfInterception: address
NAT: local=108.168.145.227:80 <http://108.168.145.227:80>
remote=192.168.2.2:58548 <http://192.168.2.2:58548> FD 55 flags=33
> 2015/01/23 18:15:48.035| Intercept.cc(362) Lookup: address BEGIN:
me/client= 192.168.2.254:13128 <http://192.168.2.254:13128>,
destination/me= 192.168.2.2:58549 <http://192.168.2.2:58549>
>
> And the good news is that squid-3.5.1 is now allowing client PCs to
browse. Thank you for that.
>
> I still have issues to raise (though my small brain is now so saturated):
>
>
> Here is what I use:
>
> ./configure --prefix=/opt/squid35 \
>         --enable-removal-policies="lru heap" \
>         --disable-epoll \
>         --enable-auth \
>         --enable-auth-basic="DB NCSA PAM PAM POP3 SSPI" \
>         --enable-external-acl-helpers="session unix_group file_userip" \
>         --enable-auth-negotiate="kerberos" \
>         --with-pthreads \
>         --enable-storeio="ufs diskd rock aufs" \
>         --enable-delay-pools \
>         --enable-snmp  \
>         --with-openssl=/usr \
>         --enable-forw-via-db \
>         --enable-cache-digests \
>         --enable-wccpv2 \
>         --enable-follow-x-forwarded-for \
>         --with-large-files \
>         --enable-large-cache-files \
>         --enable-esi \
>         --enable-kqueue \
>         --enable-icap-client \
>         --enable-kill-parent-hack \
>         --enable-ssl \
>         --enable-leakfinder \
>         --enable-ssl-crtd \
>         --enable-url-rewrite-helpers \
>         --enable-xmalloc-statistics \
>         --enable-stacktraces \
>         --enable-zph-qos \
>         --enable-eui \
>         --with-nat-devpf \
>         --enable-pf-transparent \
>         --enable-ipf-transparent
>
>
> It seems I have to remove --enable-ipf-transparent otherwise the build
fails. I was thinking I could have both of --enable-ipf-transparent and 
--enable-ipf-transparent so that I can be able to use either PF or
IPFilter - whichever I want.
>
>
> Are those two mutually exclusive? When I have the two, the build fails
with:
>
> root at mail:/usr/home/wash/squid-3.5.1-20150120-r13736 # gmake
> Making all in compat
> gmake[1]: Entering directory
'/usr/home/wash/squid-3.5.1-20150120-r13736/compat'
> depbase=`echo assert.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
> /bin/sh ../libtool  --tag=CXX   --mode=compile clang++
-DHAVE_CONFIG_H   -I.. -I../include -I../lib -I../src -I../include 
-I/usr/include  -I/usr/include  -I../libltdl -I/usr/include
-I/usr/local/include/libxml2  -I/usr/local/include/libxml2  -Werror
-Qunused-arguments  -D_REENTRANT -g -O2  -march=native
-I/usr/local/include -MT assert.lo -MD -MP -MF $depbase.Tpo -c -o
assert.lo assert.cc &&\
> mv -f $depbase.Tpo $depbase.Plo
> libtool: compile:  clang++ -DHAVE_CONFIG_H -I.. -I../include -I../lib
-I../src -I../include -I/usr/include -I/usr/include -I../libltdl
-I/usr/include -I/usr/local/include/libxml2 -I/usr/local/include/libxml2
-Werror -Qunused-arguments -D_REENTRANT -g -O2 -march=native
-I/usr/local/include -MT assert.lo -MD -MP -MF .deps/assert.Tpo -c
assert.cc  -fPIC -DPIC -o .libs/assert.o
> In file included from assert.cc:9:
> In file included from ../include/squid.h:43:
> ../compat/compat.h:49:57: error: expected value in expression
> #if IPF_TRANSPARENT && USE_SOLARIS_IPFILTER_MINOR_T_HACK
>                                                         ^
> 1 error generated.
> Makefile:921: recipe for target 'assert.lo' failed
> gmake[1]: *** [assert.lo] Error 1
> gmake[1]: Leaving directory
'/usr/home/wash/squid-3.5.1-20150120-r13736/compat'
> Makefile:567: recipe for target 'all-recursive' failed
> gmake: *** [all-recursive] Error 1
> root at mail:/usr/home/wash/squid-3.5.1-20150120-r13736
>
>
>
> --
> Best regards,
> Odhiambo WASHINGTON,
> Nairobi,KE
> +254733744121/+254722743223
> "I can't hear you -- I'm using the scrambler."
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUwmvoAAoJENNXIZxhPexGJ60IAKh1nJoRU2Q7gHHy6lFt+j0S
kA5tlDf4elneoUYzQPvbI5Uofs89ShfSVn94sfOxg4m9w9Wcsl4BODvU2XoNZ6v/
J1rh/Lxqz0hu7f3O53GEMI136g/T1Vfff9SQr25E15kj9c47SJdYvbvnuIthECTM
orpsPTjgYikgvB6uRKqDpX5ikaTzHcTfB9xMDVf5mDonE3FVUEjcPoMkLXKJO89S
wCEsg3PlGLv64zVJVzUaFLM6BvSa+ua4lZ9n6KnCAcWKzVXClIvHUXLe7YL5nKKp
e5osUdaeoXmyOWyWkvdnsKPb3Qad6OZ6mezH+uKBVVTd66IMen39+As1oF7EfqM=
=UCjZ
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150123/4d8fc1ed/attachment.htm>

From squid3 at treenet.co.nz  Fri Jan 23 15:42:53 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 24 Jan 2015 04:42:53 +1300
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <CAAdA2WOxz9UApjGTZVbV7KhxV+s+B1pvY0S2vpg42Kk=bN7gtg@mail.gmail.com>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
 <54C23744.9000800@gmail.com>
 <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>
 <54C23B07.20405@gmail.com>
 <CAAdA2WPp9C-c9ZvW=v6_+Fm34NxZcVB2tmLpYqcHUdaUsx+cGg@mail.gmail.com>
 <54C23BF1.1030608@gmail.com>
 <CAAdA2WP2S_TpgK-q+vAwE5ejVxn7F2ipAoKoM1WF0C9rnV=Aaw@mail.gmail.com>
 <54C242C6.3030804@gmail.com> <54C24796.5010601@treenet.co.nz>
 <CAAdA2WO9EHWOmtpztKii3VOu_soyZjwSBcjE-xqifLR3aWnRtw@mail.gmail.com>
 <54C24F4E.50600@treenet.co.nz>
 <CAAdA2WNoZDEL8SjwoAuBYP7kW+BM5mWehU_aSm6XWz7JQDwmYA@mail.gmail.com>
 <54C25249.5060704@treenet.co.nz>
 <CAAdA2WMJ1mAOTeSU+0GdxKjRtiojUOEOBTLsqpU-KgYckGxaPw@mail.gmail.com>
 <54C25BB4.6020906@treenet.co.nz>
 <CAAdA2WOxz9UApjGTZVbV7KhxV+s+B1pvY0S2vpg42Kk=bN7gtg@mail.gmail.com>
Message-ID: <54C26BFD.6070004@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 24/01/2015 4:29 a.m., Odhiambo Washington wrote:
> On 23 January 2015 at 17:33, Amos Jeffries <squid3 at treenet.co.nz>
> wrote:

<snip>


> And the good news is that squid-3.5.1 is now allowing client PCs to
> browse. Thank you for that.
> 

Horray!

> I still have issues to raise (though my small brain is now so
> saturated):
> 
> 
> Here is what I use:
> 
> ./configure --prefix=/opt/squid35 \ --enable-removal-policies="lru
> heap" \ --disable-epoll \ --enable-auth \ --enable-auth-basic="DB
> NCSA PAM PAM POP3 SSPI" \ --enable-external-acl-helpers="session
> unix_group file_userip" \ --enable-auth-negotiate="kerberos" \ 
> --with-pthreads \ --enable-storeio="ufs diskd rock aufs" \ 
> --enable-delay-pools \ --enable-snmp  \ --with-openssl=/usr \ 
> --enable-forw-via-db \ --enable-cache-digests \ --enable-wccpv2 \ 
> --enable-follow-x-forwarded-for \ --with-large-files \ 
> --enable-large-cache-files \ --enable-esi \ --enable-kqueue \ 
> --enable-icap-client \ --enable-kill-parent-hack \ --enable-ssl \ 
> --enable-leakfinder \ --enable-ssl-crtd \ 
> --enable-url-rewrite-helpers \ --enable-xmalloc-statistics \ 
> --enable-stacktraces \ --enable-zph-qos \ --enable-eui \ 
> --with-nat-devpf \ --enable-pf-transparent \ 
> --enable-ipf-transparent
> 
> 
> It seems I have to remove --enable-ipf-transparent otherwise the
> build fails. I was thinking I could have both of
> --enable-ipf-transparent and --enable-ipf-transparent so that I can
> be able to use either PF or IPFilter - whichever I want.
> 
> 
> Are those two mutually exclusive?

Thats a maybe. The original design was to enable that, but doing so
may repeat the issue you just resolved. From what I can tell those two
firewalls should be okay together on FreeBSD at this point.

> When I have the two, the build fails with:
> 
> root at mail:/usr/home/wash/squid-3.5.1-20150120-r13736 # gmake Making
> all in compat gmake[1]: Entering directory 
> '/usr/home/wash/squid-3.5.1-20150120-r13736/compat' depbase=`echo
> assert.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\ /bin/sh ../libtool
> --tag=CXX   --mode=compile clang++ -DHAVE_CONFIG_H -I..
> -I../include -I../lib -I../src -I../include  -I/usr/include 
> -I/usr/include  -I../libltdl -I/usr/include
> -I/usr/local/include/libxml2 -I/usr/local/include/libxml2  -Werror
> -Qunused-arguments  -D_REENTRANT -g -O2  -march=native
> -I/usr/local/include -MT assert.lo -MD -MP -MF $depbase.Tpo -c -o
> assert.lo assert.cc &&\ mv -f $depbase.Tpo $depbase.Plo libtool:
> compile:  clang++ -DHAVE_CONFIG_H -I.. -I../include -I../lib 
> -I../src -I../include -I/usr/include -I/usr/include -I../libltdl 
> -I/usr/include -I/usr/local/include/libxml2
> -I/usr/local/include/libxml2 -Werror -Qunused-arguments
> -D_REENTRANT -g -O2 -march=native -I/usr/local/include -MT
> assert.lo -MD -MP -MF .deps/assert.Tpo -c assert.cc  -fPIC -DPIC -o
> .libs/assert.o In file included from assert.cc:9: In file included
> from ../include/squid.h:43: ../compat/compat.h:49:57: error:
> expected value in expression #if IPF_TRANSPARENT &&
> USE_SOLARIS_IPFILTER_MINOR_T_HACK ^

Seems to be a bug in the autoconf detections. You can workaround it
for now by adding this to your option list:

 CXXFLAGS="-DUSE_SOLARIS_IPFILTER_MINOR_T_HACK=0"

(or if you unluckily hit build errors mentioning minor_t re-definition
try setting it to =1).

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUwmv8AAoJELJo5wb/XPRjX3UH/1/8Mq1tFumUOpb7xXSKp6qA
LFcVZt0GX7rn2Z+fBuhVcsSkAHiqZZdn1+FRyuqYhYHeu5Y5tuc6urnLV0y9sSES
+onx2xgteNH9P/QV/JFYSIYJzp2rzAs+oPHlJJCHslNUG8nF3Dmp01Wiajc+ANOG
42PJc3FhnzJeCOQtr3wS8QPeLRjOCEXLzjd8rhl/e+MHqIi3ZrTHN8c+W0YUXMdH
bc6HtMHRsfOOj3s1Bu2v/VSCsU1TJJgLJK50GoPZFiaHQyCV8SjgF85AfjYFjnh/
4WxOYEX2R6FFONtbGHz81do4I1+JmXgHgTotIcha0fAWgpJxb506ERnUDC52iOY=
=1gna
-----END PGP SIGNATURE-----


From odhiambo at gmail.com  Fri Jan 23 15:56:46 2015
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Fri, 23 Jan 2015 18:56:46 +0300
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <54C26BFD.6070004@treenet.co.nz>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
 <54C23744.9000800@gmail.com>
 <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>
 <54C23B07.20405@gmail.com>
 <CAAdA2WPp9C-c9ZvW=v6_+Fm34NxZcVB2tmLpYqcHUdaUsx+cGg@mail.gmail.com>
 <54C23BF1.1030608@gmail.com>
 <CAAdA2WP2S_TpgK-q+vAwE5ejVxn7F2ipAoKoM1WF0C9rnV=Aaw@mail.gmail.com>
 <54C242C6.3030804@gmail.com> <54C24796.5010601@treenet.co.nz>
 <CAAdA2WO9EHWOmtpztKii3VOu_soyZjwSBcjE-xqifLR3aWnRtw@mail.gmail.com>
 <54C24F4E.50600@treenet.co.nz>
 <CAAdA2WNoZDEL8SjwoAuBYP7kW+BM5mWehU_aSm6XWz7JQDwmYA@mail.gmail.com>
 <54C25249.5060704@treenet.co.nz>
 <CAAdA2WMJ1mAOTeSU+0GdxKjRtiojUOEOBTLsqpU-KgYckGxaPw@mail.gmail.com>
 <54C25BB4.6020906@treenet.co.nz>
 <CAAdA2WOxz9UApjGTZVbV7KhxV+s+B1pvY0S2vpg42Kk=bN7gtg@mail.gmail.com>
 <54C26BFD.6070004@treenet.co.nz>
Message-ID: <CAAdA2WP0p5Se_kU3VV48KNY2DsywuX=s0ocW0Mms_ug5ot1fug@mail.gmail.com>

On 23 January 2015 at 18:42, Amos Jeffries <squid3 at treenet.co.nz> wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> On 24/01/2015 4:29 a.m., Odhiambo Washington wrote:
> > On 23 January 2015 at 17:33, Amos Jeffries <squid3 at treenet.co.nz>
> > wrote:
>
> <snip>
>
>
> > And the good news is that squid-3.5.1 is now allowing client PCs to
> > browse. Thank you for that.
> >
>
> Horray!
>

THANK YOU once again:)


>
> > I still have issues to raise (though my small brain is now so
> > saturated):
> >
> >
> > Here is what I use:
> >
> > ./configure --prefix=/opt/squid35 \ --enable-removal-policies="lru
> > heap" \ --disable-epoll \ --enable-auth \ --enable-auth-basic="DB
> > NCSA PAM PAM POP3 SSPI" \ --enable-external-acl-helpers="session
> > unix_group file_userip" \ --enable-auth-negotiate="kerberos" \
> > --with-pthreads \ --enable-storeio="ufs diskd rock aufs" \
> > --enable-delay-pools \ --enable-snmp  \ --with-openssl=/usr \
> > --enable-forw-via-db \ --enable-cache-digests \ --enable-wccpv2 \
> > --enable-follow-x-forwarded-for \ --with-large-files \
> > --enable-large-cache-files \ --enable-esi \ --enable-kqueue \
> > --enable-icap-client \ --enable-kill-parent-hack \ --enable-ssl \
> > --enable-leakfinder \ --enable-ssl-crtd \
> > --enable-url-rewrite-helpers \ --enable-xmalloc-statistics \
> > --enable-stacktraces \ --enable-zph-qos \ --enable-eui \
> > --with-nat-devpf \ --enable-pf-transparent \
> > --enable-ipf-transparent
> >
> >
> > It seems I have to remove --enable-ipf-transparent otherwise the
> > build fails. I was thinking I could have both of
> > --enable-ipf-transparent and --enable-ipf-transparent so that I can
> > be able to use either PF or IPFilter - whichever I want.
> >
> >
> > Are those two mutually exclusive?
>
> Thats a maybe. The original design was to enable that, but doing so
> may repeat the issue you just resolved. From what I can tell those two
> firewalls should be okay together on FreeBSD at this point.
>
> > When I have the two, the build fails with:
> >
> > root at mail:/usr/home/wash/squid-3.5.1-20150120-r13736 # gmake Making
> > all in compat gmake[1]: Entering directory
> > '/usr/home/wash/squid-3.5.1-20150120-r13736/compat' depbase=`echo
> > assert.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\ /bin/sh ../libtool
> > --tag=CXX   --mode=compile clang++ -DHAVE_CONFIG_H -I..
> > -I../include -I../lib -I../src -I../include  -I/usr/include
> > -I/usr/include  -I../libltdl -I/usr/include
> > -I/usr/local/include/libxml2 -I/usr/local/include/libxml2  -Werror
> > -Qunused-arguments  -D_REENTRANT -g -O2  -march=native
> > -I/usr/local/include -MT assert.lo -MD -MP -MF $depbase.Tpo -c -o
> > assert.lo assert.cc &&\ mv -f $depbase.Tpo $depbase.Plo libtool:
> > compile:  clang++ -DHAVE_CONFIG_H -I.. -I../include -I../lib
> > -I../src -I../include -I/usr/include -I/usr/include -I../libltdl
> > -I/usr/include -I/usr/local/include/libxml2
> > -I/usr/local/include/libxml2 -Werror -Qunused-arguments
> > -D_REENTRANT -g -O2 -march=native -I/usr/local/include -MT
> > assert.lo -MD -MP -MF .deps/assert.Tpo -c assert.cc  -fPIC -DPIC -o
> > .libs/assert.o In file included from assert.cc:9: In file included
> > from ../include/squid.h:43: ../compat/compat.h:49:57: error:
> > expected value in expression #if IPF_TRANSPARENT &&
> > USE_SOLARIS_IPFILTER_MINOR_T_HACK ^
>
> Seems to be a bug in the autoconf detections. You can workaround it
> for now by adding this to your option list:
>
>  CXXFLAGS="-DUSE_SOLARIS_IPFILTER_MINOR_T_HACK=0"
>
> (or if you unluckily hit build errors mentioning minor_t re-definition
> try setting it to =1).
>
>
I could be getting it all wrong, but there is where I end:



root at mail:/usr/home/wash/ILI/Squid/3.5/squid-3.5.1-20150120-r13736 # env

<cut>
CC=clang
CXX=clang++
CXXFLAGS=-DUSE_SOLARIS_IPFILTER_MINOR_T_HACK=0
</cut>

root at mail:/usr/home/wash/ILI/Squid/3.5/squid-3.5.1-20150120-r13736 # gmake
Making all in compat
gmake[1]: Entering directory
'/usr/home/wash/ILI/Squid/3.5/squid-3.5.1-20150120-r13736/compat'
depbase=`echo assert.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
/bin/sh ../libtool  --tag=CXX   --mode=compile clang++ -DHAVE_CONFIG_H
-I.. -I../include -I../lib -I../src -I../include  -I/usr/include
 -I/usr/include  -I../libltdl -I/usr/include -I/usr/local/include/libxml2
 -I/usr/local/include/libxml2  -Werror -Qunused-arguments  -D_REENTRANT
-DUSE_SOLARIS_IPFILTER_MINOR_T_HACK=0 -march=native -I/usr/local/include
-MT assert.lo -MD -MP -MF $depbase.Tpo -c -o assert.lo assert.cc &&\
mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  clang++ -DHAVE_CONFIG_H -I.. -I../include -I../lib
-I../src -I../include -I/usr/include -I/usr/include -I../libltdl
-I/usr/include -I/usr/local/include/libxml2 -I/usr/local/include/libxml2
-Werror -Qunused-arguments -D_REENTRANT
-DUSE_SOLARIS_IPFILTER_MINOR_T_HACK=0 -march=native -I/usr/local/include
-MT assert.lo -MD -MP -MF .deps/assert.Tpo -c assert.cc  -fPIC -DPIC -o
.libs/assert.o
In file included from assert.cc:9:
In file included from ../include/squid.h:12:
../include/autoconf.h:1431:9: error: 'USE_SOLARIS_IPFILTER_MINOR_T_HACK'
macro redefined [-Werror]
#define USE_SOLARIS_IPFILTER_MINOR_T_HACK
        ^
<command line>:3:9: note: previous definition is here
#define USE_SOLARIS_IPFILTER_MINOR_T_HACK 0
        ^
In file included from assert.cc:9:
In file included from ../include/squid.h:43:
../compat/compat.h:49:57: error: expected value in expression
#if IPF_TRANSPARENT && USE_SOLARIS_IPFILTER_MINOR_T_HACK
                                                        ^
2 errors generated.
Makefile:921: recipe for target 'assert.lo' failed
gmake[1]: *** [assert.lo] Error 1
gmake[1]: Leaving directory
'/usr/home/wash/ILI/Squid/3.5/squid-3.5.1-20150120-r13736/compat'
Makefile:567: recipe for target 'all-recursive' failed
gmake: *** [all-recursive] Error 1





Plus I still have to ask:

--with-pf-transoparent --with-nat-devpf works now as expected.

How about if I only had --enable-ipf-transparent ?? It means I would be
stuck still?

Is there a workaround for IPFilter on FreeBSD not to cause the loop?





-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254733744121/+254722743223
"I can't hear you -- I'm using the scrambler."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150123/944831f1/attachment.htm>

From odhiambo at gmail.com  Fri Jan 23 15:57:11 2015
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Fri, 23 Jan 2015 18:57:11 +0300
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <CAAdA2WOxz9UApjGTZVbV7KhxV+s+B1pvY0S2vpg42Kk=bN7gtg@mail.gmail.com>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
 <54C23744.9000800@gmail.com>
 <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>
 <54C23B07.20405@gmail.com>
 <CAAdA2WPp9C-c9ZvW=v6_+Fm34NxZcVB2tmLpYqcHUdaUsx+cGg@mail.gmail.com>
 <54C23BF1.1030608@gmail.com>
 <CAAdA2WP2S_TpgK-q+vAwE5ejVxn7F2ipAoKoM1WF0C9rnV=Aaw@mail.gmail.com>
 <54C242C6.3030804@gmail.com> <54C24796.5010601@treenet.co.nz>
 <CAAdA2WO9EHWOmtpztKii3VOu_soyZjwSBcjE-xqifLR3aWnRtw@mail.gmail.com>
 <54C24F4E.50600@treenet.co.nz>
 <CAAdA2WNoZDEL8SjwoAuBYP7kW+BM5mWehU_aSm6XWz7JQDwmYA@mail.gmail.com>
 <54C25249.5060704@treenet.co.nz>
 <CAAdA2WMJ1mAOTeSU+0GdxKjRtiojUOEOBTLsqpU-KgYckGxaPw@mail.gmail.com>
 <54C25BB4.6020906@treenet.co.nz>
 <CAAdA2WOxz9UApjGTZVbV7KhxV+s+B1pvY0S2vpg42Kk=bN7gtg@mail.gmail.com>
Message-ID: <CAAdA2WN=H0CyyYqX0CBv=MftMxNsKYmKH8P6zFzb4uunvXwoLw@mail.gmail.com>

On 23 January 2015 at 18:29, Odhiambo Washington <odhiambo at gmail.com> wrote:

>
>
> On 23 January 2015 at 17:33, Amos Jeffries <squid3 at treenet.co.nz> wrote:
>
>> -----BEGIN PGP SIGNED MESSAGE-----
>> Hash: SHA1
>>
>> On 24/01/2015 3:11 a.m., Odhiambo Washington wrote:
>> > On 23 January 2015 at 16:53, Amos Jeffries <squid3 at treenet.co.nz>
>> > wrote:
>> >
>> >> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
>> >>
>> >> On 24/01/2015 2:47 a.m., Odhiambo Washington wrote:
>> >>> On 23 January 2015 at 16:40, Amos Jeffries
>> >>> <squid3 at treenet.co.nz> wrote:
>> >>>
>> >>>> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
>> >>>>
>> >>>> On 24/01/2015 2:20 a.m., Odhiambo Washington wrote:
>> >>>>> On 23 January 2015 at 16:07, Amos Jeffries
>> >>>>> <squid3 at treenet.co.nz> wrote:
>> >>>>>
>> >>>>>> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
>> >>>>>>
>> >>>>>> On 24/01/2015 1:47 a.m., Yuri Voinov wrote:
>> >>>>>>>
>> >>>>>>> Once more. You CANNOT have neither web-server nor
>> >>>>>>> other service with listening port 80 on the same host
>> >>>>>>> as transparent Squid proxy. This is one and only reason
>> >>>>>>> you have looping.
>> >>>>>>>
>> >>>>>>
>> >>>>>> That is not correct. It can be done, but depends on how
>> >>>>>> the firewall operates and what ruleset is used.
>> >>>>>>
>> >>>>>> One has to intercept traffic transiting the machine, but
>> >>>>>> ignore traffic destined *to* or *from* the local
>> >>>>>> machines running processes.
>> >>>>>>
>> >>>>>>> Look. On my transparent 3.4.11 (which was early 2.7)
>> >>>>>>> IPFilter redirects 80 port to proxy. My web server on
>> >>>>>>> the same host listens only 8080, 8088 and 8888 ports.
>> >>>>>>> No one service except NAT is using 80 port.
>> >>>>>>>
>> >>>>>>> And finally I have no looping 4 years.
>> >>>>>>>
>> >>>>>>> Obvious, is it?
>> >>>>>>>
>> >>>>>>
>> >>>>>> Maybe there was, maybe there wasn't.
>> >>>>>>
>> >>>>>> Squid-2.7 ignored a lot of NAT related errors and even
>> >>>>>> silently did some Very Bad Things(tm) - none of which
>> >>>>>> Squid-3.2+ will allow to happen anymore.
>> >>>>>>
>> >>>>>>
>> >>>>>> Odhiambo: I suspect it might be related to your use of
>> >>>>>> "rdr" firewall rules. In OpenBSD PF at least rdr rules do
>> >>>>>> not work properly and divert-to rules needs to be used
>> >>>>>> instead (divert-to can be used for either TPROXY or NAT
>> >>>>>> Squid listening ports on BSD).
>> >>>>>>
>> >>>>>
>> >>>>>
>> >>>>> I am thinking Squid-3.2+ is evil :-)
>> >>>>>
>> >>>>> Anyway, my PF rules are here : http://pastebin.com/pKv1jN2v
>> >>>>> And my IPFilter rules are here:
>> >>>>> http://pastebin.com/JQ77X01H
>> >>>>>
>> >>>>> I need to figure out why squid is DENYing all access ..
>> >>>>>
>> >>>>
>> >>>> Can you update me on what the squid -v output is from the
>> >>>> Squid build you are having issues with pleae?
>> >>>>
>> >>>> Amos
>> >>>>
>> >>>
>> >>> root at mail:/usr/src # /opt/squid35/sbin/squid -v Squid Cache:
>> >>> Version 3.5.1-20150120-r13736 Service Name: squid configure
>> >>> options:  '--prefix=/opt/squid35'
>> >>> '--enable-removal-policies=lru heap' '--disable-epoll'
>> >>> '--enable-auth' '--enable-auth-basic=DB NCSA PAM PAM POP3 SSPI'
>> >>> '--enable-external-acl-helpers=session unix_group file_userip'
>> >>> '--enable-auth-negotiate=kerberos' '--with-pthreads'
>> >>> '--enable-storeio=ufs diskd rock aufs' '--enable-delay-pools'
>> >>> '--enable-snmp' '--with-openssl=/usr' '--enable-forw-via-db'
>> >>> '--enable-cache-digests' '--enable-wccpv2'
>> >>> '--enable-follow-x-forwarded-for' '--with-large-files'
>> >>> '--enable-large-cache-files' '--enable-esi' '--enable-kqueue'
>> >>> '--enable-icap-client' '--enable-kill-parent-hack'
>> >>> '--enable-ssl' '--enable-leakfinder' '--enable-ssl-crtd'
>> >>> '--enable-url-rewrite-helpers' '--enable-xmalloc-statistics'
>> >>> '--enable-stacktraces' '--enable-zph-qos' '--enable-eui'
>> >>> '--enable-pf-transparent' 'CC=clang' 'CXX=clang++'
>> >>> --enable-ltdl-convenience
>> >>>
>> >>
>> >> Okay. Can you explicitly add --disable-ipf-transparent -
>> >> --disable-ipfw-transparent and see if that helps.
>> >>
>> >> Also in squid.conf adding debugs_options ALL,1 89,9  will show
>> >> just the NAT lookup results where things are going wrong.
>> >>
>> >
>> > So, before I recompile, we can look at the debug output:
>> >
>> > 2015/01/23 17:07:45| storeLateRelease: released 0 objects
>> > 2015/01/23 17:07:46.959| Intercept.cc(362) Lookup: address BEGIN:
>> > me/client= 192.168.2.254:13128, destination/me=
>> > 192.168.2.115:58632 2015/01/23 17:07:46.959| Intercept.cc(293)
>> > PfInterception: address NAT divert-to: local=192.168.2.254:13128
>> > remote=192.168.2.115:58632 FD 14 flag s=33
>>
>>
>> Arggg..   Add --with-nat-devpf to your build options in FreeBSD.
>>
>> http://www.squid-cache.org/Versions/v3/3.4/RELEASENOTES.html#ss2.4
>>
>> Amos
>>
>>
>
> Done that and now, debug shows:
>
> 2015/01/23 18:15:47.498| Intercept.cc(362) Lookup: address BEGIN:
> me/client= 192.168.2.254:13128, destination/me= 192.168.2.2:58541
> 2015/01/23 18:15:47.498| Intercept.cc(337) PfInterception: address NAT:
> local=190.93.244.112:80 remote=192.168.2.2:58541 FD 35 flags=33
> 2015/01/23 18:15:47.500| Intercept.cc(362) Lookup: address BEGIN:
> me/client= 192.168.2.254:13128, destination/me= 192.168.2.2:58542
> 2015/01/23 18:15:47.500| Intercept.cc(337) PfInterception: address NAT:
> local=190.93.244.112:80 remote=192.168.2.2:58542 FD 37 flags=33
> 2015/01/23 18:15:47.501| Intercept.cc(362) Lookup: address BEGIN:
> me/client= 192.168.2.254:13128, destination/me= 192.168.2.2:58543
> 2015/01/23 18:15:47.501| Intercept.cc(337) PfInterception: address NAT:
> local=190.93.244.112:80 remote=192.168.2.2:58543 FD 39 flags=33
> 2015/01/23 18:15:48.033| Intercept.cc(362) Lookup: address BEGIN:
> me/client= 192.168.2.254:13128, destination/me= 192.168.2.2:58544
> 2015/01/23 18:15:48.033| Intercept.cc(337) PfInterception: address NAT:
> local=196.0.3.114:80 remote=192.168.2.2:58544 FD 51 flags=33
> 2015/01/23 18:15:48.033| Intercept.cc(362) Lookup: address BEGIN:
> me/client= 192.168.2.254:13128, destination/me= 192.168.2.2:58545
> 2015/01/23 18:15:48.033| Intercept.cc(337) PfInterception: address NAT:
> local=108.168.145.227:80 remote=192.168.2.2:58545 FD 52 flags=33
> 2015/01/23 18:15:48.034| Intercept.cc(362) Lookup: address BEGIN:
> me/client= 192.168.2.254:13128, destination/me= 192.168.2.2:58546
> 2015/01/23 18:15:48.034| Intercept.cc(337) PfInterception: address NAT:
> local=108.168.145.227:80 remote=192.168.2.2:58546 FD 53 flags=33
> 2015/01/23 18:15:48.034| Intercept.cc(362) Lookup: address BEGIN:
> me/client= 192.168.2.254:13128, destination/me= 192.168.2.2:58547
> 2015/01/23 18:15:48.034| Intercept.cc(337) PfInterception: address NAT:
> local=108.168.145.227:80 remote=192.168.2.2:58547 FD 54 flags=33
> 2015/01/23 18:15:48.035| Intercept.cc(362) Lookup: address BEGIN:
> me/client= 192.168.2.254:13128, destination/me= 192.168.2.2:58548
> 2015/01/23 18:15:48.035| Intercept.cc(337) PfInterception: address NAT:
> local=108.168.145.227:80 remote=192.168.2.2:58548 FD 55 flags=33
> 2015/01/23 18:15:48.035| Intercept.cc(362) Lookup: address BEGIN:
> me/client= 192.168.2.254:13128, destination/me= 192.168.2.2:58549
>
> And the good news is that squid-3.5.1 is now allowing client PCs to
> browse. Thank you for that.
>
> I still have issues to raise (though my small brain is now so saturated):
>
>
> Here is what I use:
>
> ./configure --prefix=/opt/squid35 \
>         --enable-removal-policies="lru heap" \
>         --disable-epoll \
>         --enable-auth \
>         --enable-auth-basic="DB NCSA PAM PAM POP3 SSPI" \
>         --enable-external-acl-helpers="session unix_group file_userip" \
>         --enable-auth-negotiate="kerberos" \
>         --with-pthreads \
>         --enable-storeio="ufs diskd rock aufs" \
>         --enable-delay-pools \
>         --enable-snmp  \
>         --with-openssl=/usr \
>         --enable-forw-via-db \
>         --enable-cache-digests \
>         --enable-wccpv2 \
>         --enable-follow-x-forwarded-for \
>         --with-large-files \
>         --enable-large-cache-files \
>         --enable-esi \
>         --enable-kqueue \
>         --enable-icap-client \
>         --enable-kill-parent-hack \
>         --enable-ssl \
>         --enable-leakfinder \
>         --enable-ssl-crtd \
>         --enable-url-rewrite-helpers \
>         --enable-xmalloc-statistics \
>         --enable-stacktraces \
>         --enable-zph-qos \
>         --enable-eui \
>         --with-nat-devpf \
>         --enable-pf-transparent \
>         --enable-ipf-transparent
>
>
> It seems I have to remove --enable-ipf-transparent otherwise the build
> fails. I was thinking I could have both of --enable-ipf-transparent and
>  --enable-ipf-transparent so that I can be able to use either PF or
> IPFilter - whichever I want.
>
>
To simplify:

Suppose  I wanted to use IPFilter as the Firewall with IPNat, what are my
options?




-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254733744121/+254722743223
"I can't hear you -- I'm using the scrambler."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150123/6f9e2fc8/attachment.htm>

From squid3 at treenet.co.nz  Fri Jan 23 16:08:52 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 24 Jan 2015 05:08:52 +1300
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <CAAdA2WP0p5Se_kU3VV48KNY2DsywuX=s0ocW0Mms_ug5ot1fug@mail.gmail.com>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
 <54C23744.9000800@gmail.com>
 <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>
 <54C23B07.20405@gmail.com>
 <CAAdA2WPp9C-c9ZvW=v6_+Fm34NxZcVB2tmLpYqcHUdaUsx+cGg@mail.gmail.com>
 <54C23BF1.1030608@gmail.com>
 <CAAdA2WP2S_TpgK-q+vAwE5ejVxn7F2ipAoKoM1WF0C9rnV=Aaw@mail.gmail.com>
 <54C242C6.3030804@gmail.com> <54C24796.5010601@treenet.co.nz>
 <CAAdA2WO9EHWOmtpztKii3VOu_soyZjwSBcjE-xqifLR3aWnRtw@mail.gmail.com>
 <54C24F4E.50600@treenet.co.nz>
 <CAAdA2WNoZDEL8SjwoAuBYP7kW+BM5mWehU_aSm6XWz7JQDwmYA@mail.gmail.com>
 <54C25249.5060704@treenet.co.nz>
 <CAAdA2WMJ1mAOTeSU+0GdxKjRtiojUOEOBTLsqpU-KgYckGxaPw@mail.gmail.com>
 <54C25BB4.6020906@treenet.co.nz>
 <CAAdA2WOxz9UApjGTZVbV7KhxV+s+B1pvY0S2vpg42Kk=bN7gtg@mail.gmail.com>
 <54C26BFD.6070004@treenet.co.nz>
 <CAAdA2WP0p5Se_kU3VV48KNY2DsywuX=s0ocW0Mms_ug5ot1fug@mail.gmail.com>
Message-ID: <54C27214.7090202@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 24/01/2015 4:56 a.m., Odhiambo Washington wrote:
> On 23 January 2015 at 18:42, Amos Jeffries <squid3 at treenet.co.nz>
> wrote:
> 
>> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
>> 
>> On 24/01/2015 4:29 a.m., Odhiambo Washington wrote:
>>> On 23 January 2015 at 17:33, Amos Jeffries
>>> <squid3 at treenet.co.nz> wrote:
>> 
>> <snip>
>> 
>> 
>>> And the good news is that squid-3.5.1 is now allowing client
>>> PCs to browse. Thank you for that.
>>> 
>> 
>> Horray!
>> 
> 
> THANK YOU once again:)
> 
> 
>> 
>>> I still have issues to raise (though my small brain is now so 
>>> saturated):
>>> 
>>> 
>>> Here is what I use:
>>> 
>>> ./configure --prefix=/opt/squid35 \
>>> --enable-removal-policies="lru heap" \ --disable-epoll \
>>> --enable-auth \ --enable-auth-basic="DB NCSA PAM PAM POP3 SSPI"
>>> \ --enable-external-acl-helpers="session unix_group
>>> file_userip" \ --enable-auth-negotiate="kerberos" \ 
>>> --with-pthreads \ --enable-storeio="ufs diskd rock aufs" \ 
>>> --enable-delay-pools \ --enable-snmp  \ --with-openssl=/usr \ 
>>> --enable-forw-via-db \ --enable-cache-digests \ --enable-wccpv2
>>> \ --enable-follow-x-forwarded-for \ --with-large-files \ 
>>> --enable-large-cache-files \ --enable-esi \ --enable-kqueue \ 
>>> --enable-icap-client \ --enable-kill-parent-hack \ --enable-ssl
>>> \ --enable-leakfinder \ --enable-ssl-crtd \ 
>>> --enable-url-rewrite-helpers \ --enable-xmalloc-statistics \ 
>>> --enable-stacktraces \ --enable-zph-qos \ --enable-eui \ 
>>> --with-nat-devpf \ --enable-pf-transparent \ 
>>> --enable-ipf-transparent
>>> 
>>> 
>>> It seems I have to remove --enable-ipf-transparent otherwise
>>> the build fails. I was thinking I could have both of 
>>> --enable-ipf-transparent and --enable-ipf-transparent so that I
>>> can be able to use either PF or IPFilter - whichever I want.
>>> 
>>> 
>>> Are those two mutually exclusive?
>> 
>> Thats a maybe. The original design was to enable that, but doing
>> so may repeat the issue you just resolved. From what I can tell
>> those two firewalls should be okay together on FreeBSD at this
>> point.
>> 
>>> When I have the two, the build fails with:
>>> 
>>> root at mail:/usr/home/wash/squid-3.5.1-20150120-r13736 # gmake
>>> Making all in compat gmake[1]: Entering directory 
>>> '/usr/home/wash/squid-3.5.1-20150120-r13736/compat'
>>> depbase=`echo assert.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
>>> /bin/sh ../libtool --tag=CXX   --mode=compile clang++
>>> -DHAVE_CONFIG_H -I.. -I../include -I../lib -I../src
>>> -I../include  -I/usr/include -I/usr/include  -I../libltdl
>>> -I/usr/include -I/usr/local/include/libxml2
>>> -I/usr/local/include/libxml2  -Werror -Qunused-arguments
>>> -D_REENTRANT -g -O2  -march=native -I/usr/local/include -MT
>>> assert.lo -MD -MP -MF $depbase.Tpo -c -o assert.lo assert.cc
>>> &&\ mv -f $depbase.Tpo $depbase.Plo libtool: compile:  clang++
>>> -DHAVE_CONFIG_H -I.. -I../include -I../lib -I../src
>>> -I../include -I/usr/include -I/usr/include -I../libltdl 
>>> -I/usr/include -I/usr/local/include/libxml2 
>>> -I/usr/local/include/libxml2 -Werror -Qunused-arguments 
>>> -D_REENTRANT -g -O2 -march=native -I/usr/local/include -MT 
>>> assert.lo -MD -MP -MF .deps/assert.Tpo -c assert.cc  -fPIC
>>> -DPIC -o .libs/assert.o In file included from assert.cc:9: In
>>> file included from ../include/squid.h:43:
>>> ../compat/compat.h:49:57: error: expected value in expression
>>> #if IPF_TRANSPARENT && USE_SOLARIS_IPFILTER_MINOR_T_HACK ^
>> 
>> Seems to be a bug in the autoconf detections. You can workaround
>> it for now by adding this to your option list:
>> 
>> CXXFLAGS="-DUSE_SOLARIS_IPFILTER_MINOR_T_HACK=0"
>> 
>> (or if you unluckily hit build errors mentioning minor_t
>> re-definition try setting it to =1).
>> 
>> 
> I could be getting it all wrong, but there is where I end:
> 
> 
> 
> root at mail:/usr/home/wash/ILI/Squid/3.5/squid-3.5.1-20150120-r13736
> # env
> 
> <cut> CC=clang CXX=clang++ 
> CXXFLAGS=-DUSE_SOLARIS_IPFILTER_MINOR_T_HACK=0 </cut>
> 
> root at mail:/usr/home/wash/ILI/Squid/3.5/squid-3.5.1-20150120-r13736
> # gmake Making all in compat gmake[1]: Entering directory 
> '/usr/home/wash/ILI/Squid/3.5/squid-3.5.1-20150120-r13736/compat' 
> depbase=`echo assert.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\ 
> /bin/sh ../libtool  --tag=CXX   --mode=compile clang++
> -DHAVE_CONFIG_H -I.. -I../include -I../lib -I../src -I../include
> -I/usr/include -I/usr/include  -I../libltdl -I/usr/include
> -I/usr/local/include/libxml2 -I/usr/local/include/libxml2  -Werror
> -Qunused-arguments  -D_REENTRANT 
> -DUSE_SOLARIS_IPFILTER_MINOR_T_HACK=0 -march=native
> -I/usr/local/include -MT assert.lo -MD -MP -MF $depbase.Tpo -c -o
> assert.lo assert.cc &&\ mv -f $depbase.Tpo $depbase.Plo libtool:
> compile:  clang++ -DHAVE_CONFIG_H -I.. -I../include -I../lib 
> -I../src -I../include -I/usr/include -I/usr/include -I../libltdl 
> -I/usr/include -I/usr/local/include/libxml2
> -I/usr/local/include/libxml2 -Werror -Qunused-arguments
> -D_REENTRANT -DUSE_SOLARIS_IPFILTER_MINOR_T_HACK=0 -march=native
> -I/usr/local/include -MT assert.lo -MD -MP -MF .deps/assert.Tpo -c
> assert.cc  -fPIC -DPIC -o .libs/assert.o In file included from
> assert.cc:9: In file included from ../include/squid.h:12: 
> ../include/autoconf.h:1431:9: error:
> 'USE_SOLARIS_IPFILTER_MINOR_T_HACK' macro redefined [-Werror] 
> #define USE_SOLARIS_IPFILTER_MINOR_T_HACK ^ <command line>:3:9:
> note: previous definition is here #define
> USE_SOLARIS_IPFILTER_MINOR_T_HACK 0 ^

(mutters)

> In file included from assert.cc:9: In file included from
> ../include/squid.h:43: ../compat/compat.h:49:57: error: expected
> value in expression #if IPF_TRANSPARENT &&
> USE_SOLARIS_IPFILTER_MINOR_T_HACK ^ 2 errors generated. 
> Makefile:921: recipe for target 'assert.lo' failed gmake[1]: ***
> [assert.lo] Error 1 gmake[1]: Leaving directory 
> '/usr/home/wash/ILI/Squid/3.5/squid-3.5.1-20150120-r13736/compat' 
> Makefile:567: recipe for target 'all-recursive' failed gmake: ***
> [all-recursive] Error 1
> 
> 
> 
> 
> 
> Plus I still have to ask:
> 
> --with-pf-transparent --with-nat-devpf works now as expected.
> 
> How about if I only had --enable-ipf-transparent ?? It means I
> would be stuck still?

Given the state of that macro definition, yes.

There are some other things on Solaris I had to fix for Yuri (who is
sponsoring those build fixes). I will put this on my list of thing to
check out and hopefully be able to point you at a new snapshot to work
with in a few days.

> 
> Is there a workaround for IPFilter on FreeBSD not to cause the
> loop?

The cause of the loop was wrong NAT lookup being done for PF. The
OpenBSD style PF which you were accidentally building used a different
system API which always returns wrong results on FreeBSD.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUwnIUAAoJELJo5wb/XPRjQ1IIANnYk+6frClJG+YG8mdGqAn9
LDzDOqJXz2JPt8IM6mi66Q6+ykv/W00aQllq3VmA6oTqGs/fH6A6r6TrLXAnkv/n
77zKMo3VDO6z7It5w+IuK9X6FWSGOCVrNKZQWnwGstEpk6jpxE/wIyYHlUEJqdJi
d9Gnnek2/aZDdDYjmgdbJOu78qyuA2eXO2dzBluNgWlnRjdBCWGwlIDUKQky5Wf6
3HH+/n9eQ86EEsHL9gsfB6bJTIPBxcge9hkQWsYIapfBXj2+ynBDrVxnmPVc4y2/
xs204HYAvTO3KuNj2cJnYBl1IiJ+QnVHg43srVyeNNjpp3XQF0R3sLyJKe2Q6oU=
=G+4T
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Fri Jan 23 16:17:18 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 24 Jan 2015 05:17:18 +1300
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <CAAdA2WN=H0CyyYqX0CBv=MftMxNsKYmKH8P6zFzb4uunvXwoLw@mail.gmail.com>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
 <54C23744.9000800@gmail.com>
 <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>
 <54C23B07.20405@gmail.com>
 <CAAdA2WPp9C-c9ZvW=v6_+Fm34NxZcVB2tmLpYqcHUdaUsx+cGg@mail.gmail.com>
 <54C23BF1.1030608@gmail.com>
 <CAAdA2WP2S_TpgK-q+vAwE5ejVxn7F2ipAoKoM1WF0C9rnV=Aaw@mail.gmail.com>
 <54C242C6.3030804@gmail.com> <54C24796.5010601@treenet.co.nz>
 <CAAdA2WO9EHWOmtpztKii3VOu_soyZjwSBcjE-xqifLR3aWnRtw@mail.gmail.com>
 <54C24F4E.50600@treenet.co.nz>
 <CAAdA2WNoZDEL8SjwoAuBYP7kW+BM5mWehU_aSm6XWz7JQDwmYA@mail.gmail.com>
 <54C25249.5060704@treenet.co.nz>
 <CAAdA2WMJ1mAOTeSU+0GdxKjRtiojUOEOBTLsqpU-KgYckGxaPw@mail.gmail.com>
 <54C25BB4.6020906@treenet.co.nz>
 <CAAdA2WOxz9UApjGTZVbV7KhxV+s+B1pvY0S2vpg42Kk=bN7gtg@mail.gmail.com>
 <CAAdA2WN=H0CyyYqX0CBv=MftMxNsKYmKH8P6zFzb4uunvXwoLw@mail.gmail.com>
Message-ID: <54C2740E.9020007@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 24/01/2015 4:57 a.m., Odhiambo Washington wrote:
> On 23 January 2015 at 18:29, Odhiambo Washington wrote:
> 
> To simplify:
> 
> Suppose  I wanted to use IPFilter as the Firewall with IPNat, what
> are my options?
> 

Option 1)
 wait for me to fix the Solaris macro definition,

 or

Option 2)
 manually patch/alter definition in the include/autoconf.h file. That
has to be done after running ./configure to generate the file contents.

 - Either way you can drop the CXXFLAGS definition I gave you, it is
definitely broken beyond that workarounds ability to help.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUwnQOAAoJELJo5wb/XPRjI1QH/A8Hqzpz+d/+GflORX8xy3Fz
3Ucp0LqWHs4akv4L9I0aiDK9BcaMXSMuTIqKQuCrQfKtimai0yzpoGnPghu6EeFQ
rLucvwY3OujVDojmSfYOqHbKbsjrkMLrL89j72rQMNGi9u/KgoxkWfu1URnpepnz
QJGXMati0oTqL1haeUVDC03Bj16tXTrcdeEfDI2T34xUfEDa9YYmpczyYIWgW11h
QQwe6m2ooyl2oEB7gcacYHV9m4WY5PizKCa6CWjxASCdWOwixvPaIOA+qb8fePDm
9QDYVRMdd3t7b5wdiYiO32J+L9G8NC4fnOl44uFBD1S3bAa4L8FE3auVdnH1haM=
=75TZ
-----END PGP SIGNATURE-----


From yvoinov at gmail.com  Fri Jan 23 16:32:49 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Fri, 23 Jan 2015 22:32:49 +0600
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <54C2740E.9020007@treenet.co.nz>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
 <54C23744.9000800@gmail.com>
 <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>
 <54C23B07.20405@gmail.com>
 <CAAdA2WPp9C-c9ZvW=v6_+Fm34NxZcVB2tmLpYqcHUdaUsx+cGg@mail.gmail.com>
 <54C23BF1.1030608@gmail.com>
 <CAAdA2WP2S_TpgK-q+vAwE5ejVxn7F2ipAoKoM1WF0C9rnV=Aaw@mail.gmail.com>
 <54C242C6.3030804@gmail.com> <54C24796.5010601@treenet.co.nz>
 <CAAdA2WO9EHWOmtpztKii3VOu_soyZjwSBcjE-xqifLR3aWnRtw@mail.gmail.com>
 <54C24F4E.50600@treenet.co.nz>
 <CAAdA2WNoZDEL8SjwoAuBYP7kW+BM5mWehU_aSm6XWz7JQDwmYA@mail.gmail.com>
 <54C25249.5060704@treenet.co.nz>
 <CAAdA2WMJ1mAOTeSU+0GdxKjRtiojUOEOBTLsqpU-KgYckGxaPw@mail.gmail.com>
 <54C25BB4.6020906@treenet.co.nz>
 <CAAdA2WOxz9UApjGTZVbV7KhxV+s+B1pvY0S2vpg42Kk=bN7gtg@mail.gmail.com>
 <CAAdA2WN=H0CyyYqX0CBv=MftMxNsKYmKH8P6zFzb4uunvXwoLw@mail.gmail.com>
 <54C2740E.9020007@treenet.co.nz>
Message-ID: <54C277B1.8070802@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Amos,

important not to break Solaris-IPFilter for me ;)

WBR, Yuri

23.01.2015 22:17, Amos Jeffries ?????:
> On 24/01/2015 4:57 a.m., Odhiambo Washington wrote:
> > On 23 January 2015 at 18:29, Odhiambo Washington wrote:
>
> > To simplify:
>
> > Suppose  I wanted to use IPFilter as the Firewall with IPNat, what
> > are my options?
>
>
> Option 1)
>  wait for me to fix the Solaris macro definition,
>
>  or
>
> Option 2)
>  manually patch/alter definition in the include/autoconf.h file. That
> has to be done after running ./configure to generate the file contents.
>
>  - Either way you can drop the CXXFLAGS definition I gave you, it is
> definitely broken beyond that workarounds ability to help.
>
> Amos
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUwnexAAoJENNXIZxhPexG7EEH/3Pe8jRN5q+pzqAswqxDEDow
sEzks5wKMKW4mnbvg+3EzqhzgyjNIBxxt/oivQPmp7kYFbGYmtSgiQemqJtkRRJF
eCRgFaaBhgpu0LHFtV7OaWq3JOcDvKyuHXvkXioGhdbgmyJ8x728xl9C4X5QBKhJ
si388E1QhDz7FQSzQnpqmcb1/Br5ubw1QVIKUstI4Mx4fK0vu359va6PfltGw6G9
EB0b7zOOQwEXruyilHf9jtv98CvwDsxnQ8yc9CNf49QWPc+ifq+VPgPe6F5khDTQ
pdxS+oItcIsfb9e7ijjB7uJ0lwVpvbz3zLFHUxCo0qmgvu0hDeTvi2YMZmJifrw=
=c6/c
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150123/41ccc50b/attachment.htm>

From squid3 at treenet.co.nz  Fri Jan 23 16:38:25 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 24 Jan 2015 05:38:25 +1300
Subject: [squid-users] Squid versions and FreeBSD-10.1 headache
In-Reply-To: <54C277B1.8070802@gmail.com>
References: <CAAdA2WM2kmj-ncwnL4EmL8WEcPfEOqJHOKzBbG5JxWxbrq4jGg@mail.gmail.com>
 <54C23744.9000800@gmail.com>
 <CAAdA2WNQ-6sNoJkjkGJYsi6fAA9d+_kVZaBF7QOSOPZ2JhoW9Q@mail.gmail.com>
 <54C23B07.20405@gmail.com>
 <CAAdA2WPp9C-c9ZvW=v6_+Fm34NxZcVB2tmLpYqcHUdaUsx+cGg@mail.gmail.com>
 <54C23BF1.1030608@gmail.com>
 <CAAdA2WP2S_TpgK-q+vAwE5ejVxn7F2ipAoKoM1WF0C9rnV=Aaw@mail.gmail.com>
 <54C242C6.3030804@gmail.com> <54C24796.5010601@treenet.co.nz>
 <CAAdA2WO9EHWOmtpztKii3VOu_soyZjwSBcjE-xqifLR3aWnRtw@mail.gmail.com>
 <54C24F4E.50600@treenet.co.nz>
 <CAAdA2WNoZDEL8SjwoAuBYP7kW+BM5mWehU_aSm6XWz7JQDwmYA@mail.gmail.com>
 <54C25249.5060704@treenet.co.nz>
 <CAAdA2WMJ1mAOTeSU+0GdxKjRtiojUOEOBTLsqpU-KgYckGxaPw@mail.gmail.com>
 <54C25BB4.6020906@treenet.co.nz>
 <CAAdA2WOxz9UApjGTZVbV7KhxV+s+B1pvY0S2vpg42Kk=bN7gtg@mail.gmail.com>
 <CAAdA2WN=H0CyyYqX0CBv=MftMxNsKYmKH8P6zFzb4uunvXwoLw@mail.gmail.com>
 <54C2740E.9020007@treenet.co.nz> <54C277B1.8070802@gmail.com>
Message-ID: <54C27901.8090809@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 24/01/2015 5:32 a.m., Yuri Voinov wrote:
> 
> Amos,
> 
> important not to break Solaris-IPFilter for me ;)
> 

Aye. I will be testing it on your machine. It seems to be "just" a
matter of getting autoconf to define the macro with a 0 or 1 value
instead of set/unset.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUwnkBAAoJELJo5wb/XPRjUM0H/AjBzyfGRQ5APgRIzcw6j9vU
z2y5PGHgwaJuhutZOD3wOkjgWmp4tpqy/h4R7UoPCchzmf1TusHgX4EQ+xaK4769
5rS3u4L+dqxGxbX+Jcfa+EtvmXiXJOO2Skzvk0jBPHTi7bTHzvndkj5BBESc26RJ
Ont4agYRJ54oFKcGJ0IHcDMP8PB1KOX9bUVr7jY2hydUxeUMn2q4EP3nh8+GxqHY
L9u+7IQqWDLNU2FpAhNvYQGOWid2M795nefG5NfSH9L9hjW843U9vBLV896XZNr0
rP8EV4fuWzVfek+TQ85LAlc/xbjlXvQM3Kyek0TSFYNgiuC/dBPoDqbNMf35wqc=
=Tf0q
-----END PGP SIGNATURE-----


From justinmschw at gmail.com  Fri Jan 23 17:20:42 2015
From: justinmschw at gmail.com (agent_js03)
Date: Fri, 23 Jan 2015 09:20:42 -0800 (PST)
Subject: [squid-users] Squid ssl-bumping: how does squid verify certificates?
Message-ID: <1422033642873-4669296.post@n4.nabble.com>

Hi,

I am kind of a newbie to SSL, and have been tinkering with squid SSL bumping
for https, so bear with me if this question has already been discussed. So
here is my understanding of how HTTPS works: a browser has a sort of local
repository of trusted certificates, correct? And when you access an HTTPS
website it searches through these certificates and determines whether one is
to be trusted or not. So I've set up squid for SSL bumping and have added by
squid certificate to my browser's list of trusted certificates. However, the
way SSL now works is that squid intercepts my HTTPS request and I never
actually see the certificate sent from the original server, correct? So what
I want to know is how does squid know whether the certificate is valid or
not? I am afraid of getting a man-in-the-middle attack since it is squid
that verifies certificates and not my client. Or is my understanding
incorrect? Does squid have this same list of trusted sources and if not can
I set it up myself?



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-ssl-bumping-how-does-squid-verify-certificates-tp4669296.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From hack.back at hotmail.com  Fri Jan 23 17:28:04 2015
From: hack.back at hotmail.com (HackXBack)
Date: Fri, 23 Jan 2015 09:28:04 -0800 (PST)
Subject: [squid-users] FATAL: The ssl_crtd helpers are crashing too
 rapidly, need help!
In-Reply-To: <1421929053162-4669257.post@n4.nabble.com>
References: <1421929053162-4669257.post@n4.nabble.com>
Message-ID: <1422034084407-4669297.post@n4.nabble.com>

yes its work normally at start but after few hours it stop and say

FATAL: The ssl_crtd helpers are crashing too rapidly, need help! 

now i make cronjob to remove ssl_crtd then create it every 6 hours but this
is not solution !!

need Amos here
Thanks Yuri.



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/FATAL-The-ssl-crtd-helpers-are-crashing-too-rapidly-need-help-tp4669257p4669297.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From squid3 at treenet.co.nz  Fri Jan 23 17:43:42 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 24 Jan 2015 06:43:42 +1300
Subject: [squid-users] FATAL: The ssl_crtd helpers are crashing too
 rapidly, need help!
In-Reply-To: <1422034084407-4669297.post@n4.nabble.com>
References: <1421929053162-4669257.post@n4.nabble.com>
 <1422034084407-4669297.post@n4.nabble.com>
Message-ID: <54C2884E.4000509@treenet.co.nz>

On 24/01/2015 6:28 a.m., HackXBack wrote:
> yes its work normally at start but after few hours it stop and say
> 
> FATAL: The ssl_crtd helpers are crashing too rapidly, need help! 
> 
> now i make cronjob to remove ssl_crtd then create it every 6 hours but this
> is not solution !!
> 
> need Amos here
> Thanks Yuri.
> 

:-(

That message is Squid reporting the helpers death after there have been
potentially many such deaths.

Do you have any info from the helper about why its dying in the first place?

PS. keep in mind I am also just learning from the sidelines on this
feature. So I may be of no help at all.

Amos



From yvoinov at gmail.com  Fri Jan 23 18:07:20 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Sat, 24 Jan 2015 00:07:20 +0600
Subject: [squid-users] FATAL: The ssl_crtd helpers are crashing too
 rapidly, need help!
In-Reply-To: <54C2884E.4000509@treenet.co.nz>
References: <1421929053162-4669257.post@n4.nabble.com>
 <1422034084407-4669297.post@n4.nabble.com> <54C2884E.4000509@treenet.co.nz>
Message-ID: <54C28DD8.2010406@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Looks like it's got strange certificate from server, Amos. And then dying.

I had noticed in tail -f cache.log only certificate errors, sort of
argument error or somewhat.

I saw at least two such cases at the past three days.

After clearing SSL db directory and recreation it, issue is gone. For a
while.

23.01.2015 23:43, Amos Jeffries ?????:
> On 24/01/2015 6:28 a.m., HackXBack wrote:
>> yes its work normally at start but after few hours it stop and say
>>
>> FATAL: The ssl_crtd helpers are crashing too rapidly, need help!
>>
>> now i make cronjob to remove ssl_crtd then create it every 6 hours
but this
>> is not solution !!
>>
>> need Amos here
>> Thanks Yuri.
>>
>
> :-(
>
> That message is Squid reporting the helpers death after there have been
> potentially many such deaths.
>
> Do you have any info from the helper about why its dying in the first
place?
>
> PS. keep in mind I am also just learning from the sidelines on this
> feature. So I may be of no help at all.
>
> Amos
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUwo3YAAoJENNXIZxhPexGlo0IALDXrWaaGVFChjTU5KceQHlb
qTYHTnR6JCFLhUh/dVV7kwOEpNzj30dxfVS+fC3OprtVu5LlwYgr0iIfP6l7O/+Q
MRaDSEMCMw4w7iIBicy0Rr+CxjdKlaoFE9GsJK/S1zSuAqchXg+eXf5s7PnzXPpS
qTM/6Napaw+f/xf4zZKC8Fm+A4A7fkKgZZwxvCw3R2IB1RXQGoz3Orcl+9cpCskO
8sJTT0pwXfCiKRr/V0FBJYOZR2ugSJ7eTuwaEp8KoAGOwbs/UyPQOQ9iU0IhNxfS
qhyRFYh2OM2rAovnIfhqw+9a0emSN3ZTfcw5oaK3tzciSXEEYaZxy3koJoIuq6Q=
=j1Jp
-----END PGP SIGNATURE-----



From squid3 at treenet.co.nz  Fri Jan 23 18:10:48 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 24 Jan 2015 07:10:48 +1300
Subject: [squid-users] Squid ssl-bumping: how does squid verify
	certificates?
In-Reply-To: <1422033642873-4669296.post@n4.nabble.com>
References: <1422033642873-4669296.post@n4.nabble.com>
Message-ID: <54C28EA8.4060507@treenet.co.nz>

On 24/01/2015 6:20 a.m., agent_js03 wrote:
> Hi,
> 
> I am kind of a newbie to SSL, and have been tinkering with squid SSL bumping
> for https, so bear with me if this question has already been discussed. So
> here is my understanding of how HTTPS works: a browser has a sort of local
> repository of trusted certificates, correct?

Correct.

> And when you access an HTTPS
> website it searches through these certificates and determines whether one is
> to be trusted or not. So I've set up squid for SSL bumping and have added by
> squid certificate to my browser's list of trusted certificates. However, the
> way SSL now works is that squid intercepts my HTTPS request and I never
> actually see the certificate sent from the original server, correct?

Maybe. It depends on how the bumping is done.

The splice and none modes in ther respective Squid versions make it
pass-thru the SSL traffic from server to client, so you do see the
server details in full.

The mimic feature generates a certificate from Squid cloning as much as
possible from the original server cert, both good and bad details are
copied. So the client can see how broken the server cert is, and in
which ways, even if some particular values are slightly different.


> So what
> I want to know is how does squid know whether the certificate is valid or
> not?

The OpenSSL library used by Squid performs mostly the same checks the
browsers are doing to validate the certificate. Then Squid (recent
releases) also pass certificate chains through a configurable helper
validator that can perform additional checks if you so wish.

In theory the set of "Trusted Certificate Authorities" is a global set,
but it does vary depending on who provided the list and how up to date
your copy is. The browser vendors have their own processes of
determining trust and generate their own lists.

On your Squid machine it is probably in a system package called
"ca-certificates" or "snakeoil" provided by your OS vendor or OpenSSL
packager. The ones I see most mention of origins for are based on the
Mozilla projects trusted CA list - though yours may not be.


> I am afraid of getting a man-in-the-middle attack since it is squid
> that verifies certificates and not my client. Or is my understanding
> incorrect?

The one thing you can guarantee is that your *ARE* absolutely getting
MITM'd. By your Squid itelf if not some other way. The "SSL-Bump" is an
MITM on HTTPS protocol.

To ensure that Squid is at least doing its best to validate stay away
from the various DONT_VERIFY_* options you see some tutorials
recommending. They actively disable validation.


> Does squid have this same list of trusted sources and if not can
> I set it up myself?

See above and yes you can add/remove trusted CA entries yourself. I
believe the openssl UI tools have ways to do it, though I'm not familiar
enough with them to point you directly at how sorry.

Amos


From micah.parrish at hp.com  Fri Jan 23 19:14:31 2015
From: micah.parrish at hp.com (Micah Parrish)
Date: Fri, 23 Jan 2015 12:14:31 -0700
Subject: [squid-users] Reverse proxy through a parent proxy
Message-ID: <54C29D97.2000906@hp.com>

Squid 3.1+RHEL6.5.

I'd like to reverse proxy a linux distro repository, but I am stuck 
behind a corporate web proxy which I do not control.  This is how I 
accelerate an internal mirror, and it works well:


http_port 80 accel defaultsite=myhostname.company.com
cache_peer internal.repo.comany.com    parent    80  0 no-query 
originserver name=myAccel
acl our_sites dstdomain myhostname.company.com
http_access allow our_sites
cache_peer_access myAccel allow our_sites
cache_peer_access myAccel deny all


I've changed some lines to treat my corporate web proxy (bluecoat) as a 
parent and accelerate a fedora repo:


http_port 80 accel defaultsite=myhostname.company.com
acl our_sites dstdomain myhostname.company.com
http_access allow our_sites
cache_peer fedoraproject.org    parent    80  0 no-query originserver 
name=myAccel

cache_peer_access myAccel allow our_sites
cache_peer_access myAccel deny all

cache_peer web-proxy.company.com       parent    8080 0  no-query 
name=myCorpProxy
cache_peer_access myCorpProxy allow our_sites
cache_peer_access myCorpProxy deny all

This results in a forwarding loop.  I've tried many variations.  I 
always get permission denied if I don't have the ACLs right or a 
forwarding loop.

So my question is, what is the proper way to accelerate a site which you 
must go through a proxy to reach?

Regards,

Micah Parrish


From mcsnv96 at afo.net  Fri Jan 23 20:08:23 2015
From: mcsnv96 at afo.net (Mike)
Date: Fri, 23 Jan 2015 14:08:23 -0600
Subject: [squid-users] FATAL: The ssl_crtd helpers are crashing too
 rapidly, need help!
In-Reply-To: <1421929053162-4669257.post@n4.nabble.com>
References: <1421929053162-4669257.post@n4.nabble.com>
Message-ID: <54C2AA37.5090000@afo.net>

For a Red Hat/CentOS based OS, selinux causes that.

The fix I found in this case:

Before the below ?audit2allow? command will work, you will need to 
install the needed tool for selinux:

* yum -yinstall policycoreutils-python
(which will also install a few other dependencies).

To temporarily set selinux to permissive:

* echo 0 >/selinux/enforce

To re-enable after it is fixed:
* echo 1 >/selinux/enforce

Check the /var/log/audit/audit.log for the type=AVC relating to the 
ssl_crtd entries (easy way is "grep AVC audit.log | less" ).

To find out WHY it is happening in selinux, use this:
grep ssl_crtd /var/log/audit/audit.log | audit2allow -w


Start in /tmp/ folder since we will not need these files for long.

* grep ssl_crtd /var/log/audit/audit.log | audit2allow -m ssl_crtdlocal 
 > ssl_crtdlocal.te
- outputs the suggested settings into the file ssl_crtdlocal.te, which 
we will review below in ?cat?
* cat ssl_crtdlocal.te
- to review the created file and show what will be donein selinux
* grep ssl_crtd /var/log/audit/audit.log | audit2allow -M ssl_crtdlocal
- Note the capital M, this Makes the needed file, ready for selinux to 
import, and then the next command below actually enables it.
* semodule -i ssl_crtdlocal.pp
- Used to enable the new policy in selinux

As long as it is now working properly, can delete the *.te and *.pp 
files created in the /tmp/ folder.

Now all of this is mute if selinux is not used so there may likely be 
other explanations, but this at least covers RedHat based OS's with 
selinux. I documented all of this since our servers ran into the same 
issue due to selinux, and this was how we resolved it.


Mike



On 1/22/2015 6:17 AM, HackXBack wrote:
> hello,
> every day i found this error and my cache stop
>
> then i remove the ssl database then restart squid
>
> next day the problem happen again ,
> am using squid 3.4.11
>
> what may cause this problem ?
>
> thanks.
>
>
>
> --
> View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/FATAL-The-ssl-crtd-helpers-are-crashing-too-rapidly-need-help-tp4669257.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>



From yvoinov at gmail.com  Fri Jan 23 20:10:38 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Sat, 24 Jan 2015 02:10:38 +0600
Subject: [squid-users] FATAL: The ssl_crtd helpers are crashing too
 rapidly, need help!
In-Reply-To: <54C2AA37.5090000@afo.net>
References: <1421929053162-4669257.post@n4.nabble.com>
 <54C2AA37.5090000@afo.net>
Message-ID: <54C2AABE.4040506@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
This issue not linux-specific, Mike.

As a minimum for me - I'm never use Linux. :)

24.01.2015 2:08, Mike ?????:
> For a Red Hat/CentOS based OS, selinux causes that.
>
> The fix I found in this case:
>
> Before the below ?audit2allow? command will work, you will need to
install the needed tool for selinux:
>
> * yum -yinstall policycoreutils-python
> (which will also install a few other dependencies).
>
> To temporarily set selinux to permissive:
>
> * echo 0 >/selinux/enforce
>
> To re-enable after it is fixed:
> * echo 1 >/selinux/enforce
>
> Check the /var/log/audit/audit.log for the type=AVC relating to the
ssl_crtd entries (easy way is "grep AVC audit.log | less" ).
>
> To find out WHY it is happening in selinux, use this:
> grep ssl_crtd /var/log/audit/audit.log | audit2allow -w
>
>
> Start in /tmp/ folder since we will not need these files for long.
>
> * grep ssl_crtd /var/log/audit/audit.log | audit2allow -m
ssl_crtdlocal > ssl_crtdlocal.te
> - outputs the suggested settings into the file ssl_crtdlocal.te, which
we will review below in ?cat?
> * cat ssl_crtdlocal.te
> - to review the created file and show what will be donein selinux
> * grep ssl_crtd /var/log/audit/audit.log | audit2allow -M ssl_crtdlocal
> - Note the capital M, this Makes the needed file, ready for selinux to
import, and then the next command below actually enables it.
> * semodule -i ssl_crtdlocal.pp
> - Used to enable the new policy in selinux
>
> As long as it is now working properly, can delete the *.te and *.pp
files created in the /tmp/ folder.
>
> Now all of this is mute if selinux is not used so there may likely be
other explanations, but this at least covers RedHat based OS's with
selinux. I documented all of this since our servers ran into the same
issue due to selinux, and this was how we resolved it.
>
>
> Mike
>
>
>
> On 1/22/2015 6:17 AM, HackXBack wrote:
>> hello,
>> every day i found this error and my cache stop
>>
>> then i remove the ssl database then restart squid
>>
>> next day the problem happen again ,
>> am using squid 3.4.11
>>
>> what may cause this problem ?
>>
>> thanks.
>>
>>
>>
>> --
>> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/FATAL-The-ssl-crtd-helpers-are-crashing-too-rapidly-need-help-tp4669257.html
>> Sent from the Squid - Users mailing list archive at Nabble.com.
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUwqq9AAoJENNXIZxhPexGQMsIAMvP4+N59KAmo3qhtMIfUllI
hItHPDd2bhGXx5tR/71bJdt9wDJCMEUU4U/+ZJJBOkUd/TyO54RLTffvkW6DjV9z
itmu+mcPTpX5U/9vY1GUobipGWiqqWLMzAV4+nGYTIlWN84DIRcwWobTpL8W970Y
l+vazCDJfwKLaopIWcq+/DOVNuYfWIngsRtbZJWatxhNRFTO7BvGCxZ7Ee4gEK/t
T7ICTeTrg62gktdZWDB4CBzNTctLXcWX9KkXV4gmVHI2IJcx8+x5ztmPj64uhL1m
9OwwxlaKMFMiTmGNijsUe/+nawamHodgtVjaBaYAOzuMvTAv5w0RZ65qZnpsXpQ=
=wH+S
-----END PGP SIGNATURE-----



From Jason_Haar at trimble.com  Fri Jan 23 23:28:56 2015
From: Jason_Haar at trimble.com (Jason Haar)
Date: Sat, 24 Jan 2015 12:28:56 +1300
Subject: [squid-users] is chunked support from clients fully supported?
Message-ID: <54C2D938.5070702@trimble.com>

Hi there

The squid.conf.documented file in squid-3.4.10 states (for
chunked_request_body_max_size), "Squid does not have full support for
that feature yet".

Is that still the case? We have some people running some client software
that requires chunked support and we want to be sure the newer squid
(we're still on 3.1) supports chunked before getting back to them (and
yes we have already asked them how to test it and they don't know: sigh
- users!!!)

Thanks!

-- 
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1



From squid3 at treenet.co.nz  Sat Jan 24 04:20:12 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 24 Jan 2015 17:20:12 +1300
Subject: [squid-users] is chunked support from clients fully supported?
In-Reply-To: <54C2D938.5070702@trimble.com>
References: <54C2D938.5070702@trimble.com>
Message-ID: <54C31D7C.3090106@treenet.co.nz>

On 24/01/2015 12:28 p.m., Jason Haar wrote:
> Hi there
> 
> The squid.conf.documented file in squid-3.4.10 states (for
> chunked_request_body_max_size), "Squid does not have full support for
> that feature yet".
> 
> Is that still the case? We have some people running some client software
> that requires chunked support and we want to be sure the newer squid
> (we're still on 3.1) supports chunked before getting back to them (and
> yes we have already asked them how to test it and they don't know: sigh
> - users!!!)
> 
> Thanks!
> 


Oops, sorry. That directive should have been removed from the documentation.

The current Squid (3.2 and later) which which send the version label
"HTTP/1.1" all support chunked encoding.

Amos



From squid3 at treenet.co.nz  Sat Jan 24 11:47:52 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 25 Jan 2015 00:47:52 +1300
Subject: [squid-users] Reverse proxy through a parent proxy
In-Reply-To: <54C29D97.2000906@hp.com>
References: <54C29D97.2000906@hp.com>
Message-ID: <54C38668.4060804@treenet.co.nz>

On 24/01/2015 8:14 a.m., Micah Parrish wrote:
> Squid 3.1+RHEL6.5.
> 
> I'd like to reverse proxy a linux distro repository, but I am stuck
> behind a corporate web proxy which I do not control.

The only way this can work is if the parent proxy is explicitly
configured with a source to relay the traffic on to.

Otherwise, as you already found, when the parent proxy looks up DNS
entries of where to deliver the traffic it just finds the internal proxy
and loops.

Amos



From squid3 at treenet.co.nz  Sat Jan 24 12:15:24 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 25 Jan 2015 01:15:24 +1300
Subject: [squid-users] tcp_outgoing_address and ICAP server
In-Reply-To: <54C01610.2050609@urlfilterdb.com>
References: <54C01610.2050609@urlfilterdb.com>
Message-ID: <54C38CDC.6040904@treenet.co.nz>

On 22/01/2015 10:11 a.m., Marcus Kool wrote:
> I am using Squid 3.4.9 and have an issue with tcp_outgoing_address.
> 
> The Squid server is connceted to the internet with multiple NICs and uses
>    tcp_outgoing_address a.public.IP.address
> 
> and also want to use an ICAP server on the same host using
> 
> icap_service  reqmod_urlfilterdb   reqmod_precache  
> icap://a.local.ip.address:1344/reqmod_icapd  bypass=off  routing=on 
> on-overload=wait ipv6=off
> 
> It seems that Squid binds the connection to the ICAP server the same way
> it binds
> connections to webservers using the rule with tcp_outgoing_address
> and that it not desired nor workable.
> 
> I tried
> 
> acl myicaphost dst a.local.ip.address
> tcp_outgoing_address a.public.IP.address !myicaphost
> 
> but Squid issues the following errors:
> 2015/01/21 21:58:32 kid1| WARNING: myicaphost ACL is used in context
> without an HTTP request. Assuming mismatch.
> 2015/01/21 21:58:32 kid1| commBind: Cannot bind socket FD 10 to
> XX.XX.XX.XX: (99) Cannot assign requested address
> 2015/01/21 21:58:32 kid1| essential ICAP service is down after an
> options fetch failure: icap://XX.XX.XX.XX:1344/reqmod_icapd [down,!opt]
> 
> So the question is how to send web traffic over a specific NIC and
> traffic to the ICAP server over an other (default?) NIC ?


Please try the attached patch against Squid-3.4. It should make your
config work.

Amos
-------------- next part --------------
=== modified file 'src/acl/DestinationIp.cc'
--- src/acl/DestinationIp.cc	2013-05-13 23:32:23 +0000
+++ src/acl/DestinationIp.cc	2015-01-24 12:08:45 +0000
@@ -35,40 +35,44 @@
 #include "acl/DestinationIp.h"
 #include "acl/FilledChecklist.h"
 #include "client_side.h"
 #include "comm/Connection.h"
 #include "HttpRequest.h"
 #include "SquidConfig.h"
 
 ACLFlag ACLDestinationIP::SupportedFlags[] = {ACL_F_NO_LOOKUP, ACL_F_END};
 
 char const *
 ACLDestinationIP::typeString() const
 {
     return "dst";
 }
 
 int
 ACLDestinationIP::match(ACLChecklist *cl)
 {
     ACLFilledChecklist *checklist = Filled(cl);
 
+    // if there is no HTTP request details fallback to the dst_addr
+    if (!checklist->request)
+        return ACLIP::match(checklist->dst_addr);
+
     // Bug 3243: CVE 2009-0801
     // Bypass of browser same-origin access control in intercepted communication
     // To resolve this we will force DIRECT and only to the original client destination.
     // In which case, we also need this ACL to accurately match the destination
     if (Config.onoff.client_dst_passthru && (checklist->request->flags.intercepted || checklist->request->flags.interceptTproxy)) {
         assert(checklist->conn() && checklist->conn()->clientConnection != NULL);
         return ACLIP::match(checklist->conn()->clientConnection->local);
     }
 
     if (flags.isSet(ACL_F_NO_LOOKUP)) {
         if (!checklist->request->GetHostIsNumeric()) {
             debugs(28, 3, "aclMatchAcl:  No-lookup DNS ACL '" << AclMatchedName << "' for '" << checklist->request->GetHost() << "'");
             return 0;
         }
 
         if (ACLIP::match(checklist->request->host_addr))
             return 1;
         return 0;
     }
 

=== modified file 'src/acl/DestinationIp.h'
--- src/acl/DestinationIp.h	2013-01-27 17:35:07 +0000
+++ src/acl/DestinationIp.h	2015-01-24 12:09:01 +0000
@@ -41,33 +41,32 @@
 {
 
 public:
     static DestinationIPLookup *Instance();
     virtual void checkForAsync(ACLChecklist *)const;
 
 private:
     static DestinationIPLookup instance_;
     static IPH LookupDone;
 };
 
 class ACLDestinationIP : public ACLIP
 {
 
 public:
     MEMPROXY_CLASS(ACLDestinationIP);
 
     ACLDestinationIP(): ACLIP(ACLDestinationIP::SupportedFlags) {}
     virtual char const *typeString() const;
     virtual int match(ACLChecklist *checklist);
-    virtual bool requiresRequest() const {return true;}
 
     virtual ACL *clone()const;
 
     static ACLFlag SupportedFlags[];
 private:
     static Prototype RegistryProtoype;
     static ACLDestinationIP RegistryEntry_;
 };
 
 MEMPROXY_CLASS_INLINE(ACLDestinationIP);
 
 #endif /* SQUID_ACLDESTINATIONIP_H */


From marcus.kool at urlfilterdb.com  Sat Jan 24 20:39:33 2015
From: marcus.kool at urlfilterdb.com (Marcus Kool)
Date: Sat, 24 Jan 2015 18:39:33 -0200
Subject: [squid-users] tcp_outgoing_address and ICAP server
In-Reply-To: <54C38CDC.6040904@treenet.co.nz>
References: <54C01610.2050609@urlfilterdb.com> <54C38CDC.6040904@treenet.co.nz>
Message-ID: <54C40305.1090408@urlfilterdb.com>



On 01/24/2015 10:15 AM, Amos Jeffries wrote:
> On 22/01/2015 10:11 a.m., Marcus Kool wrote:
>> I am using Squid 3.4.9 and have an issue with tcp_outgoing_address.
>>
>> The Squid server is connceted to the internet with multiple NICs and uses
>>     tcp_outgoing_address a.public.IP.address
>>
>> and also want to use an ICAP server on the same host using
>>
>> icap_service  reqmod_urlfilterdb   reqmod_precache
>> icap://a.local.ip.address:1344/reqmod_icapd  bypass=off  routing=on
>> on-overload=wait ipv6=off
>>
>> It seems that Squid binds the connection to the ICAP server the same way
>> it binds
>> connections to webservers using the rule with tcp_outgoing_address
>> and that it not desired nor workable.
>>
>> I tried
>>
>> acl myicaphost dst a.local.ip.address
>> tcp_outgoing_address a.public.IP.address !myicaphost
>>
>> but Squid issues the following errors:
>> 2015/01/21 21:58:32 kid1| WARNING: myicaphost ACL is used in context
>> without an HTTP request. Assuming mismatch.
>> 2015/01/21 21:58:32 kid1| commBind: Cannot bind socket FD 10 to
>> XX.XX.XX.XX: (99) Cannot assign requested address
>> 2015/01/21 21:58:32 kid1| essential ICAP service is down after an
>> options fetch failure: icap://XX.XX.XX.XX:1344/reqmod_icapd [down,!opt]
>>
>> So the question is how to send web traffic over a specific NIC and
>> traffic to the ICAP server over an other (default?) NIC ?
>
>
> Please try the attached patch against Squid-3.4. It should make your
> config work.
>
> Amos

Thank you for the patch.
It resolves 1 issue: there is no longer the warning
    WARNING: myicaphost ACL is used in context without an HTTP request. Assuming mismatch.

But the binding to the wrong NIC with the external IP still happens:

2015/01/24 17:19:48.027 kid1| Xaction.cc(133) openConnection: Adaptation::Icap::OptXact opens connection to 10.10.0.6:1344
2015/01/24 17:19:48.027 kid1| AsyncCall.cc(18) AsyncCall: The AsyncCall Adaptation::Icap::Xaction::noteCommConnected constructed, this=0x1d9d7e0 [call53]
2015/01/24 17:19:48.027 kid1| comm.cc(549) comm_openex: comm_openex: Attempt open socket for: a.public.IP.address
2015/01/24 17:19:48.027 kid1| comm.cc(590) comm_openex: comm_openex: Opened socket local=a.public.IP.address remote=[::] FD 10 flags=1 : family=2, type=1, protocol=6

The firewall and routing was changed to allow traffic from the external IP to
the internal IP so for us the urgency of the issue is low, but
the binding remains on the external IP despite the ACL saying not to do it.

Marcus




From dig at digcorp.net  Sun Jan 25 00:52:31 2015
From: dig at digcorp.net (Daniel Greenwald)
Date: Sat, 24 Jan 2015 19:52:31 -0500
Subject: [squid-users] Fwd: Squid 3.4.10 RPMs release for CentOS 32 and 64
	bit.
In-Reply-To: <CAOsHgtubTH5M_nPrf7OExxSE-To966v+pR1WZq2y1dsgatiRng@mail.gmail.com>
References: <54885AAB.2000504@treenet.co.nz> <54B69BBC.8010606@ngtech.co.il>
 <CAOsHgtubTH5M_nPrf7OExxSE-To966v+pR1WZq2y1dsgatiRng@mail.gmail.com>
Message-ID: <CAOsHgtvDprbrRaHRzi2O9Sj_wT8asni7yNJiGJP8=bV50Ldm3w@mail.gmail.com>

Eliezer- I have installed the squid 3.5 on centos 7 from your repo, the
version is:
squid-3.5.0.4-1.el6.x86_64

Problem is I am not finding ssl_crtd:
find -name ssl_crtd
returns nothing.

But squid -v
does show --enable-ssl-crtd

Should I just build from source or am I missing something?

Thanks!

-----------
Daniel I Greenwald


On Wed, Jan 14, 2015 at 11:39 AM, Eliezer Croitoru <eliezer at ngtech.co.il>
wrote:

> Published at: http://www1.ngtech.co.il/wpe/?p=8
>
> I am happy to release the new RPMs of squid 3.4.10 and 3.5.0.4 beta for
> Centos 6.6 64bit and 32bit .
>
> The new release includes couple bug fixes and improvements.
> The links to the RPMs are at the bottom of the article.
>
> "What if a human would act as a proxy server?"
>
>
> One of the hardest jobs on the planet earth would be a "proxy" that needs
> to connect between a requester and the right response. The proxy would need
> first to identify the request and understand it properly and then needs to
> decide what to lookup in the database for a corresponding response.
> It's a very messy job since the source IP and all the request
> characteristics should be answered. In many cases the request will not give
> enough information about the wanted response and the user will need to
> request another time for the requested data. I would assume that it would
> require some buildings to be populated with lots of "proxies" to fulfill
> all humans web requests. But the reality is not that far from this fantasy.
> If you would look at the world you would see that lots of humans just act
> as a simple proxy between someone to somebody else or something else. A
> nice example would be when you go to a wood store to buy some woods for a
> fire. If this would be your first time you would not know the prices and
> wood kinds while the wood-shop guy would know more then you. He then acts
> as a proxy between your mind and his to understand the different kinds of
> wood that can fulfill your needs while giving you the prices.
> And while writing I am thinking about it again, and one of the hardest
> jobs there are in the market is the "Match Maker". Just to illustrate that
> a human would have been a proxy and a "Match Maker". Actually a "Match
> Maker" job would be to take two different minds and put them together while
> understanding them both enough to make them both happy about the meetings.
> So how would a "Match Maker" would act if he was a proxy? He would need to
> fetch or get from the clients information about their wishes and analyze
> their requests to find a matching pair. From the requester side he needs
> something, a companion.
> But from the "Match Maker" point of view there is a need to actually find
> a match which would stick for a very long time and that would not cause
> harm while building love and harmony. I am not a "Match Maker" but I do
> believe that a simple piece of software can help the human which actually
> needs help from others to do other tasks which a proxy cannot do good
> enough.
>
> * Any notes and comments are wanted and welcome!
>
> For this release I am attaching a video link about DDos and the
> vulnerabilities of the Linux kernel:
>
> - DDoS protection using Netfilter iptables from Jesper Dangaard Brouer
> http://www.youtube.com/watch?v=7_8ic1AaRso
>
> Or a local mirror and presentation file at:
> http://www1.ngtech.co.il/squid/videos/Jesper Dangaard Brouer - DDoS
> protection using Netfilter_iptables_BklSqr9t4uA.mp4
>
> http://www1.ngtech.co.il/squid/videos/DDoS_protection_
> Jesper_Brouer/iptables-ddos-mitigation_JesperBrouer.pdf
>
> This release repository is at:
> http://www1.ngtech.co.il/rpm/centos/6/x86_64/
>
> This release files are:
> http://www1.ngtech.co.il/repo/centos/6/x86_64/squid-3.4.10-
> 1.el6.x86_64.rpm
> http://www1.ngtech.co.il/repo/centos/6/x86_64/squid-helpers-
> 3.4.10-1.el6.x86_64.rpm
> http://www1.ngtech.co.il/repo/centos/6/x86_64/squid-
> debuginfo-3.4.10-1.el6.x86_64.rpm
>
> The beta repository was move to:
> http://www1.ngtech.co.il/repo/centos/6/beta/x86_64/
>
> The beta release files are:
> http://www1.ngtech.co.il/repo/centos/6/beta/x86_64/squid-3.
> 5.0.4-1.el6.x86_64.rpm
> http://www1.ngtech.co.il/repo/centos/6/beta/x86_64/squid-
> helpers-3.5.0.4-1.el6.x86_64.rpm
> http://www1.ngtech.co.il/repo/centos/6/beta/x86_64/squid-
> debuginfo-3.5.0.4-1.el6.x86_64.rpm
>
> To Each and everyone of them there is an *asc* file which contains MD5
> SHA1 SHA2 SHA256 SHA384 SHA512 TIGER hashes.
>
> All The Bests,
> Eliezer Croitoru
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150124/341bcc8d/attachment.htm>

From squid3 at treenet.co.nz  Sun Jan 25 01:24:50 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 25 Jan 2015 14:24:50 +1300
Subject: [squid-users] tcp_outgoing_address and ICAP server
In-Reply-To: <54C40305.1090408@urlfilterdb.com>
References: <54C01610.2050609@urlfilterdb.com>
 <54C38CDC.6040904@treenet.co.nz> <54C40305.1090408@urlfilterdb.com>
Message-ID: <54C445E2.7090606@treenet.co.nz>

On 25/01/2015 9:39 a.m., Marcus Kool wrote:
> 
> 
> On 01/24/2015 10:15 AM, Amos Jeffries wrote:
>> On 22/01/2015 10:11 a.m., Marcus Kool wrote:
>>> I am using Squid 3.4.9 and have an issue with tcp_outgoing_address.
>>>
>>> The Squid server is connceted to the internet with multiple NICs and
>>> uses
>>>     tcp_outgoing_address a.public.IP.address
>>>
>>> and also want to use an ICAP server on the same host using
>>>
>>> icap_service  reqmod_urlfilterdb   reqmod_precache
>>> icap://a.local.ip.address:1344/reqmod_icapd  bypass=off  routing=on
>>> on-overload=wait ipv6=off
>>>
>>> It seems that Squid binds the connection to the ICAP server the same way
>>> it binds
>>> connections to webservers using the rule with tcp_outgoing_address
>>> and that it not desired nor workable.
>>>
>>> I tried
>>>
>>> acl myicaphost dst a.local.ip.address
>>> tcp_outgoing_address a.public.IP.address !myicaphost
>>>
>>> but Squid issues the following errors:
>>> 2015/01/21 21:58:32 kid1| WARNING: myicaphost ACL is used in context
>>> without an HTTP request. Assuming mismatch.
>>> 2015/01/21 21:58:32 kid1| commBind: Cannot bind socket FD 10 to
>>> XX.XX.XX.XX: (99) Cannot assign requested address
>>> 2015/01/21 21:58:32 kid1| essential ICAP service is down after an
>>> options fetch failure: icap://XX.XX.XX.XX:1344/reqmod_icapd [down,!opt]
>>>
>>> So the question is how to send web traffic over a specific NIC and
>>> traffic to the ICAP server over an other (default?) NIC ?
>>
>>
>> Please try the attached patch against Squid-3.4. It should make your
>> config work.
>>
>> Amos
> 
> Thank you for the patch.
> It resolves 1 issue: there is no longer the warning
>    WARNING: myicaphost ACL is used in context without an HTTP request.
> Assuming mismatch.
> 
> But the binding to the wrong NIC with the external IP still happens:
> 
> 2015/01/24 17:19:48.027 kid1| Xaction.cc(133) openConnection:
> Adaptation::Icap::OptXact opens connection to 10.10.0.6:1344
> 2015/01/24 17:19:48.027 kid1| AsyncCall.cc(18) AsyncCall: The AsyncCall
> Adaptation::Icap::Xaction::noteCommConnected constructed, this=0x1d9d7e0
> [call53]
> 2015/01/24 17:19:48.027 kid1| comm.cc(549) comm_openex: comm_openex:
> Attempt open socket for: a.public.IP.address
> 2015/01/24 17:19:48.027 kid1| comm.cc(590) comm_openex: comm_openex:
> Opened socket local=a.public.IP.address remote=[::] FD 10 flags=1 :
> family=2, type=1, protocol=6
> 
> The firewall and routing was changed to allow traffic from the external
> IP to
> the internal IP so for us the urgency of the issue is low, but
> the binding remains on the external IP despite the ACL saying not to do it.

Aha, conceptual problem.

tcp_outgoing_address does not forbid things. There is no "allow/deny"
action, just a set-IP action. It either sets the IP or it leaves it alone.

Your rule sets the IP when the dst is non-myicaphost. So what
tcp_outgoing_address rule or OS level routing rule matches when it *is*
myicaphost?

Amos


From al.akchurin at hotmail.com  Sun Jan 25 03:16:34 2015
From: al.akchurin at hotmail.com (Eldar Akchurin)
Date: Sun, 25 Jan 2015 04:16:34 +0100
Subject: [squid-users] Problem with running squid 3.5 on windows 7
In-Reply-To: <DUB128-W378A2E891FA711D7317611ED360@phx.gbl>
References: <DUB128-W55525A3B23BC7997B586EDED6A0@phx.gbl>,
 <54939693.3060102@treenet.co.nz>, ,
 <CAD5EgYppKH2dEaCyV5+UEWxsrVEOwhuLoHx7R5+1KeAsrpcAJA@mail.gmail.com>, ,
 <54942D75.3020908@treenet.co.nz>,
 <DUB128-W386F0087439E955D2D0817ED6B0@phx.gbl>,
 <54948EC0.9000406@treenet.co.nz>, <5495839C.90503@treenet.co.nz>,
 <DUB128-W78DFD91541BE4FF2230E56ED680@phx.gbl>,
 <549641E7.2000700@treenet.co.nz>,
 <DUB128-W846880FC1B7B967BA72838ED690@phx.gbl>,
 <5496DFCF.9040808@treenet.co.nz>,
 <DUB128-W34931C2A4940D01493E6C8ED690@phx.gbl>,
 <5496F97B.1010404@treenet.co.nz>,
 <DUB128-W63731D06D443326A3FBF1FED690@phx.gbl>,
 <DUB128-W86BEEB01DC11B87B29E9FBED690@phx.gbl>,
 <DUB128-W314A255069BDFCF7DB1BC3ED560@phx.gbl>,
 <DUB128-W347E001CA10DF69590EB0FED560@phx.gbl>,
 <549776FF.1010806@treenet.co.nz>,
 <DUB128-W23F2655740D60FD8F31C03ED4B0@phx.gbl>,
 <DUB128-W254D53363D4E4A2B48EB9EED4B0@phx.gbl>,
 <DUB128-W82B65B02877EB4846D83E3ED4B0@phx.gbl>,
 <DUB128-W1AD6C68396CB94DE7CE0DED4B0@phx.gbl>, <54BF2D4B.2020800@treenet.co.nz>,
 <DUB128-W45167C4ADD3081D24DC05AED4
 ,90@phx.gbl>,<DUB128-W378A2E891FA711D7317611ED360@phx.gbl>
Message-ID: <DUB128-W46B79BC16BF3CCDBE07EE6ED340@phx.gbl>

Hi Amos,
 
Sorry to disturb you again, I have changed the ModSelectWin32 for now, it seems it kind of works.
I will collect all the patches and will send you after I have the first version running :)
 
The next issue is in the mswindows.h
 
inline ssize_t
recvfrom(int s, void * b, size_t l, int f, struct sockaddr * fr, socklen_t * fl)
{
    ssize_t result;
    int ifl=*fl;
    if ((result = ::recvfrom(_get_osfhandle(s), (char *)b, l, f, fr, &ifl)) == SOCKET_ERROR) {
        errno = WSAGetLastError();
        return -1;
    } else
        return result;
}
 
::recvfrom changes the size, but you kind of forgetting it inside ifl, not passing it out.Why not simply pass fl? why do you need ifl? socklen_t is declared as int. Or can this be changed in the future?
At least it is necessary to copy the value returned by ifl into the fl again after the call.
 
The next problem I'm having is that only squid -N works. As soon as I run it in the daemon mode (without -N) none of the workers is created. Could you please point me to the part of the code that is responsible for spawning workers?
 
Thank you very much!
 
Best regards,
e
 
                         		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150125/4cb06653/attachment.htm>

From squid3 at treenet.co.nz  Sun Jan 25 04:05:43 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 25 Jan 2015 17:05:43 +1300
Subject: [squid-users] Problem with running squid 3.5 on windows 7
In-Reply-To: <DUB128-W46B79BC16BF3CCDBE07EE6ED340@phx.gbl>
References: <DUB128-W55525A3B23BC7997B586EDED6A0@phx.gbl>,
 <DUB128-W386F0087439E955D2D0817ED6B0@phx.gbl>,
 <54948EC0.9000406@treenet.co.nz>, <5495839C.90503@treenet.co.nz>,
 <DUB128-W78DFD91541BE4FF2230E56ED680@phx.gbl>,
 <549641E7.2000700@treenet.co.nz>,
 <DUB128-W846880FC1B7B967BA72838ED690@phx.gbl>,
 <5496DFCF.9040808@treenet.co.nz>,
 <DUB128-W34931C2A4940D01493E6C8ED690@phx.gbl>,
 <5496F97B.1010404@treenet.co.nz>,
 <DUB128-W63731D06D443326A3FBF1FED690@phx.gbl>,
 <DUB128-W86BEEB01DC11B87B29E9FBED690@phx.gbl>,
 <DUB128-W314A255069BDFCF7DB1BC3ED560@phx.gbl>,
 <DUB128-W347E001CA10DF69590EB0FED560@phx.gbl>,
 <549776FF.1010806@treenet.co.nz>,
 <DUB128-W23F2655740D60FD8F31C03ED4B0@phx.gbl>,
 <DUB128-W254D53363D4E4A2B48EB9EED4B0@phx.gbl>,
 <DUB128-W82B65B02877EB4846D83E3ED4B0@phx.gbl>,
 <DUB128-W1AD6C68396CB94DE7CE0DED4B0@phx.gbl>, <54BF2D4B.2020800@treenet.co.nz>,
 <DUB128-W45167C4ADD3081D24DC05AED4 , 90@phx.gbl>,
 <DUB128-W378A2E891FA711D7317611ED360@phx.gbl>
 <DUB128-W46B79BC16BF3CCDBE07EE6ED340@phx.gbl>
Message-ID: <54C46B97.1020709@treenet.co.nz>

On 25/01/2015 4:16 p.m., Eldar Akchurin wrote:
> Hi Amos,
>  
> Sorry to disturb you again, I have changed the ModSelectWin32 for now, it seems it kind of works.
> I will collect all the patches and will send you after I have the first version running :)
>  

Yay. Sorry for not having time for this, got flooded under with 3.5.1
feedback but things are settling down again now.


> The next issue is in the mswindows.h
>  
> inline ssize_t
> recvfrom(int s, void * b, size_t l, int f, struct sockaddr * fr, socklen_t * fl)
> {
>     ssize_t result;
>     int ifl=*fl;
>     if ((result = ::recvfrom(_get_osfhandle(s), (char *)b, l, f, fr, &ifl)) == SOCKET_ERROR) {
>         errno = WSAGetLastError();
>         return -1;
>     } else
>         return result;
> }
>  
> ::recvfrom changes the size, but you kind of forgetting it inside ifl, not passing it out.Why not simply pass fl? why do you need ifl? socklen_t is declared as int. Or can this be changed in the future?
> At least it is necessary to copy the value returned by ifl into the fl again after the call.
>  
> The next problem I'm having is that only squid -N works. As soon as I run it in the daemon mode (without -N) none of the workers is created. Could you please point me to the part of the code that is responsible for spawning workers?
>  

 src/ipc/* does most of the SMP related stuff. I was expecting issues
from UDS TypedMessage needing special Windows code to pass handles
between the processes.

It may also be related to the main.cc code forking initial daemon/worker.

Amos



From hack.back at hotmail.com  Sun Jan 25 04:02:56 2015
From: hack.back at hotmail.com (HackXBack)
Date: Sat, 24 Jan 2015 20:02:56 -0800 (PST)
Subject: [squid-users] FATAL: The ssl_crtd helpers are crashing too
 rapidly, need help!
In-Reply-To: <54C2884E.4000509@treenet.co.nz>
References: <1421929053162-4669257.post@n4.nabble.com>
 <1422034084407-4669297.post@n4.nabble.com> <54C2884E.4000509@treenet.co.nz>
Message-ID: <1422158576716-4669314.post@n4.nabble.com>

Dear Amos ,
how i can know why its dying in the first place? 
this is bug or what ?




--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/FATAL-The-ssl-crtd-helpers-are-crashing-too-rapidly-need-help-tp4669257p4669314.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From hack.back at hotmail.com  Sun Jan 25 04:03:51 2015
From: hack.back at hotmail.com (HackXBack)
Date: Sat, 24 Jan 2015 20:03:51 -0800 (PST)
Subject: [squid-users] need 206 to be 200
Message-ID: <1422158631442-4669315.post@n4.nabble.com>

hello,
i have specific site is tcp_miss 206 and i need it to be 200
what is the best way to do that ?
Thanks



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/need-206-to-be-200-tp4669315.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From squid3 at treenet.co.nz  Sun Jan 25 04:36:43 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 25 Jan 2015 17:36:43 +1300
Subject: [squid-users] need 206 to be 200
In-Reply-To: <1422158631442-4669315.post@n4.nabble.com>
References: <1422158631442-4669315.post@n4.nabble.com>
Message-ID: <54C472DB.6050806@treenet.co.nz>

On 25/01/2015 5:03 p.m., HackXBack wrote:
> hello,
> i have specific site is tcp_miss 206 and i need it to be 200
> what is the best way to do that ?

http://www.squid-cache.org/Doc/config/range_offset_limit/

Amos


From eliezer at ngtech.co.il  Sun Jan 25 05:50:01 2015
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Sun, 25 Jan 2015 07:50:01 +0200
Subject: [squid-users] Fwd: Squid 3.4.10 RPMs release for CentOS 32 and
 64 bit.
In-Reply-To: <CAOsHgtvDprbrRaHRzi2O9Sj_wT8asni7yNJiGJP8=bV50Ldm3w@mail.gmail.com>
References: <54885AAB.2000504@treenet.co.nz> <54B69BBC.8010606@ngtech.co.il>
 <CAOsHgtubTH5M_nPrf7OExxSE-To966v+pR1WZq2y1dsgatiRng@mail.gmail.com>
 <CAOsHgtvDprbrRaHRzi2O9Sj_wT8asni7yNJiGJP8=bV50Ldm3w@mail.gmail.com>
Message-ID: <54C48409.3080904@ngtech.co.il>

Hey Daniel,

If it was not mentioned anywhere else then this thread is the place:
CentOS 7 packages are in the Testing phase and will might not be stable 
enough for production.
If you may look at the RPMs my packaging of squid is a bit different 
then the mainstream.
One of the main differences is that the "squid" package contains only 
the CORE squid binaries configurations and docs.
All the non-CORE helpers are in the package "squid-helpers".
You will find ssl-crtd in squid-helpers package.
If you may wish to see the files inside each and every package you can 
use the command "rpm -qlp package_file_name.rpm".

Take your time to peek at the wiki page:
http://wiki.squid-cache.org/KnowledgeBase/CentOS

All The Bests,
Eliezer

On 25/01/2015 02:52, Daniel Greenwald wrote:
> Eliezer- I have installed the squid 3.5 on centos 7 from your repo, the
> version is:
> squid-3.5.0.4-1.el6.x86_64
>
> Problem is I am not finding ssl_crtd:
> find -name ssl_crtd
> returns nothing.
>
> But squid -v
> does show --enable-ssl-crtd
>
> Should I just build from source or am I missing something?
>
> Thanks!
>
> -----------
> Daniel I Greenwald




From marcus.kool at urlfilterdb.com  Sun Jan 25 10:43:25 2015
From: marcus.kool at urlfilterdb.com (Marcus Kool)
Date: Sun, 25 Jan 2015 08:43:25 -0200
Subject: [squid-users] tcp_outgoing_address and ICAP server
In-Reply-To: <54C445E2.7090606@treenet.co.nz>
References: <54C01610.2050609@urlfilterdb.com>
 <54C38CDC.6040904@treenet.co.nz> <54C40305.1090408@urlfilterdb.com>
 <54C445E2.7090606@treenet.co.nz>
Message-ID: <54C4C8CD.7010409@urlfilterdb.com>



On 01/24/2015 11:24 PM, Amos Jeffries wrote:
> On 25/01/2015 9:39 a.m., Marcus Kool wrote:
>>
>>
>> On 01/24/2015 10:15 AM, Amos Jeffries wrote:
>>> On 22/01/2015 10:11 a.m., Marcus Kool wrote:
>>>> I am using Squid 3.4.9 and have an issue with tcp_outgoing_address.
>>>>
>>>> The Squid server is connceted to the internet with multiple NICs and
>>>> uses
>>>>      tcp_outgoing_address a.public.IP.address
>>>>
>>>> and also want to use an ICAP server on the same host using
>>>>
>>>> icap_service  reqmod_urlfilterdb   reqmod_precache
>>>> icap://a.local.ip.address:1344/reqmod_icapd  bypass=off  routing=on
>>>> on-overload=wait ipv6=off
>>>>
>>>> It seems that Squid binds the connection to the ICAP server the same way
>>>> it binds
>>>> connections to webservers using the rule with tcp_outgoing_address
>>>> and that it not desired nor workable.
>>>>
>>>> I tried
>>>>
>>>> acl myicaphost dst a.local.ip.address
>>>> tcp_outgoing_address a.public.IP.address !myicaphost
>>>>
>>>> but Squid issues the following errors:
>>>> 2015/01/21 21:58:32 kid1| WARNING: myicaphost ACL is used in context
>>>> without an HTTP request. Assuming mismatch.
>>>> 2015/01/21 21:58:32 kid1| commBind: Cannot bind socket FD 10 to
>>>> XX.XX.XX.XX: (99) Cannot assign requested address
>>>> 2015/01/21 21:58:32 kid1| essential ICAP service is down after an
>>>> options fetch failure: icap://XX.XX.XX.XX:1344/reqmod_icapd [down,!opt]
>>>>
>>>> So the question is how to send web traffic over a specific NIC and
>>>> traffic to the ICAP server over an other (default?) NIC ?
>>>
>>>
>>> Please try the attached patch against Squid-3.4. It should make your
>>> config work.
>>>
>>> Amos
>>
>> Thank you for the patch.
>> It resolves 1 issue: there is no longer the warning
>>     WARNING: myicaphost ACL is used in context without an HTTP request.
>> Assuming mismatch.
>>
>> But the binding to the wrong NIC with the external IP still happens:
>>
>> 2015/01/24 17:19:48.027 kid1| Xaction.cc(133) openConnection:
>> Adaptation::Icap::OptXact opens connection to 10.10.0.6:1344
>> 2015/01/24 17:19:48.027 kid1| AsyncCall.cc(18) AsyncCall: The AsyncCall
>> Adaptation::Icap::Xaction::noteCommConnected constructed, this=0x1d9d7e0
>> [call53]
>> 2015/01/24 17:19:48.027 kid1| comm.cc(549) comm_openex: comm_openex:
>> Attempt open socket for: a.public.IP.address
>> 2015/01/24 17:19:48.027 kid1| comm.cc(590) comm_openex: comm_openex:
>> Opened socket local=a.public.IP.address remote=[::] FD 10 flags=1 :
>> family=2, type=1, protocol=6
>>
>> The firewall and routing was changed to allow traffic from the external
>> IP to
>> the internal IP so for us the urgency of the issue is low, but
>> the binding remains on the external IP despite the ACL saying not to do it.
>
> Aha, conceptual problem.
>
> tcp_outgoing_address does not forbid things. There is no "allow/deny"
> action, just a set-IP action. It either sets the IP or it leaves it alone.

Do you agree that the binding should not take place if a socket
is created with a destination address 'myicaphost' ?  The myicaphost is
10.10.0.6 and the comm debug output above shows that the socket *is* bound.

> Your rule sets the IP when the dst is non-myicaphost. So what
> tcp_outgoing_address rule or OS level routing rule matches when it *is*
> myicaphost?

Sorry, I don't know which routing decision is taken. All I know is that
the routing has been changed to make the connection to the ICAP server work.

I tried to show with the comm debug output that the connection to the
ICAP server (10.10.0.6) is still bound.  I replaced the public IP address
with "a.public.IP.address"  (I do not want to show the real IP but
it is definitely a public IP address).

> Amos

Thanks
Marcus





From squid3 at treenet.co.nz  Sun Jan 25 15:12:37 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 26 Jan 2015 04:12:37 +1300
Subject: [squid-users] tcp_outgoing_address and ICAP server
In-Reply-To: <54C4C8CD.7010409@urlfilterdb.com>
References: <54C01610.2050609@urlfilterdb.com>
 <54C38CDC.6040904@treenet.co.nz> <54C40305.1090408@urlfilterdb.com>
 <54C445E2.7090606@treenet.co.nz> <54C4C8CD.7010409@urlfilterdb.com>
Message-ID: <54C507E5.5050703@treenet.co.nz>

On 25/01/2015 11:43 p.m., Marcus Kool wrote:
> 
> 
> On 01/24/2015 11:24 PM, Amos Jeffries wrote:
>> On 25/01/2015 9:39 a.m., Marcus Kool wrote:
>>>
>>>
>>> On 01/24/2015 10:15 AM, Amos Jeffries wrote:
>>>> On 22/01/2015 10:11 a.m., Marcus Kool wrote:
>>>>> I am using Squid 3.4.9 and have an issue with tcp_outgoing_address.
>>>>>
>>>>> The Squid server is connceted to the internet with multiple NICs and
>>>>> uses
>>>>>      tcp_outgoing_address a.public.IP.address
>>>>>
>>>>> and also want to use an ICAP server on the same host using
>>>>>
>>>>> icap_service  reqmod_urlfilterdb   reqmod_precache
>>>>> icap://a.local.ip.address:1344/reqmod_icapd  bypass=off  routing=on
>>>>> on-overload=wait ipv6=off
>>>>>
>>>>> It seems that Squid binds the connection to the ICAP server the
>>>>> same way
>>>>> it binds
>>>>> connections to webservers using the rule with tcp_outgoing_address
>>>>> and that it not desired nor workable.
>>>>>
>>>>> I tried
>>>>>
>>>>> acl myicaphost dst a.local.ip.address
>>>>> tcp_outgoing_address a.public.IP.address !myicaphost
>>>>>
>>>>> but Squid issues the following errors:
>>>>> 2015/01/21 21:58:32 kid1| WARNING: myicaphost ACL is used in context
>>>>> without an HTTP request. Assuming mismatch.
>>>>> 2015/01/21 21:58:32 kid1| commBind: Cannot bind socket FD 10 to
>>>>> XX.XX.XX.XX: (99) Cannot assign requested address
>>>>> 2015/01/21 21:58:32 kid1| essential ICAP service is down after an
>>>>> options fetch failure: icap://XX.XX.XX.XX:1344/reqmod_icapd
>>>>> [down,!opt]
>>>>>
>>>>> So the question is how to send web traffic over a specific NIC and
>>>>> traffic to the ICAP server over an other (default?) NIC ?
>>>>
>>>>
>>>> Please try the attached patch against Squid-3.4. It should make your
>>>> config work.
>>>>
>>>> Amos
>>>
>>> Thank you for the patch.
>>> It resolves 1 issue: there is no longer the warning
>>>     WARNING: myicaphost ACL is used in context without an HTTP request.
>>> Assuming mismatch.
>>>
>>> But the binding to the wrong NIC with the external IP still happens:
>>>
>>> 2015/01/24 17:19:48.027 kid1| Xaction.cc(133) openConnection:
>>> Adaptation::Icap::OptXact opens connection to 10.10.0.6:1344
>>> 2015/01/24 17:19:48.027 kid1| AsyncCall.cc(18) AsyncCall: The AsyncCall
>>> Adaptation::Icap::Xaction::noteCommConnected constructed, this=0x1d9d7e0
>>> [call53]
>>> 2015/01/24 17:19:48.027 kid1| comm.cc(549) comm_openex: comm_openex:
>>> Attempt open socket for: a.public.IP.address
>>> 2015/01/24 17:19:48.027 kid1| comm.cc(590) comm_openex: comm_openex:
>>> Opened socket local=a.public.IP.address remote=[::] FD 10 flags=1 :
>>> family=2, type=1, protocol=6
>>>
>>> The firewall and routing was changed to allow traffic from the external
>>> IP to
>>> the internal IP so for us the urgency of the issue is low, but
>>> the binding remains on the external IP despite the ACL saying not to
>>> do it.
>>
>> Aha, conceptual problem.
>>
>> tcp_outgoing_address does not forbid things. There is no "allow/deny"
>> action, just a set-IP action. It either sets the IP or it leaves it
>> alone.
> 
> Do you agree that the binding should not take place if a socket
> is created with a destination address 'myicaphost' ?  The myicaphost is
> 10.10.0.6 and the comm debug output above shows that the socket *is* bound.

I cant agree because I dont know why it was binding. Squid only uses
bind() if there is an explicit outgoing address required to be used.


> 
>> Your rule sets the IP when the dst is non-myicaphost. So what
>> tcp_outgoing_address rule or OS level routing rule matches when it *is*
>> myicaphost?
> 
> Sorry, I don't know which routing decision is taken. All I know is that
> the routing has been changed to make the connection to the ICAP server
> work.
> 
> I tried to show with the comm debug output that the connection to the
> ICAP server (10.10.0.6) is still bound.  I replaced the public IP address
> with "a.public.IP.address"  (I do not want to show the real IP but
> it is definitely a public IP address).

That obfuscation is fine, as long as its clear which IP is which.

Perhapse a new debug trace after applying the patch will help resolve
what the remaining problem is?

Amos


From marcus.kool at urlfilterdb.com  Sun Jan 25 15:59:20 2015
From: marcus.kool at urlfilterdb.com (Marcus Kool)
Date: Sun, 25 Jan 2015 13:59:20 -0200
Subject: [squid-users] tcp_outgoing_address and ICAP server
In-Reply-To: <54C507E5.5050703@treenet.co.nz>
References: <54C01610.2050609@urlfilterdb.com>
 <54C38CDC.6040904@treenet.co.nz> <54C40305.1090408@urlfilterdb.com>
 <54C445E2.7090606@treenet.co.nz> <54C4C8CD.7010409@urlfilterdb.com>
 <54C507E5.5050703@treenet.co.nz>
Message-ID: <54C512D8.3060705@urlfilterdb.com>



On 01/25/2015 01:12 PM, Amos Jeffries wrote:
> On 25/01/2015 11:43 p.m., Marcus Kool wrote:
>>
>>
>> On 01/24/2015 11:24 PM, Amos Jeffries wrote:
>>> On 25/01/2015 9:39 a.m., Marcus Kool wrote:
>>>>
>>>>
>>>> On 01/24/2015 10:15 AM, Amos Jeffries wrote:
>>>>> On 22/01/2015 10:11 a.m., Marcus Kool wrote:
>>>>>> I am using Squid 3.4.9 and have an issue with tcp_outgoing_address.
>>>>>>
>>>>>> The Squid server is connceted to the internet with multiple NICs and
>>>>>> uses
>>>>>>       tcp_outgoing_address a.public.IP.address
>>>>>>
>>>>>> and also want to use an ICAP server on the same host using
>>>>>>
>>>>>> icap_service  reqmod_urlfilterdb   reqmod_precache
>>>>>> icap://a.local.ip.address:1344/reqmod_icapd  bypass=off  routing=on
>>>>>> on-overload=wait ipv6=off
>>>>>>
>>>>>> It seems that Squid binds the connection to the ICAP server the
>>>>>> same way
>>>>>> it binds
>>>>>> connections to webservers using the rule with tcp_outgoing_address
>>>>>> and that it not desired nor workable.
>>>>>>
>>>>>> I tried
>>>>>>
>>>>>> acl myicaphost dst a.local.ip.address
>>>>>> tcp_outgoing_address a.public.IP.address !myicaphost
>>>>>>
>>>>>> but Squid issues the following errors:
>>>>>> 2015/01/21 21:58:32 kid1| WARNING: myicaphost ACL is used in context
>>>>>> without an HTTP request. Assuming mismatch.
>>>>>> 2015/01/21 21:58:32 kid1| commBind: Cannot bind socket FD 10 to
>>>>>> XX.XX.XX.XX: (99) Cannot assign requested address
>>>>>> 2015/01/21 21:58:32 kid1| essential ICAP service is down after an
>>>>>> options fetch failure: icap://XX.XX.XX.XX:1344/reqmod_icapd
>>>>>> [down,!opt]
>>>>>>
>>>>>> So the question is how to send web traffic over a specific NIC and
>>>>>> traffic to the ICAP server over an other (default?) NIC ?
>>>>>
>>>>>
>>>>> Please try the attached patch against Squid-3.4. It should make your
>>>>> config work.
>>>>>
>>>>> Amos
>>>>
>>>> Thank you for the patch.
>>>> It resolves 1 issue: there is no longer the warning
>>>>      WARNING: myicaphost ACL is used in context without an HTTP request.
>>>> Assuming mismatch.
>>>>
>>>> But the binding to the wrong NIC with the external IP still happens:
>>>>
>>>> 2015/01/24 17:19:48.027 kid1| Xaction.cc(133) openConnection:
>>>> Adaptation::Icap::OptXact opens connection to 10.10.0.6:1344
>>>> 2015/01/24 17:19:48.027 kid1| AsyncCall.cc(18) AsyncCall: The AsyncCall
>>>> Adaptation::Icap::Xaction::noteCommConnected constructed, this=0x1d9d7e0
>>>> [call53]
>>>> 2015/01/24 17:19:48.027 kid1| comm.cc(549) comm_openex: comm_openex:
>>>> Attempt open socket for: a.public.IP.address
>>>> 2015/01/24 17:19:48.027 kid1| comm.cc(590) comm_openex: comm_openex:
>>>> Opened socket local=a.public.IP.address remote=[::] FD 10 flags=1 :
>>>> family=2, type=1, protocol=6
>>>>
>>>> The firewall and routing was changed to allow traffic from the external
>>>> IP to
>>>> the internal IP so for us the urgency of the issue is low, but
>>>> the binding remains on the external IP despite the ACL saying not to
>>>> do it.
>>>
>>> Aha, conceptual problem.
>>>
>>> tcp_outgoing_address does not forbid things. There is no "allow/deny"
>>> action, just a set-IP action. It either sets the IP or it leaves it
>>> alone.
>>
>> Do you agree that the binding should not take place if a socket
>> is created with a destination address 'myicaphost' ?  The myicaphost is
>> 10.10.0.6 and the comm debug output above shows that the socket *is* bound.
>
> I cant agree because I dont know why it was binding.



The debug trace starts with:
Xaction.cc(133) openConnection: *Adaptation::Icap::OptXact* opens connection to 10.10.0.6:1344
and then
comm.cc(549) comm_openex: comm_openex: Attempt open socket for: *a.public.IP.address*
comm.cc(590) comm_openex: comm_openex:Opened socket local=*a.public.IP.address* remote=[::] FD 10 flags=1 : family=2, type=1, protocol=6

so I think it is clear that the socket to the ICAP server on 10.10.0.6
is bound to the NIC with an external IP address (not obeying the ACL).

I do not understand your statement "I dont know why it was binding".

 > Squid only uses
 > bind() if there is an explicit outgoing address required to be used.

Have you considered the possibility of a bug ?

>>> Your rule sets the IP when the dst is non-myicaphost. So what
>>> tcp_outgoing_address rule or OS level routing rule matches when it *is*
>>> myicaphost?
>>
>> Sorry, I don't know which routing decision is taken. All I know is that
>> the routing has been changed to make the connection to the ICAP server
>> work.
>>
>> I tried to show with the comm debug output that the connection to the
>> ICAP server (10.10.0.6) is still bound.  I replaced the public IP address
>> with "a.public.IP.address"  (I do not want to show the real IP but
>> it is definitely a public IP address).
>
> That obfuscation is fine, as long as its clear which IP is which.
>
> Perhapse a new debug trace after applying the patch will help resolve
> what the remaining problem is?

The debug trace that I posted was after applying the patch.

Marcus

> Amos
>
>


From squid3 at treenet.co.nz  Sun Jan 25 16:33:07 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 26 Jan 2015 05:33:07 +1300
Subject: [squid-users] tcp_outgoing_address and ICAP server
In-Reply-To: <54C512D8.3060705@urlfilterdb.com>
References: <54C01610.2050609@urlfilterdb.com>
 <54C38CDC.6040904@treenet.co.nz> <54C40305.1090408@urlfilterdb.com>
 <54C445E2.7090606@treenet.co.nz> <54C4C8CD.7010409@urlfilterdb.com>
 <54C507E5.5050703@treenet.co.nz> <54C512D8.3060705@urlfilterdb.com>
Message-ID: <54C51AC3.4000008@treenet.co.nz>

On 26/01/2015 4:59 a.m., Marcus Kool wrote:
> 
> 
> The debug trace starts with:
> Xaction.cc(133) openConnection: *Adaptation::Icap::OptXact* opens
> connection to 10.10.0.6:1344
> and then
> comm.cc(549) comm_openex: comm_openex: Attempt open socket for:
> *a.public.IP.address*
> comm.cc(590) comm_openex: comm_openex:Opened socket
> local=*a.public.IP.address* remote=[::] FD 10 flags=1 : family=2,
> type=1, protocol=6
> 
> so I think it is clear that the socket to the ICAP server on 10.10.0.6
> is bound to the NIC with an external IP address (not obeying the ACL).
> 

Okay you need to expand that with debug level 28,3 to see what Squid is
doing with the ACLs.


> I do not understand your statement "I dont know why it was binding".
> 
>> Squid only uses
>> bind() if there is an explicit outgoing address required to be used.
> 
> Have you considered the possibility of a bug ?

Yes, a bug in the binding would report bind errors opening a socket for
local=[::]. A bug in the ICAP will depend on what the ACL behaviour is.

Amos



From hack.back at hotmail.com  Sun Jan 25 17:01:14 2015
From: hack.back at hotmail.com (HackXBack)
Date: Sun, 25 Jan 2015 09:01:14 -0800 (PST)
Subject: [squid-users] FATAL: The ssl_crtd helpers are crashing too
 rapidly, need help!
In-Reply-To: <1422158576716-4669314.post@n4.nabble.com>
References: <1421929053162-4669257.post@n4.nabble.com>
 <1422034084407-4669297.post@n4.nabble.com> <54C2884E.4000509@treenet.co.nz>
 <1422158576716-4669314.post@n4.nabble.com>
Message-ID: <1422205274028-4669322.post@n4.nabble.com>

no patch for this problem yet ?



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/FATAL-The-ssl-crtd-helpers-are-crashing-too-rapidly-need-help-tp4669257p4669322.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From yvoinov at gmail.com  Sun Jan 25 20:53:28 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 26 Jan 2015 02:53:28 +0600
Subject: [squid-users] FATAL: The ssl_crtd helpers are crashing too
 rapidly, need help!
In-Reply-To: <1422205274028-4669322.post@n4.nabble.com>
References: <1421929053162-4669257.post@n4.nabble.com>
 <1422034084407-4669297.post@n4.nabble.com> <54C2884E.4000509@treenet.co.nz>
 <1422158576716-4669314.post@n4.nabble.com>
 <1422205274028-4669322.post@n4.nabble.com>
Message-ID: <54C557C8.7040509@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
You have already opened a bug?

25.01.2015 23:01, HackXBack ?????:
> no patch for this problem yet ?
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/FATAL-The-ssl-crtd-helpers-are-crashing-too-rapidly-need-help-tp4669257p4669322.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUxVfHAAoJENNXIZxhPexG+hYH/iEhv8BBBn3hVFlfqz8v8u+U
Ml8324OgJvXtjUCoH3r448jLd1jUtQyCbJrN2f6/HE9uLu62R+IvPYJpB9m2vE1P
E8rLp2o2bakMNqRedtIqQJE05ePLAEC0CnsSIKBJp5D4jDxYlssoo+Zx7HCictdp
QOyRJ38JQg9/O9vxfitmxIRGKY9/M/6OByyf8ILWwn1osZPDNrOSSXK8uHz+LgoL
QGVL2IxlMFthJdSFB9mKnnRzGlyVJTm27NabHsUCsbWBY6dHnBrL5UvgRaw6o+2A
UQbmDcWaWqWSWcWBx13iiepPiOBEhdZR7yDtKo8l3wiSHMJwRilogRxT8YOe1bs=
=RWZG
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150126/ce699a57/attachment.htm>

From hack.back at hotmail.com  Sun Jan 25 23:09:33 2015
From: hack.back at hotmail.com (HackXBack)
Date: Sun, 25 Jan 2015 15:09:33 -0800 (PST)
Subject: [squid-users] FATAL: The ssl_crtd helpers are crashing too
 rapidly, need help!
In-Reply-To: <54C557C8.7040509@gmail.com>
References: <1421929053162-4669257.post@n4.nabble.com>
 <1422034084407-4669297.post@n4.nabble.com> <54C2884E.4000509@treenet.co.nz>
 <1422158576716-4669314.post@n4.nabble.com>
 <1422205274028-4669322.post@n4.nabble.com> <54C557C8.7040509@gmail.com>
Message-ID: <1422227373827-4669324.post@n4.nabble.com>

Dear Yuri,
how I open bug ?



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/FATAL-The-ssl-crtd-helpers-are-crashing-too-rapidly-need-help-tp4669257p4669324.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From marcus.kool at urlfilterdb.com  Mon Jan 26 00:45:16 2015
From: marcus.kool at urlfilterdb.com (Marcus Kool)
Date: Sun, 25 Jan 2015 22:45:16 -0200
Subject: [squid-users] tcp_outgoing_address and ICAP server
In-Reply-To: <54C51AC3.4000008@treenet.co.nz>
References: <54C01610.2050609@urlfilterdb.com>
 <54C38CDC.6040904@treenet.co.nz> <54C40305.1090408@urlfilterdb.com>
 <54C445E2.7090606@treenet.co.nz> <54C4C8CD.7010409@urlfilterdb.com>
 <54C507E5.5050703@treenet.co.nz> <54C512D8.3060705@urlfilterdb.com>
 <54C51AC3.4000008@treenet.co.nz>
Message-ID: <54C58E1C.5060500@urlfilterdb.com>



On 01/25/2015 02:33 PM, Amos Jeffries wrote:
> On 26/01/2015 4:59 a.m., Marcus Kool wrote:
>>
>>
>> The debug trace starts with:
>> Xaction.cc(133) openConnection: *Adaptation::Icap::OptXact* opens
>> connection to 10.10.0.6:1344
>> and then
>> comm.cc(549) comm_openex: comm_openex: Attempt open socket for:
>> *a.public.IP.address*
>> comm.cc(590) comm_openex: comm_openex:Opened socket
>> local=*a.public.IP.address* remote=[::] FD 10 flags=1 : family=2,
>> type=1, protocol=6
>>
>> so I think it is clear that the socket to the ICAP server on 10.10.0.6
>> is bound to the NIC with an external IP address (not obeying the ACL).
>>
>
> Okay you need to expand that with debug level 28,3 to see what Squid is
> doing with the ACLs.

well, I edited squid.conf again to extend the debug_options and
noticed that the config file had this:

tcp_outgoing_address a.public.ip.address
... (many lines)
acl myicaphost dst 10.10.0.6
tcp_outgoing_address a.public.ip.address !myicaphost

After commenting out the first tcp_outgoing_address, the binding works as expected,
i.e. squid does not bind the socket to the ICAP server on the external IP address.

So the ACL patch + correction of the squid.conf resolve the issue.

Thanks
Marcus


>> I do not understand your statement "I dont know why it was binding".
>>
>>> Squid only uses
>>> bind() if there is an explicit outgoing address required to be used.
>>
>> Have you considered the possibility of a bug ?
>
> Yes, a bug in the binding would report bind errors opening a socket for
> local=[::]. A bug in the ICAP will depend on what the ACL behaviour is.
>
> Amos
>
>
>


From dig at digcorp.net  Mon Jan 26 04:39:57 2015
From: dig at digcorp.net (Daniel Greenwald)
Date: Sun, 25 Jan 2015 23:39:57 -0500
Subject: [squid-users] Why 3.5.0.4 generates mimicked certs with server
 IP only when bumping?
In-Reply-To: <54B0313D.5070500@gmail.com>
References: <54AF92FD.3050702@gmail.com> <54AFB042.4000509@treenet.co.nz>
 <54AFB156.5030502@gmail.com> <54AFB416.1040500@treenet.co.nz>
 <54B0313D.5070500@gmail.com>
Message-ID: <CAOsHgtuqa9RKPHegP03HEh+Ys+Ur422tSG7ScwXmuWm8qOCQvw@mail.gmail.com>

Thank you Amos,
Based on your explanation I was able to make bumping work for transparent
with no browser errors in 3.5.1 by using the following. If I understand
correctly, this is actually whats required to mimic the behavior of pre 3.5
(sslbump server-first all) :

acl step1 at_step SslBump1
acl step2 at_step SslBump2
ssl_bump peek step1 all
ssl_bump server-first step2 all

Hope that helps Yuri or any one else with this issue.

PS So far this is working great for eg gmail.com which in previous version
would throw browser errors!

-----------
Daniel I Greenwald



On Fri, Jan 9, 2015 at 2:51 PM, Yuri Voinov <yvoinov at gmail.com> wrote:

>
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> How can that be?
>
> All HSTS sites cry with 3.5 bump option - they don't like host IP as CN,
> other sites behaviour depending they (and browsers) settings.
>
> Is it possible to keep server-first behaviour in 3.5.x ?
>
> WBR, Yuri
>
> 09.01.2015 16:57, Amos Jeffries ?????:
> > On 9/01/2015 11:45 p.m., Yuri Voinov wrote:
> >
> > > I have working production 3.4.10 with working ssl bumping.
> >
> > > Config was the same as working 3.4.10. I've just want to take a
> > > look on new release.
> >
> > > in squid.documented said, than backward compatibility server-first
> > > and none options for ssl_bump are kept.
> >
> > > But:
> >
> > > Neither works with old syntax, nor new.
> >
> > > Looks like target https hosts not resolved and bump got only IP.
> >
> > The config values are still accepted, but there is an extra bumping
> > stage now before the SNI is available.
> >
> > You are wanting to peek at stage 1 (to get the client SNI details) and
> > server-first/splice at stage 2 (using the domain). Otherwise All Squid
> > works with when intercepting are the TCP IPs.
> >
> > Amos
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2
>
> iQEcBAEBAgAGBQJUsDE9AAoJENNXIZxhPexGl+MH/2wEV5rEDSb6eQ5KRbHI8ZJ4
> WV0fdTg7yFR+bfWCUYzjVovQhrx0gaIFLNWvuwDbc62zJJnvADQuAzu7chouafkP
> wpGuBjjp3jYZWa1TlZN4XoDeK2THswXau/5kY9P7IKKAJu9VjhjII803ywn5C8DW
> 48NQWU0Uhs86Tr6XAuaRzUYZK6lht0VcJFKiftmKmOE7Rl7+Yy/Kak1zXxLh8mzX
> a8N0DSsSlBqIm7s8yngwWQuf8rQ0tlwrKWNSpCL3xD6Wk0MFwhRqe6Vbncj4sbff
> p0OifMf0YD5sbytsUq4OO5HOdO7WPu+foB2AMKSiou5cDMqz5Vcnw0mD35t25Fg=
> =OEZu
> -----END PGP SIGNATURE-----
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150125/ca8ee6de/attachment.htm>

From dig at digcorp.net  Mon Jan 26 04:45:26 2015
From: dig at digcorp.net (Daniel Greenwald)
Date: Sun, 25 Jan 2015 23:45:26 -0500
Subject: [squid-users] Fwd: Squid 3.4.10 RPMs release for CentOS 32 and
	64 bit.
In-Reply-To: <54C48409.3080904@ngtech.co.il>
References: <54885AAB.2000504@treenet.co.nz> <54B69BBC.8010606@ngtech.co.il>
 <CAOsHgtubTH5M_nPrf7OExxSE-To966v+pR1WZq2y1dsgatiRng@mail.gmail.com>
 <CAOsHgtvDprbrRaHRzi2O9Sj_wT8asni7yNJiGJP8=bV50Ldm3w@mail.gmail.com>
 <54C48409.3080904@ngtech.co.il>
Message-ID: <CAOsHgttXyPrDwnRXmKuQLzNiLk389HwV0aiV+h6w7iRtwmvtMA@mail.gmail.com>

Eliezer-

Thanks for clarifying I had read about your different packages but didn't
realize that ssl_crtd would be part of helpers. I ended up compiling from
source and it wasn't as scary as I expected :)
I used your compile options by copying squid -v output from the package.
Here are the steps I took to compile 3.5.1 on Centos 7 in case it helps
someone else.

yum install gcc-c++ openssl-devel libxml2-devel libcap-devel
libtool-ltdl-devel perl gcc autoconf automake make sudo wget

tar xzf squid..

./configure '--build=x86_64-redhat-linux-gnu'
'--host=x86_64-redhat-linux-gnu' '--target=x86_64-redhat-linux-gnu'
'--program-prefix=' '--prefix=/usr' '--exec-prefix=/usr'
'--bindir=/usr/bin' '--sbindir=/usr/sbin' '--sysconfdir=/etc'
'--datadir=/usr/share' '--includedir=/usr/include' '--libdir=/usr/lib64'
'--libexecdir=/usr/libexec' '--sharedstatedir=/var/lib'
'--mandir=/usr/share/man' '--infodir=/usr/share/info' '--exec_prefix=/usr'
'--libexecdir=/usr/lib64/squid' '--localstatedir=/var'
'--datadir=/usr/share/squid' '--sysconfdir=/etc/squid'
'--with-logdir=$(localstatedir)/log/squid'
'--with-pidfile=$(localstatedir)/run/squid.pid'
'--disable-dependency-tracking' '--enable-follow-x-forwarded-for'
'--enable-auth'
'--enable-auth-basic=DB,LDAP,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB,getpwnam'
'--enable-auth-ntlm=smb_lm,fake'
'--enable-auth-digest=file,LDAP,eDirectory'
'--enable-auth-negotiate=kerberos,wrapper'
'--enable-external-acl-helpers=wbinfo_group,kerberos_ldap_group,AD_group'
'--enable-cache-digests' '--enable-cachemgr-hostname=localhost'
'--enable-delay-pools' '--enable-epoll' '--enable-icap-client'
'--enable-ident-lookups' '--enable-linux-netfilter'
'--enable-removal-policies=heap,lru' '--enable-snmp'
'--enable-storeio=aufs,diskd,ufs,rock' '--enable-wccpv2' '--enable-esi'
'--enable-ssl' '--enable-ssl-crtd' '--enable-icmp' '--with-aio'
'--with-default-user=squid' '--with-filedescriptors=16384' '--with-dl'
'--with-openssl' '--with-pthreads' '--with-included-ltdl'
'--disable-arch-native' '--without-nettle'
'build_alias=x86_64-redhat-linux-gnu' 'host_alias=x86_64-redhat-linux-gnu'
'target_alias=x86_64-redhat-linux-gnu' 'CFLAGS=-O2 -g -pipe -Wall
-Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
--param=ssp-buffer-size=4 -m64 -mtune=generic' 'CXXFLAGS=-O2 -g -pipe -Wall
-Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
--param=ssp-buffer-size=4 -m64 -mtune=generic -fPIC'
'PKG_CONFIG_PATH=/usr/lib64/pkgconfig:/usr/share/pkgconfig'
--enable-ltdl-convenience

make
make install



-----------
Daniel I Greenwald



On Sun, Jan 25, 2015 at 12:50 AM, Eliezer Croitoru <eliezer at ngtech.co.il>
wrote:

> Hey Daniel,
>
> If it was not mentioned anywhere else then this thread is the place:
> CentOS 7 packages are in the Testing phase and will might not be stable
> enough for production.
> If you may look at the RPMs my packaging of squid is a bit different then
> the mainstream.
> One of the main differences is that the "squid" package contains only the
> CORE squid binaries configurations and docs.
> All the non-CORE helpers are in the package "squid-helpers".
> You will find ssl-crtd in squid-helpers package.
> If you may wish to see the files inside each and every package you can use
> the command "rpm -qlp package_file_name.rpm".
>
> Take your time to peek at the wiki page:
> http://wiki.squid-cache.org/KnowledgeBase/CentOS
>
> All The Bests,
> Eliezer
>
> On 25/01/2015 02:52, Daniel Greenwald wrote:
>
>> Eliezer- I have installed the squid 3.5 on centos 7 from your repo, the
>> version is:
>> squid-3.5.0.4-1.el6.x86_64
>>
>> Problem is I am not finding ssl_crtd:
>> find -name ssl_crtd
>> returns nothing.
>>
>> But squid -v
>> does show --enable-ssl-crtd
>>
>> Should I just build from source or am I missing something?
>>
>> Thanks!
>>
>> -----------
>> Daniel I Greenwald
>>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150125/ab4c004e/attachment.htm>

From squid3 at treenet.co.nz  Mon Jan 26 05:40:19 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 26 Jan 2015 18:40:19 +1300
Subject: [squid-users] FATAL: The ssl_crtd helpers are crashing too
 rapidly, need help!
In-Reply-To: <1422227373827-4669324.post@n4.nabble.com>
References: <1421929053162-4669257.post@n4.nabble.com>
 <1422034084407-4669297.post@n4.nabble.com> <54C2884E.4000509@treenet.co.nz>
 <1422158576716-4669314.post@n4.nabble.com>
 <1422205274028-4669322.post@n4.nabble.com> <54C557C8.7040509@gmail.com>
 <1422227373827-4669324.post@n4.nabble.com>
Message-ID: <54C5D343.4070503@treenet.co.nz>

On 26/01/2015 12:09 p.m., HackXBack wrote:
> Dear Yuri,
> how I open bug ?

<http://wiki.squid-cache.org/SquidFaq/BugReporting>

Note that it requires "A clear description of the bug symptoms."

Your symptoms of "helpers crashing" and "It works if I delete the DB
every 24hrs" are not clear. Particularly when many others have been
using the helper fine.


Does the patch from <http://bugs.squid-cache.org/show_bug.cgi?id=3743>
make errors start showing up from the helper?


Alternatively please try running the helper manually at teh time when
Squid is complaining and see what happens. The command line -d option
outputs debug messages. Just starting the helper seems to be where Squid
is having problems.

If the above does not find anything, perhapse adding -d to the
sslcrtd_program parameters will show what Squid sees:
<http://www.squid-cache.org/Doc/config/sslcrtd_program/>

Amos



From rafael.akchurin at diladele.com  Mon Jan 26 08:28:22 2015
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Mon, 26 Jan 2015 08:28:22 +0000
Subject: [squid-users] Why 3.5.0.4 generates mimicked certs with server
 IP only when bumping?
In-Reply-To: <CAOsHgtuqa9RKPHegP03HEh+Ys+Ur422tSG7ScwXmuWm8qOCQvw@mail.gmail.com>
References: <54AF92FD.3050702@gmail.com> <54AFB042.4000509@treenet.co.nz>
 <54AFB156.5030502@gmail.com> <54AFB416.1040500@treenet.co.nz>
 <54B0313D.5070500@gmail.com>,
 <CAOsHgtuqa9RKPHegP03HEh+Ys+Ur422tSG7ScwXmuWm8qOCQvw@mail.gmail.com>
Message-ID: <1422260905864.73930@diladele.com>

Hello Daniel, Yuri


May be you could dump your whole squid.conf here (please remove any sensitive details).

I still cannot understand once Squid has the target server hostname from SNI - where is the acl/rule in squid.conf that can be used with this info present?


Best regards,

Rafael


________________________________
From: squid-users <squid-users-bounces at lists.squid-cache.org> on behalf of Daniel Greenwald <dig at digcorp.net>
Sent: Monday, January 26, 2015 5:39 AM
To: Yuri Voinov
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Why 3.5.0.4 generates mimicked certs with server IP only when bumping?

Thank you Amos,
Based on your explanation I was able to make bumping work for transparent with no browser errors in 3.5.1 by using the following. If I understand correctly, this is actually whats required to mimic the behavior of pre 3.5 (sslbump server-first all) :

acl step1 at_step SslBump1
acl step2 at_step SslBump2
ssl_bump peek step1 all
ssl_bump server-first step2 all

Hope that helps Yuri or any one else with this issue.

PS So far this is working great for eg gmail.com<http://gmail.com> which in previous version would throw browser errors!

-----------
Daniel I Greenwald



On Fri, Jan 9, 2015 at 2:51 PM, Yuri Voinov <yvoinov at gmail.com<mailto:yvoinov at gmail.com>> wrote:

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

How can that be?

All HSTS sites cry with 3.5 bump option - they don't like host IP as CN,
other sites behaviour depending they (and browsers) settings.

Is it possible to keep server-first behaviour in 3.5.x ?

WBR, Yuri

09.01.2015 16:57, Amos Jeffries ?????:
> On 9/01/2015 11:45 p.m., Yuri Voinov wrote:
>
> > I have working production 3.4.10 with working ssl bumping.
>
> > Config was the same as working 3.4.10. I've just want to take a
> > look on new release.
>
> > in squid.documented said, than backward compatibility server-first
> > and none options for ssl_bump are kept.
>
> > But:
>
> > Neither works with old syntax, nor new.
>
> > Looks like target https hosts not resolved and bump got only IP.
>
> The config values are still accepted, but there is an extra bumping
> stage now before the SNI is available.
>
> You are wanting to peek at stage 1 (to get the client SNI details) and
> server-first/splice at stage 2 (using the domain). Otherwise All Squid
> works with when intercepting are the TCP IPs.
>
> Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2

iQEcBAEBAgAGBQJUsDE9AAoJENNXIZxhPexGl+MH/2wEV5rEDSb6eQ5KRbHI8ZJ4
WV0fdTg7yFR+bfWCUYzjVovQhrx0gaIFLNWvuwDbc62zJJnvADQuAzu7chouafkP
wpGuBjjp3jYZWa1TlZN4XoDeK2THswXau/5kY9P7IKKAJu9VjhjII803ywn5C8DW
48NQWU0Uhs86Tr6XAuaRzUYZK6lht0VcJFKiftmKmOE7Rl7+Yy/Kak1zXxLh8mzX
a8N0DSsSlBqIm7s8yngwWQuf8rQ0tlwrKWNSpCL3xD6Wk0MFwhRqe6Vbncj4sbff
p0OifMf0YD5sbytsUq4OO5HOdO7WPu+foB2AMKSiou5cDMqz5Vcnw0mD35t25Fg=
=OEZu
-----END PGP SIGNATURE-----

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org<mailto:squid-users at lists.squid-cache.org>
http://lists.squid-cache.org/listinfo/squid-users

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150126/3ff64c62/attachment.htm>

From hack.back at hotmail.com  Mon Jan 26 12:38:46 2015
From: hack.back at hotmail.com (HackXBack)
Date: Mon, 26 Jan 2015 04:38:46 -0800 (PST)
Subject: [squid-users] need 206 to be 200
In-Reply-To: <54C472DB.6050806@treenet.co.nz>
References: <1422158631442-4669315.post@n4.nabble.com>
 <54C472DB.6050806@treenet.co.nz>
Message-ID: <1422275926375-4669330.post@n4.nabble.com>

I always see in access.log for the partial content
TCP_HIT_ABORTED/206 
and this content eat my whole bandwidth

my conf is

range_offset_limit none partial
quick_abort_min 1840 KB
quick_abort_max 1844 KB



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/need-206-to-be-200-tp4669315p4669330.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From squid3 at treenet.co.nz  Mon Jan 26 13:01:45 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 27 Jan 2015 02:01:45 +1300
Subject: [squid-users] need 206 to be 200
In-Reply-To: <1422275926375-4669330.post@n4.nabble.com>
References: <1422158631442-4669315.post@n4.nabble.com>
 <54C472DB.6050806@treenet.co.nz> <1422275926375-4669330.post@n4.nabble.com>
Message-ID: <54C63AB9.1070800@treenet.co.nz>

On 27/01/2015 1:38 a.m., HackXBack wrote:
> I always see in access.log for the partial content
> TCP_HIT_ABORTED/206 

ABORTED means the client disconnected. There is nothing you can do about
that in Squid.

HIT means the object delivered came from cache. No upstream bandwidth
was consumed in the process.

> and this content eat my whole bandwidth

The 206 means client is fetching a range of data out of a larger object.
Turning that into a 200 (full-object) delivered to client will only
spend more bandwidth.

> 
> my conf is
> 
> range_offset_limit none partial
> quick_abort_min 1840 KB
> quick_abort_max 1844 KB
> 

These are all controlling Squid contact with servers. Limiting upstream
bandwidth expenditure when the client aborts. Which is useful for
TCP_MISS_ABORTED/206 cases.

Since your log says HIT, the only thing you could do in Squid is
completely reject these clients requests.

Amos



From dig at digcorp.net  Mon Jan 26 13:37:48 2015
From: dig at digcorp.net (Daniel Greenwald)
Date: Mon, 26 Jan 2015 08:37:48 -0500
Subject: [squid-users] Why 3.5.0.4 generates mimicked certs with server
 IP only when bumping?
In-Reply-To: <1422260905864.73930@diladele.com>
References: <54AF92FD.3050702@gmail.com> <54AFB042.4000509@treenet.co.nz>
 <54AFB156.5030502@gmail.com> <54AFB416.1040500@treenet.co.nz>
 <54B0313D.5070500@gmail.com>
 <CAOsHgtuqa9RKPHegP03HEh+Ys+Ur422tSG7ScwXmuWm8qOCQvw@mail.gmail.com>
 <1422260905864.73930@diladele.com>
Message-ID: <CAOsHgtsf6j=gtASvmCFVUwko66OXxd=RGOYuAa3cozgks9LiAA@mail.gmail.com>

See below. Nothing else too interesting. Those four lines were the key.

http_port 3128
http_port 3180 intercept
https_port 3443 intercept ssl-bump generate-host-certificates=on
dynamic_cert_mem_cache_size=16MB  cert=/usr/local/squid/ssl_cert/myCA.pem
sslcrtd_program /usr/lib64/squid/ssl_crtd -s
/usr/local/squid/var/lib/ssl_db -M 16MB
sslcrtd_children 10
logformat dig %{%Y-%m-%d %H:%M:%S}tl  %6tr %>a %Ss/%03>Hs %<st %rm %ru %un
%Sh/%<A "%{User-Agent}>h"
logfile_rotate 10
access_log /var/log/squid/access.log dig
pinger_enable off

acl step1 at_step SslBump1
acl step2 at_step SslBump2
ssl_bump peek step1 all
ssl_bump server-first step2 all

acl SSL_ports port 443
acl Safe_ports port 80 443
acl CONNECT method CONNECT
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

http_access allow localhost manager
http_access deny manager
http_access deny to_localhost

http_access allow all
http_access deny all

# Uncomment and adjust the following to add a disk cache directory.
#cache_dir ufs /var/spool/squid 100 16 256

# Leave coredumps in the first cache dir
coredump_dir /var/spool/squid

#
# Add any of your own refresh_pattern entries above these.
#
refresh_pattern ^ftp:        1440    20%    10080
refresh_pattern ^gopher:    1440    0%    1440
refresh_pattern -i (/cgi-bin/|\?) 0    0%    0
refresh_pattern .        0    20%    4320





-----------
Daniel I Greenwald



On Mon, Jan 26, 2015 at 3:28 AM, Rafael Akchurin <
rafael.akchurin at diladele.com> wrote:

>  Hello Daniel, Yuri
>
>
>  May be you could dump your whole squid.conf here (please remove any
> sensitive details).
>
> I still cannot understand once Squid has the target server hostname from
> SNI - where is the acl/rule in squid.conf that can be used with this info
> present?
>
>
>  Best regards,
>
> Rafael
>
>
>  ------------------------------
> *From:* squid-users <squid-users-bounces at lists.squid-cache.org> on behalf
> of Daniel Greenwald <dig at digcorp.net>
> *Sent:* Monday, January 26, 2015 5:39 AM
> *To:* Yuri Voinov
> *Cc:* squid-users at lists.squid-cache.org
> *Subject:* Re: [squid-users] Why 3.5.0.4 generates mimicked certs with
> server IP only when bumping?
>
>   Thank you Amos,
>  Based on your explanation I was able to make bumping work for transparent
> with no browser errors in 3.5.1 by using the following. If I understand
> correctly, this is actually whats required to mimic the behavior of pre 3.5
> (sslbump server-first all) :
>
> acl step1 at_step SslBump1
> acl step2 at_step SslBump2
> ssl_bump peek step1 all
> ssl_bump server-first step2 all
>
>  Hope that helps Yuri or any one else with this issue.
>
> PS So far this is working great for eg gmail.com which in previous
> version would throw browser errors!
>
>  -----------
> Daniel I Greenwald
>
>
>
> On Fri, Jan 9, 2015 at 2:51 PM, Yuri Voinov <yvoinov at gmail.com> wrote:
>
>>
>> -----BEGIN PGP SIGNED MESSAGE-----
>> Hash: SHA1
>>
>> How can that be?
>>
>> All HSTS sites cry with 3.5 bump option - they don't like host IP as CN,
>> other sites behaviour depending they (and browsers) settings.
>>
>> Is it possible to keep server-first behaviour in 3.5.x ?
>>
>> WBR, Yuri
>>
>> 09.01.2015 16:57, Amos Jeffries ?????:
>> > On 9/01/2015 11:45 p.m., Yuri Voinov wrote:
>> >
>> > > I have working production 3.4.10 with working ssl bumping.
>> >
>> > > Config was the same as working 3.4.10. I've just want to take a
>> > > look on new release.
>> >
>> > > in squid.documented said, than backward compatibility server-first
>> > > and none options for ssl_bump are kept.
>> >
>> > > But:
>> >
>> > > Neither works with old syntax, nor new.
>> >
>> > > Looks like target https hosts not resolved and bump got only IP.
>> >
>> > The config values are still accepted, but there is an extra bumping
>> > stage now before the SNI is available.
>> >
>> > You are wanting to peek at stage 1 (to get the client SNI details) and
>> > server-first/splice at stage 2 (using the domain). Otherwise All Squid
>> > works with when intercepting are the TCP IPs.
>> >
>> > Amos
>> -----BEGIN PGP SIGNATURE-----
>> Version: GnuPG v2
>>
>> iQEcBAEBAgAGBQJUsDE9AAoJENNXIZxhPexGl+MH/2wEV5rEDSb6eQ5KRbHI8ZJ4
>> WV0fdTg7yFR+bfWCUYzjVovQhrx0gaIFLNWvuwDbc62zJJnvADQuAzu7chouafkP
>> wpGuBjjp3jYZWa1TlZN4XoDeK2THswXau/5kY9P7IKKAJu9VjhjII803ywn5C8DW
>> 48NQWU0Uhs86Tr6XAuaRzUYZK6lht0VcJFKiftmKmOE7Rl7+Yy/Kak1zXxLh8mzX
>> a8N0DSsSlBqIm7s8yngwWQuf8rQ0tlwrKWNSpCL3xD6Wk0MFwhRqe6Vbncj4sbff
>> p0OifMf0YD5sbytsUq4OO5HOdO7WPu+foB2AMKSiou5cDMqz5Vcnw0mD35t25Fg=
>> =OEZu
>>  -----END PGP SIGNATURE-----
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150126/a541d383/attachment.htm>

From yvoinov at gmail.com  Mon Jan 26 14:02:22 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 26 Jan 2015 20:02:22 +0600
Subject: [squid-users] Why 3.5.0.4 generates mimicked certs with server
 IP only when bumping?
In-Reply-To: <CAOsHgtsf6j=gtASvmCFVUwko66OXxd=RGOYuAa3cozgks9LiAA@mail.gmail.com>
References: <54AF92FD.3050702@gmail.com> <54AFB042.4000509@treenet.co.nz>
 <54AFB156.5030502@gmail.com> <54AFB416.1040500@treenet.co.nz>
 <54B0313D.5070500@gmail.com>
 <CAOsHgtuqa9RKPHegP03HEh+Ys+Ur422tSG7ScwXmuWm8qOCQvw@mail.gmail.com>
 <1422260905864.73930@diladele.com>
 <CAOsHgtsf6j=gtASvmCFVUwko66OXxd=RGOYuAa3cozgks9LiAA@mail.gmail.com>
Message-ID: <54C648EE.4020402@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Raf,

wil be better to take a look on Squid source. My config similar
Daniel's, excluding bump options - I have 3.4.11 in production yet.

26.01.2015 19:37, Daniel Greenwald ?????:
> See below. Nothing else too interesting. Those four lines were the key.
>
> http_port 3128
> http_port 3180 intercept
> https_port 3443 intercept ssl-bump generate-host-certificates=on
dynamic_cert_mem_cache_size=16MB  cert=/usr/local/squid/ssl_cert/myCA.pem
> sslcrtd_program /usr/lib64/squid/ssl_crtd -s
/usr/local/squid/var/lib/ssl_db -M 16MB
> sslcrtd_children 10
> logformat dig %{%Y-%m-%d %H:%M:%S}tl  %6tr %>a %Ss/%03>Hs %<st %rm %ru
%un %Sh/%<A "%{User-Agent}>h"
> logfile_rotate 10
> access_log /var/log/squid/access.log dig
> pinger_enable off
>
> acl step1 at_step SslBump1
> acl step2 at_step SslBump2
> ssl_bump peek step1 all
> ssl_bump server-first step2 all
>
> acl SSL_ports port 443
> acl Safe_ports port 80 443 
> acl CONNECT method CONNECT
> http_access deny !Safe_ports
> http_access deny CONNECT !SSL_ports
>
> http_access allow localhost manager
> http_access deny manager
> http_access deny to_localhost
>
> http_access allow all
> http_access deny all
>
> # Uncomment and adjust the following to add a disk cache directory.
> #cache_dir ufs /var/spool/squid 100 16 256
>
> # Leave coredumps in the first cache dir
> coredump_dir /var/spool/squid
>
> #
> # Add any of your own refresh_pattern entries above these.
> #
> refresh_pattern ^ftp:        1440    20%    10080
> refresh_pattern ^gopher:    1440    0%    1440
> refresh_pattern -i (/cgi-bin/|\?) 0    0%    0
> refresh_pattern .        0    20%    4320
>
>
>
>
>
> -----------
> Daniel I Greenwald
>
>
>
> On Mon, Jan 26, 2015 at 3:28 AM, Rafael Akchurin
<rafael.akchurin at diladele.com <mailto:rafael.akchurin at diladele.com>> wrote:
>
>     Hello Daniel, Yuri
>
>
>     May be you could dump your whole squid.conf here (please remove
any sensitive details).
>
>     I still cannot understand once Squid has the target server
hostname from SNI - where is the acl/rule in squid.conf that can be used
with this info present?
>
>
>     Best regards,
>
>     Rafael
>
>
>     -------------------------
>     *From:* squid-users <squid-users-bounces at lists.squid-cache.org
<mailto:squid-users-bounces at lists.squid-cache.org>> on behalf of Daniel
Greenwald <dig at digcorp.net <mailto:dig at digcorp.net>>
>     *Sent:* Monday, January 26, 2015 5:39 AM
>     *To:* Yuri Voinov
>     *Cc:* squid-users at lists.squid-cache.org
<mailto:squid-users at lists.squid-cache.org>
>     *Subject:* Re: [squid-users] Why 3.5.0.4 generates mimicked certs
with server IP only when bumping?
>     
>     Thank you Amos,
>     Based on your explanation I was able to make bumping work for
transparent with no browser errors in 3.5.1 by using the following. If I
understand correctly, this is actually whats required to mimic the
behavior of pre 3.5 (sslbump server-first all) :
>
>     acl step1 at_step SslBump1
>     acl step2 at_step SslBump2
>     ssl_bump peek step1 all
>     ssl_bump server-first step2 all
>
>     Hope that helps Yuri or any one else with this issue.
>
>     PS So far this is working great for eg gmail.com
<http://gmail.com> which in previous version would throw browser errors!
>
>     -----------
>     Daniel I Greenwald
>
>
>
>     On Fri, Jan 9, 2015 at 2:51 PM, Yuri Voinov <yvoinov at gmail.com
<mailto:yvoinov at gmail.com>> wrote:
>
>
> How can that be?
>
> All HSTS sites cry with 3.5 bump option - they don't like host IP as CN,
> other sites behaviour depending they (and browsers) settings.
>
> Is it possible to keep server-first behaviour in 3.5.x ?
>
> WBR, Yuri
>
> 09.01.2015 16:57, Amos Jeffries ?????:
> > On 9/01/2015 11:45 p.m., Yuri Voinov wrote:
>
> > > I have working production 3.4.10 with working ssl bumping.
>
> > > Config was the same as working 3.4.10. I've just want to take a
> > > look on new release.
>
> > > in squid.documented said, than backward compatibility server-first
> > > and none options for ssl_bump are kept.
>
> > > But:
>
> > > Neither works with old syntax, nor new.
>
> > > Looks like target https hosts not resolved and bump got only IP.
>
> > The config values are still accepted, but there is an extra bumping
> > stage now before the SNI is available.
>
> > You are wanting to peek at stage 1 (to get the client SNI details) and
> > server-first/splice at stage 2 (using the domain). Otherwise All Squid
> > works with when intercepting are the TCP IPs.
>
> > Amos
>
>         _______________________________________________
>         squid-users mailing list
>         squid-users at lists.squid-cache.org
<mailto:squid-users at lists.squid-cache.org>
>         http://lists.squid-cache.org/listinfo/squid-users
>
>
>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUxkjtAAoJENNXIZxhPexGMv0IAKRe+oFmx+gpwwVQLja5iV0p
y0R/G6umiDx8P+frRn6TBZUmhFv9U0yBwjMFyl7NjFfQ4Oef6U4S+A90CdnPYbBO
rNSc9IfBh58ggBBVNJmZQR7jeb7/dJT8WAqTMW2481+Wh99TZIxEW8v8nfio2klP
HGdZpmpOVl7+4TQpG3Z+ssPXU+zFAWZ2QhUFmCyD29hey4Y0vcmxXUmJMapiz2Fh
CkRE0XA3TPtOwddbtPSShnBUsoo0GgBL/Pt2FD6s3DhZIltXl253b5YjK89TJkOR
fE/EYkVFxRvBr7ILyYR+kBtKyQUmnZHQJE9cGtkJ1/R2jWpj2v5Cs/4iWQx3mLg=
=6WHJ
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150126/77fd321d/attachment.htm>

From yvoinov at gmail.com  Mon Jan 26 15:44:21 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 26 Jan 2015 21:44:21 +0600
Subject: [squid-users] FATAL: The ssl_crtd helpers are crashing too
 rapidly, need help!
In-Reply-To: <1422227373827-4669324.post@n4.nabble.com>
References: <1421929053162-4669257.post@n4.nabble.com>
 <1422034084407-4669297.post@n4.nabble.com> <54C2884E.4000509@treenet.co.nz>
 <1422158576716-4669314.post@n4.nabble.com>
 <1422205274028-4669322.post@n4.nabble.com> <54C557C8.7040509@gmail.com>
 <1422227373827-4669324.post@n4.nabble.com>
Message-ID: <54C660D5.3000509@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
http://bugs.squid-cache.org/index.cgi

26.01.2015 5:09, HackXBack ?????:
> Dear Yuri,
> how I open bug ?
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/FATAL-The-ssl-crtd-helpers-are-crashing-too-rapidly-need-help-tp4669257p4669324.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUxmDVAAoJENNXIZxhPexGxqwH/1WujvC6hcw0P8SA3kDp9CfD
4PUyWKS270mrAMKYxUjLp6OmQ66vvPPwGUg+F3GaYB2fFRzxwivkkUbVXSqhxUaA
CwR2sTCuPCKGqLkLxXFD5TLZsNFzooildmDqXEkzLN4f41UEUwtbxGpUXR7xB2CT
J994oqfPWtips6AlRXJJaG0osJjVVW4Ldi85inxDir8tzDvZRaReSVIO2yNRkyD5
lGUsaQnbzTJIHT5IinuF8KW1i+SFrIkRRGqO+WoX+p44ZcWiLff68nKSmjKXYvko
bizK+nuxvmGJwv1Zg/mdG/BQcm1gLRn+WUSFSdwG/+WHG248sQSTU8UoHwuBdO0=
=JQin
-----END PGP SIGNATURE-----



From yvoinov at gmail.com  Mon Jan 26 15:51:23 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 26 Jan 2015 21:51:23 +0600
Subject: [squid-users] Why 3.5.0.4 generates mimicked certs with server
 IP only when bumping?
In-Reply-To: <CAOsHgtsf6j=gtASvmCFVUwko66OXxd=RGOYuAa3cozgks9LiAA@mail.gmail.com>
References: <54AF92FD.3050702@gmail.com> <54AFB042.4000509@treenet.co.nz>
 <54AFB156.5030502@gmail.com> <54AFB416.1040500@treenet.co.nz>
 <54B0313D.5070500@gmail.com>
 <CAOsHgtuqa9RKPHegP03HEh+Ys+Ur422tSG7ScwXmuWm8qOCQvw@mail.gmail.com>
 <1422260905864.73930@diladele.com>
 <CAOsHgtsf6j=gtASvmCFVUwko66OXxd=RGOYuAa3cozgks9LiAA@mail.gmail.com>
Message-ID: <54C6627B.7080903@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Daniel,

well,

but AFAIK server-first directive is deprecated in 3.5.x.

Hmmmmmm?

26.01.2015 19:37, Daniel Greenwald ?????:
> See below. Nothing else too interesting. Those four lines were the key.
>
> http_port 3128
> http_port 3180 intercept
> https_port 3443 intercept ssl-bump generate-host-certificates=on
dynamic_cert_mem_cache_size=16MB  cert=/usr/local/squid/ssl_cert/myCA.pem
> sslcrtd_program /usr/lib64/squid/ssl_crtd -s
/usr/local/squid/var/lib/ssl_db -M 16MB
> sslcrtd_children 10
> logformat dig %{%Y-%m-%d %H:%M:%S}tl  %6tr %>a %Ss/%03>Hs %<st %rm %ru
%un %Sh/%<A "%{User-Agent}>h"
> logfile_rotate 10
> access_log /var/log/squid/access.log dig
> pinger_enable off
>
> acl step1 at_step SslBump1
> acl step2 at_step SslBump2
> ssl_bump peek step1 all
> ssl_bump server-first step2 all
>
> acl SSL_ports port 443
> acl Safe_ports port 80 443 
> acl CONNECT method CONNECT
> http_access deny !Safe_ports
> http_access deny CONNECT !SSL_ports
>
> http_access allow localhost manager
> http_access deny manager
> http_access deny to_localhost
>
> http_access allow all
> http_access deny all
>
> # Uncomment and adjust the following to add a disk cache directory.
> #cache_dir ufs /var/spool/squid 100 16 256
>
> # Leave coredumps in the first cache dir
> coredump_dir /var/spool/squid
>
> #
> # Add any of your own refresh_pattern entries above these.
> #
> refresh_pattern ^ftp:        1440    20%    10080
> refresh_pattern ^gopher:    1440    0%    1440
> refresh_pattern -i (/cgi-bin/|\?) 0    0%    0
> refresh_pattern .        0    20%    4320
>
>
>
>
>
> -----------
> Daniel I Greenwald
>
>
>
> On Mon, Jan 26, 2015 at 3:28 AM, Rafael Akchurin
<rafael.akchurin at diladele.com <mailto:rafael.akchurin at diladele.com>> wrote:
>
>     Hello Daniel, Yuri
>
>
>     May be you could dump your whole squid.conf here (please remove
any sensitive details).
>
>     I still cannot understand once Squid has the target server
hostname from SNI - where is the acl/rule in squid.conf that can be used
with this info present?
>
>
>     Best regards,
>
>     Rafael
>
>
>     -------------------------
>     *From:* squid-users <squid-users-bounces at lists.squid-cache.org
<mailto:squid-users-bounces at lists.squid-cache.org>> on behalf of Daniel
Greenwald <dig at digcorp.net <mailto:dig at digcorp.net>>
>     *Sent:* Monday, January 26, 2015 5:39 AM
>     *To:* Yuri Voinov
>     *Cc:* squid-users at lists.squid-cache.org
<mailto:squid-users at lists.squid-cache.org>
>     *Subject:* Re: [squid-users] Why 3.5.0.4 generates mimicked certs
with server IP only when bumping?
>     
>     Thank you Amos,
>     Based on your explanation I was able to make bumping work for
transparent with no browser errors in 3.5.1 by using the following. If I
understand correctly, this is actually whats required to mimic the
behavior of pre 3.5 (sslbump server-first all) :
>
>     acl step1 at_step SslBump1
>     acl step2 at_step SslBump2
>     ssl_bump peek step1 all
>     ssl_bump server-first step2 all
>
>     Hope that helps Yuri or any one else with this issue.
>
>     PS So far this is working great for eg gmail.com
<http://gmail.com> which in previous version would throw browser errors!
>
>     -----------
>     Daniel I Greenwald
>
>
>
>     On Fri, Jan 9, 2015 at 2:51 PM, Yuri Voinov <yvoinov at gmail.com
<mailto:yvoinov at gmail.com>> wrote:
>
>
> How can that be?
>
> All HSTS sites cry with 3.5 bump option - they don't like host IP as CN,
> other sites behaviour depending they (and browsers) settings.
>
> Is it possible to keep server-first behaviour in 3.5.x ?
>
> WBR, Yuri
>
> 09.01.2015 16:57, Amos Jeffries ?????:
> > On 9/01/2015 11:45 p.m., Yuri Voinov wrote:
>
> > > I have working production 3.4.10 with working ssl bumping.
>
> > > Config was the same as working 3.4.10. I've just want to take a
> > > look on new release.
>
> > > in squid.documented said, than backward compatibility server-first
> > > and none options for ssl_bump are kept.
>
> > > But:
>
> > > Neither works with old syntax, nor new.
>
> > > Looks like target https hosts not resolved and bump got only IP.
>
> > The config values are still accepted, but there is an extra bumping
> > stage now before the SNI is available.
>
> > You are wanting to peek at stage 1 (to get the client SNI details) and
> > server-first/splice at stage 2 (using the domain). Otherwise All Squid
> > works with when intercepting are the TCP IPs.
>
> > Amos
>
>         _______________________________________________
>         squid-users mailing list
>         squid-users at lists.squid-cache.org
<mailto:squid-users at lists.squid-cache.org>
>         http://lists.squid-cache.org/listinfo/squid-users
>
>
>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUxmJ7AAoJENNXIZxhPexG/cEIAMm+urebQJM9//zH0ZPdqVDY
SztxbkYnHFU/3oI/Ox6CwBtn7SpvOiZn5fuk+IcKhntmF4a1iIF+jgFJkDexYGJQ
2/orRca1Ud4qExfDwEukEPUh+/4ccIB5mwmpDXRsBqbFsQMdIJeRstSrGeCTmomK
ry8m7KIX+aKb8VS6T9qyBAAoHFHs7Bffy9beJA6e7Tm52tmG/WuLc5hpzKrWYX+w
hAw3NIU8N+z0Gn2hsKphp0tpeO8r/DIUhPRmSqBNUnktzrzJmonsMD4///uCgBwr
D3yYfsiwXjo3cK1rvcCQTQj7VwUtpkZZUasr0n6LamcO/YahFFAwCgG+cm4oPXM=
=LzfY
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150126/4fb44b42/attachment.htm>

From dig at digcorp.net  Mon Jan 26 16:14:37 2015
From: dig at digcorp.net (Daniel Greenwald)
Date: Mon, 26 Jan 2015 11:14:37 -0500
Subject: [squid-users] Why 3.5.0.4 generates mimicked certs with server
 IP only when bumping?
In-Reply-To: <54C6627B.7080903@gmail.com>
References: <54AF92FD.3050702@gmail.com> <54AFB042.4000509@treenet.co.nz>
 <54AFB156.5030502@gmail.com> <54AFB416.1040500@treenet.co.nz>
 <54B0313D.5070500@gmail.com>
 <CAOsHgtuqa9RKPHegP03HEh+Ys+Ur422tSG7ScwXmuWm8qOCQvw@mail.gmail.com>
 <1422260905864.73930@diladele.com>
 <CAOsHgtsf6j=gtASvmCFVUwko66OXxd=RGOYuAa3cozgks9LiAA@mail.gmail.com>
 <54C6627B.7080903@gmail.com>
Message-ID: <CAOsHgttwr=JCj0rCOLeB3dwSk=RmU_ir_A5055q1nci5cv71Tg@mail.gmail.com>

call it what you want, it works :)

-----------
Daniel I Greenwald



On Mon, Jan 26, 2015 at 10:51 AM, Yuri Voinov <yvoinov at gmail.com> wrote:

>
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Daniel,
>
> well,
>
> but AFAIK server-first directive is deprecated in 3.5.x.
>
> Hmmmmmm?
>
> 26.01.2015 19:37, Daniel Greenwald ?????:
> > See below. Nothing else too interesting. Those four lines were the key.
> >
> > http_port 3128
> > http_port 3180 intercept
> > https_port 3443 intercept ssl-bump generate-host-certificates=on
> dynamic_cert_mem_cache_size=16MB  cert=/usr/local/squid/ssl_cert/myCA.pem
> > sslcrtd_program /usr/lib64/squid/ssl_crtd -s
> /usr/local/squid/var/lib/ssl_db -M 16MB
> > sslcrtd_children 10
> > logformat dig %{%Y-%m-%d %H:%M:%S}tl  %6tr %>a %Ss/%03>Hs %<st %rm %ru
> %un %Sh/%<A "%{User-Agent}>h"
> > logfile_rotate 10
> > access_log /var/log/squid/access.log dig
> > pinger_enable off
> >
> > acl step1 at_step SslBump1
> > acl step2 at_step SslBump2
> > ssl_bump peek step1 all
> > ssl_bump server-first step2 all
> >
> > acl SSL_ports port 443
> > acl Safe_ports port 80 443
> > acl CONNECT method CONNECT
> > http_access deny !Safe_ports
> > http_access deny CONNECT !SSL_ports
> >
> > http_access allow localhost manager
> > http_access deny manager
> > http_access deny to_localhost
> >
> > http_access allow all
> > http_access deny all
> >
> > # Uncomment and adjust the following to add a disk cache directory.
> > #cache_dir ufs /var/spool/squid 100 16 256
> >
> > # Leave coredumps in the first cache dir
> > coredump_dir /var/spool/squid
> >
> > #
> > # Add any of your own refresh_pattern entries above these.
> > #
> > refresh_pattern ^ftp:        1440    20%    10080
> > refresh_pattern ^gopher:    1440    0%    1440
> > refresh_pattern -i (/cgi-bin/|\?) 0    0%    0
> > refresh_pattern .        0    20%    4320
> >
> >
> >
> >
> >
> > -----------
> > Daniel I Greenwald
> >
> >
> >
> > On Mon, Jan 26, 2015 at 3:28 AM, Rafael Akchurin <
> rafael.akchurin at diladele.com <mailto:rafael.akchurin at diladele.com>
> <rafael.akchurin at diladele.com>> wrote:
> >
> >     Hello Daniel, Yuri
> >
> >
> >     May be you could dump your whole squid.conf here (please remove any
> sensitive details).
> >
> >     I still cannot understand once Squid has the target server hostname
> from SNI - where is the acl/rule in squid.conf that can be used with this
> info present?
> >
> >
> >     Best regards,
> >
> >     Rafael
> >
> >
> >     -------------------------
> >     *From:* squid-users <squid-users-bounces at lists.squid-cache.org
> <mailto:squid-users-bounces at lists.squid-cache.org>
> <squid-users-bounces at lists.squid-cache.org>> on behalf of Daniel
> Greenwald <dig at digcorp.net <mailto:dig at digcorp.net> <dig at digcorp.net>>
> >     *Sent:* Monday, January 26, 2015 5:39 AM
> >     *To:* Yuri Voinov
> >     *Cc:* squid-users at lists.squid-cache.org
> <mailto:squid-users at lists.squid-cache.org>
> <squid-users at lists.squid-cache.org>
> >     *Subject:* Re: [squid-users] Why 3.5.0.4 generates mimicked certs
> with server IP only when bumping?
> >
> >     Thank you Amos,
> >     Based on your explanation I was able to make bumping work for
> transparent with no browser errors in 3.5.1 by using the following. If I
> understand correctly, this is actually whats required to mimic the behavior
> of pre 3.5 (sslbump server-first all) :
> >
> >     acl step1 at_step SslBump1
> >     acl step2 at_step SslBump2
> >     ssl_bump peek step1 all
> >     ssl_bump server-first step2 all
> >
> >     Hope that helps Yuri or any one else with this issue.
> >
> >     PS So far this is working great for eg gmail.com <http://gmail.com>
> <http://gmail.com> which in previous version would throw browser errors!
> >
> >     -----------
> >     Daniel I Greenwald
> >
> >
> >
> >     On Fri, Jan 9, 2015 at 2:51 PM, Yuri Voinov <yvoinov at gmail.com
> <mailto:yvoinov at gmail.com> <yvoinov at gmail.com>> wrote:
> >
> >
> > How can that be?
> >
> > All HSTS sites cry with 3.5 bump option - they don't like host IP as CN,
> > other sites behaviour depending they (and browsers) settings.
> >
> > Is it possible to keep server-first behaviour in 3.5.x ?
> >
> > WBR, Yuri
> >
> > 09.01.2015 16:57, Amos Jeffries ?????:
> > > On 9/01/2015 11:45 p.m., Yuri Voinov wrote:
> >
> > > > I have working production 3.4.10 with working ssl bumping.
> >
> > > > Config was the same as working 3.4.10. I've just want to take a
> > > > look on new release.
> >
> > > > in squid.documented said, than backward compatibility server-first
> > > > and none options for ssl_bump are kept.
> >
> > > > But:
> >
> > > > Neither works with old syntax, nor new.
> >
> > > > Looks like target https hosts not resolved and bump got only IP.
> >
> > > The config values are still accepted, but there is an extra bumping
> > > stage now before the SNI is available.
> >
> > > You are wanting to peek at stage 1 (to get the client SNI details) and
> > > server-first/splice at stage 2 (using the domain). Otherwise All Squid
> > > works with when intercepting are the TCP IPs.
> >
> > > Amos
> >
> >         _______________________________________________
> >         squid-users mailing list
> >         squid-users at lists.squid-cache.org
> <mailto:squid-users at lists.squid-cache.org>
> <squid-users at lists.squid-cache.org>
> >         http://lists.squid-cache.org/listinfo/squid-users
> >
> >
> >
>
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2
>
> iQEcBAEBAgAGBQJUxmJ7AAoJENNXIZxhPexG/cEIAMm+urebQJM9//zH0ZPdqVDY
> SztxbkYnHFU/3oI/Ox6CwBtn7SpvOiZn5fuk+IcKhntmF4a1iIF+jgFJkDexYGJQ
> 2/orRca1Ud4qExfDwEukEPUh+/4ccIB5mwmpDXRsBqbFsQMdIJeRstSrGeCTmomK
> ry8m7KIX+aKb8VS6T9qyBAAoHFHs7Bffy9beJA6e7Tm52tmG/WuLc5hpzKrWYX+w
> hAw3NIU8N+z0Gn2hsKphp0tpeO8r/DIUhPRmSqBNUnktzrzJmonsMD4///uCgBwr
> D3yYfsiwXjo3cK1rvcCQTQj7VwUtpkZZUasr0n6LamcO/YahFFAwCgG+cm4oPXM=
> =LzfY
> -----END PGP SIGNATURE-----
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150126/6235846e/attachment.htm>

From yvoinov at gmail.com  Mon Jan 26 16:37:19 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 26 Jan 2015 22:37:19 +0600
Subject: [squid-users] Why 3.5.0.4 generates mimicked certs with server
 IP only when bumping?
In-Reply-To: <CAOsHgttwr=JCj0rCOLeB3dwSk=RmU_ir_A5055q1nci5cv71Tg@mail.gmail.com>
References: <54AF92FD.3050702@gmail.com> <54AFB042.4000509@treenet.co.nz>
 <54AFB156.5030502@gmail.com> <54AFB416.1040500@treenet.co.nz>
 <54B0313D.5070500@gmail.com>
 <CAOsHgtuqa9RKPHegP03HEh+Ys+Ur422tSG7ScwXmuWm8qOCQvw@mail.gmail.com>
 <1422260905864.73930@diladele.com>
 <CAOsHgtsf6j=gtASvmCFVUwko66OXxd=RGOYuAa3cozgks9LiAA@mail.gmail.com>
 <54C6627B.7080903@gmail.com>
 <CAOsHgttwr=JCj0rCOLeB3dwSk=RmU_ir_A5055q1nci5cv71Tg@mail.gmail.com>
Message-ID: <54C66D3F.9010300@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
I'm not about it.

server-first keyword deprecated in 3.5.x.

AFAIK, keywork "bump" now has yet another meaningful.

And also: in your example can only use acl "all". Any other ACL's
leading "Bungled config line" error.

I.e, for example,

acl net_bump acl net_bump src 192.168.101.0/24
ssl_bump peek step1 net_bump
ssl_bump server-first step2 net_bump

breaks configuration.

26.01.2015 22:14, Daniel Greenwald ?????:
> call it what you want, it works :)
>
> -----------
> Daniel I Greenwald
>
>
>
> On Mon, Jan 26, 2015 at 10:51 AM, Yuri Voinov <yvoinov at gmail.com
<mailto:yvoinov at gmail.com>> wrote:
>
>
> Daniel,
>
> well,
>
> but AFAIK server-first directive is deprecated in 3.5.x.
>
> Hmmmmmm?
>
> 26.01.2015 19:37, Daniel Greenwald ?????:
> > See below. Nothing else too interesting. Those four lines were the key.
>
> > http_port 3128
> > http_port 3180 intercept
> > https_port 3443 intercept ssl-bump generate-host-certificates=on
dynamic_cert_mem_cache_size=16MB  cert=/usr/local/squid/ssl_cert/myCA.pem
> > sslcrtd_program /usr/lib64/squid/ssl_crtd -s
/usr/local/squid/var/lib/ssl_db -M 16MB
> > sslcrtd_children 10
> > logformat dig %{%Y-%m-%d %H:%M:%S}tl  %6tr %>a %Ss/%03>Hs %<st %rm
%ru %un %Sh/%<A "%{User-Agent}>h"
> > logfile_rotate 10
> > access_log /var/log/squid/access.log dig
> > pinger_enable off
>
> > acl step1 at_step SslBump1
> > acl step2 at_step SslBump2
> > ssl_bump peek step1 all
> > ssl_bump server-first step2 all
>
> > acl SSL_ports port 443
> > acl Safe_ports port 80 443
> > acl CONNECT method CONNECT
> > http_access deny !Safe_ports
> > http_access deny CONNECT !SSL_ports
>
> > http_access allow localhost manager
> > http_access deny manager
> > http_access deny to_localhost
>
> > http_access allow all
> > http_access deny all
>
> > # Uncomment and adjust the following to add a disk cache directory.
> > #cache_dir ufs /var/spool/squid 100 16 256
>
> > # Leave coredumps in the first cache dir
> > coredump_dir /var/spool/squid
>
> > #
> > # Add any of your own refresh_pattern entries above these.
> > #
> > refresh_pattern ^ftp:        1440    20%    10080
> > refresh_pattern ^gopher:    1440    0%    1440
> > refresh_pattern -i (/cgi-bin/|\?) 0    0%    0
> > refresh_pattern .        0    20%    4320
>
>
>
>
>
> > -----------
> > Daniel I Greenwald
>
>
>
> > On Mon, Jan 26, 2015 at 3:28 AM, Rafael Akchurin
<rafael.akchurin at diladele.com <mailto:rafael.akchurin at diladele.com>
<mailto:rafael.akchurin at diladele.com>
<mailto:rafael.akchurin at diladele.com>> wrote:
>
> >     Hello Daniel, Yuri
>
>
> >     May be you could dump your whole squid.conf here (please remove
any sensitive details).
>
> >     I still cannot understand once Squid has the target server
hostname from SNI - where is the acl/rule in squid.conf that can be used
with this info present?
>
>
> >     Best regards,
>
> >     Rafael
>
>
> >     -------------------------
> >     *From:* squid-users <squid-users-bounces at lists.squid-cache.org
<mailto:squid-users-bounces at lists.squid-cache.org>
<mailto:squid-users-bounces at lists.squid-cache.org>
<mailto:squid-users-bounces at lists.squid-cache.org>> on behalf of Daniel
Greenwald <dig at digcorp.net <mailto:dig at digcorp.net>
<mailto:dig at digcorp.net> <mailto:dig at digcorp.net>>
> >     *Sent:* Monday, January 26, 2015 5:39 AM
> >     *To:* Yuri Voinov
> >     *Cc:* squid-users at lists.squid-cache.org
<mailto:squid-users at lists.squid-cache.org>
<mailto:squid-users at lists.squid-cache.org>
<mailto:squid-users at lists.squid-cache.org>
> >     *Subject:* Re: [squid-users] Why 3.5.0.4 generates mimicked
certs with server IP only when bumping?
>
> >     Thank you Amos,
> >     Based on your explanation I was able to make bumping work for
transparent with no browser errors in 3.5.1 by using the following. If I
understand correctly, this is actually whats required to mimic the
behavior of pre 3.5 (sslbump server-first all) :
>
> >     acl step1 at_step SslBump1
> >     acl step2 at_step SslBump2
> >     ssl_bump peek step1 all
> >     ssl_bump server-first step2 all
>
> >     Hope that helps Yuri or any one else with this issue.
>
> >     PS So far this is working great for eg gmail.com
<http://gmail.com> <http://gmail.com> <http://gmail.com> which in
previous version would throw browser errors!
>
> >     -----------
> >     Daniel I Greenwald
>
>
>
> >     On Fri, Jan 9, 2015 at 2:51 PM, Yuri Voinov <yvoinov at gmail.com
<mailto:yvoinov at gmail.com> <mailto:yvoinov at gmail.com>
<mailto:yvoinov at gmail.com>> wrote:
>
>
> > How can that be?
>
> > All HSTS sites cry with 3.5 bump option - they don't like host IP as CN,
> > other sites behaviour depending they (and browsers) settings.
>
> > Is it possible to keep server-first behaviour in 3.5.x ?
>
> > WBR, Yuri
>
> > 09.01.2015 16:57, Amos Jeffries ?????:
> > > On 9/01/2015 11:45 p.m., Yuri Voinov wrote:
>
> > > > I have working production 3.4.10 with working ssl bumping.
>
> > > > Config was the same as working 3.4.10. I've just want to take a
> > > > look on new release.
>
> > > > in squid.documented said, than backward compatibility server-first
> > > > and none options for ssl_bump are kept.
>
> > > > But:
>
> > > > Neither works with old syntax, nor new.
>
> > > > Looks like target https hosts not resolved and bump got only IP.
>
> > > The config values are still accepted, but there is an extra bumping
> > > stage now before the SNI is available.
>
> > > You are wanting to peek at stage 1 (to get the client SNI details) and
> > > server-first/splice at stage 2 (using the domain). Otherwise All Squid
> > > works with when intercepting are the TCP IPs.
>
> > > Amos
>
> >         _______________________________________________
> >         squid-users mailing list
> >         squid-users at lists.squid-cache.org
<mailto:squid-users at lists.squid-cache.org>
<mailto:squid-users at lists.squid-cache.org>
<mailto:squid-users at lists.squid-cache.org>
> >         http://lists.squid-cache.org/listinfo/squid-users
>
>
>
>
>
>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUxm0+AAoJENNXIZxhPexGmocH/A/s1Ly6roeR2bjqQ38qVKpK
tg77sdsdA+nreX1xJZR1MXqEtBsVpHB/StesAKz5Qnxs9pD2oqtE7HtNVfzJ+1+J
uGjtAUZxXS1A128nTDdg3LlSI+AhRaR6RFzaAkk8U75cG4osphvOx5ksns0OznkF
bY7dFZN6veFhKf73S+2DDQ30WLBppmJPUicBTfJ5+kqCs5z66WHikUiDUE2rb9yu
Rr9P+YdHONFNnhT1f4YXbpDLS4uV9E83rR60nM88ygIg2J5VzdOmlxRoDpGA6Ko8
TsQJ9FQjfvmUrv5+60sYxoLxdGTIUCAPaeW03ybj/hLos9Mgph/4aWTgKcmG238=
=/uNz
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150126/272bb0dd/attachment.htm>

From yvoinov at gmail.com  Mon Jan 26 17:22:45 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 26 Jan 2015 23:22:45 +0600
Subject: [squid-users] Error negotiating SSL connection on FD 20:
 error:00000000:lib(0):func(0):reason(0) (5/-1/131)
Message-ID: <54C677E5.3050400@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Hi gents,

who know, what this log messages mean:

2015/01/26 22:02:34 kid1| fwdNegotiateSSL: Error negotiating SSL
connection on FD 20: error:00000000:lib(0):func(0):reason(0) (5/-1/131)
2015/01/26 22:02:41 kid1| fwdNegotiateSSL: Error negotiating SSL
connection on FD 20: error:00000000:lib(0):func(0):reason(0) (5/-1/131)
2015/01/26 22:02:45 kid1| fwdNegotiateSSL: Error negotiating SSL
connection on FD 20: error:00000000:lib(0):func(0):reason(0) (5/-1/131)
2015/01/26 22:02:48 kid1| fwdNegotiateSSL: Error negotiating SSL
connection on FD 20: error:00000000:lib(0):func(0):reason(0) (5/-1/131)
2015/01/26 22:02:55 kid1| fwdNegotiateSSL: Error negotiating SSL
connection on FD 20: error:00000000:lib(0):func(0):reason(0) (5/-1/131)
2015/01/26 22:03:02 kid1| fwdNegotiateSSL: Error negotiating SSL
connection on FD 20: error:00000000:lib(0):func(0):reason(0) (5/-1/131)
2015/01/26 22:03:06 kid1| fwdNegotiateSSL: Error negotiating SSL
connection on FD 20: error:00000000:lib(0):func(0):reason(0) (5/-1/131)
2015/01/26 22:03:12 kid1| fwdNegotiateSSL: Error negotiating SSL
connection on FD 20: error:00000000:lib(0):func(0):reason(0) (5/-1/131)

?

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUxnflAAoJENNXIZxhPexGam8IAJGcIZcuiXgnWgc7pxwH8Y6a
gCI8Q3Y8eUET1aRRyP07ZnZ+yxetksmFrpGdFZ6AahWbP7oF9USNme+HDLUyVSLL
yJ5UKVK4xBH82K7DQ7uKMt3riANVV6U4DK0rbYxL4oNyLBfDmbxoyBBoIIY045PT
oo1KT5O0hICR7Xam7f2FjPWM5xc3dQAdjSG6JIAmwK3rg5COKb+DtokVICzyU0wp
oypUZyRdJgwZiCPfEiI/hVXcktxtpAR8mLIkmP40MUBj5RqmIX3P9UttiPO5GrvS
yi/CiZnqWPEInv2UBrRj6H5tr2Nm2HGPnobtcdSAXDFbG5OBKfDmaGDtNt2eQug=
=DTZv
-----END PGP SIGNATURE-----



From squid3 at treenet.co.nz  Mon Jan 26 17:33:08 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 27 Jan 2015 06:33:08 +1300
Subject: [squid-users] Why 3.5.0.4 generates mimicked certs with server
 IP only when bumping?
In-Reply-To: <54C66D3F.9010300@gmail.com>
References: <54AF92FD.3050702@gmail.com> <54AFB042.4000509@treenet.co.nz>
 <54AFB156.5030502@gmail.com> <54AFB416.1040500@treenet.co.nz>
 <54B0313D.5070500@gmail.com>
 <CAOsHgtuqa9RKPHegP03HEh+Ys+Ur422tSG7ScwXmuWm8qOCQvw@mail.gmail.com>
 <1422260905864.73930@diladele.com>
 <CAOsHgtsf6j=gtASvmCFVUwko66OXxd=RGOYuAa3cozgks9LiAA@mail.gmail.com>
 <54C6627B.7080903@gmail.com>
 <CAOsHgttwr=JCj0rCOLeB3dwSk=RmU_ir_A5055q1nci5cv71Tg@mail.gmail.com>
 <54C66D3F.9010300@gmail.com>
Message-ID: <54C67A54.8090306@treenet.co.nz>

On 27/01/2015 5:37 a.m., Yuri Voinov wrote:
> 
> I'm not about it.
> 
> server-first keyword deprecated in 3.5.x.
> 
> AFAIK, keywork "bump" now has yet another meaningful.
> 
> And also: in your example can only use acl "all". Any other ACL's
> leading "Bungled config line" error.
> 
> I.e, for example,
> 
> acl net_bump acl net_bump src 192.168.101.0/24

You sure the bungled is not about the previous line?

"acl net_bump acl ..." no such ACL type as "acl".


> ssl_bump peek step1 net_bump
> ssl_bump server-first step2 net_bump
> 

And yes you are right that is deprecated. It should be "bump" as the action.

Amos


From yvoinov at gmail.com  Mon Jan 26 17:35:09 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 26 Jan 2015 23:35:09 +0600
Subject: [squid-users] Why 3.5.0.4 generates mimicked certs with server
 IP only when bumping?
In-Reply-To: <54C67A54.8090306@treenet.co.nz>
References: <54AF92FD.3050702@gmail.com> <54AFB042.4000509@treenet.co.nz>
 <54AFB156.5030502@gmail.com> <54AFB416.1040500@treenet.co.nz>
 <54B0313D.5070500@gmail.com>
 <CAOsHgtuqa9RKPHegP03HEh+Ys+Ur422tSG7ScwXmuWm8qOCQvw@mail.gmail.com>
 <1422260905864.73930@diladele.com>
 <CAOsHgtsf6j=gtASvmCFVUwko66OXxd=RGOYuAa3cozgks9LiAA@mail.gmail.com>
 <54C6627B.7080903@gmail.com>
 <CAOsHgttwr=JCj0rCOLeB3dwSk=RmU_ir_A5055q1nci5cv71Tg@mail.gmail.com>
 <54C66D3F.9010300@gmail.com> <54C67A54.8090306@treenet.co.nz>
Message-ID: <54C67ACD.8000809@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
It's mistype. :)

Of course, I mean

acl net_bump src 192.168.101.0/24


Yep, sure - when I change "all" to another ACL - row bungled.


26.01.2015 23:33, Amos Jeffries ?????:
> On 27/01/2015 5:37 a.m., Yuri Voinov wrote:
>>
>> I'm not about it.
>>
>> server-first keyword deprecated in 3.5.x.
>>
>> AFAIK, keywork "bump" now has yet another meaningful.
>>
>> And also: in your example can only use acl "all". Any other ACL's
>> leading "Bungled config line" error.
>>
>> I.e, for example,
>>
>> acl net_bump acl net_bump src 192.168.101.0/24
>
> You sure the bungled is not about the previous line?
>
> "acl net_bump acl ..." no such ACL type as "acl".
>
>
>> ssl_bump peek step1 net_bump
>> ssl_bump server-first step2 net_bump
>>
>
> And yes you are right that is deprecated. It should be "bump" as the
action.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUxnrNAAoJENNXIZxhPexGbtgH/AlBia1J2rX2htD3znXOA9Cb
i2Ifv0p38LPOqMOetDDDOCcsWNYg/zBbrzGhYP3A63NFTOsLNtJX7pcl++sMgUTe
xUp+Xc/pgacAoGGX8ntZChP5l+YWyuIsJ6UOqTK0UXK0MPW427V1CDrqAanKu0wW
VZLSqgUyD4P6wVVCclb82WbbWERJY4sN+vjqXz1wOfWjGvEJjxqySs2YpAXLmtIM
hU1B9YvH+njn1A4lhTMb+YiGVs/AeCqZe2q1AeQk31qKIxlRTqlpSZP7dzU3VmZK
7iRVIEYqqqijCx/2dTyr78Uh21yF5QcMzwUJ3btndHWPj3WfYXHls5pR/jUAn14=
=ixWn
-----END PGP SIGNATURE-----



From yvoinov at gmail.com  Mon Jan 26 17:42:00 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 26 Jan 2015 23:42:00 +0600
Subject: [squid-users] Error negotiating SSL connection on FD 20:
 error:00000000:lib(0):func(0):reason(0) (5/-1/131)
In-Reply-To: <54C677E5.3050400@gmail.com>
References: <54C677E5.3050400@gmail.com>
Message-ID: <54C67C68.6040107@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
After a bit Google-Fu ;)

I found this:

http://stackoverflow.com/questions/14770100/libssl-read-error-131-causing-an-application-crash

Is that it?

26.01.2015 23:22, Yuri Voinov ?????:
>
> Hi gents,
>
> who know, what this log messages mean:
>
> 2015/01/26 22:02:34 kid1| fwdNegotiateSSL: Error negotiating SSL
> connection on FD 20: error:00000000:lib(0):func(0):reason(0) (5/-1/131)
> 2015/01/26 22:02:41 kid1| fwdNegotiateSSL: Error negotiating SSL
> connection on FD 20: error:00000000:lib(0):func(0):reason(0) (5/-1/131)
> 2015/01/26 22:02:45 kid1| fwdNegotiateSSL: Error negotiating SSL
> connection on FD 20: error:00000000:lib(0):func(0):reason(0) (5/-1/131)
> 2015/01/26 22:02:48 kid1| fwdNegotiateSSL: Error negotiating SSL
> connection on FD 20: error:00000000:lib(0):func(0):reason(0) (5/-1/131)
> 2015/01/26 22:02:55 kid1| fwdNegotiateSSL: Error negotiating SSL
> connection on FD 20: error:00000000:lib(0):func(0):reason(0) (5/-1/131)
> 2015/01/26 22:03:02 kid1| fwdNegotiateSSL: Error negotiating SSL
> connection on FD 20: error:00000000:lib(0):func(0):reason(0) (5/-1/131)
> 2015/01/26 22:03:06 kid1| fwdNegotiateSSL: Error negotiating SSL
> connection on FD 20: error:00000000:lib(0):func(0):reason(0) (5/-1/131)
> 2015/01/26 22:03:12 kid1| fwdNegotiateSSL: Error negotiating SSL
> connection on FD 20: error:00000000:lib(0):func(0):reason(0) (5/-1/131)
>
> ?
>
>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUxnxnAAoJENNXIZxhPexGMPgIAJzmnEZI/O14b1CycM7gzRTH
RYMketA1LrBXrfryEm/JU/eVAT5YR+gk6m1aQ58driSk6+r7VazYC6LiNXBXBuKd
l/dtpmxX1FlaYUYhWhWN7U1ID66uLAifQtpVtc6pOfF39ENhCHDQJlwboJWBWEhK
VYnZ1f0AJSt9j5jSPQF9hibOPFLr4vtg5FIFMbU03gXI5A52TNcba5VzZsi7WmBK
ZDE7vHj5Xd/ou8+wFezMcqLPB1NxAF0zh5JckaubrQQ+UJdzo0wA4MuzhM9WNtc0
hqIT1X7r+JAdGpaHD+JfPjdPrpoS0VB6geTLjgUZMiJZxPUGrBLWJheBF82cB1c=
=LsGC
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150126/c6586028/attachment.htm>

From jborrell at central.aplitec.com  Mon Jan 26 17:48:05 2015
From: jborrell at central.aplitec.com (Josep Borrell)
Date: Mon, 26 Jan 2015 17:48:05 +0000
Subject: [squid-users] HTTPS intercept,
	simple configuration to avoid bank bumping
Message-ID: <42DE25A255671C44A93A7B58470DC09C5E2B24D3@Michelle.aplitec.local>

Hi all,

Working on squid 3.5.1 with HTTPS interception.
Trying to make a peek/splice configuration to work and avoid bank bumping.
Until now bumping is working fine but can't avoid to bump sites on acl. All are bumped.
Can anybody share a working configuration or take a look at mine to find why is not working.

Thanks

Josep

Squid.conf:

#HTTPS (SSL) trafic interception options
sslcrtd_program /usr/lib/squid3/ssl_crtd -s /var/spool/squid3_ssldb -M 4MB
sslcrtd_children 8 startup=1 idle=1

acl disable-ssl-bump dstdomain -i "/etc/squid3/no-ssl-bump.acl"
acl step1 at_step SSLBump1
acl step2 at_step SSLBump2
acl step3 at_step SSLBump3

ssl_bump peek step1 all
ssl_bump splice step2 disable-ssl-bump
ssl_bump stare step2 all
ssl_bump splice step3 disable-ssl-bump
ssl_bump bump step3 all

http_access allow all

http_port 3128
http_port 8080 intercept
https_port 8081 intercept ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB cert=/etc/squid3/ssl_cert/squidcert.pem

forward_max_tries 25
cache_mem 2 GB
maximum_object_size_in_memory 25 MB
maximum_object_size 1 GB

visible_hostname squid-v2

workers 3

coredump_dir /var/spool/squid3
cache_replacement_policy heap LFUDA
cache_dir rock /var/spool/squid3/cache1 4000 max-size=32000
cache_dir rock /var/spool/squid3/cache2 10000

refresh_pattern ^ftp: 1440 20% 10080
refresh_pattern ^gopher: 1440 0% 10080
refresh_pattern -i (/cgi-bin/|\?) 0 0% 0
refresh_pattern . 0 80% 10080

# FortiGate interface of wccp
wccp2_router 192.168.111.1
# wccp version 2 configuration
wccp2_service standard 90
# tunneling method GRE for forward traffic
wccp2_forwarding_method gre
# tunneling method GRE for return traffic
wccp2_return_method gre
# which interface to use for WCCP (0.0.0.0 determines the interface from routing)
wccp2_address 0.0.0.0

/etc/squid3/no-ssl-bump.acl file:
.bancsabadell.com
.lacaixa.com


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150126/592e43ac/attachment.htm>

From yvoinov at gmail.com  Mon Jan 26 17:53:49 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Mon, 26 Jan 2015 23:53:49 +0600
Subject: [squid-users] HTTPS intercept,
 simple configuration to avoid bank bumping
In-Reply-To: <42DE25A255671C44A93A7B58470DC09C5E2B24D3@Michelle.aplitec.local>
References: <42DE25A255671C44A93A7B58470DC09C5E2B24D3@Michelle.aplitec.local>
Message-ID: <54C67F2D.6070502@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
You can't use dstdomain ACL for disable bumping.

Only dst with IP's.

You don't know site FQDN before bump. :)

26.01.2015 23:48, Josep Borrell ?????:
>
> Hi all,
>
> 
>
> Working on squid 3.5.1 with HTTPS interception.
>
> Trying to make a peek/splice configuration to work and avoid bank bumping.
>
> Until now bumping is working fine but can?t avoid to bump sites on
acl. All are bumped.
>
> Can anybody share a working configuration or take a look at mine to
find why is not working.
>
> 
>
> Thanks
>
> 
>
> Josep
>
> 
>
> Squid.conf:
>
> 
>
> #HTTPS (SSL) trafic interception options
>
> sslcrtd_program /usr/lib/squid3/ssl_crtd -s /var/spool/squid3_ssldb -M 4MB
>
> sslcrtd_children 8 startup=1 idle=1
>
> 
>
> acl disable-ssl-bump dstdomain -i "/etc/squid3/no-ssl-bump.acl"
>
> acl step1 at_step SSLBump1
>
> acl step2 at_step SSLBump2
>
> acl step3 at_step SSLBump3
>
> 
>
> ssl_bump peek step1 all
>
> ssl_bump splice step2 disable-ssl-bump
>
> ssl_bump stare step2 all
>
> ssl_bump splice step3 disable-ssl-bump
>
> ssl_bump bump step3 all
>
> 
>
> http_access allow all
>
> 
>
> http_port 3128
>
> http_port 8080 intercept
>
> https_port 8081 intercept ssl-bump generate-host-certificates=on
dynamic_cert_mem_cache_size=4MB cert=/etc/squid3/ssl_cert/squidcert.pem
>
> 
>
> forward_max_tries 25
>
> cache_mem 2 GB
>
> maximum_object_size_in_memory 25 MB
>
> maximum_object_size 1 GB
>
> 
>
> visible_hostname squid-v2
>
> 
>
> workers 3
>
> 
>
> coredump_dir /var/spool/squid3
>
> cache_replacement_policy heap LFUDA
>
> cache_dir rock /var/spool/squid3/cache1 4000 max-size=32000
>
> cache_dir rock /var/spool/squid3/cache2 10000
>
> 
>
> refresh_pattern ^ftp: 1440 20% 10080
>
> refresh_pattern ^gopher: 1440 0% 10080
>
> refresh_pattern -i (/cgi-bin/|\?) 0 0% 0
>
> refresh_pattern . 0 80% 10080
>
> 
>
> # FortiGate interface of wccp
>
> wccp2_router 192.168.111.1
>
> # wccp version 2 configuration
>
> wccp2_service standard 90
>
> # tunneling method GRE for forward traffic
>
> wccp2_forwarding_method gre
>
> # tunneling method GRE for return traffic
>
> wccp2_return_method gre
>
> # which interface to use for WCCP (0.0.0.0 determines the interface
from routing)
>
> wccp2_address 0.0.0.0
>
> 
>
> /etc/squid3/no-ssl-bump.acl file:
>
> .bancsabadell.com
>
> .lacaixa.com
>
> 
>
> 
>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUxn8sAAoJENNXIZxhPexGQ5UIAJYWDE+L0pWR/cn3SNWZkpGt
LIBXoFsw7DGtvKD1ieu6WVAmHwf784ZrZpKtSUY7IW4/UBOdsLZtPeSe9WYmtBW6
mDLTxeQbrY7b2Xp3vnYGtw3nskYFOdR2SOeTqzcL82Pj/D0IChKgTxxt3z4Uv3it
1VKgV4fOBwiYd9ib2PBPeIEfVv7ZQLfgtr8+sTnHsxMLZjXuugokVpLtsRBiCukY
Dg6G7iyap4gPDn66GpsE7LgMbJYDIyRkWle8M55EgK12yspM6LuDTcyMOCfiNOZa
LMwyZhFbVh1XxS+2b2mBnmZtqKO3ylgGki6R/FRFUuZLgPhGidUena3vZgJBDbw=
=Q0Yt
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150126/2d99d13e/attachment.htm>

From dig at digcorp.net  Mon Jan 26 18:26:13 2015
From: dig at digcorp.net (Daniel Greenwald)
Date: Mon, 26 Jan 2015 13:26:13 -0500
Subject: [squid-users] Why 3.5.0.4 generates mimicked certs with server
 IP only when bumping?
In-Reply-To: <54C67ACD.8000809@gmail.com>
References: <54AF92FD.3050702@gmail.com> <54AFB042.4000509@treenet.co.nz>
 <54AFB156.5030502@gmail.com> <54AFB416.1040500@treenet.co.nz>
 <54B0313D.5070500@gmail.com>
 <CAOsHgtuqa9RKPHegP03HEh+Ys+Ur422tSG7ScwXmuWm8qOCQvw@mail.gmail.com>
 <1422260905864.73930@diladele.com>
 <CAOsHgtsf6j=gtASvmCFVUwko66OXxd=RGOYuAa3cozgks9LiAA@mail.gmail.com>
 <54C6627B.7080903@gmail.com>
 <CAOsHgttwr=JCj0rCOLeB3dwSk=RmU_ir_A5055q1nci5cv71Tg@mail.gmail.com>
 <54C66D3F.9010300@gmail.com> <54C67A54.8090306@treenet.co.nz>
 <54C67ACD.8000809@gmail.com>
Message-ID: <CAOsHgtt4KQFyAx5nSrWb9j6ioedkK=09naVcd11cn7isf_0CjA@mail.gmail.com>

Thank you Amos, I have updated to bump. Working well just the same..
Even chrome doesn't complain for google properties. Very nice.

-----------
Daniel I Greenwald



On Mon, Jan 26, 2015 at 12:35 PM, Yuri Voinov <yvoinov at gmail.com> wrote:

>
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> It's mistype. :)
>
> Of course, I mean
>
> acl net_bump src 192.168.101.0/24
>
>
> Yep, sure - when I change "all" to another ACL - row bungled.
>
>
> 26.01.2015 23:33, Amos Jeffries ?????:
> > On 27/01/2015 5:37 a.m., Yuri Voinov wrote:
> >>
> >> I'm not about it.
> >>
> >> server-first keyword deprecated in 3.5.x.
> >>
> >> AFAIK, keywork "bump" now has yet another meaningful.
> >>
> >> And also: in your example can only use acl "all". Any other ACL's
> >> leading "Bungled config line" error.
> >>
> >> I.e, for example,
> >>
> >> acl net_bump acl net_bump src 192.168.101.0/24
> >
> > You sure the bungled is not about the previous line?
> >
> > "acl net_bump acl ..." no such ACL type as "acl".
> >
> >
> >> ssl_bump peek step1 net_bump
> >> ssl_bump server-first step2 net_bump
> >>
> >
> > And yes you are right that is deprecated. It should be "bump" as the
> action.
> >
> > Amos
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
>
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2
>
> iQEcBAEBAgAGBQJUxnrNAAoJENNXIZxhPexGbtgH/AlBia1J2rX2htD3znXOA9Cb
> i2Ifv0p38LPOqMOetDDDOCcsWNYg/zBbrzGhYP3A63NFTOsLNtJX7pcl++sMgUTe
> xUp+Xc/pgacAoGGX8ntZChP5l+YWyuIsJ6UOqTK0UXK0MPW427V1CDrqAanKu0wW
> VZLSqgUyD4P6wVVCclb82WbbWERJY4sN+vjqXz1wOfWjGvEJjxqySs2YpAXLmtIM
> hU1B9YvH+njn1A4lhTMb+YiGVs/AeCqZe2q1AeQk31qKIxlRTqlpSZP7dzU3VmZK
> 7iRVIEYqqqijCx/2dTyr78Uh21yF5QcMzwUJ3btndHWPj3WfYXHls5pR/jUAn14=
> =ixWn
> -----END PGP SIGNATURE-----
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150126/bf9dc478/attachment.htm>

From yvoinov at gmail.com  Mon Jan 26 18:40:50 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Tue, 27 Jan 2015 00:40:50 +0600
Subject: [squid-users] Why 3.5.0.4 generates mimicked certs with server
 IP only when bumping?
In-Reply-To: <CAOsHgtt4KQFyAx5nSrWb9j6ioedkK=09naVcd11cn7isf_0CjA@mail.gmail.com>
References: <54AF92FD.3050702@gmail.com> <54AFB042.4000509@treenet.co.nz>
 <54AFB156.5030502@gmail.com> <54AFB416.1040500@treenet.co.nz>
 <54B0313D.5070500@gmail.com>
 <CAOsHgtuqa9RKPHegP03HEh+Ys+Ur422tSG7ScwXmuWm8qOCQvw@mail.gmail.com>
 <1422260905864.73930@diladele.com>
 <CAOsHgtsf6j=gtASvmCFVUwko66OXxd=RGOYuAa3cozgks9LiAA@mail.gmail.com>
 <54C6627B.7080903@gmail.com>
 <CAOsHgttwr=JCj0rCOLeB3dwSk=RmU_ir_A5055q1nci5cv71Tg@mail.gmail.com>
 <54C66D3F.9010300@gmail.com> <54C67A54.8090306@treenet.co.nz>
 <54C67ACD.8000809@gmail.com>
 <CAOsHgtt4KQFyAx5nSrWb9j6ioedkK=09naVcd11cn7isf_0CjA@mail.gmail.com>
Message-ID: <54C68A32.3080304@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Still not working.

Every HTTPS-site produces error like that:

1422297291.318      0 192.168.100.5 TAG_NONE_ABORTED/000 0 GET
https://r5---sn-h
xb54vo-304l.googlevideo.com/videoplayback?gir=yes&mm=31&signature=CF822B36D7CA4B
43B8D1244FFF568777CDFB7B15.FA40AB98545E64C3320FFDA1130E033AB5B0473E&id=o-AN8D1qc
0rtmOeTXFYoc0TPI8mbtZpVj2O2SJfpADCgwV&sparams=clen%2Cdur%2Cgir%2Cid%2Cinitcwndbp
s%2Cip%2Cipbits%2Citag%2Ckeepalive%2Clmt%2Cmime%2Cmm%2Cms%2Cmv%2Cpl%2Crequiressl
%2Csource%2Cupn%2Cexpire&sver=3&ip=178.88.163.102&clen=954398&mt=1422297217&mv=m
&ms=au&keepalive=yes&dur=60.046&source=youtube&itag=140&requiressl=yes&key=yt5&i
pbits=0&initcwndbps=903750&pl=24&mime=audio%2Fmp4&lmt=1390059362110278&expire=14
22318845&upn=_hyzhDi7WlU&fexp=3300103%2C3300103%2C3300133%2C3300133%2C3300137%2C
3300137%2C3300161%2C3300161%2C3310366%2C3310366%2C3310698%2C3310698%2C900718%2C9
07263%2C927622%2C930824%2C933226%2C9405146%2C941004%2C943607%2C943917%2C947225%2
C948124%2C952302%2C952605%2C952901%2C955301%2C957103%2C957105%2C957201%2C959701&
cpn=IFvjo3uYvTM59S0w&alr=yes&ratebypass=yes&c=WEB&cver=html5&range=273343-318800
 - HIER_NONE/- -

Request size = 0

And got these errors in cache.log:

2015/01/27 00:36:39 kid1| BUG 3556: FD 64 is not an open socket.
2015/01/27 00:39:47 kid1| BUG 3556: FD 38 is not an open socket.

So what...

Upgrade failed. Rollback to 3.4.11. It works perfectly.

27.01.2015 0:26, Daniel Greenwald ?????:
> Thank you Amos, I have updated to bump. Working well just the same..
> Even chrome doesn't complain for google properties. Very nice.
>
> -----------
> Daniel I Greenwald
>
>
>
> On Mon, Jan 26, 2015 at 12:35 PM, Yuri Voinov <yvoinov at gmail.com
<mailto:yvoinov at gmail.com>> wrote:
>
>
> It's mistype. :)
>
> Of course, I mean
>
> acl net_bump src 192.168.101.0/24 <http://192.168.101.0/24>
>
>
> Yep, sure - when I change "all" to another ACL - row bungled.
>
>
> 26.01.2015 23:33, Amos Jeffries ?????:
> > On 27/01/2015 5:37 a.m., Yuri Voinov wrote:
> >>
> >> I'm not about it.
> >>
> >> server-first keyword deprecated in 3.5.x.
> >>
> >> AFAIK, keywork "bump" now has yet another meaningful.
> >>
> >> And also: in your example can only use acl "all". Any other ACL's
> >> leading "Bungled config line" error.
> >>
> >> I.e, for example,
> >>
> >> acl net_bump acl net_bump src 192.168.101.0/24
<http://192.168.101.0/24>
>
> > You sure the bungled is not about the previous line?
>
> > "acl net_bump acl ..." no such ACL type as "acl".
>
>
> >> ssl_bump peek step1 net_bump
> >> ssl_bump server-first step2 net_bump
> >>
>
> > And yes you are right that is deprecated. It should be "bump" as the
> action.
>
> > Amos
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
<mailto:squid-users at lists.squid-cache.org>
> > http://lists.squid-cache.org/listinfo/squid-users
>
>
>     _______________________________________________
>     squid-users mailing list
>     squid-users at lists.squid-cache.org
<mailto:squid-users at lists.squid-cache.org>
>     http://lists.squid-cache.org/listinfo/squid-users
>
>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUxooyAAoJENNXIZxhPexGIToH/1RRJnm9UNja8MYUMv0tuNri
sxwx6BCZ9OjYKAnfAs5uTwewRwDM6+1CrWq1OWlhPBPTODLMzk5RgdGVY1DrkxB3
aB6V38ynVmwAvzYbi6ycZyulPf7rOiJMTW4lEBiji8jmEBBmohMA24AWz6FALhv4
ohCYDH5KEn/OAkQ0S9xUOwhm7wOAwOQoBtgpzIKxZCpRFei7CElmx4TwlOrwRkon
HwwFx6X7QjI2Q73cU2R1Mgh7HbnhJDF7X0LBS939uBg0xk0Ixh1KxAJGzk7CjHpk
cSF0+nquOti+iIUEMW3CWxvSS1mKO38wVbpuI72RBN83QQRjUi1SljbfEd4i3a0=
=UjK6
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150127/accada9e/attachment.htm>

From yvoinov at gmail.com  Mon Jan 26 19:02:33 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Tue, 27 Jan 2015 01:02:33 +0600
Subject: [squid-users] Why 3.5.0.4 generates mimicked certs with server
 IP only when bumping?
In-Reply-To: <CAOsHgtt4KQFyAx5nSrWb9j6ioedkK=09naVcd11cn7isf_0CjA@mail.gmail.com>
References: <54AF92FD.3050702@gmail.com> <54AFB042.4000509@treenet.co.nz>
 <54AFB156.5030502@gmail.com> <54AFB416.1040500@treenet.co.nz>
 <54B0313D.5070500@gmail.com>
 <CAOsHgtuqa9RKPHegP03HEh+Ys+Ur422tSG7ScwXmuWm8qOCQvw@mail.gmail.com>
 <1422260905864.73930@diladele.com>
 <CAOsHgtsf6j=gtASvmCFVUwko66OXxd=RGOYuAa3cozgks9LiAA@mail.gmail.com>
 <54C6627B.7080903@gmail.com>
 <CAOsHgttwr=JCj0rCOLeB3dwSk=RmU_ir_A5055q1nci5cv71Tg@mail.gmail.com>
 <54C66D3F.9010300@gmail.com> <54C67A54.8090306@treenet.co.nz>
 <54C67ACD.8000809@gmail.com>
 <CAOsHgtt4KQFyAx5nSrWb9j6ioedkK=09naVcd11cn7isf_0CjA@mail.gmail.com>
Message-ID: <54C68F49.8030704@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
With this:

acl step2 at_step SslBump2
acl step3 at_step SslBump3
ssl_bump peek step2 all
ssl_bump bump step3 all

it does'nt produce errors, but also doesn't bump.

No mimicked certificates created. No one.

Yep, permissions are ok. Yep, owner is ok. Yep, another configuration ok. :)

What else?

27.01.2015 0:26, Daniel Greenwald ?????:
> Thank you Amos, I have updated to bump. Working well just the same..
> Even chrome doesn't complain for google properties. Very nice.
>
> -----------
> Daniel I Greenwald
>
>
>
> On Mon, Jan 26, 2015 at 12:35 PM, Yuri Voinov <yvoinov at gmail.com
<mailto:yvoinov at gmail.com>> wrote:
>
>
> It's mistype. :)
>
> Of course, I mean
>
> acl net_bump src 192.168.101.0/24 <http://192.168.101.0/24>
>
>
> Yep, sure - when I change "all" to another ACL - row bungled.
>
>
> 26.01.2015 23:33, Amos Jeffries ?????:
> > On 27/01/2015 5:37 a.m., Yuri Voinov wrote:
> >>
> >> I'm not about it.
> >>
> >> server-first keyword deprecated in 3.5.x.
> >>
> >> AFAIK, keywork "bump" now has yet another meaningful.
> >>
> >> And also: in your example can only use acl "all". Any other ACL's
> >> leading "Bungled config line" error.
> >>
> >> I.e, for example,
> >>
> >> acl net_bump acl net_bump src 192.168.101.0/24
<http://192.168.101.0/24>
>
> > You sure the bungled is not about the previous line?
>
> > "acl net_bump acl ..." no such ACL type as "acl".
>
>
> >> ssl_bump peek step1 net_bump
> >> ssl_bump server-first step2 net_bump
> >>
>
> > And yes you are right that is deprecated. It should be "bump" as the
> action.
>
> > Amos
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
<mailto:squid-users at lists.squid-cache.org>
> > http://lists.squid-cache.org/listinfo/squid-users
>
>
>     _______________________________________________
>     squid-users mailing list
>     squid-users at lists.squid-cache.org
<mailto:squid-users at lists.squid-cache.org>
>     http://lists.squid-cache.org/listinfo/squid-users
>
>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUxo9IAAoJENNXIZxhPexGJ7wH/2ZBWWu+JKFu3tFTIbTXLro7
qkokUD+zSuP4ThaViBem7asf7SNGN8tshDOtI6+WAIE93TszGcjZQ4sGWbQp/mmN
L9OlEjxrBgbNOCV7aLdwHcBeoOS6PktXYaFIm7dGoXmyzFyf560WkBEUa1RtRDJ0
/OKkHvBQPWHXzhvTVJVtC2HMFx6MJ682jTTMRsY/6Y/ymC6Mcbjdvdz/qOjcNqnq
vAssvdVEL3v7CoIWuBEEq/cjh6m0Z6bHOxCBJfSQWj7E9UceY5KaDRUy+PwIQe4X
koqjtJRwwu8+KoXM6hGAl5Qntglb7aVnooaymcVBDYv+/h46uED0Lo5hi1bvnGE=
=pYeI
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150127/3ed65dc3/attachment.htm>

From yvoinov at gmail.com  Mon Jan 26 19:08:04 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Tue, 27 Jan 2015 01:08:04 +0600
Subject: [squid-users] Why 3.5.0.4 generates mimicked certs with server
 IP only when bumping?
In-Reply-To: <CAOsHgtt4KQFyAx5nSrWb9j6ioedkK=09naVcd11cn7isf_0CjA@mail.gmail.com>
References: <54AF92FD.3050702@gmail.com> <54AFB042.4000509@treenet.co.nz>
 <54AFB156.5030502@gmail.com> <54AFB416.1040500@treenet.co.nz>
 <54B0313D.5070500@gmail.com>
 <CAOsHgtuqa9RKPHegP03HEh+Ys+Ur422tSG7ScwXmuWm8qOCQvw@mail.gmail.com>
 <1422260905864.73930@diladele.com>
 <CAOsHgtsf6j=gtASvmCFVUwko66OXxd=RGOYuAa3cozgks9LiAA@mail.gmail.com>
 <54C6627B.7080903@gmail.com>
 <CAOsHgttwr=JCj0rCOLeB3dwSk=RmU_ir_A5055q1nci5cv71Tg@mail.gmail.com>
 <54C66D3F.9010300@gmail.com> <54C67A54.8090306@treenet.co.nz>
 <54C67ACD.8000809@gmail.com>
 <CAOsHgtt4KQFyAx5nSrWb9j6ioedkK=09naVcd11cn7isf_0CjA@mail.gmail.com>
Message-ID: <54C69094.4040506@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Daniel,

you really sure you configuration makes bumping?

/var/lib/ssl_db/certs/  remains empty, Squid cannot bump without
mimicked certs, which is not produces.

I've seen only tunneling CONNECT with your configuration (of course, you
browser glad to see original server cert ;)),

and with my las configutaion - I see the same. Only CONNECTs tunneling.

Urge Amos :))))))) judge us.

27.01.2015 0:26, Daniel Greenwald ?????:
> Thank you Amos, I have updated to bump. Working well just the same..
> Even chrome doesn't complain for google properties. Very nice.
>
> -----------
> Daniel I Greenwald
>
>
>
> On Mon, Jan 26, 2015 at 12:35 PM, Yuri Voinov <yvoinov at gmail.com
<mailto:yvoinov at gmail.com>> wrote:
>
>
> It's mistype. :)
>
> Of course, I mean
>
> acl net_bump src 192.168.101.0/24 <http://192.168.101.0/24>
>
>
> Yep, sure - when I change "all" to another ACL - row bungled.
>
>
> 26.01.2015 23:33, Amos Jeffries ?????:
> > On 27/01/2015 5:37 a.m., Yuri Voinov wrote:
> >>
> >> I'm not about it.
> >>
> >> server-first keyword deprecated in 3.5.x.
> >>
> >> AFAIK, keywork "bump" now has yet another meaningful.
> >>
> >> And also: in your example can only use acl "all". Any other ACL's
> >> leading "Bungled config line" error.
> >>
> >> I.e, for example,
> >>
> >> acl net_bump acl net_bump src 192.168.101.0/24
<http://192.168.101.0/24>
>
> > You sure the bungled is not about the previous line?
>
> > "acl net_bump acl ..." no such ACL type as "acl".
>
>
> >> ssl_bump peek step1 net_bump
> >> ssl_bump server-first step2 net_bump
> >>
>
> > And yes you are right that is deprecated. It should be "bump" as the
> action.
>
> > Amos
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
<mailto:squid-users at lists.squid-cache.org>
> > http://lists.squid-cache.org/listinfo/squid-users
>
>
>     _______________________________________________
>     squid-users mailing list
>     squid-users at lists.squid-cache.org
<mailto:squid-users at lists.squid-cache.org>
>     http://lists.squid-cache.org/listinfo/squid-users
>
>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUxpCTAAoJENNXIZxhPexG06UH/RVuzRRIoKz2/jUSNLE/1eSZ
tGP328qFdzRTHa0zvtQ1SRASNKVNusyykwJxJ/ZGmLUZEM9+ubUuIET4vlkZnsPd
vhsd/IqtaHWJvpVpxxr/wgu5Pv2dqtWoBHt+7Xop3oURtQq91mVEvXzPEDwxfVtX
rPp85/QPIrln5lFwaEG07TXOW2BcbXW3EfLJN7rAH3pGZh6AdROgzHCrN+pTJHj3
mI1FcCqSoy6ks73ncFbMUcMh8zaQBnr3dJQ67W32EmQIyTkNFZbLP2TTPuMJldF5
U35fKoiOc9I+dd+7/Fye4rZihA2kdfYnVWAW0/bRg/mHv/xdkZM1MXsQ+B//dbM=
=OVYL
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150127/204e5b93/attachment.htm>

From yvoinov at gmail.com  Mon Jan 26 19:16:49 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Tue, 27 Jan 2015 01:16:49 +0600
Subject: [squid-users] Why 3.5.0.4 generates mimicked certs with server
 IP only when bumping?
In-Reply-To: <CAOsHgtt4KQFyAx5nSrWb9j6ioedkK=09naVcd11cn7isf_0CjA@mail.gmail.com>
References: <54AF92FD.3050702@gmail.com> <54AFB042.4000509@treenet.co.nz>
 <54AFB156.5030502@gmail.com> <54AFB416.1040500@treenet.co.nz>
 <54B0313D.5070500@gmail.com>
 <CAOsHgtuqa9RKPHegP03HEh+Ys+Ur422tSG7ScwXmuWm8qOCQvw@mail.gmail.com>
 <1422260905864.73930@diladele.com>
 <CAOsHgtsf6j=gtASvmCFVUwko66OXxd=RGOYuAa3cozgks9LiAA@mail.gmail.com>
 <54C6627B.7080903@gmail.com>
 <CAOsHgttwr=JCj0rCOLeB3dwSk=RmU_ir_A5055q1nci5cv71Tg@mail.gmail.com>
 <54C66D3F.9010300@gmail.com> <54C67A54.8090306@treenet.co.nz>
 <54C67ACD.8000809@gmail.com>
 <CAOsHgtt4KQFyAx5nSrWb9j6ioedkK=09naVcd11cn7isf_0CjA@mail.gmail.com>
Message-ID: <54C692A1.7070201@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
No one ssl_bump combination did not work.

With your config I see only:

1422299531.482  18722 192.168.100.5 TCP_TUNNEL/200 99418 CONNECT
128.121.22.133:
443 - ORIGINAL_DST/128.121.22.133 -

and connection does'nt established.

No errors - no bump. Certs generated, but strange - without FQDN CN's.

27.01.2015 0:26, Daniel Greenwald ?????:
> Thank you Amos, I have updated to bump. Working well just the same..
> Even chrome doesn't complain for google properties. Very nice.
>
> -----------
> Daniel I Greenwald
>
>
>
> On Mon, Jan 26, 2015 at 12:35 PM, Yuri Voinov <yvoinov at gmail.com
<mailto:yvoinov at gmail.com>> wrote:
>
>
> It's mistype. :)
>
> Of course, I mean
>
> acl net_bump src 192.168.101.0/24 <http://192.168.101.0/24>
>
>
> Yep, sure - when I change "all" to another ACL - row bungled.
>
>
> 26.01.2015 23:33, Amos Jeffries ?????:
> > On 27/01/2015 5:37 a.m., Yuri Voinov wrote:
> >>
> >> I'm not about it.
> >>
> >> server-first keyword deprecated in 3.5.x.
> >>
> >> AFAIK, keywork "bump" now has yet another meaningful.
> >>
> >> And also: in your example can only use acl "all". Any other ACL's
> >> leading "Bungled config line" error.
> >>
> >> I.e, for example,
> >>
> >> acl net_bump acl net_bump src 192.168.101.0/24
<http://192.168.101.0/24>
>
> > You sure the bungled is not about the previous line?
>
> > "acl net_bump acl ..." no such ACL type as "acl".
>
>
> >> ssl_bump peek step1 net_bump
> >> ssl_bump server-first step2 net_bump
> >>
>
> > And yes you are right that is deprecated. It should be "bump" as the
> action.
>
> > Amos
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
<mailto:squid-users at lists.squid-cache.org>
> > http://lists.squid-cache.org/listinfo/squid-users
>
>
>     _______________________________________________
>     squid-users mailing list
>     squid-users at lists.squid-cache.org
<mailto:squid-users at lists.squid-cache.org>
>     http://lists.squid-cache.org/listinfo/squid-users
>
>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUxpKhAAoJENNXIZxhPexG830IAJxFbwTp/lo4BtL09GGU8RXI
zEElJ9R8qaSxqUFc2BL1u5n2VsCOwEAo9PQpsBZiMULLRXy2hmIGPO6tYwAehE2N
zq70oBoDkcXMavELA9ApDUo1sMu05wWJ6RlPzP3H2ctOSAakRyU7f7Eq2gPBcVSg
XO6emmIuFr83PldR9TEnYa+LSSey5ZYJK4zh/AghqgDLFQ/Uh+kJGvyN1X16QS4H
sjXQKAMRkDtzW7yTb7QQkdSQiwLYhyi6kebAz+jVu6XSI8XFeBLOOZlfHEa6R/sk
S12YGThC7Ew1GugWNlGbiaRyfUnkYtWPNSA0MQYQJVzVpTXNobgtDQs1XM5GHfM=
=DC+0
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150127/3f5e6f8c/attachment.htm>

From dig at digcorp.net  Mon Jan 26 19:54:06 2015
From: dig at digcorp.net (Daniel Greenwald)
Date: Mon, 26 Jan 2015 14:54:06 -0500
Subject: [squid-users] HTTPS intercept,
	simple configuration to avoid bank bumping
In-Reply-To: <54C67F2D.6070502@gmail.com>
References: <42DE25A255671C44A93A7B58470DC09C5E2B24D3@Michelle.aplitec.local>
 <54C67F2D.6070502@gmail.com>
Message-ID: <CAOsHgttD1fJN1GGuzQA-31Ksv6zuzfGUu8ZPCf3RQ54YxDRanw@mail.gmail.com>

hmm acc to how I read this page:
http://wiki.squid-cache.org/Features/SslPeekAndSplice
The following *should* work, however in my test it bumps all and does not
splice.
Yuri- I believe, the domain name should be available at step2 after peeking
in step1.
Someone correct me?


acl domains_nobump dstdomain "/etc/squid/domains_nobump.acl"
acl step1 at_step SslBump1
acl step2 at_step SslBump2
ssl_bump splice domains_nobump
ssl_bump peek step1 all
ssl_bump bump step2 all


-----------
Daniel I Greenwald



On Mon, Jan 26, 2015 at 12:53 PM, Yuri Voinov <yvoinov at gmail.com> wrote:

>
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> You can't use dstdomain ACL for disable bumping.
>
> Only dst with IP's.
>
> You don't know site FQDN before bump. :)
>
> 26.01.2015 23:48, Josep Borrell ?????:
> >
> > Hi all,
> >
> >
> >
> > Working on squid 3.5.1 with HTTPS interception.
> >
> > Trying to make a peek/splice configuration to work and avoid bank
> bumping.
> >
> > Until now bumping is working fine but can?t avoid to bump sites on acl.
> All are bumped.
> >
> > Can anybody share a working configuration or take a look at mine to find
> why is not working.
> >
> >
> >
> > Thanks
> >
> >
> >
> > Josep
> >
> >
> >
> > Squid.conf:
> >
> >
> >
> > #HTTPS (SSL) trafic interception options
> >
> > sslcrtd_program /usr/lib/squid3/ssl_crtd -s /var/spool/squid3_ssldb -M
> 4MB
> >
> > sslcrtd_children 8 startup=1 idle=1
> >
> >
> >
> > acl disable-ssl-bump dstdomain -i "/etc/squid3/no-ssl-bump.acl"
> >
> > acl step1 at_step SSLBump1
> >
> > acl step2 at_step SSLBump2
> >
> > acl step3 at_step SSLBump3
> >
> >
> >
> > ssl_bump peek step1 all
> >
> > ssl_bump splice step2 disable-ssl-bump
> >
> > ssl_bump stare step2 all
> >
> > ssl_bump splice step3 disable-ssl-bump
> >
> > ssl_bump bump step3 all
> >
> >
> >
> > http_access allow all
> >
> >
> >
> > http_port 3128
> >
> > http_port 8080 intercept
> >
> > https_port 8081 intercept ssl-bump generate-host-certificates=on
> dynamic_cert_mem_cache_size=4MB cert=/etc/squid3/ssl_cert/squidcert.pem
> >
> >
> >
> > forward_max_tries 25
> >
> > cache_mem 2 GB
> >
> > maximum_object_size_in_memory 25 MB
> >
> > maximum_object_size 1 GB
> >
> >
> >
> > visible_hostname squid-v2
> >
> >
> >
> > workers 3
> >
> >
> >
> > coredump_dir /var/spool/squid3
> >
> > cache_replacement_policy heap LFUDA
> >
> > cache_dir rock /var/spool/squid3/cache1 4000 max-size=32000
> >
> > cache_dir rock /var/spool/squid3/cache2 10000
> >
> >
> >
> > refresh_pattern ^ftp: 1440 20% 10080
> >
> > refresh_pattern ^gopher: 1440 0% 10080
> >
> > refresh_pattern -i (/cgi-bin/|\?) 0 0% 0
> >
> > refresh_pattern . 0 80% 10080
> >
> >
> >
> > # FortiGate interface of wccp
> >
> > wccp2_router 192.168.111.1
> >
> > # wccp version 2 configuration
> >
> > wccp2_service standard 90
> >
> > # tunneling method GRE for forward traffic
> >
> > wccp2_forwarding_method gre
> >
> > # tunneling method GRE for return traffic
> >
> > wccp2_return_method gre
> >
> > # which interface to use for WCCP (0.0.0.0 determines the interface from
> routing)
> >
> > wccp2_address 0.0.0.0
> >
> >
> >
> > /etc/squid3/no-ssl-bump.acl file:
> >
> > .bancsabadell.com
> >
> > .lacaixa.com
> >
> >
> >
> >
> >
> >
> >
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
>
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2
>
> iQEcBAEBAgAGBQJUxn8sAAoJENNXIZxhPexGQ5UIAJYWDE+L0pWR/cn3SNWZkpGt
> LIBXoFsw7DGtvKD1ieu6WVAmHwf784ZrZpKtSUY7IW4/UBOdsLZtPeSe9WYmtBW6
> mDLTxeQbrY7b2Xp3vnYGtw3nskYFOdR2SOeTqzcL82Pj/D0IChKgTxxt3z4Uv3it
> 1VKgV4fOBwiYd9ib2PBPeIEfVv7ZQLfgtr8+sTnHsxMLZjXuugokVpLtsRBiCukY
> Dg6G7iyap4gPDn66GpsE7LgMbJYDIyRkWle8M55EgK12yspM6LuDTcyMOCfiNOZa
> LMwyZhFbVh1XxS+2b2mBnmZtqKO3ylgGki6R/FRFUuZLgPhGidUena3vZgJBDbw=
> =Q0Yt
> -----END PGP SIGNATURE-----
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150126/40588547/attachment.htm>

From yvoinov at gmail.com  Mon Jan 26 19:58:05 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Tue, 27 Jan 2015 01:58:05 +0600
Subject: [squid-users] HTTPS intercept,
 simple configuration to avoid bank bumping
In-Reply-To: <CAOsHgttD1fJN1GGuzQA-31Ksv6zuzfGUu8ZPCf3RQ54YxDRanw@mail.gmail.com>
References: <42DE25A255671C44A93A7B58470DC09C5E2B24D3@Michelle.aplitec.local>
 <54C67F2D.6070502@gmail.com>
 <CAOsHgttD1fJN1GGuzQA-31Ksv6zuzfGUu8ZPCf3RQ54YxDRanw@mail.gmail.com>
Message-ID: <54C69C4D.3010609@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
In theory.

I don't see any 3.5.x bump working yet.

In 3.4.x bumping not chunked to stages and only IP-based dst acls will
working.

27.01.2015 1:54, Daniel Greenwald ?????:
> hmm acc to how I read this page: http://wiki.squid-cache.org/Features/SslPeekAndSplice
> The following *should* work, however in my test it bumps all and does
not splice.
> Yuri- I believe, the domain name should be available at step2 after
peeking in step1.
> Someone correct me?
> 
>
> acl domains_nobump dstdomain "/etc/squid/domains_nobump.acl"
> acl step1 at_step SslBump1
> acl step2 at_step SslBump2
> ssl_bump splice domains_nobump
> ssl_bump peek step1 all
> ssl_bump bump step2 all
>
>
> -----------
> Daniel I Greenwald
>
>
>
> On Mon, Jan 26, 2015 at 12:53 PM, Yuri Voinov <yvoinov at gmail.com
<mailto:yvoinov at gmail.com>> wrote:
>
>
> You can't use dstdomain ACL for disable bumping.
>
> Only dst with IP's.
>
> You don't know site FQDN before bump. :)
>
> 26.01.2015 23:48, Josep Borrell ?????:
>
> > Hi all,
>
>
>
> > Working on squid 3.5.1 with HTTPS interception.
>
> > Trying to make a peek/splice configuration to work and avoid bank
bumping.
>
> > Until now bumping is working fine but can?t avoid to bump sites on
acl. All are bumped.
>
> > Can anybody share a working configuration or take a look at mine to
find why is not working.
>
>
>
> > Thanks
>
>
>
> > Josep
>
>
>
> > Squid.conf:
>
>
>
> > #HTTPS (SSL) trafic interception options
>
> > sslcrtd_program /usr/lib/squid3/ssl_crtd -s /var/spool/squid3_ssldb
-M 4MB
>
> > sslcrtd_children 8 startup=1 idle=1
>
>
>
> > acl disable-ssl-bump dstdomain -i "/etc/squid3/no-ssl-bump.acl"
>
> > acl step1 at_step SSLBump1
>
> > acl step2 at_step SSLBump2
>
> > acl step3 at_step SSLBump3
>
>
>
> > ssl_bump peek step1 all
>
> > ssl_bump splice step2 disable-ssl-bump
>
> > ssl_bump stare step2 all
>
> > ssl_bump splice step3 disable-ssl-bump
>
> > ssl_bump bump step3 all
>
>
>
> > http_access allow all
>
>
>
> > http_port 3128
>
> > http_port 8080 intercept
>
> > https_port 8081 intercept ssl-bump generate-host-certificates=on
dynamic_cert_mem_cache_size=4MB cert=/etc/squid3/ssl_cert/squidcert.pem
>
>
>
> > forward_max_tries 25
>
> > cache_mem 2 GB
>
> > maximum_object_size_in_memory 25 MB
>
> > maximum_object_size 1 GB
>
>
>
> > visible_hostname squid-v2
>
>
>
> > workers 3
>
>
>
> > coredump_dir /var/spool/squid3
>
> > cache_replacement_policy heap LFUDA
>
> > cache_dir rock /var/spool/squid3/cache1 4000 max-size=32000
>
> > cache_dir rock /var/spool/squid3/cache2 10000
>
>
>
> > refresh_pattern ^ftp: 1440 20% 10080
>
> > refresh_pattern ^gopher: 1440 0% 10080
>
> > refresh_pattern -i (/cgi-bin/|\?) 0 0% 0
>
> > refresh_pattern . 0 80% 10080
>
>
>
> > # FortiGate interface of wccp
>
> > wccp2_router 192.168.111.1
>
> > # wccp version 2 configuration
>
> > wccp2_service standard 90
>
> > # tunneling method GRE for forward traffic
>
> > wccp2_forwarding_method gre
>
> > # tunneling method GRE for return traffic
>
> > wccp2_return_method gre
>
> > # which interface to use for WCCP (0.0.0.0 determines the interface
from routing)
>
> > wccp2_address 0.0.0.0
>
>
>
> > /etc/squid3/no-ssl-bump.acl file:
>
> > .bancsabadell.com <http://bancsabadell.com>
>
> > .lacaixa.com <http://lacaixa.com>
>
>
>
>
>
>
>
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
<mailto:squid-users at lists.squid-cache.org>
> > http://lists.squid-cache.org/listinfo/squid-users
>
>
>
>     _______________________________________________
>     squid-users mailing list
>     squid-users at lists.squid-cache.org
<mailto:squid-users at lists.squid-cache.org>
>     http://lists.squid-cache.org/listinfo/squid-users
>
>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUxpxMAAoJENNXIZxhPexG43IH/Rk6elTzB7xFtG7wNx+juAHC
9MdVKxR6QFnlBWn/A6KNWZK1vNCv6+N3n2RPD6OUCPiLrEQIA2h20BceEjMYkM1A
Fw6Gk+ImowMJ2K6H5+X5MKFwvOLsaKtO8Tm4b299+42Xkvg2oFxFO0BeX8GJaWAm
aq4NsUN6pzJK51CRTKe5ZwGpJ2kN0rtgDaILAV1shX3jnWnrWJMV41ZJGLtWEnDX
pZ45unu1qjVDOs6ibaFDDX6ehWnfXh/WhLq0TwWPu0AaoCn28Sid0Y3V/4ShKFpH
EP2Jgs10Oyi7/Ph7o4RtFGONUNhVGrl2QdftM+MOZPsCvRIrYF4pff5gjd0R8EU=
=Xdb5
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150127/e50407de/attachment.htm>

From hack.back at hotmail.com  Mon Jan 26 20:49:55 2015
From: hack.back at hotmail.com (HackXBack)
Date: Mon, 26 Jan 2015 12:49:55 -0800 (PST)
Subject: [squid-users] Error negotiating SSL connection on FD 20:
 error:00000000:lib(0):func(0):reason(0) (5/-1/131)
In-Reply-To: <54C67C68.6040107@gmail.com>
References: <54C677E5.3050400@gmail.com> <54C67C68.6040107@gmail.com>
Message-ID: <1422305395708-4669351.post@n4.nabble.com>

when you know tell me because i asked this question before here and i didnt
get any answer



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Error-negotiating-SSL-connection-on-FD-20-error-00000000-lib-0-func-0-reason-0-5-1-131-tp4669338p4669351.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From yvoinov at gmail.com  Mon Jan 26 21:30:14 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Tue, 27 Jan 2015 03:30:14 +0600
Subject: [squid-users] Error negotiating SSL connection on FD 20:
 error:00000000:lib(0):func(0):reason(0) (5/-1/131)
In-Reply-To: <1422305395708-4669351.post@n4.nabble.com>
References: <54C677E5.3050400@gmail.com> <54C67C68.6040107@gmail.com>
 <1422305395708-4669351.post@n4.nabble.com>
Message-ID: <54C6B1E6.2000209@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
I suggest we are asking in wrong place :)

This is OpenSSL error stack, not squid.

Also, man, which root CA bundle you are use in your installation?

27.01.2015 2:49, HackXBack ?????:
> when you know tell me because i asked this question before here and i didnt
> get any answer
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/Error-negotiating-SSL-connection-on-FD-20-error-00000000-lib-0-func-0-reason-0-5-1-131-tp4669338p4669351.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUxrHlAAoJENNXIZxhPexGQhsIAMFIcqXHqRpogVFM4AwViEtP
xZyraoWx6JKgZWPlCnXo4q163c0d55i/RExeQcQpOI7PL6QadgdcKn/jsUFY+DHO
eYi11CzZKHynYH5tcsbXf1lqDfZQKt41x2Yi2GgduXmQ0KETbjajjdbeomI9541u
lggzCAzThYpWhQaBI1ZxY2pPCv7afYj6XyL7yY7MGe14tFcJME30R1i0/9SW44AP
TeHNV26pqFVqo5cww29T8Olv6XDs6O/nfZgYADLDbwew6r4zH/kR4Oa5wdo59yCC
P8JRQQ/VANRVMuV25cV7dLe2jTTOK0uZ3MkhXLkQ4qQDwuClnwT6bSkMVEgQghM=
=QjdE
-----END PGP SIGNATURE-----



From Jason_Haar at trimble.com  Mon Jan 26 21:33:40 2015
From: Jason_Haar at trimble.com (Jason Haar)
Date: Tue, 27 Jan 2015 10:33:40 +1300
Subject: [squid-users] HTTPS intercept,
 simple configuration to avoid bank bumping
In-Reply-To: <CAOsHgttD1fJN1GGuzQA-31Ksv6zuzfGUu8ZPCf3RQ54YxDRanw@mail.gmail.com>
References: <42DE25A255671C44A93A7B58470DC09C5E2B24D3@Michelle.aplitec.local>
 <54C67F2D.6070502@gmail.com>
 <CAOsHgttD1fJN1GGuzQA-31Ksv6zuzfGUu8ZPCf3RQ54YxDRanw@mail.gmail.com>
Message-ID: <54C6B2B4.4070307@trimble.com>


Well the documentation says

#   SslBump1: After getting TCP-level and HTTP CONNECT info.
#   SslBump2: After getting SSL Client Hello info.
#   SslBump3: After getting SSL Server Hello info.


So that means SslBump1 only works for direct proxy (ie CONNECT)
sessions, it's SslBump2 that peeks into the traffic to discover the
client SNI hostname. So I think you actually need (I'll use more
descriptive acl names and comment out those that I think don't add any
value)

acl domains_nobump dstdomain "/etc/squid/domains_nobump.acl"
#no added value: acl DiscoverCONNECTHost at_step SslBump1
acl DiscoverSNIHost at_step SslBump2
#don't use - breaks bump: acl DiscoverServerHost at_step SslBump3
#no added value - in fact forces peek for some reason: ssl_bump peek
DiscoverCONNECTHost all
ssl_bump peek DiscoverSNIHost all

ssl_bump splice domains_nobump
#DiscoverSNIHost should now mean Squid knows about all the SNI details
ssl_bump bump all

Sadly, this doesn't work for me *in transparent mode*. Works fine when
using squid as a formal proxy, but when used via https_port intercept,
we end up with IP address certs instead of SNI certs.

We really need someone who knows more to tell us how to make this work :-(


-- 
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150127/3a2a7c1d/attachment.htm>

From yvoinov at gmail.com  Mon Jan 26 22:13:22 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Tue, 27 Jan 2015 04:13:22 +0600
Subject: [squid-users] Host header forgery detected
Message-ID: <54C6BC02.2030400@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Hi gents,

who knows - what does it mean below?

2015/01/27 04:11:42.289 kid1| SECURITY ALERT: Host header forgery
detected on local=192.168.200.3:80 remote=192.168.200.5:9909 FD 18
flags=33 (intercepted port does not match 443)
2015/01/27 04:11:42.289 kid1| SECURITY ALERT: By user agent:
2015/01/27 04:11:42.289 kid1| SECURITY ALERT: on URL:
stnd-lueg.crsi.symantec.com:443
2015/01/27 04:11:42.289 kid1| abandoning local=192.168.200.3:80
remote=192.168.200.5:9909 FD 18 flags=33
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUxrwCAAoJENNXIZxhPexGkQYIAIBgPyeMcBo6dkODMeL7V9vD
n26ae8SCJ9psrKeVfvKOsA0brrsap5pjfGbhwAXux9ei95uHCysdiuKJbQbSjoKR
KLXpUv166MDbn2zoQwa7Xsl1akF5YPjKPtPZd03UCmeuNkb3bk0SCWTL7KnGfTlz
a4kH1Z7En6cw+31G7KprcaNI49WXSm6bRxDWMTaLSn0gOGFLrZ8bUuvippyC7K1/
fEb5D4JvWTPAuN7UswtD6f0gDJwU47vITzkLtylJKH9K/e5sFwNmthOedRZ60oqB
SJrM7Y8901JkznHX46xNSVk9HyoAJO4FayX6QbTkfTgsGcormzrgCbzO9XTw9Kw=
=IN2r
-----END PGP SIGNATURE-----



From dan at getbusi.com  Mon Jan 26 22:13:40 2015
From: dan at getbusi.com (Dan Charlesworth)
Date: Tue, 27 Jan 2015 09:13:40 +1100
Subject: [squid-users] HTTPS intercept,
	simple configuration to avoid bank bumping
In-Reply-To: <54C6B2B4.4070307@trimble.com>
References: <42DE25A255671C44A93A7B58470DC09C5E2B24D3@Michelle.aplitec.local>
 <54C67F2D.6070502@gmail.com>
 <CAOsHgttD1fJN1GGuzQA-31Ksv6zuzfGUu8ZPCf3RQ54YxDRanw@mail.gmail.com>
 <54C6B2B4.4070307@trimble.com>
Message-ID: <CAN8nrKDYDRgoe2Du6OSAos8SRtTvLQYxzj-wcZZFRvbJO=qM_A@mail.gmail.com>

Wasn't somebody saying that you'd need write an External ACL to evaluate
the SNI host because dstdomain isn't hooked into that code (yet? ever?)?

On 27 January 2015 at 08:33, Jason Haar <Jason_Haar at trimble.com> wrote:

>
> Well the documentation says
>
> #   SslBump1: After getting TCP-level and HTTP CONNECT info.
> #   SslBump2: After getting SSL Client Hello info.
> #   SslBump3: After getting SSL Server Hello info.
>
>
> So that means SslBump1 only works for direct proxy (ie CONNECT) sessions,
> it's SslBump2 that peeks into the traffic to discover the client SNI
> hostname. So I think you actually need (I'll use more descriptive acl names
> and comment out those that I think don't add any value)
>
> acl domains_nobump dstdomain "/etc/squid/domains_nobump.acl"
> #no added value: acl DiscoverCONNECTHost at_step SslBump1
> acl DiscoverSNIHost at_step SslBump2
> #don't use - breaks bump: acl DiscoverServerHost at_step SslBump3
> #no added value - in fact forces peek for some reason: ssl_bump peek
> DiscoverCONNECTHost all
> ssl_bump peek DiscoverSNIHost all
>
> ssl_bump splice domains_nobump
> #DiscoverSNIHost should now mean Squid knows about all the SNI details
> ssl_bump bump all
>
> Sadly, this doesn't work for me *in transparent mode*. Works fine when
> using squid as a formal proxy, but when used via https_port intercept, we
> end up with IP address certs instead of SNI certs.
>
> We really need someone who knows more to tell us how to make this work :-(
>
>
> --
> Cheers
>
> Jason Haar
> Corporate Information Security Manager, Trimble Navigation Ltd.
> Phone: +1 408 481 8171
> PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150127/5ffa7ac2/attachment.htm>

From squid3 at treenet.co.nz  Tue Jan 27 04:41:19 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 27 Jan 2015 17:41:19 +1300
Subject: [squid-users] Host header forgery detected
In-Reply-To: <54C6BC02.2030400@gmail.com>
References: <54C6BC02.2030400@gmail.com>
Message-ID: <54C716EF.8030904@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 27/01/2015 11:13 a.m., Yuri Voinov wrote:
> 
> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
> 
> Hi gents,
> 
> who knows - what does it mean below?
> 
> 2015/01/27 04:11:42.289 kid1| SECURITY ALERT: Host header forgery 
> detected on local=192.168.200.3:80 remote=192.168.200.5:9909 FD 18 
> flags=33 (intercepted port does not match 443) 2015/01/27
> 04:11:42.289 kid1| SECURITY ALERT: By user agent: 2015/01/27
> 04:11:42.289 kid1| SECURITY ALERT: on URL: 
> stnd-lueg.crsi.symantec.com:443 2015/01/27 04:11:42.289 kid1|
> abandoning local=192.168.200.3:80 remote=192.168.200.5:9909 FD 18
> flags=33


http://wiki.squid-cache.org/KnowledgeBase/HostHeaderForgery


Notice how the origin-server request being intercepted on port *80*
says its on port *443*.

This is either one of the actual attacks the forgery protection was
put in place to prevent (yeas they do happen). Or you have a NAT
somewhere mapping port 443 onto port 80 before it gets to the proxy
machine.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUxxbvAAoJELJo5wb/XPRjTdQIAIOcNaLxWDrXqea1kNR1w+s5
sojo3GdYRDxCZpnFkacHfvP3gKh6lGvCBOGztVx9u0Xn9Jce8VBKwgf0nUTeYOX3
nIzpwFTONpSAEo1LJDbuilbciQh6uSj5TFWJK4XhHlARURWWTAax1+9SZZHpTKt0
MulqF0nmka+qqeETVZ19qpTowbEmdD8NLI4k5e9xDwUGXicSuy5tpGYsxZKM3vbB
muIexuZlAajsIK7MyFepipvGqMLbQ86O/Pi7fgyCjK9ZMzimAdvygi/gv2kJiXmt
YzWPXqROX4qXrnmU24W4HBFdZXTzl9Al3Z+oqRpFlzGs2yWVXVFBJLwa19IDM9A=
=efCQ
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Tue Jan 27 08:45:51 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 27 Jan 2015 21:45:51 +1300
Subject: [squid-users] Why 3.5.0.4 generates mimicked certs with server
 IP only when bumping?
In-Reply-To: <54C692A1.7070201@gmail.com>
References: <54AF92FD.3050702@gmail.com> <54AFB042.4000509@treenet.co.nz>
 <54AFB156.5030502@gmail.com> <54AFB416.1040500@treenet.co.nz>
 <54B0313D.5070500@gmail.com>
 <CAOsHgtuqa9RKPHegP03HEh+Ys+Ur422tSG7ScwXmuWm8qOCQvw@mail.gmail.com>
 <1422260905864.73930@diladele.com>
 <CAOsHgtsf6j=gtASvmCFVUwko66OXxd=RGOYuAa3cozgks9LiAA@mail.gmail.com>
 <54C6627B.7080903@gmail.com>
 <CAOsHgttwr=JCj0rCOLeB3dwSk=RmU_ir_A5055q1nci5cv71Tg@mail.gmail.com>
 <54C66D3F.9010300@gmail.com> <54C67A54.8090306@treenet.co.nz>
 <54C67ACD.8000809@gmail.com>
 <CAOsHgtt4KQFyAx5nSrWb9j6ioedkK=09naVcd11cn7isf_0CjA@mail.gmail.com>
 <54C692A1.7070201@gmail.com>
Message-ID: <54C7503F.4010206@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 27/01/2015 8:16 a.m., Yuri Voinov wrote:
> 
> No one ssl_bump combination did not work.
> 
> With your config I see only:
> 
> 1422299531.482  18722 192.168.100.5 TCP_TUNNEL/200 99418 CONNECT 
> 128.121.22.133: 443 - ORIGINAL_DST/128.121.22.133 -
> 
> and connection does'nt established.

That is a non-bumped TUNNEL.

If connection is not established for TUNNEL the bug is either in TCP
connecting to the server, or in the TLS/SSL directly between server
and client - Squid is not taking part.

The fact that it is a TUNNEL instead of bumped (MISS) is a separate
issue that others seem not to be having.


> 
> No errors - no bump. Certs generated, but strange - without FQDN
> CN's.
> 
> 27.01.2015 0:26, Daniel Greenwald ?????:
>> Thank you Amos, I have updated to bump. Working well just the
>> same.. Even chrome doesn't complain for google properties. Very
>> nice.
> 
>> ----------- Daniel I Greenwald
> 

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUx1A/AAoJELJo5wb/XPRj5zAH/i2R1ltgmqigDdrrIdAqbvo0
/uwoasnqcwcNBDu7j5rONLy5J+CUDXPelB5rU9lRg5YrjnjbK2mRtN+z+zKzmSjb
jcEc+VWJMWQGFpLcMImJPyUR52h0qum/JF+iCYi9bl8XjX1UTmtm804/oB7sh03C
hKa37CmxYMR1s+4EBjRbIgwGO5dVPiHvmAqPH/CI7O4rO5pddCcyul2yLlvtZPyA
KOlOkcLI89LAGU58HlcGBtiAvvAKt8TrrtlofMUcjKDD5EcHdV8F61p+DSuY1nX2
WJf03dGsSIpZ6esmYwaUA2jiIafpPkr0RcK67nnN9GvB6LzZlRJL4ZyKYIESy1E=
=aMQ1
-----END PGP SIGNATURE-----


From yvoinov at gmail.com  Tue Jan 27 09:22:55 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Tue, 27 Jan 2015 15:22:55 +0600
Subject: [squid-users] Host header forgery detected
In-Reply-To: <54C716EF.8030904@treenet.co.nz>
References: <54C6BC02.2030400@gmail.com> <54C716EF.8030904@treenet.co.nz>
Message-ID: <54C758EF.30505@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Oh, shi......

It can't be on proxy host or other infrastructure. It can be on these
client......

Let's check.

27.01.2015 10:41, Amos Jeffries ?????:


-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUx1jpAAoJENNXIZxhPexG24YIAL1nclnWcuX7GGrTKAFYHz3f
Ol7gmKPAXHk0TWYB5ukrw9RZzDfIlJu45JRK2pp2Vql8UAOjmu/WUsROmrZrkTuI
zuTRS/m6tJlWvYJNqhnyQ2X79ebi9/FbqSh+iwWl1HAdDMz/psm6eVHK1NnBiEU2
JeBIFeiSA+UnNcSVjoBQLqOnFezQwcXt3MVnAkyEes9ql0dm7pJTkuSzL+JgA5xS
NHitL7Ho2zK/mgANdAc3xTRnDMRt3hlt6Sm2QJB9eiAf4kasHenYjEUEp5pjgUnH
jWt8ngBmIEQEj6fJNwaG4/hliGGnlbVYZUfi7tFWJyupKla5rS/Urm41H/om1bo=
=LVf4
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150127/91183459/attachment.htm>

From yvoinov at gmail.com  Tue Jan 27 09:22:55 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Tue, 27 Jan 2015 15:22:55 +0600
Subject: [squid-users] Host header forgery detected
In-Reply-To: <54C716EF.8030904@treenet.co.nz>
References: <54C6BC02.2030400@gmail.com> <54C716EF.8030904@treenet.co.nz>
Message-ID: <54C758EF.70307@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Oh, shi......

It can't be on proxy host or other infrastructure. It can be on these
client......

Let's check.

27.01.2015 10:41, Amos Jeffries ?????:
> On 27/01/2015 11:13 a.m., Yuri Voinov wrote:
>
> > -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
>
> > Hi gents,
>
> > who knows - what does it mean below?
>
> > 2015/01/27 04:11:42.289 kid1| SECURITY ALERT: Host header forgery
> > detected on local=192.168.200.3:80 remote=192.168.200.5:9909 FD 18
> > flags=33 (intercepted port does not match 443) 2015/01/27
> > 04:11:42.289 kid1| SECURITY ALERT: By user agent: 2015/01/27
> > 04:11:42.289 kid1| SECURITY ALERT: on URL:
> > stnd-lueg.crsi.symantec.com:443 2015/01/27 04:11:42.289 kid1|
> > abandoning local=192.168.200.3:80 remote=192.168.200.5:9909 FD 18
> > flags=33
>
>
> http://wiki.squid-cache.org/KnowledgeBase/HostHeaderForgery
>
>
> Notice how the origin-server request being intercepted on port *80*
> says its on port *443*.
>
> This is either one of the actual attacks the forgery protection was
> put in place to prevent (yeas they do happen). Or you have a NAT
> somewhere mapping port 443 onto port 80 before it gets to the proxy
> machine.
>
> Amos
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUx1juAAoJENNXIZxhPexGD/4IAKWWJ7Uf29cxIOCwOcMZwkYv
vu/h2FV/hf7W7ZK2XTAr2a2kcCR4YKamlHcftd1/jT9EMLCRhj87xicLoLSqjyJJ
ONAPP6OOy7ib8cNGyEpUhoYL9pui32iwv/lLFQZro7c1cvuJZFheg3RMqXMG4q7l
XAWFiKPsTl8vZ5pWQIrmkeuqBoee6XHZmBErGY/cIcEcn0bAlxMQLgyC1wNg136l
cqZxk5f55SZ03fy+pivjUgy16vWJx5pJyDMJIJh79x7hbE9ZilTDRGnf81+Sie5s
80QmQh17pWMmT9o7CDFG6FdOcDtpn386D7OECrJZYCiorKIctRevF+I/sCQfj3c=
=IQmE
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150127/9e9183c1/attachment.htm>

From yvoinov at gmail.com  Tue Jan 27 09:59:54 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Tue, 27 Jan 2015 15:59:54 +0600
Subject: [squid-users] WARNING: Error Pages Missing Language: en-gb
Message-ID: <54C7619A.7030707@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Squid 3.4.11. Translation enabled. All error pages and directories exists.

But sometimes:

2015/01/27 15:56:48 kid1| WARNING: Error Pages Missing Language: en-gb
2015/01/27 15:56:48 kid1| WARNING: Error Pages Missing Language: en

Why?

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUx2GaAAoJENNXIZxhPexGl2QH/iwX+JUz16SczxEzGXGv3f+K
Q2idKUnZttLs721f0azp3hSn3Vs9rSQTsBIprqX9TigZuTKNgz5MwxAA+f5ftfkJ
A4J/KsdhpasA1viasftvoXFR99dsS3N0/BuRnP1bSWUAHFZM8RiCyJ9KewH6c2ZK
ZGB7qbgxLbnTPKAQrqxrZq8IY+FVnB68EoUqUPM+RfbtWuhXukYlstfEo1k87umI
db07gYfgUrejlenrvWcOVIufISVjkIs8I4ERLKtjxvWEmJHapDWwakCj6CzUk3Ci
MubiZ+3eBY5RJVJZpf+uSzwzt6JQvr6JLK5MrxxVkheGjXprslODLYytKuhZsaA=
=evs0
-----END PGP SIGNATURE-----



From squid3 at treenet.co.nz  Tue Jan 27 10:23:22 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 27 Jan 2015 23:23:22 +1300
Subject: [squid-users] WARNING: Error Pages Missing Language: en-gb
In-Reply-To: <54C7619A.7030707@gmail.com>
References: <54C7619A.7030707@gmail.com>
Message-ID: <54C7671A.60104@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 27/01/2015 10:59 p.m., Yuri Voinov wrote:
> 
> Squid 3.4.11. Translation enabled. All error pages and directories
> exists.
> 
> But sometimes:
> 
> 2015/01/27 15:56:48 kid1| WARNING: Error Pages Missing Language:
> en-gb 2015/01/27 15:56:48 kid1| WARNING: Error Pages Missing
> Language: en
> 
> Why?
> 

en-gb ... maybe missing the dialect alias symlinks.

en ... not a clue.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUx2cZAAoJELJo5wb/XPRjdeQH/ixmyIkiVNcHAwfitpIIaiwb
LkeA2/Jvbi8+GfDsEj8f9bcwO8ygvqhcghReSQUs/gSTg51MYqGYmFqPNks/aYk9
eOT6dGKnVBBwd225xS1zpuIURp61QOCTw+AdxNUDTaC6IzQ66MsGpl4j2mDNvjGU
Ue0BS8/oS3xMzKz2OLY90nS3yRVhMbUZYwYn4ZltYuGZ3YAV02J9G/pq6wmykvVY
lbNl4jL0fsecGvlvmHwUeyXASfe9CNoET9geW9duVlP3wwZoFAqnwcHoC3bryvVF
UoEVV9t0fuDX5kGXQFpofPQlk/d3CslHHFcFDagyxIgKMlf+LHhIY0nXZsNnYDE=
=BC2d
-----END PGP SIGNATURE-----


From yvoinov at gmail.com  Tue Jan 27 10:27:03 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Tue, 27 Jan 2015 16:27:03 +0600
Subject: [squid-users] WARNING: Error Pages Missing Language: en-gb
In-Reply-To: <54C7671A.60104@treenet.co.nz>
References: <54C7619A.7030707@gmail.com> <54C7671A.60104@treenet.co.nz>
Message-ID: <54C767F7.9060501@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Exist:

http://i.imgur.com/JJAkR0x.png

And I am not a clue.

27.01.2015 16:23, Amos Jeffries ?????:
> not a clue.

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUx2f2AAoJENNXIZxhPexG/O0H/0hKC9X3ejf0sFAKbrdR9fRB
BGAXsrArs+t9fpwXKR8DiFmgmxDizu+vQoVlvDPDAZlwlRacsAcf3X8StfmSYXix
rct9aitLAbOL1+MbMmPRPsWsiNk2XgKdj1XqtVMLn2RzNhyxwtmo0EWiDMdIcq2H
ffQJWm/PisKwZEZ9xZ02TpRQ3n4FWqydWeDEZNNIaUnA9OOuvSyUohhbIg2L1aZf
Q9ObwPJZJAbLhxMM70tCoZ7mD9tWhQRK18gOfegM12w4k/QKBkZDsqQ1XctU4hs7
uNGJ/7kQ2Y8d2qrz7Evn9tJUVWygnyEJLeUVSrX0cdCc2z7pp//Jtf1qOXAK9UI=
=imBS
-----END PGP SIGNATURE-----



From jborrell at central.aplitec.com  Tue Jan 27 10:33:41 2015
From: jborrell at central.aplitec.com (Josep Borrell)
Date: Tue, 27 Jan 2015 10:33:41 +0000
Subject: [squid-users] HTTPS intercept,
 simple configuration to avoid bank bumping
In-Reply-To: <54C6B2B4.4070307@trimble.com>
References: <42DE25A255671C44A93A7B58470DC09C5E2B24D3@Michelle.aplitec.local>
 <54C67F2D.6070502@gmail.com>
 <CAOsHgttD1fJN1GGuzQA-31Ksv6zuzfGUu8ZPCf3RQ54YxDRanw@mail.gmail.com>
 <54C6B2B4.4070307@trimble.com>
Message-ID: <42DE25A255671C44A93A7B58470DC09C5E2B3433@Michelle.aplitec.local>

I agree.
Are there someone with the skills to help us with a working sample ?
is an external ACL needed as Dan remarks ?
maybe the peek and splice feature need some tuning ?
if I can help with something, tell me.

Josep



De: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] En nombre de Jason Haar
Enviado el: lunes, 26 de enero de 2015 22:34
Para: squid-users at lists.squid-cache.org
Asunto: Re: [squid-users] HTTPS intercept, simple configuration to avoid bank bumping


Well the documentation says

#   SslBump1: After getting TCP-level and HTTP CONNECT info.
#   SslBump2: After getting SSL Client Hello info.
#   SslBump3: After getting SSL Server Hello info.


So that means SslBump1 only works for direct proxy (ie CONNECT) sessions, it's SslBump2 that peeks into the traffic to discover the client SNI hostname. So I think you actually need (I'll use more descriptive acl names and comment out those that I think don't add any value)

acl domains_nobump dstdomain "/etc/squid/domains_nobump.acl"
#no added value: acl DiscoverCONNECTHost at_step SslBump1
acl DiscoverSNIHost at_step SslBump2
#don't use - breaks bump: acl DiscoverServerHost at_step SslBump3
#no added value - in fact forces peek for some reason: ssl_bump peek DiscoverCONNECTHost all
ssl_bump peek DiscoverSNIHost all

ssl_bump splice domains_nobump
#DiscoverSNIHost should now mean Squid knows about all the SNI details
ssl_bump bump all

Sadly, this doesn't work for me *in transparent mode*. Works fine when using squid as a formal proxy, but when used via https_port intercept, we end up with IP address certs instead of SNI certs.

We really need someone who knows more to tell us how to make this work :-(


--
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150127/0459f4c3/attachment.htm>

From yvoinov at gmail.com  Tue Jan 27 10:49:10 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Tue, 27 Jan 2015 16:49:10 +0600
Subject: [squid-users] Error negotiating SSL connection on FD 20:
 error:00000000:lib(0):func(0):reason(0) (5/-1/131)
In-Reply-To: <1422305395708-4669351.post@n4.nabble.com>
References: <54C677E5.3050400@gmail.com> <54C67C68.6040107@gmail.com>
 <1422305395708-4669351.post@n4.nabble.com>
Message-ID: <54C76D26.5020404@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
131 error means:

CONNECTED(00000003)
write:errno=131
- ---
no peer certificate available
- ---
No client certificate CA names sent
- ---
SSL handshake has read 0 bytes and written 148 bytes
- ---
New, (NONE), Cipher is (NONE)

Looks like something intermediate CA (or may be root) is absent.

27.01.2015 2:49, HackXBack ?????:
> when you know tell me because i asked this question before here and i didnt
> get any answer
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/Error-negotiating-SSL-connection-on-FD-20-error-00000000-lib-0-func-0-reason-0-5-1-131-tp4669338p4669351.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUx20lAAoJENNXIZxhPexGZXYH/jGfjyXrRkYWFq4eo/AXuyN5
HokT2LiWAFICkIi7vFefHwU1t3IzD0nwCooeX6Dr0g27kF9rcwlWaZzcFhuYQVt2
PdEB8iLVvly5g5YQH26t3KUXx1s92wlBbnQ2IAHD9Fsbedu6RtzI/ineuZyUP8eP
EU4LWe6eAkfKaUEniS0Xm3+78sk7NnBMxCAhWy6m7GZkjF05VQT0fffVzSD+61aP
dObM1zCZmVbrrLkCMYgPmI1qP5m0oluC6uWMpKADkpd+Nwn04IpcmT52Cduvy+eR
VE+QtIhBRUNDoHkJr/59C5mdt3Cf5UzFkCqqg7SbkTvJndEVFuXCN0LrWCQHZW4=
=HViZ
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150127/00b5f5cc/attachment.htm>

From odhiambo at gmail.com  Tue Jan 27 13:03:50 2015
From: odhiambo at gmail.com (Odhiambo Washington)
Date: Tue, 27 Jan 2015 16:03:50 +0300
Subject: [squid-users] squid-3.5.0.4 coredump on FreeBSD 10.1
Message-ID: <CAAdA2WO-uwpXhSt_LsB=mJdh_aLKLKVEz+RmJoV9C4bftWNVwQ@mail.gmail.com>

Upon squid -k parse, I get a segmentation fault/coredump.


FreeBSD banter 10.1-RELEASE FreeBSD 10.1-RELEASE #0: Sat Jan 24 09:09:29
EAT 2015     root at banter:/usr/obj/usr/src/sys/BEASTIE-10.x  amd64

root at mail:/opt/squid-3.5.0.4 # ./sbin/squid -v
Squid Cache: Version 3.5.0.4
Service Name: squid
configure options:  '--prefix=/opt/squid-3.5.0.4'
'--enable-removal-policies=lru heap' '--disable-epoll' '--enable-auth'
'--enable-auth-basic=DB
NCSA PAM PAM POP3 SSPI' '--enable-external-acl-helpers=session unix_group
file_userip' '--enable-auth-negotiate=kerberos' '--with-pthreads' '--en
able-storeio=ufs diskd rock aufs' '--enable-delay-pools' '--enable-snmp'
'--with-openssl=/usr' '--enable-forw-via-db' '--enable-cache-digests' '-
-enable-wccpv2' '--enable-follow-x-forwarded-for' '--with-large-files'
'--enable-large-cache-files' '--enable-esi' '--enable-kqueue' '--enable-ic
ap-client' '--enable-kill-parent-hack' '--enable-ssl' '--enable-leakfinder'
'--enable-ssl-crtd' '--enable-url-rewrite-helpers' '--enable-xmalloc-
statistics' '--enable-stacktraces' '--enable-zph-qos' '--enable-eui'
'--with-nat-devpf' '--enable-pf-transparent' 'CC=clang' 'CXX=clang++'
--enable-ltdl-convenience


GNU gdb 6.1.1 [FreeBSD]
Copyright 2004 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain
conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "amd64-marcel-freebsd"...
Core was generated by `squid'.
Program terminated with signal 11, Segmentation fault.
Reading symbols from /usr/lib/librt.so.1...done.
Loaded symbols for /usr/lib/librt.so.1
Reading symbols from /usr/local/lib/libnettle.so.4...done.
Loaded symbols for /usr/local/lib/libnettle.so.4
Reading symbols from /usr/local/lib/libxml2.so.2...done.
Loaded symbols for /usr/local/lib/libxml2.so.2
Reading symbols from /usr/local/lib/libexpat.so.1...done.
Loaded symbols for /usr/local/lib/libexpat.so.1
Reading symbols from /usr/lib/libssl.so.7...done.
Loaded symbols for /usr/lib/libssl.so.7
Reading symbols from /usr/lib/libgssapi.so.10...done.
Loaded symbols for /usr/lib/libgssapi.so.10
Reading symbols from /usr/lib/libgssapi_krb5.so.10...done.
Loaded symbols for /usr/lib/libgssapi_krb5.so.10
Reading symbols from /usr/lib/libheimntlm.so.11...done.
Loaded symbols for /usr/lib/libheimntlm.so.11
Reading symbols from /usr/lib/libkrb5.so.11...done.
Loaded symbols for /usr/lib/libkrb5.so.11
Reading symbols from /usr/lib/libhx509.so.11...done.
Loaded symbols for /usr/lib/libhx509.so.11
Reading symbols from /usr/lib/libcom_err.so.5...done.
Loaded symbols for /usr/lib/libcom_err.so.5
Reading symbols from /lib/libcrypto.so.7...done.
Loaded symbols for /lib/libcrypto.so.7
Reading symbols from /usr/lib/libasn1.so.11...done.
Loaded symbols for /usr/lib/libasn1.so.11
Reading symbols from /usr/lib/libwind.so.11...done.
Loaded symbols for /usr/lib/libwind.so.11
Reading symbols from /usr/lib/libheimbase.so.11...done.
Loaded symbols for /usr/lib/libheimbase.so.11
Reading symbols from /usr/lib/libroken.so.11...done.
Loaded symbols for /usr/lib/libroken.so.11
Reading symbols from /lib/libcrypt.so.5...done.
Loaded symbols for /lib/libcrypt.so.5
Reading symbols from /lib/libm.so.5...done.
Loaded symbols for /lib/libm.so.5
Reading symbols from /usr/lib/libc++.so.1...done.
Loaded symbols for /usr/lib/libc++.so.1
Reading symbols from /lib/libcxxrt.so.1...done.
Loaded symbols for /lib/libcxxrt.so.1
Reading symbols from /lib/libgcc_s.so.1...done.
Loaded symbols for /lib/libgcc_s.so.1
Reading symbols from /lib/libthr.so.3...done.
Loaded symbols for /lib/libthr.so.3
Reading symbols from /lib/libc.so.7...done.
Loaded symbols for /lib/libc.so.7
Reading symbols from /lib/libz.so.6...done.
Loaded symbols for /lib/libz.so.6
Reading symbols from /usr/lib/liblzma.so.5...done.
Loaded symbols for /usr/lib/liblzma.so.5
Reading symbols from /usr/lib/private/libheimipcc.so.11...done.
Loaded symbols for /usr/lib/private/libheimipcc.so.11
Reading symbols from /libexec/ld-elf.so.1...done.
Loaded symbols for /libexec/ld-elf.so.1
#0  0x000000080423976b in strlen () from /lib/libc.so.7
[New Thread 805006400 (LWP 100229/squid)]
(gdb) bt full
#0  0x000000080423976b in strlen () from /lib/libc.so.7
No symbol table info available.
#1  0x0000000000515d07 in std::__1::operator<< <std::__1::char_traits<char>
> (__os=@0x80516e280, __str=0x0) at string:651
        __len = <value optimized out>
        __s = {__ok_ = true, __os_ = @0x80516e280}
#2  0x00000000006c138c in ~ACL (this=0xb87710) at Acl.cc:378
        _dbo = <value optimized out>
#3  0x0000000804214a00 in __cxa_finalize () from /lib/libc.so.7
No symbol table info available.
#4  0x00000008041b5e8c in exit () from /lib/libc.so.7
No symbol table info available.
#5  0x000000000050f4b6 in _start ()
No symbol table info available.
#6  0x0000000800b87000 in ?? ()
No symbol table info available.
#7  0x0000000000000000 in ?? ()
No symbol table info available.
(gdb)



-- 
Best regards,
Odhiambo WASHINGTON,
Nairobi,KE
+254733744121/+254722743223
"I can't hear you -- I'm using the scrambler."
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150127/227234a5/attachment.htm>

From gecom at tubosider.it  Tue Jan 27 13:44:07 2015
From: gecom at tubosider.it (masterx81)
Date: Tue, 27 Jan 2015 05:44:07 -0800 (PST)
Subject: [squid-users] Squid and site ryanair.com
In-Reply-To: <54BDB6B3.9010409@treenet.co.nz>
References: <1421337529987-4669105.post@n4.nabble.com>
 <54B88B33.5010701@treenet.co.nz> <1421692947043-4669205.post@n4.nabble.com>
 <54BDB6B3.9010409@treenet.co.nz>
Message-ID: <1422366247155-4669366.post@n4.nabble.com>

I'll doubt is a chrome bug, as with direct connection i've not any problem...



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-and-site-ryanair-com-tp4669105p4669366.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From ncrogers at gmail.com  Tue Jan 27 18:10:13 2015
From: ncrogers at gmail.com (Nick Rogers)
Date: Tue, 27 Jan 2015 10:10:13 -0800
Subject: [squid-users] 3.4.11 coredumps and restarts upon shutdown under
	FreeBSD 10.1-RELEASE
Message-ID: <CAKOb=YafFaPvqTwahBpa01q+NfB58pn=M+U9n_UdKZvCx=yCmA@mail.gmail.com>

Hello,

I thought I would make everyone on this list aware of an issue between
squid 3.4.x (and perhaps 3.5?) and FreeBSD 10.1-RELEASE. There was a
regression in the FreeBSD 10.1-RELEASE kernel's signal handling behavior
that causes squid to coredump and restart itself when receiving the
shutdown signal (i.e., squid -k shutdown). The problem has been fixed in
FreeBSD 10.1-STABLE (10/stable), but will likely not be applied to
10.1-RELEASE (releng/10.1). So it is bound to affect many squid users
running FreeBSD.

More information about the kernel bug can be found here:
https://bugs.freebsd.org/bugzilla/show_bug.cgi?id=195802
https://lists.freebsd.org/pipermail/freebsd-threads/2014-November/005611.html

There is an ongoing discussion about how it affects the squid port here:
https://www.mail-archive.com/freebsd-ports at freebsd.org/msg63515.html

The working fix is to apply two different patches to the 10.1-RELEASE
kernel and run off a custom kernel. Perhaps there is some kind of
workaround squid could employ if the problem is not fixed in 10.1-RELEASE?
I'm not suggesting this as a good idea, and I'm personally comfortable with
running a custom kernel as I do this already, but it seems that a lot of
people are starting to run into this problem who are not so comfortable.

Hopefully this helps someone running into this strange problem.

-Nick
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150127/46387d4b/attachment.htm>

From ahmed.zaeem at netstream.ps  Wed Jan 28 05:54:44 2015
From: ahmed.zaeem at netstream.ps (Ahmad)
Date: Tue, 27 Jan 2015 21:54:44 -0800
Subject: [squid-users] testttttt
Message-ID: <00c901d03abe$eba9b7b0$c2fd2710$@netstream.ps>

testttttt

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150127/79f2021f/attachment.htm>

From ahmed.zaeem at netstream.ps  Wed Jan 28 06:04:52 2015
From: ahmed.zaeem at netstream.ps (Ahmad)
Date: Tue, 27 Jan 2015 22:04:52 -0800
Subject: [squid-users] squid cache peer with many sessions round robin to
	the same destination , is that possible ?
Message-ID: <00d301d03ac0$55d5ef40$0181cdc0$@netstream.ps>

Hi mates ,

 

I have a proxy provider that give me may sessions , and each session is per
username and pwd.

As an example , I have the provider 1.1.1.1 with 5 usernames

Each username will give me different ip.

 

I need to do on my proxy something like cache peer to the ip 1.1.1.1 and
need to set 5 lines config each line with user/pwd .

 

But squid provent me and told me it's the same destination .

As wt I need will looks like :

cache_peer  1111  parent  0 no-query round-robin no-digest no-tproxy
proxy-only login=lum-customer-datahen-zone-gen-session-1:374feafff
cache_peer  1111  parent  0 no-query round-robin no-digest no-tproxy
proxy-only login=lum-customer-datahen-zone-gen-session-2:dsfdsf


cache_peer  1111  parent  0 no-query round-robin no-digest no-tproxy
proxy-only login=lum-customer-datahen-zone-gen-session-3:dds


cache_peer  1111  parent  0 no-query round-robin no-digest no-tproxy
proxy-only login=lum-customer-datahen-zone-gen-session-4:dfds


cache_peer  1111  parent  0 no-query round-robin no-digest no-tproxy
proxy-only login=lum-customer-datahen-zone-gen-session-5:dfds

 

 

but squid don't allow me and let me only set 1 line  with 1 username  :

 

so wts the solution to use 5 usernames with roundrobin from the same
provider ?

 

 

cheers

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150127/f3247d98/attachment.htm>

From Jason_Haar at trimble.com  Tue Jan 27 20:09:10 2015
From: Jason_Haar at trimble.com (Jason Haar)
Date: Wed, 28 Jan 2015 09:09:10 +1300
Subject: [squid-users] HTTPS intercept,
 simple configuration to avoid bank bumping
In-Reply-To: <CAN8nrKDYDRgoe2Du6OSAos8SRtTvLQYxzj-wcZZFRvbJO=qM_A@mail.gmail.com>
References: <42DE25A255671C44A93A7B58470DC09C5E2B24D3@Michelle.aplitec.local>	<54C67F2D.6070502@gmail.com>	<CAOsHgttD1fJN1GGuzQA-31Ksv6zuzfGUu8ZPCf3RQ54YxDRanw@mail.gmail.com>	<54C6B2B4.4070307@trimble.com>
 <CAN8nrKDYDRgoe2Du6OSAos8SRtTvLQYxzj-wcZZFRvbJO=qM_A@mail.gmail.com>
Message-ID: <54C7F066.9010702@trimble.com>

On 27/01/15 11:13, Dan Charlesworth wrote:
> Wasn't somebody saying that you'd need write an External ACL to
> evaluate the SNI host because dstdomain isn't hooked into that code
> (yet? ever?)?

That can't be the case. If the external ACL is called without the SNI,
then at best all it can do is connect to an IP address and scrape the
server response. But some SSL servers (especially WAFs) are configured
to DROP connections if they don't see a client SNI (I've seen this with
CDN networks with my own experience with external ACLs). Only squid has
access to the SNI - it has to be done in squid code.

Jason


-- 
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150128/3172d04d/attachment.htm>

From ahmed.zaeem at netstream.ps  Wed Jan 28 06:10:47 2015
From: ahmed.zaeem at netstream.ps (Ahmad)
Date: Tue, 27 Jan 2015 22:10:47 -0800
Subject: [squid-users] how long object size can squid 3.5.2 handle ?
Message-ID: <00e201d03ac1$2968d660$7c3a8320$@netstream.ps>

Hi dev ,

how long object size can squid 3.5.2 handle ??

it says >>than 32KB

 

is that for memory or  disk caching  or for both ???? 

 

I mean does that mean on memory  the hot object will be >>32KB ? 

 

And in  rock store >>32 also ?

 

If >>32 Kb how much ?

 

500 Kb ? 1M or more or  less ?

Just curious and need to know what the max size we can save fo far

 

cheers

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150127/1500f380/attachment.htm>

From yvoinov at gmail.com  Tue Jan 27 20:29:34 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Wed, 28 Jan 2015 02:29:34 +0600
Subject: [squid-users] how long object size can squid 3.5.2 handle ?
In-Reply-To: <00e201d03ac1$2968d660$7c3a8320$@netstream.ps>
References: <00e201d03ac1$2968d660$7c3a8320$@netstream.ps>
Message-ID: <54C7F52E.9040607@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
In 3.5.2?  :) It already released? :)

But really - with 64 bit build with enough RAM under 64 bit OS on 64 bit
(or 128 bit) filesystem you can save as big object your want with any
Squid. :)

28.01.2015 12:10, Ahmad ?????:


-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUx/UkAAoJENNXIZxhPexGh+oIAK0TiCtcpn9Pjp9ccxnSpHQj
vTEDKrei2CNdz2JUTk3La8oQReQnLa31xyCFKGA8PBcuNCng+mbv5psNEULczvuS
j7DNgM9hEHYjENTcvuMfvpCEnQLNboSD8vFn8haJKxJ3nxaFuBtE7aaeg/ovix6q
9isJ0QXKhp5MwTSMXCko0dfbjqOHey5ve5aRQygcTt0TiC/LoXwCDPbunH2gVVnr
dFrcCyi1KifjcuAq7RdVzqyG6KEhuhcIhewQkso4S9G19CAFXorgmTMHS7RkliX3
mRcFVFTRAHoN+J1naah6VOWN9KkAVcdhsQwQCgVLZHvLhmZ08svCBgmBBXNnaiM=
=0CI9
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150128/fca5e722/attachment.htm>

From yvoinov at gmail.com  Tue Jan 27 20:29:34 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Wed, 28 Jan 2015 02:29:34 +0600
Subject: [squid-users] how long object size can squid 3.5.2 handle ?
In-Reply-To: <00e201d03ac1$2968d660$7c3a8320$@netstream.ps>
References: <00e201d03ac1$2968d660$7c3a8320$@netstream.ps>
Message-ID: <54C7F52D.5050107@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
In 3.5.2?  :) It already released? :)

But really - with 64 bit build with enough RAM under 64 bit OS on 64 bit
(or 128 bit) filesystem you can save as big object your want with any
Squid. :)

28.01.2015 12:10, Ahmad ?????:
>
> Hi dev ,
>
> how long object size can squid 3.5.2 handle ??
>
> it says >>than 32KB
>
> 
>
> is that for memory or  disk caching  or for both ????
>
> 
>
> I mean does that mean on memory  the hot object will be >>32KB ?
>
> 
>
> And in  rock store >>32 also ?
>
> 
>
> If >>32 Kb how much ?
>
> 
>
> 500 Kb ? 1M or more or  less ?
>
> Just curious and need to know what the max size we can save fo far
>
> 
>
> cheers
>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUx/UsAAoJENNXIZxhPexG12QH+wVlEyCkkLJ4c3J+s2ii4Z8E
kBj/E6RCHhDk3XUK6zJ7zj8uK7PQyUTkjgvWOGXn4hyh5h01pxD6Gjnlq6iBjKKd
bcUztsphbLAZ/dRGCDszbMny5BMuEDp5AXH4artlfUEkaEy9F82j8rcGlEpGJQ9r
Pbpvll884UKaPld/TWWPKYLK2IQi52c7eOLH7wPW9lHOKJkpSGrQ/P4IC0JQGz2u
qr18FhWZz2Dqwt4o0Kxf3GVmoybignsyj7wqX6FIYXd6fknZDyUBI20kNEPR029k
Mskk1k296jy3kjcOT2Q40d2Nb3PDrPDJCJZRSNb9up8i/1KFeeU7GH0rfryj+Ww=
=elVq
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150128/66de4b20/attachment.htm>

From squid3 at treenet.co.nz  Tue Jan 27 21:01:42 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 28 Jan 2015 10:01:42 +1300
Subject: [squid-users] testttttt
In-Reply-To: <00c901d03abe$eba9b7b0$c2fd2710$@netstream.ps>
References: <00c901d03abe$eba9b7b0$c2fd2710$@netstream.ps>
Message-ID: <54C7FCB6.4020301@treenet.co.nz>

On 28/01/2015 6:54 p.m., Ahmad wrote:
> testttttt
> 

Ping. This got through.

Amos



From Jason_Haar at trimble.com  Tue Jan 27 21:02:35 2015
From: Jason_Haar at trimble.com (Jason Haar)
Date: Wed, 28 Jan 2015 10:02:35 +1300
Subject: [squid-users] HTTPS intercept,
 simple configuration to avoid bank bumping
In-Reply-To: <54C7F066.9010702@trimble.com>
References: <42DE25A255671C44A93A7B58470DC09C5E2B24D3@Michelle.aplitec.local>	<54C67F2D.6070502@gmail.com>	<CAOsHgttD1fJN1GGuzQA-31Ksv6zuzfGUu8ZPCf3RQ54YxDRanw@mail.gmail.com>	<54C6B2B4.4070307@trimble.com>
 <CAN8nrKDYDRgoe2Du6OSAos8SRtTvLQYxzj-wcZZFRvbJO=qM_A@mail.gmail.com>
 <54C7F066.9010702@trimble.com>
Message-ID: <54C7FCEB.6070103@trimble.com>

I might have found something

Turning up debugging shows that squid is learning the SNI value from an
intercepted/transparent HTTPS session (or is it learnt from the server
response?)

2015/01/28 09:23:34.328 kid1| bio.cc(835) parseV3Hello: Found server
name: www.kiwibank.co.nz

Looking that up in the source code, it's from bio.cc. However the same
file implies I should also be seeing the SNI debug line:

#if defined(TLSEXT_NAMETYPE_host_name)
    if (const char *server = SSL_get_servername(ssl,
TLSEXT_NAMETYPE_host_name))
        serverName = server;
    debugs(83, 7, "SNI server name: " << serverName);
#endif


On my test Ubuntu 14.04 laptop with squid-3.5.1 and openssl-1.0.1f,
TLSEXT_NAMETYPE_host_name is defined in /usr/include/openssl/tls1.h, so
that should cause that debug line to be called - but it isn't?

I also confirmed with wireshark that my Firefox browser was generating a
SNI (although it took me a few minutes to realise I have to sniff port
3129 [which I redirected 443 onto] as well as 443 to get the full tcp
session)

-- 
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1



From yvoinov at gmail.com  Tue Jan 27 21:13:01 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Wed, 28 Jan 2015 03:13:01 +0600
Subject: [squid-users] testttttt
In-Reply-To: <54C7FCB6.4020301@treenet.co.nz>
References: <00c901d03abe$eba9b7b0$c2fd2710$@netstream.ps>
 <54C7FCB6.4020301@treenet.co.nz>
Message-ID: <54C7FF5D.7010004@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Amos,

the better answer is "pong" ;) And don't forget to add TTL ;)

28.01.2015 3:01, Amos Jeffries ?????:
> On 28/01/2015 6:54 p.m., Ahmad wrote:
>> testttttt
>>
>
> Ping. This got through.
>
> Amos
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUx/9cAAoJENNXIZxhPexGjtkH/j0tKOLb1+be3GJ7PHtc5gt1
mme184niJ58kTjpaMVWwfVSMTyYB0jqoY0i94KWv5gJMP7d0+slFPI0pWTFjvL2/
ebJu8DdkQlLpASiRSKXfwACFBigmtCLQV/93DepndfEg2dw3wZg2La6a/rTOTZLy
M9ZOjZ7b6nEmD74mYYLt8shSDwHH/F+KupmCl/fgU3C3yUfUoVPbCNbt1zuv/8D2
yCRSYhYOUnUssITgs0GfE3v5UAbcKIl5d7SdwRUhBiOXtuX9if6qxGTdG8Le69/v
wD4rfol62diS2uEFRBn0rjPkgWM4aulgW2v5/lv9UMhDEiOLmV7JJ7iIZ/+JeZ4=
=Gqqg
-----END PGP SIGNATURE-----



From shenan.hawkins at gmail.com  Tue Jan 27 21:26:54 2015
From: shenan.hawkins at gmail.com (Shenan Hawkins)
Date: Tue, 27 Jan 2015 16:26:54 -0500
Subject: [squid-users] testttttt
In-Reply-To: <54C7FF5D.7010004@gmail.com>
References: <00c901d03abe$eba9b7b0$c2fd2710$@netstream.ps>
 <54C7FCB6.4020301@treenet.co.nz> <54C7FF5D.7010004@gmail.com>
Message-ID: <CAFzetisO548uPiq45bGXRyt6QLG+NzLA0pYTtrDfjbt1bZtXKQ@mail.gmail.com>

1422375352.851 42 127.0.0.1 JOKE_MISS/206 1d0n7 GET http://it

On 27 January 2015 at 16:13, Yuri Voinov <yvoinov at gmail.com> wrote:

>
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Amos,
>
> the better answer is "pong" ;) And don't forget to add TTL ;)
>
> 28.01.2015 3:01, Amos Jeffries ?????:
> > On 28/01/2015 6:54 p.m., Ahmad wrote:
> >> testttttt
> >>
> >
> > Ping. This got through.
> >
> > Amos
> >
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
>
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2
>
> iQEcBAEBAgAGBQJUx/9cAAoJENNXIZxhPexGjtkH/j0tKOLb1+be3GJ7PHtc5gt1
> mme184niJ58kTjpaMVWwfVSMTyYB0jqoY0i94KWv5gJMP7d0+slFPI0pWTFjvL2/
> ebJu8DdkQlLpASiRSKXfwACFBigmtCLQV/93DepndfEg2dw3wZg2La6a/rTOTZLy
> M9ZOjZ7b6nEmD74mYYLt8shSDwHH/F+KupmCl/fgU3C3yUfUoVPbCNbt1zuv/8D2
> yCRSYhYOUnUssITgs0GfE3v5UAbcKIl5d7SdwRUhBiOXtuX9if6qxGTdG8Le69/v
> wD4rfol62diS2uEFRBn0rjPkgWM4aulgW2v5/lv9UMhDEiOLmV7JJ7iIZ/+JeZ4=
> =Gqqg
> -----END PGP SIGNATURE-----
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150127/a716cfe1/attachment.htm>

From squid3 at treenet.co.nz  Tue Jan 27 21:26:49 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 28 Jan 2015 10:26:49 +1300
Subject: [squid-users] Squid and site ryanair.com
In-Reply-To: <1422366247155-4669366.post@n4.nabble.com>
References: <1421337529987-4669105.post@n4.nabble.com>
 <54B88B33.5010701@treenet.co.nz> <1421692947043-4669205.post@n4.nabble.com>
 <54BDB6B3.9010409@treenet.co.nz> <1422366247155-4669366.post@n4.nabble.com>
Message-ID: <54C80299.1040606@treenet.co.nz>

On 28/01/2015 2:44 a.m., masterx81 wrote:
> I'll doubt is a chrome bug, as with direct connection i've not any problem...
> 

Lets see,
 * Chrome, fail
 * Firefox, works via Squid
 * MSIE, works via Squid
 * test tool, works via Squid

There is also the factum that direct non-proxied connections do not use
CONNECT mesages, nor Proxy-Auth mechanism. So the behaviour is not
easily comparible.

If you are able to find some trace that shows how things are breaking
through Squid, please followup with them. The access log trace by itself
is not enough to do more than what has already been pointed out.

Amos



From squid3 at treenet.co.nz  Tue Jan 27 21:30:05 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 28 Jan 2015 10:30:05 +1300
Subject: [squid-users] how long object size can squid 3.5.2 handle ?
In-Reply-To: <54C7F52E.9040607@gmail.com>
References: <00e201d03ac1$2968d660$7c3a8320$@netstream.ps>
 <54C7F52E.9040607@gmail.com>
Message-ID: <54C8035D.4020103@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 28/01/2015 9:29 a.m., Yuri Voinov wrote:
> 
> In 3.5.2?  :) It already released? :)

Aye, if that was meant to say 3.5.0.2 (the beta) - then please upgrade
Urgently to current stable.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUyANdAAoJELJo5wb/XPRjNEgH/2mt75TBMsyO32p+Uhlj8fFO
C58bsakkZ6UlmtaD1LZl6TklqIo+Nb7A2v43MMeGDnBLVZjRrAWxdi4d+dFtEisO
P8Ee82yYA5Kl8FrLvvb7b4t6qT7m3s8RxmLDRLCcllQg0BLtgbbHMFVAxvQQiWwM
GT8mDaSBGsX23Xl5HN+vaaPxR5hkLYm6bvMHqRBk898MGGD1YNDKbZWqD5Y4FbIP
LmDoct4QsJso3PbMPGFknGT5jBi3GEi1CSVWKsEq2/cBQ0bKFHpbn2xmgkaFdtKl
zOSakhQnfQ5EHlsf6rNwvPXPja7Lia17glElRZowqjVLjSmGZB80sSm+iH8q9R0=
=Uk3d
-----END PGP SIGNATURE-----


From yvoinov at gmail.com  Tue Jan 27 21:32:25 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Wed, 28 Jan 2015 03:32:25 +0600
Subject: [squid-users] how long object size can squid 3.5.2 handle ?
In-Reply-To: <54C8035D.4020103@treenet.co.nz>
References: <00e201d03ac1$2968d660$7c3a8320$@netstream.ps>
 <54C7F52E.9040607@gmail.com> <54C8035D.4020103@treenet.co.nz>
Message-ID: <54C803E9.1070701@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
I'm waiting for working transparent interception bumping ;)

yet sit on 3.4.11 ;)

28.01.2015 3:30, Amos Jeffries ?????:
> On 28/01/2015 9:29 a.m., Yuri Voinov wrote:
>
> > In 3.5.2?  :) It already released? :)
>
> Aye, if that was meant to say 3.5.0.2 (the beta) - then please upgrade
> Urgently to current stable.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUyAPpAAoJENNXIZxhPexGNwEIAJbe3yQoyCDepULQM7/FU5Gl
oGPVj10bZ8a+slNJX0leXEWuiQd0JadTgPM2gdEmYijTcR8yZD0lH2WRcuok+lGP
vAmPo/JJc/gAyMBpuGwlUttZ+9+7f1uyvcyqvVEgotqgf+vWWp7s3FsXZvF1mgD8
oaHe725fZ63BKROoutEr2EV+ZEZQfGm7sTX9DH+kv4HJ75IJPDmHj0wJRuV1sbt6
CWEoXAsKKir0hhJQiwrKMNrnJgFd1f39PW9nU5FhEljyA4TQe+bBQ//l97+ohzFj
QKhqhzDFlKIurv4wlefzrjwFPP/2UYBC3UbisU+Z4mG6+03z8CqNcghVgXeafzw=
=/zb3
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150128/7155d328/attachment.htm>

From ambrose.li at gmail.com  Tue Jan 27 21:41:37 2015
From: ambrose.li at gmail.com (Ambrose LI)
Date: Tue, 27 Jan 2015 16:41:37 -0500
Subject: [squid-users] testttttt
In-Reply-To: <CAFzetisO548uPiq45bGXRyt6QLG+NzLA0pYTtrDfjbt1bZtXKQ@mail.gmail.com>
References: <00c901d03abe$eba9b7b0$c2fd2710$@netstream.ps>
 <54C7FCB6.4020301@treenet.co.nz> <54C7FF5D.7010004@gmail.com>
 <CAFzetisO548uPiq45bGXRyt6QLG+NzLA0pYTtrDfjbt1bZtXKQ@mail.gmail.com>
Message-ID: <CADJvFOVZ1sk2s7=KxCOnN+nPSQKb-sGvkCLO+u3J+C-g8Bce4Q@mail.gmail.com>

I thought the correct answer to "test" would be "test received".
"Pong" would be correct only if the test message was "ping". No? :-)

On 27 January 2015 at 16:26, Shenan Hawkins <shenan.hawkins at gmail.com> wrote:
> 1422375352.851 42 127.0.0.1 JOKE_MISS/206 1d0n7 GET http://it
>
> On 27 January 2015 at 16:13, Yuri Voinov <yvoinov at gmail.com> wrote:
>>
>>
>> -----BEGIN PGP SIGNED MESSAGE-----
>> Hash: SHA1
>>
>> Amos,
>>
>> the better answer is "pong" ;) And don't forget to add TTL ;)
>>
>> 28.01.2015 3:01, Amos Jeffries ?????:
>> > On 28/01/2015 6:54 p.m., Ahmad wrote:
>> >> testttttt
>> >>
>> >
>> > Ping. This got through.
>> >
>> > Amos
>> >
>> > _______________________________________________
>> > squid-users mailing list
>> > squid-users at lists.squid-cache.org
>> > http://lists.squid-cache.org/listinfo/squid-users
>>
>> -----BEGIN PGP SIGNATURE-----
>> Version: GnuPG v2
>>
>> iQEcBAEBAgAGBQJUx/9cAAoJENNXIZxhPexGjtkH/j0tKOLb1+be3GJ7PHtc5gt1
>> mme184niJ58kTjpaMVWwfVSMTyYB0jqoY0i94KWv5gJMP7d0+slFPI0pWTFjvL2/
>> ebJu8DdkQlLpASiRSKXfwACFBigmtCLQV/93DepndfEg2dw3wZg2La6a/rTOTZLy
>> M9ZOjZ7b6nEmD74mYYLt8shSDwHH/F+KupmCl/fgU3C3yUfUoVPbCNbt1zuv/8D2
>> yCRSYhYOUnUssITgs0GfE3v5UAbcKIl5d7SdwRUhBiOXtuX9if6qxGTdG8Le69/v
>> wD4rfol62diS2uEFRBn0rjPkgWM4aulgW2v5/lv9UMhDEiOLmV7JJ7iIZ/+JeZ4=
>> =Gqqg
>> -----END PGP SIGNATURE-----
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>



-- 
cheers,
ambrose // http://o.gniw.ca / http://gniw.ca //


From squid3 at treenet.co.nz  Tue Jan 27 21:42:22 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 28 Jan 2015 10:42:22 +1300
Subject: [squid-users] how long object size can squid 3.5.2 handle ?
In-Reply-To: <00e201d03ac1$2968d660$7c3a8320$@netstream.ps>
References: <00e201d03ac1$2968d660$7c3a8320$@netstream.ps>
Message-ID: <54C8063E.10107@treenet.co.nz>

On 28/01/2015 7:10 p.m., Ahmad wrote:
> Hi dev ,
> 
> how long object size can squid 3.5.2 handle ??
> 
> it says >>than 32KB
> 

What "it" ?

> 
> is that for memory or  disk caching  or for both ???? 
> 

SMP memory is the only one restricted to 32KB. Because 32KB is the
default UDS (Unix Data Socket) packet size limit, and Squid SMP code is
assuming that limit is in place even if the sysadmin has altered the
kernel to accept larger packets.


> 
> I mean does that mean on memory  the hot object will be >>32KB ? 
> 
>  
> 
> And in  rock store >>32 also ?
> 
>  
> 
> If >>32 Kb how much ?
> 
>  
> 
> 500 Kb ? 1M or more or  less ?
> 
> Just curious and need to know what the max size we can save fo far


Squid-3.5 has 5 cache areas in which HTTP objects can be stored:

* Transients Memory (in-transit objects cache)
* SMP shared memory cache (cache_mem between workers)
* Local memory cache (cache_mem for local worker only)
* Rock disk cache
* UFS disk cache (ufs, aufs, diskd)

Only two of those have *ever* been limited to 32KB (Rock and SMP shared
memory), and in 3.5 that is reduced to one (shared memory cache).

The others are not limited by object size, but by total cache space.

Amos


From yvoinov at gmail.com  Tue Jan 27 21:43:22 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Wed, 28 Jan 2015 03:43:22 +0600
Subject: [squid-users] testttttt
In-Reply-To: <CADJvFOVZ1sk2s7=KxCOnN+nPSQKb-sGvkCLO+u3J+C-g8Bce4Q@mail.gmail.com>
References: <00c901d03abe$eba9b7b0$c2fd2710$@netstream.ps>
 <54C7FCB6.4020301@treenet.co.nz> <54C7FF5D.7010004@gmail.com>
 <CAFzetisO548uPiq45bGXRyt6QLG+NzLA0pYTtrDfjbt1bZtXKQ@mail.gmail.com>
 <CADJvFOVZ1sk2s7=KxCOnN+nPSQKb-sGvkCLO+u3J+C-g8Bce4Q@mail.gmail.com>
Message-ID: <54C8067A.7010808@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Yep :)

"test received, TTL=34 min" :)

28.01.2015 3:41, Ambrose LI ?????:
> I thought the correct answer to "test" would be "test received".
> "Pong" would be correct only if the test message was "ping". No? :-)
>
> On 27 January 2015 at 16:26, Shenan Hawkins <shenan.hawkins at gmail.com>
wrote:
>> 1422375352.851 42 127.0.0.1 JOKE_MISS/206 1d0n7 GET http://it
>>
>> On 27 January 2015 at 16:13, Yuri Voinov <yvoinov at gmail.com> wrote:
>>>
>>>
> Amos,
>
> the better answer is "pong" ;) And don't forget to add TTL ;)
>
> 28.01.2015 3:01, Amos Jeffries ?????:
> >>>> On 28/01/2015 6:54 p.m., Ahmad wrote:
> >>>>> testttttt
> >>>>>
> >>>>
> >>>> Ping. This got through.
> >>>>
> >>>> Amos
> >>>>
> >>>> _______________________________________________
> >>>> squid-users mailing list
> >>>> squid-users at lists.squid-cache.org
> >>>> http://lists.squid-cache.org/listinfo/squid-users
>
>>>
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users
>>
>>
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>>
>
>
>

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUyAZ6AAoJENNXIZxhPexGZagH/09EYuvnLt9LUJcG8+ekQ7SF
6/igk3SkbDifc8ciD3YMGRChUiFsm0U08ZN0N8EPPmtOu/Du+h94paLROc3g4Px6
C65wD34NM1nPl2i3LAvEvJ8gyqjIF2jVZzmrf+OKuexgg7oM3wufVY47BFlIqmDS
DsTiLUq/KKVtCU7ZZ6romHFj0Gma06EGbpgpgO6uQa864FCgZfYAudK7zJiAi6r+
I0F3luXHc8Rf+a0zNCsCGi+hB1+43a/1rYgysIFAeUpCkM8M6lRpJk7nggYUbZi1
eCqqdHVT/QvdM3dE1GoEihoP9yfbrLeb6/8xpHfMKDLqOzgUE0rzpwZ0JMm/WX0=
=hyDY
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150128/d6168dff/attachment.htm>

From squid3 at treenet.co.nz  Tue Jan 27 21:46:42 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 28 Jan 2015 10:46:42 +1300
Subject: [squid-users] squid cache peer with many sessions round robin
 to the same destination , is that possible ?
In-Reply-To: <00d301d03ac0$55d5ef40$0181cdc0$@netstream.ps>
References: <00d301d03ac0$55d5ef40$0181cdc0$@netstream.ps>
Message-ID: <54C80742.1020704@treenet.co.nz>

On 28/01/2015 7:04 p.m., Ahmad wrote:
> Hi mates ,
> 
>  
> 
> I have a proxy provider that give me may sessions , and each session is per
> username and pwd.
> 
> As an example , I have the provider 1.1.1.1 with 5 usernames
> 
> Each username will give me different ip.
> 
>  
> 
> I need to do on my proxy something like cache peer to the ip 1.1.1.1 and
> need to set 5 lines config each line with user/pwd .
> 
>  
> 
> But squid provent me and told me it's the same destination .

You can set multiple cache_peer directives to the same server:port by
adding the name= option to tell Squid how to identify them uniquely.

Amos



From bmatznick at pbandt.com  Tue Jan 27 21:48:00 2015
From: bmatznick at pbandt.com (Bobby)
Date: Tue, 27 Jan 2015 14:48:00 -0700
Subject: [squid-users] squid3
Message-ID: <b3b04db.1d03a7b.1d3b19c.390c@pbandt.com>

Sorry if you?re seeing this twice? I think I sent it to the wrong address the first time.
 
 
Hello, 
Ive been using squid + dansguardian (NTLM) for a few years now 
and have begun setting up a new proxy with squid 3.1.20. Everything 
seems to be working fine except I don?t seem to be sending the 
usernames to dansguardian? Im just using the ntlm auth which is 
working fine for me with squid 2.7*, any ideas why this might be 
happening? 
I do see the traffic hitting dansguardian and it is 
filtering everything through "list" (basic non user filter) I just 
cant seem to get the usernames passed from squid to dansguardian for 
some reason. By the way the usernames do show up in squid3 log with 
one minor difference from the way they show up in my squid 2.7 log.
In squid 2.7 the show up like this:
Username
In squid3 the show up like 
 this: Domain\username
Any ideas on what I may be doing wrong are greatly appreciated!
Thanks!
 
Bobby
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150127/053404f0/attachment.htm>

From yvoinov at gmail.com  Tue Jan 27 21:52:03 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Wed, 28 Jan 2015 03:52:03 +0600
Subject: [squid-users] squid3
In-Reply-To: <b3b04db.1d03a7b.1d3b19c.390c@pbandt.com>
References: <b3b04db.1d03a7b.1d3b19c.390c@pbandt.com>
Message-ID: <54C80883.5090307@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Hmmmmmm...... Why so ancient Squid version?

3.1.x is legacy.

Now Amos says: "Upgrade to last version". ;)

Which is 3.5.1 (wow! :))

28.01.2015 3:48, Bobby ?????:
>
> Sorry if you?re seeing this twice? I think I sent it to the wrong
address the first time.
>
> 
>
> 
>
> Hello,
>
> Ive been using squid + dansguardian (NTLM) for a few years now
>
> and have begun setting up a new proxy with squid 3.1.20. Everything
>
> seems to be working fine except I don?t seem to be sending the
>
> usernames to dansguardian? Im just using the ntlm auth which is
>
> working fine for me with squid 2.7*, any ideas why this might be
>
> happening?
>
> I do see the traffic hitting dansguardian and it is
>
> filtering everything through "list" (basic non user filter) I just
>
> cant seem to get the usernames passed from squid to dansguardian for
>
> some reason. By the way the usernames do show up in squid3 log with
>
> one minor difference from the way they show up in my squid 2.7 log.
>
> In squid 2.7 the show up like this:
>
> Username
>
> In squid3 the show up like
>
>  this: Domain\username
>
> Any ideas on what I may be doing wrong are greatly appreciated!
>
> Thanks!
>
> 
>
> Bobby
>
> 
>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUyAiDAAoJENNXIZxhPexGW5UIAMky96ScHzlb7VM8Wxhj7PM/
YSChHHFvAT3kEsY1qKpK7dpS6D1DPeo+TmKBEUHj8tVQaD+o1mQYPTwaqrGyKcVd
8LHs1e21DOQGmXhyhg3+cnO3WynpraX2QsnL3flBYsK3h/zC8cEZNZ4FqjHuIXEA
Riw3h2JpLIQWc7zKV8eB0JrkU4UNDDmdh47UKgMMjpkbi4wcM6aAGpNdf6ciUuAP
tEBBoYU0C+KdNTRIk7sG7xeS0r3Hd14mBF0Q4PhnsOTF0ERKLv0JX5eB9OyiV6zn
w2rwnBvyTtY494vmOFQlLF/fWWo0YX6rEPx7lckxPGyx5Lj8wfYWxArfD10kCwo=
=6ob4
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150128/dbdee668/attachment.htm>

From squid3 at treenet.co.nz  Tue Jan 27 21:53:50 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 28 Jan 2015 10:53:50 +1300
Subject: [squid-users] HTTPS intercept,
 simple configuration to avoid bank bumping
In-Reply-To: <42DE25A255671C44A93A7B58470DC09C5E2B3433@Michelle.aplitec.local>
References: <42DE25A255671C44A93A7B58470DC09C5E2B24D3@Michelle.aplitec.local>
 <54C67F2D.6070502@gmail.com>
 <CAOsHgttD1fJN1GGuzQA-31Ksv6zuzfGUu8ZPCf3RQ54YxDRanw@mail.gmail.com>
 <54C6B2B4.4070307@trimble.com>
 <42DE25A255671C44A93A7B58470DC09C5E2B3433@Michelle.aplitec.local>
Message-ID: <54C808EE.90704@treenet.co.nz>

On 27/01/2015 11:33 p.m., Josep Borrell wrote:
> I agree.
> Are there someone with the skills to help us with a working sample ?
> is an external ACL needed as Dan remarks ?
> maybe the peek and splice feature need some tuning ?
> if I can help with something, tell me.
> 

I've sent a virtual poke to Christos the SSL-Bump author. Hopefully he
will be able to help more than I can.

Amos



From bmatznick at pbandt.com  Tue Jan 27 21:59:00 2015
From: bmatznick at pbandt.com (Bobby)
Date: Tue, 27 Jan 2015 14:59:00 -0700
Subject: [squid-users] squid3
In-Reply-To: <54C80883.5090307@gmail.com>
Message-ID: <7fdf1fa9.1d03a7c.1dd3bc1.124@pbandt.com>

It is but it?s the latest version available through apt-get on Debian 7 without adding backports which I may end up doing anyway. However I don?t think that is my problem, I think I may have missed something in my config and was wondering if anyone had seen this before with the usernames not seeming to be passed to dansguardian.
 
Bobby
 
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Yuri Voinov
Sent: Tuesday, January 27, 2015 2:52 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] squid3
 

-----BEGIN PGP SIGNED MESSAGE----- 
Hash: SHA1 
 
Hmmmmmm...... Why so ancient Squid version?

3.1.x is legacy.

Now Amos says: "Upgrade to last version". ;)

Which is 3.5.1 (wow! :))

28.01.2015 3:48, Bobby ?????:
>


      > Sorry if you?re seeing this twice? I think I sent it to the
      wrong address the first time.


      >


      >  


      >


      >  


      >


      > Hello,


      >


      > Ive been using squid + dansguardian (NTLM) for a few years
      now


      >


      > and have begun setting up a new proxy with squid 3.1.20.
      Everything


      >


      > seems to be working fine except I don?t seem to be sending
      the


      >


      > usernames to dansguardian? Im just using the ntlm auth which
      is


      >


      > working fine for me with squid 2.7*, any ideas why this might
      be


      >


      > happening?


      >


      > I do see the traffic hitting dansguardian and it is


      >


      > filtering everything through "list" (basic non user filter) I
      just


      >


      > cant seem to get the usernames passed from squid to
      dansguardian for


      >


      > some reason. By the way the usernames do show up in squid3
      log with


      >


      > one minor difference from the way they show up in my squid
      2.7 log.


      >


      > In squid 2.7 the show up like this:


      >


      > Username


      >


      > In squid3 the show up like


      >


      >  this: Domain\username


      >


      > Any ideas on what I may be doing wrong are greatly
      appreciated!


      >


      > Thanks!


      >


      >  


      >


      > Bobby


      >


      >  


      >


      >


      >


      > _______________________________________________


      > squid-users mailing list


      > squid-users at lists.squid-cache.org


      > http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE----- 
Version: GnuPG v2 
 
iQEcBAEBAgAGBQJUyAiDAAoJENNXIZxhPexGW5UIAMky96ScHzlb7VM8Wxhj7PM/ 
YSChHHFvAT3kEsY1qKpK7dpS6D1DPeo+TmKBEUHj8tVQaD+o1mQYPTwaqrGyKcVd 
8LHs1e21DOQGmXhyhg3+cnO3WynpraX2QsnL3flBYsK3h/zC8cEZNZ4FqjHuIXEA 
Riw3h2JpLIQWc7zKV8eB0JrkU4UNDDmdh47UKgMMjpkbi4wcM6aAGpNdf6ciUuAP 
tEBBoYU0C+KdNTRIk7sG7xeS0r3Hd14mBF0Q4PhnsOTF0ERKLv0JX5eB9OyiV6zn 
w2rwnBvyTtY494vmOFQlLF/fWWo0YX6rEPx7lckxPGyx5Lj8wfYWxArfD10kCwo= 
=6ob4 
-----END PGP SIGNATURE----- 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150127/8f55b68e/attachment.htm>

From jeroen.ruijter at borsboomhamm.nl  Wed Jan 28 10:39:58 2015
From: jeroen.ruijter at borsboomhamm.nl (Jeroen Ruijter)
Date: Wed, 28 Jan 2015 10:39:58 +0000
Subject: [squid-users] when using a search box on een website my hole
 internet explorer freezes incuding earlier opend tabs
Message-ID: <510FCECD6E595A4D83BF67FC07028E75D39F6F@BHMB-02.bnh.local>

We use a Squid Proxy Server 3.3
Further I have Basic Ldap Authentication
And the site which freezes is on the allowed list
Windows 2008 R2 Terminal Server
Internet Explorer 11

The site that freezes is www.rechtspraak.nl<http://www.rechtspraak.nl>

Anyone any ideas?


Regards Jeroen Ruijter
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150128/00e20939/attachment.htm>

From squid3 at treenet.co.nz  Wed Jan 28 11:25:11 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 29 Jan 2015 00:25:11 +1300
Subject: [squid-users] when using a search box on een website my hole
 internet explorer freezes incuding earlier opend tabs
In-Reply-To: <510FCECD6E595A4D83BF67FC07028E75D39F6F@BHMB-02.bnh.local>
References: <510FCECD6E595A4D83BF67FC07028E75D39F6F@BHMB-02.bnh.local>
Message-ID: <54C8C717.2030508@treenet.co.nz>

On 28/01/2015 11:39 p.m., Jeroen Ruijter wrote:
> We use a Squid Proxy Server 3.3
> Further I have Basic Ldap Authentication
> And the site which freezes is on the allowed list
> Windows 2008 R2 Terminal Server
> Internet Explorer 11
> 
> The site that freezes is www.rechtspraak.nl<http://www.rechtspraak.nl>
> 
> Anyone any ideas?

Any information? please define "freeze" in terms of stateless HTTP
operations.

Amos



From pavel.kazlenka at measurement-factory.com  Wed Jan 28 12:44:09 2015
From: pavel.kazlenka at measurement-factory.com (Pavel Kazlenka)
Date: Wed, 28 Jan 2015 15:44:09 +0300
Subject: [squid-users] How to force squid to ask for client certificate
 during tls handshake on https_port?
Message-ID: <54C8D999.6040902@measurement-factory.com>

Hi gentlemen,

I have https_port configured as the next:
https_port 3128 cert=/home/tester/certificates/server.crt 
key=/home/tester/certificates/server.key

and would like to force squid to retrieve client's certificate. 
According to 
http://www-01.ibm.com/support/knowledgecenter/api/content/nl/en-us/SSFKSJ_7.1.0/com.ibm.mq.doc/sy10660a.gif 
, client certificate request is optional and looks like squid doesn't 
request the one by default.
Squid version if 3.5.1.

Is that possible at all and if so, how to do this?

TIA,
Pavel


From al.akchurin at hotmail.com  Wed Jan 28 13:33:29 2015
From: al.akchurin at hotmail.com (Eldar Akchurin)
Date: Wed, 28 Jan 2015 14:33:29 +0100
Subject: [squid-users] Problem with running squid 3.5 on windows 7
In-Reply-To: <54C46B97.1020709@treenet.co.nz>
References: <DUB128-W55525A3B23BC7997B586EDED6A0@phx.gbl>,
 <DUB128-W386F0087439E955D2D0817ED6B0@phx.gbl>,
 <54948EC0.9000406@treenet.co.nz>, <5495839C.90503@treenet.co.nz>,
 <DUB128-W78DFD91541BE4FF2230E56ED680@phx.gbl>,
 <549641E7.2000700@treenet.co.nz>,
 <DUB128-W846880FC1B7B967BA72838ED690@phx.gbl>,
 <5496DFCF.9040808@treenet.co.nz>,
 <DUB128-W34931C2A4940D01493E6C8ED690@phx.gbl>,
 <5496F97B.1010404@treenet.co.nz>,
 <DUB128-W63731D06D443326A3FBF1FED690@phx.gbl>,
 <DUB128-W86BEEB01DC11B87B29E9FBED690@phx.gbl>,
 <DUB128-W314A255069BDFCF7DB1BC3ED560@phx.gbl>,
 <DUB128-W347E001CA10DF69590EB0FED560@phx.gbl>,
 <549776FF.1010806@treenet.co.nz>,
 <DUB128-W23F2655740D60FD8F31C03ED4B0@phx.gbl>,
 <DUB128-W254D53363D4E4A2B48EB9EED4B0@phx.gbl>,
 <DUB128-W82B65B02877EB4846D83E3ED4B0@phx.gbl>,
 <DUB128-W1AD6C68396CB94DE7CE0DED4B0@phx.gbl>, <54BF2D4B.2020800@treenet.co.nz>,
 <DUB128-W45167C4ADD3081D24DC05AED4
 ,90@phx.gbl>,<DUB128-W378A2E891FA711D7317611ED360@phx.gbl>
 <DUB128-W46B79BC16BF3CCDBE07EE6ED340@phx.gbl>, <54C46B97.1020709@treenet.co.nz>
Message-ID: <DUB128-W46F5324310FE9ACC2A27BEED330@phx.gbl>

Hi Amos,
 
It seems the functionality that is responsible for creation of child workers is absent on Windows. This is what I see in the main.cc
watch_child(char *argv[])
{
#if !_SQUID_WINDOWS_ 
...
#endif
}
 
Are there any plans to add this functionality in the near future? 
 
Thank you!
 
Best regards,
-e
 
> Date: Sun, 25 Jan 2015 17:05:43 +1300
> From: squid3 at treenet.co.nz
> To: al.akchurin at hotmail.com; squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] Problem with running squid 3.5 on windows 7
> 
> On 25/01/2015 4:16 p.m., Eldar Akchurin wrote:
> > Hi Amos,
> >  
> > Sorry to disturb you again, I have changed the ModSelectWin32 for now, it seems it kind of works.
> > I will collect all the patches and will send you after I have the first version running :)
> >  
> 
> Yay. Sorry for not having time for this, got flooded under with 3.5.1
> feedback but things are settling down again now.
> 
> 
> > The next issue is in the mswindows.h
> >  
> > inline ssize_t
> > recvfrom(int s, void * b, size_t l, int f, struct sockaddr * fr, socklen_t * fl)
> > {
> >     ssize_t result;
> >     int ifl=*fl;
> >     if ((result = ::recvfrom(_get_osfhandle(s), (char *)b, l, f, fr, &ifl)) == SOCKET_ERROR) {
> >         errno = WSAGetLastError();
> >         return -1;
> >     } else
> >         return result;
> > }
> >  
> > ::recvfrom changes the size, but you kind of forgetting it inside ifl, not passing it out.Why not simply pass fl? why do you need ifl? socklen_t is declared as int. Or can this be changed in the future?
> > At least it is necessary to copy the value returned by ifl into the fl again after the call.
> >  
> > The next problem I'm having is that only squid -N works. As soon as I run it in the daemon mode (without -N) none of the workers is created. Could you please point me to the part of the code that is responsible for spawning workers?
> >  
> 
>  src/ipc/* does most of the SMP related stuff. I was expecting issues
> from UDS TypedMessage needing special Windows code to pass handles
> between the processes.
> 
> It may also be related to the main.cc code forking initial daemon/worker.
> 
> Amos
> 
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150128/2299e74a/attachment.htm>

From ahmed.zaeem at netstream.ps  Thu Jan 29 03:17:22 2015
From: ahmed.zaeem at netstream.ps (Ahmad)
Date: Wed, 28 Jan 2015 19:17:22 -0800
Subject: [squid-users] how long object size can squid 3.5.2 handle ?
In-Reply-To: <54C8063E.10107@treenet.co.nz>
References: <00e201d03ac1$2968d660$7c3a8320$@netstream.ps>
 <54C8063E.10107@treenet.co.nz>
Message-ID: <012701d03b72$1a118250$4e3486f0$@netstream.ps>

Thank you amos  for explanation , 
You also didn?t answer me , does that mean in 3.5 squid version the object size in rock store  can be like 500KB ? or 1M ?
Or there is still has limitation for max size ? I know it exceed the 32kB , does that mean it can save like 1 M object size ?
==================

The 1nd question , I have 3.head squid version
Its
Squid Cache: Version 3.HEAD-20141105-r13687


Will I find a big performance in rock   in comparison to 3.5 ?

Does that version im using right now has limitation on rock ?

cheers

-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Amos Jeffries
Sent: Tuesday, January 27, 2015 1:42 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] how long object size can squid 3.5.2 handle ?

On 28/01/2015 7:10 p.m., Ahmad wrote:
> Hi dev ,
> 
> how long object size can squid 3.5.2 handle ??
> 
> it says >>than 32KB
> 

What "it" ?

> 
> is that for memory or  disk caching  or for both ???? 
> 

SMP memory is the only one restricted to 32KB. Because 32KB is the default UDS (Unix Data Socket) packet size limit, and Squid SMP code is assuming that limit is in place even if the sysadmin has altered the kernel to accept larger packets.


> 
> I mean does that mean on memory  the hot object will be >>32KB ? 
> 
>  
> 
> And in  rock store >>32 also ?
> 
>  
> 
> If >>32 Kb how much ?
> 
>  
> 
> 500 Kb ? 1M or more or  less ?
> 
> Just curious and need to know what the max size we can save fo far


Squid-3.5 has 5 cache areas in which HTTP objects can be stored:

* Transients Memory (in-transit objects cache)
* SMP shared memory cache (cache_mem between workers)
* Local memory cache (cache_mem for local worker only)
* Rock disk cache
* UFS disk cache (ufs, aufs, diskd)

Only two of those have *ever* been limited to 32KB (Rock and SMP shared memory), and in 3.5 that is reduced to one (shared memory cache).

The others are not limited by object size, but by total cache space.

Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From ahmed.zaeem at netstream.ps  Thu Jan 29 03:29:14 2015
From: ahmed.zaeem at netstream.ps (Ahmad)
Date: Wed, 28 Jan 2015 19:29:14 -0800
Subject: [squid-users] how long object size can squid 3.5.2 handle ?
In-Reply-To: <012701d03b72$1a118250$4e3486f0$@netstream.ps>
References: <00e201d03ac1$2968d660$7c3a8320$@netstream.ps>
 <54C8063E.10107@treenet.co.nz> <012701d03b72$1a118250$4e3486f0$@netstream.ps>
Message-ID: <012801d03b73$c25f55d0$471e0170$@netstream.ps>

Again , im talking about rock store object size

cheers

-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Ahmad
Sent: Wednesday, January 28, 2015 7:17 PM
To: 'Amos Jeffries'
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] how long object size can squid 3.5.2 handle ?

Thank you amos  for explanation ,
You also didn?t answer me , does that mean in 3.5 squid version the object size in rock store  can be like 500KB ? or 1M ?
Or there is still has limitation for max size ? I know it exceed the 32kB , does that mean it can save like 1 M object size ?
==================

The 1nd question , I have 3.head squid version Its Squid Cache: Version 3.HEAD-20141105-r13687


Will I find a big performance in rock   in comparison to 3.5 ?

Does that version im using right now has limitation on rock ?

cheers

-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Amos Jeffries
Sent: Tuesday, January 27, 2015 1:42 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] how long object size can squid 3.5.2 handle ?

On 28/01/2015 7:10 p.m., Ahmad wrote:
> Hi dev ,
> 
> how long object size can squid 3.5.2 handle ??
> 
> it says >>than 32KB
> 

What "it" ?

> 
> is that for memory or  disk caching  or for both ???? 
> 

SMP memory is the only one restricted to 32KB. Because 32KB is the default UDS (Unix Data Socket) packet size limit, and Squid SMP code is assuming that limit is in place even if the sysadmin has altered the kernel to accept larger packets.


> 
> I mean does that mean on memory  the hot object will be >>32KB ? 
> 
>  
> 
> And in  rock store >>32 also ?
> 
>  
> 
> If >>32 Kb how much ?
> 
>  
> 
> 500 Kb ? 1M or more or  less ?
> 
> Just curious and need to know what the max size we can save fo far


Squid-3.5 has 5 cache areas in which HTTP objects can be stored:

* Transients Memory (in-transit objects cache)
* SMP shared memory cache (cache_mem between workers)
* Local memory cache (cache_mem for local worker only)
* Rock disk cache
* UFS disk cache (ufs, aufs, diskd)

Only two of those have *ever* been limited to 32KB (Rock and SMP shared memory), and in 3.5 that is reduced to one (shared memory cache).

The others are not limited by object size, but by total cache space.

Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From vdoctor at neuf.fr  Wed Jan 28 17:31:18 2015
From: vdoctor at neuf.fr (Stakres)
Date: Wed, 28 Jan 2015 09:31:18 -0800 (PST)
Subject: [squid-users] Squid 2.7,
 3.4 and 3.5 Videos/Music/Images/Libraris/CDNs Booster
In-Reply-To: <1421655817441-4669159.post@n4.nabble.com>
References: <1418415837677-4668693.post@n4.nabble.com>
 <1418628416193-4668707.post@n4.nabble.com>
 <1418825003303-4668738.post@n4.nabble.com>
 <1419155198462-4668803.post@n4.nabble.com>
 <1420464046420-4668929.post@n4.nabble.com> <54AA918C.10300@gmail.com>
 <1420465642362-4668933.post@n4.nabble.com> <54AA979B.7060803@gmail.com>
 <1420470567538-4668941.post@n4.nabble.com>
 <1421655817441-4669159.post@n4.nabble.com>
Message-ID: <1422466278065-4669395.post@n4.nabble.com>

Hi All,

Advanced Caching Add-On for Linux Squid Proxy Cache v2.7, v3.4 and v3.5 with
Videos, Music, Images, Libraries and CDNs.

New  version 2.31 <https://sourceforge.net/projects/squidvideosbooster>  
including new websites and bug fix - January 28th 2015.
More details on https://svb.unveiltech.com

Enjoy

Bye Fred 



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-2-7-3-4-and-3-5-Videos-Music-Images-Libraries-CDNs-Booster-tp4668683p4669395.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From hack.back at hotmail.com  Wed Jan 28 22:53:16 2015
From: hack.back at hotmail.com (HackXBack)
Date: Wed, 28 Jan 2015 14:53:16 -0800 (PST)
Subject: [squid-users] testttttt
In-Reply-To: <00c901d03abe$eba9b7b0$c2fd2710$@netstream.ps>
References: <00c901d03abe$eba9b7b0$c2fd2710$@netstream.ps>
Message-ID: <1422485596108-4669396.post@n4.nabble.com>

Ping request could not find host testttttt. Please check the name and try
again.



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/testttttt-tp4669368p4669396.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From hack.back at hotmail.com  Wed Jan 28 22:54:56 2015
From: hack.back at hotmail.com (HackXBack)
Date: Wed, 28 Jan 2015 14:54:56 -0800 (PST)
Subject: [squid-users] Error negotiating SSL connection on FD 20:
 error:00000000:lib(0):func(0):reason(0) (5/-1/131)
In-Reply-To: <54C76D26.5020404@gmail.com>
References: <54C677E5.3050400@gmail.com> <54C67C68.6040107@gmail.com>
 <1422305395708-4669351.post@n4.nabble.com> <54C76D26.5020404@gmail.com>
Message-ID: <1422485696025-4669397.post@n4.nabble.com>

You solve It ?



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Error-negotiating-SSL-connection-on-FD-20-error-00000000-lib-0-func-0-reason-0-5-1-131-tp4669338p4669397.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From hack.back at hotmail.com  Wed Jan 28 22:59:46 2015
From: hack.back at hotmail.com (HackXBack)
Date: Wed, 28 Jan 2015 14:59:46 -0800 (PST)
Subject: [squid-users] FATAL: The ssl_crtd helpers are crashing too
 rapidly, need help!
In-Reply-To: <54C5D343.4070503@treenet.co.nz>
References: <1421929053162-4669257.post@n4.nabble.com>
 <1422034084407-4669297.post@n4.nabble.com> <54C2884E.4000509@treenet.co.nz>
 <1422158576716-4669314.post@n4.nabble.com>
 <1422205274028-4669322.post@n4.nabble.com> <54C557C8.7040509@gmail.com>
 <1422227373827-4669324.post@n4.nabble.com> <54C5D343.4070503@treenet.co.nz>
Message-ID: <1422485986058-4669398.post@n4.nabble.com>

Dear Amos,

root at dotspot:~# /usr/lib/squid/ssl_crtd -d
/usr/lib/squid/ssl_crtd: Uninitialized SSL certificate database directory: .
To initialize, run "ssl_crtd -c -s ".

no debug msg !!?



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/FATAL-The-ssl-crtd-helpers-are-crashing-too-rapidly-need-help-tp4669257p4669398.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From squid3 at treenet.co.nz  Thu Jan 29 04:55:57 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 29 Jan 2015 17:55:57 +1300
Subject: [squid-users] how long object size can squid 3.5.2 handle ?
In-Reply-To: <012701d03b72$1a118250$4e3486f0$@netstream.ps>
References: <00e201d03ac1$2968d660$7c3a8320$@netstream.ps>
 <54C8063E.10107@treenet.co.nz> <012701d03b72$1a118250$4e3486f0$@netstream.ps>
Message-ID: <54C9BD5D.6070506@treenet.co.nz>

On 29/01/2015 4:17 p.m., Ahmad wrote:
> Thank you amos  for explanation , 
> You also didn?t answer me , does that mean in 3.5 squid version the object size in rock store  can be like 500KB ? or 1M ?
> Or there is still has limitation for max size ? I know it exceed the 32kB , does that mean it can save like 1 M object size ?

Yes it can. But a bad idea to do so.

You loose all the benefits rock offers over UFS while still gaining the
costs.

Amos



From dstsmallbird at foxmail.com  Thu Jan 29 05:09:07 2015
From: dstsmallbird at foxmail.com (=?ISO-8859-1?B?U21hbGwgQmlyZA==?=)
Date: Thu, 29 Jan 2015 13:09:07 +0800
Subject: [squid-users] How to use Radius & Squid to make per-user traffic
	statistic
Message-ID: <tencent_5E8A1B642FF30C992B67562C@qq.com>

Hi~I have a proxy with Radius and Squid, but I cannot find the way to make per-user traffic statistic.
I want to get the network traffic of a specific user when he or she get disconnected, and post the log to database server.
Please tell me how to do >.<


Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150129/f30dc6be/attachment.htm>

From alejandro51295 at gmail.com  Thu Jan 29 07:53:39 2015
From: alejandro51295 at gmail.com (456mb)
Date: Wed, 28 Jan 2015 23:53:39 -0800 (PST)
Subject: [squid-users] Squid problem, one client for one user
Message-ID: <1422518019197-4669402.post@n4.nabble.com>

Hi i try disable multilogin of the same user (avoid share accounts), but not
luck, i used that config

*auth_param basic program /usr/lib64/squid/ncsa_auth /etc/squid/squid_passwd
acl ncsa_users proxy_auth REQUIRED
http_access allow ncsa_users
auth_param basic casesensitive off

authenticate_ip_ttl 0 seconds
acl max_user max_user_ip -s 1
http_access deny max_user*

thanks for you time, all response is important  for me ;)



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-problem-one-client-for-one-user-tp4669402.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From squid3 at treenet.co.nz  Thu Jan 29 09:06:56 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 29 Jan 2015 22:06:56 +1300
Subject: [squid-users] Squid problem, one client for one user
In-Reply-To: <1422518019197-4669402.post@n4.nabble.com>
References: <1422518019197-4669402.post@n4.nabble.com>
Message-ID: <54C9F830.4060809@treenet.co.nz>

On 29/01/2015 8:53 p.m., 456mb wrote:
> Hi i try disable multilogin of the same user (avoid share accounts), but not
> luck, i used that config
> 
> *auth_param basic program /usr/lib64/squid/ncsa_auth /etc/squid/squid_passwd
> acl ncsa_users proxy_auth REQUIRED
> http_access allow ncsa_users
> auth_param basic casesensitive off
> 
> authenticate_ip_ttl 0 seconds
> acl max_user max_user_ip -s 1
> http_access deny max_user*
> 
> thanks for you time, all response is important  for me ;)
> 

The idea of limiting "users" based on IP in the modern Internet does not
work in most networks.
* NAT can (and is) used to also share IP addresses as well as accounts -
this is in fact the default of Windows machines sharing network access.
* The existence of IPv6 also means that any given machine has a minimum
of 4 IP addresses it can use for any connection. Some of which change
unpredictably.

Your config is correct. So we will need more details about why its not
working to provide any more help than this.

Amos



From yvoinov at gmail.com  Thu Jan 29 10:03:45 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 29 Jan 2015 16:03:45 +0600
Subject: [squid-users] Error negotiating SSL connection on FD 20:
 error:00000000:lib(0):func(0):reason(0) (5/-1/131)
In-Reply-To: <1422485696025-4669397.post@n4.nabble.com>
References: <54C677E5.3050400@gmail.com> <54C67C68.6040107@gmail.com>
 <1422305395708-4669351.post@n4.nabble.com> <54C76D26.5020404@gmail.com>
 <1422485696025-4669397.post@n4.nabble.com>
Message-ID: <54CA0581.3050605@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Not yet. Works on it.

29.01.2015 4:54, HackXBack ?????:
> You solve It ?
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/Error-negotiating-SSL-connection-on-FD-20-error-00000000-lib-0-func-0-reason-0-5-1-131-tp4669338p4669397.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUygWAAAoJENNXIZxhPexGGk8H/334ojyBR5946IXOZEe98r4m
Zt9mk82urTI6hnmGfKmzE6xPsAoRA2thu+vYGiVFGhz3NjSugvSr+znEkoNe8IwW
E8KwYevkVvkSt5R8TAHzOJlJTb7tjAe8i7kxOI/v7+nvbZDYyNYCOpCHrdVSYcOg
eFhAH9OYQocg/I6Ysvw54LRkUszyi1DyfguvlBIiCh9UqwkMP12/RgVa636dMcLu
rLcls9fn1qULKHdOWJH2qiXe+aaGSyzIiz12hs66rYcqvLlvtGlsn5db0uYz2Gos
CKFDRJw6ezgQ2bZsDm066g6sUGeDLEkOhmv/ENAUJYf51xiYAS00349me9+JPpE=
=KdD8
-----END PGP SIGNATURE-----



From yvoinov at gmail.com  Thu Jan 29 10:24:49 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 29 Jan 2015 16:24:49 +0600
Subject: [squid-users] Which hits cachemgr shows?
Message-ID: <54CA0A71.7020502@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Amos,

btw.

Which type of hits cachemgr collects and shows? TCP_HIT only?

What about other HIT-types?

WBR, Yuri
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUygpwAAoJENNXIZxhPexGUOIIAIA3BMaeVCD8UvSFQ+IH0rOM
g45WXGARa6NS9pmPHMhRsyhgbKyAbOh4mMtbhTrIQ/FOAnD7lWKvtvauStOozsAj
LvPg2saqCMLuyaUMO1khtObPftbWFPOY2m0y9qkDFHnYAhSS/YYb+dFwwa7xct4j
4mjHUq0t+kZoPYqgArCoxLQ9kjzQPqSUTEgONmgxhmKQjYjcLoLB3syk4bKQW0ez
zbC4xe346LqaBbbNiYq6SOn6R+dOOe76+Iozs519RO2dVcQq/VHWrFAiyKCjKhgK
XfjVf4UdgHYD0nYG2uA2TWQLmPZDL70ZvKPlL0al1ypkWeN5hmdc1zY2qPUm6MY=
=zdbO
-----END PGP SIGNATURE-----



From pavel.kazlenka at measurement-factory.com  Thu Jan 29 10:26:03 2015
From: pavel.kazlenka at measurement-factory.com (Pavel Kazlenka)
Date: Thu, 29 Jan 2015 13:26:03 +0300
Subject: [squid-users] How to force squid to ask for client certificate
 during tls handshake on https_port?
In-Reply-To: <54C8D999.6040902@measurement-factory.com>
References: <54C8D999.6040902@measurement-factory.com>
Message-ID: <54CA0ABB.20807@measurement-factory.com>

Answering my own question:

Adding clientca= and cafile= options of https_port is enough to trigger 
client certificate request.

On 01/28/2015 03:44 PM, Pavel Kazlenka wrote:
> Hi gentlemen,
>
> I have https_port configured as the next:
> https_port 3128 cert=/home/tester/certificates/server.crt 
> key=/home/tester/certificates/server.key
>
> and would like to force squid to retrieve client's certificate. 
> According to 
> http://www-01.ibm.com/support/knowledgecenter/api/content/nl/en-us/SSFKSJ_7.1.0/com.ibm.mq.doc/sy10660a.gif 
> , client certificate request is optional and looks like squid doesn't 
> request the one by default.
> Squid version if 3.5.1.
>
> Is that possible at all and if so, how to do this?
>
> TIA,
> Pavel
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From yvoinov at gmail.com  Thu Jan 29 10:27:06 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 29 Jan 2015 16:27:06 +0600
Subject: [squid-users] How to force squid to ask for client certificate
 during tls handshake on https_port?
In-Reply-To: <54CA0ABB.20807@measurement-factory.com>
References: <54C8D999.6040902@measurement-factory.com>
 <54CA0ABB.20807@measurement-factory.com>
Message-ID: <54CA0AFA.1040905@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
.... Just read squid.conf.documented, is it? ;)

29.01.2015 16:26, Pavel Kazlenka ?????:
> Answering my own question:
>
> Adding clientca= and cafile= options of https_port is enough to
trigger client certificate request.
>
> On 01/28/2015 03:44 PM, Pavel Kazlenka wrote:
>> Hi gentlemen,
>>
>> I have https_port configured as the next:
>> https_port 3128 cert=/home/tester/certificates/server.crt
key=/home/tester/certificates/server.key
>>
>> and would like to force squid to retrieve client's certificate.
According to
http://www-01.ibm.com/support/knowledgecenter/api/content/nl/en-us/SSFKSJ_7.1.0/com.ibm.mq.doc/sy10660a.gif
, client certificate request is optional and looks like squid doesn't
request the one by default.
>> Squid version if 3.5.1.
>>
>> Is that possible at all and if so, how to do this?
>>
>> TIA,
>> Pavel
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUygr6AAoJENNXIZxhPexGFTQH/ilYlldxB3PI0aWTP4ngfTQM
SOwo3J73tG5ohi7MMutua8PmhMj28kuGEDXtXj8TradpGeIRcLS8RM2L6yxWFA5C
ac2T/WjuH0PLLUCYx7mWeFz7WV7lUpf1CmZIiXf5gNxNCrMDHZd+fXphVaAph15T
QE7W606yKmSM3zGbki7s8GtaBVh9TXSbkzpivnZbvbuvVN8FZow7rUzg9YWqgy79
wBRJy0GcJx39DsEEhB7KC56ov8nFNe2kMWL7V6E1HbH4bZNMToPM53YO/9S06M9z
/5dd9z9QReSwLgFEXMH1+yBFCfrA2onozJFcVoXOfu6UiUZbOFrczugwejH81Cc=
=UTXu
-----END PGP SIGNATURE-----



From Richard.Aspley at hammonds-uk.com  Thu Jan 29 11:24:19 2015
From: Richard.Aspley at hammonds-uk.com (Rich549)
Date: Thu, 29 Jan 2015 03:24:19 -0800 (PST)
Subject: [squid-users] Webpages won't load or load slowly
Message-ID: <1422530659467-4669408.post@n4.nabble.com>

Hi,

Having a problem with a new Squid installation, 3.3.8 in Ubuntu 14.04.

When trying to load certain webpages: twitter.com, reddit.com,
ubuntugeek.com and experts-exchange.com the pages just sit there loading and
eventually in the case of Twitter some text will load but not in the correct
order, no images or advanced features etc. With the other two the pages just
don't load in the slightest.

My config is attached squid.conf
<http://squid-web-proxy-cache.1019090.n4.nabble.com/file/n4669408/squid.conf>  

Any help would be great as I'm completely stumped! Obviously bypassng Squid
makes these websites load and using an older version of Squid 2.7 for
Windows works fine too.

Thanks,

Rich



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Webpages-won-t-load-or-load-slowly-tp4669408.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From theronzorbas at yahoo.com  Thu Jan 29 11:56:03 2015
From: theronzorbas at yahoo.com (Theron ZORBAS)
Date: Thu, 29 Jan 2015 11:56:03 +0000 (UTC)
Subject: [squid-users] Compile error with Squid-3.5.1 under OpenBSD 5.5
Message-ID: <583874714.2343729.1422532563694.JavaMail.yahoo@mail.yahoo.com>

Hi, 

I'm trying to compile squid-3.5.1 under OpenBSD 5.5 amd64. 


I use gnutls as a depency package: 
# pkg_info |grep gnutls 
gnutls-3.2.15 GNU Transport Layer Security library 


My configure parameters are: 
./configure --enable-arp-acl --disable-auth-basic --disable-auth-digest --enable-delay-pools --enable-external-acl-helpers="SQL_session file_userip session time_quota" --enable-forw-via-db --enable-negotiate-auth-helpers="no" --enable-removal-policies="lru heap" --enable-ssl --enable-ssl-crtd --enable-storeio="aufs ufs diskd" --with-pthreads --with-default-user=_squid --enable-follow-x-forwarded-for --mandir='/usr/local/man' --infodir='/usr/local/info' --enable-ipfw-transparent --disable-devpoll --disable-epoll --disable-ident-lookups --disable-loadable-modules --enable-forw-via-db --enable-http-violations --enable-icap-client --enable-ipv6 --with-filedescriptors=32768 --enable-stacktraces --enable-log-daemon-helpers="DB file" --enable-url-rewrite-helpers="fake" --enable-pf-transparent --with-openssl --disable-strict-error-checking --disable-arch-native 

And compile faults with these error messages: 
depbase=`echo squidclient.o | sed 's|[^/]*$|.deps/&|;s|\.o$||'`; g++ -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -Wall -Wpointer-arith -Wwrite-strings -Wcomments -Wshadow -pipe -D_REENTRANT -I/usr/include -I/usr/local/include -I/usr/local/include/p11-kit-1 -I/usr/include -O0 -g -fno-strict-overflow -Wno-error -MT squidclient.o -MD -MP -MF $depbase.Tpo -c -o squidclient.o squidclient.cc && mv -f $depbase.Tpo $depbase.Po 
In file included from squidclient.cc:17: 
../../tools/squidclient/Transport.h:81: error: 'gnutls_anon_client_credentials_t' does not name a type 
../../tools/squidclient/Transport.h:84: error: 'gnutls_certificate_credentials_t' does not name a type 
../../tools/squidclient/Transport.h:87: error: 'gnutls_session_t' does not name a type 
squidclient.cc: In function 'int main(int, char**)': 
squidclient.cc:538: error: 'gnutls_error_is_fatal' was not declared in this scope 
squidclient.cc:539: error: 'gnutls_strerror' was not declared in this scope 
squidclient.cc:541: error: 'gnutls_strerror' was not declared in this scope 
*** Error 1 in tools/squidclient (Makefile:892 'squidclient.o') 
*** Error 1 in tools/squidclient (Makefile:994 'all-recursive') 
*** Error 1 in tools (Makefile:1067 'all-recursive') 
*** Error 1 in /opt/squid-3.5.1 (Makefile:592 'all-recursive') 


How can I fix this? Thanks. 


--
Theron


From yvoinov at gmail.com  Thu Jan 29 12:13:55 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 29 Jan 2015 18:13:55 +0600
Subject: [squid-users] Webpages won't load or load slowly
In-Reply-To: <1422530659467-4669408.post@n4.nabble.com>
References: <1422530659467-4669408.post@n4.nabble.com>
Message-ID: <54CA2403.4050009@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
This one:

hierarchy_stoplist cgi-bin ?
acl QUERY urlpath_regex cgi-bin \?
cache deny QUERY

is deprecated.

And your Squid is ancient. :)

Why don't build from sources latest version?

29.01.2015 17:24, Rich549 ?????:
> Hi,
>
> Having a problem with a new Squid installation, 3.3.8 in Ubuntu 14.04.
>
> When trying to load certain webpages: twitter.com, reddit.com,
> ubuntugeek.com and experts-exchange.com the pages just sit there
loading and
> eventually in the case of Twitter some text will load but not in the
correct
> order, no images or advanced features etc. With the other two the
pages just
> don't load in the slightest.
>
> My config is attached squid.conf
>
<http://squid-web-proxy-cache.1019090.n4.nabble.com/file/n4669408/squid.conf> 

>
> Any help would be great as I'm completely stumped! Obviously bypassng
Squid
> makes these websites load and using an older version of Squid 2.7 for
> Windows works fine too.
>
> Thanks,
>
> Rich
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/Webpages-won-t-load-or-load-slowly-tp4669408.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUyiQDAAoJENNXIZxhPexGXxMH/0cWaC7eDoATJTXpV+v3Y19/
rohJoBU7XMfZrpFV8JZlxxgmpUhtmom9AqcC/Y3G9mmSp5409EwWmWLKkyuB7jwk
Txy/glaefd1hFIvm1V8MBQNkQMMexlgHQyE48xPsSJS1onWvUAT+th0dfijZxEXa
VT6tguBYUddUcsQl2MebbYvi8mfJnVnVmr2mCC8+GIxVk8XaYns6FtAauBPBdtaT
tWecKgvUB0guQYUGxA4lANqSI//dxuFJe8QukvKwQFYzfjj2D4DxiSzhiiW+2+CK
K9KkHLcYkEj27qyG65GBl9OT/VwdvrUsy2R/pq1RzDrBTD5hH9Rz7F4kSJR2SDA=
=OAq3
-----END PGP SIGNATURE-----



From yvoinov at gmail.com  Thu Jan 29 12:17:14 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 29 Jan 2015 18:17:14 +0600
Subject: [squid-users] Webpages won't load or load slowly
In-Reply-To: <1422530659467-4669408.post@n4.nabble.com>
References: <1422530659467-4669408.post@n4.nabble.com>
Message-ID: <54CA24CA.9090101@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
And your access rules looks skew:

http_access deny BlacklistedSites StoresAllow
http_access allow OK_Unauthenticated
http_access allow StaticIPWhitelist
http_access allow InetAllow
http_access allow StoresAllow


http_access allow ftp
http_access allow CONNECT Safe_ports
http_access allow manager localhost
http_access deny manager
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access deny all
http_reply_access allow all

Where is allow rule for internal networks?

Something like:

http_access allow localnet

?

29.01.2015 17:24, Rich549 ?????:
> Hi,
>
> Having a problem with a new Squid installation, 3.3.8 in Ubuntu 14.04.
>
> When trying to load certain webpages: twitter.com, reddit.com,
> ubuntugeek.com and experts-exchange.com the pages just sit there
loading and
> eventually in the case of Twitter some text will load but not in the
correct
> order, no images or advanced features etc. With the other two the
pages just
> don't load in the slightest.
>
> My config is attached squid.conf
>
<http://squid-web-proxy-cache.1019090.n4.nabble.com/file/n4669408/squid.conf> 

>
> Any help would be great as I'm completely stumped! Obviously bypassng
Squid
> makes these websites load and using an older version of Squid 2.7 for
> Windows works fine too.
>
> Thanks,
>
> Rich
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/Webpages-won-t-load-or-load-slowly-tp4669408.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUyiTKAAoJENNXIZxhPexGCFwH/1i3YSltQtTu19CaN1nzMOC2
YN0rsUar1HNzuMTSzwrM/kzV1gjyLH/BDoX2iO9RLfzjGOm4osf4r5yry3uasWwW
5KUP9zQbBuzUhhB4YVRhxidjrQ9G1wEErGlkzyAsXC6mKFfiGNiEuFFfmUReM+Nq
Dc32EN3f82mmXMuTRAprd/Z8OHmztgN0+KKJeCBe/PSXreduw6Gw57cm0SJ4m49m
Kgbt5nxmRvsqWu8JeVrGm3aUPZQiH8ErwRWRaWV9ebo4xe6jmxmdIFhVu0jbNvBm
0mgRwkM7avg011GtMRGdb4VfDX0/tqPbiMzqKjH7GfMIozaEkMSfWNndVMYpa3I=
=8DyG
-----END PGP SIGNATURE-----



From ahmed.zaeem at netstream.ps  Thu Jan 29 23:21:56 2015
From: ahmed.zaeem at netstream.ps (Ahmad)
Date: Thu, 29 Jan 2015 15:21:56 -0800
Subject: [squid-users] testttttt
In-Reply-To: <1422485596108-4669396.post@n4.nabble.com>
References: <00c901d03abe$eba9b7b0$c2fd2710$@netstream.ps>
 <1422485596108-4669396.post@n4.nabble.com>
Message-ID: <013d01d03c1a$65401860$2fc04920$@netstream.ps>

Lol .......it  seems a good joke :)

Thanks for all guys @ this nice mailing list .



-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of HackXBack
Sent: Wednesday, January 28, 2015 2:53 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] testttttt

Ping request could not find host testttttt. Please check the name and try again.



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/testttttt-tp4669368p4669396.html
Sent from the Squid - Users mailing list archive at Nabble.com.
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From Richard.Aspley at hammonds-uk.com  Thu Jan 29 13:43:34 2015
From: Richard.Aspley at hammonds-uk.com (Rich549)
Date: Thu, 29 Jan 2015 05:43:34 -0800 (PST)
Subject: [squid-users] Webpages won't load or load slowly
In-Reply-To: <54CA2403.4050009@gmail.com>
References: <1422530659467-4669408.post@n4.nabble.com>
 <54CA2403.4050009@gmail.com>
Message-ID: <1422539014059-4669413.post@n4.nabble.com>

Yuri Voinov wrote
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>  
> This one:
> 
> hierarchy_stoplist cgi-bin ?
> acl QUERY urlpath_regex cgi-bin \?
> cache deny QUERY
> 
> is deprecated.
> 
> And your Squid is ancient. :)
> 
> Why don't build from sources latest version?

I'll have a look at removing those from the config then, I'm surprised it
doesn't moan when I run 'squid3 -k reconfigure'.

The reason I have an older version is because this was the latest one
available in Aptitude and I don't like to stray outside of that normally as
it makes updating a (more or less) simple process. Plus I don't know how to
compile Squid from source for Ubuntu.

- Rich




--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Webpages-won-t-load-or-load-slowly-tp4669408p4669413.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From Richard.Aspley at hammonds-uk.com  Thu Jan 29 13:49:02 2015
From: Richard.Aspley at hammonds-uk.com (Rich549)
Date: Thu, 29 Jan 2015 05:49:02 -0800 (PST)
Subject: [squid-users] Webpages won't load or load slowly
In-Reply-To: <54CA24CA.9090101@gmail.com>
References: <1422530659467-4669408.post@n4.nabble.com>
 <54CA24CA.9090101@gmail.com>
Message-ID: <1422539342797-4669414.post@n4.nabble.com>

Yuri Voinov wrote
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>  
> And your access rules looks skew:
> 
> http_access deny BlacklistedSites StoresAllow
> http_access allow OK_Unauthenticated
> http_access allow StaticIPWhitelist
> http_access allow InetAllow
> http_access allow StoresAllow
> 
> 
> http_access allow ftp
> http_access allow CONNECT Safe_ports
> http_access allow manager localhost
> http_access deny manager
> http_access deny !Safe_ports
> http_access deny CONNECT !SSL_ports
> http_access deny all
> http_reply_access allow all
> 
> Where is allow rule for internal networks?
> 
> Something like:
> 
> http_access allow localnet
> 
> ?

We can access all of our local sites ok, is this required?
Any ideas about my original problem too? Or would updating to the latest
version be the fix for that?

Thanks,
- Rich



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Webpages-won-t-load-or-load-slowly-tp4669408p4669414.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From squid3 at treenet.co.nz  Thu Jan 29 13:57:13 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 30 Jan 2015 02:57:13 +1300
Subject: [squid-users] Which hits cachemgr shows?
In-Reply-To: <54CA0A71.7020502@gmail.com>
References: <54CA0A71.7020502@gmail.com>
Message-ID: <54CA3C39.4040909@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 29/01/2015 11:24 p.m., Yuri Voinov wrote:
> 
> Amos,
> 
> btw.
> 
> Which type of hits cachemgr collects and shows? TCP_HIT only?
> 
> What about other HIT-types?

All of them, broken down into cache-HITs and near-HITs categories.

As you can see in the info report, like this:

"
Median Service Times (seconds)  5 min    60 min:
	HTTP Requests (All):   0.05331  0.04519
	Cache Misses:          0.03622  0.04519
	Cache Hits:            0.00000  0.01387
	Near Hits:             0.09219  0.23230
"

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUyjw4AAoJELJo5wb/XPRjJ5AH+wcwdbjiffPx9Fe1/ugLXs6u
9aqXK+SZZdKijwBTj4MrJwBDoeVvYQyJ9f0AgEq1Vq9UJjcScPrYq+YcARzaSB4Y
1OYBuNt41s09ByrNeXHhtAZ4O6IfDpBI/IyGNlNcF63AmBINK1z6VidQnvUV1jUH
/1EdZTB1ry0k/A3rzXY/W4qDfXMKs+7afLCDmRNd9cDLq9qYxCOztfS+eWvGbXYL
+CXOSDV+zOVk80wf68uFCvfymPxCTfC6fl8cjKY0LT4DGeZ+xgv9GcOhviIuXoWf
IKPITFbOLc2/tkNHbajigMF9CBkh861xTQaoBVAxcZlqPbNrJVhxb5JpuUNTyHQ=
=qu4g
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Thu Jan 29 14:21:39 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 30 Jan 2015 03:21:39 +1300
Subject: [squid-users] Webpages won't load or load slowly
In-Reply-To: <1422539342797-4669414.post@n4.nabble.com>
References: <1422530659467-4669408.post@n4.nabble.com>
 <54CA24CA.9090101@gmail.com> <1422539342797-4669414.post@n4.nabble.com>
Message-ID: <54CA41F3.7000707@treenet.co.nz>

On 30/01/2015 2:49 a.m., Rich549 wrote:
> Yuri Voinov wrote
>> And your access rules looks skew:
>>
>> http_access deny BlacklistedSites StoresAllow
>> http_access allow OK_Unauthenticated
>> http_access allow StaticIPWhitelist
>> http_access allow InetAllow
>> http_access allow StoresAllow
>>

NP: He has the above rules instead of a localnet acess permission.

The worst part though is that since the above does not deny invalid user
credentials the following two lines...

>>
>> http_access allow ftp
>> http_access allow CONNECT Safe_ports

... effectively make the proxy an open relay for any type of abuse
anybody on the Internet wants to spew through it.


>> http_access allow manager localhost
>> http_access deny manager
>> http_access deny !Safe_ports
>> http_access deny CONNECT !SSL_ports

The above basic security checks are shuffled down here almost to the
end, which makes them almost ineffective...

>> http_access deny all

... then a deny all" which makes the security checks not only
ineffective but do nothing that would not have happened anyway. ie useless.


>> http_reply_access allow all
>>
>> Where is allow rule for internal networks?
>>
>> Something like:
>>
>> http_access allow localnet
>>
>> ?
> 
> We can access all of our local sites ok, is this required?

I reckon its a close call as to whether I could as well, using your
proxy. Just hinges on whether a TCP connection can be made from outside
your network to your Squid listening port.


To avoid that risk, order your http_access rules like this:


 http_access deny !Safe_ports
 http_access deny CONNECT !SSL_ports

 http_access deny BlacklistedSites StoresAllow

 http_access allow OK_Unauthenticated
 http_access allow StaticIPWhitelist

 acl login proxy_auth REQUIRED
 http_access deny !login

 http_access allow InetAllow
 http_access allow StoresAllow

 http_access allow localhost manager
 http_access deny all


Notice particularly how I moved the basic security checks up top again,
and erased the "allow ftp" and "allow CONNECT" lines.

The extra auth check is to catch and reject invalid login attempts
quickly without involving the external ACL helpers. It also helps with
some external ACL bugs we see had in some of the older versions.


If you encounter problems with people making legitimate CONNECT requests
to services with ports other than 443, please fix that by just adding
the ports to SSL_Ports ACL instead of moving the CONNECT security rule
around.
 That way they are still controlled by your auth, whitelist, and
blacklist policies.


> Any ideas about my original problem too? Or would updating to the latest
> version be the fix for that?

The current releases are faster, they also have fixed a bug in the
handling of CONNECT requests which is triggered by modern web protocols
like HTTP/2, SPDY, and Websockets. Any one of which those websites you
listed may be attempting to use and failing on a timeout before getting
through with HTTP/1.

Amos


From Richard.Aspley at hammonds-uk.com  Thu Jan 29 14:23:15 2015
From: Richard.Aspley at hammonds-uk.com (Rich549)
Date: Thu, 29 Jan 2015 06:23:15 -0800 (PST)
Subject: [squid-users] Webpages won't load or load slowly
In-Reply-To: <54CA41F3.7000707@treenet.co.nz>
References: <1422530659467-4669408.post@n4.nabble.com>
 <54CA24CA.9090101@gmail.com> <1422539342797-4669414.post@n4.nabble.com>
 <54CA41F3.7000707@treenet.co.nz>
Message-ID: <1422541395684-4669417.post@n4.nabble.com>

Looks like I have some work to do then, thanks for your help!

With regards to compiling Squid 3.5 for Ubuntu, would this guide be the
correct thing to follow: http://wiki.squid-cache.org/SquidFaq/CompilingSquid

- Rich



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Webpages-won-t-load-or-load-slowly-tp4669408p4669417.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From squid3 at treenet.co.nz  Thu Jan 29 14:35:50 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 30 Jan 2015 03:35:50 +1300
Subject: [squid-users] Webpages won't load or load slowly
In-Reply-To: <1422541395684-4669417.post@n4.nabble.com>
References: <1422530659467-4669408.post@n4.nabble.com>
 <54CA24CA.9090101@gmail.com> <1422539342797-4669414.post@n4.nabble.com>
 <54CA41F3.7000707@treenet.co.nz> <1422541395684-4669417.post@n4.nabble.com>
Message-ID: <54CA4546.3090605@treenet.co.nz>

On 30/01/2015 3:23 a.m., Rich549 wrote:
> Looks like I have some work to do then, thanks for your help!
> 
> With regards to compiling Squid 3.5 for Ubuntu, would this guide be the
> correct thing to follow: http://wiki.squid-cache.org/SquidFaq/CompilingSquid
> 

Specifically this part of it:
<http://wiki.squid-cache.org/SquidFaq/CompilingSquid#Debian.2C_Ubuntu>

Amos


From Richard.Aspley at hammonds-uk.com  Thu Jan 29 14:48:52 2015
From: Richard.Aspley at hammonds-uk.com (Rich549)
Date: Thu, 29 Jan 2015 06:48:52 -0800 (PST)
Subject: [squid-users] Webpages won't load or load slowly
In-Reply-To: <54CA4546.3090605@treenet.co.nz>
References: <1422530659467-4669408.post@n4.nabble.com>
 <54CA24CA.9090101@gmail.com> <1422539342797-4669414.post@n4.nabble.com>
 <54CA41F3.7000707@treenet.co.nz> <1422541395684-4669417.post@n4.nabble.com>
 <54CA4546.3090605@treenet.co.nz>
Message-ID: <1422542932042-4669419.post@n4.nabble.com>

Cool, that's the bit I was looking at so I'll follow that, thanks.

I've made the suggested changes to my security but I'm getting the following
error when I run reconfigure:

2015/01/29 14:50:37| aclParseAclList: ACL name '%LOGIN' not found.
FATAL: Bungled /etc/squid3/squid.conf line 312: http_access deny %LOGIN
Squid Cache (Version 3.3.8): Terminated abnormally.
CPU Usage: 0.014 seconds = 0.014 user + 0.000 sys
Maximum Resident Size: 21984 KB
Page faults with physical i/o: 0

My security now looks like this:

# ------------------------------------------------
# ------ Permit/Deny access as appropriate -------
# ------------------------------------------------

refresh_pattern -i (/cgi-bin/|\?) 0 0% 0     
refresh_pattern ^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern .		0	20%	4320
shutdown_lifetime 10 seconds
acl SSL_ports port 443 563 21
acl Safe_ports port 80		# http
acl Safe_ports port 21  	# ftp
acl Safe_ports port 22		# sftp
acl Safe_ports port 443 563	# https, snews
acl Safe_ports port 70		# gopher
acl Safe_ports port 210		# wais
acl Safe_ports port 1025-65535	# unregistered ports
acl Safe_ports port 280		# http-mgmt
acl Safe_ports port 488		# gss-http
acl Safe_ports port 591		# filemaker
acl Safe_ports port 777		# multiling http
acl Safe_ports port 4004	# Radii website download site uses this port
acl Safe_ports port 10000	# Webmin
acl Safe_ports port 900		# Swat
acl Safe_ports port 82		# Pacejet request - test site hosted on HTTP 82
acl Safe_ports port 81		# Image plus test server (hepplewhite)

acl CONNECT method CONNECT

http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

http_access deny BlacklistedSites StoresAllow

http_access allow OK_Unauthenticated
http_access allow StaticIPWhitelist

acl auth proxy_auth REQUIRED
http_access deny %LOGIN

http_access allow InetAllow
http_access allow StoresAllow

http_access allow localhost manager
http_access deny all

acl ftp proto FTP
#http_access allow ftp
#http_access allow CONNECT Safe_ports
http_access deny manager
http_reply_access allow all
icp_access allow all
cache_mgr otrs at hammonds-uk.com
forwarded_for off


Sorry for all of the questions...



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Webpages-won-t-load-or-load-slowly-tp4669408p4669419.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From Richard.Aspley at hammonds-uk.com  Thu Jan 29 14:50:08 2015
From: Richard.Aspley at hammonds-uk.com (Rich549)
Date: Thu, 29 Jan 2015 06:50:08 -0800 (PST)
Subject: [squid-users] Webpages won't load or load slowly
In-Reply-To: <1422542932042-4669419.post@n4.nabble.com>
References: <1422530659467-4669408.post@n4.nabble.com>
 <54CA24CA.9090101@gmail.com> <1422539342797-4669414.post@n4.nabble.com>
 <54CA41F3.7000707@treenet.co.nz> <1422541395684-4669417.post@n4.nabble.com>
 <54CA4546.3090605@treenet.co.nz> <1422542932042-4669419.post@n4.nabble.com>
Message-ID: <1422543008510-4669420.post@n4.nabble.com>

Oh...ignore the %LOGIN, that should be !LOGIN in both the error and my
config, I was fiddling with it to see if I could make it work.



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Webpages-won-t-load-or-load-slowly-tp4669408p4669420.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From yvoinov at gmail.com  Thu Jan 29 15:03:06 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 29 Jan 2015 21:03:06 +0600
Subject: [squid-users] Which hits cachemgr shows?
In-Reply-To: <54CA3C39.4040909@treenet.co.nz>
References: <54CA0A71.7020502@gmail.com> <54CA3C39.4040909@treenet.co.nz>
Message-ID: <54CA4BAA.7090807@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Yep. Can we sum near hits with hits to determine real cache hit ratio?
Or this is not correct?

29.01.2015 19:57, Amos Jeffries ?????:
> On 29/01/2015 11:24 p.m., Yuri Voinov wrote:
>
> > Amos,
>
> > btw.
>
> > Which type of hits cachemgr collects and shows? TCP_HIT only?
>
> > What about other HIT-types?
>
> All of them, broken down into cache-HITs and near-HITs categories.
>
> As you can see in the info report, like this:
>
> "
> Median Service Times (seconds)  5 min    60 min:
>     HTTP Requests (All):   0.05331  0.04519
>     Cache Misses:          0.03622  0.04519
>     Cache Hits:            0.00000  0.01387
>     Near Hits:             0.09219  0.23230
> "
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUykuqAAoJENNXIZxhPexGPFcIAJ55XDBJKp6zitqyg4YBwZ4a
2Et8V9WjEarpbhA/a3AlbVOWPpufQDwUNDXAgfYuWQQM5G24Fyr+baybZV8jbzEb
pJ9zvH8xJ0+a4kBNYjjya8bLXU9PzxuSVyLiQUxtShyzE2aB5MxNsZ37vj1lcXYb
P6MyA/bn6sFr+uV7ixdRs6LklGTow60toXv+5F17NgwTj3vSa/rKkoTfS3FXHf/G
oAJQH90If5KOOapR7wo6sTr5EU6OceIwrDLmtRbqwBtRxdDXi3AQcE8lUcDGb16k
8qzPgmSGCBJYwpxnaL0gFYjgs/HWq+DMh3xvnOT1iZDe4osa9hkJgVlmJohFqzw=
=KPd1
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150129/4ba3f020/attachment.htm>

From pavel.kazlenka at measurement-factory.com  Thu Jan 29 15:15:23 2015
From: pavel.kazlenka at measurement-factory.com (Pavel Kazlenka)
Date: Thu, 29 Jan 2015 18:15:23 +0300
Subject: [squid-users] How to force squid to ask for client certificate
 during tls handshake on https_port?
In-Reply-To: <54CA0AFA.1040905@gmail.com>
References: <54C8D999.6040902@measurement-factory.com>
 <54CA0ABB.20807@measurement-factory.com> <54CA0AFA.1040905@gmail.com>
Message-ID: <54CA4E8B.90204@measurement-factory.com>

Not really. There's no place in documentation where it is said which 
directives trigger user certificate retrieval. This has sense and could 
be assumed, but, e.g. acl user_cert doesn't trigger acquiring user 
certificate though this directive works with user certificate too.

On 01/29/2015 01:27 PM, Yuri Voinov wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>   
> .... Just read squid.conf.documented, is it? ;)
>
> 29.01.2015 16:26, Pavel Kazlenka ?????:
>> Answering my own question:
>>
>> Adding clientca= and cafile= options of https_port is enough to
> trigger client certificate request.
>> On 01/28/2015 03:44 PM, Pavel Kazlenka wrote:
>>> Hi gentlemen,
>>>
>>> I have https_port configured as the next:
>>> https_port 3128 cert=/home/tester/certificates/server.crt
> key=/home/tester/certificates/server.key
>>> and would like to force squid to retrieve client's certificate.
> According to
> http://www-01.ibm.com/support/knowledgecenter/api/content/nl/en-us/SSFKSJ_7.1.0/com.ibm.mq.doc/sy10660a.gif
> , client certificate request is optional and looks like squid doesn't
> request the one by default.
>>> Squid version if 3.5.1.
>>>
>>> Is that possible at all and if so, how to do this?
>>>
>>> TIA,
>>> Pavel
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2
>   
> iQEcBAEBAgAGBQJUygr6AAoJENNXIZxhPexGFTQH/ilYlldxB3PI0aWTP4ngfTQM
> SOwo3J73tG5ohi7MMutua8PmhMj28kuGEDXtXj8TradpGeIRcLS8RM2L6yxWFA5C
> ac2T/WjuH0PLLUCYx7mWeFz7WV7lUpf1CmZIiXf5gNxNCrMDHZd+fXphVaAph15T
> QE7W606yKmSM3zGbki7s8GtaBVh9TXSbkzpivnZbvbuvVN8FZow7rUzg9YWqgy79
> wBRJy0GcJx39DsEEhB7KC56ov8nFNe2kMWL7V6E1HbH4bZNMToPM53YO/9S06M9z
> /5dd9z9QReSwLgFEXMH1+yBFCfrA2onozJFcVoXOfu6UiUZbOFrczugwejH81Cc=
> =UTXu
> -----END PGP SIGNATURE-----
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From squid3 at treenet.co.nz  Thu Jan 29 15:18:00 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 30 Jan 2015 04:18:00 +1300
Subject: [squid-users] Which hits cachemgr shows?
In-Reply-To: <54CA4BAA.7090807@gmail.com>
References: <54CA0A71.7020502@gmail.com> <54CA3C39.4040909@treenet.co.nz>
 <54CA4BAA.7090807@gmail.com>
Message-ID: <54CA4F28.20406@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 30/01/2015 4:03 a.m., Yuri Voinov wrote:
> 
> Yep. Can we sum near hits with hits to determine real cache hit
> ratio? Or this is not correct?

You want to sum an average time/duration ?!

Lets take a step back...

 What are you trying to get out of all this?

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUyk8nAAoJELJo5wb/XPRjTz0H/3EwiAxIHAJdC2uq2n+gwO7a
Ez3tP4rdRIrh23TsHHm/MXGJte4LHHLQuJODOgChrEUSBUXyDwnAxnZVYEr9AYff
aqTr2M3GnJefepzKF5MRCvVQXTnLHVROlRquBtQ2+3bnvED8/zSFar6TuSCoQrqo
9hBN8IZtj+2I91Gdll6cvHs2ROlegahK73zjCpt0dFU5g691v+RvPJXsG10PXbyH
ypFmrNtINhwx1RvATKK1mHSspW3/6lIws9avI0omhqyxdYMlA85e/fT7/GJ2xrx8
sPs234suX/t8PfTlrowxRSnpEZSbIWp/GMp9xfgQEmOT6gL8/D7m1YqmXv6WjaA=
=//oG
-----END PGP SIGNATURE-----


From yvoinov at gmail.com  Thu Jan 29 15:20:47 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 29 Jan 2015 21:20:47 +0600
Subject: [squid-users] Which hits cachemgr shows?
In-Reply-To: <54CA4F28.20406@treenet.co.nz>
References: <54CA0A71.7020502@gmail.com> <54CA3C39.4040909@treenet.co.nz>
 <54CA4BAA.7090807@gmail.com> <54CA4F28.20406@treenet.co.nz>
Message-ID: <54CA4FCF.6060208@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
No. I want to count all hits :) Not only TCP_HIT/MEMORY_HIT. But also
complementary - TCP_UNMODIFIED_REFRESH, for example. AFAIK, this is also
HIT, no?

29.01.2015 21:18, Amos Jeffries ?????:
> On 30/01/2015 4:03 a.m., Yuri Voinov wrote:
>
> > Yep. Can we sum near hits with hits to determine real cache hit
> > ratio? Or this is not correct?
>
> You want to sum an average time/duration ?!
>
> Lets take a step back...
>
>  What are you trying to get out of all this?
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUyk/PAAoJENNXIZxhPexGs54IAMxauyXT31Fr8R5XbQfwnaGb
YxXEYg2hyRHAI7nSXm0mPZ+78GYCrXqS3JxzO4gTscKXAaexvASIAtzShGgcwIzE
UUubEcmv0F4SYv9VBngcsWuFQHWBSw5ttI6b2A5SIh0GiN3A62JpM+kfH1rGRCVr
k9ZyREPmQshVum8AK7hH3GN2NYDjGgof7aeCNgycxn26362UJnm/6ARdIYpH2TGB
P0vJj/FHd+yIs+B8yWntZtB68DgkWT4VAp8YQ1uhdziQ+Sn73bB03rX3U0lu8CoJ
miPmLI/ScwI8m53vikbnnLUCmGwlmu/QHDd/weYTRBk95xhIv10x5KcSr50i2Mc=
=zMYT
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150129/b421c7a6/attachment.htm>

From squid3 at treenet.co.nz  Thu Jan 29 15:21:28 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 30 Jan 2015 04:21:28 +1300
Subject: [squid-users] Webpages won't load or load slowly
In-Reply-To: <1422543008510-4669420.post@n4.nabble.com>
References: <1422530659467-4669408.post@n4.nabble.com>
 <54CA24CA.9090101@gmail.com> <1422539342797-4669414.post@n4.nabble.com>
 <54CA41F3.7000707@treenet.co.nz> <1422541395684-4669417.post@n4.nabble.com>
 <54CA4546.3090605@treenet.co.nz> <1422542932042-4669419.post@n4.nabble.com>
 <1422543008510-4669420.post@n4.nabble.com>
Message-ID: <54CA4FF8.7080802@treenet.co.nz>

On 30/01/2015 3:50 a.m., Rich549 wrote:
> Oh...ignore the %LOGIN, that should be !LOGIN in both the error and my
> config, I was fiddling with it to see if I could make it work.
> 

Should have been "!auth" by the last snippet you posted. Its a '!'
(invert match results) in front of the name of the ACL you define on the
line above.

Amos



From squid3 at treenet.co.nz  Thu Jan 29 15:30:44 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 30 Jan 2015 04:30:44 +1300
Subject: [squid-users] Compile error with Squid-3.5.1 under OpenBSD 5.5
In-Reply-To: <583874714.2343729.1422532563694.JavaMail.yahoo@mail.yahoo.com>
References: <583874714.2343729.1422532563694.JavaMail.yahoo@mail.yahoo.com>
Message-ID: <54CA5224.30805@treenet.co.nz>

On 30/01/2015 12:56 a.m., Theron ZORBAS wrote:
> Hi, 
> 
> I'm trying to compile squid-3.5.1 under OpenBSD 5.5 amd64. 
> 
> 
> I use gnutls as a depency package: 
> # pkg_info |grep gnutls 
> gnutls-3.2.15 GNU Transport Layer Security library 
> 
> 
> My configure parameters are: 
> ./configure --enable-arp-acl --disable-auth-basic --disable-auth-digest --enable-delay-pools --enable-external-acl-helpers="SQL_session file_userip session time_quota" --enable-forw-via-db --enable-negotiate-auth-helpers="no" --enable-removal-policies="lru heap" --enable-ssl --enable-ssl-crtd --enable-storeio="aufs ufs diskd" --with-pthreads --with-default-user=_squid --enable-follow-x-forwarded-for --mandir='/usr/local/man' --infodir='/usr/local/info' --enable-ipfw-transparent --disable-devpoll --disable-epoll --disable-ident-lookups --disable-loadable-modules --enable-forw-via-db --enable-http-violations --enable-icap-client --enable-ipv6 --with-filedescriptors=32768 --enable-stacktraces --enable-log-daemon-helpers="DB file" --enable-url-rewrite-helpers="fake" --enable-pf-transparent --with-openssl --disable-strict-error-checking --disable-arch-native 
> 
> And compile faults with these error messages: 
> depbase=`echo squidclient.o | sed 's|[^/]*$|.deps/&|;s|\.o$||'`; g++ -DHAVE_CONFIG_H -I../.. -I../../include -I../../lib -I../../src -I../../include -Wall -Wpointer-arith -Wwrite-strings -Wcomments -Wshadow -pipe -D_REENTRANT -I/usr/include -I/usr/local/include -I/usr/local/include/p11-kit-1 -I/usr/include -O0 -g -fno-strict-overflow -Wno-error -MT squidclient.o -MD -MP -MF $depbase.Tpo -c -o squidclient.o squidclient.cc && mv -f $depbase.Tpo $depbase.Po 
> In file included from squidclient.cc:17: 
> ../../tools/squidclient/Transport.h:81: error: 'gnutls_anon_client_credentials_t' does not name a type 
> ../../tools/squidclient/Transport.h:84: error: 'gnutls_certificate_credentials_t' does not name a type 
> ../../tools/squidclient/Transport.h:87: error: 'gnutls_session_t' does not name a type 
> squidclient.cc: In function 'int main(int, char**)': 
> squidclient.cc:538: error: 'gnutls_error_is_fatal' was not declared in this scope 
> squidclient.cc:539: error: 'gnutls_strerror' was not declared in this scope 
> squidclient.cc:541: error: 'gnutls_strerror' was not declared in this scope 
> *** Error 1 in tools/squidclient (Makefile:892 'squidclient.o') 
> *** Error 1 in tools/squidclient (Makefile:994 'all-recursive') 
> *** Error 1 in tools (Makefile:1067 'all-recursive') 
> *** Error 1 in /opt/squid-3.5.1 (Makefile:592 'all-recursive') 
> 
> 
> How can I fix this? Thanks. 
> 

NP: If you dont specifially want HTTPS support in that command line tool
then the quick way is to use --without-gnutls. That will get past this
without affecting the HTTPS abilities in other parts of Squid.


Can you please provide the output of the command:
   pkg-config gnutls

(that is what Squid is using to find GnuTLS location).

If GnuTLS is installed at an unusual location you may need to add to the
./configure options:
  --with-gnutls=/path


Also, unrelated but the clang compiler is generally better to use than
GCC on recent BSD systems. You should only need to add these to your
./configure parameters:   CC="clang" CXX="clang++"


Amos


From alejandro51295 at gmail.com  Thu Jan 29 15:34:58 2015
From: alejandro51295 at gmail.com (456mb)
Date: Thu, 29 Jan 2015 07:34:58 -0800 (PST)
Subject: [squid-users] Squid problem, one client for one user
In-Reply-To: <54C9F830.4060809@treenet.co.nz>
References: <1422518019197-4669402.post@n4.nabble.com>
 <54C9F830.4060809@treenet.co.nz>
Message-ID: <1422545698770-4669427.post@n4.nabble.com>

with the actually confi, only appear pop-up message to login, but dont limit
the conexion

i new in squid, dont existe a method more easy?

only i want one user per session, but actually i can login 999 times with
the same user and pass





--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-problem-one-client-for-one-user-tp4669402p4669427.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From yvoinov at gmail.com  Thu Jan 29 15:39:55 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 29 Jan 2015 21:39:55 +0600
Subject: [squid-users] Which hits cachemgr shows?
In-Reply-To: <54CA4F28.20406@treenet.co.nz>
References: <54CA0A71.7020502@gmail.com> <54CA3C39.4040909@treenet.co.nz>
 <54CA4BAA.7090807@gmail.com> <54CA4F28.20406@treenet.co.nz>
Message-ID: <54CA544B.6050002@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Also - how to count Store ID gotten files?

29.01.2015 21:18, Amos Jeffries ?????:
> On 30/01/2015 4:03 a.m., Yuri Voinov wrote:
>
> > Yep. Can we sum near hits with hits to determine real cache hit
> > ratio? Or this is not correct?
>
> You want to sum an average time/duration ?!
>
> Lets take a step back...
>
>  What are you trying to get out of all this?
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUylRLAAoJENNXIZxhPexGaxkH/jW6EJi4kCldr23RV2lfqCDw
q9myQJas2UUFDC++p+Ssj68xEJXS+ostKQTGqlOI11yyHuj6k1+QOwi6EW/g6Go0
/R8rMIuIVod7pluoxwpwjUsoXpF10Y9FoOpWBpT/Ue9SILNdVvqvprShwfKIOQu5
tCGmxwngmiSq5o+h7Jzz9lyYZjcqQ574mmUEDtJvDrodA5Il9PKMl+DN3RRsu4ck
9mSn75gVv+CDFAQxJXcfBXtkmCX+7PXday7A94FlWw/UeQMLLyV/jAEqMUSYpAeA
4Zi+BUoRIS3JOLRyyqKkrsW5z0q61Eyx7UDT4a4y81nAYEWjPdbo78uCHq8LwII=
=D2zd
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150129/ae5f0da9/attachment.htm>

From yvoinov at gmail.com  Thu Jan 29 15:40:54 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 29 Jan 2015 21:40:54 +0600
Subject: [squid-users] Squid problem, one client for one user
In-Reply-To: <1422545698770-4669427.post@n4.nabble.com>
References: <1422518019197-4669402.post@n4.nabble.com>
 <54C9F830.4060809@treenet.co.nz> <1422545698770-4669427.post@n4.nabble.com>
Message-ID: <54CA5486.3060305@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
I think, this is not Squid, but external auth system issue.

29.01.2015 21:34, 456mb ?????:
> with the actually confi, only appear pop-up message to login, but dont limit
> the conexion
>
> i new in squid, dont existe a method more easy?
>
> only i want one user per session, but actually i can login 999 times with
> the same user and pass
>
>
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-problem-one-client-for-one-user-tp4669402p4669427.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUylSGAAoJENNXIZxhPexGidEH/ii6JjZowY3BvBMUnllUoPdW
vV0NcYsehbLdLfTlrYNIBVgddiUQLMYMKdqBm7P6o7E6ciBts7x23uUY8Zpb0sZW
i2MU+6HGu8ED5Uw+Sw5XgoOcWlShpnUHzFC0caH10NDbfriqoz0a9OfEfknNtg0r
OTLlMtovsk50dfyIyGiji/gVrBijlSXV2Ti63oZChMKzgChItW1wmfxzcW/+1RJc
/YDyVfkrp+o2AnGumNNz8klQZPUZqzdrbKuhJnNI8sDXxrylnXtZRZRl/fQy6FE8
5ywnWRie0uzluHo/qe0kTm3XQTx1S8HW/SDZgz3dDfn8ZiyL383O0gfW1/gNGxo=
=t3Oh
-----END PGP SIGNATURE-----



From squid3 at treenet.co.nz  Thu Jan 29 15:45:25 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 30 Jan 2015 04:45:25 +1300
Subject: [squid-users] Which hits cachemgr shows?
In-Reply-To: <54CA4FCF.6060208@gmail.com>
References: <54CA0A71.7020502@gmail.com> <54CA3C39.4040909@treenet.co.nz>
 <54CA4BAA.7090807@gmail.com> <54CA4F28.20406@treenet.co.nz>
 <54CA4FCF.6060208@gmail.com>
Message-ID: <54CA5595.4070708@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 30/01/2015 4:20 a.m., Yuri Voinov wrote:
> 
> No. I want to count all hits :) Not only TCP_HIT/MEMORY_HIT. But
> also complementary - TCP_UNMODIFIED_REFRESH, for example. AFAIK,
> this is also HIT, no?

Yes. Straight from the code here is what is counted as a hit and added
into the relevant HIT statistic (HIT count, bandwidth used, ratios, etc):

 HIT
 IMS_HIT
 REFRESH_FAIL
 REFRESH_UNMODIFIED
 NEGATIVE_HIT
 MEM_HIT
 OFFLINE_HIT

The rest are accounted as MISS events.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEbBAEBAgAGBQJUylWUAAoJELJo5wb/XPRjBYkH92Ti6l3gEJXg9eC+ZUzh6cZD
2Hfvdycnyh77YrAAPg2P8Myvf/l794qvk3We1Gerwbc+3gVsNPvaXFMJXGDR57TM
KwTdMd7ogRsA/QXqMHZpI1IsL8sSHI2C9+AIV9m2xgMcpg7grke8f0HtSHENKavC
cKcE69yTNs49eu3p4+PUASZD48A2JOjteAd5aPNq0jd6CrWYsssHHJwFx9zMFEHd
O72oyYDiOIcX3oAbZZU4RXatCUuc936rbtKCWxrAS3Ci4Jri8mC4cstG9WsuxGdd
FqRM0updKLvNDuLqNyB6BeyuQ5IbUXn12GM1NmVx5i7eaX2Fp4j1QHhV20c27Q==
=CtlY
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Thu Jan 29 15:51:00 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 30 Jan 2015 04:51:00 +1300
Subject: [squid-users] Which hits cachemgr shows?
In-Reply-To: <54CA544B.6050002@gmail.com>
References: <54CA0A71.7020502@gmail.com> <54CA3C39.4040909@treenet.co.nz>
 <54CA4BAA.7090807@gmail.com> <54CA4F28.20406@treenet.co.nz>
 <54CA544B.6050002@gmail.com>
Message-ID: <54CA56E4.60105@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 30/01/2015 4:39 a.m., Yuri Voinov wrote:
> 
> Also - how to count Store ID gotten files?
> 

All StoreID is doing is modifying a hash key. Its not even part of the
index lookups, nor in any resulting network activity from those lookups.

You can count how many times the helper was used etc. But not what
happened afterwards.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUylbkAAoJELJo5wb/XPRjDO8IAK0m1rPbbo2uNgFuv0N5E3Lv
EiVj/4PtnmGX2wEHmsxwXfwkloWUCbdGud9HB6u0Ko7WRTZh+W5exMXpzrTJfGgm
4BUM61KSRo1nXxV/YoQeBMXfI9nxDMdYg0/oIYPCPK2RXeaf2kvkYMxxpooCf9zE
O8qWAnjSMHtkTepLjvEgqLAfRaGc8OfvInWBhjQ9v2j5btqYqalQyt1Vi6iwmCrJ
utMMMrCz+rOp0d4DmipjMbCgAhMM+FyCX82tibnTihyZ6cMgSLWTLacMHftLCs6s
Pp0S7jDyZR96XlfJt0BY+OmrgTApp6jVIOIRaylw5DNkN5qfyx7XixIVXGcMf/U=
=bhKg
-----END PGP SIGNATURE-----


From squid3 at treenet.co.nz  Thu Jan 29 15:56:34 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 30 Jan 2015 04:56:34 +1300
Subject: [squid-users] Squid problem, one client for one user
In-Reply-To: <54CA5486.3060305@gmail.com>
References: <1422518019197-4669402.post@n4.nabble.com>
 <54C9F830.4060809@treenet.co.nz> <1422545698770-4669427.post@n4.nabble.com>
 <54CA5486.3060305@gmail.com>
Message-ID: <54CA5832.2040802@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 30/01/2015 4:40 a.m., Yuri Voinov wrote:
> 
> I think, this is not Squid, but external auth system issue.
> 
> 29.01.2015 21:34, 456mb ?????:
>> with the actually confi, only appear pop-up message to login, but
>> dont limit the conexion
> 
>> i new in squid, dont existe a method more easy?
> 
>> only i want one user per session, but actually i can login 999
>> times with the same user and pass
> 

I spy:

 authenticate_ip_ttl 0 seconds

... instructing Squid *not* to remember what IPs a user is logged in with.

The default value is "1 second", so Squid at least has a chance to
remember IPs between consecutive requests if not for very long.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUylgxAAoJELJo5wb/XPRjLqAH/1zsh0M23wywAvVQOQVgeM6R
LVTi/jzXOTD08H4hWTeERlUwvJIJNOhbUlf57okNTd59Q7+RiXrDpUCGiN2gAKUX
8gwZYBTFA82WiK+OKF2d4k34wlZgRYKb3g8lufqS1myjEqwxdhDZU8wgOiP2l6jI
+ZrJaDYbOr68ETt8mNzLuhDT4biVmJWOGLI1GLI2RdTkjgoFPCSocgqK0Su80Klk
Q7fSE38NfflBykYByS+W7k8UpHdwKbrCMAOyPw9BuEC4GYsGU8wiSGHlkDteiYyl
Ab6JGBlofShcmBox5s0JTGjzHj54Idl4efVX3vOybmlC5GlL08LVLJrTJ4z61N8=
=Cs/B
-----END PGP SIGNATURE-----


From yvoinov at gmail.com  Thu Jan 29 16:19:15 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 29 Jan 2015 22:19:15 +0600
Subject: [squid-users] Which hits cachemgr shows?
In-Reply-To: <54CA56E4.60105@treenet.co.nz>
References: <54CA0A71.7020502@gmail.com> <54CA3C39.4040909@treenet.co.nz>
 <54CA4BAA.7090807@gmail.com> <54CA4F28.20406@treenet.co.nz>
 <54CA544B.6050002@gmail.com> <54CA56E4.60105@treenet.co.nz>
Message-ID: <54CA5D83.3040302@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Understand. As I thought.

Finally, just for clarity, is this refresh_pattern is meaningful with
store id helper:

refresh_pattern -i (video-srv|ytimg).*SQUIDINTERNAL    14400    99%   
518400    override-expire override-lastmod refresh-ims reload-into-ims
ignore-reload ignore-no-store ignore-private ignore-auth
ignore-must-revalidate store-stale

?

29.01.2015 21:51, Amos Jeffries ?????:
> On 30/01/2015 4:39 a.m., Yuri Voinov wrote:
>
> > Also - how to count Store ID gotten files?
>
>
> All StoreID is doing is modifying a hash key. Its not even part of the
> index lookups, nor in any resulting network activity from those lookups.
>
> You can count how many times the helper was used etc. But not what
> happened afterwards.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUyl2DAAoJENNXIZxhPexGEHsH/RdkxvZJPzAL7b98lamKvEW4
iX/5ljlXW+8UPH6czGFFsiG1W+QCBMTCdcY7/iktEpKR4CR0Hev80lICgdSnzWdZ
4/i0poAtXwZyCJzLaH8TJsONqG4EY84WHveIYDQf5x0XlN6bUuSXtYOXsbsBGl7A
fUN4OWOK4a2WIsNJzuCmLpcvTLMHbow3rDfu/1M7uvF98Cy1goh+wLXJ6FeFO2bK
5p3BzaPnXkD/8scFY8fhjV8VsxdpPepD05nMXYTgq8OgsaYzbNrbLY+FVl8EdeGE
IJZDrUJ7hR3SCa1v8++F7/YuBdiLyLp3bo6X6IXQaMFSLu13DImDsSOGXN9Y+uk=
=uy/4
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150129/b1ffd914/attachment.htm>

From fredbmail at free.fr  Thu Jan 29 16:32:34 2015
From: fredbmail at free.fr (FredB)
Date: Thu, 29 Jan 2015 17:32:34 +0100 (CET)
Subject: [squid-users] squid3
In-Reply-To: <7fdf1fa9.1d03a7c.1dd3bc1.124@pbandt.com>
Message-ID: <1521017858.319669818.1422549154414.JavaMail.root@zimbra4-e1.priv.proxad.net>


 
> 
> It is but it?s the latest version available through apt-get on Debian
> 7 without adding backports which I may end up doing anyway. However
> I don?t think that is my problem, I think I may have missed
> something in my config and was wondering if anyone had seen this
> before with the usernames not seeming to be passed to dansguardian.
> 
> 
> 


Which version of DG, anonymizelogs set to on ?
There is no authentication problem ?

----

Regards,

Fred

http://numsys.eu
http://e2guardian.org




From squid3 at treenet.co.nz  Thu Jan 29 16:38:41 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 30 Jan 2015 05:38:41 +1300
Subject: [squid-users] Which hits cachemgr shows?
In-Reply-To: <54CA5D83.3040302@gmail.com>
References: <54CA0A71.7020502@gmail.com> <54CA3C39.4040909@treenet.co.nz>
 <54CA4BAA.7090807@gmail.com> <54CA4F28.20406@treenet.co.nz>
 <54CA544B.6050002@gmail.com> <54CA56E4.60105@treenet.co.nz>
 <54CA5D83.3040302@gmail.com>
Message-ID: <54CA6211.1070702@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 30/01/2015 5:19 a.m., Yuri Voinov wrote:
> 
> Understand. As I thought.
> 
> Finally, just for clarity, is this refresh_pattern is meaningful
> with store id helper:
> 
> refresh_pattern -i (video-srv|ytimg).*SQUIDINTERNAL    14400    99%
>  518400    override-expire override-lastmod refresh-ims
> reload-into-ims ignore-reload ignore-no-store ignore-private
> ignore-auth ignore-must-revalidate store-stale
> 

Possibly, depend on whether the helper is providing IDs that match
that pattern or clients fetching URLs that match it (also very
possible given what the pattern will match).

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUymIRAAoJELJo5wb/XPRjqYcIANaER+sut8vrO4eaWj9Eucm2
fuu/YzQHgbkvx4U2ZktMBEIj4iLKmbxZCOrvyFgC3Yp2G+XEHD24/WmyfleHt4Ba
4vOdSNuODoI+AUgs5vvzMXKtWPHLDhLJgLWP3DSogzNlJrbsDkvc0LYfzrai32mU
TwKjrgh52HgR/Jt9cx7v+i7pp8WPTyYsaF47EnMCSpv4ED/IJlI6hiERG1F+gpbb
JtlW4WyONhP3/AcNuNeIZTIyMzVHmWoaEzCosxsi9/s+9xfTXYuUS1jIbcKkY5Mi
i1owVOQwFuRXDuF/gKtMRawB1zF4IUNMRY4QhEPIKxnGAmYtrloLkK9rwWsqS8Q=
=LmB+
-----END PGP SIGNATURE-----


From yvoinov at gmail.com  Thu Jan 29 16:47:00 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Thu, 29 Jan 2015 22:47:00 +0600
Subject: [squid-users] Which hits cachemgr shows?
In-Reply-To: <54CA6211.1070702@treenet.co.nz>
References: <54CA0A71.7020502@gmail.com> <54CA3C39.4040909@treenet.co.nz>
 <54CA4BAA.7090807@gmail.com> <54CA4F28.20406@treenet.co.nz>
 <54CA544B.6050002@gmail.com> <54CA56E4.60105@treenet.co.nz>
 <54CA5D83.3040302@gmail.com> <54CA6211.1070702@treenet.co.nz>
Message-ID: <54CA6404.5040000@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Thank you, Amos.

You break it down. :)

I think, this is removes most of the questions.

29.01.2015 22:38, Amos Jeffries ?????:
> Possibly, depend on whether the helper is providing IDs that match
> that pattern or clients fetching URLs that match it (also very
> possible given what the pattern will match).

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUymQEAAoJENNXIZxhPexGzh4H/RnxLem54dFVw8DsdxFnvgA1
AJUddBVxZrb+f3OaNfPVGa1t+tdJAkEbXADgDhXGui0CyM95TRPZu6E18eY0zUHj
cgayhZH9KG+CmpRRKAU2ATtoi30mcjlBJqt820XkrqXjYpg1N2RZlE3QsyqJGf3H
zTMxSWKzYaHedd4NFMJc/aB5w3SXnGGNd2jeX5VtKdmgXx54WtuP6oXJzPCgPsyV
r5VX+5Z3hGueh67r4JYba48aTUpNTtb/U7W2cBjYZC8D2ttC7eVpcYvqDfcKr2EV
yaqJWnSm9YZHiZucLlSed4Rrqno9xciZVqIrVuI+NUMd28FoSaxG4K5HSnAkKl8=
=UdI/
-----END PGP SIGNATURE-----



From christian.kundela at a1business.at  Fri Jan 30 00:43:09 2015
From: christian.kundela at a1business.at (Christian Kundela)
Date: Fri, 30 Jan 2015 01:43:09 +0100
Subject: [squid-users] SSL Bump, CA Cert
Message-ID: <54CAD39D.9090601@a1business.at>

Dear all,

I have problems setting up explicit proxy. (interrcept tcp 80 no problem)

If i doaself signed Cert, and i install it in Firefox or IE, no problem.

but if i use a CA-Cert i am using a signed cert from cacert.org, SSl 
Site only TXT loaded and no pictures ... this i know, when something is 
wrong with keyor else ?
(Install also all certs from cacert.org (also Firefox addons))

Key, CSR is generatedwith:
openssl genrsa -out /etc/squid/squid.key 2048
openssl req -new -key /etc/squid/squid.key -out /etc/squid/squid.csr

Signed on the sitecacert.org.TXT put into /etc/squid/squid.crt

My question: what CA Cert Squid expects ? wildcard * ? as common name i 
choose www.mydomain.net (is an example, for csr i used my real domain name).

How can trace this Problem (debug)or is the Cert wrong ?i stuck here ...


Best regards

Many Thanks in advice



Here is the squid.conf (changes done in config, added SquidGuard, C-Icap 
and MS update (from squid-cache.org) works all perfect)
IP of server is 192.168.1.1/24

## squid.conf begin
#
# Recommended minimum configuration:
#
# Example rule allowing access from your local networks.
# Adapt to list your (internal) IP networks from where browsing
# should be allowed
#acl localnet src 10.0.0.0/8            # RFC1918 possible internal network
#acl localnet src 172.16.0.0/12         # RFC1918 possible internal network
#acl localnet src 192.168.0.0/16        # RFC1918 possible internal network
acl localnet src fc00::/7               # RFC 4193 local private network 
range
acl localnet src fe80::/10              # RFC 4291 link-local (directly 
plugged) machines
acl localnet src 192.168.1.0/24

acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http

# MS Update
acl windowsupdate dstdomain windowsupdate.microsoft.com
acl windowsupdate dstdomain .update.microsoft.com
acl windowsupdate dstdomain download.windowsupdate.com
acl windowsupdate dstdomain redir.metaservices.microsoft.com
acl windowsupdate dstdomain images.metaservices.microsoft.com
acl windowsupdate dstdomain c.microsoft.com
acl windowsupdate dstdomain www.download.windowsupdate.com
acl windowsupdate dstdomain wustat.windows.com
acl windowsupdate dstdomain crl.microsoft.com
acl windowsupdate dstdomain sls.microsoft.com
acl windowsupdate dstdomain productactivation.one.microsoft.com
acl windowsupdate dstdomain ntservicepack.microsoft.com
acl windowsupdate dstdomain ctldl.windowsupdate.com

acl CONNECT method CONNECT

# MS Update
acl wuCONNECT dstdomain www.update.microsoft.com
acl wuCONNECT dstdomain sls.microsoft.com

#
# Recommended minimum Access Permission configuration:
#
# Deny requests to certain unsafe ports
http_access deny !Safe_ports

# Deny CONNECT to other than secure SSL ports
http_access deny CONNECT !SSL_ports

# Only allow cachemgr access from localhost
http_access allow localhost manager
http_access deny manager

# We strongly recommend the following be uncommented to protect innocent
# web applications running on the proxy server who think the only
# one who can access services on "localhost" is a local user
http_access deny to_localhost

#
# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
#

# MS Update
http_access allow CONNECT wuCONNECT localnet
http_access allow CONNECT wuCONNECT localhost
http_access allow windowsupdate localnet
http_access allow windowsupdate localhost

# Example rule allowing access from your local networks.
# Adapt localnet in the ACL section to list your (internal) IP networks
# from where browsing should be allowed
http_access allow localnet
http_access allow localhost

# And finally deny all other access to this proxy
http_access deny all

# SSL Stuff
always_direct allow all
ssl_bump server-first all
#sslproxy_cert_error allow all
#sslproxy_flags DONT_VERIFY_PEER

# Squid normally listens to port 3128
http_port localhost:3128
http_port 192.168.1.1:3130 ssl-bump cert=/etc/squid/server.crt 
key=/etc/squid/server.key# TEST
http_port localhost:3129 intercept

# Uncomment and adjust the following to add a disk cache directory.
cache_dir ufs /var/squid/cache 40000 16 256

# Added
cache_mem 2 GB

# Leave coredumps in the first cache dir
coredump_dir /var/squid/cache

# MS Update
refresh_pattern -i 
microsoft.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 80% 
43200 reload-into-ims
refresh_pattern -i 
windowsupdate.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 
80% 43200 reload-into-ims
refresh_pattern -i 
windows.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 80% 
43200 reload-into-ims

#
# Add any of your own refresh_pattern entries above these.
#
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320

# Added
max_filedescriptors 1024

# MS Update
range_offset_limit 200 MB windowsupdate
maximum_object_size 200 MB
quick_abort_min -1

# Path to the redirector program
url_rewrite_program   /usr/local/bin/squidGuard

# Number of redirector processes to spawn
url_rewrite_children  20

# To prevent loops, don't send requests from localhost to the redirector
url_rewrite_access    deny  localhost

# SquidClamav C-Icap
icap_enable on
icap_send_client_ip on
icap_send_client_username on
icap_client_username_encode off
icap_client_username_header X-Authenticated-User
icap_preview_enable on
icap_preview_size 1024
icap_service service_req reqmod_precache bypass=1 
icap://127.0.0.1:1344/squidclamav
adaptation_access service_req allow all
icap_service service_resp respmod_precache bypass=1 
icap://127.0.0.1:1344/squidclamav
adaptation_access service_resp allow all
## squid.conf end


From squid3 at treenet.co.nz  Fri Jan 30 04:42:04 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 30 Jan 2015 17:42:04 +1300
Subject: [squid-users] SSL Bump, CA Cert
In-Reply-To: <54CAD39D.9090601@a1business.at>
References: <54CAD39D.9090601@a1business.at>
Message-ID: <54CB0B9C.3060407@treenet.co.nz>

On 30/01/2015 1:43 p.m., Christian Kundela wrote:
> Dear all,
> 
> I have problems setting up explicit proxy. (interrcept tcp 80 no problem)
> 
> If i doaself signed Cert, and i install it in Firefox or IE, no problem.
> 
> but if i use a CA-Cert i am using a signed cert from cacert.org, SSl
> Site only TXT loaded and no pictures ... this i know, when something is
> wrong with keyor else ?
> (Install also all certs from cacert.org (also Firefox addons))

Something is definitely wrong with your understanding of TLS/SSL.

You are not alone in this, we get people every few weeks asking about
this same "problem".

> 
> Key, CSR is generatedwith:
> openssl genrsa -out /etc/squid/squid.key 2048
> openssl req -new -key /etc/squid/squid.key -out /etc/squid/squid.csr
> 
> Signed on the sitecacert.org.TXT put into /etc/squid/squid.crt
> 
> My question: what CA Cert Squid expects ? wildcard * ? as common name i
> choose www.mydomain.net (is an example, for csr i used my real domain
> name).

SSL-Bump cert generator requires both public and *private* security key
for a CA which is eligible to generate signed certificates.

To do what you are trying with a cacert.org signed certificate chain you
would need to have a copy of the private key belonging to cacert.org.
Or, to somehow convince them to grant *you* the same worldwide powers
and responsibilities that the global Trusted CA organisations have.

I hope you can see why that is not possible?


> 
> How can trace this Problem (debug)or is the Cert wrong ?i stuck here ...
> 

Use the self-signed cert in the way that you found works.

There are two situations where certificate generation is potentially
legitimately used:
 1) if you have legal authority to install your self-signed CA into the
client browser,
  - cacert.org and other Trusted CA organisations are unnecessary.

 2) if you own the domain being visited and are only delivering the cert
cacert.org verified as belonging to you.
  - interception of the traffic is unnecessary.

In neither situation do a Trusted CA signed certificate and interception
happen together.


Definitely do check up your local laws. Some countries its outright
illegal to use that Squid feature, others require a govt license, etc.

Amos


From eliezer at ngtech.co.il  Fri Jan 30 10:14:34 2015
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Fri, 30 Jan 2015 12:14:34 +0200
Subject: [squid-users] squid3
In-Reply-To: <7fdf1fa9.1d03a7c.1dd3bc1.124@pbandt.com>
References: <7fdf1fa9.1d03a7c.1dd3bc1.124@pbandt.com>
Message-ID: <54CB598A.2020909@ngtech.co.il>

Hey Bobby,

It is not true.
Squid3 in debian is newer then 3.1 as far as I remember and if it's not 
in the main repos then use the backports for it.
It is recommended that you will use a newer version of squid.
If for your environment 3.1 works fine then I guess you can say that it 
works and that's it.
Consider that there are more then couple bug fixes.

If you do use Debian you can consider ubuntu LTS version which is not 
up-to-date but has a more up to date version then 3.1.20.

Eliezer

On 27/01/2015 23:59, Bobby wrote:
> It is but it?s the latest version available through apt-get on Debian 7 without adding backports which I may end up doing anyway. However I don?t think that is my problem, I think I may have missed something in my config and was wondering if anyone had seen this before with the usernames not seeming to be passed to dansguardian.
>
> Bobby




From fredbmail at free.fr  Fri Jan 30 10:27:36 2015
From: fredbmail at free.fr (FredB)
Date: Fri, 30 Jan 2015 11:27:36 +0100 (CET)
Subject: [squid-users] squid3
In-Reply-To: <54CB598A.2020909@ngtech.co.il>
Message-ID: <521497225.321307357.1422613656144.JavaMail.root@zimbra4-e1.priv.proxad.net>

> It is not true.
> Squid3 in debian is newer then 3.1 as far as I remember and if it's
> not
> in the main repos then use the backports for it.

No, 3.1.20 is the latest in stable release (wheezy)

> > It is but it?s the latest version available through apt-get on
> > Debian 7 without adding backports which I may end up doing anyway.


Yes, maybe you should try

----

Regards,

Fred

http://numsys.eu
http://e2guardian.org


From yvoinov at gmail.com  Fri Jan 30 11:17:06 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Fri, 30 Jan 2015 17:17:06 +0600
Subject: [squid-users] SSL Bump, CA Cert
In-Reply-To: <54CAD39D.9090601@a1business.at>
References: <54CAD39D.9090601@a1business.at>
Message-ID: <54CB6832.3020500@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Christian,

for SSL Bump Squid expects only self-signed root CA. Not server signed -
it only appropriate on a reverse proxy.

WBR, Yuri

30.01.2015 6:43, Christian Kundela ?????:
> Dear all,
>
> I have problems setting up explicit proxy. (interrcept tcp 80 no problem)
>
> If i doaself signed Cert, and i install it in Firefox or IE, no problem.
>
> but if i use a CA-Cert i am using a signed cert from cacert.org, SSl
Site only TXT loaded and no pictures ... this i know, when something is
wrong with keyor else ?
> (Install also all certs from cacert.org (also Firefox addons))
>
> Key, CSR is generatedwith:
> openssl genrsa -out /etc/squid/squid.key 2048
> openssl req -new -key /etc/squid/squid.key -out /etc/squid/squid.csr
>
> Signed on the sitecacert.org.TXT put into /etc/squid/squid.crt
>
> My question: what CA Cert Squid expects ? wildcard * ? as common name
i choose www.mydomain.net (is an example, for csr i used my real domain
name).
>
> How can trace this Problem (debug)or is the Cert wrong ?i stuck here ...
>
>
> Best regards
>
> Many Thanks in advice
>
>
>
> Here is the squid.conf (changes done in config, added SquidGuard,
C-Icap and MS update (from squid-cache.org) works all perfect)
> IP of server is 192.168.1.1/24
>
> ## squid.conf begin
> #
> # Recommended minimum configuration:
> #
> # Example rule allowing access from your local networks.
> # Adapt to list your (internal) IP networks from where browsing
> # should be allowed
> #acl localnet src 10.0.0.0/8            # RFC1918 possible internal
network
> #acl localnet src 172.16.0.0/12         # RFC1918 possible internal
network
> #acl localnet src 192.168.0.0/16        # RFC1918 possible internal
network
> acl localnet src fc00::/7               # RFC 4193 local private
network range
> acl localnet src fe80::/10              # RFC 4291 link-local
(directly plugged) machines
> acl localnet src 192.168.1.0/24
>
> acl SSL_ports port 443
> acl Safe_ports port 80          # http
> acl Safe_ports port 21          # ftp
> acl Safe_ports port 443         # https
> acl Safe_ports port 70          # gopher
> acl Safe_ports port 210         # wais
> acl Safe_ports port 1025-65535  # unregistered ports
> acl Safe_ports port 280         # http-mgmt
> acl Safe_ports port 488         # gss-http
> acl Safe_ports port 591         # filemaker
> acl Safe_ports port 777         # multiling http
>
> # MS Update
> acl windowsupdate dstdomain windowsupdate.microsoft.com
> acl windowsupdate dstdomain .update.microsoft.com
> acl windowsupdate dstdomain download.windowsupdate.com
> acl windowsupdate dstdomain redir.metaservices.microsoft.com
> acl windowsupdate dstdomain images.metaservices.microsoft.com
> acl windowsupdate dstdomain c.microsoft.com
> acl windowsupdate dstdomain www.download.windowsupdate.com
> acl windowsupdate dstdomain wustat.windows.com
> acl windowsupdate dstdomain crl.microsoft.com
> acl windowsupdate dstdomain sls.microsoft.com
> acl windowsupdate dstdomain productactivation.one.microsoft.com
> acl windowsupdate dstdomain ntservicepack.microsoft.com
> acl windowsupdate dstdomain ctldl.windowsupdate.com
>
> acl CONNECT method CONNECT
>
> # MS Update
> acl wuCONNECT dstdomain www.update.microsoft.com
> acl wuCONNECT dstdomain sls.microsoft.com
>
> #
> # Recommended minimum Access Permission configuration:
> #
> # Deny requests to certain unsafe ports
> http_access deny !Safe_ports
>
> # Deny CONNECT to other than secure SSL ports
> http_access deny CONNECT !SSL_ports
>
> # Only allow cachemgr access from localhost
> http_access allow localhost manager
> http_access deny manager
>
> # We strongly recommend the following be uncommented to protect innocent
> # web applications running on the proxy server who think the only
> # one who can access services on "localhost" is a local user
> http_access deny to_localhost
>
> #
> # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
> #
>
> # MS Update
> http_access allow CONNECT wuCONNECT localnet
> http_access allow CONNECT wuCONNECT localhost
> http_access allow windowsupdate localnet
> http_access allow windowsupdate localhost
>
> # Example rule allowing access from your local networks.
> # Adapt localnet in the ACL section to list your (internal) IP networks
> # from where browsing should be allowed
> http_access allow localnet
> http_access allow localhost
>
> # And finally deny all other access to this proxy
> http_access deny all
>
> # SSL Stuff
> always_direct allow all
> ssl_bump server-first all
> #sslproxy_cert_error allow all
> #sslproxy_flags DONT_VERIFY_PEER
>
> # Squid normally listens to port 3128
> http_port localhost:3128
> http_port 192.168.1.1:3130 ssl-bump cert=/etc/squid/server.crt
key=/etc/squid/server.key# TEST
> http_port localhost:3129 intercept
>
> # Uncomment and adjust the following to add a disk cache directory.
> cache_dir ufs /var/squid/cache 40000 16 256
>
> # Added
> cache_mem 2 GB
>
> # Leave coredumps in the first cache dir
> coredump_dir /var/squid/cache
>
> # MS Update
> refresh_pattern -i
microsoft.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 80%
43200 reload-into-ims
> refresh_pattern -i
windowsupdate.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320
80% 43200 reload-into-ims
> refresh_pattern -i
windows.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 80%
43200 reload-into-ims
>
> #
> # Add any of your own refresh_pattern entries above these.
> #
> refresh_pattern ^ftp:           1440    20%     10080
> refresh_pattern ^gopher:        1440    0%      1440
> refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
> refresh_pattern .               0       20%     4320
>
> # Added
> max_filedescriptors 1024
>
> # MS Update
> range_offset_limit 200 MB windowsupdate
> maximum_object_size 200 MB
> quick_abort_min -1
>
> # Path to the redirector program
> url_rewrite_program   /usr/local/bin/squidGuard
>
> # Number of redirector processes to spawn
> url_rewrite_children  20
>
> # To prevent loops, don't send requests from localhost to the redirector
> url_rewrite_access    deny  localhost
>
> # SquidClamav C-Icap
> icap_enable on
> icap_send_client_ip on
> icap_send_client_username on
> icap_client_username_encode off
> icap_client_username_header X-Authenticated-User
> icap_preview_enable on
> icap_preview_size 1024
> icap_service service_req reqmod_precache bypass=1
icap://127.0.0.1:1344/squidclamav
> adaptation_access service_req allow all
> icap_service service_resp respmod_precache bypass=1
icap://127.0.0.1:1344/squidclamav
> adaptation_access service_resp allow all
> ## squid.conf end
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUy2gxAAoJENNXIZxhPexGwZMIAKX1uyFzdKrjq0FJvMMsL/9d
22R06xyExxuRIdWwp4IHAhWDud1dLlnAkEckmwCYdeUQJLeue/ccf6QIwblqT8ld
PruboM2+a3vE9KNKwXVUbv9UDhE933cq34/vX+kiBFIKc4/5TMFEjO9t/yeuamKl
3vYiRM9P7763AeCYRexB2tMHw9ghItstubav6ZzY2rmkdbqP+KlsaUL5jZOULTS7
FD8y8y3MW2jWFACYjqLZQ+0qjDJU2rcjEZR/w9jGGjGT7EEFxIPzvS9lAt5jVxIh
E8FzSnBKMw0FYQVEQW6mW6gfwNOhjTxTJKFlGigkITIp3R9vQaYhBwe8lYypTcQ=
=wjv1
-----END PGP SIGNATURE-----



From yvoinov at gmail.com  Fri Jan 30 11:19:24 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Fri, 30 Jan 2015 17:19:24 +0600
Subject: [squid-users] SSL Bump, CA Cert
In-Reply-To: <54CB0B9C.3060407@treenet.co.nz>
References: <54CAD39D.9090601@a1business.at> <54CB0B9C.3060407@treenet.co.nz>
Message-ID: <54CB68BC.3030507@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Amos,

this question is already ready for FAQ.

Time to write article in Squid Wiki? :)

This question popups every week.

WBR, Yuri

30.01.2015 10:42, Amos Jeffries ?????:
> On 30/01/2015 1:43 p.m., Christian Kundela wrote:
>> Dear all,
>>
>> I have problems setting up explicit proxy. (interrcept tcp 80 no problem)
>>
>> If i doaself signed Cert, and i install it in Firefox or IE, no problem.
>>
>> but if i use a CA-Cert i am using a signed cert from cacert.org, SSl
>> Site only TXT loaded and no pictures ... this i know, when something is
>> wrong with keyor else ?
>> (Install also all certs from cacert.org (also Firefox addons))
>
> Something is definitely wrong with your understanding of TLS/SSL.
>
> You are not alone in this, we get people every few weeks asking about
> this same "problem".
>
>>
>> Key, CSR is generatedwith:
>> openssl genrsa -out /etc/squid/squid.key 2048
>> openssl req -new -key /etc/squid/squid.key -out /etc/squid/squid.csr
>>
>> Signed on the sitecacert.org.TXT put into /etc/squid/squid.crt
>>
>> My question: what CA Cert Squid expects ? wildcard * ? as common name i
>> choose www.mydomain.net (is an example, for csr i used my real domain
>> name).
>
> SSL-Bump cert generator requires both public and *private* security key
> for a CA which is eligible to generate signed certificates.
>
> To do what you are trying with a cacert.org signed certificate chain you
> would need to have a copy of the private key belonging to cacert.org.
> Or, to somehow convince them to grant *you* the same worldwide powers
> and responsibilities that the global Trusted CA organisations have.
>
> I hope you can see why that is not possible?
>
>
>>
>> How can trace this Problem (debug)or is the Cert wrong ?i stuck here ...
>>
>
> Use the self-signed cert in the way that you found works.
>
> There are two situations where certificate generation is potentially
> legitimately used:
>  1) if you have legal authority to install your self-signed CA into the
> client browser,
>   - cacert.org and other Trusted CA organisations are unnecessary.
>
>  2) if you own the domain being visited and are only delivering the cert
> cacert.org verified as belonging to you.
>   - interception of the traffic is unnecessary.
>
> In neither situation do a Trusted CA signed certificate and interception
> happen together.
>
>
> Definitely do check up your local laws. Some countries its outright
> illegal to use that Squid feature, others require a govt license, etc.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUy2i8AAoJENNXIZxhPexGyV0H/R/uVgotfAKEUqrLdC5ieCHj
A7M9Ef+4/3D8Z0l7GFb31TWEAA6L2H4q857QvmefA4Tgd4Jo14X1tA7oi5HQgv3G
i0l+e7a0MBsxdKy5nO0vWBQEoghmj9qlhi5azfsKslINhlejmmrGhNNP2RQywZKK
ZSFJvUjbpg0J2iofBSY1kG8nDAC3BEBTkHJxbdW3NYZyXDAIYonHY7+UjBtIPKR5
XKZDYKjPI0GcjjKDoaePCYOgfzfjz5SXtxK2yyg1yeU61BRSidVMH6NAwmMxgd8I
TXpIslXQqmdZuwxuPo/HO4zdvLTwZxkBaZwKAi1OAPoYTBlO5JbkcaS38B7LUSI=
=Q9Fc
-----END PGP SIGNATURE-----



From bmatznick at pbandt.com  Fri Jan 30 14:39:00 2015
From: bmatznick at pbandt.com (Bobby)
Date: Fri, 30 Jan 2015 07:39:00 -0700
Subject: [squid-users] squid3
In-Reply-To: <521497225.321307357.1422613656144.JavaMail.root@zimbra4-e1.priv.proxad.net>
Message-ID: <863642d5.1d03c9a.4df46d.2d4f@pbandt.com>

When I look to see what's available after adding backports to sources.list I do see the 3.4 package:

root@######:/etc/squid3# apt-cache madison squid3
    squid3 | 3.4.8-5~bpo70+1 | http://ftp.debian.org/debian/ wheezy-backports/main i386 Packages
    squid3 | 3.1.20-2.2+deb7u2 | http://ftp.us.debian.org/debian/ wheezy/main i386 Packages
    squid3 | 3.1.20-2.2+deb7u2 | http://security.debian.org/ wheezy/updates/main i386 Packages
    squid3 | 3.1.20-2.2+deb7u2 | http://ftp.us.debian.org/debian/ wheezy/main Sources
    squid3 | 3.1.20-2.2+deb7u2 | http://security.debian.org/ wheezy/updates/main Sources
root@######:/etc/squid3#

But if I try to install it "apt-get install package-name" it cant seem to find it?

BMatz









-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of FredB
Sent: Friday, January 30, 2015 3:28 AM
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] squid3

> It is not true.
> Squid3 in debian is newer then 3.1 as far as I remember and if it's 
> not in the main repos then use the backports for it.

No, 3.1.20 is the latest in stable release (wheezy)

> > It is but it?s the latest version available through apt-get on 
> > Debian 7 without adding backports which I may end up doing anyway.


Yes, maybe you should try

----

Regards,

Fred

http://numsys.eu
http://e2guardian.org
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From christian.kundela at a1business.at  Fri Jan 30 14:58:55 2015
From: christian.kundela at a1business.at (Christian Kundela)
Date: Fri, 30 Jan 2015 15:58:55 +0100
Subject: [squid-users] SSL Bump, CA Cert
In-Reply-To: <54CAD39D.9090601@a1business.at>
References: <54CAD39D.9090601@a1business.at>
Message-ID: <54CB9C2F.8000309@a1business.at>

Dear all,

Many Thanks for help, an fast answers case closed.
Sorry for bothering you.

best regrads

Chris

Am 30.01.2015 um 01:43 schrieb Christian Kundela:
> Dear all,
>
> I have problems setting up explicit proxy. (interrcept tcp 80 no problem)
>
> If i doaself signed Cert, and i install it in Firefox or IE, no problem.
>
> but if i use a CA-Cert i am using a signed cert from cacert.org, SSl 
> Site only TXT loaded and no pictures ... this i know, when something 
> is wrong with keyor else ?
> (Install also all certs from cacert.org (also Firefox addons))
>
> Key, CSR is generatedwith:
> openssl genrsa -out /etc/squid/squid.key 2048
> openssl req -new -key /etc/squid/squid.key -out /etc/squid/squid.csr
>
> Signed on the sitecacert.org.TXT put into /etc/squid/squid.crt
>
> My question: what CA Cert Squid expects ? wildcard * ? as common name 
> i choose www.mydomain.net (is an example, for csr i used my real 
> domain name).
>
> How can trace this Problem (debug)or is the Cert wrong ?i stuck here ...
>
>
> Best regards
>
> Many Thanks in advice
>
>
>
> Here is the squid.conf (changes done in config, added SquidGuard, 
> C-Icap and MS update (from squid-cache.org) works all perfect)
> IP of server is 192.168.1.1/24
>
> ## squid.conf begin
> #
> # Recommended minimum configuration:
> #
> # Example rule allowing access from your local networks.
> # Adapt to list your (internal) IP networks from where browsing
> # should be allowed
> #acl localnet src 10.0.0.0/8            # RFC1918 possible internal 
> network
> #acl localnet src 172.16.0.0/12         # RFC1918 possible internal 
> network
> #acl localnet src 192.168.0.0/16        # RFC1918 possible internal 
> network
> acl localnet src fc00::/7               # RFC 4193 local private 
> network range
> acl localnet src fe80::/10              # RFC 4291 link-local 
> (directly plugged) machines
> acl localnet src 192.168.1.0/24
>
> acl SSL_ports port 443
> acl Safe_ports port 80          # http
> acl Safe_ports port 21          # ftp
> acl Safe_ports port 443         # https
> acl Safe_ports port 70          # gopher
> acl Safe_ports port 210         # wais
> acl Safe_ports port 1025-65535  # unregistered ports
> acl Safe_ports port 280         # http-mgmt
> acl Safe_ports port 488         # gss-http
> acl Safe_ports port 591         # filemaker
> acl Safe_ports port 777         # multiling http
>
> # MS Update
> acl windowsupdate dstdomain windowsupdate.microsoft.com
> acl windowsupdate dstdomain .update.microsoft.com
> acl windowsupdate dstdomain download.windowsupdate.com
> acl windowsupdate dstdomain redir.metaservices.microsoft.com
> acl windowsupdate dstdomain images.metaservices.microsoft.com
> acl windowsupdate dstdomain c.microsoft.com
> acl windowsupdate dstdomain www.download.windowsupdate.com
> acl windowsupdate dstdomain wustat.windows.com
> acl windowsupdate dstdomain crl.microsoft.com
> acl windowsupdate dstdomain sls.microsoft.com
> acl windowsupdate dstdomain productactivation.one.microsoft.com
> acl windowsupdate dstdomain ntservicepack.microsoft.com
> acl windowsupdate dstdomain ctldl.windowsupdate.com
>
> acl CONNECT method CONNECT
>
> # MS Update
> acl wuCONNECT dstdomain www.update.microsoft.com
> acl wuCONNECT dstdomain sls.microsoft.com
>
> #
> # Recommended minimum Access Permission configuration:
> #
> # Deny requests to certain unsafe ports
> http_access deny !Safe_ports
>
> # Deny CONNECT to other than secure SSL ports
> http_access deny CONNECT !SSL_ports
>
> # Only allow cachemgr access from localhost
> http_access allow localhost manager
> http_access deny manager
>
> # We strongly recommend the following be uncommented to protect innocent
> # web applications running on the proxy server who think the only
> # one who can access services on "localhost" is a local user
> http_access deny to_localhost
>
> #
> # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
> #
>
> # MS Update
> http_access allow CONNECT wuCONNECT localnet
> http_access allow CONNECT wuCONNECT localhost
> http_access allow windowsupdate localnet
> http_access allow windowsupdate localhost
>
> # Example rule allowing access from your local networks.
> # Adapt localnet in the ACL section to list your (internal) IP networks
> # from where browsing should be allowed
> http_access allow localnet
> http_access allow localhost
>
> # And finally deny all other access to this proxy
> http_access deny all
>
> # SSL Stuff
> always_direct allow all
> ssl_bump server-first all
> #sslproxy_cert_error allow all
> #sslproxy_flags DONT_VERIFY_PEER
>
> # Squid normally listens to port 3128
> http_port localhost:3128
> http_port 192.168.1.1:3130 ssl-bump cert=/etc/squid/server.crt 
> key=/etc/squid/server.key# TEST
> http_port localhost:3129 intercept
>
> # Uncomment and adjust the following to add a disk cache directory.
> cache_dir ufs /var/squid/cache 40000 16 256
>
> # Added
> cache_mem 2 GB
>
> # Leave coredumps in the first cache dir
> coredump_dir /var/squid/cache
>
> # MS Update
> refresh_pattern -i 
> microsoft.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 80% 
> 43200 reload-into-ims
> refresh_pattern -i 
> windowsupdate.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 
> 80% 43200 reload-into-ims
> refresh_pattern -i 
> windows.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 80% 
> 43200 reload-into-ims
>
> #
> # Add any of your own refresh_pattern entries above these.
> #
> refresh_pattern ^ftp:           1440    20%     10080
> refresh_pattern ^gopher:        1440    0%      1440
> refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
> refresh_pattern .               0       20%     4320
>
> # Added
> max_filedescriptors 1024
>
> # MS Update
> range_offset_limit 200 MB windowsupdate
> maximum_object_size 200 MB
> quick_abort_min -1
>
> # Path to the redirector program
> url_rewrite_program   /usr/local/bin/squidGuard
>
> # Number of redirector processes to spawn
> url_rewrite_children  20
>
> # To prevent loops, don't send requests from localhost to the redirector
> url_rewrite_access    deny  localhost
>
> # SquidClamav C-Icap
> icap_enable on
> icap_send_client_ip on
> icap_send_client_username on
> icap_client_username_encode off
> icap_client_username_header X-Authenticated-User
> icap_preview_enable on
> icap_preview_size 1024
> icap_service service_req reqmod_precache bypass=1 
> icap://127.0.0.1:1344/squidclamav
> adaptation_access service_req allow all
> icap_service service_resp respmod_precache bypass=1 
> icap://127.0.0.1:1344/squidclamav
> adaptation_access service_resp allow all
> ## squid.conf end
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From alberto2perez at gmail.com  Fri Jan 30 20:15:36 2015
From: alberto2perez at gmail.com (Alberto Perez)
Date: Fri, 30 Jan 2015 15:15:36 -0500
Subject: [squid-users] External ACL TTL not working as expected
In-Reply-To: <mailman.38090.1422648817.1833.squid-users@lists.squid-cache.org>
References: <mailman.38090.1422648817.1833.squid-users@lists.squid-cache.org>
Message-ID: <CAMZauGrzEQ3uUC5B3U5+QtshgTDCXfSmiR5NT76mcW+SCyivVQ@mail.gmail.com>

Hello to everyone,

First of all thanks for the support and for this awesome product.

I'm developing a captive portal with squid 3.4.9 over ubuntu 14.04

Here is my external acl configuration

external_acl_type session_active_def ipv4  %SRC
/etc/squid3/captive/sessionHelper.php  concurrency=100 children=1 -a
-f ttl=1  negative_ttl=0 startup=2 idle=1

acl password external session_active_def

deny_info https://proxy-bump.upr.edu.cu/?url=%u password


And the captive portal autenticate users against Active directory and
save authorization data to memcache server on the same proxy server.

External acl sessionHelper.php  checks for those authorization data in
the memcached server. I have not authentication, only authorization by
ip using that external acl and returning autenticated user so squid
log the username information.

Everything works like a charm except for the frequency squid checks
for those authorization data in the external acl, I has tried every
configuration sample found in the internet but without success, ttl
parameter of external acl doesnt works for me.

Session login and logout doesn't work as expected due to squid doesn't
check this external acl frecuently enough, user can surf after closed
session (removed user authorization data from memcache server) because
squid doesn't authorize anymore same ip requests using the external
acl.

Only way I found to force squid to check for the acl was reloading
configuration like /usr/sbin/squid3 -k reconfigure

But this gives me lot of instability  because squid stop accepting
connections for the time it is reloading configuration, I have lot of
people opening and closing sessions so right now squid is reloading
each minute to cover that demand.

My question: is there a way to force squid to check the external acl
each 1 second or just for every request without reloading
configuration.

I've tried all for over a month and you are my last resort, please
help, and forgive my english also.

Grateful

Alberto


From hack.back at hotmail.com  Fri Jan 30 20:16:21 2015
From: hack.back at hotmail.com (HackXBack)
Date: Fri, 30 Jan 2015 12:16:21 -0800 (PST)
Subject: [squid-users] FATAL: The ssl_crtd helpers are crashing too
 rapidly, need help!
In-Reply-To: <1422485986058-4669398.post@n4.nabble.com>
References: <1421929053162-4669257.post@n4.nabble.com>
 <1422034084407-4669297.post@n4.nabble.com> <54C2884E.4000509@treenet.co.nz>
 <1422158576716-4669314.post@n4.nabble.com>
 <1422205274028-4669322.post@n4.nabble.com> <54C557C8.7040509@gmail.com>
 <1422227373827-4669324.post@n4.nabble.com> <54C5D343.4070503@treenet.co.nz>
 <1422485986058-4669398.post@n4.nabble.com>
Message-ID: <1422648981449-4669447.post@n4.nabble.com>

Dear Amos ,
please answer me because crashing increased , now it happen every hour, so
every hour i need to delete old ssl db and create new one then restart squid
to make it works !!
how i can tune this issue to solve it i need you in this bug,
Thanks Mate.



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/FATAL-The-ssl-crtd-helpers-are-crashing-too-rapidly-need-help-tp4669257p4669447.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From yvoinov at gmail.com  Fri Jan 30 20:23:34 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Sat, 31 Jan 2015 02:23:34 +0600
Subject: [squid-users] FATAL: The ssl_crtd helpers are crashing too
 rapidly, need help!
In-Reply-To: <1422648981449-4669447.post@n4.nabble.com>
References: <1421929053162-4669257.post@n4.nabble.com>
 <1422034084407-4669297.post@n4.nabble.com> <54C2884E.4000509@treenet.co.nz>
 <1422158576716-4669314.post@n4.nabble.com>
 <1422205274028-4669322.post@n4.nabble.com> <54C557C8.7040509@gmail.com>
 <1422227373827-4669324.post@n4.nabble.com> <54C5D343.4070503@treenet.co.nz>
 <1422485986058-4669398.post@n4.nabble.com>
 <1422648981449-4669447.post@n4.nabble.com>
Message-ID: <54CBE846.2020809@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Man,

which SSL CA bundle are you using?


31.01.2015 2:16, HackXBack ?????:
> Dear Amos ,
> please answer me because crashing increased , now it happen every hour, so
> every hour i need to delete old ssl db and create new one then restart
squid
> to make it works !!
> how i can tune this issue to solve it i need you in this bug,
> Thanks Mate.
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/FATAL-The-ssl-crtd-helpers-are-crashing-too-rapidly-need-help-tp4669257p4669447.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUy+hFAAoJENNXIZxhPexG/yAH/31Ts4vKJkMHTGPXO4sTkUuc
gwI/dkrtpMEUWfzUV6HF5Kqf06mAMJ72UZpVwuRMwlx8z4l42IMaIjO6Sefnvi6a
1bWRite5i5uFLtiWB/Pi373HaKPH5sRrcyeLxOd0RkxdrLxr1rn8yxZI1dCXDFJj
95qfQ7YHqvfhT+jXpmUFhbnmxgbN6KdrPkwOldANsgIcMTcSnMBKYpzrTlpDWUpa
fBPgkIetj2IYN67pOXhoNC8siuos4GloWXtjYwmHELzqZDqIfiOLXZNmvmL5SMtE
n+UF0cc1Hzyd4Avz+VdTF6/CrPXn2fYASXvMDUxSMDWu/1NuIVr2DbSjHXe4bCc=
=HH+N
-----END PGP SIGNATURE-----



From yvoinov at gmail.com  Fri Jan 30 20:37:10 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Sat, 31 Jan 2015 02:37:10 +0600
Subject: [squid-users] FATAL: The ssl_crtd helpers are crashing too
 rapidly, need help!
In-Reply-To: <1422648981449-4669447.post@n4.nabble.com>
References: <1421929053162-4669257.post@n4.nabble.com>
 <1422034084407-4669297.post@n4.nabble.com> <54C2884E.4000509@treenet.co.nz>
 <1422158576716-4669314.post@n4.nabble.com>
 <1422205274028-4669322.post@n4.nabble.com> <54C557C8.7040509@gmail.com>
 <1422227373827-4669324.post@n4.nabble.com> <54C5D343.4070503@treenet.co.nz>
 <1422485986058-4669398.post@n4.nabble.com>
 <1422648981449-4669447.post@n4.nabble.com>
Message-ID: <54CBEB76.5040400@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
The point following.

OpenSSL itself contains CAs derived from Mozilla bundle.

This CA bundle is NOT complete and NOT contains most intermediate
certificates.

I was forced to find and install over 40 CA's.

In particular, Symantec intermediate and root CA is completely absent in
Mozilla bundle, and, following, in OpenSSL.

So, you can't bump Symantec updates and some Twitter services (yes, it
protected by Symantec CA's) without it.

Also, some CA chains will not work if your don't add some certs.

Finally - finding and install required CA's is your responsibility. The
bump can't performing well without most used CA's.

31.01.2015 2:16, HackXBack ?????:
> Dear Amos ,
> please answer me because crashing increased , now it happen every hour, so
> every hour i need to delete old ssl db and create new one then restart
squid
> to make it works !!
> how i can tune this issue to solve it i need you in this bug,
> Thanks Mate.
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/FATAL-The-ssl-crtd-helpers-are-crashing-too-rapidly-need-help-tp4669257p4669447.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUy+t2AAoJENNXIZxhPexG478H/AwdEGaqkowsjoN7q2ffe9Sp
HFc+oYiP9aJx2O9V2AB0+hkB+Lk/s9x2K2pVo+i8NhtWnUbJlvqqNoAeNvFfFCw1
UgYbNxqaVPxHCluYbPWCNCF3KhC7mP1fwGmluEtVjymNWqN5bKJABN/30CFjAJk9
Xkke6TwMbFT8akfSgJ+kZeiBLEl40TjLGrAfn5ul8UYrUCSyRjZ4LMXkqyqmWYBL
yc8pY5WPngnRkKsnHJ/olgLe4e8Q3S6EHtzULg59s7+jsPm4r2XS2SbMOLF6wfKM
vJi/yzB3v7Ks/JcC+PI7FyvKccpU4Urriv32+SXtQTk+aQkKsWQFc9yO/a46QU0=
=jyl+
-----END PGP SIGNATURE-----



From hack.back at hotmail.com  Fri Jan 30 20:56:12 2015
From: hack.back at hotmail.com (HackXBack)
Date: Fri, 30 Jan 2015 12:56:12 -0800 (PST)
Subject: [squid-users] FATAL: The ssl_crtd helpers are crashing too
 rapidly, need help!
In-Reply-To: <54CBEB76.5040400@gmail.com>
References: <1422034084407-4669297.post@n4.nabble.com>
 <54C2884E.4000509@treenet.co.nz> <1422158576716-4669314.post@n4.nabble.com>
 <1422205274028-4669322.post@n4.nabble.com> <54C557C8.7040509@gmail.com>
 <1422227373827-4669324.post@n4.nabble.com> <54C5D343.4070503@treenet.co.nz>
 <1422485986058-4669398.post@n4.nabble.com>
 <1422648981449-4669447.post@n4.nabble.com> <54CBEB76.5040400@gmail.com>
Message-ID: <1422651372368-4669450.post@n4.nabble.com>

 Yuri Voinov , 
what you are talking about ?
I used self signed CA, the problem is that every hour i got error in
cache.log and squid keep restarting
"Re: FATAL: The ssl_crtd helpers are crashing too rapidly, need help! "
and after i remove db 
rm -rf /etc/squid/ssl_db/certs

and then create again
/usr/lib/squid/ssl_crtd -c -s /etc/squid/ssl_db/certs

squid work fine for an hour and then the same ....



--
View this message in context: http://squid-web-proxy-cache.1019090.n4.nabble.com/FATAL-The-ssl-crtd-helpers-are-crashing-too-rapidly-need-help-tp4669257p4669450.html
Sent from the Squid - Users mailing list archive at Nabble.com.


From yvoinov at gmail.com  Fri Jan 30 21:13:04 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Sat, 31 Jan 2015 03:13:04 +0600
Subject: [squid-users] FATAL: The ssl_crtd helpers are crashing too
 rapidly, need help!
In-Reply-To: <1422651372368-4669450.post@n4.nabble.com>
References: <1422034084407-4669297.post@n4.nabble.com>
 <54C2884E.4000509@treenet.co.nz> <1422158576716-4669314.post@n4.nabble.com>
 <1422205274028-4669322.post@n4.nabble.com> <54C557C8.7040509@gmail.com>
 <1422227373827-4669324.post@n4.nabble.com> <54C5D343.4070503@treenet.co.nz>
 <1422485986058-4669398.post@n4.nabble.com>
 <1422648981449-4669447.post@n4.nabble.com> <54CBEB76.5040400@gmail.com>
 <1422651372368-4669450.post@n4.nabble.com>
Message-ID: <54CBF3E0.1050903@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Omg.

You ssl_crtd uses openssl, which uses public CA certs bundle.

I'm about it.

31.01.2015 2:56, HackXBack ?????:
>  Yuri Voinov , 
> what you are talking about ?
> I used self signed CA, the problem is that every hour i got error in
> cache.log and squid keep restarting
> "Re: FATAL: The ssl_crtd helpers are crashing too rapidly, need help! "
> and after i remove db
> rm -rf /etc/squid/ssl_db/certs
>
> and then create again
> /usr/lib/squid/ssl_crtd -c -s /etc/squid/ssl_db/certs
>
> squid work fine for an hour and then the same ....
>
>
>
> --
> View this message in context:
http://squid-web-proxy-cache.1019090.n4.nabble.com/FATAL-The-ssl-crtd-helpers-are-crashing-too-rapidly-need-help-tp4669257p4669450.html
> Sent from the Squid - Users mailing list archive at Nabble.com.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUy/PgAAoJENNXIZxhPexGetQH/RchxDE7QTDjFqqkfwfkHAUt
KBqXUKsJRHquvFs5vWEVCa3S65wCteDFxbKSfpivlX1eYJZiuPNe3kYyl2rinacH
EIOR9WAWOSWpTvTBuFLA0xfn/mDcwodjzW1eldvcFTt5aySu90g9eabXULIvEpeY
PRGyt2V2WkUHPDLOrZRyrKukdvbrVcODQGM0d9t9uCiC+52OC/q4Vcg1+kf31Fx3
XbwTYf1QP1XoIZZXvrx2hT9h1jFh3K/1qM0BO8kX1WYTJcwp8RKkeYCCi4Uz9EjI
5guHz9YZiUu6J27tcI6DniUVUfVKcSzxd1SM+tCUlY2pXVr+2od0Ym4Ffo8kjRA=
=cszn
-----END PGP SIGNATURE-----



From squid3 at treenet.co.nz  Fri Jan 30 21:49:31 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 31 Jan 2015 10:49:31 +1300
Subject: [squid-users] SSL Bump, CA Cert
In-Reply-To: <54CB68BC.3030507@gmail.com>
References: <54CAD39D.9090601@a1business.at> <54CB0B9C.3060407@treenet.co.nz>
 <54CB68BC.3030507@gmail.com>
Message-ID: <54CBFC6B.9010600@treenet.co.nz>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 31/01/2015 12:19 a.m., Yuri Voinov wrote:
> 
> Amos,
> 
> this question is already ready for FAQ.
> 
> Time to write article in Squid Wiki? :)

Where did you find that? must be hidden so deeply I missed it
yesterday when lookign for a ref.

Regarding blog, I need to get the wording straight and clears with
some good ConfigExample to point at.

Amos


-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUy/xrAAoJELJo5wb/XPRjTSEIAL4hHYjVaWdk81O1vMgGkrj6
floI68RMLPVRcQdmer8RBYjtNYT6bhxYot8mlAT2FrqOlYOyz9BWsowxp1Ol769p
3Pe8b+FqINNS6JL9vq97A5SGYreYg9AZ1uGFh1Yhf6ZP3/qGPficoKlWBoKpaKiB
O6/71Ite+VYePBV/GmoAdvMroI4Wccn2VmUC/czi5AlOpJOqjT4f/c+wRkjWXQ7o
oVbb6UOV2zjVH6B0bahZ17XdfX9qRKd+zX4xppfSJsseBwXxgw7XOyLd/Z2X2Vos
KUY/5GlbiDkJ2N0s4GZSnvmoj4CIp3zZdTwlJpK8K8heFsFrJhlhZHbAUNnT1N0=
=IuJO
-----END PGP SIGNATURE-----


From yvoinov at gmail.com  Fri Jan 30 21:57:06 2015
From: yvoinov at gmail.com (Yuri Voinov)
Date: Sat, 31 Jan 2015 03:57:06 +0600
Subject: [squid-users] SSL Bump, CA Cert
In-Reply-To: <54CBFC6B.9010600@treenet.co.nz>
References: <54CAD39D.9090601@a1business.at> <54CB0B9C.3060407@treenet.co.nz>
 <54CB68BC.3030507@gmail.com> <54CBFC6B.9010600@treenet.co.nz>
Message-ID: <54CBFE32.4050508@gmail.com>


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
I mean it not written yet. ;)

But looks like time to. ;)

Regarding FAQ - I think, need to clearly differentiate interception
bumping and reverse proxy. And focus to some near-SSL Squid details.
Somebody's don't understand, how PKI works in general. So, the
explanation must be extremely simple. ;)

31.01.2015 3:49, Amos Jeffries ?????:
> On 31/01/2015 12:19 a.m., Yuri Voinov wrote:
>
> > Amos,
>
> > this question is already ready for FAQ.
>
> > Time to write article in Squid Wiki? :)
>
> Where did you find that? must be hidden so deeply I missed it
> yesterday when lookign for a ref.
>
> Regarding blog, I need to get the wording straight and clears with
> some good ConfigExample to point at.
>
> Amos
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUy/4xAAoJENNXIZxhPexGPHkH/1D/T5pM3g0xcLRF8UvGgcRD
sa/FVNEYdTcLYMJ+rejZ5yLvvDS5mjCzM9BnMduASSAic0l++ARs2HrugYloN/I6
lKu+CMoAa34jUFrJOAT3n+Ruqa/1dp/7uhgUEVtf/Q0x5+5EpKAtR/gzYEMHUmu1
epbwLZPK7N1U/tj0PZ2Fsll2im/Lrioq5zi0aVKFUT82cPURV6aDb50Ua2fmm2fI
NbU52SUAtcee4Su5ZibyWqXeAr+r6LnEIktASlyTq8y5F0g+X3gn7+fSz4IFsIEK
DiADyMk2yM+oxiRRTHIJXbQrK4XmmuSXM5ukckK+NaFzZk/xdzaK8nnhPxLZ5QM=
=7pER
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150131/14829842/attachment.htm>

From squid3 at treenet.co.nz  Fri Jan 30 22:25:55 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 31 Jan 2015 11:25:55 +1300
Subject: [squid-users] External ACL TTL not working as expected
In-Reply-To: <CAMZauGrzEQ3uUC5B3U5+QtshgTDCXfSmiR5NT76mcW+SCyivVQ@mail.gmail.com>
References: <mailman.38090.1422648817.1833.squid-users@lists.squid-cache.org>
 <CAMZauGrzEQ3uUC5B3U5+QtshgTDCXfSmiR5NT76mcW+SCyivVQ@mail.gmail.com>
Message-ID: <54CC04F3.9060900@treenet.co.nz>

On 31/01/2015 9:15 a.m., Alberto Perez wrote:
> Hello to everyone,
> 
> First of all thanks for the support and for this awesome product.
> 

Welcome. Thank You for getting the use of authorization vs
authentication correct in your question :-) so nice not to have to start
with clarifying that.


> I'm developing a captive portal with squid 3.4.9 over ubuntu 14.04
> 
> Here is my external acl configuration
> 
> external_acl_type session_active_def ipv4  %SRC
> /etc/squid3/captive/sessionHelper.php  concurrency=100 children=1 -a
> -f ttl=1  negative_ttl=0 startup=2 idle=1
> 

<http://www.squid-cache.org/Doc/config/external_acl_type/>.


In particular you have the syntax for the helper wrong. The correct
syntax is:

 external_acl_type name [options] FORMAT /path/to/helper [helper arguments]

Note the difference between "options" and "helper arguments". Helper
arguments is part of the command line to be run.


So this is the correct config line for what you have above is:

 external_acl_type \
  session_active_def \
  concurrency=100 children-max=1 children-startup=1 \
    ipv4 ttl=1 negative_ttl=0 \
  \
  %SRC \
  /etc/squid3/captive/sessionHelper.php -a -f


I noticed the total number of children was smaller that the number
indicated to be run at startup. Squid would complain about that as it
auto-corrects to using startup=1.
Also, with startup >= children the idle parameter is unnecessary. There
is no amount of child helpers being started later based on load.


NP: There were a few nasty issues with the Zend engine limiting how long
a PHP script was allowed to run for. Even the dynamic restart feature
for Squid helpers was unable to solve that fully. You may want to
re-write the helper into another language for production use.



> acl password external session_active_def
> 
> deny_info https://proxy-bump.upr.edu.cu/?url=%u password
> 

Be careful with the use of HTTPS in sessions.

The initial CONNECT (even the fake-CONNECT Squid uses on intercepted
traffic) will need accounting for in your session management ACLs. You
dont want it to be kicking off another session login partway through the
first.



HTH
Amos


From squid3 at treenet.co.nz  Fri Jan 30 22:40:33 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 31 Jan 2015 11:40:33 +1300
Subject: [squid-users] FATAL: The ssl_crtd helpers are crashing too
 rapidly, need help!
In-Reply-To: <1422485986058-4669398.post@n4.nabble.com>
References: <1421929053162-4669257.post@n4.nabble.com>
 <1422034084407-4669297.post@n4.nabble.com> <54C2884E.4000509@treenet.co.nz>
 <1422158576716-4669314.post@n4.nabble.com>
 <1422205274028-4669322.post@n4.nabble.com> <54C557C8.7040509@gmail.com>
 <1422227373827-4669324.post@n4.nabble.com> <54C5D343.4070503@treenet.co.nz>
 <1422485986058-4669398.post@n4.nabble.com>
Message-ID: <54CC0861.3040204@treenet.co.nz>

On 29/01/2015 11:59 a.m., HackXBack wrote:
> Dear Amos,
> 
> root at dotspot:~# /usr/lib/squid/ssl_crtd -d
> /usr/lib/squid/ssl_crtd: Uninitialized SSL certificate database directory: .
> To initialize, run "ssl_crtd -c -s ".
> 
> no debug msg !!?
> 

That was the debug message:

"
 Uninitialized SSL certificate database directory: .
 To initialize, run "ssl_crtd -c -s ".

"

So the directory path mentioned at the end of the first line is .  (.)

I think you either missed out some command line parameters when running
that test, or have been creating the helpers database in a location
Squid does not use.

For example, if you previously ran "ssl_crtd -c -s " then the DB would
be created in your home directory, and when Squid tried to run helpers
in *its* working directory they would die.


The docs <http://www.squid-cache.org/Doc/config/sslcrtd_program/> says
the helper requires -s and -M parameters.

What I meant was for you to add -d to the ones Squid was running it as
and see if it would run for you. Something like:

  ssl_crtd -d -s /usr/local/squid/var/lib/ssl_db -M 4MB



Amos


From "darrenjbreeze" at netvigator.com  Sat Jan 31 01:00:40 2015
From: "darrenjbreeze" at netvigator.com (Darren B.)
Date: Sat, 31 Jan 2015 09:00:40 +0800
Subject: [squid-users] Splash page issues
Message-ID: <mailman.1.1736411243.1101126.squid-users@lists.squid-cache.org>

Hi

I am trying to set up a router that is inline between the clients and 
the internet.

Everything is working as far as proxy operations, however i am now 
trying to set up a splash page that new clients are shown when they 
first connect.

The splash page is served off a copy of nginx running on the proxy server.

local.<domainname>.com is set up in hosts and the dns the clients use to 
point to the correct IP

I seem to be tangled up in ACL ordering. Whilst the redirect to the 
splash page works fine, the session db is not getting written to so the 
client never gets past the splash page.

Any guidance on this would be greatly appreciated.

thanks in advance

Darren B.

the relevant bits of the config are as follows.

----------------------------------------------------

acl localnet1 src 172.25.101.0/24       # RFC1918 possible internal network
acl localnet2 src 172.25.102.0/24       # RFC1918 possible internal network
acl localnet3 src 172.25.103.0/24       # RFC1918 possible internal network

acl localserver dstdomain local.<domainname>.com

http_access allow localhost
http_access allow localserver

#splash page

external_acl_type splash_page concurrency=100 ttl=60 %SRC 
/usr/lib/squid3/ext_session_acl -a -T 10800 -b 
/mnt/data/squid/session/session.db
acl existing_users external splash_page
http_access deny !existing_users
deny_info http://local.<domainname>.com?usr=%s existing_users

http_access allow localnet1
http_access allow localnet2
http_access allow localnet3

http_access deny !Safe_ports

-----------------------------------------------------------

my build of squid is

Squid Cache: Version 3.3.8
Ubuntu
configure options:  '--build=x86_64-linux-gnu' '--prefix=/usr' 
'--includedir=${prefix}/include' '--mandir=${prefix}/share/man' 
'--infodir=${prefix}/share/info' '--sysconfdir=/etc' 
'--localstatedir=/var' '--libexecdir=${prefix}/lib/squid3' '--srcdir=.' 
'--disable-maintainer-mode' '--disable-dependency-tracking' 
'--disable-silent-rules' '--datadir=/usr/share/squid3' 
'--sysconfdir=/etc/squid3' '--mandir=/usr/share/man' '--enable-inline' 
'--enable-async-io=8' '--enable-storeio=ufs,aufs,diskd,rock' 
'--enable-removal-policies=lru,heap' '--enable-delay-pools' 
'--enable-cache-digests' '--enable-underscores' '--enable-icap-client' 
'--enable-follow-x-forwarded-for' 
'--enable-auth-basic=DB,fake,getpwnam,LDAP,MSNT,MSNT-multi-domain,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB' 
'--enable-auth-digest=file,LDAP' 
'--enable-auth-negotiate=kerberos,wrapper' 
'--enable-auth-ntlm=fake,smb_lm' 
'--enable-external-acl-helpers=file_userip,kerberos_ldap_group,LDAP_group,session,SQL_session,unix_group,wbinfo_group' 
'--enable-url-rewrite-helpers=fake' '--enable-ssl' '--enable-ssl-crtd' 
'--enable-eui' '--enable-esi' '--enable-icmp' '--enable-zph-qos' 
'--enable-ecap' '--disable-translation' 
'--with-swapdir=/var/spool/squid3' '--with-logdir=/var/log/squid3' 
'--with-pidfile=/var/run/squid3.pid' '--with-filedescriptors=65536' 
'--with-large-files' '--with-default-user=proxy' 
'--enable-linux-netfilter' 'build_alias=x86_64-linux-gnu' 'CFLAGS=-g -O2 
-fPIE -fstack-protector --param=ssp-buffer-size=4 -Wformat 
-Werror=format-security -Wall' 'LDFLAGS=-Wl,-Bsymbolic-functions -fPIE 
-pie -Wl,-z,relro -Wl,-z,now' 'CPPFLAGS=-D_FORTIFY_SOURCE=2' 
'CXXFLAGS=-g -O2 -fPIE -fstack-protector --param=ssp-buffer-size=4 
-Wformat -Werror=format-security'








From squid3 at treenet.co.nz  Sat Jan 31 01:26:37 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 31 Jan 2015 14:26:37 +1300
Subject: [squid-users] Splash page issues
In-Reply-To: <20150131010120.32F2CE52FB@lists.squid-cache.org>
References: <20150131010120.32F2CE52FB@lists.squid-cache.org>
Message-ID: <54CC2F4D.6070309@treenet.co.nz>

On 31/01/2015 2:00 p.m., Darren B. wrote:
> Hi
> 
> I am trying to set up a router that is inline between the clients and
> the internet.
> 
> Everything is working as far as proxy operations, however i am now
> trying to set up a splash page that new clients are shown when they
> first connect.
> 
> The splash page is served off a copy of nginx running on the proxy server.
> 
> local.<domainname>.com is set up in hosts and the dns the clients use to
> point to the correct IP
> 
> I seem to be tangled up in ACL ordering. Whilst the redirect to the
> splash page works fine, the session db is not getting written to so the
> client never gets past the splash page.

You explicitly configured that to happen.

> 
> external_acl_type splash_page concurrency=100 ttl=60 %SRC
> /usr/lib/squid3/ext_session_acl -a -T 10800 -b
> /mnt/data/squid/session/session.db

Helper in "active mode". Where explicit LOGIN action has to be requested
by the ACL test for any session to be created.


> acl existing_users external splash_page
> http_access deny !existing_users
> deny_info http://local.<domainname>.com?usr=%s existing_users
> 

Being used for only simple/passive session existence lookup.

Please read the *text* on this page:
<http://wiki.squid-cache.org/action/edit/ConfigExamples/Portal/Splash>



> 
> -----------------------------------------------------------
> 
> my build of squid is
> 
> Squid Cache: Version 3.3.8


Please also note how the captive portal example page has different
configuration settings for pre- and post- Squid-3.2.

Amos


From alberto2perez at gmail.com  Sat Jan 31 04:14:09 2015
From: alberto2perez at gmail.com (Alberto Perez)
Date: Fri, 30 Jan 2015 23:14:09 -0500
Subject: [squid-users] External ACL TTL not working as expected
In-Reply-To: <54CC04F3.9060900@treenet.co.nz>
References: <mailman.38090.1422648817.1833.squid-users@lists.squid-cache.org>
 <CAMZauGrzEQ3uUC5B3U5+QtshgTDCXfSmiR5NT76mcW+SCyivVQ@mail.gmail.com>
 <54CC04F3.9060900@treenet.co.nz>
Message-ID: <CAMZauGrBiKMDamQ=2G=S8qWx8af6yL+y9VM9wm8U-n0nzoWieg@mail.gmail.com>

Amos,
You rock it,
Thanks a lot, now its working pretty well.

I was partialy aware of PHP limitation when used to build external
helpers any way I gave it not too much importance since was working
fine, I will rewrite code in python ASAP, I appreciate your
recommendations.

Please if is not too much to ask, I will like to ask you about another
issue I have not been able to make it work, im trying to skip access
logging of a subnet, in old versions of squid (3.1) I was using the
following configuration


acl ip_upredes src 10.2.100.0/24

log_access deny ip_upredes
log_access allow all


As of squid 3.4 log_access directive was no longer available I was
trying to change to

cache_access_log stdio:/var/log/squid3/access.log
cache_store_log stdio:/var/log/squid3/store.log
access_log none ip_upredes


Starting squid in debug mode shows this

2015/01/30 22:50:15| ACL not found: ip_upredes
FATAL: Bungled /etc/squid3/squid.conf line 98: access_log none ip_upredes

I am suspecting about a missing configuration option when I compiled
squid, so following are my compilation options

configure options:
'--sysconfdir=/etc/squid3'
'--mandir=/usr/share/man'
'--enable-inline'
'--enable-async-io=8'
'--enable-storeio=ufs,aufs,diskd,rock'
'--enable-removal-policies=lru,heap'
'--enable-delay-pools'
'--enable-cache-digests'
'--enable-underscores'
'--enable-icap-client'
'--enable-follow-x-forwarded-for'
'--enable-url-rewrite-helpers=fake'
'--enable-eui'
'--enable-esi'
'--enable-icmp'
'--enable-zph-qos'
'--enable-ecap'
'--enable-ssl'
'--enable-ssl-crtd'
'--disable-translation'
'--with-swapdir=/var/spool/squid3'
'--with-logdir=/var/log/squid3'
'--with-pidfile=/var/run/squid3.pid'
'--with-filedescriptors=65536'
'--with-large-files'
'--with-default-user=proxy'


Again, thanks a lot for this great support, I read a lot of your
answers in this mailing list on the web and I can say you are making a
really GOOD job supporting this community and project.

Thanks, thanks, thanks

Alberto



On 1/30/15, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> On 31/01/2015 9:15 a.m., Alberto Perez wrote:
>> Hello to everyone,
>>
>> First of all thanks for the support and for this awesome product.
>>
>
> Welcome. Thank You for getting the use of authorization vs
> authentication correct in your question :-) so nice not to have to start
> with clarifying that.
>
>
>> I'm developing a captive portal with squid 3.4.9 over ubuntu 14.04
>>
>> Here is my external acl configuration
>>
>> external_acl_type session_active_def ipv4  %SRC
>> /etc/squid3/captive/sessionHelper.php  concurrency=100 children=1 -a
>> -f ttl=1  negative_ttl=0 startup=2 idle=1
>>
>
> <http://www.squid-cache.org/Doc/config/external_acl_type/>.
>
>
> In particular you have the syntax for the helper wrong. The correct
> syntax is:
>
>  external_acl_type name [options] FORMAT /path/to/helper [helper arguments]
>
> Note the difference between "options" and "helper arguments". Helper
> arguments is part of the command line to be run.
>
>
> So this is the correct config line for what you have above is:
>
>  external_acl_type \
>   session_active_def \
>   concurrency=100 children-max=1 children-startup=1 \
>     ipv4 ttl=1 negative_ttl=0 \
>   \
>   %SRC \
>   /etc/squid3/captive/sessionHelper.php -a -f
>
>
> I noticed the total number of children was smaller that the number
> indicated to be run at startup. Squid would complain about that as it
> auto-corrects to using startup=1.
> Also, with startup >= children the idle parameter is unnecessary. There
> is no amount of child helpers being started later based on load.
>
>
> NP: There were a few nasty issues with the Zend engine limiting how long
> a PHP script was allowed to run for. Even the dynamic restart feature
> for Squid helpers was unable to solve that fully. You may want to
> re-write the helper into another language for production use.
>
>
>
>> acl password external session_active_def
>>
>> deny_info https://proxy-bump.upr.edu.cu/?url=%u password
>>
>
> Be careful with the use of HTTPS in sessions.
>
> The initial CONNECT (even the fake-CONNECT Squid uses on intercepted
> traffic) will need accounting for in your session management ACLs. You
> dont want it to be kicking off another session login partway through the
> first.
>
>
>
> HTH
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


From tixu at cs.ucsd.edu  Sat Jan 31 05:41:39 2015
From: tixu at cs.ucsd.edu (Tianyin Xu)
Date: Fri, 30 Jan 2015 21:41:39 -0800
Subject: [squid-users] The email notification feature does not work after 10
	days
Message-ID: <CABBDWweu4v0o3=c5EVffkfasT75PAbHMcW2QLj63fn7_nnS6og@mail.gmail.com>

Hi,

I'm trying to use the email notification feature specified in the document.
http://www.squid-cache.org/Doc/config/mail_program/
http://www.squid-cache.org/Doc/config/cache_mgr/
http://www.squid-cache.org/Doc/config/mail_from/

Basically, if the Squid proxy server dies, I can receive an email
notification by configuring "mail_program", "cache_mgr", and
"mail_from". This is a very nice feature.

However, when I start Squid and then intentionally kill Squid by
issuing SEGV, Squid dies without sending any email to me. Diving into
the code, I see that the email notification feature is disabled by the
following if condition,

    /* src/tools.cc */
    ....
    if (squid_curtime - SQUID_RELEASE_TIME < 864000) {
        /* skip if more than 10 days old */
        if (Config.adminEmail)
            mail_warranty();

        puts(dead_msg());
    }

>From the comment, it seems that intentionally the feature is disabled
if the current time is latter than 10 days after the release time
(which is my case). This totally makes no sense to me because most
users like me will use this feature after 10 days latter than the
release date...

Could anyone explain this? I moved the if-condition and the feature does work.

I also opened a bugzilla report here,
http://bugs.squid-cache.org/show_bug.cgi?id=4184

Thanks!

~t


From squid3 at treenet.co.nz  Sat Jan 31 09:33:10 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 31 Jan 2015 22:33:10 +1300
Subject: [squid-users] External ACL TTL not working as expected
In-Reply-To: <CAMZauGrBiKMDamQ=2G=S8qWx8af6yL+y9VM9wm8U-n0nzoWieg@mail.gmail.com>
References: <mailman.38090.1422648817.1833.squid-users@lists.squid-cache.org>	<CAMZauGrzEQ3uUC5B3U5+QtshgTDCXfSmiR5NT76mcW+SCyivVQ@mail.gmail.com>	<54CC04F3.9060900@treenet.co.nz>
 <CAMZauGrBiKMDamQ=2G=S8qWx8af6yL+y9VM9wm8U-n0nzoWieg@mail.gmail.com>
Message-ID: <54CCA156.8010005@treenet.co.nz>

On 31/01/2015 5:14 p.m., Alberto Perez wrote:
> Amos,
> You rock it,
> Thanks a lot, now its working pretty well.
> 
> I was partialy aware of PHP limitation when used to build external
> helpers any way I gave it not too much importance since was working
> fine, I will rewrite code in python ASAP, I appreciate your
> recommendations.
> 
> Please if is not too much to ask, I will like to ask you about another
> issue I have not been able to make it work, im trying to skip access
> logging of a subnet, in old versions of squid (3.1) I was using the
> following configuration
> 
> 
> acl ip_upredes src 10.2.100.0/24
> 
> log_access deny ip_upredes
> log_access allow all
> 
> 
> As of squid 3.4 log_access directive was no longer available I was
> trying to change to
> 
> cache_access_log stdio:/var/log/squid3/access.log
> cache_store_log stdio:/var/log/squid3/store.log
> access_log none ip_upredes
> 

That should be:

 access_log stdio:/var/log/squid3/access.log squid !ip_upredes

Amos



From squid3 at treenet.co.nz  Sat Jan 31 10:04:50 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 31 Jan 2015 23:04:50 +1300
Subject: [squid-users] The email notification feature does not work
 after 10 days
In-Reply-To: <CABBDWweu4v0o3=c5EVffkfasT75PAbHMcW2QLj63fn7_nnS6og@mail.gmail.com>
References: <CABBDWweu4v0o3=c5EVffkfasT75PAbHMcW2QLj63fn7_nnS6og@mail.gmail.com>
Message-ID: <54CCA8C2.30600@treenet.co.nz>

On 31/01/2015 6:41 p.m., Tianyin Xu wrote:
> Hi,
> 
> I'm trying to use the email notification feature specified in the document.
> http://www.squid-cache.org/Doc/config/mail_program/
> http://www.squid-cache.org/Doc/config/cache_mgr/
> http://www.squid-cache.org/Doc/config/mail_from/
> 
> Basically, if the Squid proxy server dies, I can receive an email
> notification by configuring "mail_program", "cache_mgr", and
> "mail_from". This is a very nice feature.
> 
> However, when I start Squid and then intentionally kill Squid by
> issuing SEGV, Squid dies without sending any email to me. Diving into
> the code, I see that the email notification feature is disabled by the
> following if condition,
> 
>     /* src/tools.cc */
>     ....
>     if (squid_curtime - SQUID_RELEASE_TIME < 864000) {
>         /* skip if more than 10 days old */
>         if (Config.adminEmail)
>             mail_warranty();
> 
>         puts(dead_msg());
>     }
> 
> From the comment, it seems that intentionally the feature is disabled
> if the current time is latter than 10 days after the release time
> (which is my case). This totally makes no sense to me because most
> users like me will use this feature after 10 days latter than the
> release date...
> 
> Could anyone explain this? I moved the if-condition and the feature does work.
> 
> I also opened a bugzilla report here,
> http://bugs.squid-cache.org/show_bug.cgi?id=4184


It is a difficult situation.

The 10 day limit is itself a feature designed to reduce spam emails
being delivered from production systems which are stuck long-term on
"stable" version packages. Often long after the crash being notified
about is found and fixed. There are people still running Squid 3.1.6 for
example, despite years having passed and numerous crashes having been fixed.

Squid auto-restarts after crashes to ensure minimal downtime and user
impact. There are also numerous other things that could happen that are
only ever logged - that includes the reason for the crash being
notified.  So you should have log monitoring in place for production
systems anyway which mails you on criteria you are interested in. Making
this feature much less interesting for production systems using the
formal release for long periods of time.


It is much more interesting / useful to hear about crashes in newer code
with less production use and testing behind it.

The development code and daily snapshots define SQUID_RELEASE_TIME to be
squid_curtime so the if-condition always matches and enables the feature
for experimental installations.

This combined with the fact that the only way to resolve crash
conditions is to patch the code and/or build latest release snapshot,
means that people who are actually interested in avoiding those type of
problem are usually running the snapshot code where the 10-day limit
does not apply.


Amos


From alberto2perez at gmail.com  Sat Jan 31 14:16:55 2015
From: alberto2perez at gmail.com (Alberto Perez)
Date: Sat, 31 Jan 2015 09:16:55 -0500
Subject: [squid-users] External ACL TTL not working as expected
In-Reply-To: <54CCA156.8010005@treenet.co.nz>
References: <mailman.38090.1422648817.1833.squid-users@lists.squid-cache.org>
 <CAMZauGrzEQ3uUC5B3U5+QtshgTDCXfSmiR5NT76mcW+SCyivVQ@mail.gmail.com>
 <54CC04F3.9060900@treenet.co.nz>
 <CAMZauGrBiKMDamQ=2G=S8qWx8af6yL+y9VM9wm8U-n0nzoWieg@mail.gmail.com>
 <54CCA156.8010005@treenet.co.nz>
Message-ID: <CAMZauGqdJyX8hWMuWfxY1B=RA6w0NduAe6Q-AWFoBagm9QGr8g@mail.gmail.com>

Thank you Amos for your response,

Sorry to say this solution gives me the same result.

Any other idea?

Thanks a lot

Alberto


On 1/31/15, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> On 31/01/2015 5:14 p.m., Alberto Perez wrote:
>> Amos,
>> You rock it,
>> Thanks a lot, now its working pretty well.
>>
>> I was partialy aware of PHP limitation when used to build external
>> helpers any way I gave it not too much importance since was working
>> fine, I will rewrite code in python ASAP, I appreciate your
>> recommendations.
>>
>> Please if is not too much to ask, I will like to ask you about another
>> issue I have not been able to make it work, im trying to skip access
>> logging of a subnet, in old versions of squid (3.1) I was using the
>> following configuration
>>
>>
>> acl ip_upredes src 10.2.100.0/24
>>
>> log_access deny ip_upredes
>> log_access allow all
>>
>>
>> As of squid 3.4 log_access directive was no longer available I was
>> trying to change to
>>
>> cache_access_log stdio:/var/log/squid3/access.log
>> cache_store_log stdio:/var/log/squid3/store.log
>> access_log none ip_upredes
>>
>
> That should be:
>
>  access_log stdio:/var/log/squid3/access.log squid !ip_upredes
>
> Amos
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


From squid3 at treenet.co.nz  Sat Jan 31 14:29:58 2015
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 01 Feb 2015 03:29:58 +1300
Subject: [squid-users] External ACL TTL not working as expected
In-Reply-To: <CAMZauGqdJyX8hWMuWfxY1B=RA6w0NduAe6Q-AWFoBagm9QGr8g@mail.gmail.com>
References: <mailman.38090.1422648817.1833.squid-users@lists.squid-cache.org>	<CAMZauGrzEQ3uUC5B3U5+QtshgTDCXfSmiR5NT76mcW+SCyivVQ@mail.gmail.com>	<54CC04F3.9060900@treenet.co.nz>	<CAMZauGrBiKMDamQ=2G=S8qWx8af6yL+y9VM9wm8U-n0nzoWieg@mail.gmail.com>	<54CCA156.8010005@treenet.co.nz>
 <CAMZauGqdJyX8hWMuWfxY1B=RA6w0NduAe6Q-AWFoBagm9QGr8g@mail.gmail.com>
Message-ID: <54CCE6E6.5000000@treenet.co.nz>

On 1/02/2015 3:16 a.m., Alberto Perez wrote:
> Thank you Amos for your response,
> 
> Sorry to say this solution gives me the same result.
> 
> Any other idea?

The message "ACL not found: ip_upredes" means you did not configure any
ACL using that name.

You still need this bit from the old config in current Squid:
  acl ip_upredes src 10.2.100.0/24

... and it still needs to be defined above the log lines that use it.

Amos



From alberto2perez at gmail.com  Sat Jan 31 18:05:15 2015
From: alberto2perez at gmail.com (Alberto Perez)
Date: Sat, 31 Jan 2015 13:05:15 -0500
Subject: [squid-users] External ACL TTL not working as expected
In-Reply-To: <54CCA156.8010005@treenet.co.nz>
References: <mailman.38090.1422648817.1833.squid-users@lists.squid-cache.org>
 <CAMZauGrzEQ3uUC5B3U5+QtshgTDCXfSmiR5NT76mcW+SCyivVQ@mail.gmail.com>
 <54CC04F3.9060900@treenet.co.nz>
 <CAMZauGrBiKMDamQ=2G=S8qWx8af6yL+y9VM9wm8U-n0nzoWieg@mail.gmail.com>
 <54CCA156.8010005@treenet.co.nz>
Message-ID: <CAMZauGr+YhkPZc5e3h8s7_AmN0_uUvaXYFVOr=FXD6KsJWC=rw@mail.gmail.com>

Thank you again Amos,
it was the order, I didn't notice those lines where above ACLs
definition, is a huge config file and old version had it in the right
place so I didn't notice I altered the order in this config file.

Its good now, finally I used

access_log none ip_upredes
access_log stdio:/var/log/squid3/access.log  squid

Because I will be skipping logging for other ACLs

Thanks a lot for your help.

Good Bless you.

Have a nice weekend.

Alberto





On 1/31/15, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> On 31/01/2015 5:14 p.m., Alberto Perez wrote:
>> Amos,
>> You rock it,
>> Thanks a lot, now its working pretty well.
>>
>> I was partialy aware of PHP limitation when used to build external
>> helpers any way I gave it not too much importance since was working
>> fine, I will rewrite code in python ASAP, I appreciate your
>> recommendations.
>>
>> Please if is not too much to ask, I will like to ask you about another
>> issue I have not been able to make it work, im trying to skip access
>> logging of a subnet, in old versions of squid (3.1) I was using the
>> following configuration
>>
>>
>> acl ip_upredes src 10.2.100.0/24
>>
>> log_access deny ip_upredes
>> log_access allow all
>>
>>
>> As of squid 3.4 log_access directive was no longer available I was
>> trying to change to
>>
>> cache_access_log stdio:/var/log/squid3/access.log
>> cache_store_log stdio:/var/log/squid3/store.log
>> access_log none ip_upredes
>>
>
> That should be:
>
>  access_log stdio:/var/log/squid3/access.log squid !ip_upredes
>
> Amos
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


From tixu at cs.ucsd.edu  Sat Jan 31 21:25:14 2015
From: tixu at cs.ucsd.edu (Tianyin Xu)
Date: Sat, 31 Jan 2015 13:25:14 -0800
Subject: [squid-users] The email notification feature does not work
 after 10 days
In-Reply-To: <54CCA8C2.30600@treenet.co.nz>
References: <CABBDWweu4v0o3=c5EVffkfasT75PAbHMcW2QLj63fn7_nnS6og@mail.gmail.com>
 <54CCA8C2.30600@treenet.co.nz>
Message-ID: <CABBDWwf2EdSncWmAaMpddmCL3bSgYXzNEwa-REgPYJYY9BzesQ@mail.gmail.com>

Dear Amos,

Thanks for the explanation. It's interesting that the 10-day feature is for
encouraging users to apply the daily released snapshots. I'm never aware of
this.

Actually, I totally understand the users who are running old stable
versions (e.g., 3.1.6). They are reluctant to change or have no time to
test out the new versions as long as the current one works ok. I'm not
talking about the production uses such as in Baidu and in Flickr where a
big team of admins watching these servers on a 24*7 basis. The email
feature is attractive for users like me who uses Squid for non-production
scenarios but still requires certain level of availability. I think that's
why the feature is still there for years and I do appreciate it :-)

Thanks again, Amos! Have a great weekend!

Best,
Tianyin


On Sat, Jan 31, 2015 at 2:04 AM, Amos Jeffries <squid3 at treenet.co.nz> wrote:

> On 31/01/2015 6:41 p.m., Tianyin Xu wrote:
> > Hi,
> >
> > I'm trying to use the email notification feature specified in the
> document.
> > http://www.squid-cache.org/Doc/config/mail_program/
> > http://www.squid-cache.org/Doc/config/cache_mgr/
> > http://www.squid-cache.org/Doc/config/mail_from/
> >
> > Basically, if the Squid proxy server dies, I can receive an email
> > notification by configuring "mail_program", "cache_mgr", and
> > "mail_from". This is a very nice feature.
> >
> > However, when I start Squid and then intentionally kill Squid by
> > issuing SEGV, Squid dies without sending any email to me. Diving into
> > the code, I see that the email notification feature is disabled by the
> > following if condition,
> >
> >     /* src/tools.cc */
> >     ....
> >     if (squid_curtime - SQUID_RELEASE_TIME < 864000) {
> >         /* skip if more than 10 days old */
> >         if (Config.adminEmail)
> >             mail_warranty();
> >
> >         puts(dead_msg());
> >     }
> >
> > From the comment, it seems that intentionally the feature is disabled
> > if the current time is latter than 10 days after the release time
> > (which is my case). This totally makes no sense to me because most
> > users like me will use this feature after 10 days latter than the
> > release date...
> >
> > Could anyone explain this? I moved the if-condition and the feature does
> work.
> >
> > I also opened a bugzilla report here,
> > http://bugs.squid-cache.org/show_bug.cgi?id=4184
>
>
> It is a difficult situation.
>
> The 10 day limit is itself a feature designed to reduce spam emails
> being delivered from production systems which are stuck long-term on
> "stable" version packages. Often long after the crash being notified
> about is found and fixed. There are people still running Squid 3.1.6 for
> example, despite years having passed and numerous crashes having been
> fixed.
>
> Squid auto-restarts after crashes to ensure minimal downtime and user
> impact. There are also numerous other things that could happen that are
> only ever logged - that includes the reason for the crash being
> notified.  So you should have log monitoring in place for production
> systems anyway which mails you on criteria you are interested in. Making
> this feature much less interesting for production systems using the
> formal release for long periods of time.
>
>
> It is much more interesting / useful to hear about crashes in newer code
> with less production use and testing behind it.
>
> The development code and daily snapshots define SQUID_RELEASE_TIME to be
> squid_curtime so the if-condition always matches and enables the feature
> for experimental installations.
>
> This combined with the fact that the only way to resolve crash
> conditions is to patch the code and/or build latest release snapshot,
> means that people who are actually interested in avoiding those type of
> problem are usually running the snapshot code where the 10-day limit
> does not apply.
>
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20150131/3abab04d/attachment.htm>

From tixu at cs.ucsd.edu  Sat Jan 31 22:01:24 2015
From: tixu at cs.ucsd.edu (Tianyin Xu)
Date: Sat, 31 Jan 2015 14:01:24 -0800
Subject: [squid-users] The email notification feature does not work
 after 10 days
In-Reply-To: <CABBDWwf2EdSncWmAaMpddmCL3bSgYXzNEwa-REgPYJYY9BzesQ@mail.gmail.com>
References: <CABBDWweu4v0o3=c5EVffkfasT75PAbHMcW2QLj63fn7_nnS6og@mail.gmail.com>
 <54CCA8C2.30600@treenet.co.nz>
 <CABBDWwf2EdSncWmAaMpddmCL3bSgYXzNEwa-REgPYJYY9BzesQ@mail.gmail.com>
Message-ID: <CABBDWwd6U2iViMpQ53j0SitJK+bJaFHryMaDxab-DJq2n-Hu7g@mail.gmail.com>

btw, I closed the bugzilla case by referring to your reply.

Anyway, since Squid is an open-source project, the users who don't
want the 10-day limit can always comment the if-condition to always
get email notifications.

Thanks!

~t



On Sat, Jan 31, 2015 at 1:25 PM, Tianyin Xu <tixu at cs.ucsd.edu> wrote:
> Dear Amos,
>
> Thanks for the explanation. It's interesting that the 10-day feature is for
> encouraging users to apply the daily released snapshots. I'm never aware of
> this.
>
> Actually, I totally understand the users who are running old stable versions
> (e.g., 3.1.6). They are reluctant to change or have no time to test out the
> new versions as long as the current one works ok. I'm not talking about the
> production uses such as in Baidu and in Flickr where a big team of admins
> watching these servers on a 24*7 basis. The email feature is attractive for
> users like me who uses Squid for non-production scenarios but still requires
> certain level of availability. I think that's why the feature is still there
> for years and I do appreciate it :-)
>
> Thanks again, Amos! Have a great weekend!
>
> Best,
> Tianyin
>
>
> On Sat, Jan 31, 2015 at 2:04 AM, Amos Jeffries <squid3 at treenet.co.nz> wrote:
>>
>> On 31/01/2015 6:41 p.m., Tianyin Xu wrote:
>> > Hi,
>> >
>> > I'm trying to use the email notification feature specified in the
>> > document.
>> > http://www.squid-cache.org/Doc/config/mail_program/
>> > http://www.squid-cache.org/Doc/config/cache_mgr/
>> > http://www.squid-cache.org/Doc/config/mail_from/
>> >
>> > Basically, if the Squid proxy server dies, I can receive an email
>> > notification by configuring "mail_program", "cache_mgr", and
>> > "mail_from". This is a very nice feature.
>> >
>> > However, when I start Squid and then intentionally kill Squid by
>> > issuing SEGV, Squid dies without sending any email to me. Diving into
>> > the code, I see that the email notification feature is disabled by the
>> > following if condition,
>> >
>> >     /* src/tools.cc */
>> >     ....
>> >     if (squid_curtime - SQUID_RELEASE_TIME < 864000) {
>> >         /* skip if more than 10 days old */
>> >         if (Config.adminEmail)
>> >             mail_warranty();
>> >
>> >         puts(dead_msg());
>> >     }
>> >
>> > From the comment, it seems that intentionally the feature is disabled
>> > if the current time is latter than 10 days after the release time
>> > (which is my case). This totally makes no sense to me because most
>> > users like me will use this feature after 10 days latter than the
>> > release date...
>> >
>> > Could anyone explain this? I moved the if-condition and the feature does
>> > work.
>> >
>> > I also opened a bugzilla report here,
>> > http://bugs.squid-cache.org/show_bug.cgi?id=4184
>>
>>
>> It is a difficult situation.
>>
>> The 10 day limit is itself a feature designed to reduce spam emails
>> being delivered from production systems which are stuck long-term on
>> "stable" version packages. Often long after the crash being notified
>> about is found and fixed. There are people still running Squid 3.1.6 for
>> example, despite years having passed and numerous crashes having been
>> fixed.
>>
>> Squid auto-restarts after crashes to ensure minimal downtime and user
>> impact. There are also numerous other things that could happen that are
>> only ever logged - that includes the reason for the crash being
>> notified.  So you should have log monitoring in place for production
>> systems anyway which mails you on criteria you are interested in. Making
>> this feature much less interesting for production systems using the
>> formal release for long periods of time.
>>
>>
>> It is much more interesting / useful to hear about crashes in newer code
>> with less production use and testing behind it.
>>
>> The development code and daily snapshots define SQUID_RELEASE_TIME to be
>> squid_curtime so the if-condition always matches and enables the feature
>> for experimental installations.
>>
>> This combined with the fact that the only way to resolve crash
>> conditions is to patch the code and/or build latest release snapshot,
>> means that people who are actually interested in avoiding those type of
>> problem are usually running the snapshot code where the 10-day limit
>> does not apply.
>>
>>
>> Amos
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>
>



-- 
Tianyin XU,
http://cseweb.ucsd.edu/~tixu/


From "darrenjbreeze" at netvigator.com  Sat Jan 31 23:02:41 2015
From: "darrenjbreeze" at netvigator.com (Darren B.)
Date: Sun, 01 Feb 2015 07:02:41 +0800
Subject: [squid-users] Splash page issues
In-Reply-To: <54CC2F4D.6070309@treenet.co.nz>
References: <20150131010120.32F2CE52FB@lists.squid-cache.org>
 <54CC2F4D.6070309@treenet.co.nz>
Message-ID: <mailman.2.1736411243.1101126.squid-users@lists.squid-cache.org>

Hi

I removed the -a flag from the external_acl_type line but it still 
refused to create a session.db so the acl failed.

after scratching around, I found that limiting it to ipv4 made 
everything work perfectly.

the new config line reads

external_acl_type splash_page ipv4 ttl=5 concurrency=100 %SRC 
/usr/lib/squid3/ext_session_acl -t 7200 -b /mnt/ksn/squid/session/session.db

happy days.

thanks

Darren B






On 31/01/2015 9:26 AM, Amos Jeffries wrote:
> On 31/01/2015 2:00 p.m., Darren B. wrote:
>> Hi
>>
>> I am trying to set up a router that is inline between the clients and
>> the internet.
>>
>> Everything is working as far as proxy operations, however i am now
>> trying to set up a splash page that new clients are shown when they
>> first connect.
>>
>> The splash page is served off a copy of nginx running on the proxy server.
>>
>> local.<domainname>.com is set up in hosts and the dns the clients use to
>> point to the correct IP
>>
>> I seem to be tangled up in ACL ordering. Whilst the redirect to the
>> splash page works fine, the session db is not getting written to so the
>> client never gets past the splash page.
> You explicitly configured that to happen.
>
>> external_acl_type splash_page concurrency=100 ttl=60 %SRC
>> /usr/lib/squid3/ext_session_acl -a -T 10800 -b
>> /mnt/data/squid/session/session.db
> Helper in "active mode". Where explicit LOGIN action has to be requested
> by the ACL test for any session to be created.
>
>
>> acl existing_users external splash_page
>> http_access deny !existing_users
>> deny_info http://local.<domainname>.com?usr=%s existing_users
>>
> Being used for only simple/passive session existence lookup.
>
> Please read the *text* on this page:
> <http://wiki.squid-cache.org/action/edit/ConfigExamples/Portal/Splash>
>
>
>
>> -----------------------------------------------------------
>>
>> my build of squid is
>>
>> Squid Cache: Version 3.3.8
>
> Please also note how the captive portal example page has different
> configuration settings for pre- and post- Squid-3.2.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



