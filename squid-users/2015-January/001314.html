<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3 SSL bump: Google drive application could not connect
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203%20SSL%20bump%3A%20Google%20drive%20application%20could%0A%20not%20connect&In-Reply-To=%3C54AA02BE.7040309%40trimble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001313.html">
   <LINK REL="Next"  HREF="001315.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3 SSL bump: Google drive application could not connect</H1>
    <B>Jason Haar</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203%20SSL%20bump%3A%20Google%20drive%20application%20could%0A%20not%20connect&In-Reply-To=%3C54AA02BE.7040309%40trimble.com%3E"
       TITLE="[squid-users] Squid 3 SSL bump: Google drive application could not connect">Jason_Haar at trimble.com
       </A><BR>
    <I>Mon Jan  5 03:19:26 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="001313.html">[squid-users] Squid 3 SSL bump: Google drive application could not connect
</A></li>
        <LI>Next message (by thread): <A HREF="001315.html">[squid-users] Squid 3 SSL bump: Google drive application could not connect
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1314">[ date ]</a>
              <a href="thread.html#1314">[ thread ]</a>
              <a href="subject.html#1314">[ subject ]</a>
              <a href="author.html#1314">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 05/01/15 15:44, Eliezer Croitoru wrote:
&gt;<i> A squid helper is nice but... a NFQUEUE helper that can verify if to
</I>&gt;<i> FORWARD or BUMP the connection would be a better suited solution to my
</I>&gt;<i> opinion.
</I>Not sure if you're ignoring the ssl-peek work, but squid still needs to
be able to &quot;peek&quot; in order for squid to know the actual HTTPS server
name the client is connecting to before it's able to call any external
helper/etc. As that involves understanding SSL (which is a huge chunk of
code) - that means it's not appropriate for a kernel solution - it has
to be done at Layer-7 (ie squid - but not some app called by squid as
that's too late to see the data it needs)

eg after hearing how James Harper wrote his own external &quot;https-tester&quot;
script, I've written my own and have been merrily testing it under
squid-3.4.10 (ie not 3.5 with &quot;peek&quot;). In proxy-mode it works great, the
&quot;https-tester&quot; script is passed the DNS name and port, it manually uses
curl to test that to ensure it's a real HTTPS server and returns OK,
else it returns ERR - making squid fall-back on passthrough/splice mode.
That means it can detect non-SSL apps, as well as client-cert protected
HTTPS webservers (which you also have to drop back to splice with - you
can never successfully MiTM a client-cert based SSL session).

However, the moment you try to do transparent https proxy, things break.
In that case, squid-3.4 only sees the destination IP, and &quot;https_tester&quot;
can only try to &quot;curl -k <A HREF="https://ip.add.ress:port/">https://ip.add.ress:port/</A>&quot; - which only works
for *some* webservers. A lot have WAFs on them and righteously ditch the
incoming connection when they recognise the client (my script) doesn't
know what their hostname is. eg any HTTPS site using cloudfront.net is
in that category. Of course it still works - but in passthrough mode -
which isn't the outcome we're after.

I'm going to have to look at squid-3.5 ;-)

-- 
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="001313.html">[squid-users] Squid 3 SSL bump: Google drive application could not connect
</A></li>
	<LI>Next message (by thread): <A HREF="001315.html">[squid-users] Squid 3 SSL bump: Google drive application could not connect
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1314">[ date ]</a>
              <a href="thread.html#1314">[ thread ]</a>
              <a href="subject.html#1314">[ subject ]</a>
              <a href="author.html#1314">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
