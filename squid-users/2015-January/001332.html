<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3 SSL bump: Google drive application could not connect
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203%20SSL%20bump%3A%20Google%20drive%20application%20could%0A%20not%20connect&In-Reply-To=%3CCAOsHgtvAT30b19yq%3D6B5jWeLAgJ3%2B9fFjAjv0LXcx%3DaJA6%2B6Bw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001331.html">
   <LINK REL="Next"  HREF="001333.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3 SSL bump: Google drive application could not connect</H1>
    <B>Douglas Davenport</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203%20SSL%20bump%3A%20Google%20drive%20application%20could%0A%20not%20connect&In-Reply-To=%3CCAOsHgtvAT30b19yq%3D6B5jWeLAgJ3%2B9fFjAjv0LXcx%3DaJA6%2B6Bw%40mail.gmail.com%3E"
       TITLE="[squid-users] Squid 3 SSL bump: Google drive application could not connect">doug1234 at digcorp.net
       </A><BR>
    <I>Mon Jan  5 14:38:14 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="001331.html">[squid-users] Squid 3 SSL bump: Google drive application could not connect
</A></li>
        <LI>Next message (by thread): <A HREF="001333.html">[squid-users] Squid 3 SSL bump: Google drive application could not connect
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1332">[ date ]</a>
              <a href="thread.html#1332">[ thread ]</a>
              <a href="subject.html#1332">[ subject ]</a>
              <a href="author.html#1332">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Marcus, not to distract from the very important main points being discussed
here but I have to question your last line:
&quot;i.e. there is not yet an interface for this type of traffic inspection.&quot;

Is that not the whole point of Squid's ICAP interface and HTTPS bumping? Or
do you just mean that ufdbguard doesn't utilize that yet. If so you might
want to consider adding that functionality...




On Mon, Jan 5, 2015 at 9:10 AM, Marcus Kool &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">marcus.kool at urlfilterdb.com</A>&gt;
wrote:

&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 01/05/2015 11:11 AM, Yuri Voinov wrote:
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;&gt;<i> Hash: SHA1
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> And also:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> don't forget about bogus homebrew internet-bankings. Which is uses bogus
</I>&gt;&gt;<i> SSL-certs with bogus GOST realisations. And bogus Java-based clients. All
</I>&gt;&gt;<i> of them also uses 443 port. And often HTTPS with
</I>&gt;&gt;<i> homebrew bogus features.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> We don't know, how to bump it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> What about it? Pass-through? Pass-through.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This is clean exclusion.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So don't worry about SSH/Tor. To block them we will be use another
</I>&gt;&gt;<i> solutions. DPI. And not always technical. Revoke administrative rights from
</I>&gt;&gt;<i> clients is basics of security, like physical access to
</I>&gt;&gt;<i> infrastructure. If they can't install Tor/SSH - why we can worry about
</I>&gt;&gt;<i> this traffic?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> We have (and can solve) two simple problems. HTTP over 443 port. And SSL
</I>&gt;&gt;<i> Pinning. That's all, folks.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> It is clear what *you* want.
</I>&gt;<i> You prefer  Squid + HTTP filter + Cisco/DPI + tcputils + sniffer + manual
</I>&gt;<i> maintenance of ACLs/exclude list
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  05.01.2015 17:51, Marcus Kool &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Much of the discussion so far  has been about bumping traffic on port
</I>&gt;&gt;&gt;<i> 443,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>  &gt; bumping SSL-encapsulated HTTP traffic and not bumping (allowing)
</I>&gt;&gt;<i>  &gt; other traffic.  Since port 443 is used for many protocols, it is in
</I>&gt;&gt;<i> many
</I>&gt;&gt;<i>  &gt; cases dangerous to allow non-bumpable traffic: SSH tunnels using port
</I>&gt;&gt;<i> 443
</I>&gt;&gt;<i>  &gt; are common, so are VPNs.  Do you know a security officer who does not
</I>&gt;&gt;<i> want
</I>&gt;&gt;<i>  &gt; to block an SSH tunnel, or an app that can share corporate documents
</I>&gt;&gt;<i>  &gt; on public websites?  If there is not more attention to these kinds of
</I>&gt;&gt;<i>  &gt; applications that use port 443 to circumvent corporate firewalls,
</I>&gt;&gt;<i>  &gt; Squid will be doomed to be used only in environments where the priority
</I>&gt;&gt;<i>  &gt; for security is low to non-existent.  Just type &quot;punching holes in
</I>&gt;&gt;<i> corporate
</I>&gt;&gt;<i>  &gt; firewalls&quot; or &quot;ssh tunnel proxy&quot; in Google to see how easy it is to
</I>&gt;&gt;<i> use an
</I>&gt;&gt;<i>  &gt; SSH tunnel.
</I>&gt;&gt;<i>  &gt;
</I>&gt;&gt;<i>  &gt; I am the author of ufdbGuard, a filter for Squid and besides filtering
</I>&gt;&gt;<i>  &gt; based on URLs, ufdbGuard also probes port 443 to see what kind of
</I>&gt;&gt;<i> traffic
</I>&gt;&gt;<i>  &gt; the server is expecting.  By using probes, ufdbGuard can detect SSH
</I>&gt;&gt;<i> tunnels,
</I>&gt;&gt;<i>  &gt; popular chat protocols, etc. but it is not a 100% guaranteed solution
</I>&gt;&gt;<i>  &gt; because ufdbGuard cannot not see the traffic that flows through the
</I>&gt;&gt;<i> proxy,
</I>&gt;&gt;<i>  &gt; i.e. there is not yet an interface for this type of traffic inspection.
</I>&gt;&gt;<i>  &gt;
</I>&gt;&gt;<i>  &gt; Marcus
</I>&gt;&gt;<i>  &gt;
</I>&gt;&gt;<i>  &gt;
</I>&gt;&gt;<i>  &gt; On 01/05/2015 07:59 AM, Eliezer Croitoru wrote:
</I>&gt;&gt;<i>  &gt; Hey Yuri,
</I>&gt;&gt;<i>  &gt;
</I>&gt;&gt;<i>  &gt; Indeed there are other *NIX systems and for each and every one of them
</I>&gt;&gt;<i>  &gt; there is a solution in need.
</I>&gt;&gt;<i>  &gt;
</I>&gt;&gt;<i>  &gt; SSL Pinned destinations cannot be identified automatically since the
</I>&gt;&gt;<i>  &gt; are pinned inside a software and the certificate will not show
</I>&gt;&gt;<i>  &gt; anything about that.
</I>&gt;&gt;<i>  &gt; The basic tests we can do are:
</I>&gt;&gt;<i>  &gt; - The host is using ssl or tls or not at all(based on the selective
</I>&gt;&gt;<i>  &gt; answer of the service)
</I>&gt;&gt;<i>  &gt; -
</I>&gt;&gt;<i>  &gt; - If the connection is using tls\ssl then inspect the components of
</I>&gt;&gt;<i>  &gt; the certificate(such as rootCA validation against the local machine
</I>&gt;&gt;<i>  &gt; certificates DB)
</I>&gt;&gt;<i>  &gt;
</I>&gt;&gt;<i>  &gt; Depend on the goal of the certificate validation the decision will be
</I>&gt;&gt;<i>  &gt; made to either allow the connection &quot;uninspected&quot; or to &quot;bump&quot; it as
</I>&gt;&gt;<i>  &gt; is without any smart identification.
</I>&gt;&gt;<i>  &gt;
</I>&gt;&gt;<i>  &gt; If indeed there is a database
</I>&gt;&gt;<i>  &gt; sqlite3\mysql\postgres\redis\memcached\others it can be used in the
</I>&gt;&gt;<i>  &gt; iptables level.
</I>&gt;&gt;<i>  &gt; Also a point in this DB and this cache is that it will be persistent
</I>&gt;&gt;<i>  &gt; so what so ever the *NIX system is there is an option once the IP +
</I>&gt;&gt;<i>  &gt; port was tagged as non-bump-able it is better be in the FIREWALL level
</I>&gt;&gt;<i>  &gt; override better then squid external_acl.
</I>&gt;&gt;<i>  &gt; Reason: If the kernel does what it needs to do then squid should not
</I>&gt;&gt;<i>  &gt; touch the packets.
</I>&gt;&gt;<i>  &gt; It's not always right but it's a point in the issue.
</I>&gt;&gt;<i>  &gt; I still do not know how to work with NFQUEUE and I am sure that there
</I>&gt;&gt;<i>  &gt; is an option to make a fast decision and if not then let the
</I>&gt;&gt;<i>  &gt; connection be BUMPED.
</I>&gt;&gt;<i>  &gt;
</I>&gt;&gt;<i>  &gt; I have written a small golang script that can check couple things
</I>&gt;&gt;<i>  &gt; about the ssl session at:
</I>&gt;&gt;<i>  &gt; <A HREF="http://www1.ngtech.co.il/squid/ssl_helpers/ssl_validator.go">http://www1.ngtech.co.il/squid/ssl_helpers/ssl_validator.go</A>
</I>&gt;&gt;<i>  &gt;
</I>&gt;&gt;<i>  &gt; Besides this helper there is another script which do couple things in
</I>&gt;&gt;<i>  &gt; another level.
</I>&gt;&gt;<i>  &gt;
</I>&gt;&gt;<i>  &gt; ##########
</I>&gt;&gt;<i>  &gt; If any thing will be decided for squid internals it will be after a
</I>&gt;&gt;<i>  &gt; proof of concept that we can implement together.
</I>&gt;&gt;<i>  &gt; Can we take this thread to storm and put on the table a proof of
</I>&gt;&gt;<i>  &gt; concept logic for ssl inspection\bumping and bypassing?
</I>&gt;&gt;<i>  &gt;
</I>&gt;&gt;<i>  &gt; Eliezer
</I>&gt;&gt;<i>  &gt;
</I>&gt;&gt;<i>  &gt; On 01/05/2015 10:40 AM, Yuri Voinov wrote:
</I>&gt;&gt;<i>  &gt; &gt;&gt;&gt; Sounds good,
</I>&gt;&gt;<i>  &gt; &gt;&gt;&gt;
</I>&gt;&gt;<i>  &gt; &gt;&gt;&gt; but server world is not end on Linux. ;)
</I>&gt;&gt;<i>  &gt; &gt;&gt;&gt;
</I>&gt;&gt;<i>  &gt; &gt;&gt;&gt; Now exists another *NIX systems. And will exists further.
</I>&gt;&gt;<i>  &gt; &gt;&gt;&gt;
</I>&gt;&gt;<i>  &gt; &gt;&gt;&gt; Also. I have an idea, gents.
</I>&gt;&gt;<i>  &gt; &gt;&gt;&gt;
</I>&gt;&gt;<i>  &gt; &gt;&gt;&gt; Do we can easy and quickly detect SSL Pinned destinations? And
</I>&gt;&gt;<i>  &gt; &gt;&gt;&gt; remember it, for example, in database?
</I>&gt;&gt;<i>  &gt; &gt;&gt;&gt;
</I>&gt;&gt;<i>  &gt; &gt;&gt;&gt; In another words - both problems is similar. Either non-HTTPS
</I>&gt;&gt;<i>  &gt; &gt;&gt;&gt; traffic over 443 port, or pinned certs.
</I>&gt;&gt;<i>  &gt; &gt;&gt;&gt;
</I>&gt;&gt;<i>  &gt; &gt;&gt;&gt; Can we detect both of them automatically and add to exclude list?
</I>&gt;&gt;<i>  &gt; &gt;&gt;&gt;
</I>&gt;&gt;<i>  &gt; &gt;&gt;&gt; WBR, Yuri
</I>&gt;&gt;<i>  &gt;
</I>&gt;&gt;<i>  &gt;&gt; _______________________________________________
</I>&gt;&gt;<i>  &gt;&gt; squid-users mailing list
</I>&gt;&gt;<i>  &gt;&gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i>  &gt;&gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i>  &gt;&gt;
</I>&gt;&gt;<i>  &gt; _______________________________________________
</I>&gt;&gt;<i>  &gt; squid-users mailing list
</I>&gt;&gt;<i>  &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i>  &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -----BEGIN PGP SIGNATURE-----
</I>&gt;&gt;<i> Version: GnuPG v2
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> iQEcBAEBAgAGBQJUqo1oAAoJENNXIZxhPexGCqQIAKbEd2gclvG8FZHDS5RwotFa
</I>&gt;&gt;<i> wPA+I+uLv0nfUO9whuWkJQmhCpCd0cPpyn1KVxiLe8g0CfcOu15uFZJGCOOdVjDV
</I>&gt;&gt;<i> NGPsuZLZPMrhKPmZaRy4YmMw2zpbQTQXGtHmoFA2GPNaIXyG5fEAyZ1oDYTyOuz5
</I>&gt;&gt;<i> djlAka3A01FE24TLT1mWREQEqb1YEtEwrzPyo5I/p5XEpnyR22ByA7Pam7cEsMXf
</I>&gt;&gt;<i> +lVJSLAzcIrT6j+wp1PoJuHEUDkDlhl8aRuL3VndMk6MLkZ6TA7HLRFLx8FGzAmC
</I>&gt;&gt;<i> 0fu6yEthb3QSrNnqTd0Lk22N/WTl3E0M4pYOsChSRlHByEV9RN1OiSryOAkodGU=
</I>&gt;&gt;<i> =XVuO
</I>&gt;&gt;<i> -----END PGP SIGNATURE-----
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150105/e9382b7d/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150105/e9382b7d/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="001331.html">[squid-users] Squid 3 SSL bump: Google drive application could not connect
</A></li>
	<LI>Next message (by thread): <A HREF="001333.html">[squid-users] Squid 3 SSL bump: Google drive application could not connect
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1332">[ date ]</a>
              <a href="thread.html#1332">[ thread ]</a>
              <a href="subject.html#1332">[ subject ]</a>
              <a href="author.html#1332">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
