<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3 SSL bump: Google drive application could not connect
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203%20SSL%20bump%3A%20Google%20drive%20application%20could%0A%20not%20connect&In-Reply-To=%3C54ABB214.7020107%40trimble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001341.html">
   <LINK REL="Next"  HREF="001316.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3 SSL bump: Google drive application could not connect</H1>
    <B>Jason Haar</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203%20SSL%20bump%3A%20Google%20drive%20application%20could%0A%20not%20connect&In-Reply-To=%3C54ABB214.7020107%40trimble.com%3E"
       TITLE="[squid-users] Squid 3 SSL bump: Google drive application could not connect">Jason_Haar at trimble.com
       </A><BR>
    <I>Tue Jan  6 09:59:48 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="001341.html">[squid-users] Squid 3 SSL bump: Google drive application could not connect
</A></li>
        <LI>Next message (by thread): <A HREF="001316.html">[squid-users] Squid 3 SSL bump: Google drive application could not connect
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1346">[ date ]</a>
              <a href="thread.html#1346">[ thread ]</a>
              <a href="subject.html#1346">[ subject ]</a>
              <a href="author.html#1346">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 06/01/15 05:28, Eliezer Croitoru wrote:
&gt;<i> In 3.5 there will be present a new feature which called peek and
</I>&gt;<i> splice that can give an interface to squid and the admin which will
</I>&gt;<i> allow the admin to know couple things about the connection from squid
</I>&gt;<i> and specifically first the client TLS request.
</I>Is there an example document showing just how to do this? Looking at the
current docs, I can't quite figure out how to layer them all together to
achieve what I'd imagine 99% of sysadmins wanting to do ssl-bump need to
do. Even squid-3.4 works very well without peek/splice - if you are
using it as a formal proxy. But it all falls apart with transparent tcp
443 - as squid only has the dst IP...

What I'd like to do is to use peek to grab the SSL server name the
client sends so that  it is available to acls (and external acl calls -
and logging?) as if the client had gone &quot;CONNECT server.name:443&quot;?

A quick sniff with wireshark shows Firefox (as an example) sends the
server name as a client SNI request in the first &quot;real&quot; packet (ie after
the 3-way), so that smells to my naive understanding as &quot;good for a
peek&quot; - and should allow squid to do an initial chat with the client,
get the SNI, then dupe with the real server, then decide if to splice or
bump the rest? Clients that don't support SNI will probably have to be
spliced - I don't care - I'm only interested in running AV scanners and
porn filters over HTTPS requests from web browsers - the 0.1% remaining
SSL traffic can slip through the cracks for all I care ;-)
 

-- 
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="001341.html">[squid-users] Squid 3 SSL bump: Google drive application could not connect
</A></li>
	<LI>Next message (by thread): <A HREF="001316.html">[squid-users] Squid 3 SSL bump: Google drive application could not connect
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1346">[ date ]</a>
              <a href="thread.html#1346">[ thread ]</a>
              <a href="subject.html#1346">[ subject ]</a>
              <a href="author.html#1346">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
