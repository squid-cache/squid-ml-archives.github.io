<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Only TCP_MISS
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Only%20TCP_MISS&In-Reply-To=%3C54B63416.4060308%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001452.html">
   <LINK REL="Next"  HREF="001456.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Only TCP_MISS</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Only%20TCP_MISS&In-Reply-To=%3C54B63416.4060308%40treenet.co.nz%3E"
       TITLE="[squid-users] Only TCP_MISS">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Jan 14 09:17:10 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="001452.html">[squid-users] Only TCP_MISS
</A></li>
        <LI>Next message (by thread): <A HREF="001456.html">[squid-users] Configuring the sslbump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1455">[ date ]</a>
              <a href="thread.html#1455">[ thread ]</a>
              <a href="subject.html#1455">[ subject ]</a>
              <a href="author.html#1455">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 14/01/2015 10:28 a.m., Robert wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I think my Squid doesn't cache. I have Ubuntu 14, I installed Squid
</I>&gt;<i> from packages (3.3.8) and now from source (3.4.10). In both cases I
</I>&gt;<i> used just basic configuration like that basic from installing from
</I>&gt;<i> source. I typed in webbrowser proxy manually and in access.log I
</I>&gt;<i> get still e.g.:
</I>&gt;<i> 
</I>&gt;<i> 1421183358.241    528 10.59.1.9 TCP_MISS/200 5430 CONNECT
</I>&gt;<i> tools.google.com:443 - HIER_DIRECT/2607:f8b0:400d:c06::8b - 
</I>&gt;<i> 1421183397.402 313700 10.59.1.9 TCP_MISS/200 10327 CONNECT
</I>&gt;<i> s-static.ak.facebook.com:443 - HIER_DIRECT/2600:1404:14:189::236 -
</I>
CONNECT tunnels are not cacheable.

&gt;<i> 1421183413.126    114 10.59.1.9 TCP_MISS/200 1701 GET
</I>&gt;<i> <A HREF="http://finance.services.appex.bing.com/Market.svc/AppTileV2?">http://finance.services.appex.bing.com/Market.svc/AppTileV2?</A> -
</I>&gt;<i> HIER_DIRECT/23.220.100.184 application/xml 1421183413.136    121
</I>&gt;<i> 10.59.1.9 TCP_MISS/200 1657 GET
</I>&gt;<i> <A HREF="http://en-us.appex-rf.msn.com/cgtile/v1/en-US/News/Today.xml">http://en-us.appex-rf.msn.com/cgtile/v1/en-US/News/Today.xml</A> -
</I>&gt;<i> HIER_DIRECT/23.220.100.184 application/xml 1421183413.145    129
</I>&gt;<i> 10.59.1.9 TCP_MISS/200 1593 GET
</I>&gt;<i> <A HREF="http://en-us.appex-rf.msn.com/cgtile/v1/en-US/HealthAndFitness/Home.xml?">http://en-us.appex-rf.msn.com/cgtile/v1/en-US/HealthAndFitness/Home.xml?</A>
</I>&gt;<i> - HIER_DIRECT/23.220.100.184 application/xml 1421183413.147    131
</I>&gt;<i> 10.59.1.9 TCP_MISS/200 305 GET
</I>&gt;<i> <A HREF="http://service.weather.microsoft.com/appex/DesktopTile/PreInstallLiveTile?">http://service.weather.microsoft.com/appex/DesktopTile/PreInstallLiveTile?</A>
</I>&gt;<i> - HIER_DIRECT/23.220.115.174 - 1421183413.216     88 10.59.1.9
</I>&gt;<i> TCP_MISS/200 1554 GET
</I>&gt;<i> <A HREF="http://en-us.appex-rf.msn.com/cgtile/v1/en-US/Sports/Today.xml?">http://en-us.appex-rf.msn.com/cgtile/v1/en-US/Sports/Today.xml?</A> -
</I>&gt;<i> HIER_DIRECT/23.220.100.184 application/xml
</I>
There are no repeat requests in the above trace. Thus no way to tell
whether a HIT was even possible.

Without query string details the only testable URI was the
News/Today.xml and that says:

* its cacheable for only 6 minutes 5 seconds. Squid will use a
revalidation contitional request to update it on repeat visitors
outside that time...

* The ETag used to identify the reply object uniquely is constantly
changing even when the reply object has *not* changed. So even if
Squid does cache one reply the next update/revalidation check will
says the object changed - which is a MISS instead of REFRESH. Causing...

* An If-None-Match conditional request returned the full content
unchanged.

* An If-Modified-Since conditional request returned the full content
unchanged.

All of that means Squid only ever gets told by the server to discard
its cached content and waste bandwidth re-downloading it. IMHO these
are signs of a rather badly designed site.


&gt;<i> 1421183413.322    185 10.59.1.9 TCP_MISS_ABORTED/503 1541 GET
</I>&gt;<i> <A HREF="http://www.amazon.com/gp/am/metro/application/livetileRedirect?">http://www.amazon.com/gp/am/metro/application/livetileRedirect?</A> -
</I>&gt;<i> HIER_DIRECT/205.251.242.103 text/html
</I>
&gt;<i> 1421183415.611    132 10.59.1.9 TCP_MISS/206 8526 GET
</I>&gt;<i> <A HREF="http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87i9P.jpg?">http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87i9P.jpg?</A> -
</I>&gt;<i> HIER_DIRECT/23.220.133.211 image/jpeg 1421183416.619     34
</I>&gt;<i> 10.59.1.9 TCP_MISS/206 834 GET
</I>&gt;<i> <A HREF="http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87i9P.jpg?">http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87i9P.jpg?</A> -
</I>&gt;<i> HIER_DIRECT/23.220.133.211 image/jpeg 1421183417.094     76
</I>&gt;<i> 10.59.1.9 TCP_MISS/206 11123 GET
</I>&gt;<i> <A HREF="http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA86gtq.jpg?">http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA86gtq.jpg?</A> -
</I>&gt;<i> HIER_DIRECT/23.220.133.211 image/jpeg 1421183418.269     52
</I>&gt;<i> 10.59.1.9 TCP_MISS/206 4882 GET
</I>&gt;<i> <A HREF="http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87zJF.jpg?">http://img.stb.s-msn.com/usappex/tenant/amp/entityid/AA87zJF.jpg?</A> -
</I>&gt;<i> HIER_DIRECT/23.220.133.211 image/jpeg
</I>
Partial messages (206) from servers are not cacheable by Squid. And
again the non-logged query parameters may make what appears to be
identical requests actually quite different.

&gt;<i> I don't have any TCP_HIT :( , so what is going on ? why Squid
</I>&gt;<i> doesn't work ? :(
</I>&gt;<i> 
</I>
For testing configure:
  strip_query_terms off

Also, how are you doing the testing?
HTTP clients are able to send explicit instructions to proxies
forbidding the use of cache. The curl tools do that by default, and
also the browser &quot;Refresh&quot; or &quot;Reload&quot; buttons.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUtjQWAAoJELJo5wb/XPRjGGYH/ijB2EHSEdaxl9r4tT5dyHjv
3H4cdiUhchEFO2MsGvUOaL4qooO1bJr//IbroLVPmMDy4xHGLMLfk9pxeRFEvt0o
KB01vDSA3Fx75swxTvnKNroteyMd2RMAvkrbmMwKKTiE+Uva/aGxFC4YyPjSLJ4n
kP5BCs1MCq5h+gbUX/spLvRb069GwKXJTIEG5/J01Tv2eD5JqHLJaDFPqjwF3NgS
7zSIk79y8kHruDVnEStSW9ZGDXThRfGtXuMzwXXoFha8DM4VQXr3KiggxJR7F+3t
z9kVQmhSz0Q1PW9t+VTCJdIagEy/M4aR4OrnBN8Rp1sYNDxkjauKeceV5J7KxFs=
=9u9h
-----END PGP SIGNATURE-----

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="001452.html">[squid-users] Only TCP_MISS
</A></li>
	<LI>Next message (by thread): <A HREF="001456.html">[squid-users] Configuring the sslbump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1455">[ date ]</a>
              <a href="thread.html#1455">[ thread ]</a>
              <a href="subject.html#1455">[ subject ]</a>
              <a href="author.html#1455">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
