<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Traffic prioritizing
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Traffic%20prioritizing&In-Reply-To=%3C54B7AC43.4000204%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001450.html">
   <LINK REL="Next"  HREF="001446.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Traffic prioritizing</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Traffic%20prioritizing&In-Reply-To=%3C54B7AC43.4000204%40treenet.co.nz%3E"
       TITLE="[squid-users] Traffic prioritizing">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Jan 15 12:02:11 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="001450.html">[squid-users] Traffic prioritizing
</A></li>
        <LI>Next message (by thread): <A HREF="001446.html">[squid-users] Traffic prioritizing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1470">[ date ]</a>
              <a href="thread.html#1470">[ thread ]</a>
              <a href="subject.html#1470">[ subject ]</a>
              <a href="author.html#1470">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 14/01/2015 3:44 a.m., Dr. Lars Hanke wrote:
&gt;<i> Hi Eliezer:
</I>&gt;<i> 
</I>&gt;&gt;<i> There are couple aspects to the issue. The options are: - TOS
</I>&gt;&gt;<i> marking of specific connections - TPROXY(leaving the src IP the
</I>&gt;&gt;<i> same) - delay_pools
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> If you have a shaping setup in place or device that is capable
</I>&gt;&gt;<i> of traffic shaping based on TOS marking you can take a look at
</I>&gt;&gt;<i> this option.
</I>&gt;<i> 
</I>&gt;<i> TOS marking essentially will mark the GET/POST requests, right?
</I>&gt;<i> However, the size/number of these requests does not correlate well
</I>&gt;<i> with the download bandwidth. 100 AJAX requests may be much less
</I>&gt;<i> than a single GET for some PDF.
</I>
The TOS marking is *set* when the request starts. But it remains in
use until the transaction finishes and the next begins. QoS policy
should be able to do things like associate incoming packets on the
connection to the assigned flow.

&gt;<i> 
</I>&gt;<i> Setting up a TPROXY configuration might be interesting, since my
</I>&gt;<i> current transparent proxy appears to have issues with some special
</I>&gt;<i> devices.
</I>&gt;<i> 
</I>&gt;<i> However, it all boils down to limit the outgoing bandwidth. Of
</I>&gt;<i> course I could police incoming packets, but when they arrive the
</I>&gt;<i> bandwidth is wasted already. If dropped, the server will resend and
</I>&gt;<i> eat my bandwidth again.
</I>&gt;<i> 
</I>&gt;<i> So my idea was that Squid should have all data required about
</I>&gt;<i> streams any may be the most suitable instance to take action, e.g.
</I>&gt;<i> delay ACK and new requests. delay_pools in general look like the
</I>&gt;<i> right choice, but I could not see a function similar to HTB or
</I>&gt;<i> HFSC, which both would do the trick.
</I>
Squid knows only what is at the HTTP level and some IP:port etc
details that TCP provides. All of the overheads are unknown to Squid.

The delay pools in Squid are a mix of both HTB and HFSC. The
delay_pool_access directive does HFSC-like selection of what pool to
apply each transaction to. Then the pool bandwidth is managed with HTB
algorithm using delay_parameters and a fixed 1 second refresh cycle,
and applied only to the HTTP reply messages. Thus only a *speed*
limiter, they slow download traffic but do not quota control it nor
account for uploads.

&gt;<i> 
</I>&gt;<i> So it could be that I think too complicated, or that I miss
</I>&gt;<i> something, or that there is simply no solution, yet.
</I>&gt;<i> 
</I>&gt;<i> If the latter is true, I'll try experimenting with the TOS
</I>&gt;<i> solution. Joined with outgoing ACK throtteling it might work.
</I>&gt;<i> 
</I>
I realy do think that is better, as it manages both request and reply
packets. More importantly its applied to the actual *packets* instead
of just the reply/download payload segments.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUt6xCAAoJELJo5wb/XPRj10QH/i4oc83HAvtx2/r3zVlU5TW5
Pjh9T5hmiZnVh+wyfYFpJplyi5n1u0MrW12WyUOltDo/Wfyn4Ae/ZaqV9tG50uaY
VPaQCGTpHhXvWS51tc9CUWlmfzkBGbqgQo8Re3gLpi++GjrgCyts4m0hzu/7/mhA
frv0UEY7/3+JEe7jevWJ5w25VRORPvfaVWRwDYNtuKWTZZFxRA8qt0EQWc9cYuSS
inSgOFvxvVvNOc1RKPmeud2RSFt/zGPoUZtzCSFDNabCLKYuzK33v60nd4EgX4cm
3/WXYlJhUjXvNCThNZjZca2eTrPT3lbBWTd265j9pi43AosBf9Cnrw+vHwB2iSw=
=FuaY
-----END PGP SIGNATURE-----

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="001450.html">[squid-users] Traffic prioritizing
</A></li>
	<LI>Next message (by thread): <A HREF="001446.html">[squid-users] Traffic prioritizing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1470">[ date ]</a>
              <a href="thread.html#1470">[ thread ]</a>
              <a href="subject.html#1470">[ subject ]</a>
              <a href="author.html#1470">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
