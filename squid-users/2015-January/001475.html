<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Too much assertion failed: comm.cc:178: &quot;fd_table[conn-&gt;fd].halfClosedReader != NULL&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Too%20much%20assertion%20failed%3A%20comm.cc%3A178%3A%0A%20%22fd_table%5Bconn-%3Efd%5D.halfClosedReader%20%21%3D%20NULL%22&In-Reply-To=%3C54B7BF64.8030605%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001474.html">
   <LINK REL="Next"  HREF="001476.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Too much assertion failed: comm.cc:178: &quot;fd_table[conn-&gt;fd].halfClosedReader != NULL&quot;</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Too%20much%20assertion%20failed%3A%20comm.cc%3A178%3A%0A%20%22fd_table%5Bconn-%3Efd%5D.halfClosedReader%20%21%3D%20NULL%22&In-Reply-To=%3C54B7BF64.8030605%40gmail.com%3E"
       TITLE="[squid-users] Too much assertion failed: comm.cc:178: &quot;fd_table[conn-&gt;fd].halfClosedReader != NULL&quot;">yvoinov at gmail.com
       </A><BR>
    <I>Thu Jan 15 13:23:48 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="001474.html">[squid-users] Too much assertion failed: comm.cc:178: &quot;fd_table[conn-&gt;fd].halfClosedReader != NULL&quot;
</A></li>
        <LI>Next message (by thread): <A HREF="001476.html">[squid-users] Too much assertion failed: comm.cc:178: &quot;fd_table[conn-&gt;fd].halfClosedReader != NULL&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1475">[ date ]</a>
              <a href="thread.html#1475">[ thread ]</a>
              <a href="subject.html#1475">[ subject ]</a>
              <a href="author.html#1475">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
 
Core dumps is configured after OS installation - over 4 years ago. For
another processes they produces ok.

System has modular mebugger (MDB), but this is production system and
undesirable to run key service under debugger.

The same time this case is difficult to reproduce on test system.

Looks like assertion produces one of clients within irregular intervals.

I'll try to use DTrace to catch assertion live.

15.01.2015 19:14, Amos Jeffries &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> On 16/01/2015 1:50 a.m., Yuri Voinov wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; Hi gents,
</I>&gt;<i>
</I>&gt;<i> &gt; Sometimes I have too much assertions:
</I>&gt;<i>
</I>&gt;<i> &gt; 2015/01/08 09:40:39 kid1| assertion failed: comm.cc:178:
</I>&gt;<i> &gt; &quot;fd_table[conn-&gt;fd].halfClosedReader != NULL&quot;
</I>&gt;<i>
</I>&gt;<i> &gt; Core dump not produced but Squid restarts. So, I can't get stack
</I>&gt;<i> &gt; trace.
</I>&gt;<i>
</I>&gt;<i> &gt; When I set hals_closed_clients to on, I've got much more
</I>&gt;<i> &gt; assertions:
</I>&gt;<i>
</I>&gt;<i> &gt; 2015/01/15 18:41:31 kid1| assertion failed: comm.cc:1823:
</I>&gt;<i> &gt; &quot;isOpen(fd) &amp;&amp; !commHasHalfClosedMonitor(fd)&quot;
</I>&gt;<i>
</I>&gt;<i> &gt; What can be wrong? This is very annoying behaviour. Also memory
</I>&gt;<i> &gt; cache is often cold after restarts and hit ratio is degrades.
</I>&gt;<i>
</I>&gt;<i> &gt; This looks similar adaptation bug 4057, but it is closed in 3.4.11.
</I>&gt;<i> &gt; This behaviour depends half-closed connections, but how?
</I>&gt;<i>
</I>&gt;<i> &gt; And how to troubleshoot?
</I>&gt;<i>
</I>&gt;<i> A) running Squid under GDB. There are instructions in
</I>&gt;<i> &lt;<A HREF="http://wiki.squid-cache.org/SquidFaq/BugReporting">http://wiki.squid-cache.org/SquidFaq/BugReporting</A>&gt; on how to do that
</I>&gt;<i> even if you are debugging a production server that needs no downtime.
</I>&gt;<i>
</I>&gt;<i> OR,
</I>&gt;<i>
</I>&gt;<i> B) finding out how to enable core dumps in your OS. The assertion
</I>&gt;<i> handling calls abort() which will generate a core file if the OS
</I>&gt;<i> allows them to be created.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBAgAGBQJUt79kAAoJENNXIZxhPexGu3wH/28qhMz9SRRdv4M/NnZascGH
J2pgn03D7RI7C/rHY0fn9TeojoTFE1WLNEBkj+n3ufU7jp44eBZ1X1ZImS1Of/jc
5qmKaWc9vAIfRjX1J5Wvyn0Z6p5P0HqBO7WLE6kSBK6M+s9JkcCC49zZS0qp+pOd
U5tuNT1CqX3B1VkdDLbBMDxxGDKTTTt76CRhiF5bn/8GfdTL2/aPrhEpiKzRBK3W
b0azWyIKs39QzWwPTbkFk47Xidz3xFFXAl0bGuWnJg38fgRW/S6tlHUu8J0n+PCO
e4rXODf/X1EADWIZJMe7tUoKgk5o3AUSm4ZgnggMQj4y+MQFw//xrkczSVoJCOM=
=RvbX
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150115/c211b9f3/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150115/c211b9f3/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="001474.html">[squid-users] Too much assertion failed: comm.cc:178: &quot;fd_table[conn-&gt;fd].halfClosedReader != NULL&quot;
</A></li>
	<LI>Next message (by thread): <A HREF="001476.html">[squid-users] Too much assertion failed: comm.cc:178: &quot;fd_table[conn-&gt;fd].halfClosedReader != NULL&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1475">[ date ]</a>
              <a href="thread.html#1475">[ thread ]</a>
              <a href="subject.html#1475">[ subject ]</a>
              <a href="author.html#1475">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
