<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] google always requesting captach through transparent proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20google%20always%20requesting%20captach%20through%0A%20transparent%20proxy&In-Reply-To=%3C54BBC7D5.8040508%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001527.html">
   <LINK REL="Next"  HREF="001541.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] google always requesting captach through transparent proxy</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20google%20always%20requesting%20captach%20through%0A%20transparent%20proxy&In-Reply-To=%3C54BBC7D5.8040508%40treenet.co.nz%3E"
       TITLE="[squid-users] google always requesting captach through transparent proxy">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Jan 18 14:48:53 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="001527.html">[squid-users] google always requesting captach through transparent	proxy
</A></li>
        <LI>Next message (by thread): <A HREF="001541.html">[squid-users] google always requesting captach through transparent proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1528">[ date ]</a>
              <a href="thread.html#1528">[ thread ]</a>
              <a href="subject.html#1528">[ subject ]</a>
              <a href="author.html#1528">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 19/01/2015 3:39 a.m., <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid at proxyplayer.co.uk</A> wrote:
&gt;<i> Google is requesting a captcha everytime I request a page as it is 
</I>&gt;<i> saying that my computer is doing something weird (via a proxy).
</I>
What *exactly* is it saying?

&gt;<i> 
</I>&gt;<i> How can I get rid of this message from Google. I tried redirecting 
</I>&gt;<i> directly but it makes no difference. It seems like Google is
</I>&gt;<i> pickingup a lack of headers as an issue.
</I>
 acl google dstdom_regex -i google
 http_access deny google

but I suspect maybe you might not actually like the results of what
you are asking for.

&gt;<i> 
</I>&gt;<i> auth_param basic realm AAA proxy server auth_param basic
</I>&gt;<i> credentialsttl 2 hours auth_param basic program
</I>&gt;<i> /usr/lib64/squid/ncsa_auth /etc/squid/squid_passwd 
</I>&gt;<i> authenticate_cache_garbage_interval 1 hour authenticate_ip_ttl 2
</I>&gt;<i> hours acl manager proto cache_object acl localhost src
</I>&gt;<i> 127.0.0.1/32 acl to_localhost dst 127.0.0.0/8 acl SSL_ports port
</I>&gt;<i> 443 acl Safe_ports port 80          # http acl Safe_ports port 21
</I>&gt;<i> # ftp acl Safe_ports port 443         # https acl Safe_ports port
</I>&gt;<i> 70          # gopher acl Safe_ports port 210         # wais acl
</I>&gt;<i> Safe_ports port 1025-65535  # unregistered ports acl Safe_ports
</I>&gt;<i> port 280         # http-mgmt acl Safe_ports port 488         #
</I>&gt;<i> gss-http acl Safe_ports port 591         # filemaker acl Safe_ports
</I>&gt;<i> port 777         # multiling http acl Safe_ports port 1863
</I>&gt;<i> # MSN messenger acl ncsa_users proxy_auth REQUIRED acl CONNECT
</I>&gt;<i> method CONNECT http_access deny manager http_access deny
</I>&gt;<i> !Safe_ports http_access deny CONNECT !SSL_ports http_access deny
</I>&gt;<i> to_localhost http_access allow localhost http_access allow
</I>&gt;<i> ncsa_users http_access deny all icp_access allow all http_port
</I>&gt;<i> 8080 http_port 80 access_log /var/log/squid/access.log squid 
</I>&gt;<i> cache_log /var/log/squid/cache.log buffered_logs on 
</I>&gt;<i> half_closed_clients off visible_hostname AAAProxyServer 
</I>&gt;<i> log_icp_queries off dns_nameservers 208.67.222.222 208.67.220.220 
</I>&gt;<i> hosts_file /etc/hosts memory_pools off client_db off delay_pools 1 
</I>&gt;<i> delay_class 1 2 delay_parameters 1 -1/-1 400000/400000
</I>
I assume this following bit of config is what you meant by &quot;I tried
redirecting directly&quot;.

&gt;<i> acl google1 dstdomain .google.com acl google2 dstdomain
</I>&gt;<i> .google.co.uk always_direct allow google1 google2
</I>
What it tells Squid is not to use a cache_peer connection if the URL
domain name is BOTH *.google.com AND *.google.co.uk.

So as you should be able to see it is not possible for teh domain to
match two different values simultaneously. And you are not useing
cache_peer ayway so even if/when the directive matches it has no effect.


&gt;<i> via off forwarded_for off follow_x_forwarded_for deny all cache_mem
</I>&gt;<i> 512 MB
</I>&gt;<i> 
</I>
PS. you config is showing a lot of directives that have been obsolete
for several years now. If your Squid version is so old that it will
accept the above config, then its time to consider an upgrade.

Amos

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUu8fVAAoJELJo5wb/XPRj2GoIAJbO3LxR1L6NmgdnDTH3RvTh
sxsp+Oq0jXj8SjOx5bwSrlrzF84mZFtXjHyEM0iWEwpWGGw6IVQ7JrHIv5sOXI5A
g39yIoqHdKGIhxJE6w5hFefpgfXCAFCQ0lGRCYEFya9+dtno1XPIWlHny0M3/aJD
r24ipb6mffvQ+bvrD9yO1lJK4EaZQmrmp4L5sxEPiUGWunKagZpQIs+xfXwYbf8+
WSmtRdA5lkAGd8ylW/y35SApulU7MxRT+d/hKON/Blwfg1eCKk7dY+VXqp/a0GFH
OOursNxUZHx9PG1FXxHtEjXbDCQfUqw8/jux3DJPpELbe1gr51YJElgI0PQZIro=
=pq+8
-----END PGP SIGNATURE-----

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="001527.html">[squid-users] google always requesting captach through transparent	proxy
</A></li>
	<LI>Next message (by thread): <A HREF="001541.html">[squid-users] google always requesting captach through transparent proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1528">[ date ]</a>
              <a href="thread.html#1528">[ thread ]</a>
              <a href="subject.html#1528">[ subject ]</a>
              <a href="author.html#1528">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
