<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Local port number logging woes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Local%20port%20number%20logging%20woes&In-Reply-To=%3C54BFE94F.5050602%40gmx.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001637.html">
   <LINK REL="Next"  HREF="001633.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Local port number logging woes</H1>
    <B>Carl-Daniel Hailfinger</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Local%20port%20number%20logging%20woes&In-Reply-To=%3C54BFE94F.5050602%40gmx.net%3E"
       TITLE="[squid-users] Local port number logging woes">c-d.hailfinger.devel.2006 at gmx.net
       </A><BR>
    <I>Wed Jan 21 18:00:47 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="001637.html">[squid-users] Squid as reverse proxy and image theft protection
</A></li>
        <LI>Next message (by thread): <A HREF="001633.html">[squid-users] Local port number logging woes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1624">[ date ]</a>
              <a href="thread.html#1624">[ thread ]</a>
              <a href="subject.html#1624">[ subject ]</a>
              <a href="author.html#1624">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I'm using cascaded/hierarchical Squid instances, one per machine. To get
the ability to correlate access.log entries between instances, I have
extended the default squid log format by %&gt;p and %&lt;lp .
For correlation, I use the following two sets of information:
The parent proxy uses &quot;URL&quot;, &quot;timestamp&quot;, &quot;client source port&quot;.
The child proxy uses &quot;URL&quot;, &quot;timestamp&quot;, &quot;local port number of the last
server or peer connection&quot;.
Even with some slight timing variations due to caching/lookups/network,
the child proxy local port number of the last peer connection and the
parent proxy client source port help tremendously matching those entries
against each other.

This works great except for one oddity: Quite a few Squid log entries of
the child proxy have &quot;0&quot; as local port number of the last server or peer
connection. I have absolutely no idea why that would be the case. AFAICS
cached entries have &quot;-&quot; as local port number and that's fine because it
means there was no associated parent proxy connection.

Am I doing something wrong? Are there any cases where the log format
code %&lt;lp would legitimately yield 0?

Regards,
Carl-Daniel

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="001637.html">[squid-users] Squid as reverse proxy and image theft protection
</A></li>
	<LI>Next message (by thread): <A HREF="001633.html">[squid-users] Local port number logging woes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1624">[ date ]</a>
              <a href="thread.html#1624">[ thread ]</a>
              <a href="subject.html#1624">[ subject ]</a>
              <a href="author.html#1624">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
