<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid versions and FreeBSD-10.1 headache
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20versions%20and%20FreeBSD-10.1%20headache&In-Reply-To=%3C54C27214.7090202%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001669.html">
   <LINK REL="Next"  HREF="001670.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid versions and FreeBSD-10.1 headache</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20versions%20and%20FreeBSD-10.1%20headache&In-Reply-To=%3C54C27214.7090202%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid versions and FreeBSD-10.1 headache">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Jan 23 16:08:52 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="001669.html">[squid-users] Squid versions and FreeBSD-10.1 headache
</A></li>
        <LI>Next message (by thread): <A HREF="001670.html">[squid-users] Squid versions and FreeBSD-10.1 headache
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1671">[ date ]</a>
              <a href="thread.html#1671">[ thread ]</a>
              <a href="subject.html#1671">[ subject ]</a>
              <a href="author.html#1671">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 24/01/2015 4:56 a.m., Odhiambo Washington wrote:
&gt;<i> On 23 January 2015 at 18:42, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> -----BEGIN PGP SIGNED MESSAGE----- Hash: SHA1
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> On 24/01/2015 4:29 a.m., Odhiambo Washington wrote:
</I>&gt;&gt;&gt;<i> On 23 January 2015 at 17:33, Amos Jeffries
</I>&gt;&gt;&gt;<i> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> &lt;snip&gt;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> And the good news is that squid-3.5.1 is now allowing client
</I>&gt;&gt;&gt;<i> PCs to browse. Thank you for that.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Horray!
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> THANK YOU once again:)
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> I still have issues to raise (though my small brain is now so 
</I>&gt;&gt;&gt;<i> saturated):
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Here is what I use:
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> ./configure --prefix=/opt/squid35 \
</I>&gt;&gt;&gt;<i> --enable-removal-policies=&quot;lru heap&quot; \ --disable-epoll \
</I>&gt;&gt;&gt;<i> --enable-auth \ --enable-auth-basic=&quot;DB NCSA PAM PAM POP3 SSPI&quot;
</I>&gt;&gt;&gt;<i> \ --enable-external-acl-helpers=&quot;session unix_group
</I>&gt;&gt;&gt;<i> file_userip&quot; \ --enable-auth-negotiate=&quot;kerberos&quot; \ 
</I>&gt;&gt;&gt;<i> --with-pthreads \ --enable-storeio=&quot;ufs diskd rock aufs&quot; \ 
</I>&gt;&gt;&gt;<i> --enable-delay-pools \ --enable-snmp  \ --with-openssl=/usr \ 
</I>&gt;&gt;&gt;<i> --enable-forw-via-db \ --enable-cache-digests \ --enable-wccpv2
</I>&gt;&gt;&gt;<i> \ --enable-follow-x-forwarded-for \ --with-large-files \ 
</I>&gt;&gt;&gt;<i> --enable-large-cache-files \ --enable-esi \ --enable-kqueue \ 
</I>&gt;&gt;&gt;<i> --enable-icap-client \ --enable-kill-parent-hack \ --enable-ssl
</I>&gt;&gt;&gt;<i> \ --enable-leakfinder \ --enable-ssl-crtd \ 
</I>&gt;&gt;&gt;<i> --enable-url-rewrite-helpers \ --enable-xmalloc-statistics \ 
</I>&gt;&gt;&gt;<i> --enable-stacktraces \ --enable-zph-qos \ --enable-eui \ 
</I>&gt;&gt;&gt;<i> --with-nat-devpf \ --enable-pf-transparent \ 
</I>&gt;&gt;&gt;<i> --enable-ipf-transparent
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> It seems I have to remove --enable-ipf-transparent otherwise
</I>&gt;&gt;&gt;<i> the build fails. I was thinking I could have both of 
</I>&gt;&gt;&gt;<i> --enable-ipf-transparent and --enable-ipf-transparent so that I
</I>&gt;&gt;&gt;<i> can be able to use either PF or IPFilter - whichever I want.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Are those two mutually exclusive?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Thats a maybe. The original design was to enable that, but doing
</I>&gt;&gt;<i> so may repeat the issue you just resolved. From what I can tell
</I>&gt;&gt;<i> those two firewalls should be okay together on FreeBSD at this
</I>&gt;&gt;<i> point.
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> When I have the two, the build fails with:
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at mail</A>:/usr/home/wash/squid-3.5.1-20150120-r13736 # gmake
</I>&gt;&gt;&gt;<i> Making all in compat gmake[1]: Entering directory 
</I>&gt;&gt;&gt;<i> '/usr/home/wash/squid-3.5.1-20150120-r13736/compat'
</I>&gt;&gt;&gt;<i> depbase=`echo assert.lo | sed 's|[^/]*$|.deps/&amp;|;s|\.lo$||'`;\
</I>&gt;&gt;&gt;<i> /bin/sh ../libtool --tag=CXX   --mode=compile clang++
</I>&gt;&gt;&gt;<i> -DHAVE_CONFIG_H -I.. -I../include -I../lib -I../src
</I>&gt;&gt;&gt;<i> -I../include  -I/usr/include -I/usr/include  -I../libltdl
</I>&gt;&gt;&gt;<i> -I/usr/include -I/usr/local/include/libxml2
</I>&gt;&gt;&gt;<i> -I/usr/local/include/libxml2  -Werror -Qunused-arguments
</I>&gt;&gt;&gt;<i> -D_REENTRANT -g -O2  -march=native -I/usr/local/include -MT
</I>&gt;&gt;&gt;<i> assert.lo -MD -MP -MF $depbase.Tpo -c -o assert.lo assert.cc
</I>&gt;&gt;&gt;<i> &amp;&amp;\ mv -f $depbase.Tpo $depbase.Plo libtool: compile:  clang++
</I>&gt;&gt;&gt;<i> -DHAVE_CONFIG_H -I.. -I../include -I../lib -I../src
</I>&gt;&gt;&gt;<i> -I../include -I/usr/include -I/usr/include -I../libltdl 
</I>&gt;&gt;&gt;<i> -I/usr/include -I/usr/local/include/libxml2 
</I>&gt;&gt;&gt;<i> -I/usr/local/include/libxml2 -Werror -Qunused-arguments 
</I>&gt;&gt;&gt;<i> -D_REENTRANT -g -O2 -march=native -I/usr/local/include -MT 
</I>&gt;&gt;&gt;<i> assert.lo -MD -MP -MF .deps/assert.Tpo -c assert.cc  -fPIC
</I>&gt;&gt;&gt;<i> -DPIC -o .libs/assert.o In file included from assert.cc:9: In
</I>&gt;&gt;&gt;<i> file included from ../include/squid.h:43:
</I>&gt;&gt;&gt;<i> ../compat/compat.h:49:57: error: expected value in expression
</I>&gt;&gt;&gt;<i> #if IPF_TRANSPARENT &amp;&amp; USE_SOLARIS_IPFILTER_MINOR_T_HACK ^
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Seems to be a bug in the autoconf detections. You can workaround
</I>&gt;&gt;<i> it for now by adding this to your option list:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> CXXFLAGS=&quot;-DUSE_SOLARIS_IPFILTER_MINOR_T_HACK=0&quot;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> (or if you unluckily hit build errors mentioning minor_t
</I>&gt;&gt;<i> re-definition try setting it to =1).
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;<i> I could be getting it all wrong, but there is where I end:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at mail</A>:/usr/home/wash/ILI/Squid/3.5/squid-3.5.1-20150120-r13736
</I>&gt;<i> # env
</I>&gt;<i> 
</I>&gt;<i> &lt;cut&gt; CC=clang CXX=clang++ 
</I>&gt;<i> CXXFLAGS=-DUSE_SOLARIS_IPFILTER_MINOR_T_HACK=0 &lt;/cut&gt;
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at mail</A>:/usr/home/wash/ILI/Squid/3.5/squid-3.5.1-20150120-r13736
</I>&gt;<i> # gmake Making all in compat gmake[1]: Entering directory 
</I>&gt;<i> '/usr/home/wash/ILI/Squid/3.5/squid-3.5.1-20150120-r13736/compat' 
</I>&gt;<i> depbase=`echo assert.lo | sed 's|[^/]*$|.deps/&amp;|;s|\.lo$||'`;\ 
</I>&gt;<i> /bin/sh ../libtool  --tag=CXX   --mode=compile clang++
</I>&gt;<i> -DHAVE_CONFIG_H -I.. -I../include -I../lib -I../src -I../include
</I>&gt;<i> -I/usr/include -I/usr/include  -I../libltdl -I/usr/include
</I>&gt;<i> -I/usr/local/include/libxml2 -I/usr/local/include/libxml2  -Werror
</I>&gt;<i> -Qunused-arguments  -D_REENTRANT 
</I>&gt;<i> -DUSE_SOLARIS_IPFILTER_MINOR_T_HACK=0 -march=native
</I>&gt;<i> -I/usr/local/include -MT assert.lo -MD -MP -MF $depbase.Tpo -c -o
</I>&gt;<i> assert.lo assert.cc &amp;&amp;\ mv -f $depbase.Tpo $depbase.Plo libtool:
</I>&gt;<i> compile:  clang++ -DHAVE_CONFIG_H -I.. -I../include -I../lib 
</I>&gt;<i> -I../src -I../include -I/usr/include -I/usr/include -I../libltdl 
</I>&gt;<i> -I/usr/include -I/usr/local/include/libxml2
</I>&gt;<i> -I/usr/local/include/libxml2 -Werror -Qunused-arguments
</I>&gt;<i> -D_REENTRANT -DUSE_SOLARIS_IPFILTER_MINOR_T_HACK=0 -march=native
</I>&gt;<i> -I/usr/local/include -MT assert.lo -MD -MP -MF .deps/assert.Tpo -c
</I>&gt;<i> assert.cc  -fPIC -DPIC -o .libs/assert.o In file included from
</I>&gt;<i> assert.cc:9: In file included from ../include/squid.h:12: 
</I>&gt;<i> ../include/autoconf.h:1431:9: error:
</I>&gt;<i> 'USE_SOLARIS_IPFILTER_MINOR_T_HACK' macro redefined [-Werror] 
</I>&gt;<i> #define USE_SOLARIS_IPFILTER_MINOR_T_HACK ^ &lt;command line&gt;:3:9:
</I>&gt;<i> note: previous definition is here #define
</I>&gt;<i> USE_SOLARIS_IPFILTER_MINOR_T_HACK 0 ^
</I>
(mutters)

&gt;<i> In file included from assert.cc:9: In file included from
</I>&gt;<i> ../include/squid.h:43: ../compat/compat.h:49:57: error: expected
</I>&gt;<i> value in expression #if IPF_TRANSPARENT &amp;&amp;
</I>&gt;<i> USE_SOLARIS_IPFILTER_MINOR_T_HACK ^ 2 errors generated. 
</I>&gt;<i> Makefile:921: recipe for target 'assert.lo' failed gmake[1]: ***
</I>&gt;<i> [assert.lo] Error 1 gmake[1]: Leaving directory 
</I>&gt;<i> '/usr/home/wash/ILI/Squid/3.5/squid-3.5.1-20150120-r13736/compat' 
</I>&gt;<i> Makefile:567: recipe for target 'all-recursive' failed gmake: ***
</I>&gt;<i> [all-recursive] Error 1
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Plus I still have to ask:
</I>&gt;<i> 
</I>&gt;<i> --with-pf-transparent --with-nat-devpf works now as expected.
</I>&gt;<i> 
</I>&gt;<i> How about if I only had --enable-ipf-transparent ?? It means I
</I>&gt;<i> would be stuck still?
</I>
Given the state of that macro definition, yes.

There are some other things on Solaris I had to fix for Yuri (who is
sponsoring those build fixes). I will put this on my list of thing to
check out and hopefully be able to point you at a new snapshot to work
with in a few days.

&gt;<i> 
</I>&gt;<i> Is there a workaround for IPFilter on FreeBSD not to cause the
</I>&gt;<i> loop?
</I>
The cause of the loop was wrong NAT lookup being done for PF. The
OpenBSD style PF which you were accidentally building used a different
system API which always returns wrong results on FreeBSD.

Amos
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (MingW32)

iQEcBAEBAgAGBQJUwnIUAAoJELJo5wb/XPRjQ1IIANnYk+6frClJG+YG8mdGqAn9
LDzDOqJXz2JPt8IM6mi66Q6+ykv/W00aQllq3VmA6oTqGs/fH6A6r6TrLXAnkv/n
77zKMo3VDO6z7It5w+IuK9X6FWSGOCVrNKZQWnwGstEpk6jpxE/wIyYHlUEJqdJi
d9Gnnek2/aZDdDYjmgdbJOu78qyuA2eXO2dzBluNgWlnRjdBCWGwlIDUKQky5Wf6
3HH+/n9eQ86EEsHL9gsfB6bJTIPBxcge9hkQWsYIapfBXj2+ynBDrVxnmPVc4y2/
xs204HYAvTO3KuNj2cJnYBl1IiJ+QnVHg43srVyeNNjpp3XQF0R3sLyJKe2Q6oU=
=G+4T
-----END PGP SIGNATURE-----

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="001669.html">[squid-users] Squid versions and FreeBSD-10.1 headache
</A></li>
	<LI>Next message (by thread): <A HREF="001670.html">[squid-users] Squid versions and FreeBSD-10.1 headache
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1671">[ date ]</a>
              <a href="thread.html#1671">[ thread ]</a>
              <a href="subject.html#1671">[ subject ]</a>
              <a href="author.html#1671">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
