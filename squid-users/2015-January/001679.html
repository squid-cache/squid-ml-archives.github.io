<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid ssl-bumping: how does squid verify	certificates?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20ssl-bumping%3A%20how%20does%20squid%20verify%0A%09certificates%3F&In-Reply-To=%3C54C28EA8.4060507%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001675.html">
   <LINK REL="Next"  HREF="001680.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid ssl-bumping: how does squid verify	certificates?</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20ssl-bumping%3A%20how%20does%20squid%20verify%0A%09certificates%3F&In-Reply-To=%3C54C28EA8.4060507%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid ssl-bumping: how does squid verify	certificates?">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Jan 23 18:10:48 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="001675.html">[squid-users] Squid ssl-bumping: how does squid verify certificates?
</A></li>
        <LI>Next message (by thread): <A HREF="001680.html">[squid-users] Reverse proxy through a parent proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1679">[ date ]</a>
              <a href="thread.html#1679">[ thread ]</a>
              <a href="subject.html#1679">[ subject ]</a>
              <a href="author.html#1679">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 24/01/2015 6:20 a.m., agent_js03 wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I am kind of a newbie to SSL, and have been tinkering with squid SSL bumping
</I>&gt;<i> for https, so bear with me if this question has already been discussed. So
</I>&gt;<i> here is my understanding of how HTTPS works: a browser has a sort of local
</I>&gt;<i> repository of trusted certificates, correct?
</I>
Correct.

&gt;<i> And when you access an HTTPS
</I>&gt;<i> website it searches through these certificates and determines whether one is
</I>&gt;<i> to be trusted or not. So I've set up squid for SSL bumping and have added by
</I>&gt;<i> squid certificate to my browser's list of trusted certificates. However, the
</I>&gt;<i> way SSL now works is that squid intercepts my HTTPS request and I never
</I>&gt;<i> actually see the certificate sent from the original server, correct?
</I>
Maybe. It depends on how the bumping is done.

The splice and none modes in ther respective Squid versions make it
pass-thru the SSL traffic from server to client, so you do see the
server details in full.

The mimic feature generates a certificate from Squid cloning as much as
possible from the original server cert, both good and bad details are
copied. So the client can see how broken the server cert is, and in
which ways, even if some particular values are slightly different.


&gt;<i> So what
</I>&gt;<i> I want to know is how does squid know whether the certificate is valid or
</I>&gt;<i> not?
</I>
The OpenSSL library used by Squid performs mostly the same checks the
browsers are doing to validate the certificate. Then Squid (recent
releases) also pass certificate chains through a configurable helper
validator that can perform additional checks if you so wish.

In theory the set of &quot;Trusted Certificate Authorities&quot; is a global set,
but it does vary depending on who provided the list and how up to date
your copy is. The browser vendors have their own processes of
determining trust and generate their own lists.

On your Squid machine it is probably in a system package called
&quot;ca-certificates&quot; or &quot;snakeoil&quot; provided by your OS vendor or OpenSSL
packager. The ones I see most mention of origins for are based on the
Mozilla projects trusted CA list - though yours may not be.


&gt;<i> I am afraid of getting a man-in-the-middle attack since it is squid
</I>&gt;<i> that verifies certificates and not my client. Or is my understanding
</I>&gt;<i> incorrect?
</I>
The one thing you can guarantee is that your *ARE* absolutely getting
MITM'd. By your Squid itelf if not some other way. The &quot;SSL-Bump&quot; is an
MITM on HTTPS protocol.

To ensure that Squid is at least doing its best to validate stay away
from the various DONT_VERIFY_* options you see some tutorials
recommending. They actively disable validation.


&gt;<i> Does squid have this same list of trusted sources and if not can
</I>&gt;<i> I set it up myself?
</I>
See above and yes you can add/remove trusted CA entries yourself. I
believe the openssl UI tools have ways to do it, though I'm not familiar
enough with them to point you directly at how sorry.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="001675.html">[squid-users] Squid ssl-bumping: how does squid verify certificates?
</A></li>
	<LI>Next message (by thread): <A HREF="001680.html">[squid-users] Reverse proxy through a parent proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1679">[ date ]</a>
              <a href="thread.html#1679">[ thread ]</a>
              <a href="subject.html#1679">[ subject ]</a>
              <a href="author.html#1679">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
