<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Why 3.5.0.4 generates mimicked certs with server IP only when bumping?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Why%203.5.0.4%20generates%20mimicked%20certs%20with%20server%0A%20IP%20only%20when%20bumping%3F&In-Reply-To=%3CCAOsHgtuqa9RKPHegP03HEh%2BYs%2BUr422tSG7ScwXmuWm8qOCQvw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001393.html">
   <LINK REL="Next"  HREF="001707.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Why 3.5.0.4 generates mimicked certs with server IP only when bumping?</H1>
    <B>Daniel Greenwald</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Why%203.5.0.4%20generates%20mimicked%20certs%20with%20server%0A%20IP%20only%20when%20bumping%3F&In-Reply-To=%3CCAOsHgtuqa9RKPHegP03HEh%2BYs%2BUr422tSG7ScwXmuWm8qOCQvw%40mail.gmail.com%3E"
       TITLE="[squid-users] Why 3.5.0.4 generates mimicked certs with server IP only when bumping?">dig at digcorp.net
       </A><BR>
    <I>Mon Jan 26 04:39:57 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="001393.html">[squid-users] Why 3.5.0.4 generates mimicked certs with server IP only when bumping?
</A></li>
        <LI>Next message (by thread): <A HREF="001707.html">[squid-users] Why 3.5.0.4 generates mimicked certs with server IP only when bumping?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1704">[ date ]</a>
              <a href="thread.html#1704">[ thread ]</a>
              <a href="subject.html#1704">[ subject ]</a>
              <a href="author.html#1704">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thank you Amos,
Based on your explanation I was able to make bumping work for transparent
with no browser errors in 3.5.1 by using the following. If I understand
correctly, this is actually whats required to mimic the behavior of pre 3.5
(sslbump server-first all) :

acl step1 at_step SslBump1
acl step2 at_step SslBump2
ssl_bump peek step1 all
ssl_bump server-first step2 all

Hope that helps Yuri or any one else with this issue.

PS So far this is working great for eg gmail.com which in previous version
would throw browser errors!

-----------
Daniel I Greenwald



On Fri, Jan 9, 2015 at 2:51 PM, Yuri Voinov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A>&gt; wrote:

&gt;<i>
</I>&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i> Hash: SHA1
</I>&gt;<i>
</I>&gt;<i> How can that be?
</I>&gt;<i>
</I>&gt;<i> All HSTS sites cry with 3.5 bump option - they don't like host IP as CN,
</I>&gt;<i> other sites behaviour depending they (and browsers) settings.
</I>&gt;<i>
</I>&gt;<i> Is it possible to keep server-first behaviour in 3.5.x ?
</I>&gt;<i>
</I>&gt;<i> WBR, Yuri
</I>&gt;<i>
</I>&gt;<i> 09.01.2015 16:57, Amos Jeffries &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;<i> &gt; On 9/01/2015 11:45 p.m., Yuri Voinov wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; I have working production 3.4.10 with working ssl bumping.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; Config was the same as working 3.4.10. I've just want to take a
</I>&gt;<i> &gt; &gt; look on new release.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; in squid.documented said, than backward compatibility server-first
</I>&gt;<i> &gt; &gt; and none options for ssl_bump are kept.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; But:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; Neither works with old syntax, nor new.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; Looks like target https hosts not resolved and bump got only IP.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The config values are still accepted, but there is an extra bumping
</I>&gt;<i> &gt; stage now before the SNI is available.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; You are wanting to peek at stage 1 (to get the client SNI details) and
</I>&gt;<i> &gt; server-first/splice at stage 2 (using the domain). Otherwise All Squid
</I>&gt;<i> &gt; works with when intercepting are the TCP IPs.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Amos
</I>&gt;<i> -----BEGIN PGP SIGNATURE-----
</I>&gt;<i> Version: GnuPG v2
</I>&gt;<i>
</I>&gt;<i> iQEcBAEBAgAGBQJUsDE9AAoJENNXIZxhPexGl+MH/2wEV5rEDSb6eQ5KRbHI8ZJ4
</I>&gt;<i> WV0fdTg7yFR+bfWCUYzjVovQhrx0gaIFLNWvuwDbc62zJJnvADQuAzu7chouafkP
</I>&gt;<i> wpGuBjjp3jYZWa1TlZN4XoDeK2THswXau/5kY9P7IKKAJu9VjhjII803ywn5C8DW
</I>&gt;<i> 48NQWU0Uhs86Tr6XAuaRzUYZK6lht0VcJFKiftmKmOE7Rl7+Yy/Kak1zXxLh8mzX
</I>&gt;<i> a8N0DSsSlBqIm7s8yngwWQuf8rQ0tlwrKWNSpCL3xD6Wk0MFwhRqe6Vbncj4sbff
</I>&gt;<i> p0OifMf0YD5sbytsUq4OO5HOdO7WPu+foB2AMKSiou5cDMqz5Vcnw0mD35t25Fg=
</I>&gt;<i> =OEZu
</I>&gt;<i> -----END PGP SIGNATURE-----
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150125/ca8ee6de/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150125/ca8ee6de/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="001393.html">[squid-users] Why 3.5.0.4 generates mimicked certs with server IP only when bumping?
</A></li>
	<LI>Next message (by thread): <A HREF="001707.html">[squid-users] Why 3.5.0.4 generates mimicked certs with server IP only when bumping?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1704">[ date ]</a>
              <a href="thread.html#1704">[ thread ]</a>
              <a href="subject.html#1704">[ subject ]</a>
              <a href="author.html#1704">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
