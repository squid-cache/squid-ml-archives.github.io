<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] HTTPS intercept, simple configuration to avoid bank bumping
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20HTTPS%20intercept%2C%0A%20simple%20configuration%20to%20avoid%20bank%20bumping&In-Reply-To=%3C42DE25A255671C44A93A7B58470DC09C5E2B3433%40Michelle.aplitec.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001753.html">
   <LINK REL="Next"  HREF="001765.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] HTTPS intercept, simple configuration to avoid bank bumping</H1>
    <B>Josep Borrell</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20HTTPS%20intercept%2C%0A%20simple%20configuration%20to%20avoid%20bank%20bumping&In-Reply-To=%3C42DE25A255671C44A93A7B58470DC09C5E2B3433%40Michelle.aplitec.local%3E"
       TITLE="[squid-users] HTTPS intercept, simple configuration to avoid bank bumping">jborrell at central.aplitec.com
       </A><BR>
    <I>Tue Jan 27 10:33:41 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="001753.html">[squid-users] HTTPS intercept, simple configuration to avoid bank bumping
</A></li>
        <LI>Next message (by thread): <A HREF="001765.html">[squid-users] HTTPS intercept, simple configuration to avoid bank bumping
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1741">[ date ]</a>
              <a href="thread.html#1741">[ thread ]</a>
              <a href="subject.html#1741">[ subject ]</a>
              <a href="author.html#1741">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I agree.
Are there someone with the skills to help us with a working sample ?
is an external ACL needed as Dan remarks ?
maybe the peek and splice feature need some tuning ?
if I can help with something, tell me.

Josep



De: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] En nombre de Jason Haar
Enviado el: lunes, 26 de enero de 2015 22:34
Para: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Asunto: Re: [squid-users] HTTPS intercept, simple configuration to avoid bank bumping


Well the documentation says

#   SslBump1: After getting TCP-level and HTTP CONNECT info.
#   SslBump2: After getting SSL Client Hello info.
#   SslBump3: After getting SSL Server Hello info.


So that means SslBump1 only works for direct proxy (ie CONNECT) sessions, it's SslBump2 that peeks into the traffic to discover the client SNI hostname. So I think you actually need (I'll use more descriptive acl names and comment out those that I think don't add any value)

acl domains_nobump dstdomain &quot;/etc/squid/domains_nobump.acl&quot;
#no added value: acl DiscoverCONNECTHost at_step SslBump1
acl DiscoverSNIHost at_step SslBump2
#don't use - breaks bump: acl DiscoverServerHost at_step SslBump3
#no added value - in fact forces peek for some reason: ssl_bump peek DiscoverCONNECTHost all
ssl_bump peek DiscoverSNIHost all

ssl_bump splice domains_nobump
#DiscoverSNIHost should now mean Squid knows about all the SNI details
ssl_bump bump all

Sadly, this doesn't work for me *in transparent mode*. Works fine when using squid as a formal proxy, but when used via https_port intercept, we end up with IP address certs instead of SNI certs.

We really need someone who knows more to tell us how to make this work :-(


--
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150127/0459f4c3/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150127/0459f4c3/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="001753.html">[squid-users] HTTPS intercept, simple configuration to avoid bank bumping
</A></li>
	<LI>Next message (by thread): <A HREF="001765.html">[squid-users] HTTPS intercept, simple configuration to avoid bank bumping
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1741">[ date ]</a>
              <a href="thread.html#1741">[ thread ]</a>
              <a href="subject.html#1741">[ subject ]</a>
              <a href="author.html#1741">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
