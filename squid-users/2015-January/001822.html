<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] External ACL TTL not working as expected
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20External%20ACL%20TTL%20not%20working%20as%20expected&In-Reply-To=%3CCAMZauGrzEQ3uUC5B3U5%2BQtshgTDCXfSmiR5NT76mcW%2BSCyivVQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001821.html">
   <LINK REL="Next"  HREF="001830.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] External ACL TTL not working as expected</H1>
    <B>Alberto Perez</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20External%20ACL%20TTL%20not%20working%20as%20expected&In-Reply-To=%3CCAMZauGrzEQ3uUC5B3U5%2BQtshgTDCXfSmiR5NT76mcW%2BSCyivVQ%40mail.gmail.com%3E"
       TITLE="[squid-users] External ACL TTL not working as expected">alberto2perez at gmail.com
       </A><BR>
    <I>Fri Jan 30 20:15:36 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="001821.html">[squid-users] SSL Bump, CA Cert
</A></li>
        <LI>Next message (by thread): <A HREF="001830.html">[squid-users] External ACL TTL not working as expected
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1822">[ date ]</a>
              <a href="thread.html#1822">[ thread ]</a>
              <a href="subject.html#1822">[ subject ]</a>
              <a href="author.html#1822">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello to everyone,

First of all thanks for the support and for this awesome product.

I'm developing a captive portal with squid 3.4.9 over ubuntu 14.04

Here is my external acl configuration

external_acl_type session_active_def ipv4  %SRC
/etc/squid3/captive/sessionHelper.php  concurrency=100 children=1 -a
-f ttl=1  negative_ttl=0 startup=2 idle=1

acl password external session_active_def

deny_info <A HREF="https://proxy-bump.upr.edu.cu/?url=%u">https://proxy-bump.upr.edu.cu/?url=%u</A> password


And the captive portal autenticate users against Active directory and
save authorization data to memcache server on the same proxy server.

External acl sessionHelper.php  checks for those authorization data in
the memcached server. I have not authentication, only authorization by
ip using that external acl and returning autenticated user so squid
log the username information.

Everything works like a charm except for the frequency squid checks
for those authorization data in the external acl, I has tried every
configuration sample found in the internet but without success, ttl
parameter of external acl doesnt works for me.

Session login and logout doesn't work as expected due to squid doesn't
check this external acl frecuently enough, user can surf after closed
session (removed user authorization data from memcache server) because
squid doesn't authorize anymore same ip requests using the external
acl.

Only way I found to force squid to check for the acl was reloading
configuration like /usr/sbin/squid3 -k reconfigure

But this gives me lot of instability  because squid stop accepting
connections for the time it is reloading configuration, I have lot of
people opening and closing sessions so right now squid is reloading
each minute to cover that demand.

My question: is there a way to force squid to check the external acl
each 1 second or just for every request without reloading
configuration.

I've tried all for over a month and you are my last resort, please
help, and forgive my english also.

Grateful

Alberto

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="001821.html">[squid-users] SSL Bump, CA Cert
</A></li>
	<LI>Next message (by thread): <A HREF="001830.html">[squid-users] External ACL TTL not working as expected
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1822">[ date ]</a>
              <a href="thread.html#1822">[ thread ]</a>
              <a href="subject.html#1822">[ subject ]</a>
              <a href="author.html#1822">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
