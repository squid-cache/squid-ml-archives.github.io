<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] External ACL TTL not working as expected
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20External%20ACL%20TTL%20not%20working%20as%20expected&In-Reply-To=%3C54CC04F3.9060900%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001822.html">
   <LINK REL="Next"  HREF="001834.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] External ACL TTL not working as expected</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20External%20ACL%20TTL%20not%20working%20as%20expected&In-Reply-To=%3C54CC04F3.9060900%40treenet.co.nz%3E"
       TITLE="[squid-users] External ACL TTL not working as expected">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Jan 30 22:25:55 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="001822.html">[squid-users] External ACL TTL not working as expected
</A></li>
        <LI>Next message (by thread): <A HREF="001834.html">[squid-users] External ACL TTL not working as expected
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1830">[ date ]</a>
              <a href="thread.html#1830">[ thread ]</a>
              <a href="subject.html#1830">[ subject ]</a>
              <a href="author.html#1830">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 31/01/2015 9:15 a.m., Alberto Perez wrote:
&gt;<i> Hello to everyone,
</I>&gt;<i> 
</I>&gt;<i> First of all thanks for the support and for this awesome product.
</I>&gt;<i> 
</I>
Welcome. Thank You for getting the use of authorization vs
authentication correct in your question :-) so nice not to have to start
with clarifying that.


&gt;<i> I'm developing a captive portal with squid 3.4.9 over ubuntu 14.04
</I>&gt;<i> 
</I>&gt;<i> Here is my external acl configuration
</I>&gt;<i> 
</I>&gt;<i> external_acl_type session_active_def ipv4  %SRC
</I>&gt;<i> /etc/squid3/captive/sessionHelper.php  concurrency=100 children=1 -a
</I>&gt;<i> -f ttl=1  negative_ttl=0 startup=2 idle=1
</I>&gt;<i> 
</I>
&lt;<A HREF="http://www.squid-cache.org/Doc/config/external_acl_type/">http://www.squid-cache.org/Doc/config/external_acl_type/</A>&gt;.


In particular you have the syntax for the helper wrong. The correct
syntax is:

 external_acl_type name [options] FORMAT /path/to/helper [helper arguments]

Note the difference between &quot;options&quot; and &quot;helper arguments&quot;. Helper
arguments is part of the command line to be run.


So this is the correct config line for what you have above is:

 external_acl_type \
  session_active_def \
  concurrency=100 children-max=1 children-startup=1 \
    ipv4 ttl=1 negative_ttl=0 \
  \
  %SRC \
  /etc/squid3/captive/sessionHelper.php -a -f


I noticed the total number of children was smaller that the number
indicated to be run at startup. Squid would complain about that as it
auto-corrects to using startup=1.
Also, with startup &gt;= children the idle parameter is unnecessary. There
is no amount of child helpers being started later based on load.


NP: There were a few nasty issues with the Zend engine limiting how long
a PHP script was allowed to run for. Even the dynamic restart feature
for Squid helpers was unable to solve that fully. You may want to
re-write the helper into another language for production use.



&gt;<i> acl password external session_active_def
</I>&gt;<i> 
</I>&gt;<i> deny_info <A HREF="https://proxy-bump.upr.edu.cu/?url=%u">https://proxy-bump.upr.edu.cu/?url=%u</A> password
</I>&gt;<i> 
</I>
Be careful with the use of HTTPS in sessions.

The initial CONNECT (even the fake-CONNECT Squid uses on intercepted
traffic) will need accounting for in your session management ACLs. You
dont want it to be kicking off another session login partway through the
first.



HTH
Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="001822.html">[squid-users] External ACL TTL not working as expected
</A></li>
	<LI>Next message (by thread): <A HREF="001834.html">[squid-users] External ACL TTL not working as expected
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1830">[ date ]</a>
              <a href="thread.html#1830">[ thread ]</a>
              <a href="subject.html#1830">[ subject ]</a>
              <a href="author.html#1830">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
