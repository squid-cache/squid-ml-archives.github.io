<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] External ACL TTL not working as expected
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20External%20ACL%20TTL%20not%20working%20as%20expected&In-Reply-To=%3CCAMZauGrBiKMDamQ%3D2G%3DS8qWx8af6yL%2By9VM9wm8U-n0nzoWieg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001830.html">
   <LINK REL="Next"  HREF="001836.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] External ACL TTL not working as expected</H1>
    <B>Alberto Perez</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20External%20ACL%20TTL%20not%20working%20as%20expected&In-Reply-To=%3CCAMZauGrBiKMDamQ%3D2G%3DS8qWx8af6yL%2By9VM9wm8U-n0nzoWieg%40mail.gmail.com%3E"
       TITLE="[squid-users] External ACL TTL not working as expected">alberto2perez at gmail.com
       </A><BR>
    <I>Sat Jan 31 04:14:09 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="001830.html">[squid-users] External ACL TTL not working as expected
</A></li>
        <LI>Next message (by thread): <A HREF="001836.html">[squid-users] External ACL TTL not working as expected
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1834">[ date ]</a>
              <a href="thread.html#1834">[ thread ]</a>
              <a href="subject.html#1834">[ subject ]</a>
              <a href="author.html#1834">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Amos,
You rock it,
Thanks a lot, now its working pretty well.

I was partialy aware of PHP limitation when used to build external
helpers any way I gave it not too much importance since was working
fine, I will rewrite code in python ASAP, I appreciate your
recommendations.

Please if is not too much to ask, I will like to ask you about another
issue I have not been able to make it work, im trying to skip access
logging of a subnet, in old versions of squid (3.1) I was using the
following configuration


acl ip_upredes src 10.2.100.0/24

log_access deny ip_upredes
log_access allow all


As of squid 3.4 log_access directive was no longer available I was
trying to change to

cache_access_log stdio:/var/log/squid3/access.log
cache_store_log stdio:/var/log/squid3/store.log
access_log none ip_upredes


Starting squid in debug mode shows this

2015/01/30 22:50:15| ACL not found: ip_upredes
FATAL: Bungled /etc/squid3/squid.conf line 98: access_log none ip_upredes

I am suspecting about a missing configuration option when I compiled
squid, so following are my compilation options

configure options:
'--sysconfdir=/etc/squid3'
'--mandir=/usr/share/man'
'--enable-inline'
'--enable-async-io=8'
'--enable-storeio=ufs,aufs,diskd,rock'
'--enable-removal-policies=lru,heap'
'--enable-delay-pools'
'--enable-cache-digests'
'--enable-underscores'
'--enable-icap-client'
'--enable-follow-x-forwarded-for'
'--enable-url-rewrite-helpers=fake'
'--enable-eui'
'--enable-esi'
'--enable-icmp'
'--enable-zph-qos'
'--enable-ecap'
'--enable-ssl'
'--enable-ssl-crtd'
'--disable-translation'
'--with-swapdir=/var/spool/squid3'
'--with-logdir=/var/log/squid3'
'--with-pidfile=/var/run/squid3.pid'
'--with-filedescriptors=65536'
'--with-large-files'
'--with-default-user=proxy'


Again, thanks a lot for this great support, I read a lot of your
answers in this mailing list on the web and I can say you are making a
really GOOD job supporting this community and project.

Thanks, thanks, thanks

Alberto



On 1/30/15, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:
&gt;<i> On 31/01/2015 9:15 a.m., Alberto Perez wrote:
</I>&gt;&gt;<i> Hello to everyone,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> First of all thanks for the support and for this awesome product.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Welcome. Thank You for getting the use of authorization vs
</I>&gt;<i> authentication correct in your question :-) so nice not to have to start
</I>&gt;<i> with clarifying that.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> I'm developing a captive portal with squid 3.4.9 over ubuntu 14.04
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Here is my external acl configuration
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> external_acl_type session_active_def ipv4  %SRC
</I>&gt;&gt;<i> /etc/squid3/captive/sessionHelper.php  concurrency=100 children=1 -a
</I>&gt;&gt;<i> -f ttl=1  negative_ttl=0 startup=2 idle=1
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &lt;<A HREF="http://www.squid-cache.org/Doc/config/external_acl_type/">http://www.squid-cache.org/Doc/config/external_acl_type/</A>&gt;.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> In particular you have the syntax for the helper wrong. The correct
</I>&gt;<i> syntax is:
</I>&gt;<i>
</I>&gt;<i>  external_acl_type name [options] FORMAT /path/to/helper [helper arguments]
</I>&gt;<i>
</I>&gt;<i> Note the difference between &quot;options&quot; and &quot;helper arguments&quot;. Helper
</I>&gt;<i> arguments is part of the command line to be run.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> So this is the correct config line for what you have above is:
</I>&gt;<i>
</I>&gt;<i>  external_acl_type \
</I>&gt;<i>   session_active_def \
</I>&gt;<i>   concurrency=100 children-max=1 children-startup=1 \
</I>&gt;<i>     ipv4 ttl=1 negative_ttl=0 \
</I>&gt;<i>   \
</I>&gt;<i>   %SRC \
</I>&gt;<i>   /etc/squid3/captive/sessionHelper.php -a -f
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I noticed the total number of children was smaller that the number
</I>&gt;<i> indicated to be run at startup. Squid would complain about that as it
</I>&gt;<i> auto-corrects to using startup=1.
</I>&gt;<i> Also, with startup &gt;= children the idle parameter is unnecessary. There
</I>&gt;<i> is no amount of child helpers being started later based on load.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> NP: There were a few nasty issues with the Zend engine limiting how long
</I>&gt;<i> a PHP script was allowed to run for. Even the dynamic restart feature
</I>&gt;<i> for Squid helpers was unable to solve that fully. You may want to
</I>&gt;<i> re-write the helper into another language for production use.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> acl password external session_active_def
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> deny_info <A HREF="https://proxy-bump.upr.edu.cu/?url=%u">https://proxy-bump.upr.edu.cu/?url=%u</A> password
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Be careful with the use of HTTPS in sessions.
</I>&gt;<i>
</I>&gt;<i> The initial CONNECT (even the fake-CONNECT Squid uses on intercepted
</I>&gt;<i> traffic) will need accounting for in your session management ACLs. You
</I>&gt;<i> dont want it to be kicking off another session login partway through the
</I>&gt;<i> first.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> HTH
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="001830.html">[squid-users] External ACL TTL not working as expected
</A></li>
	<LI>Next message (by thread): <A HREF="001836.html">[squid-users] External ACL TTL not working as expected
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1834">[ date ]</a>
              <a href="thread.html#1834">[ thread ]</a>
              <a href="subject.html#1834">[ subject ]</a>
              <a href="author.html#1834">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
