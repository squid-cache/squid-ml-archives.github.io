<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] The email notification feature does not work after 10 days
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20The%20email%20notification%20feature%20does%20not%20work%0A%20after%2010%20days&In-Reply-To=%3C54CCA8C2.30600%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001835.html">
   <LINK REL="Next"  HREF="001841.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] The email notification feature does not work after 10 days</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20The%20email%20notification%20feature%20does%20not%20work%0A%20after%2010%20days&In-Reply-To=%3C54CCA8C2.30600%40treenet.co.nz%3E"
       TITLE="[squid-users] The email notification feature does not work after 10 days">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Jan 31 10:04:50 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="001835.html">[squid-users] The email notification feature does not work after 10	days
</A></li>
        <LI>Next message (by thread): <A HREF="001841.html">[squid-users] The email notification feature does not work after 10 days
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1837">[ date ]</a>
              <a href="thread.html#1837">[ thread ]</a>
              <a href="subject.html#1837">[ subject ]</a>
              <a href="author.html#1837">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 31/01/2015 6:41 p.m., Tianyin Xu wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I'm trying to use the email notification feature specified in the document.
</I>&gt;<i> <A HREF="http://www.squid-cache.org/Doc/config/mail_program/">http://www.squid-cache.org/Doc/config/mail_program/</A>
</I>&gt;<i> <A HREF="http://www.squid-cache.org/Doc/config/cache_mgr/">http://www.squid-cache.org/Doc/config/cache_mgr/</A>
</I>&gt;<i> <A HREF="http://www.squid-cache.org/Doc/config/mail_from/">http://www.squid-cache.org/Doc/config/mail_from/</A>
</I>&gt;<i> 
</I>&gt;<i> Basically, if the Squid proxy server dies, I can receive an email
</I>&gt;<i> notification by configuring &quot;mail_program&quot;, &quot;cache_mgr&quot;, and
</I>&gt;<i> &quot;mail_from&quot;. This is a very nice feature.
</I>&gt;<i> 
</I>&gt;<i> However, when I start Squid and then intentionally kill Squid by
</I>&gt;<i> issuing SEGV, Squid dies without sending any email to me. Diving into
</I>&gt;<i> the code, I see that the email notification feature is disabled by the
</I>&gt;<i> following if condition,
</I>&gt;<i> 
</I>&gt;<i>     /* src/tools.cc */
</I>&gt;<i>     ....
</I>&gt;<i>     if (squid_curtime - SQUID_RELEASE_TIME &lt; 864000) {
</I>&gt;<i>         /* skip if more than 10 days old */
</I>&gt;<i>         if (Config.adminEmail)
</I>&gt;<i>             mail_warranty();
</I>&gt;<i> 
</I>&gt;<i>         puts(dead_msg());
</I>&gt;<i>     }
</I>&gt;<i> 
</I>&gt;<i> From the comment, it seems that intentionally the feature is disabled
</I>&gt;<i> if the current time is latter than 10 days after the release time
</I>&gt;<i> (which is my case). This totally makes no sense to me because most
</I>&gt;<i> users like me will use this feature after 10 days latter than the
</I>&gt;<i> release date...
</I>&gt;<i> 
</I>&gt;<i> Could anyone explain this? I moved the if-condition and the feature does work.
</I>&gt;<i> 
</I>&gt;<i> I also opened a bugzilla report here,
</I>&gt;<i> <A HREF="http://bugs.squid-cache.org/show_bug.cgi?id=4184">http://bugs.squid-cache.org/show_bug.cgi?id=4184</A>
</I>

It is a difficult situation.

The 10 day limit is itself a feature designed to reduce spam emails
being delivered from production systems which are stuck long-term on
&quot;stable&quot; version packages. Often long after the crash being notified
about is found and fixed. There are people still running Squid 3.1.6 for
example, despite years having passed and numerous crashes having been fixed.

Squid auto-restarts after crashes to ensure minimal downtime and user
impact. There are also numerous other things that could happen that are
only ever logged - that includes the reason for the crash being
notified.  So you should have log monitoring in place for production
systems anyway which mails you on criteria you are interested in. Making
this feature much less interesting for production systems using the
formal release for long periods of time.


It is much more interesting / useful to hear about crashes in newer code
with less production use and testing behind it.

The development code and daily snapshots define SQUID_RELEASE_TIME to be
squid_curtime so the if-condition always matches and enables the feature
for experimental installations.

This combined with the fact that the only way to resolve crash
conditions is to patch the code and/or build latest release snapshot,
means that people who are actually interested in avoiding those type of
problem are usually running the snapshot code where the 10-day limit
does not apply.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="001835.html">[squid-users] The email notification feature does not work after 10	days
</A></li>
	<LI>Next message (by thread): <A HREF="001841.html">[squid-users] The email notification feature does not work after 10 days
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1837">[ date ]</a>
              <a href="thread.html#1837">[ thread ]</a>
              <a href="subject.html#1837">[ subject ]</a>
              <a href="author.html#1837">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
