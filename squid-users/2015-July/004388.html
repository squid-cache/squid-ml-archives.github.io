<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ssl_bump with cache_peer problem: Handshake fail after Client Hello.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ssl_bump%20with%20cache_peer%20problem%3A%20Handshake%20fail%0A%20after%20Client%20Hello.&In-Reply-To=%3CCAFy8SQUm%2BuNahwEXcpLpVM_7wfy%2Bsy3Mjcx-S0rcxtoPqNSXZg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004387.html">
   <LINK REL="Next"  HREF="004389.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ssl_bump with cache_peer problem: Handshake fail after Client Hello.</H1>
    <B>adam900710</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ssl_bump%20with%20cache_peer%20problem%3A%20Handshake%20fail%0A%20after%20Client%20Hello.&In-Reply-To=%3CCAFy8SQUm%2BuNahwEXcpLpVM_7wfy%2Bsy3Mjcx-S0rcxtoPqNSXZg%40mail.gmail.com%3E"
       TITLE="[squid-users] ssl_bump with cache_peer problem: Handshake fail after Client Hello.">adam900710 at gmail.com
       </A><BR>
    <I>Mon Jul  6 13:34:19 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004387.html">[squid-users] ssl_bump with cache_peer problem: Handshake fail after Client Hello.
</A></li>
        <LI>Next message (by thread): <A HREF="004389.html">[squid-users] ssl_bump with cache_peer problem: Handshake fail after Client Hello.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4388">[ date ]</a>
              <a href="thread.html#4388">[ thread ]</a>
              <a href="subject.html#4388">[ subject ]</a>
              <a href="author.html#4388">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>2015-07-06 20:06 GMT+08:00 Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;:
&gt;<i> On 6/07/2015 9:30 p.m., adam900710 wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Here is some of my experiments:
</I>&gt;&gt;<i> 1) Remove &quot;never_direct&quot;
</I>&gt;&gt;<i> Then ssl_bump works as expected, but all traffic doesn't goes through
</I>&gt;&gt;<i> the SOCKS5 proxy. So a lot of sites I can't access.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 2) Use local 8118 proxy
</I>&gt;&gt;<i> That works fine without any problem, but SSL_dump is needed...
</I>&gt;&gt;<i> So just prove privoxy are working.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Any clue?
</I>&gt;<i>
</I>&gt;&gt;<i> Also, If I disable &quot;ssl_bump&quot; at http_port line, squid works without
</I>&gt;&gt;<i> any problem just as a forwarder.
</I>&gt;&gt;<i> But that makes no sense anyway.
</I>&gt;<i>
</I>&gt;<i> Makes perfect sense. Would you like anybody to be able to decrypt your
</I>&gt;<i> HTTPS traffic and send it as plain-text wherever they want?
</I>&gt;<i>
</I>&gt;<i> Squid does not permit that. All inbound encrypted traffic must one way
</I>&gt;<i> or another leave upstream only by encrypted channels.
</I>Agree with Yuri, I hate the government (Yeah, especially the f**king
China gov!) and
the evil Chinese one has alreayd tried this trick on gmail some month ago.

That's who forces me to pass the traffic to privoxy, as the Great
Firewall is already
blocking me to reach most sites in the open world.

Also you get a little confused with ssl dump and encryption/authentication.

SSL bump in fact doesn't do the black magic to magically decrypt
everything without cost.
PKI things still makes you know that some one is bump your SSL communication.

So normally with SSL bump, you will see a big browser warning about
the unknown issuer of
the faked certificates.
And normal routine like curl will just abort the connection when it
found the certificate is not valid.

Although the communication lost the encryption, you can still know you
are under monitoring.
And this implement needs you to trust the fake CA.
If one doesn't trust it, just blacklist the fake CA and use tor or
whatever to really hide the trace.

So although the ssl bump destory encryption, but it doesn't destory
authentication.
And the combination of ssl bump and cache peer should be allowed if no
bugs or my configuration error.

Thanks.
&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004387.html">[squid-users] ssl_bump with cache_peer problem: Handshake fail after Client Hello.
</A></li>
	<LI>Next message (by thread): <A HREF="004389.html">[squid-users] ssl_bump with cache_peer problem: Handshake fail after Client Hello.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4388">[ date ]</a>
              <a href="thread.html#4388">[ thread ]</a>
              <a href="subject.html#4388">[ subject ]</a>
              <a href="author.html#4388">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
