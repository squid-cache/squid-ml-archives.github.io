<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid and ufdbGuard, display blocked URL on client browser address bar
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20and%20ufdbGuard%2C%0A%20display%20blocked%20URL%20on%20client%20browser%20address%20bar&In-Reply-To=%3C559FBFB9.8080206%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004454.html">
   <LINK REL="Next"  HREF="004455.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid and ufdbGuard, display blocked URL on client browser address bar</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20and%20ufdbGuard%2C%0A%20display%20blocked%20URL%20on%20client%20browser%20address%20bar&In-Reply-To=%3C559FBFB9.8080206%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid and ufdbGuard, display blocked URL on client browser address bar">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Jul 10 12:51:05 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004454.html">[squid-users] Squid and ufdbGuard, display blocked URL on client browser address bar
</A></li>
        <LI>Next message (by thread): <A HREF="004455.html">[squid-users] accessing google.com
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4456">[ date ]</a>
              <a href="thread.html#4456">[ thread ]</a>
              <a href="subject.html#4456">[ subject ]</a>
              <a href="author.html#4456">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/07/2015 10:31 p.m., Marcus Kool wrote:
&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On 07/10/2015 12:54 AM, Amos Jeffries wrote:
</I>&gt;&gt;<i> On 10/07/2015 9:51 a.m., David Touzeau wrote:
</I>&gt;&gt;&gt;<i> Hi ikna
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> This can be done, but you need to forget the ufdbgclient and create
</I>&gt;&gt;&gt;<i> yourself a new one that is able to connect to the ufdbguard server in
</I>&gt;&gt;&gt;<i> order to get ufdbguard results.
</I>&gt;&gt;&gt;<i> In this case, you have with your code to replace the  OK status=302
</I>&gt;&gt;&gt;<i> url=&quot;&quot; sent by ufdbguard server by OK rewrite-url=&quot;&quot;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Then the address bar will be not changed.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> If you need an example, you will find it after installing this open
</I>&gt;&gt;&gt;<i> source software :
</I>&gt;&gt;&gt;<i> <A HREF="http://sourceforge.net/projects/artica-squid/files/ISO/proxy-appliances/">http://sourceforge.net/projects/artica-squid/files/ISO/proxy-appliances/</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thats not what he is asking for though.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> He is asking to change the page *content*. By only altering the URL
</I>&gt;&gt;<i> request-line on the received message.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The answer is to change what the <A HREF="http://10.1.1.142/sgerror.php">http://10.1.1.142/sgerror.php</A> script
</I>&gt;&gt;<i> does. So it displays the url= parameter instead of its own full URL.
</I>&gt;<i> 
</I>&gt;<i> Ikna contacted me yesterday and I have sent the same answer yesterday
</I>&gt;<i> directly without notifying the list.
</I>&gt;<i> 
</I>&gt;<i> The issue is basically that URL redirectors usually send an HTML 302
</I>&gt;<i> redirection code to redirect a blocked URL to an error page.
</I>&gt;<i> squidGuard and ufdbGuard use by default the 302 code.
</I>&gt;<i> 
</I>&gt;<i> Ikna has, however, a 404 code which behaves differrent and likes to know
</I>&gt;<i> how to configure ufdbGuard to send a 404 code.  This is the same as with
</I>&gt;<i> squidGuard:
</I>&gt;<i>    redirect &quot;404:&lt;some-URL&gt;&quot;
</I>

Squid only accepts RFC defined redirection status codes for redirection
(301, 302, 303, 307, 308). Any other status gets passed through as if
the helper indicated no-change.

In HTTP 4xx messages have an optional body/payload. A Location:&lt;url&gt;
header has no defined meaning and is ignored by browsers.

So the equivalent deny_info uses 4xx:file where the file will be sent as
error message payload.

&gt;<i> 
</I>&gt;&gt;<i> IMPORTANT:  doing that was a XSS / open-proxy vulnerability that
</I>&gt;&gt;<i> squidguard had. Its not a good idea to just dump out query-string data
</I>&gt;&gt;<i> delivered by the client as body content. It needs to be sanitized
</I>&gt;&gt;<i> properly first.
</I>&gt;<i> 
</I>&gt;<i> ufdbGuard sends a sanitised URL so in this case dumping out the value of
</I>&gt;<i> the
</I>&gt;<i> url= parameter is safe.
</I>&gt;<i> 
</I>
I'm speaking about the URL that comes back from the client after the
redirect 3xx has happened. The script should not assume that it is the
same as the sanitized URL the helper produced.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004454.html">[squid-users] Squid and ufdbGuard, display blocked URL on client browser address bar
</A></li>
	<LI>Next message (by thread): <A HREF="004455.html">[squid-users] accessing google.com
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4456">[ date ]</a>
              <a href="thread.html#4456">[ thread ]</a>
              <a href="subject.html#4456">[ subject ]</a>
              <a href="author.html#4456">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
