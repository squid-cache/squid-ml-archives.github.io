<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Transparent proxy before NAT
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Transparent%20proxy%20before%20NAT&In-Reply-To=%3C55A4A396.8040900%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004498.html">
   <LINK REL="Next"  HREF="004507.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Transparent proxy before NAT</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Transparent%20proxy%20before%20NAT&In-Reply-To=%3C55A4A396.8040900%40gmail.com%3E"
       TITLE="[squid-users] Transparent proxy before NAT">yvoinov at gmail.com
       </A><BR>
    <I>Tue Jul 14 05:52:22 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004498.html">[squid-users] Transparent proxy before NAT
</A></li>
        <LI>Next message (by thread): <A HREF="004507.html">[squid-users] Transparent proxy before NAT
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4502">[ date ]</a>
              <a href="thread.html#4502">[ thread ]</a>
              <a href="subject.html#4502">[ subject ]</a>
              <a href="author.html#4502">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I use a bit another configuration:

<A HREF="http://wiki.squid-cache.org/ConfigExamples/Intercept/CiscoIOSv15Wccp2">http://wiki.squid-cache.org/ConfigExamples/Intercept/CiscoIOSv15Wccp2</A>

As you can see, squid box placed between two routers. Front router uses 
NAT to white IP, back router has no NAT and configured with WCCPv2 
redirection. DMZ configured between two routers.

As I think, configuration you described will really strange and 
insecure. Yes, you can assign white IP to squid. No, you can't use squid 
as router or DHCP. Squid box can only work as intercepter for HTTP/HTTPS 
traffic and TCP/IP forwarder for another traffic.

As I said, more correct configuration will be:

Internet &lt;-----&gt; Router &lt;-----&gt; Transparent Squid box as gateway 
&lt;-------&gt; devices.

This configuration works, I use it on my testing environment.

14.07.15 2:34, John Pearson &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> Thanks Yuri for the response, I understand. I do have Shorewall 
</I>&gt;<i> configured and I understand the security implications. My Router is 
</I>&gt;<i> also the Wireless AP, so I want to try out this setup without having 
</I>&gt;<i> to buy another Wireless AP.
</I>&gt;<i>
</I>&gt;<i> I don't mind it being complex, do you have any suggestions on getting 
</I>&gt;<i> Internet &lt;---&gt; Squid &lt;---&gt; Router (NAT) working ?
</I>&gt;<i>
</I>&gt;<i> Thanks!
</I>&gt;<i>
</I>&gt;<i> On Mon, Jul 13, 2015 at 1:33 PM, John Pearson 
</I>&gt;<i> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">johnpearson555 at gmail.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">johnpearson555 at gmail.com</A>&gt;&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>     Thanks Yuri for the response, I understand. I do have Shorewall
</I>&gt;<i>     configured and I understand the security implications. My Router
</I>&gt;<i>     is also the Wireless AP, so I want to try out this setup without
</I>&gt;<i>     having to buy another Wireless AP.
</I>&gt;<i>
</I>&gt;<i>     I don't mind it being complex, do you have any suggestions on
</I>&gt;<i>     getting Internet &lt;---&gt; Squid &lt;---&gt; Router (NAT) working ?
</I>&gt;<i>
</I>&gt;<i>     Thanks!
</I>&gt;<i>
</I>&gt;<i>     On Mon, Jul 13, 2015 at 1:26 PM, Yuri Voinov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A>&gt;&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>         -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i>         Hash: SHA256
</I>&gt;<i>
</I>&gt;<i>         Ah,
</I>&gt;<i>
</I>&gt;<i>         forgot about:
</I>&gt;<i>
</I>&gt;<i>         Your squid in scheme I wrote will have static gray IP. And
</I>&gt;<i>         this IP must be excluded from DHCP pool on router.
</I>&gt;<i>
</I>&gt;<i>         14.07.15 2:15, John Pearson &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;<i>         &gt; Hi Everyone, &gt; &gt; My setup is: Internet &lt;--&gt; Squid-eth0 &lt;--&gt; Squid-eth1
</I>&gt;<i>         &lt;--&gt; Router &lt;--&gt; &gt; Devices &gt; &gt; Currently the Router is doing
</I>&gt;<i>         NAT and DHCP for the devices connected to it. &gt; Squid is in
</I>&gt;<i>         transparent mode. I set up a bridge ( br0). I set up the &gt;
</I>&gt;<i>         ebtables and iptables. It works but I want to figure out a way
</I>&gt;<i>         without &gt; having to configure Squid server or Router with
</I>&gt;<i>         hardcoded addresses. &gt; &gt; I have it working with either setup:
</I>&gt;<i>         &gt; 1. Remove the bridge ( br0) and setup the Squid server eth1
</I>&gt;<i>         as a static IP &gt; address and set Squid server IP address as
</I>&gt;<i>         gateway in Router settings. &gt; 2. Since Squid server is in
</I>&gt;<i>         bridge mode, I can hard code IP address in a &gt; Squid ACL as
</I>&gt;<i>         all traffic appears to come this IP address from the router. &gt;
</I>&gt;<i>         &gt; I want a way to do this without any setup, basically to take
</I>&gt;<i>         a Squid box &gt; and place it before a Router. Is there a way to
</I>&gt;<i>         do this ? &gt; &gt; A few ideas that might be wrong: &gt; 1. In bridge
</I>&gt;<i>         mode, http_access allow CURRENTIPADDRESS  ( CURRENTIPADDRESS &gt;
</I>&gt;<i>         is the dynamic IP address provided the ISP ) Is there a way to
</I>&gt;<i>         obtain this &gt; in the squid.conf file ? &gt; 2. Setup a DHCP
</I>&gt;<i>         server alongside Squid server and have Squid(DHCP) &lt;--&gt; &gt;
</I>&gt;<i>         Router(DHCP, NAT) and have same dhcp address given to the
</I>&gt;<i>         Router in &gt; squid.conf as http_access allow localnet &gt; &gt;
</I>&gt;<i>         Thanks in advance! &gt; &gt; &gt;
</I>&gt;<i>         &gt; _______________________________________________ &gt;
</I>&gt;<i>         squid-users mailing list &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>         &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt; &gt;
</I>&gt;<i>         <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i>         -----BEGIN PGP SIGNATURE-----
</I>&gt;<i>         Version: GnuPG v2
</I>&gt;<i>
</I>&gt;<i>         iQEbBAEBCAAGBQJVpB7aAAoJENNXIZxhPexGJcgH+IcaMqoEwlcRYFNCWqKT/Msc
</I>&gt;<i>         I6aMD/82Uw5ow/HayX/GrxCHTzYjdCzXDXJTP9cAnHZaMnvOPxtCGuVocEHNEiOa
</I>&gt;<i>         sDsZC9P074hoANDEAYXycWF73auCxYg4jcg8dRtbZwVEazwYsMVN6ye5a3i9EaZM
</I>&gt;<i>         /DotQ78htLNRJrLhoCO9yQBtJObcUs+eyOie4oxk4YWSfQMcjZOXen7U8K8KGQuH
</I>&gt;<i>         cOBcodLJv/eP1T+CcEe3ATr8Szo+zQ648jG27pdy7XuPecek7sWllRnyq93fpkID
</I>&gt;<i>         FnvOr21R3gLBBdStYty43PKQ/4Z3d4vp56aYEweKBsGJV9kVC2QMjDXLOzrbug==
</I>&gt;<i>         =1pgP
</I>&gt;<i>         -----END PGP SIGNATURE-----
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>         _______________________________________________
</I>&gt;<i>         squid-users mailing list
</I>&gt;<i>         <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>         &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i>         <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150714/00b0cd92/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150714/00b0cd92/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004498.html">[squid-users] Transparent proxy before NAT
</A></li>
	<LI>Next message (by thread): <A HREF="004507.html">[squid-users] Transparent proxy before NAT
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4502">[ date ]</a>
              <a href="thread.html#4502">[ thread ]</a>
              <a href="subject.html#4502">[ subject ]</a>
              <a href="author.html#4502">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
