<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid3: 100 % CPU load during object caching
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid3%3A%20100%20%25%20CPU%20load%20during%20object%20caching&In-Reply-To=%3C55AE6744.7010003%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004665.html">
   <LINK REL="Next"  HREF="004666.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid3: 100 % CPU load during object caching</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid3%3A%20100%20%25%20CPU%20load%20during%20object%20caching&In-Reply-To=%3C55AE6744.7010003%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid3: 100 % CPU load during object caching">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Jul 21 15:37:40 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004665.html">[squid-users] Squid3: 100 % CPU load during object caching
</A></li>
        <LI>Next message (by thread): <A HREF="004666.html">[squid-users] Squid3: 100 % CPU load during object caching
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4673">[ date ]</a>
              <a href="thread.html#4673">[ thread ]</a>
              <a href="subject.html#4673">[ subject ]</a>
              <a href="author.html#4673">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 22/07/2015 12:31 a.m., Jens Offenbach wrote:
&gt;<i> Thank you very much for your detailed explainations. We want to use Squid in 
</I>&gt;<i> order to accelerate our automated software setup processes via Puppet. Actually 
</I>&gt;<i> Squid will host only a very short amount of large objects (10-20). Its purpose 
</I>&gt;<i> is not to cache web traffic or little objects.
</I>
Ah, Squid does not &quot;host&quot;, it caches. The difference may seem trivial at
first glance but it is the critical factor between whether a proxy or a
local web server is the best tool for the job.

&gt;<i>From my own experiences with Puppet, yes Squid is the right tool. But
</I>only because the Puppet server was using relatively slow python code to
generate objects and not doing server-side caching on its own. If that
situation has changed in recent years then Squids usefulness will also
have changed.


&gt;<i> The hit-ratio for all the hosted 
</I>&gt;<i> objects will be very high, because most of our VMs require the same software stack.
</I>&gt;<i> I will update mit config regarding to your comments! Thanks a lot!
</I>&gt;<i> But actually I have still no idea, why the download rates are so unsatisfying. 
</I>&gt;<i> We are sill in the test phase. We have only one client that requests a large 
</I>&gt;<i> object from Squid and the transfer rates are lower than 1 MB/sec during cache 
</I>&gt;<i> build-up without any form of concurrency. Have vou got an idea what could be the 
</I>&gt;<i> source of the problem here? Why causes the Squid process 100 % CPU usage.
</I>
I did not see any config causing the known 100% CPU bugs to be
encountered in your case (eg. HTTPS going through delay pools guarantees
100% CPU). Which leads me to think its probably related to memory
shuffling. (&lt;<A HREF="http://bugs.squid-cache.org/show_bug.cgi?id=3189">http://bugs.squid-cache.org/show_bug.cgi?id=3189</A>&gt; appears
to be the same and still unidentified)

As for speed, if the CPU is maxed out by one particular action Squid
wont have time for much other work. So things go slow.

On the other hand Squid is also optimized for relatively high traffic
usage. For very small client counts (such as under-10) it is effectively
running in idle mode 99% of the time. The I/O event loop starts pausing
for 10ms blocks waiting to see if some more useful amount of work can be
done at the end of the wait. That can lead to apparent network slowdown
as TCP gets up to 10ms delay per packet. But that should not be visible
in CPU numbers.


That said, 1 client can still max out Squid CPU and/or NIC throughput
capacity on a single request if its pushing/pulling packets fast enough.


If you can attach the strace tool to Squid when its consuming the CPU
there might be some better hints about where to look.


Cheers
Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004665.html">[squid-users] Squid3: 100 % CPU load during object caching
</A></li>
	<LI>Next message (by thread): <A HREF="004666.html">[squid-users] Squid3: 100 % CPU load during object caching
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4673">[ date ]</a>
              <a href="thread.html#4673">[ thread ]</a>
              <a href="subject.html#4673">[ subject ]</a>
              <a href="author.html#4673">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
