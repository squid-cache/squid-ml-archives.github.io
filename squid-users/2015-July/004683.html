<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSL connction failed due to SNI after content redirection
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20connction%20failed%20due%20to%20SNI%20after%20content%0A%20redirection&In-Reply-To=%3CBAY181-W244B935D970106C8E5264F83830%40phx.gbl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004681.html">
   <LINK REL="Next"  HREF="004657.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSL connction failed due to SNI after content redirection</H1>
    <B>Alex Wu</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20connction%20failed%20due%20to%20SNI%20after%20content%0A%20redirection&In-Reply-To=%3CBAY181-W244B935D970106C8E5264F83830%40phx.gbl%3E"
       TITLE="[squid-users] SSL connction failed due to SNI after content redirection">alex_wu2012 at hotmail.com
       </A><BR>
    <I>Wed Jul 22 14:41:08 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004681.html">[squid-users] SSL connction failed due to SNI after content redirection
</A></li>
        <LI>Next message (by thread): <A HREF="004657.html">[squid-users] Squid 3.5.5 ssl_bump and ufdbGuard
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4683">[ date ]</a>
              <a href="thread.html#4683">[ thread ]</a>
              <a href="subject.html#4683">[ subject ]</a>
              <a href="author.html#4683">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We do not use cache-peer. I thought cache-peer is for connecting another squid-like proxy server.

Without ssl-bump, the connection is tunneled transparently, so there is no chance to redirect each HTTP requests proxied under SSL connection.

We want to redirec each HTTP requests under SSL, so we have to use ssl-bump to terminate the connection, and squid open another connection to the server we use content redirect to specify. The code take effect when the squid opens the new connection to each designed server for each HTTPS requests.

We terminated CONNECT call at squid also to ensure we can intercept HTTP requests at squid,

Alex
&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> From: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>
</I>&gt;<i> Date: Thu, 23 Jul 2015 00:21:31 +1200
</I>&gt;<i> Subject: Re: [squid-users] SSL connction failed due to SNI after content redirection
</I>&gt;<i> 
</I>&gt;<i> On 22/07/2015 12:44 p.m., Alex Wu wrote:
</I>&gt;<i> &gt; it depends on how you set up squid, and where the connection is broken. The patch addessed the issue that occured using sslbump and content redirect together.
</I>&gt;<i> &gt; 
</I>&gt;<i> 
</I>&gt;<i> I'd like some clarification what the exact problem symptoms are please.
</I>&gt;<i> 
</I>&gt;<i> AFAIK, both redirect and re-write actions happen a relatively long time
</I>&gt;<i> *after* the bumping TLS handshakes to server are completed. Its far too
</I>&gt;<i> late to send the pre-handshake SNI data to the server.
</I>&gt;<i> 
</I>&gt;<i> I can see this change as affecting reverse-proxy / CDN configurations
</I>&gt;<i> with TLS on both connections. But you said this was SSL-bumping, and
</I>&gt;<i> reverse-proxy configurations already have a cache_peer option to set the
</I>&gt;<i> internal domain name without re-write/redirect.
</I>&gt;<i> 
</I>&gt;<i> Amos
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I> 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150722/6f7cf3d6/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150722/6f7cf3d6/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004681.html">[squid-users] SSL connction failed due to SNI after content redirection
</A></li>
	<LI>Next message (by thread): <A HREF="004657.html">[squid-users] Squid 3.5.5 ssl_bump and ufdbGuard
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4683">[ date ]</a>
              <a href="thread.html#4683">[ thread ]</a>
              <a href="subject.html#4683">[ subject ]</a>
              <a href="author.html#4683">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
