<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TCP_MISS in images
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_MISS%20in%20images&In-Reply-To=%3C55B204CF.2030007%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004713.html">
   <LINK REL="Next"  HREF="004705.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TCP_MISS in images</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_MISS%20in%20images&In-Reply-To=%3C55B204CF.2030007%40treenet.co.nz%3E"
       TITLE="[squid-users] TCP_MISS in images">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Jul 24 09:26:39 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004713.html">[squid-users] TCP_MISS in images
</A></li>
        <LI>Next message (by thread): <A HREF="004705.html">[squid-users] ecap and https
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4730">[ date ]</a>
              <a href="thread.html#4730">[ thread ]</a>
              <a href="subject.html#4730">[ subject ]</a>
              <a href="author.html#4730">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 24/07/2015 6:02 a.m., Yuri Voinov wrote:
&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 23.07.15 23:57, Amos Jeffries &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;&gt;<i> On 24/07/2015 4:02 a.m., Ulises Nicolini wrote:
</I>&gt;&gt;&gt;<i> Hello,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I have a basic squid 3.5 configuration with
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> maximum_object_size_in_memory 64 KB
</I>&gt;&gt;&gt;<i> maximum_object_size 100000 KB
</I>&gt;&gt;&gt;<i> minimum_object_size 512 bytes
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> refresh_pattern -i \.(gif|png|jpg|jpeg|ico)$ 1440 90% 10080
</I>&gt;&gt;&gt;<i> override-expire ignore-no-cache ignore-private
</I>&gt;&gt;&gt;<i> refresh_pattern -i (/cgi-bin/)                  0       0%      0
</I>&gt;&gt;&gt;<i> refresh_pattern .                                       0 20%     4320
</I>&gt;&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;&gt;<i> ignore-no-cache has no meaning for Squid-3.5.
</I>&gt;<i> 
</I>&gt;&gt;<i> ignore-private does nothing on your images. It makes current Squid act
</I>&gt;&gt;<i> like must-revalidate was set on the response instead of &quot;private&quot;.
</I>&gt;<i> 
</I>&gt;&gt;<i> override-expire also does nothing on your images. As used above it makes
</I>&gt;&gt;<i> Squid act like &quot;s-maxage=604800&quot; was given instead of any Expires:
</I>&gt;&gt;<i> header or max-age=N / s-maxage=N Cache-Control values.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> cache_dir rock  /cache1/rock1 256  min-size=500 max-size=32767
</I>&gt;&gt;&gt;<i> max-swap-rate=250 swap-timeout=350
</I>&gt;&gt;&gt;<i> cache_dir diskd /cache2/diskd1 1000 16 256 min-size=32768
</I>&gt;<i> max-size=1048576
</I>&gt;&gt;&gt;<i> cache_dir diskd /cache2/diskd2 100000 16 256 min-size=1048576
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> But when I test it against my webserver, using only one client PC, the
</I>&gt;&gt;&gt;<i> only thing I get are TCP_MISSes of my images.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 1437664284.339     11 192.168.2.103 TCP_MISS/200 132417 GET
</I>&gt;&gt;&gt;<i> <A HREF="http://test-server.com/images/imagen3.jpg">http://test-server.com/images/imagen3.jpg</A> - HIER_DIRECT/192.168.2.10
</I>&gt;&gt;&gt;<i> image/jpeg
</I>&gt;&gt;&gt;<i> 1437664549.753      5 192.168.2.103 TCP_MISS/200 53933 GET
</I>&gt;&gt;&gt;<i> <A HREF="http://test-server.com/images/imagen1.gif">http://test-server.com/images/imagen1.gif</A> - HIER_DIRECT/192.168.2.10
</I>&gt;&gt;&gt;<i> image/gif
</I>&gt;&gt;&gt;<i> 1437665917.469     18 192.168.2.103 TCP_MISS/200 8319 GET
</I>&gt;&gt;&gt;<i> <A HREF="http://test-server.com/images/icono.png">http://test-server.com/images/icono.png</A> - HIER_DIRECT/192.168.2.10
</I>&gt;&gt;&gt;<i> image/png
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> The response headers don't have Vary tags or any other that may impede
</I>&gt;&gt;&gt;<i> caching
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Accept-Ranges    bytes
</I>&gt;&gt;&gt;<i> Connection    close
</I>&gt;&gt;&gt;<i> Content-Length    53644
</I>&gt;&gt;&gt;<i> Content-Type    image/gif
</I>&gt;&gt;&gt;<i> Date    Thu, 23 Jul 2015 15:56:07 GMT
</I>&gt;&gt;&gt;<i> Etag    &quot;e548d4-d18c-51b504b95dec0&quot;
</I>&gt;&gt;&gt;<i> Last-Modified    Mon, 20 Jul 2015 15:36:03 GMT
</I>&gt;&gt;&gt;<i> Server    Apache/2.2.22 (EL)
</I>&gt;&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;&gt;<i> Your refresh pattern says to only cache these objects for +90% of their
</I>&gt;&gt;<i> current age, so long as that period is longer than 1 day (1440 mins) and
</I>&gt;&gt;<i> no more that 7 days (10080 mins).
</I>&gt;<i> 
</I>&gt;&gt;<i> Which means;
</I>&gt;&gt;<i>  they are 3 days 20 mins 4 secs old right now (260404 secs).
</I>&gt;&gt;<i>  90% of that is 2 days 17 hrs 6 mins 3 secs (234363 secs).
</I>&gt;<i> 
</I>&gt;&gt;<i> So the object &quot;e548d4-d18c-51b504b95dec0&quot; will stay in cache for the
</I>&gt;&gt;<i> next 2 days 17hrs etc.
</I>&gt;<i> 
</I>&gt;&gt;<i> I notice though that the Content-Length size does not match any of the
</I>&gt;&gt;<i> logged transfer sizes. Which makes me wonder if the object is actually
</I>&gt;&gt;<i> varying despite the lack of Vary headers.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Is it necessary a certain amount of requests of a single object to be
</I>&gt;&gt;&gt;<i> cached (mem o disk) or am I facing some other problem here?
</I>&gt;<i> 
</I>&gt;&gt;<i> Yes. Two requests. The first (a MISS) will add it to cache the second
</I>&gt;&gt;<i> and later should be HITs on the now cached object.
</I>&gt;<i> 
</I>&gt;&gt;<i> BUT, only if you are not force-reloading the browser for your tests.
</I>&gt;&gt;<i> Force-reload instructs Squid it ignore its cached content and replace it
</I>&gt;&gt;<i> with another MISS.
</I>
&gt;<i> Amos, this behaviour depends from refresh_pattern and often can be
</I>&gt;<i> ignore (with reload-into-ims, for example).
</I>
I know. You know that. The Q about number of requests is a big hint that
he is very new to this and may not be aware yet.

He has not configured anything that would affect it. So it is still
relevant to his Squid and still #1 most common mistake when testing
these things.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004713.html">[squid-users] TCP_MISS in images
</A></li>
	<LI>Next message (by thread): <A HREF="004705.html">[squid-users] ecap and https
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4730">[ date ]</a>
              <a href="thread.html#4730">[ thread ]</a>
              <a href="subject.html#4730">[ subject ]</a>
              <a href="author.html#4730">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
