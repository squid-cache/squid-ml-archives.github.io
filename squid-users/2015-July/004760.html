<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid 3.5 with auth and chroot
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%203.5%20with%20auth%20and%20chroot&In-Reply-To=%3C55B25254.9020902%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004758.html">
   <LINK REL="Next"  HREF="004761.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid 3.5 with auth and chroot</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%203.5%20with%20auth%20and%20chroot&In-Reply-To=%3C55B25254.9020902%40treenet.co.nz%3E"
       TITLE="[squid-users] squid 3.5 with auth and chroot">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Jul 24 14:57:24 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004758.html">[squid-users] squid 3.5 with auth and chroot
</A></li>
        <LI>Next message (by thread): <A HREF="004761.html">[squid-users] squid 3.5 with auth and chroot
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4760">[ date ]</a>
              <a href="thread.html#4760">[ thread ]</a>
              <a href="subject.html#4760">[ subject ]</a>
              <a href="author.html#4760">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 25/07/2015 2:22 a.m., Jorgeley Junior wrote:
&gt;<i> Thank you so much for the help.
</I>
Cant be much help sorry. I'm just guessing here. Never actually run
Squid in a chroot myself.

&gt;<i> So, I use the directive 'chroot' in the squid.conf.
</I>&gt;<i> I start squid this way:
</I>&gt;<i> cd /etc/squid-3.5.6
</I>&gt;<i> sbin/squid
</I>&gt;<i> and it starts normally, but when I open the client browser and do an
</I>&gt;<i> authentication it logs the errors and don't authenticate, but the squid
</I>&gt;<i> doesn't stop running, just it logs the error and do not authenticate.
</I>
I've just looked up what is displaying that error and why. It is more of
the code wrongly using errno to display error text. So the message
itself may be bogus, but some error is happening when fork()'ing and
execv()'ing the helper process.

Some things I think you should try;

1) configure Squid with the full non-chroot path of the binary in the
auth_param line.

2) enter the chroot, downgrade yourself to the squid low-privilege user,
then try running the helper. Thats whats Squid is doing.

3) try the chroot directive in squid.conf with a '/' on the end

I'm out of ideas at this point. Apart from patching your squid to fix
the errno usage in ipcCreate() just to see if some other error message
appears. Sad thing about thtat is that I'm not sure what syscall is
supposed to be error-reported there, quite a few happen in sequence.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004758.html">[squid-users] squid 3.5 with auth and chroot
</A></li>
	<LI>Next message (by thread): <A HREF="004761.html">[squid-users] squid 3.5 with auth and chroot
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4760">[ date ]</a>
              <a href="thread.html#4760">[ thread ]</a>
              <a href="subject.html#4760">[ subject ]</a>
              <a href="author.html#4760">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
