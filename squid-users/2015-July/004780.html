<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ISSUE accssing content
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ISSUE%20accssing%20content&In-Reply-To=%3C55B2B310.6050608%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004770.html">
   <LINK REL="Next"  HREF="004790.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ISSUE accssing content</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ISSUE%20accssing%20content&In-Reply-To=%3C55B2B310.6050608%40treenet.co.nz%3E"
       TITLE="[squid-users] ISSUE accssing content">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Jul 24 21:50:08 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004770.html">[squid-users] ISSUE accssing content
</A></li>
        <LI>Next message (by thread): <A HREF="004790.html">[squid-users] ISSUE accssing content
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4780">[ date ]</a>
              <a href="thread.html#4780">[ thread ]</a>
              <a href="subject.html#4780">[ subject ]</a>
              <a href="author.html#4780">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 25/07/2015 4:59 a.m., Jagannath Naidu wrote:
&gt;<i> 1. Its not  a transparent proxy.
</I>&gt;<i> 
</I>&gt;<i> 2. My clients get wpad configuration from AD server. So there are two
</I>&gt;<i> question.
</I>&gt;<i>  2.1 :I know that wpad is used to identify proxy server and port(and rest
</I>&gt;<i> other bypass rules).  When clients resolve to wpad.abc.com, is there way
</I>&gt;<i> that I can overwrite the wpad file off client. Like creating a webserver to
</I>&gt;<i> to serve wpad file and I change /etc/hosts file to &quot;&lt;myhwebserveripaddress&gt;
</I>&gt;<i> wpad.abc.com&quot;
</I>&gt;<i> 2.2 Is there any other way to tell clients via squid server, to do not come
</I>&gt;<i> to squid server and re initiate the request.
</I>
Exactly that if you wish. Its not clear whether WPAD is the problem though.

The fact that you have Squid logs showing access indicates the traffic
us actually getting there okay. The responses do seem to be coming back
from 10.* servers as well.
So what is happening is something is causing those servers not to like
the traffic being requested from them.


&gt;<i> 
</I>&gt;<i> On 24 July 2015 at 21:10, Jagannath Naidu &lt;
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">jagannath.naidu at fosteringlinux.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 24 July 2015 at 21:05, Jagannath Naidu &lt;
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">jagannath.naidu at fosteringlinux.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Dear List,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I have been working on this for last two weeks, but never got it
</I>&gt;&gt;&gt;<i> resolved.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> We have a application server (SERVER) in our local network and a desktop
</I>&gt;&gt;&gt;<i>  application (CLIENT). The application picks proxy settings from IE. And we
</I>&gt;&gt;&gt;<i> also have a wensense proxy server
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> case 1: when there is no proxy set
</I>&gt;&gt;&gt;<i> application works. No logs in squid server access.log
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> case 2: when proxy ip address set and checked &quot;bypass local network&quot;
</I>&gt;&gt;&gt;<i> application works. No logs in squid server access.log
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> case 3: when proxy ip address is set to wensense proxy server. UNCHECKED
</I>&gt;&gt;&gt;<i> &quot;bypass local network&quot;
</I>&gt;&gt;&gt;<i> application works. We dont have access to websense server and hence we
</I>&gt;&gt;&gt;<i> can not check logs
</I>
Can you explain &quot;not works&quot; in any better detail?
 application expected vs actual behaviour?
 if you can relate that to particular HTTP messages even better.


&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> case 4: when proxy ip address is set to proxy server ip address.
</I>&gt;&gt;&gt;<i> UNCHECKED &quot;bypass local network&quot;
</I>&gt;&gt;&gt;<i> application does not work :-(. Below are the logs.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 1437751240.149      7 192.168.122.1 TCP_MISS/404 579 GET
</I>&gt;&gt;&gt;<i> <A HREF="http://dlwvdialce.htmedia.net/UADInstall/UADPresentationLayer.application">http://dlwvdialce.htmedia.net/UADInstall/UADPresentationLayer.application</A>
</I>&gt;&gt;&gt;<i> - HIER_DIRECT/10.1.4.46 text/html
</I>
404. The URL you see above references an object that does not exist on
that server.

Things to look into:
 Is it the right server?
 Is it the right URL?
 Why was it requested?
 Does the server actually know its &quot;dlwvdialce.htmedia.net&quot; name?


&gt;&gt;&gt;<i> 1437751240.992     94 192.168.122.1 TCP_DENIED/407 3757 CONNECT
</I>&gt;&gt;&gt;<i> 0.client-channel.google.com:443 - HIER_NONE/- text/html
</I>&gt;&gt;&gt;<i> 1437751240.996      0 192.168.122.1 TCP_DENIED/407 4059 CONNECT
</I>&gt;&gt;&gt;<i> 0.client-channel.google.com:443 - HIER_NONE/- text/html
</I>

Authentication. Normal I think.

&gt;&gt;&gt;<i> 1437751242.327      5 192.168.122.1 TCP_MISS/404 579 GET
</I>&gt;&gt;&gt;<i> <A HREF="http://dlwvdialce.htmedia.net/UADInstall/uadprop.htm">http://dlwvdialce.htmedia.net/UADInstall/uadprop.htm</A> - HIER_DIRECT/
</I>&gt;&gt;&gt;<i> 10.1.4.46 text/html
</I>
Same as the first 404'd URL.

&gt;&gt;&gt;<i> 1437751244.777      1 192.168.122.1 TCP_MISS/503 4048 POST
</I>&gt;&gt;&gt;<i> <A HREF="http://cs-711-core.htmedia.net:8180/ConcertoAgentPortal/services/ConcertoAgentPortal">http://cs-711-core.htmedia.net:8180/ConcertoAgentPortal/services/ConcertoAgentPortal</A>
</I>&gt;&gt;&gt;<i> - HIER_NONE/- text/html
</I>
503 usually indicates the attempted server failed.

Makes sense if TCP to cs-711-core.htmedia.net port 8180 did not work.
Which would also match the lack of server IP in the log.


&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> UPDATE: correct logs
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 1437752279.774      6 192.168.122.1 TCP_MISS/404 579 GET
</I>&gt;&gt;<i> <A HREF="http://dlwvdialce.htmedia.net/UADInstall/UADPresentationLayer.application">http://dlwvdialce.htmedia.net/UADInstall/UADPresentationLayer.application</A>
</I>&gt;&gt;<i> - HIER_DIRECT/10.1.4.46 text/html
</I>&gt;&gt;<i> 1437752281.854      5 192.168.122.1 TCP_MISS/404 579 GET
</I>&gt;&gt;<i> <A HREF="http://dlwvdialce.htmedia.net/UADInstall/uadprop.htm">http://dlwvdialce.htmedia.net/UADInstall/uadprop.htm</A> - HIER_DIRECT/
</I>&gt;&gt;<i> 10.1.4.46 text/html
</I>&gt;&gt;<i> 1437752284.265      2 192.168.122.1 TCP_MISS/503 4048 POST
</I>&gt;&gt;<i> <A HREF="http://cs-711-core.htmedia.net:8180/ConcertoAgentPortal/services/ConcertoAgentPortal">http://cs-711-core.htmedia.net:8180/ConcertoAgentPortal/services/ConcertoAgentPortal</A>
</I>&gt;&gt;<i> - HIER_NONE/- text/html
</I>&gt;&gt;<i>
</I>
Same comments as above.

&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> squid -v
</I>&gt;&gt;&gt;<i> Squid Cache: Version 3.3.8
</I>&gt;&gt;&gt;<i> configure options:  '--build=x86_64-redhat-linux-gnu'
</I>&gt;&gt;&gt;<i> '--host=x86_64-redhat-linux-gnu' '--program-prefix=' '--prefix=/usr'
</I>&gt;&gt;&gt;<i> '--exec-prefix=/usr' '--bindir=/usr/bin' '--sbindir=/usr/sbin'
</I>&gt;&gt;&gt;<i> '--sysconfdir=/etc' '--datadir=/usr/share' '--includedir=/usr/include'
</I>&gt;&gt;&gt;<i> '--libdir=/usr/lib64' '--libexecdir=/usr/libexec'
</I>&gt;&gt;&gt;<i> '--sharedstatedir=/var/lib' '--mandir=/usr/share/man'
</I>&gt;&gt;&gt;<i> '--infodir=/usr/share/info' '--disable-strict-error-checking'
</I>&gt;&gt;&gt;<i> '--exec_prefix=/usr' '--libexecdir=/usr/lib64/squid' '--localstatedir=/var'
</I>&gt;&gt;&gt;<i> '--datadir=/usr/share/squid' '--sysconfdir=/etc/squid'
</I>&gt;&gt;&gt;<i> '--with-logdir=$(localstatedir)/log/squid'
</I>&gt;&gt;&gt;<i> '--with-pidfile=$(localstatedir)/run/squid.pid'
</I>&gt;&gt;&gt;<i> '--disable-dependency-tracking' '--enable-eui'
</I>&gt;&gt;&gt;<i> '--enable-follow-x-forwarded-for' '--enable-auth'
</I>&gt;&gt;&gt;<i> '--enable-auth-basic=DB,LDAP,MSNT,MSNT-multi-domain,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB,getpwnam'
</I>&gt;&gt;&gt;<i> '--enable-auth-ntlm=smb_lm,fake'
</I>&gt;&gt;&gt;<i> '--enable-auth-digest=file,LDAP,eDirectory'
</I>&gt;&gt;&gt;<i> '--enable-auth-negotiate=kerberos'
</I>&gt;&gt;&gt;<i> '--enable-external-acl-helpers=file_userip,LDAP_group,time_quota,session,unix_group,wbinfo_group'
</I>&gt;&gt;&gt;<i> '--enable-cache-digests' '--enable-cachemgr-hostname=localhost'
</I>&gt;&gt;&gt;<i> '--enable-delay-pools' '--enable-epoll' '--enable-icap-client'
</I>&gt;&gt;&gt;<i> '--enable-ident-lookups' '--enable-linux-netfilter'
</I>&gt;&gt;&gt;<i> '--enable-removal-policies=heap,lru' '--enable-snmp' '--enable-ssl'
</I>&gt;&gt;&gt;<i> '--enable-ssl-crtd' '--enable-storeio=aufs,diskd,ufs' '--enable-wccpv2'
</I>&gt;&gt;&gt;<i> '--enable-esi' '--enable-ecap' '--with-aio' '--with-default-user=squid'
</I>&gt;&gt;&gt;<i> '--with-filedescriptors=16384' '--with-dl' '--with-openssl'
</I>&gt;&gt;&gt;<i> '--with-pthreads' 'build_alias=x86_64-redhat-linux-gnu'
</I>&gt;&gt;&gt;<i> 'host_alias=x86_64-redhat-linux-gnu' 'CFLAGS=-O2 -g -pipe -Wall
</I>&gt;&gt;&gt;<i> -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong
</I>&gt;&gt;&gt;<i> --param=ssp-buffer-size=4 -grecord-gcc-switches   -m64 -mtune=generic
</I>&gt;&gt;&gt;<i> -fpie' 'LDFLAGS=-Wl,-z,relro  -pie -Wl,-z,relro -Wl,-z,now' 'CXXFLAGS=-O2
</I>&gt;&gt;&gt;<i> -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions
</I>&gt;&gt;&gt;<i> -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches
</I>&gt;&gt;&gt;<i> -m64 -mtune=generic -fpie'
</I>&gt;&gt;&gt;<i> 'PKG_CONFIG_PATH=%{_PKG_CONFIG_PATH}:/usr/lib64/pkgconfig:/usr/share/pkgconfig'
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> squid.conf
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> acl localnet src 10.0.0.0/8     # RFC1918 possible internal network
</I>&gt;&gt;&gt;<i> acl localnet src 172.16.0.0/12  # RFC1918 possible internal network
</I>&gt;&gt;&gt;<i> acl localnet src 192.168.0.0/16 # RFC1918 possible internal network
</I>&gt;&gt;&gt;<i> acl localnet src fc00::/7       # RFC 4193 local private network range
</I>&gt;&gt;&gt;<i> acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged)
</I>&gt;&gt;&gt;<i> machines
</I>&gt;&gt;&gt;<i> acl SSL_ports port 443
</I>&gt;&gt;&gt;<i> acl Safe_ports port 80          # http
</I>&gt;&gt;&gt;<i> acl Safe_ports port 21          # ftp
</I>&gt;&gt;&gt;<i> acl Safe_ports port 443         # https
</I>&gt;&gt;&gt;<i> acl Safe_ports port 70          # gopher
</I>&gt;&gt;&gt;<i> acl Safe_ports port 210         # wais
</I>&gt;&gt;&gt;<i> acl Safe_ports port 1025-65535  # unregistered ports
</I>&gt;&gt;&gt;<i> acl Safe_ports port 280         # http-mgmt
</I>&gt;&gt;&gt;<i> acl Safe_ports port 488         # gss-http
</I>&gt;&gt;&gt;<i> acl Safe_ports port 591         # filemaker
</I>&gt;&gt;&gt;<i> acl Safe_ports port 777         # multiling http
</I>&gt;&gt;&gt;<i> acl Safe_ports port 8180
</I>&gt;&gt;&gt;<i> acl CONNECT method CONNECT
</I>&gt;&gt;&gt;<i> acl wvdial dst 10.1.4.45 10.1.4.50 10.1.4.53 10.1.4.48 10.1.4.54
</I>&gt;&gt;&gt;<i> 10.1.4.46 10.1.4.51 10.1.4.47 10.1.4.55 10.1.4.49 10.1.4.52 10.1.2.4
</I>
For easier reading:
  acl wvdial dst 10.1.4.45-10.1.4.55/27 10.1.2.4

(at least I think they are all in one /27, double-check that)

&gt;&gt;&gt;<i> http_access allow wvdial
</I>&gt;&gt;&gt;<i> acl dialer dstdomain .htmedia.net
</I>&gt;&gt;&gt;<i> http_access allow dialer
</I>&gt;&gt;&gt;<i> http_access deny !Safe_ports
</I>&gt;&gt;&gt;<i> http_access deny CONNECT !SSL_ports
</I>&gt;&gt;&gt;<i> http_access allow localhost manager
</I>&gt;&gt;&gt;<i> http_access deny manager
</I>&gt;&gt;&gt;<i> visible_hostname = NOIDAPROXY01.MYDOMAIN.NET
</I>
 &quot;=&quot; is a funny domain name. I suspect you wanted the domain-name part
of the line to be used instead. Remove the &quot;= &quot; bit.

&gt;&gt;&gt;<i> append_domain  .mydomain.net
</I>&gt;&gt;&gt;<i> ignore_expect_100 on
</I>
The ignore_* directive should not be useful in 3.3. You can remove it now.

&gt;&gt;&gt;<i> dns_v4_first on
</I>&gt;&gt;&gt;<i> auth_param ntlm program /usr/bin/ntlm_auth --diagnostics
</I>&gt;&gt;&gt;<i> --helper-protocol=squid-2.5-ntlmssp --domain=HTMEDIA.NET
</I>&gt;&gt;&gt;<i> auth_param ntlm children 1000
</I>&gt;&gt;&gt;<i> auth_param ntlm keep_alive off
</I>&gt;&gt;&gt;<i> auth_param basic program /usr/bin/ntlm_auth
</I>&gt;&gt;&gt;<i> --helper-protocol=squid-2.5-basic
</I>&gt;&gt;&gt;<i> auth_param basic children 100
</I>&gt;&gt;&gt;<i> auth_param basic realm Squid proxy-caching web server
</I>&gt;&gt;&gt;<i> auth_param basic credentialsttl 2 hours
</I>&gt;&gt;&gt;<i> acl auth proxy_auth REQUIRED
</I>&gt;&gt;&gt;<i> http_access allow all auth
</I>
&quot;allow all auth&quot; means the same as &quot;allow auth&quot;.

&quot;all&quot; only has meaning on the end (right-hand side) of the line which
would otherwise end in a proxy_auth ACL.
It should either be on the end of that line, or not used at all.


&gt;&gt;&gt;<i> http_access allow localnet
</I>&gt;&gt;&gt;<i> http_access allow localhost
</I>&gt;&gt;&gt;<i> http_access deny all
</I>&gt;&gt;&gt;<i> http_port 0.0.0.0:8080
</I>&gt;&gt;&gt;<i> coredump_dir /var/spool/squid
</I>&gt;&gt;&gt;<i> refresh_pattern ^ftp:           1440    20%     10080
</I>&gt;&gt;&gt;<i> refresh_pattern ^gopher:        1440    0%      1440
</I>&gt;&gt;&gt;<i> refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
</I>&gt;&gt;&gt;<i> refresh_pattern .               0       20%     4320
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> It was the same behavior with squid-3.1.10-19. I thought, upgrading to
</I>&gt;&gt;&gt;<i> squid 3.3 would help. Please help me resolving this mystery.
</I>
Looks to me like the server at 10.1.4.46 does not know what to do with
the URLs requested.

I would start looking at whether the application is actually supposed to
be going there for its requests.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004770.html">[squid-users] ISSUE accssing content
</A></li>
	<LI>Next message (by thread): <A HREF="004790.html">[squid-users] ISSUE accssing content
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4780">[ date ]</a>
              <a href="thread.html#4780">[ thread ]</a>
              <a href="subject.html#4780">[ subject ]</a>
              <a href="author.html#4780">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
