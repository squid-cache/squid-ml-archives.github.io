<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] random forward proxy authentication pop-up
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20random%20forward%20proxy%20authentication%20pop-up&In-Reply-To=%3C201507271756.41564.Antony.Stone%40squid.open.source.it%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004812.html">
   <LINK REL="Next"  HREF="004815.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] random forward proxy authentication pop-up</H1>
    <B>Antony Stone</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20random%20forward%20proxy%20authentication%20pop-up&In-Reply-To=%3C201507271756.41564.Antony.Stone%40squid.open.source.it%3E"
       TITLE="[squid-users] random forward proxy authentication pop-up">Antony.Stone at squid.open.source.it
       </A><BR>
    <I>Mon Jul 27 16:56:41 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004812.html">[squid-users] random forward proxy authentication pop-up
</A></li>
        <LI>Next message (by thread): <A HREF="004815.html">[squid-users] random forward proxy authentication pop-up
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4814">[ date ]</a>
              <a href="thread.html#4814">[ thread ]</a>
              <a href="subject.html#4814">[ subject ]</a>
              <a href="author.html#4814">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Monday 27 Jul 2015 at 17:21, Berkes, David wrote:

&gt;<i> Here is the information requested.  From the log, everything looks to be
</I>&gt;<i> normal.  The log example is from the cdn0.vox-cdn.com traffic.
</I>&gt;<i> 
</I>&gt;<i> **** ORIGIN URL's
</I>&gt;<i> pixel.adsafeprotected.com
</I>&gt;<i> cdn0.vox-cdn.com
</I>&gt;<i> sb.scorecardresearch.com
</I>&gt;<i> 
</I>&gt;<i> **** SQUID LOG
</I>&gt;<i> access.log.2:1437683164.693      0 70.197.241.219 TCP_DENIED/407 4213
</I>&gt;<i> CONNECT cdn0.vox-cdn.com:443 - HIER_NONE/- text/html
</I>&gt;<i> access.log.2:1437683164.815      0 70.197.241.219 TCP_DENIED/407 4213
</I>&gt;<i> CONNECT cdn0.vox-cdn.com:443 - HIER_NONE/- text/html
</I>&gt;<i> access.log.2:1437683164.815      0 70.197.241.219 TCP_DENIED/407 4213
</I>&gt;<i> CONNECT cdn0.vox-cdn.com:443 - HIER_NONE/- text/html
</I>&gt;<i> access.log.2:1437683164.816      0 70.197.241.219 TCP_DENIED/407 4213
</I>&gt;<i> CONNECT cdn0.vox-cdn.com:443 - HIER_NONE/- text/html
</I>&gt;<i> access.log.2:1437683164.816      0 70.197.241.219 TCP_DENIED/407 4213
</I>&gt;<i> CONNECT cdn0.vox-cdn.com:443 - HIER_NONE/- text/html
</I>&gt;<i> access.log.2:1437683164.816      0 70.197.241.219 TCP_DENIED/407 4213
</I>&gt;<i> CONNECT cdn0.vox-cdn.com:443 - HIER_NONE/- text/html
</I>&gt;<i> access.log.2:1437683166.464   1590 70.197.241.219 TCP_TUNNEL/200 29114
</I>&gt;<i> CONNECT cdn0.vox-cdn.com:443 proxyid HIER_DIRECT/54.192.120.85 -
</I>&gt;<i> access.log.2:1437683166.464   1590 70.197.241.219 TCP_TUNNEL/200 72579
</I>&gt;<i> CONNECT cdn0.vox-cdn.com:443 proxyid HIER_DIRECT/54.192.120.85 -
</I>&gt;<i> access.log.2:1437683166.464   1582 70.197.241.219 TCP_TUNNEL/200 39476
</I>&gt;<i> CONNECT cdn0.vox-cdn.com:443 proxyid HIER_DIRECT/54.192.120.85 -
</I>&gt;<i> access.log.2:1437683166.464   1583 70.197.241.219 TCP_TUNNEL/200 5909
</I>&gt;<i> CONNECT cdn0.vox-cdn.com:443 proxyid HIER_DIRECT/54.192.120.85 -
</I>&gt;<i> access.log.2:1437683167.244   2354 70.197.241.219 TCP_TUNNEL/200 59238
</I>&gt;<i> CONNECT cdn0.vox-cdn.com:443 proxyid HIER_DIRECT/54.192.120.85 -
</I>&gt;<i> access.log.2:1437683167.244   2362 70.197.241.219 TCP_TUNNEL/200 75369
</I>&gt;<i> CONNECT cdn0.vox-cdn.com:443 proxyid HIER_DIRECT/54.192.120.85 -
</I>
The first obvious thing that stands out to me from this is that these are 
HTTPS connections, not HTTP, so I'm going to let someone more familiar with 
Squid's current handling of HTTPS pass further comment, except for my question 
further down...

&gt;<i> **** CONFIG
</I>&gt;<i> auth_param basic program /usr/lib64/squid/basic_ncsa_auth
</I>&gt;<i> /etc/squid/squid_passwd auth_param basic children 20
</I>&gt;<i> auth_param basic realm Squid proxy-caching web server
</I>&gt;<i> auth_param basic credentialsttl 8 hours
</I>&gt;<i> auth_param basic casesensitive on
</I>&gt;<i> 
</I>&gt;<i> acl whitelist1 dstdomain pipergo.pjc.com .apple.com .yahoo.com .wp.com
</I>&gt;<i> acl whitelist2 dstdom_regex (^|\.)*img\.com$
</I>&gt;<i> acl ncsa_users proxy_auth REQUIRED
</I>&gt;<i> 
</I>&gt;<i> http_access allow whitelist1
</I>&gt;<i> http_access allow whitelist2
</I>&gt;<i> http_access allow ncsa_users
</I>&gt;<i> http_access deny all
</I>&gt;<i> 
</I>&gt;<i> cache_mem 4096 MB
</I>&gt;<i> memory_cache_mode always
</I>&gt;<i> refresh_pattern . 1440 100% 525949 ignore-auth
</I>&gt;<i> cache_dir aufs /squid/cache 40000 128 512
</I>&gt;<i> maximum_object_size 200 MB
</I>&gt;<i> maximum_object_size_in_memory 2 MB
</I>&gt;<i> cache_swap_low 90
</I>&gt;<i> cache_swap_high 95
</I>&gt;<i> buffered_logs on
</I>&gt;<i> 
</I>&gt;<i> #
</I>&gt;<i> half_closed_clients off
</I>&gt;<i> memory_pools off
</I>&gt;<i> 
</I>&gt;<i> # DNS-record cache
</I>&gt;<i> ipcache_size 10240
</I>&gt;<i> ipcache_low 90
</I>&gt;<i> ipcache_high 95
</I>&gt;<i> negative_dns_ttl 5 minutes
</I>&gt;<i> 
</I>&gt;<i> # listening port
</I>&gt;<i> http_port 3128
</I>
When the unexpected authentication dialog appears:

1. what page do you see if you fail to authenticate correctly - is it from the 
origin server cdn0.vox-cdn.com (in this case) or is it the page your users 
would see if they failed to correctly authenticate to squid in the first 
place?

2. can you authenticate, and get the expected page from the origin server, by 
using the user's Squid credentials?


Regards,


Antony.

-- 
You can tell that the day just isn't going right when you find yourself using 
the telephone before the toilet.

                                                   Please reply to the list;
                                                         please *don't* CC me.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004812.html">[squid-users] random forward proxy authentication pop-up
</A></li>
	<LI>Next message (by thread): <A HREF="004815.html">[squid-users] random forward proxy authentication pop-up
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4814">[ date ]</a>
              <a href="thread.html#4814">[ thread ]</a>
              <a href="subject.html#4814">[ subject ]</a>
              <a href="author.html#4814">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
