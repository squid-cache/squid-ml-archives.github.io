<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Possible bug in 3.5.5 or a store change from 2.7?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Possible%20bug%20in%203.5.5%20or%20a%20store%20change%20from%202.7%3F&In-Reply-To=%3CCAEaSS0ZZiqyGzSoX_mysk%3D-VRq5aagbokni7cvPSF6VYxWfjEg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004827.html">
   <LINK REL="Next"  HREF="004833.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Possible bug in 3.5.5 or a store change from 2.7?</H1>
    <B>Tory M Blue</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Possible%20bug%20in%203.5.5%20or%20a%20store%20change%20from%202.7%3F&In-Reply-To=%3CCAEaSS0ZZiqyGzSoX_mysk%3D-VRq5aagbokni7cvPSF6VYxWfjEg%40mail.gmail.com%3E"
       TITLE="[squid-users] Possible bug in 3.5.5 or a store change from 2.7?">tmblue at gmail.com
       </A><BR>
    <I>Tue Jul 28 22:43:53 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004827.html">[squid-users] Possible bug in 3.5.5 or a store change from 2.7?
</A></li>
        <LI>Next message (by thread): <A HREF="004833.html">[squid-users] Possible bug in 3.5.5 or a store change from 2.7?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4831">[ date ]</a>
              <a href="thread.html#4831">[ thread ]</a>
              <a href="subject.html#4831">[ subject ]</a>
              <a href="author.html#4831">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Jul 28, 2015 at 12:54 PM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
wrote:

&gt;<i> On 29/07/2015 5:53 a.m., Tory M Blue wrote:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;  I just reproduced this by hand, using an HTTP sniffer tool.  I requested
</I>&gt;<i> &gt; the same URL twice, with about a 0.25 second delay between fetches, and
</I>&gt;<i> the
</I>&gt;<i> &gt; 2nd attempt was ALSO A MISS.  Then I waited 1 second and tried a 3rd
</I>&gt;<i> time,
</I>&gt;<i> &gt; and it was FINALLY a hit.
</I>&gt;<i>
</I>&gt;<i> Had the first request finished being delivered to your testing tool
</I>&gt;<i> before the second request was sent?
</I>&gt;<i>
</I>

Yes our testing is completely sequential meaning the connection has to
complete before we launch another, even by hand.



&gt;<i>
</I>&gt;<i> &gt; Squid v3 seems to have changed the way it stores objects.  Maybe it is
</I>&gt;<i> &gt; doing some sort of &quot;asynchronous&quot; background store now, so if you send in
</I>&gt;<i> &gt; sequential requests without a delay between, it may not actually have
</I>&gt;<i> &gt; finished storing it yet, so it doesn't report a &quot;hit&quot;.  Meaning, the
</I>&gt;<i> first
</I>&gt;<i> &gt; &quot;miss&quot; response may have fired off a thread to store the object, and not
</I>&gt;<i> &gt; doing it in the main thread anymore like in v2, if you get my meaning.
</I>&gt;<i>
</I>&gt;<i> Squid-3 in-transit objects are not listed as existing in cache_mem
</I>&gt;<i> storage until they have completely (and successfully) finished their
</I>&gt;<i> first use.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> You can configure &quot;collapsed_forwarding on&quot; to enable the Squid-2.7
</I>&gt;<i> behaviour. Treating the in-transit objects list as if it were another
</I>&gt;<i> cache area.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The document cite this is quite a bit different and not something I want
</I>to embark upon.

&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Timing between *completion* of the first request and starting of the
</I>&gt;<i> second is the critical. If the first request has not finished, theres no
</I>&gt;<i> hope of a HIT.
</I>&gt;<i>
</I>&gt;<i> Also size of memory cache relative to the churn currently going on also
</I>&gt;<i> matters. If you wait too long between the test requests it will be
</I>&gt;<i> pushed out and get a MISS again anyway. But I dont think that is a
</I>&gt;<i> factor with 250ms being your timing.
</I>&gt;<i>
</I>

Again completely synchronous, something is not happening as it should under
a busy condition, we tested this as far out as 5 seconds and still got a
miss.  We have added &quot;5&quot; retries to our monitor, but I do think something
is  a miss (no pun intended).  Single client hitting a single server in a
synchronous manner, should allow for a pretty quick cache hit, but it's
not.

my high/low water marks are so

cache_swap_high 90

cache_swap_low 80


My space available is so

Filesystem            Size  Used Avail Use% Mounted on

/dev/ram0              17G   14G  2.3G  86% /cache01

Any other data I could grab from the stats that would help. I do believe
something is not quite right but we have ways to get around it for now,


Thanks Amons

Tory
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150728/7e12c474/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150728/7e12c474/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004827.html">[squid-users] Possible bug in 3.5.5 or a store change from 2.7?
</A></li>
	<LI>Next message (by thread): <A HREF="004833.html">[squid-users] Possible bug in 3.5.5 or a store change from 2.7?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4831">[ date ]</a>
              <a href="thread.html#4831">[ thread ]</a>
              <a href="subject.html#4831">[ subject ]</a>
              <a href="author.html#4831">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
