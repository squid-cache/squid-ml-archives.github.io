<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] dns failover failing with 3.4.7
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20dns%20failover%20failing%20with%203.4.7&In-Reply-To=%3C55BA475A.1070004%40afo.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004822.html">
   <LINK REL="Next"  HREF="004864.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] dns failover failing with 3.4.7</H1>
    <B>Mike</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20dns%20failover%20failing%20with%203.4.7&In-Reply-To=%3C55BA475A.1070004%40afo.net%3E"
       TITLE="[squid-users] dns failover failing with 3.4.7">mcsnv96 at afo.net
       </A><BR>
    <I>Thu Jul 30 15:48:42 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004822.html">[squid-users] dns failover failing with 3.4.7
</A></li>
        <LI>Next message (by thread): <A HREF="004864.html">[squid-users] dns failover failing with 3.4.7
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4860">[ date ]</a>
              <a href="thread.html#4860">[ thread ]</a>
              <a href="subject.html#4860">[ subject ]</a>
              <a href="author.html#4860">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 7/27/2015 17:25 PM, Amos Jeffries wrote:
&gt;<i> On 28/07/2015 8:38 a.m., Mike wrote:
</I>&gt;&gt;<i> Running into an issue, using the squid.conf entry
</I>&gt;&gt;<i> dns_nameservers 72.x.x.x 72.x.y.y
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> These are different servers (under our control) for the purpose of
</I>&gt;&gt;<i> filtering than listed in resolv.conf (which are out of our control, used
</I>&gt;&gt;<i> for server IP routing by upstream host).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The problem we found like this weekend is if the primary listed dns
</I>&gt;&gt;<i> server is unavailable, squid fails to use the secondary listed server.
</I>&gt;&gt;<i> Instead it displays the &quot;unable to connect&quot; type messages with all
</I>&gt;&gt;<i> websites.
</I>&gt;<i> Details please. How do you know the secondary is not even being tried?
</I>&gt;<i>
</I>&gt;<i> What is Squid getting back from the primary when its &quot;down&quot; ?
</I>&gt;<i>   or just dns_timeout being hit?
</I>&gt;<i>
</I>&gt;<i> Add this to squid.conf to get a cache.log trace of the DNS activity:
</I>&gt;<i>    debug_options 78,6
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>Amos,

If it was using the secondary server listed, connections to almost all 
websites would not be failing to load if primary was down. For the test 
we temporarily took the primary DNS server offline (per the example 
above 72.x.x.x), and no websites would load unless it was in the squid 
cache, but any elements that required additional data failed to load 
causing formatting issues with the displayed website. If we swap the 
setting to the &quot;secondary&quot; with the first IP (per the example above) as
dns_nameservers 72.x.y.y 72.x.x.x
and it works the same way, take the &quot;.y.y&quot; down and it refuses to use 
the secondary listed IP &quot;.x.x&quot; for DNS, instead displays the website 
could not be displayed error in the browsers. We even tried another test 
(per the example above) dns_nameservers 72.x.x.x 8.8.8.8 then let it run 
for an hour or so. Then we took down the primary which means it should 
use the secondary google IP of 8.8.8.8, but it doesn't, goes right back 
to the &quot;website could not be displayed&quot; error in the browsers.
I was wonder if this might be a bug. This is happening on multiple 
servers, one has squid 3.4.7, another has 3.4.6 and problem occurs on both.

Thanks
Mike





</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004822.html">[squid-users] dns failover failing with 3.4.7
</A></li>
	<LI>Next message (by thread): <A HREF="004864.html">[squid-users] dns failover failing with 3.4.7
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4860">[ date ]</a>
              <a href="thread.html#4860">[ thread ]</a>
              <a href="subject.html#4860">[ subject ]</a>
              <a href="author.html#4860">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
