<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid centos and osq_lock
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20centos%20and%20osq_lock&In-Reply-To=%3CCAAg-RYsmVXi%2BKb%2BrSBvDzyVW-cmH2_EhbMbXCf0Gb1KwxoOg0w%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004857.html">
   <LINK REL="Next"  HREF="004867.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid centos and osq_lock</H1>
    <B>Josip Makarevic</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20centos%20and%20osq_lock&In-Reply-To=%3CCAAg-RYsmVXi%2BKb%2BrSBvDzyVW-cmH2_EhbMbXCf0Gb1KwxoOg0w%40mail.gmail.com%3E"
       TITLE="[squid-users] squid centos and osq_lock">jmakarevic at gmail.com
       </A><BR>
    <I>Thu Jul 30 20:05:35 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004857.html">[squid-users] Squid 3.4.14
</A></li>
        <LI>Next message (by thread): <A HREF="004867.html">[squid-users] squid centos and osq_lock
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4861">[ date ]</a>
              <a href="thread.html#4861">[ thread ]</a>
              <a href="subject.html#4861">[ subject ]</a>
              <a href="author.html#4861">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I have a problem with squid setup (squid version 3.5.6, built from source,
centos 6.6)
I've tried 2 options:
1. SMP
2. NON-SMP

I've decided to stick with custom build non-smp version and the thing is:
- i don't need cache - any kind of it
- I have DNS cache just for that
- squid has to listen on 1024 ports on 23 instances.
each instance listens on set of ports and each port has different outgoing
ip address.

The thing is this:
It's alll good until we hit it with more than 150mbits then...

(output from perf top)
 84.57%  [kernel]                  [k] osq_lock
  4.62%  [kernel]                  [k] mutex_spin_on_owner
  1.41%  [kernel]                  [k] memcpy
  0.79%  [kernel]                  [k] inet_dump_ifaddr
  0.62%  [kernel]                  [k] memset

 21:53:39 up 7 days, 10:38,  1 user,  load average: 24.01, 23.84, 23.33
(yes, we have 24 cores)
Same behavior is with SMP and NON-SMP setup (SMP setup is all in one file
with workers 23 option but then I have to use rock cache)

so, my question is....what...how to optimize this.....whatever....I'm stuck
for days, I've tried many sysctl options but none of them works.
Any help, info, something else?


Thanks,
J.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150730/5589247f/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150730/5589247f/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004857.html">[squid-users] Squid 3.4.14
</A></li>
	<LI>Next message (by thread): <A HREF="004867.html">[squid-users] squid centos and osq_lock
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4861">[ date ]</a>
              <a href="thread.html#4861">[ thread ]</a>
              <a href="subject.html#4861">[ subject ]</a>
              <a href="author.html#4861">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
