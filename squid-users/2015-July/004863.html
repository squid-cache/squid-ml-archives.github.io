<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] LDAP Auth re-prompting for credentials on browser close, need suggestions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20LDAP%20Auth%20re-prompting%20for%20credentials%20on%20browser%0A%20close%2C%20need%20suggestions&In-Reply-To=%3C55BA9573.90702%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004859.html">
   <LINK REL="Next"  HREF="004846.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] LDAP Auth re-prompting for credentials on browser close, need suggestions</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20LDAP%20Auth%20re-prompting%20for%20credentials%20on%20browser%0A%20close%2C%20need%20suggestions&In-Reply-To=%3C55BA9573.90702%40treenet.co.nz%3E"
       TITLE="[squid-users] LDAP Auth re-prompting for credentials on browser close, need suggestions">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Jul 30 21:21:55 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004859.html">[squid-users] LDAP Auth re-prompting for credentials on browser close, need suggestions
</A></li>
        <LI>Next message (by thread): <A HREF="004846.html">[squid-users] Negative value for total memory accounted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4863">[ date ]</a>
              <a href="thread.html#4863">[ thread ]</a>
              <a href="subject.html#4863">[ subject ]</a>
              <a href="author.html#4863">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 31/07/2015 3:36 a.m., Michael Monette wrote:
&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On 7/29/2015 5:20 PM, Amos Jeffries wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Found this post asking the same question:
</I>&gt;&gt;&gt;<i> <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Ldap-Authen-AD-how-to-make-authentication-persistent-td3604487.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Ldap-Authen-AD-how-to-make-authentication-persistent-td3604487.html</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> and it
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> There were two suggestions that stood out:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> There used to be a &quot;authenticate_ip_shortcircuit_ttl&quot; option in squid
</I>&gt;&gt;&gt;<i> 2.7 that when authenticated successfully, it would remember the users
</I>&gt;&gt;&gt;<i> IP for X amount of time and would let you avoid logging in every time
</I>&gt;&gt;&gt;<i> you reopen your browser. They removed that in later versions
</I>&gt;&gt;&gt;<i> unfortunately, I guess because someone could take over your IP and
</I>&gt;&gt;&gt;<i> would be able to authenticate as you(which is not a concern to me, at
</I>&gt;&gt;&gt;<i> all).
</I>&gt;&gt;<i> It should.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Theres this thing called NAT you see, which places multiple users behind
</I>&gt;&gt;<i> a single IP. The first one to login with IP-based auth. Since IPv4 ran
</I>&gt;&gt;<i> out back in 2003 a number of networks have started using one layer.
</I>&gt;&gt;<i> Since 2010 when IPv4 stopped being readily available its become more and
</I>&gt;&gt;<i> more popular to use 2 and even 3 layers of NAT between any two machines.
</I>&gt;&gt;<i> Just so they can talk.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Then there is this thing called DHCP. I guess this is what you mean by
</I>&gt;&gt;<i> one user taking over anothers IP. Since the DHCP service allocates any
</I>&gt;&gt;<i> available IP to user devices on request. If a device goes away its IP
</I>&gt;&gt;<i> can get re-used immediately by another device. Its uite difficult to get
</I>&gt;&gt;<i> Squid to be aware of any of those changes and update its auth
</I>&gt;&gt;<i> information.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Then there is the thing called &quot;privacy addressing&quot;. In IPv6 its
</I>&gt;&gt;<i> built-in, with IPv4 its done using DHCP short dynamic assignments. It
</I>&gt;&gt;<i> means the IP address assigned to user devices is guaranteed to change
</I>&gt;&gt;<i> frequently and randomly.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Now, if your network can operate without NAT or DHCP, or IPv6. You are
</I>&gt;&gt;<i> one of the very rare lucky people for whom IP-shortcut based auth
</I>&gt;&gt;<i> *might* work. But only until you have a malicious user contact the
</I>&gt;&gt;<i> network and start spoofing users IPs.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> IP address based authentication is, well. Dead.
</I>&gt;&gt;<i>
</I>&gt;<i> Okay, well I know how NAT and DHCP works, so I guess I am one of those
</I>&gt;<i> rare cases you talk about.  We have no NATs, I am only trying to use
</I>&gt;<i> squid on a small section of our network which has statically assigned IP
</I>&gt;<i> addresses and they have no admin rights to change it. They are open 24/7
</I>&gt;<i> so some stranger walking in, plugging his laptop on our network and
</I>&gt;<i> trying to figure out which IP is already authenticated is very unlikely
</I>&gt;<i> since everybody knows each other and it noticed/reported. That's why
</I>&gt;<i> this does not concern me. I was also only planning to have it remember
</I>&gt;<i> the IP for maybe 1 hour.
</I>
Yes it would seem you are.

&gt;<i> 
</I>&gt;<i> On the other hand, having users re-authenticate every time they close
</I>&gt;<i> their browser would irritate them and possibly cause confusion as most
</I>&gt;<i> of them are not very technical(It might just be something they will need
</I>&gt;<i> to adjust to after all).
</I>
They will have to face it in every other authentication-related use of
browsers. So thay should not be a problem.

&gt;<i> 
</I>&gt;<i> So in my case, either I figure out a way to go about this (I saw your
</I>&gt;<i> suggestions below and am going to do some reading) or I might have to
</I>&gt;<i> not implement any authentication at all, which I think is worse.
</I>
Yes and no.

The auth system is only a problem if you want user/browser to be the one
supplying credentials. For that Squid has to validate the users claim
about who they are and deal with incorrect/missing claims etc. The pop
is resulting from all that.

If you are happy to avoid user-supplied credentials entirely you can use
an external ACL helper that takes %SRC (the client IP) and provides
Squid with &quot;OK user=username&quot; with the username to log about who is
supposed to be using that machine IP or &quot;ERR&quot; for unauthorized access.

Incidentally that IP-&gt;username mapping exactly what the ip_shortcut 2.7
feature used to do. But without any possible way to control on your part
about what usernames were supplied for which IP.


These two helpers are provided with Squid that do this for different
backend databases of IP-&gt;user mapping:

&lt;<A HREF="http://www.squid-cache.org/Versions/v4/manuals/ext_edirectory_userip_acl.html">http://www.squid-cache.org/Versions/v4/manuals/ext_edirectory_userip_acl.html</A>&gt;

&lt;<A HREF="http://www.squid-cache.org/Versions/v4/manuals/ext_sql_session_acl.html">http://www.squid-cache.org/Versions/v4/manuals/ext_sql_session_acl.html</A>&gt;

The SQL one is what I use for my own clients when they have an office
setup like you describe and a very stable / long term group of trusted
workers.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004859.html">[squid-users] LDAP Auth re-prompting for credentials on browser close, need suggestions
</A></li>
	<LI>Next message (by thread): <A HREF="004846.html">[squid-users] Negative value for total memory accounted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4863">[ date ]</a>
              <a href="thread.html#4863">[ thread ]</a>
              <a href="subject.html#4863">[ subject ]</a>
              <a href="author.html#4863">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
