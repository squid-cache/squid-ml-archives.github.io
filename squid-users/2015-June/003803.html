<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Looking for a recomendation for tutorial for transparent proxy under Ubuntu
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Looking%20for%20a%20recomendation%20for%20tutorial%20for%0A%20transparent%20proxy%20under%20Ubuntu&In-Reply-To=%3C2f76befd10cd632bc907028111f2c81d%40localhost%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003802.html">
   <LINK REL="Next"  HREF="003806.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Looking for a recomendation for tutorial for transparent proxy under Ubuntu</H1>
    <B>James Lay</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Looking%20for%20a%20recomendation%20for%20tutorial%20for%0A%20transparent%20proxy%20under%20Ubuntu&In-Reply-To=%3C2f76befd10cd632bc907028111f2c81d%40localhost%3E"
       TITLE="[squid-users] Looking for a recomendation for tutorial for transparent proxy under Ubuntu">jlay at slave-tothe-box.net
       </A><BR>
    <I>Mon Jun  1 17:09:41 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003802.html">[squid-users] Looking for a recomendation for tutorial for transparent proxy under Ubuntu
</A></li>
        <LI>Next message (by thread): <A HREF="003806.html">[squid-users] Looking for a recomendation for tutorial for transparent proxy under Ubuntu
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3803">[ date ]</a>
              <a href="thread.html#3803">[ thread ]</a>
              <a href="subject.html#3803">[ subject ]</a>
              <a href="author.html#3803">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2015-06-01 10:40 AM, dkandle wrote:
&gt;<i> I am using Ubuntu 14.04 on a server with multiple NICs. I would like to 
</I>&gt;<i> set
</I>&gt;<i> it up as a transparent proxy. I have the router working and I had squid
</I>&gt;<i> working as an explicit proxy (where I set the IP address of the server 
</I>&gt;<i> as
</I>&gt;<i> the proxy in my client's browser).
</I>&gt;<i> Is there a good tutorial which covers this set-up? I've tried setting 
</I>&gt;<i> the
</I>&gt;<i> iptables as some have advised but it has issues.
</I>&gt;<i> It is not at all clear to me how squid will know which interface faces 
</I>&gt;<i> the
</I>&gt;<i> Internet and which faces my client's subnet.
</I>&gt;<i> 
</I>&gt;<i> Thanks
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> --
</I>&gt;<i> View this message in context:
</I>&gt;<i> <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Looking-for-a-recomendation-for-tutorial-for-transparent-proxy-under-Ubuntu-tp4671472.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Looking-for-a-recomendation-for-tutorial-for-transparent-proxy-under-Ubuntu-tp4671472.html</A>
</I>&gt;<i> Sent from the Squid - Users mailing list archive at Nabble.com.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
The official tutorials:

<A HREF="http://wiki.squid-cache.org/ConfigExamples#Interception">http://wiki.squid-cache.org/ConfigExamples#Interception</A>

You'll most likely want:

<A HREF="http://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxDnat">http://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxDnat</A>

Of interest is the lack of interface specification, so here's what I'm 
using on a box that has an internal nic(192.168.1.0/24) and an external 
nic(real world external IP):

$IPTABLES -t nat -A PREROUTING -i eth0 -s 192.168.1.96/28 -p tcp --dport 
80 -j REDIRECT --to-port 3128
$IPTABLES -t nat -A PREROUTING -i eth0 -s 192.168.1.96/28 -p tcp --dport 
443 -j REDIRECT --to-port 3129

This redirects traffic from clients coming in on eth0 to Squid listening 
process on eth0.  If your squid listening process is not on the same 
nic, you'll need to use DNAT instead:

$IPTABLES -t nat -A PREROUTING -i eth0 -s 192.168.1.96/28 -p tcp --dport 
80 -j DNAT --to-destination ip.that.squid.listens.on:3128
$IPTABLES -t nat -A PREROUTING -i eth0 -s 192.168.1.96/28 -p tcp --dport 
443 -j DNAT --to-destination  ip.that.squid.listens.on:3129

Hope that helps.

James

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003802.html">[squid-users] Looking for a recomendation for tutorial for transparent proxy under Ubuntu
</A></li>
	<LI>Next message (by thread): <A HREF="003806.html">[squid-users] Looking for a recomendation for tutorial for transparent proxy under Ubuntu
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3803">[ date ]</a>
              <a href="thread.html#3803">[ thread ]</a>
              <a href="subject.html#3803">[ subject ]</a>
              <a href="author.html#3803">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
