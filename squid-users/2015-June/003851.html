<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ssl_bump and SNI
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ssl_bump%20and%20SNI&In-Reply-To=%3C557027EB.5080307%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003844.html">
   <LINK REL="Next"  HREF="003800.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ssl_bump and SNI</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ssl_bump%20and%20SNI&In-Reply-To=%3C557027EB.5080307%40treenet.co.nz%3E"
       TITLE="[squid-users] ssl_bump and SNI">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Jun  4 10:26:51 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003844.html">[squid-users] ssl_bump and SNI
</A></li>
        <LI>Next message (by thread): <A HREF="003800.html">[squid-users] Squid 2.7, 3.4 and 3.5 Videos/Music/Images/Libraries/CDNs Booster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3851">[ date ]</a>
              <a href="thread.html#3851">[ thread ]</a>
              <a href="subject.html#3851">[ subject ]</a>
              <a href="author.html#3851">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 4/06/2015 6:29 p.m., sp_ wrote:
&gt;<i>  Hello Amos,
</I>&gt;<i> 
</I>&gt;<i> thank you for your reply.
</I>&gt;<i> 
</I>&gt;<i> Let's take for instance this line:
</I>&gt;<i> 
</I>&gt;<i> 192.168.78.31 - - [04/Jun/2015:09:41:22 +0300] &quot;CONNECT 173.194.122.233:443 HTTP/1.1&quot; 200 0 &quot;-&quot; &quot;-&quot; TCP_DENIED:HIER_NONE
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I have dumped the traffic passing through the interface on the router during this request.
</I>&gt;<i> In client hello in Extension &quot;server_name&quot; I can see the domain:
</I>&gt;<i> 
</I>&gt;<i> Server Name: clients4.google.com
</I>
In your packet trace look at the details in the TCP SYN packet *only* to
see what the Squid CONNECT has available.

&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> According to RFC, domain is a must in Client Hello, when SNI is used.
</I>
Yes. But the ClientHello is not part of a TCP SYN packet - which is what
Squid is working with when it does that fake CONNECT message processing.

The TLS packets have explicitly not been read into Squid yet in case
splice, none, or terminate actions are to be done by the ssl_bump step1
rules.


If the bumping is successful there will be other requests from inside
the TLS that get logged with the domain etc.

For now Squid does not log any of the SSL-bumping process itself. There
is an open bug about that now.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003844.html">[squid-users] ssl_bump and SNI
</A></li>
	<LI>Next message (by thread): <A HREF="003800.html">[squid-users] Squid 2.7, 3.4 and 3.5 Videos/Music/Images/Libraries/CDNs Booster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3851">[ date ]</a>
              <a href="thread.html#3851">[ thread ]</a>
              <a href="subject.html#3851">[ subject ]</a>
              <a href="author.html#3851">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
