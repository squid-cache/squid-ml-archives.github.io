<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Error Resolution (TunnelStateData::Connection:: error )
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Error%20Resolution%20%28TunnelStateData%3A%3AConnection%3A%3A%0A%20error%20%29&In-Reply-To=%3C557054EB.4020900%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003863.html">
   <LINK REL="Next"  HREF="004024.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Error Resolution (TunnelStateData::Connection:: error )</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Error%20Resolution%20%28TunnelStateData%3A%3AConnection%3A%3A%0A%20error%20%29&In-Reply-To=%3C557054EB.4020900%40treenet.co.nz%3E"
       TITLE="[squid-users] Error Resolution (TunnelStateData::Connection:: error )">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Jun  4 13:38:51 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003863.html">[squid-users] Error Resolution (TunnelStateData::Connection:: error )
</A></li>
        <LI>Next message (by thread): <A HREF="004024.html">[squid-users] Error Resolution (TunnelStateData::Connection:: error )
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3866">[ date ]</a>
              <a href="thread.html#3866">[ thread ]</a>
              <a href="subject.html#3866">[ subject ]</a>
              <a href="author.html#3866">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 5/06/2015 1:18 a.m., Iruma Keisuke wrote:
&gt;<i> Thank you Amos.
</I>&gt;<i> 
</I>&gt;<i> 2015-06-02 23:07 GMT+09:00, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;:
</I>&gt;&gt;<i> On 2/06/2015 9:15 p.m., Irimajiri keisuke wrote:
</I>&gt;&gt;&gt;<i> Dear all,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I have to build a proxy server by using the squid.
</I>&gt;&gt;&gt;<i> The number of clients is 400 people.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I do not know the cause of the error message that appears in the
</I>&gt;&gt;&gt;<i> cache.log.
</I>&gt;&gt;&gt;<i> In the weekday, I have come up with an error every few hours 8:00 to
</I>&gt;&gt;&gt;<i> 18:00.
</I>&gt;&gt;&gt;<i> Access concentration I look like does not matter.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> [cache.log error message]
</I>&gt;&gt;&gt;<i> 2015/05/11 13:37:24| TunnelStateData::Connection:: error : FD 610:
</I>&gt;&gt;&gt;<i> read/write failure: (110) Connection timed out
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Why I want to know whether this error has occurred.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Yes it has occured. You would not be seeing it otherwise.
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Also, I want to know the impact on the user.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The user who is causing the problem is probably not impacted at all.
</I>&gt;&gt;<i> Every other user sharing the proxy is impacted by the reduction in
</I>&gt;&gt;<i> available network socket, memory and CPU resources.
</I>&gt;&gt;<i>
</I>&gt;<i> It seems to be no abnormality in the state of network sockets and
</I>&gt;<i> memory and CPU.
</I>&gt;<i> Is it safe to ignore this error?
</I>
If you think your service is operating fine. It does mean the proxy has
a lower threshold of tolerance for network congestion than normal.


&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> [squidclient mgr:filedescriptor]
</I>&gt;&gt;&gt;<i> Every five minutes record
</I>&gt;&gt;&gt;<i> extract FD610
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> It looks like an error has occurred in the use to which the terminal
</I>&gt;&gt;&gt;<i> of xxx.xxx.2.115 user.
</I>&gt;&gt;&gt;<i> Is it a problem of communication of the user and the proxy?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Nothing happened on a TCP conection for a long time. It was closed by
</I>&gt;&gt;<i> the networking sub-systems somewhere between Squid and the client.
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> Do error is not out on the web browser?
</I>&gt;<i> Could you detailed information about TCP state and the state of the
</I>&gt;<i> user when an error has occurred.
</I>
It might be, or it might not be. Others before you who noticed the same
messages have a mixed set of reasons found for it. Some was Chrome
browser happy eyeballs algorithm leaking its second connection until it
got dropped by the network TCP stack. Some it was F5 load balancers
breaking. Others it was NAT timeout in users home routers. Some have not
bothered to dig deep so it may be other causes.

All that is certain is that something between Squid and user is closing
the connection while it is in an HTTP idle state.

&gt;<i> 
</I>&gt;&gt;&gt;<i> Active file descriptors:
</I>&gt;&gt;&gt;<i> File Type   Tout Nread  * Nwrite * Remote Address        Description
</I>&gt;&gt;&gt;<i> ---- ------ ---- -------- -------- ---------------------
</I>&gt;&gt;&gt;<i> ------------------------------
</I>&gt;&gt;&gt;<i>  610 Socket  893    39494*   50228  xxx.xxx.xxx.162:443
</I>&gt;&gt;&gt;<i> outlook.office365.com:443       2015/05/11_13:08:29
</I>&gt;&gt;&gt;<i>  610 Socket 86329   45754*  103329  xxx.xxx.6.141:50174   Reading next
</I>&gt;&gt;&gt;<i> request         2015/05/11_13:13:29
</I>&gt;&gt;&gt;<i>  610 Socket 86258    6516*   13975  xxx.xxx.2.115:50820   Reading next
</I>&gt;&gt;&gt;<i> request         2015/05/11_13:18:29
</I>&gt;&gt;&gt;<i>  610 Socket 85958   12472*   34531* xxx.xxx.2.115:50820   Reading next
</I>&gt;&gt;&gt;<i> request         2015/05/11_13:23:29
</I>&gt;&gt;&gt;<i>  610 Socket 85657   12472*   34531* xxx.xxx.2.115:50820   Reading next
</I>&gt;&gt;&gt;<i> request         2015/05/11_13:28:29
</I>&gt;&gt;&gt;<i>  610 Socket 85357   12472*   34531* xxx.xxx.2.115:50820   Reading next
</I>&gt;&gt;&gt;<i> request         2015/05/11_13:33:29
</I>&gt;&gt;&gt;<i>  610 Socket 86336    3652*    8003  xxx.xxx.3.152:50817   Reading next
</I>&gt;&gt;&gt;<i> request         2015/05/11_13:38:29
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> [access.log]
</I>&gt;&gt;&gt;<i> I do not see suspicious error log I tried to extract the address
</I>&gt;&gt;&gt;<i> xxx.xxx.2.115.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Please tell me a good idea toward someone solve.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Please provided additional details:
</I>&gt;&gt;<i>  * Squid version
</I>&gt;&gt;<i>  * Squid configuration
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I suspect you have a quite old verion of Squid. That particular error
</I>&gt;&gt;<i> message does not even exist in the code any more. The current releases
</I>&gt;&gt;<i> display much more TCP details about the connection where the error occured.
</I>&gt;<i> 
</I>&gt;<i> squid version is squid-3.1.10-29.
</I>&gt;<i> This is the latest version that RedHat is delivering.
</I>
Ah, yes RHEL policy of not updating unless explicit bug reports exist
and supporting things for 10 years+ &gt;

You may be interested in the official unofficial packages (accepted by
the Squid Project and community as reasonable packages for use, but not
RHEL official supported).
&lt;<A HREF="http://wiki.squid-cache.org/KnowledgeBase/RedHat">http://wiki.squid-cache.org/KnowledgeBase/RedHat</A>&gt;


&gt;<i> 
</I>&gt;<i> [squid.conf]
</I>&gt;<i> ------------------------------------
</I>&gt;<i> acl manager proto cache_object
</I>&gt;<i> acl localhost src 127.0.0.1/32 ::1
</I>&gt;<i> acl to_localhost dst 127.0.0.0/8 0.0.0.0/32 ::1
</I>&gt;<i> acl localnet src 10.0.0.0/8	# RFC1918 possible internal network
</I>&gt;<i> acl localnet src 172.16.0.0/12	# RFC1918 possible internal network
</I>&gt;<i> acl localnet src 192.168.0.0/16	# RFC1918 possible internal network
</I>&gt;<i> acl localnet src fc00::/7       # RFC 4193 local private network range
</I>&gt;<i> acl localnet src fe80::/10      # RFC 4291 link-local (directly
</I>&gt;<i> plugged) machines
</I>&gt;<i> acl SSL_ports port 443
</I>&gt;<i> acl Safe_ports port 80		# http
</I>&gt;<i> acl Safe_ports port 21		# ftp
</I>&gt;<i> acl Safe_ports port 443		# https
</I>&gt;<i> acl Safe_ports port 70		# gopher
</I>&gt;<i> acl Safe_ports port 210		# wais
</I>&gt;<i> acl Safe_ports port 1025-65535	# unregistered ports
</I>&gt;<i> acl Safe_ports port 280		# http-mgmt
</I>&gt;<i> acl Safe_ports port 488		# gss-http
</I>&gt;<i> acl Safe_ports port 591		# filemaker
</I>&gt;<i> acl Safe_ports port 777		# multiling http
</I>&gt;<i> acl CONNECT method CONNECT
</I>&gt;<i> http_access allow manager localhost
</I>&gt;<i> http_access deny !Safe_ports
</I>&gt;<i> http_access deny CONNECT !SSL_ports
</I>&gt;<i> http_access allow all
</I>
!!!! Open proxy !!!


&gt;<i> http_port 192.168.1.1:8080
</I>&gt;<i> hierarchy_stoplist cgi-bin ?
</I>&gt;<i> coredump_dir /var/spool/squid
</I>&gt;<i> refresh_pattern ^ftp:		1440	20%	10080
</I>&gt;<i> refresh_pattern ^gopher:	1440	0%	1440
</I>&gt;<i> refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
</I>&gt;<i> refresh_pattern .		0	20%	4320
</I>&gt;<i> 
</I>&gt;<i> cache_mem 2048 MB
</I>&gt;<i> cache_store_log none
</I>&gt;<i> visible_hostname unknown
</I>&gt;<i> request_header_access X-FORWARDED-FOR deny all
</I>&gt;<i> request_header_access Via deny all
</I>&gt;<i> max_filedesc 10240
</I>&gt;<i> ipcache_size 10240
</I>&gt;<i> -----------------------------------------------
</I>&gt;<i> 
</I>&gt;<i> Please let me ask further questions
</I>&gt;<i> Are these has to do with the error?
</I>&gt;<i> <A HREF="http://www.squid-cache.org/Doc/code/tunnel_8cc_source.html">http://www.squid-cache.org/Doc/code/tunnel_8cc_source.html</A>
</I>&gt;<i> 
</I>&gt;<i> 472 TunnelStateData::Connection::error(int const xerrno)
</I>&gt;<i> 473 {
</I>&gt;<i> 474  /* XXX fixme xstrerror and xerrno... */
</I>&gt;<i> 475  errno = xerrno;
</I>&gt;<i> 476
</I>&gt;<i> 477  debugs(50, debugLevelForError(xerrno), HERE &lt;&lt; conn &lt;&lt; &quot;:
</I>&gt;<i> read/write failure: &quot; &lt;&lt; xstrerror());
</I>&gt;<i> 478
</I>&gt;<i> 479  if (!ignoreErrno(xerrno))
</I>&gt;<i> 480  conn-&gt;close();
</I>&gt;<i> 481 }
</I>&gt;<i> 
</I>&gt;<i> 536  /* Bump the dest connection read timeout on any activity */
</I>&gt;<i> 537  /* see Bug 3659: tunnels can be weird, with very long one-way transfers */
</I>&gt;<i> 538  if (Comm::IsConnOpen(to.conn)) {
</I>&gt;<i> 539  AsyncCall::Pointer timeoutCall = commCbCall(5, 4, &quot;tunnelTimeout&quot;,
</I>&gt;<i> 540  CommTimeoutCbPtrFun(tunnelTimeout, this));
</I>&gt;<i> 541  commSetConnTimeout(to.conn, Config.Timeout.read, timeoutCall);
</I>&gt;<i> 542  }
</I>&gt;<i> 543
</I>&gt;<i> 
</I>
Possibly, but predates all that codes existence.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003863.html">[squid-users] Error Resolution (TunnelStateData::Connection:: error )
</A></li>
	<LI>Next message (by thread): <A HREF="004024.html">[squid-users] Error Resolution (TunnelStateData::Connection:: error )
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3866">[ date ]</a>
              <a href="thread.html#3866">[ thread ]</a>
              <a href="subject.html#3866">[ subject ]</a>
              <a href="author.html#3866">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
