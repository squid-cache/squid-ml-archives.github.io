<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ssl_crtd breaks after short time
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ssl_crtd%20breaks%20after%20short%20time&In-Reply-To=%3C55707011.7070003%40vsen.dk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003876.html">
   <LINK REL="Next"  HREF="003881.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ssl_crtd breaks after short time</H1>
    <B>Klavs Klavsen</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ssl_crtd%20breaks%20after%20short%20time&In-Reply-To=%3C55707011.7070003%40vsen.dk%3E"
       TITLE="[squid-users] ssl_crtd breaks after short time">kl at vsen.dk
       </A><BR>
    <I>Thu Jun  4 15:34:41 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003876.html">[squid-users] ssl_crtd breaks after short time
</A></li>
        <LI>Next message (by thread): <A HREF="003881.html">[squid-users] ssl_crtd breaks after short time
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3878">[ date ]</a>
              <a href="thread.html#3878">[ thread ]</a>
              <a href="subject.html#3878">[ subject ]</a>
              <a href="author.html#3878">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I would be perfectly fine with allowing the SSL bumping to finish for
ALL https sites - and then only block when the http request comes..

I'm hoping someone can tell me what I've done wrong in my config.. I'm
obviously not understanding how it works when https is envolved.. it
works as intended with http..

Klavs Klavsen wrote on 2015-06-04 16:50:
&gt;<i> Amos Jeffries wrote on 06/04/2015 04:19 PM:
</I>&gt;&gt;<i> On 5/06/2015 1:45 a.m., Klavs Klavsen wrote:
</I>&gt;&gt;&gt;<i> after moving it here:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> http_access allow okweb-urls testsrv1
</I>&gt;&gt;&gt;<i> http_access allow CONNECT bumpedPorts
</I>&gt;&gt;&gt;<i> http_access deny all
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> it still allows everything..
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Sigh. Sorry I must be half aslep right now.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Your rules say:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    allow ...
</I>&gt;&gt;<i>    allow ...
</I>&gt;&gt;<i>    allow ...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So why would anything be denied?
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> last line says: deny all
</I>&gt;<i> 
</I>&gt;<i> and it works for http urls.. it denies the websites not listed in
</I>&gt;<i> testurls for testsrv1.
</I>&gt;<i> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Secondly, the log line you pointed out was for peek operation. URL (for
</I>&gt;&gt;<i> url_regex ACLs to match) is not known or available until bumping
</I>&gt;&gt;<i> (specifically the full &quot;bump&quot; action) has been completed.
</I>&gt;&gt;<i>
</I>&gt;<i> but the &quot;allow CONNECT&quot; line, seems to make it skip the
</I>&gt;<i> http_access deny all
</I>&gt;<i> 
</I>&gt;<i> at the bottom.. (and not parse the allows in between which should be the
</I>&gt;<i> ones allowing certain websites on https as well..
</I>&gt;<i> 
</I>&gt;<i> do I need to change:
</I>&gt;<i> ssl_bump bump all
</I>&gt;<i> 
</I>&gt;<i> to list every https site
</I>&gt;<i> acl ok-httpsurls url_regex ^<A HREF="https://www.google.dk/$">https://www.google.dk/$</A>
</I>&gt;<i> ssl_bump bump ok-httpsurls
</I>&gt;<i> ssl_bump reject !ok-httpsurls
</I>&gt;<i> 
</I>&gt;<i> (so I an only use http_access for http intercept and must use ssl_bump
</I>&gt;<i> for https urls) ?
</I>&gt;<i> 
</I>&gt;<i> 
</I>

-- 
Regards,
Klavs Klavsen, GSEC - <A HREF="https://lists.squid-cache.org/listinfo/squid-users">kl at vsen.dk</A> - <A HREF="http://www.vsen.dk">http://www.vsen.dk</A> - Tlf. 61281200

&quot;Those who do not understand Unix are condemned to reinvent it, poorly.&quot;
  --Henry Spencer


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003876.html">[squid-users] ssl_crtd breaks after short time
</A></li>
	<LI>Next message (by thread): <A HREF="003881.html">[squid-users] ssl_crtd breaks after short time
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3878">[ date ]</a>
              <a href="thread.html#3878">[ thread ]</a>
              <a href="subject.html#3878">[ subject ]</a>
              <a href="author.html#3878">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
