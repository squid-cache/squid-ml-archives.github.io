<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Traffic redirection to squid socket
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Traffic%20redirection%20to%20squid%20socket&In-Reply-To=%3C5571F6F0.9060608%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003889.html">
   <LINK REL="Next"  HREF="003890.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Traffic redirection to squid socket</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Traffic%20redirection%20to%20squid%20socket&In-Reply-To=%3C5571F6F0.9060608%40treenet.co.nz%3E"
       TITLE="[squid-users] Traffic redirection to squid socket">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Jun  5 19:22:24 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003889.html">[squid-users] Traffic redirection to squid socket
</A></li>
        <LI>Next message (by thread): <A HREF="003890.html">[squid-users] Help with squid 4.5. on centos 6.6. filter Https
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3892">[ date ]</a>
              <a href="thread.html#3892">[ thread ]</a>
              <a href="subject.html#3892">[ subject ]</a>
              <a href="author.html#3892">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 6/06/2015 12:03 a.m., Edx gmail wrote:
&gt;<i> Hi,
</I>&gt;<i> I am using squid on Openwrt(chaos calmer) and want to redirect all requests for 
</I>&gt;<i> port 80 to 3128 port of squid  so that i can filter the traffic there on squid 
</I>&gt;<i> box. I am using wpad for auto proxy and want non-proxy user's traffic for port 
</I>&gt;<i> 80 to go to squid socket which is in my case 192.168.1.1:3128
</I>&gt;<i> 
</I>&gt;<i> I have included
</I>&gt;<i> &quot;http_port 3128 intercept&quot; in squid.conf
</I>&gt;<i> and also made rule in firewall
</I>&gt;<i> config redirect
</I>&gt;<i>          option src 'lan'
</I>&gt;<i>          option src_dport '80'
</I>&gt;<i>          option src_ip '!192.168.1.1'
</I>&gt;<i>          option dest 'wan'
</I>&gt;<i>          option dest_port '3128'
</I>&gt;<i>          option dest_ip '192.168.1.1'
</I>&gt;<i>          option proto 'tcp'
</I>&gt;<i>          option target 'DNAT'
</I>&gt;<i> 
</I>&gt;<i> Using the above configuration i am able to full fill my purpose but if do so 
</I>&gt;<i> then users with auto proxy in their browers &#8206;can't access internet at all while 
</I>&gt;<i> in access.log it shows everything perfect.
</I>

You SHOULD NOT use port 3128 for receiving intercepted port 80 HTTP
origin traffic. It is registered officially for HTTP proxy traffic and
you cant mix the two traffic types.

Select a non-3128 port of your choice for Squid to listen for the
intercepted traffic. That will also allow easy firewalling without
showing port scanners that Squid is using it.
 &lt;<A HREF="http://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxDnat">http://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxDnat</A>&gt;

Also, note that the NAT operations MUST be done on the Squid machine.
Squid requires internal access to the kernel NAT sytsem records to
intercept safely, you cant do that across machines.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003889.html">[squid-users] Traffic redirection to squid socket
</A></li>
	<LI>Next message (by thread): <A HREF="003890.html">[squid-users] Help with squid 4.5. on centos 6.6. filter Https
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3892">[ date ]</a>
              <a href="thread.html#3892">[ thread ]</a>
              <a href="subject.html#3892">[ subject ]</a>
              <a href="author.html#3892">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
