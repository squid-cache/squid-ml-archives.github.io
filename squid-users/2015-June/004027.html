<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Error Resolution (TunnelStateData::Connection:: error )
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Error%20Resolution%20%28TunnelStateData%3A%3AConnection%3A%3A%0A%20error%20%29&In-Reply-To=%3C557AA9F9.8000008%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004024.html">
   <LINK REL="Next"  HREF="003814.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Error Resolution (TunnelStateData::Connection:: error )</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Error%20Resolution%20%28TunnelStateData%3A%3AConnection%3A%3A%0A%20error%20%29&In-Reply-To=%3C557AA9F9.8000008%40treenet.co.nz%3E"
       TITLE="[squid-users] Error Resolution (TunnelStateData::Connection:: error )">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Jun 12 09:44:25 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004024.html">[squid-users] Error Resolution (TunnelStateData::Connection:: error )
</A></li>
        <LI>Next message (by thread): <A HREF="003814.html">[squid-users] Transparent Squid Proxy Server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4027">[ date ]</a>
              <a href="thread.html#4027">[ thread ]</a>
              <a href="subject.html#4027">[ subject ]</a>
              <a href="author.html#4027">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12/06/2015 5:39 p.m., Iruma Keisuke wrote:
&gt;<i> Thank you Amos.
</I>&gt;<i> I really appreciate your response.
</I>&gt;<i> 
</I>&gt;<i> We analyzed the trend of FD an error has occurred.
</I>&gt;<i> 
</I>&gt;<i> 2015/06/01_08:52:35 nsu01pint-int01 [cache]2015/06/01 08:52:32|
</I>&gt;<i> TunnelStateData::Connection:: error : FD 81: read/write failure: (110)
</I>&gt;<i> Connection timed out
</I>&gt;<i> Active file descriptors:
</I>&gt;<i>  File Type   Tout Nread  * Nwrite * Remote Address        Description
</I>&gt;<i>   ---- ------ ---- -------- -------- ---------------------
</I>&gt;<i> --------------------- ---------
</I>&gt;<i>    81 Socket 86282    8100*   67977  XXX.XXXX.2.136:49907   Reading
</I>&gt;<i> next request Date: Sun, 31 May 2015 23:32:30 GMT
</I>&gt;<i>    81 Socket 86302    8100*   16753  XXX.XXXX.2.136:49944   Reading
</I>&gt;<i> next request Date: Sun, 31 May 2015 23:37:30 GMT
</I>&gt;<i>    81 Socket 86002    8100*   17395* XXX.XXXX.2.136:49944   Reading
</I>&gt;<i> next request Date: Sun, 31 May 2015 23:42:30 GMT
</I>&gt;<i>    81 Socket 85702    8100*   17395* XXX.XXXX.2.136:49944   Reading
</I>&gt;<i> next request Date: Sun, 31 May 2015 23:47:30 GMT
</I>&gt;<i>    81 Socket 85402    8100*   17395* XXX.XXXX.2.136:49944   Reading
</I>&gt;<i> next request Date: Sun, 31 May 2015 23:52:30 GMT
</I>&gt;<i>    81 Socket 86354   56810*   40697  XXX.XXXX.6.114:49687   Reading
</I>&gt;<i> next request Date: Sun, 31 May 2015 23:57:30 GMT
</I>&gt;<i>                                  &#8593;
</I>&gt;<i>                          Error while writing ?
</I>&gt;<i> 
</I>&gt;<i> All it seems to have time out in writing.
</I>&gt;<i> And, the time until the timeout is between 10 to 15 minutes.
</I>&gt;<i> 
</I>&gt;<i> Are &quot;Write_timeout&quot; and &quot;read_timeout&quot; directive related to the error?
</I>&gt;<i> &quot;write_timeout&quot; is a directive that does not exist in the 3.1 version.
</I>&gt;<i> Though &quot;write_timeout&quot; can not be set, it works and cause a timeout in
</I>&gt;<i> 15 minutes?
</I>
There is no write timeout, things either write immediately or as soon as
space on the network pipe becomes available. The processing Job waiting
for the write to finish can timeout, but that is completely different
from sockets layer.

It might be read_timeout, but IIRC that is internal and Squid uses
close() on the socket to send the signal to the other end. Not try to
read() and fail.


&gt;<i> 
</I>&gt;<i> I think this is also a relationship.
</I>&gt;<i> <A HREF="http://www.squid-cache.org/Doc/config/half_closed_clients/">http://www.squid-cache.org/Doc/config/half_closed_clients/</A>
</I>&gt;&gt;<i> Squid can not tell the difference between a half-closed connection, and a fully closed one.
</I>&gt;<i> 3.1 version &quot;half_closed_clients&quot; is off by default.
</I>&gt;<i> 
</I>&gt;<i> I have this kind of guess.
</I>&gt;<i> 
</I>&gt;<i> 1. Change the client to &quot;half_closed&quot;.
</I>&gt;<i> 2. squid write to FD.
</I>&gt;<i> 3. Change the client to &quot;fully_losed&quot;.
</I>&gt;<i> 4. Since the &quot;fully_losed&quot; squid can not understand, squid attempts to
</I>&gt;<i> write to the FD.
</I>&gt;<i> 5. After 15 minutes, &quot;write_timeout&quot; occurs in squid
</I>&gt;<i> 
</I>&gt;<i> Can I get your opinion?
</I>
Squid does understand fully closed (the state, no directive). If the
socket/FD were fully closed it would be a &quot;read/write error connection
closed&quot; message in the log.

In the world of sockets a close event by the remote end shows up as a
signal requesting a read(), when that read() is performed an error is
returned which explains what happened. I think this is what you are
seeing (eg &quot;connection timed out&quot; happend).
 Why/how its let to get into that state is unclear and may be related to
a bug somewhere. But still unknown whether that place would be Squid,
client or server.

Timeout signalled by the TCP stack is possible and normal, though not
exactly common. As you saw it takes a while and usually connections get
closed when finished with instead of left waiting for a long time like
that, so you dont see this.
 The exception is CONNECT tunnels (TunnelStateData) - Squid is not aware
of the protocol inside so must keep them open until the very last bytes
is passed and either the remote end or the client requesting it goes away.


PS. Eliezer packages current versions of Squid unofficially for RHEL.
You may want to try upgrading to that. It is not supported by RHEL, but
by Eliezer and us here. If you want to continue with the RHEL package
then I suggest its best to get in touch with them about problems (if
this is one).

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004024.html">[squid-users] Error Resolution (TunnelStateData::Connection:: error )
</A></li>
	<LI>Next message (by thread): <A HREF="003814.html">[squid-users] Transparent Squid Proxy Server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4027">[ date ]</a>
              <a href="thread.html#4027">[ thread ]</a>
              <a href="subject.html#4027">[ subject ]</a>
              <a href="author.html#4027">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
