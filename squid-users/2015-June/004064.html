<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] no fallback to ipv4 if ipv6 remote address is	non-functional
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20no%20fallback%20to%20ipv4%20if%20ipv6%20remote%20address%20is%0A%09non-functional&In-Reply-To=%3C1434409940.32027.102.camel%40interlinx.bc.ca%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004055.html">
   <LINK REL="Next"  HREF="004070.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] no fallback to ipv4 if ipv6 remote address is	non-functional</H1>
    <B>Brian J. Murrell</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20no%20fallback%20to%20ipv4%20if%20ipv6%20remote%20address%20is%0A%09non-functional&In-Reply-To=%3C1434409940.32027.102.camel%40interlinx.bc.ca%3E"
       TITLE="[squid-users] no fallback to ipv4 if ipv6 remote address is	non-functional">brian at interlinx.bc.ca
       </A><BR>
    <I>Mon Jun 15 23:12:20 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004055.html">[squid-users] no fallback to ipv4 if ipv6 remote address is	non-functional
</A></li>
        <LI>Next message (by thread): <A HREF="004070.html">[squid-users] no fallback to ipv4 if ipv6 remote address is	non-functional
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4064">[ date ]</a>
              <a href="thread.html#4064">[ thread ]</a>
              <a href="subject.html#4064">[ subject ]</a>
              <a href="author.html#4064">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 2015-06-15 at 06:47 +1200, Amos Jeffries wrote:
&gt;<i> 
</I>&gt;<i> 1)
</I>&gt;<i> I have confirmed my suspicion that your IPv6 routing is a bit broken.
</I>
I'm not sure I agree with you entirely on that (more below)...

&gt;<i> The IPv6 address is in a private IP range fc00::/7.
</I>
Oh damn.  It's a ULA address.  I did not even recognize that.  The IPv6
addressing space is still foreign enough to me that I don't immediately
recognize what bits of the space certain addresses are in, unlike my
instant recognition of IPv4 private IP space.

&gt;<i> Which is the IPv6
</I>&gt;<i> equivalent of RFC1918 10.0.0.0/8 or 182.168.0.0/16.
</I>
s/182/192/, but yes, indeed.  I see that now.

&gt;<i> When your Squid
</I>&gt;<i> contacts it nothing at all happens within 10 seconds.
</I>
Unsurprisingly, of course.

&gt;<i> What should be happening is that when Squid tries to contact a network
</I>&gt;<i> range which is not your own LAN fd31:aeb1:48df::/48 sub-net.
</I>
It should forward it to the Squid machine's default router.

&gt;<i> The routing
</I>&gt;<i> system in your Squid machine responds with a &quot;network unavailable&quot;
</I>&gt;<i> within nanoseconds.
</I>
I disagree.  While I will agree that it is good network management
practice to not allow RFC-1918 and IPv6's corresponding ULA addresses to
leak outside of your network, AFAIK, it's not a requirement.  RFC 4193
4.3 makes it a recommendation (&quot;should&quot;) rather than a requirement
(&quot;MUST&quot;).

This is really no different than RFC-1918 addresses, which were not
always designated for their current practice and only since that
designation are also only recommended against blocking at the site
router.

&gt;<i> This signal which is not appearing is what Squid
</I>&gt;<i> depends on to to do the failover.
</I>
(As you point out below, so I think we are in agreement) I would think
that a simple timeout to connect should be just as sufficient, just like
any other piece of software, such as telnet for example.  I would think
no software should really rely on the behaviors of (only) recommended
practices.

&gt;<i> Do you have an entry in the routing table for fc00::/7 or /8 ?
</I>
No.

&gt;<i> 2)
</I>&gt;<i> Squid should still be attemoting the IPv4 address though.
</I>
Agreed.

&gt;<i> I also see you have Squid-3.4.3. Can you try an upgrade to 3.5.5 ?
</I>
OK.  Built and installed.

Still doesn't seem to be working.

&gt;<i> If the problem persists after that upgrade. Please redo with 26,5 in the
</I>&gt;<i> debug list.
</I>
Sent to your e-mail.

&gt;<i> Also, check your proxy connect_timeout is shorter than forward_timeout.
</I>
#Default:
# forward_timeout 4 minutes

So seems it is.

&gt;<i> The connect timout affects these individual connections, forward_timeout
</I>&gt;<i> needs to allow mulitiple (25?) of them for failover to have a chance in
</I>&gt;<i> lost packet situations like this.
</I>
Interestingly enough, my override of the default of connect_timeout to
10 seconds actually makes it as close to 25 times less than
forward_timeout as I could reasonably get.  :-)

b.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: This is a digitally signed message part
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150615/62a30f29/attachment.sig">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150615/62a30f29/attachment.sig</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004055.html">[squid-users] no fallback to ipv4 if ipv6 remote address is	non-functional
</A></li>
	<LI>Next message (by thread): <A HREF="004070.html">[squid-users] no fallback to ipv4 if ipv6 remote address is	non-functional
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4064">[ date ]</a>
              <a href="thread.html#4064">[ thread ]</a>
              <a href="subject.html#4064">[ subject ]</a>
              <a href="author.html#4064">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
