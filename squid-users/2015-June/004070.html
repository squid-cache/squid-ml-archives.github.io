<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] no fallback to ipv4 if ipv6 remote address is	non-functional
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20no%20fallback%20to%20ipv4%20if%20ipv6%20remote%20address%20is%0A%09non-functional&In-Reply-To=%3C557F8A2E.3060505%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004064.html">
   <LINK REL="Next"  HREF="004033.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] no fallback to ipv4 if ipv6 remote address is	non-functional</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20no%20fallback%20to%20ipv4%20if%20ipv6%20remote%20address%20is%0A%09non-functional&In-Reply-To=%3C557F8A2E.3060505%40treenet.co.nz%3E"
       TITLE="[squid-users] no fallback to ipv4 if ipv6 remote address is	non-functional">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Jun 16 02:30:06 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004064.html">[squid-users] no fallback to ipv4 if ipv6 remote address is	non-functional
</A></li>
        <LI>Next message (by thread): <A HREF="004033.html">[squid-users] Is there a way to limit the number of upload/downloads
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4070">[ date ]</a>
              <a href="thread.html#4070">[ thread ]</a>
              <a href="subject.html#4070">[ subject ]</a>
              <a href="author.html#4070">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 16/06/2015 11:12 a.m., Brian J. Murrell wrote:
&gt;<i> On Mon, 2015-06-15 at 06:47 +1200, Amos Jeffries wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 1)
</I>&gt;&gt;<i> I have confirmed my suspicion that your IPv6 routing is a bit broken.
</I>&gt;<i> 
</I>&gt;<i> I'm not sure I agree with you entirely on that (more below)...
</I>&gt;<i> 
</I>&gt;&gt;<i> The IPv6 address is in a private IP range fc00::/7.
</I>&gt;<i> 
</I>&gt;<i> Oh damn.  It's a ULA address.  I did not even recognize that.  The IPv6
</I>&gt;<i> addressing space is still foreign enough to me that I don't immediately
</I>&gt;<i> recognize what bits of the space certain addresses are in, unlike my
</I>&gt;<i> instant recognition of IPv4 private IP space.
</I>&gt;<i> 
</I>&gt;&gt;<i> Which is the IPv6
</I>&gt;&gt;<i> equivalent of RFC1918 10.0.0.0/8 or 182.168.0.0/16.
</I>&gt;<i> 
</I>&gt;<i> s/182/192/, but yes, indeed.  I see that now.
</I>&gt;<i> 
</I>&gt;&gt;<i> When your Squid
</I>&gt;&gt;<i> contacts it nothing at all happens within 10 seconds.
</I>&gt;<i> 
</I>&gt;<i> Unsurprisingly, of course.
</I>&gt;<i> 
</I>&gt;&gt;<i> What should be happening is that when Squid tries to contact a network
</I>&gt;&gt;<i> range which is not your own LAN fd31:aeb1:48df::/48 sub-net.
</I>&gt;<i> 
</I>&gt;<i> It should forward it to the Squid machine's default router.
</I>&gt;<i> 
</I>&gt;&gt;<i> The routing
</I>&gt;&gt;<i> system in your Squid machine responds with a &quot;network unavailable&quot;
</I>&gt;&gt;<i> within nanoseconds.
</I>&gt;<i> 
</I>&gt;<i> I disagree.  While I will agree that it is good network management
</I>&gt;<i> practice to not allow RFC-1918 and IPv6's corresponding ULA addresses to
</I>&gt;<i> leak outside of your network, AFAIK, it's not a requirement.  RFC 4193
</I>&gt;<i> 4.3 makes it a recommendation (&quot;should&quot;) rather than a requirement
</I>&gt;<i> (&quot;MUST&quot;).
</I>&gt;<i> 
</I>&gt;<i> This is really no different than RFC-1918 addresses, which were not
</I>&gt;<i> always designated for their current practice and only since that
</I>&gt;<i> designation are also only recommended against blocking at the site
</I>&gt;<i> router.
</I>
There are hardware requirements on router devices to reject F000::/4
packets which does not exist in IPv4. But things get very muddy with
virtual routers etc, so effectively yes.

2000::/3 is global IPv6 allocation space. These packets should be the
only ones using default route.

F000::/4 is various internal LAN spaces. Packets should never cross a
border gateway/router and not follow a default route.
 - Unless its explicitly defaulting 'inwards' to the LAN. But even then
very carefully so as to ensure external packets are rejected on arrival
at the border.

All other IPv6 ranges are bogon at present and need to be rejected.


&gt;<i> 
</I>&gt;&gt;<i> This signal which is not appearing is what Squid
</I>&gt;&gt;<i> depends on to to do the failover.
</I>&gt;<i> 
</I>&gt;<i> (As you point out below, so I think we are in agreement) I would think
</I>&gt;<i> that a simple timeout to connect should be just as sufficient, just like
</I>&gt;<i> any other piece of software, such as telnet for example.  I would think
</I>&gt;<i> no software should really rely on the behaviors of (only) recommended
</I>&gt;<i> practices.
</I>
Not relying on it for regular use. One never knows whether that fc*
range is the local LAN range or not. But when its acting properly there
is no timeout delay and the network operates at peak efficiency.

&gt;<i> 
</I>&gt;&gt;<i> Do you have an entry in the routing table for fc00::/7 or /8 ?
</I>&gt;<i> 
</I>&gt;<i> No.
</I>&gt;<i> 
</I>&gt;&gt;<i> 2)
</I>&gt;&gt;<i> Squid should still be attemoting the IPv4 address though.
</I>&gt;<i> 
</I>&gt;<i> Agreed.
</I>&gt;<i> 
</I>&gt;&gt;<i> I also see you have Squid-3.4.3. Can you try an upgrade to 3.5.5 ?
</I>&gt;<i> 
</I>&gt;<i> OK.  Built and installed.
</I>&gt;<i> 
</I>&gt;<i> Still doesn't seem to be working.
</I>&gt;<i> 
</I>&gt;&gt;<i> If the problem persists after that upgrade. Please redo with 26,5 in the
</I>&gt;&gt;<i> debug list.
</I>&gt;<i> 
</I>&gt;<i> Sent to your e-mail.
</I>&gt;<i> 
</I>&gt;&gt;<i> Also, check your proxy connect_timeout is shorter than forward_timeout.
</I>&gt;<i> 
</I>&gt;<i> #Default:
</I>&gt;<i> # forward_timeout 4 minutes
</I>&gt;<i> 
</I>&gt;<i> So seems it is.
</I>&gt;<i> 
</I>&gt;&gt;<i> The connect timout affects these individual connections, forward_timeout
</I>&gt;&gt;<i> needs to allow mulitiple (25?) of them for failover to have a chance in
</I>&gt;&gt;<i> lost packet situations like this.
</I>&gt;<i> 
</I>&gt;<i> Interestingly enough, my override of the default of connect_timeout to
</I>&gt;<i> 10 seconds actually makes it as close to 25 times less than
</I>&gt;<i> forward_timeout as I could reasonably get.  :-)
</I>
Good.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004064.html">[squid-users] no fallback to ipv4 if ipv6 remote address is	non-functional
</A></li>
	<LI>Next message (by thread): <A HREF="004033.html">[squid-users] Is there a way to limit the number of upload/downloads
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4070">[ date ]</a>
              <a href="thread.html#4070">[ thread ]</a>
              <a href="subject.html#4070">[ subject ]</a>
              <a href="author.html#4070">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
