<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Questions Regarding Transparent Proxy, HTTPS, and ssl_bump
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Questions%20Regarding%20Transparent%20Proxy%2C%20HTTPS%2C%0A%20and%20ssl_bump&In-Reply-To=%3Cf7b351c914319a5b8226ccd73759e05d%40localhost%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004199.html">
   <LINK REL="Next"  HREF="004201.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Questions Regarding Transparent Proxy, HTTPS, and ssl_bump</H1>
    <B>James Lay</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Questions%20Regarding%20Transparent%20Proxy%2C%20HTTPS%2C%0A%20and%20ssl_bump&In-Reply-To=%3Cf7b351c914319a5b8226ccd73759e05d%40localhost%3E"
       TITLE="[squid-users] Questions Regarding Transparent Proxy, HTTPS, and ssl_bump">jlay at slave-tothe-box.net
       </A><BR>
    <I>Wed Jun 24 17:31:05 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004199.html">[squid-users] Questions Regarding Transparent Proxy, HTTPS,	and ssl_bump
</A></li>
        <LI>Next message (by thread): <A HREF="004201.html">[squid-users] Questions Regarding Transparent Proxy, HTTPS,	and ssl_bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4200">[ date ]</a>
              <a href="thread.html#4200">[ thread ]</a>
              <a href="subject.html#4200">[ subject ]</a>
              <a href="author.html#4200">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2015-06-24 09:41 AM, Tom Mowbray wrote:
&gt;<i> Squid 3.5.5
</I>&gt;<i> 
</I>&gt;<i> I seem to have some confusion about how acl lists are processed in
</I>&gt;<i> squid.conf regarding the handling of SSL (HTTPS) traffic, attempting
</I>&gt;<i> to use ssl_bump directives with transparent proxy.
</I>&gt;<i> 
</I>&gt;<i> Based on available documentation, I believe my squid.conf is correct,
</I>&gt;<i> however it never seems to actually behave as expected.
</I>&gt;<i> 
</I>&gt;<i> I define the SSL port, as usual:
</I>&gt;<i> 
</I>&gt;<i> acl SSL_ports port 443
</I>&gt;<i> 
</I>&gt;<i> But here's where my confusion lies... Many state to place the
</I>&gt;<i> following line above the ssl_bump configuration lines:
</I>&gt;<i> 
</I>&gt;<i> http_access allow SSL_ports
</I>&gt;<i> 
</I>&gt;<i> However when I do this, it appears to simply stop processing any other
</I>&gt;<i> rules and allows ALL https traffic through the proxy (which is
</I>&gt;<i> actually how I'd expect a standard ACL list to operate, but then how
</I>&gt;<i> do I actually filter the traffic though our content-based ACL lists?).
</I>&gt;<i>  If I put the above line below the ssl_bump configuration options in
</I>&gt;<i> my squid.conf, then it appears to BUMP all, even though I've told the
</I>&gt;<i> config to SPLICE all https traffic, which doesn't work for our
</I>&gt;<i> deployment.
</I>&gt;<i> 
</I>&gt;<i> So, does squid actually continue to process the https traffic using
</I>&gt;<i> the ssl_bump rules if the &quot;http_access allow SSL_ports&quot; line is placed
</I>&gt;<i> above it in the configuration?
</I>&gt;<i> 
</I>&gt;<i> I should note that we've been able to get filtering to work correctly
</I>&gt;<i> when using our configuration in NON-transparent mode, however our goal
</I>&gt;<i> is get this functionality working as a transparent proxy.  We're
</I>&gt;<i> unable to load our self-signed cert onto client machines that will be
</I>&gt;<i> accessing the proxy, so using the &quot;bump&quot; or man-in-the-middle style
</I>&gt;<i> https filtering isn't a viable option for us.
</I>&gt;<i> 
</I>&gt;<i> Any help or advice is appreciated!
</I>&gt;<i> 
</I>&gt;<i> Thanks,
</I>&gt;<i> 
</I>&gt;<i> Tom
</I>
Tom,

You kinda have to change the way you think about filtering when it comes 
to Squid 3.5.5 and SSL(TLS).  Normal http traffic is easy....here's 
where we're trying to go and here's a list of place we're alloed to 
go...simple.

Not so with SSL(TLS).  Squid can't filter, since Squid may or may not 
know where we're going...and that's the issue..it's where those ssl_bump 
atStep ACL's come in.  Some sites when you connect to them are 
easy-ish..when you connect your device sends a &quot;Server Name Information&quot; 
(SNI) that says where you're going.  Other sites don't have any 
information until you complete the SSL handshake (how can you filter a 
site name, until squid KNOWS the site or at least domain name?).

If you're still wanting to go through with transparent (intercept) proxy 
with SSL, search through the list for my SSL Deep dive posts...that 
config is working for me so far (granted, not in an enterprise 
environment).  However, as Amos said,....if you choose not to install 
the cert on the client machines, you are either a) going to be out of 
luck on LOT'S of websites because they will fail the SSL handshake, or 
b) teaching your users to ignore the security warnings of their 
browser's....neither of which is a good thing.

Hope that helps.

James


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004199.html">[squid-users] Questions Regarding Transparent Proxy, HTTPS,	and ssl_bump
</A></li>
	<LI>Next message (by thread): <A HREF="004201.html">[squid-users] Questions Regarding Transparent Proxy, HTTPS,	and ssl_bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4200">[ date ]</a>
              <a href="thread.html#4200">[ thread ]</a>
              <a href="subject.html#4200">[ subject ]</a>
              <a href="author.html#4200">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
