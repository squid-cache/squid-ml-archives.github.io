<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] acl for redirect
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20acl%20for%20redirect&In-Reply-To=%3C558C11E2.7040909%40afo.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004185.html">
   <LINK REL="Next"  HREF="004223.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] acl for redirect</H1>
    <B>Mike</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20acl%20for%20redirect&In-Reply-To=%3C558C11E2.7040909%40afo.net%3E"
       TITLE="[squid-users] acl for redirect">mcsnv96 at afo.net
       </A><BR>
    <I>Thu Jun 25 14:36:18 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004185.html">[squid-users] acl for redirect
</A></li>
        <LI>Next message (by thread): <A HREF="004223.html">[squid-users] acl for redirect
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4218">[ date ]</a>
              <a href="thread.html#4218">[ thread ]</a>
              <a href="subject.html#4218">[ subject ]</a>
              <a href="author.html#4218">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Amos, thanks for info.

The primary settings being used in squid.conf:

http_port 8080
# this port is what will be used for SSL Proxy on client browser
http_port 8081 intercept

https_port 8082 intercept ssl-bump connection-auth=off 
generate-host-certificates=on dynamic_cert_mem_cache_size=16MB 
cert=/etc/squid/ssl/squid.pem key=/etc/squid/ssl/squid.key 
cipher=ECDHE-RSA-RC4-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES128-SHA:DHE-RSA-CAMELLIA128-SHA:AES128-SHA:RC4-SHA:HIGH:!aNULL:!MD5:!ADH

sslcrtd_program /usr/lib64/squid/ssl_crtd -s /var/lib/squid_ssl_db -M 16MB
sslcrtd_children 50 startup=5 idle=1
ssl_bump server-first all
ssl_bump none localhost


Then e2guardian uses 10101 for the browsers, and uses 8080 for 
connecting to squid on the same server.

Yet what is happening is there is the GET, then CONNECT and the tunnel 
is created, never allowing squid to decrypt and pass the data along to 
e2guardian, I suspect Google has changed their settings denying any 
proxy from intercepting, because we can type the most foul terms which 
are in the &quot;bannedssllist&quot; for e2guardian and literally nothing is 
filtered at all on google, nor youtube. Yet other secure sites like 
wordpress, yahoo, and others are caught and blocked, so it is just 
google owned sites that are not.

More below...


On 6/24/2015 6:36 AM, Amos Jeffries wrote:
&gt;<i> On 24/06/2015 11:03 a.m., Mike wrote:
</I>&gt;&gt;<i> We have a server setup using squid 3.5 and e2guardian (newer branch of
</I>&gt;&gt;<i> dansguardian), the issue is now google has changed a few things around
</I>&gt;&gt;<i> and google is no longer filtered which is not acceptable. We already
</I>&gt;&gt;<i> have the browser settings for SSL Proxy set to our server, and squid has
</I>&gt;&gt;<i> ssl-bump enabled and working. Previously there was enough unsecure
</I>&gt;&gt;<i> content on Google that the filtering was still working, but now google
</I>&gt;&gt;<i> has gone 100% encrypted meaning it is 100% unfiltered.
</I>&gt;<i> Maybe, maybe not.
</I>&gt;<i>
</I>&gt;&gt;<i> What is happening
</I>&gt;&gt;<i> is it is creating an ssl tunnel (for lack of a better term) between
</I>&gt;<i> No. That is the correct and official term for what they are doing. And
</I>&gt;<i> &quot;CONNECT tunnel&quot; is the full phrase / name for the particular method of
</I>&gt;<i> tunnel creation.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> their server and the browser, so all squid sees is the connection to
</I>&gt;&gt;<i> www.google.com, and after that it is tunneled and not recognized by
</I>&gt;&gt;<i> squid or e2guardian at all.
</I>&gt;<i> BUT ... you said you were SSL-Bump'ing. Which means you are decrypting
</I>&gt;<i> such tunnels to filter the content inside them.
</I>&gt;<i>
</I>&gt;<i> So what is the problem? is your method of bumping not decrypting the
</I>&gt;<i> Google traffic for Squid access controls and helpers to filter?
</I>&gt;<i>
</I>&gt;<i> Note that DansGuardian and e2guardian being independent HTTP proxies are
</I>&gt;<i> not party to that SSL-Bump decrypted content inside Squid. ONly Squid
</I>&gt;<i> internals and ICAP/eCAP services have access to it.
</I>&gt;<i>
</I>&gt;&gt;<i> I found a few options online that was used with older squid versions but
</I>&gt;&gt;<i> nothing is working with squid 3.5... Looking for something like this:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> acl google dstdomain .google.com
</I>&gt;&gt;<i> deny_info <A HREF="http://www.google.com/webhp?nord=1">http://www.google.com/webhp?nord=1</A> google
</I>&gt;<i> As you said Google have gone 100% HTTPS. URLs beginning with <A HREF="http://">http://</A> are
</I>&gt;<i> not HTTPS nor accepted there anymore. If used they just get a 30x
</I>&gt;<i> redirect to an <A HREF="https://">https://</A> URL.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>This is why we are thinking we can force the redirect, if you have ides 
on how to do that. All google pages use the secure aspect, except when 
that <A HREF="http://www.google.com/webhp?nord=1">http://www.google.com/webhp?nord=1</A> is used, it forces use of the 
insecure pages, and allows e2guardian filtering to work properly.

Thank you,

Mike

&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150625/d08f8c8c/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150625/d08f8c8c/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004185.html">[squid-users] acl for redirect
</A></li>
	<LI>Next message (by thread): <A HREF="004223.html">[squid-users] acl for redirect
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4218">[ date ]</a>
              <a href="thread.html#4218">[ thread ]</a>
              <a href="subject.html#4218">[ subject ]</a>
              <a href="author.html#4218">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
