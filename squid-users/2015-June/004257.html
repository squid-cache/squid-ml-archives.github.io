<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Mikrotik and Squid Transparent
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Mikrotik%20and%20Squid%20Transparent&In-Reply-To=%3CCAJ%2BQ1PXg2MHnpEfiUYA5Gr8B1PyReUY5bKTPzs%2BYUhk8iTo66Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004251.html">
   <LINK REL="Next"  HREF="004258.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Mikrotik and Squid Transparent</H1>
    <B>Alex Samad</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Mikrotik%20and%20Squid%20Transparent&In-Reply-To=%3CCAJ%2BQ1PXg2MHnpEfiUYA5Gr8B1PyReUY5bKTPzs%2BYUhk8iTo66Q%40mail.gmail.com%3E"
       TITLE="[squid-users] Mikrotik and Squid Transparent">alex at samad.com.au
       </A><BR>
    <I>Sun Jun 28 23:28:38 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004251.html">[squid-users] Mikrotik and Squid Transparent
</A></li>
        <LI>Next message (by thread): <A HREF="004258.html">[squid-users] Mikrotik and Squid Transparent
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4257">[ date ]</a>
              <a href="thread.html#4257">[ thread ]</a>
              <a href="subject.html#4257">[ subject ]</a>
              <a href="author.html#4257">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi

Thought I would re word what i got from this, see if I understood.

If squid and router (default gateway) are on the same box
then
DNAT to the SQUID listening port and local ip (Can you use localhost
suppose it doesn't matter)
else
router the packet to the SQUID box (if possible)
DNAT on the SQUID box to the local listening port and ip


Squid is able to look in the NAT table ? to confirm what the
destination would be not what the DNAT'ed ip would be.


Does that sum it up ?


Alex



On 28 June 2015 at 21:11, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:
&gt;<i> On 28/06/2015 10:37 p.m., Dalmar wrote:
</I>&gt;&gt;<i> To begin with, thank you Marcel,Alex and Amos for your help guys i am
</I>&gt;&gt;<i> really so close because of you. I have done exactly what Marcel told me and
</I>&gt;&gt;<i> now all transparent/intercept errors are gone. It worked nicely when i used
</I>&gt;&gt;<i> two mikrotiks one for WAN and the other for the LAN connection, however,
</I>&gt;&gt;<i> when i use one mikrotik it says TCP_MISS_ABORTED and NONE_ABORTED. In this
</I>&gt;&gt;<i> situation ,squid gets internet from the MK LAN port using a public IP and i
</I>&gt;&gt;<i> can ping the net, but squid throws the above error in the access.log. The
</I>&gt;&gt;<i> topo i wanna use is INTERNET &gt;&gt;MK &gt;&gt; SQUID .
</I>&gt;&gt;<i> i think the iptable rules will change.The Mikrotik have 3 NICS now , but i
</I>&gt;&gt;<i> can add 1 more so it becomes eth0:WAN eth1:LAN eth2:PROXY-LAN
</I>&gt;&gt;<i> eth3:PROXY-WAN .
</I>&gt;<i>
</I>&gt;<i> You should not need extra NICs for this. The Mikrotik rules just need to
</I>&gt;<i> distinguish the flows clearly.
</I>&gt;<i>
</I>&gt;<i> a) LAN-&gt;WAN dst port TCP/80 use gateway eth2
</I>&gt;<i> b) *-&gt;WAN use gateway eth0
</I>&gt;<i> c) *-&gt;Squid use gateway eth2
</I>&gt;<i> d) *-&gt;LAN use gateway eth1
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> NB: it says Your message to squid-users awaits moderator approval , Message
</I>&gt;&gt;<i> body is too big ,for all my replays! so sorry for the delay.
</I>&gt;<i>
</I>&gt;<i> NP: We have a 40KB size limit on posts to these lists. Moderation for
</I>&gt;<i> others and the moderators procrastinate.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004251.html">[squid-users] Mikrotik and Squid Transparent
</A></li>
	<LI>Next message (by thread): <A HREF="004258.html">[squid-users] Mikrotik and Squid Transparent
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4257">[ date ]</a>
              <a href="thread.html#4257">[ thread ]</a>
              <a href="subject.html#4257">[ subject ]</a>
              <a href="author.html#4257">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
