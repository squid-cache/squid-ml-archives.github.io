<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TCP_MISS/504 in cache_peer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_MISS/504%20in%20cache_peer&In-Reply-To=%3C559264F1.6020106%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004288.html">
   <LINK REL="Next"  HREF="004292.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TCP_MISS/504 in cache_peer</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_MISS/504%20in%20cache_peer&In-Reply-To=%3C559264F1.6020106%40treenet.co.nz%3E"
       TITLE="[squid-users] TCP_MISS/504 in cache_peer">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Jun 30 09:44:17 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="004288.html">[squid-users] TCP_MISS/504 in cache_peer
</A></li>
        <LI>Next message (by thread): <A HREF="004292.html">[squid-users] TCP_MISS/504 in cache_peer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4290">[ date ]</a>
              <a href="thread.html#4290">[ thread ]</a>
              <a href="subject.html#4290">[ subject ]</a>
              <a href="author.html#4290">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 30/06/2015 8:55 p.m., Stakres wrote:
&gt;<i> Amos,
</I>&gt;<i> We used this example from the wiki:
</I>&gt;<i> <A HREF="http://wiki.squid-cache.org/Features/CacheHierarchy">http://wiki.squid-cache.org/Features/CacheHierarchy</A>
</I>&gt;<i> We can see a sibling/sibling archi is possible, right ?
</I>
Possible vs Useful. For you at present its possible, but not
particularly useful.

I've just received an update about bug
(&lt;<A HREF="http://bugs.squid-cache.org/show_bug.cgi?id=4223">http://bugs.squid-cache.org/show_bug.cgi?id=4223</A>&gt;) that matching your
symptoms. Chudy seems to have isolated it to the particular mix of
HTTP/1.1 features sibling requests use.
 So a workaround would be to avoid the sibling relatinonship ...

&gt;<i> 
</I>&gt;<i> Here, we can not have a &quot;cache_peer parent&quot; archi as the tproxy (original
</I>&gt;<i> user ip) will be lost at the parent level, you wrote this in a previous post
</I>&gt;<i> I did.
</I>&gt;<i> So, we must have a sibling/sibling with the 2 squid servers, both in tproxy.
</I>
The TPROXY is separate. The IP is lost the instant the peer TCP
connection packets leave the Squid box regardess of the peer type.

&gt;<i> 
</I>&gt;<i> Now, if there is a better archi and correct settings to build a
</I>&gt;<i> tproxy/sibling-sibling archi, please share 
</I>
To use TPROXY on traffic between peers you need a cable/pathway between
the proxies that does not go through the Mikrotik/Cisco routers feeding
them with intercepted traffic. And routing rules on the Squid boxen to
ensure that TPROXY traffic exits via the same interface that it arrived on.

Alternatively you can use the no-tproxy rule on parent type cache_peer
lines with the same effect as you expected to get out of the siblings
(but not hitting the bug 4223).

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="004288.html">[squid-users] TCP_MISS/504 in cache_peer
</A></li>
	<LI>Next message (by thread): <A HREF="004292.html">[squid-users] TCP_MISS/504 in cache_peer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4290">[ date ]</a>
              <a href="thread.html#4290">[ thread ]</a>
              <a href="subject.html#4290">[ subject ]</a>
              <a href="author.html#4290">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
