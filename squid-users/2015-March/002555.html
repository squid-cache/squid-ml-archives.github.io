<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] wccp2_service_info fails on more than one port	number
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20wccp2_service_info%20fails%20on%20more%20than%20one%20port%0A%09number&In-Reply-To=%3C2DCF7238-EAAC-452B-B76D-4F355743ADFE%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002553.html">
   <LINK REL="Next"  HREF="002556.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] wccp2_service_info fails on more than one port	number</H1>
    <B>Guy Helmer</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20wccp2_service_info%20fails%20on%20more%20than%20one%20port%0A%09number&In-Reply-To=%3C2DCF7238-EAAC-452B-B76D-4F355743ADFE%40gmail.com%3E"
       TITLE="[squid-users] wccp2_service_info fails on more than one port	number">guy.helmer at gmail.com
       </A><BR>
    <I>Tue Mar  3 17:57:47 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="002553.html">[squid-users] wccp2_service_info fails on more than one port number
</A></li>
        <LI>Next message (by thread): <A HREF="002556.html">[squid-users] wccp2_service_info fails on more than one port number
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2555">[ date ]</a>
              <a href="thread.html#2555">[ thread ]</a>
              <a href="subject.html#2555">[ subject ]</a>
              <a href="author.html#2555">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Yuri -- I have thoroughly read Cisco IOS configuration manuals pertaining to WCCP2. From what I have read, there is no strict requirement for separate configurations for standard web-cache port 80 and dynamic service for non-port 80 &#8212; wccp2 dynamic services allow redirection of any ports (up to a total of 8), including port 80. As I&#8217;ve stated before, this was a working configuration in squid 3.3 at multiple sites. If there is a rationale for distinct wccp2 service configurations for port 80 vs other ports, I sure could use a reference that explains it.

As I&#8217;ve pointed out, there is a bug in Squid 3.4 that prevents specifying multiple TCP ports in the wccp2_service_info line. I&#8217;ve corrected that now in my sources. After fixing that bug, squid 3.4.12 is functioning with WCCP2 interception for port 80, 443, and others as it did in version 3.3.x.

Regards,
Guy

&gt;<i> On Mar 3, 2015, at 11:29 AM, Yuri Voinov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i> Hash: SHA1
</I>&gt;<i> 
</I>&gt;<i> Please, read Cisco iOS WCCPv2 manual first.
</I>&gt;<i> 
</I>&gt;<i> This one:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://www.cisco.com/c/en/us/td/docs/ios/12_2/configfun/configuration/guide/ffun_c/fcf018.html">http://www.cisco.com/c/en/us/td/docs/ios/12_2/configfun/configuration/guide/ffun_c/fcf018.html</A> &lt;<A HREF="http://www.cisco.com/c/en/us/td/docs/ios/12_2/configfun/configuration/guide/ffun_c/fcf018.html">http://www.cisco.com/c/en/us/td/docs/ios/12_2/configfun/configuration/guide/ffun_c/fcf018.html</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> and this one:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://www.cisco.com/c/en/us/td/docs/ios/12_2/configfun/configuration/guide/ffun_c/fcf018.html#wp1000955">http://www.cisco.com/c/en/us/td/docs/ios/12_2/configfun/configuration/guide/ffun_c/fcf018.html#wp1000955</A> &lt;<A HREF="http://www.cisco.com/c/en/us/td/docs/ios/12_2/configfun/configuration/guide/ffun_c/fcf018.html#wp1000955">http://www.cisco.com/c/en/us/td/docs/ios/12_2/configfun/configuration/guide/ffun_c/fcf018.html#wp1000955</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> wccp web-cache uses port 80 by default. Other http ports is less than
</I>&gt;<i> percentile on web-traffic.
</I>&gt;<i> 
</I>&gt;<i> https requires another dynamic wccp service.
</I>&gt;<i> 
</I>&gt;<i> Also, take a look on config example again.
</I>&gt;<i> 
</I>&gt;<i> This is working configuration.
</I>&gt;<i> 
</I>&gt;<i> 03.03.15 23:21, Guy Helmer &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;&gt;<i> It has worked in the past with WCCP2 dynamic services at multiple
</I>&gt;&gt;<i> sites.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I&#8217;ve uncovered the wccp2_service_info ports parsing error:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> --- src/wccp2.cc.ORIG	2015-03-03 11:08:18.000000000 -0600 +++
</I>&gt;&gt;<i> src/wccp2.cc	2015-03-03 11:10:37.000000000 -0600 @@ -2264,7
</I>&gt;&gt;<i> +2264,10 @@ if (i &gt;= WCCP2_NUMPORTS) { 
</I>&gt;&gt;<i> fatalf(&quot;parse_wccp2_service_ports: too many ports (maximum: 8) in
</I>&gt;&gt;<i> list '%s'\n&quot;, options); } -        int p = xatoi(tmp); +
</I>&gt;&gt;<i> char copy[len + 1]; +        memcpy(copy, tmp, len); +
</I>&gt;&gt;<i> copy[len] = '\0'; +        int p = xatoi(copy);
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> if (p &lt; 1 || p &gt; 65535) { fatalf(&quot;parse_wccp2_service_ports: port
</I>&gt;&gt;<i> value '%s' isn't valid (1..65535)\n&quot;, tmp);
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> On Mar 3, 2015, at 11:06 AM, Yuri Voinov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A>&gt;
</I>&gt;&gt;&gt;<i> wrote:
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;<i> You cannot combine HTTP and HTTPS in one WCCP service.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> <A HREF="http://wiki.squid-cache.org/ConfigExamples/Intercept/CiscoIOSv15Wccp2">http://wiki.squid-cache.org/ConfigExamples/Intercept/CiscoIOSv15Wccp2</A> &lt;<A HREF="http://wiki.squid-cache.org/ConfigExamples/Intercept/CiscoIOSv15Wccp2">http://wiki.squid-cache.org/ConfigExamples/Intercept/CiscoIOSv15Wccp2</A>&gt;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 03.03.15 23:04, Guy Helmer &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;&gt;&gt;&gt;&gt;<i> This used to work in 3.3.x:
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> wccp2_service_info 94 protocol=tcp
</I>&gt;&gt;&gt;&gt;&gt;<i> flags=dst_ip_hash,ports_source priority=240
</I>&gt;&gt;&gt;&gt;&gt;<i> ports=80,81,83,591,8008,8080,443
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> squid 3.4.12 fails: 2015/03/03 11:02:33.109|
</I>&gt;&gt;&gt;&gt;&gt;<i> cache_cf.cc(556) parseOneConfigFile: Processing:
</I>&gt;&gt;&gt;&gt;&gt;<i> wccp2_service_info 94 protocol=tcp 
</I>&gt;&gt;&gt;&gt;&gt;<i> flags=dst_ip_hash,ports_source priority=240 
</I>&gt;&gt;&gt;&gt;&gt;<i> ports=80,81,83,591,8008,8080,443 2015/03/03 11:02:33.109| 
</I>&gt;&gt;&gt;&gt;&gt;<i> wccp2.cc &lt;<A HREF="http://wccp2.cc/">http://wccp2.cc/</A>&gt;(2298) parse_wccp2_service_info:
</I>&gt;&gt;&gt;&gt;&gt;<i> parse_wccp2_service_info: called 2015/03/03 11:02:33.109|
</I>&gt;&gt;&gt;&gt;&gt;<i> ERROR: Invalid value: '80,81,83,591,8008,8080,443' is
</I>&gt;&gt;&gt;&gt;&gt;<i> supposed to be a number.
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> Any help?
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> Thanks, Guy _______________________________________________ 
</I>&gt;&gt;&gt;&gt;&gt;<i> squid-users mailing list <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt; 
</I>&gt;&gt;&gt;&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A> &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> _______________________________________________ squid-users
</I>&gt;&gt;&gt;<i> mailing list <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt; 
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A> &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;&gt;<i> 
</I>&gt;<i> -----BEGIN PGP SIGNATURE-----
</I>&gt;<i> Version: GnuPG v2
</I>&gt;<i> 
</I>&gt;<i> iQEcBAEBAgAGBQJU9e+SAAoJENNXIZxhPexGgN8H/iu2SiLdNehFyrVlK/1X2J4X
</I>&gt;<i> qa0cZMoJBYcmQYY2VhjaIGVSdO1RfHt1RP5RSEFgkAkdSH10zCSK6KrzK4eh6jrU
</I>&gt;<i> Fuze0mvACuQsi0CfwEQ2KO9gREeOpP7+QcqZ304zEdw2fFDT4YEDRBKhiYXtAYtK
</I>&gt;<i> zR4oiNAlut5TWhwjHkmbvTADLWjp64gP0FggVEYIPvIBGYQqSKjE+JVRruiCSTtW
</I>&gt;<i> TrbXjcwGNX7SA2gN3pl7pO+QcCwLdErzXnzc3E3ExCKW9uTB3VLKkK4BbK7uRBQX
</I>&gt;<i> iKUsB/G9Ps8nAt08xK/puKL0fXJ1t//N8BXSrSkztTODQ/ckTBn772Dr2LJNv7Q=
</I>&gt;<i> =j/dZ
</I>&gt;<i> -----END PGP SIGNATURE-----
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150303/12c48679/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150303/12c48679/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="002553.html">[squid-users] wccp2_service_info fails on more than one port number
</A></li>
	<LI>Next message (by thread): <A HREF="002556.html">[squid-users] wccp2_service_info fails on more than one port number
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2555">[ date ]</a>
              <a href="thread.html#2555">[ thread ]</a>
              <a href="subject.html#2555">[ subject ]</a>
              <a href="author.html#2555">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
