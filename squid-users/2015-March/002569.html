<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Redirecting traffic to fake parent
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Redirecting%20traffic%20to%20fake%20parent&In-Reply-To=%3C54F72641.3000705%40vianetcon.com.ar%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002563.html">
   <LINK REL="Next"  HREF="002572.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Redirecting traffic to fake parent</H1>
    <B>Sebastian Goicochea</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Redirecting%20traffic%20to%20fake%20parent&In-Reply-To=%3C54F72641.3000705%40vianetcon.com.ar%3E"
       TITLE="[squid-users] Redirecting traffic to fake parent">sebag at vianetcon.com.ar
       </A><BR>
    <I>Wed Mar  4 15:35:29 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="002563.html">[squid-users] Redirecting traffic to fake parent
</A></li>
        <LI>Next message (by thread): <A HREF="002572.html">[squid-users] Redirecting traffic to fake parent
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2569">[ date ]</a>
              <a href="thread.html#2569">[ thread ]</a>
              <a href="subject.html#2569">[ subject ]</a>
              <a href="author.html#2569">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The problem is that I'm using Squid 2.7 (I know how behind I am), and I 
need to use the referrer of certain requests and give those url + 
referer to a rewriter program (Posible in v 3.5 as far as I know). So in 
order to achieve this using 2.7 I redirect the traffic to a fake node.js 
proxy, extract what I need, store it on a DB and then the rewriter con 
make a query there and make the proper rewrite. I have that working 
already, but I don't know how to mantain the original IP of the client 
making the request to the very end of the transaction so to the outside 
world it doesn't look that all the requests come from the same client.


Thanks
Sebastian


El 03/03/15 a las 23:32, Amos Jeffries escribi&#243;:
&gt;<i> On 4/03/2015 9:35 a.m., Sebastian Goicochea wrote:
</I>&gt;&gt;<i> Hello everyone, I'm experimenting with cache_peer directive and node.js:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> cache_peer 10.0.0.90 parent 8888 0 no-query no-digest proxy-only name=test
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> in that port I have a node.js Proxy receiveing connections in the same
</I>&gt;&gt;<i> host, it extracts some information I need and saves it to a DB, then
</I>&gt;&gt;<i> redirects Squid with a 302 response with some garbage added to the url.
</I>&gt;&gt;<i> I use that garbage to match an access list so I can prevent looping.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Squid is working in transparent mode, the problem I'm facing is that if
</I>&gt;&gt;<i> I don't configure a tcp_outgoing_address Squid does not reach port 8888
</I>&gt;&gt;<i> on localhost. If I set a tcp_outgoing_address Squid can reach
</I>&gt;&gt;<i> localhost:8888 but with his own IP address and I need it to be
</I>&gt;&gt;<i> transparent, I need the real client IP address.
</I>&gt;<i> Why? what is all this for?
</I>&gt;<i>
</I>&gt;<i> HTTP is designed to operate just fine without forging client IPs on
</I>&gt;<i> proxy outgoing traffic. Some web applications are seriously broken, but
</I>&gt;<i> since its on your localhost you obviously are in a great position to fix
</I>&gt;<i> this one.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> also, it sounds to me like you are using all this complex 4-party
</I>&gt;<i> interaction to replicate something that an ICAP/eCAP service does much
</I>&gt;<i> faster and simpler. Or perhapse you are trying to implement Squids
</I>&gt;<i> StoreID feature using layers of proxies.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> Is there a way to configure tcp_outgoing_address to use the client's IP
</I>&gt;&gt;<i> when fetching something?
</I>&gt;<i> No. You can only bind to IP addresses which have been assigned to the
</I>&gt;<i> machine Squid is running on. Lookup the &quot;triangular routing&quot; problem if
</I>&gt;<i> you want all the gory details.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="002563.html">[squid-users] Redirecting traffic to fake parent
</A></li>
	<LI>Next message (by thread): <A HREF="002572.html">[squid-users] Redirecting traffic to fake parent
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2569">[ date ]</a>
              <a href="thread.html#2569">[ thread ]</a>
              <a href="subject.html#2569">[ subject ]</a>
              <a href="author.html#2569">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
