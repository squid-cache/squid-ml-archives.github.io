<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid intercept config
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20intercept%20config&In-Reply-To=%3CCALP3%3Dx_2Zdw3OrV%2BkaROTcgcm67UfbfwcVTC0O30L%2Bdcku_s4g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002630.html">
   <LINK REL="Next"  HREF="002633.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid intercept config</H1>
    <B>Monah Baki</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20intercept%20config&In-Reply-To=%3CCALP3%3Dx_2Zdw3OrV%2BkaROTcgcm67UfbfwcVTC0O30L%2Bdcku_s4g%40mail.gmail.com%3E"
       TITLE="[squid-users] squid intercept config">monahbaki at gmail.com
       </A><BR>
    <I>Sat Mar  7 11:33:12 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="002630.html">[squid-users] squid intercept config
</A></li>
        <LI>Next message (by thread): <A HREF="002633.html">[squid-users] squid intercept config
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2632">[ date ]</a>
              <a href="thread.html#2632">[ thread ]</a>
              <a href="subject.html#2632">[ subject ]</a>
              <a href="author.html#2632">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Amos,

Thanks for the assist. So basically from my end, the squid proxy which I am
responsible for, I shouldn't concentrate on changing any of it's
configuration, but instead tell them to try to solve on their end?
If yes, what are we looking at, their router setup?

Thanks

On Fri, Mar 6, 2015 at 11:26 PM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:

&gt;<i> On 6/03/2015 1:19 a.m., Monah Baki wrote:
</I>&gt;<i> &gt; Hi all, can anyone verify if this is correct, need to make ure that users
</I>&gt;<i> &gt; will be able to access the internet via the squid.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Running FreeBSD with a single interface with Squid-3.5.2
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Policy based routing on Cisco with the following:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; interface GigabitEthernet0/0/1.1
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; encapsulation dot1Q 1 native
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ip address 10.0.0.9 255.255.255.0
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; no ip redirects
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; no ip unreachables
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ip nat inside
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; standby 1 ip 10.0.0.10
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; standby 1 priority 120
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; standby 1 preempt
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; standby 1 name HSRP
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ip policy route-map CFLOW
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ip access-list extended REDIRECT
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; deny   tcp host 10.0.0.24 any eq www
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; permit tcp host 10.0.0.23 any eq www
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; route-map CFLOW permit 10
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; match ip address REDIRECT
</I>&gt;<i> &gt; set ip next-hop 10.0.0.24
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; In my /etc/pf.conf
</I>&gt;<i> &gt; rdr pass inet proto tcp from 10.0.0.0/8 to any port 80 -&gt; 10.0.0.24 port
</I>&gt;<i> &gt; 3129
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; # block in
</I>&gt;<i> &gt; pass in log quick on bge0
</I>&gt;<i> &gt; pass out log quick on bge0
</I>&gt;<i> &gt; pass out keep state
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; and finally in my squid.conf:
</I>&gt;<i> &gt; http_port 3128
</I>&gt;<i> &gt; http_port 3129 intercept
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; And for testing purposes from the squid server:
</I>&gt;<i> &gt;  ./squidclient -h 10.0.0.24 -p 3128 <A HREF="http://www.freebsd.org/">http://www.freebsd.org/</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; If I replace -p 3128 with -p 80, I get a access denied, and if I omit the
</I>&gt;<i> &gt; -p 3128 completely, I can access the websites.
</I>&gt;<i>
</I>&gt;<i> If you omit the -p entirely squidclient assumes &quot;-p 3128&quot; (the proxy
</I>&gt;<i> default listening port), so it works exactly the same as if you had used
</I>&gt;<i> -p 3128 explicitly.
</I>&gt;<i>
</I>&gt;<i> If you use -p 80 you also need to change the pther parameters so they
</I>&gt;<i> generate port-80 syntax message:
</I>&gt;<i>  - the -h with IP or hostname of the remote web server, and
</I>&gt;<i>  - the URL parameters being a relative URL, and
</I>&gt;<i>  - the -j parameter with Host: header domain name of the server
</I>&gt;<i> ...
</I>&gt;<i>  eg.
</I>&gt;<i>  squidclient -h www.freebsd.org -j www.freebsd.org -p 80 /
</I>&gt;<i>
</I>&gt;<i> NP: if your squidclient is too old to support -j, use this instead:
</I>&gt;<i>   -H 'Host: www.freebsd.org\n'
</I>&gt;<i>
</I>&gt;<i>  ** this test should work from the squid box without having gone through
</I>&gt;<i> the proxy. Only from the client machine should it work *with* NAT
</I>&gt;<i> passing it through the proxy.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Using a proxy syntax message sent directly to the proxy receiving port,
</I>&gt;<i> or with the proxy as receiving IP on port 80 (NAT'ed to Squid) is a
</I>&gt;<i> guaranted forwarding loop failure.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> That doesn't fix your clients issue, but hopefully makes it clear that
</I>&gt;<i> the above desribed test is broken enough to prevent you identifying when
</I>&gt;<i> the client issue is fixed if that happens on some change.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150307/fd03f52a/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150307/fd03f52a/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="002630.html">[squid-users] squid intercept config
</A></li>
	<LI>Next message (by thread): <A HREF="002633.html">[squid-users] squid intercept config
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2632">[ date ]</a>
              <a href="thread.html#2632">[ thread ]</a>
              <a href="subject.html#2632">[ subject ]</a>
              <a href="author.html#2632">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
