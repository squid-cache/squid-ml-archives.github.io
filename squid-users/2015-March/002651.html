<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Whether squid 3.5.2 can support rock at wccp tproxy environment really ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Whether%20squid%203.5.2%20can%20support%20rock%20at%20wccp%0A%20tproxy%20environment%20really%20%3F&In-Reply-To=%3C54FD67BC.2030407%40yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002650.html">
   <LINK REL="Next"  HREF="002652.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Whether squid 3.5.2 can support rock at wccp tproxy environment really ?</H1>
    <B>johnzeng</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Whether%20squid%203.5.2%20can%20support%20rock%20at%20wccp%0A%20tproxy%20environment%20really%20%3F&In-Reply-To=%3C54FD67BC.2030407%40yahoo.com%3E"
       TITLE="[squid-users] Whether squid 3.5.2 can support rock at wccp tproxy environment really ?">johnzeng2013 at yahoo.com
       </A><BR>
    <I>Mon Mar  9 09:28:28 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="002650.html">[squid-users] Whether squid 3.5.2 can support rock at wccp tproxy environment really ?
</A></li>
        <LI>Next message (by thread): <A HREF="002652.html">[squid-users] Whether squid 3.5.2 can support rock at wccp tproxy environment really ? ( there are same problem between smp model or single model )
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2651">[ date ]</a>
              <a href="thread.html#2651">[ thread ]</a>
              <a href="subject.html#2651">[ subject ]</a>
              <a href="author.html#2651">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> Hello Dear Amos:
</I>&gt;<i>
</I>&gt;<i>                              Thanks for your reply ,  i updated my 
</I>&gt;<i> config in according to your advisement .
</I>&gt;<i>
</I>&gt;<i>                              i do more testing for the part .  i face 
</I>&gt;<i> same problem still , although i understand your saying ( they are 
</I>&gt;<i> *completely* unrelated. &quot;)
</I>&gt;<i>
</I>&gt;<i> but it is real result via more testing still !
</I>&gt;<i>
</I>&gt;<i>                               if i disable cache_dir rock part ,and it 
</I>&gt;<i> will be success for wccp( tproxy) connection
</I>&gt;<i>
</I>&gt;<i>                              if i enable cache_dir rock part ,and it 
</I>&gt;<i> will be failure for wccp( tproxy)
</I>&gt;<i>
</I>&gt;<i>                              it is very strange really  ,
</I>&gt;<i>
</I>&gt;<i>                              Maybe there are some error  at Cache_dir 
</I>&gt;<i> rock , and Wccp don't running at error status ,
</I>&gt;<i>
</I>&gt;<i>                               but i don't find any error logs info  
</I>&gt;<i> after running squid .
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>                 this is a config for rock
</I>&gt;<i>
</I>&gt;<i>     cache_dir rock /accerater/webcache3/storage/rock1 2646 
</I>&gt;<i> min-size=4096 max-size=262144 max-swap-rate=250 swap-timeout=350
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> this is status info
</I>&gt;<i>
</I>&gt;<i> squid -z
</I>&gt;<i>
</I>&gt;<i> 2015/03/09 15:22:45 kid3| Creating Rock db: 
</I>&gt;<i> /accerater/webcache3/storage/rock1/rock
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> squid -d1
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at fastopmizer</A>:/accerater/webcache3/sbin# 2015/03/09 15:23:34 kid3| 
</I>&gt;<i> Set Current Directory to /accerater/logs/webcache3/opmizer1
</I>&gt;<i> 2015/03/09 15:23:34 kid4| Set Current Directory to 
</I>&gt;<i> /accerater/logs/webcache3/opmizer1
</I>&gt;<i> 2015/03/09 15:23:34 kid3| Starting Squid Cache version 3.5.2 for 
</I>&gt;<i> x86_64-unknown-linux-gnu...
</I>&gt;<i> 2015/03/09 15:23:34 kid3| Service Name: squid
</I>&gt;<i> 2015/03/09 15:23:34 kid4| Starting Squid Cache version 3.5.2 for 
</I>&gt;<i> x86_64-unknown-linux-gnu...
</I>&gt;<i> 2015/03/09 15:23:34 kid3| Process ID 12049
</I>&gt;<i> 2015/03/09 15:23:34 kid2| Set Current Directory to 
</I>&gt;<i> /accerater/logs/webcache3/opmizer1
</I>&gt;<i> 2015/03/09 15:23:34 kid4| Service Name: squid
</I>&gt;<i> 2015/03/09 15:23:34 kid3| Process Roles: disker
</I>&gt;<i> 2015/03/09 15:23:34 kid4| Process ID 12048
</I>&gt;<i> 2015/03/09 15:23:34 kid2| Starting Squid Cache version 3.5.2 for 
</I>&gt;<i> x86_64-unknown-linux-gnu...
</I>&gt;<i> 2015/03/09 15:23:34 kid3| With 4096 file descriptors available
</I>&gt;<i> 2015/03/09 15:23:34 kid2| Service Name: squid
</I>&gt;<i> 2015/03/09 15:23:34 kid2| Process ID 12050
</I>&gt;<i> 2015/03/09 15:23:34 kid4| Process Roles: coordinator
</I>&gt;<i> 2015/03/09 15:23:34 kid3| Initializing IP Cache...
</I>&gt;<i> 2015/03/09 15:23:34 kid2| Process Roles: worker
</I>&gt;<i> 2015/03/09 15:23:34 kid4| With 4096 file descriptors available
</I>&gt;<i> 2015/03/09 15:23:34 kid2| With 4096 file descriptors available
</I>&gt;<i> 2015/03/09 15:23:34 kid4| Initializing IP Cache...
</I>&gt;<i> 2015/03/09 15:23:34 kid2| Initializing IP Cache...
</I>&gt;<i> 2015/03/09 15:23:34 kid3| DNS Socket created at [::], FD 7
</I>&gt;<i> 2015/03/09 15:23:34 kid3| DNS Socket created at 0.0.0.0, FD 8
</I>&gt;<i> 2015/03/09 15:23:34 kid4| DNS Socket created at [::], FD 7
</I>&gt;<i> 2015/03/09 15:23:34 kid4| DNS Socket created at 0.0.0.0, FD 8
</I>&gt;<i> 2015/03/09 15:23:34 kid3| Adding nameserver 127.0.0.1 from 
</I>&gt;<i> /etc/resolv.conf
</I>&gt;<i> 2015/03/09 15:23:34 kid2| DNS Socket created at [::], FD 10
</I>&gt;<i> 2015/03/09 15:23:34 kid4| Adding nameserver 127.0.0.1 from 
</I>&gt;<i> /etc/resolv.conf
</I>&gt;<i> 2015/03/09 15:23:34 kid1| Set Current Directory to 
</I>&gt;<i> /accerater/logs/webcache3/opmizer1
</I>&gt;<i> 2015/03/09 15:23:34 kid2| DNS Socket created at 0.0.0.0, FD 11
</I>&gt;<i> 2015/03/09 15:23:34 kid2| Adding nameserver 127.0.0.1 from 
</I>&gt;<i> /etc/resolv.conf
</I>&gt;<i> 2015/03/09 15:23:34 kid1| Starting Squid Cache version 3.5.2 for 
</I>&gt;<i> x86_64-unknown-linux-gnu...
</I>&gt;<i> 2015/03/09 15:23:34 kid1| Service Name: squid
</I>&gt;<i> 2015/03/09 15:23:34 kid1| Process ID 12051
</I>&gt;<i> 2015/03/09 15:23:34 kid1| Process Roles: worker
</I>&gt;<i> 2015/03/09 15:23:34 kid1| With 4096 file descriptors available
</I>&gt;<i> 2015/03/09 15:23:34 kid1| Initializing IP Cache...
</I>&gt;<i> 2015/03/09 15:23:34 kid1| DNS Socket created at [::], FD 10
</I>&gt;<i> 2015/03/09 15:23:34 kid1| DNS Socket created at 0.0.0.0, FD 11
</I>&gt;<i> 2015/03/09 15:23:34 kid1| Adding nameserver 127.0.0.1 from 
</I>&gt;<i> /etc/resolv.conf
</I>&gt;<i> 2015/03/09 15:23:34 kid3| Logfile: opening log 
</I>&gt;<i> daemon:/accerater/webcache3/var/logs/access.log
</I>&gt;<i> 2015/03/09 15:23:34 kid4| Logfile: opening log 
</I>&gt;<i> daemon:/accerater/webcache3/var/logs/access.log
</I>&gt;<i> 2015/03/09 15:23:34 kid3| Logfile Daemon: opening log 
</I>&gt;<i> /accerater/webcache3/var/logs/access.log
</I>&gt;<i>
</I>&gt;<i> 2015/03/09 15:23:34 kid4| Logfile Daemon: opening log 
</I>&gt;<i> /accerater/webcache3/var/logs/access.log
</I>&gt;<i> 2015/03/09 15:23:34 kid2| Logfile: opening log 
</I>&gt;<i> stdio:/accerater/logs/webcache3/accessb.log
</I>&gt;<i> 2015/03/09 15:23:34 kid1| Logfile: opening log 
</I>&gt;<i> stdio:/accerater/logs/webcache3/accessa.log
</I>&gt;<i> 2015/03/09 15:23:34 kid2| Logfile: opening log 
</I>&gt;<i> stdio:/accerater/logs/webcache3/storeb.log1
</I>&gt;<i> 2015/03/09 15:23:34 kid2| WARNING: disk-cache maximum object size is 
</I>&gt;<i> too large for mem-cache: 102400.00 KB &gt; 90.00 KB
</I>&gt;<i> 2015/03/09 15:23:34 kid2| Swap maxSize 10444800 + 1024000 KB, 
</I>&gt;<i> estimated 882215 objects
</I>&gt;<i> 2015/03/09 15:23:34 kid2| Target number of buckets: 44110
</I>&gt;<i> 2015/03/09 15:23:34 kid2| Using 65536 Store buckets
</I>&gt;<i> 2015/03/09 15:23:34 kid2| Max Mem  size: 1024000 KB [shared]
</I>&gt;<i> 2015/03/09 15:23:34 kid2| Max Swap size: 10444800 KB
</I>&gt;<i> 2015/03/09 15:23:34 kid1| Logfile: opening log 
</I>&gt;<i> stdio:/accerater/logs/webcache3/storea.log1
</I>&gt;<i> 2015/03/09 15:23:34 kid1| WARNING: disk-cache maximum object size is 
</I>&gt;<i> too large for mem-cache: 102400.00 KB &gt; 90.00 KB
</I>&gt;<i> 2015/03/09 15:23:34 kid1| Swap maxSize 10444800 + 1024000 KB, 
</I>&gt;<i> estimated 882215 objects
</I>&gt;<i> 2015/03/09 15:23:34 kid1| Target number of buckets: 44110
</I>&gt;<i> 2015/03/09 15:23:34 kid1| Using 65536 Store buckets
</I>&gt;<i> 2015/03/09 15:23:34 kid1| Max Mem  size: 1024000 KB [shared]
</I>&gt;<i> 2015/03/09 15:23:34 kid1| Max Swap size: 10444800 KB
</I>&gt;<i> 2015/03/09 15:23:34 kid2| Rebuilding storage in 
</I>&gt;<i> /accerater/webcache3/storage/aufs2/2 (dirty log)
</I>&gt;<i> 2015/03/09 15:23:34 kid2| Using Least Load store dir selection
</I>&gt;<i> 2015/03/09 15:23:34 kid2| Set Current Directory to 
</I>&gt;<i> /accerater/logs/webcache3/opmizer1
</I>&gt;<i> 2015/03/09 15:23:34 kid1| Rebuilding storage in 
</I>&gt;<i> /accerater/webcache3/storage/aufs1/1 (dirty log)
</I>&gt;<i> 2015/03/09 15:23:34 kid1| Using Least Load store dir selection
</I>&gt;<i> 2015/03/09 15:23:34 kid1| Set Current Directory to 
</I>&gt;<i> /accerater/logs/webcache3/opmizer1
</I>&gt;<i> 2015/03/09 15:23:34 kid3| Store logging disabled
</I>&gt;<i> 2015/03/09 15:23:34 kid3| Swap maxSize 2709504 + 1024000 KB, estimated 
</I>&gt;<i> 287192 objects
</I>&gt;<i> 2015/03/09 15:23:34 kid3| Target number of buckets: 14359
</I>&gt;<i> 2015/03/09 15:23:34 kid4| Store logging disabled
</I>&gt;<i> 2015/03/09 15:23:34 kid3| Using 16384 Store buckets
</I>&gt;<i> 2015/03/09 15:23:34 kid3| Max Mem  size: 1024000 KB [shared]
</I>&gt;<i> 2015/03/09 15:23:34 kid4| Swap maxSize 0 + 1024000 KB, estimated 78769 
</I>&gt;<i> objects
</I>&gt;<i> 2015/03/09 15:23:34 kid3| Max Swap size: 2709504 KB
</I>&gt;<i> 2015/03/09 15:23:34 kid4| Target number of buckets: 3938
</I>&gt;<i> 2015/03/09 15:23:34 kid4| Using 8192 Store buckets
</I>&gt;<i> 2015/03/09 15:23:34 kid4| Max Mem  size: 1024000 KB [shared]
</I>&gt;<i> 2015/03/09 15:23:34 kid4| Max Swap size: 0 KB
</I>&gt;<i> 2015/03/09 15:23:34 kid4| Using Least Load store dir selection
</I>&gt;<i> 2015/03/09 15:23:34 kid4| Set Current Directory to 
</I>&gt;<i> /accerater/logs/webcache3/opmizer1
</I>&gt;<i>
</I>&gt;<i> 2015/03/09 15:23:34 kid3| Using Least Load store dir selection
</I>&gt;<i> 2015/03/09 15:23:34 kid3| Set Current Directory to 
</I>&gt;<i> /accerater/logs/webcache3/opmizer1
</I>&gt;<i> 2015/03/09 15:23:34 kid1| Finished loading MIME types and icons.
</I>&gt;<i> 2015/03/09 15:23:34 kid1| HTCP Disabled.
</I>&gt;<i> 2015/03/09 15:23:34 kid1| Sending SNMP messages from [::]:3401
</I>&gt;<i> 2015/03/09 15:23:34 kid2| Finished loading MIME types and icons.
</I>&gt;<i> 2015/03/09 15:23:34 kid2| HTCP Disabled.
</I>&gt;<i> 2015/03/09 15:23:34 kid2| Sending SNMP messages from [::]:3402
</I>&gt;<i> 2015/03/09 15:23:34 kid1| Squid plugin modules loaded: 0
</I>&gt;<i> 2015/03/09 15:23:34 kid1| Adaptation support is off.
</I>&gt;<i> 2015/03/09 15:23:34 kid2| Squid plugin modules loaded: 0
</I>&gt;<i> 2015/03/09 15:23:34 kid2| Adaptation support is off.
</I>&gt;<i> 2015/03/09 15:23:34 kid1| Done reading 
</I>&gt;<i> /accerater/webcache3/storage/aufs1/1 swaplog (10 entries)
</I>&gt;<i> 2015/03/09 15:23:34 kid2| Done reading 
</I>&gt;<i> /accerater/webcache3/storage/aufs2/2 swaplog (13 entries)
</I>&gt;<i> 2015/03/09 15:23:34 kid4| Finished loading MIME types and icons.
</I>&gt;<i> 2015/03/09 15:23:34 kid3| Finished loading MIME types and icons.
</I>&gt;<i> 2015/03/09 15:23:34 kid4| Accepting WCCPv2 messages on port 2048, FD 11.
</I>&gt;<i> 2015/03/09 15:23:34 kid4| Initialising all WCCPv2 lists
</I>&gt;<i> 2015/03/09 15:23:34 kid3| Squid plugin modules loaded: 0
</I>&gt;<i> 2015/03/09 15:23:34 kid3| Adaptation support is off.
</I>&gt;<i> 2015/03/09 15:23:34 kid3| Loading cache_dir #0 from 
</I>&gt;<i> /accerater/webcache3/storage/rock1/rock
</I>&gt;<i> 2015/03/09 15:23:34 kid4| Squid plugin modules loaded: 0
</I>&gt;<i> 2015/03/09 15:23:34 kid4| Adaptation support is off.
</I>&gt;<i> 2015/03/09 15:23:34 kid3| Store rebuilding is 0.59% complete
</I>&gt;<i> 2015/03/09 15:23:35 kid1| Finished rebuilding storage from disk.
</I>&gt;<i> 2015/03/09 15:23:35 kid1|        10 Entries scanned
</I>&gt;<i> 2015/03/09 15:23:35 kid1|         0 Invalid entries.
</I>&gt;<i> 2015/03/09 15:23:35 kid1|         0 With invalid flags.
</I>&gt;<i> 2015/03/09 15:23:35 kid1|        10 Objects loaded.
</I>&gt;<i> 2015/03/09 15:23:35 kid1|         0 Objects expired.
</I>&gt;<i> 2015/03/09 15:23:35 kid1|         0 Objects cancelled.
</I>&gt;<i> 2015/03/09 15:23:35 kid1|         0 Duplicate URLs purged.
</I>&gt;<i> 2015/03/09 15:23:35 kid1|         0 Swapfile clashes avoided.
</I>&gt;<i> 2015/03/09 15:23:35 kid1|   Took 1.01 seconds (  9.88 objects/sec).
</I>&gt;<i> 2015/03/09 15:23:35 kid2| Finished rebuilding storage from disk.
</I>&gt;<i> 2015/03/09 15:23:35 kid1| Beginning Validation Procedure
</I>&gt;<i> 2015/03/09 15:23:35 kid2|        13 Entries scanned
</I>&gt;<i> 2015/03/09 15:23:35 kid2|         0 Invalid entries.
</I>&gt;<i>
</I>&gt;<i> 2015/03/09 15:23:35 kid2|         0 With invalid flags.
</I>&gt;<i> 2015/03/09 15:23:35 kid2|        13 Objects loaded.
</I>&gt;<i> 2015/03/09 15:23:35 kid2|         0 Objects expired.
</I>&gt;<i> 2015/03/09 15:23:35 kid2|         0 Objects cancelled.
</I>&gt;<i> 2015/03/09 15:23:35 kid2|         0 Duplicate URLs purged.
</I>&gt;<i> 2015/03/09 15:23:35 kid2|         0 Swapfile clashes avoided.
</I>&gt;<i> 2015/03/09 15:23:35 kid2|   Took 1.01 seconds ( 12.84 objects/sec).
</I>&gt;<i> 2015/03/09 15:23:35 kid2| Beginning Validation Procedure
</I>&gt;<i> 2015/03/09 15:23:35 kid1|   Completed Validation Procedure
</I>&gt;<i> 2015/03/09 15:23:35 kid1|   Validated 10 Entries
</I>&gt;<i> 2015/03/09 15:23:35 kid1|   store_swap_size = 8840.00 KB
</I>&gt;<i> 2015/03/09 15:23:35 kid1| Accepting HTTP Socket connections at 
</I>&gt;<i> local=127.0.0.1:3220 remote=[::] FD 26 flags=1
</I>&gt;<i> 2015/03/09 15:23:35 kid1| Accepting TPROXY intercepted HTTP Socket 
</I>&gt;<i> connections at local=[::]:3221 remote=[::] FD 27 flags=17
</I>&gt;<i> 2015/03/09 15:23:35 kid1| Accepting SNMP messages on [::]:3401
</I>&gt;<i> 2015/03/09 15:23:35 kid2|   Completed Validation Procedure
</I>&gt;<i> 2015/03/09 15:23:35 kid2|   Validated 13 Entries
</I>&gt;<i> 2015/03/09 15:23:35 kid2|   store_swap_size = 16852.00 KB
</I>&gt;<i> 2015/03/09 15:23:35 kid2| Accepting HTTP Socket connections at 
</I>&gt;<i> local=127.0.0.1:3220 remote=[::] FD 26 flags=1
</I>&gt;<i> 2015/03/09 15:23:35 kid2| Accepting TPROXY intercepted HTTP Socket 
</I>&gt;<i> connections at local=[::]:3221 remote=[::] FD 27 flags=17
</I>&gt;<i> 2015/03/09 15:23:35 kid2| Accepting SNMP messages on [::]:3402
</I>&gt;<i> 2015/03/09 15:23:36 kid3| Finished rebuilding storage from disk.
</I>&gt;<i> 2015/03/09 15:23:36 kid3|    169343 Entries scanned
</I>&gt;<i> 2015/03/09 15:23:36 kid3|         0 Invalid entries.
</I>&gt;<i> 2015/03/09 15:23:36 kid3|         0 With invalid flags.
</I>&gt;<i> 2015/03/09 15:23:36 kid3|         0 Objects loaded.
</I>&gt;<i> 2015/03/09 15:23:36 kid3|         0 Objects expired.
</I>&gt;<i> 2015/03/09 15:23:36 kid3|         0 Objects cancelled.
</I>&gt;<i> 2015/03/09 15:23:36 kid3|         0 Duplicate URLs purged.
</I>&gt;<i> 2015/03/09 15:23:36 kid3|         0 Swapfile clashes avoided.
</I>&gt;<i> 2015/03/09 15:23:36 kid3|   Took 1.40 seconds (  0.00 objects/sec).
</I>&gt;<i> 2015/03/09 15:23:36 kid3| Beginning Validation Procedure
</I>&gt;<i> 2015/03/09 15:23:36 kid3|   Completed Validation Procedure
</I>&gt;<i> 2015/03/09 15:23:36 kid3|   Validated 0 Entries
</I>&gt;<i> 2015/03/09 15:23:36 kid3|   store_swap_size = 16.00 KB
</I>&gt;<i> 2015/03/09 15:23:36 kid3| storeLateRelease: released 0 objects
</I>&gt;<i> 2015/03/09 15:23:36 kid1| storeLateRelease: released 0 objects
</I>&gt;<i> 2015/03/09 15:23:36 kid2| storeLateRelease: released 0 objects
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &#20110; 2015&#24180;03&#26376;09&#26085; 13:01, Amos Jeffries &#20889;&#36947;:
</I>&gt;&gt;<i> On 9/03/2015 4:38 p.m., johnzeng wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Hello Dear All :
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I face a problem recently , When i config wccp ( tproxy ) environment (
</I>&gt;&gt;&gt;<i> via using squid 3.5.2 ) ,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> if i disable cache_dir rock part ,and it will be success for wccp(
</I>&gt;&gt;&gt;<i> tproxy) , and enable cache_dir aufs
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> #cache_dir rock /accerater/webcache3/storage/rock1 2646 min-size=4096
</I>&gt;&gt;&gt;<i> max-size=262144 max-swap-rate=250 swap-timeout=350
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> but if i enable cache_dir rock part ,and it will be failure for wccp(
</I>&gt;&gt;&gt;<i> tproxy) and enable cache_dir aufs
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> cache_dir rock /accerater/webcache3/storage/rock1 2646 min-size=4096
</I>&gt;&gt;&gt;<i> max-size=262144 max-swap-rate=250 swap-timeout=350
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Whether some of my config is error , if possible , please give me some
</I>&gt;&gt;&gt;<i> advisement
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i> For starters,
</I>&gt;&gt;<i>   WCCP is a network protocol Squid uses to inform remote routers that it
</I>&gt;&gt;<i> is active and what traffic it can receive.
</I>&gt;&gt;<i>   rock is a layout format for bits stored on a disk.
</I>&gt;&gt;<i>   ... they are *completely* unrelated.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> This is my config
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> thanks
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> coredump_dir /accerater/logs/webcache3/
</I>&gt;&gt;&gt;<i> unlinkd_program /accerater/webcache3/libexec/unlinkd
</I>&gt;&gt;&gt;<i> pid_filename /accerater/logs/webcache3/opmizer1/cache.pid
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> workers 2
</I>&gt;&gt;&gt;<i> cpu_affinity_map process_numbers=1,2 cores=1,3
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> cache_dir rock /accerater/webcache3/storage/rock1 2646 min-size=4096
</I>&gt;&gt;&gt;<i> max-size=262144 max-swap-rate=250 swap-timeout=350
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i> You are telling Squid to start two controllers to the database file
</I>&gt;&gt;<i> /accerater/webcache3/storage/rock1 from *each* worker. There is zero
</I>&gt;&gt;<i> benefit from this and the two controllers may enounter collisions as
</I>&gt;&gt;<i> they compete for acces to the disk without sharing atomic locks. That
</I>&gt;&gt;<i> leads to cache corruption.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Remove one of those two lines.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> if ${process_number} = 1
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> cache_swap_state /accerater/logs/webcache3/opmizer1_swap_log1
</I>&gt;&gt;<i> Dont use cache_swap_state.
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> access_log stdio:/accerater/logs/webcache3/opmizer1_access.log squid
</I>&gt;&gt;<i> Use this instead (mind the wrap):
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> access_log
</I>&gt;&gt;<i> stdio:/accerater/logs/webcache/opmizer${process_number}_access.log squid
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> cache_log /accerater/logs/webcache3/opmizer1_cache.log
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Use this instead:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> cache_log /accerater/logs/webcache3/opmizer${process_number}_cache.log
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> cache_store_log stdio:/accerater/logs/webcache3/opmizer1_store.log
</I>&gt;&gt;<i> You should not need cache_store_log at all.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Either remove it or use this instead (mind the wrap):
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> cache_store_log
</I>&gt;&gt;<i> stdio:/accerater/logs/webcache3/opmizer${process_number}_store.log
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> url_rewrite_program /accerater/webcache3/media/mediatool/media2
</I>&gt;&gt;&gt;<i> store_id_program /accerater/webcache3/media/mediatool/media1
</I>&gt;&gt;<i> Why do you have different binary executable names for the two workers
</I>&gt;&gt;<i> helpers?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If they are actually different, then the traffic will have different
</I>&gt;&gt;<i> things applied randomly depending on which worker happened to accept the
</I>&gt;&gt;<i> TCP connection. If they are the same, then you only need to define them
</I>&gt;&gt;<i> once and workers will start their own sets as needed.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> unique_hostname fast_opmizer1
</I>&gt;&gt;&gt;<i> snmp_port 3401
</I>&gt;&gt;<i> Use this instead:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   unique_hostname fast_opmizer${process_number}
</I>&gt;&gt;<i>   snmp_port 340${process_number}
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> All of the above details can move up out of the per-worker area.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> #cache_dir rock /accerater/webcache3/storage/rock1 2646 min-size=4096
</I>&gt;&gt;&gt;<i> max-size=262144 max-swap-rate=250 swap-timeout=350
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> cache_dir aufs /accerater/webcache3/storage/aufs1/${process_number} 
</I>&gt;&gt;&gt;<i> 5200
</I>&gt;&gt;&gt;<i> 16 64 min-size=262145
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> else
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> #endif
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> if ${process_number} = 2
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> cache_swap_state /accerater/logs/webcache3/opmizer2_swap_log
</I>&gt;&gt;&gt;<i> access_log stdio:/accerater/logs/webcache3/opmizer2_access.log squid
</I>&gt;&gt;&gt;<i> cache_log /accerater/logs/webcache3/opmizer2_cache.log
</I>&gt;&gt;&gt;<i> cache_store_log stdio:/accerater/logs/webcache3/opmizer2_store.log
</I>&gt;&gt;&gt;<i> url_rewrite_program /accerater/webcache3/media/mediatool/media4
</I>&gt;&gt;&gt;<i> store_id_program /accerater/webcache3/media/mediatool/media3
</I>&gt;&gt;&gt;<i> unique_hostname fast_opmizer2
</I>&gt;&gt;&gt;<i> snmp_port 3402
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i> Same notes as for worker 1.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> #cache_dir rock /accerater/webcache3/storage/rock2 2646 min-size=4096
</I>&gt;&gt;&gt;<i> max-size=262144 max-swap-rate=250 swap-timeout=350
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> cache_dir aufs /accerater/webcache3/storage/aufs1/${process_number} 
</I>&gt;&gt;&gt;<i> 5200
</I>&gt;&gt;&gt;<i> 16 64 min-size=262145
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> endif
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> endif
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> http_port 127.0.0.1:3220
</I>&gt;&gt;&gt;<i> http_port 3221 tproxy
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> wccp_version 2
</I>&gt;&gt;&gt;<i> wccp2_router 192.168.2.1
</I>&gt;&gt;&gt;<i> wccp2_forwarding_method 1
</I>&gt;&gt;&gt;<i> wccp2_return_method 1
</I>&gt;&gt;&gt;<i> wccp2_assignment_method 1
</I>&gt;&gt;&gt;<i> wccp2_service dynamic 80
</I>&gt;&gt;&gt;<i> wccp2_service dynamic 90
</I>&gt;&gt;&gt;<i> wccp2_service_info 80 protocol=tcp flags=src_ip_hash priority=240 
</I>&gt;&gt;&gt;<i> ports=80
</I>&gt;&gt;&gt;<i> wccp2_service_info 90 protocol=tcp flags=dst_ip_hash,ports_source
</I>&gt;&gt;&gt;<i> priority=240 ports=80
</I>&gt;&gt;<i> Both workers are telling the WCCP router in different packets that they
</I>&gt;&gt;<i> are available on the same IP:port. In theory that should work fine,
</I>&gt;&gt;<i> since the router is just getting twice as many updates as it needs to
</I>&gt;&gt;<i> keep the proxy registered. In practice some people are finding that
</I>&gt;&gt;<i> certain routers cant cope with the extra registration operations.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> tcp_outgoing_address 192.168.2.2
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i> Be aware that TPROXY spoof the client outgong address. This line has no
</I>&gt;&gt;<i> effect on the TPROXY intercepted traffic. Only the traffic received on
</I>&gt;&gt;<i> port 3220 will be using this outgoing address.
</I>&gt;&gt;<i>   Your WCCP rules need to account for that by not depending on the 
</I>&gt;&gt;<i> packet
</I>&gt;&gt;<i> IP addresses.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Amos
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="002650.html">[squid-users] Whether squid 3.5.2 can support rock at wccp tproxy environment really ?
</A></li>
	<LI>Next message (by thread): <A HREF="002652.html">[squid-users] Whether squid 3.5.2 can support rock at wccp tproxy environment really ? ( there are same problem between smp model or single model )
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2651">[ date ]</a>
              <a href="thread.html#2651">[ thread ]</a>
              <a href="subject.html#2651">[ subject ]</a>
              <a href="author.html#2651">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
