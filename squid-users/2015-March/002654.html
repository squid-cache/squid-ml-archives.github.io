<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] negotiate_wrapper: fgets() failed! dying..
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20negotiate_wrapper%3A%20fgets%28%29%20failed%21%20dying..&In-Reply-To=%3CCAC49LV6SRXbiFcGxqZgAoaHPj1qeifERtSN63ZrDsa_b%3DiW%2B1Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002637.html">
   <LINK REL="Next"  HREF="002747.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] negotiate_wrapper: fgets() failed! dying..</H1>
    <B>Donny Vibianto</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20negotiate_wrapper%3A%20fgets%28%29%20failed%21%20dying..&In-Reply-To=%3CCAC49LV6SRXbiFcGxqZgAoaHPj1qeifERtSN63ZrDsa_b%3DiW%2B1Q%40mail.gmail.com%3E"
       TITLE="[squid-users] negotiate_wrapper: fgets() failed! dying..">donny.vibianto at gmail.com
       </A><BR>
    <I>Mon Mar  9 14:20:52 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="002637.html">[squid-users] negotiate_wrapper: fgets() failed! dying..
</A></li>
        <LI>Next message (by thread): <A HREF="002747.html">[squid-users] negotiate_wrapper: fgets() failed! dying..
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2654">[ date ]</a>
              <a href="thread.html#2654">[ thread ]</a>
              <a href="subject.html#2654">[ subject ]</a>
              <a href="author.html#2654">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>anyone please...?

On Sat, Mar 7, 2015 at 10:02 PM, Donny Vibianto &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">donny.vibianto at gmail.com</A>&gt;
wrote:

&gt;<i> Hi Guys,
</I>&gt;<i>
</I>&gt;<i> After two weeks successful running several authentication in my
</I>&gt;<i> development environment with average 10-20 users, i encourage myself to put
</I>&gt;<i> in my production. it was up and ran with +-1000 users but only took 3-5
</I>&gt;<i> hours then squid suddenly stopped with error:
</I>&gt;<i>
</I>&gt;<i> 2015/03/06 15:07:59| negotiate_wrapper: fgets() failed! dying..... errno=1
</I>&gt;<i> (Operation not permitted)
</I>&gt;<i> 2015/03/06 15:07:59| negotiate_wrapper: fgets() failed! dying..... errno=1
</I>&gt;<i> (Operation not permitted)
</I>&gt;<i> 2015/03/06 15:07:59| negotiate_wrapper: fgets() failed! dying..... errno=1
</I>&gt;<i> (Operation not permitted)
</I>&gt;<i> 2015/03/06 15:07:59| negotiate_wrapper: Return 'AF
</I>&gt;<i> oYG2MIGzoAMKAQChCwYJKoZIhvcSAQICooGeBIGbYIGYBgkqhkiG9xIBAgICAG+BiDCBhaADAgEFoQMCAQ+ieTB3oAMCARKicARupdwIysaz6zjRSqsI8V4K0X67z4t5a9aOT7WPlyWRrp+1ol2zL6CYTcfZIyAq8q3D00mf+vpIeoiDDmkUkr+vXN+xkpXkWdX5pMD1hBrF4EDOL1RIp9XjpkdfIcEgg8Oia0Ay153sPK3+Tif4bGE=
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">RickyC at company.local</A>
</I>&gt;<i> '
</I>&gt;<i> 2015/03/06 15:07:59| negotiate_wrapper: Return 'AF
</I>&gt;<i> oYG1MIGyoAMKAQChCwYJKoZIhvcSAQICooGdBIGaYIGXBgkqhkiG9xIBAgICAG+BhzCBhKADAgEFoQMCAQ+ieDB2oAMCARKibwRtX5xuxTxrgsKQpg3Y+kUXLOng15XJ7eDByao5YtNPZByv/zRtrz13QgKkCuk+VkXnCAzaii0ri4Mxvd+4BoskIrjf5FuPP3W59wMTCtkPJD85igR/OmQ4Ch09DJ51WGwnOizMuCW+9jg6EsFa1Q==
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">JanTS at company.local</A>
</I>&gt;<i>
</I>&gt;<i> i use ubuntu server 14.04 with newest squid 3.5.2
</I>&gt;<i>
</I>&gt;<i> Squid Cache: Version 3.5.2
</I>&gt;<i> Service Name: squid
</I>&gt;<i> configure options:  '--enable-build-info'
</I>&gt;<i> '--enable-removal-policies=lru,heap' '--enable-ltdl-install'
</I>&gt;<i> '--enable-storeio=ufs,aufs,rock' '--enable-auth-basic=LDAP'
</I>&gt;<i> '--enable-auth-negotiate=wrapper,kerberos'
</I>&gt;<i> '--enable-external-acl-helpers=LDAP_group' '--enable-translation'
</I>&gt;<i> '--enable-ssl-crtd' '--enable-gnuregex' '--enable-xmalloc-debug'
</I>&gt;<i> '--enable-xmalloc-debug-trace' '--enable-xmalloc-statistics'
</I>&gt;<i> '--enable-async-io' '--enable-icmp' '--enable-delay-pools'
</I>&gt;<i> '--enable-useragent-log' '--enable-kill-parent-hack' '--enable-htpc'
</I>&gt;<i> '--enable-forw-via-db' '--enable-cache-digests' '--enable-underscores'
</I>&gt;<i> '--enable-x-accelerator-vary' '--enable-esi' '--enable-inline'
</I>&gt;<i> '--enable-linux-netfilter' '--with-openssl' '--with-large-files'
</I>&gt;<i>
</I>&gt;<i> here is my squid.conf:
</I>&gt;<i>
</I>&gt;<i> # ===================== ACL Cachemgr
</I>&gt;<i> ============================================
</I>&gt;<i> acl manager url_regex -i ^cache_<A HREF="object://">object://</A> /squid-internal-mgr/
</I>&gt;<i> acl managerAdmin src &quot;/usr/local/squid/etc/mgradmin.txt&quot;
</I>&gt;<i> acl stream url_regex -i &quot;/usr/local/squid/etc/stream&quot;
</I>&gt;<i>
</I>&gt;<i> acl download url_regex -i &quot;/usr/local/squid/etc/download&quot;
</I>&gt;<i> acl whitelist url_regex -i &quot;/usr/local/squid/etc/whitelist&quot;
</I>&gt;<i> acl blacklist url_regex -i &quot;/usr/local/squid/etc/blacklist&quot;
</I>&gt;<i>
</I>&gt;<i> acl SSL_ports port 443
</I>&gt;<i> acl Safe_ports port 80 # http
</I>&gt;<i> acl Safe_ports port 21 # ftp
</I>&gt;<i> acl Safe_ports port 443 # https
</I>&gt;<i> acl Safe_ports port 70 # gopher
</I>&gt;<i> acl Safe_ports port 210 # wais
</I>&gt;<i> acl Safe_ports port 1025-65535 # unregistered ports
</I>&gt;<i> acl Safe_ports port 280 # http-mgmt
</I>&gt;<i> acl Safe_ports port 488 # gss-http
</I>&gt;<i> acl Safe_ports port 591 # filemaker
</I>&gt;<i> acl Safe_ports port 777 # multiling http
</I>&gt;<i> acl http proto http
</I>&gt;<i> acl CONNECT method CONNECT
</I>&gt;<i>
</I>&gt;<i> # ==================== Authenticate using negotiate_wrapper
</I>&gt;<i> =====================
</I>&gt;<i> auth_param negotiate program
</I>&gt;<i> /usr/local/squid/libexec/negotiate_wrapper_auth -d --ntlm
</I>&gt;<i> /usr/bin/ntlm_auth --diagnostics --helper-protocol=squid-2.5-ntlmssp
</I>&gt;<i> --kerberos /usr/local/squid/libexec/negotiate_kerberos_auth -s GSS_C_NO_NAME
</I>&gt;<i> auth_param negotiate children 50 startup=0 idle=1
</I>&gt;<i> auth_param negotiate keep_alive off
</I>&gt;<i> # ==================== Authenticate using NTLM
</I>&gt;<i> ==================================
</I>&gt;<i> auth_param ntlm program /usr/bin/ntlm_auth --diagnostics
</I>&gt;<i> --helper-protocol=squid-2.5-ntlmssp
</I>&gt;<i> auth_param ntlm children 20 startup=0 idle=1
</I>&gt;<i> auth_param ntlm keep_alive off
</I>&gt;<i> # ==================== Authenticate using Basic LDAP
</I>&gt;<i> ============================
</I>&gt;<i> auth_param basic program /usr/local/squid/libexec/basic_ldap_auth -R -b
</I>&gt;<i> &quot;dc=company,dc=local&quot; -D <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid at company.local</A> -w &quot;password&quot; -f
</I>&gt;<i> sAMAccountName=%s -h idhqvdc01.company.local,idhqvdc02.company.local
</I>&gt;<i> auth_param basic children 5 startup=0 idle=1
</I>&gt;<i> auth_param basic realm AGDS Proxy: Please enter your username and password
</I>&gt;<i> domain
</I>&gt;<i> auth_param basic credentialsttl 1 minute
</I>&gt;<i> # ==================== Authenticate to Group Security Actice Directory
</I>&gt;<i> ==========
</I>&gt;<i> external_acl_type memberof ipv4 children-max=10 children-startup=1 %LOGIN
</I>&gt;<i> /usr/local/squid/libexec/ext_ldap_group_acl -R -K -S -b
</I>&gt;<i> &quot;dc=company,dc=local&quot; -D <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid at company.local</A> -w &quot;password&quot; -f
</I>&gt;<i> &quot;(&amp;(objectclass=person)(sAMAccountName=%v)(memberof=CN=%g,ou=groups,ou=resources,dc=company,dc=local))&quot;
</I>&gt;<i> -h idhqvdc01.company.local,idhqvdc02.company.local
</I>&gt;<i>
</I>&gt;<i> acl auth proxy_auth REQUIRED
</I>&gt;<i> # ==================== ACL Access hour user
</I>&gt;<i> =====================================
</I>&gt;<i> acl ach1 external memberof &quot;/usr/local/squid/etc/ach1.txt&quot; # access hour 1
</I>&gt;<i> acl ach2 external memberof &quot;/usr/local/squid/etc/ach2.txt&quot; # access hour 2
</I>&gt;<i> acl ach3 external memberof &quot;/usr/local/squid/etc/ach3.txt&quot; # access hour 3
</I>&gt;<i> acl ach4 external memberof &quot;/usr/local/squid/etc/ach4.txt&quot; # access hour 4
</I>&gt;<i> acl ach2time time D 10:00-11:59
</I>&gt;<i> acl ach2time time D 13:00-14:59
</I>&gt;<i> acl ach3time time D 08:00-09:59
</I>&gt;<i> acl ach3time time D 15:00-16:59
</I>&gt;<i> acl ach4time time D 08:00-16:59
</I>&gt;<i> acl bebastime time D 00:01-07:59 12:00-13:59 17:00-23:59
</I>&gt;<i>
</I>&gt;<i> #
</I>&gt;<i> ==============================================================================
</I>&gt;<i> http_access deny !Safe_ports # Deny requests to certain unsafe ports
</I>&gt;<i> http_access deny CONNECT !SSL_ports # Deny CONNECT to other than secure
</I>&gt;<i> SSL ports
</I>&gt;<i> http_access allow manager localhost # Only allow cachemgr access from
</I>&gt;<i> localhost
</I>&gt;<i> http_access allow manager managerAdmin
</I>&gt;<i> http_access deny manager
</I>&gt;<i>
</I>&gt;<i> #
</I>&gt;<i> ==============================================================================
</I>&gt;<i> #http_access allow localnet
</I>&gt;<i> http_access allow localhost
</I>&gt;<i> http_access deny blacklist !bebastime
</I>&gt;<i>
</I>&gt;<i> http_access allow http Safe_ports whitelist
</I>&gt;<i> http_access allow CONNECT SSL_ports whitelist
</I>&gt;<i> #http_access deny all !auth
</I>&gt;<i>
</I>&gt;<i> #http_access allow http Safe_ports ach1
</I>&gt;<i> #http_access allow CONNECT SSL_ports ach1
</I>&gt;<i> #http_access allow http Safe_ports ach2 !ach2time
</I>&gt;<i> #http_access allow CONNECT SSL_ports ach2 !ach2time
</I>&gt;<i> #http_access allow http Safe_ports ach3 !ach3time
</I>&gt;<i> #http_access allow CONNECT SSL_ports ach3 !ach3time
</I>&gt;<i> #http_access allow http Safe_ports ach4 !ach4time
</I>&gt;<i> #http_access allow CONNECT SSL_ports ach4 !ach4time
</I>&gt;<i>
</I>&gt;<i> #http_access allow accesshours1
</I>&gt;<i> #http_access allow accesshours2 !ach2time
</I>&gt;<i> #http_access allow accesshours3 !ach3time
</I>&gt;<i> #http_access allow accesshours4 !ach3time
</I>&gt;<i>
</I>&gt;<i> http_access allow ach1
</I>&gt;<i> http_access allow ach2 !ach2time
</I>&gt;<i> http_access allow ach3 !ach3time
</I>&gt;<i> http_access allow ach4 !ach4time
</I>&gt;<i>
</I>&gt;<i> http_access deny all # Deny all other access to this proxy
</I>&gt;<i> #
</I>&gt;<i> ==============================================================================
</I>&gt;<i>
</I>&gt;<i> cache_dir rock /cache1/squid 97485 max-swap-rate=200 swap-timeout=300
</I>&gt;<i> cache_dir rock /cache2/squid 97485 max-swap-rate=200 swap-timeout=300
</I>&gt;<i> coredump_dir /usr/local/squid/var/cache/squid
</I>&gt;<i> # =============================== Refresh Pattern
</I>&gt;<i> ==============================
</I>&gt;<i> refresh_pattern ^ftp: 1440 20% 10080
</I>&gt;<i> refresh_pattern ^gopher: 1440 0% 1440
</I>&gt;<i> refresh_pattern -i (/cgi-bin/|\?) 0 0% 0
</I>&gt;<i> refresh_pattern . 0 20% 4320
</I>&gt;<i>
</I>&gt;<i> cache_effective_user proxy
</I>&gt;<i> visible_hostname proxy.company.local
</I>&gt;<i> cache_mgr proxyastragraphia
</I>&gt;<i> cachemgr_passwd secret all
</I>&gt;<i> #err_page_stylesheet /usr/local/squid/etc/default.css
</I>&gt;<i> pinger_enable off
</I>&gt;<i> #workers 2
</I>&gt;<i>
</I>&gt;<i> i was tried to put different acl and put my auth_param at the top of my
</I>&gt;<i> conf but still dying error. what should i do?
</I>&gt;<i> any assistant or hint would be very appreciate. thanks
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Donny Vibianto
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150309/d8c8b1b7/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150309/d8c8b1b7/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="002637.html">[squid-users] negotiate_wrapper: fgets() failed! dying..
</A></li>
	<LI>Next message (by thread): <A HREF="002747.html">[squid-users] negotiate_wrapper: fgets() failed! dying..
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2654">[ date ]</a>
              <a href="thread.html#2654">[ thread ]</a>
              <a href="subject.html#2654">[ subject ]</a>
              <a href="author.html#2654">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
