<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Authentication help
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Authentication%20help&In-Reply-To=%3C55000465.4020106%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002610.html">
   <LINK REL="Next"  HREF="002616.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Authentication help</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Authentication%20help&In-Reply-To=%3C55000465.4020106%40treenet.co.nz%3E"
       TITLE="[squid-users] Authentication help">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Mar 11 09:01:25 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="002610.html">[squid-users] Authentication help
</A></li>
        <LI>Next message (by thread): <A HREF="002616.html">[squid-users] how to avoid browser finger printing using squid3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2687">[ date ]</a>
              <a href="thread.html#2687">[ thread ]</a>
              <a href="subject.html#2687">[ subject ]</a>
              <a href="author.html#2687">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 6/03/2015 9:49 a.m., Informatico Neurodesarrollo wrote:
&gt;<i> Hi list,
</I>&gt;<i> I am new in the list and I want to solve a problem with the
</I>&gt;<i> authentication process in the factory that I worked some years ago and
</I>&gt;<i> in this place I began work with Linux.
</I>&gt;<i> They use openSuSE 13.2 (64bits) with squid 3.4.4, the specification are:
</I>&gt;<i> - the authentication is local, Unix users
</I>&gt;<i> - two groups created :intranet (only can access to domain &quot;.cu&quot; ),internet
</I>&gt;<i> 
</I>&gt;<i> What is the deal?:
</I>&gt;<i> 
</I>&gt;<i> When I try to access, in the surfer arise a windows ask me the user and
</I>&gt;<i> password, but when I push Enter key, this windows arise again and I have
</I>&gt;<i> to press several times the &quot;ESC&quot; key to can navigate.
</I>
The client software (browser?) is responsible for locating suitable
credentials that teh authenticatio system will accept. The popup window
you are seeing is one of several options available to it and most modern
browsers use it as a last resort only if the automated alternatives fail.

If the proxy is offering multiple types of authentication and the client
browser sends the credentials for Type A when they should have been
labeled type B, then you can see the popup happen multiple times. There
is nothing we (the proxy people) can do about this type of problem in
the client browser.


It can also keep popping up if your rules say that the provided
credentials are not adequate for the access desired, but other
credentials might work. Your brower is given a chance to try those other
credentials.

So lets look at the specific config...

&gt;<i> 
</I>&gt;<i> I attach bellow squid.conf file.
</I>&gt;<i> 
</I>&gt;<i> My best regards.
</I>&gt;<i> 
</I>&gt;<i> PD Apologist my english, but if any body else understand Spanish
</I>&gt;<i> language I can explain better.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> squid.conf:
</I>&gt;<i> 
</I>&gt;<i> # Squid normally listens to port 3128
</I>&gt;<i> http_port 3128
</I>&gt;<i>
</I>&lt;snip&gt;
&gt;<i> 
</I>&gt;<i> ########################################################
</I>&gt;<i> #Autenticaci&#243;n
</I>&gt;<i> 
</I>&gt;<i> auth_param basic program /usr/sbin/basic_getpwnam_auth --helper-protocol=squid-2.5-basic
</I>&gt;<i> auth_param basic children 20
</I>&gt;<i> auth_param basic realm Servidor Proxy JVR
</I>&gt;<i> auth_param basic credentialsttl 1 hours
</I>&gt;<i> auth_param basic casesensitive off
</I>&gt;<i> 
</I>
NOTE: The basic_getpwnam_auth helper does not take any command line
parameter &quot;--helper-protocol=squid-2.5-basic&quot;

That should not have been causing any issue though. These settings
appear to be fine other than the garbage parameer.


&gt;<i> ############
</I>&gt;<i> #Grupos Unix
</I>&gt;<i> 
</I>&gt;<i> external_acl_type groupo_linux %LOGIN /usr/sbin/ext_unix_group_acl -p
</I>&gt;<i> 
</I>&gt;<i> acl nav_nac external groupo_linux intranet
</I>&gt;<i> acl nav_int external groupo_linux internet
</I>
The above two ACls will match the groups.

&gt;<i> 
</I>&gt;<i> acl nav_full proxy_auth nav_int
</I>&gt;<i> acl nav_cuba proxy_auth nav_nac
</I>
The above two ACLs will match the *individual user login* name &quot;nav_int&quot;
or &quot;nav_nac&quot;.

&gt;<i> 
</I>&gt;<i> acl Auth_jvr proxy_auth REQUIRED
</I>&gt;<i> 
</I>
&lt;snip&gt;
&gt;<i> cache_log /var/log/squid/cache.log
</I>&gt;<i> access_log /var/log/squid/access.log
</I>&gt;<i> cache_store_log /var/log/squid/store.log
</I>&gt;<i> error_directory /usr/share/squid/errors/es
</I>
I recommend setting this instead:
 default_error_language es

Your Squid will then report errors your users can read (with Espanol as
default), instead of forcing Espanol on all of them.

&gt;<i> 
</I>&gt;<i> acl localnet src 10.44.1.0/24
</I>&gt;<i> acl SSL_ports port 443
</I>&gt;<i> acl Safe_ports port 80
</I>&gt;<i> acl Safe_ports port 21
</I>&gt;<i> acl Safe_ports port 443
</I>&gt;<i> acl Safe_ports port 70
</I>&gt;<i> acl Safe_ports port 210
</I>&gt;<i> acl Safe_ports port 1025-65535
</I>&gt;<i> acl Safe_ports port 280
</I>&gt;<i> acl Safe_ports port 488
</I>&gt;<i> acl Safe_ports port 591
</I>&gt;<i> acl Safe_ports port 777
</I>&gt;<i> acl CONNECT method CONNECT
</I>&gt;<i> 
</I>&gt;<i> acl restricted_sites dstdomain &quot;/etc/squid/listas/blocked_sites.acl&quot;
</I>&gt;<i> acl restricted_dst dst &quot;/etc/squid/listas/blocked_src&quot;
</I>&gt;<i> acl nacional dstdomain .cu
</I>&gt;<i> 
</I>&gt;<i> # Regla para denegar palabras indebidas
</I>&gt;<i> acl palabras url_regex -i &quot;/etc/squid/deneg&quot;
</I>&gt;<i> 
</I>&lt;snip&gt;
&gt;<i> 
</I>&gt;<i> http_access allow localnet !restricted_sites !restricted_dst !palabras
</I>&gt;<i> http_access allow Auth_jvr nav_full !nav_nac
</I>
The above rule will require authentication for the single user name
&quot;nav_int&quot; in the group &quot;internet&quot;. Otherwise will request new
credentials that can pass the tests (the popup).

&gt;<i> http_access allow Auth_jvr nav_cuba nacional
</I>
The above will request authentication, and if it provide and the other
check passes will allow the request. Due to the &quot;nacional&quot; ACL being lat
it will NOT request different credentials.


I suspect your use of individual username ACLs is a mistake. Your policy
description only mentioned restricting access by group.

Which means your custom ACL tests should be:

 # allow access *from* LAN machines unless requesting restricted URLs
 http_access allow localnet !restricted_sites !restricted_dst !palabras

 # require login for restricted URLs
 http_access deny !Auth_jvr

 # group &quot;internet&quot; users can access anywhere
 http_access allow nav_int all

 # group &quot;intranet&quot; users can access restricted .cu domains
 http_access allow nav_cuba nacional


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="002610.html">[squid-users] Authentication help
</A></li>
	<LI>Next message (by thread): <A HREF="002616.html">[squid-users] how to avoid browser finger printing using squid3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2687">[ date ]</a>
              <a href="thread.html#2687">[ thread ]</a>
              <a href="subject.html#2687">[ subject ]</a>
              <a href="author.html#2687">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
