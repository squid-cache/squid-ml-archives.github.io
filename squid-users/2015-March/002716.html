<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] urlpath_regex
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20urlpath_regex&In-Reply-To=%3CHKNPR04MB193735C575E1581AB2290C6E8060%40HKNPR04MB193.apcprd04.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002792.html">
   <LINK REL="Next"  HREF="002721.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] urlpath_regex</H1>
    <B>James Harper</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20urlpath_regex&In-Reply-To=%3CHKNPR04MB193735C575E1581AB2290C6E8060%40HKNPR04MB193.apcprd04.prod.outlook.com%3E"
       TITLE="[squid-users] urlpath_regex">james at ejbdigital.com.au
       </A><BR>
    <I>Thu Mar 12 08:14:49 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="002792.html">[squid-users] keep data after delete swap.state
</A></li>
        <LI>Next message (by thread): <A HREF="002721.html">[squid-users] urlpath_regex
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2716">[ date ]</a>
              <a href="thread.html#2716">[ thread ]</a>
              <a href="subject.html#2716">[ subject ]</a>
              <a href="author.html#2716">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have just noticed that urlpath_regex isn't doing what I want:

acl wuau_repo dstdomain .download.windowsupdate.com
acl wuau_path urlpath_regex -i \.psf$
acl dst_server dstdomain server
acl apt_cacher browser apt-cacher

cache deny dst_server
cache deny apt_cacher
cache deny wuau_repo
cache allow all

url_rewrite_program /usr/local/squid/libexec/ext_apt_rewrite
url_rewrite_children 5 startup=0 idle=1 concurrency=0
url_rewrite_access deny apt_cacher
url_rewrite_access allow wuau_repo wuau_path
url_rewrite_access deny all

Basically I am using apt-cacher to cache windows updates (apt-cacher appears to handle and cache partial requests nicely while squid doesn't). The main static windows update content files appear to be .psf. So basically, if the destination is windows update, and the path ends in .psf, then rewrite the url to go to my apt-cacher server (called server, conveniently). If the browser string is apt-cacher then don't rewrite, to avoid loops. Also don't cache anything to do with these servers.

It works except for the wuau_path acl. The line:

url_rewrite_access allow wuau_repo wuau_path

matches all paths on the wuau_repo access list, not just those ending in .psf. I get hits for paths ending in .cab, and even worse, paths with a ? in them.

What am I doing wrong?

Thanks

James



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="002792.html">[squid-users] keep data after delete swap.state
</A></li>
	<LI>Next message (by thread): <A HREF="002721.html">[squid-users] urlpath_regex
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2716">[ date ]</a>
              <a href="thread.html#2716">[ thread ]</a>
              <a href="subject.html#2716">[ subject ]</a>
              <a href="author.html#2716">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
