<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid &quot;internal?&quot; loop - with no firewall nat going on..?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20%22internal%3F%22%20loop%20-%20with%20no%20firewall%20nat%0A%20going%20on..%3F&In-Reply-To=%3C55019447.5000304%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002735.html">
   <LINK REL="Next"  HREF="002738.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid &quot;internal?&quot; loop - with no firewall nat going on..?</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20%22internal%3F%22%20loop%20-%20with%20no%20firewall%20nat%0A%20going%20on..%3F&In-Reply-To=%3C55019447.5000304%40treenet.co.nz%3E"
       TITLE="[squid-users] squid &quot;internal?&quot; loop - with no firewall nat going on..?">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Mar 12 13:27:35 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="002735.html">[squid-users] squid &quot;internal?&quot; loop - with no firewall nat going on..?
</A></li>
        <LI>Next message (by thread): <A HREF="002738.html">[squid-users] squid &quot;internal?&quot; loop - with no firewall nat going on..?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2737">[ date ]</a>
              <a href="thread.html#2737">[ thread ]</a>
              <a href="subject.html#2737">[ subject ]</a>
              <a href="author.html#2737">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 13/03/2015 1:52 a.m., Klavs Klavsen wrote:
&gt;<i> I'd rather not have to route everything (incl. normal ingoing web
</I>&gt;<i> traffic) through the squid box.. and the firewalls are proprietary stuff
</I>&gt;<i> - so can't install squid there :)
</I>
You don't, port 80 TCP is all that *needs* it, and only for the traffic
from clients you want to go through Squid.

If you are passing outgoing web traffic through Squid the responses
(incoming) have to come back through it.

If you have external stuff making requests to internal servers, that can
be left alone in the same way Squid' outgoing traffic is.

Are we talking more or less than 100Mbps of port 80 traffic here?


&gt;<i> 
</I>&gt;<i> It works fine in accel mode.. and I can limit what urls each client ip
</I>&gt;<i> is able to access, and disable caching..
</I>&gt;<i> 
</I>&gt;<i> Shouldn't accel mode, for this use case (curl access from websites - all
</I>&gt;<i> using http/1.1 with host header) be good enough - or are there security
</I>&gt;<i> issues I am not aware of?
</I>
You guessed it. CVE-2009-0801 - the Host header is not trustworthy.
accel/reverse-proxy mode has no protection at all since the upstream
servers are expected to be explicitly configured or the allowed domains
restricted to those hosted by the CDN the proxy is part of.

... and the Host header is not always present, though that case has
declined a lot in the past few years.


&gt;<i> 
</I>&gt;<i> I realize I move the DNS lookup to the squid box - but that's actually
</I>&gt;<i> what I want in this case.
</I>
Actually you will need two DN lookups to be happening if you use accel.
Only the intercept mode with NAT lookups has ability to avoid the second
one by using ORIGINAL_DST.

accel mode normaly avoids the second DNS lookup by having the upstream
servers explicitly configured. You dont want to do that manually for
every Internet server in existence so forcing a DNS lookup with
&quot;always_direct allow all&quot; is required.


Routings your friend, really :-)

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="002735.html">[squid-users] squid &quot;internal?&quot; loop - with no firewall nat going on..?
</A></li>
	<LI>Next message (by thread): <A HREF="002738.html">[squid-users] squid &quot;internal?&quot; loop - with no firewall nat going on..?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2737">[ date ]</a>
              <a href="thread.html#2737">[ thread ]</a>
              <a href="subject.html#2737">[ subject ]</a>
              <a href="author.html#2737">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
