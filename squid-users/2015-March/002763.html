<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] peek/splice working with lynx but not with firefox or chrome [SOLVED]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20peek/splice%20working%20with%20lynx%20but%20not%20with%0A%20firefox%20or%20chrome%20%5BSOLVED%5D&In-Reply-To=%3CCAOoFbVc6rNgYdK_BwONLMGphaF-7o%3D7oGr0J%3DWBZL%2BJ8OY1KcQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002682.html">
   <LINK REL="Next"  HREF="002683.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] peek/splice working with lynx but not with firefox or chrome [SOLVED]</H1>
    <B>john jacob</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20peek/splice%20working%20with%20lynx%20but%20not%20with%0A%20firefox%20or%20chrome%20%5BSOLVED%5D&In-Reply-To=%3CCAOoFbVc6rNgYdK_BwONLMGphaF-7o%3D7oGr0J%3DWBZL%2BJ8OY1KcQ%40mail.gmail.com%3E"
       TITLE="[squid-users] peek/splice working with lynx but not with firefox or chrome [SOLVED]">john.kj1984 at gmail.com
       </A><BR>
    <I>Fri Mar 13 14:40:35 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="002682.html">[squid-users] peek/splice working with lynx but not with firefox or chrome [SOLVED]
</A></li>
        <LI>Next message (by thread): <A HREF="002683.html">[squid-users] Squid Reverse Proxy to Exchange 2010 OWA
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2763">[ date ]</a>
              <a href="thread.html#2763">[ thread ]</a>
              <a href="subject.html#2763">[ subject ]</a>
              <a href="author.html#2763">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I am also having similar environment with squid (version 3.5.2
-20150218-r13758) and openssl 1.0.1k, but for me only small number of https
sites are working with peek and splice. For eg:- , I can access
<A HREF="https://www.google.com">https://www.google.com</A> but not <A HREF="https://ssllabs.com">https://ssllabs.com</A> and lot of other https
domains, giving &quot;Error negotiating SSL on FD 15: error:140920E3:SSL
routines:SSL3_GET_SERVER_HELLO:parse tlsext (1/-1/0) &quot; in the cache.log
file.

Also I could see a bunch of other error messages in the cache.log files
relating to openssl (like &quot;Error negotiating SSL on FD 21:
error:14094085:SSL routines:SSL3_READ_BYTES:ccs received early (1/-1/0)&quot; ,
&quot;Error verifying certificates &quot; etc)  when tried to access sites like
<A HREF="https://www.facebook.com,">https://www.facebook.com,</A> <A HREF="https://www.yahoo.com">https://www.yahoo.com</A> etc

Squid is running on a CentOS 7 x64 box and Workstation is Win7 with Firefox
and Chrome. I tried configuring openssl with disabling certain options with
no-nextprotoneg  and no-ec as well as with recent openssl version1.0.2 ,
but without any success.

Below is my squid config file.

acl localnet src 10.0.0.0/8 # RFC1918 possible internal network
acl localnet src 172.16.0.0/12 # RFC1918 possible internal network
acl localnet src 192.168.0.0/16 # RFC1918 possible internal network
acl localnet src fc00::/7       # RFC 4193 local private network range
acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged)
machines

acl SSL_ports port 443
acl Safe_ports port 80 # http
acl Safe_ports port 21 # ftp
acl Safe_ports port 443 # https
acl Safe_ports port 70 # gopher
acl Safe_ports port 210 # wais
acl Safe_ports port 1025-65535 # unregistered ports
acl Safe_ports port 280 # http-mgmt
acl Safe_ports port 488 # gss-http
acl Safe_ports port 591 # filemaker
acl Safe_ports port 777 # multiling http
acl CONNECT method CONNECT

#
# Recommended minimum Access Permission configuration:
#
# Deny requests to certain unsafe ports
http_access deny !Safe_ports

# Deny CONNECT to other than secure SSL ports
http_access deny CONNECT !SSL_ports

# Only allow cachemgr access from localhost
http_access allow localhost manager
http_access deny manager
http_access allow localnet
http_access allow localhost

# And finally deny all other access to this proxy
http_access deny all

ssl_bump peek all
ssl_bump splice all

# Squid normally listens to port 3128
http_port &lt;WAN Interface IP&gt;:3128
http_port &lt;WAN Interface IP&gt;:3129 intercept
https_port &lt;WAN Interface IP&gt;:3130 intercept ssl-bump
cert=/tmp/sslcertificates/server.cert.pem
key=/tmp/sslcertificates/server.key.pem

Does this has to do anything specific to my environment or the config
options? Any help on this is highly appreciated.

Thanks in advance,
John

On Tue, Mar 10, 2015 at 10:42 PM, Roel van Meer &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">roel at 1afa.com</A>&gt; wrote:

&gt;<i> Roel van Meer writes:
</I>&gt;<i>
</I>&gt;<i>  &gt;&gt; &gt; I'm using squid 3.5.2 built with openssl 0.9.8zc on Slackware 13.1.
</I>&gt;&gt;&gt;<i> &gt;&gt; &gt; Traffic is redirected from port 443 top 3130 with iptables.
</I>&gt;&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;&gt;<i> &gt;&gt; ... and with an older version of OpenSSL missing many of the last few
</I>&gt;&gt;&gt;<i> &gt;&gt; years worth of TLS crypto features. IIRC the library releases are now
</I>&gt;&gt;&gt;<i> up
</I>&gt;&gt;&gt;<i> &gt;&gt; to 1.1.* or something. Its best to keep that kind of thing operating
</I>&gt;&gt;&gt;<i> the
</I>&gt;&gt;&gt;<i> &gt;&gt; latest versions.
</I>&gt;&gt;&gt;<i> &gt;
</I>&gt;&gt;&gt;<i> &gt; I know it missing the latest features, but security patches are
</I>&gt;&gt;&gt;<i> &gt; backported. And I know it is old, but it's what I have to work with
</I>&gt;&gt;&gt;<i> &gt; now.Do you think it might be the cause of the problem I'm having with
</I>&gt;&gt;&gt;<i> &gt; peek/splice, or was it a general recommendation?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Its a potential source of problems. Chrome is very much on the front
</I>&gt;&gt;&gt;<i> line of the arms race attempting to stop things like SSL-Bump working.
</I>&gt;&gt;&gt;<i> Firefox implement their own crypto library which tracks the latest TLS
</I>&gt;&gt;&gt;<i> features at a similar speed of development.
</I>&gt;&gt;&gt;<i> OpenSSL will be perpetually behind both of them, but at least the latest
</I>&gt;&gt;&gt;<i> one(s) have better chances not to be advertising features they reject in
</I>&gt;&gt;&gt;<i> &quot;considered harmful&quot; grounds.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'll have a go then at trying with a newer openssl and the patches from
</I>&gt;&gt;<i> thethread you mentioned.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> With Squid 3.5.2 built with openssl 1.0.1k I can splice https connections
</I>&gt;<i> with no trouble. Tested with Lync, Chrome, Firefox, and IE.
</I>&gt;<i>
</I>&gt;<i> So you were right. :) Thanks a lot for pointing me in the right direction!
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i>
</I>&gt;<i> Roel
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150313/2da60887/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150313/2da60887/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="002682.html">[squid-users] peek/splice working with lynx but not with firefox or chrome [SOLVED]
</A></li>
	<LI>Next message (by thread): <A HREF="002683.html">[squid-users] Squid Reverse Proxy to Exchange 2010 OWA
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2763">[ date ]</a>
              <a href="thread.html#2763">[ thread ]</a>
              <a href="subject.html#2763">[ subject ]</a>
              <a href="author.html#2763">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
