<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid intercept config
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20intercept%20config&In-Reply-To=%3C55034228.8030800%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002775.html">
   <LINK REL="Next"  HREF="002777.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid intercept config</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20intercept%20config&In-Reply-To=%3C55034228.8030800%40gmail.com%3E"
       TITLE="[squid-users] squid intercept config">yvoinov at gmail.com
       </A><BR>
    <I>Fri Mar 13 20:01:44 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="002775.html">[squid-users] squid intercept config
</A></li>
        <LI>Next message (by thread): <A HREF="002777.html">[squid-users] squid intercept config
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2776">[ date ]</a>
              <a href="thread.html#2776">[ thread ]</a>
              <a href="subject.html#2776">[ subject ]</a>
              <a href="author.html#2776">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

This is know-how to himself. ;)

To be serious,

you must carefully play with refresh_pattern(s), and some squid.conf
parameters (and also with store ID feature) to get higher HIT ratio.

Just for example (this is NOT complete config! No responsibility or
any guarantees in case of simple copy-n-pasted into your configs! This
is AS IS example!):

# Keep swf in cache even if asked not to
refresh_pattern -i \.(swf)(\?|$)	10080	90%	43200	override-expire
ignore-reload reload-into-ims ignore-private
# .NET cache
refresh_pattern -i \.(as(h|p)x?)(\?|$)	10080	90%	43200	reload-into-ims
# Updates: Windows, Adobe, Java
refresh_pattern -i
microsoft.com/.*\.(cab|exe|ms[i|u|f|p]|asf|wm[v|a]|dat|zip)			4320
80% 43200	reload-into-ims
refresh_pattern -i
windowsupdate.com/.*\.(cab|exe|ms[i|u|f|p]|asf|wm[v|a]|dat|zip)	
4320 80% 43200	reload-into-ims
refresh_pattern -i
my.windowsupdate.website.com/.*\.(cab|exe|ms[i|u|f|p]|asf|wm[v|a]|dat|zip)
4320 80% 43200	reload-into-ims
refresh_pattern -i adobe.com/.*\.(zip|exe)	4320	80%	43200	reload-into-ims
refresh_pattern -i java.com/.*\.(zip|exe)	4320	80%	43200	reload-into-ims
refresh_pattern -i sun.com/.*\.(zip|exe)	4320	80%	43200	reload-into-ims
refresh_pattern -i google\.com.*\.(zip|exe)	4320	80%	43200	reload-into-ims
refresh_pattern -i macromedia\.com.*\.(zip|exe)	4320	80%	43200
reload-into-ims
# Other long-lived items
refresh_pattern -i
\.(jp(e?g|e|2)|gif|png|tiff?|bmp|ico|webp|flv|mp4)(\?|$)			14400
99%	518400	ignore-no-store override-expire ignore-reload
reload-into-ims ignore-private ignore-must-revalidate
refresh_pattern -i
\.((m?|x?|s?)htm(l?)|css|js|xml|php|json)(\?|$)			10080	90%	86400
ignore-no-store override-expire override-lastmod reload-into-ims
ignore-private ignore-must-revalidate
# Default patterns
refresh_pattern -i (/cgi-bin/|\?)	0	0%	0
refresh_pattern	.	0	20%	10080	override-lastmod reload-into-ims

The example above also requires some additional cached-related
parameters to be changed.

Also, you strictly recommended to research average users activity AND
play around VARY http headers.

And others.

Each squid setup is place-specific. And depending your access/deny
lists, security policy, users/network activity etc.etc.etc.

WBR, Yuri

PS. Your question has NO simple answer. Beware - copy-n-paste any
foreign config can not guarantee the same results for YOU.

14.03.15 1:52, Alberto Perez &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> Can you share more details about &quot;Agressive dynamic content
</I>&gt;<i> caching requires some special tweaks&quot; I am very interested.
</I>&gt;<i> 
</I>&gt;<i> Thanks
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On 3/13/15, Yuri Voinov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 13.03.15 23:33, Amos Jeffries &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;&gt;&gt;&gt;<i> On 14/03/2015 5:47 a.m., Monah Baki wrote:
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> &lt;snip&gt;
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> half_closed_clients off quick_abort_min 0 KB
</I>&gt;&gt;&gt;&gt;&gt;<i> quick_abort_max 0 KB vary_ignore_expire on reload_into_ims
</I>&gt;&gt;&gt;&gt;&gt;<i> on memory_pools off cache_mem 4096 MB visible_hostname
</I>&gt;&gt;&gt;&gt;&gt;<i> isn-phc-cache minimum_object_size 0 bytes
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> maximum_object_size 512 MB maximum_object_size 512 KB
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> KB value overwriting MB value.
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> ipcache_size 1024 ipcache_low 90 ipcache_high 95
</I>&gt;&gt;&gt;&gt;&gt;<i> cache_swap_low 98 cache_swap_high 100 fqdncache_size 16384
</I>&gt;&gt;&gt;&gt;&gt;<i> retry_on_error on offline_mode off logfile_rotate 10
</I>&gt;&gt;&gt;&gt;&gt;<i> dns_nameservers 8.8.8.8 41.78.211.30
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> access.log:
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> 1426267535.210    198 10.0.0.23 TCP_MISS/200 412 GET 
</I>&gt;&gt;&gt;&gt;&gt;<i> <A HREF="http://jadserve.postrelease.com/trk.gif?">http://jadserve.postrelease.com/trk.gif?</A> - 
</I>&gt;&gt;&gt;&gt;&gt;<i> ORIGINAL_DST/54.225.133.227 image/gif 1426267535.211
</I>&gt;&gt;&gt;&gt;&gt;<i> 198 10.0.0.23 TCP_MISS/200 412 GET 
</I>&gt;&gt;&gt;&gt;&gt;<i> <A HREF="http://jadserve.postrelease.com/trk.gif?">http://jadserve.postrelease.com/trk.gif?</A> - 
</I>&gt;&gt;&gt;&gt;&gt;<i> ORIGINAL_DST/54.225.133.227 image/gif 1426267535.211
</I>&gt;&gt;&gt;&gt;&gt;<i> 198 10.0.0.23 TCP_MISS/200 412 GET 
</I>&gt;&gt;&gt;&gt;&gt;<i> <A HREF="http://jadserve.postrelease.com/trk.gif?">http://jadserve.postrelease.com/trk.gif?</A> - 
</I>&gt;&gt;&gt;&gt;&gt;<i> ORIGINAL_DST/54.225.133.227 image/gif 1426267535.223
</I>&gt;&gt;&gt;&gt;&gt;<i> 301 10.0.0.23 TCP_MISS/200 222 GET 
</I>&gt;&gt;&gt;&gt;&gt;<i> <A HREF="http://rma-api.gravity.com/v1/beacons/log?">http://rma-api.gravity.com/v1/beacons/log?</A> - 
</I>&gt;&gt;&gt;&gt;&gt;<i> ORIGINAL_DST/80.239.148.18 text/html 1426267535.244    195 
</I>&gt;&gt;&gt;&gt;&gt;<i> 10.0.0.23 TCP_MISS/200 412 GET 
</I>&gt;&gt;&gt;&gt;&gt;<i> <A HREF="http://jadserve.postrelease.com/trk.gif?">http://jadserve.postrelease.com/trk.gif?</A> - 
</I>&gt;&gt;&gt;&gt;&gt;<i> ORIGINAL_DST/54.225.133.227 image/gif
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> Lots of Akamai hosted requests. Akamai play tricks with DNS 
</I>&gt;&gt;&gt;&gt;<i> responses.
</I>&gt;<i> In my installation I've used local Unbound DNS cache and, before
</I>&gt;<i> it, forced DNS interception to him with Cisco. :)
</I>&gt;<i> 
</I>&gt;<i> So, I don't care about any hosts DNS quirks. ;)
</I>&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> Check your cache.log for security warnings; 
</I>&gt;&gt;&gt;&gt;<i> &lt;<A HREF="http://wiki.squid-cache.org/KnowledgeBase/HostHeaderForgery">http://wiki.squid-cache.org/KnowledgeBase/HostHeaderForgery</A>&gt;
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> 
</I>Note that objects failing the Host validation are not cacheable.
&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> 1426267535.333    423 10.0.0.23 TCP_MISS/200 1420 GET 
</I>&gt;&gt;&gt;&gt;&gt;<i> <A HREF="http://hpr.outbrain.com/utils/get?">http://hpr.outbrain.com/utils/get?</A> -
</I>&gt;&gt;&gt;&gt;&gt;<i> ORIGINAL_DST/50.31.185.42 text/x-json 1426267535.345    412
</I>&gt;&gt;&gt;&gt;&gt;<i> 10.0.0.23 TCP_MISS/200 11179 GET
</I>&gt;&gt;&gt;&gt;&gt;<i> <A HREF="http://p.visualrevenue.com/?">http://p.visualrevenue.com/?</A> - ORIGINAL_DST/50.31.185.40 
</I>&gt;&gt;&gt;&gt;&gt;<i> text/javascript 1426267535.346    411 10.0.0.23
</I>&gt;&gt;&gt;&gt;&gt;<i> TCP_MISS/200 423 GET <A HREF="http://t1.visualrevenue.com/?">http://t1.visualrevenue.com/?</A> -
</I>&gt;&gt;&gt;&gt;&gt;<i> ORIGINAL_DST/64.74.232.44 image/gif
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> Not sure about them. Maybe genuine MISS, maybe not.
</I>&gt;<i> 
</I>&gt;<i> Agressive dynamic content caching requires some special tweaks. ;)
</I>&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> It could also be the issues Antony pointed out, with the
</I>&gt;&gt;&gt;&gt;<i> objects just naturally not being cacheable.
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> 1426267535.363    128 10.0.0.23 TCP_REFRESH_UNMODIFIED/304
</I>&gt;&gt;&gt;&gt;&gt;<i> 327 GET 
</I>&gt;&gt;&gt;&gt;&gt;<i> <A HREF="http://z.cdn.turner.com/cnn/.element/widget/video/videoapi/api/js/vendor/jquery.ba-bbq.js">http://z.cdn.turner.com/cnn/.element/widget/video/videoapi/api/js/vendor/jquery.ba-bbq.js</A>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>- - ORIGINAL_DST/80.239.152.153 application/x-javascript
&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> There is a hit.
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> I guess you are new to Squid-3 ? Squid is HTTP/1.1 compliant
</I>&gt;&gt;&gt;&gt;<i> now and the caching rules are slightly different from
</I>&gt;&gt;&gt;&gt;<i> requirements on HTTP/1.0 software. A lot of content that
</I>&gt;&gt;&gt;&gt;<i> previously could not be stored now can (authenticated,
</I>&gt;&gt;&gt;&gt;<i> private, no-cache, etc.). But being sensitive info also
</I>&gt;&gt;&gt;&gt;<i> requires revalidation in order to be used, so they show up
</I>&gt;&gt;&gt;&gt;<i> like the above.
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> Amos
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> _______________________________________________ squid-users
</I>&gt;&gt;&gt;&gt;<i> mailing list <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> 
</I>&gt;&gt;&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;<i> _______________________________________________ squid-users
</I>&gt;&gt;<i> mailing list <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> 
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i> 
</I>-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2

iQEcBAEBAgAGBQJVA0InAAoJENNXIZxhPexG6JAIALq2tAxa9Vawr1/Rkojl0UFj
HQF9p/4mk0ZHPnL4zkV6h/Ctg/s+AgK+O/H38ncn+2JS4eyiZfSHLOxmxkmrKi11
av/yjG++JGnhQkic/3y7ETOSkvaDuAbDP+Iwrtuc+kBpJz54No9Pu37oVlIOdMLZ
uv/8Bpk9uQEc3kE5FCgCmM2nIr2tuxr6opK6T5DZ2TvcqnQin752P60R91iS7unF
XHX3tsGsFvrKflEEC7w1xDRn3u3kSGrx+gPpktA0dv6vT8ATXqPEV5+anIEZVfLZ
NKDIwoeSNHYMMknlK7QTUlcNjuq+UXmfcO3mp+eraUQbGRkxwqTPxRwvIqp/43U=
=VW9B
-----END PGP SIGNATURE-----

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="002775.html">[squid-users] squid intercept config
</A></li>
	<LI>Next message (by thread): <A HREF="002777.html">[squid-users] squid intercept config
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2776">[ date ]</a>
              <a href="thread.html#2776">[ thread ]</a>
              <a href="subject.html#2776">[ subject ]</a>
              <a href="author.html#2776">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
