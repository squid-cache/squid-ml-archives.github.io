<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid not responding during file upload.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20not%20responding%20during%20file%20upload.&In-Reply-To=%3CDM2PR0601MB1312D7D6713302F09AE087F8AE010%40DM2PR0601MB1312.namprd06.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002872.html">
   <LINK REL="Next"  HREF="002898.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid not responding during file upload.</H1>
    <B>Saravanan Coimbatore</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20not%20responding%20during%20file%20upload.&In-Reply-To=%3CDM2PR0601MB1312D7D6713302F09AE087F8AE010%40DM2PR0601MB1312.namprd06.prod.outlook.com%3E"
       TITLE="[squid-users] Squid not responding during file upload.">scoimbatore at vormetric.com
       </A><BR>
    <I>Thu Mar 19 17:26:05 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="002872.html">[squid-users] Squid not responding during file upload.
</A></li>
        <LI>Next message (by thread): <A HREF="002898.html">[squid-users] Squid not responding during file upload.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2875">[ date ]</a>
              <a href="thread.html#2875">[ thread ]</a>
              <a href="subject.html#2875">[ subject ]</a>
              <a href="author.html#2875">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Amos Jeffries
Sent: Thursday, March 19, 2015 2:26 AM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Squid not responding during file upload.

On 19/03/2015 8:11 p.m., Saravanan Coimbatore wrote:
&gt;<i> Hello all, 
</I>&gt;<i> 
</I>&gt;<i> I am using Squid 3.4 to inspect content that heads out to the cloud from enterprise. I have two c-icap filter that does the content inspection. 
</I>&gt;<i> 
</I>&gt;<i> Observation: 
</I>&gt;<i> - Upload 3000 1M files to cloud passes through successfully. 
</I>&gt;<i> - Upload 300 40M files to cloud results in multiple failures. Some of errors: 400 Bad Request, Request Timed out.. 
</I>&gt;<i> 
</I>&gt;<i> Tcpdump of the 40MB file upload tests indicate the following:
</I>&gt;<i> - Boto client used to upload sends packet to squid proxy. 
</I>
 Squid on receiving requests sends them to the ICAP REQMOD service,
   and waits for its response,
 then sends the ICAP REQMOD result to the origin server,
   and waits for its response,
 then sends that to the ICAP RESPMOD service,
   and waits for its response,
 then sends that to the client.

So...
 What is the ICAP service and the origin server doing?

&lt;SC&gt; ICAP Service inspects the data that passes through it, and does selective filtering based on user policies. There are two icap services that handles two different service providers. Would having two icap services cause any delay. Does Squid send data to a icap service if the icap service has returned 204 in the preview handler?  

The Origin server is S3 or Box. We did tests without Squid in between, and the success ratio is high. We are trying to isolate this on a component basis, but the tcp dump shows that the squid did not respond at the TCP level. We were wondering if this is because Squid is busy. 


&gt;<i> - Proxy does not acknowledge. 
</I>
What type of &quot;acknowledge&quot; are you expecting here? HTTP or TCP level?
&lt;SC&gt; TCP level. 

&gt;<i> - Client sends the data again at least 6 times, Squid does not respond. 
</I>
At TCP or HTTP layer?
&lt;SC&gt; At TCP Layer. 

&gt;<i> - After 20-25 seconds of this (where Squid did not send any data to cloud), Cloud storage vendor returns a &quot;BAD Request&quot; response. 
</I>&gt;<i> 
</I>&gt;<i> Uploading 300 files seems to be a load that should be manageable by Squid. Can anyone guide me on how to optimize Squid for the above scenario? Are there any performance parameters that I can tweak so Squid handles this correctly?
</I>&gt;<i> 
</I>

Amos

_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="002872.html">[squid-users] Squid not responding during file upload.
</A></li>
	<LI>Next message (by thread): <A HREF="002898.html">[squid-users] Squid not responding during file upload.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2875">[ date ]</a>
              <a href="thread.html#2875">[ thread ]</a>
              <a href="subject.html#2875">[ subject ]</a>
              <a href="author.html#2875">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
