<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid not responding during file upload.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20not%20responding%20during%20file%20upload.&In-Reply-To=%3C550BBA6A.4080809%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002875.html">
   <LINK REL="Next"  HREF="002901.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid not responding during file upload.</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20not%20responding%20during%20file%20upload.&In-Reply-To=%3C550BBA6A.4080809%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid not responding during file upload.">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Mar 20 06:12:58 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="002875.html">[squid-users] Squid not responding during file upload.
</A></li>
        <LI>Next message (by thread): <A HREF="002901.html">[squid-users] Squid not responding during file upload.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2898">[ date ]</a>
              <a href="thread.html#2898">[ thread ]</a>
              <a href="subject.html#2898">[ subject ]</a>
              <a href="author.html#2898">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 20/03/2015 6:26 a.m., Saravanan Coimbatore wrote:
&gt;<i> 
</I>&gt;<i> From: Amos Jeffries
</I>&gt;<i> 
</I>&gt;<i> On 19/03/2015 8:11 p.m., Saravanan Coimbatore wrote:
</I>&gt;&gt;<i> Hello all, 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I am using Squid 3.4 to inspect content that heads out to the cloud from enterprise. I have two c-icap filter that does the content inspection. 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Observation: 
</I>&gt;&gt;<i> - Upload 3000 1M files to cloud passes through successfully. 
</I>&gt;&gt;<i> - Upload 300 40M files to cloud results in multiple failures. Some of errors: 400 Bad Request, Request Timed out.. 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Tcpdump of the 40MB file upload tests indicate the following:
</I>&gt;&gt;<i> - Boto client used to upload sends packet to squid proxy. 
</I>&gt;<i> 
</I>&gt;<i>  Squid on receiving requests sends them to the ICAP REQMOD service,
</I>&gt;<i>    and waits for its response,
</I>&gt;<i>  then sends the ICAP REQMOD result to the origin server,
</I>&gt;<i>    and waits for its response,
</I>&gt;<i>  then sends that to the ICAP RESPMOD service,
</I>&gt;<i>    and waits for its response,
</I>&gt;<i>  then sends that to the client.
</I>&gt;<i> 
</I>&gt;<i> So...
</I>&gt;<i>  What is the ICAP service and the origin server doing?
</I>&gt;<i> 
</I>&gt;<i> &lt;SC&gt; ICAP Service inspects the data that passes through it, and does selective filtering based on user policies. There are two icap services that handles two different service providers. Would having two icap services cause any delay. Does Squid send data to a icap service if the icap service has returned 204 in the preview handler?  
</I>&gt;<i> 
</I>
Good to know. Though I meant more along the lines of what data its been
sent and what Squid got back from it etc, in each step of the above
theoretical sequence of operations. If they all worked properly there
would be no hang problem.


&gt;<i> The Origin server is S3 or Box. We did tests without Squid in between, and the success ratio is high. We are trying to isolate this on a component basis, but the tcp dump shows that the squid did not respond at the TCP level. We were wondering if this is because Squid is busy. 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> - Proxy does not acknowledge. 
</I>&gt;<i> 
</I>&gt;<i> What type of &quot;acknowledge&quot; are you expecting here? HTTP or TCP level?
</I>&gt;<i> &lt;SC&gt; TCP level. 
</I>&gt;<i> 
</I>
Aha. That only happens if the receive buffer in Squid is full, or Squid
believes the request is fully received and is now waiting for the
response data for it to deliver.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="002875.html">[squid-users] Squid not responding during file upload.
</A></li>
	<LI>Next message (by thread): <A HREF="002901.html">[squid-users] Squid not responding during file upload.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2898">[ date ]</a>
              <a href="thread.html#2898">[ thread ]</a>
              <a href="subject.html#2898">[ subject ]</a>
              <a href="author.html#2898">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
