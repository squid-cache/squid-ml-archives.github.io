<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] I am seeing the following in my cache.log
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20I%20am%20seeing%20the%20following%20in%20my%20cache.log&In-Reply-To=%3CCALP3%3Dx9th_u5NwLQdKgYmmHocmV3g-cVCvOtL3kJSM42nQdnmA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002925.html">
   <LINK REL="Next"  HREF="002927.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] I am seeing the following in my cache.log</H1>
    <B>Monah Baki</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20I%20am%20seeing%20the%20following%20in%20my%20cache.log&In-Reply-To=%3CCALP3%3Dx9th_u5NwLQdKgYmmHocmV3g-cVCvOtL3kJSM42nQdnmA%40mail.gmail.com%3E"
       TITLE="[squid-users] I am seeing the following in my cache.log">monahbaki at gmail.com
       </A><BR>
    <I>Tue Mar 24 20:05:57 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="002925.html">[squid-users] I am seeing the following in my cache.log
</A></li>
        <LI>Next message (by thread): <A HREF="002927.html">[squid-users] I am seeing the following in my cache.log
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2926">[ date ]</a>
              <a href="thread.html#2926">[ thread ]</a>
              <a href="subject.html#2926">[ subject ]</a>
              <a href="author.html#2926">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Yuri for the URL. The company is a small ISP using policy based
routing, so using WPAD or GPO isn't feasible.

If the cause of the server running out of file descriptions and giving
the &quot;assertion failed: store.cc:1885: &quot;isEmpty()&quot; error, I prefer to
inform the enduser to fix his computer.

Thanks
Monah


On Tue, Mar 24, 2015 at 3:24 PM, Yuri Voinov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A>&gt; wrote:
&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i> Hash: SHA256
</I>&gt;<i>
</I>&gt;<i> Feel free fo look at this:
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://wiki.squid-cache.org/KnowledgeBase/HostHeaderForgery">http://wiki.squid-cache.org/KnowledgeBase/HostHeaderForgery</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 25.03.15 1:18, Monah Baki &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;&gt;<i> Running squid 3.5.2 on Centos 6.6
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ./configure --prefix=/home/cache --enable-follow-x-forwarded-for
</I>&gt;&gt;<i> --with-large-files --enable-ssl --disable-ipv6 --enable-esi
</I>&gt;&gt;<i> --enable-kill-parent-hack --enable-snmp --with-pthreads
</I>&gt;&gt;<i> --with-filedescriptors=65535 --enable-cachemgr-hostname=hostname
</I>&gt;&gt;<i> --enable-storeio=ufs,aufs,diskd,rock
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> We have around 50 users. I am seeing hundreds of thousands of the
</I>&gt;&gt;<i> following:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 2015/03/24 14:57:34.910| SECURITY ALERT: By user agent:
</I>&gt;&gt;<i> Mozilla/5.0 (Windows NT 6.1) AppleWebKit/536.6 (KHTML, like Gecko)
</I>&gt;&gt;<i> Chrome/20.0.1092.0 Safari/536.6 2015/03/24 14:57:34.910| SECURITY
</I>&gt;&gt;<i> ALERT: on URL: www.facebook.com:443 2015/03/24 14:57:34.946|
</I>&gt;&gt;<i> SECURITY ALERT: Host header forgery detected on
</I>&gt;&gt;<i> local=85.115.52.158:80 remote=196.245.252.34:36732 FD 49 flags=33
</I>&gt;&gt;<i> (local IP does not match any domain IP)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Then after 2 hours, I get the message in my cacahe.log:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 2015/03/24 16:41:42.478| SECURITY ALERT: By user agent:
</I>&gt;&gt;<i> Mozilla/5.0 (Windows NT 6.1) AppleWebKit/536.6 (KHTML, like Gecko)
</I>&gt;&gt;<i> Chrome/20.0.1092.0 Safari/536.6 2015/03/24 16:41:42.478| SECURITY
</I>&gt;&gt;<i> ALERT: on URL: www.facebook.com:443 2015/03/24 16:41:42.478|
</I>&gt;&gt;<i> WARNING: 1 swapin MD5 mismatches 2015/03/24 16:41:42.478| Could not
</I>&gt;&gt;<i> parse headers from on disk object 2015/03/24 16:41:42.478| BUG
</I>&gt;&gt;<i> 3279: HTTP reply without Date: 2015/03/24 16:41:42.478|
</I>&gt;&gt;<i> StoreEntry-&gt;key: 23F0D6046AB8FE86440CAD447524FCBC 2015/03/24
</I>&gt;&gt;<i> 16:41:42.478| StoreEntry-&gt;next: 0 2015/03/24 16:41:42.478|
</I>&gt;&gt;<i> StoreEntry-&gt;mem_obj: 0x1d56470 2015/03/24 16:41:42.478|
</I>&gt;&gt;<i> StoreEntry-&gt;timestamp: -1 2015/03/24 16:41:42.478|
</I>&gt;&gt;<i> StoreEntry-&gt;lastref: 1427211702 2015/03/24 16:41:42.478|
</I>&gt;&gt;<i> StoreEntry-&gt;expires: -1 2015/03/24 16:41:42.478|
</I>&gt;&gt;<i> StoreEntry-&gt;lastmod: -1 2015/03/24 16:41:42.478|
</I>&gt;&gt;<i> StoreEntry-&gt;swap_file_sz: 0 2015/03/24 16:41:42.478|
</I>&gt;&gt;<i> StoreEntry-&gt;refcount: 1 2015/03/24 16:41:42.478| StoreEntry-&gt;flags:
</I>&gt;&gt;<i> PRIVATE,FWD_HDR_WAIT,VALIDATED 2015/03/24 16:41:42.478|
</I>&gt;&gt;<i> StoreEntry-&gt;swap_dirn: -1 2015/03/24 16:41:42.478|
</I>&gt;&gt;<i> StoreEntry-&gt;swap_filen: -1 2015/03/24 16:41:42.478|
</I>&gt;&gt;<i> StoreEntry-&gt;lock_count: 2 2015/03/24 16:41:42.478|
</I>&gt;&gt;<i> StoreEntry-&gt;mem_status: 0 2015/03/24 16:41:42.478|
</I>&gt;&gt;<i> StoreEntry-&gt;ping_status: 2 2015/03/24 16:41:42.478|
</I>&gt;&gt;<i> StoreEntry-&gt;store_status: 1 2015/03/24 16:41:42.478|
</I>&gt;&gt;<i> StoreEntry-&gt;swap_status: 0 2015/03/24 16:41:42.747| SECURITY ALERT:
</I>&gt;&gt;<i> Host header forgery detected on local=85.115.52.158:80
</I>&gt;&gt;<i> remote=197.255.252.34:44348 FD 20 flags=33 (local IP does not match
</I>&gt;&gt;<i> any domain IP) 2015/03/24 16:41:42.747| SECURITY ALERT: By user
</I>&gt;&gt;<i> agent: WNetCore/0.1.1.1 2015/03/24 16:41:42.747| SECURITY ALERT: on
</I>&gt;&gt;<i> URL: us-mg5.mail.yahoo.com:443 2015/03/24 16:41:42.772| SECURITY
</I>&gt;&gt;<i> ALERT: Host header forgery detected on local=85.115.52.158:80
</I>&gt;&gt;<i> remote=197.255.252.34:44349 FD 20 flags=33 (local IP does not match
</I>&gt;&gt;<i> any domain IP) 2015/03/24 16:41:42.772| SECURITY ALERT: By user
</I>&gt;&gt;<i> agent: WNetCore/0.1.1.1 2015/03/24 16:41:42.772| SECURITY ALERT: on
</I>&gt;&gt;<i> URL: csync.flickr.com:443 2015/03/24 16:41:42.800| SECURITY ALERT:
</I>&gt;&gt;<i> Host header forgery detected on local=85.115.33.158:80
</I>&gt;&gt;<i> remote=197.255.252.34:13505 FD 20 flags=33 (local IP does not match
</I>&gt;&gt;<i> any domain IP) 2015/03/24 16:41:42.800| SECURITY ALERT: By user
</I>&gt;&gt;<i> agent: Mozilla/5.0 (Windows NT 6.1) AppleWebKit/536.6 (KHTML, like
</I>&gt;&gt;<i> Gecko) Chrome/20.0.1092.0 Safari/536.6 2015/03/24 16:41:42.800|
</I>&gt;&gt;<i> SECURITY ALERT: on URL: www.facebook.com:443 2015/03/24
</I>&gt;&gt;<i> 16:41:43.115| SECURITY ALERT: Host header forgery detected on
</I>&gt;&gt;<i> local=85.115.33.158:80 remote=197.255.252.34:13506 FD 31 flags=33
</I>&gt;&gt;<i> (local IP does not match any domain IP) 2015/03/24 16:41:43.115|
</I>&gt;&gt;<i> SECURITY ALERT: By user agent: Mozilla/5.0 (Windows NT 6.1)
</I>&gt;&gt;<i> AppleWebKit/536.6 (KHTML, like Gecko) Chrome/20.0.1092.0
</I>&gt;&gt;<i> Safari/536.6 2015/03/24 16:41:43.115| SECURITY ALERT: on URL:
</I>&gt;&gt;<i> www.facebook.com:443 2015/03/24 16:41:43.115| assertion failed:
</I>&gt;&gt;<i> store.cc:1885: &quot;isEmpty()&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Then I get a message &quot;running out of file descriptors&quot;, for that I
</I>&gt;&gt;<i> did the following: echo 1024 65535 &gt;
</I>&gt;&gt;<i> /proc/sys/net/ipv4/ip_local_port_range echo 8192 &gt;
</I>&gt;&gt;<i> /proc/sys/net/ipv4/tcp_max_syn_backlog
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In my /etc/security/limits.conf, added the following: * - nofile
</I>&gt;&gt;<i> 65535
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> My squid.conf
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # # Recommended minimum configuration: #
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Example rule allowing access from your local networks. # Adapt to
</I>&gt;&gt;<i> list your (internal) IP networks from where browsing # should be
</I>&gt;&gt;<i> allowed acl localnet src 10.0.0.0/8    # RFC1918 possible internal
</I>&gt;&gt;<i> network acl localnet src 172.16.0.0/12    # RFC1918 possible
</I>&gt;&gt;<i> internal network acl localnet src 192.168.0.0/16    # RFC1918
</I>&gt;&gt;<i> possible internal network acl localnet src fc00::/7       # RFC
</I>&gt;&gt;<i> 4193 local private network range acl localnet src fe80::/10      #
</I>&gt;&gt;<i> RFC 4291 link-local (directly plugged) machines acl blockeddomain
</I>&gt;&gt;<i> dstdomain &quot;/home/cache/etc/blocked.domain.acl&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> acl SSL_ports port 443 acl Safe_ports port 80        # http acl
</I>&gt;&gt;<i> Safe_ports port 21        # ftp acl Safe_ports port 443        #
</I>&gt;&gt;<i> https acl Safe_ports port 70        # gopher acl Safe_ports port
</I>&gt;&gt;<i> 210        # wais acl Safe_ports port 1025-65535    # unregistered
</I>&gt;&gt;<i> ports acl Safe_ports port 280        # http-mgmt acl Safe_ports
</I>&gt;&gt;<i> port 488        # gss-http acl Safe_ports port 591        #
</I>&gt;&gt;<i> filemaker acl Safe_ports port 777        # multiling http acl
</I>&gt;&gt;<i> CONNECT method CONNECT acl isnsnmp snmp_community public
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # # Recommended minimum Access Permission configuration: # # Deny
</I>&gt;&gt;<i> requests to certain unsafe ports http_access deny !Safe_ports
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Deny CONNECT to other than secure SSL ports http_access deny
</I>&gt;&gt;<i> CONNECT !SSL_ports
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Only allow cachemgr access from localhost http_access allow
</I>&gt;&gt;<i> localhost manager http_access deny manager
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> cachemgr_passwd password all
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # We strongly recommend the following be uncommented to protect
</I>&gt;&gt;<i> innocent # web applications running on the proxy server who think
</I>&gt;&gt;<i> the only # one who can access services on &quot;localhost&quot; is a local
</I>&gt;&gt;<i> user #http_access deny to_localhost
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
</I>&gt;&gt;<i> #
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Example rule allowing access from your local networks. # Adapt
</I>&gt;&gt;<i> localnet in the ACL section to list your (internal) IP networks #
</I>&gt;&gt;<i> from where browsing should be allowed http_access deny
</I>&gt;&gt;<i> blockeddomain http_access allow localnet http_access allow
</I>&gt;&gt;<i> localhost snmp_access allow isnsnmp localnet
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # And finally deny all other access to this proxy http_access deny
</I>&gt;&gt;<i> all # snmp_access deny all
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Squid normally listens to port 3128 http_port 3128 http_port 3129
</I>&gt;&gt;<i> intercept snmp_port 3401
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Uncomment and adjust the following to add a disk cache
</I>&gt;&gt;<i> directory. #cache_dir ufs /usr/local/squid/var/cache/squid 100 16
</I>&gt;&gt;<i> 256 cache_dir aufs /home/cache/var/cache/squid 350000 16 256
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Leave coredumps in the first cache dir coredump_dir
</I>&gt;&gt;<i> /usr/local/squid/var/cache/squid
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> access_log daemon:/home/cache/var/logs/access.log squid cache_log
</I>&gt;&gt;<i> /home/cache/var/logs/cache.log
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # # Add any of your own refresh_pattern entries above these. #
</I>&gt;&gt;<i> refresh_pattern ^ftp:        1440    20%    10080 refresh_pattern
</I>&gt;&gt;<i> ^gopher:    1440    0%    1440 refresh_pattern -i (/cgi-bin/|\?) 0
</I>&gt;&gt;<i> 0%    0 refresh_pattern .        0    20%    4320
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> half_closed_clients off # quick_abort_min 0 KB # quick_abort_max 0
</I>&gt;&gt;<i> KB # vary_ignore_expire on # reload_into_ims on # memory_pools off
</I>&gt;&gt;<i> cache_mem 9216 MB memory_cache_mode always
</I>&gt;&gt;<i> client_persistent_connections off server_persistent_connections
</I>&gt;&gt;<i> off visible_hostname isn-phc-cache minimum_object_size 0 KB
</I>&gt;&gt;<i> maximum_object_size 96 MB maximum_object_size_in_memory 1 MB
</I>&gt;&gt;<i> memory_replacement_policy lru cache_replacement_policy heap LFUDA
</I>&gt;&gt;<i> quick_abort_min 1024 KB quick_abort_max 2048 KB quick_abort_pct 90
</I>&gt;&gt;<i> ipcache_size 10240 # ipcache_low 90 # ipcache_high 95
</I>&gt;&gt;<i> cache_swap_low 98 cache_swap_high 100 # fqdncache_size 16384 #
</I>&gt;&gt;<i> retry_on_error on # offline_mode off logfile_rotate 10
</I>&gt;&gt;<i> dns_nameservers 8.8.8.8 41.78.211.30
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Was the thousands of thousands of SECURITY ALERT the cause of
</I>&gt;&gt;<i> this?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks Monah _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i>
</I>&gt;<i> -----BEGIN PGP SIGNATURE-----
</I>&gt;<i> Version: GnuPG v2
</I>&gt;<i>
</I>&gt;<i> iQEcBAEBCAAGBQJVEbnYAAoJENNXIZxhPexGMQgIAMICUhBRZMOIl96wFRHaUz+U
</I>&gt;<i> mFOoHX+dSr5C6hh7mm44ZFq9pWYb8c4EEx+kp5olttpPVFh3cfpl8h8tY73DfWUD
</I>&gt;<i> bWojvcQA+NqQ6rIvJcSAwOJ+bWXx3fPTUefGcAOJ+gZho90DyyLxy6vDSMt/0rnV
</I>&gt;<i> GkpUCTT7r3w/EKQbavjRpAcnEdm0L/tSv70Tui+SlU4ksVn77yIoLJ6xD183B4U+
</I>&gt;<i> 6Heg/x0sd2sMG6nx3452V7v5eaaQXAO3teby/VOUeRthuaFdJDTDn60j96h5Xc8Y
</I>&gt;<i> MSXIbk5qBecRuhVKs6vt2gWC59LYvjNnpSyCv1NyF0PWADi5QPlUVvGxtfUHfHU=
</I>&gt;<i> =5wYL
</I>&gt;<i> -----END PGP SIGNATURE-----
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="002925.html">[squid-users] I am seeing the following in my cache.log
</A></li>
	<LI>Next message (by thread): <A HREF="002927.html">[squid-users] I am seeing the following in my cache.log
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2926">[ date ]</a>
              <a href="thread.html#2926">[ thread ]</a>
              <a href="subject.html#2926">[ subject ]</a>
              <a href="author.html#2926">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
