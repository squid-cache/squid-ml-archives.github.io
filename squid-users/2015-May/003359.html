<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] assertion failed: comm.cc:178: &quot;fd_table[conn-&gt;fd].halfClosedReader != NULL&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20assertion%20failed%3A%20comm.cc%3A178%3A%0A%20%22fd_table%5Bconn-%3Efd%5D.halfClosedReader%20%21%3D%20NULL%22&In-Reply-To=%3C55437A12.9080605%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003357.html">
   <LINK REL="Next"  HREF="003385.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] assertion failed: comm.cc:178: &quot;fd_table[conn-&gt;fd].halfClosedReader != NULL&quot;</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20assertion%20failed%3A%20comm.cc%3A178%3A%0A%20%22fd_table%5Bconn-%3Efd%5D.halfClosedReader%20%21%3D%20NULL%22&In-Reply-To=%3C55437A12.9080605%40treenet.co.nz%3E"
       TITLE="[squid-users] assertion failed: comm.cc:178: &quot;fd_table[conn-&gt;fd].halfClosedReader != NULL&quot;">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri May  1 13:05:22 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003357.html">[squid-users] assertion failed: comm.cc:178: &quot;fd_table[conn-&gt;fd].halfClosedReader != NULL&quot;
</A></li>
        <LI>Next message (by thread): <A HREF="003385.html">[squid-users] assertion failed: comm.cc:178: &quot;fd_table[conn-&gt;fd].halfClosedReader != NULL&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3359">[ date ]</a>
              <a href="thread.html#3359">[ thread ]</a>
              <a href="subject.html#3359">[ subject ]</a>
              <a href="author.html#3359">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/05/2015 10:09 p.m., HackXBack wrote:
&gt;<i> squid.conf you can see it all , and the answer on your question is no i dont
</I>&gt;<i> have .
</I>&gt;<i> 
</I>
Okay, a bit of an audit...

&gt;<i> 
</I>&gt;<i> # should be allowed
</I>&gt;<i> acl localnet src 10.11.20.0/24
</I>&gt;<i> acl localnet src 10.150.15.0/24
</I>&gt;<i> 
</I>&gt;<i> # ACL for rewriter
</I>&gt;<i> acl fakespeed url_regex -i
</I>&gt;<i> \.*(speedtest|espeed).*\/((latency|random.*|upload)\.(jpg|txt|php)).*
</I>
The trailing &quot;.*&quot; at the end of this is not useful.


&gt;<i> acl rewriter-link url_regex -i
</I>&gt;<i> ^http.*(google|googlesyndication)\.com\/(pagead|js)\/(bg|js)\/.*\.js
</I>&gt;<i> 
</I>&gt;<i> # OPTIONS WHICH AFFECT THE NEIGHBOR SELECTION ALGORITHM
</I>&gt;<i> #
</I>&gt;<i> -----------------------------------------------------------------------------
</I>&gt;<i> cache_peer 10.11.20.100 parent 80 0
</I>&gt;<i> cache_peer_access 10.11.20.100 allow fakespeed
</I>&gt;<i> cache_peer_access 10.11.20.100 deny all
</I>&gt;<i> 
</I>&gt;<i> # OPTIONS INFLUENCING REQUEST FORWARDING
</I>&gt;<i> #
</I>&gt;<i> -----------------------------------------------------------------------------
</I>&gt;<i> never_direct allow fakespeed
</I>&gt;<i> never_direct deny all
</I>&gt;<i> always_direct deny fakespeed
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> # add on squid.conf to remove ads
</I>&gt;<i> ########################
</I>&gt;<i> acl ads-block url_regex -i &quot;/etc/squid/ads.block&quot;
</I>&gt;<i> http_access deny ads-block
</I>&gt;<i> http_reply_access deny ads-block
</I>
Since you are denying requests being made to these URL the only possible
reply will be the &quot;Access Denied&quot; error page.

You are then denying that error page being delivered, and replacing it
with ... the &quot;Access Denied&quot; error page.

Sigh.

Hint #1:  Your Squid would operate a bit faster by removing that
&quot;http_reply_access deny ads-block&quot; line.

Hint #2: it is a deny using slow regex pattern. Your Squid would work
even faster by moving the &quot;http_access deny ads-block&quot; down below the
&quot;deny manager&quot; config line.

&gt;<i> 
</I>&gt;<i> acl SSL_ports port 443
</I>&gt;<i> acl Safe_ports port 80        # http
</I>&gt;<i> acl Safe_ports port 21        # ftp
</I>&gt;<i> acl Safe_ports port 443        # https
</I>&gt;<i> acl Safe_ports port 70        # gopher
</I>&gt;<i> acl Safe_ports port 210        # wais
</I>&gt;<i> acl Safe_ports port 1025-65535    # unregistered ports
</I>&gt;<i> acl Safe_ports port 280        # http-mgmt
</I>&gt;<i> acl Safe_ports port 488        # gss-http
</I>&gt;<i> acl Safe_ports port 591        # filemaker
</I>&gt;<i> acl Safe_ports port 777        # multiling http
</I>&gt;<i> acl CONNECT method CONNECT
</I>&gt;<i> 
</I>&gt;<i> # Deny requests to certain unsafe ports
</I>&gt;<i> http_access deny !Safe_ports
</I>&gt;<i> 
</I>&gt;<i> # Deny CONNECT to other than secure SSL ports
</I>&gt;<i> http_access deny CONNECT !SSL_ports
</I>&gt;<i> 
</I>&gt;<i> # Only allow cachemgr access from localhost
</I>&gt;<i> http_access allow localhost manager
</I>&gt;<i> http_access deny manager
</I>&gt;<i> 
</I>&gt;<i> ##Redirect some sites to storeid
</I>&gt;<i> ################################################################################################
</I>&gt;<i> ################################################################################################
</I>&gt;<i> ################################################################################################
</I>&gt;<i> # Windows update acls
</I>&gt;<i> acl windowsupdate dstdomain windowsupdate.microsoft.com
</I>&gt;<i> acl windowsupdate dstdomain .update.microsoft.com
</I>&gt;<i> acl windowsupdate dstdomain download.windowsupdate.com
</I>&gt;<i> acl windowsupdate dstdomain redir.metaservices.microsoft.com
</I>&gt;<i> acl windowsupdate dstdomain images.metaservices.microsoft.com
</I>&gt;<i> acl windowsupdate dstdomain c.microsoft.com
</I>&gt;<i> acl windowsupdate dstdomain www.download.windowsupdate.com
</I>&gt;<i> acl windowsupdate dstdomain wustat.windows.com
</I>&gt;<i> acl windowsupdate dstdomain crl.microsoft.com
</I>&gt;<i> acl windowsupdate dstdomain sls.microsoft.com
</I>&gt;<i> acl windowsupdate dstdomain productactivation.one.microsoft.com
</I>&gt;<i> acl windowsupdate dstdomain ntservicepack.microsoft.com
</I>&gt;<i> 
</I>&gt;<i> # Windows update methods
</I>&gt;<i> acl wuCONNECT dstdomain www.update.microsoft.com
</I>&gt;<i> acl wuCONNECT dstdomain sls.microsoft.com
</I>&gt;<i> 
</I>&gt;<i> # Windows updates rules
</I>&gt;<i> http_access allow CONNECT wuCONNECT localnet
</I>&gt;<i> http_access allow CONNECT wuCONNECT localhost
</I>&gt;<i> http_access allow windowsupdate localnet
</I>&gt;<i> http_access allow windowsupdate localhost
</I>&gt;<i> 
</I>
The below is one massively huge regex pattern for Squid to try and
compile then process. Lets see what can be removed...

Firstly, remove all the &quot;.*&quot; which are on the end of patterns.


&gt;<i> acl store_rewrite_list url_regex -i fbcdn\/.*(jpg|gif|png|swf)
</I>&gt;<i> acl store_rewrite_list url_regex -i (akamaihd|fbcdn|facebook)\.(net|com)\/.*
</I>&gt;<i> acl store_rewrite_list url_regex -i attachment\.fbsbx\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i fbcdn-dragon-a\.akamaihd\.net
</I>&gt;<i> acl store_rewrite_list url_regex -i socialpointgames\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i miniclipcdn\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i
</I>&gt;<i> syntasia\.hs\.llnwd\.net\/[a-z][0-9]+\/baseballheroes\/.*
</I>
&gt;<i> acl store_rewrite_list url_regex -i \.google\-analytics\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i google\-analytics\.com
</I>
The two above patterns overlap. The seconds one will match everything
the first one does, and more.
... Remove the &quot;-i \.google\-analytics\.com&quot; line.

&gt;<i> acl store_rewrite_list url_regex -i video\.google\.com\/ThumbnailServer
</I>&gt;<i> acl store_rewrite_list url_regex -i
</I>&gt;<i> (youtube|google).*(videoplayback|liveplay)
</I>&gt;<i> acl store_rewrite_list url_regex -i
</I>&gt;<i> youtube.*(ptracking|stream_204|player_204|gen_204).*
</I>&gt;<i> acl store_rewrite_list url_regex -i
</I>&gt;<i> (youtube|google|googlevideo).*videoplayback.*
</I>
The above line overlaps completely with an earlier pttern.
Remove the &quot;(youtube|google|googlevideo).*videoplayback.*&quot; line.


&gt;<i> acl store_rewrite_list url_regex -i c\.android\.clients\.google\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i phobos\.apple\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i \.apple\.com
</I>
These apple.com patterns overlap completely.
Remove the &quot;-i phobos\.apple\.com&quot; line.

&gt;<i> acl store_rewrite_list url_regex -i \/speedtest\/.*(jpg|txt|png|swf)
</I>&gt;<i> acl store_rewrite_list url_regex -i speedtest.*\/.*(jpg|txt|png|swf)
</I>
These speedtest patterns also overlap completely.
 Remove the &quot;-i \/speedtest\/.*(jpg|txt|png|swf)&quot; line.

&gt;<i> acl store_rewrite_list url_regex -i \.youjizz\.com\/.*(3gp|mpg|flv|mp4)
</I>&gt;<i> acl store_rewrite_list url_regex -i \.phncdn\.com\/.*(mp4|flv|3gp|mpg|wmv)
</I>&gt;<i> acl store_rewrite_list url_regex -i \.cdn13\.com\/.*(flv|mp3|mp4|3gp|wmv)
</I>&gt;<i> acl store_rewrite_list url_regex -i \.filehippo\.com\/.*
</I>&gt;<i> acl store_rewrite_list url_regex -i filehippo\.com\/.*
</I>
The above two lines are overlap.
Remove the &quot;-i \.filehippo\.com\/.*&quot; line.

Remove the &quot;.*&quot; from the end of the &quot;-i filehippo\.com\/.*&quot; line.

&gt;<i> acl store_rewrite_list url_regex -i dl\.sourceforge\.net\/project\/.*
</I>&gt;<i> acl store_rewrite_list url_regex -i googlevideo\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i reverbnation\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i
</I>&gt;<i> c2lo\.reverbnation\.com\/audio_player\/ec_stream_song\/.*
</I>&gt;<i> acl store_rewrite_list url_regex -i (4shared|4shared\-china)\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i 4shared\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i bp\.blogspot\.com\/.*
</I>&gt;<i> acl store_rewrite_list url_regex -i ytimg\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i (ggpht|googleusercontent)\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i (s|i[0-9]*)\.ytimg\.com\/.*
</I>
The above line is a more complicated pattern matching only things that
are matched by a simpler pattern elsewhere.
Remove the &quot;-i (s|i[0-9]*)\.ytimg\.com\/.*&quot; line.

&gt;<i> acl store_rewrite_list url_regex -i video\.google\.com\/ThumbnailServer
</I>
The above line is an exact duplicate of an earlier entry. Remove it.

&gt;<i> acl store_rewrite_list url_regex -i (google\.co(m|\.uk|\.id))\/.*
</I>&gt;<i> acl store_rewrite_list url_regex -i (\.gstatic\.com.*|\.wikimapia\.org)
</I>&gt;<i> acl store_rewrite_list url_regex -i gstatic.com\/images.*
</I>&gt;<i> acl store_rewrite_list url_regex -i gstatic.com\/.*
</I>
You have three patterns there doing the same match.
 Remove the &quot;-i gstatic.com\/.*&quot; and &quot;-i gstatic.com\/images.*&quot; lines

Replace the &quot;-i (\.gstatic\.com.*|\.wikimapia\.org)&quot; line with:
  -i (gstatic\.com|\.wikimapia\.org)

&gt;<i> acl store_rewrite_list url_regex -i bing\.(com|net)\/.*
</I>&gt;<i> acl store_rewrite_list url_regex -i (dmcdn\.net|dailymotion\.com).*
</I>&gt;<i> acl store_rewrite_list url_regex -i avast\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i geo\.kaspersky\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i update\.avg\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i
</I>&gt;<i> (cbk|mt|khm|mlt|tbn|mw)[0-9]?.google\.co(m|\.uk|\.id)
</I>&gt;<i> acl store_rewrite_list url_regex -i
</I>&gt;<i> (\.doubleclick\.net|\.quantserve\.com|\.googlesyndication\.com|yieldmanager|cpxinteractive)
</I>&gt;<i> acl store_rewrite_list url_regex -i sdlc\-esd\.sun\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i cloudfront\.net
</I>&gt;<i> acl store_rewrite_list url_regex -i sendspace\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i rapidshare\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i 185\.27\.237\.[\d]*
</I>&gt;<i> acl store_rewrite_list url_regex -i syntasia\.hs\.llnwd\.net
</I>&gt;<i> acl store_rewrite_list url_regex -i playspace\.r\.worldssl\.net
</I>&gt;<i> acl store_rewrite_list url_regex -i playit\.pk
</I>&gt;<i> acl store_rewrite_list url_regex -i attachment\.fbsbx\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i firedrive\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i cache\.pack\.google\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i pack\.google\.com
</I>
You have other patterns that match on just &quot;google.com&quot;.
Remove the &quot;-i cache\.pack\.google\.com&quot; and &quot;-i pack\.google\.com&quot; lines.

&gt;<i> acl store_rewrite_list url_regex -i dropboxusercontent\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i aclst\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i blackberry\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i (bitgravity|opera)\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i ggpht\.co(m|\.(id|uk))
</I>&gt;<i> acl store_rewrite_list url_regex -i instagram\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i virtualearth\.net
</I>&gt;<i> acl store_rewrite_list url_regex -i cnet\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i xvideos\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i .*xhcdn.*
</I>&gt;<i> acl store_rewrite_list url_regex -i steampowered\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i starhub\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i (wargaming|hwcdn)\.net
</I>&gt;<i> acl store_rewrite_list url_regex -i indowebster\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i filetrip\.net
</I>&gt;<i> acl store_rewrite_list url_regex -i get4mobile\.net
</I>&gt;<i> acl store_rewrite_list url_regex -i tube8\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i (redtube|redtubefiles)\.com
</I>
Replace the above pattern with:
  -i redtube(files)?\.com

&gt;<i> acl store_rewrite_list url_regex -i .*nsimg.*
</I>&gt;<i> acl store_rewrite_list url_regex -i .*mystreamservice.*
</I>&gt;<i> acl store_rewrite_list url_regex -i youjizz\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i .*phncdn.*
</I>&gt;<i> acl store_rewrite_list url_regex -i .*keezmovies.*
</I>&gt;<i> acl store_rewrite_list url_regex -i .*youporn.*
</I>&gt;<i> acl store_rewrite_list url_regex -i .*rncdn.*
</I>&gt;<i> acl store_rewrite_list url_regex -i .*spankwire.*
</I>&gt;<i> acl store_rewrite_list url_regex -i .*pornhub.*
</I>&gt;<i> acl store_rewrite_list url_regex -i .*playvid.*
</I>&gt;<i> acl store_rewrite_list url_regex -i .*maxporn.*
</I>&gt;<i> acl store_rewrite_list url_regex -i .*fucktube.*
</I>&gt;<i> acl store_rewrite_list url_regex -i .*slutload-media.*
</I>&gt;<i> acl store_rewrite_list url_regex -i .*hardsextube.*
</I>
All of these lines ...

&gt;<i> acl store_rewrite_list url_regex -i public\.extremetube\.phncdn\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i video\.pornhub\.phncdn\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i public\.keezmovies\.phncdn\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i public\.youporn\.phncdn\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i public\.spankwire\.phncdn\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i public\.keezmovies\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i public\.spankwire\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i pornhub\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i slutload-media\.com
</I>&gt;<i> acl store_rewrite_list url_regex -i hardsextube\.com
</I>
.. to here are duplicates. Remove them all.

&gt;<i> 
</I>&gt;<i> acl store_rewrite_list_domain url_regex
</I>&gt;<i> ^http:\/\/([a-zA-Z-]+[0-9-]+)\.[A-Za-z]*\.[A-Za-z]*
</I>
So, this matches almost every URL that exists with a domain containing
at least two '.' characters.

Go through what remains of the store_rewrite_list ACL lines and remove
the patterns that are searching for domians with two dots in them.
For example &quot;attachment\.fbsbx\.com&quot;.

Also simplify the patterns that are search for domains with two dots OR
some alternative. For Example; &quot;-i ggpht\.co(m|\.(id|uk))&quot; can be
replaced with &quot;-i ggpht\.com&quot; since the .co.id and .co.uk versions will
be matched here.


&gt;<i> acl store_rewrite_list_domain url_regex
</I>&gt;<i> (([a-z]{1,2}[0-9]{1,3})|([0-9]{1,3}[a-z]{1,2}))\.[a-z]*[0-9]?\.[a-z]{3}
</I>
For the non- <A HREF="http://">http://</A> URLs the above pattern did not match, this repeats
the search in a little more detail and matches all those 2-dot domains
and along with a number of others in the <A HREF="http://">http://</A> URL space.


&gt;<i> acl store_rewrite_list_path urlpath_regex
</I>&gt;<i> \.(jp(e?g|e|2)|gif|png|tiff?|bmp|ico|flv|avc|zip|mp3|3gp|rar|on2|mar|exe)$
</I>&gt;<i> acl store_rewrite_list_domain_CDN url_regex (khm|mt)[0-9]?.google.com
</I>
Your &quot;store_rewrite_list&quot; list contains a pattern that matches the
sub-string &quot;google.com&quot; without any qualifications.

 You can replace the &quot;(khm|mt)[0-9]?.google.com&quot; with &quot;google\.com&quot;

 Then remove all the store_rewrite_list pattens for google.com


&gt;<i> streamate.doublepimp.com.*\.js\? photos-[a-z].ak.fbcdn.net
</I>&gt;<i> \.rapidshare\.com.*\/[0-9]*\/.*\/[^\/]*
</I>&gt;<i> ^http:\/\/(www\.ziddu\.com.*\.[^\/]{3,4})\/(.*) \.doubleclick\.net.*
</I>&gt;<i> yieldmanager cpxinteractive
</I>&gt;<i> ^http:\/\/[.a-z0-9]*\.photobucket\.com.*\.[a-z]{3}$ quantserve\.com
</I>&gt;<i> 
</I>&gt;<i> store_id_access allow store_rewrite_list
</I>&gt;<i> store_id_access allow store_rewrite_list_domain
</I>&gt;<i> store_id_access allow store_rewrite_list_path
</I>&gt;<i> store_id_access allow store_rewrite_list_domain_CDN
</I>&gt;<i> 
</I>
Since these are all doing &quot;allow&quot; action the order does not matter.

Your Squid will work much faster if you switch the order of these lines
so the smaller / simpler patterns are tested first:

 store_id_access allow store_rewrite_list_domain
 store_id_access allow store_rewrite_list_path
 store_id_access allow store_rewrite_list_domain_CDN
 store_id_access allow store_rewrite_list


&gt;<i> 
</I>&gt;<i> ####for looping 302 on youtube
</I>&gt;<i> acl text-html rep_mime_type text/html
</I>&gt;<i> acl http302 http_status 302
</I>&gt;<i> 
</I>&gt;<i> store_miss deny text-html
</I>
Seriously? After all the patterns forcing caching and refresh_patterns
trying to force things to be stored longer than their designers coded
for ... you never want any HTML content to be cached?


&gt;<i> store_miss deny http302
</I>&gt;<i> send_hit deny text-html
</I>&gt;<i> send_hit deny http302
</I>&gt;<i> 
</I>&gt;<i> acl norewrite url_regex -i redirector\.c\.android\.clients\.google\.com
</I>&gt;<i> store_id_access deny norewrite
</I>
You have a pattern in the store_rewrite_list* ACLs that already allows
anything matching &quot;google.com&quot; to be re-written. By the time this config
line takes effect nothing can ever match it.

&gt;<i> 
</I>&gt;<i> ##this for send to storeid
</I>&gt;<i> acl youtube_to_storeid url_regex -i
</I>&gt;<i> ^https?:\/\/.*(youtube|google).*(set_awesome|stream_204|playback|ptracking|watchtime|atr|player_204|videogoodput|get_video|get_video_info|s\?|delayplay|ads|qoe|gen_204).*(video_id|docid|\&amp;v|content_v)\=([^\&amp;\s]*).*
</I>&gt;<i> acl youtube_to_storeid url_regex -i
</I>&gt;<i> ^https?:\/\/.*(youtube|google).*videoplayback.*
</I>&gt;<i> 
</I>&gt;<i> acl gvt1_to_storeid url_regex -i ^https?:\/\/.*\.gvt1\.com\/market\/.*
</I>&gt;<i> acl mgccw_to_storeid url_regex -i ^https?:\/\/.*\.mgccw\.com\/.*
</I>&gt;<i> 
</I>
Both of the above ACLs are looking for domains with 2 dots in them.
Your store_rewrite_list_domain ACL has already matched and passed the
request to the Store-ID helper. Neither of these ACLs will ever be used.


&gt;<i> store_id_access allow youtube_to_storeid
</I>&gt;<i> store_id_access allow gvt1_to_storeid
</I>&gt;<i> store_id_access allow mgccw_to_storeid
</I>&gt;<i> 
</I>&gt;<i> ## this for 206
</I>&gt;<i> acl partial dstdomain .googlevideo.com
</I>&gt;<i> acl partial dstdomain .youtube.com
</I>&gt;<i> acl partial dstdomain .mgccw.com
</I>&gt;<i> range_offset_limit none partial
</I>&gt;<i> store_id_access allow  partial
</I>&gt;<i> 
</I>

&gt;<i> 
</I>&gt;<i> acl queryreg url_regex -i gemscool\.com\/registration\/.*
</I>&gt;<i> acl queryreg url_regex -i gemscool\.com\/isiGcash\/.*
</I>&gt;<i> acl queryreg url_regex -i ^http.*live\.mytrans\.com.*
</I>&gt;<i> acl queryreg url_regex -i ^http.*socialpointgames\.com\/dragoncity.*USERID.*
</I>&gt;<i> acl queryreg url_regex -i ^http.*fb_source=bookmark_apps.*
</I>&gt;<i> acl queryreg url_regex -i ^http.*gvoucher.*
</I>&gt;<i> acl queryreg url_regex -i ^http.*\.(asp|aspx|php|xml)(\?.*|)$
</I>&gt;<i> 
</I>&gt;<i> cache deny queryreg
</I>&gt;<i> 
</I>&gt;<i> acl playstoreandroid url_regex -i
</I>&gt;<i> c.android.clients.google.com.market.GetBinary.GetBinary.*
</I>&gt;<i> store_id_access allow playstoreandroid
</I>
Here is another pattern that has no effect behind the 2-dot domain name
ones. In particular the 2-dot pattern matching URLs without requiring
<A HREF="http://">http://</A> initial prefix.


Thats all I've got time for today. The config has plenty of other little
gotchas though.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003357.html">[squid-users] assertion failed: comm.cc:178: &quot;fd_table[conn-&gt;fd].halfClosedReader != NULL&quot;
</A></li>
	<LI>Next message (by thread): <A HREF="003385.html">[squid-users] assertion failed: comm.cc:178: &quot;fd_table[conn-&gt;fd].halfClosedReader != NULL&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3359">[ date ]</a>
              <a href="thread.html#3359">[ thread ]</a>
              <a href="subject.html#3359">[ subject ]</a>
              <a href="author.html#3359">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
