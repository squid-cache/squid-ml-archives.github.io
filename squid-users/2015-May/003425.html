<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Youtube redirection loop?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Youtube%20redirection%20loop%3F&In-Reply-To=%3C55476DF0.6040008%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003433.html">
   <LINK REL="Next"  HREF="003444.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Youtube redirection loop?</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Youtube%20redirection%20loop%3F&In-Reply-To=%3C55476DF0.6040008%40gmail.com%3E"
       TITLE="[squid-users] Youtube redirection loop?">yvoinov at gmail.com
       </A><BR>
    <I>Mon May  4 13:02:40 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003433.html">[squid-users] about squid choose sibing
</A></li>
        <LI>Next message (by thread): <A HREF="003444.html">[squid-users] Youtube redirection loop?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3425">[ date ]</a>
              <a href="thread.html#3425">[ thread ]</a>
              <a href="subject.html#3425">[ subject ]</a>
              <a href="author.html#3425">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi gents.

I made a little research and found one funny problem with Youtube/HTML5 
caching.

When youtube output video, it starts with similar URL:

<A HREF="https://r12---sn-n8v7ln7y.googlevideo.com/videoplayback?c=web&amp;clen=362967&amp;cpn=6UqpMRDeKbePCzao&amp;cver=as3&amp;dur=30.046&amp;expire=1430763762&amp;fexp=900720%2C905652%2C907263%2C908213%2C916943%2C934954%2C938028%2C938813%2C9406849%2C9407992%2C9408352%2C9408708%2C9409252%2C9412764%2C9412987%2C9413139%2C945132%2C946008%2C948124%2C952612%2C952637%2C952642%2C957201&amp;gir=yes&amp;id=o-AKfRzAOg4Wx4u0w4O4uMwhUypQ8lfQ0riWhgnXOmtT_L&amp;ip=178.88.163.102&amp;ipbits=0&amp;itag=140&amp;keepalive=yes&amp;key=cms1&amp;lmt=1406330458866919&amp;mime=audio%2Fmp4&amp;pl=24&amp;range=0-208895&amp;ratebypass=yes&amp;requiressl=yes&amp;signature=72081B97C3180361969C07CDF014AB28B3A98C11.80C66D318F85132651B8044DA65F07A6C910A47B&amp;source=youtube&amp;sparams=clen,dur,expire,gir,id,initcwndbps,ip,ipbits,itag,keepalive,lmt,mime,mm,mn,ms,mv,pl,requiressl,source,upn&amp;sver=3&amp;upn=OgQOo91qH8U&amp;redirect_counter=1&amp;req_id=c3d2118808f2e5a8&amp;cms_redirect=yes&amp;mm=30&amp;mn=sn-n8v7ln7y&amp;ms=nxu&amp;mt=1430741825&amp;mv=u">https://r12---sn-n8v7ln7y.googlevideo.com/videoplayback?c=web&amp;clen=362967&amp;cpn=6UqpMRDeKbePCzao&amp;cver=as3&amp;dur=30.046&amp;expire=1430763762&amp;fexp=900720%2C905652%2C907263%2C908213%2C916943%2C934954%2C938028%2C938813%2C9406849%2C9407992%2C9408352%2C9408708%2C9409252%2C9412764%2C9412987%2C9413139%2C945132%2C946008%2C948124%2C952612%2C952637%2C952642%2C957201&amp;gir=yes&amp;id=o-AKfRzAOg4Wx4u0w4O4uMwhUypQ8lfQ0riWhgnXOmtT_L&amp;ip=178.88.163.102&amp;ipbits=0&amp;itag=140&amp;keepalive=yes&amp;key=cms1&amp;lmt=1406330458866919&amp;mime=audio%2Fmp4&amp;pl=24&amp;range=0-208895&amp;ratebypass=yes&amp;requiressl=yes&amp;signature=72081B97C3180361969C07CDF014AB28B3A98C11.80C66D318F85132651B8044DA65F07A6C910A47B&amp;source=youtube&amp;sparams=clen,dur,expire,gir,id,initcwndbps,ip,ipbits,itag,keepalive,lmt,mime,mm,mn,ms,mv,pl,requiressl,source,upn&amp;sver=3&amp;upn=OgQOo91qH8U&amp;redirect_counter=1&amp;req_id=c3d2118808f2e5a8&amp;cms_redirect=yes&amp;mm=30&amp;mn=sn-n8v7ln7y&amp;ms=nxu&amp;mt=1430741825&amp;mv=u</A>

which has mime type text/plain.

The size of this is above 512 bytes now (consists approx. 1-2 Kb). It is 
not good idea to deny caching redirector with cache object size, because 
of too much objects with size 1-2 Kb will gone cache.

So, when we cache this URL, we got redirection loop and youtube works 
poor or not works completely.

Yes, when I no cache a whole comain (googlevideo.com), it works with 
some delays finally. But I suggest that store-id is also stop working. 
In any case, YT shows serious delays full time with Chrome/FF (in IE all 
works perfectly).

The problem is - audio/video outputs from THE SAME domain.

I suggest, that to solve problem (squid with store-id, and I need cache 
YT) I need to make no cache for text/plain mime from .googlevideo.com 
domain.

I have no idea how to make it with Squid.

Some advice will be helpful.

WBR, Yuri


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003433.html">[squid-users] about squid choose sibing
</A></li>
	<LI>Next message (by thread): <A HREF="003444.html">[squid-users] Youtube redirection loop?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3425">[ date ]</a>
              <a href="thread.html#3425">[ thread ]</a>
              <a href="subject.html#3425">[ subject ]</a>
              <a href="author.html#3425">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
