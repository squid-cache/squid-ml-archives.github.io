<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] vary headers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20vary%20headers&In-Reply-To=%3C554790FC.5050105%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003434.html">
   <LINK REL="Next"  HREF="003439.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] vary headers</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20vary%20headers&In-Reply-To=%3C554790FC.5050105%40treenet.co.nz%3E"
       TITLE="[squid-users] vary headers">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon May  4 15:32:12 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003434.html">[squid-users] vary headers
</A></li>
        <LI>Next message (by thread): <A HREF="003439.html">[squid-users] vary headers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3435">[ date ]</a>
              <a href="thread.html#3435">[ thread ]</a>
              <a href="subject.html#3435">[ subject ]</a>
              <a href="author.html#3435">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 5/05/2015 3:15 a.m., Hussam Al-Tayeb wrote:
&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> Sent: Monday, May 04, 2015 at 12:49 PM
</I>&gt;&gt;<i> From: &quot;Amos Jeffries&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
</I>&gt;&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> Subject: Re: [squid-users] vary headers
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 4/05/2015 6:54 a.m., Hussam Al-Tayeb wrote:
</I>&gt;&gt;&gt;&gt;<i> Sent: Sunday, May 03, 2015 at 9:45 PM
</I>&gt;&gt;&gt;&gt;<i> From: &quot;Yuri Voinov&quot;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> I understand what do your want. But for what?
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> because a &quot;wget --server-response <A HREF="http://someurl">http://someurl</A>&quot; operation that
</I>&gt;&gt;&gt;<i> replies with a &quot;Vary: user-agent&quot; header always results in a MISS
</I>&gt;&gt;&gt;<i> even if the same wget version (same user-agent) and computer.
</I>&gt;&gt;&gt;<i> Instead, multiple copies of the file are stored.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> That is not right, the wget being used twice should be MISS then HIT,
</I>&gt;&gt;<i> just like any oter cacheable traffic.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The nasty thing with Vary:User-Agent is that browsers UA string embeds
</I>&gt;&gt;<i> so much plugin info they are changing between each different client
</I>&gt;&gt;<i> request. Which defeats the purpose of caching one clients reply for use
</I>&gt;&gt;<i> by other clients.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> NP: what you had with the store_miss should be working.
</I>&gt;&gt;<i>  Are you using Squid-3.5 ?
</I>&gt;&gt;<i>  How are you identifying a fail ?
</I>&gt;&gt;<i>
</I>
&gt;<i> Hello. I am using 3.5.4
</I>&gt;<i> There are new objects on disk that have the Vary: User-Agent Http header.
</I>&gt;<i> I can tell for example if type head -n13 /home/squid/04/D1/0004D122
</I>&gt;<i> 
</I>
That is not a good way to identify. All it means is that the object used
a disk file for its transfer. Cache files are also sometimes used as
on-disk buffers.

If you check with store.log for ID (0004D122) you should expect to see
that file pushed to disk, then a cache index RELEASED action performed.
The file part may stay on disk until something else needs to use the
same filename.

The ways to identify caching activity is:
 * access.log - checking that no HIT or REFRESH occur on the relevant
URLs, or
 * store.log - checking that objects with the URLs are all getting that
RELEASED action.
 * cache.log - setting &quot;debug_options 20,3&quot; and watching for &quot;store_miss
prohibits caching&quot;

There is unfortunatly currently no easy debugs linking what URL
store_miss prohibited to correlate the logs :-(

Amos




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003434.html">[squid-users] vary headers
</A></li>
	<LI>Next message (by thread): <A HREF="003439.html">[squid-users] vary headers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3435">[ date ]</a>
              <a href="thread.html#3435">[ thread ]</a>
              <a href="subject.html#3435">[ subject ]</a>
              <a href="author.html#3435">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
