<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] vary headers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20vary%20headers&In-Reply-To=%3Ctrinity-9a899f99-a1d5-4620-ba5f-9189e6d2b713-1430762984990%403capp-mailcom-bs15%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003440.html">
   <LINK REL="Next"  HREF="003451.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] vary headers</H1>
    <B>Hussam Al-Tayeb</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20vary%20headers&In-Reply-To=%3Ctrinity-9a899f99-a1d5-4620-ba5f-9189e6d2b713-1430762984990%403capp-mailcom-bs15%3E"
       TITLE="[squid-users] vary headers">hussam.tayeb at gmx.com
       </A><BR>
    <I>Mon May  4 18:09:45 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003440.html">[squid-users] vary headers
</A></li>
        <LI>Next message (by thread): <A HREF="003451.html">[squid-users] vary headers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3441">[ date ]</a>
              <a href="thread.html#3441">[ thread ]</a>
              <a href="subject.html#3441">[ subject ]</a>
              <a href="author.html#3441">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

&gt;<i> Sent: Monday, May 04, 2015 at 9:04 PM
</I>&gt;<i> From: &quot;Amos Jeffries&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
</I>&gt;<i> To: &quot;Hussam Al-Tayeb&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">hussam.tayeb at gmx.com</A>&gt;
</I>&gt;<i> Cc: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: Re: [squid-users] vary headers
</I>&gt;<i>
</I>&gt;<i> On 5/05/2015 4:38 a.m., Hussam Al-Tayeb wrote:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;&gt; Sent: Monday, May 04, 2015 at 6:32 PM
</I>&gt;<i> &gt;&gt; From: &quot;Amos Jeffries&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
</I>&gt;<i> &gt;&gt; To: &quot;Hussam Al-Tayeb&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">hussam.tayeb at gmx.com</A>&gt;
</I>&gt;<i> &gt;&gt; Cc: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt;&gt; Subject: Re: [squid-users] vary headers
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; On 5/05/2015 3:15 a.m., Hussam Al-Tayeb wrote:
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt; Sent: Monday, May 04, 2015 at 12:49 PM
</I>&gt;<i> &gt;&gt;&gt;&gt; From: &quot;Amos Jeffries&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt; To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt;&gt;&gt;&gt; Subject: Re: [squid-users] vary headers
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt; On 4/05/2015 6:54 a.m., Hussam Al-Tayeb wrote:
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; Sent: Sunday, May 03, 2015 at 9:45 PM
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; From: &quot;Yuri Voinov&quot;
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; I understand what do your want. But for what?
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; because a &quot;wget --server-response <A HREF="http://someurl">http://someurl</A>&quot; operation that
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; replies with a &quot;Vary: user-agent&quot; header always results in a MISS
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; even if the same wget version (same user-agent) and computer.
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Instead, multiple copies of the file are stored.
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt; That is not right, the wget being used twice should be MISS then HIT,
</I>&gt;<i> &gt;&gt;&gt;&gt; just like any oter cacheable traffic.
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt; The nasty thing with Vary:User-Agent is that browsers UA string embeds
</I>&gt;<i> &gt;&gt;&gt;&gt; so much plugin info they are changing between each different client
</I>&gt;<i> &gt;&gt;&gt;&gt; request. Which defeats the purpose of caching one clients reply for use
</I>&gt;<i> &gt;&gt;&gt;&gt; by other clients.
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt; NP: what you had with the store_miss should be working.
</I>&gt;<i> &gt;&gt;&gt;&gt;  Are you using Squid-3.5 ?
</I>&gt;<i> &gt;&gt;&gt;&gt;  How are you identifying a fail ?
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Hello. I am using 3.5.4
</I>&gt;<i> &gt;&gt;&gt; There are new objects on disk that have the Vary: User-Agent Http header.
</I>&gt;<i> &gt;&gt;&gt; I can tell for example if type head -n13 /home/squid/04/D1/0004D122
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; That is not a good way to identify. All it means is that the object used
</I>&gt;<i> &gt;&gt; a disk file for its transfer. Cache files are also sometimes used as
</I>&gt;<i> &gt;&gt; on-disk buffers.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; If you check with store.log for ID (0004D122) you should expect to see
</I>&gt;<i> &gt;&gt; that file pushed to disk, then a cache index RELEASED action performed.
</I>&gt;<i> &gt;&gt; The file part may stay on disk until something else needs to use the
</I>&gt;<i> &gt;&gt; same filename.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; The ways to identify caching activity is:
</I>&gt;<i> &gt;&gt;  * access.log - checking that no HIT or REFRESH occur on the relevant
</I>&gt;<i> &gt;&gt; URLs, or
</I>&gt;<i> &gt;&gt;  * store.log - checking that objects with the URLs are all getting that
</I>&gt;<i> &gt;&gt; RELEASED action.
</I>&gt;<i> &gt;&gt;  * cache.log - setting &quot;debug_options 20,3&quot; and watching for &quot;store_miss
</I>&gt;<i> &gt;&gt; prohibits caching&quot;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; There is unfortunatly currently no easy debugs linking what URL
</I>&gt;<i> &gt;&gt; store_miss prohibited to correlate the logs :-(
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Amos
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt; ok, I tried setting debug_options.
</I>&gt;<i> &gt; this is part of what I found:
</I>&gt;<i> &gt; <A HREF="http://pastebin.com/raw.php?i=4HTw9es3">http://pastebin.com/raw.php?i=4HTw9es3</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; So it looks like it only blocks caching of Vary header if followed by &quot;Accept-Encoding: gzip,deflate&quot;?
</I>&gt;<i> &gt; 
</I>&gt;<i> 
</I>&gt;<i> Ah, your regex pattern was &quot;.&quot; so if Vary header exists at all it will
</I>&gt;<i> block that response caching.
</I>&gt;<i> 
</I>&gt;<i> Since its working now use:
</I>&gt;<i> 
</I>&gt;<i>  acl hasVary rep_header Vary User-Agent
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Amos
</I>&gt;<i> 
</I>Ok, thank you. How would I modify that to include
Vary: somethingelse, User-Agent
and Vary: User-Agent, somethingelse?
Thanks again!

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003440.html">[squid-users] vary headers
</A></li>
	<LI>Next message (by thread): <A HREF="003451.html">[squid-users] vary headers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3441">[ date ]</a>
              <a href="thread.html#3441">[ thread ]</a>
              <a href="subject.html#3441">[ subject ]</a>
              <a href="author.html#3441">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
