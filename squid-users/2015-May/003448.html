<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid crashes with 3.5.1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20crashes%20with%203.5.1&In-Reply-To=%3CCAMFQPn-PQ_bVukF6U1%2B94tHmhN%2BxzcnGM8jBa1uycViJB-wG3g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003458.html">
   <LINK REL="Next"  HREF="003450.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid crashes with 3.5.1</H1>
    <B>Prashanth Prabhu</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20crashes%20with%203.5.1&In-Reply-To=%3CCAMFQPn-PQ_bVukF6U1%2B94tHmhN%2BxzcnGM8jBa1uycViJB-wG3g%40mail.gmail.com%3E"
       TITLE="[squid-users] Squid crashes with 3.5.1">prashanth.prabhu at gmail.com
       </A><BR>
    <I>Mon May  4 22:59:07 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003458.html">[squid-users] Number of clients accessing cache: 0
</A></li>
        <LI>Next message (by thread): <A HREF="003450.html">[squid-users] Squid crashes with 3.5.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3448">[ date ]</a>
              <a href="thread.html#3448">[ thread ]</a>
              <a href="subject.html#3448">[ subject ]</a>
              <a href="author.html#3448">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi folks,

I am seeing a bunch of Squid crashes after moving recently to 3.5.1.
The stack trace for the various crashes is below, along with info I
have been able to gather for them. This is on a setup where we have
Squid running in conjunction with c-icap (both on the same box).The
steps that led to these crashes isn't known yet.

Squid runs in non-transparent mode. It proxies both HTTP and HTTPS connections.

A couple of the crashes look to have been caused in the path where
Squid interacts with c-icap. The c-icap version is somewhat old --
0.1.7 -- although it was working well with a version 3.3.13 Squid
until the recent move.

Do any of the fixes (listed below, where I have found references) help
here? Any other known issues that may be related?


Thanks.
Prashanth


pprabhu:~$ sudo egrep 'assertion failed' /var/log/elastica/gateway/cache.log
2015/03/31 19:56:09| assertion failed: Read.cc:69:
&quot;fd_table[conn-&gt;fd].halfClosedReader != NULL&quot;
2015/04/01 07:04:59| assertion failed: Read.cc:205: &quot;params.data == data&quot;
2015/04/01 07:37:31| assertion failed: Read.cc:69:
&quot;fd_table[conn-&gt;fd].halfClosedReader != NULL&quot;
2015/04/01 11:06:29| assertion failed: Read.cc:69:
&quot;fd_table[conn-&gt;fd].halfClosedReader != NULL&quot;
2015/04/07 18:23:54| assertion failed: comm.cc:557: &quot;F-&gt;flags.open&quot;
2015/04/08 05:01:57| assertion failed: Read.cc:69:
&quot;fd_table[conn-&gt;fd].halfClosedReader != NULL&quot;
2015/04/08 14:46:01| assertion failed: Read.cc:69:
&quot;fd_table[conn-&gt;fd].halfClosedReader != NULL&quot;
2015/04/08 18:04:13| assertion failed: Read.cc:205: &quot;params.data ==
data&quot; IMMEDIATELY.
2015/04/13 09:38:28| assertion failed: Read.cc:69:
&quot;fd_table[conn-&gt;fd].halfClosedReader != NULL&quot;
2015/04/20 23:34:46| assertion failed: Read.cc:69:
&quot;fd_table[conn-&gt;fd].halfClosedReader != NULL&quot;
2015/04/28 23:12:40| assertion failed: Read.cc:69:
&quot;fd_table[conn-&gt;fd].halfClosedReader != NULL&quot;
2015/04/28 23:46:24| assertion failed: Read.cc:205: &quot;params.data == data&quot;
2015/04/28 23:59:07| assertion failed: Read.cc:69:
&quot;fd_table[conn-&gt;fd].halfClosedReader != NULL&quot;
2015/04/29 18:06:01| assertion failed: Read.cc:69:
&quot;fd_table[conn-&gt;fd].halfClosedReader != NULL&quot;



2015/04/28 23:46:24| assertion failed: Read.cc:205: &quot;params.data == data&quot;
----
<A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/assertion-failed-Read-cc-205-quot-params-data-data-quot-td4670624.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/assertion-failed-Read-cc-205-quot-params-data-data-quot-td4670624.html</A>


pprabhu:~$ gdb /usr/local/sbin/squid core-squid-508-1430264784
GNU gdb (Ubuntu/Linaro 7.4-2012.04-0ubuntu2.1) 7.4-2012.04
Copyright (C) 2012 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;<A HREF="http://gnu.org/licenses/gpl.html">http://gnu.org/licenses/gpl.html</A>&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;
and &quot;show warranty&quot; for details.
This GDB was configured as &quot;x86_64-linux-gnu&quot;.
For bug reporting instructions, please see:
&lt;<A HREF="http://bugs.launchpad.net/gdb-linaro/">http://bugs.launchpad.net/gdb-linaro/</A>&gt;...
Reading symbols from /usr/local/sbin/squid...done.
[New LWP 508]

warning: Can't read pathname for load map: Input/output error.
[Thread debugging using libthread_db enabled]
Using host libthread_db library &quot;/lib/x86_64-linux-gnu/libthread_db.so.1&quot;.
Core was generated by `/usr/local/sbin/squid -N -f /etc/squid/squid.conf -D'.
Program terminated with signal 6, Aborted.
#0  0x00007fd235dba0d5 in raise () from /lib/x86_64-linux-gnu/libc.so.6
(gdb) bt
#0  0x00007fd235dba0d5 in raise () from /lib/x86_64-linux-gnu/libc.so.6
#1  0x00007fd235dbd83b in abort () from /lib/x86_64-linux-gnu/libc.so.6
    callback=0x6109a0 &lt;IdleConnList::Read(RefCount&lt;Comm::Connection&gt;
const&amp;, char*, unsigned long, Comm::Flag, int, void*)&gt;, data=0xe1b078)
    at Read.cc:205
#4  0x000000000060dc54 in IdleConnList::clearHandlers (this=0xe1b078,
conn=...) at pconn.cc:157
#5  0x00000000006111cf in IdleConnList::pop (this=0xe1b078) at pconn.cc:223
#6  0x0000000000804f13 in Adaptation::Icap::ServiceRep::getConnection
(this=0xe1ac88, retriableXact=&lt;optimized out&gt;,
    reused=@0x7fff42b82bef: false) at ServiceRep.cc:116
#7  0x0000000000810f7f in Adaptation::Icap::Xaction::openConnection
(this=0x1847a68) at Xaction.cc:125
#8  0x000000000081fbc0 in Adaptation::Icap::ModXact::start
(this=0x1847a68) at ModXact.cc:101
#9  0x00000000006f5a84 in JobDialer&lt;AsyncJob&gt;::dial (this=0x18f81e0,
call=...) at ../../src/base/AsyncJobCalls.h:174
#10 0x00000000006f2309 in AsyncCall::make (this=0x18f81b0) at AsyncCall.cc:40
#11 0x00000000006f61ec in AsyncCallQueue::fireNext (this=&lt;optimized
out&gt;) at AsyncCallQueue.cc:56
#12 0x00000000006f6540 in AsyncCallQueue::fire (this=0xdd8d80) at
AsyncCallQueue.cc:42
#13 0x0000000000593bbc in EventLoop::runOnce (this=0x7fff42b82dc0) at
EventLoop.cc:120
#14 0x0000000000593d70 in EventLoop::run (this=0x7fff42b82dc0) at
EventLoop.cc:82
#15 0x00000000005f7d83 in SquidMain (argc=&lt;optimized out&gt;,
argv=&lt;optimized out&gt;) at main.cc:1508
#16 0x000000000050a0db in SquidMainSafe (argv=&lt;optimized out&gt;,
argc=&lt;optimized out&gt;) at main.cc:1240
#17 main (argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;) at main.cc:1233
(gdb) fr 3
#3  0x0000000000796908 in comm_read_cancel (fd=40,
    callback=0x6109a0 &lt;IdleConnList::Read(RefCount&lt;Comm::Connection&gt;
const&amp;, char*, unsigned long, Comm::Flag, int, void*)&gt;, data=0xe1b078)
    at Read.cc:205
205 Read.cc: No such file or directory.
----



2015/04/28 23:59:07| assertion failed: Read.cc:69:
&quot;fd_table[conn-&gt;fd].halfClosedReader != NULL&quot;
----
(gdb) bt
#0  0x00007f7ba4ad80d5 in raise () from /lib/x86_64-linux-gnu/libc.so.6
#1  0x00007f7ba4adb83b in abort () from /lib/x86_64-linux-gnu/libc.so.6
#2  0x000000000058174f in xassert (msg=0x899348 &quot;g read handler on FD
&quot;, file=0x8991bf &quot;nish&quot;, line=69) at debug.cc:544
#3  0x0000000000797410 in comm_read_base (conn=..., buf=0x124cbf0 &quot;&quot;,
size=65535, callback=...) at Read.cc:69
#4  0x000000000080f1b9 in comm_read (callback=..., len=65535,
buf=0x124cbf0 &quot;&quot;, conn=...) at ../../../src/comm/Read.h:58
#5  Adaptation::Icap::Xaction::scheduleRead (this=0x124bb78) at Xaction.cc:397
#6  0x000000000081ba78 in Adaptation::Icap::ModXact::readMore
(this=0x124bb78) at ModXact.cc:561
#7  0x0000000000823742 in
Adaptation::Icap::ModXact::handleCommConnected (this=0x124bb78) at
ModXact.cc:191
#8  0x000000000080ff2b in Adaptation::Icap::Xaction::noteCommConnected
(this=0x124bb78, io=...) at Xaction.cc:266
#9  0x0000000000813a4b in JobDialer&lt;Adaptation::Icap::Xaction&gt;::dial
(this=0x1d150a0, call=...) at ../../../src/base/AsyncJobCalls.h:174
#10 0x00000000006f2309 in AsyncCall::make (this=0x1d15070) at AsyncCall.cc:40
#11 0x00000000006f61ec in AsyncCallQueue::fireNext (this=&lt;optimized
out&gt;) at AsyncCallQueue.cc:56
#12 0x00000000006f6540 in AsyncCallQueue::fire (this=0xdd8a50) at
AsyncCallQueue.cc:42
#13 0x0000000000593bbc in EventLoop::runOnce (this=0x7fff37077350) at
EventLoop.cc:120
#14 0x0000000000593d70 in EventLoop::run (this=0x7fff37077350) at
EventLoop.cc:82
#15 0x00000000005f7d83 in SquidMain (argc=&lt;optimized out&gt;,
argv=&lt;optimized out&gt;) at main.cc:1508
#16 0x000000000050a0db in SquidMainSafe (argv=&lt;optimized out&gt;,
argc=&lt;optimized out&gt;) at main.cc:1240
#17 main (argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;) at main.cc:1233


<A HREF="http://bugs.squid-cache.org/show_bug.cgi?id=3775">http://bugs.squid-cache.org/show_bug.cgi?id=3775</A>
-- Stacktrace is different. c-icap connection appears to be where the assert
   was tripped.

<A HREF="http://bugs.squid-cache.org/show_bug.cgi?id=4173">http://bugs.squid-cache.org/show_bug.cgi?id=4173</A>
-- Dup of 3775
----


2015/04/07 18:23:54| assertion failed: comm.cc:557: &quot;F-&gt;flags.open&quot;
----
<A HREF="http://bugs.squid-cache.org/show_bug.cgi?id=3329">http://bugs.squid-cache.org/show_bug.cgi?id=3329</A>
-- Directed here, via
   <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/assertion-failed-comm-cc-557-quot-F-gt-flags-open-quot-td4670788.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/assertion-failed-comm-cc-557-quot-F-gt-flags-open-quot-td4670788.html</A>
----

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003458.html">[squid-users] Number of clients accessing cache: 0
</A></li>
	<LI>Next message (by thread): <A HREF="003450.html">[squid-users] Squid crashes with 3.5.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3448">[ date ]</a>
              <a href="thread.html#3448">[ thread ]</a>
              <a href="subject.html#3448">[ subject ]</a>
              <a href="author.html#3448">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
