<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSL Peak and Splice
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20Peak%20and%20Splice&In-Reply-To=%3C55553407.2020000%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003576.html">
   <LINK REL="Next"  HREF="003558.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSL Peak and Splice</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20Peak%20and%20Splice&In-Reply-To=%3C55553407.2020000%40treenet.co.nz%3E"
       TITLE="[squid-users] SSL Peak and Splice">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu May 14 23:47:19 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003576.html">[squid-users] SSL Peak and Splice
</A></li>
        <LI>Next message (by thread): <A HREF="003558.html">[squid-users] transparent proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3577">[ date ]</a>
              <a href="thread.html#3577">[ thread ]</a>
              <a href="subject.html#3577">[ subject ]</a>
              <a href="author.html#3577">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 15/05/2015 11:15 a.m., Casey Daniels wrote:
&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On 05/14/2015 12:37 AM, Amos Jeffries wrote:
</I>&gt;&gt;&gt;<i> Yes the second option, not the particular machine, but the FQDN
</I>&gt;&gt;&gt;<i> (i.e.&lt;<A HREF="http://www.cooking.com">http://www.cooking.com</A>&gt; )
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   # get TLS SNI details etc
</I>&gt;&gt;<i>   ssl_bump peek all
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   # some get rejected
</I>&gt;&gt;<i>   acl blocked ssl:server_name .example.com
</I>&gt;&gt;<i>   ssl_bump reject blocked
</I>&gt;&gt;<i>
</I>
Sorry, I see now that should have been:
 ssl_bump terminate blocked


&gt;&gt;<i>   # the rest allowed without decrypting
</I>&gt;&gt;<i>   ssl_bump splice all
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> When is the TLS SNI information made available by the client?
</I>&gt;&gt;<i> They send it or they dont. Nothign you or we can do about it.
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> One Follow up question.
</I>&gt;<i> 
</I>&gt;<i> You said &quot;They send it or they don't. Nothing you or we can do about
</I>&gt;<i> it.&quot; Are you referring to that we don't have control if they send it or
</I>&gt;<i> not, or there is nothing we can do if they don't?
</I>&gt;<i> 
</I>
Both.


&gt;<i> My question is, is there some way to either reject the conection, or do
</I>&gt;<i> a full SSL bump the connection for further examnation if the TLS SNI
</I>&gt;<i> information isn't present?
</I>
Have a read through the &quot;actions&quot; list in
&lt;<A HREF="http://wiki.squid-cache.org/Features/SslPeekAndSplice">http://wiki.squid-cache.org/Features/SslPeekAndSplice</A>&gt;.

In the above config snippet the &quot;peek&quot; action will get the server FQDN
from client SNI in intercepted traffic, or if it gets to step 2 the
server name from the certificate.


Write down in words the exact sequence of things you want Squid to do
and usually that will be what the config options look like.


&gt;<i>  From my understanding all modern browsers
</I>&gt;<i> should be sending the TLS SNI information, and the SSL fallback has been
</I>&gt;<i> disabled by default on them except for Windows IE.  So blocking
</I>&gt;<i> connections that fail to give TLS SNI information doesn't appear to be a
</I>&gt;<i> problem except for people using outdated devices.
</I>
Or the over-50% of web traffic that is not sent by browsers. SNI is a
relatively new feature and usage is growing, so YMWV.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003576.html">[squid-users] SSL Peak and Splice
</A></li>
	<LI>Next message (by thread): <A HREF="003558.html">[squid-users] transparent proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3577">[ date ]</a>
              <a href="thread.html#3577">[ thread ]</a>
              <a href="subject.html#3577">[ subject ]</a>
              <a href="author.html#3577">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
