<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3.4.8 with ssl-bump config.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.4.8%20with%20ssl-bump%20config.&In-Reply-To=%3C555DB693.4080409%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003662.html">
   <LINK REL="Next"  HREF="003672.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3.4.8 with ssl-bump config.</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.4.8%20with%20ssl-bump%20config.&In-Reply-To=%3C555DB693.4080409%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid 3.4.8 with ssl-bump config.">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu May 21 10:42:27 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003662.html">[squid-users] Squid 3.4.8 with ssl-bump config.
</A></li>
        <LI>Next message (by thread): <A HREF="003672.html">[squid-users] url_rewrite_extras - not getting data excepted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3668">[ date ]</a>
              <a href="thread.html#3668">[ thread ]</a>
              <a href="subject.html#3668">[ subject ]</a>
              <a href="author.html#3668">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 21/05/2015 9:50 p.m., Tony Pe&#241;a wrote:
&gt;<i> Hi again..
</I>&gt;<i> 
</I>&gt;<i> now work ok the compilation.. but have issues with the https sites.
</I>&gt;<i> 
</I>&gt;<i> squid start ok... but can't see the sites with https on the browser... i
</I>&gt;<i> make the certificate ... and put myCA.der on windows client
</I>&gt;<i> 
</I>&gt;<i> i test it with:
</I>&gt;<i> 1- ssl-bump server-first all
</I>&gt;<i> 2- ssl-bump client-first all
</I>&gt;<i> 
</I>&gt;<i> testing acl with and without...
</I>&gt;<i> acl BadSite ssl_error SQUID_X509_V_ERR_DOMAIN_MISMATCH
</I>&gt;<i> sslproxy_cert_error allow TrustedName
</I>&gt;<i> sslproxy_cert_error allow BadSite
</I>&gt;<i> sslproxy_cert_error deny all
</I>&gt;<i> 
</I>&gt;<i> and nothing  can't see https sites like mail.yahoo.com or facebook.com
</I>&gt;<i> 
</I>&gt;<i> the browser continue put out
</I>&gt;<i> ERROR SSL CONNECTION
</I>&gt;<i> ERR_SSL_PROTOCOL
</I>&gt;<i> 
</I>&gt;<i> i rebuild again many times /var/spool/squid_ssldb
</I>&gt;<i> 
</I>&gt;<i> and the logs continue saying...
</I>&gt;<i> 
</I>&gt;<i>  1432201755.569      0 172.16.1.20 TAG_NONE/400 3640
</I>&gt;<i>  Z%19%98%A50%D7%AD%19%AB%1E - HIER_NONE/- text/html
</I>&gt;<i> 1432201756.077      0 172.16.1.20 TAG_NONE/400 4056 NONE
</I>&gt;<i> error:invalid-request - HIER_NONE/- text/html
</I>
&lt;snip&gt;
&gt;<i> 
</I>&gt;<i> here is my config
</I>&gt;<i> ----------------------------------
</I>&gt;<i>  # squid3 -k parse
</I>&gt;<i> 2015/05/21 05:42:10| Startup: Initializing Authentication Schemes ...
</I>&gt;<i> 2015/05/21 05:42:10| Startup: Initialized Authentication Scheme 'basic'
</I>&gt;<i> 2015/05/21 05:42:10| Startup: Initialized Authentication Scheme 'digest'
</I>&gt;<i> 2015/05/21 05:42:10| Startup: Initialized Authentication Scheme 'negotiate'
</I>&gt;<i> 2015/05/21 05:42:10| Startup: Initialized Authentication Scheme 'ntlm'
</I>&gt;<i> 2015/05/21 05:42:10| Startup: Initialized Authentication.
</I>&gt;<i> 2015/05/21 05:42:10| Processing Configuration File: /etc/squid3/squid.conf
</I>&gt;<i> (depth 0)
</I>&gt;<i> 2015/05/21 05:42:10| Processing: http_port 172.16.1.10:3128 intercept
</I>&gt;<i> ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
</I>&gt;<i> cert=/etc/squid3/ssl/myCA.pem
</I>
&lt;snip&gt;
&gt;<i> any idea?
</I>
I dont see any sign of an https_port for receiving HTTPS from port 443.

Only a http_port for receiving HTTP from port 80 NAT'ed connections.

Port 443 has an entirely different (TLS protocol) binary syntax. Like
Squid logs say the traffic arriving in binary TLS format are invalid
when trying to interpret them as plain-text HTTP format.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003662.html">[squid-users] Squid 3.4.8 with ssl-bump config.
</A></li>
	<LI>Next message (by thread): <A HREF="003672.html">[squid-users] url_rewrite_extras - not getting data excepted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3668">[ date ]</a>
              <a href="thread.html#3668">[ thread ]</a>
              <a href="subject.html#3668">[ subject ]</a>
              <a href="author.html#3668">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
