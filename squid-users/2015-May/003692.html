<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Zyxel USG20 and Squid 3.3
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Zyxel%20USG20%20and%20Squid%203.3&In-Reply-To=%3C555F1D03.3080502%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003689.html">
   <LINK REL="Next"  HREF="003693.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Zyxel USG20 and Squid 3.3</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Zyxel%20USG20%20and%20Squid%203.3&In-Reply-To=%3C555F1D03.3080502%40treenet.co.nz%3E"
       TITLE="[squid-users] Zyxel USG20 and Squid 3.3">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri May 22 12:11:47 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003689.html">[squid-users] Zyxel USG20 and Squid 3.3
</A></li>
        <LI>Next message (by thread): <A HREF="003693.html">[squid-users] Zyxel USG20 and Squid 3.3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3692">[ date ]</a>
              <a href="thread.html#3692">[ thread ]</a>
              <a href="subject.html#3692">[ subject ]</a>
              <a href="author.html#3692">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>NP: Its too late now, but please in future start new threads for new
topics. It seriously screws up reading for those of us with threaded
mailers or forum-style mirrors of the mailing list like Nabble.


On 22/05/2015 11:18 p.m., wn48z wrote:
&gt;<i> Since long time I'm trying to upgrade from Squid 2.7 to 3.x but every
</I>&gt;<i> try has failed up to now.
</I>&gt;<i> 
</I>&gt;<i> I use a ZyXel USG 20 firewall with LAN and DMZ Zone. The Squid proxy
</I>&gt;<i> server (MySquid) is running inside the DMZ with a single IP. The Zyxel
</I>&gt;<i> USG 20 has a option for a &quot;HTTP Redirect&quot;. This is defined like:
</I>&gt;<i> 
</I>&gt;<i> Forward all HTTP Request from LAN to WAN to MySquid Port 3128.
</I>
Sounds like a nasty recipe for trouble forwarding all your LAN traffic
via somewhere on the Internet to your internal proxy. I hope that is
just terrible documentation on the part of the firewall authors.


The answer to your problem sits in how this firewall feature actually
works...

* If thats a fancy name for NAT or NAPT / port-forwarding then its not
usable to get traffic to Squid.

* If its a mini proxy relaying the traffic then Squid should be setup
with a regular forward-proxy port to receive it.

* If its something else, it may or may not be workable.

Squid requires firewalls and routers on other machines to be doing
Layer-2 (routing) or Layer-3 (tunneling) packet forwarding without the
IP address destroying operations that NAT does.


&gt;<i> On MySquid, a Squid 2.7 stable version is running with this setting:
</I>&gt;<i> 
</I>&gt;<i> http_port 3128 transparent
</I>&gt;<i> 
</I>&gt;<i> It works fine - any HTTP requests from LAN goes through the MySquid Proxy.
</I>&gt;<i> 
</I>
Well it *seems* to work. But only because Squid-2.7 was lying to you in
its logs.

Old Squid like 2.7 would take the most outrageous lies and forgery in
the TCP/IP packets and believe them. But log the HTTP level details and
tell you it was going to the place the client wanted even if the client
would actually have gone to some other server entirely had Squid not
been there in the path.

3.2 and later contain a bit more security to ensure the traffic actually
goes to the server the client was connecting to (ORIGINAL_DST or a
properly DNS listed equivalent with the same domain name).


Your firewall though is telling your Squid that the web server the
client was visiting is hosted at SquidIP:3128. NAT lies!

&gt;<i> But that is no option - I can't and will not define manual proxy settings for any client in the LAN :-(
</I>
No need to fear manual configuration. At the very least WPAD
auto-configuration is your friend.


You also have the easier option of placing the Squid machine physically
in the network path before or after the ZyXel. Configuring the Squid box
as a bridge + router with NAT sending port 80 traffic through Squid
directly on the same box as required to make interception work.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003689.html">[squid-users] Zyxel USG20 and Squid 3.3
</A></li>
	<LI>Next message (by thread): <A HREF="003693.html">[squid-users] Zyxel USG20 and Squid 3.3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3692">[ date ]</a>
              <a href="thread.html#3692">[ thread ]</a>
              <a href="subject.html#3692">[ subject ]</a>
              <a href="author.html#3692">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
