<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Zyxel USG20 and Squid 3.3
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Zyxel%20USG20%20and%20Squid%203.3&In-Reply-To=%3C555F265D.3060902%40wizonet.ch%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003693.html">
   <LINK REL="Next"  HREF="003690.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Zyxel USG20 and Squid 3.3</H1>
    <B>wn48z</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Zyxel%20USG20%20and%20Squid%203.3&In-Reply-To=%3C555F265D.3060902%40wizonet.ch%3E"
       TITLE="[squid-users] Zyxel USG20 and Squid 3.3">squid at wizonet.ch
       </A><BR>
    <I>Fri May 22 12:51:41 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003693.html">[squid-users] Zyxel USG20 and Squid 3.3
</A></li>
        <LI>Next message (by thread): <A HREF="003690.html">[squid-users] Squid with proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3694">[ date ]</a>
              <a href="thread.html#3694">[ thread ]</a>
              <a href="subject.html#3694">[ subject ]</a>
              <a href="author.html#3694">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> NP: Its too late now, but please in future start new threads for new
</I>&gt;<i> topics. It seriously screws up reading for those of us with threaded
</I>&gt;<i> mailers or forum-style mirrors of the mailing list like Nabble.
</I>Yes, this was not planned - I first used the wrong button in my email 
program (list-answer and not create). But later (before your reply) I 
also create this new thread - shall we use the other thread for further 
posts?

&gt;<i> Sounds like a nasty recipe for trouble forwarding all your LAN traffic
</I>&gt;<i> via somewhere on the Internet to your internal proxy. I hope that is
</I>&gt;<i> just terrible documentation on the part of the firewall authors.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The answer to your problem sits in how this firewall feature actually
</I>&gt;<i> works...
</I>&gt;<i>
</I>&gt;<i> * If thats a fancy name for NAT or NAPT / port-forwarding then its not
</I>&gt;<i> usable to get traffic to Squid.
</I>&gt;<i>
</I>&gt;<i> * If its a mini proxy relaying the traffic then Squid should be setup
</I>&gt;<i> with a regular forward-proxy port to receive it.
</I>&gt;<i>
</I>&gt;<i> * If its something else, it may or may not be workable.
</I>&gt;<i>
</I>&gt;<i> Squid requires firewalls and routers on other machines to be doing
</I>&gt;<i> Layer-2 (routing) or Layer-3 (tunneling) packet forwarding without the
</I>&gt;<i> IP address destroying operations that NAT does.
</I>The ZyXel USG 20 is a linux based hardware router/firewall solution for 
small business use. I have found a small online overview to the HTTP 
Redirect functionality. In my opinion - this should work well with Squid?

<A HREF="http://www.manualslib.com/manual/363461/Zyxel-Communications-Zywall-Usg-20.html?page=347#manual">http://www.manualslib.com/manual/363461/Zyxel-Communications-Zywall-Usg-20.html?page=347#manual</A> 


The picture on this site shows exactly my configuration.
&gt;&gt;<i> On MySquid, a Squid 2.7 stable version is running with this setting:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> http_port 3128 transparent
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It works fine - any HTTP requests from LAN goes through the MySquid Proxy.
</I>&gt;&gt;<i>
</I>&gt;<i> Well it *seems* to work. But only because Squid-2.7 was lying to you in
</I>&gt;<i> its logs.
</I>&gt;<i>
</I>&gt;<i> Old Squid like 2.7 would take the most outrageous lies and forgery in
</I>&gt;<i> the TCP/IP packets and believe them. But log the HTTP level details and
</I>&gt;<i> tell you it was going to the place the client wanted even if the client
</I>&gt;<i> would actually have gone to some other server entirely had Squid not
</I>&gt;<i> been there in the path.
</I>&gt;<i>
</I>&gt;<i> 3.2 and later contain a bit more security to ensure the traffic actually
</I>&gt;<i> goes to the server the client was connecting to (ORIGINAL_DST or a
</I>&gt;<i> properly DNS listed equivalent with the same domain name).
</I>Could be that it lies - but I also use squidGuard and blocked content is 
really blocked - so I think that Squid 2.7 should work correctly.

&gt;<i> Your firewall though is telling your Squid that the web server the
</I>&gt;<i> client was visiting is hosted at SquidIP:3128. NAT lies!
</I>&gt;<i>
</I>&gt;&gt;<i> But that is no option - I can't and will not define manual proxy settings for any client in the LAN :-(
</I>&gt;<i> No need to fear manual configuration. At the very least WPAD
</I>&gt;<i> auto-configuration is your friend.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> You also have the easier option of placing the Squid machine physically
</I>&gt;<i> in the network path before or after the ZyXel. Configuring the Squid box
</I>&gt;<i> as a bridge + router with NAT sending port 80 traffic through Squid
</I>&gt;<i> directly on the same box as required to make interception work.
</I>The Squid box should not work as a network device. This is not an 
option. I think it should be possible to make Squid 3.x work if it was 
possible with Squid 2.7?

Tkanks, Martin


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003693.html">[squid-users] Zyxel USG20 and Squid 3.3
</A></li>
	<LI>Next message (by thread): <A HREF="003690.html">[squid-users] Squid with proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3694">[ date ]</a>
              <a href="thread.html#3694">[ thread ]</a>
              <a href="subject.html#3694">[ subject ]</a>
              <a href="author.html#3694">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
