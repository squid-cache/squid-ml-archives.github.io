<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Proxy chain question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Proxy%20chain%20question&In-Reply-To=%3C555FF9B5.2080801%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003697.html">
   <LINK REL="Next"  HREF="003737.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Proxy chain question</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Proxy%20chain%20question&In-Reply-To=%3C555FF9B5.2080801%40treenet.co.nz%3E"
       TITLE="[squid-users] Proxy chain question">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat May 23 03:53:25 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003697.html">[squid-users] Proxy chain question
</A></li>
        <LI>Next message (by thread): <A HREF="003737.html">[squid-users] Proxy chain question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3704">[ date ]</a>
              <a href="thread.html#3704">[ thread ]</a>
              <a href="subject.html#3704">[ subject ]</a>
              <a href="author.html#3704">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 23/05/2015 1:49 a.m., Lucas van Braam van Vloten wrote:
&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> Thanks for your reply.
</I>&gt;<i> 
</I>&gt;&gt;<i> Any particular reason?
</I>&gt;<i> Unfortunately this double setup is not my choice, our architects
</I>&gt;<i> prescribe use of the TMG proxy as mandatory for all internet access from
</I>&gt;<i> the internal network. No exceptions.
</I>&gt;&gt;<i> Since the TMG is a reverse-proxy (...)
</I>&gt;<i> This is true only for inbound traffic coming from internet; TMG acts as
</I>&gt;<i> a forward proxy for outbound traffic.
</I>&gt;<i> 
</I>
Ah. Okay.

&gt;<i> So the updated diagram for what I am trying to accomplish would be
</I>&gt;<i> something like this:
</I>&gt;<i> 
</I>&gt;<i>                http       https       https
</I>&gt;<i> Internal client -&gt;  Squid  -&gt;   TMG    -&gt; internet webservice
</I>&gt;<i>                   (reverse    (forward    
</I>&gt;<i>                    proxy)      proxy)
</I>&gt;<i> 
</I>&gt;&gt;<i> Squid will not be able to handle this either unless it is directly
</I>&gt;<i> connecting to that service without the TMG in the way.
</I>&gt;<i> 
</I>&gt;<i> I noticed that if I configure the Squid proxy as a forward proxy and the
</I>&gt;<i> TMG as its peer, I can initiate and authenticate a secure connection to
</I>&gt;<i> the internet web service from a browser in the local network (using the
</I>&gt;<i> squid proxy). Apparently the TMG is passed transparently and TLS is
</I>&gt;<i> terminated on the webservice. Intuitively I would assume that,
</I>&gt;<i> therefore, there should also be some way to initiate a https connection,
</I>&gt;<i> and handle the certificate authentication, from the squid server itself.
</I>&gt;<i> 
</I>&gt;<i> Considering the updated diagram, do you think this can be done in Squid?
</I>
No, because Squid is only aware of two ways to send request - either a
connection going to the TMG, or a connection going out directly on port
443 to the server (bypassing the TMG). That latter is forbidden by
firewall rules I presume, and the connection to the TMG is not secured
for use with <A HREF="https://">https://</A> URLs.

In the case where the browser client is sending HTTPS to Squid as a
forward proxy it does so using CONNECT requests. Squid is able to relay
those CONNECT messages to the TMG and you see it working as the tunnel
spans both hops and they are both blind to the HTTPS messages themselves.


If you could TLS encrypt the connection to the TMG Squid could send the
HTTPS messages inside that, but then the TMG would still be the agent
doing the final client-cert bits with the origin server.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003697.html">[squid-users] Proxy chain question
</A></li>
	<LI>Next message (by thread): <A HREF="003737.html">[squid-users] Proxy chain question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3704">[ date ]</a>
              <a href="thread.html#3704">[ thread ]</a>
              <a href="subject.html#3704">[ subject ]</a>
              <a href="author.html#3704">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
