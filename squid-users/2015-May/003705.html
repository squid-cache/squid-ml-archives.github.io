<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid with proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20with%20proxy&In-Reply-To=%3C55600000.1090508%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003698.html">
   <LINK REL="Next"  HREF="003669.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid with proxy</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20with%20proxy&In-Reply-To=%3C55600000.1090508%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid with proxy">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat May 23 04:20:16 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003698.html">[squid-users] Squid with proxy
</A></li>
        <LI>Next message (by thread): <A HREF="003669.html">[squid-users] https quick question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3705">[ date ]</a>
              <a href="thread.html#3705">[ thread ]</a>
              <a href="subject.html#3705">[ subject ]</a>
              <a href="author.html#3705">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 23/05/2015 2:05 a.m., Silvio Siefke wrote:
&gt;<i> On Fri, 22 May 2015 23:26:13 +1200 Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> Without NextProxy is correct if ziproxy is on the &quot;outside&quot; of Squid.
</I>&gt;&gt;<i> Like so:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  client -&gt; Squid -&gt; ziproxy -&gt; Internet
</I>&gt;<i> 
</I>&gt;<i> In my browser i speak only with squid, other make squid i hope. I use
</I>&gt;<i> ziproxy for compress the traffic, but when i saw the rate is not really
</I>&gt;<i> much.
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://silviosiefke.de/squid/zip.html">http://silviosiefke.de/squid/zip.html</A>
</I>&gt;<i> 
</I>
Small, but reasonable.

Note that Squid is an HTTP/1.1 proxy designed to optimize traffic.
HTTP/1.1 contains features like revalidation and conditional requests
which are more efficient with bandwidth than even 100% compression would
be. So there is not much uncompressed but compressible content for
ziproxy to be working with.


&gt;&gt;<i> If you set ziproxy to pass *requests* to Squid, the traffic will
</I>&gt;&gt;<i> enter a loop:
</I>&gt;&gt;<i>   client -&gt; Squid -&gt; ziproxy -&gt; Squid -&gt; ziproxy -&gt; ...
</I>&gt;<i> 
</I>&gt;<i> client &gt; squid &gt; ziproxy &gt; squid &gt; client so is my plan
</I>
Squid is fetchng content from the client?

I think you are misunderstanding the &quot;-&gt;&quot; diagram syntax and how
connectivity works.

Request messages go:
 client -&gt; Squid -&gt; ziproxy -&gt; Internet

Response messages go:
 Internet -&gt; ziproxy -&gt; Squid -&gt; client

You only need to configure the request hop order - the cache_peer in
Squid, maybe proxy settings in client. The response chain is handled
automatically by TCP based on where the request went.

Squi dneeds teh cache_peer so that it goes to ziproxy instead of
straight to Internet.
 ziproxy needs *nothing* - so that is does go to Internet. If you see it
with Squid you get the infinite loop, and the client gets nothing or
errors back when the loop causes enough trouble to be noticed.

&gt;<i>  
</I>&gt;&gt;<i> In your squid.conf all traffic requires authenticating. Nothing is
</I>&gt;&gt;<i> allowed through without it. Although anything from localhost is
</I>&gt;&gt;<i> allowed to send wrong credentials and get through :-( .
</I>&gt;<i> 
</I>&gt;<i> localhost should work without authenticating. I think this is problem
</I>&gt;<i> why NextProxy in ziproxy.conf not work correct. 
</I>&gt;<i>  
</I>
You had two problems. The auth was one. The forwarding loop (NextProxy
being used) was another.

&gt;&gt;<i> - &quot;deny ads&quot; is not useful like this, anything getting to that check
</I>&gt;&gt;<i> will also be blocked by the &quot;deny all&quot; which follows it and is a
</I>&gt;&gt;<i> faster check.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> - also missing the basic HTTP abuse and DoS security protections.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> To let localhost I would write them like this:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  # basic security potections.
</I>&gt;&gt;<i>  # To let special ports through; check carefully its not abuse
</I>&gt;&gt;<i>  # then adjust Safe_ports and SSL_ports appropriately
</I>&gt;&gt;<i>  http_access deny !Safe_ports
</I>&gt;&gt;<i>  http_access deny CONNECT !SSL_Ports
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  # To use the deny ads ACL it would go here in the ordering,
</I>&gt;&gt;<i>  # before the allow rules.
</I>&gt;&gt;<i>  http_access deny ads
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  # localhost does not require authentication
</I>&gt;&gt;<i>  http_access allow localhost
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  # manager access only permitted from localhost
</I>&gt;&gt;<i>  http_access deny !localhost manager
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  # anyone with a valid auth credentials is allowed
</I>&gt;&gt;<i>  http_access allow checkpw
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  http_access deny all
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> You will need to re-add the CONNECT, Safe_ports and SSL_Ports ACL
</I>&gt;&gt;<i> definitions from the default config.
</I>&gt;<i> 
</I>&gt;<i> Okay thank you, im shamed but i really has not understand what mean 
</I>&gt;<i> SSL Ports and so now i understand more. 
</I>
No shame. Thats what we do here in this mailing list, help people with
mistakes and problems. :-)

&gt;<i> 
</I>&gt;&gt;<i> You dont really need to exempt localhost from authentication. But that
</I>&gt;&gt;<i> is your choice.
</I>&gt;<i> 
</I>&gt;<i> Only connection over port 15000 need authentication because is extern and
</I>&gt;<i> best were only my login goes. Localhost should work without any limitiation.
</I>
Then you may be interested in using a myportname ACL to enforce that.
Like this:
 http_port 15000 ... name=blah
 ...
 acl port15000 myportname blah
 http_access allow port15000 checkpw


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003698.html">[squid-users] Squid with proxy
</A></li>
	<LI>Next message (by thread): <A HREF="003669.html">[squid-users] https quick question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3705">[ date ]</a>
              <a href="thread.html#3705">[ thread ]</a>
              <a href="subject.html#3705">[ subject ]</a>
              <a href="author.html#3705">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
