<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid, Gmail.com and HSTS.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%2C%20Gmail.com%20and%20HSTS.&In-Reply-To=%3C55664F79.4070700%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003756.html">
   <LINK REL="Next"  HREF="003752.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid, Gmail.com and HSTS.</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%2C%20Gmail.com%20and%20HSTS.&In-Reply-To=%3C55664F79.4070700%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid, Gmail.com and HSTS.">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed May 27 23:12:57 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="003756.html">[squid-users] Squid, Gmail.com and HSTS.
</A></li>
        <LI>Next message (by thread): <A HREF="003752.html">[squid-users] Correct Syntax for ACL?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3755">[ date ]</a>
              <a href="thread.html#3755">[ thread ]</a>
              <a href="subject.html#3755">[ subject ]</a>
              <a href="author.html#3755">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 28/05/2015 5:51 a.m., Michael Monette wrote:
&gt;<i> Thanks for the reply. I am compiling the latest squid now and going to give that a shot using ssl::server_name. The precompiled binary for CentOS was only at 3.5.04 and didn't have ssl::server_name support I guess.
</I>&gt;<i> 
</I>&gt;<i> While I have you here, I was thinking of something else I could do. Tell me if you think it would work. You seem like an expert.
</I>&gt;<i> 
</I>
I'm the Squid maintainer. On this feature I'm just an interested party,
the real expert is Christos Tsantilas who authored it.


&gt;<i> Can I not make it so www.gmail.com resolves to (for example) 1.2.3.4 using DNS or a hosts file, then setup an acl like this:
</I>&gt;<i> 
</I>&gt;<i> acl gml dst 1.2.3.4 
</I>&gt;<i> # Redirect request for 1.2.3.4 to <A HREF="https://mail.google.com">https://mail.google.com</A>
</I>&gt;<i> deny_info <A HREF="https://mail.google.com">https://mail.google.com</A> gml        
</I>&gt;<i> # Not even sure what this does, found it on a website, didn't really question it since things were working as they were supposed to.
</I>&gt;<i> http_reply_access deny bl1 
</I>
This acts on the HTTP messages inside the TLS wrapper after SSL-Bump has
decrypted the connection and the request has been sent through to the
server. By replacing whatever reply the server actually sent with a 302
status diverting the client to that URL.

It has no effect on the bumping process itself or any of the TLS layer
details. It may have an effect on HSTS since any headers the server
might send are dropped by the 302 replacement.


&gt;<i> 
</I>&gt;<i> This way it doesn't have to monitor for a dstdomain, it watches for an IP. 
</I>
It wastes bandwidth sending a request to the server and fetching the
reply. Given that the dst-IP address is what you have from the very
first TCP packet onwards.

About the only utility it has over http_access is that its positioning
naturally restricts it to the decrypted traffic where the 302 will
always work. But by that time you have the domain name from the
encrypted HTTP message anyway.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="003756.html">[squid-users] Squid, Gmail.com and HSTS.
</A></li>
	<LI>Next message (by thread): <A HREF="003752.html">[squid-users] Correct Syntax for ACL?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3755">[ date ]</a>
              <a href="thread.html#3755">[ thread ]</a>
              <a href="subject.html#3755">[ subject ]</a>
              <a href="author.html#3755">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
