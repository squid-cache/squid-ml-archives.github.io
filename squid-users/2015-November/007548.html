<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] &quot;NF getsockopt(SO_ORIGINAL_DST)&quot; filling cache.log due to AWS ELB healthchecks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%22NF%20getsockopt%28SO_ORIGINAL_DST%29%22%20filling%0A%20cache.log%20due%20to%20AWS%20ELB%20healthchecks&In-Reply-To=%3CCAEKmLn8GtFB_X0mAm87ymaVzRqYMm9R68b0k%3D9ZvaCAvnMOCbw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007624.html">
   <LINK REL="Next"  HREF="007549.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] &quot;NF getsockopt(SO_ORIGINAL_DST)&quot; filling cache.log due to AWS ELB healthchecks</H1>
    <B>John Smith</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%22NF%20getsockopt%28SO_ORIGINAL_DST%29%22%20filling%0A%20cache.log%20due%20to%20AWS%20ELB%20healthchecks&In-Reply-To=%3CCAEKmLn8GtFB_X0mAm87ymaVzRqYMm9R68b0k%3D9ZvaCAvnMOCbw%40mail.gmail.com%3E"
       TITLE="[squid-users] &quot;NF getsockopt(SO_ORIGINAL_DST)&quot; filling cache.log due to AWS ELB healthchecks">burnncrashnow at gmail.com
       </A><BR>
    <I>Wed Nov  4 17:58:51 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007624.html">[squid-users] Refresh_pattern % bug ?
</A></li>
        <LI>Next message (by thread): <A HREF="007549.html">[squid-users] caching issues - caching traffic from another proxy, and caching https traffic
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7548">[ date ]</a>
              <a href="thread.html#7548">[ thread ]</a>
              <a href="subject.html#7548">[ subject ]</a>
              <a href="author.html#7548">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

Just to close the loop on this issue, I worked offline with Amos.  He was
able to help me to eliminate all the noise from cache.log, but only for
http traffic, not both http and https traffic using the same port, so I
ended up using my original configuration.  Amos indicated that I would need
to have http and https on different ports to make this work properly, but I
can't make that change.

My end result is that the AWS ELB healthcheck traffic is now pointed to a
different port so it does not get logged as 'noise' in cache.log, but every
single squid request still gets logged as 'noise'.  Still quite an
improvement.

Thanks Amos and Eliezer for reaching out!
John

On Thu, Oct 29, 2015 at 2:31 PM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:

&gt;<i> On 30/10/2015 9:51 a.m., John Smith wrote:
</I>&gt;<i> &gt; The outbound traffic from the L1proxy instance in question connects to a
</I>&gt;<i> &gt; public IP / DNS name of an ELB in another AWS region.
</I>&gt;<i> &gt; We need to send some traffic to a different AWS region, thus the mess
</I>&gt;<i> below:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; AWS instances (clients) -&gt;
</I>&gt;<i> &gt; AWS internal ELB for L1 proxies -&gt; AWS L1 proxy instances -&gt;
</I>&gt;<i> &gt; a different AWS internal ELB for  L1 proxy cluster -&gt; a different AWS L1
</I>&gt;<i> &gt; proxy instance (this is where we have the problem is with 'intercept or
</I>&gt;<i> &gt; transparent) -&gt;
</I>&gt;<i> &gt; *One AWS region above, a different AWS region below*
</I>&gt;<i> &gt; AWS external (publicly addressable) ELB for L2 proxies in a different AWS
</I>&gt;<i> &gt; region -&gt; AWS L2 proxy instances -&gt; the Internet
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; These AWS instances have both internal IPs and public IPs, and they don't
</I>&gt;<i> &gt; really know about their own public IPs.  That may be part or all of the
</I>&gt;<i> &gt; confusion.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; AWS ELBs are published as DNS names, they have multiple IPs, and we are
</I>&gt;<i> &gt; using DNS to connect to them.
</I>&gt;<i>
</I>&gt;<i> Okay. I suspect I know what is going on now. Before I confuse things any
</I>&gt;<i> more by mentioning it...
</I>&gt;<i>
</I>&gt;<i> Could you send me a wireshark trace of a small bunch of the connections
</I>&gt;<i> coming to Squid?  Along with the DNS name for the ELB the clients are
</I>&gt;<i> connecting to.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20151104/55e8534a/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20151104/55e8534a/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007624.html">[squid-users] Refresh_pattern % bug ?
</A></li>
	<LI>Next message (by thread): <A HREF="007549.html">[squid-users] caching issues - caching traffic from another proxy, and caching https traffic
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7548">[ date ]</a>
              <a href="thread.html#7548">[ thread ]</a>
              <a href="subject.html#7548">[ subject ]</a>
              <a href="author.html#7548">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
