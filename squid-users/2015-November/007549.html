<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] caching issues - caching traffic from another proxy, and caching https traffic
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20caching%20issues%20-%20caching%20traffic%20from%20another%20proxy%2C%0A%20and%20caching%20https%20traffic&In-Reply-To=%3CCAEKmLn-9mNboTHBxYSAdoqPKBkx7Gccmp37KxzHcuS4N4n3RYg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007548.html">
   <LINK REL="Next"  HREF="007572.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] caching issues - caching traffic from another proxy, and caching https traffic</H1>
    <B>John Smith</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20caching%20issues%20-%20caching%20traffic%20from%20another%20proxy%2C%0A%20and%20caching%20https%20traffic&In-Reply-To=%3CCAEKmLn-9mNboTHBxYSAdoqPKBkx7Gccmp37KxzHcuS4N4n3RYg%40mail.gmail.com%3E"
       TITLE="[squid-users] caching issues - caching traffic from another proxy, and caching https traffic">burnncrashnow at gmail.com
       </A><BR>
    <I>Wed Nov  4 18:16:56 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007548.html">[squid-users] &quot;NF getsockopt(SO_ORIGINAL_DST)&quot; filling cache.log due to AWS ELB healthchecks
</A></li>
        <LI>Next message (by thread): <A HREF="007572.html">[squid-users] caching issues - caching traffic from another proxy, and caching https traffic
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7549">[ date ]</a>
              <a href="thread.html#7549">[ thread ]</a>
              <a href="subject.html#7549">[ subject ]</a>
              <a href="author.html#7549">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I'm trying to improve our cache hit ratio.  We have a fairly complicated
layer of squid 3.10 proxies as previously detailed.

Problem 1.  Some of the traffic is identified by domain to go to another
layer of proxies.  I've called this proxy otherl1proxy in the squid.conf
below.  I've noticed that this traffic is not cached at all on either set
of proxies.   I'd like it cached at the top layer if possible because these
will be the largest servers with the largest caches.  I've removed
'originserver' from the squid.conf to test but that didn't seem to help.

Problem 2.  We are not caching any https traffic.  Is it possible to cache
https traffic, and if so how would one do it?  As many websites are moving
towards https for all traffic this lowers the effectiveness of cache...

squid.conf below

Thanks,
John

# Recommended minimum configuration:
#
acl manager proto cache_object
acl localhost src 127.0.0.1/32 ::1
acl to_localhost dst 127.0.0.0/8 0.0.0.0/32 ::1

# Example rule allowing access from your local networks.
# Adapt to list your (internal) IP networks from where browsing
# should be allowed
acl localnet src 10.0.0.0/8     # RFC1918 possible internal network
acl localnet src 172.16.0.0/12  # RFC1918 possible internal network
acl localnet src 192.168.0.0/16 # RFC1918 possible internal network
acl localnet src fc00::/7       # RFC 4193 local private network range
acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged)
machines

acl httpacl port 80
acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl CONNECT method CONNECT

#
# Recommended minimum Access Permission configuration:
#
# Only allow cachemgr access from localhost
http_access allow manager localhost
http_access deny manager

# Deny requests to certain unsafe ports
http_access deny !Safe_ports

# Deny CONNECT to other than secure SSL ports
http_access deny CONNECT !SSL_ports

# We strongly recommend the following be uncommented to protect innocent
# web applications running on the proxy server who think the only
# one who can access services on &quot;localhost&quot; is a local user
#http_access deny to_localhost

#
# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
#

negative_ttl 3600 seconds

# Example rule allowing access from your local networks.
# Adapt localnet in the ACL section to list your (internal) IP networks
# from where browsing should be allowed
http_access allow localnet
http_access allow localhost

# And finally deny all other access to this proxy
http_access deny all

# Squid normally listens to port 3128
http_port 3128 transparent
http_port 3130

# We recommend you to use at least the following line.
hierarchy_stoplist cgi-bin ?

# Uncomment and adjust the following to add a disk cache directory.
access_log /logs/squid/access.log
cache_log /logs/squid/cache.log

# Leave coredumps in the first cache dir
coredump_dir /var/spool/squid

visible_hostname domain.com

# Add any of your own refresh_pattern entries above these.
refresh_pattern -i (robots\.txt)$ 60 40% 240
refresh_pattern -i \.(html|htm|css|js)$ 1440 40% 259200
refresh_pattern -i \.(gif|png|jpg|jpeg|ico|otf|woff|eot|ttf|svg)$ 10080 90%
259200 override-expire ignore-no-cache ignore-no-store ignore-private
refresh_pattern ^ftp:   1440  20% 10080
refresh_pattern ^gopher:  1440  0%  1440
refresh_pattern -i (/cgi-bin/|\?) 0 0%  0
refresh_pattern .   0 20% 4320

cache_peer otherl1proxy parent 3128 0 no-query originserver no-digest
name=other_l1_proxy
acl sites_other_l1_proxy dstdomain .othersite.com
cache_peer_access other_l1_proxy allow sites_other_l1_proxy
cache_peer_access other_l1_proxy deny all

cache_peer httpelb  parent 80 0 no-query no-digest name=http_peer
cache_peer_access http_peer allow httpacl
cache_peer httpselb  parent 3129 0 no-query no-digest name=https_peer
cache_peer_access https_peer deny httpacl
never_direct allow all
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20151104/f1045abd/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20151104/f1045abd/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007548.html">[squid-users] &quot;NF getsockopt(SO_ORIGINAL_DST)&quot; filling cache.log due to AWS ELB healthchecks
</A></li>
	<LI>Next message (by thread): <A HREF="007572.html">[squid-users] caching issues - caching traffic from another proxy, and caching https traffic
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7549">[ date ]</a>
              <a href="thread.html#7549">[ thread ]</a>
              <a href="subject.html#7549">[ subject ]</a>
              <a href="author.html#7549">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
