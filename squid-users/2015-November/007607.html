<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Subject: Re: authentication of every GET request from part of URL?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Subject%3A%20Re%3A%20authentication%20of%20every%20GET%20request%0A%20from%20part%20of%20URL%3F&In-Reply-To=%3C563F6342.9090606%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007605.html">
   <LINK REL="Next"  HREF="007627.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Subject: Re: authentication of every GET request from part of URL?</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Subject%3A%20Re%3A%20authentication%20of%20every%20GET%20request%0A%20from%20part%20of%20URL%3F&In-Reply-To=%3C563F6342.9090606%40measurement-factory.com%3E"
       TITLE="[squid-users] Subject: Re: authentication of every GET request from part of URL?">rousskov at measurement-factory.com
       </A><BR>
    <I>Sun Nov  8 14:59:14 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007605.html">[squid-users] Subject: Re: authentication of every GET request from part of URL?
</A></li>
        <LI>Next message (by thread): <A HREF="007627.html">[squid-users] Subject: Re: authentication of every GET request from part of URL?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7607">[ date ]</a>
              <a href="thread.html#7607">[ thread ]</a>
              <a href="subject.html#7607">[ subject ]</a>
              <a href="author.html#7607">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/08/2015 06:34 AM, Sreenath BH wrote:

&gt;<i> Is there a way for me to invoke some custom code for every request
</I>&gt;<i> that Squid receives? 
</I>
Yes, there are several interfaces, including a built-in ACL, an external
ACL helper, a URL rewriter, an eCAP/ICAP service. Roughly speaking, the
former ones are easier to use and the latter ones are more powerful.


&gt;<i> That script would do the following:
</I>&gt;<i> 
</I>&gt;<i> 1. Extract part of the URL(the token) and look up in a database to see
</I>&gt;<i> if it is valid.
</I>&gt;<i>     If valid, proceed to lookup cached object, other wise go to
</I>&gt;<i> back-end fetch, etc.
</I>&gt;<i> 2. If the token is not found in database, return with an error, so
</I>&gt;<i> that Squid can send back a not found type (some HTTP error) of
</I>&gt;<i> response.
</I>
If the above are your requirements, avoid the word &quot;authentication&quot;
might help. It confuses people into thinking you want something far more
complex.


The validation in step #1 can be done by an external ACL. However, you
probably forgot to mention that the found token should be removed from
the URL. To edit the URL, you need to use a URL rewriter or an eCAP/ICAP
service.

Everything else can be done by built-in ACLs unless you need to serve
very custom error messages. In the latter case, you will need an eCAP or
ICAP service.

However, if &quot;go to back-end fetch&quot; means loading response from some
storage external to Squid without using HTTP, then you need an eCAP or
ICAP service to do that fetching.

I recommend that you clarify these parts of your specs:

What do you want to do when the token is not found in the URL?

What do you want to do when an invalid token is found in the URL?

Will sending a response using a simple template filled with some basic
request details suffice when a valid token is not found in the database?


HTH,

Alex.



&gt;<i> On 7/11/2015 1:33 a.m., Sreenath BH wrote:
</I>&gt;&gt;<i> Hi
</I>&gt;&gt;<i> I am very new to Squid, and think have a strange requirement.
</I>&gt;&gt;<i> We want to serve cached content only if the client has been
</I>&gt;&gt;<i> authenticated before.
</I>&gt;&gt;<i> Since we don't expect the client software to send any information in
</I>&gt;&gt;<i> headers, we embed a token in the URL that we present to the user.
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> Um, you know how sending username and password in plain-text Basic auth
</I>&gt;<i> headers is supposed to be the worst form of security around?
</I>&gt;<i> 
</I>&gt;<i> It's not quite. Sending credentials in the URL is worse. Even if its
</I>&gt;<i> just an encoded token.
</I>&gt;<i> 
</I>&gt;<i> Why are you avoiding actual HTTP authentication?
</I>&gt;<i> 
</I>&gt;<i> Why be so actively hostile to every other cache in existence?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> So when the client s/w uses this URL, we want to extract the token
</I>&gt;&gt;<i> from URL and do a small database query to ensure that the token is
</I>&gt;&gt;<i> valid.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This is in accelerator mode.
</I>&gt;&gt;<i> Is it possible to use something similar to basic_fake_auth and put my
</I>&gt;&gt;<i> code there that does some database query?
</I>&gt;<i> 
</I>&gt;<i> The &quot;basic_..._auth&quot; parts of that helpers name mean that it performs
</I>&gt;<i> HTTP Basic authentication.
</I>&gt;<i> 
</I>&gt;<i> The &quot;fake&quot; part means that it does not perform any kind of validation.
</I>&gt;<i> 
</I>&gt;<i> All of the text above has been describing how you want to perform
</I>&gt;<i> actions which are the direct opposite of everything basic_fake_auth does.
</I>&gt;<i> 
</I>&gt;&gt;<i> If the query fails, we don't return the cached content?
</I>&gt;<i> 
</I>&gt;<i> What do you want to be delivered instead?
</I>&gt;<i> 
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007605.html">[squid-users] Subject: Re: authentication of every GET request from part of URL?
</A></li>
	<LI>Next message (by thread): <A HREF="007627.html">[squid-users] Subject: Re: authentication of every GET request from part of URL?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7607">[ date ]</a>
              <a href="thread.html#7607">[ thread ]</a>
              <a href="subject.html#7607">[ subject ]</a>
              <a href="author.html#7607">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
