<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ssl_bump with cache_peer problem: Handshake fail after Client Hello.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ssl_bump%20with%20cache_peer%20problem%3A%20Handshake%20fail%0A%20after%20Client%20Hello.&In-Reply-To=%3C563FCA54.6020300%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007606.html">
   <LINK REL="Next"  HREF="007617.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ssl_bump with cache_peer problem: Handshake fail after Client Hello.</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ssl_bump%20with%20cache_peer%20problem%3A%20Handshake%20fail%0A%20after%20Client%20Hello.&In-Reply-To=%3C563FCA54.6020300%40treenet.co.nz%3E"
       TITLE="[squid-users] ssl_bump with cache_peer problem: Handshake fail after Client Hello.">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Nov  8 22:19:00 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007606.html">[squid-users] ssl_bump with cache_peer problem: Handshake fail after Client Hello.
</A></li>
        <LI>Next message (by thread): <A HREF="007617.html">[squid-users] ssl_bump with cache_peer problem: Handshake fail after Client Hello.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7608">[ date ]</a>
              <a href="thread.html#7608">[ thread ]</a>
              <a href="subject.html#7608">[ subject ]</a>
              <a href="author.html#7608">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 9/11/2015 2:40 a.m., maple wrote:
&gt;<i> hi Amos,
</I>&gt;<i> 
</I>&gt;<i> first of all, thanks very much for your specified answer. and about your
</I>&gt;<i> questions:
</I>&gt;<i> 1) are you the sysadmin for that network? 
</I>&gt;<i> there are actually three networks involved: internal net(I'm fully in charge
</I>&gt;<i> of this) &lt;---&gt;lab network(jump server located, I'm using it to set up ssh
</I>&gt;<i> tunnel from office, I'm just a user in this net) &lt;---&gt; office network(http
</I>&gt;<i> proxy located, I'm just a user)
</I>&gt;<i> 2) and why is there a full separation like that? 
</I>&gt;<i> as I said above, lab network is almost completely separated from others,
</I>&gt;<i> only provide a jump server which allow office network to access with ssh, so
</I>&gt;<i> if i want my internal net located in lab to access internet, the only way is
</I>&gt;<i> to use ssh tunnel to visit http proxy in office range. this is the reason I
</I>&gt;<i> set up like this, I may contact sysadmin to give some way to access internet
</I>&gt;<i> from lab directly which can bypass the ssh tunnel way, but upstream proxy is
</I>&gt;<i> necessary for policy reason.
</I>
That would be the best solution. That way they ae both aware of the use,
and can assist you with any problems going through their gateway proxy.

It may be that their proxy does not have TLS/SSL support available. If
so this thread will not be able to come to a happy solution for you anyway.


&gt;<i> 
</I>&gt;<i> I went through solution suggested by you, just confirm in case I don't
</I>&gt;<i> understand it in right way:
</I>&gt;<i> 
</I>&gt;<i> client &lt;---https---&gt; second squid &lt;---proxychains---&gt; first squid &lt;---ssh
</I>&gt;<i> tunnel---&gt; http proxy &lt;--http/https--&gt; internet
</I>&gt;<i> 
</I>

I meant:

first squid --(TLS)--]SSH tunnel[--(TLS)--&gt; parent proxy --&gt; Internet


&gt;<i> for first squid(&quot;configured with a cache_peer using an IP:port, and also
</I>&gt;<i> using the &quot;ssl&quot; option):
</I>&gt;<i> http_port 3128 intercept
</I>&gt;<i> cache_peer 127.0.0.1 parent 12345 0 no-query no-digest default
</I>&gt;<i> never_direct allow all 
</I>&gt;<i> sslproxy_flags DONT_VERIFY_PEER
</I>&gt;<i> 
</I>&gt;<i> I'm not sure what's exact &quot;ssl&quot;option, but it should not be ssl_bump, right?
</I>&gt;<i> it's appreciated if you can specify it.
</I>
Please read the documentation about &quot;SSL / HTTPS / TLS options&quot; for
cache_peer:
 &lt;<A HREF="http://www.squid-cache.org/Doc/config/cache_peer/">http://www.squid-cache.org/Doc/config/cache_peer/</A>&gt;


Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007606.html">[squid-users] ssl_bump with cache_peer problem: Handshake fail after Client Hello.
</A></li>
	<LI>Next message (by thread): <A HREF="007617.html">[squid-users] ssl_bump with cache_peer problem: Handshake fail after Client Hello.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7608">[ date ]</a>
              <a href="thread.html#7608">[ thread ]</a>
              <a href="subject.html#7608">[ subject ]</a>
              <a href="author.html#7608">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
