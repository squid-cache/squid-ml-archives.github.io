<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Subject: Re: authentication of every GET request from part of URL?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Subject%3A%20Re%3A%20authentication%20of%20every%20GET%20request%0A%20from%20part%20of%20URL%3F&In-Reply-To=%3C5640DB03.8030200%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007627.html">
   <LINK REL="Next"  HREF="007664.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Subject: Re: authentication of every GET request from part of URL?</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Subject%3A%20Re%3A%20authentication%20of%20every%20GET%20request%0A%20from%20part%20of%20URL%3F&In-Reply-To=%3C5640DB03.8030200%40treenet.co.nz%3E"
       TITLE="[squid-users] Subject: Re: authentication of every GET request from part of URL?">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Nov  9 17:42:27 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007627.html">[squid-users] Subject: Re: authentication of every GET request from part of URL?
</A></li>
        <LI>Next message (by thread): <A HREF="007664.html">[squid-users] Subject: Re: authentication of every GET request from part of URL?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7628">[ date ]</a>
              <a href="thread.html#7628">[ thread ]</a>
              <a href="subject.html#7628">[ subject ]</a>
              <a href="author.html#7628">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/11/2015 6:12 a.m., Sreenath BH wrote:
&gt;<i> Hi Alex,
</I>&gt;<i> 
</I>&gt;<i> thanks for your detailed asnwers.
</I>&gt;<i> 
</I>&gt;<i> Here are more details.
</I>&gt;<i> 1. If the URL does not have any token, we would like to send an error
</I>&gt;<i> message back to the browser/client, without doing a cache lookup, or
</I>&gt;<i> going to backend apache server.
</I>&gt;<i> 
</I>&gt;<i> 2. If the token is invalid (that is we can't find it in a database),
</I>&gt;<i> that means we can not serve
</I>&gt;<i> data. In this case we would like to send back a HTTP error (something
</I>&gt;<i> like a  401 or 404, along with a more descriptive message)
</I>&gt;<i> 
</I>
All of the above is external_acl_type helper operations.

&gt;<i> 3. If the token is valid(found), remove the token from the URL, and
</I>&gt;<i> use remaining part of URL as the key to look in Squid cache.
</I>&gt;<i> 
</I>&gt;<i> 4. If found return that data, along with proper HTTP status code.
</I>
The above is url_rewrite_program operations.

&gt;<i> 5. If cache lookup fails(not cached), send HTTP request to back-end
</I>&gt;<i> apache server (removing the token), get returned result, store in
</I>&gt;<i> cache, and return to client/browser.
</I>
And that part is normal caching. Squid will do it by default.

Except the &quot;removing the token&quot; part. Which was done at step #4 already,
so has no relevance here at step #5.

&gt;<i> 
</I>&gt;<i> I read about ACL helper programs, and it appears I can do arbitrary
</I>&gt;<i> validations in it, so should work.
</I>&gt;<i> Is it correct to assume that the external ACL code runs before url rewriting?,
</I>
The http_access tests are run before re-writing.
If the external ACL is one of those http_access tests the answer is yes.

&gt;<i> 
</I>&gt;<i> Does the URL rewriter run before a cache lookup?
</I>
Yes.



Although, please note that despite this workaround for your cache. It
really is *only* your proxy which will work nicely. Every other cache on
the planet will see your applications URLs are being unique and needing
different caching slots.

This not only wastes cache space for them, but also forces them to pass
extra traffic in the form of full-object fetches at your proxy. Which
raises the bandwidth costs for both them and you far beyond what proper
header based authentication or authorization would.

As the other sysadmin around the world notice this unnecessarily raised
cost they will start to hack their configs to force-cache the responses
from your application. Which will bypass your protection system entirely
since your proxy may not not even see many of the requests.

The earlier you can get the application re-design underway to remove the
credentials token from URL, the earlier the external problems and costs
will start to dsappear.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007627.html">[squid-users] Subject: Re: authentication of every GET request from part of URL?
</A></li>
	<LI>Next message (by thread): <A HREF="007664.html">[squid-users] Subject: Re: authentication of every GET request from part of URL?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7628">[ date ]</a>
              <a href="thread.html#7628">[ thread ]</a>
              <a href="subject.html#7628">[ subject ]</a>
              <a href="author.html#7628">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
