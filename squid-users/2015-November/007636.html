<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSL bumping without faked server certificates
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20bumping%20without%20faked%20server%20certificates&In-Reply-To=%3C564211F6.1070303%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007643.html">
   <LINK REL="Next"  HREF="007772.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSL bumping without faked server certificates</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20bumping%20without%20faked%20server%20certificates&In-Reply-To=%3C564211F6.1070303%40measurement-factory.com%3E"
       TITLE="[squid-users] SSL bumping without faked server certificates">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Nov 10 15:49:10 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007643.html">[squid-users] SSL bumping without faked server certificates
</A></li>
        <LI>Next message (by thread): <A HREF="007772.html">[squid-users] SSL bumping without faked server certificates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7636">[ date ]</a>
              <a href="thread.html#7636">[ thread ]</a>
              <a href="subject.html#7636">[ subject ]</a>
              <a href="author.html#7636">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/10/2015 07:05 AM, Stefan Kutzke wrote:

&gt;<i> My assumption is that I have to use in Squid's config:
</I>
&gt;<i> acl MYSITE ssl:server_name .mydomain.com
</I>&gt;<i> ssl_bump bump MYSITE
</I>&gt;<i> ssl_bump splice all
</I>
&gt;<i> This results in tunneling all https traffic, nothing will be bumped and
</I>&gt;<i> cached. 
</I>
Yes, probably because MYSITE (ssl::server_name) often needs SNI and SNI
is not available during step1 when MYSITE is evaluated in your config.
In other words, your config is equivalent to

  ssl_bump splice all

unless reverse DNS works perfectly well.


&gt;<i> I'm a little bit confused about the documentation:
</I>
&gt;<i> Under the headline &quot;Processing steps&quot;:
</I>&gt;<i> *Step 2:*
</I>&gt;<i>  1. Get TLS clientHello info, including *SNI* where available. 
</I>

&gt;<i> Under the headline &quot;Actions&quot;:
</I>&gt;<i> peek/stare Receive client *SNI (step1)*, ...
</I>

I know it is confusing, but I cannot find a better way to explain this
in brief documentation without pictures. Improvements are welcomed. The
key here is that ssl_bump rules are evaluated at the end of a step and
usually allow Squid to do something at the beginning of the next step.

For example, during step1, Squid does not have SNI. If a peek rule
matches during step1, then Squid proceeds to step2. At the beginning of
step2, Squid gets SNI. Thus, a step1 peek rule controls whether Squid
will get SNI (during step2).


&gt;<i> Is it possible to achieve my goal with Squid in transparent mode?
</I>
I should be possible, but I do not know whether anybody has done exactly
that so there could be some minor bugs along the way. You need
configuration suggested by Sebastian and the latest Squid you can build.


HTH,

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007643.html">[squid-users] SSL bumping without faked server certificates
</A></li>
	<LI>Next message (by thread): <A HREF="007772.html">[squid-users] SSL bumping without faked server certificates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7636">[ date ]</a>
              <a href="thread.html#7636">[ thread ]</a>
              <a href="subject.html#7636">[ subject ]</a>
              <a href="author.html#7636">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
