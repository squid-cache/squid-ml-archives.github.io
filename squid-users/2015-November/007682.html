<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] sslBump somehow interferes with authentication
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20sslBump%20somehow%20interferes%20with%20authentication&In-Reply-To=%3C564391CE.3010209%40norma.perm.ru%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007681.html">
   <LINK REL="Next"  HREF="007683.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] sslBump somehow interferes with authentication</H1>
    <B>Eugene M. Zheganin</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20sslBump%20somehow%20interferes%20with%20authentication&In-Reply-To=%3C564391CE.3010209%40norma.perm.ru%3E"
       TITLE="[squid-users] sslBump somehow interferes with authentication">emz at norma.perm.ru
       </A><BR>
    <I>Wed Nov 11 19:06:54 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007681.html">[squid-users] sslBump somehow interferes with authentication
</A></li>
        <LI>Next message (by thread): <A HREF="007683.html">[squid-users] sslBump somehow interferes with authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7682">[ date ]</a>
              <a href="thread.html#7682">[ thread ]</a>
              <a href="subject.html#7682">[ subject ]</a>
              <a href="author.html#7682">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi.

On 11.11.2015 23:44, Amos Jeffries wrote:
&gt;<i> Proxy-authentication cannot be performed on MITM'd traffic. That
</I>&gt;<i> includes SSL-bump decrypted messages.
</I>&gt;<i>
</I>&gt;<i> However, unlike the other methods SSL-bump CONNECT wrapper messages in
</I>&gt;<i> explicit-proxy traffic can be authenticated and their credentials
</I>&gt;<i> inherited by the messages decrypted. Squid should be doing that. But
</I>&gt;<i> again cannot do it for the fake/synthetic ones it generates itself on
</I>&gt;<i> intercepted port 443 traffic.
</I>&gt;<i>
</I>&gt;<i> So the question becomes, why are foo and bar ACLs not matching?
</I>&gt;<i>  http_access rules are applied separately to the CONNECT wrapper message
</I>&gt;<i> and to the decrypted non-CONNECT HTTP message(s).
</I>&gt;<i>
</I>&gt;<i>
</I>Yeah, completely my fault - I forgot to tell what URL user is trying to
browse and what matches when.
Once again.

===Cut===
acl freetime time MTWHF 18:00-24:00

acl foo dst 192.168.0.0/16
acl bar dstdomain .bar.tld

acl users proxy_auth steve
acl users proxy_auth mike
acl users proxy_auth bob

acl unauthorized proxy_auth stringthatwillnevermatch

acl block dstdomain &quot;block.acl&quot;
acl blockssl ssl::server_name &quot;block.acl&quot;

http_access allow foo
http_access allow bar

http_access deny unauthorized

http_access allow blockssl users freetime
http_access allow block users freetime
http_access deny blockssl users
http_access deny block users
http_access allow users
http_access deny all
===Cut===

So, the user starts it's browser and opens the URL '<A HREF="https://someurl">https://someurl</A>'.
And this URL matches both 'block' and 'blockssl' ACLs, one I created for
you know... usual matching and one - for sslBump, since dstdomain ACLs
cannot work there. So, the main idea here is to actually show some
information to the user, when he's trying to visit some blocked site via
TLS and that site isn't allowed - because all the user sees in such
situation are various browser-depending error pages, like &quot;Proxy server
refusing connections&quot; (Firefox) or some other brief error (cannot
remember it exactly)  in Chrome - so user thinks it's technical error
and starts bothering tech support. Can this goal be achieved for a
configuration with user authentication ? ACL 'foo' and ACL 'bar' don't
match 'somesite' because they are created to match some traffic that is
allowed to all proxy users, regardless of their authentication, and I
listed these ACLs here to give proper representation of my ACL structure
- there's a part without authentication, and there's a part with.

Thanks.
Eugene.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007681.html">[squid-users] sslBump somehow interferes with authentication
</A></li>
	<LI>Next message (by thread): <A HREF="007683.html">[squid-users] sslBump somehow interferes with authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7682">[ date ]</a>
              <a href="thread.html#7682">[ thread ]</a>
              <a href="subject.html#7682">[ subject ]</a>
              <a href="author.html#7682">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
