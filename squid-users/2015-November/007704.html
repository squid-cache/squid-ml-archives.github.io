<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] sslBump and intercept
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20sslBump%20and%20intercept&In-Reply-To=%3C5644927B.3090808%40norma.perm.ru%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007726.html">
   <LINK REL="Next"  HREF="007727.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] sslBump and intercept</H1>
    <B>Eugene M. Zheganin</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20sslBump%20and%20intercept&In-Reply-To=%3C5644927B.3090808%40norma.perm.ru%3E"
       TITLE="[squid-users] sslBump and intercept">emz at norma.perm.ru
       </A><BR>
    <I>Thu Nov 12 13:22:03 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007726.html">[squid-users] sslBump and intercept
</A></li>
        <LI>Next message (by thread): <A HREF="007727.html">[squid-users] sslBump and intercept
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7704">[ date ]</a>
              <a href="thread.html#7704">[ thread ]</a>
              <a href="subject.html#7704">[ subject ]</a>
              <a href="author.html#7704">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi.

On 12.11.2015 17:04, Steve Hill wrote:
&gt;<i>
</I>&gt;<i> proxy_auth won't work on intercepted traffic and will therefore always
</I>&gt;<i> return false, so as far as I can see you're always going to peek and
</I>&gt;<i> then splice.  i.e. you're never going to bump, so squid should never
</I>&gt;<i> be generating a forged certificate.
</I>Yup, I know that, and my fault is that I forgot to mention it, and to
explain that this sample config contains parts that handle user
authentication. So, yes, I'm aware that intercepted SSL traffic will
look to squid like anonymous, and that's the idea.
&gt;<i>
</I>&gt;<i> You say that Squid _is_ generating a forged certificate, so something
</I>&gt;<i> else is going on to cause it to do that.  My first guess is that Squid
</I>&gt;<i> is generating some kind of error page due to some http_access rules
</I>&gt;<i> which you haven't listed, and is therefore bumping.
</I>This is exactly what's happening.
&gt;<i>
</I>&gt;<i> Two possibilities spring to mind for the certificate being for the IP
</I>&gt;<i> address rather than for the name:
</I>&gt;<i> 1. The browser isn't bothering to include an SNI in the SSL handshake
</I>&gt;<i> (use wireshark to confirm).  In this case, Squid has no way to know
</I>&gt;<i> what name to stick in the cert, so will just use the IP instead.
</I>&gt;<i> 2. The bumping is happening in step 1 instead of step 2 for some
</I>&gt;<i> reason.  See:  <A HREF="http://bugs.squid-cache.org/show_bug.cgi?id=4327">http://bugs.squid-cache.org/show_bug.cgi?id=4327</A>
</I>Thanks, I'll try to investigate.

Eugene.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007726.html">[squid-users] sslBump and intercept
</A></li>
	<LI>Next message (by thread): <A HREF="007727.html">[squid-users] sslBump and intercept
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7704">[ date ]</a>
              <a href="thread.html#7704">[ thread ]</a>
              <a href="subject.html#7704">[ subject ]</a>
              <a href="author.html#7704">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
