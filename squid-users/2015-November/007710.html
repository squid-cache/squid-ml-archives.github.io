<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ACL and http_access
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ACL%20and%20http_access&In-Reply-To=%3C201511121704.06788.Antony.Stone%40squid.open.source.it%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007707.html">
   <LINK REL="Next"  HREF="007733.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ACL and http_access</H1>
    <B>Antony Stone</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ACL%20and%20http_access&In-Reply-To=%3C201511121704.06788.Antony.Stone%40squid.open.source.it%3E"
       TITLE="[squid-users] ACL and http_access">Antony.Stone at squid.open.source.it
       </A><BR>
    <I>Thu Nov 12 16:04:06 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007707.html">[squid-users] ACL and http_access
</A></li>
        <LI>Next message (by thread): <A HREF="007733.html">[squid-users] ACL and http_access
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7710">[ date ]</a>
              <a href="thread.html#7710">[ thread ]</a>
              <a href="subject.html#7710">[ subject ]</a>
              <a href="author.html#7710">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thursday 12 November 2015 at 15:55:10, Magic Link wrote:

&gt;<i> Hi,
</I>&gt;<i> I want people don't have access to Internet, except one hour twice a day
</I>&gt;<i> with only some urls.listed in a file.I use the ACL type &quot;time&quot; and
</I>&gt;<i> &quot;url_regex&quot; but it doesn't work.
</I>
Please elaborate on &quot;it doesn't work&quot;.

Do you mean people cannot access the Internet when they are supposed to be 
able to?

Do you mean they can access the Internet when they are not supposed to be able 
to?

Do you mean that can access sites which they are not supposed to access?

What, specifically, does and does not work?

&gt;<i> I think i don't do well with the order of http_access too.  Is it possible
</I>&gt;<i> with squid only to do what i want ? Here is my squid.conf :
</I>
&gt;<i> acl network src 10.2.0.0/16
</I>&gt;<i> acl working_hours time MTWHF 09:30-10:30
</I>&gt;<i> acl out_working_hours MTWHF 17:30-18:30
</I>&gt;<i> acl whitelist url_regex &quot;/etc/squid3/allow.acl&quot;
</I>
We need to see the contents (or at least, some examples) from that file.

&gt;<i> acl SSL_ports port 443
</I>&gt;<i> acl Safe_ports port 80		# http
</I>&gt;<i> acl Safe_ports port 21		# ftp
</I>&gt;<i> acl Safe_ports port 443		# https
</I>&gt;<i> acl Safe_ports port 70		# gopher
</I>&gt;<i> acl Safe_ports port 210		# wais
</I>&gt;<i> acl Safe_ports port 1025-65535	# unregistered ports
</I>&gt;<i> acl Safe_ports port 280		# http-mgmt
</I>&gt;<i> acl Safe_ports port 488		# gss-http
</I>&gt;<i> acl Safe_ports port 591		# filemaker
</I>&gt;<i> acl Safe_ports port 777		# multiling http
</I>&gt;<i> acl CONNECT method CONNECT
</I>&gt;<i> http_access deny !Safe_ports
</I>&gt;<i> http_access deny CONNECT !SSL_ports
</I>&gt;<i> http_access allow localhost manager
</I>&gt;<i> http_access deny manager
</I>
&gt;<i> http_access allow localhost
</I>&gt;<i> http_access deny out_working_hours
</I>&gt;<i> http_access allow working_hours whitelist
</I>&gt;<i> http_access allow network
</I>&gt;<i> http_access deny all
</I>
So the above 5 directives will:

1. Allow access from the local machine (good).

2. Deny access from anywhere between M-F 17:30-18:30 - is that really what you 
meant?  You said you want to allow access for one hour twice a day, yet here 
you are denying access during a one hour timeslot.

3. Allow access from anywhere M-F 09:30-10:30 to sites matching your regex 
list.

4. Allow access from any address 10.2.0.0/16 - this looks bad

5. Deny anything else.

&gt;<i> http_port 3128
</I>&gt;<i> coredump_dir /var/spool/squid3
</I>&gt;<i> refresh_pattern ^ftp:		1440	20%	10080
</I>&gt;<i> refresh_pattern ^gopher:	1440	0%	1440
</I>&gt;<i> refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
</I>&gt;<i> refresh_pattern .		0	20%	4320
</I>&gt;<i> debug_options 28,4
</I>
I would suggest (assuming your regex list is good) trying:

http_access allow localhost
http_access allow network working_hours whitelist
http_access allow network out_working_hours whitelist
http_access deny all

The above should allow access from 10.2.0.0/16 to the sites in your regex list 
between the hours 09:30-10:30 and 17:30-18:30 M-F

If that isn't what you wanted, please specify the requirement and we'll see if 
we can help further.



Antony.

-- 
+++ Divide By Cucumber Error.  Please Reinstall Universe And Reboot +++

                                                   Please reply to the list;
                                                         please *don't* CC me.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007707.html">[squid-users] ACL and http_access
</A></li>
	<LI>Next message (by thread): <A HREF="007733.html">[squid-users] ACL and http_access
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7710">[ date ]</a>
              <a href="thread.html#7710">[ thread ]</a>
              <a href="subject.html#7710">[ subject ]</a>
              <a href="author.html#7710">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
