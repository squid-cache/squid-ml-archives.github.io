<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ssl bump and url_rewrite_program (like squidguard)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ssl%20bump%20and%20url_rewrite_program%20%28like%20squidguard%29&In-Reply-To=%3C5645AA73.5090208%40e-gaulue.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007725.html">
   <LINK REL="Next"  HREF="007745.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ssl bump and url_rewrite_program (like squidguard)</H1>
    <B>Edouard Gaulu&#233;</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ssl%20bump%20and%20url_rewrite_program%20%28like%20squidguard%29&In-Reply-To=%3C5645AA73.5090208%40e-gaulue.com%3E"
       TITLE="[squid-users] ssl bump and url_rewrite_program (like squidguard)">edouard at e-gaulue.com
       </A><BR>
    <I>Fri Nov 13 09:16:35 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007725.html">[squid-users] ssl bump and url_rewrite_program (like squidguard)
</A></li>
        <LI>Next message (by thread): <A HREF="007745.html">[squid-users] ssl bump and url_rewrite_program (like squidguard)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7737">[ date ]</a>
              <a href="thread.html#7737">[ thread ]</a>
              <a href="subject.html#7737">[ subject ]</a>
              <a href="author.html#7737">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Amos and all,

Learning on HTTP CONNECT, I got 
there:<A HREF="http://serverfault.com/questions/727262/how-to-redirect-https-connect-request-with-squid-explicit-proxy">http://serverfault.com/questions/727262/how-to-redirect-https-connect-request-with-squid-explicit-proxy</A>

I read on <A HREF="http://wiki.squid-cache.org/Features/MimicSslServerCert">http://wiki.squid-cache.org/Features/MimicSslServerCert</A> in the 
&quot;Delayed error responses&quot; chapter:
&quot;When Squid fails to negotiate a secure connection with the origin 
server and bump-ssl-server-first is enabled, Squid remembers the error 
page and serves it after establishing the secure connection with the 
client and receiving the first encrypted client request. The error is 
served securely. The same approach is used for Squid redirect messages 
configured via deny_info. This error delay is implemented because (a) 
browsers like FireFox and Chromium do not display CONNECT errors 
correctly and (b) intercepted SSL connections must wait for the first 
request to serve an error.&quot;

My ideas/questions:
1/ Is there a way to have the same with new peek and splice feature?
2/ Is there a way to say url_rewrite_program not to work on CONNECT 
request? This way the CONNECT is not redirected, next request the 
browser sends after squid has bumped it  should be a kind of  GET/POST 
one that will be redirected by url_rewrite_program.
3/ Would it works if squidguard were i-cap'ed?

EG


Le 13/11/2015 01:31, Amos Jeffries a &#233;crit :
&gt;<i> On 13/11/2015 1:02 a.m., Edouard Gaulu&#233; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Why is the browser not taking account of the redirect?
</I>&gt;<i> Think about *exactly* what is being redirected.
</I>&gt;<i>
</I>&gt;<i> CONNECT is a request to setup a blind packet relaying tunnel.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> Why is it redoing the same connect?
</I>&gt;<i> Because its a browser. They do some really weird things when confused.
</I>&gt;<i>
</I>&gt;<i> It was told a TCP relay tunnel existed at
</I>&gt;<i> &quot;<A HREF="https://proxyweb.echoppe.lan/cgi-bin/...">https://proxyweb.echoppe.lan/cgi-bin/...</A>&quot;. Thats a pretty weird place
</I>&gt;<i> for a network socket to exist.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> Why is there no trace at all in the proxy logs of this second CONNECT?
</I>&gt;&gt;<i>
</I>&gt;<i> Only if it was handled would it be logged. It seems it may have been
</I>&gt;<i> read in (or maybe not) but definitely not processed for some reason.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007725.html">[squid-users] ssl bump and url_rewrite_program (like squidguard)
</A></li>
	<LI>Next message (by thread): <A HREF="007745.html">[squid-users] ssl bump and url_rewrite_program (like squidguard)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7737">[ date ]</a>
              <a href="thread.html#7737">[ thread ]</a>
              <a href="subject.html#7737">[ subject ]</a>
              <a href="author.html#7737">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
