<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Some questions about ssl_bump.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Some%20questions%20about%20ssl_bump.&In-Reply-To=%3C564B85A9.2040009%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007836.html">
   <LINK REL="Next"  HREF="007841.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Some questions about ssl_bump.</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Some%20questions%20about%20ssl_bump.&In-Reply-To=%3C564B85A9.2040009%40treenet.co.nz%3E"
       TITLE="[squid-users] Some questions about ssl_bump.">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Nov 17 19:53:13 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007836.html">[squid-users] Some questions about ssl_bump.
</A></li>
        <LI>Next message (by thread): <A HREF="007841.html">[squid-users] Some questions about ssl_bump.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7840">[ date ]</a>
              <a href="thread.html#7840">[ thread ]</a>
              <a href="subject.html#7840">[ subject ]</a>
              <a href="author.html#7840">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 18/11/2015 7:46 a.m., Bruce Markey wrote:
&gt;<i> So I &quot;think&quot; I have squid working with https, but to be honest I'm not
</I>&gt;<i> really sure.  Hopefully someone can point me in the right direction.
</I>&gt;<i> 
</I>&gt;<i> We're using squid as a transparent NON caching proxy.  It's basically only
</I>&gt;<i> there to give us insight into what everyone is using the web for.  From
</I>&gt;<i> there we'll do some blacklisting via squidguard.
</I>&gt;<i> 
</I>&gt;<i> I'm running centos 7, squid installed via yum.  Squid version 3.3.8.
</I>&gt;<i> 
</I>
SSL-Bump is a feature participating in an &quot;arms race&quot;. The situation is
very volatile and things continue to change fast as the worlds use of
TLS improves, and the functionality in Squid changes to match it.

You basically need to use the very latest Squid Squid release for it to
work properly. Today that means 3.5.10 or later.

You can find more recent packages for CentOS at the repositories listed
in &lt;<A HREF="http://wiki.squid-cache.org/KnowledgeBase/CentOS">http://wiki.squid-cache.org/KnowledgeBase/CentOS</A>&gt;


&gt;<i> Here are my questions.
</I>&gt;<i> 
</I>&gt;<i> 1. If ssl_bump is working correctly what should I be seeing in my
</I>&gt;<i> access.log?  Something like this?
</I>&gt;<i> 1447785601.904 240239 192.168.203.100 TCP_MISS/200 4876 CONNECT
</I>&gt;<i> 173.194.207.113:443 - HIER_DIRECT/173.194.207.113 -
</I>&gt;<i> 
</I>&gt;<i> 2. What should ssl_bump be set to?  Right now it's set to ssl_bump none
</I>&gt;<i> all.   I don't think I'm seeing the traffic in the logs.  I changed this
</I>&gt;<i> and instantly started seeing https in the log BUT could not connect.
</I>&gt;<i> Browser errors.  Yes I understand how MITM works but I'm not sure what
</I>&gt;<i> exactly I'm supposed to be seeing here.   I assume if this was working
</I>&gt;<i> correctly i'd have push out the self signed cert I used for squid to
</I>&gt;<i> everyone.
</I>
Depends on what you are connecting to. But 3.3 series are not capable of
working around the &quot;certifiate pinning&quot; features that are becomming
popular in browsers.

&gt;<i> 
</I>&gt;<i> 3.  I'm not able to block https sites with squidguard.  I think this is due
</I>&gt;<i> to my https proxying not being correct.  I'm just not sure what exactly to
</I>&gt;<i> look for to troubleshoot.
</I>
SG is not capable of HTTPS. It &quot;blocks&quot; traffic by causing the client to
be sent to a HTTP URL. Browsers do not like doing this and some will
error. Older versions of Squid would not correctly perform the outgoing
connection when intercepted traffic was sent over plain-text even if the
URL was <A HREF="http://.">http://.</A>

Also, SG is a dead software and no longer maintained. Everything it does
is able to be written as squid.conf ACLs instead.


&gt;<i> 
</I>&gt;<i> At the end of the day all I'd like to be able to do is quantify where
</I>&gt;<i> people are going, both http and https and to be able to blacklist certain
</I>&gt;<i> sites.
</I>
That is best done with the peek-and-splice functionality of Squid-3.5.
Where you can peek to see from SNI where the client was going, then
terminate or splice based on that. No need for decryption to complicate
things most of the time, but you will still need to setup certs for the
(declining) edge cases where it is still necessary.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007836.html">[squid-users] Some questions about ssl_bump.
</A></li>
	<LI>Next message (by thread): <A HREF="007841.html">[squid-users] Some questions about ssl_bump.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7840">[ date ]</a>
              <a href="thread.html#7840">[ thread ]</a>
              <a href="subject.html#7840">[ subject ]</a>
              <a href="author.html#7840">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
