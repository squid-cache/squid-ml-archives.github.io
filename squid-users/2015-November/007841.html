<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Some questions about ssl_bump.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Some%20questions%20about%20ssl_bump.&In-Reply-To=%3CCACRtyezEXR6p1dOA9Nn9zdSvYr4Xq48foqO8p3zDJwBXAOJk8w%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007840.html">
   <LINK REL="Next"  HREF="007843.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Some questions about ssl_bump.</H1>
    <B>Bruce Markey</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Some%20questions%20about%20ssl_bump.&In-Reply-To=%3CCACRtyezEXR6p1dOA9Nn9zdSvYr4Xq48foqO8p3zDJwBXAOJk8w%40mail.gmail.com%3E"
       TITLE="[squid-users] Some questions about ssl_bump.">bmarkey at gmail.com
       </A><BR>
    <I>Tue Nov 17 20:24:18 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007840.html">[squid-users] Some questions about ssl_bump.
</A></li>
        <LI>Next message (by thread): <A HREF="007843.html">[squid-users] Some questions about ssl_bump.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7841">[ date ]</a>
              <a href="thread.html#7841">[ thread ]</a>
              <a href="subject.html#7841">[ subject ]</a>
              <a href="author.html#7841">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Amos,

I knew something wasn't right.

Ok then I'm going to start there.  I had a heck of a time getting
squidguard to even work due to its reliance on old berkely db packages, I'd
be happy to see it go.

So that being said. I'm going to lose squidguard.  Upgrade squid to 3.5.

I haven't even looked at the 3.5 stuff.  How big of a config change am I
looking at?  That being said, upgrade or start fresh?

Thanks again. This is the first definitive answer I've gotten!.



On Tue, Nov 17, 2015 at 2:53 PM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:

&gt;<i> On 18/11/2015 7:46 a.m., Bruce Markey wrote:
</I>&gt;<i> &gt; So I &quot;think&quot; I have squid working with https, but to be honest I'm not
</I>&gt;<i> &gt; really sure.  Hopefully someone can point me in the right direction.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; We're using squid as a transparent NON caching proxy.  It's basically
</I>&gt;<i> only
</I>&gt;<i> &gt; there to give us insight into what everyone is using the web for.  From
</I>&gt;<i> &gt; there we'll do some blacklisting via squidguard.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I'm running centos 7, squid installed via yum.  Squid version 3.3.8.
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> SSL-Bump is a feature participating in an &quot;arms race&quot;. The situation is
</I>&gt;<i> very volatile and things continue to change fast as the worlds use of
</I>&gt;<i> TLS improves, and the functionality in Squid changes to match it.
</I>&gt;<i>
</I>&gt;<i> You basically need to use the very latest Squid Squid release for it to
</I>&gt;<i> work properly. Today that means 3.5.10 or later.
</I>&gt;<i>
</I>&gt;<i> You can find more recent packages for CentOS at the repositories listed
</I>&gt;<i> in &lt;<A HREF="http://wiki.squid-cache.org/KnowledgeBase/CentOS">http://wiki.squid-cache.org/KnowledgeBase/CentOS</A>&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Here are my questions.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 1. If ssl_bump is working correctly what should I be seeing in my
</I>&gt;<i> &gt; access.log?  Something like this?
</I>&gt;<i> &gt; 1447785601.904 240239 192.168.203.100 TCP_MISS/200 4876 CONNECT
</I>&gt;<i> &gt; 173.194.207.113:443 - HIER_DIRECT/173.194.207.113 -
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 2. What should ssl_bump be set to?  Right now it's set to ssl_bump none
</I>&gt;<i> &gt; all.   I don't think I'm seeing the traffic in the logs.  I changed this
</I>&gt;<i> &gt; and instantly started seeing https in the log BUT could not connect.
</I>&gt;<i> &gt; Browser errors.  Yes I understand how MITM works but I'm not sure what
</I>&gt;<i> &gt; exactly I'm supposed to be seeing here.   I assume if this was working
</I>&gt;<i> &gt; correctly i'd have push out the self signed cert I used for squid to
</I>&gt;<i> &gt; everyone.
</I>&gt;<i>
</I>&gt;<i> Depends on what you are connecting to. But 3.3 series are not capable of
</I>&gt;<i> working around the &quot;certifiate pinning&quot; features that are becomming
</I>&gt;<i> popular in browsers.
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 3.  I'm not able to block https sites with squidguard.  I think this is
</I>&gt;<i> due
</I>&gt;<i> &gt; to my https proxying not being correct.  I'm just not sure what exactly
</I>&gt;<i> to
</I>&gt;<i> &gt; look for to troubleshoot.
</I>&gt;<i>
</I>&gt;<i> SG is not capable of HTTPS. It &quot;blocks&quot; traffic by causing the client to
</I>&gt;<i> be sent to a HTTP URL. Browsers do not like doing this and some will
</I>&gt;<i> error. Older versions of Squid would not correctly perform the outgoing
</I>&gt;<i> connection when intercepted traffic was sent over plain-text even if the
</I>&gt;<i> URL was <A HREF="http://.">http://.</A>
</I>&gt;<i>
</I>&gt;<i> Also, SG is a dead software and no longer maintained. Everything it does
</I>&gt;<i> is able to be written as squid.conf ACLs instead.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; At the end of the day all I'd like to be able to do is quantify where
</I>&gt;<i> &gt; people are going, both http and https and to be able to blacklist certain
</I>&gt;<i> &gt; sites.
</I>&gt;<i>
</I>&gt;<i> That is best done with the peek-and-splice functionality of Squid-3.5.
</I>&gt;<i> Where you can peek to see from SNI where the client was going, then
</I>&gt;<i> terminate or splice based on that. No need for decryption to complicate
</I>&gt;<i> things most of the time, but you will still need to setup certs for the
</I>&gt;<i> (declining) edge cases where it is still necessary.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20151117/06b39e9f/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20151117/06b39e9f/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007840.html">[squid-users] Some questions about ssl_bump.
</A></li>
	<LI>Next message (by thread): <A HREF="007843.html">[squid-users] Some questions about ssl_bump.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7841">[ date ]</a>
              <a href="thread.html#7841">[ thread ]</a>
              <a href="subject.html#7841">[ subject ]</a>
              <a href="author.html#7841">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
