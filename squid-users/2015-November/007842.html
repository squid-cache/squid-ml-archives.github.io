<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] (113) Software caused connection abort
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%28113%29%20Software%20caused%20connection%20abort&In-Reply-To=%3C564B8DB6.8090803%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007833.html">
   <LINK REL="Next"  HREF="007834.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] (113) Software caused connection abort</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%28113%29%20Software%20caused%20connection%20abort&In-Reply-To=%3C564B8DB6.8090803%40treenet.co.nz%3E"
       TITLE="[squid-users] (113) Software caused connection abort">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Nov 17 20:27:34 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007833.html">[squid-users] (113) Software caused connection abort
</A></li>
        <LI>Next message (by thread): <A HREF="007834.html">[squid-users] TCP_MISS/502
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7842">[ date ]</a>
              <a href="thread.html#7842">[ thread ]</a>
              <a href="subject.html#7842">[ subject ]</a>
              <a href="author.html#7842">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 18/11/2015 3:55 a.m., Patrick Flaherty wrote:
&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> Here is my squid config.
</I>&gt;<i>
</I>&gt;<i> -Patrick
</I>&gt;<i>
</I>
With this configuration Squid is relaying CONNECT messages as-is. squid
has nothing to do with the crypto layer(s) inside the tunnel being
setup, it is just a blind relay for the data.

&gt;<i>From the packet trace I see a 200 status being sent by Squid to the
</I>client. So as far as Squid is concerned the tunnel setup is successfully
completed.

 ==&gt; Meaning those crypto problems are directly and only between the
client and the server software. Nothing to do with Squid.


&gt;<i> # Squid Proxy Configuration
</I>&gt;<i>
</I>&gt;<i> http_port     3128
</I>&gt;<i>
</I>&gt;<i> # acl and http_access to (&quot;whitelist.txt&quot;)
</I>&gt;<i> acl whitelist dstdomain  &quot;c:/squid/etc/squid/whitelist.txt&quot;
</I>&gt;<i> http_access 	allow 	whitelist
</I>&gt;<i>
</I>&gt;<i> # network source of proxy traffic
</I>&gt;<i> acl localnet  src        0.0.0.0/0.0.0.0
</I>
You have defined the *entire IPv4 Internet* as being your LAN.
This is terrible in several ways:

1) the ACL definition for that should correctly be:

   acl localnet src ipv4


2) it would allows almost unrestricted use of your proxy by any attacker
who can find it. (if it was actually working, see #4 below)


3) entire IPv4-space is not yours to own.

If the intention was to not service IPv6 cleints at all, use this

  http_port 0.0.0.0:3128

or this if you want to continue actively sending &quot;Access Denied&quot; for all
IPv6 clients:

  acl ipv4 src ipv4
  http_access deny !ipv4


&gt;<i>
</I>&gt;<i> # acl directives for ports and protocols
</I>&gt;<i> acl http      proto      http
</I>&gt;<i> acl https     proto      https
</I>&gt;<i> acl port_80   port       80
</I>&gt;<i> acl sslports  port       443
</I>&gt;<i> acl CONNECT   method     CONNECT
</I>&gt;<i>
</I>&gt;<i> # rules allowing proxy access
</I>&gt;<i> http_access allow http    port_80  whitelist localnet
</I>&gt;<i> http_access allow https   sslports whitelist localnet
</I>&gt;<i>
</I>
4) You already did &quot;allow whitelist&quot; with no restrictions. These
controls with extra restrictions are doing nothing.


&gt;<i> # dns servers (Change dns_nameservers to client dns servers for
</I>consistency and better performance)
&gt;<i> dns_nameservers 8.8.8.8 8.8.4.4
</I>
Why not setup a proper *working* recursive resolver within your network?
it will most probably be actually faster than sending your DNS traffic
to halfway around the world and back.

You can have that local resolver use 8.8.8.8/8.8.4.4 if they really are
faster than your own ISPs resolver. And divert the LAN clients port 53
traffic through it if your clients insist on using other resolvers.


&gt;<i>
</I>&gt;<i> # cache web pages directory
</I>&gt;<i> #cache_dir ufs C:/Squid/var/cache/squid 100 16 256
</I>&gt;<i> cache_mem 64 MB
</I>&gt;<i>
</I>&gt;<i> # log file roll weekly
</I>&gt;<i> logfile_rotate 7
</I>&gt;<i>
</I>&gt;<i> # access log rules
</I>&gt;<i> logformat squid %tl %6tr %&gt;a %Ss/%03&gt;Hs %&lt;st %rm %ru %un %Sh/%&lt;A %mt
</I>
The basic log formats are now built-in. Please do not re-define them.
Squid-3 will ignore your config.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007833.html">[squid-users] (113) Software caused connection abort
</A></li>
	<LI>Next message (by thread): <A HREF="007834.html">[squid-users] TCP_MISS/502
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7842">[ date ]</a>
              <a href="thread.html#7842">[ thread ]</a>
              <a href="subject.html#7842">[ subject ]</a>
              <a href="author.html#7842">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
