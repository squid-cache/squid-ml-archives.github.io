<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] intercepting traffic
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20intercepting%20traffic&In-Reply-To=%3C564D2F0A.9090304%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007870.html">
   <LINK REL="Next"  HREF="007873.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] intercepting traffic</H1>
    <B>Brendan Kearney</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20intercepting%20traffic&In-Reply-To=%3C564D2F0A.9090304%40gmail.com%3E"
       TITLE="[squid-users] intercepting traffic">bpk678 at gmail.com
       </A><BR>
    <I>Thu Nov 19 02:08:10 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007870.html">[squid-users] squid ACL based on OS type
</A></li>
        <LI>Next message (by thread): <A HREF="007873.html">[squid-users] intercepting traffic
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7872">[ date ]</a>
              <a href="thread.html#7872">[ thread ]</a>
              <a href="subject.html#7872">[ subject ]</a>
              <a href="author.html#7872">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am trying to set up a transparent, intercepting squid instance, along 
side my existing explicit instance, and would like some input around 
what i have buggered up so far.

i am running HAProxy in front of two squid instances, with the XFF 
header added by HAProxy.  My squid configs are all set to follow the XFF 
for the real source and logging is setup around digesting XFF for the 
source.

i took my config and added:
http_port 192.168.88.1:3129 intercept

on the router/firewall/load balancer device that is running HAProxy, i 
added a NAT rule as described here:
<A HREF="http://www.fwbuilder.org/4.0/docs/users_guide5/redirection_rules.shtml">http://www.fwbuilder.org/4.0/docs/users_guide5/redirection_rules.shtml</A>

in my cache.log i get:
2015/11/18 20:45:13 kid1|  NF getsockopt(SO_ORIGINAL_DST) failed on 
local=192.168.88.1:3129 remote=192.168.88.254:37102 FD 20 flags=33: (92) 
Protocol not available
2015/11/18 20:49:05 kid1|  NF getsockopt(SO_ORIGINAL_DST) failed on 
local=192.168.88.1:3129 remote=192.168.88.254:37381 FD 20 flags=33: (92) 
Protocol not available

this tells me that i am getting to the squid instances via the load 
balancer, but i am running into the &quot;NAT must occur on the squid box&quot; 
rule, i think.

i want to intercept http traffic, and load balance the traffic to my 
squid instances.  this link:

<A HREF="http://wiki.squid-cache.org/ConfigExamples/Intercept/IptablesPolicyRoute">http://wiki.squid-cache.org/ConfigExamples/Intercept/IptablesPolicyRoute</A>

seems to be a step in the right direction, but i am at a loss on how to 
apply the logic to my environment.  my proxies are on a separate vlan, 
behind a load balancer, not in a DMZ.  i am missing something and not 
sure exactly what it is.  any input on where i need to go?

thanks,

brendan

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007870.html">[squid-users] squid ACL based on OS type
</A></li>
	<LI>Next message (by thread): <A HREF="007873.html">[squid-users] intercepting traffic
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7872">[ date ]</a>
              <a href="thread.html#7872">[ thread ]</a>
              <a href="subject.html#7872">[ subject ]</a>
              <a href="author.html#7872">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
