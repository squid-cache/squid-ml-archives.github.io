<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] [Squid 3.5.10] - Unable to cache objects from Cloudflare
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5BSquid%203.5.10%5D%20-%20Unable%20to%20cache%20objects%20from%0A%20Cloudflare&In-Reply-To=%3C564E9078.1040409%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007886.html">
   <LINK REL="Next"  HREF="007930.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] [Squid 3.5.10] - Unable to cache objects from Cloudflare</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5BSquid%203.5.10%5D%20-%20Unable%20to%20cache%20objects%20from%0A%20Cloudflare&In-Reply-To=%3C564E9078.1040409%40treenet.co.nz%3E"
       TITLE="[squid-users] [Squid 3.5.10] - Unable to cache objects from Cloudflare">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Nov 20 03:16:08 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007886.html">[squid-users] [Squid 3.5.10] - Unable to cache objects from	Cloudflare
</A></li>
        <LI>Next message (by thread): <A HREF="007930.html">[squid-users] [Squid 3.5.10] - Unable to cache objects from Cloudflare
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7889">[ date ]</a>
              <a href="thread.html#7889">[ thread ]</a>
              <a href="subject.html#7889">[ subject ]</a>
              <a href="author.html#7889">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 20/11/2015 12:59 p.m., David Touzeau wrote:
&gt;<i> Hi
</I>&gt;<i> 
</I>&gt;<i> It seems that squid is not able to save in cache objects from CloudFlare
</I>&gt;<i> websites.
</I>&gt;<i> 
</I>&gt;<i> Here it is the header information:
</I>&gt;<i> 
</I>&gt;<i> Connecting to 127.0.0.1:8182... connected.
</I>&gt;<i> Proxy request sent, awaiting response...
</I>&gt;<i>   HTTP/1.1 200 OK
</I>&gt;<i>   Date: Thu, 19 Nov 2015 18:03:31 GMT
</I>&gt;<i>   Content-Type: image/png
</I>&gt;<i>   Set-Cookie: __cfduid=d1ca8a069c4db15a451d81f2327781ced1447956211;
</I>&gt;<i> expires=Fri, 18-Nov-16 18:03:31 GMT; path=/; domain=.mutaz.net; HttpOnly
</I>&gt;<i>   Last-Modified: Fri, 23 Oct 2015 11:18:39 GMT
</I>&gt;<i>   Vary: Accept-Encoding
</I>&gt;<i>   X-Cache: HIT from Backend
</I>&gt;<i>   CF-Cache-Status: HIT
</I>&gt;<i>   Server: cloudflare-nginx
</I>&gt;<i>   CF-RAY: 247dd510143a08fc-CDG
</I>&gt;<i>   X-Cache: MISS from MySquid3-5-10
</I>&gt;<i>   X-Cache-Lookup: MISS from MySquid3-5-10:3128
</I>&gt;<i>   Transfer-Encoding: chunked
</I>&gt;<i>   Connection: keep-alive
</I>&gt;<i> 
</I>&gt;<i> I have seen the same issue in tracker as 3806
</I>&gt;<i> <A HREF="http://bugs.squid-cache.org/show_bug.cgi?id=3806">http://bugs.squid-cache.org/show_bug.cgi?id=3806</A>
</I>
If it actually is the same issue. Then the situation is still as
described by Alex in his description of what the patch did.

Namely that Vary caching depends on whether one is using shared memory
cache or not.

&gt;<i> 
</I>&gt;<i> Can somebody encounter the same behavior with latest squid branch ?
</I>&gt;<i> 
</I>

I do not recall anyone having done anything specifically to followup
after that patch went in back in 3.3. But there have been a number of
updates in and around the store and Vary functionality across all Squi
dversions 3.3+ right up to yesterdays 4.x snapshot. So it may be a
completely different issue, or a different variation with alternative
way to reach it


That said, tehre are two things to be aware of:

1) the X-Cache/X-Cache-Lookup headers output by Squid do contains lies
in HTTP/1.1. They were designed for HTTP/1.0 where the situation is
HIT-vs-MISS with no grey areas like REFRESH, so they can contain wrong
HIT/MISS wording when a revalidate happens (which happens a lot in 1.1).

2) the Squid caching decisions depend as much on the request details and
what was cached beforehand as what the reply headers say. There may be
something hidden in those details preventing what you want.


And finally, please test the 3.5.11 snapshot r13954 coming out today if
you are having odd cache behaviour in 3.5.10 and 3.5.11. There are a
couple of patches there which might be involved.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007886.html">[squid-users] [Squid 3.5.10] - Unable to cache objects from	Cloudflare
</A></li>
	<LI>Next message (by thread): <A HREF="007930.html">[squid-users] [Squid 3.5.10] - Unable to cache objects from Cloudflare
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7889">[ date ]</a>
              <a href="thread.html#7889">[ thread ]</a>
              <a href="subject.html#7889">[ subject ]</a>
              <a href="author.html#7889">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
