<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] intercepting traffic
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20intercepting%20traffic&In-Reply-To=%3C564E9D92.10402%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007887.html">
   <LINK REL="Next"  HREF="007874.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] intercepting traffic</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20intercepting%20traffic&In-Reply-To=%3C564E9D92.10402%40treenet.co.nz%3E"
       TITLE="[squid-users] intercepting traffic">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Nov 20 04:12:02 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007887.html">[squid-users] intercepting traffic
</A></li>
        <LI>Next message (by thread): <A HREF="007874.html">[squid-users] Squid HaProxy Protocol Support
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7891">[ date ]</a>
              <a href="thread.html#7891">[ thread ]</a>
              <a href="subject.html#7891">[ subject ]</a>
              <a href="author.html#7891">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 20/11/2015 1:09 p.m., Brendan Kearney wrote:
&gt;<i> when i put in just the DNAT that sends the traffic to the proxy VIP and
</I>&gt;<i> load balances the requests to the squid instances on port 3128 (not the
</I>&gt;<i> intercept port), i issue a curl command:
</I>&gt;<i> 
</I>&gt;<i> curl -vvv --noproxy squid-cache.org <A HREF="http://squid-cache.org/">http://squid-cache.org/</A>
</I>&gt;<i> 
</I>&gt;<i> and get an error page saying:
</I>&gt;<i> 
</I>&gt;<i> ...
</I>&gt;<i> &lt;p&gt;The following error was encountered while trying to retrieve the URL:
</I>&gt;<i> &lt;a href=&quot;/&quot;&gt;/&lt;/a&gt;&lt;/p&gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> is the DNAT stripping header info, such as the Host header, or am i
</I>&gt;<i> still missing something?
</I>
HTTP != TCP/IP ... DNAT is only changing the IP:port details.

Whatever is receiving the packet from DNAT has to also translate the
HTTP layer messages from origin relative-URI format to intermediary
absolute-URI format.

That rule-of-thumb &quot;MUST rule&quot; you mentioned earlier is about those two
DNAT and HTTP translation operations being required to be done together
on the same machine. It is not limited to Squid. It could be HAProxy or
some other LB software responsible for doing it.

Squid is just the only software which actually tells you up front about
the issue, instead of leaving other software later on down the transfer
chain (possibly in somebody elses network) to break with errors like you
see above.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007887.html">[squid-users] intercepting traffic
</A></li>
	<LI>Next message (by thread): <A HREF="007874.html">[squid-users] Squid HaProxy Protocol Support
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7891">[ date ]</a>
              <a href="thread.html#7891">[ thread ]</a>
              <a href="subject.html#7891">[ subject ]</a>
              <a href="author.html#7891">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
