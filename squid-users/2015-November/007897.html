<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid intercept mode fo http &amp; https
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20intercept%20mode%20fo%20http%20%26%20https&In-Reply-To=%3C201511211721.52776.Antony.Stone%40squid.open.source.it%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007896.html">
   <LINK REL="Next"  HREF="007898.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid intercept mode fo http &amp; https</H1>
    <B>Antony Stone</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20intercept%20mode%20fo%20http%20%26%20https&In-Reply-To=%3C201511211721.52776.Antony.Stone%40squid.open.source.it%3E"
       TITLE="[squid-users] squid intercept mode fo http &amp; https">Antony.Stone at squid.open.source.it
       </A><BR>
    <I>Sat Nov 21 16:21:52 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007896.html">[squid-users] squid intercept mode fo http &amp; https
</A></li>
        <LI>Next message (by thread): <A HREF="007898.html">[squid-users] squid intercept mode fo http &amp; https
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7897">[ date ]</a>
              <a href="thread.html#7897">[ thread ]</a>
              <a href="subject.html#7897">[ subject ]</a>
              <a href="author.html#7897">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Saturday 21 November 2015 at 17:02:56, Ahmad Alzaeem wrote:

&gt;<i> Hi Guys I have a squid runnng in intercept mode
</I>
Okay...

&gt;<i> I have a dns to resolve all the websites to the ip of proxy
</I>
Which instructions / documentation did you follow saying that was a good idea?

&gt;<i> I want the proxy to be able to operate normally
</I>
Then, set up your DNS server normally as well :)

&gt;<i> and don't look @ the destination ip since all packet will have the
</I>&gt;<i> destination ip as the ip of proxy
</I>
I think you have the wrong idea of what &quot;intercept mode&quot; means.

&gt;<i> I want  the proxy to operate based on the domain name.
</I>
So, just route the packets to the proxy (with the *correct* destination IP 
address) as per all the guidelines you can find on the Internet showing how to 
do this, and Squid will do the rest.

&gt;<i> So far I have the squid listenting on port 11611 interept mode and I have
</I>&gt;<i> traffic 80 , 443 hit the linux proxy server
</I>
You need to perform NAT on the same box as Squid is running on, to redirect 
packets from their original IP address, to the IP of Squid, and it will work.

Undo the weirdness you've created with DNS.

&gt;<i> Now I cant open either http or https .
</I>
I can only say &quot;I'm not surprised.&quot;  You've told the clients to connect to 
Squid as a web server.  Squid finds its own IP as the destination, and gives 
up.

&gt;<i> Squid.conf :
</I>&gt;<i> 
</I>&gt;<i> dns_nameservers 8.8.8.8
</I>
I strongly recommend you to set up a local caching name server, and point both 
your clients, and Squid, at it.

&gt;<i> visible_hostname seerver.server
</I>
Have you cut and pasted this configuration file, or (mis-)typed it?

&gt;<i> acl localnet src xxx.0.0/16 xxx.0.0/16 192.168.0.0/16    # RFC1918 possible
</I>&gt;<i> internal network
</I>
You have public IPs on your internal network?

Unusual, but plausible...  I'm just checking to make sure I understand your 
network correctly.

&gt;<i> # Squid normally listens to port 3128
</I>&gt;<i> 
</I>&gt;<i> #http_port 443 intercept
</I>&gt;<i> 
</I>&gt;<i> http_port 10.159.144.206:11611 intercept
</I>
So, the Squid server has a private IP - this makes it all the more unusual 
that you seem to have public IPs on your internal network.

&gt;<i> iptables settings :
</I>&gt;<i> 
</I>&gt;<i> iptables -t nat -A PREROUTING -p tcp -m tcp --dport 80 -j DNAT
</I>&gt;<i> --to-destination 10.159.144.206:11611
</I>
That looks fine for a standard intercept setup.

&gt;<i> any help ?????
</I>
Undo your DNS strangeness and let us know if it starts working.


Regards,


Antony.

-- 
&quot;There is no reason for any individual to have a computer in their home.&quot;

 - Ken Olsen, President of Digital Equipment Corporation (DEC, later consumed 
by Compaq, later merged with HP)

                                                   Please reply to the list;
                                                         please *don't* CC me.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007896.html">[squid-users] squid intercept mode fo http &amp; https
</A></li>
	<LI>Next message (by thread): <A HREF="007898.html">[squid-users] squid intercept mode fo http &amp; https
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7897">[ date ]</a>
              <a href="thread.html#7897">[ thread ]</a>
              <a href="subject.html#7897">[ subject ]</a>
              <a href="author.html#7897">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
