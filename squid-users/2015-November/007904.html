<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] file descriptors leak
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20file%20descriptors%20leak&In-Reply-To=%3C20151122120121.Horde.9rSzFRvRMzh2xQ-uxHeNaff%40webmail.brazcubas.br%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007902.html">
   <LINK REL="Next"  HREF="007905.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] file descriptors leak</H1>
    <B>Andr&#233; Janna</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20file%20descriptors%20leak&In-Reply-To=%3C20151122120121.Horde.9rSzFRvRMzh2xQ-uxHeNaff%40webmail.brazcubas.br%3E"
       TITLE="[squid-users] file descriptors leak">andre61 at brazcubas.br
       </A><BR>
    <I>Sun Nov 22 14:01:21 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007902.html">[squid-users] file descriptors leak
</A></li>
        <LI>Next message (by thread): <A HREF="007905.html">[squid-users] file descriptors leak
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7904">[ date ]</a>
              <a href="thread.html#7904">[ thread ]</a>
              <a href="subject.html#7904">[ subject ]</a>
              <a href="author.html#7904">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>  Citando Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;:

&gt;<i> CONNECT requests with tunnels can be particularly long lived, mobiles
</I>&gt;<i> and their applications stay active for weeks on end with few outward
</I>&gt;<i> signs of what is happening inside the encrypted tunnel. The only way to
</I>&gt;<i> be sure the connection is finished with is when one of the client or
</I>&gt;<i> server remote endpoints closes it.
</I>&gt;<i>
</I>&gt;<i> * The port 55815 connection _was_ closed sometimes within 15 mintes of
</I>&gt;<i> the lsof being run.
</I>&gt;<i>
</I>&gt;<i> * The port 52288 connection is still being used.
</I>&gt;<i>
</I>&gt;<i> Given the timespan between those messages and the lsof, it is also
</I>&gt;<i> possible they were closed and reopened in between. If you have a lot of
</I>&gt;<i> ports in active use, then re-use of closed ones becomes more likely.
</I>&gt;<i> Though I suspect it is just persistence doing what it is designed to do.
</I>&gt;<i> You will need a more detailed trace of the entire time period to know.
</I>
11 more hours have passed since my last &quot;lsof&quot; and cause it's Sunday I'm
sure that no device have been connected to 192.168.x.x network at least for
15 hours.
Right now lsof output is the same as 11 hours before:

squid&#160;&#160;&#160;&#160; 32490&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; proxy&#160;&#160; 12u&#160;&#160;&#160;&#160;
IPv6&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 4065613&#160;&#160;&#160;&#160;&#160; 0t0&#160;&#160;&#160;&#160;&#160;&#160;&#160; TCP
172.16.10.22:3126-&gt;192.168.93.113:55815 (CLOSE_WAIT)
squid&#160;&#160;&#160;&#160; 32490&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; proxy&#160;&#160; 14u&#160;&#160;&#160;&#160;
IPv6&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 4097822&#160;&#160;&#160;&#160;&#160; 0t0&#160;&#160;&#160;&#160;&#160;&#160;&#160; TCP
172.16.10.22:3126-&gt;192.168.90.207:52288 (ESTABLISHED)
...

Squid is still using file descriptors 12 and 14 (and a lot of others) for
the same connections as yesterday, although the mobile devices it was
connected to have not been online in our network for at least 15 hours.
Is it by design?
Raising file descriptors limit is the only solution?
The maximum number of file descriptors in my installation is set to 65535.
Is there any drawback to increasing this number let's say by a factor of
ten?

Regards,
&#160; Andr&#233;
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20151122/362ec520/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20151122/362ec520/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007902.html">[squid-users] file descriptors leak
</A></li>
	<LI>Next message (by thread): <A HREF="007905.html">[squid-users] file descriptors leak
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7904">[ date ]</a>
              <a href="thread.html#7904">[ thread ]</a>
              <a href="subject.html#7904">[ subject ]</a>
              <a href="author.html#7904">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
