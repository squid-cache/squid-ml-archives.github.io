<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid intercept mode fo http &amp; https
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20intercept%20mode%20fo%20http%20%26%20https&In-Reply-To=%3C000d01d12631%242c00fbd0%248402f370%24%40netstream.ps%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007903.html">
   <LINK REL="Next"  HREF="007901.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid intercept mode fo http &amp; https</H1>
    <B>Ahmad Alzaeem</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20intercept%20mode%20fo%20http%20%26%20https&In-Reply-To=%3C000d01d12631%242c00fbd0%248402f370%24%40netstream.ps%3E"
       TITLE="[squid-users] squid intercept mode fo http &amp; https">ahmed.zaeem at netstream.ps
       </A><BR>
    <I>Mon Nov 23 20:54:39 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007903.html">[squid-users] squid intercept mode fo http &amp; https
</A></li>
        <LI>Next message (by thread): <A HREF="007901.html">[squid-users] file descriptors leak
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7918">[ date ]</a>
              <a href="thread.html#7918">[ thread ]</a>
              <a href="subject.html#7918">[ subject ]</a>
              <a href="author.html#7918">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Amos , 
Is it possible to let squid blind to the ds tip and lookup  only  to the domain name in the packet ???

Awaiting ur reply 

Thank you 

-----Original Message-----
From: Ahmad Alzaeem [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ahmed.zaeem at netstream.ps</A>] 
Sent: Sunday, November 22, 2015 9:45 AM
To: 'Amos Jeffries'
Cc: '<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>'
Subject: RE: [squid-users] squid intercept mode fo http &amp; https

Amos , thank you so much for your kind reply  .

The topology is complex and I cant do it like setting up the gateway to be the squid and im forced to work on DNS .

Im just asking is it possible to work on that way with squid ?
Or
Its impossible to have it working ???

I have its werid and not popular , but im forced to do it on that  way .

So  again , can we use like redsocks or any redirector to help me in this issue ?


If squid can work on that way , do I need to add more directives to let it work ?

As I mentioned from logs it stuck and lookup for destination ip  ip :
1448121518.847      0 xx.79.120 TCP_MISS/503 4183 GET <A HREF="http://cnn.com/">http://cnn.com/</A> - ORIGINAL_DST/10.159.144.206 text/html
1448121526.056      0 xx.79.120 TCP_MISS/503 399 HEAD <A HREF="http://cnn.com/">http://cnn.com/</A> - ORIGINAL_DST/10.159.144.206 text/html


so if I was understanding well , I guess squid will work on the domain name not on the ip and I suppose it to work , but so far I don&#8217;t know why !

Thank you amos  again , I appreciate all ur help and the team support help , all of you were and still a nice helpers


cheers

-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Amos Jeffries
Sent: Sunday, November 22, 2015 3:51 AM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] squid intercept mode fo http &amp; https

On 22/11/2015 5:56 a.m., Ahmad Alzaeem wrote:
&gt;<i> Thanks fot your reply .
</I>&gt;<i> 
</I>&gt;<i> I know that my DNS is weird .
</I>&gt;<i> 
</I>&gt;<i> But all I need is
</I>&gt;<i> I have access to DNS server , but I don&#8217;t have access to pcs to give them ip:port in their browsers .
</I>&gt;<i> 
</I>&gt;<i> So yes , im forced to work on that way .
</I>
You should not be. Have a read through
&lt;<A HREF="http://wiki.squid-cache.org/SquidFaq/ConfiguringBrowsers">http://wiki.squid-cache.org/SquidFaq/ConfiguringBrowsers</A>&gt;. Notice that DNS weirdness is not mentioned anywhere, not even as a last-resort method.



&gt;<i> 
</I>&gt;<i> And I want to filter my websites and the only way to go internet is using the proxy .
</I>&gt;<i> 
</I>&gt;<i> So what do you suggest ?
</I>
Try the methods listed in that wiki page for WPAD/PAC auto-configuration (aka &quot;transparent proxy configuration&quot;, notice that is a 3-word phrase).
That will catch a lot of the main-stream browsers.

When that is done set up your routers for *routing* the port 80/443 traffic through the Squid machine. With NAT (aka &quot;transparent interception proxy&quot;, notice that is a different 3-word phrase)

No DNS required in any of that.

&gt;<i> 
</I>&gt;<i> So again , the packet go to squid , but inside this packet the name of websites and ds tip is the proxy ip.
</I>
Exactly. That is all Squid is given to work with.

&gt;<i> 
</I>&gt;<i> What settings needed on squid to operate such as get the info from name and skip dst ip ?
</I>&gt;<i> 
</I>&gt;<i>  If u look @ the log files u will understand my idea
</I>&gt;<i> 
</I>
We already understand your idea. Others have had it before. The reason it is not popular is the extremely complicated nature of the multiple pieces of high performance high-uptime hardware required just to keep it from falling over and/or hitting the side effects you have seen so far, and many others you have not even got close to reaching yet. When things go wrong the clients also need an individual reset to clear their internal DNS caches.

Route packets to Squid (no DNS) just like normally routed packets if Squid were a border gateway, then NAT or TPROXY intercept into the proxy itself on the same machine. FAR more robust.

Amos

_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007903.html">[squid-users] squid intercept mode fo http &amp; https
</A></li>
	<LI>Next message (by thread): <A HREF="007901.html">[squid-users] file descriptors leak
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7918">[ date ]</a>
              <a href="thread.html#7918">[ thread ]</a>
              <a href="subject.html#7918">[ subject ]</a>
              <a href="author.html#7918">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
