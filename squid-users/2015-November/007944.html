<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TCP-MISS 503 for wrong destination ip
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP-MISS%20503%20for%20wrong%20destination%20ip&In-Reply-To=%3C000101d126bc%24654edf70%242fec9e50%24%40netstream.ps%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007943.html">
   <LINK REL="Next"  HREF="007945.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TCP-MISS 503 for wrong destination ip</H1>
    <B>Ahmad Alzaeem</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP-MISS%20503%20for%20wrong%20destination%20ip&In-Reply-To=%3C000101d126bc%24654edf70%242fec9e50%24%40netstream.ps%3E"
       TITLE="[squid-users] TCP-MISS 503 for wrong destination ip">ahmed.zaeem at netstream.ps
       </A><BR>
    <I>Tue Nov 24 13:31:15 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007943.html">[squid-users] TCP-MISS 503 for wrong destination ip
</A></li>
        <LI>Next message (by thread): <A HREF="007945.html">[squid-users] TCP-MISS 503 for wrong destination ip
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7944">[ date ]</a>
              <a href="thread.html#7944">[ thread ]</a>
              <a href="subject.html#7944">[ subject ]</a>
              <a href="author.html#7944">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ok 


1. Have you fixed DNS so that clients are now resolving the correct addresses for destination servers?
No , the issues will not be solved and will always dns resolve the ip of websites to the ip address of squid ( http &amp; https requestst with the wrong ds tip will hit squid)

Again , I want to solve this issue form squid

2. Are you performing NAT *only* on the machine where Squid is running?


Yes I have redirect rules  that redirect the http &amp; https to the port that squid listen  .
So I have :
http_port 3128
http_port 10.159.144.206:11611 intercept

iptables :

ptables &#8211;t nat -A PREROUTING -p tcp -m tcp --dport 80 -j DNAT --to-destination 10.159.144.206:11611
ptables &#8211;t nat -A PREROUTING -p tcp -m tcp --dport 443 -j DNAT --to-destination 10.159.144.206:11611


Do you know where that IP address comes from?  Is your DNS still broken, is this the IP address of the Squid server, does it mean anythign at all in your network?

Some ips are locally and some ips are  outside  , so we have port forwarding well

For now , skip the outside users and focous in the inside users
The dns is separated server differ than squid , but both on same network 

The DNS is not broken , it will resolve some websites to ip address of squid and other websites will rslve to other ip , so again I don&#8217;t want to touch the DNS and I want to work on the current state

&gt;<i> So how to let squid bypass checking it ?
</I>
It's not a matter of bypassing Squid checking it - it's a matter of making it correct so that the checks do not fail.

Im open to let squid do it and let wrong dstp ips  forwarded well on squid .


&gt;<i> Is my way above wrong ?
</I>
I think so, but please answer the questions above so we can be more sure.

&gt;<i> U say we need proxy mode ??
</I>&gt;<i> 
</I>&gt;<i> How should I implement proxy mode since user will not put ip:port in 
</I>&gt;<i> his browser
</I>
Use DHCP options and/or WPAD.

Assume ips are static ips on clients




Thanks again and im awaiting ur suggestions

cheers



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007943.html">[squid-users] TCP-MISS 503 for wrong destination ip
</A></li>
	<LI>Next message (by thread): <A HREF="007945.html">[squid-users] TCP-MISS 503 for wrong destination ip
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7944">[ date ]</a>
              <a href="thread.html#7944">[ thread ]</a>
              <a href="subject.html#7944">[ subject ]</a>
              <a href="author.html#7944">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
