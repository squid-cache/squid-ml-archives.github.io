<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Duplicate Headers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Duplicate%20Headers&In-Reply-To=%3C5654EECC.2010203%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007953.html">
   <LINK REL="Next"  HREF="007956.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Duplicate Headers</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Duplicate%20Headers&In-Reply-To=%3C5654EECC.2010203%40treenet.co.nz%3E"
       TITLE="[squid-users] Duplicate Headers">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Nov 24 23:12:12 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007953.html">[squid-users] Duplicate Headers
</A></li>
        <LI>Next message (by thread): <A HREF="007956.html">[squid-users] 2 way SSL on a non standard SSL Port
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7957">[ date ]</a>
              <a href="thread.html#7957">[ thread ]</a>
              <a href="subject.html#7957">[ subject ]</a>
              <a href="author.html#7957">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 25/11/2015 6:58 a.m., Benjamin Reed wrote:
&gt;<i> Any idea how my X-Cache, X-Cache-Lookup, and Via: headers are getting
</I>&gt;<i> messed up on my accelerator configuration?
</I>&gt;<i>
</I>&gt;<i> Here's the output from a sample HEAD request:
</I>&gt;<i>
</I>&gt;<i>
</I><A HREF="http://paste.opennms.eu/?26c282e7abba631e#oqU/8pAmAUXHhMXPHhr9vWjJAA1FVcgn49W5BWO1vIs=">http://paste.opennms.eu/?26c282e7abba631e#oqU/8pAmAUXHhMXPHhr9vWjJAA1FVcgn49W5BWO1vIs=</A>
&gt;<i>
</I>
This is a forwarding loop of a slightly unusual kind:

When Squid received the request, it asked its peers who had ability to
reach the object. They all did (X-Cache-Lookup: HIT...), so it picked
the first responder and sent the request there.
Unfortunately the first responder was just another mirror, so when it
received that request ... it does exactly the same thing.

If any mirror sees itself as listed in the Via header it will reject the
request with fowarding loop error, and the mirror that sent the request
to it will move on to the next possible destination for it.

Eventually the origin will be reached. But possibly after having gone
through all mirrors or some large portion of them.


&gt;<i> The 4 systems are set up as cache peers to each other, with a parent
</I>&gt;<i> host that contains all the upstream content.
</I>
Instead of &quot;cache_peer_access X allow all&quot; use:
  cache_peer_access X allow !mirrors

That will ensure that mirrors go to the origin for any request that was
received from another mirror. Mirrors will still be available as
alternative sources for clients sent requests.


PS. you can also remove the &quot;cache allow all&quot; line. It does nothing.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007953.html">[squid-users] Duplicate Headers
</A></li>
	<LI>Next message (by thread): <A HREF="007956.html">[squid-users] 2 way SSL on a non standard SSL Port
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7957">[ date ]</a>
              <a href="thread.html#7957">[ thread ]</a>
              <a href="subject.html#7957">[ subject ]</a>
              <a href="author.html#7957">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
