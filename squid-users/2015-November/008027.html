<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid memory leak on ubuntu 14.04
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20memory%20leak%20on%20ubuntu%2014.04&In-Reply-To=%3C565BC47E.6070408%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008025.html">
   <LINK REL="Next"  HREF="008031.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid memory leak on ubuntu 14.04</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20memory%20leak%20on%20ubuntu%2014.04&In-Reply-To=%3C565BC47E.6070408%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid memory leak on ubuntu 14.04">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Nov 30 03:37:34 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008025.html">[squid-users] Squid memory leak on ubuntu 14.04
</A></li>
        <LI>Next message (by thread): <A HREF="008031.html">[squid-users] Squid memory leak on ubuntu 14.04
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8027">[ date ]</a>
              <a href="thread.html#8027">[ thread ]</a>
              <a href="subject.html#8027">[ subject ]</a>
              <a href="author.html#8027">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 30/11/2015 3:19 p.m., &#39118;&#22768; wrote:
&gt;<i> I try to use jemalloc, but from monitoring, there is no difference,
</I>&gt;<i> 
</I>&gt;<i> I follow this guide:
</I>&gt;<i> <A HREF="https://github.com/jemalloc/jemalloc/wiki/Getting-Started">https://github.com/jemalloc/jemalloc/wiki/Getting-Started</A>
</I>&gt;<i> 
</I>&gt;<i> I used LD_PRELOAD to let squid use jemalloc.
</I>&gt;<i> 
</I>&gt;<i> is there something wrong ?
</I>&gt;<i> 
</I>&gt;<i> If I want to re-compile squid with jemalloc, how can i do that ? Can I just
</I>&gt;<i> use some FLAGS ?
</I>&gt;<i> 
</I>
A number of build variables can be set on the command line to
./configure.  See the end of the &quot;./configure --help&quot; for the ones your
Squid supports.

But, hold up a minute there.

You have provided all sorts of snapshots of what the system thinks
memory usage is. But not told us anything about what values you expect
to see there, or what the machine has available. Just a blank statement
that its &quot;high&quot;.

I see that the *entire machine* is using ~8GB of RAM. For those of us
managing machines with 32-128 GB of RAM thats actually pretty low. For
machines with only a few hundred MB of RAM plugged in thats impossible
numbers. So please provide some context about the machiens limits.


Also, be aware that &quot;Virtual Memory&quot; is just that *virtual*. It is not
real in-use memory. Whenever fork() is usesd to spawn a child helper or
pworker process the current memory value of the parent process is
assigned to the child - regardless of whether it needs or uses it.
Effectively doubling the &quot;Virtual Memory&quot; numbers with every helper
started, even when the helper uses only a few KB.


I see from the netstat output that you have ~6318 sockets currently in
play. Thats up to ~1.6 GB of RAM just for connection buffering right there.

Then whatever the cache requirements are. Reaching several GB of RAM in
actual usage is pretty easy.

Then only after that is all added together multiply by however many
dozen or hundred helpers are being run, and thats what the virtual
memory numbers can say Squid is &quot;using&quot;. Though in reality it is not
even close.

Amos



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008025.html">[squid-users] Squid memory leak on ubuntu 14.04
</A></li>
	<LI>Next message (by thread): <A HREF="008031.html">[squid-users] Squid memory leak on ubuntu 14.04
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8027">[ date ]</a>
              <a href="thread.html#8027">[ thread ]</a>
              <a href="subject.html#8027">[ subject ]</a>
              <a href="author.html#8027">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
