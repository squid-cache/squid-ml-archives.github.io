<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] 2 way SSL on a non standard SSL Port
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%202%20way%20SSL%20on%20a%20non%20standard%20SSL%20Port&In-Reply-To=%3CCAMxDymf8xXhm1p7TXy6XhZ98--XmtmuqhQvaFY9RX2NFmfJOWw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008051.html">
   <LINK REL="Next"  HREF="008039.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] 2 way SSL on a non standard SSL Port</H1>
    <B>Bart Spedden</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%202%20way%20SSL%20on%20a%20non%20standard%20SSL%20Port&In-Reply-To=%3CCAMxDymf8xXhm1p7TXy6XhZ98--XmtmuqhQvaFY9RX2NFmfJOWw%40mail.gmail.com%3E"
       TITLE="[squid-users] 2 way SSL on a non standard SSL Port">bart.spedden at 3sharecorp.com
       </A><BR>
    <I>Mon Nov 30 23:37:39 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008051.html">[squid-users] 2 way SSL on a non standard SSL Port
</A></li>
        <LI>Next message (by thread): <A HREF="008039.html">[squid-users] 2 way SSL on a non standard SSL Port
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8062">[ date ]</a>
              <a href="thread.html#8062">[ thread ]</a>
              <a href="subject.html#8062">[ subject ]</a>
              <a href="author.html#8062">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Good idea Anthony.

Here's what I found.

On the squid server when I use the following command to monitor a call to
<A HREF="https://www.google.com">https://www.google.com</A>

tcpdump -i eth0 -vv 'port 443'

I get the following:

17:32:56.373772 IP (tos 0x0, ttl 64, id 33502, offset 0, flags [DF], proto
TCP (6), length 60)

    d6uxpci.lq.com.46591 &gt; qh-in-f104.1e100.net.https: Flags [S], cksum
0x62f0 (correct), seq 3198653455, win 14600, options [mss 1460,sackOK,TS
val 530978513 ecr 0,nop,wscale 7], length 0

17:32:56.390214 IP (tos 0x0, ttl 42, id 42485, offset 0, flags [none],
proto TCP (6), length 60)

    qh-in-f104.1e100.net.https &gt; d6uxpci.lq.com.46591: Flags [S.], cksum
0x40d0 (correct), seq 558417168, ack 3198653456, win 42540, options [mss
1380,nop,nop,TS val 953915655 ecr 530978513,nop,wscale 7], length 0

17:32:56.390423 IP (tos 0x0, ttl 64, id 33503, offset 0, flags [DF], proto
TCP (6), length 52)

    d6uxpci.lq.com.46591 &gt; qh-in-f104.1e100.net.https: Flags [.], cksum
0x11f5 (correct), seq 1, ack 1, win 115, options [nop,nop,TS val 530978529
ecr 953915655], length 0

17:32:56.605977 IP (tos 0x0, ttl 64, id 33504, offset 0, flags [DF], proto
TCP (6), length 329)

    d6uxpci.lq.com.46591 &gt; qh-in-f104.1e100.net.https: Flags [P.], cksum
0x6c5a (incorrect -&gt; 0xc57a), seq 1:278, ack 1, win 115, options
[nop,nop,TS val 530978745 ecr 953915655], length 277

17:32:56.622191 IP (tos 0x0, ttl 42, id 42578, offset 0, flags [none],
proto TCP (6), length 52)

    qh-in-f104.1e100.net.https &gt; d6uxpci.lq.com.46591: Flags [.], cksum
0x0e3e (correct), seq 1, ack 278, win 341, options [nop,nop,TS val
953915887 ecr 530978745], length 0

but when I monitor on the non-stand https port (8184) that I'm trying to
connect to I do not see any traffic at all.  So this leads me to believe
that squid is not actually trying to make the call on the client's behalf.

So I'm feeling a bit lost.

I've upgraded to 3.5.11.

The only change I made to the default /etc/squid/squid.conf is to add the
two non stand https ports that I need to connect to via:

acl SSL_ports port 443 8184 8185

Is there anyway to get more logging out of squid?  I tried adding
debug_option ALL to the squid.conf but didn't see any more logging.

On Mon, Nov 30, 2015 at 10:59 AM, Antony Stone &lt;
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">Antony.Stone at squid.open.source.it</A>&gt; wrote:

&gt;<i> On Monday 30 November 2015 at 18:53:54, Bart Spedden wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; I can successfully connect as long as I don't use squid for either 1 way
</I>&gt;<i> or
</I>&gt;<i> &gt; 2 way TLS connections. I've also successfully connect via curl. So, I
</I>&gt;<i> feel
</I>&gt;<i> &gt; like the site's certs are working well. I could be totally off base here
</I>&gt;<i> &gt; but my interpretation of the the 503 (service unavailable) is that squid
</I>&gt;<i> is
</I>&gt;<i> &gt; timing out on tls handshake? But what is weird is that when using squid I
</I>&gt;<i> &gt; can successfully connect to google using https. So, that is what makes me
</I>&gt;<i> &gt; wonder if it has something to do with the non-standard https port?
</I>&gt;<i>
</I>&gt;<i> If it's a timeout, you should be able to see this with a standard
</I>&gt;<i> wireshark /
</I>&gt;<i> tcpdump packet capture (no SSL inspection necessary) on your
</I>&gt;<i> external-facing
</I>&gt;<i> router (or anywhere else which is a common path both when going direct from
</I>&gt;<i> the client, and via Squid).
</I>&gt;<i>
</I>&gt;<i> Comparing the two (even though you can't decode the content of the packets)
</I>&gt;<i> may well give a clue as to what's going on differently between the two
</I>&gt;<i> types of
</I>&gt;<i> connection.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Antony.
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Users don't know what they want until they see what they get.
</I>&gt;<i>
</I>&gt;<i>                                                    Please reply to the
</I>&gt;<i> list;
</I>&gt;<i>                                                          please *don't* CC
</I>&gt;<i> me.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>


-- 
Bart Spedden  |  Senior Developer
+1.720.210.7041  |
*<A HREF="https://lists.squid-cache.org/listinfo/squid-users">bart.spedden at 3sharecorp.com</A> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">bart.spedden at 3sharecorp.com</A>&gt;*
3 | S H A R E  |  Adobe Digital Marketing Experts  |  An Adobe&#174;  Business
Plus Level Solution PartnerConsulting  |  Training  |  Remote Operations
Management
&lt;<A HREF="http://www.3sharecorp.com/en/services/rom.html">http://www.3sharecorp.com/en/services/rom.html</A>&gt;
&lt;<A HREF="http://www.3sharecorp.com/en/services/rom.html">http://www.3sharecorp.com/en/services/rom.html</A>&gt;
&lt;<A HREF="http://www.3sharecorp.com/en/services/rom.html">http://www.3sharecorp.com/en/services/rom.html</A>&gt;
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20151130/2d2a87f0/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20151130/2d2a87f0/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rom-email-sig4_600x100.png
Type: image/png
Size: 16361 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20151130/2d2a87f0/attachment.png">http://lists.squid-cache.org/pipermail/squid-users/attachments/20151130/2d2a87f0/attachment.png</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008051.html">[squid-users] 2 way SSL on a non standard SSL Port
</A></li>
	<LI>Next message (by thread): <A HREF="008039.html">[squid-users] 2 way SSL on a non standard SSL Port
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8062">[ date ]</a>
              <a href="thread.html#8062">[ thread ]</a>
              <a href="subject.html#8062">[ subject ]</a>
              <a href="author.html#8062">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
