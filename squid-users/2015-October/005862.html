<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Ssl-Bump and revoked server certificates
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Ssl-Bump%20and%20revoked%20server%20certificates&In-Reply-To=%3C561448A0.6010009%40trimble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005845.html">
   <LINK REL="Next"  HREF="005864.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Ssl-Bump and revoked server certificates</H1>
    <B>Jason Haar</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Ssl-Bump%20and%20revoked%20server%20certificates&In-Reply-To=%3C561448A0.6010009%40trimble.com%3E"
       TITLE="[squid-users] Ssl-Bump and revoked server certificates">Jason_Haar at trimble.com
       </A><BR>
    <I>Tue Oct  6 22:18:08 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005845.html">[squid-users] Ssl-Bump and revoked server certificates
</A></li>
        <LI>Next message (by thread): <A HREF="005864.html">[squid-users] Ssl-Bump and revoked server certificates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5862">[ date ]</a>
              <a href="thread.html#5862">[ thread ]</a>
              <a href="subject.html#5862">[ subject ]</a>
              <a href="author.html#5862">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 06/10/15 23:21, Walter H. wrote:
&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> can you please provide an example of how to use this in squid.conf
</I>
#create external acl checker that returns &quot;ERR&quot; or &quot;OK&quot; based on cert
data sent to it
external_acl_type checkIfHTTPS children-max=20 concurrency=20
negative_ttl=3600 ttl=3600 grace=90  %SRC %DST %PORT %ssl::&gt;sni
/usr/local/bin/confirm_https.pl
acl is_ssl external checkIfHTTPS

#only bump SSL transactions that return &quot;OK&quot;
ssl_bump bump is_ssl


Then the script is passed srcIP, dstHostname|dstIP (depends on whether
this is a CONNECT or transparent proxy), port (probably 443) and the SNI
value (if present)

My script does a bunch of checks, and now includes downloading the
server cert, scraping it for CRL data, downloads the CRL file and
compares the cert's serial number against that CRL - hence discovering
if it's revoked or not

The script can differentiate between non-SSL, SSL, HTTPS and
HTTPS-to-whitelisted-sites,HTTPS-with-self-signed,
HTTPS-with-untrusted-CA, HTTPS-with-client-cert, HTTPS-with-CRL-check -
in all these &quot;failure&quot; cases it returns &quot;ERR&quot; - which causes squid to
NOT bump the connection and instead splice it. End result is squid only
bumps sessions it can successfully and safely bump, and applications
like Gtalk, Skype, and regex-whitelisted sites work  without human
intervention - leaving only cert pinning as the only manual process
(because these cannot be detected - only the application &quot;knows&quot; if it's
pinned)



-- 
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005845.html">[squid-users] Ssl-Bump and revoked server certificates
</A></li>
	<LI>Next message (by thread): <A HREF="005864.html">[squid-users] Ssl-Bump and revoked server certificates
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5862">[ date ]</a>
              <a href="thread.html#5862">[ thread ]</a>
              <a href="subject.html#5862">[ subject ]</a>
              <a href="author.html#5862">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
