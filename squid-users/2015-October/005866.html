<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ICAP and HTTPS
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ICAP%20and%20HTTPS&In-Reply-To=%3C561472E4.5010101%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005863.html">
   <LINK REL="Next"  HREF="005856.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ICAP and HTTPS</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ICAP%20and%20HTTPS&In-Reply-To=%3C561472E4.5010101%40measurement-factory.com%3E"
       TITLE="[squid-users] ICAP and HTTPS">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Oct  7 01:18:28 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005863.html">[squid-users] ICAP and HTTPS
</A></li>
        <LI>Next message (by thread): <A HREF="005856.html">[squid-users] authentication setup for squid-internal-mgr
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5866">[ date ]</a>
              <a href="thread.html#5866">[ thread ]</a>
              <a href="subject.html#5866">[ subject ]</a>
              <a href="author.html#5866">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/06/2015 06:50 PM, Marcus Kool wrote:
&gt;<i> The 2b) option a.k.a &quot;simply always allow the CONNECT www.example.com and
</I>&gt;<i> later block GET <A HREF="https://www.example.com/index.html">https://www.example.com/index.html</A>&quot; _only_ works for
</I>&gt;<i> correctly SSL-bumped sites and does not work sites that do not use
</I>&gt;<i> SSL+HTTP.
</I>
If you want the user to see a non-browser error message, then _all_ of
those options require bumping, SSL, and HTTP (all three!). They only
differ in where the error message originates (Squid, ICAP, or eCAP) and
the associated development effort (if any).


&gt;<i> For Skype, SSH tunnels and other protocols that also use CONNECT
</I>&gt;<i> the ICAP server must block the CONNECT (if configured to do so).
</I>&gt;<i> There are even sites that use SSL+other protocol, so bumping such site may
</I>&gt;<i> initially seem OK since the SSL handshake was done without problems,
</I>&gt;<i> but since it is not followed by an HTTP protocol request, the ICAP server
</I>&gt;<i> will never see a followup HTTP GET/POST and hence will never be able to
</I>&gt;<i> block the site after it allowed the CONNECT.
</I>
A bumping Squid will essentially block the site in such cases though
(subject to on_unsupported_protocol controls in recent Squids).


&gt;<i> So if the site must be blocked, the ICAP server must already decide what
</I>&gt;<i> to do when it receives a CONNECT request:
</I>&gt;<i> a) guess that the CONNECT is for SSL+HTTP, pass the CONNECT and wait for
</I>&gt;<i> the followup GET/POST to be blocked, or
</I>&gt;<i> b) guess that the CONNECT is for a site that does not use SSL+HTTP and
</I>&gt;<i> block the CONNECT.
</I>
Recent Squids also have options for detecting non-HTTP and non-SSL
traffic (see the on_unsupported_protocol directive in squid.conf).


&gt;<i> Because of the above, I had a discussion a long time ago with the Squid
</I>&gt;<i> developers
</I>&gt;<i> to extend Squid to send the (non-HTTP) content to the ICAP server in case
</I>&gt;<i> that the CONNECT tunnel does not have SSL+HTTP, but the implementation
</I>&gt;<i> effort was considered to be too much at that time.
</I>
What do you mean? Too much implementation effort to implement quickly?
... to implement for free? ... to implement in the next release?
Something else?

In general, improvements in Squid's non-SSL and non-HTTP content
handling should be welcomed and adaptation services may be used for that
IMO, especially when it comes to custom error generation.


Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005863.html">[squid-users] ICAP and HTTPS
</A></li>
	<LI>Next message (by thread): <A HREF="005856.html">[squid-users] authentication setup for squid-internal-mgr
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5866">[ date ]</a>
              <a href="thread.html#5866">[ thread ]</a>
              <a href="subject.html#5866">[ subject ]</a>
              <a href="author.html#5866">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
