<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Peek And Splice memory leak
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Peek%20And%20Splice%20memory%20leak&In-Reply-To=%3C5614A25B.8050706%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005847.html">
   <LINK REL="Next"  HREF="005818.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Peek And Splice memory leak</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Peek%20And%20Splice%20memory%20leak&In-Reply-To=%3C5614A25B.8050706%40treenet.co.nz%3E"
       TITLE="[squid-users] Peek And Splice memory leak">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Oct  7 04:40:59 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005847.html">[squid-users] Peek And Splice memory leak
</A></li>
        <LI>Next message (by thread): <A HREF="005818.html">[squid-users] Squid 3.5 for Windows and AD authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5870">[ date ]</a>
              <a href="thread.html#5870">[ thread ]</a>
              <a href="subject.html#5870">[ subject ]</a>
              <a href="author.html#5870">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 3/10/2015 1:47 a.m., &#1040;&#1083;&#1077;&#1082;&#1089;&#1072;&#1085;&#1076;&#1088; &#1044;&#1077;&#1084;&#1095;&#1077;&#1085;&#1082;&#1086; wrote:
&gt;<i> Hello!
</I>&gt;<i> It's looks like I have memory leak on squid with peek and splice https
</I>&gt;<i> traffic.
</I>&gt;<i> I use squid 3.5.9 (try 3.5.8 and 3.5.7 also). Openssl and libresll both
</I>&gt;<i> tried.
</I>&gt;<i> CentOs 7. Traffic redirecting transparently by wccp.
</I>&gt;<i> Server: 8 cores, 64GB RAM. Approx 600 clients with 150 requests per second.
</I>&gt;<i> 
</I>&gt;<i> Squid consume RAM without limits. Around 10MB in a second. (Screenshot from
</I>&gt;<i> zabbix: <A HREF="http://snag.gy/HQmJI.jpg">http://snag.gy/HQmJI.jpg</A>)
</I>
We have had a few reports of beaviour similar to this with SSL-Bump.
Those turned out to be the fact that SSL contexts and sessions have a
huge amount of memory state associated with them that does not get
released for the lifetime of the connection. Also contexts are not
shared between workers, so in your config there will be 6x the memory
use for contexts.

Please check if the memory goes down when all connections to the proxy
are closed. Or if there is some (possibly many GB) amount where it
levels off.

If you still think its a leak after checking that, please try to locate
a build with valgrind support. The bugzilla report will need the output
from a run with valgrind.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005847.html">[squid-users] Peek And Splice memory leak
</A></li>
	<LI>Next message (by thread): <A HREF="005818.html">[squid-users] Squid 3.5 for Windows and AD authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5870">[ date ]</a>
              <a href="thread.html#5870">[ thread ]</a>
              <a href="subject.html#5870">[ subject ]</a>
              <a href="author.html#5870">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
