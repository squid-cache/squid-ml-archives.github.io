<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] acl Question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20acl%20Question&In-Reply-To=%3C561CAF77.2090107%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005934.html">
   <LINK REL="Next"  HREF="005939.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] acl Question</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20acl%20Question&In-Reply-To=%3C561CAF77.2090107%40treenet.co.nz%3E"
       TITLE="[squid-users] acl Question">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Oct 13 07:15:03 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005934.html">[squid-users] acl Question
</A></li>
        <LI>Next message (by thread): <A HREF="005939.html">[squid-users] SQUID: cache_dir filling up and squid imploding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5935">[ date ]</a>
              <a href="thread.html#5935">[ thread ]</a>
              <a href="subject.html#5935">[ subject ]</a>
              <a href="author.html#5935">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 13/10/2015 12:19 p.m., joe wrote:
&gt;<i> ok again i filter out most of the squid conf  with this minimum config should
</I>&gt;<i> i get any static img or anything as hit or not
</I>&gt;<i> caus i dont get any  
</I>&gt;<i>  i test on squid 3.5.8 and up same think
</I>
Please continue to use that later version. In absence of any other
useful information about yoru Squid or what it supposed to be doing the
below response assumes you are using 3.5.8.

Please do supply a description of how your Squid is _supposed_ to be
used. And any access policies you are expecting to be enforced by the proxy.


&gt;<i> 
</I>&gt;<i> via off
</I>&gt;<i> forwarded_for off
</I>&gt;<i> 
</I>&gt;<i> # should be allowed
</I>&gt;<i> acl localnet src 10.2.3.0/24
</I>&gt;<i> acl localnet src 10.2.2.0/24
</I>&gt;<i> acl localnet src 10.3.2.0/24
</I>&gt;<i> acl localnet src 10.4.4.0/24
</I>&gt;<i> 
</I>&gt;<i> #http_access deny all
</I>&gt;<i> acl SSL_ports port 443
</I>&gt;<i> acl Safe_ports port 80		# http
</I>&gt;<i> acl Safe_ports port 21		# ftp
</I>&gt;<i> acl Safe_ports port 443		# https
</I>&gt;<i> acl Safe_ports port 70		# gopher
</I>&gt;<i> acl Safe_ports port 210		# wais
</I>&gt;<i> acl Safe_ports port 1025-65535	# unregistered ports
</I>&gt;<i> acl Safe_ports port 280		# http-mgmt
</I>&gt;<i> acl Safe_ports port 488		# gss-http
</I>&gt;<i> acl Safe_ports port 591		# filemaker
</I>&gt;<i> acl Safe_ports port 777		# multiling http
</I>&gt;<i> acl CONNECT method CONNECT
</I>&gt;<i> 
</I>&gt;<i> # STOREID ACCESS LIST 
</I>&gt;<i> acl domaincache dstdomain .dailymotion.com
</I>&gt;<i> 
</I>&gt;<i> cache allow domaincache
</I>
This rule allows URLs within the *.dailymotion.com domains to be cached.
The implicit followup prevents any others from being stored.

To let everything be cached properly, just remove the above &quot;cache
allow&quot; rule.


&gt;<i> http_access deny !Safe_ports
</I>&gt;<i> # Deny CONNECT to other than secure SSL ports
</I>&gt;<i> http_access deny CONNECT !SSL_ports
</I>&gt;<i> http_access allow localhost
</I>&gt;<i> http_access allow localnet
</I>&gt;<i> http_access allow manager
</I>
Allowing anyone who can access the proxy to view the proxy management
reports and controls.


&gt;<i> # And finally deny all other access to this proxy
</I>&gt;<i> http_access allow all
</I>
&quot;allow all&quot; does not deny anything. You have an &quot;open proxy&quot;.
&lt;<A HREF="https://en.wikipedia.org/wiki/Open_proxy">https://en.wikipedia.org/wiki/Open_proxy</A>&gt;

&gt;<i> 
</I>&gt;<i> http_port 8079 
</I>&gt;<i> http_port 8080 accel vhost allow-direct
</I>
What do you think this is doing?


&gt;<i> 
</I>&gt;<i> store_dir_select_algorithm least-load
</I>&gt;<i> cache_dir aufs /mnt/sdb 500000 26 256
</I>&gt;<i> cache_dir aufs /mnt/sdc 500000 26 256
</I>&gt;<i> 
</I>&gt;<i> memory_pools off
</I>&gt;<i> memory_pools_limit 4 GB
</I>
You disabled memory pools. No need to set a limit for it.

&gt;<i> cache_mem 5 GB
</I>&gt;<i> #maximum_object_size_in_memory 64 KB
</I>&gt;<i> maximum_object_size_in_memory 2048 KB
</I>
Meaning you can store 2 of the big objects in memory. The rest has to be
on disk.

This can cause major latency problems when Squid has to export up to 1
million small (1KB+) objects out of memory for one of these big objects.

Then when the big object expires it happens all over again, as up to 1
million small objects get loaded back from back from disk or network.


&gt;<i> minimum_object_size 1 KB 
</I>&gt;<i> maximum_object_size 3 GB
</I>&gt;<i> cache_swap_low 98
</I>&gt;<i> cache_swap_high 99
</I>&gt;<i> logfile_rotate 0
</I>&gt;<i> cache_store_log none
</I>
This is a default. You can remove the cache_store_log line entirely.

&gt;<i> access_log daemon:/var/log/squid3/access.log !CONNECT
</I>
You have an open proxy. CONNECT is usually the method used to send abuse
through open proxies. Ignoring it all is a bad idea.

&gt;<i> cache_log /var/log/squid3/cache.log
</I>
This should be a default. You can remove the cache_log line entirely.

&gt;<i> 
</I>&gt;<i> # FILES TYPE
</I>&gt;<i> refresh_pattern -i \.(exe|crx|esd)(\?|\/\?) 10080 100% 799000
</I>&gt;<i> override-expire override-lastmod ignore-reload ignore-no-store
</I>&gt;<i> ignore-private ignore-auth ignore-must-revalidate store-stale
</I>&gt;<i> reload-into-ims
</I>&gt;<i> 
</I>&gt;<i> refresh_pattern -i
</I>&gt;<i> \.(3gp|m1v|ace|web(m|p|a)|m2(v|p)|swf|dat|cup|dvr-ms|ram|avi|mk(a|v)|vob|wm(a|v)|flv|x-flv|JPG)
</I>&gt;<i> 10080 100% 129600 override-expire override-lastmod ignore-reload
</I>&gt;<i> ignore-no-store ignore-private ignore-auth ignore-must-revalidate
</I>&gt;<i> store-stale reload-into-ims
</I>&gt;<i> refresh_pattern -i
</I>&gt;<i> \.(m3u8|jp(e?g|e|2)|gif|pn[pg]|bm?|tiff?|ico|mp(e?g|a|e|1|2|3|4)|deb|ad|f4(f|v)|abst|dll)
</I>&gt;<i> 10080 100% 129600 override-expire override-lastmod ignore-reload
</I>&gt;<i> ignore-no-store ignore-private ignore-auth ignore-must-revalidate
</I>&gt;<i> store-stale reload-into-ims
</I>&gt;<i> refresh_pattern -i
</I>&gt;<i> \.(rar|jar|gz|tgz|bz2|iso|7z|asx|mo(d|v)|arj|lha|lzh|zip|tar|pak|cup|ipa|apk)
</I>&gt;<i> 10080 100% 43800 override-expire override-lastmod ignore-reload
</I>&gt;<i> ignore-no-store ignore-private ignore-auth ignore-must-revalidate
</I>&gt;<i> store-stale
</I>&gt;<i> refresh_pattern -i
</I>&gt;<i> \.(rpm|ac4|bin|ms(i|u|p)|og(x|v|a|g)|rm|r(a|p)m|snd|inc|cod|jad|txt) 10080
</I>&gt;<i> 100% 43800 override-expire override-lastmod ignore-reload ignore-no-store
</I>&gt;<i> ignore-private ignore-auth ignore-must-revalidate store-stale
</I>&gt;<i> refresh_pattern -i
</I>&gt;<i> \.(pp(t?x)|s|t)|pdf|rtf|wax|cab|wmx|wpl|cb(r|z|t)|xl(s?x)|do(c?x)|qt|vpx)
</I>&gt;<i> 10080 100% 43800 override-expire override-lastmod ignore-reload
</I>&gt;<i> ignore-no-store ignore-private ignore-auth ignore-must-revalidate
</I>&gt;<i> store-stale
</I>
These options do nothing useful, and are quite harmful:
 ignore-private ignore-auth ignore-must-revalidate


Since you are running a reverse proxy, claiming to be the CDN operator
for the domain dailmotion.com and others you should also stop screwing
your clients over with &quot;override-expire override-lastmod ignore-reload
ignore-no-store&quot; and get their origin servers fixed instead.


&gt;<i> refresh_pattern -i .(html|htm|css|js|xml)$ 1440 75% 40320
</I>&gt;<i> refresh_pattern -i .index.(html|htm)$ 0 75% 43800
</I>&gt;<i> refresh_pattern ^ftp:		1440	20%	10080
</I>&gt;<i> refresh_pattern ^gopher:	1440	0%	1440
</I>&gt;<i> refresh_pattern -i (/cgi-bin/\?) 0	0%	0
</I>&gt;<i> refresh_pattern .		0	20%	4320
</I>&gt;<i> 
</I>&gt;<i> cache_effective_user proxy
</I>&gt;<i> cache_effective_group proxy
</I>&gt;<i> visible_hostname xcache
</I>&gt;<i> unique_hostname xcache
</I>
&quot;xcache&quot; is not a publicly resolvable domain name. The visible_hostname
should be the CDN hostname used to access your proxy. It *will* be
displayed to visitors.

Please also read the unique_hostname documentation. It is rarely
necessary to use that directive. If you dont need it, remove it.


&gt;<i> dns_nameservers 8.8.8.8 8.8.4.4 4.2.2.4
</I>
So, you are running a CDN to mirror Google hosted websites?


&gt;<i> shutdown_lifetime 10 second
</I>
Many of the lines below are default settings for Squid-3.5. You should
check them and remove the ones that are only setting a default value.

&gt;<i> icp_port 0
</I>&gt;<i> htcp_port 0
</I>&gt;<i> check_hostnames off
</I>&gt;<i> memory_replacement_policy heap GDSF
</I>&gt;<i> cache_replacement_policy heap LFUDA
</I>&gt;<i> forward_timeout 240 seconds
</I>&gt;<i> connect_timeout 60 seconds
</I>&gt;<i> #read_timeout 15 minute
</I>&gt;<i> peer_connect_timeout 30 seconds
</I>&gt;<i> read_timeout 600 second
</I>&gt;<i> request_timeout 60 second
</I>&gt;<i> ipcache_size 16384
</I>&gt;<i> ipcache_low 98
</I>&gt;<i> ipcache_high 99
</I>&gt;<i> ipcache_size 2048
</I>&gt;<i> ipcache_low 98
</I>&gt;<i> ipcache_high 99
</I>&gt;<i> quick_abort_min 0
</I>&gt;<i> quick_abort_max 0
</I>&gt;<i> quick_abort_pct 100
</I>&gt;<i> fqdncache_size 16384
</I>&gt;<i> icp_hit_stale on
</I>&gt;<i> query_icmp off
</I>&gt;<i> strip_query_terms off
</I>&gt;<i> retry_on_error on
</I>&gt;<i> check_hostnames off
</I>&gt;<i> minimum_expiry_time 0 seconds
</I>&gt;<i> positive_dns_ttl 6 hour
</I>&gt;<i> negative_dns_ttl 60 second
</I>&gt;<i> half_closed_clients off
</I>&gt;<i> memory_pools off
</I>&gt;<i> reload_into_ims on
</I>&gt;<i> store_avg_object_size 82 KB
</I>&gt;<i> client_db on
</I>&gt;<i> max_filedescriptors 32768
</I>&gt;<i> # QoS MARKING
</I>&gt;<i> qos_flows local-hit=0x30
</I>&gt;<i> tcp_outgoing_tos 0x30 all
</I>&gt;<i> 
</I>
Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005934.html">[squid-users] acl Question
</A></li>
	<LI>Next message (by thread): <A HREF="005939.html">[squid-users] SQUID: cache_dir filling up and squid imploding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5935">[ date ]</a>
              <a href="thread.html#5935">[ thread ]</a>
              <a href="subject.html#5935">[ subject ]</a>
              <a href="author.html#5935">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
