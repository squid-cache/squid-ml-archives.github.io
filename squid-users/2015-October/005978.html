<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] debug skype ssl_bump numeric ips to be spliced
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20debug%20skype%20ssl_bump%20numeric%20ips%20to%20be%20spliced&In-Reply-To=%3C561F006D.4090100%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005967.html">
   <LINK REL="Next"  HREF="005982.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] debug skype ssl_bump numeric ips to be spliced</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20debug%20skype%20ssl_bump%20numeric%20ips%20to%20be%20spliced&In-Reply-To=%3C561F006D.4090100%40treenet.co.nz%3E"
       TITLE="[squid-users] debug skype ssl_bump numeric ips to be spliced">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Oct 15 01:25:01 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005967.html">[squid-users] debug skype ssl_bump numeric ips to be spliced
</A></li>
        <LI>Next message (by thread): <A HREF="005982.html">[squid-users] debug skype ssl_bump numeric ips to be spliced
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5978">[ date ]</a>
              <a href="thread.html#5978">[ thread ]</a>
              <a href="subject.html#5978">[ subject ]</a>
              <a href="author.html#5978">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 15/10/2015 1:00 a.m., Marko Cupa&#263; wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I read this interesting thread:
</I>&gt;<i> <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Skype-SSL-is-incompatible-with-OpenSSL-td4665803.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Skype-SSL-is-incompatible-with-OpenSSL-td4665803.html</A>
</I>&gt;<i> 
</I>&gt;<i> And from what I read, I'd assume those entries in cache.log ...
</I>&gt;<i> 
</I>&gt;<i> 2015/10/14 13:44:51 kid1| Error negotiating SSL on FD 144: error:14090086:SSL routines:SSL3_GET_SERVER_CERTIFICATE:certificate verify failed (1/-1/0)
</I>&gt;<i> 2015/10/14 13:45:17 kid1| Error negotiating SSL on FD 118: error:14090086:SSL routines:SSL3_GET_SERVER_CERTIFICATE:certificate verify failed (1/-1/0)
</I>&gt;<i> 2015/10/14 13:45:17 kid1| Error negotiating SSL connection on FD 114: error:14094412:SSL routines:SSL3_READ_BYTES:sslv3 alert bad certificate (1/0)
</I>&gt;<i> 
</I>&gt;<i> ... are caused by skype clients, or other clients that use port 443 for
</I>&gt;<i> non-ssl traffic.
</I>
... or they are servers using invalid certificates

.. or they are servers using TLS extensions your library does not
understand how to deal with,

... or they are servers with revoked certificates

... or they are servers using a TSL certificate version your library has
been told not to accept

All those lines imply is a certificate verify problem inside the SSL
library.

Also note that the FD numbers are different, meaning each line is a
completely different TCP connection. The only thing they have in common
is that they are errors.


&gt;<i> 
</I>&gt;<i> My ssl_bump setup is as follows:
</I>&gt;<i> 
</I>&gt;<i> acl splice_ips dst &quot;/usr/local/etc/squid/splice_ips&quot;
</I>&gt;<i> acl step1 at_step SslBump1
</I>&gt;<i> ssl_bump peek step1
</I>&gt;<i> ssl_bump splice splice_ips
</I>&gt;<i> ssl_bump bump all
</I>&gt;<i> 
</I>&gt;<i> Is there a way to increase verbosity of cache.log in a way that I get
</I>&gt;<i> more information about this? I guess I am mostly interested in remote
</I>&gt;<i> IP addresses so I can add them to splice_ips ACL.
</I>
You could use &quot;debug_options 17,3&quot;. It produces a line that may be
prefixed &quot;FwdState::connectDone&quot; on successful server TCP connection
setup just prior to TLS initiation.

Or you could try out Squid-4. Which has automatic bypass for non-HTTPS
traffic and will resolve the confusion over whether it was actually
non-HTTPS or just a broken certificate.


Your logic is based on a flawed assumption though. Squid is a proxy.
Which means its very purpose is to select the best server from a whole
set to provide an answer for the bumped request.

Failure to perform TLS to connect to one server for a domain does not
means all IPs for that domain are bad. Squid will simply try other
alternative IPs or servers until one succeeds or there are no more
usable destinations.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005967.html">[squid-users] debug skype ssl_bump numeric ips to be spliced
</A></li>
	<LI>Next message (by thread): <A HREF="005982.html">[squid-users] debug skype ssl_bump numeric ips to be spliced
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5978">[ date ]</a>
              <a href="thread.html#5978">[ thread ]</a>
              <a href="subject.html#5978">[ subject ]</a>
              <a href="author.html#5978">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
