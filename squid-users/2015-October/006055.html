<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] site http://www.domain.cpu.qc.ca work BUT http://domain.cpu.qc.ca DONT WORK
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20site%20http%3A//www.domain.cpu.qc.ca%20work%20BUT%0A%20http%3A//domain.cpu.qc.ca%20DONT%20WORK&In-Reply-To=%3C5625C4EB.7010307%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006046.html">
   <LINK REL="Next"  HREF="006053.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] site http://www.domain.cpu.qc.ca work BUT http://domain.cpu.qc.ca DONT WORK</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20site%20http%3A//www.domain.cpu.qc.ca%20work%20BUT%0A%20http%3A//domain.cpu.qc.ca%20DONT%20WORK&In-Reply-To=%3C5625C4EB.7010307%40treenet.co.nz%3E"
       TITLE="[squid-users] site http://www.domain.cpu.qc.ca work BUT http://domain.cpu.qc.ca DONT WORK">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Oct 20 04:36:59 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="006046.html">[squid-users] site http://www.domain.cpu.qc.ca work BUT http://domain.cpu.qc.ca DONT WORK
</A></li>
        <LI>Next message (by thread): <A HREF="006053.html">[squid-users] NTLM Authentication Failing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6055">[ date ]</a>
              <a href="thread.html#6055">[ thread ]</a>
              <a href="subject.html#6055">[ subject ]</a>
              <a href="author.html#6055">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 20/10/2015 6:57 a.m., Sebastien.Boulianne wrote:
&gt;<i> If I replace the &quot;acl cpuwebacl dstdomain www.cpu.qc.ca&quot; by &quot;acl cpuwebacl dstdomain cpu.qc.ca&quot;, I got a error 404****
</I>&gt;<i> 
</I>
I think I see where the confusion is coming from. We need to teach you
both how dstdomain and proxying works.

* Lets start with dstdomain.

This line: acl cpuwebacl dstdomain cpu.qc.ca

... matches *only* the <A HREF="http://cpu.qc.ca/">http://cpu.qc.ca/</A> requests.

This line: acl cpuwebacl dstdomain www.cpu.qc.ca

... matches *only* the <A HREF="http://www.cpu.qc.ca/">http://www.cpu.qc.ca/</A> requests.

Because the values in the dstdomain are *exact* domain FQDN.


This line:
  acl cpuwebacl dstdomain .cpu.qc.ca

.. matches any request for cpu.qc.ca *and* for any sub-domain such as
www.cpu.qc.ca, helloworld.cpu.qc.ca, etc.
Because the '.' prefix makes it a wildcard match.


So what you have been doing is switching the ACL from accepting the main
domain FQDN and its www.* subdomain. But not both at once.



* Secondly, proxying.

The purpose of the proxy is to pass on the client request as
transparently as possible. Note that &quot;transparent&quot; here has the literal
meaning of transparency. As in the request received is almost exactly
what gets passed on.

I suspect that TMG did not proxy the requests but interpreted and
translated a request for the main FQDN to www.*, or vice versa. Squid
does not do that. Squid passes the *actual* client request URL to the
origin server and expects that server to be fully aware of the URLs it
is serving up.

If your origin server is broken and cannot handle the real client
requests, there are workarounds. But the best thing is to fix the server
so it will work propery regardless of a proxy being in front. So lets
try that first.

As Anthony mentioned the 404 is coming from the origin. Find out why and
fix it, or if its okay ignore it.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="006046.html">[squid-users] site http://www.domain.cpu.qc.ca work BUT http://domain.cpu.qc.ca DONT WORK
</A></li>
	<LI>Next message (by thread): <A HREF="006053.html">[squid-users] NTLM Authentication Failing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6055">[ date ]</a>
              <a href="thread.html#6055">[ thread ]</a>
              <a href="subject.html#6055">[ subject ]</a>
              <a href="author.html#6055">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
