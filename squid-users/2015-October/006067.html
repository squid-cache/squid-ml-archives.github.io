<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] POST upload splits tcp stream in many small 39byte	sized pakets
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20POST%20upload%20splits%20tcp%20stream%20in%20many%20small%2039byte%0A%09sized%20pakets&In-Reply-To=%3C20151020154947.Horde.MkuPY1Mxju5p8MXnZRANOvZ%40aws-it.at%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006113.html">
   <LINK REL="Next"  HREF="006071.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] POST upload splits tcp stream in many small 39byte	sized pakets</H1>
    <B>Squid admin</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20POST%20upload%20splits%20tcp%20stream%20in%20many%20small%2039byte%0A%09sized%20pakets&In-Reply-To=%3C20151020154947.Horde.MkuPY1Mxju5p8MXnZRANOvZ%40aws-it.at%3E"
       TITLE="[squid-users] POST upload splits tcp stream in many small 39byte	sized pakets">squid at aws-it.at
       </A><BR>
    <I>Tue Oct 20 13:49:47 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="006113.html">[squid-users] auto get latest  release
</A></li>
        <LI>Next message (by thread): <A HREF="006071.html">[squid-users] POST upload splits tcp stream in many small 39byte sized pakets
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6067">[ date ]</a>
              <a href="thread.html#6067">[ thread ]</a>
              <a href="subject.html#6067">[ subject ]</a>
              <a href="author.html#6067">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dear squid team,

first of all thanks for developing such a great product!

Unfortunately on uploading a big test file (unencrypted POST) to  
apache webserver using a squid proxy (V 3.5.10 or 4.0.1) the upstream  
pakets get slized into thousands of small 39 byte sized pakets.

Excerpt from cache.log:

2015/10/20 13:51:08.201 kid1| 5,5| Write.cc(35) Write:  
local=10.1.1.210:46731 remote=10.1.1.19:81 FD 17 flags=1: sz 583:  
asynCall 0x244b670*1
2015/10/20 13:51:08.201 kid1| 5,5| Write.cc(66) HandleWrite:  
local=10.1.1.210:46731 remote=10.1.1.19:81 FD 17 flags=1: off 0, sz 583.
2015/10/20 13:51:08.203 kid1| 5,5| Write.cc(35) Write:  
local=10.1.1.210:46731 remote=10.1.1.19:81 FD 17 flags=1: sz 16422:  
asynCall 0x2447d40*1
2015/10/20 13:51:08.203 kid1| 5,5| Write.cc(66) HandleWrite:  
local=10.1.1.210:46731 remote=10.1.1.19:81 FD 17 flags=1: off 0, sz  
16422.
2015/10/20 13:51:08.204 kid1| 5,5| Write.cc(35) Write:  
local=10.1.1.210:46731 remote=10.1.1.19:81 FD 17 flags=1: sz 39:  
asynCall 0x2448ec0*1
2015/10/20 13:51:08.205 kid1| 5,5| Write.cc(66) HandleWrite:  
local=10.1.1.210:46731 remote=10.1.1.19:81 FD 17 flags=1: off 0, sz 39.
2015/10/20 13:51:08.206 kid1| 5,5| Write.cc(35) Write:  
local=10.1.1.210:46731 remote=10.1.1.19:81 FD 17 flags=1: sz 39:  
asynCall 0x2464bb0*1
2015/10/20 13:51:08.207 kid1| 5,5| Write.cc(66) HandleWrite:  
local=10.1.1.210:46731 remote=10.1.1.19:81 FD 17 flags=1: off 0, sz 39.
2015/10/20 13:51:08.208 kid1| 5,5| Write.cc(35) Write:  
local=10.1.1.210:46731 remote=10.1.1.19:81 FD 17 flags=1: sz 39:  
asynCall 0x2448ec0*1
2015/10/20 13:51:08.209 kid1| 5,5| Write.cc(66) HandleWrite:  
local=10.1.1.210:46731 remote=10.1.1.19:81 FD 17 flags=1: off 0, sz 39.
...



Attached you can find a tar file containing squid configuration,
test network topology, network trace from traffic from client to squid,
network trace from squid to webserver and a full debug log from squid

One incoming paket of size ~ 1500 bytes gets sliced into more as 40 pakets.
On the target webserver the squid upstream traffic therefore looks  
like a DOS attack.

The problem can be reproduced using squid 3.5.x and squid 4.0.x (32bit  
and 64bit variants)
The where no such problems using squid 3.2.x

Hopefully you can help me to fix this problem as this is a showstopper  
for me to upgrade to squid 3.5.x and higher.

Best regards,

Toni

-------------- next part --------------
A non-text attachment was scrubbed...
Name: squid_upload_splits_tcp_traffic_into_39byte_packets.tar.gz
Type: application/x-compressed-tar
Size: 38350 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20151020/b92eb2c0/attachment.bin">http://lists.squid-cache.org/pipermail/squid-users/attachments/20151020/b92eb2c0/attachment.bin</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="006113.html">[squid-users] auto get latest  release
</A></li>
	<LI>Next message (by thread): <A HREF="006071.html">[squid-users] POST upload splits tcp stream in many small 39byte sized pakets
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6067">[ date ]</a>
              <a href="thread.html#6067">[ thread ]</a>
              <a href="subject.html#6067">[ subject ]</a>
              <a href="author.html#6067">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
