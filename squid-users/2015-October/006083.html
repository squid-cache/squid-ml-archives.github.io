<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] NTLM Authentication Failing
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20NTLM%20Authentication%20Failing&In-Reply-To=%3Cafd3d9e5bf0fddb55220989ee12d18b7%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006079.html">
   <LINK REL="Next"  HREF="006114.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] NTLM Authentication Failing</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20NTLM%20Authentication%20Failing&In-Reply-To=%3Cafd3d9e5bf0fddb55220989ee12d18b7%40treenet.co.nz%3E"
       TITLE="[squid-users] NTLM Authentication Failing">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Oct 21 04:17:59 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="006079.html">[squid-users] NTLM Authentication Failing
</A></li>
        <LI>Next message (by thread): <A HREF="006114.html">[squid-users] NTLM Authentication Failing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6083">[ date ]</a>
              <a href="thread.html#6083">[ thread ]</a>
              <a href="subject.html#6083">[ subject ]</a>
              <a href="author.html#6083">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2015-10-21 15:38, Ilias Clifton wrote:
&gt;&gt;<i> 
</I>&gt;&gt;<i> On 20/10/2015 4:04 p.m., Ilias Clifton wrote:
</I>&gt;&gt;<i> &gt; Hi All,
</I>&gt;&gt;<i> &gt; I've been following the guide at this location for Active Directory integration
</I>&gt;&gt;<i> &gt; <A HREF="http://wiki.bitbinary.com/index.php/Active_Directory_Integrated_Squid_Proxy[http://wiki.bitbinary.com/index.php/">http://wiki.bitbinary.com/index.php/Active_Directory_Integrated_Squid_Proxy[http://wiki.bitbinary.com/index.php/</A>&gt;Active_Directory_Integrated_Squid_Proxy]
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; First, some versions for sanity..
</I>&gt;&gt;<i> &gt; Ubuntu : 14.04.3 LTS
</I>&gt;&gt;<i> &gt; Squid : 3.3.8 (from ubuntu repositories)
</I>&gt;&gt;<i> &gt; Samba : 4.1.6-Ubuntu
</I>&gt;&gt;<i> &gt; DC : Windows Server 2012 R2
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; I am currently testing the authentication, negotiate kerberos and basic ldap are
</I>&gt;&gt;<i> &gt; both working correctly. However ntlm is not and I don't seem to making any
</I>&gt;&gt;<i> &gt; progress on debugging further.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Date: Tue, 20 Oct 2015 18:06:17 +1300
</I>&gt;&gt;<i> From: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Your version of Squid has big problems with (4) and some with (2), and
</I>&gt;&gt;<i> your DC server version has big problems with (1) and (3).
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Amos
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Hi Amos,
</I>&gt;<i> 
</I>&gt;<i> Thank you for your detailed answer.
</I>&gt;<i> 
</I>&gt;<i> So what is the best way to authenticate users in a mixed environment?
</I>&gt;<i> I've got Windows domain PCs with IE/firefox/chrome. Linux PCs with
</I>&gt;<i> Firefox/chrome. Windows non-domain joined PCs with IE/firefox/chrome -
</I>&gt;<i> plus various mobile devices.
</I>&gt;<i> 
</I>&gt;<i> I've tried getting rid of ntlm and just using negotiate kerberos and
</I>&gt;<i> ldap for basic, is that all I need?
</I>
I believe thats at least very close to the solution. The getting rid of 
NTLM is something that needs to happen at the client end though, so IE 
does not attempt to use it over Negotiate scheme.


&gt;<i> 
</I>&gt;<i> On the non-domain joined PCs, if I disable 'Enable Integrated Windows
</I>&gt;<i> Authentication', they now correctly use basic ldap.
</I>
And thats the way to do it IIRC. Someone more familiar may know a better 
way.


&gt;<i> 
</I>&gt;<i> My config now looks like..
</I>&gt;<i> 
</I>&gt;<i> ### negotiate kerberos and ntlm authentication
</I>&gt;<i> auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth
</I>&gt;<i> -d -s GSS_C_NO_NAME
</I>&gt;<i> auth_param negotiate children 10
</I>&gt;<i> auth_param negotiate keep_alive off
</I>&gt;<i> 
</I>&gt;<i> ### provide basic authentication via ldap for clients not
</I>&gt;<i> authenticated via kerberos/ntlm
</I>&gt;<i> auth_param basic program /usr/lib/squid3/basic_ldap_auth -R -b
</I>&gt;<i> &quot;DC=domain,DC=local&quot; -D proxyuser at domain.local -W
</I>&gt;<i> /etc/squid3/ldappass.txt -f sAMAccountName=%s -h dc1.domain.local
</I>&gt;<i> auth_param basic children 10
</I>&gt;<i> auth_param basic realm Internet Proxy
</I>&gt;<i> auth_param basic credentialsttl 30 minutes
</I>&gt;<i> 
</I>&gt;<i> ### ldap authorisation
</I>&gt;<i> external_acl_type memberof %LOGIN /usr/lib/squid3/ext_ldap_group_acl
</I>&gt;<i> -R -K -S -b &quot;DC=domain,DC=local&quot; -D proxyuser at domain.local -W
</I>&gt;<i> /etc/squid3/ldappass.txt -f
</I>&gt;<i> &quot;(&amp;(objectclass=person)(sAMAccountName=%v)(memberof=cn=%g,OU=Proxy,DC=domain,DC=local))&quot;
</I>&gt;<i> -h dc1.domain.local
</I>&gt;<i> 
</I>&gt;<i> Does that look ok?
</I>
Looks reasonable for a small installation. If you have a medium to large 
network you may find Squid mentioning queue issues and requesting more 
helper children be configured. Simply increasing the numbers there 
should resolve that.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="006079.html">[squid-users] NTLM Authentication Failing
</A></li>
	<LI>Next message (by thread): <A HREF="006114.html">[squid-users] NTLM Authentication Failing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6083">[ date ]</a>
              <a href="thread.html#6083">[ thread ]</a>
              <a href="subject.html#6083">[ subject ]</a>
              <a href="author.html#6083">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
