<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] R: R:  nonce_garbage_interval problem?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20R%3A%20R%3A%20%20nonce_garbage_interval%20problem%3F&In-Reply-To=%3C875EC9DECC66D547B0E5B4328642CEDBDFC11ED3%40CG003SERVER.camegroup.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006142.html">
   <LINK REL="Next"  HREF="006147.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] R: R:  nonce_garbage_interval problem?</H1>
    <B>Athos Fiolo</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20R%3A%20R%3A%20%20nonce_garbage_interval%20problem%3F&In-Reply-To=%3C875EC9DECC66D547B0E5B4328642CEDBDFC11ED3%40CG003SERVER.camegroup.local%3E"
       TITLE="[squid-users] R: R:  nonce_garbage_interval problem?">afiolo at came.com
       </A><BR>
    <I>Thu Oct 22 14:08:53 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="006142.html">[squid-users] R:  nonce_garbage_interval problem?
</A></li>
        <LI>Next message (by thread): <A HREF="006147.html">[squid-users] nonce_garbage_interval problem?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6145">[ date ]</a>
              <a href="thread.html#6145">[ thread ]</a>
              <a href="subject.html#6145">[ subject ]</a>
              <a href="author.html#6145">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Amos.

&gt;<i> Please check if a helper lookup is being performed on each request as well as new nonce generated.
</I>
I guess you are right, but I don't know how to solve it.
cache.log doesn&#8217;t show restarts for the heelper, even if only 1/5 helper is started.
The output log of the helper shows no caching of the result (see later).
On the contrary, the external type helper shows the result is cached for 30s (correct).


squid.conf
auth_param digest program /usr/bin/php /etc/squid3/check_user.php
auth_param digest children 5
auth_param digest realm MySquidProxy
auth_param digest nonce_garbage_interval 5 minutes
auth_param digest nonce_max_duration 2 hours
auth_param digest nonce_max_count 50

auth_param basic program /usr/lib/squid3/basic_ncsa_auth /etc/squid3/passwd
auth_param basic children 5
auth_param basic realm MySquidProxy
auth_param basic credentialsttl 2 hours
auth_param basic casesensitive off

external_acl_type reqtype_filter ttl=30 children-max=20 %LOGIN %DST %PORT %METHOD %URI %PATH /usr/bin/php /etc/squid3/check_request.php

acl auth_users proxy_auth REQUIRED
acl userx_auth proxy_auth userx
acl auth_reqtype external reqtype_filter
acl to_vpn dst 1.2.3.4/16

[...]
http_access allow userx_auth to_vpn #maybe better post-pone this line to the following one?
http_access allow auth_reqtype auth_users to_vpn


helper log (shows no result caching):
[2015-10-22 13:45:47] OK ha1=&quot;214404311caddffbc1c97d2323eeb123&quot;: &quot;username&quot;:&quot;MySquidProxy&quot;
[2015-10-22 13:45:47] OK ha1=&quot;214404311caddffbc1c97d2323eeb123&quot;: &quot;username&quot;:&quot;MySquidProxy&quot;
[2015-10-22 13:45:53] OK ha1=&quot;214404311caddffbc1c97d2323eeb123&quot;: &quot;username&quot;:&quot;MySquidProxy&quot;
[2015-10-22 13:45:53] OK ha1=&quot;214404311caddffbc1c97d2323eeb123&quot;: &quot;username&quot;:&quot;MySquidProxy&quot;
[2015-10-22 13:45:54] OK ha1=&quot;214404311caddffbc1c97d2323eeb123&quot;: &quot;username&quot;:&quot;MySquidProxy&quot;
[2015-10-22 13:45:54] OK ha1=&quot;214404311caddffbc1c97d2323eeb123&quot;: &quot;username&quot;:&quot;MySquidProxy&quot;
[2015-10-22 13:45:55] OK ha1=&quot;214404311caddffbc1c97d2323eeb123&quot;: &quot;username&quot;:&quot;MySquidProxy&quot;
[2015-10-22 13:45:56] OK ha1=&quot;214404311caddffbc1c97d2323eeb123&quot;: &quot;username&quot;:&quot;MySquidProxy&quot;

External acl type helper log (shows result caching for about 30s):
[2015-10-22 13:46:43] OK: username 1.2.3.4 80 POST <A HREF="http://1.2.3.4/myurl/">http://1.2.3.4/myurl/</A> /myurl/
[2015-10-22 13:47:14] OK: username 1.2.3.4 80 POST <A HREF="http://1.2.3.4/myurl/">http://1.2.3.4/myurl/</A> /myurl/
[2015-10-22 13:47:47] OK: username 1.2.3.4 80 POST <A HREF="http://1.2.3.4/myurl/">http://1.2.3.4/myurl/</A> /myurl/
[2015-10-22 13:48:24] OK: username 1.2.3.4 80 POST <A HREF="http://1.2.3.4/myurl/">http://1.2.3.4/myurl/</A> /myurl/
[2015-10-22 13:48:54] OK: username 1.2.3.4 80 POST <A HREF="http://1.2.3.4/myurl/">http://1.2.3.4/myurl/</A> /myurl/
[2015-10-22 13:49:24] OK: username 1.2.3.4 80 POST <A HREF="http://1.2.3.4/myurl/">http://1.2.3.4/myurl/</A> /myurl/
[2015-10-22 13:49:54] OK: username 1.2.3.4 80 POST <A HREF="http://1.2.3.4/myurl/">http://1.2.3.4/myurl/</A> /myurl/
[2015-10-22 13:50:24] OK: username 1.2.3.4 80 POST <A HREF="http://1.2.3.4/myurl/">http://1.2.3.4/myurl/</A> /myurl/
[2015-10-22 13:50:55] OK: username 1.2.3.4 80 POST <A HREF="http://1.2.3.4/myurl/">http://1.2.3.4/myurl/</A> /myurl/
[2015-10-22 13:51:27] OK: username 1.2.3.4 80 POST <A HREF="http://1.2.3.4/myurl/">http://1.2.3.4/myurl/</A> /myurl/
[2015-10-22 13:51:57] OK: username 1.2.3.4 80 POST <A HREF="http://1.2.3.4/myurl/">http://1.2.3.4/myurl/</A> /myurl/
[2015-10-22 13:52:27] OK: username 1.2.3.4 80 POST <A HREF="http://1.2.3.4/myurl/">http://1.2.3.4/myurl/</A> /myurl/
[2015-10-22 13:53:06] OK: username 1.2.3.4 80 POST <A HREF="http://1.2.3.4/myurl/">http://1.2.3.4/myurl/</A> /myurl/
[2015-10-22 13:53:37] OK: username 1.2.3.4 80 POST <A HREF="http://1.2.3.4/myurl/">http://1.2.3.4/myurl/</A> /myurl/


Athos Fiolo
Software Engineer
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">afiolo at came.com</A>
CAME S.p.A.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="006142.html">[squid-users] R:  nonce_garbage_interval problem?
</A></li>
	<LI>Next message (by thread): <A HREF="006147.html">[squid-users] nonce_garbage_interval problem?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6145">[ date ]</a>
              <a href="thread.html#6145">[ thread ]</a>
              <a href="subject.html#6145">[ subject ]</a>
              <a href="author.html#6145">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
