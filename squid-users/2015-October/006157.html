<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] How to inspect client certificate in ssl_bump
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20How%20to%20inspect%20client%20certificate%20in%20ssl_bump&In-Reply-To=%3C56296603.3060307%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006156.html">
   <LINK REL="Next"  HREF="006171.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] How to inspect client certificate in ssl_bump</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20How%20to%20inspect%20client%20certificate%20in%20ssl_bump&In-Reply-To=%3C56296603.3060307%40measurement-factory.com%3E"
       TITLE="[squid-users] How to inspect client certificate in ssl_bump">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Oct 22 22:41:07 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="006156.html">[squid-users] How to inspect client certificate in ssl_bump
</A></li>
        <LI>Next message (by thread): <A HREF="006171.html">[squid-users] How to inspect client certificate in ssl_bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6157">[ date ]</a>
              <a href="thread.html#6157">[ thread ]</a>
              <a href="subject.html#6157">[ subject ]</a>
              <a href="author.html#6157">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/22/2015 03:53 PM, Leon wrote:

&gt;<i> I'm using Squid 3.5. What I'm going to do is setting up a forward proxy that
</I>&gt;<i> inspect TLS handshake between client and server then allow the connection
</I>&gt;<i> only when following two requirements are met:
</I>&gt;<i> 
</I>&gt;<i>     1. The server address must be in our whitelist, and the server must
</I>&gt;<i> provide a correct server certificate during TLS handshake
</I>&gt;<i>     2. The client must provide a client certificate during TLS handshake.
</I>&gt;<i> And the certificate's subject must be in our whitelist
</I>&gt;<i> 
</I>&gt;<i> I've set up the ssl_bump according to this page:
</I>&gt;<i> <A HREF="http://wiki.squid-cache.org/Features/SslPeekAndSplice.">http://wiki.squid-cache.org/Features/SslPeekAndSplice.</A> I don't need to do
</I>&gt;<i> any bump. I only need to peek then either splice or terminate.
</I>&gt;<i> 
</I>&gt;<i> My question is - how to inspect the client certificate? And how to configure
</I>&gt;<i> an acl for that?
</I>

Current SslBump code does not support client certificate inspection.
Squid does not know anything about a bumped client certificate.


&gt;<i> The document is confusing. It explains the peek action as:
</I>&gt;<i> peek    step1, step2    Receive SNI and client certificate (step1), or
</I>&gt;<i> server certificate (step2) while preserving the possibility of splicing the
</I>&gt;<i> connection. Peeking at the server certificate usually precludes future
</I>&gt;<i> bumping of the connection (see Limitations).
</I>
&gt;<i> But client certificate is not sent at step1 during TLS handshake. Client
</I>&gt;<i> certificate is sent after server certificate is received and the sever also
</I>&gt;<i> send a &quot;Certificate Request&quot; message.
</I>
That is correct. What do you find confusing about the current
description? Please suggest improvements or edit the current text.


&gt;<i> So I guess I need an additional step (step4)?
</I>
Yes, although client certificate inspection should most likely be done
during step3 and/or step4, with the current &quot;final&quot; step3 increased to
step4 or step5.


&gt;<i> Is there already someone working on this or I need to create by
</I>&gt;<i> myself?
</I>
I am not aware of anybody working on the client certificate inspection
in SslBump. Please note that correctly handling client certificates
during SslBump requires serious development work and that work needs to
be done in the unstable SslBump code (e.g., we are currently rewriting
handshake parsing code to make it safe and robust).


HTH,

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="006156.html">[squid-users] How to inspect client certificate in ssl_bump
</A></li>
	<LI>Next message (by thread): <A HREF="006171.html">[squid-users] How to inspect client certificate in ssl_bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6157">[ date ]</a>
              <a href="thread.html#6157">[ thread ]</a>
              <a href="subject.html#6157">[ subject ]</a>
              <a href="author.html#6157">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
