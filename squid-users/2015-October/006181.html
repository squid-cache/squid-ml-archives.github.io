<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Access regulation with multiple outgoing IPs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Access%20regulation%20with%20multiple%20outgoing%20IPs&In-Reply-To=%3C1445698198127-4673900.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006180.html">
   <LINK REL="Next"  HREF="006185.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Access regulation with multiple outgoing IPs</H1>
    <B>rudi</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Access%20regulation%20with%20multiple%20outgoing%20IPs&In-Reply-To=%3C1445698198127-4673900.post%40n4.nabble.com%3E"
       TITLE="[squid-users] Access regulation with multiple outgoing IPs">rudis.gameshop at gmail.com
       </A><BR>
    <I>Sat Oct 24 14:49:58 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="006180.html">[squid-users] config Q
</A></li>
        <LI>Next message (by thread): <A HREF="006185.html">[squid-users] Access regulation with multiple outgoing IPs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6181">[ date ]</a>
              <a href="thread.html#6181">[ thread ]</a>
              <a href="subject.html#6181">[ subject ]</a>
              <a href="author.html#6181">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey guys, 

im trying to setup squid for windows. I have different IPs on my server and
i want to assign them to VMs:
VM1 --&gt; Outgoing IP1
VM2 --&gt; Outgoing IP2
...

So far this is working! But now i want to deny all other IPs to avoid false
access. So all VMs have the same incoming IP (i think) but the outgoing IP
changes by port. 

Can you help me to set up the access regulation and deny all unwanted
adresses?


acl localnet src 10.0.0.0/8	# RFC1918 possible internal network
acl localnet src 172.16.0.0/12	# RFC1918 possible internal network
acl localnet src 192.168.0.0/16	# RFC1918 possible internal network
acl localnet src fc00::/7       # RFC 4193 local private network range
acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged)
machines


http_port 5.189.xxx.xx1:3129 name=3129
http_port 5.189.xxx.xx2:3130 name=3130

#VM1
acl vm3129 myportname 3129 src 213.xxx.xxx.83/24 
tcp_outgoing_address 5.189.xxx.xx1 vm3129
http_access allow vm3129

#VM2
acl vm3130 myportname 3130 src 213.xxx.xxx.83/24
tcp_outgoing_address 5.189.xxx.xx2 bot3130
http_access allow vm3130


acl SSL_ports port 443
acl Safe_ports port 80		# http
acl Safe_ports port 21		# ftp
acl Safe_ports port 443		# https
acl Safe_ports port 70		# gopher
acl Safe_ports port 210		# wais
acl Safe_ports port 1025-65535	# unregistered ports
acl Safe_ports port 280		# http-mgmt
acl Safe_ports port 488		# gss-http
acl Safe_ports port 591		# filemaker
acl Safe_ports port 777		# multiling http
acl CONNECT method CONNECT

#
# Recommended minimum Access Permission configuration:
#

# Only allow cachemgr access from localhost
http_access allow localhost manager
http_access deny manager

# Deny requests to certain unsafe ports
http_access deny !Safe_ports

# Deny CONNECT to other than secure SSL ports
#http_access deny CONNECT !SSL_ports


# We strongly recommend the following be uncommented to protect innocent
# web applications running on the proxy server who think the only
# one who can access services on &quot;localhost&quot; is a local user
#http_access deny to_localhost

#
# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
#

# Example rule allowing access from your local networks.
# Adapt localnet in the ACL section to list your (internal) IP networks
# from where browsing should be allowed
http_access allow localnet
http_access allow localhost
#http_access allow all


# And finally deny all other access to this proxy
http_access deny all

# Squid normally listens to port 3128
#http_port 3128


# Uncomment the line below to enable disk caching - path format is
/cygdrive/&lt;full path to cache folder&gt;, i.e.
#cache_mem 64 MB
#cache_dir aufs /cygdrive/d/squid/cache 4000 16 256


# Leave coredumps in the first cache dir
#coredump_dir /var/cache/squid

# Add any of your own refresh_pattern entries above these.
refresh_pattern ^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
refresh_pattern .		0	20%	4320

dns_nameservers xxx xxx

max_filedescriptors 3200



Thank you for your help!



--
View this message in context: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Access-regulation-with-multiple-outgoing-IPs-tp4673900.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Access-regulation-with-multiple-outgoing-IPs-tp4673900.html</A>
Sent from the Squid - Users mailing list archive at Nabble.com.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="006180.html">[squid-users] config Q
</A></li>
	<LI>Next message (by thread): <A HREF="006185.html">[squid-users] Access regulation with multiple outgoing IPs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6181">[ date ]</a>
              <a href="thread.html#6181">[ thread ]</a>
              <a href="subject.html#6181">[ subject ]</a>
              <a href="author.html#6181">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
