<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] [Squid 4.x]: Truncated accounts when there is spaces in usernames
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5BSquid%204.x%5D%3A%20Truncated%20accounts%20when%20there%20is%0A%20spaces%20in%20usernames&In-Reply-To=%3C562C8C42.2000104%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006182.html">
   <LINK REL="Next"  HREF="006184.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] [Squid 4.x]: Truncated accounts when there is spaces in usernames</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5BSquid%204.x%5D%3A%20Truncated%20accounts%20when%20there%20is%0A%20spaces%20in%20usernames&In-Reply-To=%3C562C8C42.2000104%40treenet.co.nz%3E"
       TITLE="[squid-users] [Squid 4.x]: Truncated accounts when there is spaces in usernames">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Oct 25 08:01:06 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="006182.html">[squid-users] [Squid 4.x]: Truncated accounts when there is spaces in usernames
</A></li>
        <LI>Next message (by thread): <A HREF="006184.html">[squid-users] [Squid 4.x]: Truncated accounts when there is spaces in usernames
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6183">[ date ]</a>
              <a href="thread.html#6183">[ thread ]</a>
              <a href="subject.html#6183">[ subject ]</a>
              <a href="author.html#6183">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 25/10/2015 5:47 a.m., David Touzeau wrote:
&gt;<i> 
</I>&gt;<i> auth_param ntlm program /usr/bin/ntlm_auth  --domain=TOUZEAU.BIZ
</I>&gt;<i> --helper-protocol=squid-2.5-ntlmssp
</I>&gt;<i> auth_param ntlm children 20 startup=5 idle=3
</I>&gt;<i> auth_param ntlm keep_alive on
</I>&gt;<i> authenticate_ttl 14400 seconds
</I>&gt;<i> authenticate_cache_garbage_interval 18000 seconds
</I>&gt;<i> authenticate_ip_ttl 14400 seconds
</I>&gt;<i> 
</I>&gt;<i> auth_param basic program /usr/bin/ntlm_auth
</I>&gt;<i> --helper-protocol=squid-2.5-basic
</I>&gt;<i> auth_param basic children 10 startup=5 idle=1
</I>&gt;<i> auth_param basic realm Basic Identification
</I>&gt;<i> auth_param basic credentialsttl 4 hours
</I>&gt;<i> 
</I>&gt;<i> here a debug log with an account logged as &quot;david touzeau&quot;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Proxy-Authorization: NTLM
</I>&gt;<i> TlRMTVNTUAADAAAAGAAYAJAAAAAYABgAqAAAAA4ADgBYAAAAGgAaAGYAAAAQABAAgAAAAAAAAADAAAAABYKIogYBsR0AAAAPudyEOYFjFhMW+qrJNxLkdlQATwBVAFoARQBBAFUAZABhAHYAaQBkACAAdABvAHUAegBlAGEAdQBXAEkATgA3AFUAUwAtADEAkZrVyKTcrdAAAAAAAAAAAAAAAAAAAAAA/wlnYT2Q+F
</I>&gt;<i> 
</I>&gt;<i> 2015/10/24 12:34:58.089 kid1| 84,5| helper.cc(1384)
</I>&gt;<i> helperStatefulDispatch: helperStatefulDispatch: Request sent to
</I>&gt;<i> ntlmauthenticator #Hlpr65, 260 bytes
</I>&gt;<i> 2015/10/24 12:34:58.092 kid1| 84,5| helper.cc(1000)
</I>&gt;<i> helperStatefulHandleRead: helperStatefulHandleRead: 17 bytes from
</I>&gt;<i> ntlmauthenticator #Hlpr65
</I>&gt;<i> 2015/10/24 12:34:58.092 kid1| 29,6| UserRequest.cc(171)
</I>&gt;<i> releaseAuthServer: releasing NTLM auth server '0x1d91cd8'
</I>&gt;<i> 2015/10/24 12:34:58.092 kid1| 29,4| UserRequest.cc(327) HandleReply:
</I>&gt;<i> Successfully validated user via NTLM. Username 'touzeau'
</I>&gt;<i> 
</I>
Okay. I think there is nothing we can do about it except to say you
can't have whitespace in usernames when using the old-style helpers.
That currently still includes ntlm_auth from Samba.

It is not a new problem. The NTLM/Negotiate helper response lines have
an optional token field before the username and the line is whitespace
delimited. If the username has whitespace inside it, then the first part
is parsed as being that field. It should be %-encoding the username,
which seems not to be happening.

We moved to the key=value protocol as the solution to avoid that in
future. But it requires the helper(s) to be using the new protocol. And
this one is not doing that either.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="006182.html">[squid-users] [Squid 4.x]: Truncated accounts when there is spaces in usernames
</A></li>
	<LI>Next message (by thread): <A HREF="006184.html">[squid-users] [Squid 4.x]: Truncated accounts when there is spaces in usernames
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6183">[ date ]</a>
              <a href="thread.html#6183">[ thread ]</a>
              <a href="subject.html#6183">[ subject ]</a>
              <a href="author.html#6183">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
