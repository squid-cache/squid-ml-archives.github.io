<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid4 has extremely low hit ratio due to lacks of ignore-no-cache
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid4%20has%20extremely%20low%20hit%20ratio%20due%20to%20lacks%0A%20of%20ignore-no-cache&In-Reply-To=%3C562E0073.4090302%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006197.html">
   <LINK REL="Next"  HREF="006205.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid4 has extremely low hit ratio due to lacks of ignore-no-cache</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid4%20has%20extremely%20low%20hit%20ratio%20due%20to%20lacks%0A%20of%20ignore-no-cache&In-Reply-To=%3C562E0073.4090302%40ngtech.co.il%3E"
       TITLE="[squid-users] Squid4 has extremely low hit ratio due to lacks of ignore-no-cache">eliezer at ngtech.co.il
       </A><BR>
    <I>Mon Oct 26 10:29:07 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="006197.html">[squid-users] Squid4 has extremely low hit ratio due to lacks of ignore-no-cache
</A></li>
        <LI>Next message (by thread): <A HREF="006205.html">[squid-users] Squid4 has extremely low hit ratio due to lacks of ignore-no-cache
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6203">[ date ]</a>
              <a href="thread.html#6203">[ thread ]</a>
              <a href="subject.html#6203">[ subject ]</a>
              <a href="author.html#6203">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Yuri,

What have you tried until now to understand the situation of the issue?
 From your basic question I was sure that you ran some tests on some 
well defined objects.
To asses the state of squid you would need some static objects and some 
changing objects.
You would also be required to test using a simple UA like a 
script\wget\curl and using a fully fledged UA such as 
chrome\firefox\explorer\opera\safari.

I can try to give you couple cache friendly sites which will show you 
what the basic status of squid.
In the past someone here asked how to cache the site: <A HREF="http://djmaza.info/">http://djmaza.info/</A>
which by default is built using lots of static content such as html 
pages, pictures and good css and also implements cache headers nicely.
I still do not know why wordpress main pages do not have a valid cache 
headers, and what I mean by that is: Is it not possible to have a page 
cached for 60 seconds? how much updates can accrue in 60 seconds? would 
a &quot;must-revalidate&quot; cost that much compared to what there is now?(maybe 
it does).
Another one would be <A HREF="https://www.yahoo.com/">https://www.yahoo.com/</A> which is mostly fine with 
cache and define their main page with &quot;Cache-Control: no-store, 
no-cache, private, max-age=0&quot; since it's a news page which updates too much.

I was looking for cache testing subjects and I am still missing couple 
examples\options.

Until now what have mainly used for basic test was redbot.org and a 
local copy of it for testing purposes.
And while writing to you looking for test subjects I have seen that my 
own web server have a question for squid.
I have an example case which gives a great example how to &quot;break&quot; squid 
cache.
So I have my website and the main page:
<A HREF="http://ngtech.co.il/">http://ngtech.co.il/</A>
<A HREF="https://ngtech.co.il/">https://ngtech.co.il/</A> (self signed certificate)

that would be cached properly by squid!
If for any reason I would remove the Last-Modified header from the page 
it would become un-cachable in squid (3.5.10) with default settings.
Accidentally I turned ON the apache option to treat html as php using 
the apache configuration line:
AddType application/x-httpd-php .html .htm

Which is recommended to be used by the first google result for &quot;html as 
php&quot;.
Once you will try the next page(with this setting on):
<A HREF="http://ngtech.co.il/squidblocker/">http://ngtech.co.il/squidblocker/</A>
<A HREF="https://ngtech.co.il/squidblocker/">https://ngtech.co.il/squidblocker/</A> (self signed certificate)

You will see that it is not being cached at all.
Redbot.org claims that the cache is allowed it's own freshness for the 
object but squid (3.5.10) will not cache it what so ever and no matter 
what I do.
When I am removing &quot;http as php&quot; tweak the page response with a 
Last-Modified header and can be cached again.

I am unsure who is the culprit for the issue but I will ask about it in 
a separated thread *if* I will get no response here.(sorry for partially 
top-posting)

Eliezer


On 25/10/2015 21:29, Yuri Voinov wrote:
&gt;<i> In a nutshell - I need no possible explanation. I want to know - it's a
</I>&gt;<i> bug or so conceived?
</I>&gt;<i>
</I>&gt;<i> 26.10.15 1:17, Eliezer Croitoru &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;&gt;<i> Hey Yuri,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I am not sure if you think that Squid version 4 with extreme low hit
</I>&gt;<i> ratio is bad or not but I can understand your sight about things.
</I>&gt;&gt;<i> Usually I am redirecting to this page:
</I>&gt;<i> <A HREF="http://wiki.squid-cache.org/Features/StoreID/CollisionRisks#Several_real_world_examples">http://wiki.squid-cache.org/Features/StoreID/CollisionRisks#Several_real_world_examples</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> But this time I can proudly say that the squid project is doing things
</I>&gt;<i> the right way while it might not be understood by some.
</I>&gt;&gt;<i> Before you or anyone declares that there is a low hit ratio due to
</I>&gt;<i> something that is missing I will try to put some sense into how things
</I>&gt;<i> looks in the real world.
</I>&gt;&gt;<i> Small thing from a nice day of mine:
</I>&gt;&gt;<i> I was sitting talking with a friend of mine, a MD to be exact and
</I>&gt;<i> while we were talking I was just comforting him about the wonders of
</I>&gt;<i> Computers.
</I>&gt;&gt;<i> He was complaining on how the software in the office moves so slow and
</I>&gt;<i> he needs to wait for the software to response with results. So I
</I>&gt;<i> hesitated a bit but then I asked him &quot;What would have happen if some MD
</I>&gt;<i> here in the office will receive the wrong content\results on a patient
</I>&gt;<i> from the software? he described it to me terrified from the question 'He
</I>&gt;<i> can get the wrong decision!' and then I described to him how he is in
</I>&gt;<i> such a good place when he doesn't need to fear from such scenarios.
</I>&gt;&gt;<i> In this same office Squid is being used for many things and it's
</I>&gt;<i> crucial that besides the option to cache content the possibility to
</I>&gt;<i> validate cache properly will be set right.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I do understand that there is a need for caches and sometimes it is
</I>&gt;<i> crucial in order to give the application more CPU cycles or more RAM but
</I>&gt;<i> sometimes the hunger for cache can consume the actual requirement for
</I>&gt;<i> the content integrity and it must be re-validated from time to time.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have seen couple times how a cache in a DB or other levels results
</I>&gt;<i> with a very bad and unwanted result while I do understand some of the
</I>&gt;<i> complexity and caution that the programmers take when building all sort
</I>&gt;<i> of systems with cache in them.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If you do want to understand more about the subject pick your favorite
</I>&gt;<i> scripting language and just try to implement a simple object caching.
</I>&gt;&gt;<i> You would then see how complex the task can be and you can maybe then
</I>&gt;<i> understand why caches are not such a simple thing and specially why
</I>&gt;<i> ignore-no-cache should not be used in any environment if it is possible.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> While I do advise you to not use it I would hint you and others on
</I>&gt;<i> another approach to the subject.
</I>&gt;&gt;<i> If you are greedy and you have hunger for cache for specific
</I>&gt;<i> sites\traffic and you would like to be able to benefit from over-caching
</I>&gt;<i> there is a solution for that!
</I>&gt;&gt;<i> - You can alter\hack squid code to meet your needs
</I>&gt;&gt;<i> - You can write an ICAP service that will be able to alter the
</I>&gt;<i> response headers so squid would think it is cachable by default.
</I>&gt;&gt;<i> - You can write an ECAP module that will be able to alter the response
</I>&gt;<i> headers ...
</I>&gt;&gt;<i> - Write your own cache service with your algorithms in it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Take in account that the squid project tries to be as fault tolerance
</I>&gt;<i> as possible due to it being a very sensitive piece of software in very
</I>&gt;<i> big production systems.
</I>&gt;&gt;<i> Squid doesn't try to meet the requirement of &quot;Maximum Cache&quot; and it is
</I>&gt;<i> not squid that as a caching proxy makes a reduction of any cache percentage!
</I>&gt;&gt;<i> The reason that the content is not cachable is due to all these
</I>&gt;<i> application that describe their content as not cachable!
</I>&gt;&gt;<i> For a second of sanity from the the squid project, try to contact
</I>&gt;<i> google\youtube admins\support\operators\forces\what-ever to understand
</I>&gt;<i> how would you be able to benefit from a local cache.
</I>&gt;&gt;<i> If and when you do manage to contact them let them know I was looking
</I>&gt;<i> for a contact and I never managed to find one of these available to me
</I>&gt;<i> on the phone or email. You cannot say anything like that on the squid
</I>&gt;<i> project, the squid project can be contacted using an email and if
</I>&gt;<i> required you can get a hold of the man behind the software(while he is a
</I>&gt;<i> human).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> And I will try to write it in a geeky way:
</I>&gt;&gt;<i> deny_info 302:<A HREF="https://support.google.com/youtube/">https://support.google.com/youtube/</A>
</I>&gt;<i> big_system_that_doesnt_want_to_be_cached
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Eliezer
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * P.S If you do want to write an ICAP service or an ECAP module to
</I>&gt;<i> replace the &quot;ignore-no-cache&quot; I can give you some code that will might
</I>&gt;<i> help you as a starter.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 25/10/2015 17:17, Yuri Voinov wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i> Hi gents,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Pay attention to whether someone from the test SQUID 4 as extremely low
</I>&gt;&gt;<i> of cache hits from the new version? Particularly with respect to sites
</I>&gt;&gt;<i> HTTPS directive &quot;no cache&quot;? After replacing the Squid 3.4 to 4 squid
</I>&gt;&gt;<i> cache hit collapsed from 85 percent or more on the level of 5-15
</I>&gt;&gt;<i> percent. I believe this is due to the exclusion of support guidelines
</I>&gt;&gt;<i> ignore-no-cache, which eliminates the possibility of aggressive caching
</I>&gt;&gt;<i> and reduces the value of caching proxy to almost zero.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This HTTP caches normally. However, due to the widespread use of HTTPS
</I>&gt;&gt;<i> trends - caching dramatically decreased to unacceptable levels.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Noticed there anyone else this effect? And what is now with caching?
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="006197.html">[squid-users] Squid4 has extremely low hit ratio due to lacks of ignore-no-cache
</A></li>
	<LI>Next message (by thread): <A HREF="006205.html">[squid-users] Squid4 has extremely low hit ratio due to lacks of ignore-no-cache
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6203">[ date ]</a>
              <a href="thread.html#6203">[ thread ]</a>
              <a href="subject.html#6203">[ subject ]</a>
              <a href="author.html#6203">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
