<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid4 has extremely low hit ratio due to lacks of ignore-no-cache
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid4%20has%20extremely%20low%20hit%20ratio%20due%20to%20lacks%0A%20of%20ignore-no-cache&In-Reply-To=%3C562E60BE.3000302%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006222.html">
   <LINK REL="Next"  HREF="006228.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid4 has extremely low hit ratio due to lacks of ignore-no-cache</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid4%20has%20extremely%20low%20hit%20ratio%20due%20to%20lacks%0A%20of%20ignore-no-cache&In-Reply-To=%3C562E60BE.3000302%40gmail.com%3E"
       TITLE="[squid-users] Squid4 has extremely low hit ratio due to lacks of ignore-no-cache">yvoinov at gmail.com
       </A><BR>
    <I>Mon Oct 26 17:19:58 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="006222.html">[squid-users] Squid4 has extremely low hit ratio due to lacks of ignore-no-cache
</A></li>
        <LI>Next message (by thread): <A HREF="006228.html">[squid-users] Squid4 has extremely low hit ratio due to lacks of ignore-no-cache
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6223">[ date ]</a>
              <a href="thread.html#6223">[ thread ]</a>
              <a href="subject.html#6223">[ subject ]</a>
              <a href="author.html#6223">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256
 
The answer is simple.

Look ath this row from 3.5.10 access.log:

1445879345.827     48 127.0.0.1 TCP_MEM_HIT/200 24425 GET
<A HREF="https://upload.wikimedia.org/wikipedia/commons/thumb/8/8c/Teller-Ulam_device.png/200px-Teller-Ulam_device.png">https://upload.wikimedia.org/wikipedia/commons/thumb/8/8c/Teller-Ulam_device.png/200px-Teller-Ulam_device.png</A>
- HIER_NONE/- image/png

We can see a big enoug image from Wiki. Mem hit, yea?

With next request we got TCP_HIT, when image comes from disk cache after
swap out.

Refresh pattern from 3.5.10 related to this URL:

# Other long-lived items
refresh_pattern -i
\.(jp(e?g|e|2)|gif|png|tiff?|bmp|ico|svg|webp|flv|f4f|mp4|ttf|eot|woff2?)(\?.*)?$   
14400    99%    518400     override-expire override-lastmod
reload-into-ims ignore-private ignore-no-store

Then we look in 4.0.1 access.log with the same image:

14458854979.432     48 127.0.0.1 TCP_MISS/200 24425 GET
<A HREF="https://upload.wikimedia.org/wikipedia/commons/thumb/8/8c/Teller-Ulam_device.png/200px-Teller-Ulam_device.png">https://upload.wikimedia.org/wikipedia/commons/thumb/8/8c/Teller-Ulam_device.png/200px-Teller-Ulam_device.png</A>
- HIER_NONE/- image/png

# Other long-lived items
refresh_pattern -i
\.(jp(e?g|e|2)|gif|png|bmp|ico|svg|web(p|m)|flv|f4f|mp(3|4)|ttf|eot|woff2?))(\?.*)?$   
14400    100%    518400    override-expire override-lastmod
reload-into-ims ignore-private ignore-no-store

Did you see principal difference? Ah, yes. 4.0.1 has more than 4 times
bigger mem_cache, 1 Gb. 1st example 3.5.10 has only 256 Mbytes. This is
the reason of miss??????

Both servers has the similar squid.conf. Both images are static.

Well, now we goes to redbot.org and check this URL:

<A HREF="http://i.imgur.com/KiydfT0.png">http://i.imgur.com/KiydfT0.png</A>

What we seen?


      Caching

  * This response allows all caches to store it.
  * This response cannot be served from cache without validation.

So, what's wrong with Squid NOW?

Interesting, isn't it?

26.10.15 23:01, Alex Rousskov &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> On 10/26/2015 04:41 AM, Yuri Voinov wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> what has changed so much that the same
</I>&gt;&gt;<i> configuration I get 10 times smaller cache hit.
</I>&gt;<i>
</I>&gt;<i> You are asking a good question. I do not think anybody knows the exact
</I>&gt;<i> answer -- too many things have changed in general to either identify the
</I>&gt;<i> changes that have affected your [complicated] setup or to exclude all of
</I>&gt;<i> the changes and blame some yet-unknown v4 bug.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> However, the following procedure is almost guaranteed to lead you to the
</I>&gt;<i> answer:
</I>&gt;<i>
</I>&gt;<i> 1. Find a URL/resource that was served from the cache in v3 but became a
</I>&gt;<i> miss in v4. You probably have access.logs that can be used for that. If
</I>&gt;<i> not, enable them and run more experiments. Since your drop in hit ratio
</I>&gt;<i> is so drastic, it should not take long to find a URL that was usually a
</I>&gt;<i> hit before and is usually a miss now (or that becomes a hit/miss as soon
</I>&gt;<i> as you switch to v3/4).
</I>&gt;<i>
</I>&gt;<i> 2. Reproduce the v4 miss with an ALL,9 cache.log and share that log. Do
</I>&gt;<i> this using single-transaction command-line tools, with no other traffic
</I>&gt;<i> going through Squid. Others on this list can guide you as to what
</I>&gt;<i> logging options to use if you do not want to run with ALL,9.
</I>&gt;<i>
</I>&gt;<i> The above requires some work on your part. It is a good idea to run
</I>&gt;<i> these tests in a non-production environment (which may require even more
</I>&gt;<i> work from you). Needless to say, you are not required to do that extra
</I>&gt;<i> work. However, some extra work is most likely required if you want to
</I>&gt;<i> get the answer to your question because there is currently not enough
</I>&gt;<i> information to answer it.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> HTH,
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i>
</I>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBCAAGBQJWLmC+AAoJENNXIZxhPexGGj8IAKfXg0FZU/27pZxcga0cmcRD
lSKxRf9zwxpGu5lZ9ubDaZwf/SYlish8Ej7pQkzTSTi4ApVP5QWYg4P9DoY1PnJ2
ziSwFPuc3zVmgm8ua8fKUL+zsBMe46xIBNHino13dEN4tzFgxm4gQ2VjDOk/0S2n
xM0svah0UDBiagSeyKt7SeDIwZRNNhMywiALwyjltrYc73OkfrwLt4yDE08SehOi
phDlsVwaaQDqOk8AauYoNl55BBa3Qj+GlqJ3CduIIU6C54+6cAYG8V3YTJtwFFvX
wLa7u5PWB5fkWAiuS+ZlKdG3A2KRO16Ya87dMCdu0GaYTS0eo2I+sqtCiCCRgg8=
=ahlV
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20151026/c6a69f44/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20151026/c6a69f44/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="006222.html">[squid-users] Squid4 has extremely low hit ratio due to lacks of ignore-no-cache
</A></li>
	<LI>Next message (by thread): <A HREF="006228.html">[squid-users] Squid4 has extremely low hit ratio due to lacks of ignore-no-cache
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6223">[ date ]</a>
              <a href="thread.html#6223">[ thread ]</a>
              <a href="subject.html#6223">[ subject ]</a>
              <a href="author.html#6223">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
