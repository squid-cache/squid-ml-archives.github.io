<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid SNI at Step 2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20SNI%20at%20Step%202&In-Reply-To=%3CCAGRJihUb%3Dsu3vJu-OPFcDEyc0W-g_zimxvu6V9-pZ6u8T5%2BqDw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006224.html">
   <LINK REL="Next"  HREF="006214.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid SNI at Step 2</H1>
    <B>Jatin Bhasin</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20SNI%20at%20Step%202&In-Reply-To=%3CCAGRJihUb%3Dsu3vJu-OPFcDEyc0W-g_zimxvu6V9-pZ6u8T5%2BqDw%40mail.gmail.com%3E"
       TITLE="[squid-users] Squid SNI at Step 2">jbhasin83 at gmail.com
       </A><BR>
    <I>Mon Oct 26 19:18:30 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="006224.html">[squid-users] Squid SNI at Step 2
</A></li>
        <LI>Next message (by thread): <A HREF="006214.html">[squid-users] The url_rewriter helpers are crashing too rapidly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6237">[ date ]</a>
              <a href="thread.html#6237">[ thread ]</a>
              <a href="subject.html#6237">[ subject ]</a>
              <a href="author.html#6237">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Alex,

Thanks. I understand this. I want a mechanism by which squid can send
the FAKE connect SNI as HOST request to ecap adapter so that I can
decide whether to bump this connection or not. So do you think this
will not be possible in current release of squid ?

Squid does not generate SNI FAKE CONNECT until we splice at step 2. Do
you know that why squid does not generate FAKE CONNECT request for
bump and peek actions at step2 ?


Thanks,
Jatin



On Tue, Oct 27, 2015 at 4:20 AM, Alex Rousskov
&lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:
&gt;<i> On 10/26/2015 06:34 AM, Jatin Bhasin wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> I am running squid 3.5.10 for bumping transparent SSL connections To
</I>&gt;&gt;<i> achieve this I am using following squid configuration for SSL Bumping.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ssl_bump peek step1 all
</I>&gt;&gt;<i> ssl_bump peek step2 nobumpSites
</I>&gt;&gt;<i> ssl_bump bump step3 nobumpSites
</I>&gt;&gt;<i> ssl_bump bump all
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> In the latest Squids, the above config probably does not do what you
</I>&gt;<i> want. For nobumpSites, your config is equivalent to:
</I>&gt;<i>
</I>&gt;<i>   ssl_bump peek step1
</I>&gt;<i>   ssl_bump peek step2
</I>&gt;<i>   ssl_bump bump step3
</I>&gt;<i>
</I>&gt;<i> which does not work in most cases -- you cannot bump after peeking at step2.
</I>&gt;<i>
</I>&gt;<i> For all other sites, you config is equivalent to:
</I>&gt;<i>
</I>&gt;<i>   ssl_bump peek step1
</I>&gt;<i>   ssl_bump bump step2
</I>&gt;<i>
</I>&gt;<i> which works.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> If you want to bump everything, then this should work:
</I>&gt;<i>
</I>&gt;<i>   ssl_bump stare all
</I>&gt;<i>   ssl_bump bump all
</I>&gt;<i>
</I>&gt;<i> If you want to bump everything other than nobumpSites (which needs SNI),
</I>&gt;<i> then start with something like this:
</I>&gt;<i>
</I>&gt;<i>   ssl_bump peek step1
</I>&gt;<i>   ssl_bump splice nobumpSites
</I>&gt;<i>   ssl_bump bump all
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> HTH,
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="006224.html">[squid-users] Squid SNI at Step 2
</A></li>
	<LI>Next message (by thread): <A HREF="006214.html">[squid-users] The url_rewriter helpers are crashing too rapidly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6237">[ date ]</a>
              <a href="thread.html#6237">[ thread ]</a>
              <a href="subject.html#6237">[ subject ]</a>
              <a href="author.html#6237">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
