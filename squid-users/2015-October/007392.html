<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Host header forgery detected after upgrade from 3.5.8 to 3.5.9
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Host%20header%20forgery%20detected%20after%20upgrade%20from%0A%203.5.8%20to%203.5.9&In-Reply-To=%3C5631A4A4.8000800%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007388.html">
   <LINK REL="Next"  HREF="007397.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Host header forgery detected after upgrade from 3.5.8 to 3.5.9</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Host%20header%20forgery%20detected%20after%20upgrade%20from%0A%203.5.8%20to%203.5.9&In-Reply-To=%3C5631A4A4.8000800%40treenet.co.nz%3E"
       TITLE="[squid-users] Host header forgery detected after upgrade from 3.5.8 to 3.5.9">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Oct 29 04:46:28 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007388.html">[squid-users] Host header forgery detected after upgrade from	3.5.8 to 3.5.9
</A></li>
        <LI>Next message (by thread): <A HREF="007397.html">[squid-users] Host header forgery detected after upgrade from	3.5.8 to 3.5.9
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7392">[ date ]</a>
              <a href="thread.html#7392">[ thread ]</a>
              <a href="subject.html#7392">[ subject ]</a>
              <a href="author.html#7392">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 29/10/2015 1:16 p.m., Dan Charlesworth wrote:
&gt;<i> It looks like there&#8217;s certain hosts that are designed to load balance (or something) between a few IPs, regardless of geography.
</I>&gt;<i> 
</I>&gt;<i> For example pbs.twimg.com resolves to wildcard.twimg.com which returns two different IPs each time, from a pool of 5&#8211;6, at random. Basically rolling the dice whether the client and the proxy are going to get the same IPs at the same time.
</I>&gt;<i> 
</I>&gt;<i> What is one to do about that?
</I>
The same thing. Ensuring that the proxy and the clients are using the
same DNS server.

The reasoning goes like so:
* some client does a DNS fetch causing the result to be cached in *that*
server.
* then the proxy repeats the query and gets the DNS cached result.
* those results should match 99% of the time even if the domain DNS is
playing tricks.

This falls down with the Google DNS because &quot;8.8.8.8&quot; is not one server
but an entire farm of servers spread aroudn the globe. The two
consecutive queries done often go to different physical servers.

You can of course configure 8.8.8.8 to be an upstream resolver for your
local DNS server if you think that is a good idea. The key think is
having the same local-end DNS cache being used by the clients and Squid.


NP: these problems do not exist for forward proxies. Only for traffic
hijacking interceptor proxies.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007388.html">[squid-users] Host header forgery detected after upgrade from	3.5.8 to 3.5.9
</A></li>
	<LI>Next message (by thread): <A HREF="007397.html">[squid-users] Host header forgery detected after upgrade from	3.5.8 to 3.5.9
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7392">[ date ]</a>
              <a href="thread.html#7392">[ thread ]</a>
              <a href="subject.html#7392">[ subject ]</a>
              <a href="author.html#7392">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
