<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] &quot;NF getsockopt(SO_ORIGINAL_DST)&quot; filling cache.log due to AWS ELB healthchecks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%22NF%20getsockopt%28SO_ORIGINAL_DST%29%22%20filling%0A%20cache.log%20due%20to%20AWS%20ELB%20healthchecks&In-Reply-To=%3C5631A7D6.4030206%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007389.html">
   <LINK REL="Next"  HREF="007409.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] &quot;NF getsockopt(SO_ORIGINAL_DST)&quot; filling cache.log due to AWS ELB healthchecks</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%22NF%20getsockopt%28SO_ORIGINAL_DST%29%22%20filling%0A%20cache.log%20due%20to%20AWS%20ELB%20healthchecks&In-Reply-To=%3C5631A7D6.4030206%40treenet.co.nz%3E"
       TITLE="[squid-users] &quot;NF getsockopt(SO_ORIGINAL_DST)&quot; filling cache.log due to AWS ELB healthchecks">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Oct 29 05:00:06 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007389.html">[squid-users] &quot;NF getsockopt(SO_ORIGINAL_DST)&quot; filling cache.log due to AWS ELB healthchecks
</A></li>
        <LI>Next message (by thread): <A HREF="007409.html">[squid-users] &quot;NF getsockopt(SO_ORIGINAL_DST)&quot; filling cache.log due to AWS ELB healthchecks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7395">[ date ]</a>
              <a href="thread.html#7395">[ thread ]</a>
              <a href="subject.html#7395">[ subject ]</a>
              <a href="author.html#7395">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 29/10/2015 1:28 p.m., Eliezer Croitoru wrote:
&gt;<i> Why are you using an intercept port?
</I>&gt;<i> IF you don't need it you dont't.
</I>&gt;<i> Every time any direct conneciton is done to the proxy port 3128 it will
</I>&gt;<i> show this line since the connection is a regular TCP one while the
</I>&gt;<i> &quot;intercept&quot; directive instructs squid to fetch information which exists
</I>&gt;<i> only on NATTED\REDIRECT traffic.
</I>&gt;<i> Pretty simple and straight forward and this is the way squid works..
</I>&gt;<i> You should verify if you need a http_port 1111 or http_port 1111 accel
</I>&gt;<i> or http_port 1111 intercept.
</I>&gt;<i> 
</I>&gt;<i> I will be glad to help you in about 20 hours.
</I>&gt;<i> 
</I>&gt;<i> Eliezer
</I>&gt;<i> 
</I>&gt;<i> On 29/10/2015 02:06, John Smith wrote:
</I>&gt;&gt;<i> Hi Eliezer,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I've added a single line to my squid.conf:
</I>&gt;&gt;<i> http_port 3130
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> And I've modified my AWS ELB healthcheck to monitor port 3130 instead of
</I>&gt;&gt;<i> 3128.
</I>&gt;&gt;<i> Now my instances are still in the ELB, and the proxy still works as
</I>&gt;&gt;<i> expected, AND the amount of garbage errors in the cache.log has been
</I>&gt;&gt;<i> significantly reduced.
</I>
They are not garbage. They are telling you very clearly that the message
being received did not go through the kernel NAT system so all the TCP
protocol NAT related stuff is not working properly.

&gt;&gt;<i>
</I>&gt;&gt;<i> Unfortunately I'm seeing a single a single line in cache.log every time I
</I>&gt;&gt;<i> hit the proxy on port 3128:
</I>&gt;&gt;<i> 2015/10/28 23:53:32| IpIntercept.cc(137) NetfilterInterception:  NF
</I>&gt;&gt;<i> getsockopt(SO_ORIGINAL_DST) failed on FD 61: (92) Protocol not available
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  From other posts, it appears this warning message related to NAT. 
</I>&gt;&gt;<i> I'm not
</I>&gt;&gt;<i> doing NAT on the squid proxies, the load balancer takes care of that.
</I>
Exactly. You told Squid it had to do NAT with the &quot;intercept&quot; option.
When it tried to do as you instructed ... boom.

&gt;&gt;<i>
</I>&gt;&gt;<i> Any ideas how to remove the rest of the noise from my logs?
</I>
Start with removing the &quot;intercept&quot;. It is clearly the wrong thing to
have. Then move on to whatever problem appears next.

If you let us know what this ELB+Squid pair is supposed to be doing,
and/or share your squid.conf we can perhapse suggest what else you need
to do for other problems.

AMos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007389.html">[squid-users] &quot;NF getsockopt(SO_ORIGINAL_DST)&quot; filling cache.log due to AWS ELB healthchecks
</A></li>
	<LI>Next message (by thread): <A HREF="007409.html">[squid-users] &quot;NF getsockopt(SO_ORIGINAL_DST)&quot; filling cache.log due to AWS ELB healthchecks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7395">[ date ]</a>
              <a href="thread.html#7395">[ thread ]</a>
              <a href="subject.html#7395">[ subject ]</a>
              <a href="author.html#7395">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
