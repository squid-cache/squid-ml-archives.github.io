<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] 3.5.8 Arm7 socket permissions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%203.5.8%20Arm7%20socket%20permissions&In-Reply-To=%3C5631F0ED.2070003%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007396.html">
   <LINK REL="Next"  HREF="007403.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] 3.5.8 Arm7 socket permissions</H1>
    <B>Darren Breeze ML</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%203.5.8%20Arm7%20socket%20permissions&In-Reply-To=%3C5631F0ED.2070003%40gmail.com%3E"
       TITLE="[squid-users] 3.5.8 Arm7 socket permissions">darren.j.breeze.ml at gmail.com
       </A><BR>
    <I>Thu Oct 29 10:11:57 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007396.html">[squid-users] 3.5.8 Arm7 socket permissions
</A></li>
        <LI>Next message (by thread): <A HREF="007403.html">[squid-users] 3.5.8 Arm7 socket permissions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7398">[ date ]</a>
              <a href="thread.html#7398">[ thread ]</a>
              <a href="subject.html#7398">[ subject ]</a>
              <a href="author.html#7398">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi

Thanks for the reply.

Libcap2 is in the build, but the build is for an Arm7 and the rootfs is 
read only. Anything that needs write access I have moved to a ram disk
and symlinked it back into the expected place during the build process.

There must be something else in the OS standing in the way.

The unit has dnsmasq on it and that's working just fine. It also has a 
set of iptables rules that have been tested on an X86 system and work fine.

I can see the run it as root idea is just wrong so that's off the table.

Darren B.


On 29/10/2015 12:37 PM, Amos Jeffries wrote:
&gt;<i> On 29/10/2015 11:16 a.m., Darren Breeze ML wrote:
</I>&gt;&gt;<i> Hi all
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have built squid 3.5.8 with yocto to run on an arm 7.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This build of the OS seems to have different permissions for processes
</I>&gt;&gt;<i> opening sockets. THe DNS routine fails to open a socket with the
</I>&gt;&gt;<i> following error
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at test</A>:~# 2015/10/28 22:07:43 testing| Starting Squid Cache version
</I>&gt;&gt;<i> 3.5.8 for arm-poky-linux-gnueabi...
</I>&gt;&gt;<i> 2015/10/28 22:07:43 kid1| Service Name: squid
</I>&gt;&gt;<i> 2015/10/28 22:07:43 kid1| comm_open: socket failure: (13) Permission denied
</I>&gt;&gt;<i> 2015/10/28 22:07:43 kid1| comm_open: socket failure: (13) Permission denied
</I>&gt;&gt;<i> FATAL: Could not create a DNS socket
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It looks like I would have to either run squid as a user that can do
</I>&gt;&gt;<i> this or change this underlying permissions setting in the OS.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I would rather fix the OS rather than run squid as root.
</I>&gt;<i>
</I>&gt;<i> Firstly, since this is Linux ensure you are building Squid with libcap2
</I>&gt;<i> support. Squid actually uses capabilities when possible.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Secondly, *Starting* Squid as root does not mean it stays that way.
</I>&gt;<i>
</I>&gt;<i> Squid is actually a pair of processes, one daemon manager and a daemon.
</I>&gt;<i> You need to start the main &quot;squid&quot; binary as root so the daemon manager
</I>&gt;<i> can do the root things before it drops down to a low-privilege account
</I>&gt;<i> for the regular operations.
</I>&gt;<i>
</I>&gt;<i> That low-privilege account is set by whichever of these is found first
</I>&gt;<i> (in this order):
</I>&gt;<i> * the value in squid.conf cache_effective_user
</I>&gt;<i> * the username X specified in --with-default-user=X
</I>&gt;<i> * upstream default: &quot;nobody&quot;
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007396.html">[squid-users] 3.5.8 Arm7 socket permissions
</A></li>
	<LI>Next message (by thread): <A HREF="007403.html">[squid-users] 3.5.8 Arm7 socket permissions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7398">[ date ]</a>
              <a href="thread.html#7398">[ thread ]</a>
              <a href="subject.html#7398">[ subject ]</a>
              <a href="author.html#7398">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
