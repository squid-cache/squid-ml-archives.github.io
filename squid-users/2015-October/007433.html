<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] &quot;NF getsockopt(SO_ORIGINAL_DST)&quot; filling cache.log due to AWS ELB healthchecks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%22NF%20getsockopt%28SO_ORIGINAL_DST%29%22%20filling%0A%20cache.log%20due%20to%20AWS%20ELB%20healthchecks&In-Reply-To=%3C56328295.3050002%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007441.html">
   <LINK REL="Next"  HREF="007399.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] &quot;NF getsockopt(SO_ORIGINAL_DST)&quot; filling cache.log due to AWS ELB healthchecks</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%22NF%20getsockopt%28SO_ORIGINAL_DST%29%22%20filling%0A%20cache.log%20due%20to%20AWS%20ELB%20healthchecks&In-Reply-To=%3C56328295.3050002%40ngtech.co.il%3E"
       TITLE="[squid-users] &quot;NF getsockopt(SO_ORIGINAL_DST)&quot; filling cache.log due to AWS ELB healthchecks">eliezer at ngtech.co.il
       </A><BR>
    <I>Thu Oct 29 20:33:25 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007441.html">[squid-users] &quot;NF getsockopt(SO_ORIGINAL_DST)&quot; filling cache.log due to AWS ELB healthchecks
</A></li>
        <LI>Next message (by thread): <A HREF="007399.html">[squid-users] dynamic ssl cert and active directory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7433">[ date ]</a>
              <a href="thread.html#7433">[ thread ]</a>
              <a href="subject.html#7433">[ subject ]</a>
              <a href="author.html#7433">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey John,

You and me are missing couple things in the picture and you first need 
to understand what you have in order to fix it.
The http_port 3128 intercept cannot and should not handle CONNECT 
request which are the basic form of HTTPS connections that squid knows 
in general how to use.
I am confused which proxies are there and which aren't.
You wrote &quot;My problem is that it appears every single AWS elastic load 
balancer healthcheck triggers a line like this in cache.log:&quot; which 
means that there are couple AWS elastic load balancers.
It kind of confuses me if the squid is the first load balancer or you 
are using some service that AWS sells.
If you are using AWS elastic load balancer which is a service you should 
first make sure you understand what it does exactly and what I am 
talking about is, what is it doing with the packets it receives? Also on 
what level do they work? in the TCP level? in the HTTP level?
Also there are couple missing parts about the squid service itself.
What is to be expected(from a protocol level) from squid to handle?
What HTTP requests should be pointed there? a specific domain? a whole 
bunch of domains? intercepted traffic? do we expect SSL connections to 
be present there?
Do the AWS elastic load balancer handles SSL?

I would describe you the question you are asking in a creative way:
&quot;I have a monkey which eats the banana and every time he is pooping 
after it, I do not understand why he is pooping?&quot;

My and others side of the picture is that you have something that does 
something but cannot is not being described.
Believe me that proxies work the same way for a very long time and your 
setup is probably not that special.
If I understand right the AWS elastic load balancer is something like 
haproxy and from an unknown reason you are using squid in the picture.
Maybe it's for caching maybe it's for network policy or logging.

If you prefer to send me a private email with couple more details and 
the answers to my questions feel free to do that, not everything should 
be publicly available in the mailing list.

I do not know about your TCP and HTTP\HTTPS level of expertise and it 
makes it hard to even know if I am asking you the right questions.
Also do you have someone to ask about any of the system parts? if not... 
TCPDUMP+wireshark is your friend!

All The Bests,
Eliezer

* I am at the squid channel at freenode under the nick elico if you want 
to contact me there.

On 29/10/2015 21:39, John Smith wrote:
&gt;<i> Hi Eliezer,
</I>&gt;<i>
</I>&gt;<i> It is entirely possible that haproxy is a better solution than squid for
</I>&gt;<i> what we are doing.
</I>&gt;<i> I have never used either solution, and inherited this 'working' squid
</I>&gt;<i> configuration with the task of cleaning things up and stabilizing it.
</I>&gt;<i> Regarding your question of 'How do the first layer of proxies send their
</I>&gt;<i> request to the second layer of proxies?', all I can tell you is that all
</I>&gt;<i> the work is done in the squid.conf, and I've posted the entire contents
</I>&gt;<i> with a few replacements for security reasons.
</I>&gt;<i> As I've said, I've removed the word 'intercept' several times and the
</I>&gt;<i> requests to secondary proxies no longer work.
</I>&gt;<i> I just confirmed this behaviour again.
</I>&gt;<i> If this is as 'quiet' as I can make the logs then it is what it is.
</I>&gt;<i>
</I>&gt;<i> Thanks!
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007441.html">[squid-users] &quot;NF getsockopt(SO_ORIGINAL_DST)&quot; filling cache.log due to AWS ELB healthchecks
</A></li>
	<LI>Next message (by thread): <A HREF="007399.html">[squid-users] dynamic ssl cert and active directory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7433">[ date ]</a>
              <a href="thread.html#7433">[ thread ]</a>
              <a href="subject.html#7433">[ subject ]</a>
              <a href="author.html#7433">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
