<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Strange Interaction between Squid and Facebook
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Strange%20Interaction%20between%20Squid%20and%20Facebook&In-Reply-To=%3CCAOZxD%2B%2BDwk1aOsEzm0DvW15qTnz-tBp%3D1UoHbgh56Amdt2R%2BMg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007456.html">
   <LINK REL="Next"  HREF="007440.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Strange Interaction between Squid and Facebook</H1>
    <B>Patrick Blair - Peapod</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Strange%20Interaction%20between%20Squid%20and%20Facebook&In-Reply-To=%3CCAOZxD%2B%2BDwk1aOsEzm0DvW15qTnz-tBp%3D1UoHbgh56Amdt2R%2BMg%40mail.gmail.com%3E"
       TITLE="[squid-users] Strange Interaction between Squid and Facebook">patrick.blair at ahold.com
       </A><BR>
    <I>Thu Oct 29 23:35:13 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007456.html">[squid-users] Strange Interaction between Squid and Facebook
</A></li>
        <LI>Next message (by thread): <A HREF="007440.html">[squid-users] Error: squid_ldap_group: No such file or directory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7451">[ date ]</a>
              <a href="thread.html#7451">[ thread ]</a>
              <a href="subject.html#7451">[ subject ]</a>
              <a href="author.html#7451">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Amos,

I ran squid with those debug options you indicated and here is the output
for requesting <A HREF="https://www.facebook.com">https://www.facebook.com</A> and
<A HREF="https://www.facebook.com/PeapodDelivers/">https://www.facebook.com/PeapodDelivers/</A>

access.log
1446160994.160    471 10.1.99.147 TCP_MISS/200 3628 CONNECT
api.ip2info.org:443 pblair HIER_DIRECT/178.63.49.5 -
1446160998.706     76 10.1.99.147 TCP_MISS/200 3197 CONNECT
static.xx.fbcdn.net:443 - HIER_DIRECT/31.13.74.7 -
1446160998.713     57 10.1.99.147 TCP_MISS/200 3198 CONNECT
static.xx.fbcdn.net:443 - HIER_DIRECT/31.13.74.7 -
1446160998.795     48 10.1.99.147 TCP_MISS/200 3198 CONNECT
scontent.xx.fbcdn.net:443 - HIER_DIRECT/31.13.74.7 -
1446160998.863     25 10.1.99.147 TCP_MISS/200 2074 POST
<A HREF="http://vassg142.ocsp.omniroot.com/">http://vassg142.ocsp.omniroot.com/</A> - HIER_DIRECT/96.17.10.89
application/ocsp-response
1446160999.000     61 10.1.99.147 TCP_MISS/200 3198 CONNECT
static.xx.fbcdn.net:443 - HIER_DIRECT/31.13.74.7 -
1446161028.891  30142 10.1.99.147 TCP_MISS/200 8547 CONNECT
fbcdn-dragon-a.akamaihd.net:443 - HIER_DIRECT/96.17.10.18 -
1446161033.696  59489 10.1.99.147 TCP_MISS/200 4953 CONNECT
play.google.com:443 - HIER_DIRECT/74.125.196.100 -
1446161042.680  64997 10.1.99.147 TCP_MISS/200 23601 CONNECT
mail.google.com:443 - HIER_DIRECT/74.125.21.17 -
1446161049.265    519 10.1.99.147 TCP_MISS/200 688 CONNECT
api.ip2info.org:443 pblair HIER_DIRECT/178.63.49.5 -
1446161082.351     48 10.1.99.147 TCP_MISS/200 3198 CONNECT
static.xx.fbcdn.net:443 - HIER_DIRECT/31.13.74.7 -
1446161091.418  58753 10.1.99.147 TCP_MISS/200 5520 CONNECT
plus.google.com:443 - HIER_DIRECT/74.125.21.139 -
1446161109.247    502 10.1.99.147 TCP_MISS/200 3628 CONNECT
api.ip2info.org:443

cache.log
2015/10/29 18:22:49 kid1| Starting Squid Cache version 3.3.8 for
x86_64-redhat-linux-gnu...
2015/10/29 18:23:13 kid1| Starting new basicauthenticator helpers...
2015/10/29 18:23:18.853 kid1| forward.cc(317) Start: '
<A HREF="http://vassg142.ocsp.omniroot.com/">http://vassg142.ocsp.omniroot.com/</A>'
2015/10/29 18:23:18.853 kid1| forward.cc(121) FwdState: Forwarding client
request local=10.46.128.68:10000 remote=10.1.99.147:61616 FD 22 flags=1,
url=<A HREF="http://vassg142.ocsp.omniroot.com/">http://vassg142.ocsp.omniroot.com/</A>
2015/10/29 18:23:18.853 kid1| forward.cc(368) startConnectionOrFail:
<A HREF="http://vassg142.ocsp.omniroot.com/">http://vassg142.ocsp.omniroot.com/</A>
2015/10/29 18:23:18.853 kid1| forward.cc(936) connectStart:
fwdConnectStart: <A HREF="http://vassg142.ocsp.omniroot.com/">http://vassg142.ocsp.omniroot.com/</A>
2015/10/29 18:23:18.853 kid1| forward.cc(1058) connectStart:
fwdConnectStart: got outgoing addr 0.0.0.0, tos 0, netfilter mark 0
2015/10/29 18:23:18.854 kid1| AsyncCall.cc(18) AsyncCall: The AsyncCall
fwdConnectDoneWrapper constructed, this=0x7f053becf100 [call619]
2015/10/29 18:23:18.857 kid1| AsyncCall.cc(85) ScheduleCall:
ConnOpener.cc(132) will call fwdConnectDoneWrapper(local=10.46.128.68:41365
remote=96.17.10.89:80 FD 23 flags=1, data=0x7f053becef68) [call619]
2015/10/29 18:23:18.857 kid1| AsyncCallQueue.cc(51) fireNext: entering
fwdConnectDoneWrapper(local=10.46.128.68:41365 remote=96.17.10.89:80 FD 23
flags=1, data=0x7f053becef68)
2015/10/29 18:23:18.857 kid1| AsyncCall.cc(30) make: make call
fwdConnectDoneWrapper [call619]
2015/10/29 18:23:18.857 kid1| forward.cc(883) connectDone: local=
10.46.128.68:41365 remote=96.17.10.89:80 FD 23 flags=1: '
<A HREF="http://vassg142.ocsp.omniroot.com/">http://vassg142.ocsp.omniroot.com/</A>'
2015/10/29 18:23:18.857 kid1| forward.cc(1074) dispatch: local=
10.46.128.68:10000 remote=10.1.99.147:61616 FD 22 flags=1: Fetching 'POST
<A HREF="http://vassg142.ocsp.omniroot.com/">http://vassg142.ocsp.omniroot.com/</A>'
2015/10/29 18:23:18.857 kid1| AsyncCallQueue.cc(53) fireNext: leaving
fwdConnectDoneWrapper(local=10.46.128.68:41365 remote=96.17.10.89:80 FD 23
flags=1, data=0x7f053becef68)
2015/10/29 18:23:18.863 kid1| forward.cc(426) unregister:
<A HREF="http://vassg142.ocsp.omniroot.com/">http://vassg142.ocsp.omniroot.com/</A>
2015/10/29 18:23:18.863 kid1| forward.cc(451) complete:
<A HREF="http://vassg142.ocsp.omniroot.com/">http://vassg142.ocsp.omniroot.com/</A>
        status 200
2015/10/29 18:23:18.863 kid1| forward.cc(1212) reforward:
<A HREF="http://vassg142.ocsp.omniroot.com/?">http://vassg142.ocsp.omniroot.com/?</A>
2015/10/29 18:23:18.863 kid1| forward.cc(1215) reforward: No,
ENTRY_FWD_HDR_WAIT isn't set
2015/10/29 18:23:18.863 kid1| forward.cc(475) complete: server (FD closed)
not re-forwarding status 200
2015/10/29 18:23:18.863 kid1| forward.cc(248) ~FwdState: FwdState
destructor starting
2015/10/29 18:23:18.863 kid1| AsyncCall.cc(48) cancel: will not call
fwdConnectDoneWrapper [call619] because FwdState destructed
2015/10/29 18:23:18.863 kid1| forward.cc(278) ~FwdState: FwdState
destructor done

It doesn't look like it's showing anything for the facebook request, just
the ocsp one.

I forgot to mention as well in my earlier reply, we have the proxy
listening over port 10000 if that makes a difference.

For your question:

&gt;<i> Is it breaking only when Squid is in the &quot;other&quot; datacenter from the
</I>&gt;<i> client(s) ?
</I>
Not sure if I answered that completely. Clients that are &quot;local&quot; to that
datacenter and not local to it have the same response, however I have been
making my tests from the same location.

Thanks again for your response, please let me know if I can provide any
further information.

Pat Blair
Sr. Unix Administrator
Peapod, LLC
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">pblair at peapod.com</A>

-- 
This email and any attachments may contain information that is proprietary,
confidential and/or privileged and for the sole use of the intended 
recipients(s)
only.
If you are not the intended recipient, please notify the sender by return
email and delete all copies of this email and any attachments. Ahold and/or 
its
subsidiaries shall neither be liable for the inaccurate or incomplete 
transmission
of the information contained in this email or any attachments, nor for any 
delay
in its receipt. To the extent this email is intended to create any legal 
obligation,
the obligation shall bind only the contracting entity and not any other 
entity within
the Ahold Group.

-- 
This email and any attachments may contain information that is proprietary,
confidential and/or privileged and for the sole use of the intended 
recipients(s)
only.
If you are not the intended recipient, please notify the sender by return
email and delete all copies of this email and any attachments. Ahold and/or 
its
subsidiaries shall neither be liable for the inaccurate or incomplete 
transmission
of the information contained in this email or any attachments, nor for any 
delay
in its receipt. To the extent this email is intended to create any legal 
obligation,
the obligation shall bind only the contracting entity and not any other 
entity within
the Ahold Group.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20151029/d144c339/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20151029/d144c339/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007456.html">[squid-users] Strange Interaction between Squid and Facebook
</A></li>
	<LI>Next message (by thread): <A HREF="007440.html">[squid-users] Error: squid_ldap_group: No such file or directory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7451">[ date ]</a>
              <a href="thread.html#7451">[ thread ]</a>
              <a href="subject.html#7451">[ subject ]</a>
              <a href="author.html#7451">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
