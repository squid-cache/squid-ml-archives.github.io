<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Strange Interaction between Squid and Facebook
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Strange%20Interaction%20between%20Squid%20and%20Facebook&In-Reply-To=%3C5632D14D.10701%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007450.html">
   <LINK REL="Next"  HREF="007455.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Strange Interaction between Squid and Facebook</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Strange%20Interaction%20between%20Squid%20and%20Facebook&In-Reply-To=%3C5632D14D.10701%40ngtech.co.il%3E"
       TITLE="[squid-users] Strange Interaction between Squid and Facebook">eliezer at ngtech.co.il
       </A><BR>
    <I>Fri Oct 30 02:09:17 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007450.html">[squid-users] Strange Interaction between Squid and Facebook
</A></li>
        <LI>Next message (by thread): <A HREF="007455.html">[squid-users] Strange Interaction between Squid and Facebook
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7453">[ date ]</a>
              <a href="thread.html#7453">[ thread ]</a>
              <a href="subject.html#7453">[ subject ]</a>
              <a href="author.html#7453">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Patrick,

Thanks for clearing the picture out.
Since it's HTTPS traffic it will might be a bit difficult to debug.

I wanted to notify you that squid 3.5.10 is suffering from some bugs but 
it is very hard for me to actually find this specific issue meet any of 
the know bugs else then one bug(something with ssl-bump).

One thing I can think of in this scenario in order to maybe somehow 
change how things are would be to use a second proxy just for the test.
If you can run another proxy on a tiny VM with another IP on the same DC 
as the existing one it would narrow down couple things.
If it works OK with squid default conf file then try to assign the IP of 
the problematic proxy to the new one.
If it works with the same IP it's an issue with something in the proxy 
setup or the conf.


Another approach would be to use the secondary DC proxy as a cache_peer 
of the primary DC proxy to verify if it affects the traffic in a similar 
way.

--
In the first post you have mentioned this link:
<A HREF="http://wiki.squid-cache.org/ConfigExamples/SmpCarpCluster">http://wiki.squid-cache.org/ConfigExamples/SmpCarpCluster</A>

This specific example was intended for caching optimization or something 
similar.
Since your case involves CONNECT requests which cannot be cached anyway 
and also this CARP has certain limitations I would first try to simplify 
the setup into a no-disk RAM only cache with couple workers rather then 
multi workers peering.
The CARP example actually limits the whole service to the frontend 
capabilities and there for it's recommended to not use it if possible.
Try a default squid.conf if possible.

Since the issue can be reproduced very easily testing the different 
options will take couple minutes and can be done after work hours.

The above options is what I would have tried with my own servers.

Eliezer

On 30/10/2015 01:17, Patrick Blair - Peapod wrote:
&gt;<i> It is very unclear, our network team is trying to determine if a
</I>&gt;<i> network issue may be in play, but we believe that is unlikely...
</I>&gt;<i>
</I>&gt;<i> I couldn't understand how you ran the tests.
</I>&gt;&gt;<i> &gt;I do understand that you have two proxies and one is peering to the
</I>&gt;&gt;<i> &gt;other, right?
</I>&gt;<i> Apologies if that wasn't clear, I'll try to give a better explanation:
</I>&gt;<i>
</I>&gt;<i>     - There is always one proxy in this situation.
</I>&gt;<i>     - The difference is that we run the proxy out of our secondary
</I>&gt;<i>     datacenter and route all user internet traffic through that location so it
</I>&gt;<i>     doesn't cause any issues with the traffic to our website flowing in and out
</I>&gt;<i>     of our primary datacenter.
</I>&gt;<i>     - A test instance I used to recreate the squid instance that is having
</I>&gt;<i>     the issues with, works as expected in our primary datacenter, however, the
</I>&gt;<i>     older version of squid we were using is located in the secondary datacenter
</I>&gt;<i>     and also works as expected, only the newer version doesn't work.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks for your help!
</I>&gt;<i>
</I>&gt;<i> Pat Blair
</I>&gt;<i> Sr. Unix Administrator
</I>&gt;<i> Peapod, LLC
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">pblair at peapod.com</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007450.html">[squid-users] Strange Interaction between Squid and Facebook
</A></li>
	<LI>Next message (by thread): <A HREF="007455.html">[squid-users] Strange Interaction between Squid and Facebook
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7453">[ date ]</a>
              <a href="thread.html#7453">[ thread ]</a>
              <a href="subject.html#7453">[ subject ]</a>
              <a href="author.html#7453">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
