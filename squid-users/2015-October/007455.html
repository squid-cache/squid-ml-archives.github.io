<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Strange Interaction between Squid and Facebook
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Strange%20Interaction%20between%20Squid%20and%20Facebook&In-Reply-To=%3CCAOZxD%2B%2BMUWL41e0b%2B-%2BUDiYu%3DCWHpS0-cZXgL-Lt_6Y3yZDBSA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007453.html">
   <LINK REL="Next"  HREF="007456.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Strange Interaction between Squid and Facebook</H1>
    <B>Patrick Blair - Peapod</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Strange%20Interaction%20between%20Squid%20and%20Facebook&In-Reply-To=%3CCAOZxD%2B%2BMUWL41e0b%2B-%2BUDiYu%3DCWHpS0-cZXgL-Lt_6Y3yZDBSA%40mail.gmail.com%3E"
       TITLE="[squid-users] Strange Interaction between Squid and Facebook">patrick.blair at ahold.com
       </A><BR>
    <I>Fri Oct 30 03:24:25 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007453.html">[squid-users] Strange Interaction between Squid and Facebook
</A></li>
        <LI>Next message (by thread): <A HREF="007456.html">[squid-users] Strange Interaction between Squid and Facebook
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7455">[ date ]</a>
              <a href="thread.html#7455">[ thread ]</a>
              <a href="subject.html#7455">[ subject ]</a>
              <a href="author.html#7455">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Eliezer,

Thanks for your response.

I have set up a VM to test out configurations in the same data center and
address space as the problematic one.
What I haven't done is test it by rebuilding the squid configuration from
the defaults up and trying to use the same IP, that will probably be what
I'll try tomorrow.

Also, thanks for the tip on the CARP example. I was trying to find a
configuration that took advantage of SMP, but I see how that complicates
things further.

Thanks so much for the suggestions! I'll update this thread further if
things start working a bit better.
And thank you again for packaging newer squid versions for CentOS!

Pat Blair
Sr. Unix Administrator
Peapod, LLC
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">pblair at peapod.com</A>
On Oct 29, 2015 21:09, &quot;Eliezer Croitoru&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt; wrote:

&gt;<i> Hey Patrick,
</I>&gt;<i>
</I>&gt;<i> Thanks for clearing the picture out.
</I>&gt;<i> Since it's HTTPS traffic it will might be a bit difficult to debug.
</I>&gt;<i>
</I>&gt;<i> I wanted to notify you that squid 3.5.10 is suffering from some bugs but
</I>&gt;<i> it is very hard for me to actually find this specific issue meet any of the
</I>&gt;<i> know bugs else then one bug(something with ssl-bump).
</I>&gt;<i>
</I>&gt;<i> One thing I can think of in this scenario in order to maybe somehow change
</I>&gt;<i> how things are would be to use a second proxy just for the test.
</I>&gt;<i> If you can run another proxy on a tiny VM with another IP on the same DC
</I>&gt;<i> as the existing one it would narrow down couple things.
</I>&gt;<i> If it works OK with squid default conf file then try to assign the IP of
</I>&gt;<i> the problematic proxy to the new one.
</I>&gt;<i> If it works with the same IP it's an issue with something in the proxy
</I>&gt;<i> setup or the conf.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Another approach would be to use the secondary DC proxy as a cache_peer of
</I>&gt;<i> the primary DC proxy to verify if it affects the traffic in a similar way.
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> In the first post you have mentioned this link:
</I>&gt;<i> <A HREF="http://wiki.squid-cache.org/ConfigExamples/SmpCarpCluster">http://wiki.squid-cache.org/ConfigExamples/SmpCarpCluster</A>
</I>&gt;<i>
</I>&gt;<i> This specific example was intended for caching optimization or something
</I>&gt;<i> similar.
</I>&gt;<i> Since your case involves CONNECT requests which cannot be cached anyway
</I>&gt;<i> and also this CARP has certain limitations I would first try to simplify
</I>&gt;<i> the setup into a no-disk RAM only cache with couple workers rather then
</I>&gt;<i> multi workers peering.
</I>&gt;<i> The CARP example actually limits the whole service to the frontend
</I>&gt;<i> capabilities and there for it's recommended to not use it if possible.
</I>&gt;<i> Try a default squid.conf if possible.
</I>&gt;<i>
</I>&gt;<i> Since the issue can be reproduced very easily testing the different
</I>&gt;<i> options will take couple minutes and can be done after work hours.
</I>&gt;<i>
</I>&gt;<i> The above options is what I would have tried with my own servers.
</I>&gt;<i>
</I>&gt;<i> Eliezer
</I>&gt;<i>
</I>&gt;<i> On 30/10/2015 01:17, Patrick Blair - Peapod wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> It is very unclear, our network team is trying to determine if a
</I>&gt;&gt;<i> network issue may be in play, but we believe that is unlikely...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I couldn't understand how you ran the tests.
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> &gt;I do understand that you have two proxies and one is peering to the
</I>&gt;&gt;&gt;<i> &gt;other, right?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i> Apologies if that wasn't clear, I'll try to give a better explanation:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     - There is always one proxy in this situation.
</I>&gt;&gt;<i>     - The difference is that we run the proxy out of our secondary
</I>&gt;&gt;<i>     datacenter and route all user internet traffic through that location
</I>&gt;&gt;<i> so it
</I>&gt;&gt;<i>     doesn't cause any issues with the traffic to our website flowing in
</I>&gt;&gt;<i> and out
</I>&gt;&gt;<i>     of our primary datacenter.
</I>&gt;&gt;<i>     - A test instance I used to recreate the squid instance that is having
</I>&gt;&gt;<i>     the issues with, works as expected in our primary datacenter,
</I>&gt;&gt;<i> however, the
</I>&gt;&gt;<i>     older version of squid we were using is located in the secondary
</I>&gt;&gt;<i> datacenter
</I>&gt;&gt;<i>     and also works as expected, only the newer version doesn't work.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks for your help!
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Pat Blair
</I>&gt;&gt;<i> Sr. Unix Administrator
</I>&gt;&gt;<i> Peapod, LLC
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">pblair at peapod.com</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>
-- 
This email and any attachments may contain information that is proprietary,
confidential and/or privileged and for the sole use of the intended 
recipients(s)
only.
If you are not the intended recipient, please notify the sender by return
email and delete all copies of this email and any attachments. Ahold and/or 
its
subsidiaries shall neither be liable for the inaccurate or incomplete 
transmission
of the information contained in this email or any attachments, nor for any 
delay
in its receipt. To the extent this email is intended to create any legal 
obligation,
the obligation shall bind only the contracting entity and not any other 
entity within
the Ahold Group.

-- 
This email and any attachments may contain information that is proprietary,
confidential and/or privileged and for the sole use of the intended 
recipients(s)
only.
If you are not the intended recipient, please notify the sender by return
email and delete all copies of this email and any attachments. Ahold and/or 
its
subsidiaries shall neither be liable for the inaccurate or incomplete 
transmission
of the information contained in this email or any attachments, nor for any 
delay
in its receipt. To the extent this email is intended to create any legal 
obligation,
the obligation shall bind only the contracting entity and not any other 
entity within
the Ahold Group.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20151029/0441dfe1/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20151029/0441dfe1/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007453.html">[squid-users] Strange Interaction between Squid and Facebook
</A></li>
	<LI>Next message (by thread): <A HREF="007456.html">[squid-users] Strange Interaction between Squid and Facebook
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7455">[ date ]</a>
              <a href="thread.html#7455">[ thread ]</a>
              <a href="subject.html#7455">[ subject ]</a>
              <a href="author.html#7455">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
