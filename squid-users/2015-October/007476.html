<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSL-Bump to specific users
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL-Bump%20to%20specific%20users&In-Reply-To=%3C5633AD71.2010209%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007475.html">
   <LINK REL="Next"  HREF="007477.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSL-Bump to specific users</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL-Bump%20to%20specific%20users&In-Reply-To=%3C5633AD71.2010209%40measurement-factory.com%3E"
       TITLE="[squid-users] SSL-Bump to specific users">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Oct 30 17:48:33 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007475.html">[squid-users] SSL-Bump to specific users
</A></li>
        <LI>Next message (by thread): <A HREF="007477.html">[squid-users] SSL-Bump to specific users
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7476">[ date ]</a>
              <a href="thread.html#7476">[ thread ]</a>
              <a href="subject.html#7476">[ subject ]</a>
              <a href="author.html#7476">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/30/2015 10:36 AM, Rodrigo de Lima Silva wrote:

&gt;<i> There's a way to join ssl_bump + a simple acl? Basicly, I would like to
</I>&gt;<i> permit access to some sites, like facebbok, linkedin, for example.
</I>&gt;<i> during a period of day time, for example:
</I>&gt;<i> 
</I>&gt;<i> acl after_work time MTWHFAS 18:00-21:00
</I>&gt;<i> ssl_bump terminate deny_https_sites !after_work
</I>
You can use any ACL (or any combination of ACLs) with ssl_bump rules if
the ACLs you are using have enough information to work correctly during
ssl_bump steps. For example, the &quot;time&quot; ACL always has enough information.

SslBump steps only have access to information in an HTTP CONNECT request
(or equivalent). What information is available in that CONNECT request
depends on Squid version, Squid configuration, current transaction, and
current SslBump step. I do not think there is detailed documentation
about available information. Somebody should write it.

Alex.


&gt;<i> 2015-10-29 20:35 GMT-02:00 Alex Rousskov:
</I>&gt;<i> 
</I>&gt;<i>     On 10/29/2015 04:09 PM, Rodrigo de Lima Silva wrote:
</I>&gt;<i> 
</I>&gt;<i>     &gt; I've been configured Squid version 3.5.9 and transparent proxy. To do
</I>&gt;<i>     &gt; this. I used the &quot;peek and splice&quot; feature to works with https protocol
</I>&gt;<i>     &gt; in transparent mode. It's works fine.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; There is a &quot;acl&quot; to block some sites, like facebook.com &lt;<A HREF="http://facebook.com">http://facebook.com</A>&gt;
</I>&gt;<i>     &gt; &lt;<A HREF="http://facebook.com">http://facebook.com</A>&gt;, linkedin.com &lt;<A HREF="http://linkedin.com">http://linkedin.com</A>&gt;
</I>&gt;<i>     &lt;<A HREF="http://linkedin.com">http://linkedin.com</A>&gt;, etc... It's
</I>&gt;<i>     &gt; works fine too.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; acl deny_https_sites ssl::server_name_regex &quot;/etc/squid/https_url.txt&quot;
</I>&gt;<i>     &gt; ssl_bump terminate deny_https_sites
</I>&gt;<i>     &gt; ssl_bump peek all
</I>&gt;<i>     &gt; ssl_bump splice all
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     The above is kind of wrong because it may terminate before learning
</I>&gt;<i>     enough about the connection. You should terminate after peeking:
</I>&gt;<i> 
</I>&gt;<i>       acl ...
</I>&gt;<i> 
</I>&gt;<i>       ssl_bump peek all
</I>&gt;<i>       ssl_bump terminate deny_https_sites
</I>&gt;<i>       ssl_bump splice all
</I>&gt;<i> 
</I>&gt;<i>     Peeking feeds your deny_https_sites ACL with information. Without
</I>&gt;<i>     peeking, that ACL may only have IP addresses to work with (especially in
</I>&gt;<i>     an interception environment).
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     &gt; But, now, I need to do an rule to permit access for specific users, or
</I>&gt;<i>     &gt; ip address. But, I don't know if it's possible with ssl_bump. I tried
</I>&gt;<i>     &gt; somethink like:
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; ssl_bump terminate deny_https_sites !permited_ips
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; or
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; ssl_bump peek deny_https_sites permited_ips
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; There is one way to do this?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     The first variant is theoretically correct, but I recommend avoiding
</I>&gt;<i>     negation in ACLs: An ACL result is not a boolean &quot;match&quot; or &quot;mismatch&quot;.
</I>&gt;<i>     It is actually closer to &quot;match&quot;, &quot;mismatch&quot;, &quot;do not know&quot;, or &quot;error&quot;.
</I>&gt;<i>     Negating four values correctly is difficult, and Squid itself has had
</I>&gt;<i>     many bugs in that area.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     If you can truly identify &quot;specific users&quot; by IP, then do that first (no
</I>&gt;<i>     need to peek):
</I>&gt;<i> 
</I>&gt;<i>       ssl_bump splice permited_ips
</I>&gt;<i>       ssl_bump peek all
</I>&gt;<i>       ssl_bump terminate deny_https_sites
</I>&gt;<i>       ssl_bump splice all
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     If your actual &quot;specific user&quot; ACL needs host name information, then let
</I>&gt;<i>     Squid peek first:
</I>&gt;<i> 
</I>&gt;<i>       ssl_bump peek all
</I>&gt;<i>       ssl_bump splice specific_users
</I>&gt;<i>       ssl_bump terminate deny_https_sites
</I>&gt;<i>       ssl_bump splice all
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     Your questions indicate that you may not understand how Squid evaluates
</I>&gt;<i>     ACL rules. Proceed with caution and try reading a guide book or a good
</I>&gt;<i>     tutorial. The basic single-rule evaluation algorithm is not specific to
</I>&gt;<i>     SslBump (although multiple ssl_bump directives add more complexity).
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     Good luck,
</I>&gt;<i> 
</I>&gt;<i>     Alex.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -- 
</I>&gt;<i> Rodrigo Lima  - rodrigodlima[at]gmail[dot]com
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007475.html">[squid-users] SSL-Bump to specific users
</A></li>
	<LI>Next message (by thread): <A HREF="007477.html">[squid-users] SSL-Bump to specific users
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7476">[ date ]</a>
              <a href="thread.html#7476">[ thread ]</a>
              <a href="subject.html#7476">[ subject ]</a>
              <a href="author.html#7476">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
