<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSL-Bump to specific users
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL-Bump%20to%20specific%20users&In-Reply-To=%3C5633DC31.4070007%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007477.html">
   <LINK REL="Next"  HREF="007452.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSL-Bump to specific users</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL-Bump%20to%20specific%20users&In-Reply-To=%3C5633DC31.4070007%40treenet.co.nz%3E"
       TITLE="[squid-users] SSL-Bump to specific users">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Oct 30 21:08:01 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="007477.html">[squid-users] SSL-Bump to specific users
</A></li>
        <LI>Next message (by thread): <A HREF="007452.html">[squid-users] Squid with SMP, CARP and a forwarding loop
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7478">[ date ]</a>
              <a href="thread.html#7478">[ thread ]</a>
              <a href="subject.html#7478">[ subject ]</a>
              <a href="author.html#7478">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 31/10/2015 7:36 a.m., Rodrigo de Lima Silva wrote:
&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> There's a way to join ssl_bump + a simple acl? Basicly, I would like to
</I>&gt;&gt;&gt;<i> permit access to some sites, like facebbok, linkedin, for example.
</I>&gt;&gt;<i> during a
</I>&gt;&gt;&gt;<i> period of day time, for example:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> acl after_work time MTWHFAS 18:00-21:00
</I>&gt;&gt;&gt;<i> ssl_bump terminate deny_https_sites !after_work
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Once you understand what the &quot;Common Mistakes&quot; section of the ACL wiki
</I>&gt;&gt;<i> page is talking about you will know the answer to your question. It
</I>&gt;&gt;<i> describes the problem Alex was talking about, but in slightly simpler
</I>&gt;&gt;<i> terms.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hint: you say you want to permit things. But you are writing rules with
</I>&gt;&gt;<i> &quot;deny&quot; / &quot;terminate&quot; as the action for Squid to do. Seems a bit
</I>&gt;&gt;<i> backwards, yes?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i> Hi Amos,
</I>&gt;<i> Sorry, but I wrote very fast the last email and could not describe
</I>&gt;<i> very well what
</I>&gt;<i> I'm trying to do and it got confused.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> PS. Apologies if we seems to be obstructing. But you really do need to
</I>&gt;&gt;<i> properly know how Squid ACLs work if you are going to be configuring
</I>&gt;&gt;<i> Squid. They are used for controlling almost everything, as you will see
</I>&gt;&gt;<i> in those wiki pages.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i> It's all rigth ;-)
</I>&gt;<i> Basically, the idea is to block access certain websites during office hours
</I>&gt;<i> and after this time allow access.
</I>&gt;<i> To do this with simple acl is easy,
</I>&gt;<i> 
</I>
Your still doing the policy description != policy rules thing.

Whereas your last emails rules match the above description.
Below is a policy that matches your last emails description.

&gt;<i> acl after_work time MTWHFAS 17:00-21:00
</I>&gt;<i> http_access allow deny_sites after_work
</I>&gt;<i> http_access deny deny_sites
</I>&gt;<i> 
</I>&gt;<i> But, on transparent mode, I'm getting confused to do this with sslbump and
</I>&gt;<i> https sites.
</I>
Stop thinking of HTTPS as a single thing. It is not.

It is a TLS protocol layer, with an HTTP protocol layer inside it. The
TLS layer has its own messages completely different and separate from
the HTTP ones.

http_access rules tell Squid what to do with HTTP layer messages. Either
the ones Squid is receiving straight on top of TCP (aka plain text
HTTP), or ones it decrypted from inside the TLS layer (aka HTTPS).

ssl_bump tells Squid how to treat each of the TLS layer operations that
occur before the first encrypted HTTPS message. We call them stage 1, 2
and 3.


Your configuration so far is using splice to mean allow and terminate to
mean deny. But the peek and splice feature is not http_access, it is a
bit more complicated than allow/deny.

There is _type_ of metadata the ACLs are accessing (CONNECT wrapper
[step1], client handshake data [step2], server certificate [step3])
affecting what the ACLs will match against. Then what was done at the
previous step(s) affect what actions are possible now.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="007477.html">[squid-users] SSL-Bump to specific users
</A></li>
	<LI>Next message (by thread): <A HREF="007452.html">[squid-users] Squid with SMP, CARP and a forwarding loop
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7478">[ date ]</a>
              <a href="thread.html#7478">[ thread ]</a>
              <a href="subject.html#7478">[ subject ]</a>
              <a href="author.html#7478">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
