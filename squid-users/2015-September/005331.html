<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] refresh_pattern and same objects
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20refresh_pattern%20and%20same%20objects&In-Reply-To=%3C55E5F534.1030108%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005330.html">
   <LINK REL="Next"  HREF="005334.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] refresh_pattern and same objects</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20refresh_pattern%20and%20same%20objects&In-Reply-To=%3C55E5F534.1030108%40gmail.com%3E"
       TITLE="[squid-users] refresh_pattern and same objects">yvoinov at gmail.com
       </A><BR>
    <I>Tue Sep  1 18:57:56 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005330.html">[squid-users] refresh_pattern and same objects
</A></li>
        <LI>Next message (by thread): <A HREF="005334.html">[squid-users] refresh_pattern and same objects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5331">[ date ]</a>
              <a href="thread.html#5331">[ thread ]</a>
              <a href="subject.html#5331">[ subject ]</a>
              <a href="author.html#5331">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256
 
This is bad idea - to cache the same gifs with unique parameters. They
keeps unchanged for one HTTP-session in best case. You cache will
overloads with this small same gifs with unique parameters. Only store
ID saves this situation. In other hand, you must cache all Internet and
all it variations. Yes, Vary is evil. But web-masters which is fight
against caching is more evil.

02.09.15 0:16, Marcus Kool &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 09/01/2015 03:08 PM, Yuri Voinov wrote:
</I>&gt;&gt;<i>
</I>&gt;<i> Better to write store-id rule which cut off parameters and store gif.
</I>&gt;<i>
</I>&gt;<i> Something like this:
</I>&gt;<i>
</I>&gt;<i>
</I>^https?:\/\/(.+?)\/(.+?)\.(js|css|jp(?:e?g|e|2)|gif|png|bmp|ico|svg|web(p|m))
&gt;<i> <A HREF="http://$1.squidinternal/$2.$3">http://$1.squidinternal/$2.$3</A>
</I>&gt;<i>
</I>&gt;<i> And, of course, universal rule for store_id_access.
</I>&gt;<i>
</I>&gt;<i> &gt; I think that this works well for trackers gifs but not for other
</I>gifs with parameters.
&gt;<i>
</I>&gt;<i> Store ID is powerful instrument for deduplication cache story. Which
</I>&gt;<i> permits not to use terabytes disks.
</I>&gt;<i>
</I>&gt;<i> 02.09.15 0:00, Marcus Kool &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; On 09/01/2015 05:14 AM, FredB wrote:
</I>&gt;<i> &gt;&gt;&gt;&gt; More precisely
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt; I reduced the ttl of the first line
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt; refresh_pattern -i \.(htm|html|xml|css)(\?.*)?$ 10080 100% 10080
</I>&gt;<i> &gt;&gt;&gt;&gt; #All File 30 days max
</I>&gt;<i> &gt;&gt;&gt;&gt; refresh_pattern -i
</I>&gt;<i> \.(3gp|7z|ace|asx|bin|deb|divx|dvr-ms|ram|rpm|exe|inc|cab|qt)(\?.*)?$
</I>&gt;<i> 43200 100% 43200 ignore-no-store reload-into-ims store-stale
</I>&gt;<i> &gt;&gt;&gt;&gt; refresh_pattern -i
</I>&gt;<i> \.(rar|jar|gz|tgz|bz2|iso|m1v|m2(v|p)|mo(d|v)|arj|lha|lzh|zip|tar)(\?.*)?$
</I>&gt;<i> 43200 100% 43200 ignore-no-store reload-into-ims store-stale
</I>&gt;<i> &gt;&gt;&gt;&gt; refresh_pattern -i
</I>&gt;<i> \.(jp(e?g|e|2)|gif|pn[pg]|bm?|ico|swf|dat|ad|txt|dll)(\?.*)?$ 43200 100%
</I>&gt;<i> 43200 ignore-no-store reload-into-ims store-stale
</I>&gt;<i> &gt;&gt;&gt;&gt; refresh_pattern -i
</I>&gt;<i>
</I>\.(avi|ac4|mp(e?g|a|e|1|2|3|4)|mk(a|v)|ms(i|u|p)|og(x|v|a|g)|rm|r(a|p)m|snd|vob)(\?.*)?$
&gt;<i> 43200 100% 43200 ignore-no-store reload-into-ims store-stale
</I>&gt;<i> &gt;&gt;&gt;&gt; refresh_pattern -i
</I>&gt;<i>
</I>\.(pp(t?x)|s|t)|pdf|rtf|wax|wm(a|v)|wmx|wpl|cb(r|z|t)|xl(s?x)|do(c?x)|flv|x-flv)(\?.*)?$
&gt;<i> 43200 100% 43200 ignore-no-store reload-into-ims store-stale
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; trackers use a 1x1 gif extensively and they usually have parameters,
</I>&gt;<i> e.g.
</I>&gt;<i>
</I>www.example.com/track.gif?browser=chrome&amp;allsortsofdata&amp;random=RANDOMNUMBER
&gt;<i> &gt;&gt;&gt; and these trackers are not cacheable since the parameters are never
</I>&gt;<i> the same.
</I>&gt;<i> &gt;&gt;&gt; So for gif, I suggest to
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; refresh_pattern -i \.gif$   43200 100% 43200 ignore-no-store
</I>&gt;<i> reload-into-ims store-stale
</I>&gt;<i> &gt;&gt;&gt; refresh_pattern -i \.gif\?  0 0% 0
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Marcus
</I>&gt;<i> &gt;&gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt;&gt; squid-users mailing list
</I>&gt;<i> &gt;&gt;&gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt;&gt;&gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBCAAGBQJV5fU0AAoJENNXIZxhPexGQZsIAL2/UW7K9HzbwP166GAFiERe
12fm9Y7BL9ryw9JMF3sKcq0qvUXvLc4liCVAQLzl8VLbVrF59xJMSXc7ljCy2iCE
Str2h6mzIOklPyyFctvl1vq8J3upRH7EsN6oZn99RM1Y3ICxhO6aV1pgHGAnF4TS
166LJeBrJVGwc+gWo1V+LL1oGem5U2RMkQNBgFTzpAcQAYv60ai0tz9OExO6LRKD
vl9lGFVIQ/wMBU1jbbKZGLBDReqgmZnl25kqfVc8zWyu1zMt6cb3ZaRYeCVrEX6q
MhFG+sOMLhk6OPaNiuqftdAXZ4UUjvRN951X1kWTe18D/LFfh31sGwUiyZxb04U=
=P8m3
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150902/9cd2df8e/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150902/9cd2df8e/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005330.html">[squid-users] refresh_pattern and same objects
</A></li>
	<LI>Next message (by thread): <A HREF="005334.html">[squid-users] refresh_pattern and same objects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5331">[ date ]</a>
              <a href="thread.html#5331">[ thread ]</a>
              <a href="subject.html#5331">[ subject ]</a>
              <a href="author.html#5331">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
