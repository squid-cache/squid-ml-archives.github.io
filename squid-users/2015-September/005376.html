<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Lots of &quot;Vary object loop!&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Lots%20of%20%22Vary%20object%20loop%21%22&In-Reply-To=%3C55E895FF.90006%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005374.html">
   <LINK REL="Next"  HREF="005377.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Lots of &quot;Vary object loop!&quot;</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Lots%20of%20%22Vary%20object%20loop%21%22&In-Reply-To=%3C55E895FF.90006%40treenet.co.nz%3E"
       TITLE="[squid-users] Lots of &quot;Vary object loop!&quot;">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Sep  3 18:48:31 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005374.html">[squid-users] Lots of &quot;Vary object loop!&quot;
</A></li>
        <LI>Next message (by thread): <A HREF="005377.html">[squid-users] Lots of &quot;Vary object loop!&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5376">[ date ]</a>
              <a href="thread.html#5376">[ thread ]</a>
              <a href="subject.html#5376">[ subject ]</a>
              <a href="author.html#5376">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 4/09/2015 6:24 a.m., Sebasti&#225;n Goicochea wrote:
&gt;<i> Regarding configure options, I disable IPv6 because of the latency that
</I>&gt;<i> adds to DNS queries, enable-ssl could be removed, gnuregex gave no
</I>&gt;<i> problems (or that I think).
</I>&gt;<i> 
</I>&gt;<i> That options on the config file are the core of my configuration. Just
</I>&gt;<i> stripped ACLs and that kind of stuff to make it shorter, and I also
</I>&gt;<i> stripped the part of the rewriter (because I have it commented at the
</I>&gt;<i> moment).
</I>&gt;<i> Could any of the misconfigurations you mention could be causing this
</I>&gt;<i> Vary loop?
</I>
In summary;
  it looks like you may have been using SMP workers in an unsafe manner
(simetime recently perhapse) and screwed over your cache_dir. A full
cache re-scan is probably in order to fix it.


In detail;

What I noticed particularly was that you have a section of SMP
configuration. And that later you have &quot;cache_dir diskd ...&quot; without any
SMP protections. But what you posted did not say &quot;workers&quot; directive so
I was unsure.

If you have at any time run that config file with the &quot;workers&quot;
directive in it, then those diskd caches will have been randomly
overwriting each others stored content. Almost guaranteeing these types
of problem and other SWAPFAIL events as well. Even if workers was for
only happening for a short time, disk cache corruption is persistent.

You have two options.

1) wait until all the collisions have been found and erased. That could
take a while to happen naturally.

2) stop Squid, erase the swap.state in those cache_dir and restart
Squid. The slow &quot;DIRTY&quot; rebuild will fix collision type corruptions.


In related settings you have shared memory cache disabled and rock store
in use. Disabling shared memory and running with SMP workers might make
rock store collide as well - though I'm not sure of that. It does
nothing in a non-SMP configuration.

If the rock is corrupted it self-heals pretty quickly. Just restart
Squid and that happens.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005374.html">[squid-users] Lots of &quot;Vary object loop!&quot;
</A></li>
	<LI>Next message (by thread): <A HREF="005377.html">[squid-users] Lots of &quot;Vary object loop!&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5376">[ date ]</a>
              <a href="thread.html#5376">[ thread ]</a>
              <a href="subject.html#5376">[ subject ]</a>
              <a href="author.html#5376">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
