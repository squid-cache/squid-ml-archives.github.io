<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Building squid | Best Practices?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Building%20squid%20%7C%20Best%20Practices%3F&In-Reply-To=%3C55EE3D96.70008%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005443.html">
   <LINK REL="Next"  HREF="005446.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Building squid | Best Practices?</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Building%20squid%20%7C%20Best%20Practices%3F&In-Reply-To=%3C55EE3D96.70008%40treenet.co.nz%3E"
       TITLE="[squid-users] Building squid | Best Practices?">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Sep  8 01:44:54 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005443.html">[squid-users] Building squid | Best Practices?
</A></li>
        <LI>Next message (by thread): <A HREF="005446.html">[squid-users] recompiling squid 3.5.7
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5444">[ date ]</a>
              <a href="thread.html#5444">[ thread ]</a>
              <a href="subject.html#5444">[ subject ]</a>
              <a href="author.html#5444">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 8/09/2015 6:32 a.m., Howard Waterfall wrote:
&gt;<i> Rafael / Amos -
</I>&gt;<i> I got my system up and running yesterday. Thanks so much for the help. I
</I>&gt;<i> couldn't get some of the suggestions that Amos made to work, but they did
</I>&gt;<i> after running some of the commands on Rafael's wiki, so a real team effort!
</I>&gt;<i> 
</I>&gt;<i> After getting it up and running, I found that mac address filtering was not
</I>&gt;<i> working. On closer inspection I found that I was running v3.3.8. I guess
</I>&gt;<i> that&#8217;s the version my new Ubuntu install (14.04.03 LTS) uses with:
</I>&gt;<i> 
</I>&gt;<i> sudo apt-get install squid
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I decided to try and build the latest version of squid from source and I
</I>&gt;<i> ran into some more problems I cannot solve, so some follow up questions
</I>&gt;<i> 
</I>&gt;<i> 1) Earlier in the thread, Amos suggested I run:
</I>&gt;<i> 
</I>&gt;<i> apt-get build-dep squid
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> to install the packages needed to build squid. That&#8217;s just the dependencies
</I>&gt;<i> though right; I still need the squid source code? Sorry if that seems
</I>&gt;<i> obvious, just want to make sure I&#8217;m not missing something.
</I>&gt;<i> 
</I>&gt;<i> 2) I downloaded squid-3.5.8.tar.xz. I captured the configure options from
</I>&gt;<i> my current v3.3.8 squid install using:
</I>&gt;<i> 
</I>&gt;<i> squid3 -v
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> but it led to errors when building v3.5.8, for example:
</I>&gt;<i> 
</I>&gt;<i> '--enable-auth-basic=DB,fake,getpwnam,LDAP,MSNT,MSNT-multi-domain,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB'.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I suppose it&#8217;s not surprising given it&#8217;s such an old version, so I went
</I>&gt;<i> through them all and used the ones I thought made most sense for me. I got
</I>&gt;<i> it to build. Here&#8217;s the squid3 -v output from my v3.5.8 build:
</I>&gt;<i> 
</I>&gt;<i> Squid Cache: Version 3.5.8
</I>&gt;<i> Service Name: squid
</I>&gt;<i> configure options:  '--prefix=/mysquid' '--enable-arp-acl'
</I>&gt;<i> '--localstatedir=/var' '--libexecdir=/lib/squid3' '--datadir=/share/squid3'
</I>&gt;<i> '--sysconfdir=/etc/squid3' '--with-default-user=proxy'
</I>&gt;<i> '--with-logdir=/var/log/squid3' '--with-pidfile=/var/run/squid3.pid'
</I>&gt;<i> '--build=arm-linux-gnueabihf' '--includedir=/include' '--mandir=/share/man'
</I>&gt;<i> '--infodir=/share/info' '--srcdir=.' '--enable-basic-auth-helpers=DB'
</I>&gt;<i> 'build_alias=arm-linux-gnueabihf'
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Here are the problems:
</I>&gt;<i> 
</I>&gt;<i> a) I had to change the owner of /var/log/squid3 from root to proxy:
</I>&gt;<i> 
</I>&gt;<i> sudo chown proxy /var/log/squid3
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Not a big deal I guess, but why can&#8217;t make install take care of the
</I>&gt;<i> permissions?
</I>&gt;<i> 
</I>
It should be. Thanks, I will look into it.

&gt;<i> b) It doesn&#8217;t start as a service and there&#8217;s no squid file in:
</I>&gt;<i> 
</I>&gt;<i> /etc/init.d/
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> so I cannot make the DAEMON= and CONFIG= variables point at my custom
</I>&gt;<i> /mysquid/sbin/squid and /etc/squid3/squid.conf (I&#8217;ll change the
</I>&gt;<i> --sysconfdir config parameter to /mysquid/etc/squid3 in a future build)
</I>&gt;<i> 
</I>
That script is part of the OS packaging. You will have to pull a copy of
it out of the official package.
&lt;<A HREF="https://alioth.debian.org/plugins/scmgit/cgi-bin/gitweb.cgi?p=pkg-squid/pkg-squid3.git;a=blob_plain;f=debian/squid.rc">https://alioth.debian.org/plugins/scmgit/cgi-bin/gitweb.cgi?p=pkg-squid/pkg-squid3.git;a=blob_plain;f=debian/squid.rc</A>&gt;


&gt;<i> c) There&#8217;s no error when I run:
</I>&gt;<i> 
</I>&gt;<i> /mysquid/sbin/squid -k parse
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> but when I run:
</I>&gt;<i> 
</I>&gt;<i> /mysquid/sbin/squid -NCd1
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I get:
</I>&gt;<i> 
</I>&gt;<i> FATAL: Ipc::Mem::Segment::create failed to
</I>&gt;<i> shm_open(/squid-cf__metadata.shm): (13) Permission denied
</I>&gt;<i> 
</I>
For this you need to &quot;mount /dev/shm&quot; on Debian/Ubuntu systems.

Before you start Squid make sure that there is no other Squid running,
and that the directory is empty of squid things.


&gt;<i> d) The configuration file:
</I>&gt;<i> 
</I>&gt;<i> /etc/squid3/squid.conf
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> is a lot different! For example I cannot find:
</I>&gt;<i> 
</I>&gt;<i> cache_effective_user
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Can you point me to the updated documentation for configuring squid?
</I>
You dont need it now :-). Build option --with-default-user=proxy causes
&quot;cache_effective_user proxy&quot; to be the built-in default. The only use
that directive has is when sharing your build with someone else who
doesn't want 'proxy' as their low-privilege user account.

All directives not listed in squid.conf are optional and most of the
documentation has been removed to squid.conf.documented and online at
&lt;<A HREF="http://www.squid-cache.org/Doc/config/">http://www.squid-cache.org/Doc/config/</A>&gt;. What remains is the bare
essentials and recommended security settings for a simple LAN proxy.

Squid should work fine with just the default config file. If it doesn't
that problem needs fixing before anything more complicated get added.
The usualy first issues are making sure the LAN ranges are in the
localnet ACL definition, the /dev/shm mounted, and nothing else running
on Squid listening port.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005443.html">[squid-users] Building squid | Best Practices?
</A></li>
	<LI>Next message (by thread): <A HREF="005446.html">[squid-users] recompiling squid 3.5.7
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5444">[ date ]</a>
              <a href="thread.html#5444">[ thread ]</a>
              <a href="subject.html#5444">[ subject ]</a>
              <a href="author.html#5444">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
