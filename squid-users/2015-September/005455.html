<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] 3.5.8 &#8212; SSL Bump questions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%3D%3Futf-8%3Fq%3F3%3D2E5%3D2E8_%3DE2%3D80%3D94_SSL_Bump_questions%3F%3D&In-Reply-To=%3C55EE8B9A.9080909%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005451.html">
   <LINK REL="Next"  HREF="005457.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] 3.5.8 &#8212; SSL Bump questions</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%3D%3Futf-8%3Fq%3F3%3D2E5%3D2E8_%3DE2%3D80%3D94_SSL_Bump_questions%3F%3D&In-Reply-To=%3C55EE8B9A.9080909%40treenet.co.nz%3E"
       TITLE="[squid-users] 3.5.8 &#8212; SSL Bump questions">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Sep  8 07:17:46 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005451.html">[squid-users] 3.5.8 &#8212; SSL Bump questions
</A></li>
        <LI>Next message (by thread): <A HREF="005457.html">[squid-users] 3.5.8 &#8212; SSL Bump questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5455">[ date ]</a>
              <a href="thread.html#5455">[ thread ]</a>
              <a href="subject.html#5455">[ subject ]</a>
              <a href="author.html#5455">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 8/09/2015 5:36 p.m., Dan Charlesworth wrote:
&gt;<i> Hello all
</I>&gt;<i> 
</I>&gt;<i> I&#8217;ve been testing out an SSL bumping config using 3.5.8 for the last week or so and am scratching my head over a couple of things.
</I>&gt;<i> 
</I>&gt;<i> First, here&#8217;s my config (shout out to James Lay):
</I>&gt;<i> 
</I>&gt;<i> acl tcp_level at_step SslBump1
</I>&gt;<i> acl client_hello_peeked at_step SslBump2
</I>&gt;<i> acl bump_bypass_domains ssl::server_name &#8220;/path/to/some/domains.txt&quot;
</I>&gt;<i> ssl_bump splice client_hello_peeked bump_bypass_domains
</I>&gt;<i> ssl_bump bump client_hello_peeked
</I>&gt;<i> 
</I>&gt;<i> 1. Why don&#8217;t spliced connections get a user agent logged like explicit CONNECTs do?
</I>
If you are talking about the synthetic CONNECT created on intercepted
traffic it is because there is no User-Agent header and nothing to
create one from.

If you are seeing explicit CONNECT come in and not have a User-Agent
header when they are spliced. That would seem to be a bug. The
splice/bump stuff should not be affecting the original CONNECT message
the client sent.

&gt;<i> 
</I>&gt;<i> 2. Safari produces this error visiting all sorts of websites (github, wikipedia, gmail):
</I>&gt;<i> Error negotiating SSL connection on FD 15: error:140A1175:SSL routines:SSL_BYTES_TO_CIPHER_LIST:inappropriate fallback (1/-1)
</I>&gt;<i> 
</I>&gt;<i> &#8230; whereas Chrome and Firefox do not. What&#8217;s the story with this one?
</I>
&quot;inappropriate fallback&quot; means the client is claiming it has been forced
down to the SSLv3 (or some low/insecure TLS version) because no more
secure version was permitted. But the server is aware that it does
support a higher version.

It can happen two ways:
 1) somebody is MITM'ing the connection and performing the POODLE attack.

 2) client has misconfigured TLS/SSL support.


TLS agents are supposed to support a _continuous_ range of protocol
versions from the set { SSLv2, SSLv3, TLSv1.0, TLSv1.1, TLSv1.2, TLSv1.3
}, the client states what it highest is and if it is in the servers set
that gets used. If it gets rejected the client has to fallback to its
next-lower version and try again.

(2) happens when somebody pokes a hole by disabling one of the protocol
versions in the middle of their otherwise supported range. Usually it is
the client, but servers can do it too. When the 'hole' overlaps with the
highest supported version of the other end the fallback mechanism breaks
with the behaviour you see.


The solution is to ensure the TLS versions supported by the client are a
continuous range.

* SSLv2 should be dead and buried. Disabled everywhere. Kill it ASAP if
you see it enabled anywhere.

* SSLv3 _should_ be disabled now too. Using it is actively dangerous. In
the event that it cannot be disabled then TLSv1.0 through to the highest
supported TLS version also *need* to be enabled. No poking holes to
disable TLSv1.0 with SSLv3 still active.

* TLSv1.0 is a good idea to disable. It is not dangerous yet but very
will soon be, and there are a lot of its ciphers which _are_ actively
dangerous and require disabling if its going to be allowed. The only
reasons to have it enabled are old TLSv1.0-only software or when SSLv3
is required.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005451.html">[squid-users] 3.5.8 &#8212; SSL Bump questions
</A></li>
	<LI>Next message (by thread): <A HREF="005457.html">[squid-users] 3.5.8 &#8212; SSL Bump questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5455">[ date ]</a>
              <a href="thread.html#5455">[ thread ]</a>
              <a href="subject.html#5455">[ subject ]</a>
              <a href="author.html#5455">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
