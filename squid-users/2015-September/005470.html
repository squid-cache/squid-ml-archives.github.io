<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] 3.5.8 &#8212; SSL Bump questions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%3D%3Futf-8%3Fq%3F3%3D2E5%3D2E8_%3DE2%3D80%3D94_SSL_Bump_questions%3F%3D&In-Reply-To=%3Cf001b8aa6315a996f27fd8ee749e14c5%40localhost%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005467.html">
   <LINK REL="Next"  HREF="005471.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] 3.5.8 &#8212; SSL Bump questions</H1>
    <B>James Lay</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%3D%3Futf-8%3Fq%3F3%3D2E5%3D2E8_%3DE2%3D80%3D94_SSL_Bump_questions%3F%3D&In-Reply-To=%3Cf001b8aa6315a996f27fd8ee749e14c5%40localhost%3E"
       TITLE="[squid-users] 3.5.8 &#8212; SSL Bump questions">jlay at slave-tothe-box.net
       </A><BR>
    <I>Tue Sep  8 20:18:55 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005467.html">[squid-users] 3.5.8 &#8212; SSL Bump questions
</A></li>
        <LI>Next message (by thread): <A HREF="005471.html">[squid-users] 3.5.8 &#8212; SSL Bump questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5470">[ date ]</a>
              <a href="thread.html#5470">[ thread ]</a>
              <a href="subject.html#5470">[ subject ]</a>
              <a href="author.html#5470">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2015-09-08 01:54 PM, Alex Rousskov wrote:
&gt;<i> On 09/07/2015 11:36 PM, Dan Charlesworth wrote:
</I>&gt;&gt;<i> First, here&#8217;s my config (shout out to James Lay):
</I>&gt;<i> 
</I>&gt;&gt;<i> acl client_hello_peeked at_step SslBump2
</I>&gt;&gt;<i> ssl_bump splice client_hello_peeked bump_bypass_domains
</I>&gt;&gt;<i> ssl_bump bump client_hello_peeked
</I>&gt;<i> 
</I>&gt;<i> Just in case somebody tries to copy this:
</I>&gt;<i> 
</I>&gt;<i> AFAICT, in Squid v3.5.8, the above config does not make sense. Since
</I>&gt;<i> client_hello_peeked does not match during step1, no ssl_bump rules will
</I>&gt;<i> patch during step1, and so the above is equivalent to:
</I>&gt;<i> 
</I>&gt;<i>   ssl_bump splice !all
</I>&gt;<i>   ssl_bump bump !all
</I>&gt;<i> 
</I>&gt;<i> which, in turn, should be equivalent to:
</I>&gt;<i> 
</I>&gt;<i>   ssl_bump splice all
</I>&gt;<i> 
</I>&gt;<i> because &quot;splice&quot; is the default ssl_bump action unless Squid has been
</I>&gt;<i> &quot;staring&quot;. That, in turn, should be nearly equivalent to not using
</I>&gt;<i> SslBump at all. There are some side effects related to the
</I>&gt;<i> always-performed SslBump step1 actions that you may observe, but I 
</I>&gt;<i> doubt
</I>&gt;<i> you were after those side effects.
</I>&gt;<i> 
</I>&gt;<i> Alex.
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
I recall that in testing something similar was proposed, but it did not 
function as intended, but that was....gosh I'm not sure how many revs 
back.  I'm currently having great success with 3.5.8 and this 
peek/splice only method using transparent intercept:

###############################
acl step1 at_step SslBump1
acl step2 at_step SslBump2
acl step3 at_step SslBump3

ssl_bump peek step1 all
ssl_bump peek step2 all
acl allowed_https_sites ssl::server_name_regex 
&quot;/opt/etc/squid/http_url.txt&quot;
ssl_bump splice step3 allowed_https_sites
ssl_bump terminate all
###############################

I didn't really have a reason to actually bump and decrypt, just to 
allow/disallow.  I still see peek only 
(<A HREF="http://bugs.squid-cache.org/show_bug.cgi?id=4256">http://bugs.squid-cache.org/show_bug.cgi?id=4256</A>) in the logs for both 
successfully spliced and terminated sessions, but eh...I know it's 
working otherwise I'd have unhappy children :D

James

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005467.html">[squid-users] 3.5.8 &#8212; SSL Bump questions
</A></li>
	<LI>Next message (by thread): <A HREF="005471.html">[squid-users] 3.5.8 &#8212; SSL Bump questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5470">[ date ]</a>
              <a href="thread.html#5470">[ thread ]</a>
              <a href="subject.html#5470">[ subject ]</a>
              <a href="author.html#5470">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
