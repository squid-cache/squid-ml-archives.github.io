<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid3 Kerberos Auth works but does not update	theusers group membership in the winbind cache of samba as	forexamle ntlm_auth does
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid3%20Kerberos%20Auth%20works%20but%20does%20not%20update%0A%09theusers%20group%20membership%20in%20the%20winbind%20cache%20of%20samba%20as%0A%09forexamle%20ntlm_auth%20does&In-Reply-To=%3Cmt4r2h%24flk%241%40ger.gmane.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005461.html">
   <LINK REL="Next"  HREF="005465.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid3 Kerberos Auth works but does not update	theusers group membership in the winbind cache of samba as	forexamle ntlm_auth does</H1>
    <B>Markus Moeller</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid3%20Kerberos%20Auth%20works%20but%20does%20not%20update%0A%09theusers%20group%20membership%20in%20the%20winbind%20cache%20of%20samba%20as%0A%09forexamle%20ntlm_auth%20does&In-Reply-To=%3Cmt4r2h%24flk%241%40ger.gmane.org%3E"
       TITLE="[squid-users] Squid3 Kerberos Auth works but does not update	theusers group membership in the winbind cache of samba as	forexamle ntlm_auth does">huaraz at moeller.plus.com
       </A><BR>
    <I>Sun Sep 13 21:50:05 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005461.html">[squid-users] Squid3 Kerberos Auth works but does not update the	users group membership in the winbind cache of samba as for	examle ntlm_auth does
</A></li>
        <LI>Next message (by thread): <A HREF="005465.html">[squid-users] Using Squid as forward http proxy failing to complete request?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5506">[ date ]</a>
              <a href="thread.html#5506">[ thread ]</a>
              <a href="subject.html#5506">[ subject ]</a>
              <a href="author.html#5506">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Enrico,
 
   The Kerberos helper will authenticate only for now ( There is a  now code to get the group information, but it is not further processed).  It does not do anything to group membership like the winbind cache.  Also keep in mind Kerberos cache for about 10 hours the ticket on the client machine.  If the user does not lock/unlock his PC  there won&#8217;t be any update to the cached ticket and therefore not to the group membership information in the ticket either. 

Regards
Markus 


&quot;Heine, Enrico&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">independence at data-core.org</A>&gt; wrote in message news:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">c821a938e46c6278b4cc39912760b408bb84f83c at data-core.org...</A>
Hello together,

My Issue is the following: 

Using Squid3 with Kerberos Auth works just fine but does not update the users group membership in the winbind cache of samba as for examle ntlm_auth does.

So when using /usr/lib/squid3/negotiate_kerberos_auth for Kerberos, the auth works, but group memberships for my user as example are never updated, when I comment this auth helper then it gets updated because then I use ntlm_auth for ntlmssp
So if I have a new group eg: My_Test , then I can check this like this: 

wbinfo -n My_Test -&gt; returns SID of My_Test
wbinfo -Y SID -&gt; returns mapped GID
wbinfo -r myuser | grep GID -&gt; GID is not listed!!

getent group My_Test -&gt; returns: myuser is member of that group! So just in my account &quot;myuser&quot; it is not listed (wbinfo -r myuser | grep GID -&gt; GID is not listed!!) but ext_wbinfo_group_acl is checking my group membership based on the commands listed above.

Commenting Kerberos auth in the squid conf, so that only ntlm_auth is used and requesting one website to be sure to have done an auth, works. So then the GID is listed in the output of wbinfo -r myuser

How can I ensure that my memberships are getting updated using /usr/lib/squid3/negotiate_kerberos_auth as it does work with ntlm_user? Or is there another auth helper that can be used for Kerberos that is doing what ntlm_user does automatically after an successfull authentication?

My Squid Config for Auth Helpers looks like this:

######################################################### Kerberos #########################################################
#auth_param negotiate program /usr/lib/squid3/negotiate_kerberos_auth -r -s HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">myserver.MYDOMAIN at MYDOMAIN</A>
#auth_param negotiate children 300
#auth_param negotiate keep_alive on

######################################################### NTLM #########################################################
auth_param ntlm program /usr/bin/ntlm_auth --helper-protocol=squid-2.5-ntlmssp
auth_param ntlm children 50
auth_param ntlm keep_alive off

######################################################### BASIC #########################################################
auth_param basic program /usr/bin/ntlm_auth --helper-protocol=squid-2.5-basic
auth_param basic children 50
auth_param basic credentialsttl 2 hours
auth_param basic realm Windows Authentication required
auth_param basic casesensitive off

Also I am using the following to check group memberships, which is working fine !! with all auth helpers !! and it is much faster than the slow Kerberos group check, I assume that this helper is updating automatically the winbind group cache, which is the reason that the group itself is beeing recognized and I am also a member of that group when I check that specific group via getent group My_Test

external_acl_type nt_group ttl=60 children-max=300 children-startup=50 %LOGIN /usr/lib/squid3/ext_wbinfo_group_acl -K

Software Versions used:
- Squid Cache: Version 3.4.8
- Samba &amp; winbindd Version 4.1.17-Debian
- Distri: Debian Jessie


-- 
-- 
Best regards,
Enrico Heine

&#8203;This email and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this email in error please notify the system manager. This message contains confidential information and is intended only for the individual named. If you are not the named addressee you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately by e-mail if you have received this e-mail by mistake and delete this e-mail from your system. If you are not the intended recipient you are notified that disclosing, copying, distributing or taking any action in reliance on the contents of this information is strictly prohibited.




--------------------------------------------------------------------------------
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150913/ec82a288/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150913/ec82a288/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005461.html">[squid-users] Squid3 Kerberos Auth works but does not update the	users group membership in the winbind cache of samba as for	examle ntlm_auth does
</A></li>
	<LI>Next message (by thread): <A HREF="005465.html">[squid-users] Using Squid as forward http proxy failing to complete request?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5506">[ date ]</a>
              <a href="thread.html#5506">[ thread ]</a>
              <a href="subject.html#5506">[ subject ]</a>
              <a href="author.html#5506">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
