<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] help with acl order and deny_info pages
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20help%20with%20acl%20order%20and%20deny_info%20pages&In-Reply-To=%3C55F98428.4060902%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005540.html">
   <LINK REL="Next"  HREF="005564.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] help with acl order and deny_info pages</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20help%20with%20acl%20order%20and%20deny_info%20pages&In-Reply-To=%3C55F98428.4060902%40treenet.co.nz%3E"
       TITLE="[squid-users] help with acl order and deny_info pages">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Sep 16 15:00:56 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005540.html">[squid-users] help with acl order and deny_info pages
</A></li>
        <LI>Next message (by thread): <A HREF="005564.html">[squid-users] help with acl order and deny_info pages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5543">[ date ]</a>
              <a href="thread.html#5543">[ thread ]</a>
              <a href="subject.html#5543">[ subject ]</a>
              <a href="author.html#5543">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 17/09/2015 12:37 a.m., Marko Cupa&#263; wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I'm trying to setup squid in a way that it authenticates users via
</I>&gt;<i> kerberos and grants different levels of web access according to ldap
</I>&gt;<i> query of MS AD groups.After some trials and errors I have found acl
</I>&gt;<i> order which apparently does not trigger reauthentication (auth
</I>&gt;<i> dialogues in browsers although I don't even provide basic auth).
</I>
What makes you think browser dialog box has anything to do with Basic auth?
All it means is that the browser does not know what credentials will
work. The ones tried (if any) have been rejected with a challenge
response (401/407) for valid ones. It may be the browser password manager.

If you are using only Kerberos auth then users enter their Kerberos
username and password into the dialog to allow the browser to fetch the
Kerberos token (or keytab entry) it needs to send to Squid.


&gt;<i> Here's relevant part:
</I>&gt;<i> 
</I>&gt;<i> http_access deny !Safe_ports
</I>&gt;<i> http_access deny CONNECT !SSL_ports
</I>&gt;<i> http_access allow localhost manager
</I>&gt;<i> http_access deny manager
</I>&gt;<i> http_access deny to_localhost
</I>&gt;<i> # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
</I>&gt;<i> http_access deny !auth all
</I>&gt;<i> http_access allow !basic_domains !basic_extensions basic_users
</I>&gt;<i> http_reply_access allow !basic_mimetypes basic_users
</I>&gt;<i> http_access allow !advanced_domains !advanced_extensions advanced_users
</I>&gt;<i> http_access allow expert_users all
</I>&gt;<i> # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
</I>&gt;<i> http_access allow localhost
</I>&gt;<i> http_access deny all
</I>&gt;<i> 
</I>&gt;<i> I'd like to know which acl triggered the ban, so I've created custom
</I>&gt;<i> error page:
</I>&gt;<i> 
</I>&gt;<i> error_directory /usr/local/etc/squid/myerrors
</I>&gt;<i> deny_info ERR_BASIC_EXTENSION basic_extensions
</I>&gt;<i> 
</I>&gt;<i> The problem is that my custom error page does not trigger when I expect
</I>&gt;<i> it to (member of basic_users accessing URL with extension listed in
</I>&gt;<i> basic_extensions) - ERR_ACCESS_DENIED is triggered instead. I guess
</I>&gt;<i> this is because of last matching rule which is http_access deny all.
</I>
Perhapse.

But, basic_extensions is never the last listed ACL in a denial rule.
There is never a deny action associated with the ACL. That is why the
deny_info response template is not being used.

&gt;<i> 
</I>&gt;<i> Is there another way how I can order acls so that I don't trigger
</I>&gt;<i> reauthentication while triggering deny_info?
</I>
Not without the ACL definition details.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005540.html">[squid-users] help with acl order and deny_info pages
</A></li>
	<LI>Next message (by thread): <A HREF="005564.html">[squid-users] help with acl order and deny_info pages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5543">[ date ]</a>
              <a href="thread.html#5543">[ thread ]</a>
              <a href="subject.html#5543">[ subject ]</a>
              <a href="author.html#5543">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
