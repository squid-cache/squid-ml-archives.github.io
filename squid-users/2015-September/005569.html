<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] problem with ntlm_smb_lm_auth helper
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20problem%20with%20ntlm_smb_lm_auth%20helper&In-Reply-To=%3C55FA94E4.4030300%40cadoles.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005539.html">
   <LINK REL="Next"  HREF="005574.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] problem with ntlm_smb_lm_auth helper</H1>
    <B>Emmanuel Garette</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20problem%20with%20ntlm_smb_lm_auth%20helper&In-Reply-To=%3C55FA94E4.4030300%40cadoles.com%3E"
       TITLE="[squid-users] problem with ntlm_smb_lm_auth helper">egarette at cadoles.com
       </A><BR>
    <I>Thu Sep 17 10:24:36 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005539.html">[squid-users] problem with ntlm_smb_lm_auth helper
</A></li>
        <LI>Next message (by thread): <A HREF="005574.html">[squid-users] problem with ntlm_smb_lm_auth helper
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5569">[ date ]</a>
              <a href="thread.html#5569">[ thread ]</a>
              <a href="subject.html#5569">[ subject ]</a>
              <a href="author.html#5569">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Le 16/09/2015 11:40, Amos Jeffries a &#233;crit :
&gt;<i> On 16/09/2015 9:05 p.m., Emmanuel Garette wrote:
</I>&gt;&gt;<i> Le 07/09/2015 18:40, Amos Jeffries a &#233;crit :
</I>&gt;&gt;&gt;<i> On 8/09/2015 1:17 a.m., Emmanuel Garette wrote:
</I>&gt;&gt;&gt;&gt;<i> Seems to be ok for me. Thanks for your fast reply.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Need I open a bug in bugzilla ?
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> No need. I think this may be one of the existing ones about this helper.
</I>&gt;&gt;&gt;<i> Thanks for the feedback it should be applied to the current versions
</I>&gt;&gt;&gt;<i> shortly.
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Today I found a new problem. All work fine with computer join into
</I>&gt;&gt;<i> windows domain. Not for computer user CNTLM (not in the domain).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In debug mode I can see this error:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> ntlm_smb_lm_auth.cc(307): pid=4668 :NT response: insane data (pkt-sz:
</I>&gt;&gt;<i> 108, fetch len: 0, offset: 108)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If I understand, there is no NT password.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In older code, there was this line:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> tmp = ntlm_fetch_string ((char *) auth, auth_length, &amp;auth-&gt;ntresponse);
</I>&gt;&gt;&gt;<i> if (tmp.str != NULL &amp;&amp; tmp.l != 0) {
</I>&gt;&gt;<i> The NT password was check only if len was different to 0.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In this part of your patch:
</I>&gt;&gt;&gt;<i> /* still fetch the NT response and check validity against empty
</I>&gt;&gt;<i> password */
</I>&gt;&gt;&gt;<i>      {
</I>&gt;&gt;&gt;<i>          const strhdr * str = &amp;auth-&gt;ntresponse;
</I>&gt;&gt;&gt;<i>          int16_t len = le16toh(str-&gt;len);
</I>&gt;&gt;&gt;<i>          int32_t offset = le32toh(str-&gt;offset);
</I>&gt;&gt;&gt;<i>          if (len != ENCODED_PASS_LEN || offset + len &gt; auth_length ||
</I>&gt;&gt;<i> offset == 0) {
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> if I replace last line with:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> if ((len != 0 &amp;&amp; len != ENCODED_PASS_LEN) || offset + len &gt;
</I>&gt;&gt;<i> auth_length || offset == 0) {
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Everything works well.
</I>&gt;<i> By that do you mean it rejects with &quot;Empty NT password supplied for
</I>&gt;<i> user&quot; ?  or that it accepts the login?
</I>I'm not familar with NTLM protocol, but in my case NT password seems to
be empty (length 0). In this case, older version of helper accept it.
The new one exit with error &quot;insane data&quot;. That why I propose to test if
len is not null.

NT password is empty with cNTLM but also with firefox on a GNU/Linux
workstation.

Cordialement,
&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005539.html">[squid-users] problem with ntlm_smb_lm_auth helper
</A></li>
	<LI>Next message (by thread): <A HREF="005574.html">[squid-users] problem with ntlm_smb_lm_auth helper
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5569">[ date ]</a>
              <a href="thread.html#5569">[ thread ]</a>
              <a href="subject.html#5569">[ subject ]</a>
              <a href="author.html#5569">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
