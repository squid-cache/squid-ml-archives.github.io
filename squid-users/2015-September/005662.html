<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSL Bump in intercept mode
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20Bump%20in%20intercept%20mode&In-Reply-To=%3C5602BF99.7000109%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005647.html">
   <LINK REL="Next"  HREF="005729.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSL Bump in intercept mode</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20Bump%20in%20intercept%20mode&In-Reply-To=%3C5602BF99.7000109%40measurement-factory.com%3E"
       TITLE="[squid-users] SSL Bump in intercept mode">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Sep 23 15:04:57 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005647.html">[squid-users] SSL Bump in intercept mode
</A></li>
        <LI>Next message (by thread): <A HREF="005729.html">[squid-users] SSL Bump in intercept mode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5662">[ date ]</a>
              <a href="thread.html#5662">[ thread ]</a>
              <a href="subject.html#5662">[ subject ]</a>
              <a href="author.html#5662">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 09/23/2015 12:16 AM, &#1057;&#1090;&#1077;&#1087;&#1072;&#1085;&#1077;&#1085;&#1082;&#1086; &#1057;&#1077;&#1088;&#1075;&#1077;&#1081; wrote:

&gt;<i> My proxy certificate released by subca, i.e CA - SubCA - Proxy.
</I>
&gt;<i> OS - Centos6.7, squid - 3.5.7 from www1.ngtech.co.il repo
</I>

&gt;<i> ssl_bump stare all
</I>&gt;<i> ssl_bump bump all
</I>&gt;<i> ssl_bump splice all step3
</I>
Please note that the last &quot;splice&quot; rule will never match [in the latest
Squids]. Other than being misleading about your true intent, this should
not cause problems.

Apart from the pointless splice rule, this is the configuration variant
you should focus on if you want to bump everything.


&gt;<i> in this configuration browser write &quot;Not check certificate chain&quot;
</I>
Perhaps the browser lacks the SubCA certificate? Does Squid send that
intermediate certificate to the browser? You should be able to tell by
examining the browser-Squid SSL handshake in wireshark.


&gt;<i> ssl_bump bump all
</I>&gt;<i> ssl_bump stare all
</I>&gt;<i> ssl_bump splice all step3
</I>
Please note that the second and third rules will never match [in the
latest Squids].

Also, the above config variation is subject to Bug 4327 [in the latest
Squids]. It is not yet clear what the correct Squid behaviour should be
in this case. Avoid this configuration for now.

    <A HREF="http://bugs.squid-cache.org/show_bug.cgi?id=4327">http://bugs.squid-cache.org/show_bug.cgi?id=4327</A>


&gt;<i> I'm get error &quot;The security certificate presented by this website was
</I>&gt;<i> issued for a different website's address&quot;, but certificate chain is
</I>&gt;<i> trust, i.e I'm view chain CA - SubCA - Proxy - site ipaddr.
</I>
Possibly because of the problems discussed in comments 0-3 of the Bug
4327 report mentioned above. I do not know whether your Squid version is
affected because quite a few things have changed since it was released.


&gt;<i> ssl_bump server-first all
</I>
&gt;<i> All works. But not all sites.
</I>
I cannot fully explain this observation. In theory, this last config
should have similar effects to your first config, but should handle
fewer cases because the last config lacks SNI support.

I recommend that you try to reproduce the problems [with the first
config] using the latest v3.5 daily snapshot (or trunk):

  ssl_bump stare all
  ssl_bump bump all


Good luck,

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005647.html">[squid-users] SSL Bump in intercept mode
</A></li>
	<LI>Next message (by thread): <A HREF="005729.html">[squid-users] SSL Bump in intercept mode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5662">[ date ]</a>
              <a href="thread.html#5662">[ thread ]</a>
              <a href="subject.html#5662">[ subject ]</a>
              <a href="author.html#5662">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
