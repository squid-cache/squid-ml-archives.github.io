<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid with SMP registeration time out when i use 10K opened sessions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20with%20SMP%20registeration%20time%20out%20when%20i%20use%0A%2010K%20opened%20sessions&In-Reply-To=%3C5604204F.90905%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005681.html">
   <LINK REL="Next"  HREF="005688.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid with SMP registeration time out when i use 10K opened sessions</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20with%20SMP%20registeration%20time%20out%20when%20i%20use%0A%2010K%20opened%20sessions&In-Reply-To=%3C5604204F.90905%40measurement-factory.com%3E"
       TITLE="[squid-users] squid with SMP registeration time out when i use 10K opened sessions">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Sep 24 16:09:51 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005681.html">[squid-users] squid with SMP registeration time out when i use 10K	opened sessions
</A></li>
        <LI>Next message (by thread): <A HREF="005688.html">[squid-users] squid with SMP registeration time out when i use	10K opened sessions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5683">[ date ]</a>
              <a href="thread.html#5683">[ thread ]</a>
              <a href="subject.html#5683">[ subject ]</a>
              <a href="author.html#5683">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 09/24/2015 08:54 AM, Ahmad Alzaeem wrote:

&gt;<i> If I run it with no SMP 10000 listenting ports  , it works ok and problem
</I>&gt;<i> 
</I>&gt;<i> If I run squid with 10000  listening port with 2 workers &#232;kid timeout
</I>&gt;<i> registeration
</I>
&gt;<i> 2015/09/24 14:51:25 kid2| Closing HTTP port [::]:29995
</I>&gt;<i> 2015/09/24 14:51:25 kid2| Closing HTTP port [::]:29996
</I>&gt;<i> 2015/09/24 14:51:25 kid2| Closing HTTP port [::]:29997
</I>&gt;<i> 2015/09/24 14:51:25 kid2| Closing HTTP port [::]:29998
</I>&gt;<i> 2015/09/24 14:51:25 kid2| Closing HTTP port [::]:29999
</I>&gt;<i> 2015/09/24 14:51:25 kid2| Closing HTTP port [::]:30000
</I>...
&gt;<i> FATAL: kid2 registration timed out
</I>
&gt;<i> do we need to increase timeout ?? since it take long time to load the
</I>&gt;<i> the ips.
</I>

The existing SMP http_port sharing algorithm needs lots of UDS buffer
space to share lots of ports. You may be able to get your configuration
working by allocating lots of UDS buffer space (sysctl
net.local.dgram.recvspace and such), but it may turn out to be
impossible for 10K ports. If there is not enough UDS buffer space,
increasing timeout will not help.


The attached patch for Squid v3.3.11 changes the port sharing algorithm
to minimize memory usage (at the expense of registration time). Please
see the patch preamble for technical details. The patch worked with 3K
ports (24 workers * 128 http_ports each); the registration lasted less
than 5 seconds.

I do not recall whether we have tested the patch with 10K ports -- you
may need to increase the hard-coded kid registration timeout to handle
10K ports with a patched Squid.

Sorry, I do not have a patch for other Squid versions at this time.


HTH,

Alex.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: one-http-port-at-a-time-v3p3.patch
Type: text/x-diff
Size: 6704 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150924/178aa21e/attachment.patch">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150924/178aa21e/attachment.patch</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005681.html">[squid-users] squid with SMP registeration time out when i use 10K	opened sessions
</A></li>
	<LI>Next message (by thread): <A HREF="005688.html">[squid-users] squid with SMP registeration time out when i use	10K opened sessions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5683">[ date ]</a>
              <a href="thread.html#5683">[ thread ]</a>
              <a href="subject.html#5683">[ subject ]</a>
              <a href="author.html#5683">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
