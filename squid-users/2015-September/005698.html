<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Proxying webservices: modify URL externally
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Proxying%20webservices%3A%20modify%20URL%20externally&In-Reply-To=%3C56052CD7.6020509%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005697.html">
   <LINK REL="Next"  HREF="005699.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Proxying webservices: modify URL externally</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Proxying%20webservices%3A%20modify%20URL%20externally&In-Reply-To=%3C56052CD7.6020509%40treenet.co.nz%3E"
       TITLE="[squid-users] Proxying webservices: modify URL externally">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Sep 25 11:15:35 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005697.html">[squid-users] Proxying webservices: modify URL externally
</A></li>
        <LI>Next message (by thread): <A HREF="005699.html">[squid-users] 3.5.9 for Debian
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5698">[ date ]</a>
              <a href="thread.html#5698">[ thread ]</a>
              <a href="subject.html#5698">[ subject ]</a>
              <a href="author.html#5698">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 25/09/2015 9:27 p.m., Lucas van Braam van Vloten wrote:
&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> I would like to use Squid to forward requests to webservices.
</I>&gt;<i> I would like to accomplish the following:
</I>&gt;<i> 
</I>&gt;<i> Traffic is initially directed directly to the Squid server at its
</I>&gt;<i> internal address, for example:
</I>&gt;<i>     <A HREF="http://squid.server.local/first/webservice/">http://squid.server.local/first/webservice/</A>
</I>&gt;<i> 
</I>&gt;<i> The request to the actual webservice is originated from the Squid
</I>&gt;<i> server, for example:
</I>&gt;<i>    <A HREF="https://internet-webservice.example.com/soap/in/">https://internet-webservice.example.com/soap/in/</A>
</I>&gt;<i> 
</I>
This is a very bad design. It leads to all sorts of problems with
internal URL leaking out to external clients, context and security
scoping problems, and all the secondary side effects from those.

Proxies like Squid are designed to gateway the full URL between client
and server/service.


&gt;<i> I can configure Squid so that internal requests are connected to the
</I>&gt;<i> external webservice. Client certificate authentication is handled by
</I>&gt;<i> Squid. However this is based on the FQDN only, everything that comes
</I>&gt;<i> after the FQDN (the second part of the URL) is passed through to the
</I>&gt;<i> external service.
</I>
This is one of the security side-effect problems. There is no solution
except to do HTTP properly.

&gt;<i> 
</I>&gt;<i> I would like to modify the second part of the URL, so that an internal
</I>&gt;<i> connection to &quot;.../first/webservice/&quot;, is externally connected to
</I>&gt;<i> &quot;.../soap/in/&quot;
</I>&gt;<i> Everything that comes after the second part of the URL should be passed
</I>&gt;<i> through as usual.
</I>&gt;<i> 
</I>&gt;<i> My question is: Can it be done?
</I>

Yes if you are willing to cope with all the brokenness that results.
It is called URL rewriting and is done by a helper and the
url_rewrite_program directive.


But it is far easier to do HTTP properly:
* make the public and private paths identical.
* add a cache_peer with port 443 and SSL options, and the
forcedomain=internet-webservice.example.com option to change the domain
sent.
* ensure the web service only ever uses relative URLs. It must not use
the <A HREF="https://">https://</A> or FQDN in any of its outputs.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005697.html">[squid-users] Proxying webservices: modify URL externally
</A></li>
	<LI>Next message (by thread): <A HREF="005699.html">[squid-users] 3.5.9 for Debian
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5698">[ date ]</a>
              <a href="thread.html#5698">[ thread ]</a>
              <a href="subject.html#5698">[ subject ]</a>
              <a href="author.html#5698">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
