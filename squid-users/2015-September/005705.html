<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Building squid | Best Practices?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Building%20squid%20%7C%20Best%20Practices%3F&In-Reply-To=%3CCAP6bC06YkANFguPj9KGE4e50TFuZaDEqjqDfQxNAXvt80yn-Vg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005445.html">
   <LINK REL="Next"  HREF="005714.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Building squid | Best Practices?</H1>
    <B>Howard Waterfall</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Building%20squid%20%7C%20Best%20Practices%3F&In-Reply-To=%3CCAP6bC06YkANFguPj9KGE4e50TFuZaDEqjqDfQxNAXvt80yn-Vg%40mail.gmail.com%3E"
       TITLE="[squid-users] Building squid | Best Practices?">hwaterfall at gmail.com
       </A><BR>
    <I>Sat Sep 26 06:21:52 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005445.html">[squid-users] Building squid | Best Practices?
</A></li>
        <LI>Next message (by thread): <A HREF="005714.html">[squid-users] Building squid | Best Practices?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5705">[ date ]</a>
              <a href="thread.html#5705">[ thread ]</a>
              <a href="subject.html#5705">[ subject ]</a>
              <a href="author.html#5705">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey guys back at it. I expect that Linux issues are really a much bigger
problem for me than squid!

I'm running into this problem now:

/var/run/squid3.pid: (13) Permission denied


I know it's a permission problem, but not sure the optimal way of fixing it.

I created user 'proxy' and group 'squid' to run squid:

sudo addgroup --system squid
sudo adduser --system --no-create-home --group proxy squid


And I set up my build config accordingly:

--with-default-user=proxy


but 'proxy' does not have access to /var/run:

lrwxrwxrwx 1 root root /var/run


This explains why /var/run/squid3.pid cannot be written, but I'm not sure
simply changing ownership of /var/run to 'proxy' is the best approach given
that squid is not the only service that accesses that folder. I'm thinking
that I should configure the build differently.

In order to see what configurations are used in the distro package, I
installed it:

sudo apt-get install squid


and had a look at the output of:

squid3 -v


These setting are troubling for me:

--prefix=/usr
--localstatedir=/var
--with-swapdir=/var/spool/squid3
--with-logdir=/var/log/squid3
--with-pidfile=/var/run/squid3.pid
--datadir=/usr/share/squid3
--mandir=/usr/share/man'
--sysconfdir=/etc
--sysconfdir=/etc/squid3


Yes --sysconfdir is defined twice! Regardless of that, wouldn't it better
to set them up this way:

--prefix=/usr
--localstatedir=${prefix}/var
--with-swapdir=${localstatedir}/spool/squid3
--with-logdir=${localstatedir}/log/squid3
--with-pidfile=${localstatedir}/run/squid3.pid
--datadir=${prefix}/share/squid3
--mandir=${prefix}/share/man'
--sysconfdir=${prefix}/etc/squid3


I'm not positive about this directive:

--sysconfdir=${prefix}/etc/squid3


that may be better left as:

--sysconfdir=/etc/squid3


I am curious about the others though. If what I've said makes sense, I'll
update my build config that way and make one more change:

--prefix=/proxy


Thanks
Deiter


On Mon, Sep 7, 2015 at 6:44 PM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:

&gt;<i> On 8/09/2015 10:10 a.m., Eliezer Croitoru wrote:
</I>&gt;<i> &gt; Hey Howard,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I forgot to mention that squid uses the directory &quot;/var/run/squid&quot; as
</I>&gt;<i> &gt; the IPC directory which should be owned by the proxy or squid
</I>&gt;<i> &gt; user(depends on the OS).
</I>&gt;<i> &gt; From what you have mentioned squid tries to access some directory and is
</I>&gt;<i> &gt; getting denied by permissions.
</I>&gt;<i> &gt; Please Don't run squid with a &quot;-n&quot; option if possible, it will limit
</I>&gt;<i> &gt; your options to using only one worker(which is the default and is OK in
</I>&gt;<i> &gt; most basic cases).
</I>&gt;<i>
</I>&gt;<i> No. The -N (upper case) means that. On Ubuntu the -N was needed for
</I>&gt;<i> Upstart integration (now defunct in the custom build).
</I>&gt;<i>
</I>&gt;<i> Not to be confused with -n (lower case) which means a multi-tenant /
</I>&gt;<i> multi-instance named service is being used.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20150925/bcd6df03/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20150925/bcd6df03/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005445.html">[squid-users] Building squid | Best Practices?
</A></li>
	<LI>Next message (by thread): <A HREF="005714.html">[squid-users] Building squid | Best Practices?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5705">[ date ]</a>
              <a href="thread.html#5705">[ thread ]</a>
              <a href="subject.html#5705">[ subject ]</a>
              <a href="author.html#5705">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
