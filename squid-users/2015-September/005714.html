<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Building squid | Best Practices?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Building%20squid%20%7C%20Best%20Practices%3F&In-Reply-To=%3C56073551.9000107%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005705.html">
   <LINK REL="Next"  HREF="005443.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Building squid | Best Practices?</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Building%20squid%20%7C%20Best%20Practices%3F&In-Reply-To=%3C56073551.9000107%40treenet.co.nz%3E"
       TITLE="[squid-users] Building squid | Best Practices?">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Sep 27 00:16:17 UTC 2015</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005705.html">[squid-users] Building squid | Best Practices?
</A></li>
        <LI>Next message (by thread): <A HREF="005443.html">[squid-users] Building squid | Best Practices?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5714">[ date ]</a>
              <a href="thread.html#5714">[ thread ]</a>
              <a href="subject.html#5714">[ subject ]</a>
              <a href="author.html#5714">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 26/09/2015 6:21 p.m., Howard Waterfall wrote:
&gt;<i> Hey guys back at it. I expect that Linux issues are really a much bigger
</I>&gt;<i> problem for me than squid!
</I>&gt;<i> 
</I>&gt;<i> I'm running into this problem now:
</I>&gt;<i> 
</I>&gt;<i> /var/run/squid3.pid: (13) Permission denied
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I know it's a permission problem, but not sure the optimal way of fixing it.
</I>&gt;<i> 
</I>&gt;<i> I created user 'proxy' and group 'squid' to run squid:
</I>&gt;<i> 
</I>&gt;<i> sudo addgroup --system squid
</I>&gt;<i> sudo adduser --system --no-create-home --group proxy squid
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> And I set up my build config accordingly:
</I>&gt;<i> 
</I>&gt;<i> --with-default-user=proxy
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> but 'proxy' does not have access to /var/run:
</I>&gt;<i> 
</I>&gt;<i> lrwxrwxrwx 1 root root /var/run
</I>&gt;<i> 
</I>
Everything has access to /var/run (the &quot;rwx&quot; on 'other' permissions).
The symlink should point at /run which has similar permissions that any
account can read, and root can create/write.

Note that Squid needs to be started by the root account to have its
required security capabilities.

&gt;<i> 
</I>&gt;<i> This explains why /var/run/squid3.pid cannot be written, but I'm not sure
</I>&gt;<i> simply changing ownership of /var/run to 'proxy' is the best approach given
</I>&gt;<i> that squid is not the only service that accesses that folder. I'm thinking
</I>&gt;<i> that I should configure the build differently.
</I>&gt;<i> 
</I>&gt;<i> In order to see what configurations are used in the distro package, I
</I>&gt;<i> installed it:
</I>&gt;<i> 
</I>&gt;<i> sudo apt-get install squid
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> and had a look at the output of:
</I>&gt;<i> 
</I>&gt;<i> squid3 -v
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> These setting are troubling for me:
</I>&gt;<i> 
</I>&gt;<i> --prefix=/usr
</I>&gt;<i> --localstatedir=/var
</I>&gt;<i> --with-swapdir=/var/spool/squid3
</I>&gt;<i> --with-logdir=/var/log/squid3
</I>&gt;<i> --with-pidfile=/var/run/squid3.pid
</I>&gt;<i> --datadir=/usr/share/squid3
</I>&gt;<i> --mandir=/usr/share/man'
</I>&gt;<i> --sysconfdir=/etc
</I>&gt;<i> --sysconfdir=/etc/squid3
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Yes --sysconfdir is defined twice! Regardless of that, wouldn't it better
</I>&gt;<i> to set them up this way:
</I>&gt;<i> 
</I>&gt;<i> --prefix=/usr
</I>&gt;<i> --localstatedir=${prefix}/var
</I>&gt;<i> --with-swapdir=${localstatedir}/spool/squid3
</I>&gt;<i> --with-logdir=${localstatedir}/log/squid3
</I>&gt;<i> --with-pidfile=${localstatedir}/run/squid3.pid
</I>&gt;<i> --datadir=${prefix}/share/squid3
</I>&gt;<i> --mandir=${prefix}/share/man'
</I>&gt;<i> --sysconfdir=${prefix}/etc/squid3
</I>&gt;<i> 
</I>
For you when custom building yes. The OS distributors chose the other
way for their own reasons. The primary being that the OS package needs
to be installed to the FHS system locations, not user custom-build
locations.


&gt;<i> 
</I>&gt;<i> I'm not positive about this directive:
</I>&gt;<i> 
</I>&gt;<i> --sysconfdir=${prefix}/etc/squid3
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> that may be better left as:
</I>&gt;<i> 
</I>&gt;<i> --sysconfdir=/etc/squid3
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I am curious about the others though. If what I've said makes sense, I'll
</I>&gt;<i> update my build config that way and make one more change:
</I>&gt;<i> 
</I>&gt;<i> --prefix=/proxy
</I>&gt;<i> 
</I>
Up to you. Consider the prefix as a type of weak chroot. Squid will be
installed inside it, but access to non-squid system things doesn't
depend on the usual chroot copying and restrictions.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005705.html">[squid-users] Building squid | Best Practices?
</A></li>
	<LI>Next message (by thread): <A HREF="005443.html">[squid-users] Building squid | Best Practices?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5714">[ date ]</a>
              <a href="thread.html#5714">[ thread ]</a>
              <a href="subject.html#5714">[ subject ]</a>
              <a href="author.html#5714">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
