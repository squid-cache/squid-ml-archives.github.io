<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Query about login=pass
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Query%20about%20login%3Dpass&In-Reply-To=%3CCALgKBSmu4DnmGbFhMdvUUu5WVVpn%3DuNwQVkoZ5gLvUT8_4kNtQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009968.html">
   <LINK REL="Next"  HREF="009969.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Query about login=pass</H1>
    <B>Sreenath BH</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Query%20about%20login%3Dpass&In-Reply-To=%3CCALgKBSmu4DnmGbFhMdvUUu5WVVpn%3DuNwQVkoZ5gLvUT8_4kNtQ%40mail.gmail.com%3E"
       TITLE="[squid-users] Query about login=pass">bhsreenath at gmail.com
       </A><BR>
    <I>Fri Apr  1 12:40:33 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009968.html">[squid-users] We have a big problems with Squid 3.3.8, it's a bug ?
</A></li>
        <LI>Next message (by thread): <A HREF="009969.html">[squid-users] Query about login=pass
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9966">[ date ]</a>
              <a href="thread.html#9966">[ thread ]</a>
              <a href="subject.html#9966">[ subject ]</a>
              <a href="author.html#9966">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi All,

We have a setup with two squid servers lets say, squid1 and squid2.
Requests land at Squid1 and it sends the request to squid2. Squid2
uses X-User-ID and Authorization headers for authenticating the user,
and on success, fetches data from another webserver and returns the
data. If authentication fails, it returns a 401 response.

What we have observed is that for some reason, squid does not send the
Authorization header to the upstream squid server. However, X-User-ID
header is always sent to upstre.

10.135.81.100 is squid2.

Here is configuration of squid1, where we see the problem.
------------------
acl    test_upload   urlpath_regex   ^/upload
acl    test_nms       urlpath_regex   ^/nms
acl    trash_misc    urlpath_regex   ^/trash

http_port 80 accel defaultsite=sitgateway.qiodrive.com vhost
https_port 443 cert=/etc/squid3/certificates/test.crt
key=/etc/squid3/certificates/qiodrivekey.key
cafile=/etc/squid3/certificates/gd_bundle-g2-g1.crt accel

cache_peer 10.135.81.100 parent 80 0 no-query login=PASS originserver name=name1
cache_peer_access name1 allow test_upload
cache_peer_access name1 deny all

cache_peer 10.135.81.100 parent 80 0 no-query login=PASS originserver name=name2
cache_peer_access name2 allow test_nms
cache_peer_access name2 deny all

cache_peer 10.135.81.100 parent 80 0 no-query originserver name=name3
cache_peer_access name3 allow trash_misc
cache_peer_access name3 deny all
----------------

As can be seen above, we have associated different names  (name1,
name2 and name3) for the same Squid2 server, all listening at same
port also. Is this a correct way of doing it? I ran squid -parse on
the squid.conf file and it did not report any problem.

1. Squid1 listens on both 80 and SSL port. If request comes on SSL
port, will it send Authorization token to Squid that is not SSL squid?

2. In the source code of squid (http.c) I see following lines in the function:

void
copyOneHeaderFromClientsideRequestToUpstreamRequest(const
HttpHeaderEntry *e, const String strConnection, const HttpRequest *
request, HttpHeader * hdr_out, const int we_do_ranges, const
HttpStateFlags &amp;flags)

   case HDR_AUTHORIZATION:
        /** \par WWW-Authorization:
         * Pass on WWW authentication */

        if (!flags.originpeer) {
            hdr_out-&gt;addEntry(e-&gt;clone());
        } else {
            /** \note In accelerators, only forward authentication if enabled
             * (see also httpFixupAuthentication for special cases)
             */
            if (request-&gt;peer_login &amp;&amp;
                    (strcmp(request-&gt;peer_login, &quot;PASS&quot;) == 0 ||
                     strcmp(request-&gt;peer_login, &quot;PASSTHRU&quot;) == 0 ||
                     strcmp(request-&gt;peer_login, &quot;PROXYPASS&quot;) == 0)) {
                hdr_out-&gt;addEntry(e-&gt;clone());
            }
        }

        break;


I don't understand what might prevent squid from sending the
Authorization header.

Any help appreciated,

thanks,
Sreenath

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009968.html">[squid-users] We have a big problems with Squid 3.3.8, it's a bug ?
</A></li>
	<LI>Next message (by thread): <A HREF="009969.html">[squid-users] Query about login=pass
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9966">[ date ]</a>
              <a href="thread.html#9966">[ thread ]</a>
              <a href="subject.html#9966">[ subject ]</a>
              <a href="author.html#9966">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
