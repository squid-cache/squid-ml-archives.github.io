<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3.5.16 and vary loop objects (bug ?)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.16%20and%20vary%20loop%20objects%20%28bug%20%3F%29&In-Reply-To=%3C1459769406356-4676908.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009990.html">
   <LINK REL="Next"  HREF="009993.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3.5.16 and vary loop objects (bug ?)</H1>
    <B>joe</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.16%20and%20vary%20loop%20objects%20%28bug%20%3F%29&In-Reply-To=%3C1459769406356-4676908.post%40n4.nabble.com%3E"
       TITLE="[squid-users] Squid 3.5.16 and vary loop objects (bug ?)">chip_pop at hotmail.com
       </A><BR>
    <I>Mon Apr  4 11:30:06 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009990.html">[squid-users] Squid 3.5.16 and vary loop objects (bug ?)
</A></li>
        <LI>Next message (by thread): <A HREF="009993.html">[squid-users] Squid 3.5.16 and vary loop objects (bug ?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9992">[ date ]</a>
              <a href="thread.html#9992">[ thread ]</a>
              <a href="subject.html#9992">[ subject ]</a>
              <a href="author.html#9992">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>FredB wrote
&gt;&gt;<i> Objet: Re: [squid-users] Squid 3.5.16 and vary loop objects (bug ?)
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> intercept  ??
</I>&gt;<i> 
</I>&gt;<i> No, implicit proxy 
</I>&gt;<i> 
</I>&gt;&gt;<i> i got excellent result but not the correct way its and old issue
</I>&gt;&gt;<i> may be i was not posting the issue in correct way for the dev... to
</I>&gt;&gt;<i> understand
</I>&gt;<i> 
</I>&gt;<i> Very recent for me, not problem with 6 proxies and squid 3.5.13 but
</I>&gt;<i> present with 2 new 3.5.16
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>
&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at .squid-cache</A>
</I>
&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
mmm code ar the same must be something else corrupt the vary before
varyEvaluateMatch()

i can provide testing patch    just for testing  .. not for production until
they find the right cause
but   make shurr the header ar  public for those link might be your
situation ar diff...

diff -Naur src/client_side.cc src/client_side.cc
--- src/client_side.cc	2016-04-02 03:38:47.000000000 +0300
+++ src/client_side.cc	2016-04-03 16:47:02.000000000 +0300
@@ -4725,13 +4725,26 @@
             if (!vary.isEmpty())
                 request-&gt;vary_headers = vary;
         }
+        if (vary.isEmpty()) {
+            vary = entry-&gt;mem_obj-&gt;vary_headers;
+
+            if (!vary.isEmpty())
+                request-&gt;vary_headers = vary;
+        }
 
         if (vary.isEmpty()) {
             /* Ouch.. we cannot handle this kind of variance */
             /* XXX This cannot really happen, but just to be complete */
             return VARY_CANCEL;
+
         } else if (vary.cmp(entry-&gt;mem_obj-&gt;vary_headers) == 0) {
             return VARY_MATCH;
+
+        } else if (vary.cmp(httpMakeVaryMark(request, entry-&gt;getReply()))
== 0) {
+            return VARY_MATCH;
+
+        } else if (!vary.isEmpty() &amp;&amp;
!entry-&gt;mem_obj-&gt;vary_headers.isEmpty()) {
+            return VARY_MATCH;
         } else {
             /* Oops.. we have already been here and still haven't
              * found the requested variant. Bail out




--
View this message in context: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-3-5-16-and-vary-loop-objects-bug-tp4676901p4676908.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-3-5-16-and-vary-loop-objects-bug-tp4676901p4676908.html</A>
Sent from the Squid - Users mailing list archive at Nabble.com.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009990.html">[squid-users] Squid 3.5.16 and vary loop objects (bug ?)
</A></li>
	<LI>Next message (by thread): <A HREF="009993.html">[squid-users] Squid 3.5.16 and vary loop objects (bug ?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9992">[ date ]</a>
              <a href="thread.html#9992">[ thread ]</a>
              <a href="subject.html#9992">[ subject ]</a>
              <a href="author.html#9992">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
