<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Identifying intercepted clients
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Identifying%20intercepted%20clients&In-Reply-To=%3C5702E9EA.9050200%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009980.html">
   <LINK REL="Next"  HREF="009981.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Identifying intercepted clients</H1>
    <B>Brendan Kearney</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Identifying%20intercepted%20clients&In-Reply-To=%3C5702E9EA.9050200%40gmail.com%3E"
       TITLE="[squid-users] Identifying intercepted clients">bpk678 at gmail.com
       </A><BR>
    <I>Mon Apr  4 22:25:46 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009980.html">[squid-users] Identifying intercepted clients
</A></li>
        <LI>Next message (by thread): <A HREF="009981.html">[squid-users] filtering http(s) sites, transparently
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10007">[ date ]</a>
              <a href="thread.html#10007">[ thread ]</a>
              <a href="subject.html#10007">[ subject ]</a>
              <a href="author.html#10007">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 04/03/2016 08:06 PM, Amos Jeffries wrote:
&gt;<i> On 4/04/2016 4:22 a.m., Brendan Kearney wrote:
</I>&gt;&gt;<i> with fedora 24 being released in a couple months, haproxy v1.6.x will be
</I>&gt;&gt;<i> available, and the ability to easily intercept HTTP traffic will be in
</I>&gt;&gt;<i> the version (see the set-uri directive).  with v1.6 i will be able to
</I>&gt;&gt;<i> rewrite the URL, so that squid can process the request properly.
</I>&gt;<i> That does not make sense. Intercepting and URL-rewriting are completely
</I>&gt;<i> different actions.
</I>&gt;<i>
</I>&gt;<i> The Squid-3.5 and later versions are able to receive PROXY protocol
</I>&gt;<i> headers from HAProxy. You may find that much better than fiddling around
</I>&gt;<i> with URLs and available in your current HAProxy.
</I>i use iptables to intercept the request, and need the set-uri option in 
haproxy 1.6.x to concatenate the Host header with the GET, in order to 
have the request in the form that squid expects the request.  yes, they 
are separate actions and i should have been clearer.

i will look into the PROXY protocol additions, but that may not be an 
option until i can get all my boxes upgraded.
&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>   my
</I>&gt;&gt;<i> problem is that i run authenticated access on the proxy, and will need
</I>&gt;&gt;<i> to exempt the traffic from that restriction.
</I>&gt;&gt;<i>
</I>&gt;<i> What restriction?
</I>the authenticated access restriction.  not much of my policy allows for 
unauthenticated access.
&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> what mechanisms can i use to identify the fact that the client traffic
</I>&gt;&gt;<i> has been intercepted, so that i can create ACLs to match the traffic?  i
</I>&gt;&gt;<i> don't want to use things like IPs or User-Agent strings, as they may
</I>&gt;&gt;<i> change or be unknown.
</I>&gt;<i> Only the interceptor can do that traffic distinction. Once traffic gets
</I>&gt;<i> multiplexed the information is lost.
</I>i tried to create / insert a header at the router/firewall/load 
balancer, and test for the existence of the header in squid, but that 
did not seem to go as well as i thought it might.
&gt;<i>
</I>&gt;&gt;<i> i was thinking about sending the intercepted traffic to a different
</I>&gt;&gt;<i> port, say 3129, and then using localport to identify the traffic. with
</I>&gt;&gt;<i> an ACL, i would exempt the traffic from auth, etc.  are there better
</I>&gt;&gt;<i> options?  how are other folks dealing with intercepted and explicit
</I>&gt;&gt;<i> traffic on the same box?
</I>&gt;<i> That would be one fairly good way to distinguish the traffic types. So
</I>&gt;<i> why is the URL fiddling happening?
</I>because i need to concatenate the Host header with the GET line (URI), 
in order for squid to be able to process the request.  i dont have squid 
3.5 yet, nor do i have haproxy 1.6 yet, so i have to use the old 
interception methods to accomplish this, at this point.
&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>thanks for the feedback.  seems i might be able to do things, just have 
to find my way through until newer versions give me better means of 
doing it.

thanks,

brendan

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009980.html">[squid-users] Identifying intercepted clients
</A></li>
	<LI>Next message (by thread): <A HREF="009981.html">[squid-users] filtering http(s) sites, transparently
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10007">[ date ]</a>
              <a href="thread.html#10007">[ thread ]</a>
              <a href="subject.html#10007">[ subject ]</a>
              <a href="author.html#10007">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
