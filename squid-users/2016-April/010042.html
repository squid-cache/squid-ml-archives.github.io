<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] select parent proxy based on ACL
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20select%20parent%20proxy%20based%20on%20ACL&In-Reply-To=%3C1459948450.9684.43.camel%40watteel.be%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010034.html">
   <LINK REL="Next"  HREF="010044.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] select parent proxy based on ACL</H1>
    <B>Pascal Watteel</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20select%20parent%20proxy%20based%20on%20ACL&In-Reply-To=%3C1459948450.9684.43.camel%40watteel.be%3E"
       TITLE="[squid-users] select parent proxy based on ACL">pascal at watteel.be
       </A><BR>
    <I>Wed Apr  6 13:14:10 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010034.html">[squid-users] select parent proxy based on ACL
</A></li>
        <LI>Next message (by thread): <A HREF="010044.html">[squid-users] select parent proxy based on ACL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10042">[ date ]</a>
              <a href="thread.html#10042">[ thread ]</a>
              <a href="subject.html#10042">[ subject ]</a>
              <a href="author.html#10042">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ok maybe it was't all clear.

I live in Dubai. Our local ISP limits the bandwith per TCP connection
when connections are made outside of the gulf.
Don't ask me why, they just do.
I have a fast 128Mbit link but as i'm limited to 4Mbit per TCP, the
moment i download a file from a non local mirror it's slow.

Aria2c or Uget works perfect on my desktop but i wanted a solution that
would work universal without any software on a pc.

the solution is ranged downloads if the server supports it.
This will make my download split in example 16 ranged byte gets -&gt; 16
TCP connections =&gt; 16X 4Mbit =&gt; descent download speed.

My solution was to write a python based proxy.
<A HREF="https://github.com/intagger/paraproxio">https://github.com/intagger/paraproxio</A>

It does exaclty that but in a proxy form.&#160;
Anything that is not .iso .zip or other that you can define in the
config will just be transparent. Anything that is defined will be split
in segmented downloads and so downloaded faster on my ISP.

Now i already have a Squid proxy in my network with a another Squid
proxy parent in AWS.
I use the proxy for local caching nothing fancy, But use the parent
with an acl to send specific domains to the parent and so enable me to
access sites without the need of a VPN.

I now want to add my Python based proxy as another parent.
However i have no option to tell squid what parent to use.
I would like to create a regex acl in squid and someway tell squid to
use parent proxy X for ACL_X and parent proxy Y for ACL Y.
But i can only use the ACL to say direct or indirect.

And use the proxy-peer-domain statement to choose the parent based on a
domain or tld.

so my question is how to make squid choose the parent based on an ACL.

hope this explanes it better for you.
what my parent does, is not important. It could be anyother parent
proxy.


















On Thu, 2016-04-07 at 00:00 +1200, Amos Jeffries wrote:
&gt;<i> On 6/04/2016 5:38 p.m., Pascal Watteel wrote:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; anyone?
</I>&gt;<i> NP: Messages sent at 12am should be expected to have some response
</I>&gt;<i> delay. (and its always 12am somewhere in the world :-).
</I>&gt;<i> 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; On Tue, 2016-04-05 at 12:08 +0000, Pascal Watteel wrote:
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; Hi peeps,
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; I have written a python based download accelerator based proxy.
</I>&gt;<i> &gt; &gt; It does exactly the same thing as what aria2c would do, but as a
</I>&gt;<i> &gt; &gt; proxy.
</I>&gt;<i> Huh?
</I>&gt;<i> 
</I>&gt;<i> aria2c is a &quot;client&quot; (or &quot;user agent&quot;) in HTTP terminology.
</I>&gt;<i> 
</I>&gt;<i> A proxy is ... a proxy. Which is to say both client and server. But
</I>&gt;<i> definitely NOT a user-agent.
</I>&gt;<i> 
</I>&gt;<i> So either you have written a proxy, or you have written something
</I>&gt;<i> like
</I>&gt;<i> aria2c. Not both.
</I>&gt;<i> 
</I>&gt;<i> &quot;accelerator&quot; is a marketing jargon word. Particularly when used in
</I>&gt;<i> the
</I>&gt;<i> phrase &quot;download acclerator&quot;.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; I now want to tell squid to only send .zip .iso .whatever to this
</I>&gt;<i> &gt; &gt; proxy
</I>&gt;<i> &gt; &gt; as an parent proxy.
</I>&gt;<i> &gt; &gt; But i only find a way how to tell squid to do this for domains
</I>&gt;<i> &gt; &gt; with
</I>&gt;<i> &gt; &gt; peer_domain.
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> &gt; &gt; Is there a way how i can tell squid to decide the parent proxy
</I>&gt;<i> &gt; &gt; based
</I>&gt;<i> &gt; &gt; on
</I>&gt;<i> &gt; &gt; a ACL so i can just use regex define the files i wanna send to
</I>&gt;<i> &gt; &gt; this
</I>&gt;<i> &gt; &gt; parent?
</I>&gt;<i> &gt; &gt; 
</I>&gt;<i> Terminology clash again. Squid does not send files anywhere. Two
</I>&gt;<i> reasons
</I>&gt;<i> for that:
</I>&gt;<i> 
</I>&gt;<i> 1) HTTP is a &quot;pull&quot; protocol: Requests go out (aka &quot;send&quot;). Responses
</I>&gt;<i> come back (aka &quot;receive&quot;). That is all.
</I>&gt;<i> 
</I>&gt;<i> 2) HTTP has therefore no protocol concept of &quot;files&quot;. Squid is only
</I>&gt;<i> aware of the response content-type (note that its &quot;payload&quot; or
</I>&gt;<i> &quot;content&quot;, not 'file') when it is already on its way back to the
</I>&gt;<i> client.
</I>&gt;<i> Far too late to decide which server to send the request message to.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I *think* what you are asking for is:
</I>&gt;<i> &#160;&lt;<A HREF="http://www.squid-cache.org/Doc/config/cache_peer_access/">http://www.squid-cache.org/Doc/config/cache_peer_access/</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> But I am seriously doubting whether you have the right HTTP model
</I>&gt;<i> with
</I>&gt;<i> all this malformed terminology you are using.
</I>&gt;<i> 
</I>&gt;<i> You can approximately guess what the traffic will be by urlpath_regex
</I>&gt;<i> matching the URL path values. But unless you control the servers URL
</I>&gt;<i> design that is just a rough guess.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> PS. &quot;download accelerator&quot; is an old concept from the days 20-odd
</I>&gt;<i> years
</I>&gt;<i> go when networks were slow and HTTP/1.0 was wasting bandwidth to make
</I>&gt;<i> things slower. As with all old concepts in HTTP Squid probably
</I>&gt;<i> already
</I>&gt;<i> does it in one way or several.
</I>&gt;<i> In particular modern HTTP/1.1 plus Caching obsoletes almost all
</I>&gt;<i> &quot;download accelerator&quot; designs in a much more efficient way.
</I>&gt;<i> &#160;If you describe what you actualy want the whole system to do in a
</I>&gt;<i> clear
</I>&gt;<i> way we can perhapse provide you with squid.conf settings to avoid
</I>&gt;<i> needing the extra layer of custom proxy software.
</I>&gt;<i> 
</I>&gt;<i> Amos
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I></PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010034.html">[squid-users] select parent proxy based on ACL
</A></li>
	<LI>Next message (by thread): <A HREF="010044.html">[squid-users] select parent proxy based on ACL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10042">[ date ]</a>
              <a href="thread.html#10042">[ thread ]</a>
              <a href="subject.html#10042">[ subject ]</a>
              <a href="author.html#10042">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
