<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Logging of https
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Logging%20of%20https&In-Reply-To=%3C2B77BF184EAC2F43BB9FC908954D8B1266FFD74E%40Ex5.lnpnews.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010150.html">
   <LINK REL="Next"  HREF="010072.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Logging of https</H1>
    <B>Markey, Bruce</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Logging%20of%20https&In-Reply-To=%3C2B77BF184EAC2F43BB9FC908954D8B1266FFD74E%40Ex5.lnpnews.com%3E"
       TITLE="[squid-users] Logging of https">bmarkey at steinmancommunications.com
       </A><BR>
    <I>Thu Apr  7 13:11:27 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010150.html">[squid-users] Unable to Proxy https traffic using squid
</A></li>
        <LI>Next message (by thread): <A HREF="010072.html">[squid-users] Logging of https
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10064">[ date ]</a>
              <a href="thread.html#10064">[ thread ]</a>
              <a href="subject.html#10064">[ subject ]</a>
              <a href="author.html#10064">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ok thanks for that.  I think I have a slightly better understanding of what is going on.    That being said this is what I've come up with.  

No caching.  All sites allowed, peeking at all. 

I'm hoping this config will simply give me the logging that I'm looking for and nothing else.  And from that link you sent I don't have to install the client side cert?

Thanks

  1 #Access Lists
  2 acl internal src 192.168.200.0/21
  3 acl wireless src 192.168.100.0/23
  4 
  5 #Ports allowed through Squid
  6 acl Safe_ports port 80
  7 acl Safe_ports port 443
  8 acl SSL_ports port 443
  9 acl CONNECT method CONNECT
 10 
 11 #allow/deny
 12 http_access allow internal
 13 http_access allow wireless
 14 http_access deny !Safe_ports
 15 http_access deny CONNECT !SSL_ports
 16 http_access deny all
 17 
 18 #Bumping 
 19 acl step1 at_step SslBump1
 20 acl step2 at_step SslBump2
 21 acl step3 at_step SslBump3
 22 
 23 ssl_bump peek all
 24 ssl_bump splice all
 25 
 26 sslproxy_capath /etc/ssl/certs
 27 
 28 sslcrtd_program /usr/lib/squid3/ssl_crtd -s /opt/var/ssl_db -M 6MB
 29 sslcrtd_children 5
 30 
 31 #certs
 32 cert=/etc/squid3/certs/squid.pem
 33 cafile=/etc/squid3/certs/squid.pem
 34 key=/etc/squid3/certs/squid.pem generate-host-certificates=on dynamic_cert_mem_cache_size=6MB sslflags=NO_SESSION_REUSE
 35 
 36 logformat mine %&gt;a %[ui %[un [%tl] &quot;%rm %ru HTTP/%rv&quot; %ssl::&gt;sni %ssl::&gt;cert_subject %&gt;Hs %&lt;st %Ss:%Sh
 37 
 38 access_log syslog:daemon.info mine
 39 
 40 #intercept
 41 http_port 3128 intercept
 42 https_port 3129 intercept ssl-bump
 43 
 44 #nameservers
 45 dns_nameservers 192.168.201.1 8.8.8.8
 46 
 47 #WCCPv2 items
 48 wccp_version 2
 49 wccp2_router 192.168.200.73
 50 wccp2_forwarding_method gre
 51 wccp2_return_method gre
 52 wccp2_service standard 0 password=LNP1
 53 wccp2_service dynamic 70 password=LNP1
 54 wccp2_service_info 70 protocol=tcp flags=dst_ip_hash priority=240 ports=443
 55

Bruce Markey | Network Security Analyst
STEINMAN COMMUNICATIONS
717.291.8758&#160;(o) |&#160;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">bmarkey at steinmancommunications.com</A>
8 West King St | PO Box 1328, Lancaster, PA 17608-1328

-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of James Lay
Sent: Thursday, March 24, 2016 4:14 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Logging of https

On 2016-03-24 13:41, Markey, Bruce wrote:
&gt;<i> I'm hoping this is a simple question, I've gotten/seen differing 
</I>&gt;<i> answers and I'd just like a final answer.
</I>&gt;<i> 
</I>&gt;<i> With squid setup as a transparent proxy via wccp will there be any log 
</I>&gt;<i> entries for https sites, even just the ip?  Just the initial get 
</I>&gt;<i> request is what I'd expect.
</I>&gt;<i> 
</I>&gt;<i> ( I have no interest in breaking https, I'd simply like to get any 
</I>&gt;<i> data I can without having to go down that road)
</I>&gt;<i> 
</I>&gt;<i> If yes then what needs to be done to make that happen. Currently 
</I>&gt;<i> everything is working on the http side perfectly.  Oh the https side 
</I>&gt;<i> as soon as I enable wccp redirection of 443 to squid it breaks https.
</I>&gt;<i>  ( I'll add here that I've read all the peek and splice info and I 
</I>&gt;<i> don't really understand it.)
</I>&gt;<i> 
</I>&gt;<i> Thanks
</I>&gt;<i> 
</I>&gt;<i> BRUCE MARKEY | Network Security Analyst
</I>&gt;<i> 
</I>&gt;<i> STEINMAN COMMUNICATIONS
</I>&gt;<i> 
</I>&gt;<i> 717.291.8758 (o) | <A HREF="https://lists.squid-cache.org/listinfo/squid-users">bmarkey at steinmancommunications.com</A>
</I>&gt;<i> 
</I>&gt;<i> 8 West King St | PO Box 1328, Lancaster, PA 17608-1328
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

Read this:

<A HREF="http://thread.gmane.org/gmane.comp.web.squid.general/114384/focus=114389">http://thread.gmane.org/gmane.comp.web.squid.general/114384/focus=114389</A>

Sample messages:

allowed https:
Mar 24 14:02:11 gateway (squid-1): 192.168.1.101 - -
[24/Mar/2016:14:02:11 -0600] &quot;CONNECT 209.59.180.48:443 HTTP/1.1&quot; - -
200 5511 TCP_TUNNEL:ORIGINAL_DST

note the size, 5511, and the TCP_TUNNEL, this has no SNI

denied https:
Mar 24 13:36:01 gateway (squid-1): 192.168.1.101 - -
[24/Mar/2016:13:36:01 -0600] &quot;CONNECT 54.171.35.38:443 HTTP/1.1&quot; - - 200
0 TAG_NONE:ORIGINAL_DST

note the size, 0, and the TAG_NONE, and this also has no SNI

Mar 24 13:36:01 gateway (squid-1): 192.168.1.101 - -
[24/Mar/2016:13:36:01 -0600] &quot;CONNECT 54.171.177.121:443 HTTP/1.1&quot; 
track.appsflyer.com - 200 0 TAG_NONE:ORIGINAL_DST

again, size, and TAG_NONE, but we saw SNI for this one.

the above are the output when using the config info in the link.  Hope that helps.

James
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010150.html">[squid-users] Unable to Proxy https traffic using squid
</A></li>
	<LI>Next message (by thread): <A HREF="010072.html">[squid-users] Logging of https
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10064">[ date ]</a>
              <a href="thread.html#10064">[ thread ]</a>
              <a href="subject.html#10064">[ subject ]</a>
              <a href="author.html#10064">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
