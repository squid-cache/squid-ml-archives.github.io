<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3.5.16 and vary loop objects (bug ?)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.16%20and%20vary%20loop%20objects%20%28bug%20%3F%29&In-Reply-To=%3C570667C0.4000704%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010059.html">
   <LINK REL="Next"  HREF="010071.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3.5.16 and vary loop objects (bug ?)</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.16%20and%20vary%20loop%20objects%20%28bug%20%3F%29&In-Reply-To=%3C570667C0.4000704%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid 3.5.16 and vary loop objects (bug ?)">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Apr  7 13:59:28 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010059.html">[squid-users] Squid 3.5.16 and vary loop objects (bug ?)
</A></li>
        <LI>Next message (by thread): <A HREF="010071.html">[squid-users] Squid 3.5.16 and vary loop objects (bug ?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10066">[ date ]</a>
              <a href="thread.html#10066">[ thread ]</a>
              <a href="subject.html#10066">[ subject ]</a>
              <a href="author.html#10066">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 7/04/2016 5:05 a.m., joe wrote:
&gt;<i> amos question ?
</I>&gt;<i> 
</I>&gt;<i> off topic sorry for that 
</I>&gt;<i> 
</I>&gt;<i> vary is the second key store right ?
</I>
I'm not sure what you mean by &quot;second key store&quot;. Its a bit ambiguous.

Squid looks up the URL and finds an object saying there is Vary header
details also needed.
Squid does a second lookup (on the same cache) for a string containing
URL + extras.
Squid then verifies that the object found by that second lookup actually
matches the URL *and* that it has a correct Vary header for the pattern
being looked up (to make sure its from the current Vary set and not some
older obsolete set).

&gt;<i> 
</I>&gt;<i> same object with 2 browser  firefox
</I>&gt;<i> accept-encoding=&quot;gzip,%20deflate&quot;
</I>&gt;<i> 
</I>&gt;<i> chrome
</I>&gt;<i> accept-encoding=&quot;gzip,%20deflate,%20sdch&quot;
</I>&gt;<i> 
</I>&gt;<i> so if they ar 2*1 object stored is that right   ? 
</I>
 (2 +1) objects. Add not multiply.

&gt;<i> and other browser might have more compression 
</I>&gt;<i> accept-encoding=&quot;gzip,%20deflate,%xxxxxxxxxxx
</I>&gt;<i> that will be 3*1   right  if yes
</I>
That would be a third variant, yes.

&gt;<i>   why not filtering only the one has (not
</I>&gt;<i> %) = accept-encoding=&quot;gzip&quot;
</I>&gt;<i> and use that only it will be beter hit and save more storage
</I>&gt;<i> just idea what you think  ??  since &quot;%&quot;  meaning those compression not used
</I>&gt;<i> for the object only
</I>&gt;<i> the one without it 
</I>
The object encoding is not relevant. Surprising maybe, but true.

Think of it like this:

 If you request from me a drink, indicating that you will take Coffee or
Tea. I hand you a Coffee.
 *  Does that mean I dont have plain Water? of course not.

 If you asked me for a drink and indicated you will take Coffee, Tea or
Water. I might hand you Water.

 If you asked for Coffee or Tea a second time. I might hand you Tea.

 If you asked for Beer or Coffee. I might hand you Water. (Even though I
did have Coffee earlier, and I might have Beer but not be willing to
deliver it yet)


The one thing in common with all the requests above was Coffee. But
notice how the most common thing delivered was actually Water, and
sometimes Tea.



Back to caching.

The variant object stored at cache location:
   URL + 'accept-encoding=&quot;gzip,%20deflate&quot;'

... is *only* guaranteed to be whatever object needs to be delivered
when the client sends &quot;Accept-Encoding: gzip, deflate&quot;. That is all.


When the server response contains &quot;Vary: Accept-Encoding&quot; then even a
single-character difference in two client requests Accept-Encoding
header means a different cache variant object. Because that small
difference does mean it could be a different type coming back. Including
the *absence* of that header being one possible variant.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010059.html">[squid-users] Squid 3.5.16 and vary loop objects (bug ?)
</A></li>
	<LI>Next message (by thread): <A HREF="010071.html">[squid-users] Squid 3.5.16 and vary loop objects (bug ?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10066">[ date ]</a>
              <a href="thread.html#10066">[ thread ]</a>
              <a href="subject.html#10066">[ subject ]</a>
              <a href="author.html#10066">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
