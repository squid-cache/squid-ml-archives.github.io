<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Error starting 3.5.16 on FreeBSD-8.4
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Error%20starting%203.5.16%20on%20FreeBSD-8.4&In-Reply-To=%3C57068C61.1030608%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010068.html">
   <LINK REL="Next"  HREF="010079.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Error starting 3.5.16 on FreeBSD-8.4</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Error%20starting%203.5.16%20on%20FreeBSD-8.4&In-Reply-To=%3C57068C61.1030608%40measurement-factory.com%3E"
       TITLE="[squid-users] Error starting 3.5.16 on FreeBSD-8.4">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Apr  7 16:35:45 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010068.html">[squid-users] Error starting 3.5.16 on FreeBSD-8.4
</A></li>
        <LI>Next message (by thread): <A HREF="010079.html">[squid-users] Error starting 3.5.16 on FreeBSD-8.4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10075">[ date ]</a>
              <a href="thread.html#10075">[ thread ]</a>
              <a href="subject.html#10075">[ subject ]</a>
              <a href="author.html#10075">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 04/07/2016 08:21 AM, Odhiambo Washington wrote:

&gt;<i> On 7 April 2016 at 17:16, Amos Jeffries wrote:
</I>&gt;<i> 
</I>&gt;<i>     On 7/04/2016 3:16 a.m., Odhiambo Washington wrote:
</I>&gt;<i>     &gt; I am getting the following error in cache.log:
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; Squid Cache (Version 3.5.16): Terminated abnormally.
</I>&gt;<i>     &gt; FATAL: Ipc::Mem::Segment::create failed to
</I>&gt;<i>     &gt; shm_open(/opt/squid-3.5/var/run/squid/cf__metadata.shm): (17) File exists
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; However, that file doesn't exist.
</I>
&gt;<i>     This can happen if you have a startup script the runs 'squid -z' or
</I>&gt;<i>     similar just prior to starting the main proxy, and not waiting
</I>&gt;<i>     sufficiently long for the -z run to finish.
</I>

&gt;<i> I am gonna check this out again tonight although I doubt if that is the
</I>&gt;<i> cause.
</I>&gt;<i> 
</I>&gt;<i> I run squid using daemontools, invoked as:
</I>&gt;<i> 
</I>&gt;<i> exec setuidgid root /opt/squid-3.5/sbin/squid -f
</I>&gt;<i> /opt/squid-3.5/etc/squid.conf -N
</I>&gt;<i> 
</I>&gt;<i> /opt/squid-3.5/var/run/squid/ is actually empty when I get this error.
</I>

I see two possibilities:

1. The file was there at the time the error was triggered but was not
there at the time you checked the directory. This would mean that
something is starting a second Squid while the first Squid has not
removed the shared memory segment file (yet). Amos mentioned one such
common scenario (not waiting for background squid-z) but there are
others, possibly including handling of Squid crashes. Do you see any
other errors, assertions, or FATAL messages in your cache.log?

2. Squid code that is trying to open the shared segment is broken or,
more likely, not compatible with your FreeBSD environment. For example,
it tries to exclusively create a shared segment using the wrong name.

If you can reproduce this, I recommend starting Squid via strace (or
equivalent) to see the system calls that Squid is making when calling
shm_open() and the exact call parameters. This can confirm or eliminate
#2 as the suspect.


HTH,

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010068.html">[squid-users] Error starting 3.5.16 on FreeBSD-8.4
</A></li>
	<LI>Next message (by thread): <A HREF="010079.html">[squid-users] Error starting 3.5.16 on FreeBSD-8.4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10075">[ date ]</a>
              <a href="thread.html#10075">[ thread ]</a>
              <a href="subject.html#10075">[ subject ]</a>
              <a href="author.html#10075">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
