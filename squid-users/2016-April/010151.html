<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Sibling cache returns 504 when accessing cached objects
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Sibling%20cache%20returns%20504%20when%20accessing%20cached%0A%20objects&In-Reply-To=%3C570EE612.2080501%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010148.html">
   <LINK REL="Next"  HREF="010149.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Sibling cache returns 504 when accessing cached objects</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Sibling%20cache%20returns%20504%20when%20accessing%20cached%0A%20objects&In-Reply-To=%3C570EE612.2080501%40treenet.co.nz%3E"
       TITLE="[squid-users] Sibling cache returns 504 when accessing cached objects">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Apr 14 00:36:34 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010148.html">[squid-users] Sibling cache returns 504 when accessing cached	objects
</A></li>
        <LI>Next message (by thread): <A HREF="010149.html">[squid-users] Stuggling with 3.5.16 on FreeBSD-9.3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10151">[ date ]</a>
              <a href="thread.html#10151">[ thread ]</a>
              <a href="subject.html#10151">[ subject ]</a>
              <a href="author.html#10151">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 14/04/2016 4:28 a.m., Tomas Mozes wrote:
&gt;<i> On Wed, Apr 13, 2016 at 5:39 PM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> On 14/04/2016 2:23 a.m., Tomas Mozes wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I checked upstream (up.example.com) and there was no connection attempt.
</I>&gt;&gt;&gt;<i> Tried with ICP/HTCP, same result. I'm not sure, is this bug
</I>&gt;&gt;&gt;<i> <A HREF="http://bugs.squid-cache.org/show_bug.cgi?id=4223?">http://bugs.squid-cache.org/show_bug.cgi?id=4223?</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I think it is, yes.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Amos
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Can I supply any more information to help fixing this?
</I>&gt;<i> 
</I>
There is a quick-fix and a full fix.

* The quick fix would be to just remove the &quot;only-if-cached&quot; from
sibling lookups. That would let the sibling revalidate. Queries would
result in 200 or such 'successfully', but much slower than they should.

* The full fix for good performance we still need someone to get a ALL,9
debug trace from both proxies and then to figure out from that;
 A) why the sibling is trying to do 304 revalidation on the full fetch
instead of identifying such problems on the HTCP lookup, and
 B) why the front proxy is not doing failover properly on the 504
response it gets back.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010148.html">[squid-users] Sibling cache returns 504 when accessing cached	objects
</A></li>
	<LI>Next message (by thread): <A HREF="010149.html">[squid-users] Stuggling with 3.5.16 on FreeBSD-9.3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10151">[ date ]</a>
              <a href="thread.html#10151">[ thread ]</a>
              <a href="subject.html#10151">[ subject ]</a>
              <a href="author.html#10151">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
