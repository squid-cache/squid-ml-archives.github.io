<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Dynamic/CDN Content Caching Challenges
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Dynamic/CDN%20Content%20Caching%20Challenges&In-Reply-To=%3Cema60ded53-9c53-4d3c-830e-87f234a99878%40augere-1%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010159.html">
   <LINK REL="Next"  HREF="010163.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Dynamic/CDN Content Caching Challenges</H1>
    <B>Muhammad Faisal</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Dynamic/CDN%20Content%20Caching%20Challenges&In-Reply-To=%3Cema60ded53-9c53-4d3c-830e-87f234a99878%40augere-1%3E"
       TITLE="[squid-users] Dynamic/CDN Content Caching Challenges">faisalusuf at yahoo.com
       </A><BR>
    <I>Thu Apr 14 09:32:42 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010159.html">[squid-users] Dynamic/CDN Content Caching Challenges
</A></li>
        <LI>Next message (by thread): <A HREF="010163.html">[squid-users] Dynamic/CDN Content Caching Challenges
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10160">[ date ]</a>
              <a href="thread.html#10160">[ thread ]</a>
              <a href="subject.html#10160">[ subject ]</a>
              <a href="author.html#10160">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Amos for a detailed response.
Well for Squid we are redirecting only HTTP traffic from policy routing. 
The object is unique which is being served to clients but due to 
different redirection of every user a new object is stored.

What about http streaming content having 206 response code how to deal 
with it? afaik squid dont cache 206 partial content. Is this correct?

e.g filehippo below is the sequence:

When I click download button there are two requests one 301 which 
contains (Location header for the requested content) and second 200:

301 Headers: ?

GET 
/download/file/6853a2c840eaefd1d7da43d6f2c94863adc5f470927402e6518d70573a99114d/ 
HTTP/1.1
Host: filehippo.com
Accept: 
text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Encoding: gzip, deflate, sdch
Accept-Language: en-US,en;q=0.8
Cookie: FHSession=mfzdaugt4nu11q3yfxfkjyox; 
FH_PreferredCulture=l=en-US&amp;e=3/30/2017 1:38:22 PM; 
__utmt_UA-5815250-1=1; __qca=P0-1359511593-1459345103148; 
__utma=144473122.1934842269.1459345103.1459345103.1459345103.1; 
__utmb=144473122.3.10.1459345119355; __utmc=144473122; 
__utmz=144473122.1459345103.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none); 
__utmv=144473122.|1=AB%20Test=new-home-v1=1
Referer: 
<A HREF="http://filehippo.com/download_vlc_64/download/56a450f832aee6bb4fda3b01259f9866/">http://filehippo.com/download_vlc_64/download/56a450f832aee6bb4fda3b01259f9866/</A>
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 
(KHTML, like Gecko) Chrome/49.0.2623.87 Safari/537.36

HTTP/1.1 301 Moved Permanently
Accept-Ranges: bytes
Age: 0
Cache-Control: private
Connection: keep-alive
Content-Length: 0
Content-Type: text/html
Date: Wed, 30 Mar 2016 13:38:45 GMT
Location: 
<A HREF="http://fs37.filehippo.com/9546/46cfd241f1da4ae9812f512f7b36643c/vlc-2.2.2-win64.exe">http://fs37.filehippo.com/9546/46cfd241f1da4ae9812f512f7b36643c/vlc-2.2.2-win64.exe</A>
Via: 1.1 varnish
X-Cache: MISS
X-Cache-Hits: 0
x-debug-output: FHSession=mfzdaugt4nu11q3yfxfkjyox; 
FH_PreferredCulture=l=en-US&amp;e=3/30/2017 1:38:22 PM; 
__utmt_UA-5815250-1=1; __qca=P0-1359511593-1459345103148; 
__utma=144473122.1934842269.1459345103.1459345103.1459345103.1; 
__utmb=144473122.3.10.1459345119355; __utmc=144473122; 
__utmz=144473122.1459345103.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none); 
__utmv=144473122.|1=AB%20Test=new-home-v1=1
X-Served-By: cache-lhr6334-LHR

200 Header: Why ATS is not caching octet stream despite having CONFIG 
proxy.config.http.cache.required_headers INT 1
GET /9546/46cfd241f1da4ae9812f512f7b36643c/vlc-2.2.2-win64.exe HTTP/1.1
Host: fs37.filehippo.com
Accept: 
text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Encoding: gzip, deflate, sdch
Accept-Language: en-US,en;q=0.8
Cookie: __utmt_UA-5815250-1=1; __qca=P0-1359511593-1459345103148; 
__utma=144473122.1934842269.1459345103.1459345103.1459345103.1; 
__utmb=144473122.3.10.1459345119355; __utmc=144473122; 
__utmz=144473122.1459345103.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none); 
__utmv=144473122.|1=AB%20Test=new-home-v1=1
Referer: 
<A HREF="http://filehippo.com/download_vlc_64/download/56a450f832aee6bb4fda3b01259f9866/">http://filehippo.com/download_vlc_64/download/56a450f832aee6bb4fda3b01259f9866/</A>
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 
(KHTML, like Gecko) Chrome/49.0.2623.87 Safari/537.36

HTTP/1.1 200 OK
Accept-Ranges: bytes
Age: 739
Connection: keep-alive
Content-Length: 31367109
Content-Type: application/octet-stream
Date: Wed, 30 Mar 2016 13:26:43 GMT
ETag: &quot;81341be3a62d11:0&quot;
Last-Modified: Mon, 08 Feb 2016 06:34:21 GMT

--
Regards,
Faisal.



------ Original Message ------
From: &quot;Amos Jeffries&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Sent: 4/14/2016 2:18:25 PM
Subject: Re: [squid-users] Dynamic/CDN Content Caching Challenges

&gt;<i>On 14/04/2016 8:03 p.m., Muhammad Faisal wrote:
</I>&gt;&gt;<i>  Hi,
</I>&gt;&gt;<i>  I'm trying to deal with dynamic content to be cached by Squid 3.5 (i
</I>&gt;&gt;<i>  tried many other version of squid e.g 2.7, 3.1, 3.4). By Dynamic I 
</I>&gt;&gt;<i>mean
</I>&gt;&gt;<i>  the URL for the actual content is always change this results in the
</I>&gt;&gt;<i>  wastage of Cache storage and low hit rate. As per my understanding I
</I>&gt;&gt;<i>  have two challenges atm:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  1- Websites with dynamic URL for requested content (e.g filehippo,
</I>&gt;&gt;<i>  download.com etc etc)
</I>&gt;<i>
</I>&gt;<i>If the URL is dynamicaly generated, the resource/content behind it may
</I>&gt;<i>be too and thus would fail to meet the uniqueness requirement of 
</I>&gt;<i>StoreID:
</I>&gt;<i>  That every *object* cached at a particular store ID MUST be identical
</I>&gt;<i>(either binary and/or semantically) regardless of the URL(s) mapped to
</I>&gt;<i>that ID.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>  2- Streaming web sites where the dynamic URL has 206 (partial 
</I>&gt;&gt;<i>content)
</I>&gt;&gt;<i>  tune.pk videos for e.g or windows updates (enabling range off set 
</I>&gt;&gt;<i>limit
</I>&gt;&gt;<i>  to -1 causes havoc on upstream to we kept it disable is there some 
</I>&gt;&gt;<i>way
</I>&gt;&gt;<i>  to control the behavior ?)
</I>&gt;<i>
</I>&gt;<i>3- non-HTTP streaming. ICY and such like which are transferred over 
</I>&gt;<i>HTTP
</I>&gt;<i>proxies and supported by Squid but are not cacheable.
</I>&gt;<i>
</I>&gt;<i>4- Dynamic sites where the content *actually* changes between two URLs
</I>&gt;<i>which you think are the same. Unless one has access to the server code
</I>&gt;<i>(ie open source CDN, or at minimum they published the mirroring URL
</I>&gt;<i>structure) it can be a lot of work to guarantee that any two URLs
</I>&gt;<i>matched by a regex pattern meet the uniqueness requirement of StoreID.
</I>&gt;<i>
</I>&gt;<i>Solving #4 usually solves #1 on the way.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  If someone has successfully configured the above scenario please help 
</I>&gt;&gt;<i>me
</I>&gt;&gt;<i>  out as i dont have programming background to deal with this 
</I>&gt;&gt;<i>complexity.
</I>&gt;<i>
</I>&gt;<i>NP: You should not need programming know-how for this. Just &quot;good&quot; 
</I>&gt;<i>level
</I>&gt;<i>of regex experience and knowledge (mistakes are painful in this
</I>&gt;<i>particular situation). Plus ability+willingness to analyse the targeted
</I>&gt;<i>CDNs URL structure vs behaviour in a lot of detail (more systems
</I>&gt;<i>analysis skill than coding).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>The Store-ID helper provided with Squid fed with the regex patterns in
</I>&gt;<i>the wiki &quot;database&quot; for some of the popular CDNs should give you some
</I>&gt;<i>savings. If only the popular jQuery ones.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  I tried using different store-ID helpers but no saving on upstream 
</I>&gt;&gt;<i>the
</I>&gt;&gt;<i>  content is still coming from origin. Below is the helper i have used:
</I>&gt;<i>
</I>&gt;<i>Your low success rate may be from the focus on <A HREF="http://">http://</A> URLs. Most of 
</I>&gt;<i>the
</I>&gt;<i>majors CDNs you are listing in this helper are actually using <A HREF="https://">https://</A>
</I>&gt;<i>URLs for their content nowdays.
</I>&gt;<i>
</I>&gt;<i>Amos
</I>&gt;<i>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>squid-users mailing list
</I>&gt;<i><A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i><A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010159.html">[squid-users] Dynamic/CDN Content Caching Challenges
</A></li>
	<LI>Next message (by thread): <A HREF="010163.html">[squid-users] Dynamic/CDN Content Caching Challenges
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10160">[ date ]</a>
              <a href="thread.html#10160">[ thread ]</a>
              <a href="subject.html#10160">[ subject ]</a>
              <a href="author.html#10160">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
