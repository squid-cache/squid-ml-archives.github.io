<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Dynamic/CDN Content Caching Challenges
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Dynamic/CDN%20Content%20Caching%20Challenges&In-Reply-To=%3C570F7802.5050306%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010160.html">
   <LINK REL="Next"  HREF="010164.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Dynamic/CDN Content Caching Challenges</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Dynamic/CDN%20Content%20Caching%20Challenges&In-Reply-To=%3C570F7802.5050306%40treenet.co.nz%3E"
       TITLE="[squid-users] Dynamic/CDN Content Caching Challenges">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Apr 14 10:59:14 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010160.html">[squid-users] Dynamic/CDN Content Caching Challenges
</A></li>
        <LI>Next message (by thread): <A HREF="010164.html">[squid-users] Dynamic/CDN Content Caching Challenges
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10163">[ date ]</a>
              <a href="thread.html#10163">[ thread ]</a>
              <a href="subject.html#10163">[ subject ]</a>
              <a href="author.html#10163">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 14/04/2016 9:32 p.m., Muhammad Faisal wrote:
&gt;<i> Thanks Amos for a detailed response.
</I>&gt;<i> Well for Squid we are redirecting only HTTP traffic from policy routing.
</I>&gt;<i> The object is unique which is being served to clients but due to
</I>&gt;<i> different redirection of every user a new object is stored.
</I>&gt;<i> 
</I>&gt;<i> What about http streaming content having 206 response code how to deal
</I>&gt;<i> with it? afaik squid dont cache 206 partial content. Is this correct?
</I>
Squid does not cache 206 from the server. But a HIT served by Squid can
be 206 status.

&gt;<i> 
</I>&gt;<i> e.g filehippo below is the sequence:
</I>&gt;<i> 
</I>&gt;<i> When I click download button there are two requests one 301 which
</I>&gt;<i> contains (Location header for the requested content) and second 200:
</I>&gt;<i> 
</I>&gt;<i> 301 Headers: ?
</I>&gt;<i> 
</I>&gt;<i> GET
</I>&gt;<i> /download/file/6853a2c840eaefd1d7da43d6f2c94863adc5f470927402e6518d70573a99114d/
</I>&gt;<i> HTTP/1.1
</I>&gt;<i> Host: filehippo.com
</I>&gt;<i> Accept:
</I>&gt;<i> text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
</I>&gt;<i> Accept-Encoding: gzip, deflate, sdch
</I>&gt;<i> Accept-Language: en-US,en;q=0.8
</I>&gt;<i> Cookie: FHSession=mfzdaugt4nu11q3yfxfkjyox;
</I>&gt;<i> FH_PreferredCulture=l=en-US&amp;e=3/30/2017 1:38:22 PM;
</I>&gt;<i> __utmt_UA-5815250-1=1; __qca=P0-1359511593-1459345103148;
</I>&gt;<i> __utma=144473122.1934842269.1459345103.1459345103.1459345103.1;
</I>&gt;<i> __utmb=144473122.3.10.1459345119355; __utmc=144473122;
</I>&gt;<i> __utmz=144473122.1459345103.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none);
</I>&gt;<i> __utmv=144473122.|1=AB%20Test=new-home-v1=1
</I>&gt;<i> Referer:
</I>&gt;<i> <A HREF="http://filehippo.com/download_vlc_64/download/56a450f832aee6bb4fda3b01259f9866/">http://filehippo.com/download_vlc_64/download/56a450f832aee6bb4fda3b01259f9866/</A>
</I>&gt;<i> 
</I>&gt;<i> Upgrade-Insecure-Requests: 1
</I>&gt;<i> User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36
</I>&gt;<i> (KHTML, like Gecko) Chrome/49.0.2623.87 Safari/537.36
</I>&gt;<i> 
</I>&gt;<i> HTTP/1.1 301 Moved Permanently
</I>&gt;<i> Accept-Ranges: bytes
</I>&gt;<i> Age: 0
</I>&gt;<i> Cache-Control: private
</I>&gt;<i> Connection: keep-alive
</I>&gt;<i> Content-Length: 0
</I>&gt;<i> Content-Type: text/html
</I>&gt;<i> Date: Wed, 30 Mar 2016 13:38:45 GMT
</I>&gt;<i> Location:
</I>&gt;<i> <A HREF="http://fs37.filehippo.com/9546/46cfd241f1da4ae9812f512f7b36643c/vlc-2.2.2-win64.exe">http://fs37.filehippo.com/9546/46cfd241f1da4ae9812f512f7b36643c/vlc-2.2.2-win64.exe</A>
</I>&gt;<i> 
</I>&gt;<i> Via: 1.1 varnish
</I>&gt;<i> X-Cache: MISS
</I>&gt;<i> X-Cache-Hits: 0
</I>&gt;<i> x-debug-output: FHSession=mfzdaugt4nu11q3yfxfkjyox;
</I>&gt;<i> FH_PreferredCulture=l=en-US&amp;e=3/30/2017 1:38:22 PM;
</I>&gt;<i> __utmt_UA-5815250-1=1; __qca=P0-1359511593-1459345103148;
</I>&gt;<i> __utma=144473122.1934842269.1459345103.1459345103.1459345103.1;
</I>&gt;<i> __utmb=144473122.3.10.1459345119355; __utmc=144473122;
</I>&gt;<i> __utmz=144473122.1459345103.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none);
</I>&gt;<i> __utmv=144473122.|1=AB%20Test=new-home-v1=1
</I>&gt;<i> X-Served-By: cache-lhr6334-LHR
</I>&gt;<i> 
</I>
Ew. Borked server. 302 may be old but there are situations (this being
one) where it actually is appropriate to respond with a temporary status.

It also seems to contain an amateur attempt at cache-optimization by
someone who does not understand what middleware does.


You could technically force this to cache. But its not worth it. Let the
site admin who made that yucky response deal with the 2x latency cost
they created. Better to Store-ID cache the thing its Location header is
pointing to.


&gt;<i> 200 Header: Why ATS is not caching octet stream despite having CONFIG
</I>&gt;<i> proxy.config.http.cache.required_headers INT 1
</I>
Squid is not ATS. The 301 response above is CC:private so only the
receiving browser is allowed to cache it. What was the question?

&gt;<i> GET /9546/46cfd241f1da4ae9812f512f7b36643c/vlc-2.2.2-win64.exe HTTP/1.1
</I>&gt;<i> Host: fs37.filehippo.com
</I>
What do you know about the components of that URL...

* What does &quot;9546&quot; mean;
 - just a random number?
 - some form of customer-ID videolan have with Filehippo ?
 - some form of category ID that represents VLC software type etc?

* What does the long random looking hex number mean;
 - just a random visitor session ID?
 - the hash sum for the VLC binary being fetched?

... or something else?

try some manual requests with different values and see what happens to
the response. Pay particular attention to the ETag response header, its
size, and if you want to be paranoid take the SHA1 and MD5 hashes of the
response object when it looks like it should be identical.

Check your logs for patterns in the URLs and test in teh same ways the
other files you find people fetching.

If that checks out then you know what your Store-ID pattern can drop and
what needs to be kept.

This is the hard way, and a &quot;lot of work&quot; as I mentioned earlier. If you
want to help the community then please contribute back by putting your
findings into the wiki Store-ID database pages so all that work does not
go to waste.

&gt;<i> 
</I>&gt;<i> HTTP/1.1 200 OK
</I>&gt;<i> Accept-Ranges: bytes
</I>&gt;<i> Age: 739
</I>&gt;<i> Connection: keep-alive
</I>&gt;<i> Content-Length: 31367109
</I>&gt;<i> Content-Type: application/octet-stream
</I>&gt;<i> Date: Wed, 30 Mar 2016 13:26:43 GMT
</I>&gt;<i> ETag: &quot;81341be3a62d11:0&quot;
</I>&gt;<i> Last-Modified: Mon, 08 Feb 2016 06:34:21 GMT
</I>&gt;<i> 
</I>
Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010160.html">[squid-users] Dynamic/CDN Content Caching Challenges
</A></li>
	<LI>Next message (by thread): <A HREF="010164.html">[squid-users] Dynamic/CDN Content Caching Challenges
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10163">[ date ]</a>
              <a href="thread.html#10163">[ thread ]</a>
              <a href="subject.html#10163">[ subject ]</a>
              <a href="author.html#10163">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
