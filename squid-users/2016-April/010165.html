<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Dynamic/CDN Content Caching Challenges
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Dynamic/CDN%20Content%20Caching%20Challenges&In-Reply-To=%3Cem7ddbe311-8922-45da-a409-21f2be3cdfc1%40augere-1%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010164.html">
   <LINK REL="Next"  HREF="010166.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Dynamic/CDN Content Caching Challenges</H1>
    <B>Muhammad Faisal</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Dynamic/CDN%20Content%20Caching%20Challenges&In-Reply-To=%3Cem7ddbe311-8922-45da-a409-21f2be3cdfc1%40augere-1%3E"
       TITLE="[squid-users] Dynamic/CDN Content Caching Challenges">faisalusuf at yahoo.com
       </A><BR>
    <I>Thu Apr 14 13:18:46 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010164.html">[squid-users] Dynamic/CDN Content Caching Challenges
</A></li>
        <LI>Next message (by thread): <A HREF="010166.html">[squid-users] Dynamic/CDN Content Caching Challenges
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10165">[ date ]</a>
              <a href="thread.html#10165">[ thread ]</a>
              <a href="subject.html#10165">[ subject ]</a>
              <a href="author.html#10165">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Amos,
As you mentioned &quot;Better to Store-ID cache the thing its Location header 
is pointing to.&quot; The problem is Location header has random strings in 
the URL that caused unique URL for the same object.
Location: 
<A HREF="http://fs37.filehippo.com/9546/46cfd241f1da4ae9812f512f7b36643c/vlc-2.2.2-win64.exe">http://fs37.filehippo.com/9546/46cfd241f1da4ae9812f512f7b36643c/vlc-2.2.2-win64.exe</A>

Random string in the URL &quot;/9546/46cfd241f1da4ae9812f512f7b36643c&quot;

I was trying to deal with this situation.

--
Regards,
Faisal.



------ Original Message ------
From: &quot;Muhammad Faisal&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">faisalusuf at yahoo.com</A>&gt;
To: &quot;Amos Jeffries&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;; 
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Sent: 4/14/2016 4:21:16 PM
Subject: Re: [squid-users] Dynamic/CDN Content Caching Challenges

&gt;<i>Thanks i will keep grinding on other websites. Currently working on 
</I>&gt;<i>streaming videos to be served from Cache. I'm a bit confuse on cache 
</I>&gt;<i>hit reason why its miss is it because of 206 or some other reason:
</I>&gt;<i>
</I>&gt;<i>TCP_MISS/206 3874196 GET 
</I>&gt;<i><A HREF="http://cw002.foo.net/files/videos/2015/12/30/145148227265e28-360.mp4">http://cw002.foo.net/files/videos/2015/12/30/145148227265e28-360.mp4</A> - 
</I>&gt;<i>ORIGINAL_DST/a.b.c.d video/mp4
</I>&gt;<i>
</I>&gt;<i>Im trying with the regexp with store-ID helper to be served from the 
</I>&gt;<i>cache and save it as single object because [cw002] could change and 
</I>&gt;<i>will result in a different object.
</I>&gt;<i>
</I>&gt;<i>so my understanding with storeid helper to deal with those objects 
</I>&gt;<i>which are similar but originating from different hosts is correct?
</I>&gt;<i>http:\/\/(cws[0-9]+)\.foo.net\/files\/videos\/.*\/.*\/(.*\.mp4)
</I>&gt;<i>
</I>&gt;<i>to store as <A HREF="http://cdn.foo.net/">http://cdn.foo.net/</A>&quot; . $1
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>--
</I>&gt;<i>Regards,
</I>&gt;<i>Faisal.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>------ Original Message ------
</I>&gt;<i>From: &quot;Amos Jeffries&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
</I>&gt;<i>To: &quot;Muhammad Faisal&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">faisalusuf at yahoo.com</A>&gt;; 
</I>&gt;<i><A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>Sent: 4/14/2016 3:59:14 PM
</I>&gt;<i>Subject: Re: [squid-users] Dynamic/CDN Content Caching Challenges
</I>&gt;<i>
</I>&gt;&gt;<i>On 14/04/2016 9:32 p.m., Muhammad Faisal wrote:
</I>&gt;&gt;&gt;<i>  Thanks Amos for a detailed response.
</I>&gt;&gt;&gt;<i>  Well for Squid we are redirecting only HTTP traffic from policy 
</I>&gt;&gt;&gt;<i>routing.
</I>&gt;&gt;&gt;<i>  The object is unique which is being served to clients but due to
</I>&gt;&gt;&gt;<i>  different redirection of every user a new object is stored.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  What about http streaming content having 206 response code how to 
</I>&gt;&gt;&gt;<i>deal
</I>&gt;&gt;&gt;<i>  with it? afaik squid dont cache 206 partial content. Is this 
</I>&gt;&gt;&gt;<i>correct?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Squid does not cache 206 from the server. But a HIT served by Squid 
</I>&gt;&gt;<i>can
</I>&gt;&gt;<i>be 206 status.
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  e.g filehippo below is the sequence:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  When I click download button there are two requests one 301 which
</I>&gt;&gt;&gt;<i>  contains (Location header for the requested content) and second 200:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  301 Headers: ?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  GET
</I>&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;<i>/download/file/6853a2c840eaefd1d7da43d6f2c94863adc5f470927402e6518d70573a99114d/
</I>&gt;&gt;&gt;<i>  HTTP/1.1
</I>&gt;&gt;&gt;<i>  Host: filehippo.com
</I>&gt;&gt;&gt;<i>  Accept:
</I>&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;<i>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
</I>&gt;&gt;&gt;<i>  Accept-Encoding: gzip, deflate, sdch
</I>&gt;&gt;&gt;<i>  Accept-Language: en-US,en;q=0.8
</I>&gt;&gt;&gt;<i>  Cookie: FHSession=mfzdaugt4nu11q3yfxfkjyox;
</I>&gt;&gt;&gt;<i>  FH_PreferredCulture=l=en-US&amp;e=3/30/2017 1:38:22 PM;
</I>&gt;&gt;&gt;<i>  __utmt_UA-5815250-1=1; __qca=P0-1359511593-1459345103148;
</I>&gt;&gt;&gt;<i>  __utma=144473122.1934842269.1459345103.1459345103.1459345103.1;
</I>&gt;&gt;&gt;<i>  __utmb=144473122.3.10.1459345119355; __utmc=144473122;
</I>&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;<i>__utmz=144473122.1459345103.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none);
</I>&gt;&gt;&gt;<i>  __utmv=144473122.|1=AB%20Test=new-home-v1=1
</I>&gt;&gt;&gt;<i>  Referer:
</I>&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;<i><A HREF="http://filehippo.com/download_vlc_64/download/56a450f832aee6bb4fda3b01259f9866/">http://filehippo.com/download_vlc_64/download/56a450f832aee6bb4fda3b01259f9866/</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  Upgrade-Insecure-Requests: 1
</I>&gt;&gt;&gt;<i>  User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36
</I>&gt;&gt;&gt;<i>  (KHTML, like Gecko) Chrome/49.0.2623.87 Safari/537.36
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  HTTP/1.1 301 Moved Permanently
</I>&gt;&gt;&gt;<i>  Accept-Ranges: bytes
</I>&gt;&gt;&gt;<i>  Age: 0
</I>&gt;&gt;&gt;<i>  Cache-Control: private
</I>&gt;&gt;&gt;<i>  Connection: keep-alive
</I>&gt;&gt;&gt;<i>  Content-Length: 0
</I>&gt;&gt;&gt;<i>  Content-Type: text/html
</I>&gt;&gt;&gt;<i>  Date: Wed, 30 Mar 2016 13:38:45 GMT
</I>&gt;&gt;&gt;<i>  Location:
</I>&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;<i><A HREF="http://fs37.filehippo.com/9546/46cfd241f1da4ae9812f512f7b36643c/vlc-2.2.2-win64.exe">http://fs37.filehippo.com/9546/46cfd241f1da4ae9812f512f7b36643c/vlc-2.2.2-win64.exe</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  Via: 1.1 varnish
</I>&gt;&gt;&gt;<i>  X-Cache: MISS
</I>&gt;&gt;&gt;<i>  X-Cache-Hits: 0
</I>&gt;&gt;&gt;<i>  x-debug-output: FHSession=mfzdaugt4nu11q3yfxfkjyox;
</I>&gt;&gt;&gt;<i>  FH_PreferredCulture=l=en-US&amp;e=3/30/2017 1:38:22 PM;
</I>&gt;&gt;&gt;<i>  __utmt_UA-5815250-1=1; __qca=P0-1359511593-1459345103148;
</I>&gt;&gt;&gt;<i>  __utma=144473122.1934842269.1459345103.1459345103.1459345103.1;
</I>&gt;&gt;&gt;<i>  __utmb=144473122.3.10.1459345119355; __utmc=144473122;
</I>&gt;&gt;&gt;<i>  
</I>&gt;&gt;&gt;<i>__utmz=144473122.1459345103.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none);
</I>&gt;&gt;&gt;<i>  __utmv=144473122.|1=AB%20Test=new-home-v1=1
</I>&gt;&gt;&gt;<i>  X-Served-By: cache-lhr6334-LHR
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Ew. Borked server. 302 may be old but there are situations (this being
</I>&gt;&gt;<i>one) where it actually is appropriate to respond with a temporary 
</I>&gt;&gt;<i>status.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>It also seems to contain an amateur attempt at cache-optimization by
</I>&gt;&gt;<i>someone who does not understand what middleware does.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>You could technically force this to cache. But its not worth it. Let 
</I>&gt;&gt;<i>the
</I>&gt;&gt;<i>site admin who made that yucky response deal with the 2x latency cost
</I>&gt;&gt;<i>they created. Better to Store-ID cache the thing its Location header 
</I>&gt;&gt;<i>is
</I>&gt;&gt;<i>pointing to.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  200 Header: Why ATS is not caching octet stream despite having 
</I>&gt;&gt;&gt;<i>CONFIG
</I>&gt;&gt;&gt;<i>  proxy.config.http.cache.required_headers INT 1
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Squid is not ATS. The 301 response above is CC:private so only the
</I>&gt;&gt;<i>receiving browser is allowed to cache it. What was the question?
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  GET /9546/46cfd241f1da4ae9812f512f7b36643c/vlc-2.2.2-win64.exe 
</I>&gt;&gt;&gt;<i>HTTP/1.1
</I>&gt;&gt;&gt;<i>  Host: fs37.filehippo.com
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>What do you know about the components of that URL...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>* What does &quot;9546&quot; mean;
</I>&gt;&gt;<i>  - just a random number?
</I>&gt;&gt;<i>  - some form of customer-ID videolan have with Filehippo ?
</I>&gt;&gt;<i>  - some form of category ID that represents VLC software type etc?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>* What does the long random looking hex number mean;
</I>&gt;&gt;<i>  - just a random visitor session ID?
</I>&gt;&gt;<i>  - the hash sum for the VLC binary being fetched?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>... or something else?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>try some manual requests with different values and see what happens to
</I>&gt;&gt;<i>the response. Pay particular attention to the ETag response header, 
</I>&gt;&gt;<i>its
</I>&gt;&gt;<i>size, and if you want to be paranoid take the SHA1 and MD5 hashes of 
</I>&gt;&gt;<i>the
</I>&gt;&gt;<i>response object when it looks like it should be identical.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Check your logs for patterns in the URLs and test in teh same ways the
</I>&gt;&gt;<i>other files you find people fetching.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>If that checks out then you know what your Store-ID pattern can drop 
</I>&gt;&gt;<i>and
</I>&gt;&gt;<i>what needs to be kept.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>This is the hard way, and a &quot;lot of work&quot; as I mentioned earlier. If 
</I>&gt;&gt;<i>you
</I>&gt;&gt;<i>want to help the community then please contribute back by putting your
</I>&gt;&gt;<i>findings into the wiki Store-ID database pages so all that work does 
</I>&gt;&gt;<i>not
</I>&gt;&gt;<i>go to waste.
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  HTTP/1.1 200 OK
</I>&gt;&gt;&gt;<i>  Accept-Ranges: bytes
</I>&gt;&gt;&gt;<i>  Age: 739
</I>&gt;&gt;&gt;<i>  Connection: keep-alive
</I>&gt;&gt;&gt;<i>  Content-Length: 31367109
</I>&gt;&gt;&gt;<i>  Content-Type: application/octet-stream
</I>&gt;&gt;&gt;<i>  Date: Wed, 30 Mar 2016 13:26:43 GMT
</I>&gt;&gt;&gt;<i>  ETag: &quot;81341be3a62d11:0&quot;
</I>&gt;&gt;&gt;<i>  Last-Modified: Mon, 08 Feb 2016 06:34:21 GMT
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Amos
</I>&gt;&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010164.html">[squid-users] Dynamic/CDN Content Caching Challenges
</A></li>
	<LI>Next message (by thread): <A HREF="010166.html">[squid-users] Dynamic/CDN Content Caching Challenges
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10165">[ date ]</a>
              <a href="thread.html#10165">[ thread ]</a>
              <a href="subject.html#10165">[ subject ]</a>
              <a href="author.html#10165">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
