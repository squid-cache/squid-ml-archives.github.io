<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 4: Cloudflare SSL connection problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%204%3A%20Cloudflare%20SSL%20connection%20problem&In-Reply-To=%3C570FE20F.5080704%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010167.html">
   <LINK REL="Next"  HREF="010169.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 4: Cloudflare SSL connection problem</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%204%3A%20Cloudflare%20SSL%20connection%20problem&In-Reply-To=%3C570FE20F.5080704%40gmail.com%3E"
       TITLE="[squid-users] Squid 4: Cloudflare SSL connection problem">yvoinov at gmail.com
       </A><BR>
    <I>Thu Apr 14 18:31:43 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010167.html">[squid-users] Squid 4: Cloudflare SSL connection problem
</A></li>
        <LI>Next message (by thread): <A HREF="010169.html">[squid-users] Squid 4: Cloudflare SSL connection problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10168">[ date ]</a>
              <a href="thread.html#10168">[ thread ]</a>
              <a href="subject.html#10168">[ subject ]</a>
              <a href="author.html#10168">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256
 
Ok, nobody.

Well.

I've done my own research.

My suggestions:

CloudFlare now uses it's own custom OpenSSL 1.0.2 with very custom
patches with CHACHA Poly support.

This patches is not in upstream. Moreover, OpenSSL team no plans in the
foreseeable future to support the latest ciphers.

So, Squid 4 can't handshake TLS with CF right now. Possible it is Squid
4.x branch bug. Because of 3.5.x does CF handshake.

LibreSSL does CHACHA right now.

The question is:

Amos, does Squid can support LibreSSL and, if no, when you plan to support?

14.04.16 20:38, Yuri Voinov &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i>
</I>&gt;<i> Any ideas?
</I>&gt;<i>
</I>&gt;<i> Anybody?
</I>&gt;<i>
</I>&gt;<i> 13.04.16 2:37, Yuri Voinov &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt; I suggests the matter can be openssl not OS:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt; root @ cthulhu /patch # openssl version -a
</I>&gt;<i>
</I>&gt;<i>       &gt; OpenSSL 1.0.1s  1 Mar 2016
</I>&gt;<i>
</I>&gt;<i>       &gt; built on: Tue Mar  1 15:42:26 2016
</I>&gt;<i>
</I>&gt;<i>       &gt; platform: solaris64-x86_64-cc-sunw
</I>&gt;<i>
</I>&gt;<i>       &gt; options:  bn(64,64) rc4(16x,int) des(ptr,cisc,16,int)
</I>&gt;<i>       idea(int) blowfish(ptr)
</I>&gt;<i>
</I>&gt;<i>       &gt; compiler: /opt/solarisstudio12.4/bin/cc -I. -I..
</I>&gt;<i>       -I../include  -KPIC -DOPENSSL_PIC -DOPENSSL_THREADS -D_REENTRANT
</I>&gt;<i>       -DDSO_DLFCN -DHAVE_DLFCN_H
</I>&gt;<i>       -DPK11_LIB_LOCATION=&quot;/usr/lib/64/libpkcs11.so&quot; -DHAVE_ISSETUGID
</I>&gt;<i>       -DAV_SPARC_FJAES=0 -xO3 -m64 -xstrconst -Xa -DL_ENDIAN
</I>&gt;<i>       -DOPENSSL_IA32_SSE2 -DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_MONT5
</I>&gt;<i>       -DOPENSSL_BN_ASM_GF2m -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM
</I>&gt;<i>       -DMD5_ASM -DAES_ASM -DVPAES_ASM -DBSAES_ASM -DWHIRLPOOL_ASM
</I>&gt;<i>       -DGHASH_ASM
</I>&gt;<i>
</I>&gt;<i>       &gt; OPENSSLDIR: &quot;/etc/opt/csw/ssl&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt; 13.04.16 2:29, Yuri Voinov &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt; root @ cthulhu /patch # dig www.cloudflare.com
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt; ; &lt;&lt;&gt;&gt; DiG 9.6-ESV-R11-P4
</I>&gt;<i>       &lt;&lt;&gt;&gt;
</I>&gt;<i>
</I>&gt;<i>       &gt;       www.cloudflare.com
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt; ;; global options: +cmd
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt; ;; Got answer:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt; ;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status:
</I>&gt;<i>       NOERROR,
</I>&gt;<i>
</I>&gt;<i>       &gt;       id: 32548
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt; ;; flags: qr rd ra; QUERY: 1, ANSWER: 2,
</I>&gt;<i>       AUTHORITY: 0,
</I>&gt;<i>
</I>&gt;<i>       &gt;       ADDITIONAL: 0
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt; ;; QUESTION SECTION:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt; ;www.cloudflare.com.            IN      A
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt; ;; ANSWER SECTION:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt; www.cloudflare.com.     86400   IN      A     
</I>&gt;<i>
</I>&gt;<i>       &gt;       198.41.214.162
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt; www.cloudflare.com.     86400   IN      A     
</I>&gt;<i>
</I>&gt;<i>       &gt;       198.41.215.162
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt; ;; Query time: 538 msec
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt; ;; SERVER: 127.0.0.1#53(127.0.0.1)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt; ;; WHEN: Wed Apr 13 02:28:34 ALMT 2016
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt; ;; MSG SIZE  rcvd: 68
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt; root @ cthulhu /patch # uname -a
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt; SunOS cthulhu 5.10 Generic_150401-30 i86pc i386
</I>&gt;<i>       i86pc Solaris
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt; But I think OS does not matter here.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt; 13.04.16 2:02, Eliezer Croitoru &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt; &gt; What &quot;dig www.cloudflare.com&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt;       results with?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt;       &gt; Also what OS are you using? I am using
</I>&gt;<i>       CentOS 7 up
</I>&gt;<i>
</I>&gt;<i>       &gt;       to date...
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt;       &gt; Eliezer
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt;       &gt; On 12/04/2016 21:39, Yuri Voinov wrote:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt;       &gt;&gt; root @ cthulhu /patch # openssl
</I>&gt;<i>       s_client
</I>&gt;<i>
</I>&gt;<i>       &gt;       -cipher
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt;       'ECDHE-ECDSA-AES128-GCM-SHA256' -connect
</I>&gt;<i>
</I>&gt;<i>       &gt;       www.cloudflare.com:443
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt;       &gt;
</I>&gt;<i>       _______________________________________________
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt;       &gt; squid-users mailing list
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt;       &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt;       &gt;       &gt;
</I>&gt;<i>       <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBCAAGBQJXD+IPAAoJENNXIZxhPexGhe4IAIdg3PLM/s5YxkP822HNwDA2
fbHLf9XcWe6koYNMMuHJ1NgN4thr5KtXEuQZBTno5TYFlce9P8PaXnnZCPD/xOjM
Bs+J705QG5tqDy5d7EYk606wiefXa8IuifLY0gQnZYjz0pM+CneJw8zVK47VrRwl
jUr/aohgAXuGfUcFMQyX/Jxc/mHHOdC2Pyd1R0qkw93r5LbppDQ5vuS/Hm2clTtt
bSIjFcPv7Ug+kNYp47g6WIoYjbBK7BPpWoolJMIf9p0sF7Scq7RCo30aViWBOcKh
TjVjZdwwTypW0tyLb89D2OKc1ieDVSk6HKcL+Ed1V0TMg2AakXmkXurRR73WP+o=
=umi3
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160415/d3ea5f78/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160415/d3ea5f78/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x613DEC46.asc
Type: application/pgp-keys
Size: 2437 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160415/d3ea5f78/attachment.key">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160415/d3ea5f78/attachment.key</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010167.html">[squid-users] Squid 4: Cloudflare SSL connection problem
</A></li>
	<LI>Next message (by thread): <A HREF="010169.html">[squid-users] Squid 4: Cloudflare SSL connection problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10168">[ date ]</a>
              <a href="thread.html#10168">[ thread ]</a>
              <a href="subject.html#10168">[ subject ]</a>
              <a href="author.html#10168">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
