<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] High CPU usage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20High%20CPU%20usage&In-Reply-To=%3C571250E2.9050103%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010201.html">
   <LINK REL="Next"  HREF="010182.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] High CPU usage</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20High%20CPU%20usage&In-Reply-To=%3C571250E2.9050103%40treenet.co.nz%3E"
       TITLE="[squid-users] High CPU usage">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Apr 16 14:49:06 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010201.html">[squid-users] High CPU usage
</A></li>
        <LI>Next message (by thread): <A HREF="010182.html">[squid-users] Not sure if reverse proxy is what I need
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10193">[ date ]</a>
              <a href="thread.html#10193">[ thread ]</a>
              <a href="subject.html#10193">[ subject ]</a>
              <a href="author.html#10193">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 16/04/2016 6:41 a.m., Mohammad Sadegh Nasiri wrote:
&gt;<i> Thanks Amos for your reply.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> This reaches 800 Mbps with Squid still spending a measurable chunk of its
</I>&gt;&gt;<i> time (~30%) waiting for something to do.
</I>&gt;<i> 
</I>&gt;<i> How do you discovered to this numbers (800Mbps and ~30%)?
</I>
I explained the 800 Mbps in my last post. &quot;adding these together&quot; right
under the set of values which were added together.

~30% CPU is 100% CPU - 67% CPU. The difference of CPU rates in your traces.

&gt;<i> 
</I>&gt;<i> What is median_select_fds means?
</I>
It is the average (median) number of sockets (FD) which the kernel tells
Squid need some processing done (using CPU) when Squid performs an I/O
select(2) to find that out.

&gt;<i> 
</I>&gt;<i> HW info:
</I>&gt;<i> Server model: ProLiant DL380 Gen8]
</I>&gt;<i> CPU: Intel(R) Xeon(R) CPU E5-2670 v2 @ 2.50GHz
</I>&gt;<i> RAM: 128GB
</I>&gt;<i> Disks: Samsung SSD [1TB+512GB+512GB]
</I>&gt;<i> 
</I>&gt;<i> I'm suspicious to Squid configuration or I/O (DMA, RAID)
</I>
If RAID is having any effect it would be making your CPU baseline higher
than it would be without RAID. And during a overload peak slowing down
the recovery. It is unlikely to be the direct cause of the peak event.

The bottleneck for your system appears to be concurrent transactions and
CPU. The amount of work the CPU used by Squid can do each I/O cycle is
less than the work the active FD are needing done.

If you think it is configuration related, then show the config and I/we
can point at things that are making that CPU work exist.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010201.html">[squid-users] High CPU usage
</A></li>
	<LI>Next message (by thread): <A HREF="010182.html">[squid-users] Not sure if reverse proxy is what I need
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10193">[ date ]</a>
              <a href="thread.html#10193">[ thread ]</a>
              <a href="subject.html#10193">[ subject ]</a>
              <a href="author.html#10193">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
