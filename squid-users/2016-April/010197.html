<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Browser circunvents acl's blocking https	(intercept mode)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Browser%20circunvents%20acl%27s%20blocking%20https%0A%09%28intercept%20mode%29&In-Reply-To=%3C70483071-2612-49EC-8994-21C6F35D9170%40spikes.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010196.html">
   <LINK REL="Next"  HREF="010199.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Browser circunvents acl's blocking https	(intercept mode)</H1>
    <B>Jok Thuau</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Browser%20circunvents%20acl%27s%20blocking%20https%0A%09%28intercept%20mode%29&In-Reply-To=%3C70483071-2612-49EC-8994-21C6F35D9170%40spikes.com%3E"
       TITLE="[squid-users] Browser circunvents acl's blocking https	(intercept mode)">jok at spikes.com
       </A><BR>
    <I>Sun Apr 17 01:53:00 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010196.html">[squid-users] Browser circunvents acl's blocking https (intercept	mode)
</A></li>
        <LI>Next message (by thread): <A HREF="010199.html">[squid-users] Browser circunvents acl's blocking https (intercept mode)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10197">[ date ]</a>
              <a href="thread.html#10197">[ thread ]</a>
              <a href="subject.html#10197">[ subject ]</a>
              <a href="author.html#10197">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Blocking YouTube (appear to be on your list) is tricky, if the browser is chrome:

<A HREF="https://en.m.wikipedia.org/wiki/QUIC">https://en.m.wikipedia.org/wiki/QUIC</A>

If you click on the 'green lock' and look at the connection you will see it's not using https (funnily enough, the ads there do!).

Look at the wiki for more info on how to block QUIC.

&gt;<i> On Apr 16, 2016, at 4:10 PM, Sergio Belkin &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">sebelk at gmail.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I cannot block some sites using squid 3.4.8, this the configuration. On Firefox, blocking works, browser says:
</I>&gt;<i> 
</I>&gt;<i> `Error code: SSL_ERROR_RX_RECORD_TOO_LONG`
</I>&gt;<i> 
</I>&gt;<i> But on Chromium Versi&#243;n 49.0.2623.108, browser is not affected by the blocking acl's, despite access_logs says:
</I>&gt;<i> 
</I>&gt;<i> ````
</I>&gt;<i> 192.168.80.250 - - [16/Apr/2016:19:53:17 -0300] &quot;CONNECT 172.217.29.14:443 HTTP/1.1&quot; 403 3443 &quot;-&quot; &quot;-&quot; TCP_DENIED:HIER_NONE
</I>&gt;<i> 192.168.80.250 - - [16/Apr/2016:19:53:17 -0300] &quot;NONE error:invalid-request HTTP/0.0&quot; 400 4042 &quot;-&quot; &quot;-&quot; TAG_NONE:HIER_NONE
</I>&gt;<i> 192.168.80.250 - - [16/Apr/2016:19:53:17 -0300] &quot;CONNECT 172.217.29.14:443 HTTP/1.1&quot; 403 3443 &quot;-&quot; &quot;-&quot; TCP_DENIED:HIER_NONE
</I>&gt;<i> 192.168.80.250 - - [16/Apr/2016:19:53:17 -0300] &quot;CONNECT 172.217.29.14:443 HTTP/1.1&quot; 403 3443 &quot;-&quot; &quot;-&quot; TCP_DENIED:HIER_NONE
</I>&gt;<i> 192.168.80.250 - - [16/Apr/2016:19:53:17 -0300] &quot;CONNECT 172.217.29.14:443 HTTP/1.1&quot; 403 3443 &quot;-&quot; &quot;-&quot; TCP_DENIED:HIER_NONE
</I>&gt;<i> 192.168.80.250 - - [16/Apr/2016:19:53:17 -0300] &quot;NONE error:invalid-request HTTP/0.0&quot; 400 4042 &quot;-&quot; &quot;-&quot; TAG_NONE:HIER_NONE
</I>&gt;<i> 192.168.80.250 - - [16/Apr/2016:19:53:17 -0300] &quot;CONNECT 172.217.29.14:443 HTTP/1.1&quot; 403 3443 &quot;-&quot; &quot;-&quot; TCP_DENIED:HIER_NONE
</I>&gt;<i> 192.168.80.250 - - [16/Apr/2016:19:53:17 -0300] &quot; %BA%5D%B71A%E2%90C%BD0:Ep%82%99%FE%88 HTTP/0.0&quot; 400 3638 &quot;-&quot; &quot;-&quot; TAG_NONE:HIER_NONE
</I>&gt;<i> 192.168.80.250 - - [16/Apr/2016:19:53:17 -0300] &quot;CONNECT 172.217.29.14:443 HTTP/1.1&quot; 403 3443 &quot;-&quot; &quot;-&quot; TCP_DENIED:HIER_NONE
</I>&gt;<i> 192.168.80.250 - - [16/Apr/2016:19:53:17 -0300] &quot;NONE error:invalid-request HTTP/0.0&quot; 400 4042 &quot;-&quot; &quot;-&quot; TAG_NONE:HIER_NONE
</I>&gt;<i> 192.168.80.250 - - [16/Apr/2016:19:53:17 -0300] &quot;CONNECT 172.217.29.14:443 HTTP/1.1&quot; 403 3443 &quot;-&quot; &quot;-&quot; TCP_DENIED:HIER_NONE
</I>&gt;<i> 192.168.80.250 - - [16/Apr/2016:19:53:17 -0300] &quot;NONE error:invalid-request HTTP/0.0&quot; 400 4042 &quot;-&quot; &quot;-&quot; TAG_NONE:HIER_NONE
</I>&gt;<i> 192.168.80.250 - - [16/Apr/2016:19:53:17 -0300] &quot; %11Tf%03%A4%83%F3%8C%EE HTTP/0.0&quot; 400 3614 &quot;-&quot; &quot;-&quot; TAG_NONE:HIER_NONE
</I>&gt;<i> 192.168.80.250 - - [16/Apr/2016:19:53:17 -0300] &quot;NONE error:invalid-request HTTP/0.0&quot; 400 4042 &quot;-&quot; &quot;-&quot; TAG_NONE:HIER_NONE
</I>&gt;<i> 192.168.80.250 - - [16/Apr/2016:19:53:23 -0300] &quot;CONNECT 172.217.29.14:443 HTTP/1.1&quot; 403 3443 &quot;-&quot; &quot;-&quot; TCP_DENIED:HIER_NONE
</I>&gt;<i> 192.168.80.250 - - [16/Apr/2016:19:53:23 -0300] &quot;NONE error:invalid-request HTTP/0.0&quot; 400 4042 &quot;-&quot; &quot;-&quot; TAG_NONE:HIER_NONE
</I>&gt;<i> ````
</I>&gt;<i> 
</I>&gt;<i> Debugging I've found this in cache.log:
</I>&gt;<i> 
</I>&gt;<i> ````
</I>&gt;<i> 2016/04/16 20:00:21.924 kid1| client_side.cc(864) swanSong: local=172.217.28.225:443 remote=192.168.80.250:55068 flags=33
</I>&gt;<i> 2016/04/16 20:00:21.925 kid1| Checklist.cc(62) preCheck: 0x7eff3754 checking fast ACLs
</I>&gt;<i> 2016/04/16 20:00:21.925 kid1| Acl.cc(157) matches: checking access_log daemon:/var/log/squid3/access.log
</I>&gt;<i> 2016/04/16 20:00:21.925 kid1| Acl.cc(157) matches: checking (access_log daemon:/var/log/squid3/access.log line)
</I>&gt;<i> 2016/04/16 20:00:21.925 kid1| Acl.cc(177) matches: checked: (access_log daemon:/var/log/squid3/access.log line) = 1
</I>&gt;<i> 2016/04/16 20:00:21.926 kid1| Acl.cc(177) matches: checked: access_log daemon:/var/log/squid3/access.log = 1
</I>&gt;<i> 2016/04/16 20:00:21.926 kid1| Checklist.cc(55) markFinished: 0x7eff3754 answer ALLOWED for match
</I>&gt;<i> ````
</I>&gt;<i> 
</I>&gt;<i> Please could you help? Am I missing something? Below, my configuration:
</I>&gt;<i> 
</I>&gt;<i> ````
</I>&gt;<i> acl localnet src 192.168.0.0/16 # RFC1918 possible internal network
</I>&gt;<i> acl SSL_ports port 443
</I>&gt;<i> acl Safe_ports port 80          # http
</I>&gt;<i> acl Safe_ports port 21          # ftp
</I>&gt;<i> acl Safe_ports port 443         # https
</I>&gt;<i> acl Safe_ports port 70          # gopher
</I>&gt;<i> acl Safe_ports port 210         # wais
</I>&gt;<i> acl Safe_ports port 1025-65535  # unregistered ports
</I>&gt;<i> acl Safe_ports port 280         # http-mgmt
</I>&gt;<i> acl Safe_ports port 488         # gss-http
</I>&gt;<i> acl Safe_ports port 591         # filemaker
</I>&gt;<i> acl Safe_ports port 777         # multiling http
</I>&gt;<i> acl CONNECT method CONNECT
</I>&gt;<i> acl tvsamsung src 192.168.80.160
</I>&gt;<i> acl sarmiento src 192.168.80.248
</I>&gt;<i> acl netbook src 192.168.80.245
</I>&gt;<i> acl dompermitidos dstdomain &quot;/etc/squid3/rules/whitelistdom&quot;
</I>&gt;<i> acl streaming dstdomain &quot;/etc/squid3/rules/streaming&quot;
</I>&gt;<i> acl test  dstdomain .debian.org
</I>&gt;<i> acl streamingips dst &quot;/etc/squid3/rules/streamingips&quot;
</I>&gt;<i> acl sergiocel src 192.168.80.249
</I>&gt;<i> acl tiempojuanse time SMTWHFA 10:00-13:00
</I>&gt;<i> acl tiempojuanse time SMTWHFA 16:00-22:00
</I>&gt;<i> acl yt dstdomain .youtube.com
</I>&gt;<i> acl facebook dstdomain .facebook.com
</I>&gt;<i> http_access deny !Safe_ports
</I>&gt;<i> http_access deny CONNECT !SSL_ports
</I>&gt;<i> http_access allow localhost manager
</I>&gt;<i> http_access deny manager
</I>&gt;<i> always_direct allow all
</I>&gt;<i> ssl_bump none all
</I>&gt;<i> sslproxy_cert_error allow all
</I>&gt;<i> sslproxy_flags DONT_VERIFY_PEER
</I>&gt;<i> http_access allow  tvsamsung
</I>&gt;<i> http_access deny yt
</I>&gt;<i> http_access allow facebook
</I>&gt;<i> http_access deny  streaming
</I>&gt;<i> http_access deny  streamingips
</I>&gt;<i> http_access allow dompermitidos
</I>&gt;<i> http_access allow  sarmiento
</I>&gt;<i> http_access allow localnet
</I>&gt;<i> http_access allow localhost
</I>&gt;<i> http_access deny all
</I>&gt;<i> http_port 3128
</I>&gt;<i> http_port 3127 intercept
</I>&gt;<i> https_port 8080 intercept ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB cert=/home/proxy/ssl_cert/example.com.cert key=/home/proxy/ssl_cert/example.com.private
</I>&gt;<i> sslcrtd_program /usr/lib/squid3/ssl_crtd -s /var/spool/squid3_ssldb -M 4MB
</I>&gt;<i> access_log daemon:/var/log/squid3/access.log combined
</I>&gt;<i> coredump_dir /var/spool/squid3
</I>&gt;<i> refresh_pattern ^ftp:           1440    20%     10080
</I>&gt;<i> refresh_pattern ^gopher:        1440    0%      1440
</I>&gt;<i> refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
</I>&gt;<i> refresh_pattern .               0       20%     4320
</I>&gt;<i> ````
</I>&gt;<i> 
</I>&gt;<i> Thanks in advance!
</I>&gt;<i> -- 
</I>&gt;<i> --
</I>&gt;<i> Sergio Belkin
</I>&gt;<i> LPIC-2 Certified - <A HREF="http://www.lpi.org">http://www.lpi.org</A>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160416/fd385694/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160416/fd385694/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010196.html">[squid-users] Browser circunvents acl's blocking https (intercept	mode)
</A></li>
	<LI>Next message (by thread): <A HREF="010199.html">[squid-users] Browser circunvents acl's blocking https (intercept mode)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10197">[ date ]</a>
              <a href="thread.html#10197">[ thread ]</a>
              <a href="subject.html#10197">[ subject ]</a>
              <a href="author.html#10197">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
