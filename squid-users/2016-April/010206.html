<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 4: Cloudflare SSL connection problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%204%3A%20Cloudflare%20SSL%20connection%20problem&In-Reply-To=%3C668aa91a-ac71-599a-cf5d-93af25b6da2f%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010198.html">
   <LINK REL="Next"  HREF="010215.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 4: Cloudflare SSL connection problem</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%204%3A%20Cloudflare%20SSL%20connection%20problem&In-Reply-To=%3C668aa91a-ac71-599a-cf5d-93af25b6da2f%40gmail.com%3E"
       TITLE="[squid-users] Squid 4: Cloudflare SSL connection problem">yvoinov at gmail.com
       </A><BR>
    <I>Sun Apr 17 10:50:57 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010198.html">[squid-users] Squid 4: Cloudflare SSL connection problem
</A></li>
        <LI>Next message (by thread): <A HREF="010215.html">[squid-users] Squid 4: Cloudflare SSL connection problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10206">[ date ]</a>
              <a href="thread.html#10206">[ thread ]</a>
              <a href="subject.html#10206">[ subject ]</a>
              <a href="author.html#10206">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256
 
*NIX means UNIX. Solaris is AT&amp;T UNIX. Linux is not UNIX (C) Linus
Torvalds. :) We are not speaking about all possible OS'es. I suggests
the matter in SSL/TLS, not OS or hands or something similar.

The problem is in CF, I think. As a maximum in peek-n-splice.


Because of I've not changed my squid.conf over last year, but approx. in
january 2016 CloudFlare stopped work via proxy, as said my field SA.
AFAIK, CF change own security settings. Also, I suggests, mozilla .org
also moved behind CF.

Ok, let's talk about squid.conf. SSL-related rows are here:

# SSL bump rules
acl DiscoverSNIHost at_step SslBump1
acl NoSSLIntercept ssl::server_name_regex -i
&quot;/usr/local/squid/etc/url.nobump&quot;
acl NoSSLIntercept ssl::server_name_regex -i &quot;/usr/local/squid/etc/url.tor&quot;
ssl_bump peek DiscoverSNIHost
ssl_bump splice NoSSLIntercept
ssl_bump bump all

http_port 3126 intercept
https_port 3127 intercept ssl-bump generate-host-certificates=on
dynamic_cert_mem_cache_size=4MB cert=/usr/local/squid/etc/rootCA.crt
key=/usr/local/squid/etc/rootCA.key
options=SINGLE_DH_USE,SINGLE_ECDH_USE
tls-dh=prime256v1:/usr/local/squid/etc/dhparam.pem
cipher=HIGH:MEDIUM:!aNULL:!eNULL:!RC4:!LOW:!MD5:!EXP:!PSK:!SRP:!DSS
http_port 3128 ssl-bump generate-host-certificates=on
dynamic_cert_mem_cache_size=4MB cert=/usr/local/squid/etc/rootCA.crt
key=/usr/local/squid/etc/rootCA.key
options=SINGLE_DH_USE,SINGLE_ECDH_USE
tls-dh=prime256v1:/usr/local/squid/etc/dhparam.pem
cipher=HIGH:MEDIUM:!aNULL:!eNULL:!RC4:!LOW:!MD5:!EXP:!PSK:!SRP:!DSS
tls_outgoing_options cafile=/usr/local/squid/etc/ca-bundle.crt
options=SINGLE_DH_USE,SINGLE_ECDH_USE
cipher=HIGH:MEDIUM:!aNULL:!eNULL:!RC4:!LOW:!MD5:!EXP:!PSK:!SRP:!DSS
sslproxy_foreign_intermediate_certs /usr/local/squid/etc/intermediate_ca.pem
sslcrtd_program /usr/local/squid/libexec/security_file_certgen -s
/var/lib/ssl_db -M 4MB

I see no anomalies in this lines. Ciphersuite is very relaxed.

Also, if we discuss a bug - may be better to turn on debug to know, why
4.x got first NONE_ABORTED/200 during CONNECT phase and then NONE/503
during TLS negotiate?


17.04.16 14:58, Eliezer Croitoru &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> For me it works.
</I>&gt;<i> ...
</I>&gt;<i> The first thing to do is publish the squid.conf with a bug report and
</I>all other related info.
&gt;<i> *NIX doesn't mean CentOS since on CentOS this specific issue doesn't exit.
</I>&gt;<i> I assume that if it works on CentOS it will work almost the same for
</I>Ubuntu and Debian.
&gt;<i>
</I>&gt;<i> Eliezer
</I>&gt;<i>
</I>&gt;<i> On 16/04/2016 19:50, Yuri Voinov wrote:
</I>&gt;&gt;<i> 3.5.16 on *NIX is also has this issue.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Only 3.5.16 Win64 is works like sharm.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBCAAGBQJXE2qQAAoJENNXIZxhPexGD0wH/1SkyQyaa4gHV4AhXf5RrUTM
oEyGkOcEPwYw6M4+uYgvZ1FzvjrQhS6G8RTH/XrpSZ1utt9nbNSHP+W6FnXyxNPN
J/bauCQeADWf/NUGLG8GnOMXA9LD7w20ylAwOeLe1MUQJ4DTDT4arwzExkx0kohk
4mQNqq1Q105lgh0xyUQWF/wt0Uy3hSs2pPjyK4CGPWCbRO2kmYpPANT0ejoglfsF
uWNYBN5gl4hCd9kVzo0oaVwY2sNUftc1MyYztBpYUQ9WSoHoTnlvAWcWEF7FqHV6
TIB77Pr2fURIkEIlyLIQJ7weXkueOLI8VJp3EYLX5arDDLwu4tfXKpItHx5Tjd8=
=eQPH
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160417/d5433e63/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160417/d5433e63/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x613DEC46.asc
Type: application/pgp-keys
Size: 2437 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160417/d5433e63/attachment.key">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160417/d5433e63/attachment.key</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010198.html">[squid-users] Squid 4: Cloudflare SSL connection problem
</A></li>
	<LI>Next message (by thread): <A HREF="010215.html">[squid-users] Squid 4: Cloudflare SSL connection problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10206">[ date ]</a>
              <a href="thread.html#10206">[ thread ]</a>
              <a href="subject.html#10206">[ subject ]</a>
              <a href="author.html#10206">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
