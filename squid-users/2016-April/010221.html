<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Two questions regarding ssl_bump and peek/splice.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Two%20questions%20regarding%20ssl_bump%20and%20peek/splice.&In-Reply-To=%3C2B77BF184EAC2F43BB9FC908954D8B126704E1A2%40Ex5.lnpnews.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010211.html">
   <LINK REL="Next"  HREF="010222.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Two questions regarding ssl_bump and peek/splice.</H1>
    <B>Markey, Bruce</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Two%20questions%20regarding%20ssl_bump%20and%20peek/splice.&In-Reply-To=%3C2B77BF184EAC2F43BB9FC908954D8B126704E1A2%40Ex5.lnpnews.com%3E"
       TITLE="[squid-users] Two questions regarding ssl_bump and peek/splice.">bmarkey at steinmancommunications.com
       </A><BR>
    <I>Tue Apr 19 13:16:13 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010211.html">[squid-users] http_port with &quot;transparent&quot; or &quot;intercept&quot;?
</A></li>
        <LI>Next message (by thread): <A HREF="010222.html">[squid-users] Two questions regarding ssl_bump and peek/splice.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10221">[ date ]</a>
              <a href="thread.html#10221">[ thread ]</a>
              <a href="subject.html#10221">[ subject ]</a>
              <a href="author.html#10221">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Can anyone point me to a deep dive or something like that about how ssl_bump and peek/splice etc work? The more technical the better.   I don't want to ask a ton of questions about some of the errors I'm getting without fully understanding what is going on.

I currently have squid working almost the way I want it, with just a few remaining issues.  One of them being is that with ssl sites I seem to get a lot of &quot;not private, cert authority&quot; messages then I have to add that site to an acl to not be bumped.    Regarding my first question, I want to understand why.

My second question I think is a quickie.  Can you run 2 log files?  Reason being is that I use squidanalyzer and it only reads the standard log format.  But there are better log formats for what I'm doing. I'd like to keep dual logs while I work on my own analyzer that reads that log file.   You can see the logformat line commented out along with some other log  lines.

Thanks much

Here is my current working config.

#Access Lists
acl internal src 192.168.200.0/21
acl wireless src 192.168.100.0/23

#Ports allowed through Squid
acl Safe_ports port 80
acl Safe_ports port 443
acl SSL_ports port 443
acl CONNECT method CONNECT

#acls from blacklist
acl allowed dstdomain -i &quot;/etc/squid3/acls/http_allowed.acl&quot;
acl prime dstdomain -i &quot;/etc/squid3/acls/squid-prime.acl&quot;
acl china dst -n &quot;/etc/squid3/acls/ccd-china.acl&quot;
acl india dst -n &quot;/etc/squid3/acls/ccd-india.acl&quot;
acl iran dst -n &quot;/etc/squid3/acls/ccd-iran.acl&quot;
acl nigeria dst -n &quot;/etc/squid3/acls/ccd-nigeria.acl&quot;
acl pakistan dst -n &quot;/etc/squid3/acls/ccd-nigeria.acl&quot;
acl romania dst -n &quot;/etc/squid3/acls/ccd-romania.acl&quot;
acl russia dst -n &quot;/etc/squid3/acls/ccd-russia.acl&quot;
acl syria dst -n &quot;/etc/squid3/acls/ccd-syria.acl&quot;
acl ukraine dst -n &quot;/etc/squid3/acls/ccd-ukraine.acl&quot;
acl uzbekistan dst -n &quot;/etc/squid3/acls/ccd-uzbekistan.acl&quot;
acl ips dst -n &quot;/etc/squid3/acls/broken_ips.acl&quot;

#allow/deny
http_access allow allowed
http_access allow ips
http_access deny prime
http_access deny china
http_access deny india
http_access deny iran
http_access deny nigeria
http_access deny pakistan
http_access deny romania
http_access deny russia
http_access deny syria
http_access deny ukraine
http_access deny uzbekistan

http_access allow internal
http_access allow wireless
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access deny all

#Bumping
acl step1 at_step SslBump1
acl step2 at_step SslBump2
acl step3 at_step SslBump3

acl broken_sites ssl::server_name_regex &quot;/etc/squid3/acls/http_broken.txt&quot;

#ssl_bump peek all
ssl_bump peek !broken_sites
ssl_bump splice all
#ssl_bump splice !broken_sites

sslproxy_capath /etc/ssl/certs

sslcrtd_program /lib/squid3/ssl_crtd -s /etc/squid3/ssl_db -M 4MB
sslcrtd_children 32 startup=5 idle=1


#logformat mine %&gt;a %[ui %[un [%tl] &quot;%rm %ru HTTP/%rv&quot; %ssl::&gt;sni %ssl::&gt;cert_subject %&gt;Hs %&lt;st %Ss:%Sh

#access_log syslog:daemon.info mine
#access_log daemon:/var/log/squid3/test.log mine

#intercept
http_port 3128 intercept
https_port 3129 intercept ssl-bump cert=/etc/squid3/certs/squid.pem cafile=/etc/squid3/certs/squid.pem key=/etc/squid3/certs/squid.pem  generate-host-certificates=on dynamic_cert_mem_cache_size=4MB sslflags=NO_SESSION_REUSE

#nameservers
dns_nameservers 192.168.201.1 8.8.8.8

#WCCPv2 items
wccp_version 2
wccp2_router 192.168.200.73
wccp2_forwarding_method gre
wccp2_return_method gre
wccp2_service standard 0 password=LNP1
wccp2_service dynamic 70 password=LNP1
wccp2_service_info 70 protocol=tcp flags=dst_ip_hash priority=240 ports=443

Bruce Markey | Network Security Analyst
STEINMAN COMMUNICATIONS
717.291.8758 (o) | <A HREF="https://lists.squid-cache.org/listinfo/squid-users">bmarkey at steinmancommunications.com</A>
8 West King St | PO Box 1328, Lancaster, PA 17608-1328

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160419/ac42f99c/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160419/ac42f99c/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010211.html">[squid-users] http_port with &quot;transparent&quot; or &quot;intercept&quot;?
</A></li>
	<LI>Next message (by thread): <A HREF="010222.html">[squid-users] Two questions regarding ssl_bump and peek/splice.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10221">[ date ]</a>
              <a href="thread.html#10221">[ thread ]</a>
              <a href="subject.html#10221">[ subject ]</a>
              <a href="author.html#10221">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
