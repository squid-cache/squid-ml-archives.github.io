<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Routing Internally And/Or Externally?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Routing%20Internally%20And/Or%20Externally%3F&In-Reply-To=%3C57171E1A.2070404%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010243.html">
   <LINK REL="Next"  HREF="010245.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Routing Internally And/Or Externally?</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Routing%20Internally%20And/Or%20Externally%3F&In-Reply-To=%3C57171E1A.2070404%40treenet.co.nz%3E"
       TITLE="[squid-users] Routing Internally And/Or Externally?">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Apr 20 06:13:46 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010243.html">[squid-users] Routing Internally And/Or Externally?
</A></li>
        <LI>Next message (by thread): <A HREF="010245.html">[squid-users] Routing Internally And/Or Externally?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10233">[ date ]</a>
              <a href="thread.html#10233">[ thread ]</a>
              <a href="subject.html#10233">[ subject ]</a>
              <a href="author.html#10233">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 20/04/2016 6:16 a.m., nkingsquid wrote:
&gt;<i> Trying to figure out if I need to write a script for this or not... 
</I>&gt;<i> I am Brand new to Squid but have done a ton of searches and can't find this.
</I>&gt;<i> 
</I>&gt;<i> I have authenticated traffic coming to my squid server from the Internet
</I>&gt;<i> (Via a NetScaler).
</I>
How exactly is the NetScalar sending it?
 via NAT or explicit-proxy configuration on the NetScalar?
 how is the Squid expected to validate that the traffic received is from
the NetScalar and not some malware?


&gt;<i>  If the request is for an INTERNAL resource I want it to
</I>&gt;<i> continue on its journey.  However, if it is anything else I want it
</I>&gt;<i> re-directed back to the internet via the netscaler.  (just going to list the
</I>&gt;<i> applicable portion and throw in example data)
</I>
As you have described it sounds like an &quot;open proxy&quot;. Having one of
these in your network is an instant security fail.

&gt;<i> 
</I>&gt;<i> acl localnetPAC src 192.168.0.0/24                        #resource within
</I>&gt;<i> my network
</I>&gt;<i> acl localnetPAC src internal.resources.com              #resource within my
</I>&gt;<i> network
</I>&gt;<i> acl localnetPAC src internal1.resources.com            #resource within my
</I>&gt;<i> network
</I>&gt;<i> acl localnetPAC src internal2.resources.com            #resource within my
</I>&gt;<i> network
</I>&gt;<i> acl localnetPAC src internal3.resources.com            #resource within my
</I>&gt;<i> network
</I>&gt;<i> 
</I>&gt;<i> acl InboundNet scr 10.24.62.51           #NetScaler
</I>&gt;<i> acl OutboundNet scr 10.24.62.51           #NetScaler
</I>&gt;<i> 
</I>&gt;<i> http_access allow localnetPAC                     #user will be let thru to
</I>&gt;<i> the local resources
</I>&gt;<i> InboundNet !localnetPAC allow OutboundNet    #this is what I WANT to do but
</I>&gt;<i> isn't working
</I>&gt;<i>                                                                #can anyone
</I>&gt;<i> steer me to the right track?
</I>

You seem to have made one of the usual beginners mistakes, thinking of
things from a client perspective where source is the place data comes from.

In HTTP we deal with request message orientation. Source (src) is the
place the request came from (the client IP) and destination is where it
is going to (the URL domain, dstdomain).

So what you have configured is that when an *LAN* generated request is
received it is allowed through.


For any request that is allowed to be processed, Squid will lookup where
to send it in DNS and send it there. Use your networks normal recursive
DNS resolver with split-DNS / views delivering the right
internal/external IPs things will &quot;just work&quot; in regards to Squid
delivering the requests. You do have one of those right?

Notice that &quot;internal&quot; and &quot;external&quot; are meaningless. There is simply
&quot;where DNS told me/Squid to go for this URL domain&quot;.


The part you need to work on is what traffic is allowed to be processed.
And how Squid knows that. I suggest at minimum limiting it to only
accepting traffic arriving from the NetScalar IP:

 # The usual security protections go first.
 http_access deny !Safe_ports
 http_access deny CONNECT !SSL_Ports

 # Your local custom permissions go here:
 acl NetScalar src 10.24.62.51
 http_access allow NetScalar

 # deny anything not explicitly permitted.
 http_access deny all


How you have configured the NetScalar to receive traffic and/or to relay
it to Squid may affect what you need to configure. Or may allow better
security protections on the channel between NetScalar and Squid.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010243.html">[squid-users] Routing Internally And/Or Externally?
</A></li>
	<LI>Next message (by thread): <A HREF="010245.html">[squid-users] Routing Internally And/Or Externally?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10233">[ date ]</a>
              <a href="thread.html#10233">[ thread ]</a>
              <a href="subject.html#10233">[ subject ]</a>
              <a href="author.html#10233">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
