<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Never expire any object Squid configuration
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Never%20expire%20any%20object%20Squid%20configuration&In-Reply-To=%3C571754CA.70101%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010235.html">
   <LINK REL="Next"  HREF="010333.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Never expire any object Squid configuration</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Never%20expire%20any%20object%20Squid%20configuration&In-Reply-To=%3C571754CA.70101%40treenet.co.nz%3E"
       TITLE="[squid-users] Never expire any object Squid configuration">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Apr 20 10:07:06 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010235.html">[squid-users] Never expire any object Squid configuration
</A></li>
        <LI>Next message (by thread): <A HREF="010333.html">[squid-users] Never expire any object Squid configuration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10236">[ date ]</a>
              <a href="thread.html#10236">[ thread ]</a>
              <a href="subject.html#10236">[ subject ]</a>
              <a href="author.html#10236">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 20/04/2016 7:24 p.m., Veiko Kukk wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> We have a Squid between our server application and openstack swift
</I>&gt;<i> backend in accel/reverse mode with store-id configuraton (to strip
</I>&gt;<i> temporary authentication URL-s). We want that any object that has been
</I>&gt;<i> stored in squid cache is never again fetched from source and never again
</I>&gt;<i> checked if it is fresh. Well, never in this case could be one year.
</I>
The usual resonse to this is &quot;Squid is a cache, not an archive&quot;.

Squid obeys the instructions given to it by the client and the server.
If the union of those instructions requires a fetch or revalidation it
is important to do so to ensure data integrity.

&gt;<i> 
</I>&gt;<i> Relevant section from current configuration:
</I>&gt;<i> 
</I>&gt;<i> refresh_pattern -i ^https:\/\/AUTH_.*squid.internal.* 526000 100% 526000
</I>&gt;<i> override-expire ignore-reload ignore-no-store ignore-private store-stale
</I>&gt;<i> max-stale=52
</I>&gt;<i> 
</I>&gt;<i> With this configuration, we still see lots of TCP_REFRESH_MODIFIED/200
</I>&gt;<i> TCP_REFRESH_UNMODIFIED/200 and TCP_REFRESH_UNMODIFIED/304 in logs.
</I>&gt;<i> 
</I>&gt;<i> How must Squid be configured to completely disable any refreshes? Those
</I>&gt;<i> objects never change after they have been created and we only want them
</I>&gt;<i> to be pushed out from cache by cache replacement policy.
</I>

The refresh_pattern ignore-* and override-* are hacks for ISP proxies to
cope with and fix traffic from badly designed web applications. They do
not have control over the origin so at times have no other choice.

A good rule of thumb to follow with reverse-proxy is that any problem
you see with your proxy, so does every other proxy on the planet have
with your sites traffic. It is best to fix things using HTTP mechanisms
properly, not with proxy config workarounds. That way you can benefit
from those other proxies caching as well as your own.


The correct way to do this in HTTP is to have the origin server /
application deliver an Expires: header with a date 1 year in the future
and/or a Cache-Control header with max-age=N with an equivalent value in
seconds. Squid will obey that.

 NP: HTTP allows caching for up to 68 years (2^31 seconds). Squid will
revalidate objects older than 1 year.

If you want objects to be cached, *do not* send Cache-Control:no-store
or Cache-Control:private on them. Nor small values of max-age=N.

If you want to avoid revalidation, *do not* send Cache-Control with
must-revalidate, proxy-revalidate, no-cache, or private. Also avoid
www-auth.


A reverse-proxy has some more options than other proxies:

* As a reverse-proxy you are allowed to use the 'ignore-cc' option on
http_port directives. This will cause the reverse-proxy to ignore any
client Cache-Control demands for revalidation.

* reverse-proxy contain the Surrogate feature. This can be used to give
the CDN proxy completely different max-age values than are sent in
Cache-Control for general caching.
 &lt;<A HREF="http://www.squid-cache.org/Doc/config/http_accel_surrogate_remote/">http://www.squid-cache.org/Doc/config/http_accel_surrogate_remote/</A>&gt;
 &lt;<A HREF="http://www.squid-cache.org/Doc/config/httpd_accel_surrogate_id/">http://www.squid-cache.org/Doc/config/httpd_accel_surrogate_id/</A>&gt;


&gt;<i> 
</I>&gt;<i> I read from old post
</I>&gt;<i> <A HREF="http://www.squid-cache.org/mail-archive/squid-dev/201108/0029.html">http://www.squid-cache.org/mail-archive/squid-dev/201108/0029.html</A> that
</I>&gt;<i> if client requests object without etag and server sends with etag, then
</I>&gt;<i> Squid fetches object again. How to disable this?
</I>
What I was trying to convey in that post was that empty / non-existent
is one of the valid ETag values. ETag is a unique identifier within the
URI scope. If the client explicitly asks for a variant of the object in
a conditional If-Match request, then using another value of ETag to
respond is not valid/legal.

Think of ETag like a MD5/SHA hash of the object. You cant just decide
that the value is different - you have to actually change the object to
make it different. Then you have two versions of it with different tags
and the client might ask specifically about either one.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010235.html">[squid-users] Never expire any object Squid configuration
</A></li>
	<LI>Next message (by thread): <A HREF="010333.html">[squid-users] Never expire any object Squid configuration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10236">[ date ]</a>
              <a href="thread.html#10236">[ thread ]</a>
              <a href="subject.html#10236">[ subject ]</a>
              <a href="author.html#10236">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
