<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Routing Internally And/Or Externally?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Routing%20Internally%20And/Or%20Externally%3F&In-Reply-To=%3C1461160783542-4677168.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010231.html">
   <LINK REL="Next"  HREF="010233.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Routing Internally And/Or Externally?</H1>
    <B>nkingsquid</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Routing%20Internally%20And/Or%20Externally%3F&In-Reply-To=%3C1461160783542-4677168.post%40n4.nabble.com%3E"
       TITLE="[squid-users] Routing Internally And/Or Externally?">nking4930 at hotmail.com
       </A><BR>
    <I>Wed Apr 20 13:59:43 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010231.html">[squid-users] Routing Internally And/Or Externally?
</A></li>
        <LI>Next message (by thread): <A HREF="010233.html">[squid-users] Routing Internally And/Or Externally?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10243">[ date ]</a>
              <a href="thread.html#10243">[ thread ]</a>
              <a href="subject.html#10243">[ subject ]</a>
              <a href="author.html#10243">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Eliezer, this was very Helpful!  I have changed several things that you
mentioned that were incorrect and I will post my code below (changing names
and IPs to protect the confused :P ).  

At a high level this is my situation:  Our users have devices that are
supplied by us.  On these devices we have sandboxed apps that we ONLY allow
to come to our domain.  They also have their regular browser &amp; Apps that can
access the web.  

While they are within the sandboxed apps however we want that app (for
various reasons) to both go to internal sites and external sites.

So when traffic hits the Squid (This is *AFTER* it gets authenticated thru
various security layers, and lastly thru a NetScaler) it either matches the
list of internal resources and is allowed to continue OR it does not and is
re-directed to a second proxy that will then send it to the internet.  ( I
was mistaken before about it going back to the original netscaler it came
from).

For example:
I browse to *me.examp.com*
     Squid recognizes that is an internal resource and lets me go to the
internal resource

I browse to *google.com*
     Squid recognizes that is NOT an internal resource and sends the traffic
to a second proxy to go to google.com

I browse to *facebook.com*
     Squid recognizes that is NOT an internal resource and sends the traffic
to a second proxy to go to facebook.com

I browse to *anywhere on the internet*
     Squid recognizes that is NOT an internal resource and sends the traffic
to a second proxy to go to anywhere else on the internet

Last ?...  if I have: acl Internal_Domain dstdomain [-n] .examp.com  do I
NEED to list me.examp.com or them.examp.com ?




CODE:

acl Local_Network dst 11.0.0.0/8
acl Local_Network dst 132.0.0.0/8
acl Internal_Domain dstdomain [-n] .examp.com
acl Internal_Domain dstdomain me.examp.com
acl Internal_Domain dstdomain them.examp.com
acl Internal_Domain dstdomain here.examp.com
acl Internal_Domain dstdomain hereagain.examp.com
acl Internal_Domain dstdomain sigh.examp.com
acl Internal_Domain dstdomain me.examp2.com
acl Internal_Domain dstdomain  [-n] .me.examp3.com
acl Local_Network dst 149.200.214.0/24
acl Local_Network dst 152.130.186.0/24
acl Local_Network dst 192.168.0.0/16
acl Local_Network src 121.0.0.1

acl dummy_match dstdom_regex . #dummy match all domain regex

acl Inbound_Net_Scaler src 10.24.62.51
acl Outbound_Proxy src 10.213.51.18

acl SSL_ports port 443
acl Safe_ports port 80		
acl Safe_ports port 443		
acl CONNECT method CONNECT


# Deny requests to certain unsafe ports
http_access deny !Safe_ports

# Deny CONNECT to other than secure SSL ports
http_access deny CONNECT !SSL_ports


deny_info 302: <A HREF="http://www.google.com/?%H">http://www.google.com/?%H</A> dummy_match              
#Customized deny_info that will redirect to google with some addition 

http_access allow Inbound_Net_Scaler Internal_Domain            #rule that
allows netscaler sources traffic to access internal domains 
http_access allow Inbound_Net_Scaler acl Local_Network          #rule that
allows netscaler sources traffic to access internal ip addresses 


####Need code that states if traffic is from &lt;<A HREF="http://www.google.com/?%H">http://www.google.com/?%H</A>&gt;
*Inbound_Net_Scaler * but does not match *Internal_Domain* or
*Local_Network* to re-direct it to *Outbound_Proxy* ####                  

http_access deny all


END CODE










--
View this message in context: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Routing-Internally-And-Or-Externally-tp4677152p4677168.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Routing-Internally-And-Or-Externally-tp4677152p4677168.html</A>
Sent from the Squid - Users mailing list archive at Nabble.com.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010231.html">[squid-users] Routing Internally And/Or Externally?
</A></li>
	<LI>Next message (by thread): <A HREF="010233.html">[squid-users] Routing Internally And/Or Externally?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10243">[ date ]</a>
              <a href="thread.html#10243">[ thread ]</a>
              <a href="subject.html#10243">[ subject ]</a>
              <a href="author.html#10243">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
