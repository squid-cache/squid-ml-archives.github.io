<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Cert authority invalid failures.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Cert%20authority%20invalid%20failures.&In-Reply-To=%3C2B77BF184EAC2F43BB9FC908954D8B12670530CA%40Ex5.lnpnews.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010274.html">
   <LINK REL="Next"  HREF="010263.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Cert authority invalid failures.</H1>
    <B>Markey, Bruce</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Cert%20authority%20invalid%20failures.&In-Reply-To=%3C2B77BF184EAC2F43BB9FC908954D8B12670530CA%40Ex5.lnpnews.com%3E"
       TITLE="[squid-users] Cert authority invalid failures.">bmarkey at steinmancommunications.com
       </A><BR>
    <I>Wed Apr 20 20:18:27 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010274.html">[squid-users] Squid 3.5.9 Problems with Teamviewer
</A></li>
        <LI>Next message (by thread): <A HREF="010263.html">[squid-users] Cert authority invalid failures.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10252">[ date ]</a>
              <a href="thread.html#10252">[ thread ]</a>
              <a href="subject.html#10252">[ subject ]</a>
              <a href="author.html#10252">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm curious as to why this is happening.

Proxy was implemented last week and since then I've been dealing with all the sites that don't work. Not a problem, knew it was going to happen. I'd like to understand why the following is happening.


1.       User goes to <A HREF="https://www.whatever.com">https://www.whatever.com</A>

2.       Browser, mostly chrome, gives the following error.   Connection not private. NET:ERR_CERT_AUTHORITY_INVALID

3.       If you view the cert it shows the dynamic cert listed.

4.       Click the &quot;Proceed to www.whatever.com&lt;<A HREF="http://www.whatever.com">http://www.whatever.com</A>&gt; (unsafe )

5.       Now I get a squid error.  Requested url could not be retrieved.  Access denied while trying to retrieve <A HREF="https://">https://</A> some ip address/*

Thing is I don't have an acl blocking that ip?   ( Small sub question here, is there a way to tell which acl blocks something? )

What I've had to do to get around this is add www.whatever.com&lt;<A HREF="http://www.whatever.com">http://www.whatever.com</A>&gt; to my broken_sites.acl.    Then add the ip to an allowed_ips.acl.

Then I http_access allow the ips list

And skip peeking at the broken site.

acl broken_sites ssl::server_name_regex &quot;/etc/squid3/acls/http_broken.txt&quot;
ssl_bump peek !broken_sites
ssl_bump splice all

I'm trying to understand why this is breaking and if I'm doing the right thing in fixing it.


The second error I'm getting is:


The following error was encountered while trying to retrieve the URL: <A HREF="https://*.agentimediaservices.com/*&lt;https://%2A.agentimediaservices.com/*">https://*.agentimediaservices.com/*&lt;https://%2A.agentimediaservices.com/*</A>&gt;

Failed to establish a secure connection to 63.240.52.151

The system returned:

(71) Protocol error (TLS code: X509_V_ERR_UNABLE_TO_GET_ISSUER_CERT_LOCALLY)

SSL Certficate error: certificate issuer (CA) not known: /C=GB/ST=Greater Manchester/L=Salford/O=COMODO CA Limited/CN=COMODO RSA Organization Validation Secure Server CA
Same question.  From what I've read this means that I don't have the correct root ca?  Is that correct?  If so is the fix to then go try to find the correct .crt and add it to the standard ca-cert store? ( I'm on debian so /usr/share/ca-certificates/Mozilla )

Again, is this correct as to what is going wrong and the correct fix?

Thank you


Bruce Markey | Network Security Analyst
STEINMAN COMMUNICATIONS
717.291.8758 (o) | <A HREF="https://lists.squid-cache.org/listinfo/squid-users">bmarkey at steinmancommunications.com</A>
8 West King St | PO Box 1328, Lancaster, PA 17608-1328

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160420/5a8c744b/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160420/5a8c744b/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010274.html">[squid-users] Squid 3.5.9 Problems with Teamviewer
</A></li>
	<LI>Next message (by thread): <A HREF="010263.html">[squid-users] Cert authority invalid failures.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10252">[ date ]</a>
              <a href="thread.html#10252">[ thread ]</a>
              <a href="subject.html#10252">[ subject ]</a>
              <a href="author.html#10252">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
