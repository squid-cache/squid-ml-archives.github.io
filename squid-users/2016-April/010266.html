<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3.5.9 Problems with Teamviewer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.9%20Problems%20with%20Teamviewer&In-Reply-To=%3C5718D4F0.7020601%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010251.html">
   <LINK REL="Next"  HREF="010274.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3.5.9 Problems with Teamviewer</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.9%20Problems%20with%20Teamviewer&In-Reply-To=%3C5718D4F0.7020601%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid 3.5.9 Problems with Teamviewer">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Apr 21 13:26:08 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010251.html">[squid-users] Squid 3.5.9 Problems with Teamviewer
</A></li>
        <LI>Next message (by thread): <A HREF="010274.html">[squid-users] Squid 3.5.9 Problems with Teamviewer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10266">[ date ]</a>
              <a href="thread.html#10266">[ thread ]</a>
              <a href="subject.html#10266">[ subject ]</a>
              <a href="author.html#10266">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 21/04/2016 3:39 a.m., epytir wrote:
&gt;<i> Hey Squid Users,
</I>&gt;<i> 
</I>&gt;<i> Sorry for my bad english im learning it currently.
</I>&gt;<i> 
</I>&gt;<i> I got a little problem with my squid proxy.
</I>&gt;<i> I installed it with ufdbguard and squidclamav and everything works fine.
</I>&gt;<i> 
</I>&gt;<i> The users login with kerberos ntlm or normal username passowrt
</I>&gt;<i> authentication.
</I>&gt;<i> 
</I>&gt;<i> My Problem is when Users start Teamviewer (every Version) some time
</I>&gt;<i> teamviewer doing nothing then the message &quot;no connection please check proxy
</I>&gt;<i> settings&quot; appears. Then i klick nothing after 10 more seconds the teamviewer
</I>&gt;<i> is connected without changing anything.
</I>&gt;<i> So Teamviewer needs up to 1 minute to connect through the proxy without i
</I>&gt;<i> need like 5 seconds.
</I>&gt;<i> 
</I>&gt;<i> Teamviewer is not blocked for the users with the problems and it connects
</I>&gt;<i> but needs to much time. I have 1500 User so the normal user dont understand
</I>&gt;<i> that he must wait and dont klick on change settings or abort.
</I>&gt;<i> 
</I>&gt;<i> I log squid in database and every connect i see is not blocked:
</I>&gt;<i> | 23731740 |   1461164861.040 | 2016-04-20 | 17:07:41  | 48 | ip  | TCP_MISS 
</I>&gt;<i> | 200 | 15623 | GET | www.teamviewer.com     | Username| FIRSTUP_PARENT    |
</I>&gt;<i> NULL | NULL   |
</I>&gt;<i> | 23733412 |   1461165077.533 | 2016-04-20 | 17:11:18  |  11 | ip  |
</I>&gt;<i> TCP_MEM_HIT | 200  |   15631 | GET   | www.teamviewer.com  | Username|
</I>&gt;<i> HIER_NONE         | NULL           | NULL      |
</I>&gt;<i> 
</I>
You missed out the bit where the column titles were described so we know
what that above means.


&gt;<i> The parent Proxy is not the problem cause our old proxy is tmg from
</I>&gt;<i> microsoft and use the same proxy without teamviewer problems. (we want to
</I>&gt;<i> shutdown tmg cause its extremly slow and squid is so fast :) ) 
</I>&gt;<i> 
</I>
Maybe it, is maybe it isn't. Not a safe assumption.

It is likely tmg and Squid are talking to it slightly differently which
might make it do different things and hit some bug you never saw before.
The older that parent proxy software is the more likely this is to happen.


&gt;<i> 
</I>&gt;<i> Here are some information:
</I>&gt;<i> Squid 3.5.9
</I>&gt;<i> UFDB 1.31-16
</I>&gt;<i> Server Ubuntu 14.04 LTS
</I>&gt;<i> 
</I>
The old Squid version could also be a problem. We have found and fixed
quite a lot of bugs in the last 2 years.

A useful rule of thumb when dealing with squid issues is to first try an
upgrade and see if the issue is resolved already.

If you can wait a few days I suggest trying for an upgrade to Ubuntu
Xenial 16.04 LTS, which should appear any day now and has a much better
Squid in it.


&gt;<i> Squid config snip:
</I>&gt;<i> auth_param negotiate program /usr/lib/squid3/negotiate_wrapper_auth  --ntlm 
</I>&gt;<i> /usr/lib/squid3/fakeauth_auth  --kerberos 
</I>&gt;<i> /usr/lib/squid3/negotiate_kerberos_auth -r -s GSS_C_NO_NA$
</I>
The above line got truncated.

&gt;<i> auth_param negotiate children 80
</I>&gt;<i> auth_param negotiate keep_alive on
</I>
I recommend using &quot;off&quot; here. It seems to be needed by recent Firefox
and some other tools as well.

&gt;<i> 
</I>&gt;<i> auth_param ntlm program /usr/lib/squid3/fakeauth_auth x.x.x\DC
</I>
This &quot;x.x.x\DC&quot; thing is suspicious. If it is actually needed, then I
suspect it should be on the Negotiate/NTLM helper as well as the NTLM one.


&gt;<i> auth_param ntlm children 30
</I>&gt;<i> auth_param ntlm keep_alive off
</I>&gt;<i> 
</I>&gt;<i> #LDAP Authentication
</I>&gt;<i> auth_param basic program  /usr/lib/squid3/basic_ldap_auth -b
</I>&gt;<i> &quot;dc=X,dc=X,dc=X&quot; -D &quot;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">XXX at X.X.X</A>&quot; -w &quot;XXXXXXXXX&quot; -v 3 -h <A HREF="ldaps://X.X.X">ldaps://X.X.X</A>
</I>&gt;<i> auth_param basic children 30
</I>&gt;<i> auth_param basic realm Domain-Internet-Proxy
</I>&gt;<i> auth_param basic credentialsttl 30 day  #How often ask for Login credentials
</I>&gt;<i> auth_param basic casesensitive off
</I>&gt;<i> 
</I>&gt;<i> acl ldap-auth proxy_auth REQUIRED # Rule authentication needed
</I>&gt;<i> never_direct allow all
</I>&gt;<i> # Deny requests to certain unsafe ports
</I>&gt;<i> http_access deny !Safe_ports
</I>&gt;<i> 
</I>&gt;<i> # Deny CONNECT to other than secure SSL ports
</I>&gt;<i> #http_access allow CONNECT SSL_ports
</I>
The security rule provided is &quot;deny CONNECT !SSL_Ports&quot;.

That is *not* the same as &quot;allow CONNECT SSL_Ports&quot;.

It uses &quot;deny&quot; explicitly to prevent other rules later in the config
doing unexpected bad things...


&gt;<i> http_access allow localnet
</I>&gt;<i> http_access allow localhost
</I>&gt;<i> 
</I>&gt;<i> #LDAP User are allowed to connect to the Internet
</I>&gt;<i> http_access allow ldap-auth
</I>&gt;<i> http_access allow CONNECT  SSL_ports ldap-auth
</I>&gt;<i> 
</I>
... like this rule doing nothing.

Why?
  Because ldap-auth, localnet, localhost ACLs already let users do
anything they want. Anything. Oops.


&gt;<i> 
</I>&gt;<i> # And finally deny all other access to this proxy
</I>&gt;<i> http_access deny all
</I>&gt;<i> .
</I>&gt;<i> .
</I>&gt;<i> .
</I>&gt;<i> 
</I>&gt;<i> Normal ntlm dont work but we have some old programms that need ntlm so i use
</I>&gt;<i> fake tnlm for them browsers only use kerberos.
</I>&gt;<i> 
</I>&gt;<i> In squid log i see nothing no entrys for the connection time.
</I>
Squid logs transactions when they complete. If the teamviewer is still
using it for some minutes/hours/days you wont see it until its over.

&quot;Days&quot; is not a joke, some can last that long. GoogleTalk, Facebook
Chat, Skype etc are known for it already. It woud not surprise me to
find TeamViewer is similar.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010251.html">[squid-users] Squid 3.5.9 Problems with Teamviewer
</A></li>
	<LI>Next message (by thread): <A HREF="010274.html">[squid-users] Squid 3.5.9 Problems with Teamviewer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10266">[ date ]</a>
              <a href="thread.html#10266">[ thread ]</a>
              <a href="subject.html#10266">[ subject ]</a>
              <a href="author.html#10266">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
