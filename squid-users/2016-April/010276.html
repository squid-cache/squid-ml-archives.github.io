<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] High CPU Usage with ssl_bump
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20High%20CPU%20Usage%20with%20ssl_bump&In-Reply-To=%3C5719169B.4010700%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010272.html">
   <LINK REL="Next"  HREF="010278.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] High CPU Usage with ssl_bump</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20High%20CPU%20Usage%20with%20ssl_bump&In-Reply-To=%3C5719169B.4010700%40measurement-factory.com%3E"
       TITLE="[squid-users] High CPU Usage with ssl_bump">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Apr 21 18:06:19 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010272.html">[squid-users] High CPU Usage with ssl_bump
</A></li>
        <LI>Next message (by thread): <A HREF="010278.html">[squid-users] High CPU Usage with ssl_bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10276">[ date ]</a>
              <a href="thread.html#10276">[ thread ]</a>
              <a href="subject.html#10276">[ subject ]</a>
              <a href="author.html#10276">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 04/21/2016 08:12 AM, Odhiambo Washington wrote:

&gt;<i> acl no_ssl_interception ssl::server_name ...
</I>&gt;<i> ssl_bump splice no_ssl_interception 
</I>&gt;<i> ssl_bump stare step2
</I>&gt;<i> ssl_bump splice all
</I>
You are mixing splice and stare now. There are two groups of actions:

* peek and then splice
* stare and then bump

Do not mix actions from different groups together unless you know what
you are doing.


&gt;<i> So basically I should just have two options, I think, no?? Like
</I>&gt;<i> 
</I>&gt;<i> ssl_bump stare step2
</I>&gt;<i> ssl_bump splice all
</I>
Two bugs in this config:

1. It will splice everything during step #1. It is equivalent to:

   ssl_bump splice all


2. To quote the wiki page:

stare (step2): Receive server certificate while preserving the
possibility of bumping the connection. Staring at the server certificate
usually precludes future splicing of the connection.

squid.conf.documented has very similar text as well.

You are telling Squid to splice do exactly what the documentation tells
you is not usually possible.


I can understand that it may be difficult to find and interpret
documentation correctly. I can understand that it is difficult to
evaluate a given configuration correctly. What I cannot understand is
why you are not starting with configurations suggested specifically for
your use case, on this email thread.


&gt;<i> If one day, for some reason I want to bump, then I could change to:
</I>&gt;<i> 
</I>&gt;<i> ssl_bump splice no_ssl_interception
</I>&gt;<i> ssl_bump stare step2
</I>&gt;<i> ssl_bump bump all
</I>
Similar to #1 above, this will bump all connections not matching the
[misnamed] no_ssl_interception during step1.

The first matching action wins. During step1, that action is &quot;bump&quot; from
your last rule if no_ssl_interception does not match.


HTH,

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010272.html">[squid-users] High CPU Usage with ssl_bump
</A></li>
	<LI>Next message (by thread): <A HREF="010278.html">[squid-users] High CPU Usage with ssl_bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10276">[ date ]</a>
              <a href="thread.html#10276">[ thread ]</a>
              <a href="subject.html#10276">[ subject ]</a>
              <a href="author.html#10276">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
