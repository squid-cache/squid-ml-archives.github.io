<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] High CPU Usage with ssl_bump
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20High%20CPU%20Usage%20with%20ssl_bump&In-Reply-To=%3C57195F62.3010209%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010289.html">
   <LINK REL="Next"  HREF="010294.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] High CPU Usage with ssl_bump</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20High%20CPU%20Usage%20with%20ssl_bump&In-Reply-To=%3C57195F62.3010209%40measurement-factory.com%3E"
       TITLE="[squid-users] High CPU Usage with ssl_bump">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Apr 21 23:16:50 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010289.html">[squid-users] High CPU Usage with ssl_bump
</A></li>
        <LI>Next message (by thread): <A HREF="010294.html">[squid-users] High CPU Usage with ssl_bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10293">[ date ]</a>
              <a href="thread.html#10293">[ thread ]</a>
              <a href="subject.html#10293">[ subject ]</a>
              <a href="author.html#10293">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 04/21/2016 03:26 PM, Odhiambo Washington wrote:
&gt;<i> On 21 April 2016 at 23:14, Alex Rousskov wrote:
</I>&gt;<i>     Logging aside, your latest random configuration is equivalent to
</I>&gt;<i>     [...] not intercepting SSL at all, which brings
</I>&gt;<i>     us back to the old question: What do you want Squid to do?
</I>

&gt;<i> If I could intercept SSL and do nothing EXCEPT subject the domains to
</I>&gt;<i> time ACLs, that'd be all.
</I>
You are going back to the problem we have already discussed. Please slow
down and translate your description above into what should happen to
user connections that match your &quot;time ACLs&quot;.

* Does &quot;subject the domains to time ACLs&quot; mean &quot;immediately close
connections that match&quot; those ACLs?

* Or does it mean &quot;serve Squid error pages&quot; over connections that match
those ACLs?

Once you decide, apply one of the two templates provided (the two
templates correspond to which of the two questions you answer &quot;yes&quot;).


&gt;<i> I just want the data passing through squid for me to determine who is
</I>&gt;<i> allowed to access it and at what time.
</I>
Assume Squid has made that access determination you want to make, and
the user is not allowed. Now what: Close the connection? Or serve an
error page?


&gt;<i> I do have time ACLs, [...]
</I>
The specifics of your ACLs are irrelevant at this stage. You can fix
them later once you get overall SslBump setup working the way you want.
You can assume that there is just one ACL called &quot;prohibited_traffic&quot; or
&quot;good_traffic&quot;. Now write the rules that determine what happens to
connections that match one of those two ACLs.


&gt;<i>     If you want Squid to not intrude except when terminating prohibited
</I>&gt;<i>     traffic, then start with this sketch:
</I>&gt;<i> 
</I>&gt;<i>       ssl_bump terminate prohibited_traffic
</I>&gt;<i>       ssl_bump peek all
</I>&gt;<i>       ssl_bump splice all
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Lemme see if I understand this. I have a problem wrapping my head around
</I>&gt;<i> 'terminate' (as a terminology, maybe)
</I>
&quot;terminate&quot; means &quot;close the SSL connection(s) immediately&quot;. No error
response is sent by Squid to the user. It does not get much simpler than
that! The browser will probably show some &quot;secure connection could not
be negotiated&quot; error to the user with no usable details [because Squid
sent nothing to the browser in this case].


&gt;<i> and 'prohibited_traffic' (also as a terminology).
</I>
Just some ACL name. You will define that aggregate ACL later to match
any traffic you want to prohibit. It will contain a combination of time
and server name ACLs. Other details are not important until your SslBump
[and http_access rules] are correct.

If you do not know how to aggregate ACLs, look for &quot;any-of&quot; and &quot;all-of&quot;
in squid.conf.documented, but, again, ACL specifics are not important
right now. They will become important at stage three. Now you are
struggling with stage one: Deciding what to do with matching SSL
connections (close or serve error pages).

FWIW, my recommendation is to terminate/close and find other ways to
inform users about their policy violations.

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010289.html">[squid-users] High CPU Usage with ssl_bump
</A></li>
	<LI>Next message (by thread): <A HREF="010294.html">[squid-users] High CPU Usage with ssl_bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10293">[ date ]</a>
              <a href="thread.html#10293">[ thread ]</a>
              <a href="subject.html#10293">[ subject ]</a>
              <a href="author.html#10293">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
