<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] help for my intercept proxy setup
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20help%20for%20my%20intercept%20proxy%20setup&In-Reply-To=%3C20196313-83a0-5298-4ebf-5d9bb6d7d8a2%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010353.html">
   <LINK REL="Next"  HREF="010356.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] help for my intercept proxy setup</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20help%20for%20my%20intercept%20proxy%20setup&In-Reply-To=%3C20196313-83a0-5298-4ebf-5d9bb6d7d8a2%40gmail.com%3E"
       TITLE="[squid-users] help for my intercept proxy setup">yvoinov at gmail.com
       </A><BR>
    <I>Tue Apr 26 22:07:14 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010353.html">[squid-users] help for my intercept proxy setup
</A></li>
        <LI>Next message (by thread): <A HREF="010356.html">[squid-users] help for my intercept proxy setup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10355">[ date ]</a>
              <a href="thread.html#10355">[ thread ]</a>
              <a href="subject.html#10355">[ subject ]</a>
              <a href="author.html#10355">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256
 
Note this:

#  TAG: wccp2_forwarding_method
#    WCCP2 allows the setting of forwarding methods between the
#    router/switch and the cache.  Valid values are as follows:
#
#    gre - GRE encapsulation (forward the packet in a GRE/WCCP tunnel)
#    l2  - L2 redirect (forward the packet using Layer 2/MAC rewriting)
#
#    Currently (as of IOS 12.4) cisco routers only support GRE.
#    Cisco switches only support the L2 redirect assignment method.
#Default:
# wccp2_forwarding_method gre

iOS 15.x has switch functionality. As by as most Sicso's modern routers:

scilla#sho cdp neighbors
Capability Codes: R - Router, T - Trans Bridge, B - Source Route Bridge
                  S - Switch, H - Host, I - IGMP, r - Repeater, P - Phone,
                  D - Remote, C - CVTA, M - Two-port Mac Relay

Device ID        Local Intrfce     Holdtme    Capability  Platform  Port ID
                 Gig 0/1           152             R B S  CISCO2901 Gig 0/1



27.04.16 4:01, Maile Halatuituia &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> wccp2_router 10.240.0.254
</I>&gt;<i> wccp_version 4
</I>&gt;<i> wccp2_forwarding_method gre
</I>&gt;<i> wccp2_return_method gre
</I>&gt;<i> wccp2_rebuild_wait off
</I>&gt;<i> wccp2_assignment_method hash
</I>&gt;<i> wccp2_service standard 0
</I>&gt;<i> wccp2_service dynamic 70
</I>&gt;<i> wccp2_service_info 70 protocol=tcp
</I>flags=dst_ip_hash,src_ip_alt_hash,src_port_alt_hash priority=240
ports=443,80
&gt;<i> always_direct allow all
</I>&gt;<i> thanks
</I>&gt;<i> ________________________________________
</I>&gt;<i> From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; on
</I>behalf of Yuri Voinov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A>&gt;
&gt;<i> Sent: Wednesday, April 27, 2016 10:57 AM
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: Re: [squid-users] help for my intercept proxy setup
</I>&gt;<i>
</I>&gt;<i> Show WCCP section of yout squid.conf please.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 27.04.16 3:05, maileh &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;<i> &gt; Hi
</I>&gt;<i> &gt; Here is my router wccp config
</I>&gt;<i> &gt; In global config i enable ip wccp
</I>&gt;<i> &gt; #ip wccp web-cache redirect-list WCCP_HTTP
</I>&gt;<i> &gt; #ip wccp 70 redirect-list WCCP_HTTPS
</I>&gt;<i> &gt; Interface facing my Clients and also Squid is in the same subnet
</I>&gt;<i>
</I>&gt;<i> &gt; int g0/0.904
</I>&gt;<i> &gt; ip wccp web-cache redirect out
</I>&gt;<i> &gt; ip wccp 70 redirect out.
</I>&gt;<i>
</I>&gt;<i> &gt; Verification
</I>&gt;<i>
</I>&gt;<i> &gt; #sh ip wccp sum
</I>&gt;<i> &gt; WCCP version 2 enabled, 2 services
</I>&gt;<i>
</I>&gt;<i> &gt; Service     Clients   Routers   Assign      Redirect   Bypass
</I>&gt;<i> &gt; -------     -------   -------   ------      --------   ------
</I>&gt;<i> &gt; Default routing table (Router Id: x.x.x.x):
</I>&gt;<i> &gt; web-cache   1         1         HASH        GRE        GRE
</I>&gt;<i> &gt; 70                  1         1         HASH        GRE        GRE
</I>&gt;<i>
</I>&gt;<i> &gt; #sh tunnel groups wccp
</I>&gt;<i> &gt;  WCCP : service group 0 in &quot;Default&quot;, ver v2, assgnmnt: hash-table
</I>&gt;<i> &gt;    intf: Tunnel2, locally sourced
</I>&gt;<i> &gt;  WCCP : service group 326 in &quot;Default&quot;, ver v2, assgnmnt: hash-table
</I>&gt;<i> &gt;    intf: Tunnel0, locally sourced
</I>&gt;<i>
</I>&gt;<i> &gt; #sh adjacency tunnel 0 detail
</I>&gt;<i> &gt; Protocol Interface                 Address
</I>&gt;<i> &gt; IP       Tunnel0                   10.240.0.30(3)
</I>&gt;<i> &gt;                                    connectionid 1
</I>&gt;<i> &gt;                                    0 packets, 0 bytes
</I>&gt;<i> &gt;                                    epoch 0
</I>&gt;<i> &gt;                                    sourced in sev-epoch 31
</I>&gt;<i> &gt;                                    Encap length 28
</I>&gt;<i> &gt;                                    4500000000000000FF2FC732CA861F08
</I>&gt;<i> &gt;                                    0AF0001E0000883E01460000
</I>&gt;<i> &gt;                                    Tun endpt
</I>&gt;<i> &gt;                                    Next chain element:
</I>&gt;<i> &gt;                                     IP adj out of
</I>GigabitEthernet0/0.904,
&gt;<i> &gt; addr 10.240.0.30
</I>&gt;<i> &gt; #sh adjacency tunnel 2 detail
</I>&gt;<i> &gt;     Protocol Interface                 Address
</I>&gt;<i> &gt; IP       Tunnel2                   10.240.0.30(3)
</I>&gt;<i> &gt;                                    connectionid 1
</I>&gt;<i> &gt;                                    0 packets, 0 bytes
</I>&gt;<i> &gt;                                    epoch 0
</I>&gt;<i> &gt;                                    sourced in sev-epoch 32
</I>&gt;<i> &gt;                                    Encap length 28
</I>&gt;<i> &gt;                                    4500000000000000FF2FC732CA861F08
</I>&gt;<i> &gt;                                    0AF0001E0000883E00000000
</I>&gt;<i> &gt;                                    Tun endpt
</I>&gt;<i> &gt;                                    Next chain element:
</I>&gt;<i> &gt;                                     IP adj out of
</I>GigabitEthernet0/0.904,
&gt;<i> &gt; addr 10.240.0.30
</I>&gt;<i> &gt; #sh ip wccp web-cache detail
</I>&gt;<i> &gt; WCCP Client information:
</I>&gt;<i> &gt;         WCCP Client ID:          10.240.0.30
</I>&gt;<i> &gt;         Protocol Version:        2.0
</I>&gt;<i> &gt;         State:                   Usable
</I>&gt;<i> &gt;         Redirection:             GRE
</I>&gt;<i> &gt;         Packet Return:           GRE
</I>&gt;<i> &gt;         Assignment:              HASH
</I>&gt;<i> &gt;         Initial Hash Info:       00000000000000000000000000000000
</I>&gt;<i> &gt;                                  00000000000000000000000000000000
</I>&gt;<i> &gt;         Assigned Hash Info:      FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
</I>&gt;<i> &gt;                                  FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF
</I>&gt;<i> &gt;         Hash Allotment:          256 (100.00%)
</I>&gt;<i> &gt;         Packets s/w Redirected:  0
</I>&gt;<i> &gt;         Connect Time:            00:08:42
</I>&gt;<i> &gt;         GRE Bypassed Packets
</I>&gt;<i> &gt;           Process:               0
</I>&gt;<i> &gt;           CEF:                   0
</I>&gt;<i> &gt;           Errors:                0
</I>&gt;<i> &gt; If you can see all seems to be established between the router and
</I>&gt;<i> squid box
</I>&gt;<i> &gt; but no PACKET has been redirected.
</I>&gt;<i> &gt; For my IOS
</I>&gt;<i> &gt; ROM: System Bootstrap, Version 15.0(1r)M15, RELEASE SOFTWARE (fc1)
</I>&gt;<i>
</I>&gt;<i> &gt; It's been over two weeks now and i seems to looking everywhere but no
</I>&gt;<i> luck.
</I>&gt;<i> &gt; Also here is my iptables rules for you info whch run on ubuntu 14.04
</I>with
&gt;<i> &gt; squid
</I>&gt;<i>
</I>&gt;<i> &gt; # squid -v
</I>&gt;<i> &gt; Squid Cache: Version 3.5.16
</I>&gt;<i> &gt; Service Name: squid
</I>&gt;<i> &gt; Intercept/WCCPv2/LibreSSL/CRTD/(A)UFS/DISKD/ROCK/eCAP/64/GCC Production
</I>&gt;<i> &gt; configure options:  '--prefix=/usr/local' '--enable-translation'
</I>&gt;<i> &gt; '--enable-external-acl-helpers=none'
</I>&gt;<i> '--enable-storeio=ufs,aufs,diskd,rock'
</I>&gt;<i> &gt; '--enable-removal-policies=lru,heap' '--enable-wccp2'
</I>&gt;<i> &gt; '--enable-follow-x-forwarded-for' '--enable-cache-digests'
</I>&gt;<i> &gt; '--enable-auth-negotiate=none' '--disable-auth-digest'
</I>&gt;<i> '--disable-auth-ntlm'
</I>&gt;<i> &gt; '--disable-url-rewrite-helpers' '--enable-storeid-rewrite-helpers=file'
</I>&gt;<i> &gt; '--enable-log-daemon-helpers=file' '--with-openssl=/usr/local'
</I>&gt;<i> &gt; '--enable-ssl' '--enable-ssl-crtd' '--enable-zph-qos' '--enable-snmp'
</I>&gt;<i> &gt; '--enable-inline' '--with-dl'
</I>&gt;<i> '--with-build-environment=POSIX_V6_LP64_OFF64'
</I>&gt;<i> &gt; 'CFLAGS=-O3 -m64 -pipe' 'CXXFLAGS=-O3 -m64 -pipe'
</I>&gt;<i> &gt; 'LIBOPENSSL_CFLAGS=-I/usr/local/include'
</I>&gt;<i> &gt; 'PKG_CONFIG_PATH=/usr/local/lib/pkgconfig'
</I>&gt;<i> '--disable-strict-error-checking'
</I>&gt;<i>
</I>&gt;<i>
</I>'--enable-build-info=Intercept/WCCPv2/LibreSSL/CRTD/(A)UFS/DISKD/ROCK/eCAP/64/GCC
&gt;<i> &gt; Production'
</I>&gt;<i> &gt; IPtables Rules for redirection to squid ports
</I>&gt;<i> &gt; -A PREROUTING -i wccp0 -p tcp -m tcp --dport 80 -j REDIRECT --to-ports
</I>&gt;<i> 3127
</I>&gt;<i> &gt; -A PREROUTING -i wccp0 -p tcp -m tcp --dport 443 -j REDIRECT
</I>&gt;<i> --to-ports 3129
</I>&gt;<i> &gt; -A POSTROUTING -j MASQUERADE
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Appreciate you kind asistance ....
</I>&gt;<i> &gt; hanks in advance
</I>&gt;<i> &gt; Maile
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; --
</I>&gt;<i> &gt; View this message in context:
</I>&gt;<i>
</I><A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/help-for-my-intercept-proxy-setup-tp4677279.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/help-for-my-intercept-proxy-setup-tp4677279.html</A>
&gt;<i> &gt; Sent from the Squid - Users mailing list archive at Nabble.com.
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; squid-users mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Confidentiality Notice: This email (including any attachment) is
</I>intended for internal use only. Any unauthorized use, dissemination or
copying of the content is prohibited. If you are not the intended
recipient and have received this e-mail in error, please notify the
sender by email and delete this email and any attachment.
&gt;<i> Confidentiality Notice: This email (including any attachment) is
</I>intended for internal use only. Any unauthorized use, dissemination or
copying of the content is prohibited. If you are not the intended
recipient and have received this e-mail in error, please notify the
sender by email and delete this email and any attachment.

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBCAAGBQJXH+aSAAoJENNXIZxhPexGKQMH/j/cG/jTnbol7r83SbVMUs7t
FO8S98Hx+Sq79Hbfs8EJUxpNPG0k7y7HnvgJEbGSbU/Rn31neJ1/vzU/a+zmVdEs
5JiLkDXYueBvwvf9kapY24tXcspeEDKi1UkHIDDwyR79yA9il5CCxb1sTNWNKWVp
IkBkkmbsVpD1FO1pPB6hF8U8zZe6E9WI2drCguNvqJSsMY/a9ByrhcEbODDMxQBR
D3UyxzwVgm+QnKIFuyc+Adxf0fTAakqzk1KIreCAfmethBZ7TYtA/8TSHo+gzmri
JWXjrquqd7pxfLHdOzWjfIJm6vXUMsi7RcHPwP2SWbsx15dGyoEkVxz2U1rwArE=
=3K52
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160427/6fafcb38/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160427/6fafcb38/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x613DEC46.asc
Type: application/pgp-keys
Size: 2437 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160427/6fafcb38/attachment.key">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160427/6fafcb38/attachment.key</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010353.html">[squid-users] help for my intercept proxy setup
</A></li>
	<LI>Next message (by thread): <A HREF="010356.html">[squid-users] help for my intercept proxy setup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10355">[ date ]</a>
              <a href="thread.html#10355">[ thread ]</a>
              <a href="subject.html#10355">[ subject ]</a>
              <a href="author.html#10355">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
