<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Using dont_verify_peer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Using%20dont_verify_peer&In-Reply-To=%3C2f0deaa4-cfa5-2abc-c478-a5dd477bbff4%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010371.html">
   <LINK REL="Next"  HREF="010373.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Using dont_verify_peer</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Using%20dont_verify_peer&In-Reply-To=%3C2f0deaa4-cfa5-2abc-c478-a5dd477bbff4%40gmail.com%3E"
       TITLE="[squid-users] Using dont_verify_peer">yvoinov at gmail.com
       </A><BR>
    <I>Thu Apr 28 21:42:08 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010371.html">[squid-users] Using dont_verify_peer
</A></li>
        <LI>Next message (by thread): <A HREF="010373.html">[squid-users] Using dont_verify_peer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10372">[ date ]</a>
              <a href="thread.html#10372">[ thread ]</a>
              <a href="subject.html#10372">[ subject ]</a>
              <a href="author.html#10372">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256
 
With intermediate certificates better to use
sslproxy_foreign_intermediate_certs for many reasons:

1. sslproxy_foreign_intermediate_certs not treated as trusted root CA's.
They only uses for complete certificate chain.

2. Intermediate CA's most often has relatively short expiration, so
better do not mix it with root's.

3. IMHO separate intermediate bundle has less maintenance overhead.

# sslproxy_foreign_intermediate_certs backported from 4.x starting 3.5.13
sslproxy_foreign_intermediate_certs /usr/local/squid/etc/intermediate_ca.pem

I've published here download link to my intermediate_ca.pem I'm using in
my setups. I'm not pretend this bundle is full, but I'm updating it when
meet UNABLE_TO_GET_ISSUER_CERT_LOCALLY.

Note: You need to check intermediate CA's expiration/revocation youself.
So, to do this you need all source intermediates separately. This time
there is no tool to build this bundle automatically, like Mozilla's CA
bundle.

Note 2: Don't - I repeat - DONT USE dont_verify_peer in production
setups. Never. This is dangerous.

29.04.16 2:56, Rafael Akchurin &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i>
</I>&gt;<i> Hello Bruce,
</I>&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> According to
</I><A HREF="https://www.ssllabs.com/ssltest/analyze.html?d=agentimediaservices.com">https://www.ssllabs.com/ssltest/analyze.html?d=agentimediaservices.com</A>
the server does not send the whole chain of certificates and imho squid
cannot automatically download the intermediate certificates like
browsers do.
&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> You need to manually add them to the store. Currently we do it like
</I><A HREF="http://docs.diladele.com/faq/squid/fix_unable_to_get_issuer_cert_locally.html">http://docs.diladele.com/faq/squid/fix_unable_to_get_issuer_cert_locally.html</A>
&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> I hope Yuri knows everything about adding certificates to the store
</I>and will reply shortly :)
&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> If you were using explicit proxy usually making
</I>agentimediaservices.com non bumpable would be enough as squid would
simply pump bytes from browser to site after allowed CONNECT; but as you
have intercepting squid &#8211; I suspect it needs to establish a new
connection to the remote site and thus openssl code that is used when
establishing connections gets a change to fail the connection to a site
with incomplete certificate chain. IMHO :)
&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> I am also interested how to bypass it in intercepted scenario.
</I>&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> Best regards,
</I>&gt;<i>
</I>&gt;<i> Rafael Akchurin
</I>&gt;<i>
</I>&gt;<i> Diladele B.V.
</I>&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> *From:* squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>]
</I>*On Behalf Of *Markey, Bruce
&gt;<i> *Sent:* Thursday, April 28, 2016 10:33 PM
</I>&gt;<i> *To:* <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> *Subject:* [squid-users] Using dont_verify_peer
</I>&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> I didn&#8217;t really get an answer previously so I did some research and
</I>now I&#8217;m not quite sure what to do.
&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> Problem is I&#8217;m getting a lot of these:
</I>&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> The following error was encountered while trying to retrieve the URL:
</I><A HREF="https://*.agentimediaservices.com/*">https://*.agentimediaservices.com/*</A> &lt;<A HREF="https://%2A.agentimediaservices.com/*">https://%2A.agentimediaservices.com/*</A>&gt;
&gt;<i>
</I>&gt;<i> *Failed to establish a secure connection to 63.240.52.151*
</I>&gt;<i>
</I>&gt;<i> The system returned:
</I>&gt;<i>
</I>&gt;<i> (71) Protocol error (TLS code:
</I>X509_V_ERR_UNABLE_TO_GET_ISSUER_CERT_LOCALLY)
&gt;<i>
</I>&gt;<i> SSL Certficate error: certificate issuer (CA) not known:
</I>/C=GB/ST=Greater Manchester/L=Salford/O=COMODO CA Limited/CN=COMODO RSA
Organization Validation Secure Server CA
&gt;<i>
</I>&gt;<i> This proxy and the remote host failed to negotiate a mutually
</I>acceptable security settings for handling your request. It is possible
that the remote host does not support secure connections, or the proxy
is not satisfied with the host security credentials.
&gt;<i>
</I>&gt;<i> Your cache administrator is webmaster
</I>&lt;mailto:webmaster?subject=CacheErrorInfo%20-%20ERR_SECURE_CONNECT_FAIL&amp;body=CacheHost%3A%20LNP-Proxy%0D%0AErrPage%3A%20ERR_SECURE_CONNECT_FAIL%0D%0AErr%3A%20(71)%20Protocol%20error%0D%0ATimeStamp%3A%20Thu,%2028%20Apr%202016%2016%3A37%3A14%20GMT%0D%0A%0D%0AClientIP%3A%20192.168.203.24%0D%0AServerIP%3A%2063.240.52.151%0D%0A%0D%0AHTTP%20Request%3A%0D%0ACONNECT%20%2F%20HTTP%2F1.1%0AHost%3A%2063.240.52.151%3A443%0D%0A%0D%0A%0D%0A&gt;.
&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> As I had stated some are &#8220;fixable&#8221; by adding the url to my broken acl
</I>and then not peeking at it. That sometimes works, most of the time not
and then I have to add the ip listed to an acl of allowed ips.   This
usually works but not in all cases.
&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> That leaves me sort of stuck. I&#8217;ve been having to actually remove
</I>folks from the proxy so they could work.  I work for a newspaper and
most of the issues lie with the myriad of SEO/Marketing sites/tools
these people use. They&#8217;re horrible.
&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> That leads me to my question of will using that flag make this issue
</I>go away?   Granted Im aware it&#8217;s not the safest I can&#8217;t deny users
access to the sites they need.
&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> I&#8217;m running 3.5.16 compiled from source on debian Jessie.  Fully
</I>updated.  I&#8217;m also confused as to why this is happening.  My ca store is
up to date.   I&#8217;m confused as to why this is happening.  If I can access
all these sites fine without the proxy I&#8217;d have to think it&#8217;s not the
cert itself. So it&#8217;s either debians cert store or something else.  I&#8217;m
sort of at the end of my knowledge here as to what to troubleshoot.
&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> The other option, though it would be last resort would be to just stop
</I>doing anything with https, though all I really wanted was to keep stats
on sites visited.
&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> Here is some openssl info.  This leads me to believe its not a squid
</I>issue persay, its an openssl issue and or debian issue with certs. But
I&#8217;m not 100% on that.
&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">bruce at LNP-Proxy</A>:/etc/squid3$ sudo openssl s_client -connect
</I>www.agentimediaservices.com:443 &lt;<A HREF="http://www.agentimediaservices.com:443">http://www.agentimediaservices.com:443</A>&gt;
-showcerts
&gt;<i>
</I>&gt;<i> CONNECTED(00000003)
</I>&gt;<i>
</I>&gt;<i> depth=0 C = US, postalCode = 10007, ST = NY, L = New York, street =
</I>195 Broadway, O = OMD USA LLC, OU = IT, OU = Hosted by OMD USA INC, OU =
PlatinumSSL Wildcard, CN = *.agentimediaservices.com
&gt;<i>
</I>&gt;<i> verify error:num=20:unable to get local issuer certificate
</I>&gt;<i>
</I>&gt;<i> verify return:1
</I>&gt;<i>
</I>&gt;<i> depth=0 C = US, postalCode = 10007, ST = NY, L = New York, street =
</I>195 Broadway, O = OMD USA LLC, OU = IT, OU = Hosted by OMD USA INC, OU =
PlatinumSSL Wildcard, CN = *.agentimediaservices.com
&gt;<i>
</I>&gt;<i> verify error:num=27:certificate not trusted
</I>&gt;<i>
</I>&gt;<i> verify return:1
</I>&gt;<i>
</I>&gt;<i> depth=0 C = US, postalCode = 10007, ST = NY, L = New York, street =
</I>195 Broadway, O = OMD USA LLC, OU = IT, OU = Hosted by OMD USA INC, OU =
PlatinumSSL Wildcard, CN = *.agentimediaservices.com
&gt;<i>
</I>&gt;<i> verify error:num=21:unable to verify the first certificate
</I>&gt;<i>
</I>&gt;<i> verify return:1
</I>&gt;<i>
</I>&gt;<i> ---
</I>&gt;<i>
</I>&gt;<i> Certificate chain
</I>&gt;<i>
</I>&gt;<i> 0 s:/C=US/postalCode=10007/ST=NY/L=New York/street=195 Broadway/O=OMD
</I>USA LLC/OU=IT/OU=Hosted by OMD USA INC/OU=PlatinumSSL
Wildcard/CN=*.agentimediaservices.com
&gt;<i>
</I>&gt;<i>    i:/C=GB/ST=Greater Manchester/L=Salford/O=COMODO CA
</I>Limited/CN=COMODO RSA Organization Validation Secure Server CA
&gt;<i>
</I>&gt;<i> -----BEGIN CERTIFICATE-----
</I>&gt;<i>
</I>&gt;<i> MIIF+zCCBOOgAwIBAgIRAMmCjqA+AnLRGj9AxsuZpfMwDQYJKoZIhvcNAQELBQAw
</I>&gt;<i>
</I>&gt;<i> gZYxCzAJBgNVBAYTAkdCMRswGQYDVQQIExJHcmVhdGVyIE1hbmNoZXN0ZXIxEDAO
</I>&gt;<i>
</I>&gt;<i> BgNVBAcTB1NhbGZvcmQxGjAYBgNVBAoTEUNPTU9ETyBDQSBMaW1pdGVkMTwwOgYD
</I>&gt;<i>
</I>&gt;<i> VQQDEzNDT01PRE8gUlNBIE9yZ2FuaXphdGlvbiBWYWxpZGF0aW9uIFNlY3VyZSBT
</I>&gt;<i>
</I>&gt;<i> ZXJ2ZXIgQ0EwHhcNMTUwMTE2MDAwMDAwWhcNMTgwMTE1MjM1OTU5WjCB2jELMAkG
</I>&gt;<i>
</I>&gt;<i> A1UEBhMCVVMxDjAMBgNVBBETBTEwMDA3MQswCQYDVQQIEwJOWTERMA8GA1UEBxMI
</I>&gt;<i>
</I>&gt;<i> TmV3IFlvcmsxFTATBgNVBAkTDDE5NSBCcm9hZHdheTEUMBIGA1UEChMLT01EIFVT
</I>&gt;<i>
</I>&gt;<i> QSBMTEMxCzAJBgNVBAsTAklUMR4wHAYDVQQLExVIb3N0ZWQgYnkgT01EIFVTQSBJ
</I>&gt;<i>
</I>&gt;<i> TkMxHTAbBgNVBAsTFFBsYXRpbnVtU1NMIFdpbGRjYXJkMSIwIAYDVQQDFBkqLmFn
</I>&gt;<i>
</I>&gt;<i> ZW50aW1lZGlhc2VydmljZXMuY29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIB
</I>&gt;<i>
</I>&gt;<i> CgKCAQEA26hgIL5HPDSLX6fySB8fUzbWFHFwEFzPIqt47wdqyNR2moDHrtEJ+ybZ
</I>&gt;<i>
</I>&gt;<i> v+byrRm4b34Zjfvt7n6caV6pcogiazE1ByIEWdEPN7M6jTU4ZiwMfaIfs0T4uNlc
</I>&gt;<i>
</I>&gt;<i> 9I8PKws8u093JRP5DV1AEm2t8JI69msPaK14x4pE6sDRqRuNaXVtLiMBR5B/jurK
</I>&gt;<i>
</I>&gt;<i> xOpv365wb3ckoebFNbOo/AHC8abi3PCaVTVFMu1b1QFI9SVrmHVYAsqVwPiyi2YJ
</I>&gt;<i>
</I>&gt;<i> zkdaHyu51uOmk6kXuVyZT2sfrNyTt9e7UuwqmgqvolncoMyV5MEzR5LZvephPIpM
</I>&gt;<i>
</I>&gt;<i> bV9HNPcDY0KXOKfeDWPpfeFJxosVzQIDAQABo4IB/DCCAfgwHwYDVR0jBBgwFoAU
</I>&gt;<i>
</I>&gt;<i> mvMr2s+tT7YvuypISCoStxtCwSQwHQYDVR0OBBYEFIu+BPXh1FoDihdd/D/iMDMv
</I>&gt;<i>
</I>&gt;<i> bNRhMA4GA1UdDwEB/wQEAwIFoDAMBgNVHRMBAf8EAjAAMB0GA1UdJQQWMBQGCCsG
</I>&gt;<i>
</I>&gt;<i> AQUFBwMBBggrBgEFBQcDAjBQBgNVHSAESTBHMDsGDCsGAQQBsjEBAgEDBDArMCkG
</I>&gt;<i>
</I>&gt;<i> CCsGAQUFBwIBFh1odHRwczovL3NlY3VyZS5jb21vZG8uY29tL0NQUzAIBgZngQwB
</I>&gt;<i>
</I>&gt;<i> AgIwWgYDVR0fBFMwUTBPoE2gS4ZJaHR0cDovL2NybC5jb21vZG9jYS5jb20vQ09N
</I>&gt;<i>
</I>&gt;<i> T0RPUlNBT3JnYW5pemF0aW9uVmFsaWRhdGlvblNlY3VyZVNlcnZlckNBLmNybDCB
</I>&gt;<i>
</I>&gt;<i> iwYIKwYBBQUHAQEEfzB9MFUGCCsGAQUFBzAChklodHRwOi8vY3J0LmNvbW9kb2Nh
</I>&gt;<i>
</I>&gt;<i> LmNvbS9DT01PRE9SU0FPcmdhbml6YXRpb25WYWxpZGF0aW9uU2VjdXJlU2VydmVy
</I>&gt;<i>
</I>&gt;<i> Q0EuY3J0MCQGCCsGAQUFBzABhhhodHRwOi8vb2NzcC5jb21vZG9jYS5jb20wPQYD
</I>&gt;<i>
</I>&gt;<i> VR0RBDYwNIIZKi5hZ2VudGltZWRpYXNlcnZpY2VzLmNvbYIXYWdlbnRpbWVkaWFz
</I>&gt;<i>
</I>&gt;<i> ZXJ2aWNlcy5jb20wDQYJKoZIhvcNAQELBQADggEBACDzmWMa2LpUbcDEh1Quz+ak
</I>&gt;<i>
</I>&gt;<i> 4irQoi97D3iD7HHtZRuLSzR5AT11le56GJR9e/0IlFFlxiA+dwn60OmAAi6EX0zb
</I>&gt;<i>
</I>&gt;<i> 7qAJ5Lemm8PtLcdqAydreaK9uYxhF3J1O4/bJHmCJ6P/n6U5MDTNRHYKx4Vo0Dfy
</I>&gt;<i>
</I>&gt;<i> CepRebqV79BCzRDEBTTL2MOnoFJB5NZciYRcypm4JuKHCDO0XCjkONHIlLLDquKV
</I>&gt;<i>
</I>&gt;<i> cNDI7Q00Ctlw8MriPpT8MPY1pdfIYkEVNp2AXOPQ/gXMHJ7EwFPGk3pnct3a9Nk1
</I>&gt;<i>
</I>&gt;<i> XsLTUSSRN5ggOIVk+qDU+PhgKA5U1V6TJEfEt7WA47DY5DtJqVpV/qMoNaGlU8Y=
</I>&gt;<i>
</I>&gt;<i> -----END CERTIFICATE-----
</I>&gt;<i>
</I>&gt;<i> ---
</I>&gt;<i>
</I>&gt;<i> Server certificate
</I>&gt;<i>
</I>&gt;<i> subject=/C=US/postalCode=10007/ST=NY/L=New York/street=195
</I>Broadway/O=OMD USA LLC/OU=IT/OU=Hosted by OMD USA INC/OU=PlatinumSSL
Wildcard/CN=*.agentimediaservices.com
&gt;<i>
</I>&gt;<i> issuer=/C=GB/ST=Greater Manchester/L=Salford/O=COMODO CA
</I>Limited/CN=COMODO RSA Organization Validation Secure Server CA
&gt;<i>
</I>&gt;<i> ---
</I>&gt;<i>
</I>&gt;<i> No client certificate CA names sent
</I>&gt;<i>
</I>&gt;<i> ---
</I>&gt;<i>
</I>&gt;<i> SSL handshake has read 1678 bytes and written 599 bytes
</I>&gt;<i>
</I>&gt;<i> ---
</I>&gt;<i>
</I>&gt;<i> New, TLSv1/SSLv3, Cipher is RC4-MD5
</I>&gt;<i>
</I>&gt;<i> Server public key is 2048 bit
</I>&gt;<i>
</I>&gt;<i> Secure Renegotiation IS supported
</I>&gt;<i>
</I>&gt;<i> Compression: NONE
</I>&gt;<i>
</I>&gt;<i> Expansion: NONE
</I>&gt;<i>
</I>&gt;<i> SSL-Session:
</I>&gt;<i>
</I>&gt;<i>     Protocol  : TLSv1.2
</I>&gt;<i>
</I>&gt;<i>     Cipher    : RC4-MD5
</I>&gt;<i>
</I>&gt;<i>     Session-ID:
</I>4F9EE34EFA2F6305BBD46D6F367BFDC9F95580A7889D9E1FE91F0F79BA86701F
&gt;<i>
</I>&gt;<i>     Session-ID-ctx:
</I>&gt;<i>
</I>&gt;<i>     Master-Key:
</I>F741F597EFC3C837CE52546CC455FFFEBC0F18CCBC74CFB4BE7F1AE3C85EEB9065C39AE50CC525A33C5BD6CCF3D2483A
&gt;<i>
</I>&gt;<i>     Key-Arg   : None
</I>&gt;<i>
</I>&gt;<i>     PSK identity: None
</I>&gt;<i>
</I>&gt;<i>    PSK identity hint: None
</I>&gt;<i>
</I>&gt;<i>     SRP username: None
</I>&gt;<i>
</I>&gt;<i>     Start Time: 1461875411
</I>&gt;<i>
</I>&gt;<i>     Timeout   : 300 (sec)
</I>&gt;<i>
</I>&gt;<i>     Verify return code: 21 (unable to verify the first certificate)
</I>&gt;<i>
</I>&gt;<i> ---
</I>&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> Squid.conf:
</I>&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> #Access Lists
</I>&gt;<i>
</I>&gt;<i> acl internal src 192.168.200.0/21
</I>&gt;<i>
</I>&gt;<i> acl wireless src 192.168.100.0/23
</I>&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> #Ports allowed through Squid
</I>&gt;<i>
</I>&gt;<i> acl Safe_ports port 80
</I>&gt;<i>
</I>&gt;<i> acl Safe_ports port 443
</I>&gt;<i>
</I>&gt;<i> acl SSL_ports port 443
</I>&gt;<i>
</I>&gt;<i> acl CONNECT method CONNECT
</I>&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> #acls from blacklist
</I>&gt;<i>
</I>&gt;<i> acl allowed dstdomain -i &quot;/etc/squid3/acls/http_allowed.acl&quot;
</I>&gt;<i>
</I>&gt;<i> acl prime dstdomain -i &quot;/etc/squid3/acls/squid-prime.acl&quot;
</I>&gt;<i>
</I>&gt;<i> acl china dst -n &quot;/etc/squid3/acls/ccd-china.acl&quot;
</I>&gt;<i>
</I>&gt;<i> acl india dst -n &quot;/etc/squid3/acls/ccd-india.acl&quot;
</I>&gt;<i>
</I>&gt;<i> acl iran dst -n &quot;/etc/squid3/acls/ccd-iran.acl&quot;
</I>&gt;<i>
</I>&gt;<i> acl nigeria dst -n &quot;/etc/squid3/acls/ccd-nigeria.acl&quot;
</I>&gt;<i>
</I>&gt;<i> acl pakistan dst -n &quot;/etc/squid3/acls/ccd-nigeria.acl&quot;
</I>&gt;<i>
</I>&gt;<i> acl romania dst -n &quot;/etc/squid3/acls/ccd-romania.acl&quot;
</I>&gt;<i>
</I>&gt;<i> acl russia dst -n &quot;/etc/squid3/acls/ccd-russia.acl&quot;
</I>&gt;<i>
</I>&gt;<i> acl syria dst -n &quot;/etc/squid3/acls/ccd-syria.acl&quot;
</I>&gt;<i>
</I>&gt;<i> acl ukraine dst -n &quot;/etc/squid3/acls/ccd-ukraine.acl&quot;
</I>&gt;<i>
</I>&gt;<i> acl uzbekistan dst -n &quot;/etc/squid3/acls/ccd-uzbekistan.acl&quot;
</I>&gt;<i>
</I>&gt;<i> acl ips dst -n &quot;/etc/squid3/acls/broken_ips.acl&quot;
</I>&gt;<i>
</I>&gt;<i> acl blocked dstdomain -i &quot;/etc/squid3/acls/http_blocked.acl&quot;
</I>&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> #allow/deny
</I>&gt;<i>
</I>&gt;<i> http_access allow allowed
</I>&gt;<i>
</I>&gt;<i> http_access allow ips
</I>&gt;<i>
</I>&gt;<i> http_access deny blocked
</I>&gt;<i>
</I>&gt;<i> http_access deny prime
</I>&gt;<i>
</I>&gt;<i> http_access deny china
</I>&gt;<i>
</I>&gt;<i> http_access deny india
</I>&gt;<i>
</I>&gt;<i> http_access deny iran
</I>&gt;<i>
</I>&gt;<i> http_access deny nigeria
</I>&gt;<i>
</I>&gt;<i> http_access deny pakistan
</I>&gt;<i>
</I>&gt;<i> http_access deny romania
</I>&gt;<i>
</I>&gt;<i> http_access deny russia
</I>&gt;<i>
</I>&gt;<i> http_access deny syria
</I>&gt;<i>
</I>&gt;<i> http_access deny ukraine
</I>&gt;<i>
</I>&gt;<i> http_access deny uzbekistan
</I>&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> http_access allow internal
</I>&gt;<i>
</I>&gt;<i> http_access allow wireless
</I>&gt;<i>
</I>&gt;<i> http_access deny !Safe_ports
</I>&gt;<i>
</I>&gt;<i> http_access deny CONNECT !SSL_ports
</I>&gt;<i>
</I>&gt;<i> http_access deny all
</I>&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> #Bumping
</I>&gt;<i>
</I>&gt;<i> acl step1 at_step SslBump1
</I>&gt;<i>
</I>&gt;<i> acl step2 at_step SslBump2
</I>&gt;<i>
</I>&gt;<i> acl step3 at_step SslBump3
</I>&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> acl broken_sites ssl::server_name_regex &quot;/etc/squid3/acls/http_broken.txt&quot;
</I>&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> #ssl_bump peek all
</I>&gt;<i>
</I>&gt;<i> ssl_bump peek !broken_sites
</I>&gt;<i>
</I>&gt;<i> ssl_bump splice all
</I>&gt;<i>
</I>&gt;<i> #ssl_bump splice !broken_sites
</I>&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> sslproxy_capath /etc/ssl/certs
</I>&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> sslcrtd_program /lib/squid3/ssl_crtd -s /etc/squid3/ssl_db -M 4MB
</I>&gt;<i>
</I>&gt;<i> sslcrtd_children 32 startup=5 idle=1
</I>&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> #logformat mine %&gt;a %[ui %[un [%tl] &quot;%rm %ru HTTP/%rv&quot; %ssl::&gt;sni
</I>%ssl::&gt;cert_subject %&gt;Hs %&lt;st %Ss:%Sh
&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> #access_log syslog:daemon.info mine
</I>&gt;<i>
</I>&gt;<i> #access_log daemon:/var/log/squid3/test.log mine
</I>&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> #intercept
</I>&gt;<i>
</I>&gt;<i> http_port 3128 intercept
</I>&gt;<i>
</I>&gt;<i> https_port 3129 intercept ssl-bump cert=/etc/squid3/certs/squid.pem
</I>cafile=/etc/squid3/certs/squid.pem key=/etc/squid3/certs/squid.pem 
generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
sslflags=NO_SESSION_REUSE
&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> #nameservers
</I>&gt;<i>
</I>&gt;<i> dns_nameservers 192.168.201.1 8.8.8.8
</I>&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> #WCCPv2 items
</I>&gt;<i>
</I>&gt;<i> wccp_version 2
</I>&gt;<i>
</I>&gt;<i> wccp2_router 192.168.200.73
</I>&gt;<i>
</I>&gt;<i> wccp2_forwarding_method gre
</I>&gt;<i>
</I>&gt;<i> wccp2_return_method gre
</I>&gt;<i>
</I>&gt;<i> wccp2_service standard 0 password=LNP1
</I>&gt;<i>
</I>&gt;<i> wccp2_service dynamic 70 password=LNP1
</I>&gt;<i>
</I>&gt;<i> wccp2_service_info 70 protocol=tcp flags=dst_ip_hash priority=240
</I>ports=443
&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> *Bruce Markey*| Network Security Analyst
</I>&gt;<i>
</I>&gt;<i> STEINMANCOMMUNICATIONS
</I>&gt;<i>
</I>&gt;<i> 717.291.8758 (o) | <A HREF="https://lists.squid-cache.org/listinfo/squid-users">_bmarkey at steinmancommunications.com</A>
</I>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">bmarkey at steinmancommunications.com</A>&gt;_
&gt;<i>
</I>&gt;<i> 8 West King St| PO Box 1328,Lancaster, PA 17608-1328
</I>&gt;<i>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBCAAGBQJXIoOwAAoJENNXIZxhPexGyhwH/iys6RATQ+spnune1egNhMal
OcYXbZoC+mtIF5axYxLALNe+codKZlEEEcbdqQIRVx9EtM3q6ilwVhw0tJ6r2N4G
87h0sfRvTzdWVrHXjdmZhgDzj1TjIfb74W2nRWBMrSEbPrEinEJHaMqtO2/5iXBX
/k4GqAsq8LZi8fKEwKdiENYp82ywe5fsVleG6RxIlP4ek7dyAFj21XHWCvc0+Fwc
wzbC06H/3Uik797IlXB3opeWQfemxXqs9OzK/u+P8SNUgoQTLcz4DFpillg/8u9T
IJMSSxIbOqxIzKLT9+SFIno9GBgkjJ6MvorUVd24aMqbUr0jWp6a+vjN2X9HFk8=
=JLmW
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160429/1d355b36/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160429/1d355b36/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x613DEC46.asc
Type: application/pgp-keys
Size: 2437 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160429/1d355b36/attachment.key">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160429/1d355b36/attachment.key</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010371.html">[squid-users] Using dont_verify_peer
</A></li>
	<LI>Next message (by thread): <A HREF="010373.html">[squid-users] Using dont_verify_peer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10372">[ date ]</a>
              <a href="thread.html#10372">[ thread ]</a>
              <a href="subject.html#10372">[ subject ]</a>
              <a href="author.html#10372">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
