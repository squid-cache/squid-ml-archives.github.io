<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid NTLM AD Group Delay Pools
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20NTLM%20AD%20Group%20Delay%20Pools&In-Reply-To=%3C216a60fc-3ab3-61bd-5056-fbe0d5d8b103%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011792.html">
   <LINK REL="Next"  HREF="011803.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid NTLM AD Group Delay Pools</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20NTLM%20AD%20Group%20Delay%20Pools&In-Reply-To=%3C216a60fc-3ab3-61bd-5056-fbe0d5d8b103%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid NTLM AD Group Delay Pools">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Aug  4 12:07:36 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011792.html">[squid-users] Squid NTLM AD Group Delay Pools
</A></li>
        <LI>Next message (by thread): <A HREF="011803.html">[squid-users] Squid automatically deleted the Proxy-Authenticate	header
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11797">[ date ]</a>
              <a href="thread.html#11797">[ thread ]</a>
              <a href="subject.html#11797">[ subject ]</a>
              <a href="author.html#11797">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 4/08/2016 10:16 p.m., Garth wrote:
&gt;<i> Hi All
</I>&gt;<i> 
</I>&gt;<i> I am struggling with delay pools and Group AD. I have managed to narrow
</I>&gt;<i> down the problem to the AD Groups. If I do user auth, the delay pool
</I>&gt;<i> works perfectly. I have tried multiple groups from old to new just
</I>&gt;<i> incase. The AD Groups work for normal site access in the http_access
</I>&gt;<i> rules etc.
</I>&gt;<i> 
</I>&gt;<i> Is there a known issue with this?
</I>
Yes. See the FAQ:
&lt;<A HREF="http://wiki.squid-cache.org/SquidFaq/SquidAcl#Fast_and_Slow_ACLs">http://wiki.squid-cache.org/SquidFaq/SquidAcl#Fast_and_Slow_ACLs</A>&gt;

&gt;<i> Is there a way to confirm the group
</I>&gt;<i> lookup is correct by the squid/winbind?
</I>&gt;<i> 
</I>
By running your group helper manually from the command line. Entering
the username (in NTLM format) and group nam, separated by a space.


&gt;<i> Squid Cache: Version 3.1.23
</I>&gt;<i> 
</I>&gt;<i> Centos 6.8
</I>&gt;<i> 
</I>
There is one other catch with older Squid RHEL/CentOS packages. RHEL
used to patch Squid so the cache_effective_group directive had a default
value. This actively prevents Squid being setup as a member of the
winbind_priv group in addition to its normal 'proxy' or 'nobody' group.
You have to build your own proxy without that patch to use Winbind on
RHEL and CentOS.

I see that you are using the LDAP helper (not Winbinid helper you said
you were). So this may not be an issue, but YMMV.

&gt;<i> external_acl_type ldap_group %LOGIN /usr/lib64/squid/squid_ldap_group -R
</I>&gt;<i> -b &quot;dc=example,dc=example&quot; -f
</I>&gt;<i> &quot;(&amp;(sAMAccountName=%v)(memberOf=cn=%a,ou=Security,ou=groups,dc=example,dc=example))&quot;
</I>&gt;<i> -D <A HREF="https://lists.squid-cache.org/listinfo/squid-users">test at EXAMPLE.EXAMPLE</A> -w testing -h 192.168.1.254
</I>&gt;<i> 
</I>&gt;<i> auth_param ntlm program /usr/bin/ntlm_auth
</I>&gt;<i> --helper-protocol=squid-2.5-ntlmssp
</I>&gt;<i> auth_param ntlm children 50
</I>
:<i>-( this month is the 10-year anniversary since MiS announced NTLM was
</I>being deprecated and removed from their software. And the 5-year
anniversary since that process was apparently completed. It is very sad
to see such a broken protocol still being used.


&gt;<i> auth_param basic program /usr/bin/ntlm_auth
</I>&gt;<i> --helper-protocol=squid-2.5-basic
</I>&gt;<i> auth_param basic children 50
</I>&gt;<i> 
</I>&gt;<i> acl proxyusers-delaypool external ldap_group proxyusers-delaypool
</I>&gt;<i> acl proxyusers-nondelaypool external ldap_group proxyusers-nondelaypool
</I>&gt;<i> acl ftp.is url_regex ftp.is.co.za
</I>&gt;<i> 
</I>&gt;<i> acl socialsites url_regex &quot;/etc/squid/socialsites.txt&quot;
</I>&gt;<i> 
</I>&gt;<i> In the socialsites is the following:
</I>&gt;<i> 
</I>&gt;<i> .facebook.com
</I>&gt;<i> .facebook.co.za
</I>&gt;<i> .facebook.com:443
</I>&gt;<i> .youtube.com:443
</I>&gt;<i> .googlevideo.
</I>&gt;<i> .fbcdn.net
</I>&gt;<i> .akamaihd.net
</I>&gt;<i> .vimeocdn.com:443
</I>&gt;<i> 
</I>&gt;<i> delay_pools 4
</I>&gt;<i> delay_class 1 1
</I>&gt;<i> delay_class 2 2
</I>&gt;<i> delay_class 3 2
</I>&gt;<i> delay_class 4 1
</I>&gt;<i> delay_parameters 1 244000/552000
</I>&gt;<i> delay_parameters 2 524000/525000 524000/525000
</I>&gt;<i> delay_parameters 3 244000/254000 244000/254000
</I>&gt;<i> delay_parameters 4 244000/552000
</I>&gt;<i> delay_access 1 allow socialsites proxyusers-delaypool
</I>&gt;<i> delay_access 2 allow proxyusers-nondelaypool
</I>&gt;<i> delay_access 3 allow proxyusers-delaypool
</I>&gt;<i> delay_access 4 allow ftp.is proxyusers-delaypool
</I>&gt;<i> 
</I>&gt;<i> I am testing via wget and proxy input details into the bash profile. I
</I>&gt;<i> can confirm the username appears in the squid logs.
</I>&gt;<i> 
</I>&gt;<i> Any ideas?\
</I>
With Squid-3.1 you are limited to running the group lookup ACL in one of
the slow access control. Usually http_access. Then hoping that it stays
in memory long enough for the delay_access lookup to find it there and
not &quot;fail&quot; because no lookup is possible.

With the recent Squid versions you can make a wrapper script** that
returns the group names to Squid-3.5 as annotations like ' group=&quot;Foo&quot;
', and you have a 'note' type ACL checking the groups in delay_access.

** if you (or anyone) want to try patching the helper to do it without a
wrapper that would be very welcome for merging to Squid-4.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011792.html">[squid-users] Squid NTLM AD Group Delay Pools
</A></li>
	<LI>Next message (by thread): <A HREF="011803.html">[squid-users] Squid automatically deleted the Proxy-Authenticate	header
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11797">[ date ]</a>
              <a href="thread.html#11797">[ thread ]</a>
              <a href="subject.html#11797">[ subject ]</a>
              <a href="author.html#11797">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
