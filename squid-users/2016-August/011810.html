<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Seeking insight into zeros, negative values in log: 2.6.STABLE18
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Seeking%20insight%20into%20zeros%2C%0A%20negative%20values%20in%20log%3A%202.6.STABLE18&In-Reply-To=%3C8b6f5ca7-eb06-981b-573d-045154ff420b%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011808.html">
   <LINK REL="Next"  HREF="011812.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Seeking insight into zeros, negative values in log: 2.6.STABLE18</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Seeking%20insight%20into%20zeros%2C%0A%20negative%20values%20in%20log%3A%202.6.STABLE18&In-Reply-To=%3C8b6f5ca7-eb06-981b-573d-045154ff420b%40treenet.co.nz%3E"
       TITLE="[squid-users] Seeking insight into zeros, negative values in log: 2.6.STABLE18">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Aug  5 14:03:24 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011808.html">[squid-users] Seeking insight into zeros,	negative values in log: 2.6.STABLE18
</A></li>
        <LI>Next message (by thread): <A HREF="011812.html">[squid-users] Seeking insight into zeros,	negative values in log: 2.6.STABLE18 -- SOLVED
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11810">[ date ]</a>
              <a href="thread.html#11810">[ thread ]</a>
              <a href="subject.html#11810">[ subject ]</a>
              <a href="author.html#11810">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 6/08/2016 1:03 a.m., Henry S. Thompson wrote:
&gt;<i> Amos wrote:
</I>&gt;&gt;<i> HST wrote:
</I>&gt;<i> ...
</I>&gt;&gt;&gt;<i> Amos wrote:
</I>&gt;<i> ...
</I>&gt;&gt;&gt;&gt;<i> HST wrote:
</I>&gt;&gt;&gt;&gt;&gt;<i>  3) I'm seeing very small numbers (1 in 100000) of negative durations, e.g.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>     1402744620.389 -70 ... TCP_MISS/200 1882 GET <A HREF="http://...">http://...</A> DIRECT/... text/xml
</I>&gt;&gt;&gt;&gt;&gt;<i>     
</I>&gt;&gt;&gt;&gt;&gt;<i>     How should these be understood?
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> The system clock on your machine went backwards between the request
</I>&gt;&gt;&gt;&gt;<i> arriving and the response being completely sent. Check for issues in
</I>&gt;&gt;&gt;&gt;<i> your NTP setup.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 1000s of times a day?  Seems . . . unlikely.  But I'll try to get the
</I>&gt;&gt;&gt;<i> sys admin people responsible to investigate.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Squid's simply doing a time fetch from the kernel and subtracting
</I>&gt;&gt;<i> Start-time from End-time to get a negative.
</I>&gt;&gt;<i> Note that its on the scale of ~100 milliseconds.
</I>&gt;<i> 
</I>&gt;<i> Sorry but I still don't see how two successive fetchs could result in a
</I>&gt;<i> decrement (w/o an NTP intervention).  
</I>
Yes. I could have been clearer by saying the value is likely to be some
few hundred milliseconds off what really happened.

&gt;<i> 
</I>&gt;<i> The negative numbers I'm seeing range up into the low 1000s (of msec,
</I>&gt;<i> right?  That's what the squid documentation says, IIRC).
</I>
Yes Squid logs show milliseconds. But...

&gt;<i> 
</I>&gt;<i> Did you really mean &quot;~100 _milliseconds_&quot;?  My understanding was that
</I>&gt;<i> kernel time differences were typically accurate to ~100 _nanoseconds_.
</I>&gt;<i> 
</I>
Kernels at nanoseconds. Squid is working in milliseconds. Average
transactions are usually around 100ms and NTP jumps which are probably
behind this are in seconds or milliseconds.

So with NTP jumping around I' give it a rough estimate of the accuracy
being likely to be some 100's of ms different from reality.

&gt;<i> If you can easily tell me where to look in the source, obviously that's
</I>&gt;<i> what I should do....
</I>
Sorry. With 2.6 I'm not sure where anything is. 3.x has a lot of change
since then, even 2.7 is significantly different.

In Squid-3 it is src/time.cc getCurrentTime() to fetch when the request
is done parsing, and again when log line is formatted - the value of
current_time stored at those points (not squid_time). With
tvSubMsec(T1(parsed time), T2(logged time)) output used as the duration
column.

So the Squid logs can contain negative duration under exactly four
conditions:
 1) server boot when (and only when) the BIOS clock is innacurate and
jumps around a bit.

 2) daylight savings changes. Only when the server is running in local
timezone clocks instead of proper UTC.

 3) UTC leap seconds/minutes that go backward. (once every six months
that might happen).

 4) NTP service adjusting the kernel clock backwards.

Since you say this is happening noticably often then its #4 and there is
something funky going on with NTP. The others are all at rare and
predictable times.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011808.html">[squid-users] Seeking insight into zeros,	negative values in log: 2.6.STABLE18
</A></li>
	<LI>Next message (by thread): <A HREF="011812.html">[squid-users] Seeking insight into zeros,	negative values in log: 2.6.STABLE18 -- SOLVED
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11810">[ date ]</a>
              <a href="thread.html#11810">[ thread ]</a>
              <a href="subject.html#11810">[ subject ]</a>
              <a href="author.html#11810">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
