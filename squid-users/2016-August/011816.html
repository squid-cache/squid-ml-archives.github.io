<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Range header is a hit ratio killer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Range%20header%20is%20a%20hit%20ratio%20killer&In-Reply-To=%3C01e101d1f0ae%247f193830%247d4ba890%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011813.html">
   <LINK REL="Next"  HREF="011829.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Range header is a hit ratio killer</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Range%20header%20is%20a%20hit%20ratio%20killer&In-Reply-To=%3C01e101d1f0ae%247f193830%247d4ba890%24%40ngtech.co.il%3E"
       TITLE="[squid-users] Range header is a hit ratio killer">eliezer at ngtech.co.il
       </A><BR>
    <I>Sun Aug  7 13:20:41 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011813.html">[squid-users] Range header is a hit ratio killer
</A></li>
        <LI>Next message (by thread): <A HREF="011829.html">[squid-users] Range header is a hit ratio killer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11816">[ date ]</a>
              <a href="thread.html#11816">[ thread ]</a>
              <a href="subject.html#11816">[ subject ]</a>
              <a href="author.html#11816">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Simon,

I do not know the plans but it will depend on couple things which can fit to one case but not the other.
The assumption that we can fetch any part of the object is the first step for any solution what so ever.
However it is not guaranteed that each request will be public.

The idea of static chunks exists for many years in many applications and in many forms and YouTube videos player uses a similar idea. Google video clients and servers uses a bytes &quot;range&quot; request in the url rather then in the request header.
Technically it would be possible to implement such an idea but it has it's own cost.
Eventually if the file is indeed public(what squid was designed to cache) then it might not be of a big problem.
Depends on the target sites a the solution will be different.
Before deciding on a specific solution my preferred path is to analyze the requests.

By observing amplified traffic of 500% to  clients side you mean that the incoming traffic to the server is 500% compared to the output towards the clients?
If so I think that there might be a &quot;smarter&quot; solution then 206 range offset limit.
The old method of prefetching works pretty good in many cases. From what you describe it might have better luck then the plain &quot;fetch everything on the wire in real time&quot;.

I cannot guarantee that prefetching is the right solution for you but I think that a case like this deserves couple eyes to understand if there is a right way to handle the situation.

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>


-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of k simon
Sent: Saturday, August 6, 2016 12:56 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [squid-users] Range header is a hit ratio killer

Hi,list,
   Code 206 is the most pain for our forwed proxy. Squid use &#8220;range_offset_limit&#8221; to process byte-range request. when set it &quot;none&quot;, it has 2 wellknown issue:
1.  boost the traffic on the server side, we observed it's amplified 500% compared to clients side on our box.
2.  it's always failed on a lossy link, and squid refetched it again and again.
   I've noticed that nginx have supported &quot;byte-range cacheing&quot; since
1.9.8  by Module ngx_http_slice_module officially.
(1. 
<A HREF="http://nginx.org/en/docs/http/ngx_http_slice_module.html?_ga=1.140845234.106894549.1470474534">http://nginx.org/en/docs/http/ngx_http_slice_module.html?_ga=1.140845234.106894549.1470474534</A>
2. <A HREF="https://www.nginx.com/resources/admin-guide/content-caching/">https://www.nginx.com/resources/admin-guide/content-caching/</A>  ).
   The solution is not perfect, but it's really more usable than &quot;range_offset_limit&quot;. The secret it's use a fixed size object replaced the whole file, and we can alter the request range offset and passed it to server; perhaps forward the origin range offset and cache a part of the object with a range key is a better idea. And squid should know how to make up those object and process the request with range header.
   And with a fixed size object to cache it may benefits to disk IO. 
Sounds it's similar like big-rock db concept, though I've not got successed with rock on FreeBSD nor ubuntu box.
   Does squid has some plan to support this method or have another solution?



Regards
Simon
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011813.html">[squid-users] Range header is a hit ratio killer
</A></li>
	<LI>Next message (by thread): <A HREF="011829.html">[squid-users] Range header is a hit ratio killer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11816">[ date ]</a>
              <a href="thread.html#11816">[ thread ]</a>
              <a href="subject.html#11816">[ subject ]</a>
              <a href="author.html#11816">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
