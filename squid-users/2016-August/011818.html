<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Range header is a hit ratio killer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Range%20header%20is%20a%20hit%20ratio%20killer&In-Reply-To=%3C02d401d1f112%24aab5c6c0%2400215440%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011817.html">
   <LINK REL="Next"  HREF="011830.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Range header is a hit ratio killer</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Range%20header%20is%20a%20hit%20ratio%20killer&In-Reply-To=%3C02d401d1f112%24aab5c6c0%2400215440%24%40ngtech.co.il%3E"
       TITLE="[squid-users] Range header is a hit ratio killer">eliezer at ngtech.co.il
       </A><BR>
    <I>Mon Aug  8 01:17:44 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011817.html">[squid-users] Range header is a hit ratio killer
</A></li>
        <LI>Next message (by thread): <A HREF="011830.html">[squid-users] Range header is a hit ratio killer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11818">[ date ]</a>
              <a href="thread.html#11818">[ thread ]</a>
              <a href="subject.html#11818">[ subject ]</a>
              <a href="author.html#11818">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Yuri,

 

The issue is not money alone&#8230;

To my understanding Squid is written in C++ and is very complex, due to this it requires more then basic level knowledge.

However I can clearly say that it's not a big issue to use current squid APIs\Interfaces(ICAP\ECAP) to implement a solution which will act like the nginx  &quot;module&quot;.

I do not know how long it would take or how much it will cost since it requires time&#8230;

This time is required for:

- Learning\Relearning

- Identifying and predicting the different cases

- Basic testing for the different cases

- Implementing a basic structure

- Testing

- (In a loop and\or couple trees&#8230;)

 

&gt;<i>From my point of view compared to &quot;ransom&quot; or any similar idea, anyone that will write any piece of software to implement this specific idea should be able to take on his shoulders more then only this but more then just this.
</I>
And just to illustrate, imagine that some nice guy pops into Boing or RedHat offices and will leave a DiskOnKey at the front desk with a note &quot;This flash drive contains an idea that will bring you lots of money&quot;(not saying the current idea itself is bad or wrong..).

What would these companies do? Will they put a team of engineers in a second?

I do believe that they are not &quot;hot headed&quot; enough to act in a second.

 

I received a link couple years ago from Amos for an e-cap module:

<A HREF="https://github.com/creamy/ecap-mongo">https://github.com/creamy/ecap-mongo</A>

Which does couple very interesting things but, despite to the fact that I learned to program in C and C++ I couldn't understand and\or implement a Store API which could be used for\by squid.

However I implemented this:

Windows Updates a Caching Stub zone[ <A HREF="http://www1.ngtech.co.il/wpe/?page_id=301">http://www1.ngtech.co.il/wpe/?page_id=301</A> ]

And while implementing the idea one of the main things I noticed is that trying to &quot;catch&quot; all traffic into disk is the wrong way to define a goal.

Indeed it can be written to be done &quot;automatically&quot; but I will ask:
What is it worth to write everything into disk if you never read from disk more then 1% of the files content?

 

If you have a specific targeted site it's one thing but trying to catch them all is kind of like tying your feet with a rope to a door and then shove\slam the door to the other direction.
Imagine yourself how far and fast you will fly?

 

Thanks,

Eliezer

 

----

 &lt;<A HREF="http://ngtech.co.il/lmgtfy/">http://ngtech.co.il/lmgtfy/</A>&gt; Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>



 

From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Yuri Voinov
Sent: Sunday, August 7, 2016 9:23 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Range header is a hit ratio killer

 


-----BEGIN PGP SIGNED MESSAGE----- 
Hash: SHA256 
 
So,

the overall answer is &quot;NO&quot;.

You can use Store-ID + collapsed forwarding functionality to achieve something your want. May be together, may be separate. Hard luck :)

But this is your own problem. No one will solve the problem without the infusion of large amounts of money to make it interesting.

:<i>)
</I>

07.08.2016 20:12, Amos Jeffries &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> On 6/08/2016 9:56 p.m., k simon
</I>
      wrote:



      &gt;&gt; Hi,list,



      &gt;&gt;   Code 206 is the most pain for our forwed proxy. Squid

      use



      &gt;&gt; &#8220;range_offset_limit&#8221; to process byte-range request. when

      set it &quot;none&quot;,



      &gt;&gt; it has 2 wellknown issue:



      &gt;&gt; 1.  boost the traffic on the server side, we observed

      it's amplified



      &gt;&gt; 500% compared to clients side on our box.



      &gt;



      &gt; To which the answer currently is to see if enabling

      collapsed_forwarding



      &gt; works okay for your needs.



      &gt;



      &gt;&gt; 2.  it's always failed on a lossy link, and squid

      refetched it again and



      &gt;&gt; again.



      &gt;&gt;   I've noticed that nginx have supported &quot;byte-range

      cacheing&quot; since



      &gt;&gt; 1.9.8  by Module ngx_http_slice_module officially.



      &gt;&gt; (1.



      &gt;&gt;

<A HREF="http://nginx.org/en/docs/http/ngx_http_slice_module.html?_ga=1.140845234.106894549.1470474534">http://nginx.org/en/docs/http/ngx_http_slice_module.html?_ga=1.140845234.106894549.1470474534</A>



      &gt;&gt;



      &gt;



      &gt; So? what relevance does other software features have to Squid

      behaviour?



      &gt;



      &gt; 

 &lt;<A HREF="http://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F">http://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F</A>&gt; &lt;<A HREF="http://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F">http://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F</A>&gt;



      &gt;



      &gt; ... to be fair the storage code in Squid is a bit hairy in

      places. So



      &gt; paying for it to be done is unlikely to be cheap. But still,

      waiting



      &gt; wont fix the problem. We nearly go there in Squid-2.7, but

      the



      &gt; experiment there is not able to completely port across to

      Squid-3 and



      &gt; had some important problems anyway.



      &gt;



      &gt;



      &gt;&gt; 2.

      <A HREF="https://www.nginx.com/resources/admin-guide/content-caching/">https://www.nginx.com/resources/admin-guide/content-caching/</A>  ).



      &gt;&gt;   The solution is not perfect, but it's really more

      usable than



      &gt;&gt; &quot;range_offset_limit&quot;. The secret it's use a fixed size

      object replaced



      &gt;&gt; the whole file, and we can alter the request range offset

      and passed it



      &gt;&gt; to server;



      &gt;



      &gt; Ah, thats what range_offset_limit does today. Updates the

      server request



      &gt; to say &quot;deliver all of it&quot; and stores the response in a file

      the size of



      &gt; the whole expected response the server informs will be

      arriving.



      &gt;



      &gt; The reason you are seeing that 500% increase in bandwidth is

      that



      &gt; multiple Range requests arrive while the initial part of the

      first



      &gt; response is still arriving back to Squid, so 5 of them get

      sent through



      &gt; to the server. When that first one finishes, its object

      becomes



      &gt; available for use as a HIT and followup Range requests get

      bits of it



      &gt; (so you dont see 600% -&gt; millions of % bandwidth

      increase).



      &gt;



      &gt; collapsed_fowarding alters this by letting the first response

      be used by



      &gt; other requests while it is still incomplete. But YMMV

      regarding the



      &gt; savings and CF affects all traffic, so it may cause

      behaviours you dont



      &gt; want on other types of request. Worth a try though.



      &gt;



      &gt;



      &gt;&gt; perhaps forward the origin range offset and cache a part

      of



      &gt;&gt; the object with a range key is a better idea.



      &gt;&gt; And squid should know how



      &gt;&gt; to make up those object and process the request with

      range header.



      &gt;&gt;   And with a fixed size object to cache it may benefits

      to disk IO.



      &gt;&gt; Sounds it's similar like big-rock db concept, though I've

      not got



      &gt;&gt; successed with rock on FreeBSD nor ubuntu box.



      &gt;&gt;   Does squid has some plan to support this method or have

      another solution?



      &gt;&gt;



      &gt;



      &gt; squid is software. It doesn't have its own plans (at least I

      hope not).



      &gt;



      &gt; I'm not aware of any plans specifically to add Range caching

      any time



      &gt; soon. Ideas for how to do it get thrown around in squid-dev a

      couple of



      &gt; times a year, so lots of ideas but so far nothing concrete

      has come out



      &gt; of it. Yes rock and/or memory caches are looking like the

      most easily



      &gt; adapted cache types to enable storing partial objects in,

      someone still



      &gt; has to do the actual coding work though.



      &gt;



      &gt; Amos



      &gt;



      &gt; _______________________________________________



      &gt; squid-users mailing list



      &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt; 



      &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>

-----BEGIN PGP SIGNATURE----- 
Version: GnuPG v2 
 
iQEcBAEBCAAGBQJXp3yAAAoJENNXIZxhPexGDEYH/AjM5hD4ahsF9IXsMo5PrWLE 
nlKCloampXBur7o1PD2uOynU35ayV2wjJlBU9P9uQrux5lus0FCHt0yD/X9rEJ4J 
E1AcShLUfK6ezMdSKnn5tylfTg1+4U08/hJz3+E9PGxA//peoPVovgHu/WuFXM4X 
2NtSaVeib1O7QI2Dr0yRGZKKuJ9C2/YZqTAgjUa8rT2JZAsi5bzVU4WoaXwxklZD 
OolueguA63dKo3n86oAR1W0jmPoXQeHvPuleYbGLUwWVBBlRJdCHpKfVnh/D+ni4 
w0hR0MRBZzS8dVNQTrTCCzuFoIH1VjHhYKKZaIQEgPpo7AsvtABNTxLM7MJmqRY= 
=UX3s 
-----END PGP SIGNATURE----- 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160808/31bc9354/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160808/31bc9354/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 11317 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160808/31bc9354/attachment.png">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160808/31bc9354/attachment.png</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011817.html">[squid-users] Range header is a hit ratio killer
</A></li>
	<LI>Next message (by thread): <A HREF="011830.html">[squid-users] Range header is a hit ratio killer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11818">[ date ]</a>
              <a href="thread.html#11818">[ thread ]</a>
              <a href="subject.html#11818">[ subject ]</a>
              <a href="author.html#11818">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
