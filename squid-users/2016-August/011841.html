<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] I redirect some http traffic to squid ( 90Mbps) and i found TIME_WAIT is 20840 and one of squid process is 57% , whether it will be fine ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20I%20redirect%20some%20http%20traffic%20to%20squid%20%28%2090Mbps%29%0A%20and%20i%20found%20TIME_WAIT%20is%2020840%20and%20one%20of%20squid%20process%20is%2057%25%20%2C%0A%20whether%20it%20will%20be%20fine%20%3F&In-Reply-To=%3C4c61fe6a-56d5-4a03-a76b-a832d995cda6%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011833.html">
   <LINK REL="Next"  HREF="011834.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] I redirect some http traffic to squid ( 90Mbps) and i found TIME_WAIT is 20840 and one of squid process is 57% , whether it will be fine ?</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20I%20redirect%20some%20http%20traffic%20to%20squid%20%28%2090Mbps%29%0A%20and%20i%20found%20TIME_WAIT%20is%2020840%20and%20one%20of%20squid%20process%20is%2057%25%20%2C%0A%20whether%20it%20will%20be%20fine%20%3F&In-Reply-To=%3C4c61fe6a-56d5-4a03-a76b-a832d995cda6%40treenet.co.nz%3E"
       TITLE="[squid-users] I redirect some http traffic to squid ( 90Mbps) and i found TIME_WAIT is 20840 and one of squid process is 57% , whether it will be fine ?">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Aug  9 15:56:08 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011833.html">[squid-users] I redirect some http traffic to squid ( 90Mbps) and i found TIME_WAIT is 20840 and one of squid process is 57% , whether it will be fine ?
</A></li>
        <LI>Next message (by thread): <A HREF="011834.html">[squid-users] [Feature request] possibility to mark some keys(in	kv-pairs) as singular
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11841">[ date ]</a>
              <a href="thread.html#11841">[ thread ]</a>
              <a href="subject.html#11841">[ subject ]</a>
              <a href="author.html#11841">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 9/08/2016 7:31 p.m., johnzeng wrote:
&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Hello Dear Sir
</I>&gt;<i> 
</I>&gt;<i> I redirect some http traffic to squid ( 90Mbps) and i found TIME_WAIT is
</I>&gt;<i> 20840 and one of squid process is 57%
</I>&gt;<i> 
</I>&gt;<i> whether it will be normal condition ??
</I>&gt;<i> 
</I>
For 3.5.2 it can be 'normal'. But normal is not necessarily good.
Several bugs that have that type of effect have been fixed since 3.5.2
was released.

If you can please upgrade to 3.5.20 ASAP, all releases before 3.5.19
have major security vulnerabilities.


&gt;<i> Whether we can balance cpu processing capacity
</I>&gt;<i> &lt;<A HREF="http://www.baidu.com/link?url=Rnht_DzfJLQPi_VnmfPjUfWfUdE4kaP1H7Vol-rTTZqKvF8npmGrx8-h947AFhU6-kqlwyWBW7W4ghqHWMs1iN1APnbkLMjrB7YI1PzephOCELHTqemcUEY1JH0mmw68">http://www.baidu.com/link?url=Rnht_DzfJLQPi_VnmfPjUfWfUdE4kaP1H7Vol-rTTZqKvF8npmGrx8-h947AFhU6-kqlwyWBW7W4ghqHWMs1iN1APnbkLMjrB7YI1PzephOCELHTqemcUEY1JH0mmw68</A>&gt;
</I>&gt;<i> for full squid process !
</I>
This focussing on balanced CPUs is counter-productive. With processes
like Squid it is actually more efficient to use fewer CPUs at higher
load than more CPUs at lower load.

When one CPU core is doing a lot more of the work it means there is less
contention between cores for access to RAM resoures, less delays
incurred by UDP messaging between the Squid worker processes or waiting
for atomic locks, and the unused core(s) can possibly be put into
power-saving modes. All of which reduces latency or monetary costs.

&gt;<i> 
</I>&gt;<i> Because we use squid 3.5.2 and use cache_dir rock part . Maybe squid
</I>&gt;<i> 3.5.2 require to do automatic scheduling at full cpu core
</I>&gt;<i> 
</I>&gt;<i> i don't know whether i can use taskset for squid 3.5.3 as squid 2.7 ??
</I>&gt;<i> 
</I>
I'm not certain but it should be possible. You have used cpu_affinity
explicitly in squid.conf, so that may alter what can be done with
taskset. Give it a try.

&gt;<i> ___________________________________________________________________________
</I>&gt;<i> 
</I>&gt;<i> PART SQUID CONFIG
</I>&gt;<i> ___________________________________________________________________________
</I>&gt;<i> 
</I>&gt;<i> cache_mem 32172 MB
</I>&gt;<i> workers 8
</I>&gt;<i> cpu_affinity_map process_numbers=1,2,3,4,5,6,7,8 cores=1,3,5,7,9,11,13,15
</I>&gt;<i> cache_dir rock /acapp/webcache3/storage/cossbig1/squid1 17280
</I>&gt;<i> min-size=4097 max-size=262144 max-swap-rate=250 swap-timeout=350
</I>&gt;<i> cache_dir rock /acapp/webcache3/storage/cosssmall1/squid1 1152
</I>&gt;<i> max-size=4096 max-swap-rate=250 swap-timeout=350
</I>&gt;<i> if ${process_number} = 1
</I>&gt;<i> unique_hostname fast_squid${process_number}
</I>&gt;<i> access_log stdio:/acapp/logs/webcache3/squid${process_number}/access.log
</I>&gt;<i> squid
</I>&gt;<i> cache_log /acapp/logs/webcache3/squid${process_number}/cache.log
</I>

FYI the idea behind using ${process_number} within config lines is to
avoid the need to wrap them inside the if ${process_number} config block
conditions.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011833.html">[squid-users] I redirect some http traffic to squid ( 90Mbps) and i found TIME_WAIT is 20840 and one of squid process is 57% , whether it will be fine ?
</A></li>
	<LI>Next message (by thread): <A HREF="011834.html">[squid-users] [Feature request] possibility to mark some keys(in	kv-pairs) as singular
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11841">[ date ]</a>
              <a href="thread.html#11841">[ thread ]</a>
              <a href="subject.html#11841">[ subject ]</a>
              <a href="author.html#11841">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
