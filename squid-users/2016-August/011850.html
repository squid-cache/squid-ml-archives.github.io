<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Range header is a hit ratio killer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Range%20header%20is%20a%20hit%20ratio%20killer&In-Reply-To=%3C091b01d1f2f9%241579d720%24406d8560%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011829.html">
   <LINK REL="Next"  HREF="011815.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Range header is a hit ratio killer</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Range%20header%20is%20a%20hit%20ratio%20killer&In-Reply-To=%3C091b01d1f2f9%241579d720%24406d8560%24%40ngtech.co.il%3E"
       TITLE="[squid-users] Range header is a hit ratio killer">eliezer at ngtech.co.il
       </A><BR>
    <I>Wed Aug 10 11:19:38 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011829.html">[squid-users] Range header is a hit ratio killer
</A></li>
        <LI>Next message (by thread): <A HREF="011815.html">[squid-users] Range header is a hit ratio killer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11850">[ date ]</a>
              <a href="thread.html#11850">[ thread ]</a>
              <a href="subject.html#11850">[ subject ]</a>
              <a href="author.html#11850">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Well it will be different from system to system but one of the main things was not about prefetching.
Indeed sometimes prefetching is not possible, but, when you have a situation which parallel requests are causing amplified download by your proxy it means the proxy or the clients have some conflict of &quot;interest&quot;.
The client and you will blame the proxy while you will probably blame the software or the code.

Prefetching in the caching world and from my perspective and understanding of how proxies work is only compared to repeated download.
Means that since a proxy can never fetch something without the client requesting anything, then we can separate couple things in the proxy.
The request, the prefetching and the cache policy are couple different &quot;things&quot;.
When you are using a rule\config which forces the proxy to utilize 500% of the bandwidth then you have an &quot;issue&quot;.
This specific issue can be converted from one to another with enough admin logic leaving the cache policy to the internal parts of the cache.

The simplest way to understand the issue is to understand what Amos described.. It is possible that the proxy is trying to download the full object 5 times if 5 clients(or the  same but couple connections) are asking the same object.
The solution to such an issue would be to consolidate these requests into one.
And since code changes in Squid takes time you could convert the issue into another form.
The simplest way to do so is inspect each request in a level that will identify a 206 request and will send it into one &quot;prefetch&quot; queue.
This prefetch external queue software\script\code will be able to resolve the &quot;500% amplification&quot; which some would describe as an attack.
This way the clients requests will be served live and without causing amplification attacks while the cache will be filled externally\artificially with objects.
Depends on the cache purpose you would be able to make it work.
I have implemented couple times this idea in the past using a set of ruby scripts and I must admit that some objects do not worth the code invested in them.

Hope it clears the picture\words and meanings,
Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>


-----Original Message-----
From: k simon [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">chio1990 at gmail.com</A>] 
Sent: Tuesday, August 9, 2016 6:36 AM
To: Eliezer Croitoru; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Range header is a hit ratio killer



&#22312; 16/8/7 21:20, Eliezer Croitoru &#20889;&#36947;:
&gt;<i> Hey Simon,
</I>&gt;<i>
</I>&gt;<i> I do not know the plans but it will depend on couple things which can fit to one case but not the other.
</I>&gt;<i> The assumption that we can fetch any part of the object is the first step for any solution what so ever.
</I>&gt;<i> However it is not guaranteed that each request will be public.
</I>&gt;<i>
</I>&gt;<i> The idea of static chunks exists for many years in many applications and in many forms and YouTube videos player uses a similar idea. Google video clients and servers uses a bytes &quot;range&quot; request in the url rather then in the request header.
</I>&gt;<i> Technically it would be possible to implement such an idea but it has it's own cost.
</I>&gt;<i> Eventually if the file is indeed public(what squid was designed to cache) then it might not be of a big problem.
</I>&gt;<i> Depends on the target sites a the solution will be different.
</I>&gt;<i> Before deciding on a specific solution my preferred path is to analyze the requests.
</I>&gt;<i>
</I>&gt;<i> By observing amplified traffic of 500% to  clients side you mean that the incoming traffic to the server is 500% compared to the output towards the clients?
</I>&gt;<i> If so I think that there might be a &quot;smarter&quot; solution then 206 range offset limit.
</I>&gt;<i> The old method of prefetching works pretty good in many cases. From what you describe it might have better luck then the plain &quot;fetch everything on the wire in real time&quot;.
</I>&gt;<i>
</I>&gt;<i> I cannot guarantee that prefetching is the right solution for you but I think that a case like this deserves couple eyes to understand if there is a right way to handle the situation.
</I>&gt;<i>
</I>  I think prefetch may not be fit for forward proxy, as we do not know what's &quot;hot&quot; request exactly. LRU should do more efficient.

Simon


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011829.html">[squid-users] Range header is a hit ratio killer
</A></li>
	<LI>Next message (by thread): <A HREF="011815.html">[squid-users] Range header is a hit ratio killer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11850">[ date ]</a>
              <a href="thread.html#11850">[ thread ]</a>
              <a href="subject.html#11850">[ subject ]</a>
              <a href="author.html#11850">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
