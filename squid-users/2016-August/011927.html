<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid cpu usage 100% from few days ago !!
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20cpu%20usage%20100%25%20from%20few%20days%20ago%20%21%21&In-Reply-To=%3C43d47103-542c-0fdd-9a56-ba45a360123c%40urlfilterdb.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011926.html">
   <LINK REL="Next"  HREF="011928.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid cpu usage 100% from few days ago !!</H1>
    <B>Marcus Kool</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20cpu%20usage%20100%25%20from%20few%20days%20ago%20%21%21&In-Reply-To=%3C43d47103-542c-0fdd-9a56-ba45a360123c%40urlfilterdb.com%3E"
       TITLE="[squid-users] Squid cpu usage 100% from few days ago !!">marcus.kool at urlfilterdb.com
       </A><BR>
    <I>Sat Aug 13 11:02:11 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011926.html">[squid-users] Squid cpu usage 100% from few days ago !!
</A></li>
        <LI>Next message (by thread): <A HREF="011928.html">[squid-users] Squid cpu usage 100% from few days ago !!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11927">[ date ]</a>
              <a href="thread.html#11927">[ thread ]</a>
              <a href="subject.html#11927">[ subject ]</a>
              <a href="author.html#11927">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>It seems that squid is doing a lot of calls to vfprintf.
The first thing that comes to mind is that you have debugging on.
What is the setting for debug_options ?

Marcus

On 08/13/2016 04:18 AM, Omid Kosari wrote:
&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> Recently 2 different squid boxes grows from ~40% cpu usage to 100% without
</I>&gt;<i> any changes to config/banwidth/number of clients/etc
</I>&gt;<i>
</I>&gt;<i> The problems forced me to bypass squid until the problem found .
</I>&gt;<i> Right now even 10% of users can make squid 100% .
</I>&gt;<i>
</I>&gt;<i> Info
</I>&gt;<i>
</I>&gt;<i> Squid is in tproxy mode with routing
</I>&gt;<i>
</I>&gt;<i> Ubuntu Linux 16.04 , 4.4.0-34-generic on x86_64
</I>&gt;<i> Squid Cache: Version 3.5.19 from debian repository
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> samples  %        image name               symbol name
</I>&gt;<i> 1532894  42.8190  libc-2.23.so             _IO_strn_overflow
</I>&gt;<i> 1028537  28.7306  libc-2.23.so             _IO_default_xsputn
</I>&gt;<i> 662802   18.5143  libc-2.23.so             vfprintf
</I>&gt;<i> 77019     2.1514  squid                    /usr/sbin/squid
</I>&gt;<i> 28861     0.8062  libc-2.23.so             __memset_sse2
</I>&gt;<i> 26948     0.7528  r8169                    /r8169
</I>&gt;<i> 25320     0.7073  libc-2.23.so             __memcpy_sse2_unaligned
</I>&gt;<i> 21712     0.6065  libc-2.23.so             __GI___mempcpy
</I>&gt;<i> 14918     0.4167  libc-2.23.so             _int_malloc
</I>&gt;<i> 8889      0.2483  nf_conntrack             /nf_conntrack
</I>&gt;<i> 8130      0.2271  libc-2.23.so             __GI_strchr
</I>&gt;<i> 6357      0.1776  libc-2.23.so             _int_free
</I>&gt;<i> 4152      0.1160  libc-2.23.so             re_search_internal
</I>&gt;<i> 4043      0.1129  libc-2.23.so             strlen
</I>&gt;<i> 2754      0.0769  libstdc++.so.6.0.21
</I>&gt;<i> /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.21
</I>&gt;<i> 2753      0.0769  libc-2.23.so             free
</I>&gt;<i> 2704      0.0755  ip_tables                /ip_tables
</I>&gt;<i> 2560      0.0715  reiserfs                 /reiserfs
</I>&gt;<i> 2332      0.0651  kallsyms                 ___slab_alloc
</I>&gt;<i> 2284      0.0638  libc-2.23.so             malloc_consolidate
</I>&gt;<i> 2204      0.0616  libc-2.23.so             malloc
</I>&gt;<i> 2175      0.0608  kallsyms                 sys_epoll_ctl
</I>&gt;<i> 2035      0.0568  kallsyms                 csum_partial_copy_generic
</I>&gt;<i> 1614      0.0451  libc-2.23.so             calloc
</I>&gt;<i> 1552      0.0434  kallsyms                 _raw_spin_lock
</I>&gt;<i> 1208      0.0337  kallsyms                 memcpy
</I>&gt;<i> 1203      0.0336  kallsyms                 nf_iterate
</I>&gt;<i> 1177      0.0329  kallsyms                 irq_entries_start
</I>&gt;<i> 1165      0.0325  kallsyms                 __fget
</I>&gt;<i> 1072      0.0299  kallsyms                 copy_user_generic_string
</I>&gt;<i> 1037      0.0290  kallsyms                 __alloc_skb
</I>&gt;<i> 1002      0.0280  kallsyms                 tcp_sendmsg
</I>&gt;<i> 945       0.0264  libc-2.23.so             build_upper_buffer
</I>&gt;<i> 875       0.0244  kallsyms                 kmem_cache_free
</I>&gt;<i> 873       0.0244  kallsyms                 tcp_rack_mark_lost
</I>&gt;<i> 868       0.0242  nf_nat_ipv4              /nf_nat_ipv4
</I>&gt;<i> 861       0.0241  kallsyms                 kfree
</I>&gt;<i> 837       0.0234  kallsyms                 __inet_lookup_established
</I>&gt;<i> 834       0.0233  kallsyms                 get_partial_node.isra.61
</I>&gt;<i> 825       0.0230  kallsyms                 __slab_free
</I>&gt;<i> 815       0.0228  kallsyms                 sock_poll
</I>&gt;<i> 810       0.0226  kallsyms                 skb_release_data
</I>&gt;<i> 802       0.0224  nf_conntrack_ipv4        /nf_conntrack_ipv4
</I>&gt;<i> 792       0.0221  kallsyms                 tcp_transmit_skb
</I>&gt;<i> 771       0.0215  kallsyms                 kmem_cache_alloc
</I>&gt;<i> 719       0.0201  kallsyms                 fib_table_lookup
</I>&gt;<i> 704       0.0197  kallsyms                 _raw_spin_lock_irqsave
</I>&gt;<i> 701       0.0196  kallsyms                 tcp_v4_rcv
</I>&gt;<i> 699       0.0195  libm-2.23.so             __ieee754_log_avx
</I>&gt;<i> 686       0.0192  nf_nat                   /nf_nat
</I>&gt;<i> 684       0.0191  kallsyms                 tcp_write_xmit
</I>&gt;<i> 674       0.0188  kallsyms                 __cmpxchg_double_slab.isra.44
</I>&gt;<i> 626       0.0175  kallsyms                 __netif_receive_skb_core
</I>&gt;<i> 621       0.0173  libnettle.so.6.2
</I>&gt;<i> /usr/lib/x86_64-linux-gnu/libnettle.so.6.2
</I>&gt;<i> 608       0.0170  kallsyms                 delay_tsc
</I>&gt;<i> 600       0.0168  kallsyms                 ksize
</I>&gt;<i> 595       0.0166  kallsyms                 tcp_ack
</I>&gt;<i> 592       0.0165  kallsyms                 __local_bh_enable_ip
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> View this message in context: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-cpu-usage-100-from-few-days-ago-tp4678894.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-cpu-usage-100-from-few-days-ago-tp4678894.html</A>
</I>&gt;<i> Sent from the Squid - Users mailing list archive at Nabble.com.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011926.html">[squid-users] Squid cpu usage 100% from few days ago !!
</A></li>
	<LI>Next message (by thread): <A HREF="011928.html">[squid-users] Squid cpu usage 100% from few days ago !!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11927">[ date ]</a>
              <a href="thread.html#11927">[ thread ]</a>
              <a href="subject.html#11927">[ subject ]</a>
              <a href="author.html#11927">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
