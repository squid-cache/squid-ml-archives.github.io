<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Yet another store_id question HIT MISS
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Yet%20another%20store_id%20question%20HIT%20MISS&In-Reply-To=%3C024901d1f88f%24701dd4b0%2450597e10%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011998.html">
   <LINK REL="Next"  HREF="012005.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Yet another store_id question HIT MISS</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Yet%20another%20store_id%20question%20HIT%20MISS&In-Reply-To=%3C024901d1f88f%24701dd4b0%2450597e10%24%40ngtech.co.il%3E"
       TITLE="[squid-users] Yet another store_id question HIT MISS">eliezer at ngtech.co.il
       </A><BR>
    <I>Wed Aug 17 13:58:31 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011998.html">[squid-users] Yet another store_id question HIT MISS
</A></li>
        <LI>Next message (by thread): <A HREF="012005.html">[squid-users] Yet another store_id question HIT MISS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12001">[ date ]</a>
              <a href="thread.html#12001">[ thread ]</a>
              <a href="subject.html#12001">[ subject ]</a>
              <a href="author.html#12001">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Omid,

StoreID is not the only thing which can affect a HIT or a MISS.
A nice tool which was written to understand the subject is RedBot at:
<A HREF="https://redbot.org/">https://redbot.org/</A>

&gt;<i>From a simple inspection of the file it seems that it should get  hit but, why are you using StoreID for this object?
</I>Also why are you using:
refresh_pattern -i ^http:\/\/[a-zA-Z0-9\-\_\.]+\.squid\.internal\/.* 10080 95% 86400   override-lastmod override-expire reload-into-ims ignore-reload ignore-must-revalidate ignore-no-store ignore-private 

??
You would only need this for the specific case which the hostname is &quot;dynamic&quot;.
This url seems by default cache friendly and only if you have enough details on their cdn network you should try to use StoreID.
Something that may help you is the next log format settings:
logformat cache_headers %ts.%03tu %6tr %&gt;a %Ss/%03&gt;Hs %&lt;st %rm %ru %[un %Sh/%&lt;a %mt Q-CC: &quot;%{Cache-Control}&gt;h&quot; &quot;%{Cache-Control}&gt;ha&quot; Q-P: &quot;%{Pragma}&gt;h&quot; &quot;%{Pragma}&gt;ha&quot; REP-CC: &quot;%{Cache-Control}&lt;h&quot; REP-EXP: &quot;%{Expires}&lt;h&quot; VARY: &quot;%{Vary}&lt;h&quot; %&gt;eui
access_log daemon:/var/log/squid/access.log cache_headers

Try to see how the requests for these looks like in the logs.

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>


-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Omid Kosari
Sent: Wednesday, August 17, 2016 4:44 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [squid-users] Yet another store_id question HIT MISS

Why following link is HIT

X-Cache:&quot;HIT from cache1&quot;
X-Cache-Lookup:&quot;HIT from cache1:3128&quot;


<A HREF="http://igcdn-photos-c-a.akamaihd.net/hphotos-ak-xaf1/t51.2885-15/s150x150/e35/13649137_1547514802224163_950421795_n.jpg">http://igcdn-photos-c-a.akamaihd.net/hphotos-ak-xaf1/t51.2885-15/s150x150/e35/13649137_1547514802224163_950421795_n.jpg</A>

but this one is MISS

<A HREF="http://igcdn-photos-a-a.akamaihd.net/hphotos-ak-xaf1/t51.2885-15/s150x150/e35/13649137_1547514802224163_950421795_n.jpg">http://igcdn-photos-a-a.akamaihd.net/hphotos-ak-xaf1/t51.2885-15/s150x150/e35/13649137_1547514802224163_950421795_n.jpg</A>



store_id_program &quot;/usr/lib/squid/storeid_file_rewrite&quot;
&quot;/etc/squid/storeid_db&quot;
store_id_children 50 startup=10 idle=5 concurrency=50
acl storeiddomainregex dstdom_regex
^igcdn(\-photos|\-videos)[a-z0-9\-]{0,9}\.akamaihd\.net$
store_id_access allow storeiddomainregex
store_id_access deny all
refresh_pattern -i ^http:\/\/[a-zA-Z0-9\-\_\.]+\.squid\.internal\/.* 10080
95% 86400  override-lastmod override-expire reload-into-ims ignore-reload
ignore-must-revalidate ignore-no-store ignore-private  

storeid_db content

^http:\/\/igcdn-.*\.akamaihd\.net/hphotos-ak-.*/(t5.*?)(?:\?|$)
<A HREF="http://instagramcdn.squid.internal/$1">http://instagramcdn.squid.internal/$1</A>


<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at cache</A>:~# echo
'<A HREF="http://igcdn-photos-c-a.akamaihd.net/hphotos-ak-xaf1/t51.2885-15/s150x150/e35/13649137_1547514802224163_950421795_n.jpg">http://igcdn-photos-c-a.akamaihd.net/hphotos-ak-xaf1/t51.2885-15/s150x150/e35/13649137_1547514802224163_950421795_n.jpg</A>'
|<i> /usr/lib/squid/storeid_file_rewrite /etc/squid/storeid_db
</I>OK
store-id=<A HREF="http://instagramcdn.squid.internal/t51.2885-15/s150x150/e35/13649137_1547514802224163_950421795_n.jpg">http://instagramcdn.squid.internal/t51.2885-15/s150x150/e35/13649137_1547514802224163_950421795_n.jpg</A>
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at cache</A>:~# echo
'<A HREF="http://igcdn-photos-a-a.akamaihd.net/hphotos-ak-xaf1/t51.2885-15/s150x150/e35/13649137_1547514802224163_950421795_n.jpg">http://igcdn-photos-a-a.akamaihd.net/hphotos-ak-xaf1/t51.2885-15/s150x150/e35/13649137_1547514802224163_950421795_n.jpg</A>'
|<i> /usr/lib/squid/storeid_file_rewrite /etc/squid/storeid_db
</I>OK
store-id=<A HREF="http://instagramcdn.squid.internal/t51.2885-15/s150x150/e35/13649137_1547514802224163_950421795_n.jpg">http://instagramcdn.squid.internal/t51.2885-15/s150x150/e35/13649137_1547514802224163_950421795_n.jpg</A>



StoreId helper Statistics:
program: /usr/lib/squid/storeid_file_rewrite
number active: 10 of 50 (0 shutting down)
requests sent: 1755734
replies received: 1755734
queue length: 0
avg service time: 0 msec

Number of requests bypassed because all StoreId helpers were busy: 0





--
View this message in context: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Yet-another-store-id-question-HIT-MISS-tp4678972.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Yet-another-store-id-question-HIT-MISS-tp4678972.html</A>
Sent from the Squid - Users mailing list archive at Nabble.com.
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011998.html">[squid-users] Yet another store_id question HIT MISS
</A></li>
	<LI>Next message (by thread): <A HREF="012005.html">[squid-users] Yet another store_id question HIT MISS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12001">[ date ]</a>
              <a href="thread.html#12001">[ thread ]</a>
              <a href="subject.html#12001">[ subject ]</a>
              <a href="author.html#12001">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
