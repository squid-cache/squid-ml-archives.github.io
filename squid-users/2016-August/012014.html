<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Malformed HTTP on tproxy squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Malformed%20HTTP%20on%20tproxy%20squid&In-Reply-To=%3C34b9a680-f2cb-8709-e141-4041af19b39b%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012011.html">
   <LINK REL="Next"  HREF="012016.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Malformed HTTP on tproxy squid</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Malformed%20HTTP%20on%20tproxy%20squid&In-Reply-To=%3C34b9a680-f2cb-8709-e141-4041af19b39b%40measurement-factory.com%3E"
       TITLE="[squid-users] Malformed HTTP on tproxy squid">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Aug 17 16:07:20 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012011.html">[squid-users] Malformed HTTP on tproxy squid
</A></li>
        <LI>Next message (by thread): <A HREF="012016.html">[squid-users] Malformed HTTP on tproxy squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12014">[ date ]</a>
              <a href="thread.html#12014">[ thread ]</a>
              <a href="subject.html#12014">[ subject ]</a>
              <a href="author.html#12014">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 08/17/2016 09:02 AM, Amos Jeffries wrote:

&gt;<i> Your Squid is not even getting far enough to apply security rules to the
</I>&gt;<i> garbage traffic. It is basically just doing: accept() connection,
</I>&gt;<i> unmangle the NAT/TPROXY details, read(2) some bytes, try to parse - bam
</I>&gt;<i> generate and send error page, close the TCP connection and log the event.
</I>
*If* just a few clients doing the above can have a serious effect on
overall performance of a Squid instance running on decent hardware, then
we need to fix or optimize something. There is little Squid can do
against a powerful DDoS, but a few broken clients rarely mimic that.


&gt;<i> About the only thing you could do to speed it up is locate the error
</I>&gt;<i> page templates and remove their contents.
</I>
Also, *if* the clients do not open new connections until their old
connections are closed, then you may be able to slow them down
considerably by delaying those error responses. It may be possible to do
that with an external ACL helper (that delays responses) and
http_reply_access rules that target those specific error pages.


Disclaimer: I am not implying that the two conditions marked with &quot;*If*&quot;
above are true. I have not checked them.

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012011.html">[squid-users] Malformed HTTP on tproxy squid
</A></li>
	<LI>Next message (by thread): <A HREF="012016.html">[squid-users] Malformed HTTP on tproxy squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12014">[ date ]</a>
              <a href="thread.html#12014">[ thread ]</a>
              <a href="subject.html#12014">[ subject ]</a>
              <a href="author.html#12014">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
