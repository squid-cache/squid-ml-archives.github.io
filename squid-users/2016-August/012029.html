<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 2.7.s9 HTTPS-proxying - hint welcome
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%202.7.s9%20HTTPS-proxying%20-%20hint%20welcome&In-Reply-To=%3Cb000d16b-ae3f-4a91-9cc9-1a2fb4fb018e%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012023.html">
   <LINK REL="Next"  HREF="012056.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 2.7.s9 HTTPS-proxying - hint welcome</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%202.7.s9%20HTTPS-proxying%20-%20hint%20welcome&In-Reply-To=%3Cb000d16b-ae3f-4a91-9cc9-1a2fb4fb018e%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid 2.7.s9 HTTPS-proxying - hint welcome">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Aug 18 04:32:37 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012023.html">[squid-users] Squid 2.7.s9 HTTPS-proxying - hint welcome
</A></li>
        <LI>Next message (by thread): <A HREF="012056.html">[squid-users] Squid 2.7.s9 HTTPS-proxying - hint welcome
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12029">[ date ]</a>
              <a href="thread.html#12029">[ thread ]</a>
              <a href="subject.html#12029">[ subject ]</a>
              <a href="author.html#12029">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 18/08/2016 11:00 a.m., Torsten Kuehn wrote:
&gt;<i> Thank you for your quick reply!
</I>&gt;<i> 
</I>&gt;<i> On 17/08/2016 6:01 p.m., Amos Jeffries wrote:
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i> I am forced to stuck with 2.X
</I>&gt;&gt;<i> Then you cannot decrypt the HTTPS in order to cache it. Squid older than
</I>&gt;&gt;<i> 3.2 simply do not have any of the functionality to do so.
</I>&gt;<i> 
</I>&gt;<i> I.e. not cacheable at all?
</I>
Correct.

&gt;<i> May sound stupid but I imagine layouts where the
</I>&gt;<i> encrypted traffic itself gets stored and a client could re-use it later.
</I>
There is no way for Squid to know what is contained inside the
encryption. Therefore no way to know if a previous encrypted stream is
reusable. To squid it is just a random stream of opaque bytes.


&gt;<i> 
</I>&gt;&gt;<i> Cache is not an archive. Everything in a cache is by definition *not*
</I>&gt;&gt;<i> valuable and subject to be erased at any time.
</I>&gt;&gt;<i> [...] &quot;of personal value&quot; data is at high risk of being erased with
</I>&gt;&gt;<i> every request sent through that proxy
</I>&gt;<i> 
</I>&gt;<i> Archiving is a different matter, no question. But I prefer not to erase
</I>&gt;<i> objects from my cache, unless requested. My refresh_patterns etc. may look
</I>&gt;<i> horrible for administrators who try to provide most recent content:
</I>&gt;<i>     authenticate_ttl 359996400 seconds
</I>
Lookup &quot;credentials replay attack&quot;. Thats what this enables. There is no
other use for this directive than attacking your clients. We have
dropped it in Squid-3.

Use the &quot;auth_param ... credentialsttl&quot; to extend credentials lifespan.
It is still not good to have large values there, but way better than the
global TTL feature.


&gt;<i>     hierarchy_stoplist cgi-bin
</I>&gt;<i>     maximum_object_size 1073741824 bytes
</I>&gt;<i>     refresh_pattern -i /cgi-bin/ 5258880 100% 5258880
</I>
Please use the pattern settings:  &quot;-i (/cgi-bin/|\?) 0 0% 0&quot;

This pattern is designed to work around an issue with truly ancient CGI
scripts that are so old or broken that they do not produce any
cache-control headers. Such scripts are guaranteed to be dynamically
changing but being so old /broken they are incapable of telling the
proxy what their outputs expiry should be. Thus we need to use 0's to be
sure its accurate.

NP: this does not affect ASP or PHP type dynamic CGI scripts used in
modern sites. These languages are new enough that the scripting engines
automatically add appropriate cache-controls and the 0 values do not get
used on their outputs.


&gt;<i>     refresh_pattern (Release|Packages(.gz)*)$ 0 20% 2880
</I>&gt;<i>     refresh_pattern . 5258880 100% 5258880
</I>&gt;<i>         override-expire override-lastmod ignore-no-cache ignore-private
</I>&gt;<i>     positive_dns_ttl 359996400 seconds
</I>
Meaning whenever any domain name moves hosting service you get cutoff
from it completely for ~11 years or until you fully restart Squid.

When you go to Squid-3, removing both these DNS settings entirely would
be best. But if you really insist on caching the DNS positive results
for a long time ~48hrs should work just as well and be much safer as well.


&gt;<i>     negative_dns_ttl 60 seconds
</I>&gt;<i>     vary_ignore_expire on
</I>&gt;<i>     reload_into_ims on
</I>&gt;<i> 
</I>&gt;<i> This setup is that robust that both force-reload
</I>
This is done solely by &quot;override-expire&quot;. The rest of your config is
unrelated. Even the &quot;reload_into_ims&quot; does nothing because Squid is
explicitly ignoring the max-age=0 value, aka. 'force reload'.


&gt;<i> and PURGE fail unless
</I>
In Squid-2 this is more efficiently done by:
 acl PURGE method PURGE
 http_access deny PURGE

Squid-3 does that automatically by default and even disables all the
PURGE functionality *unless* you have &quot;PURGE&quot; method in an ACL like
above. It is a good idea for performance reasons to remove all mention
of &quot;PURGE&quot; when upgrading to Squid-3.


&gt;<i> objects are deleted manually (resulting in &quot;truncate: Warning: DosOpen
</I>&gt;<i> Error 110, OPEN_FAILED, file ...&quot;) or the ugly &quot;reload_into_ims on&quot; option
</I>&gt;<i> is set which violates standards.
</I>
reload_into_ims is not a violation of current HTTP/1.1 standards. It is
simply undefined behaviour - therefore a bit risky.

The big(est) problem with it is that Squid-2 is HTTP/1.0 software and
both reload and IMS revalidation are not defined in that version of the
protocol. Adding two risky undefined things together multiplies the
dangers. The risk being that the server or client is not properly doing
the revalidate actions in HTTP/1.0 messaging.



Overall the approach to caching *at any cost* is doing more harm than
good, both to yourself and to many others. I have seen far worse
configurations though.

The only really terrible things you are doing is the authenticate_ttl
and positive_dns_ttl values. They are not relevant to the HTTP caching
behaviour and are doing a huge amount of harm to you.


Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012023.html">[squid-users] Squid 2.7.s9 HTTPS-proxying - hint welcome
</A></li>
	<LI>Next message (by thread): <A HREF="012056.html">[squid-users] Squid 2.7.s9 HTTPS-proxying - hint welcome
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12029">[ date ]</a>
              <a href="thread.html#12029">[ thread ]</a>
              <a href="subject.html#12029">[ subject ]</a>
              <a href="author.html#12029">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
