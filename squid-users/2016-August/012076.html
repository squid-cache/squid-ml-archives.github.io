<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 2.7.s9 HTTPS-proxying - hint welcome
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%202.7.s9%20HTTPS-proxying%20-%20hint%20welcome&In-Reply-To=%3Ccc5f8760-989f-0dd9-460d-58f179a34d32%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012056.html">
   <LINK REL="Next"  HREF="012018.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 2.7.s9 HTTPS-proxying - hint welcome</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%202.7.s9%20HTTPS-proxying%20-%20hint%20welcome&In-Reply-To=%3Ccc5f8760-989f-0dd9-460d-58f179a34d32%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid 2.7.s9 HTTPS-proxying - hint welcome">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Aug 20 10:12:21 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012056.html">[squid-users] Squid 2.7.s9 HTTPS-proxying - hint welcome
</A></li>
        <LI>Next message (by thread): <A HREF="012018.html">[squid-users] stop caching completely on squid 3.5.2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12076">[ date ]</a>
              <a href="thread.html#12076">[ thread ]</a>
              <a href="subject.html#12076">[ subject ]</a>
              <a href="author.html#12076">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 19/08/2016 10:42 p.m., Torsten Kuehn wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> On 18/08/2016 6:32 a.m., Amos Jeffries wrote:
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i> I imagine layouts where the encrypted traffic itself gets stored
</I>&gt;&gt;<i> no way for Squid to know if a previous encrypted stream is reusable.
</I>&gt;&gt;<i> To squid it is just a random stream of opaque bytes.
</I>&gt;<i> 
</I>&gt;<i> Enlightening! The idea was that omitting decryption but instead providing
</I>&gt;<i> measures to do so from the client's side had less concerns wrt privacy.
</I>&gt;<i> As I see, with a mere &quot;stream of opaque bytes&quot;, any &quot;handle&quot; to provide
</I>&gt;<i> such measures is missing. Thus, if caching of SSL-encrypted data is wished,
</I>&gt;<i> decryption is mandatory.
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i> I.e. [HTTPS] not cacheable at all [in 2.7.s9]?
</I>&gt;&gt;<i> Correct.
</I>&gt;<i> 
</I>&gt;<i> Asking months earlier here would have saved me painful failures ...
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i> I prefer not to erase objects [...] My [TAGs] may look horrible
</I>&gt;&gt;&gt;<i>     authenticate_ttl 359996400 seconds
</I>&gt;&gt;<i> Lookup &quot;credentials replay attack&quot;. [...] There is no other use for
</I>&gt;&gt;<i> this directive than attacking your clients.
</I>&gt;<i> 
</I>&gt;<i> Uugh! Was set in april 2012, by error (without effect in 2.5.s8_OS2_VAC,
</I>&gt;<i> thus
</I>&gt;<i> it didn't harm): the idea was to turn off Squid's garbage collection, in
</I>&gt;<i> order
</I>&gt;<i> to avoid wearing out flash memory. Wrong place, and I ignored credentials
</I>&gt;<i> ...
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i>     hierarchy_stoplist cgi-bin
</I>&gt;&gt;&gt;<i>     refresh_pattern -i /cgi-bin/ 5258880 100% 5258880
</I>&gt;&gt;<i> Please use the pattern settings:  &quot;-i (/cgi-bin/|\?) 0 0% 0&quot;
</I>&gt;&gt;<i> This pattern is designed to work around an issue with truly ancient CGI
</I>&gt;&gt;<i> scripts [...] Such scripts are guaranteed to be dynamically changing [...]
</I>&gt;<i> 
</I>&gt;<i> The idea comes from <A HREF="http://twiki.cern.ch/twiki/bin/view/CMS/MyOwnSquid">http://twiki.cern.ch/twiki/bin/view/CMS/MyOwnSquid</A> ,
</I>&gt;<i> to get dynamic web pages cached. I am glad that Squid finally does so!
</I>&gt;<i> Conflicting concepts, as it seems. Or, is there any RegEx which does the
</I>&gt;<i> old CGI script-workaround but still caches content with &quot;?&quot; in URLs?
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i>     refresh_pattern . 5258880 100% 5258880
</I>&gt;&gt;&gt;<i>         override-expire override-lastmod ignore-no-cache ignore-private
</I>&gt;&gt;&gt;<i>     positive_dns_ttl 359996400 seconds
</I>&gt;&gt;<i> Meaning whenever any domain name moves hosting service you get cutoff
</I>&gt;&gt;<i> from it completely for ~11 years or until you fully restart Squid.
</I>&gt;<i> 
</I>&gt;<i> Yes, I noticed this :-) (Used to reconfigure Squid from CacheMgr in these
</I>&gt;<i> cases). Came from Sjoerd Visser's dutch page on Squid 1.1, to work around
</I>&gt;<i> it's missing offline_mode TAG (just kept positive_dns_ttl afterwards):
</I>&gt;<i> <A HREF="http://vissesh.home.xs4all.nl/multiboot/firewall/squid.html">http://vissesh.home.xs4all.nl/multiboot/firewall/squid.html</A>
</I>&gt;<i> 
</I>
Well, that tags available now. :-). Though it does not do much now since
HTTP/1.1 caching brings most of what it used to do but in a standardised
way.

&gt;&gt;<i> When you go to Squid-3, removing both these DNS settings entirely would
</I>&gt;&gt;<i> be best. [...] if you really insist [...] ~48hrs should work just as well
</I>&gt;<i> 
</I>&gt;<i> Truely. When I set up 2.5.s8_OS2_VAC six years ago, I just added a few new
</I>&gt;<i> TAGs to my old 1.1 config. Only this summer, I spent a couple of days to
</I>&gt;<i> migrate previous settings into the new order of a fresh 2.7.s9's config (for
</I>&gt;<i> better comparison), now comprising a history of all available OS/2 builds
</I>&gt;<i> (introduction/ disappearance of features etc.). To be re-done with 3.5.
</I>
Hmm. Run &quot;squid -k parse&quot; and you should get notices about chnaged or
removed config options. You should do so before/during any big version
jump anyway.

&gt;<i> 
</I>&gt;&gt;&gt;<i> setup is that robust that force-reload [fails unless objects deleted]
</I>&gt;&gt;<i> This is done solely by &quot;override-expire&quot;.
</I>&gt;<i> 
</I>&gt;<i> Perfect. I'm far from knowing config TAGs by heart and thus don't see how
</I>&gt;<i> things play together. Enabling &quot;overide-expire&quot; in 2012 was a bad thing.
</I>&gt;<i> 
</I>
Yeah. Times change. The new RFCs now tell us Expires header is to be
followed unless other (max-age) values are available, so its sort of
optional in todays traffic. Ignoring it is still a violation, but not
much risk.


&gt;&gt;&gt;<i> [setup that robust that] PURGE fails unless [objects deleted manually]
</I>&gt;&gt;<i> In Squid-2 this is more efficiently done by:
</I>&gt;&gt;<i>   acl PURGE method PURGE
</I>&gt;&gt;<i>   http_access deny PURGE
</I>&gt;<i> 
</I>&gt;<i> Recently enabled (as well as CacheMgr-access) by setting
</I>&gt;<i>     acl localnet src 192.168.0.160/27
</I>&gt;<i>     [...]
</I>&gt;<i>     acl purge method PURGE
</I>&gt;<i>     http_access allow purge localnet
</I>&gt;<i>     http_access allow purge localhost
</I>&gt;<i>     http_access deny purge
</I>&gt;<i> 
</I>&gt;&gt;<i> Squid-3 [...] disables all the PURGE functionality *unless* you have
</I>&gt;&gt;<i> &quot;PURGE&quot; method in an ACL like above. It is a good idea for performance
</I>&gt;&gt;<i> reasons to remove all mention of &quot;PURGE&quot; when upgrading to Squid-3.
</I>&gt;<i> 
</I>&gt;<i> Permitting PURGE has a performance impact? I enabled it recently, but
</I>&gt;<i> since reload works now, it could be suppressed.
</I>
A little bit. Squid has to track cached objects with an index ID that
PURGE can use (normal one is tied to GET), so wastes a bit of memory and
CPU time calculating it.

 HTCP protocol CLR messages work better than PURGE, especially when
using a group/hierarchy of caches.

&gt;<i> 
</I>&gt;&gt;&gt;<i> [force-reload fails unless] the ugly &quot;reload_into_ims on&quot; option
</I>&gt;&gt;&gt;<i> is set which violates standards.
</I>&gt;&gt;<i> reload_into_ims is not a violation of current HTTP/1.1 standards. [...]
</I>&gt;&gt;<i> The big(est) problem with it is that Squid-2 is HTTP/1.0 software and
</I>&gt;&gt;<i> both reload and IMS revalidation are not defined in that version of the
</I>&gt;&gt;<i> protocol. Adding two risky undefined things together multiplies dangers.
</I>&gt;&gt;<i> [...] Overall the approach to caching *at any cost* is doing more harm
</I>&gt;&gt;<i> than good, both to yourself and to many others.
</I>&gt;<i> 
</I>&gt;<i> Disquieting. In fact, I tried to change Squid's default caching behaviour
</I>&gt;<i> to &quot;accumulating&quot; content (&quot;once here, why to reload redundant stuff?&quot;).
</I>&gt;<i> The second, important intention behind this is not to wear out the flash
</I>&gt;<i> memory where Squid runs on. Data is backed up regularily, but I'm afraid
</I>&gt;<i> of, e.g., the regular revalidation processes's write accesses. (A friend
</I>&gt;<i> lost a solid state disk with a Squid cache after only six months.)
</I>&gt;<i> 
</I>
Nod. My customers experiences with SSD, and talk with other list members
here, has been similar. The older Squid pass all objects through the
cache_dir so the disk gets a lot more write activity than you would
expect. That has been improved with recent releases, but is not yet
fully solved.

You need to go for SSD with very high advertised write/rewrite counts,
and you can expect/budget for the operating lifetime under Squid to be
1/2 or even 1/3 what the manufacturer advertise. Not due to any fault of
theirs, Squid just thrashes hardware in ways SSD are not designed for.

FYI; ufs/aufs/diskd cache_dir do not update the on-disk copy of objects
when revalidating - just the in-memory objects or rock cache types do
that. For most that is a bug (#7 if interested) for you it may be a
bonus :-)

Cheers
Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012056.html">[squid-users] Squid 2.7.s9 HTTPS-proxying - hint welcome
</A></li>
	<LI>Next message (by thread): <A HREF="012018.html">[squid-users] stop caching completely on squid 3.5.2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12076">[ date ]</a>
              <a href="thread.html#12076">[ thread ]</a>
              <a href="subject.html#12076">[ subject ]</a>
              <a href="author.html#12076">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
