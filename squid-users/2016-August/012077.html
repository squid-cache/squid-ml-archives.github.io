<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ssl-bump / https traffic not cacheing
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ssl-bump%20/%20https%20traffic%20not%20cacheing&In-Reply-To=%3C8f255f2a-331a-8615-d05e-73d4e26832c0%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012072.html">
   <LINK REL="Next"  HREF="012081.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ssl-bump / https traffic not cacheing</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ssl-bump%20/%20https%20traffic%20not%20cacheing&In-Reply-To=%3C8f255f2a-331a-8615-d05e-73d4e26832c0%40treenet.co.nz%3E"
       TITLE="[squid-users] ssl-bump / https traffic not cacheing">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Aug 20 10:31:02 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012072.html">[squid-users] ssl-bump / https traffic not cacheing
</A></li>
        <LI>Next message (by thread): <A HREF="012081.html">[squid-users] Squid Samba 4 and ntlm_auth concurrency question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12077">[ date ]</a>
              <a href="thread.html#12077">[ thread ]</a>
              <a href="subject.html#12077">[ subject ]</a>
              <a href="author.html#12077">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 20/08/2016 2:56 p.m., JR Dalrymple wrote:
&gt;<i> I'm sure I'm missing something stupid, but https traffic just isn't
</I>&gt;<i> caching. I really want to cache https alongside http as this project is for
</I>&gt;<i> a customer who lives in the sticks and pays dearly for every byte.
</I>&gt;<i> 
</I>&gt;<i> 1471660884.894  11402 172.22.19.48 TCP_MISS/200 746898 GET
</I>&gt;<i> <A HREF="https://www.jrssite.com/newfi/fullsizes/081916214031.jpg">https://www.jrssite.com/newfi/fullsizes/081916214031.jpg</A> - ORIGINAL_DST/
</I>&gt;<i> 23.30.254.3 image/jpeg
</I>&gt;<i> 1471660967.389  14392 172.22.22.68 TCP_MISS/200 746898 GET
</I>&gt;<i> <A HREF="https://www.jrssite.com/newfi/fullsizes/081916214031.jpg">https://www.jrssite.com/newfi/fullsizes/081916214031.jpg</A> - ORIGINAL_DST/
</I>&gt;<i> 23.30.254.3 image/jpeg
</I>&gt;<i> 1471661329.884  33506 172.22.22.68 TCP_MISS/200 746898 GET
</I>&gt;<i> <A HREF="http://www.jrssite.com/newfi/fullsizes/081916214031.jpg">http://www.jrssite.com/newfi/fullsizes/081916214031.jpg</A> - ORIGINAL_DST/
</I>&gt;<i> 23.30.254.3 image/jpeg
</I>&gt;<i> 1471661385.282    402 172.22.19.48 TCP_HIT/200 746906 GET
</I>&gt;<i> <A HREF="http://www.jrssite.com/newfi/fullsizes/081916214031.jpg">http://www.jrssite.com/newfi/fullsizes/081916214031.jpg</A> - HIER_NONE/-
</I>&gt;<i> image/jpeg
</I>&gt;<i> 
</I>&gt;<i> # grep -i ssl /usr/local/squid/etc/squid.conf
</I>&gt;<i> acl SSL_ports port 443
</I>&gt;<i> # Deny CONNECT to other than secure SSL ports
</I>&gt;<i> http_access deny CONNECT !SSL_ports
</I>&gt;<i> ssl_bump stare all
</I>&gt;<i> ssl_bump bump all
</I>&gt;<i> https_port 127.0.0.1:3129 intercept ssl-bump generate-host-certificates=on
</I>&gt;<i> dynamic_cert_mem_cache_size=4MB cert=/usr/local/squid/etc/ssl/CACert.pem
</I>&gt;<i> sslcrtd_program /usr/local/squid/libexec/ssl_crtd -s
</I>&gt;<i> /usr/local/squid/var/lib/ssl_db -M 4MB
</I>&gt;<i> sslcrtd_children 10
</I>&gt;<i> 
</I>&gt;<i> Happy to provide any other information someone else might find useful. I'm
</I>&gt;<i> sure that there is just some point of ignorance on my part. This is indeed
</I>&gt;<i> all very new to me.
</I>

ORIGINAL_DST is a hint that these requests may have failed to pass
Squid's Host verfication tests. If Squid is unable to verify that the
server providing the data is actually the correct origin/authority for
that data then we relay to the client expicitly requesting that server
be used - but do not cache to avoid corrupting/infecting other clients.

Alternatively, there could be some cache controls or Vary header
involved that cause the particular reponses.
 (I went to check that myself, but it says login is required. You can
use the redbot.org tool to see the caching status if you have a working
login).

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012072.html">[squid-users] ssl-bump / https traffic not cacheing
</A></li>
	<LI>Next message (by thread): <A HREF="012081.html">[squid-users] Squid Samba 4 and ntlm_auth concurrency question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12077">[ date ]</a>
              <a href="thread.html#12077">[ thread ]</a>
              <a href="subject.html#12077">[ subject ]</a>
              <a href="author.html#12077">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
