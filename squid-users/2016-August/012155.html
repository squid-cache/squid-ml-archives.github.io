<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Https_port with &quot;official&quot; certificate
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Https_port%20with%20%22official%22%20certificate&In-Reply-To=%3CCAD8MJvB3_0K-0bJET%2B%2B8-kW%3DYGHCCHHc1YEHK%2BnobVehRe0d9Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012154.html">
   <LINK REL="Next"  HREF="012165.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Https_port with &quot;official&quot; certificate</H1>
    <B>Diogenes S. Jesus</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Https_port%20with%20%22official%22%20certificate&In-Reply-To=%3CCAD8MJvB3_0K-0bJET%2B%2B8-kW%3DYGHCCHHc1YEHK%2BnobVehRe0d9Q%40mail.gmail.com%3E"
       TITLE="[squid-users] Https_port with &quot;official&quot; certificate">splash at gmail.com
       </A><BR>
    <I>Wed Aug 24 14:39:51 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012154.html">[squid-users] Https_port with &quot;official&quot; certificate
</A></li>
        <LI>Next message (by thread): <A HREF="012165.html">[squid-users] Https_port with &quot;official&quot; certificate
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12155">[ date ]</a>
              <a href="thread.html#12155">[ thread ]</a>
              <a href="subject.html#12155">[ subject ]</a>
              <a href="author.html#12155">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Oh, an a tiny little detail :)

# squid -v

Squid Cache: Version 4.0.13

Service Name: squid

configure options:  '--with-openssl' '--prefix=/usr' '--localstatedir=/var'
'--libexecdir=/lib/squid' '--datadir=/share/squid'
'--sysconfdir=/etc/squid' '--with-default-user=proxy'
'--with-logdir=/var/log/squid' '--with-pidfile=/var/run/squid.pid'


On Wed, Aug 24, 2016 at 4:37 PM, Diogenes S. Jesus &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">splash at gmail.com</A>&gt; wrote:

&gt;<i> This configuration here covers the use case described by the OP:
</I>&gt;<i> <A HREF="https://gist.githubusercontent.com/splashx/758ff0c59ea291f32edafc516fdaad">https://gist.githubusercontent.com/splashx/758ff0c59ea291f32edafc516fdaad</A>
</I>&gt;<i> 73/raw/8050fa054821657812961050332b38a56e7e3e68/
</I>&gt;<i>
</I>&gt;<i> If everything works well, you'll notice you won't support HTTP proxy at
</I>&gt;<i> all, but users can reach  both HTTP and HTTPS target websites via your
</I>&gt;<i> HTTPS proxy.
</I>&gt;<i>
</I>&gt;<i> # netstat -nltp
</I>&gt;<i>
</I>&gt;<i> Active Internet connections (only servers)
</I>&gt;<i>
</I>&gt;<i> Proto Recv-Q Send-Q Local Address           Foreign Address         State
</I>&gt;<i>       PID/Program name
</I>&gt;<i>
</I>&gt;<i> tcp        0      0 0.0.0.0:22              0.0.0.0:*
</I>&gt;<i> LISTEN      32109/sshd
</I>&gt;<i>
</I>&gt;<i> tcp6       0      0 :::80                   :::*
</I>&gt;<i> LISTEN      26627/apache2
</I>&gt;<i>
</I>&gt;<i> tcp6       0      0 :::3443                 :::*
</I>&gt;<i> LISTEN      7303/(squid-1)
</I>&gt;<i>
</I>&gt;<i> tcp6       0      0 :::22                   :::*
</I>&gt;<i> LISTEN      32109/sshd
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The user connects to the proxy ONLY via HTTPS Proxy on port 3443
</I>&gt;<i>
</I>&gt;<i> All traffic between the OP and the proxy is encrypted using TLS.
</I>&gt;<i> A) If the user enters <A HREF="http://target.example.com,">http://target.example.com,</A> between the proxy and
</I>&gt;<i> the target you'll see HTTP.
</I>&gt;<i> B) If the user enters <A HREF="https://target.example.com,">https://target.example.com,</A> between the proxy and
</I>&gt;<i> the target you'll see HTTPS.
</I>&gt;<i>
</I>&gt;<i> If you sniff the traffic between the client and the proxy, you'll see TLS.
</I>&gt;<i>
</I>&gt;<i> Tested with:
</I>&gt;<i>
</I>&gt;<i> $ /Applications/Firefox\ 2.app/Contents/MacOS/firefox -v
</I>&gt;<i>
</I>&gt;<i> Mozilla Firefox 48.0
</I>&gt;<i>
</I>&gt;<i> Firefox set up to use PAC: Preferences &gt; Advanced &gt; Network &gt; Settings:
</I>&gt;<i> &quot;Automatic Proxy Configuration&quot;: <A HREF="http://squid.example.com/proxy.pac">http://squid.example.com/proxy.pac</A>
</I>&gt;<i>
</I>&gt;<i> The downside here of course is the limited amount of clients supporting
</I>&gt;<i> HTTPS Proxy settings.
</I>&gt;<i>
</I>&gt;<i> Dio
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Wed, Aug 24, 2016 at 3:46 PM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Just to rewind this conversation to the actual problem ...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 24/08/2016 11:42 p.m., Samuraiii wrote:
</I>&gt;&gt;<i> &gt; On 24.8.2016 13:18, Antony Stone wrote:
</I>&gt;&gt;<i> &gt;&gt; Unfortunately it's not Squid that's the challenge - it's the browser.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; If you're using Firefox and/or Chrome, you should be okay.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; See &quot;Encrypted browser-Squid connection&quot; at the bottom of
</I>&gt;&gt;<i> &gt;&gt; <A HREF="http://wiki.squid-cache.org/Features/HTTPS">http://wiki.squid-cache.org/Features/HTTPS</A>
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; Antony.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt; I have seen that, it is the cause of my subscription to this list.
</I>&gt;&gt;<i> &gt; I haven't been able to find any usable hints.
</I>&gt;&gt;<i> &gt; My config attempt fails
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &lt;snip&gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; https_port 8443 \
</I>&gt;&gt;<i> &gt;     cert=/etc/letsencrypt/live/sklad.duckdns.org/cert.pem \
</I>&gt;&gt;<i> &gt;     key=/etc/letsencrypt/live/sklad.duckdns.org/key.pem \
</I>&gt;&gt;<i> &gt;     cleintca=/etc/letsencrypt/live/sklad.duckdns.org/fullchain.pem \
</I>&gt;&gt;<i> &gt;     tls-dh=/etc/ssl/certs/dhparam.pem \
</I>&gt;&gt;<i> &gt;     sslproxy_options=NO_SSLv2,NO_SSLv3,SINGLE_DH_USE \
</I>&gt;&gt;<i> &gt;     cipher=HIGH
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> As Dio mentioned the cleintca= (or rather clientca=) is for
</I>&gt;&gt;<i> authenticating clients ceritficates. Don't use that unless you are
</I>&gt;&gt;<i> requiring client certs in TLS.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The rest of your config looks reasonable to me. I suspect you have found
</I>&gt;&gt;<i> a bug introduced during all the SSL-Bump code changes. Please make a
</I>&gt;&gt;<i> bugzilla report and include your exact Squid version (found with the
</I>&gt;&gt;<i> 'squid -v' command), the https_port line(s) and the exact error message
</I>&gt;&gt;<i> produced on startup.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Amos
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i>
</I>&gt;<i> --------
</I>&gt;<i>
</I>&gt;<i> Diogenes S. de Jesus
</I>&gt;<i>
</I>


-- 

--------

Diogenes S. de Jesus
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160824/a98c0fb5/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160824/a98c0fb5/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012154.html">[squid-users] Https_port with &quot;official&quot; certificate
</A></li>
	<LI>Next message (by thread): <A HREF="012165.html">[squid-users] Https_port with &quot;official&quot; certificate
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12155">[ date ]</a>
              <a href="thread.html#12155">[ thread ]</a>
              <a href="subject.html#12155">[ subject ]</a>
              <a href="author.html#12155">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
