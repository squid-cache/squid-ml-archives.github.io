<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TCP_RESET non http requests on port 80
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_RESET%20non%20http%20requests%20on%20port%2080&In-Reply-To=%3C3baf0e15-0dbb-8a7c-ceee-06d7d08a3b3e%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012160.html">
   <LINK REL="Next"  HREF="012205.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TCP_RESET non http requests on port 80</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_RESET%20non%20http%20requests%20on%20port%2080&In-Reply-To=%3C3baf0e15-0dbb-8a7c-ceee-06d7d08a3b3e%40measurement-factory.com%3E"
       TITLE="[squid-users] TCP_RESET non http requests on port 80">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Aug 24 19:43:18 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012160.html">[squid-users] TCP_RESET non http requests on port 80
</A></li>
        <LI>Next message (by thread): <A HREF="012205.html">[squid-users] TCP_RESET non http requests on port 80
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12161">[ date ]</a>
              <a href="thread.html#12161">[ thread ]</a>
              <a href="subject.html#12161">[ subject ]</a>
              <a href="author.html#12161">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 08/24/2016 12:24 PM, Omid Kosari wrote:
&gt;<i> Alex Rousskov wrote
</I>&gt;&gt;<i> Thus, the existing implementation should cover non-HTTP
</I>&gt;&gt;<i> requests on port 80 (or 3128). If it does not, it is a bug. We should
</I>&gt;&gt;<i> polish the documentation to make this clear.
</I>

&gt;<i> The problem is not squid itself . The problem is in some situations for
</I>&gt;<i> example DOS(with malformed requests) , infected clients sends lots of
</I>&gt;<i> requests to target server . The requests goes through squid tproxy so squid
</I>&gt;<i> will send back about 250 byte in reply to each request .
</I>&gt;<i> 
</I>&gt;<i> So i am looking for a way to just send tcp reset and not that 250 bytes .
</I>

What you said is orthogonal to what I said. There are two parts of the
problem you are trying to solve:

1. Detect a non-HTTP request on port 80.
2. Reset the client connection when #1 happens.

The existing on_unsupported_protocol directive already supports #1 --
bugs notwithstanding, it can be used to generate an error response when
you want. It is also the default behavior.

Once that error response is generated, you want to convert it into a TCP
reset by denying that response _and_ using a matching &quot;deny_info
TCP_RESET&quot;. That is part #2. I do not know why deny_info does not work
in your tests.


N.B. Since resetting non-HTTP connections is a common need, it may be
tempting to add a &quot;terminate&quot; action to the on_unsupported_protocol list
of supported actions. However, I am not sure that is a good idea because
resetting a connection is a common need in many contexts. Deny_info may
be a better (more general) solution.


HTH,

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012160.html">[squid-users] TCP_RESET non http requests on port 80
</A></li>
	<LI>Next message (by thread): <A HREF="012205.html">[squid-users] TCP_RESET non http requests on port 80
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12161">[ date ]</a>
              <a href="thread.html#12161">[ thread ]</a>
              <a href="subject.html#12161">[ subject ]</a>
              <a href="author.html#12161">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
