<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Trouble negotiate_kerberos_auth
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Trouble%20negotiate_kerberos_auth&In-Reply-To=%3CCA%2B0TdyqEAt4L5KO4zrJNJ1aUe64mY2Re7z95KFdqW7Y8SV_qbg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012256.html">
   <LINK REL="Next"  HREF="012228.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Trouble negotiate_kerberos_auth</H1>
    <B>Marcio Demetrio Bacci</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Trouble%20negotiate_kerberos_auth&In-Reply-To=%3CCA%2B0TdyqEAt4L5KO4zrJNJ1aUe64mY2Re7z95KFdqW7Y8SV_qbg%40mail.gmail.com%3E"
       TITLE="[squid-users] Trouble negotiate_kerberos_auth">marciobacci at gmail.com
       </A><BR>
    <I>Sat Aug 27 16:32:20 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012256.html">[squid-users] Shared Caching with Authorization
</A></li>
        <LI>Next message (by thread): <A HREF="012228.html">[squid-users] Trouble negotiate_kerberos_auth
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12213">[ date ]</a>
              <a href="thread.html#12213">[ thread ]</a>
              <a href="subject.html#12213">[ subject ]</a>
              <a href="author.html#12213">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have trouble to authenticate Squid3 with kerberos in Samba4 domain. I'm
using CentOS 7 and Squid 3.3.8 (yum install squid)

When I type the bellow command in terminal:
/usr/lib64/squid/negotiate_kerberos_auth -d -i -s HTTP/
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
john <A HREF="https://lists.squid-cache.org/listinfo/squid-users">xyz at 12345</A>

I have the following error:
negotiate_kerberos_auth.cc(315): pid=6364 :2016/08/27 10:44:33|
negotiate_kerberos_auth: DEBUG: Got 'john <A HREF="https://lists.squid-cache.org/listinfo/squid-users">xyz at 12345</A>' from squid (length:
14).
negotiate_kerberos_auth.cc(362): pid=6364 :2016/08/27 10:44:33|
negotiate_kerberos_auth: ERROR: Invalid request [john <A HREF="https://lists.squid-cache.org/listinfo/squid-users">xyz at 12345</A>]
BH invalid request


Here are my files configuration:

/etc/krb5.conf
[libdefaults]
    default_realm = CMS.ENSINO.BR
[realms]
    CMS.ENSINO.BR = {
    kdc = dc1.cms.ensino.br:88
    admin_server = dc1.cms.ensino.br
    default_domain = CMS.ENSINO.BR
    }
[domain_realm]
    .cms.ensino.br = CMS.ENSINO.BR
    cms.ensino.br = CMS.ENSINO.BR



Keytab name: FILE:/etc/krb5.keytab
KVNO Principal
----
--------------------------------------------------------------------------
   1 proxy-k$@CMS.ENSINO.BR
   1 proxy-k$@CMS.ENSINO.BR
   1 proxy-k$@CMS.ENSINO.BR
   1 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
   1 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
   1 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
   1 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
   1 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
   1 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
   1 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
   1 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
   1 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">PROXY at CMS.ENSINO.BR</A>
   1 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">PROXY at CMS.ENSINO.BR</A>
   1 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">PROXY at CMS.ENSINO.BR</A>
   1 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">PROXY at CMS.ENSINO.BR</A>
   1 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">PROXY at CMS.ENSINO.BR</A>
   1 PROXY$@CMS.ENSINO.BR
   1 PROXY$@CMS.ENSINO.BR
   1 PROXY$@CMS.ENSINO.BR
   1 PROXY$@CMS.ENSINO.BR
   1 PROXY$@CMS.ENSINO.BR
   1 proxy-k$@CMS.ENSINO.BR
   1 proxy-k$@CMS.ENSINO.BR
   1 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
   1 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
   1 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">PROXY at CMS.ENSINO.BR</A>
   1 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">PROXY at CMS.ENSINO.BR</A>
   1 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">PROXY at CMS.ENSINO.BR</A>
   1 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">PROXY at CMS.ENSINO.BR</A>
   1 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">PROXY at CMS.ENSINO.BR</A>


Keytab name: FILE:/etc/squid/PROXY.keytab
KVNO Principal
----
--------------------------------------------------------------------------
   1 proxy-k$@CMS.ENSINO.BR
   1 proxy-k$@CMS.ENSINO.BR
   1 proxy-k$@CMS.ENSINO.BR
   1 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
   1 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
   1 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
   1 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
   1 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
   1 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>


/etc/sysconfig/squid
# default squid options
SQUID_OPTS=&quot;&quot;
# Time to wait for Squid to shut down when asked. Should not be necessary
# most of the time.
SQUID_SHUTDOWN_TIMEOUT=100
# default squid conf file
SQUID_CONF=&quot;/etc/squid/squid.conf&quot;

KRB5_KTNAME=/etc/squid/PROXY.keytab
export KRB5_KTNAME


kinit and klist commands are OK.

Best Regards,

M&#225;rcio
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160827/eff9813a/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160827/eff9813a/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012256.html">[squid-users] Shared Caching with Authorization
</A></li>
	<LI>Next message (by thread): <A HREF="012228.html">[squid-users] Trouble negotiate_kerberos_auth
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12213">[ date ]</a>
              <a href="thread.html#12213">[ thread ]</a>
              <a href="subject.html#12213">[ subject ]</a>
              <a href="author.html#12213">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
