<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid with random outgoing ip from pool of 1000	ips
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20with%20random%20outgoing%20ip%20from%20pool%20of%201000%0A%09ips&In-Reply-To=%3CD61E7137-EA75-4142-A2FC-25E10C5417BF%40netstream.ps%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012217.html">
   <LINK REL="Next"  HREF="012221.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid with random outgoing ip from pool of 1000	ips</H1>
    <B>--Ahmad--</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20with%20random%20outgoing%20ip%20from%20pool%20of%201000%0A%09ips&In-Reply-To=%3CD61E7137-EA75-4142-A2FC-25E10C5417BF%40netstream.ps%3E"
       TITLE="[squid-users] squid with random outgoing ip from pool of 1000	ips">ahmed.zaeem at netstream.ps
       </A><BR>
    <I>Sun Aug 28 08:04:27 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012217.html">[squid-users] squid with random outgoing ip from pool of 1000	ips
</A></li>
        <LI>Next message (by thread): <A HREF="012221.html">[squid-users] squid with random outgoing ip from pool of 1000	ips
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12219">[ date ]</a>
              <a href="thread.html#12219">[ thread ]</a>
              <a href="subject.html#12219">[ subject ]</a>
              <a href="author.html#12219">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>thanks for reply 

how about the length of the number?

1/1000 to which digits should i round ??

4 or 5 6 digits ?



AS AN EXAMPLE the 1/1000 probabilities will have the acls as below :


0.001 0.000999 0.000998001 0.000997002999 0.000996005996001


the question is how many digits should i round ?

will squid understand the long digits ?


cheers


&gt;<i> On Aug 28, 2016, at 2:38 AM, Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> On 08/27/2016 04:34 PM, --Ahmad-- wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> i guess i need to create probability 1/1000 for each ip.
</I>&gt;<i> 
</I>&gt;<i> Yes, but that is _not_ the same as 1/1000 probability for each
</I>&gt;<i> tcp_outgoing_address rule, unfortunately. tcp_outgoing_address rules are
</I>&gt;<i> evaluated top to bottom until the first matches. If you have N rules and
</I>&gt;<i> each rule has a 1/N probability of a match in isolation, then you will
</I>&gt;<i> get the following probabilities of a match when the rules are combined:
</I>&gt;<i> 
</I>&gt;<i>  rule #0: 1/N   -- good!
</I>&gt;<i>  rule #1: (1-1/N) * 1/N  -- which is not 1/N
</I>&gt;<i>  rule #2: (1-1/N) * (1-1/N) * 1/N  -- even less 1/N than rule #2 was
</I>&gt;<i>  rule #3: (1-1/N) * (1-1/N) * (1-1/N) * 1/N  -- and getting worse!
</I>&gt;<i>  ...
</I>&gt;<i> 
</I>&gt;<i> To simplify equations, let me denote 1/N as p and (1-1/N) as q. With
</I>&gt;<i> your incorrect 1/N ACLs, you get the following probabilities (I am just
</I>&gt;<i> rewriting the above using p and q):
</I>&gt;<i> 
</I>&gt;<i>  rule #0: p
</I>&gt;<i>  rule #1: q * p
</I>&gt;<i>  rule #2: q*q * p
</I>&gt;<i>  rule #3: q*q*q * p
</I>&gt;<i>  ...
</I>&gt;<i> 
</I>&gt;<i> If you are still unsure, consider the simple case of just 2 rules
</I>&gt;<i> (instead of 1000). You want the second rule to match 50% of the time. If
</I>&gt;<i> you give the second rule ACL the same 1/2 probability of a match, then
</I>&gt;<i> the second rule will only match 1/4 of the time because it will match
</I>&gt;<i> only when the previous rule did _not_ match (1/2) _and_ when its own ACL
</I>&gt;<i> matched (1/2): 1/2*1/2 = 1/4.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> To compensate for the cumulative effect of rules evaluation, you need
</I>&gt;<i> rule i to have p/(q^i) probability of a match (where &quot;q^i&quot; is &quot;q to the
</I>&gt;<i> power of i&quot;). With that, you will always get the same probability of a
</I>&gt;<i> match (p) for each rule when that rule is evaluated:
</I>&gt;<i> 
</I>&gt;<i>  rule #0: p
</I>&gt;<i>  rule #1: q * p/q = p
</I>&gt;<i>  rule #2: q*q * p/(q*q) = p
</I>&gt;<i>  rule #3: q*q*q * p/(q*q*q) = p
</I>&gt;<i>  ...
</I>&gt;<i>  rule #998: q^998 * p/(q^998) = p
</I>&gt;<i> 
</I>&gt;<i> To avoid uncertainty, the last rule (rule #999 in the above notation)
</I>&gt;<i> should use the &quot;all&quot; ACL (i.e., it will always match).
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> how can i create the randomized acls ???
</I>&gt;<i> 
</I>&gt;<i> I suggest writing a script that generates 999 ACLs with correct p/(q^i)
</I>&gt;<i> probability and the corresponding tcp_outgoing_address lines to match them.
</I>&gt;<i> 
</I>&gt;<i> Please note that computing ~500 random ACL matches for each outgoing
</I>&gt;<i> Squid connection (or is it each request?) is not going to be
</I>&gt;<i> instantaneous! If you are worried about Squid performance, then you may
</I>&gt;<i> want to add custom Squid code to select a random or round-robin IP
</I>&gt;<i> address out of a pool of 1000 addresses instead.
</I>&gt;<i> 
</I>&gt;<i> [ It is not going to be easy, but if you do it right, the same new
</I>&gt;<i> configuration interface and underlying code can then be applied to other
</I>&gt;<i> similar tasks in Squid (e.g., selecting one of several load-balanced
</I>&gt;<i> ICAP services). In that case, it would be a welcomed feature that may be
</I>&gt;<i> officially accepted. If you decide to make this generally useful, then I
</I>&gt;<i> recommend getting your configuration design pre-approved on squid-dev
</I>&gt;<i> before you implement anything (or before you pay somebody else to
</I>&gt;<i> implement it)! ]
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> is my settings below is correct ??
</I>&gt;<i> 
</I>&gt;<i> No. Your ACL(s) and rule probabilities are wrong. See above.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> HTH,
</I>&gt;<i> 
</I>&gt;<i> Alex.
</I>&gt;<i> 
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160828/3598e14d/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160828/3598e14d/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012217.html">[squid-users] squid with random outgoing ip from pool of 1000	ips
</A></li>
	<LI>Next message (by thread): <A HREF="012221.html">[squid-users] squid with random outgoing ip from pool of 1000	ips
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12219">[ date ]</a>
              <a href="thread.html#12219">[ thread ]</a>
              <a href="subject.html#12219">[ subject ]</a>
              <a href="author.html#12219">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
