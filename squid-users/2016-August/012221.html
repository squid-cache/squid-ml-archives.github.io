<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid with random outgoing ip from pool of 1000	ips
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20with%20random%20outgoing%20ip%20from%20pool%20of%201000%0A%09ips&In-Reply-To=%3C8FBBE5B3-4C18-47C2-A8BE-59ACD625E133%40netstream.ps%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012219.html">
   <LINK REL="Next"  HREF="012230.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid with random outgoing ip from pool of 1000	ips</H1>
    <B>--Ahmad--</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20with%20random%20outgoing%20ip%20from%20pool%20of%201000%0A%09ips&In-Reply-To=%3C8FBBE5B3-4C18-47C2-A8BE-59ACD625E133%40netstream.ps%3E"
       TITLE="[squid-users] squid with random outgoing ip from pool of 1000	ips">ahmed.zaeem at netstream.ps
       </A><BR>
    <I>Sun Aug 28 09:56:39 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012219.html">[squid-users] squid with random outgoing ip from pool of 1000	ips
</A></li>
        <LI>Next message (by thread): <A HREF="012230.html">[squid-users] squid with random outgoing ip from pool of 1000	ips
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12221">[ date ]</a>
              <a href="thread.html#12221">[ thread ]</a>
              <a href="subject.html#12221">[ subject ]</a>
              <a href="author.html#12221">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>just to tell you 
i updated the acl as below :
acl half10001 random 0.0009980010000000
acl half10006 random 0.0009930209650350
acl half10011 random 0.0009880657804942
acl half10020 random 0.0009792086759647
acl half10037 random 0.0009626946373158
acl half10043 random 0.0009569328906720
acl half10059 random 0.0009417362622232
acl half10079 random 0.0009230793978373
acl half10082 random 0.0009203129279589
acl half10084 random 0.0009184732224159
acl half10094 random 0.0009093297114627
acl half10098 random 0.0009056978449587
acl half10109 random 0.0008957848329039
acl half10113 random 0.0008922070646991
acl half10114 random 0.0008913148576344
acl half10122 random 0.0008842092457380
acl half10137 random 0.0008710385479118
acl half10154 random 0.0008563487636013
acl half10168 random 0.0008444374977929
acl half10171 random 0.0008419067177676
acl half10173 random 0.0008402237462388
acl half10218 random 0.0008032337005613
acl half10221 random 0.0008008264083574
acl half10222 random 0.0008000255819491
acl half10223 random 0.0007992255563671
acl half10227 random 0.0007960334462989
acl half10247 random 0.0007802631200941
acl half10248 random 0.0007794828569740
.
.
.
.
.


but the rotation is very bad and the outgoing ip now is the ip that is on my eth0 ipv6 address  only .
i mean the lists above not working at all and all request go with  1 ipv6 which is the ip that is on my eth0 address .


what wrong did i do ?



&gt;<i> On Aug 28, 2016, at 11:04 AM, --Ahmad-- &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ahmed.zaeem at netstream.ps</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> thanks for reply 
</I>&gt;<i> 
</I>&gt;<i> how about the length of the number?
</I>&gt;<i> 
</I>&gt;<i> 1/1000 to which digits should i round ??
</I>&gt;<i> 
</I>&gt;<i> 4 or 5 6 digits ?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> AS AN EXAMPLE the 1/1000 probabilities will have the acls as below :
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 0.001 0.000999 0.000998001 0.000997002999 0.000996005996001
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> the question is how many digits should i round ?
</I>&gt;<i> 
</I>&gt;<i> will squid understand the long digits ?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> cheers
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> On Aug 28, 2016, at 2:38 AM, Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;&gt; wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> On 08/27/2016 04:34 PM, --Ahmad-- wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> i guess i need to create probability 1/1000 for each ip.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Yes, but that is _not_ the same as 1/1000 probability for each
</I>&gt;&gt;<i> tcp_outgoing_address rule, unfortunately. tcp_outgoing_address rules are
</I>&gt;&gt;<i> evaluated top to bottom until the first matches. If you have N rules and
</I>&gt;&gt;<i> each rule has a 1/N probability of a match in isolation, then you will
</I>&gt;&gt;<i> get the following probabilities of a match when the rules are combined:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>  rule #0: 1/N   -- good!
</I>&gt;&gt;<i>  rule #1: (1-1/N) * 1/N  -- which is not 1/N
</I>&gt;&gt;<i>  rule #2: (1-1/N) * (1-1/N) * 1/N  -- even less 1/N than rule #2 was
</I>&gt;&gt;<i>  rule #3: (1-1/N) * (1-1/N) * (1-1/N) * 1/N  -- and getting worse!
</I>&gt;&gt;<i>  ...
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> To simplify equations, let me denote 1/N as p and (1-1/N) as q. With
</I>&gt;&gt;<i> your incorrect 1/N ACLs, you get the following probabilities (I am just
</I>&gt;&gt;<i> rewriting the above using p and q):
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>  rule #0: p
</I>&gt;&gt;<i>  rule #1: q * p
</I>&gt;&gt;<i>  rule #2: q*q * p
</I>&gt;&gt;<i>  rule #3: q*q*q * p
</I>&gt;&gt;<i>  ...
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> If you are still unsure, consider the simple case of just 2 rules
</I>&gt;&gt;<i> (instead of 1000). You want the second rule to match 50% of the time. If
</I>&gt;&gt;<i> you give the second rule ACL the same 1/2 probability of a match, then
</I>&gt;&gt;<i> the second rule will only match 1/4 of the time because it will match
</I>&gt;&gt;<i> only when the previous rule did _not_ match (1/2) _and_ when its own ACL
</I>&gt;&gt;<i> matched (1/2): 1/2*1/2 = 1/4.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> To compensate for the cumulative effect of rules evaluation, you need
</I>&gt;&gt;<i> rule i to have p/(q^i) probability of a match (where &quot;q^i&quot; is &quot;q to the
</I>&gt;&gt;<i> power of i&quot;). With that, you will always get the same probability of a
</I>&gt;&gt;<i> match (p) for each rule when that rule is evaluated:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>  rule #0: p
</I>&gt;&gt;<i>  rule #1: q * p/q = p
</I>&gt;&gt;<i>  rule #2: q*q * p/(q*q) = p
</I>&gt;&gt;<i>  rule #3: q*q*q * p/(q*q*q) = p
</I>&gt;&gt;<i>  ...
</I>&gt;&gt;<i>  rule #998: q^998 * p/(q^998) = p
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> To avoid uncertainty, the last rule (rule #999 in the above notation)
</I>&gt;&gt;<i> should use the &quot;all&quot; ACL (i.e., it will always match).
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> how can i create the randomized acls ???
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I suggest writing a script that generates 999 ACLs with correct p/(q^i)
</I>&gt;&gt;<i> probability and the corresponding tcp_outgoing_address lines to match them.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Please note that computing ~500 random ACL matches for each outgoing
</I>&gt;&gt;<i> Squid connection (or is it each request?) is not going to be
</I>&gt;&gt;<i> instantaneous! If you are worried about Squid performance, then you may
</I>&gt;&gt;<i> want to add custom Squid code to select a random or round-robin IP
</I>&gt;&gt;<i> address out of a pool of 1000 addresses instead.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> [ It is not going to be easy, but if you do it right, the same new
</I>&gt;&gt;<i> configuration interface and underlying code can then be applied to other
</I>&gt;&gt;<i> similar tasks in Squid (e.g., selecting one of several load-balanced
</I>&gt;&gt;<i> ICAP services). In that case, it would be a welcomed feature that may be
</I>&gt;&gt;<i> officially accepted. If you decide to make this generally useful, then I
</I>&gt;&gt;<i> recommend getting your configuration design pre-approved on squid-dev
</I>&gt;&gt;<i> before you implement anything (or before you pay somebody else to
</I>&gt;&gt;<i> implement it)! ]
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> is my settings below is correct ??
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> No. Your ACL(s) and rule probabilities are wrong. See above.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> HTH,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Alex.
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160828/448d80c1/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160828/448d80c1/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012219.html">[squid-users] squid with random outgoing ip from pool of 1000	ips
</A></li>
	<LI>Next message (by thread): <A HREF="012230.html">[squid-users] squid with random outgoing ip from pool of 1000	ips
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12221">[ date ]</a>
              <a href="thread.html#12221">[ thread ]</a>
              <a href="subject.html#12221">[ subject ]</a>
              <a href="author.html#12221">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
