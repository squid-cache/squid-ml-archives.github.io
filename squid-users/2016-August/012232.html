<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Trouble negotiate_kerberos_auth
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Trouble%20negotiate_kerberos_auth&In-Reply-To=%3CCA%2B0Tdyr%2B2jEL7p09yrtJQ516M-2uE-q%3DZayd3F5J0A%3D25zcacQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012228.html">
   <LINK REL="Next"  HREF="012248.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Trouble negotiate_kerberos_auth</H1>
    <B>Marcio Demetrio Bacci</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Trouble%20negotiate_kerberos_auth&In-Reply-To=%3CCA%2B0Tdyr%2B2jEL7p09yrtJQ516M-2uE-q%3DZayd3F5J0A%3D25zcacQ%40mail.gmail.com%3E"
       TITLE="[squid-users] Trouble negotiate_kerberos_auth">marciobacci at gmail.com
       </A><BR>
    <I>Mon Aug 29 01:58:25 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012228.html">[squid-users] Trouble negotiate_kerberos_auth
</A></li>
        <LI>Next message (by thread): <A HREF="012248.html">[squid-users] Trouble negotiate_kerberos_auth
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12232">[ date ]</a>
              <a href="thread.html#12232">[ thread ]</a>
              <a href="subject.html#12232">[ subject ]</a>
              <a href="author.html#12232">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Markus, thank you for help me.

When I type the klist command, the result is:

Ticket cache: FILE:/tmp/krb5cc_0
Default principal: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">robert at CMS.ENSINO.BR</A>
Valid starting       Expires              Service principal
28-08-2016 22:40:53  29-08-2016 08:40:53  krbtgt/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">CMS.ENSINO.BR at CMS.ENSINO.BR</A>
    renew until 29-08-2016 22:40:41

But, I have the following result to command bellow:
/usr/lib64/squid/negotiate_kerberos_auth_test proxy.cms.ensino.br| awk
'{sub(/Token:/,&quot;YR&quot;); print $0}END{print &quot;QQ&quot;}' |
/usr/lib64/squid/negotiate_kerberos_auth -r -s HTTP/proxy.cms.ensino.br

Result:
TT
oYGbMIGYoAMKAQGhCAYGKwYBBQIFooGGBIGDBQEwFKESBBBDTUIuRU5TSU5PLkVCLkJSfmkwZ6ADAgEFoQMCAR6iERgPMjAxNjA4MjkwMTM2MDVaowUCAwK7P6QRGA8yMDE2MDgyOTAxMzYwNVqlBQIDBhpppgMCAQepFRsTPHVuc3BlY2lmaWVkIHJlYWxtPqoLMAmgAwIBAKECMAA=
BH quit command


The HTTP/proxy.cms.ensino.br is in keytab files

I don't have the &quot;test_negotiate_auth.sh&quot; file in
src/auth/negotiate/kerberos, but I have
/usr/lib64/squid/negotiate_kerberos_auth_test, thus I'm using it.

My Linux distribution is CentOS 7

Regards,

M&#225;rcio




2016-08-28 15:24 GMT-03:00 Markus Moeller &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">huaraz at moeller.plus.com</A>&gt;:

&gt;<i>
</I>&gt;<i> HI Marcio,
</I>&gt;<i>
</I>&gt;<i>   The helper need a Kerberos token as input.  Please have a look at
</I>&gt;<i> test_negotiate_auth.sh  which is in src/auth/negotiate/kerberos of the
</I>&gt;<i> trunk version. The squid hostname must match the entry in your keytab and
</I>&gt;<i> you must have done kinit to authenticate against a Kerberos server (e.g.
</I>&gt;<i> AD) as user first.
</I>&gt;<i>
</I>&gt;<i> Regards
</I>&gt;<i> Markus
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &quot;Marcio Demetrio Bacci&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">marciobacci at gmail.com</A>&gt; wrote in message news:CA+
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">0TdyqEAt4L5KO4zrJNJ1aUe64mY2Re7z95KFdqW7Y8SV_qbg at mail.gmail.com...</A>
</I>&gt;<i> I have trouble to authenticate Squid3 with kerberos in Samba4 domain. I'm
</I>&gt;<i> using CentOS 7 and Squid 3.3.8 (yum install squid)
</I>&gt;<i>
</I>&gt;<i> When I type the bellow command in terminal:
</I>&gt;<i> /usr/lib64/squid/negotiate_kerberos_auth -d -i -s HTTP/
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
</I>&gt;<i> john <A HREF="https://lists.squid-cache.org/listinfo/squid-users">xyz at 12345</A>
</I>&gt;<i>
</I>&gt;<i> I have the following error:
</I>&gt;<i> negotiate_kerberos_auth.cc(315): pid=6364 :2016/08/27 10:44:33|
</I>&gt;<i> negotiate_kerberos_auth: DEBUG: Got 'john <A HREF="https://lists.squid-cache.org/listinfo/squid-users">xyz at 12345</A>' from squid (length:
</I>&gt;<i> 14).
</I>&gt;<i> negotiate_kerberos_auth.cc(362): pid=6364 :2016/08/27 10:44:33|
</I>&gt;<i> negotiate_kerberos_auth: ERROR: Invalid request [john <A HREF="https://lists.squid-cache.org/listinfo/squid-users">xyz at 12345</A>]
</I>&gt;<i> BH invalid request
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Here are my files configuration:
</I>&gt;<i>
</I>&gt;<i> /etc/krb5.conf
</I>&gt;<i> [libdefaults]
</I>&gt;<i>     default_realm = CMS.ENSINO.BR
</I>&gt;<i> [realms]
</I>&gt;<i>     CMS.ENSINO.BR = {
</I>&gt;<i>     kdc = dc1.cms.ensino.br:88
</I>&gt;<i>     admin_server = dc1.cms.ensino.br
</I>&gt;<i>     default_domain = CMS.ENSINO.BR
</I>&gt;<i>     }
</I>&gt;<i> [domain_realm]
</I>&gt;<i>     .cms.ensino.br = CMS.ENSINO.BR
</I>&gt;<i>     cms.ensino.br = CMS.ENSINO.BR
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Keytab name: FILE:/etc/krb5.keytab
</I>&gt;<i> KVNO Principal
</I>&gt;<i> ---- ------------------------------------------------------------
</I>&gt;<i> --------------
</I>&gt;<i>    1 proxy-k$@CMS.ENSINO.BR
</I>&gt;<i>    1 proxy-k$@CMS.ENSINO.BR
</I>&gt;<i>    1 proxy-k$@CMS.ENSINO.BR
</I>&gt;<i>    1 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
</I>&gt;<i>    1 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
</I>&gt;<i>    1 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
</I>&gt;<i>    1 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
</I>&gt;<i>    1 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
</I>&gt;<i>    1 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
</I>&gt;<i>    1 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
</I>&gt;<i>    1 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
</I>&gt;<i>    1 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">PROXY at CMS.ENSINO.BR</A>
</I>&gt;<i>    1 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">PROXY at CMS.ENSINO.BR</A>
</I>&gt;<i>    1 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">PROXY at CMS.ENSINO.BR</A>
</I>&gt;<i>    1 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">PROXY at CMS.ENSINO.BR</A>
</I>&gt;<i>    1 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">PROXY at CMS.ENSINO.BR</A>
</I>&gt;<i>    1 PROXY$@CMS.ENSINO.BR
</I>&gt;<i>    1 PROXY$@CMS.ENSINO.BR
</I>&gt;<i>    1 PROXY$@CMS.ENSINO.BR
</I>&gt;<i>    1 PROXY$@CMS.ENSINO.BR
</I>&gt;<i>    1 PROXY$@CMS.ENSINO.BR
</I>&gt;<i>    1 proxy-k$@CMS.ENSINO.BR
</I>&gt;<i>    1 proxy-k$@CMS.ENSINO.BR
</I>&gt;<i>    1 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
</I>&gt;<i>    1 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
</I>&gt;<i>    1 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">PROXY at CMS.ENSINO.BR</A>
</I>&gt;<i>    1 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">PROXY at CMS.ENSINO.BR</A>
</I>&gt;<i>    1 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">PROXY at CMS.ENSINO.BR</A>
</I>&gt;<i>    1 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">PROXY at CMS.ENSINO.BR</A>
</I>&gt;<i>    1 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">PROXY at CMS.ENSINO.BR</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Keytab name: FILE:/etc/squid/PROXY.keytab
</I>&gt;<i> KVNO Principal
</I>&gt;<i> ---- ------------------------------------------------------------
</I>&gt;<i> --------------
</I>&gt;<i>    1 proxy-k$@CMS.ENSINO.BR
</I>&gt;<i>    1 proxy-k$@CMS.ENSINO.BR
</I>&gt;<i>    1 proxy-k$@CMS.ENSINO.BR
</I>&gt;<i>    1 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
</I>&gt;<i>    1 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
</I>&gt;<i>    1 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
</I>&gt;<i>    1 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
</I>&gt;<i>    1 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
</I>&gt;<i>    1 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.cms.ensino.br at CMS.ENSINO.BR</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> /etc/sysconfig/squid
</I>&gt;<i> # default squid options
</I>&gt;<i> SQUID_OPTS=&quot;&quot;
</I>&gt;<i> # Time to wait for Squid to shut down when asked. Should not be necessary
</I>&gt;<i> # most of the time.
</I>&gt;<i> SQUID_SHUTDOWN_TIMEOUT=100
</I>&gt;<i> # default squid conf file
</I>&gt;<i> SQUID_CONF=&quot;/etc/squid/squid.conf&quot;
</I>&gt;<i>
</I>&gt;<i> KRB5_KTNAME=/etc/squid/PROXY.keytab
</I>&gt;<i> export KRB5_KTNAME
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> kinit and klist commands are OK.
</I>&gt;<i>
</I>&gt;<i> Best Regards,
</I>&gt;<i>
</I>&gt;<i> M&#225;rcio
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160828/2c7658a1/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160828/2c7658a1/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012228.html">[squid-users] Trouble negotiate_kerberos_auth
</A></li>
	<LI>Next message (by thread): <A HREF="012248.html">[squid-users] Trouble negotiate_kerberos_auth
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12232">[ date ]</a>
              <a href="thread.html#12232">[ thread ]</a>
              <a href="subject.html#12232">[ subject ]</a>
              <a href="author.html#12232">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
