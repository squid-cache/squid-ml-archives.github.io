<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Transparent intercept Squid 3.5.20: where VPNs go to	die.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Transparent%20intercept%20Squid%203.5.20%3A%20where%20VPNs%20go%20to%0A%09die.&In-Reply-To=%3CCANLNtGR2MCY_3M3k5tP_6ij5nCG1SppfsbkUhj%3D%2BaDfE9LV96g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012247.html">
   <LINK REL="Next"  HREF="012250.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Transparent intercept Squid 3.5.20: where VPNs go to	die.</H1>
    <B>Stanford Prescott</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Transparent%20intercept%20Squid%203.5.20%3A%20where%20VPNs%20go%20to%0A%09die.&In-Reply-To=%3CCANLNtGR2MCY_3M3k5tP_6ij5nCG1SppfsbkUhj%3D%2BaDfE9LV96g%40mail.gmail.com%3E"
       TITLE="[squid-users] Transparent intercept Squid 3.5.20: where VPNs go to	die.">stan.prescott at gmail.com
       </A><BR>
    <I>Mon Aug 29 16:43:03 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012247.html">[squid-users] Wget https://www.google.com not download
</A></li>
        <LI>Next message (by thread): <A HREF="012250.html">[squid-users] Transparent intercept Squid 3.5.20: where VPNs go to die.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12246">[ date ]</a>
              <a href="thread.html#12246">[ thread ]</a>
              <a href="subject.html#12246">[ subject ]</a>
              <a href="author.html#12246">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have successfully gotten Squid 3.5.20 to filter both HTTP and HTTPS in
transparent intercept mode. With intercept mode, iptables rules redirect
port 80 to squid's http_port 800 and HTTPS port 443 is redirected to
Squid's https_port 801. It all seems to work exactly as it should.

I have recently been trying to integrate a urlfilter using
url_redirect_program with my Squid implementation, and that works very
well, also.

The problem:

One of the useful features of the urlfilter is that it detects proxy
tunnels and blocks them. Not being very proficient in the use of proxy
tunnels and VPNs I wanted to test it out. I setup a VPN client (CyberGhost
VPN) on my Linux client connected to my firewall with the Squid
implementation and could successfully establish a VPN connection *via port
443* when Squid and the URL Filter were disabled. After disconnecting the
VPN and enabling Squid and the urlfilter, attempting to connect using the
VPN over 443 failed to connect.

Now that actually might be a good thing because I am trying to block it
anyway. But the block is an error and not in the manner that is expected.
It is blocked, it seems, because the redirection of port 443 to Squid
causes Squid to barf on the VPN because the VPN, while using port 443 is
not a TLS/SSL encrypted connection and Squid doesn't seem to know what to
do with the connection.

Is there a way to tell Squid that there may be port 443 connections that
don't use TLS/SSL so that a useful message could be generated other than
the &quot;connection failed&quot; message the VPN client gives? There are error
messages in the Squid cache.log about connection attempts failed because of
problems with TLS/SSL and certs.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160829/ca3ebcd8/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160829/ca3ebcd8/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012247.html">[squid-users] Wget https://www.google.com not download
</A></li>
	<LI>Next message (by thread): <A HREF="012250.html">[squid-users] Transparent intercept Squid 3.5.20: where VPNs go to die.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12246">[ date ]</a>
              <a href="thread.html#12246">[ thread ]</a>
              <a href="subject.html#12246">[ subject ]</a>
              <a href="author.html#12246">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
