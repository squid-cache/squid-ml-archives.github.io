<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] More host header forgery pain with peek/splice
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20More%20host%20header%20forgery%20pain%20with%20peek/splice&In-Reply-To=%3C477b5e2b-6eb4-54bc-240f-af416f53612c%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012180.html">
   <LINK REL="Next"  HREF="012260.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] More host header forgery pain with peek/splice</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20More%20host%20header%20forgery%20pain%20with%20peek/splice&In-Reply-To=%3C477b5e2b-6eb4-54bc-240f-af416f53612c%40treenet.co.nz%3E"
       TITLE="[squid-users] More host header forgery pain with peek/splice">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Aug 30 16:01:47 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012180.html">[squid-users] More host header forgery pain with peek/splice
</A></li>
        <LI>Next message (by thread): <A HREF="012260.html">[squid-users] More host header forgery pain with peek/splice
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12257">[ date ]</a>
              <a href="thread.html#12257">[ thread ]</a>
              <a href="subject.html#12257">[ subject ]</a>
              <a href="author.html#12257">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 26/08/2016 6:34 a.m., reinerotto wrote:
&gt;<i> Hack the code. Because it is even worse, as firefox for example does not obey
</I>&gt;<i> to the TTL. 
</I>&gt;<i> 
</I>
It is not that simple. The checks are there for very good reason(s)
related to security of the network using the proxy.

The Host forgery issue being checked for allows network firewall rule
bypass, browser same-origin bypass, and browser sandbox bypass - in a
way which places the attacker in control of what logs you see [aha!
invisible access to the network]. With all the related nasty
side-effects those allow. There is both malware and services for sale
around the 'net that take advantage of the attack to do those bypasses.
=&gt; Simply disabling the check code is a *very* risky thing to do.


The cases where Squid still gets it wrong are where the popular CDN
service(s) in question are performing DNS actions indistinguishable to
those malware attacks. If Squid can't tell the difference between an
attack and normal DNS behaviour the only code change possible is to
disable the check (see above about the risk level).


FYI: I have a plan to reduce the false-positive rate from DNS rotation
effects. But that requires some deep redesign of the DNS code, which I'm
intending to do as part of the Squid-5 roadmap to avoid further
destabilizing 4.x while its in beta.

For now the workarounds are:

* obey the requirement that destination NAT (if any) is performed only
on the Squid machine.

* to tune the lifetime for persistent client connections. That reduces
(but not fully) connections outliving DNS rotation times and thus
causing requests to have different ORIGINAL_DST from what DNS says.

* if wanting Google 8.8.8.8 service as your resolver. Use a local DNS
recursive resolver shared by Squid and client which points to that
service as its parent/forwarded resolver. That removes the issue with
every 8.8.8.8 response having different reply IP values (so client and
Squid doing near simultaneous lookups get different IPs).

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012180.html">[squid-users] More host header forgery pain with peek/splice
</A></li>
	<LI>Next message (by thread): <A HREF="012260.html">[squid-users] More host header forgery pain with peek/splice
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12257">[ date ]</a>
              <a href="thread.html#12257">[ thread ]</a>
              <a href="subject.html#12257">[ subject ]</a>
              <a href="author.html#12257">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
