<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] mangle ranges using ICAP
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20mangle%20ranges%20using%20ICAP&In-Reply-To=%3Ca8885ab2-6d1d-fec4-37ca-cbe69d77d757%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013659.html">
   <LINK REL="Next"  HREF="013663.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] mangle ranges using ICAP</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20mangle%20ranges%20using%20ICAP&In-Reply-To=%3Ca8885ab2-6d1d-fec4-37ca-cbe69d77d757%40measurement-factory.com%3E"
       TITLE="[squid-users] mangle ranges using ICAP">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Dec  5 03:29:17 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013659.html">[squid-users] mangle ranges using ICAP
</A></li>
        <LI>Next message (by thread): <A HREF="013663.html">[squid-users] mangle ranges using ICAP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13661">[ date ]</a>
              <a href="thread.html#13661">[ thread ]</a>
              <a href="subject.html#13661">[ subject ]</a>
              <a href="author.html#13661">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12/04/2016 03:05 PM, Alfredo Rezinovsky wrote:
&gt;<i> Let say a client asks for a URL using a range: 0-256000.
</I>&gt;<i> 
</I>&gt;<i> I want squid to ask just for 10.000 bytes and answer as if the request
</I>&gt;<i> was server side aborted.
</I>&gt;<i> 
</I>&gt;<i> I can change the request Range: &quot;bytes=0-256000&quot; to &quot;bytes=0-10000&quot; with
</I>&gt;<i> and icap server
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> In the answer I'm trying to change the Content-Range from
</I>&gt;<i> &quot;0-10000/total&quot; to &quot;0-256000/total&quot; and Content-Length from &quot;10001&quot; to
</I>&gt;<i> &quot;256001&quot; squid won't hung up and the client will stay waiting after the
</I>&gt;<i> first 10001 bytes.
</I>&gt;<i> 
</I>&gt;<i> There's a way to make squid send what it gets from the icap and then
</I>&gt;<i> drop the TCP connection as in a server side aborted connection?
</I>
I have not tested it, but I would expect Squid to close the TCP
connection to the HTTP client if the ICAP service aborts the
corresponding RESPMOD transaction (i.e., closes the ICAP connection
before serving the entire ICAP response).

In theory, Squid should read the embedded HTTP response headers and
expect 256001 HTTP body bytes. Your ICAP service can close the
connection after sending fewer HTTP body bytes to simulate the abort.
Such premature aborts do happen in virus filtering with data trickling
environments, so I would expect the corresponding Squid code to work in
principle.

In practice, Squid might get confused with ICAP service manipulations of
the overall transaction state. You would need to test this to know
whether your specific plan works without any Squid modifications.

For example, there is a bug report about Squid getting confused when an
ICAP REQMOD service rewrites a CONNECT request to a GET request (or vice
versa, I do not recall). You might hit somewhat similar limitations with
range manipulations.


HTH,

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013659.html">[squid-users] mangle ranges using ICAP
</A></li>
	<LI>Next message (by thread): <A HREF="013663.html">[squid-users] mangle ranges using ICAP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13661">[ date ]</a>
              <a href="thread.html#13661">[ thread ]</a>
              <a href="subject.html#13661">[ subject ]</a>
              <a href="author.html#13661">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
