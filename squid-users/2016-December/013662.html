<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Bad HTTP requests trigger ICAP suspension
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Bad%20HTTP%20requests%20trigger%20ICAP%20suspension&In-Reply-To=%3C87c2d95e-87e3-ecd1-cd1e-1058d47d4965%40coronamundi.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013703.html">
   <LINK REL="Next"  HREF="013664.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Bad HTTP requests trigger ICAP suspension</H1>
    <B>Silamael</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Bad%20HTTP%20requests%20trigger%20ICAP%20suspension&In-Reply-To=%3C87c2d95e-87e3-ecd1-cd1e-1058d47d4965%40coronamundi.de%3E"
       TITLE="[squid-users] Bad HTTP requests trigger ICAP suspension">Silamael at coronamundi.de
       </A><BR>
    <I>Mon Dec  5 10:17:28 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013703.html">[squid-users] Config Recommendations
</A></li>
        <LI>Next message (by thread): <A HREF="013664.html">[squid-users] Bad HTTP requests trigger ICAP suspension
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13662">[ date ]</a>
              <a href="thread.html#13662">[ thread ]</a>
              <a href="subject.html#13662">[ subject ]</a>
              <a href="author.html#13662">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

We are using the ICAP services of Squid for filtering HTTP-Requests. Now
we encountered the problem that a buggy? web application creates
requests with an URL with the hostname set to '.'.
These bad requests than cause the suspension of the whole ICAP service
which then causes the bypass of the URL filtering as the ICAP service
has bypass=yes configured.
This sounds somehow wrong to me, the ICAP service doesn't have a
problem, just the HTTP request being forwarded is borken. Therefor is no
need to suspend the ICAP service at a whole for 30 seconds.
Am I wrong or is this behavior intended?

This are the log messages:
2016/11/28 13:30:00 kid1| SECURITY ALERT: Missing hostname in URL
'<A HREF="http:///?_task=mail&amp;_id=xxxxxxxxxxx&amp;_action=display-attachment&amp;_file=rcmfilexxxxxxxxxxxxxxxxxxxxx">http:///?_task=mail&amp;_id=xxxxxxxxxxx&amp;_action=display-attachment&amp;_file=rcmfilexxxxxxxxxxxxxxxxxxxxx</A>'.
see access.log for details.
2016/11/28 13:30:00.740 kid1| 0,3| src/base/TextException.cc(87) Throw:
src/adaptation/icap/ModXact.cc:970:exception:
adapted.header-&gt;parse(&amp;httpBuf, true, &amp;error)
2016/11/28 13:30:00.740 kid1| suspending ICAP service for too many failures
2016/11/28 13:30:00.740 kid1| optional ICAP service is suspended:
<A HREF="icap://XXX.XXX.XXX.XXX:1344/reqmod">icap://XXX.XXX.XXX.XXX:1344/reqmod</A> [down,susp,fail11]

Cheers,
Matthias

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013703.html">[squid-users] Config Recommendations
</A></li>
	<LI>Next message (by thread): <A HREF="013664.html">[squid-users] Bad HTTP requests trigger ICAP suspension
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13662">[ date ]</a>
              <a href="thread.html#13662">[ thread ]</a>
              <a href="subject.html#13662">[ subject ]</a>
              <a href="author.html#13662">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
