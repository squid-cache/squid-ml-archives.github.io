<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Bad HTTP requests trigger ICAP suspension
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Bad%20HTTP%20requests%20trigger%20ICAP%20suspension&In-Reply-To=%3C1421fdfd-99e5-5a1f-d336-cd054f5919ce%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013679.html">
   <LINK REL="Next"  HREF="013694.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Bad HTTP requests trigger ICAP suspension</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Bad%20HTTP%20requests%20trigger%20ICAP%20suspension&In-Reply-To=%3C1421fdfd-99e5-5a1f-d336-cd054f5919ce%40treenet.co.nz%3E"
       TITLE="[squid-users] Bad HTTP requests trigger ICAP suspension">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Dec  6 13:54:24 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013679.html">[squid-users] Bad HTTP requests trigger ICAP suspension
</A></li>
        <LI>Next message (by thread): <A HREF="013694.html">[squid-users] Bad HTTP requests trigger ICAP suspension
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13682">[ date ]</a>
              <a href="thread.html#13682">[ thread ]</a>
              <a href="subject.html#13682">[ subject ]</a>
              <a href="author.html#13682">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 6/12/2016 9:03 p.m., Silamael wrote:
&gt;<i> On 05.12.2016 13:58, Amos Jeffries wrote:
</I>&gt;&gt;<i> On 5/12/2016 11:17 p.m., Silamael wrote:
</I>&gt;&gt;&gt;<i> This sounds somehow wrong to me, the ICAP service doesn't have a
</I>&gt;&gt;&gt;<i> problem, just the HTTP request being forwarded is borken. Therefor is no
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The ICAP service appears to be producing URLs without any host segment
</I>&gt;&gt;<i> at all (&quot;&quot;) instead of using the input &quot;.&quot; or some other value of its
</I>&gt;&gt;<i> choosing.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Strictly speaking Squid should accept that as a URL with no hostname,
</I>&gt;&gt;<i> just like it accepted the odd '.' hostname. That is one of the issues
</I>&gt;&gt;<i> bug 1961 seeks to fix.
</I>&gt;<i> 
</I>&gt;<i> Hi Amos,
</I>&gt;<i> 
</I>&gt;<i> So, you think the URL Squid complains about is returned by our ICAP service?
</I>&gt;<i> As far as I understood the log messages, the URL was not sent to the
</I>&gt;<i> ICAP service at all.
</I>&gt;<i> Or am I wrong here?
</I>
The exception was thrown from the HTTP request parser when handling the
ICAP service response - which was delivering a new HTTP request message
to use instead of the client-provided request message.

Assuming your statement was correct about the input having '.' hostname.
That means the ICAP changed the URL to '<A HREF="scheme:///path">scheme:///path</A>'.


&gt;<i> 
</I>&gt;&gt;&gt;<i> need to suspend the ICAP service at a whole for 30 seconds.
</I>&gt;&gt;&gt;<i> Am I wrong or is this behavior intended?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> AIUI, for installations using bypass=yes the behaviour is expected. That
</I>&gt;&gt;<i> setting is not tied to particular types of error, it simply means the
</I>&gt;&gt;<i> service is optional. *any* HTTP request (even good ones) can bypass.
</I>&gt;<i> 
</I>&gt;<i> Yeah, that's clear. My problem is, that the service is suspended.
</I>&gt;<i> If there are real problems within the communication with the ICAP
</I>&gt;<i> service, it should be bypassed.
</I>
Nod. I think Eliezers solution with the ACL is the best thing to do
while waiting on the Squid fix to handle that URL type. Maybe even keep
it after that if the ICAP service is not liking the input request either.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013679.html">[squid-users] Bad HTTP requests trigger ICAP suspension
</A></li>
	<LI>Next message (by thread): <A HREF="013694.html">[squid-users] Bad HTTP requests trigger ICAP suspension
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13682">[ date ]</a>
              <a href="thread.html#13682">[ thread ]</a>
              <a href="subject.html#13682">[ subject ]</a>
              <a href="author.html#13682">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
