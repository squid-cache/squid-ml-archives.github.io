<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] HTTPS through http proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20HTTPS%20through%20http%20proxy&In-Reply-To=%3C1d5ba5ab-009c-8fdf-0a83-fea5450d849f%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013678.html">
   <LINK REL="Next"  HREF="013668.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] HTTPS through http proxy</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20HTTPS%20through%20http%20proxy&In-Reply-To=%3C1d5ba5ab-009c-8fdf-0a83-fea5450d849f%40treenet.co.nz%3E"
       TITLE="[squid-users] HTTPS through http proxy">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Dec  6 14:05:26 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013678.html">[squid-users] HTTPS through http proxy
</A></li>
        <LI>Next message (by thread): <A HREF="013668.html">[squid-users] TCP_MISS/419
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13683">[ date ]</a>
              <a href="thread.html#13683">[ thread ]</a>
              <a href="subject.html#13683">[ subject ]</a>
              <a href="author.html#13683">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 6/12/2016 7:30 p.m., Blaxton wrote:
&gt;<i> Thank you Amos,
</I>&gt;<i> version of squid is : squid-3.3.8-26.el7_2.4.x86_64
</I>&gt;<i> Is this statement true:squid is not aware or traffic that is made with connect command ?
</I>
&quot;aware of the traffic&quot; is too vague to answer yes or no. Squid is
&quot;aware&quot; that there are bytes going through (ie how many). But it does
not normally look at them to see what they are made of.


&gt;<i> since connect command make a tunnel within squid ?
</I>
That assumes that the CONNECT message arrived into Squid. Unless you can
see some things happening in some logs or tracers (ie. system ones) then
you dont know if that stage of the transaction even got reached.

The only thing that is sure is that no tunnel has ended.


&gt;<i> passing below argument to JVM:-Dhttps.proxyHost=webcache.example.com -Dhttps.proxyPort=8080cause application connect to <A HREF="https://webcache.exammple.comhowever">https://webcache.exammple.comhowever</A> I have not created any certificate.
</I>
Do not understand what you said.

clients usually dont need certificates to do HTTPS these days (thats
bad, but what we have to work with for now). So that should not matter.


Also, &quot;connect to <A HREF="https://webcache.exammple.com">https://webcache.exammple.com</A>&quot; could mean

1) connecting to webcache.exammple.com with TCP, then
  negotiating TLS

OR it could mean

2) connecting to the proxy, and
  initiating a &quot;CONNECT webcache.exammple.com:443&quot; tunnel, then
  negotiating TLS through that

.. then there is the matter of whats going on inside the TLS:

 i) HTTP/1 (aka &quot;HTTPS&quot;)
 ii) WebSockets
 iii) SPDY
 iv) HTTP/2 (aka, &quot;h2&quot;, aka &quot;HTTPS&quot;)
 v) something unknown.

I don't know what that java tool is or what its doing.


Alex already advised; Use a tool with well known capabilities and
behaviour to do initial testing.

That will save you the time of providing a complete documentation and
behavioural lesson about the java tool you are using. Just so we can say
what its doing right or wrong.


&gt;<i> May I assume squid is built with ssl enabled and both https and http proxybeing provided on one port ?
</I>
No, you cant assume.

There are two Transports (TCP or TLS) and two Transfer message syntaxes
(origin or proxy). Squid listening ports can only listen on one
Transport protocol + Transfer syntax pair at a time.

* Port 80 has TCP transport and origin syntax.
* Port 443 has TLS transport and origin syntax.
* Port 3128 has TCP transport + proxy syntax.
* There is no port commonly associated with TLS transport + proxy syntax.


The TCP receiver is called http_port.
The TLS receiver is called https_port. Notice the 's' difference.


CONNECT messages are part of the proxy syntax.

The origin syntax is split into &quot;modes&quot; (accel, intercept, tproxy)
depending on how traffic managed to reach the proxy - which determines
how it can be handled.

So whether the assumption is true or not depends on what you mean by
'https' and by 'proxy being provided'.


Does that clarify enough for you to answer the question yourself?


&gt;<i> either above statement is true, or maybe Java has a bug.
</I>&gt;<i> Thanks for help, I will check on squidtool.
</I>&gt;<i> Thanks
</I>&gt;<i> 
</I>
see also Alex response, he listed some others you might be familiar
enough with to use for testing. Along with what you need to test.

[ sorry for the long mail, I'm a bit bored waiting for compiles to
finish :-) ]

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013678.html">[squid-users] HTTPS through http proxy
</A></li>
	<LI>Next message (by thread): <A HREF="013668.html">[squid-users] TCP_MISS/419
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13683">[ date ]</a>
              <a href="thread.html#13683">[ thread ]</a>
              <a href="subject.html#13683">[ subject ]</a>
              <a href="author.html#13683">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
