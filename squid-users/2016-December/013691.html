<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Skype for Business behind a transparent squid	(TProxy) HTTP/S
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Skype%20for%20Business%20behind%20a%20transparent%20squid%0A%09%28TProxy%29%20HTTP/S&In-Reply-To=%3C14FD8AC2-756C-4B39-9CA3-757E95BE4B96%40insync.za.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013673.html">
   <LINK REL="Next"  HREF="013686.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Skype for Business behind a transparent squid	(TProxy) HTTP/S</H1>
    <B>Pieter De Wit</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Skype%20for%20Business%20behind%20a%20transparent%20squid%0A%09%28TProxy%29%20HTTP/S&In-Reply-To=%3C14FD8AC2-756C-4B39-9CA3-757E95BE4B96%40insync.za.net%3E"
       TITLE="[squid-users] Skype for Business behind a transparent squid	(TProxy) HTTP/S">pieter at insync.za.net
       </A><BR>
    <I>Tue Dec  6 17:32:03 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013673.html">[squid-users] Skype for Business behind a transparent squid (TProxy) HTTP/S
</A></li>
        <LI>Next message (by thread): <A HREF="013686.html">[squid-users] &quot;store-stale&quot; sending original &quot;expires&quot; header may be breaking windows update?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13691">[ date ]</a>
              <a href="thread.html#13691">[ thread ]</a>
              <a href="subject.html#13691">[ subject ]</a>
              <a href="author.html#13691">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>If that is the edge server then it will be the audio/video

Sent from my iPhone

&gt;<i> On 6/12/2016, at 12:35, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> On 6/12/2016 11:46 a.m., Sameh Onaissi wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I have a Ubuntu 16.04 server with Squid 3.5.22 installed. It acts as a gateway in a LAN.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> It is configured to intercept HTTP and HTTPS traffic (Transparent). So iptables redirects were used for ports 80 and 443.
</I>&gt;&gt;<i> The server runs two scripts:
</I>&gt;&gt;<i> _*nat.sh*_ to bridge the two network cards, allowing LAN computers access to the internet through the servers Internet interface card.
</I>&gt;&gt;<i> *_iptables.sh_* which defines the ip rules and port forwarding: <A HREF="http://pastebin.com/SqpbmYQQ">http://pastebin.com/SqpbmYQQ</A>
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> BEFORE RUNNING iptables.sh...
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> When I connect a LAN computer to it, everything works as expected. Complete Internet access with some HTTP and HTTPS domains blocked/redirected to another page. Skype for Business logs in successfully.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> AFTER RUNNING iptables.sh
</I>&gt;&gt;<i> Skype for Business disconnects, and fails to re-connect, normal skype works just fine.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I revised: <A HREF="https://support.office.com/en-us/article/Create-DNS-records-at-eNomCentral-for-Office-365-a6626053-a9c8-445b-81ee-eeb6672fae77?ui=en-US&amp;rs=en-US&amp;ad=US#bkmk_verify">https://support.office.com/en-us/article/Create-DNS-records-at-eNomCentral-for-Office-365-a6626053-a9c8-445b-81ee-eeb6672fae77?ui=en-US&amp;rs=en-US&amp;ad=US#bkmk_verify</A> And added all DNS configurations on enom.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> That got rid of the DNS error I was getting to another error saying service is temporarily unavailable.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Any suggestions to why this is happening? Any solutions?
</I>&gt;<i> 
</I>&gt;<i> Skype is sending something that is not HTTPS over port 443. The on_unsupported_protocol feature in Squid-4 is needed to tunnel Skype traffic when intercepting port 443.
</I>&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> *Note:* both router and Ubuntu's WAN interface use Google's 8.8.8.8 DNS
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I hope that means the border router is providing DNS recursive lookup with 8.8.8.8 as the parent, with LAN devices using that border router as their DNS server. That will minimize the damage Google is causing, but not avoid it completely. If not you should make it so, or at least place another shared resolver somewhere to do the necessary DNS caching.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> *Amos
</I>&gt;<i> 
</I>&gt;<i> *
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013673.html">[squid-users] Skype for Business behind a transparent squid (TProxy) HTTP/S
</A></li>
	<LI>Next message (by thread): <A HREF="013686.html">[squid-users] &quot;store-stale&quot; sending original &quot;expires&quot; header may be breaking windows update?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13691">[ date ]</a>
              <a href="thread.html#13691">[ thread ]</a>
              <a href="subject.html#13691">[ subject ]</a>
              <a href="author.html#13691">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
