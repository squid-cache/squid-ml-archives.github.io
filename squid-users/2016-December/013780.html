<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Crash: every 1-2 hour: kernel: Out of memory:	Kill process (squid)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Crash%3A%20every%201-2%20hour%3A%20kernel%3A%20Out%20of%20memory%3A%0A%09Kill%20process%20%28squid%29&In-Reply-To=%3C0bc001d256d4%24ffcc24b0%24ff646e10%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013778.html">
   <LINK REL="Next"  HREF="013823.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Crash: every 1-2 hour: kernel: Out of memory:	Kill process (squid)</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Crash%3A%20every%201-2%20hour%3A%20kernel%3A%20Out%20of%20memory%3A%0A%09Kill%20process%20%28squid%29&In-Reply-To=%3C0bc001d256d4%24ffcc24b0%24ff646e10%24%40ngtech.co.il%3E"
       TITLE="[squid-users] Crash: every 1-2 hour: kernel: Out of memory:	Kill process (squid)">eliezer at ngtech.co.il
       </A><BR>
    <I>Thu Dec 15 13:13:17 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013778.html">[squid-users] Crash: every 1-2 hour: kernel: Out of memory: Kill process (squid)
</A></li>
        <LI>Next message (by thread): <A HREF="013823.html">[squid-users] Crash: every 1-2 hour: kernel: Out of memory:	Kill process (squid)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13780">[ date ]</a>
              <a href="thread.html#13780">[ thread ]</a>
              <a href="subject.html#13780">[ subject ]</a>
              <a href="author.html#13780">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>+1 for what Amos suggesting.
It's too weird to be caused by a special and unknown issue.
Can you minimize the test to intercept only 1 SINGLE client?
Also about the Russian tutorials, these are for building and running squid which might work.
But for the interception part on the cisco you didn't referred to any tutorial.
I can only refer a tutorial which I wrote for a cisco router:
<A HREF="http://wiki.squid-cache.org/ConfigExamples/UbuntuTproxy4Wccp2">http://wiki.squid-cache.org/ConfigExamples/UbuntuTproxy4Wccp2</A>
Also squid cannot identify in any way if there is a routing or switching loop.

To illustrate:
Squid has mac address 99:99:99:99:99:91 and the switch has 99:99:99:99:99:92, 
Squid will always see packets flowing from one of the switch mac address for both legit and non legit(loops).
So you first need to verify the setup with one single client and use tcdump on the squid machine to identify by the src port if the connection is looped or not.

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>


-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Amos Jeffries
Sent: Thursday, December 15, 2016 6:52 AM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Crash: every 1-2 hour: kernel: Out of memory: Kill process (squid)

On 15/12/2016 6:24 a.m., <A HREF="https://lists.squid-cache.org/listinfo/squid-users">noc at forceline.net</A> wrote:
&gt;<i> Eliezer, thanks for your reply. Guides:
</I>&gt;<i> <A HREF="http://wiki.squid-cache.org/Features/SslBump">http://wiki.squid-cache.org/Features/SslBump</A>
</I>&gt;<i> <A HREF="http://wiki.squid-cache.org/Features/SslPeekAndSplice">http://wiki.squid-cache.org/Features/SslPeekAndSplice</A>
</I>&gt;<i> <A HREF="https://habrahabr.ru/post/267851/">https://habrahabr.ru/post/267851/</A>  &lt;-- Russian lang 
</I>&gt;<i> <A HREF="https://habrahabr.ru/post/272733/">https://habrahabr.ru/post/272733/</A>  &lt;-- Russian lang
</I>&gt;<i> 
</I>&gt;&gt;<i> First goes first change this: 13130:
</I>&gt;<i> Done, nothing changed. Squid died.
</I>&gt;<i> 
</I>&gt;<i> Maby it will be work fine whith lower load even with https. But I 
</I>&gt;<i> don't understand, why it killed by a kernel rather than just update 
</I>&gt;<i> memory by new one.
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://wiki.squid-cache.org/Features/SslBump">http://wiki.squid-cache.org/Features/SslBump</A>
</I>&gt;&gt;<i> Memory usage
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    /!\ Warning: Unlike the rest of this page at the time of writing, 
</I>&gt;&gt;<i> this
</I>&gt;<i> section applies to Squid-3.3 and possibly later code capable of 
</I>&gt;<i> dynamic SSL certificate generation and origin server certificate 
</I>&gt;<i> mimicking. The current section text is intended primarily for 
</I>&gt;<i> developers and early adopters facing excessive memory consumption in 
</I>&gt;<i> certain SslBump environments. These notes may be relocated elsewhere if a better location is found.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Current documentation is specific to bump-server-first configurations.
</I>&gt;<i> 
</I>&gt;<i> In attach server statistic.
</I>&gt;<i> 
</I>

I think you still have a forwarding loop. Does the cisco WCCP send port
443 connections from Squid to reach the Internet instead of sending them back into Squid.

The Via header will protect against HTTP messages looping, but the TLS handshake traffic has no such protection.

Amos

_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013778.html">[squid-users] Crash: every 1-2 hour: kernel: Out of memory: Kill process (squid)
</A></li>
	<LI>Next message (by thread): <A HREF="013823.html">[squid-users] Crash: every 1-2 hour: kernel: Out of memory:	Kill process (squid)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13780">[ date ]</a>
              <a href="thread.html#13780">[ thread ]</a>
              <a href="subject.html#13780">[ subject ]</a>
              <a href="author.html#13780">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
