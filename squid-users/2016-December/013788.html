<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Proper Cache Peer Access
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Proper%20Cache%20Peer%20Access&In-Reply-To=%3C8c061728-1aa3-db19-b9a3-92c4952535ea%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013756.html">
   <LINK REL="Next"  HREF="013758.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Proper Cache Peer Access</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Proper%20Cache%20Peer%20Access&In-Reply-To=%3C8c061728-1aa3-db19-b9a3-92c4952535ea%40treenet.co.nz%3E"
       TITLE="[squid-users] Proper Cache Peer Access">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Dec 16 11:41:34 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013756.html">[squid-users] Proper Cache Peer Access
</A></li>
        <LI>Next message (by thread): <A HREF="013758.html">[squid-users] Squid 3.5.21 ssl bump and x-forward
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13788">[ date ]</a>
              <a href="thread.html#13788">[ thread ]</a>
              <a href="subject.html#13788">[ subject ]</a>
              <a href="author.html#13788">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 14/12/2016 2:56 p.m., <A HREF="https://lists.squid-cache.org/listinfo/squid-users">creditu at eml.cc</A> wrote:
&gt;<i> On Tue, Dec 13, 2016, at 06:33 PM, Amos Jeffries wrote:
</I>&gt;&gt;<i> On 14/12/2016 2:10 p.m., creditu wrote:
</I>&gt;&gt;&gt;<i> Looking for the best way to provide cache peer access for two urls on a
</I>&gt;&gt;&gt;<i> 3.1 accelerator.  For example if a set of backend servers fullfill
</I>&gt;&gt;&gt;<i> requests for both www.example.com and www-legacy.example.com is the
</I>&gt;&gt;&gt;<i> following the correct way to handle them in regards to the cach peer
</I>&gt;&gt;&gt;<i> access? 
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> What you have works and is fine for simple setups like yours.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> However, since you ask for &quot;proper&quot; ...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &lt;snip&gt;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> # Backend servers for www and www-legacy
</I>&gt;&gt;&gt;<i> acl www dstdomain www.example.com
</I>&gt;&gt;&gt;<i> acl www-legacy dstdomain www-legacy.example.com
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Recommended practice when you have same-type data and ACLs used in
</I>&gt;&gt;<i> identical ways like these ones. Is to place both those domain values in
</I>&gt;&gt;<i> the one ACL named 'www'. That will simplify your access lines.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> There are some tiny memory and (cumulative) speed gains. But the biggest
</I>&gt;&gt;<i> reason is easier understanding and maintenance of the config if/when it
</I>&gt;&gt;<i> gets more complex.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Amos
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________
</I>&gt;<i> 
</I>&gt;<i> Ah, so you would do something like this:
</I>&gt;<i> 
</I>&gt;<i> acl www dstdomain www.example.com www-legacy.example.com
</I>&gt;<i> cache_peer 10.10.10.1 parent 80 0 no-query no-digest originserver
</I>&gt;<i> round-robin
</I>&gt;<i> cache_peer_access 10.10.10.1 allow www
</I>&gt;<i> cache_peer_access 10.10.10.1 deny all
</I>&gt;<i> . . .
</I>
I would, yes.

&gt;<i> 
</I>&gt;<i> I was worried about a situation that was detailed in
</I>&gt;<i> <A HREF="http://wiki.squid-cache.org/SquidFaq/SquidAcl#And.2FOr_logic">http://wiki.squid-cache.org/SquidFaq/SquidAcl#And.2FOr_logic</A> (the src
</I>&gt;<i> address example).  Thanks
</I>
You are more likely to make that mistake with the differently named ACLs
config. That's part of the simplicity==good reasoning.

Using them as the only condition on different but sequential lines is an
OR condition. Putting two values in one named ACL is also an OR
condition. So for simple types like dstdomain the two ways of writing
'OR' are equivalent and the simpler way is better for reasons other than
than technical ones (harder for us humans to make mistakes with).

For some ACL types which have side effects (like helper or remote data
lookups) the use of multiple allow/deny lines can behave differently
than one ACL check. Which can be useful if you want that, but not what
you have going on here.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013756.html">[squid-users] Proper Cache Peer Access
</A></li>
	<LI>Next message (by thread): <A HREF="013758.html">[squid-users] Squid 3.5.21 ssl bump and x-forward
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13788">[ date ]</a>
              <a href="thread.html#13788">[ thread ]</a>
              <a href="subject.html#13788">[ subject ]</a>
              <a href="author.html#13788">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
