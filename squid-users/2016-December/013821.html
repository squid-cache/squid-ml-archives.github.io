<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Crash: every 1-2 hour: kernel: Out of memory:	Kill process (squid)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Crash%3A%20every%201-2%20hour%3A%20kernel%3A%20Out%20of%20memory%3A%0A%09Kill%20process%20%28squid%29&In-Reply-To=%3C201612191239.51098.Antony.Stone%40squid.open.source.it%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013819.html">
   <LINK REL="Next"  HREF="013763.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Crash: every 1-2 hour: kernel: Out of memory:	Kill process (squid)</H1>
    <B>Antony Stone</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Crash%3A%20every%201-2%20hour%3A%20kernel%3A%20Out%20of%20memory%3A%0A%09Kill%20process%20%28squid%29&In-Reply-To=%3C201612191239.51098.Antony.Stone%40squid.open.source.it%3E"
       TITLE="[squid-users] Crash: every 1-2 hour: kernel: Out of memory:	Kill process (squid)">Antony.Stone at squid.open.source.it
       </A><BR>
    <I>Mon Dec 19 11:39:50 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013819.html">[squid-users] Crash: every 1-2 hour: kernel: Out of memory:	Kill process (squid)
</A></li>
        <LI>Next message (by thread): <A HREF="013763.html">[squid-users] Cisco ASA with transparent Squid with HTTP/HTTPS	filtering
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13821">[ date ]</a>
              <a href="thread.html#13821">[ thread ]</a>
              <a href="subject.html#13821">[ subject ]</a>
              <a href="author.html#13821">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Monday 19 December 2016 at 12:34:19, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">noc at forceline.net</A> wrote:

&gt;<i> Anybody can help?
</I>&gt;<i> Maby I need to change mailing list?
</I>
Did you try the suggestions already made?

<A HREF="http://lists.squid-cache.org/pipermail/squid-users/2016-December/013777.html">http://lists.squid-cache.org/pipermail/squid-users/2016-December/013777.html</A>
<A HREF="http://lists.squid-cache.org/pipermail/squid-users/2016-December/013778.html">http://lists.squid-cache.org/pipermail/squid-users/2016-December/013778.html</A>
<A HREF="http://lists.squid-cache.org/pipermail/squid-users/2016-December/013780.html">http://lists.squid-cache.org/pipermail/squid-users/2016-December/013780.html</A>

Antony.

&gt;<i> &gt; -----Original Message-----
</I>&gt;<i> &gt; From: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">noc at forceline.net</A> [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">noc at forceline.net</A>]
</I>&gt;<i> &gt; Sent: Wednesday, December 14, 2016 2:40 PM
</I>&gt;<i> &gt; To: '<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>'
</I>&gt;<i> &gt; Subject: Crash: every 1-2 hour: kernel: Out of memory: Kill process
</I>&gt;<i> &gt; (squid)
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Hello. I wrote earlier in wrong location:
</I>&gt;<i> &gt; <A HREF="http://bugs.squid-cache.org/show_bug.cgi?id=4647">http://bugs.squid-cache.org/show_bug.cgi?id=4647</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; Squid eats all RAM, then eats all swap in a hour and killed by
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; kernel.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt;I was try to turn off cache, change squid version, change some
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; configuration parameters by this guide <A HREF="http://wiki.squid-">http://wiki.squid-</A>
</I>&gt;<i> &gt; cache.org/SquidFaq/SquidMemory except malloc, but nothing helps.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I made some config changes in accordance with the advice of Amos
</I>&gt;<i> &gt; Jeffries (via on). But it does not help.
</I>&gt;<i> &gt; This trouble somehow linked with https.
</I>&gt;<i> &gt; If wccp redirects only 80 port - works fine.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;   wccp2_service_info 70 protocol = tcp flags = dst_ip_hash priority =
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 231 ports = 80
</I>&gt;<i> &gt; If wccp redirects 443 too - then squid overflows and killed by kernel
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;   wccp2_service_info 70 protocol = tcp flags = dst_ip_hash priority =
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 231 ports = 80,443
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; ---Before it died (HTTPS on):
</I>&gt;<i> &gt; Mem:  16291720k total, 16125288k used,   166432k free,      540k
</I>&gt;<i> &gt; buffers
</I>&gt;<i> &gt; Swap:  8216568k total,  8112628k used,   103940k free,    27112k cached
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;   PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 30858 squid     20   0 22.7g  14g 3612 S  8.0 94.6  14:50.82 squid
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; # free -m
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;              total       used       free     shared    buffers
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; cached
</I>&gt;<i> &gt; Mem:         15909      15750        158          0          0
</I>&gt;<i> &gt; 26
</I>&gt;<i> &gt; -/+ buffers/cache:      15723        186
</I>&gt;<i> &gt; Swap:         8023       7936         87
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Start Time:	Sat, 10 Dec 2016 07:52:50 GMT
</I>&gt;<i> &gt; Current Time:	Sat, 10 Dec 2016 09:39:45 GMT
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Connection information for squid:
</I>&gt;<i> &gt; 	Number of clients accessing cache:	1305
</I>&gt;<i> &gt; 	Number of HTTP requests received:	193434
</I>&gt;<i> &gt; 	Number of ICP messages received:	0
</I>&gt;<i> &gt; 	Number of ICP messages sent:	0
</I>&gt;<i> &gt; 	Number of queued ICP replies:	0
</I>&gt;<i> &gt; 	Number of HTCP messages received:	0
</I>&gt;<i> &gt; 	Number of HTCP messages sent:	0
</I>&gt;<i> &gt; 	Request failure ratio:	 0.00
</I>&gt;<i> &gt; 	Average HTTP requests per minute since start:	1809.2
</I>&gt;<i> &gt; 	Average ICP messages per minute since start:	0.0
</I>&gt;<i> &gt; 	Select loop called: 4529796 times, 1.416 ms avg
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Cache information for squid:
</I>&gt;<i> &gt; 	Hits as % of all requests:	5min: 0.0%, 60min: 0.0%
</I>&gt;<i> &gt; 	Hits as % of bytes sent:	5min: 0.1%, 60min: -0.0%
</I>&gt;<i> &gt; 	Memory hits as % of hit requests:	5min: 0.0%, 60min: 0.0%
</I>&gt;<i> &gt; 	Disk hits as % of hit requests:	5min: 0.0%, 60min: 0.0%
</I>&gt;<i> &gt; 	Storage Swap size:	82044 KB
</I>&gt;<i> &gt; 	Storage Swap capacity:	80.1% used, 19.9% free
</I>&gt;<i> &gt; 	Storage Mem size:	107876 KB
</I>&gt;<i> &gt; 	Storage Mem capacity:	20.6% used, 79.4% free
</I>&gt;<i> &gt; 	Mean Object Size:	29.54 KB
</I>&gt;<i> &gt; 	Requests given to unlinkd:	9258
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Median Service Times (seconds)  5 min    60 min:
</I>&gt;<i> &gt; 	HTTP Requests (All):   0.10857  0.04519
</I>&gt;<i> &gt; 	Cache Misses:          0.01648  0.00678
</I>&gt;<i> &gt; 	Cache Hits:            0.00000  0.00000
</I>&gt;<i> &gt; 	Near Hits:             0.00000  0.00000
</I>&gt;<i> &gt; 	Not-Modified Replies:  0.00000  0.00000
</I>&gt;<i> &gt; 	DNS Lookups:           0.00860  0.00779
</I>&gt;<i> &gt; 	ICP Queries:           0.00000  0.00000
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Resource usage for squid:
</I>&gt;<i> &gt; 	UP Time:	6415.101 seconds
</I>&gt;<i> &gt; 	CPU Time:	902.767 seconds
</I>&gt;<i> &gt; 	CPU Usage:	14.07%
</I>&gt;<i> &gt; 	CPU Usage, 5 minute avg:	15.97%
</I>&gt;<i> &gt; 	CPU Usage, 60 minute avg:	13.96%
</I>&gt;<i> &gt; 	Maximum Resident Size: 62241760 KB
</I>&gt;<i> &gt; 	Page faults with physical i/o: 32647
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Memory accounted for:
</I>&gt;<i> &gt; 	Total accounted:       1073388 KB
</I>&gt;<i> &gt; 	memPoolAlloc calls:     12969
</I>&gt;<i> &gt; 	memPoolFree calls:   35802441
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; File descriptor usage for squid:
</I>&gt;<i> &gt; 	Maximum number of file descriptors:   100000
</I>&gt;<i> &gt; 	Largest file desc currently in use:   28744
</I>&gt;<i> &gt; 	Number of file desc currently in use: 28738
</I>&gt;<i> &gt; 	Files queued for open:                   0
</I>&gt;<i> &gt; 	Available number of file descriptors: 71262
</I>&gt;<i> &gt; 	Reserved number of file descriptors:   100
</I>&gt;<i> &gt; 	Store Disk files open:                   0
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Internal Data Structures:
</I>&gt;<i> &gt; 	 57337 StoreEntries
</I>&gt;<i> &gt; 	 54560 StoreEntries with MemObjects
</I>&gt;<i> &gt; 	 
</I>&gt;<i> &gt; 	    52 Hot Object Cache Items
</I>&gt;<i> &gt; 	  
</I>&gt;<i> &gt; 	  2777 on-disk objects
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; ---after:
</I>&gt;<i> &gt; /var/log/messages
</I>&gt;<i> &gt; kernel: 11733 total pagecache pages
</I>&gt;<i> &gt; kernel: 8957 pages in swap cache
</I>&gt;<i> &gt; kernel: Swap cache stats: add 21118384, delete 21109427, find
</I>&gt;<i> &gt; 12110273/12422740
</I>&gt;<i> &gt; kernel: Free swap  = 0kB
</I>&gt;<i> &gt; kernel: Total swap = 8216568kB
</I>&gt;<i> &gt; kernel: 4194303 pages RAM
</I>&gt;<i> &gt; kernel: 121373 pages reserved
</I>&gt;<i> &gt; kernel: 11781 pages shared
</I>&gt;<i> &gt; kernel: 4023631 pages non-shared
</I>&gt;<i> &gt; ...omitted...
</I>&gt;<i> &gt; kernel: Out of memory: Kill process 30858 (squid) score 954 or
</I>&gt;<i> &gt; sacrifice child
</I>&gt;<i> &gt; kernel: Killed process 30868, UID 23, (log_file_daemon) total-
</I>&gt;<i> &gt; vm:26640kB, anon-rss:48kB, file-rss:512kB
</I>&gt;<i> &gt; (squid-1): I don't handle this error well!
</I>&gt;<i> &gt; Dec 10 12:44:27 localhost squid[30855]: Squid Parent: (squid-1) process
</I>&gt;<i> &gt; 30858 exited due to signal 9 with status 0
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; In attach all /var/log/messages output.
</I>&gt;<i> &gt; Main task for the server is to block bad sites and bypass others on
</I>&gt;<i> &gt; same IPs.
</I>&gt;<i> &gt; Any ideas?
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; --
</I>&gt;<i> &gt; Sergey
</I>
-- 
What makes you think I know what I'm talking about?
I just have more O'Reilly books than most people.

                                                   Please reply to the list;
                                                         please *don't* CC me.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013819.html">[squid-users] Crash: every 1-2 hour: kernel: Out of memory:	Kill process (squid)
</A></li>
	<LI>Next message (by thread): <A HREF="013763.html">[squid-users] Cisco ASA with transparent Squid with HTTP/HTTPS	filtering
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13821">[ date ]</a>
              <a href="thread.html#13821">[ thread ]</a>
              <a href="subject.html#13821">[ subject ]</a>
              <a href="author.html#13821">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
