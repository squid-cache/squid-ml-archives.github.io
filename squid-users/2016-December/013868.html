<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Help: How to calculate all bytes when communicate with client for a request
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Help%3A%20How%20to%20calculate%20all%20bytes%20when%20communicate%0A%20with%20client%20for%20a%20request&In-Reply-To=%3CPS1PR01MB130668D47038EA8944175F6598930%40PS1PR01MB1306.apcprd01.prod.exchangelabs.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013863.html">
   <LINK REL="Next"  HREF="013871.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Help: How to calculate all bytes when communicate with client for a request</H1>
    <B>wei</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Help%3A%20How%20to%20calculate%20all%20bytes%20when%20communicate%0A%20with%20client%20for%20a%20request&In-Reply-To=%3CPS1PR01MB130668D47038EA8944175F6598930%40PS1PR01MB1306.apcprd01.prod.exchangelabs.com%3E"
       TITLE="[squid-users] Help: How to calculate all bytes when communicate with client for a request">edwin.zhou at hotmail.com
       </A><BR>
    <I>Wed Dec 21 04:09:37 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013863.html">[squid-users] Help: How to calculate all bytes when communicate with client for a request
</A></li>
        <LI>Next message (by thread): <A HREF="013871.html">[squid-users] Help: How to calculate all bytes when communicate with client for a request
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13868">[ date ]</a>
              <a href="thread.html#13868">[ thread ]</a>
              <a href="subject.html#13868">[ subject ]</a>
              <a href="author.html#13868">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Alex,


Many thanks for your reply and sorry for the misleading. In fact I just want to log the number of encrypted bytes received from the HTTPS client, not the decrypted HTTPS body sizes. Do you know how to do this?


I also build squid 3.5.23 with default parameter, and seems squid log still ignore the encrypted bytes(except &quot;CONNECT&quot; header) that the client send to squid server.


Below is two Get and Post commands and you can see there is no difference with their total size(%st 3520) in the logs:

curl --proxy 48.96.17.25:3128  <A HREF="https://showip.net">https://showip.net</A>
curl --proxy 48.96.17.25:3128 -d'test' <A HREF="https://showip.net">https://showip.net</A>

1482292236.816   1700 48.96.17.25 TCP_TUNNEL/200 3408 112 3520 0 112 CONNECT showip.net:443 - HIER_DIRECT/showip.net:23.253.100.206 -
1482292258.735   1234 48.96.17.25 TCP_TUNNEL/200 3408 112 3520 0 112 CONNECT showip.net:443 - HIER_DIRECT/showip.net:23.253.100.206 -

logformat in squid.conf is:
logformat squid %ts.%03tu %6tr %&gt;a %Ss/%03Hs %&lt;st %&gt;st %st %&lt;sh %&gt;sh %rm %ru %un %Sh/%&lt;A:%&lt;a %mt

For Https, %&gt;st is supposed to be &quot;Total bytes received from client&quot; and %st is supposed to be &quot;Total bytes received from client and sent to client&quot;, right? But why they have no change while the client send more data to squid server? Is this a bug?

Thanks for all your help!

Regards,
Edwin

________________________________
On 20 December 2016 at 16:38, Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:

&gt;<i> I want to calculate all bytes when a request is sent to squid,
</I>
According to squid.conf.documented, you can use the following logformat
%codes to get unencrypted HTTP request sizes:


&gt;<i> including:
</I>
&gt;<i>  1. the header length that client will send to squid
</I>
[http::]&gt;sh     Size of request headers received from client


&gt;<i>  2. the post content length that send to squid
</I>
[http::]&gt;st     Total size of request received from client.

minus

[http::]&gt;sh     Size of request headers received from client


&gt;<i>  3. the response length squid will reply to client
</I>

[http::]&lt;st     Total size of reply sent to client (after adaptation)

minus

[http::]&lt;sh     Size of reply headers sent to client (after adaptation)


Please note that you need Squid v3.5.22 or later for many size-related
logformat %codes to work reasonably well in some environments. There
were many size logging bugs in earlier versions!

If some of these %codes do not work in your tests with the latest Squid,
please consider filing a but report with an isolated test case
illustrating the problem.


&gt;<i> I don't need to know the request content, just want to know how many
</I>&gt;<i> bytes the client totally send including the post and https bytes, is it
</I>&gt;<i> possible to do this?
</I>
The only way to measure the size of encrypted HTTP message parts is to
decrypt that message. Thus, if you want to log HTTPS POST body sizes (as
opposed to just the number of encrypted bytes received from the HTTPS
client), then you have to tell Squid to decrypt that traffic. In most
cases, decryption is not worth the associated headaches if you just want
to log sizes.


HTH,

Alex.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20161221/266d9413/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20161221/266d9413/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013863.html">[squid-users] Help: How to calculate all bytes when communicate with client for a request
</A></li>
	<LI>Next message (by thread): <A HREF="013871.html">[squid-users] Help: How to calculate all bytes when communicate with client for a request
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13868">[ date ]</a>
              <a href="thread.html#13868">[ thread ]</a>
              <a href="subject.html#13868">[ subject ]</a>
              <a href="author.html#13868">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
