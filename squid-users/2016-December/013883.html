<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Bypassed Proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Bypassed%20Proxy&In-Reply-To=%3C11A1F1B6-1047-473A-AF1C-974BCB0777AF%40solcv.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013878.html">
   <LINK REL="Next"  HREF="013884.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Bypassed Proxy</H1>
    <B>Sameh Onaissi</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Bypassed%20Proxy&In-Reply-To=%3C11A1F1B6-1047-473A-AF1C-974BCB0777AF%40solcv.com%3E"
       TITLE="[squid-users] Bypassed Proxy">sameh.onaissi at solcv.com
       </A><BR>
    <I>Thu Dec 22 21:02:56 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013878.html">[squid-users] Bypassed Proxy
</A></li>
        <LI>Next message (by thread): <A HREF="013884.html">[squid-users] Bypassed Proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13883">[ date ]</a>
              <a href="thread.html#13883">[ thread ]</a>
              <a href="subject.html#13883">[ subject ]</a>
              <a href="author.html#13883">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,


Eliezer&#8217;s recommended fix did not work.

The user was on YouTube watching UFC all day today.

Here&#8217;s a copy of the log at the time.
1482436450.285    353 10.0.0.105 TAG_NONE/200 0 CONNECT 167.114.159.186:443 - ORIGINAL_DST/167.114.159.186 -
1482436450.303      0 10.0.0.105 TAG_NONE/503 4462 CONNECT s.youtube.com&lt;<A HREF="http://s.youtube.com">http://s.youtube.com</A>&gt;:443 - HIER_NONE/- text/html
1482436450.318   4756 10.0.0.105 TAG_NONE/200 0 CONNECT 139.59.225.84:443 - ORIGINAL_DST/139.59.225.84 -
1482436450.340      0 10.0.0.105 TAG_NONE/503 4456 CONNECT s.youtube.com&lt;<A HREF="http://s.youtube.com">http://s.youtube.com</A>&gt;:443 - HIER_NONE/- text/html
1482436450.567    839 10.0.0.105 TAG_NONE/200 0 CONNECT 188.166.70.138:443 - ORIGINAL_DST/188.166.70.138 -
1482436450.585      0 10.0.0.105 TAG_NONE/503 4459 CONNECT s.youtube.com&lt;<A HREF="http://s.youtube.com">http://s.youtube.com</A>&gt;:443 - HIER_NONE/- text/html
1482436450.650    373 10.0.0.105 TAG_NONE/200 0 CONNECT 85.203.7.35:443 - ORIGINAL_DST/85.203.7.35 -
1482436450.669      0 10.0.0.105 TAG_NONE/503 4450 CONNECT s.youtube.com&lt;<A HREF="http://s.youtube.com">http://s.youtube.com</A>&gt;:443 - HIER_NONE/- text/html
1482436450.682   1969 10.0.0.105 TAG_NONE/200 0 CONNECT 139.59.225.84:443 - ORIGINAL_DST/139.59.225.84 -
1482436450.706    386 10.0.0.105 TAG_NONE/200 0 CONNECT 188.166.73.9:443 - ORIGINAL_DST/188.166.73.9 -
1482436450.740   6540 10.0.0.105 TAG_NONE/200 0 CONNECT 85.203.18.254:443 - ORIGINAL_DST/85.203.18.254 -
1482436450.784      0 10.0.0.105 TAG_NONE/503 4456 CONNECT s.youtube.com&lt;<A HREF="http://s.youtube.com">http://s.youtube.com</A>&gt;:443 - HIER_NONE/- text/html
1482436450.784      0 10.0.0.105 TAG_NONE/503 4453 CONNECT s.youtube.com&lt;<A HREF="http://s.youtube.com">http://s.youtube.com</A>&gt;:443 - HIER_NONE/- text/html
1482436450.784      0 10.0.0.105 TAG_NONE/503 4456 CONNECT s.youtube.com&lt;<A HREF="http://s.youtube.com">http://s.youtube.com</A>&gt;:443 - HIER_NONE/- text/html
1482436450.909    469 10.0.0.105 TAG_NONE/200 0 CONNECT 138.68.93.229:443 - ORIGINAL_DST/138.68.93.229 -
1482436450.927   1882 10.0.0.105 TAG_NONE/200 0 CONNECT 208.123.223.254:443 - ORIGINAL_DST/208.123.223.254 -
1482436450.940      0 10.0.0.105 TAG_NONE/503 4456 CONNECT s.youtube.com&lt;<A HREF="http://s.youtube.com">http://s.youtube.com</A>&gt;:443 - HIER_NONE/- text/html
1482436450.955      0 10.0.0.105 TAG_NONE/503 4462 CONNECT s.youtube.com&lt;<A HREF="http://s.youtube.com">http://s.youtube.com</A>&gt;:443 - HIER_NONE/- text/html
1482436451.063    197 10.0.0.105 TAG_NONE/200 0 CONNECT 208.123.223.254:443 - ORIGINAL_DST/208.123.223.254 -
1482436451.080      0 10.0.0.105 TAG_NONE/503 4462 CONNECT s.youtube.com&lt;<A HREF="http://s.youtube.com">http://s.youtube.com</A>&gt;:443 - HIER_NONE/- text/html
1482436451.217    434 10.0.0.105 TAG_NONE/200 0 CONNECT 138.68.97.9:443 - ORIGINAL_DST/138.68.97.9 -
1482436451.236      0 10.0.0.105 TAG_NONE/503 4450 CONNECT s.youtube.com&lt;<A HREF="http://s.youtube.com">http://s.youtube.com</A>&gt;:443 - HIER_NONE/- text/html
1482436451.322    271 10.0.0.105 TAG_NONE/200 0 CONNECT 65.52.108.76:443 - ORIGINAL_DST/65.52.108.76 -
1482436451.345    479 10.0.0.105 TAG_NONE/200 0 CONNECT 138.68.93.229:443 - ORIGINAL_DST/138.68.93.229 -
1482436451.361      0 10.0.0.105 TAG_NONE/503 4456 CONNECT s.youtube.com&lt;<A HREF="http://s.youtube.com">http://s.youtube.com</A>&gt;:443 - HIER_NONE/- text/html
1482436451.498   4240 10.0.0.105 TAG_NONE/200 0 CONNECT 139.59.225.84:443 - ORIGINAL_DST/139.59.225.84 -
1482436451.530      0 10.0.0.105 TAG_NONE/503 4456 CONNECT s.youtube.com&lt;<A HREF="http://s.youtube.com">http://s.youtube.com</A>&gt;:443 - HIER_NONE/- text/html
1482436451.909    817 10.0.0.105 TAG_NONE/200 0 CONNECT 188.166.70.138:443 - ORIGINAL_DST/188.166.70.138 -



I know 503 is an error, but the user was using youtube without any hassles.
Those IPs are for Digital Ocean and Alentus Corporation.

Squid is being &#8220;fooled&#8221; somehow.
 I did notice the 503, which made it more confusing to me.
The reason I investigated the issue was because I saw youtube working on the client&#8217;s PC with a blue shield-like icon along with some words on top of the youtube page (was not close enough to see the exact logo/words). The video was working fine, but that blue shield extension seems to be the reason behind &#8220;fooling&#8221; squid.

Both the chrome extension and the Desktop client are installed on the machine.

I tried replicating that, but I couldn&#8217;t even connect the client.

What should I be looking for in cache.log?


Thanks again!

Sam

On Dec 21, 2016, at 6:59 PM, Sameh Onaissi &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">sameh.onaissi at solcv.com</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">sameh.onaissi at solcv.com</A>&gt;&gt; wrote:





On Dec 21, 2016, at 6:51 PM, Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;&gt; wrote:

On 12/21/2016 10:14 AM, Sameh Onaissi wrote:

One user is somehow, able to access you tube through squid!

1482339083.228      0 10.0.0.162 TAG_NONE/503 4459 CONNECT s.youtube.com&lt;<A HREF="http://s.youtube.com">http://s.youtube.com</A>&gt;:443 - HIER_NONE/- text/html

What makes you think this user was able to access youtube? AFAICT, Squid
responded with an error (TAG_NONE/503) and did not contact the origin
server (HIER_NONE/-).

I did notice the 503, which made it more confusing to me.
The reason I investigated the issue was because I saw youtube working on the client&#8217;s PC with a blue shield-like icon along with some words on top of the youtube page (was not close enough to see the exact logo/words). The video was working fine, but that blue shield extension seems to be the reason behind &#8220;fooling&#8221; squid.

In any case, I applied the ACL&#8217;s to the squid.conf as Eliezer recommended, now I&#8217;ll wait till the user comes back in tomorrow to see if it worked.


I understand that you want Squid to redirect users instead of responding
with an error. This 503 response could be due to Squid being unable to
bump the user connection for some reason. Successful bumping is required
to redirect users.

You may see more details inside that error response itself. Others on
the list may be able to help you to get to that response in Squid logs
or packet captures.


HTH,

Alex.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20161222/ff8c7596/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20161222/ff8c7596/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013878.html">[squid-users] Bypassed Proxy
</A></li>
	<LI>Next message (by thread): <A HREF="013884.html">[squid-users] Bypassed Proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13883">[ date ]</a>
              <a href="thread.html#13883">[ thread ]</a>
              <a href="subject.html#13883">[ subject ]</a>
              <a href="author.html#13883">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
