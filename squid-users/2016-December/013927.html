<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid keep using one parent proxy while I have	multiple parent proxies
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20keep%20using%20one%20parent%20proxy%20while%20I%20have%0A%09multiple%20parent%20proxies&In-Reply-To=%3C54d1d59a53739622233651f862187e1f%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013906.html">
   <LINK REL="Next"  HREF="013899.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid keep using one parent proxy while I have	multiple parent proxies</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20keep%20using%20one%20parent%20proxy%20while%20I%20have%0A%09multiple%20parent%20proxies&In-Reply-To=%3C54d1d59a53739622233651f862187e1f%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid keep using one parent proxy while I have	multiple parent proxies">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Dec 29 07:47:46 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013906.html">[squid-users] Squid keep using one parent proxy while I have multiple parent proxies
</A></li>
        <LI>Next message (by thread): <A HREF="013899.html">[squid-users] squid 4.0.17 accept-encoding.. sending gzip?!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13927">[ date ]</a>
              <a href="thread.html#13927">[ thread ]</a>
              <a href="subject.html#13927">[ subject ]</a>
              <a href="author.html#13927">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2016-12-27 16:37, wei wrote:
&gt;<i> The curl command is:
</I>&gt;<i> 
</I>&gt;<i> curl -s -i <A HREF="http://showip.net">http://showip.net</A> [1]
</I>&gt;<i> 
</I>&gt;<i> The configuration in squid.conf is:
</I>&gt;<i> 
</I>&gt;<i> cache_peer 192.168.1.100 parent 3128 weight=5 no-query name=p1
</I>&gt;<i> round-robin
</I>&gt;<i> cache_peer 192.168.1.101 parent 3128 weight=5 no-query name=p2
</I>&gt;<i> round-robin
</I>&gt;<i> cache_peer 192.168.1.102 parent 3128 weight=5 no-query name=p3
</I>&gt;<i> round-robin
</I>
Since you have equal weightings on each peer they are irrelevant. Remove 
the weight=5 for better performance.


&gt;<i> 
</I>&gt;<i> cache_peer_domain p1 .com
</I>&gt;<i> cache_peer_domain p1 .net
</I>&gt;<i> cache_peer_domain p2 .com
</I>&gt;<i> cache_peer_domain p2 .net
</I>&gt;<i> cache_peer_domain p3 .com
</I>&gt;<i> cache_peer_domain p3 .net
</I>
Please use the cache_peer_access directive instead. cache_peer_domain is 
deprecated.


&gt;<i> From: wei
</I>&gt;<i> 
</I>&gt;<i> Hi Amos,
</I>&gt;<i> 
</I>&gt;<i> The Squid version I tested is 3.4.14(installed by yum on Centos 6.8)
</I>&gt;<i> and
</I>&gt;<i> 3.4.8(installed by apt on Debian 7), both have the problem of use same
</I>&gt;<i> parent proxy after about 55 seconds. I also test 3.5.23(compiled by
</I>&gt;<i> default
</I>&gt;<i> parameter) and found the time increased from 55 to 85 seconds or so.
</I>&gt;<i> Thanks.
</I>
I have just checked the code. The round-robin counters are 'cleared' on 
a 5min cycle, on startup, on reconfigure, or when peers change from DEAD 
to ALIVE state &quot;to prevent the revived CachePeer being flooded with 
requests which it has 'missed' during the down period.&quot;

So if your peers are being reset every minute, then either you are 
reconfiguring Squid that often, or they are constantly being detected as 
DEAD. Neither of which is good.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013906.html">[squid-users] Squid keep using one parent proxy while I have multiple parent proxies
</A></li>
	<LI>Next message (by thread): <A HREF="013899.html">[squid-users] squid 4.0.17 accept-encoding.. sending gzip?!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13927">[ date ]</a>
              <a href="thread.html#13927">[ thread ]</a>
              <a href="subject.html#13927">[ subject ]</a>
              <a href="author.html#13927">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
