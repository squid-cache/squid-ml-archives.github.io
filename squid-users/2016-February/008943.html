<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ext_ldap_group_acl not working
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ext_ldap_group_acl%20not%20working&In-Reply-To=%3C395666.66832.bm%40smtp107.mail.ir2.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008942.html">
   <LINK REL="Next"  HREF="008944.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ext_ldap_group_acl not working</H1>
    <B>Alessandro Sironi</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ext_ldap_group_acl%20not%20working&In-Reply-To=%3C395666.66832.bm%40smtp107.mail.ir2.yahoo.com%3E"
       TITLE="[squid-users] ext_ldap_group_acl not working">alesironi at yahoo.it
       </A><BR>
    <I>Mon Feb  1 10:40:08 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008942.html">[squid-users] TeamViewer and other http tunneled connections
</A></li>
        <LI>Next message (by thread): <A HREF="008944.html">[squid-users] ext_ldap_group_acl not working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8943">[ date ]</a>
              <a href="thread.html#8943">[ thread ]</a>
              <a href="subject.html#8943">[ subject ]</a>
              <a href="author.html#8943">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hello everyone 

I'm a newbie regarding SQUID and in general on Linux. 
I have an Active Directory environment (Windows Server 2012 R2) and a Linux Debian 8 Jessie configured in the same network. 
My goal is to install SQUID on Debian, integrate with Active Directory using Kerberos and autohise users to use SQUID based on Active Directory asecurity group membership lookup. 
Long story short, I followed the instructions here 
<A HREF="http://wiki.bitbinary.com/index.php/Active_Directory_Integrated_Squid_Proxy#Configure_Squid">http://wiki.bitbinary.com/index.php/Active_Directory_Integrated_Squid_Proxy#Configure_Squid</A>


My test environment:
Active Directory domain: KIDANEMEHRET.LOCAL 
test user: KIDANEMEHRET\test-full 
Security groups which is member of: &quot;Internet Users Full&quot;, &quot;Internet Users Standard&quot; 

Test done
After having&#160; properly configured my test client (Windows 7 joined to the domain), logged on with the test user KIDANEMEHRET\test-full, configured internet explorer to use the proxy, what I get everytime I try to browse the internet is a SQUID page telling me Access Denied. 

Quick Analisys
Having a look at access.log and cache.log (see attached), I understand that user is properly authenticated (I see KIDANEMEHRET\test-full properly written in each log). 
For this reason I suspect the problem is in the authorisation part. 

I try then to run from terminal the program used in SQUID.CONF to check authorisation (based on the wiki too); note that I'm running with sudo otherwise with standard use I get no access to password file: 

sudo /usr/lib/squid3/ext_ldap_group_acl -R -K -S -b &quot;dc=kidanemehret,dc=local&quot; -D <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid at kidanemehret.local</A> -W /etc/squid3/ldappass.txt -f &quot;(&amp;(objectclass=person)(sAMAccountName=%v) (memberof=cn=%g,ou=Service Accounts,ou=USR,dc=kidanemehret,dc=local))&quot; -h domcon.kidanemehret.local test-full Internet%20Users%20Full 
Do not get any result: waiting for minutes... 

Try to use KIDANEMEHRET\test-full instead of test-full without success. 

Most likely the problem is here. 

Do you have any suggestion on how to proceed next? 

Here you can find ACCESS.LOG, CACHE.LOG, KRB5.CONF and SQUID.CONF

<A HREF="http://1drv.ms/1nHDRXH">http://1drv.ms/1nHDRXH</A>

Thanks in advance

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160201/f3c43684/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160201/f3c43684/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008942.html">[squid-users] TeamViewer and other http tunneled connections
</A></li>
	<LI>Next message (by thread): <A HREF="008944.html">[squid-users] ext_ldap_group_acl not working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8943">[ date ]</a>
              <a href="thread.html#8943">[ thread ]</a>
              <a href="subject.html#8943">[ subject ]</a>
              <a href="author.html#8943">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
