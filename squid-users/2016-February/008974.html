<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3.5.13 -k rotate does not honor	store_id_children
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.13%20-k%20rotate%20does%20not%20honor%0A%09store_id_children&In-Reply-To=%3C56B0B530.80609%40xvidservices.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008973.html">
   <LINK REL="Next"  HREF="008976.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3.5.13 -k rotate does not honor	store_id_children</H1>
    <B>Veiko Kukk</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.13%20-k%20rotate%20does%20not%20honor%0A%09store_id_children&In-Reply-To=%3C56B0B530.80609%40xvidservices.com%3E"
       TITLE="[squid-users] Squid 3.5.13 -k rotate does not honor	store_id_children">vkukk at xvidservices.com
       </A><BR>
    <I>Tue Feb  2 13:54:56 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008973.html">[squid-users] Oracle Linux Server RPMs release 3.4.14 + 3.5.13
</A></li>
        <LI>Next message (by thread): <A HREF="008976.html">[squid-users] convert http requests to https on proxy setup.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8974">[ date ]</a>
              <a href="thread.html#8974">[ thread ]</a>
              <a href="subject.html#8974">[ subject ]</a>
              <a href="author.html#8974">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I have squid 3.5.13 using configuration like this:

# logfiles
access_log /var/log/squid/${service_name}_access.log
cache_log /var/log/squid/${service_name}_cache.log
# do not rotate logs, let logrotate do that
logfile_rotate 0
store_id_program /usr/lib64/squid/storeid_file_rewrite 
/var/spool/squid/store_id_db
store_id_children 20 startup=2

There are several squid instances running on same server, so logrotate 
postrotate script is specifying instance and configuration file:
'/usr/sbin/squid -nsquid0 -f /etc/squid/squid0.conf -k rotate 2&gt;/dev/null'

The problem is that after rotation, only one store id program children 
is left alive.

 From the squid0_cache.log:
2016/02/02 13:45:30| Set Current Directory to /var/spool/squid
2016/02/02 13:45:30 kid1| storeDirWriteCleanLogs: Starting...
2016/02/02 13:45:30 kid1|   Finished.  Wrote 401 entries.
2016/02/02 13:45:30 kid1|   Took 0.00 seconds (1610441.77 entries/sec).
2016/02/02 13:45:30 kid1| logfileRotate: 
stdio:/var/log/squid/squid0_access.log
2016/02/02 13:45:30 kid1| Rotate log file 
stdio:/var/log/squid/squid0_access.log
2016/02/02 13:45:30 kid1| helperOpenServers: Starting 1/20 
'storeid_file_rewrite' processes

And i can confirm that only single store id program proccess is running 
per squid instance.
Why does it start only one? May it be that some other configuration file 
lines are also ignored?

Best regards,
Veiko

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008973.html">[squid-users] Oracle Linux Server RPMs release 3.4.14 + 3.5.13
</A></li>
	<LI>Next message (by thread): <A HREF="008976.html">[squid-users] convert http requests to https on proxy setup.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8974">[ date ]</a>
              <a href="thread.html#8974">[ thread ]</a>
              <a href="subject.html#8974">[ subject ]</a>
              <a href="author.html#8974">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
