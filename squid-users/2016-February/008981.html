<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Debugging http_access and http_reply_access
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Debugging%20http_access%20and%20http_reply_access&In-Reply-To=%3C008f01d15e4a%24ca8af430%245fa0dc90%24%40filter.luko.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008980.html">
   <LINK REL="Next"  HREF="008982.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Debugging http_access and http_reply_access</H1>
    <B>squid-users at filter.luko.org</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Debugging%20http_access%20and%20http_reply_access&In-Reply-To=%3C008f01d15e4a%24ca8af430%245fa0dc90%24%40filter.luko.org%3E"
       TITLE="[squid-users] Debugging http_access and http_reply_access">squid-users at filter.luko.org
       </A><BR>
    <I>Wed Feb  3 06:19:08 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008980.html">[squid-users] convert http requests to https on proxy setup.
</A></li>
        <LI>Next message (by thread): <A HREF="008982.html">[squid-users] Debugging http_access and http_reply_access
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8981">[ date ]</a>
              <a href="thread.html#8981">[ thread ]</a>
              <a href="subject.html#8981">[ subject ]</a>
              <a href="author.html#8981">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Squid users,

I'm seeking some guidance regarding the best way to debug the http_access
and http_reply_access configuration statements on a moderately busy Squid
3.5 cache.  In cases where a number (say, 5 or more) of http_access lines
are present, the goal is to find which configuration statement (if any) was
found to match for a given request, then write this information to a log for
further processing.  Example:

http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
http_access allow localhost
http_access deny out_working_hours
http_access allow working_hours whitelist
http_access allow network
http_access deny all

Let's assume each of those lines have an index (0, 1, 2 thru 8 in the
example above).  Is there any way to find which one matched?

Explored so far: using debug_options to look at sections 33 (Client Side
Routines), 88 (Client-side Reply Routines) and 85 (Client Side Request
Routines) return useful information, but it's hard to use it to identify
(programmatically) which log entries relate to which request on a busy
cache.  Activating debug logging on a busy cache also doesn't seem like the
right approach.

Also explored: creating a pair of logformat and access_log statements
corresponding to each http_access and http_reply_access statement, with the
same ACL conditions as their policy counterparts.  The idea being to create
a log entry for each http_access and http_reply_access statement, to which
Squid will write matching requests.  This approach only partially achieves
the goal, because although it collects matching requests, it doesn't take
into account the sequential nature of policy rule processing.  Eg, in the
example above, even though a request to manager may be denied by rule 3, it
might still have matched the conditions associated with rule 7, and thus be
written to that log, even though it never hit that policy rule.

Are there any other debug sections which would be more appropriate to the
task?  If not, is there another more suitable approach?

Luke



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008980.html">[squid-users] convert http requests to https on proxy setup.
</A></li>
	<LI>Next message (by thread): <A HREF="008982.html">[squid-users] Debugging http_access and http_reply_access
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8981">[ date ]</a>
              <a href="thread.html#8981">[ thread ]</a>
              <a href="subject.html#8981">[ subject ]</a>
              <a href="author.html#8981">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
