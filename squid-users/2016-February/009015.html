<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Inject a banner on a couple of sites
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Inject%20a%20banner%20on%20a%20couple%20of%20sites&In-Reply-To=%3C56B50A09.6060904%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009014.html">
   <LINK REL="Next"  HREF="009017.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Inject a banner on a couple of sites</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Inject%20a%20banner%20on%20a%20couple%20of%20sites&In-Reply-To=%3C56B50A09.6060904%40ngtech.co.il%3E"
       TITLE="[squid-users] Inject a banner on a couple of sites">eliezer at ngtech.co.il
       </A><BR>
    <I>Fri Feb  5 20:46:01 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009014.html">[squid-users] Inject a banner on a couple of sites
</A></li>
        <LI>Next message (by thread): <A HREF="009017.html">[squid-users] Squid LDAP Auth ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9015">[ date ]</a>
              <a href="thread.html#9015">[ thread ]</a>
              <a href="subject.html#9015">[ subject ]</a>
              <a href="author.html#9015">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 05/02/2016 22:15, Alex Rousskov wrote:
&gt;<i> On 02/05/2016 02:58 AM, Travel Factory S.r.l. wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> &gt;I need to inject some javascript to show some warnings to my users when
</I>&gt;&gt;<i> &gt;they access a couple of external web sites.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;Is it possible to use squid for this, perhaps together with an icap server?
</I>&gt;<i> As Eliezer has answered already, yes, this is possible with ICAP or
</I>&gt;<i> eCAP. Eliezer answer focused on security implications that are probably
</I>&gt;<i> irrelevant to you (since you are the one doing the injection).
</I>
And if I may add that maybe not only for this post the information might 
be irrelevant but also for many of the squid users\admins.
I was really too unclear about why I am mentioning the video so...
The reason for that is that the implementation which explained in the 
video contains very basic helpful information on one way (injecting the 
JS before the closing &lt;/body&gt; tag) that the JS can be injected into the 
page.
There are couple other ways such as injecting any form of &lt;script&gt; or 
&lt;link&gt; tags after the &lt;head&gt; tag of the html page.
If the html is not huge or complex or that the link is not too slow it 
would be better to implement the injection in another way then &quot;in 
transit&quot; or &quot;in pass-thru&quot; but do it in couple steps.
- validate\find size and basic object mime type(not a must)
- download the whole html response
- validate that the content can be injected(maybe even add some debug 
for special cases that you will be interested investigating)
- find the right spot to inject and inject(concatenating the two ends of 
the page strings)
- Send to the client the injected response

And I must admit that I have seen more then one use of some variation of 
the above method being used to provide some protection on information on 
html pages, the latest I have seen is CloudFlare &quot;mailto&quot; and &quot;href&quot; JS 
replacement scripts which mask the real email or link address from 
&quot;non-smart&quot; robots that scan the net for attack victims.

All The Bests,
Eliezer Croitoru

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009014.html">[squid-users] Inject a banner on a couple of sites
</A></li>
	<LI>Next message (by thread): <A HREF="009017.html">[squid-users] Squid LDAP Auth ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9015">[ date ]</a>
              <a href="thread.html#9015">[ thread ]</a>
              <a href="subject.html#9015">[ subject ]</a>
              <a href="author.html#9015">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
