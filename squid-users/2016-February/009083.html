<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid Crashing
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20Crashing&In-Reply-To=%3C56BA61AB.80200%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009081.html">
   <LINK REL="Next"  HREF="009065.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid Crashing</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20Crashing&In-Reply-To=%3C56BA61AB.80200%40measurement-factory.com%3E"
       TITLE="[squid-users] Squid Crashing">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Feb  9 22:01:15 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009081.html">[squid-users] Squid Crashing
</A></li>
        <LI>Next message (by thread): <A HREF="009065.html">[squid-users] squid cache
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9083">[ date ]</a>
              <a href="thread.html#9083">[ thread ]</a>
              <a href="subject.html#9083">[ subject ]</a>
              <a href="author.html#9083">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 02/09/2016 02:54 PM, Rafael Akchurin wrote:

&gt;<i> If you need to **only** filter by IP/ CONNECT domain name/SNI then you
</I>&gt;<i> do not need to install Squid&#8217;s Root CA certificate onto your client
</I>&gt;<i> machines. 
</I>
This is correct.


&gt;<i> In this case indeed there is not much sense to use ICAP as for
</I>&gt;<i> it to work you **must** bump (otherwise you cannot &#8220;look into the SSL
</I>&gt;<i> stream&#8221;).
</I>
This is a little misleading because Squid does send CONNECT requests
(real and faked by SslBump) to ICAP and eCAP services where they can be
acted upon. CONNECT handling happens before connection bumping. Bumping
is necessary only if you want to look at or modify HTTP messages inside
the SSL/TLS connection.

Whether it is a good idea to use ICAP/eCAP for CONNECT-only filtering is
a complicated question, but it is _possible_.


Cheers,

Alex.



&gt;<i> *From:*Panda Admin [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">pandanonomous at gmail.com</A>]
</I>&gt;<i> *Sent:* Tuesday, February 9, 2016 10:43 PM
</I>&gt;<i> *To:* Rafael Akchurin &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rafael.akchurin at diladele.com</A>&gt;
</I>&gt;<i> *Cc:* <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at squid-cache.org</A>
</I>&gt;<i> *Subject:* Re: [squid-users] Squid Crashing
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> I would love to use another tool, however can your tools do ssl_bumping
</I>&gt;<i> aka filtering of HTTPS traffic WITHOUT putting a cert on the client
</I>&gt;<i> side? This is the only way I've been able to come up with to do both
</I>&gt;<i> HTTPS and HTTP Content Filtering using squid. 
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> Thanks for all advice:)
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> On Tue, Feb 9, 2016 at 3:50 PM, Rafael Akchurin
</I>&gt;<i> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rafael.akchurin at diladele.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rafael.akchurin at diladele.com</A>&gt;&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i>     Hello Panda Admin,
</I>&gt;<i> 
</I>&gt;<i>      
</I>&gt;<i> 
</I>&gt;<i>     If you do not mind looking at ICAP filtering instead of only URL
</I>&gt;<i>     filtering please take a look at our qlproxy (ICAP web filter for Squid).
</I>&gt;<i> 
</I>&gt;<i>     The shalla list formatted folders with categories can be used as is
</I>&gt;<i>     as third party blacklist provider and I presume takes less time to
</I>&gt;<i>     process upon start.
</I>&gt;<i> 
</I>&gt;<i>      
</I>&gt;<i> 
</I>&gt;<i>     Please note we currently do not support regexes in the list of
</I>&gt;<i>     domain names.
</I>&gt;<i> 
</I>&gt;<i>      
</I>&gt;<i> 
</I>&gt;<i>     Best regards,
</I>&gt;<i> 
</I>&gt;<i>     Rafael
</I>&gt;<i> 
</I>&gt;<i>      
</I>&gt;<i> 
</I>&gt;<i>     *From:*squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt;] *On Behalf Of
</I>&gt;<i>     *Panda Admin
</I>&gt;<i>     *Sent:* Tuesday, February 9, 2016 5:01 PM
</I>&gt;<i>     *To:* Kinkie &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">gkinkie at gmail.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">gkinkie at gmail.com</A>&gt;&gt;
</I>&gt;<i>     *Cc:* <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at squid-cache.org</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at squid-cache.org</A>&gt;
</I>&gt;<i>     *Subject:* Re: [squid-users] Squid Crashing
</I>&gt;<i> 
</I>&gt;<i>      
</I>&gt;<i> 
</I>&gt;<i>     I see that, but that's not possible. I still have system memory
</I>&gt;<i>     available.
</I>&gt;<i> 
</I>&gt;<i>     I just did a top while running squid, never went over 30% memory
</I>&gt;<i>     usage.  It maxed out the CPU but not the memory. So, yeah...still
</I>&gt;<i>     confused.
</I>&gt;<i> 
</I>&gt;<i>      
</I>&gt;<i> 
</I>&gt;<i>     On Tue, Feb 9, 2016 at 10:55 AM, Kinkie &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">gkinkie at gmail.com</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">gkinkie at gmail.com</A>&gt;&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i>         Hi,
</I>&gt;<i>           it's all in the logs you posted:
</I>&gt;<i> 
</I>&gt;<i>         ipcCreate: fork: (12) Cannot allocate memory
</I>&gt;<i>         WARNING: Cannot run '/lib/squid3/ssl_crtd' process.
</I>&gt;<i>         ...
</I>&gt;<i>         FATAL: Failed to create unlinkd subprocess
</I>&gt;<i> 
</I>&gt;<i>         You've run of system memory during startup.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>         On Tue, Feb 9, 2016 at 4:47 PM, Panda Admin
</I>&gt;<i>         &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">pandanonomous at gmail.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">pandanonomous at gmail.com</A>&gt;&gt; wrote:
</I>&gt;<i>         &gt; Hello,
</I>&gt;<i>         &gt;
</I>&gt;<i>         &gt; I am running squid 3.5.13 and it crashes with these errors:
</I>&gt;<i>         &gt;
</I>&gt;<i>         &gt; 2016/02/09 15:43:24 kid1| Set Current Directory to
</I>&gt;<i>         /var/spool/squid3
</I>&gt;<i>         &gt; 2016/02/09 15:43:24 kid1| Starting Squid Cache version 3.5.13 for
</I>&gt;<i>         &gt; x86_64-pc-linux-gnu...
</I>&gt;<i>         &gt; 2016/02/09 15:43:24 kid1| Service Name: squid
</I>&gt;<i>         &gt; 2016/02/09 15:43:24 kid1| Process ID 7279
</I>&gt;<i>         &gt; 2016/02/09 15:43:24 kid1| Process Roles: worker
</I>&gt;<i>         &gt; 2016/02/09 15:43:24 kid1| With 1024 file descriptors available
</I>&gt;<i>         &gt; 2016/02/09 15:43:24 kid1| Initializing IP Cache...
</I>&gt;<i>         &gt; 2016/02/09 15:43:24 kid1| DNS Socket created at [::], FD 6
</I>&gt;<i>         &gt; 2016/02/09 15:43:24 kid1| DNS Socket created at 0.0.0.0, FD 7
</I>&gt;<i>         &gt; 2016/02/09 15:43:24 kid1| Adding nameserver 10.31.2.78 from
</I>&gt;<i>         /etc/resolv.conf
</I>&gt;<i>         &gt; 2016/02/09 15:43:24 kid1| Adding nameserver 10.31.2.79 from
</I>&gt;<i>         /etc/resolv.conf
</I>&gt;<i>         &gt; 2016/02/09 15:43:24 kid1| Adding domain nuspire.com
</I>&gt;<i>         &lt;<A HREF="http://nuspire.com">http://nuspire.com</A>&gt; from /etc/resolv.conf
</I>&gt;<i>         &gt; 2016/02/09 15:43:24 kid1| helperOpenServers: Starting 5/10
</I>&gt;<i>         'ssl_crtd'
</I>&gt;<i>         &gt; processes
</I>&gt;<i>         &gt; 2016/02/09 15:43:24 kid1| ipcCreate: fork: (12) Cannot
</I>&gt;<i>         allocate memory
</I>&gt;<i>         &gt; 2016/02/09 15:43:24 kid1| WARNING: Cannot run
</I>&gt;<i>         '/lib/squid3/ssl_crtd'
</I>&gt;<i>         &gt; process.
</I>&gt;<i>         &gt; 2016/02/09 15:43:24 kid1| ipcCreate: fork: (12) Cannot
</I>&gt;<i>         allocate memory
</I>&gt;<i>         &gt; 2016/02/09 15:43:24 kid1| WARNING: Cannot run
</I>&gt;<i>         '/lib/squid3/ssl_crtd'
</I>&gt;<i>         &gt; process.
</I>&gt;<i>         &gt; 2016/02/09 15:43:24 kid1| ipcCreate: fork: (12) Cannot
</I>&gt;<i>         allocate memory
</I>&gt;<i>         &gt; 2016/02/09 15:43:24 kid1| WARNING: Cannot run
</I>&gt;<i>         '/lib/squid3/ssl_crtd'
</I>&gt;<i>         &gt; process.
</I>&gt;<i>         &gt; 2016/02/09 15:43:24 kid1| ipcCreate: fork: (12) Cannot
</I>&gt;<i>         allocate memory
</I>&gt;<i>         &gt; 2016/02/09 15:43:24 kid1| WARNING: Cannot run
</I>&gt;<i>         '/lib/squid3/ssl_crtd'
</I>&gt;<i>         &gt; process.
</I>&gt;<i>         &gt; 2016/02/09 15:43:24 kid1| ipcCreate: fork: (12) Cannot
</I>&gt;<i>         allocate memory
</I>&gt;<i>         &gt; 2016/02/09 15:43:24 kid1| WARNING: Cannot run
</I>&gt;<i>         '/lib/squid3/ssl_crtd'
</I>&gt;<i>         &gt; process.
</I>&gt;<i>         &gt; 2016/02/09 15:43:24 kid1| helperOpenServers: Starting 0/15
</I>&gt;<i>         'squidGuard'
</I>&gt;<i>         &gt; processes
</I>&gt;<i>         &gt; 2016/02/09 15:43:24 kid1| helperOpenServers: No 'squidGuard'
</I>&gt;<i>         processes
</I>&gt;<i>         &gt; needed.
</I>&gt;<i>         &gt; 2016/02/09 15:43:24 kid1| Logfile: opening log
</I>&gt;<i>         syslog:local5.info &lt;<A HREF="http://local5.info">http://local5.info</A>&gt;
</I>&gt;<i>         &gt; 2016/02/09 15:43:24 kid1| ipcCreate: fork: (12) Cannot
</I>&gt;<i>         allocate memory
</I>&gt;<i>         &gt; FATAL: Failed to create unlinkd subprocess
</I>&gt;<i>         &gt; Squid Cache (Version 3.5.13): Terminated abnormally.
</I>&gt;<i>         &gt; CPU Usage: 20.041 seconds = 19.115 user + 0.926 sys
</I>&gt;<i>         &gt; Maximum Resident Size: 4019840 KB
</I>&gt;<i>         &gt; Page faults with physical i/o: 0
</I>&gt;<i>         &gt;
</I>&gt;<i>         &gt;
</I>&gt;<i>         &gt; Anybody have an idea why?
</I>&gt;<i>         &gt;
</I>&gt;<i> 
</I>&gt;<i>         &gt; _______________________________________________
</I>&gt;<i>         &gt; squid-users mailing list
</I>&gt;<i>         &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>         &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i>         &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>         &gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>         --
</I>&gt;<i>             Francesco
</I>&gt;<i> 
</I>&gt;<i>      
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009081.html">[squid-users] Squid Crashing
</A></li>
	<LI>Next message (by thread): <A HREF="009065.html">[squid-users] squid cache
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9083">[ date ]</a>
              <a href="thread.html#9083">[ thread ]</a>
              <a href="subject.html#9083">[ subject ]</a>
              <a href="author.html#9083">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
