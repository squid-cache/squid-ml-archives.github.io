<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Reverse DNS Lookup for client IPs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Reverse%20DNS%20Lookup%20for%20client%20IPs&In-Reply-To=%3C56BED8AD.1030107%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009108.html">
   <LINK REL="Next"  HREF="009115.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Reverse DNS Lookup for client IPs</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Reverse%20DNS%20Lookup%20for%20client%20IPs&In-Reply-To=%3C56BED8AD.1030107%40treenet.co.nz%3E"
       TITLE="[squid-users] Reverse DNS Lookup for client IPs">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Feb 13 07:18:05 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009108.html">[squid-users] Reverse DNS Lookup for client IPs
</A></li>
        <LI>Next message (by thread): <A HREF="009115.html">[squid-users] Reverse DNS Lookup for client IPs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9109">[ date ]</a>
              <a href="thread.html#9109">[ thread ]</a>
              <a href="subject.html#9109">[ subject ]</a>
              <a href="author.html#9109">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 13/02/2016 10:15 a.m., Stefan H&#246;lzle wrote:
&gt;<i> I have some new insight:
</I>&gt;<i> The following line triggers the unwanted client ip ptr lookup:
</I>&gt;<i> 
</I>&gt;<i> ./src/client_side.cc:3590:
</I>&gt;<i> fqdncache_gethostbyaddr(clientConnection-&gt;remote, FQDN_LOOKUP_IF_MISS);
</I>&gt;<i> Source package:
</I>&gt;<i> <A HREF="http://www.squid-cache.org/Versions/v3/3.5/squid-3.5.10.tar.gz">http://www.squid-cache.org/Versions/v3/3.5/squid-3.5.10.tar.gz</A>
</I>&gt;<i> 
</I>&gt;<i> This line should only be called if Config.onoff.log_fqdn is 1.
</I>&gt;<i> 
</I>&gt;<i> Unfortunately Config.onoff.log_fqdn is set to 1:
</I>&gt;<i> squid-3.5.10 :) $ grep -rni Config.onoff.log_fqdn .
</I>&gt;<i> ./src/format/Token.cc:507:        Config.onoff.log_fqdn = 1;
</I>&gt;<i> ./src/client_side.cc:3081:        if (Config.onoff.log_fqdn)
</I>&gt;<i> ./src/client_side.cc:3184:    if (Config.onoff.log_fqdn)
</I>&gt;<i> ./src/client_side.cc:3589:    if (Config.onoff.log_fqdn)
</I>&gt;<i> ./src/log/FormatSquidIcap.cc:34:        if (Config.onoff.log_fqdn)
</I>&gt;<i> 
</I>&gt;<i> Config.onoff.log_fqdn is only set to 1 if &quot;&gt;A&quot; is contained in a
</I>&gt;<i> logformat. We only use default logformats.
</I>&gt;<i> 
</I>&gt;<i> There is only two configuration directives with a default logformat
</I>&gt;<i> %macro containing the string &quot;&gt;A&quot;:
</I>&gt;<i> url_rewrite_extras and store_id_extras
</I>&gt;<i> 
</I>&gt;<i> We don't use these directives.
</I>&gt;<i> 
</I>

Aha. Good catch. Sorry I missed that. There is no config fix for this
one I'm afraid. The damage is already done before squid.conf gets started.

To avoid the PTR being triggered you will have to alter the &quot;DEFAULT:&quot;
lines in src/cf.data.pre corresponding to those directives and rebuild.

The current behaviour is for backward compatibility with old squid.conf
using ancient helpers. Far too may people still using squidguard for
example, and nobody knows how many outdated custom ones. So patches
welcome, but they will have to retain that back-compat property.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009108.html">[squid-users] Reverse DNS Lookup for client IPs
</A></li>
	<LI>Next message (by thread): <A HREF="009115.html">[squid-users] Reverse DNS Lookup for client IPs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9109">[ date ]</a>
              <a href="thread.html#9109">[ thread ]</a>
              <a href="subject.html#9109">[ subject ]</a>
              <a href="author.html#9109">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
