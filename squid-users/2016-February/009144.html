<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Mutual authenticated SSL
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Mutual%20authenticated%20SSL&In-Reply-To=%3C56C33326.3090507%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009142.html">
   <LINK REL="Next"  HREF="009143.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Mutual authenticated SSL</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Mutual%20authenticated%20SSL&In-Reply-To=%3C56C33326.3090507%40treenet.co.nz%3E"
       TITLE="[squid-users] Mutual authenticated SSL">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Feb 16 14:33:10 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009142.html">[squid-users] Mutual authenticated SSL
</A></li>
        <LI>Next message (by thread): <A HREF="009143.html">[squid-users] Rock datastore, CFLAGS and a crash that (may be) known
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9144">[ date ]</a>
              <a href="thread.html#9144">[ thread ]</a>
              <a href="subject.html#9144">[ subject ]</a>
              <a href="author.html#9144">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 17/02/2016 3:11 a.m., <A HREF="https://lists.squid-cache.org/listinfo/squid-users">lucas2 at dds.nl</A> wrote:
&gt;<i> Hi List,
</I>&gt;<i> 
</I>&gt;<i> I am using Squid 3.1.23 as a reverse proxy. Client authentication to
</I>&gt;<i> backend servers is mandatory. All backend servers use client certificate
</I>&gt;<i> based authentication which I configure as follows:
</I>&gt;<i> cache_peer (...) ssl sslcert=/etc/squid/client-certs/client-cert.pem (...)
</I>&gt;<i> The .pem file is provided by the backend maintainers and they take care
</I>&gt;<i> of the server side of the client authentication process. The .pem file
</I>&gt;<i> also contains a private key.
</I>&gt;<i> This works fine.
</I>&gt;<i> 
</I>
Yes.  TLS requires each participant to have two keys. One public (in the
cert itself) and one private. Without both Squid cannot perform TLS.

In this configuration you happen to have both keys in the same .PEM
file. The private key should not be 'in the cert', just sitting next to
the cert in the same file.


&gt;<i> However now the maintainer of a backend server has supplied a server
</I>&gt;<i> certificate that has the &quot;client authentication eku enabled&quot;, which
</I>&gt;<i> &quot;should be sufficient for mutual authenticated SSL&quot;
</I>&gt;<i> 
</I>&gt;<i> It shows like this:
</I>&gt;<i> 
</I>&gt;<i> # openssl x509 -in server.crt -noout -text
</I>&gt;<i> (...)
</I>&gt;<i>    x509v3 Extended Key Usage:
</I>&gt;<i>        TLS Web Client Authentication, TLS Web Server Authentication,
</I>&gt;<i> E-mail Protection
</I>&gt;<i> (...)
</I>&gt;<i> 
</I>&gt;<i> When I use this certificate directly in my squid configuration I get an
</I>&gt;<i> error when loading the config: &quot;Failed to acquire SSL private key&quot;
</I>
This new .PEM file is missing the private key which is paired with that
certificate.

The person who generated the two keys and initiated the cert-request
process should be able to supply you with the private key Squid needs to
use that cert.


&gt;<i> 
</I>&gt;<i> Unfortunately my knowledge of SSL certificates is limited, and I do not
</I>&gt;<i> know exactly which mode of operation the backend maintainer intends to
</I>&gt;<i> use for mutual authentication. I can imagine, however, that it is
</I>&gt;<i> undesirable to share the private key of a server certificate.
</I>&gt;<i> 
</I>&gt;<i> So my question is:
</I>&gt;<i> - Is it possible, Squid reverse proxy, to use a certificate that has the
</I>&gt;<i> &quot;client authentication eku enabled&quot; to achieve client authentication?
</I>
Yes. EKU just restricts the certificate to being used on HTTP (&quot;Web&quot;)
connections. For example; you cannot install it into email software.
Outside that restriction it is essentially the same as the one you had
before.


&gt;<i> - How should this be configured?
</I>
Same as before if possible. With both cert and private key in the same .PEM.

If the private key is not allowed to be in the same .pem as the cert for
some reason, then you can configure Squid with a sslkey= parameter
pointing to a different .pem file with just the private key in it.
 Either way Squid needs both the cert and the private key to make use of it.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009142.html">[squid-users] Mutual authenticated SSL
</A></li>
	<LI>Next message (by thread): <A HREF="009143.html">[squid-users] Rock datastore, CFLAGS and a crash that (may be) known
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9144">[ date ]</a>
              <a href="thread.html#9144">[ thread ]</a>
              <a href="subject.html#9144">[ subject ]</a>
              <a href="author.html#9144">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
