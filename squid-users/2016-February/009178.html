<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Rock datastore, CFLAGS and a crash that (may be) known
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Rock%20datastore%2C%0A%20CFLAGS%20and%20a%20crash%20that%20%28may%20be%29%20known&In-Reply-To=%3C56C4A332.9040003%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009193.html">
   <LINK REL="Next"  HREF="009189.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Rock datastore, CFLAGS and a crash that (may be) known</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Rock%20datastore%2C%0A%20CFLAGS%20and%20a%20crash%20that%20%28may%20be%29%20known&In-Reply-To=%3C56C4A332.9040003%40ngtech.co.il%3E"
       TITLE="[squid-users] Rock datastore, CFLAGS and a crash that (may be) known">eliezer at ngtech.co.il
       </A><BR>
    <I>Wed Feb 17 16:43:30 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009193.html">[squid-users] Rock datastore, CFLAGS and a crash that (may be) known
</A></li>
        <LI>Next message (by thread): <A HREF="009189.html">[squid-users] Rock datastore,	CFLAGS and a crash that (may be) known
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9178">[ date ]</a>
              <a href="thread.html#9178">[ thread ]</a>
              <a href="subject.html#9178">[ subject ]</a>
              <a href="author.html#9178">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>So after reading the whole thread from top to bottom:
Since it's an ESXi version 6.0 with an Ubuntu 14.04 guest I would choose 
another approach!
You do not use any SSL related settings and it's a simple proxy(from the 
squid -v output) so I would ask &quot;did you tried to rebuild any deb file?&quot;
There might be some benefits from a special flag or more but from my 
experience with such VMs it would be very little in most cases.(I do not 
have tons of experience...)
I had experience with a bunch of Gentoo machines running all sort of web 
and Internet services on them for years. The claim for self compiling 
was that it is much efficient then pre-built binaries. The fact is that 
real hardware was faster\better then VMs (ESXi) either with pre-built or 
self-compiled binaries. So when moved from HW to VMs there were lots of 
things to test and confirm. Things like high CPU spikes or high DISK IO 
activity spikes which was pretty weird compared to the real HW.
Currently I have seen that VMs given enough vCPU, RAM and doing some 
fine tuning for balancing between VMs(..not throwing 24 vCPU per guest 
on a 24 cores host) and hosts gave for *these specific hosts* better 
performance then custom-compiling and flagging.

I have not built a Debian\Ubuntu deb package for a very long time but I 
had a plan to do so.
Maybe I will do it one day.

All The Bests,
Eliezer Croitoru

On 17/02/2016 15:36, Jester Purtteman wrote:
&gt;<i> Dear Eliezer, Amos and Marcus,
</I>&gt;<i>
</I>&gt;<i> Thank you, and sorry for the late reply, day jobs are a menace to productivity:)
</I>&gt;<i>
</I>&gt;<i> So, in order of responses:  Eliezer:
</I>&gt;&gt;<i> &gt;Before digging into the details of the issue, can you supply the OS details?
</I>&gt;&gt;<i> &gt;What OS are you using? What distribution?
</I>&gt;&gt;<i> &gt;32 or 64 bit?
</I>&gt;&gt;<i> &gt;can you also add the output of &quot;squid -v&quot; for both 3.5.14 and 3.5.13 ?
</I>&gt;<i> I am running Ubuntu 14.04.2 updated to the latest apt-get binaries, 64-bit version, 4 processors, 24-gb of &quot;ram&quot; allocated under the VM.  This is all on a vmware ESXi 6.0 host, so I recognize that compiler flags are probably a bit like throwing water balloons at Jaws from a performance stand point.  The counter point is, with performance as bad as a VM, you need all the help you can get.  As much as anything, it was a curiousity.
</I>&gt;<i>
</I>&gt;<i> Squid -v for a working configuration is as follows:
</I>&gt;<i>
</I>&gt;<i> Squid Cache: Version 3.5.14
</I>&gt;<i> Service Name: squid
</I>&gt;<i> configure options:  '--with-pthreads' '--prefix=/usr' '--localstatedir=/var' '--libexecdir=/usr/lib/squid' '--srcdir=.' '--datadir=/usr/share/squid' '--sysconfdir=/etc/squid' '--with-default-user=proxy' '--with-logdir=/var/log' '--with-pidfile=/var/run/squid.pid' '--enable-linux-netfilter' '--enable-cache-digests' '--enable-storeio=ufs,aufs,diskd,rock' '--enable-async-io=30' '--enable-http-violations' '--enable-zph-qos' '--with-netfilter-conntrack' '--with-filedescriptors=65536' '--with-large-files' --enable-ltdl-convenience
</I>&gt;<i>
</I>&gt;<i> I cut and pasted the configuration string I'd used with 3.5.13, added &quot;--with-pthreads&quot;, and had no problems.  Here is the working 3.5.13 -v output:
</I>&gt;<i>
</I>&gt;<i> Squid Cache: Version 3.5.13
</I>&gt;<i> Service Name: squid
</I>&gt;<i> configure options:  '--prefix=/usr' '--localstatedir=/var' '--libexecdir=/usr/lib/squid' '--srcdir=.' '--datadir=/usr/share/squid' '--sysconfdir=/etc/squid' '--with-default-user=proxy' '--with-logdir=/var/log' '--with-pidfile=/var/run/squid.pid' '--enable-linux-netfilter' '--enable-cache-digests' '--enable-storeio=ufs,aufs,diskd,rock' '--enable-async-io=30' '--enable-http-violations' '--enable-zph-qos' '--with-netfilter-conntrack' '--with-filedescriptors=65536' '--with-large-files' --enable-ltdl-convenience
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009193.html">[squid-users] Rock datastore, CFLAGS and a crash that (may be) known
</A></li>
	<LI>Next message (by thread): <A HREF="009189.html">[squid-users] Rock datastore,	CFLAGS and a crash that (may be) known
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9178">[ date ]</a>
              <a href="thread.html#9178">[ thread ]</a>
              <a href="subject.html#9178">[ subject ]</a>
              <a href="author.html#9178">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
