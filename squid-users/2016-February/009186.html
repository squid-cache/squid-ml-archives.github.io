<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] tcpkeepalive http_port directive
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20tcpkeepalive%20http_port%20directive&In-Reply-To=%3C56C4EAD7.3010600%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009184.html">
   <LINK REL="Next"  HREF="009191.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] tcpkeepalive http_port directive</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20tcpkeepalive%20http_port%20directive&In-Reply-To=%3C56C4EAD7.3010600%40treenet.co.nz%3E"
       TITLE="[squid-users] tcpkeepalive http_port directive">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Feb 17 21:49:11 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009184.html">[squid-users] tcpkeepalive http_port directive
</A></li>
        <LI>Next message (by thread): <A HREF="009191.html">[squid-users] bump files
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9186">[ date ]</a>
              <a href="thread.html#9186">[ thread ]</a>
              <a href="subject.html#9186">[ subject ]</a>
              <a href="author.html#9186">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 18/02/2016 9:00 a.m., Sebastien.Boulianne wrote:
&gt;<i> Hi all,
</I>&gt;<i> 
</I>&gt;<i> We host some online catalogs for a customers.
</I>&gt;<i> The online catalogs are slow to answer to the http requests sometimes.
</I>&gt;<i> 
</I>&gt;<i> I would like to extend the timeout that Squid show us.
</I>&gt;<i> 
</I>&gt;<i> I checked in the http_port directive and I saw that
</I>&gt;<i> tcpkeepalive[=idle,interval,timeout]
</I>&gt;<i>                           Enable TCP keepalive probes of idle connections.
</I>&gt;<i>                           In seconds; idle is the initial time before TCP starts
</I>&gt;<i>                           probing the connection, interval how often to probe, and
</I>&gt;<i>                           timeout the time before giving up.
</I>&gt;<i> 
</I>&gt;<i> How shoud I use it ?
</I>&gt;<i> Just like
</I>&gt;<i> http_port xx.xx.xx.xx:80 tcpkeepalive=60 accel defaultsite=... name=...
</I>&gt;<i> 
</I>
It is a Linux feature. I'm not sure of other systems support it, but
they might do its quite old.

Setting it without any values uses the default TCP keepalive settings.
You can see what those are with:

 cat /proc/sys/net/ipv4/tcp_keepalive_time
 cat /proc/sys/net/ipv4/tcp_keepalive_intvl
 cat /proc/sys/net/ipv4/tcp_keepalive_probes

You can set those at the system level with sysctl. Or you an set the
values in squid.conf so they apply only client connections received at
that http_port.

In Squid you configure tcp_keepalive_time with 'idle',
tcp_keepalive_intvl with 'interval', and tcp_keepalive_probes is
calculated for you based on what you set for the timeout of a probe.


One gotcha that I am aware of is that there exists NAT systems with
shorter NAT mapping timeouts (approx. 30sec) than TCP normally uses
(approx. 1-5min). If you want to keep alive connections going through
such systems you need an idle value below their NAT timeout.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009184.html">[squid-users] tcpkeepalive http_port directive
</A></li>
	<LI>Next message (by thread): <A HREF="009191.html">[squid-users] bump files
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9186">[ date ]</a>
              <a href="thread.html#9186">[ thread ]</a>
              <a href="subject.html#9186">[ subject ]</a>
              <a href="author.html#9186">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
