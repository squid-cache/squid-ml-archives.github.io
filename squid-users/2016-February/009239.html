<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Rock Store max object size 3.5.14
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Rock%20Store%20max%20object%20size%203.5.14&In-Reply-To=%3C56CCB93E.4030104%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009238.html">
   <LINK REL="Next"  HREF="009240.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Rock Store max object size 3.5.14</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Rock%20Store%20max%20object%20size%203.5.14&In-Reply-To=%3C56CCB93E.4030104%40treenet.co.nz%3E"
       TITLE="[squid-users] Rock Store max object size 3.5.14">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Feb 23 19:55:42 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009238.html">[squid-users] Rock Store max object size 3.5.14
</A></li>
        <LI>Next message (by thread): <A HREF="009240.html">[squid-users] Rock Store max object size 3.5.14
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9239">[ date ]</a>
              <a href="thread.html#9239">[ thread ]</a>
              <a href="subject.html#9239">[ subject ]</a>
              <a href="author.html#9239">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>[ pPS please dont hijack other peoples threads ... this has nothing to
do with YouTube ]

On 24/02/2016 8:11 a.m., Heiler Bemerguy wrote:
&gt;<i> 
</I>&gt;<i> Thanks Alex.
</I>&gt;<i> 
</I>&gt;<i> We have a simple cache_dir config like this, with no &quot;workers&quot; defined:
</I>&gt;<i> cache_dir rock /cache2 80000 min-size=0 max-size=32767
</I>&gt;<i> cache_dir aufs /cache 320000 96 256 min-size=32768
</I>&gt;<i> 
</I>&gt;<i> And we are suffering from a 100% CPU use by a single squid thread. We
</I>&gt;<i> have lots of ram, cores and disk space..
</I>
Squid is essentially single-threaded (not completely, so dual-core has
benefit, but close). Without SMP enabled you will not benefit from those
&quot;lots of cores&quot;.


&gt;<i> but also too many users:
</I>&gt;<i> Number of clients accessing cache:      1634
</I>&gt;<i> Number of HTTP requests received:       3276691
</I>&gt;<i> Average HTTP requests per minute since start:   12807.1
</I>&gt;<i> Select loop called: 60353401 times, 22.017 ms avg
</I>&gt;<i> 
</I>
What GHz rating is each CPU core?  200-250 RPS is roughly in the range I
would expect from a 1.xGHz core going full speed / 100% usage.

Are you using RAID on the disk storage? IME, RAID can more than halve
the speed of the proxy. Although the CPU thrashing effect is mostly
hidden away out of sight in the disk controller processor(s).


&gt;<i> Getting rid of this big aufs and spreading to many rock stores will
</I>&gt;<i> improve things here? I've already shrunk the acls and patterns/regexes etc
</I>&gt;<i> 
</I>
YMMV but I doubt it. AUFS has 64 disk I/O threads taking advantage of
those other cores. Without SMP rock is restricted to fewer threads for
its I/O and most work is being done by the main worker core anyway
without the disk IO portion.


With CPU maxing out as the bottleneck I would be looking at config
perforemance (you say you have done that already), then Squid SMP
workers as the next workaround. With disk efficiencies later if/when
they become relevant.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009238.html">[squid-users] Rock Store max object size 3.5.14
</A></li>
	<LI>Next message (by thread): <A HREF="009240.html">[squid-users] Rock Store max object size 3.5.14
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9239">[ date ]</a>
              <a href="thread.html#9239">[ thread ]</a>
              <a href="subject.html#9239">[ subject ]</a>
              <a href="author.html#9239">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
