<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Rock Store max object size 3.5.14
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Rock%20Store%20max%20object%20size%203.5.14&In-Reply-To=%3C56CCD0F4.5030202%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009248.html">
   <LINK REL="Next"  HREF="009284.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Rock Store max object size 3.5.14</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Rock%20Store%20max%20object%20size%203.5.14&In-Reply-To=%3C56CCD0F4.5030202%40ngtech.co.il%3E"
       TITLE="[squid-users] Rock Store max object size 3.5.14">eliezer at ngtech.co.il
       </A><BR>
    <I>Tue Feb 23 21:36:52 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009248.html">[squid-users] Rock Store max object size 3.5.14
</A></li>
        <LI>Next message (by thread): <A HREF="009284.html">[squid-users] Optimizing squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9249">[ date ]</a>
              <a href="thread.html#9249">[ thread ]</a>
              <a href="subject.html#9249">[ subject ]</a>
              <a href="author.html#9249">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey,

Some of the emails was probably off-list from some reason so responding 
here.

Since you are having some issues with the current way that the proxy 
works since it gets to 100% CPU and probably your clients\users 
suffering from an issue I would suggest to try another approach to get 
couple clear things into our\yout sight.

Stop using disk cache as a starter and make sure that the current basic 
CPU+RAM handles the traffic properly. Only after you somehow made sure 
that the proxy handles something right try to see what can be done with 
any form of cache_dir.

Since you have plenty of RAM and CORES see if *without* any cache_dir 
you are having any CPU issues.
If you still have then I would suggest to do two things simultaneously:
- disable access logs
- upper the workers number from the default 1 to more

If when the access logs are disabled and the cores number was bumped-up 
to the maximum you are probably having the wrong machine for the task.
If in some state that the access logs disabled and the number of cores 
was higher then 1 and not up to the maximum of the machine you hare 
having a somehow balanced CPU percentages you still have a chance to 
match the hardware to the task.
Then the next step would be to enabled the access logs and see how the 
machine holds only this.

The above method is the basic way to make sure you are on the right track.
If you need more advice just respond to email.

All The Bests,
Eliezer

On 23/02/2016 21:11, Heiler Bemerguy wrote:
&gt;<i>
</I>&gt;<i> Thanks Alex.
</I>&gt;<i>
</I>&gt;<i> We have a simple cache_dir config like this, with no &quot;workers&quot; defined:
</I>&gt;<i> cache_dir rock /cache2 80000 min-size=0 max-size=32767
</I>&gt;<i> cache_dir aufs /cache 320000 96 256 min-size=32768
</I>&gt;<i>
</I>&gt;<i> And we are suffering from a 100% CPU use by a single squid thread. We
</I>&gt;<i> have lots of ram, cores and disk space.. but also too many users:
</I>&gt;<i> Number of clients accessing cache:      1634
</I>&gt;<i> Number of HTTP requests received:       3276691
</I>&gt;<i> Average HTTP requests per minute since start:   12807.1
</I>&gt;<i> Select loop called: 60353401 times, 22.017 ms avg
</I>&gt;<i>
</I>&gt;<i> Getting rid of this big aufs and spreading to many rock stores will
</I>&gt;<i> improve things here? I've already shrunk the acls and patterns/regexes etc
</I>&gt;<i>
</I>&gt;<i> Best Regards,
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009248.html">[squid-users] Rock Store max object size 3.5.14
</A></li>
	<LI>Next message (by thread): <A HREF="009284.html">[squid-users] Optimizing squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9249">[ date ]</a>
              <a href="thread.html#9249">[ thread ]</a>
              <a href="subject.html#9249">[ subject ]</a>
              <a href="author.html#9249">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
