<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Optimizing squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Optimizing%20squid&In-Reply-To=%3C56CE17D5.9000000%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009286.html">
   <LINK REL="Next"  HREF="009288.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Optimizing squid</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Optimizing%20squid&In-Reply-To=%3C56CE17D5.9000000%40gmail.com%3E"
       TITLE="[squid-users] Optimizing squid">yvoinov at gmail.com
       </A><BR>
    <I>Wed Feb 24 20:51:33 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009286.html">[squid-users] Optimizing squid
</A></li>
        <LI>Next message (by thread): <A HREF="009288.html">[squid-users] Optimizing squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9287">[ date ]</a>
              <a href="thread.html#9287">[ thread ]</a>
              <a href="subject.html#9287">[ subject ]</a>
              <a href="author.html#9287">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256
 
It's simple. It is strange that you do not understand. Do you have a
thread on the CPU, the pending IO. Then comes another one. Third. Do you
think that makes the OS? It unloads it in a swap? Ha ha, with several
tens of gigabytes of RAM you have not found it necessary to create a
swap. Or the OS does not unload the active processes in the swap. What's
next? CPU becomes like a juggler with 600 oranges. He will sweat as you
think? The problem is compounded by the virtual environment. It has its
own cache? How it works with cache synchronization guest?

This is performance for dummies.

I've already told you, you need to look at what direction. To do it or
not - at your wish.

25.02.16 2:40, Heiler Bemerguy &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i>
</I>&gt;<i> Not to mention only 10GB of cache is almost useless for us... lol
</I>&gt;<i>
</I>&gt;<i> But I still think cpu is cpu and i/o is i/o. &quot;WAIT&quot; fields on both TOP
</I>and VMSTAT shows almost always a ZERO

Can you believe even in God. Squid makes heavy use of input-output and
keep in mind processors are directly connected with the input-output
subsystem.
&gt;<i>
</I>&gt;<i> Why would it show a process using cpu while actually it's waiting for
</I>a I/O.. ?

I told you. Use more appropriate tool than top itself to investigate
bottleneck. You can't see it directly.

&gt;<i>
</I>&gt;<i> Best Regards
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Heiler Bemerguy - (91) 98151-4894
</I>&gt;<i> Assessor T&#233;cnico - CINBESA (91) 3184-1751
</I>&gt;<i>
</I>&gt;<i> Em 24/02/2016 17:13, Yuri Voinov escreveu:
</I>&gt;<i> AFAIK, if you solve issue with cache_mem 10 GB and completely disabled
</I>&gt;<i> disk cache, then you had disk IO bottleneck exactly. You completely
</I>&gt;<i> disable disk caches. So, all obvious now.
</I>&gt;<i>
</I>&gt;<i> But - what you will do after squid restart? :))))))))))))) A deadly cold
</I>&gt;<i> memory cache, hehehe
</I>&gt;<i>
</I>&gt;<i> 25.02.16 1:44, Heiler Bemerguy &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;<i> &gt;&gt;&gt; Hi Eliezer, thanks for your reply.
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; As you've suggested, I removed all cache_dirs to verify if the rest
</I>&gt;<i> was stable/fast and raised cache_mem to 10GB. I didn't disable access
</I>&gt;<i> logs because we really need it..
</I>&gt;<i> &gt;&gt;&gt; And it is super fast, I can't even notice it using only ONE core..
</I>&gt;<i> (and it isn't running as smp)
</I>&gt;<i> &gt;&gt;&gt; %Cpu0  :  0,7 us,  1,0 sy,  0,0 ni, 98,3 id,  0,0 wa,  0,0 hi,  0,0
</I>&gt;<i> si,  0,0 st
</I>&gt;<i> &gt;&gt;&gt; %Cpu1  :  8,8 us,  5,6 sy,  0,0 ni, 76,1 id,  0,0 wa,  0,0 hi,  9,5
</I>&gt;<i> si,  0,0 st
</I>&gt;<i> &gt;&gt;&gt; %Cpu2  :  8,7 us,  4,0 sy,  0,0 ni, 83,3 id,  0,0 wa,  0,0 hi,  4,0
</I>&gt;<i> si,  0,0 st
</I>&gt;<i> &gt;&gt;&gt; %Cpu3  :  5,4 us,  3,4 sy,  0,0 ni, 86,2 id,  0,0 wa,  0,0 hi,  5,0
</I>&gt;<i> si,  0,0 st
</I>&gt;<i> &gt;&gt;&gt; %Cpu4  :  7,8 us,  5,1 sy,  0,0 ni, 73,5 id,  6,8 wa,  0,0 hi,  6,8
</I>&gt;<i> si,  0,0 st
</I>&gt;<i> &gt;&gt;&gt; %Cpu5  :  1,0 us,  1,0 sy,  0,0 ni, 98,0 id,  0,0 wa,  0,0 hi,  0,0
</I>&gt;<i> si,  0,0 st
</I>&gt;<i> &gt;&gt;&gt;   PID USER      PR  NI  VIRT  RES  SHR S  %CPU %MEM    TIME+ COMMAND
</I>&gt;<i> &gt;&gt;&gt; 11604 proxy     20   0 11,6g  11g 5232 S  48,4 72,2  72:31.24 squid
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Start Time:     Wed, 24 Feb 2016 15:38:59 GMT
</I>&gt;<i> &gt;&gt;&gt; Current Time:   Wed, 24 Feb 2016 19:18:30 GMT
</I>&gt;<i> &gt;&gt;&gt; Connection information for squid:
</I>&gt;<i> &gt;&gt;&gt;         Number of clients accessing cache:      1433
</I>&gt;<i> &gt;&gt;&gt;         Number of HTTP requests received:       2532800
</I>&gt;<i> &gt;&gt;&gt;         Average HTTP requests per minute since start:   11538.5
</I>&gt;<i> &gt;&gt;&gt;         Select loop called: 68763019 times, 0.192 ms avg
</I>&gt;<i> &gt;&gt;&gt;         Storage Mem size:       9874500 KB
</I>&gt;<i> &gt;&gt;&gt;         Storage Mem capacity:   94.2% used,  5.8% free
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; I don't think I had a bottleneck on I/O itself, maybe the hash/search
</I>&gt;<i> of cache indexes was too much for a single thread?
</I>&gt;<i> &gt;&gt;&gt; Best Regards,
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBCAAGBQJWzhfUAAoJENNXIZxhPexGlloIALSld4PZGTKbdAdQFHntDKkz
7tWH69kRPRUh7aSmQKmedqrEDXnz4N/dnWOvfzw3IGkpXPUqRk3OtJTpve/iC8Tz
TPUSETRAyedYm8OT1hwzqcdQ04AykFjB6Kg+cGn0eAtkruhviHDIbMiB9bMyAi2E
WURGPqLkzPjKJzuHPWkLfE1tg82lOyybBIL0fC5gDG45Yb4yIykVNjQA829LdQah
orh/iBSWV0OUSm9FXgbowXfNniBAiJohJbv9Ykux+uSEaQhlPm3/nXdRrl4yliYR
iamYe/JiBNKeKaF1GdwwSvUzYRdmXfN32HaEaCLrpu6UtOFpctSY+e2fu+AHb2c=
=vNyO
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160225/4abaed1c/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160225/4abaed1c/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x613DEC46.asc
Type: application/pgp-keys
Size: 2437 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160225/4abaed1c/attachment.key">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160225/4abaed1c/attachment.key</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009286.html">[squid-users] Optimizing squid
</A></li>
	<LI>Next message (by thread): <A HREF="009288.html">[squid-users] Optimizing squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9287">[ date ]</a>
              <a href="thread.html#9287">[ thread ]</a>
              <a href="subject.html#9287">[ subject ]</a>
              <a href="author.html#9287">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
