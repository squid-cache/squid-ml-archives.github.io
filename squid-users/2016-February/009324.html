<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Optimizing squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Optimizing%20squid&In-Reply-To=%3C56CF4B92.1020009%40cinbesa.com.br%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009323.html">
   <LINK REL="Next"  HREF="009325.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Optimizing squid</H1>
    <B>Heiler Bemerguy</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Optimizing%20squid&In-Reply-To=%3C56CF4B92.1020009%40cinbesa.com.br%3E"
       TITLE="[squid-users] Optimizing squid">heiler.bemerguy at cinbesa.com.br
       </A><BR>
    <I>Thu Feb 25 18:44:34 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009323.html">[squid-users] Optimizing squid
</A></li>
        <LI>Next message (by thread): <A HREF="009325.html">[squid-users] Optimizing squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9324">[ date ]</a>
              <a href="thread.html#9324">[ thread ]</a>
              <a href="subject.html#9324">[ subject ]</a>
              <a href="author.html#9324">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Since it started with both cache_dirs...


Em 25/02/2016 15:32, Yuri Voinov escreveu:
&gt;<i>
</I>&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i> Hash: SHA256
</I>&gt;<i>
</I>&gt;<i> Don't think so.
</I>&gt;<i>
</I>&gt;<i> This messages floods all time?
</I>&gt;<i>
</I>&gt;<i> 26.02.16 0:17, Heiler Bemerguy &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;<i> &gt; &gt; I waited squid -z to finish.. did a &quot;ps auxw |grep squid&quot; a dozen 
</I>&gt;<i> times to check.. THEN I started it. &gt; It may have tried to serve 
</I>&gt;<i> something, as lots of users we're already conecting to it right after 
</I>&gt;<i> it started, but I'm still seeing a flood of warnings on error.log: &gt; &gt; 
</I>&gt;<i> &gt; /2016/02/25 15:06:38 kid1| WARNING: swapfile header inconsistent 
</I>&gt;<i> with available data// &gt; //2016/02/25 15:06:38 kid1| WARNING: swapfile 
</I>&gt;<i> header inconsistent with available data// &gt; //2016/02/25 15:06:38 
</I>&gt;<i> kid1| WARNING: swapfile header inconsistent with available data// &gt; 
</I>&gt;<i> //2016/02/25 15:06:39 kid1| WARNING: swapfile header inconsistent with 
</I>&gt;<i> available data/ &gt; &gt; It's curious that with only one cache_dir (the 
</I>&gt;<i> first one), I didn't receive any of these errors... &gt; Maybe the 
</I>&gt;<i> non-rounded &quot;4097&quot; value is causing an issue? &gt; &gt; Best Regards, &gt; &gt; -- 
</I>&gt;<i> &gt; Heiler Bemerguy - (91) 98151-4894 &gt; Assessor T&#233;cnico - CINBESA (91) 
</I>&gt;<i> 3184-1751 &gt; &gt; &gt; Em 25/02/2016 14:18, Amos Jeffries escreveu: &gt;&gt; On 
</I>&gt;<i> 26/02/2016 5:58 a.m., Heiler Bemerguy wrote: &gt;&gt;&gt; Hi Alex, Eliezer, 
</I>&gt;<i> Yuri, Amos.. &gt;&gt;&gt; &gt;&gt;&gt; So, to start from the start, after seeing squid 
</I>&gt;<i> was totally stable and &gt;&gt;&gt; fast, running with NO cache_dirs, I tried 
</I>&gt;<i> to add only 2 rockstore &gt;&gt;&gt; cache_dirs to test. &gt;&gt;&gt; &gt;&gt;&gt; conf: &gt;&gt;&gt; 
</I>&gt;<i> /cache_dir rock /cache2/rock1 20000 min-size=0 max-size=4096 &gt;&gt;&gt; 
</I>&gt;<i> slot-size=2048// &gt;&gt;&gt; //cache_dir rock /cache2/rock2 30000 
</I>&gt;<i> min-size=4097 max-size=16384 &gt;&gt;&gt; slot-size=4096/ &gt;&gt;&gt; (ps.: I know it 
</I>&gt;<i> would be nice to use one store PER partition/disk/lun &gt;&gt;&gt; whatever.. 
</I>&gt;<i> but I'm trying to lessen disk wasting by using small &gt;&gt;&gt; slot-sizes 
</I>&gt;<i> for small files.. am I wrong?) &gt;&gt;&gt; &gt;&gt;&gt; Then squid -z: &gt;&gt;&gt; /2016/02/25 
</I>&gt;<i> 13:42:00 kid2| Creating Rock db: /cache2/rock1/rock// &gt;&gt;&gt; //2016/02/25 
</I>&gt;<i> 13:42:00 kid3| Creating Rock db: /cache2/rock2/rock/ &gt;&gt;&gt; &gt;&gt;&gt; Then 
</I>&gt;<i> running squid for the first time with these newly created rock &gt;&gt;&gt; 
</I>&gt;<i> stores.... &gt;&gt;&gt; &gt;&gt;&gt; /2016/02/25 13:42:09 kid3| Loading cache_dir #1 
</I>&gt;<i> from /cache2/rock2/rock// &gt;&gt;&gt; //2016/02/25 13:42:09 kid2| Loading 
</I>&gt;<i> cache_dir #0 from /cache2/rock1/rock// &gt;&gt;&gt; //2016/02/25 13:42:09 kid3| 
</I>&gt;<i> Store rebuilding is 0.01% complete// &gt;&gt;&gt; //2016/02/25 13:42:09 kid2| 
</I>&gt;<i> Store rebuilding is 0.01% complete/ &gt;&gt;&gt; &gt;&gt;&gt; Rebuilding what? just 
</I>&gt;<i> creating the huge files I think... &gt;&gt; The cache index for those rock 
</I>&gt;<i> DB. &gt;&gt; &gt;&gt; Unlike UFS which stores a swap.state file, rock rebuilds its 
</I>&gt;<i> index on &gt;&gt; each startup. &gt;&gt; &gt;&gt;&gt; Then: &gt;&gt;&gt; /2016/02/25 13:42:19 kid1| 
</I>&gt;<i> WARNING: swapfile header inconsistent with &gt;&gt;&gt; available data &gt;&gt;&gt; 
</I>&gt;<i> 2016/02/25 13:42:21 kid2| WARNING: cache_dir[0]: Ignoring malformed 
</I>&gt;<i> &gt;&gt;&gt; cache entry meta data at 6943832064 &gt;&gt; &lt;snip repeats&gt; &gt;&gt;&gt; 
</I>&gt;<i> 2016/02/25 13:42:40 kid1| ctx: enter level  0: &gt;&gt;&gt; 
</I>&gt;<i> '<A HREF="http://static.bn-static.com/pg/0plcB0QjJpBbwN7rMMDjKKO5Z63Nhu3zfPw==.gif">http://static.bn-static.com/pg/0plcB0QjJpBbwN7rMMDjKKO5Z63Nhu3zfPw==.gif</A>' 
</I>&gt;<i> &gt;&gt;&gt; 2016/02/25 13:42:40 kid1| WARNING: swapfile header inconsistent 
</I>&gt;<i> with &gt;&gt;&gt; available data &gt;&gt;&gt; 2016/02/25 13:42:40 kid2| WARNING: 
</I>&gt;<i> cache_dir[0]: Ignoring malformed &gt;&gt;&gt; cache entry meta data at 
</I>&gt;<i> 19581075456 &gt;&gt;&gt; 2016/02/25 13:42:41 kid2| WARNING: cache_dir[0]: 
</I>&gt;<i> Ignoring malformed &gt;&gt;&gt; cache entry meta data at 19757760512 &gt;&gt;&gt; 
</I>&gt;<i> 2016/02/25 13:42:43 kid2| Finished rebuilding storage from disk. &gt;&gt;&gt; 
</I>&gt;<i> 2016/02/25 13:42:43 kid2|   10239992 Entries scanned &gt;&gt;&gt; 2016/02/25 
</I>&gt;<i> 13:42:43 kid2|        14 Invalid entries./// &gt;&gt;&gt; &gt;&gt;&gt; What entry? why 
</I>&gt;<i> malformed? Wasn't it just a empty store?! it just &gt;&gt;&gt; created 
</I>&gt;<i> it....... &gt;&gt;&gt; &gt;&gt; &gt;&gt; Did you wait for the -z background processes to 
</I>&gt;<i> finish creating the 50GB &gt;&gt; of disk allocation before starting the 
</I>&gt;<i> main Squid process ? &gt;&gt; &gt;&gt; Are your workers trying to serve up traffic 
</I>&gt;<i> to or from the cache before &gt;&gt; the rebuild has completed? &gt;&gt; &gt;&gt; &gt;&gt; As 
</I>&gt;<i> you can see from the log timestamps on startup it will take ~30-60 &gt;&gt; 
</I>&gt;<i> sec for the rock caches of that size to be loaded in your system. &gt;&gt; 
</I>&gt;<i> &gt;&gt; &gt;&gt; Amos &gt;&gt; &gt;&gt; _______________________________________________ &gt;&gt; 
</I>&gt;<i> squid-users mailing list &gt;&gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &gt;&gt; 
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A> &gt; &gt; &gt; &gt; 
</I>&gt;<i> _______________________________________________ &gt; squid-users mailing 
</I>&gt;<i> list &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &gt; 
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i> -----BEGIN PGP SIGNATURE-----
</I>&gt;<i> Version: GnuPG v2
</I>&gt;<i>
</I>&gt;<i> iQEcBAEBCAAGBQJWz0ioAAoJENNXIZxhPexGqv0H/iumDpA03D6UDC7Px+Scdrgm
</I>&gt;<i> +u/Bnf7MbXRX4UptkoYZ0WdXfBUgaeGfQvajZRpegktqzdmf+tn85uS+JZ5tjtAN
</I>&gt;<i> /MBQLTFQiYzjiYEma3wH2GrhHdOHGAQytlO6vyP+KJXkj+XEZlKapfDxMe9jfe0P
</I>&gt;<i> PJ/6Q+zy+3LgGT4BnZzBN50YZ42RtQ5eF72W2t6y+XLDs6behYf2xqrtq0CGiOY8
</I>&gt;<i> KwtE3SsN601VAgbd4eZqbZT0tp8DO8/qAWHqnsu2goiTkjIyrBHWXO8Rx4fm9DCt
</I>&gt;<i> rUwuqzOncu/mWMXVrNlZdPSp39T05u3Wdi/eQU4E0F1OppPBMVp3+OrBIEvcHLE=
</I>&gt;<i> =LI6z
</I>&gt;<i> -----END PGP SIGNATURE-----
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
-- 
Heiler Bemerguy - (91) 98151-4894
Assessor T&#233;cnico - CINBESA (91) 3184-1751

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160225/9195ce7a/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160225/9195ce7a/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009323.html">[squid-users] Optimizing squid
</A></li>
	<LI>Next message (by thread): <A HREF="009325.html">[squid-users] Optimizing squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9324">[ date ]</a>
              <a href="thread.html#9324">[ thread ]</a>
              <a href="subject.html#9324">[ subject ]</a>
              <a href="author.html#9324">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
