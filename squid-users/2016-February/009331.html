<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Optimizing squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Optimizing%20squid&In-Reply-To=%3C56CF7588.3030306%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009330.html">
   <LINK REL="Next"  HREF="009348.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Optimizing squid</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Optimizing%20squid&In-Reply-To=%3C56CF7588.3030306%40measurement-factory.com%3E"
       TITLE="[squid-users] Optimizing squid">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Feb 25 21:43:36 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009330.html">[squid-users] Optimizing squid
</A></li>
        <LI>Next message (by thread): <A HREF="009348.html">[squid-users] Optimizing squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9331">[ date ]</a>
              <a href="thread.html#9331">[ thread ]</a>
              <a href="subject.html#9331">[ subject ]</a>
              <a href="author.html#9331">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 02/25/2016 01:19 PM, Heiler Bemerguy wrote:
&gt;&gt;&gt;<i> /2016/02/25 13:42:19 kid1| WARNING: swapfile header inconsistent with available data
</I>
&gt;&gt;<i> I do not know what causes these in your environment. Do you see them
</I>&gt;&gt;<i> when _not_ using any optional options on the cache_dir lines and not
</I>&gt;&gt;<i> sending any HTTP requests to Squid?
</I>

&gt;<i> I just disabled the &quot;optional options&quot; and run like this:
</I>
&gt;<i> cache_dir rock /cache2/rock1 20000
</I>&gt;<i> 
</I>&gt;<i> And even with a lot of connections coming in, NO errors or warnings this
</I>&gt;<i> time...
</I>
Glad you are making progress! I assume you ran &quot;squid -z&quot; after removing
slot-size=2048 but please correct me if my assumption is wrong.

I suspect the warnings are caused by rock index building code assuming
that one database slot is always enough to store cache entry metadata.
With a 2KB slot, some metadata (e.g., containing long Vary values) may
overflow into the next db slot. The metadata is probably stored
correctly, but the index building code does not load its tail, resulting
in warnings.

I recommend filing a bug report with Squid bugzilla about this,
referring to this email message.

As a work around, consider increasing your slot size. No supported size
will be 100% sufficient until the bug is fixed, but I speculate that
16KB should cover most cases. You may be able to go lower.
Unfortunately, I do not know what the store entry metadata size
distribution looks like [in your environment] and Squid does not really
report that, so I am just guessing, and you would have to experiment.


HTH,

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009330.html">[squid-users] Optimizing squid
</A></li>
	<LI>Next message (by thread): <A HREF="009348.html">[squid-users] Optimizing squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9331">[ date ]</a>
              <a href="thread.html#9331">[ thread ]</a>
              <a href="subject.html#9331">[ subject ]</a>
              <a href="author.html#9331">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
