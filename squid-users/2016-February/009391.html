<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Survey on assertions: When the impossible happens
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Survey%20on%20assertions%3A%20When%20the%20impossible%20happens&In-Reply-To=%3C56D214DC.40309%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009378.html">
   <LINK REL="Next"  HREF="009413.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Survey on assertions: When the impossible happens</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Survey%20on%20assertions%3A%20When%20the%20impossible%20happens&In-Reply-To=%3C56D214DC.40309%40treenet.co.nz%3E"
       TITLE="[squid-users] Survey on assertions: When the impossible happens">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Feb 27 21:27:56 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009378.html">[squid-users] Survey on assertions: When the impossible happens
</A></li>
        <LI>Next message (by thread): <A HREF="009413.html">[squid-users] Survey on assertions: When the impossible happens
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9391">[ date ]</a>
              <a href="thread.html#9391">[ thread ]</a>
              <a href="subject.html#9391">[ subject ]</a>
              <a href="author.html#9391">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 28/02/2016 7:52 a.m., joe wrote:
&gt;<i> right Asserts is the best choice for critical function im with you
</I>
define &quot;critical&quot;. It is not always obvious.


&gt;<i> on that in the other hand some function its not critical to have 
</I>&gt;<i> asserts just trace() or some other function to notify the cache log 
</I>
Now your cache.log / syslog fills with many KB per request as someone
DDoS your proxy with just a few bytes of input per request. That is
called a DoS amplifier.

Whole machine (not just Squid) crashes with disk space exhausted - DDoS
successful after sending only a few dozen MB or GB of traffic. Keep in
mind that DoS are reaching TB of traffic quickly, and the machine which
dies may not be Squid but a separate logging server, and the nature of
the crash may leave no clear evidence pointing back at the problem being
Squid or the small-DDoS.

There is no simple &quot;do this&quot; action to solve all _impossible_ situations.

People like yourself jumping to quick solutions, or baseing them on
outdated/wrong ideas without thinking the consequences over is why the
topic of letting admin have any control at all is controversial in the
first place.


&gt;<i> for warning and do not halt just keep running its choice of what
</I>&gt;<i> function need to have asserts or if the function not critical just
</I>&gt;<i> notification will do as of compiled code but for testing in lab some
</I>&gt;<i> function still has bad bug asserts is good for it don't know if other
</I>&gt;<i> guys agree so....
</I>
If that were true no assertions would ever occur in production machines.
We could thread the code with them and never worry. Perfect code and all
that.


The truth is as Alex said. That assertion happening is because an
&quot;impossible&quot; situation happened in production. If it did happen in
testing *at all* the dev changing the code would have removed the
assertion and added code to handle that case.
 It simply did not happen in testing. The dev thought it was impossible,
but had just enough paranoia to add an assert to bring attention to it
if it did.


This past weeks CVE is a very good example of that.

Squid has rather extensive controls over the size of messages it received:

 * request_header_max_size and reply_header_max_size place an absolute
limit of 64KB or less on any mesage *total* mime header size
  - multiple lines and surrounding syntax bytes all less than 64KB total.

 * each individual line of that header must also be within 64KB if by
chance the admin chooses to raise that limit.

 * these are carefully checked and enforced on arrival of data from all
network inputs *and* from disk cache.
 - in case someone fiddled with the disk entry. We have seen that happen.

Reasonable to assume that its impossible to receive a HTTP message with
single header line &gt;64KB, yes?
 Well, no. CVE-2016-2569 still happens. A single message header line can
reach far more than 64KB. The proof is an assertion.

Oh, and handling that situation instead of assert/crash and restarting
makes at least 3 other impossible situations / asserts happen later on
for Squid (well, 3 that we know of so far).


PS. Can you use some punctuation in future please.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009378.html">[squid-users] Survey on assertions: When the impossible happens
</A></li>
	<LI>Next message (by thread): <A HREF="009413.html">[squid-users] Survey on assertions: When the impossible happens
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9391">[ date ]</a>
              <a href="thread.html#9391">[ thread ]</a>
              <a href="subject.html#9391">[ subject ]</a>
              <a href="author.html#9391">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
