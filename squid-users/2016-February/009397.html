<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Ignore &quot;pragma:no-cache /cache-control:no-cache&quot; header in HTTP request&lt; config help&gt;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Ignore%20%22pragma%3Ano-cache%20/cache-control%3Ano-cache%22%0A%20header%20in%20HTTP%20request%3C%20config%20help%3E&In-Reply-To=%3C56D28E44.5000203%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009396.html">
   <LINK REL="Next"  HREF="009398.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Ignore &quot;pragma:no-cache /cache-control:no-cache&quot; header in HTTP request&lt; config help&gt;</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Ignore%20%22pragma%3Ano-cache%20/cache-control%3Ano-cache%22%0A%20header%20in%20HTTP%20request%3C%20config%20help%3E&In-Reply-To=%3C56D28E44.5000203%40treenet.co.nz%3E"
       TITLE="[squid-users] Ignore &quot;pragma:no-cache /cache-control:no-cache&quot; header in HTTP request&lt; config help&gt;">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Feb 28 06:05:56 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009396.html">[squid-users] Ignore &quot;pragma:no-cache /cache-control:no-cache&quot; header in HTTP request&lt; config help&gt;
</A></li>
        <LI>Next message (by thread): <A HREF="009398.html">[squid-users] Ignore &quot;pragma:no-cache /cache-control:no-cache&quot; header in HTTP request&lt; config help&gt;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9397">[ date ]</a>
              <a href="thread.html#9397">[ thread ]</a>
              <a href="subject.html#9397">[ subject ]</a>
              <a href="author.html#9397">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 28/02/2016 5:31 p.m., Anonymous cross wrote:
&gt;<i> Hi, Amos,
</I>&gt;<i> We are using forward tproxy . We used to redirect the packets coming  from
</I>&gt;<i> client for port 80 to squid proxy server. Squid spoofs the request and
</I>&gt;<i> establishes a connection with Server transparently. Please find the
</I>&gt;<i> configuration below
</I>&gt;<i> 
</I>&gt;<i> Client --- &gt; Squid proxy server --- &gt; web Server
</I>&gt;<i> 
</I>
You talk about TPROXY up here. But your config with the refresh pattern
is for the accel port domain.

If you are a legitimate reverse-proxy / CDN / accel - then intercepting,
even with TPROXY is just plain daft.


&gt;<i> =====
</I>&gt;<i> http_port 3128
</I>&gt;<i> http_port 3129 tproxy
</I>&gt;<i> http_port 80 accel defaultsite=abcexample.com
</I>&gt;<i> refresh_pattern -i abcexample.com/* 600 0% 600 override-expire
</I>&gt;<i> override-lastmod reload-into-ims ignore-reload
</I>&gt;<i> refresh_pattern -i abcexample2.com/* 600 0% 600 override-expire
</I>&gt;<i> override-lastmod reload-into-ims ignore-reload
</I>&gt;<i> =====
</I>
You can remove the &quot;/*&quot; part of those patterns, its just wasting config
file space and perhapse confusing you into thinking the '/' part is
being looked for by regex (the '*' cancels its existence out).


reload-into-ims and ignore-reload are mutually exclusive options. Squid
cannot both adjust a reload action and ignore it at the same time.
Remove the ignore-reload.

Add &quot;ignore-cc&quot; to the accel port line to ignore a Cache-Control
arriving from the clients.  No you cannot do the same on the tproxy line
without causing a lot of trouble.

You should seriously consider removing override-lastmod as well. That is
usually only used on dynamic content, which is important to keep up-to-date.


&gt;<i> 
</I>&gt;<i> Basically we want to increase the page load times by caching the images.
</I>
Then adjust your web server outputs to make that happen. Page times will
get even better if you allow cache in the ISPs closer to the clients to
store your images correctly instead of hacking your proxy config to be
the only one doing so efficiently.

The config above indicates that you are the owner of abcexample.com (or
they are a customer of yours) and thus in a position to get problems
like caching times for images fixed at the web server end.


&gt;<i> Sometimes the specific client is triggering HTTP request with cache-control
</I>&gt;<i> as no-cache. We want to mandate the packets coming from specific client to
</I>&gt;<i> be cached in squid to increase the page load times .  In order to avoid
</I>&gt;<i> serving the stale content we have configured a refresh pattern.
</I>&gt;<i> 
</I>
You have configured the refresh_pattern to force Squid to serve stale
content for up to 10 hours. It does not prevent the content being stale.
It just gets delivered by the proxy anyway.

This is kind of what I meant by there usually being a reason for seeing
no-cache.

If you have used refresh_pattern to force things to cache for long times
and the web server indicates they are not supposed to. Then you can
cause pages looking weird, not updating correctly, etc ...

 ... users press the force-refresh button in their browser to 'fix' the
page they see. Thus generating a no-cache or max-age=0 request (aka
reload) to try and make the page update properly.

 ... downstream caches think the content is constantly stale and
re-request updates for every user until they get something fresh.

These can waste more bandwidth and actually increase avg page load times
versus letting the objects get refreshed once every N requests.

Force-caching is a pretty popular pasttime. ISPs at least have a little
bit of excuse since they have no way to fix what the web server outputs.
As reverse-proxy operator you do.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009396.html">[squid-users] Ignore &quot;pragma:no-cache /cache-control:no-cache&quot; header in HTTP request&lt; config help&gt;
</A></li>
	<LI>Next message (by thread): <A HREF="009398.html">[squid-users] Ignore &quot;pragma:no-cache /cache-control:no-cache&quot; header in HTTP request&lt; config help&gt;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9397">[ date ]</a>
              <a href="thread.html#9397">[ thread ]</a>
              <a href="subject.html#9397">[ subject ]</a>
              <a href="author.html#9397">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
