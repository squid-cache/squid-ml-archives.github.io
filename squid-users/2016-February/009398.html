<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Ignore &quot;pragma:no-cache /cache-control:no-cache&quot; header in HTTP request&lt; config help&gt;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Ignore%20%22pragma%3Ano-cache%20/cache-control%3Ano-cache%22%0A%20header%20in%20HTTP%20request%3C%20config%20help%3E&In-Reply-To=%3CCAHAQXcp5PvUqTGxFEJOqwgoGnvs4KKU6DGAC80qMC%2BGm43hAWg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009397.html">
   <LINK REL="Next"  HREF="009403.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Ignore &quot;pragma:no-cache /cache-control:no-cache&quot; header in HTTP request&lt; config help&gt;</H1>
    <B>Anonymous cross</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Ignore%20%22pragma%3Ano-cache%20/cache-control%3Ano-cache%22%0A%20header%20in%20HTTP%20request%3C%20config%20help%3E&In-Reply-To=%3CCAHAQXcp5PvUqTGxFEJOqwgoGnvs4KKU6DGAC80qMC%2BGm43hAWg%40mail.gmail.com%3E"
       TITLE="[squid-users] Ignore &quot;pragma:no-cache /cache-control:no-cache&quot; header in HTTP request&lt; config help&gt;">anonymouscross at gmail.com
       </A><BR>
    <I>Sun Feb 28 07:18:08 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009397.html">[squid-users] Ignore &quot;pragma:no-cache /cache-control:no-cache&quot; header in HTTP request&lt; config help&gt;
</A></li>
        <LI>Next message (by thread): <A HREF="009403.html">[squid-users] Ignore &quot;pragma:no-cache /cache-control:no-cache&quot; header in HTTP request&lt; config help&gt;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9398">[ date ]</a>
              <a href="thread.html#9398">[ thread ]</a>
              <a href="subject.html#9398">[ subject ]</a>
              <a href="author.html#9398">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sorry for nagging.  We want to use both tproxy and accelerator mode. Mainly
tproxy for internet traffic and accelerator mode for web server. Also we
want to ignore cache control header in the HTTP requests destined for our
webserver (abcexample.com)  Does the below configuration work ? or Do we
need to do add IPtables rules?

http_port 3128
http_port 3129 tproxy
http_port 80 accel defaultsite=abcexample.com ignore-cc


cache_peer abcexample.com/data/ parent 80 0 no-query originserver
name=myAccel

acl our_sites dstdomain abcexample.com
http_access allow our_sites
cache_peer_access myAccel allow our_sites
cache_peer_access myAccel deny all

- Cross

On Sun, Feb 28, 2016 at 12:05 AM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
wrote:

&gt;<i> On 28/02/2016 5:31 p.m., Anonymous cross wrote:
</I>&gt;<i> &gt; Hi, Amos,
</I>&gt;<i> &gt; We are using forward tproxy . We used to redirect the packets coming
</I>&gt;<i> from
</I>&gt;<i> &gt; client for port 80 to squid proxy server. Squid spoofs the request and
</I>&gt;<i> &gt; establishes a connection with Server transparently. Please find the
</I>&gt;<i> &gt; configuration below
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Client --- &gt; Squid proxy server --- &gt; web Server
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> You talk about TPROXY up here. But your config with the refresh pattern
</I>&gt;<i> is for the accel port domain.
</I>&gt;<i>
</I>&gt;<i> If you are a legitimate reverse-proxy / CDN / accel - then intercepting,
</I>&gt;<i> even with TPROXY is just plain daft.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; =====
</I>&gt;<i> &gt; http_port 3128
</I>&gt;<i> &gt; http_port 3129 tproxy
</I>&gt;<i> &gt; http_port 80 accel defaultsite=abcexample.com
</I>&gt;<i> &gt; refresh_pattern -i abcexample.com/* 600 0% 600 override-expire
</I>&gt;<i> &gt; override-lastmod reload-into-ims ignore-reload
</I>&gt;<i> &gt; refresh_pattern -i abcexample2.com/* 600 0% 600 override-expire
</I>&gt;<i> &gt; override-lastmod reload-into-ims ignore-reload
</I>&gt;<i> &gt; =====
</I>&gt;<i>
</I>&gt;<i> You can remove the &quot;/*&quot; part of those patterns, its just wasting config
</I>&gt;<i> file space and perhapse confusing you into thinking the '/' part is
</I>&gt;<i> being looked for by regex (the '*' cancels its existence out).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> reload-into-ims and ignore-reload are mutually exclusive options. Squid
</I>&gt;<i> cannot both adjust a reload action and ignore it at the same time.
</I>&gt;<i> Remove the ignore-reload.
</I>&gt;<i>
</I>&gt;<i> Add &quot;ignore-cc&quot; to the accel port line to ignore a Cache-Control
</I>&gt;<i> arriving from the clients.  No you cannot do the same on the tproxy line
</I>&gt;<i> without causing a lot of trouble.
</I>&gt;<i>
</I>&gt;<i> You should seriously consider removing override-lastmod as well. That is
</I>&gt;<i> usually only used on dynamic content, which is important to keep
</I>&gt;<i> up-to-date.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Basically we want to increase the page load times by caching the images.
</I>&gt;<i>
</I>&gt;<i> Then adjust your web server outputs to make that happen. Page times will
</I>&gt;<i> get even better if you allow cache in the ISPs closer to the clients to
</I>&gt;<i> store your images correctly instead of hacking your proxy config to be
</I>&gt;<i> the only one doing so efficiently.
</I>&gt;<i>
</I>&gt;<i> The config above indicates that you are the owner of abcexample.com (or
</I>&gt;<i> they are a customer of yours) and thus in a position to get problems
</I>&gt;<i> like caching times for images fixed at the web server end.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Sometimes the specific client is triggering HTTP request with
</I>&gt;<i> cache-control
</I>&gt;<i> &gt; as no-cache. We want to mandate the packets coming from specific client
</I>&gt;<i> to
</I>&gt;<i> &gt; be cached in squid to increase the page load times .  In order to avoid
</I>&gt;<i> &gt; serving the stale content we have configured a refresh pattern.
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> You have configured the refresh_pattern to force Squid to serve stale
</I>&gt;<i> content for up to 10 hours. It does not prevent the content being stale.
</I>&gt;<i> It just gets delivered by the proxy anyway.
</I>&gt;<i>
</I>&gt;<i> This is kind of what I meant by there usually being a reason for seeing
</I>&gt;<i> no-cache.
</I>&gt;<i>
</I>&gt;<i> If you have used refresh_pattern to force things to cache for long times
</I>&gt;<i> and the web server indicates they are not supposed to. Then you can
</I>&gt;<i> cause pages looking weird, not updating correctly, etc ...
</I>&gt;<i>
</I>&gt;<i>  ... users press the force-refresh button in their browser to 'fix' the
</I>&gt;<i> page they see. Thus generating a no-cache or max-age=0 request (aka
</I>&gt;<i> reload) to try and make the page update properly.
</I>&gt;<i>
</I>&gt;<i>  ... downstream caches think the content is constantly stale and
</I>&gt;<i> re-request updates for every user until they get something fresh.
</I>&gt;<i>
</I>&gt;<i> These can waste more bandwidth and actually increase avg page load times
</I>&gt;<i> versus letting the objects get refreshed once every N requests.
</I>&gt;<i>
</I>&gt;<i> Force-caching is a pretty popular pasttime. ISPs at least have a little
</I>&gt;<i> bit of excuse since they have no way to fix what the web server outputs.
</I>&gt;<i> As reverse-proxy operator you do.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>


-- 
Regards,
Anonymous cross.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160228/b0e20ebe/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160228/b0e20ebe/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009397.html">[squid-users] Ignore &quot;pragma:no-cache /cache-control:no-cache&quot; header in HTTP request&lt; config help&gt;
</A></li>
	<LI>Next message (by thread): <A HREF="009403.html">[squid-users] Ignore &quot;pragma:no-cache /cache-control:no-cache&quot; header in HTTP request&lt; config help&gt;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9398">[ date ]</a>
              <a href="thread.html#9398">[ thread ]</a>
              <a href="subject.html#9398">[ subject ]</a>
              <a href="author.html#9398">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
