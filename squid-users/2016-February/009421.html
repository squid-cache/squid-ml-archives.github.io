<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Survey on assertions: When the impossible happens
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Survey%20on%20assertions%3A%20When%20the%20impossible%20happens&In-Reply-To=%3C56D47E51.9050002%40urlfilterdb.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009420.html">
   <LINK REL="Next"  HREF="009422.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Survey on assertions: When the impossible happens</H1>
    <B>Marcus Kool</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Survey%20on%20assertions%3A%20When%20the%20impossible%20happens&In-Reply-To=%3C56D47E51.9050002%40urlfilterdb.com%3E"
       TITLE="[squid-users] Survey on assertions: When the impossible happens">marcus.kool at urlfilterdb.com
       </A><BR>
    <I>Mon Feb 29 17:22:25 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009420.html">[squid-users] Survey on assertions: When the impossible happens
</A></li>
        <LI>Next message (by thread): <A HREF="009422.html">[squid-users] Survey on assertions: When the impossible happens
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9421">[ date ]</a>
              <a href="thread.html#9421">[ thread ]</a>
              <a href="subject.html#9421">[ subject ]</a>
              <a href="author.html#9421">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> * Choices.
</I>&gt;<i>
</I>&gt;<i> Overall, there are three options for handling an impossible situation:
</I>&gt;<i>
</I>&gt;<i> 1. Quit Squid process. This is what Squid does today in most cases.
</I>&gt;<i>     When the impossible happens, you get a crash. Very predictable.
</I>&gt;<i>     No malformed/corrupted/misleading HTTP messages (some are truncated).
</I>&gt;<i>     No memory leaks.
</I>&gt;<i>
</I>&gt;<i> 2. Quit the current processing sequence but keep Squid process running,
</I>&gt;<i>     assuming that [most] other processing sequences are not affected.
</I>&gt;<i>     [If you are familiar with programming, this is done by throwing
</I>&gt;<i>     exceptions instead of asserting and catching those exceptions at
</I>&gt;<i>     &quot;processing sequence&quot; boundaries].
</I>&gt;<i>
</I>&gt;<i> 3. Keep executing the current processing sequence, assuming that the
</I>&gt;<i>     assertion was wrong or unimportant. This is what you might be
</I>&gt;<i>     suggesting above. When the impossible happens, you may get a crash,
</I>&gt;<i>     memory leaks, malformed/corrupted/misleading HTTP messages, or normal
</I>&gt;<i>     behavior, depending on the assertion and traffic.
</I>&gt;<i>
</I>&gt;<i> IMO, we should make #2 the default, but make the choice between all
</I>&gt;<i> three options configurable by the admin (without recompiling Squid).
</I>
Let me suggest #4 :

immediately execute an external program that calls gdb or any other debugger
which produces a stack trace of all squid processes and then do #1 or #2.

The stack dumps will be save in an assertion failure log file which admins
can send to Squid developers.

This will speedup the debugging and fixing procedure.

Finally, there must be a mechanism that warns admins that an assertion failure
happened.  This is not trivial since an admin does not look every day
in the squid log file.

Marcus

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009420.html">[squid-users] Survey on assertions: When the impossible happens
</A></li>
	<LI>Next message (by thread): <A HREF="009422.html">[squid-users] Survey on assertions: When the impossible happens
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9421">[ date ]</a>
              <a href="thread.html#9421">[ thread ]</a>
              <a href="subject.html#9421">[ subject ]</a>
              <a href="author.html#9421">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
