<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] IIS error with one website
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20IIS%20error%20with%20one%20website&In-Reply-To=%3C56D4D3B8.6050307%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009428.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] IIS error with one website</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20IIS%20error%20with%20one%20website&In-Reply-To=%3C56D4D3B8.6050307%40ngtech.co.il%3E"
       TITLE="[squid-users] IIS error with one website">eliezer at ngtech.co.il
       </A><BR>
    <I>Mon Feb 29 23:26:48 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009428.html">[squid-users] IIS error with one website
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9429">[ date ]</a>
              <a href="thread.html#9429">[ thread ]</a>
              <a href="subject.html#9429">[ subject ]</a>
              <a href="author.html#9429">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Ryan,

I noticed that you are using a windows version of squid and ontop of 
that a 2.X version.
Technically this version is not supported anymore by the squid-cache 
project and from the settings either you are running a very old machine 
or something else not really known to me.
It's hard to know what is the difference in the request that squid does 
compared to BlueCoat or other proxies without sniffing the network.
And since it's a HTTP connection it would not be very hard to find the 
culprit with couple wireshark dumps.
The options I can think about are:
- squid 2 uses http/1.0 instead of http/1.1 which the service requires
- squid 2 adds something to the request that breaks the connection
- the upstream proxy(proxy1.ap.webscanningservice.com) is doing 
something to the connection.
- the combination of both squid2 and the upstream complicates things and 
the web application doesn't like it.

If you do have any way to upgrade the service from 2.X to anything newer 
do that instead of something else.
Try to take a look at:
<A HREF="http://squid.diladele.com/">http://squid.diladele.com/</A>

If you do have the option to run it on a Linux machine instead of a 
windows consider to do so.

If you want me to analyze the wireshark dumps from the proxy server send 
them privately.

Eliezer

On 01/03/2016 01:09, Ryan Slick wrote:
&gt;<i> Hi this is not an SSL site.
</I>&gt;<i>
</I>&gt;<i> Here is the config (I have stripped out the ACL's)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> #WELCOME TO SQUID 2
</I>&gt;<i> #------------------
</I>&gt;<i>
</I>&gt;<i> # NETWORK OPTIONS
</I>&gt;<i> #
</I>&gt;<i> -----------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> # OPTIONS WHICH AFFECT THE NEIGHBOR SELECTION ALGORITHM
</I>&gt;<i> #
</I>&gt;<i> -----------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> #  TAG: cache_peer
</I>&gt;<i>    cache_peer proxy1.ap.webscanningservice.com parent 3128 0000 default
</I>&gt;<i> no-query no-digest
</I>&gt;<i> # cache_peer proxy1.eu.webscanningservice.com parent 3128 0000 default
</I>&gt;<i> no-query no-digest
</I>&gt;<i> # cache_peer proxy1.us.webscanningservice.com parent 3128 0000 default
</I>&gt;<i> no-query no-digest
</I>&gt;<i> # cache_peer proxy1.hk.webscanningservice.com parent 3128 0000 default
</I>&gt;<i> no-query no-digest
</I>&gt;<i> # cache_peer proxy1.eu.webscanningservice.com parent 3128 0000 default
</I>&gt;<i> no-query no-digest
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> # disable local cache digest generation
</I>&gt;<i> digest_generation off
</I>&gt;<i>
</I>&gt;<i> #  TAG: hierarchy_stoplist
</I>&gt;<i> hierarchy_stoplist cgi-bin ?
</I>&gt;<i>
</I>&gt;<i> #define the all here as it will be used by the no_cache
</I>&gt;<i> acl all src 0.0.0.0/0.0.0.0
</I>&gt;<i> #  TAG: no_cache
</I>&gt;<i> cache deny all
</I>&gt;<i>
</I>&gt;<i> # OPTIONS WHICH AFFECT THE CACHE SIZE
</I>&gt;<i> #
</I>&gt;<i> -----------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> #  TAG: maximum_object_size(bytes)
</I>&gt;<i> maximum_object_size 0 KB
</I>&gt;<i>
</I>&gt;<i> # LOGFILE PATHNAMES AND CACHE DIRECTORIES
</I>&gt;<i> #
</I>&gt;<i> -----------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> log_uses_indirect_client on
</I>&gt;<i>
</I>&gt;<i> # Enable Log Rotation
</I>&gt;<i>
</I>&gt;<i> logfile_rotate 7
</I>&gt;<i>
</I>&gt;<i> #  TAG: emulate_httpd_logon|off
</I>&gt;<i> emulate_httpd_log on
</I>&gt;<i>
</I>&gt;<i> #  TAG: debug_options
</I>&gt;<i> debug_options ALL,1
</I>&gt;<i> #debug_options ALL,9
</I>&gt;<i>
</I>&gt;<i> #  By default, the store and access log is disabled to avoid large size
</I>&gt;<i> log files
</I>&gt;<i> cache_store_log none
</I>&gt;<i> access_log none
</I>&gt;<i> useragent_log none
</I>&gt;<i> #cache_log c:/ClientSiteProxy/var/logs/cache.log
</I>&gt;<i> #access_log C:/ClientSiteProxy/var/logs/access.log
</I>&gt;<i> cache_log D:/SquidDefinitions/logs/cache.log
</I>&gt;<i> access_log D:/SquidDefinitions/logs/access.log
</I>&gt;<i> #useragent_log c:/ClientSiteProxy/var/logs/useragent.log
</I>&gt;<i>
</I>&gt;<i> # IGNORE EXPECT 100 HTTP HEADER
</I>&gt;<i> #
</I>&gt;<i> -----------------------------------------------------------------------------
</I>&gt;<i> ignore_expect_100 on
</I>&gt;<i>
</I>&gt;<i> # OPTIONS FOR EXTERNAL SUPPORT PROGRAMS
</I>&gt;<i> #
</I>&gt;<i> -----------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> #  TAG: auth_param
</I>&gt;<i> auth_param ntlm program c:/clientsiteproxy/libexec/mswin_ntlm_auth.exe
</I>&gt;<i> auth_param ntlm children 80
</I>&gt;<i> auth_param ntlm keep_alive on
</I>&gt;<i>
</I>&gt;<i> # auth_param negotiate program
</I>&gt;<i> c:/clientsiteproxy/libexec/mswin_negotiate_auth.exe
</I>&gt;<i> auth_param negotiate children 80
</I>&gt;<i>
</I>&gt;<i> auth_param basic program c:/clientsiteproxy/libexec/ncsa_auth.exe
</I>&gt;<i> C:/clientsiteproxy/etc/passwd.txt
</I>&gt;<i> auth_param basic children 5
</I>&gt;<i> auth_param basic realm Squid proxy-caching web server
</I>&gt;<i> auth_param basic credentialsttl 2 hours
</I>&gt;<i> auth_param basic casesensitive off
</I>&gt;<i>
</I>&gt;<i> #  Use this tag to specify how long the IP authentication credentials
</I>&gt;<i> will be cached
</I>&gt;<i> #  If multiple users connect from a single IP (ie: terminal services)
</I>&gt;<i> comment out the
</I>&gt;<i> #  following line and uncomment the next.
</I>&gt;<i> #authenticate_ip_shortcircuit_ttl 30 seconds
</I>&gt;<i> authenticate_ip_shortcircuit_access none
</I>&gt;<i>
</I>&gt;<i> # OPTIONS FOR TUNING THE CACHE
</I>&gt;<i> #
</I>&gt;<i> -----------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> #  TAG: refresh_pattern
</I>&gt;<i> refresh_pattern ^ftp:144020%10080
</I>&gt;<i> refresh_pattern ^gopher:14400%1440
</I>&gt;<i> refresh_pattern .020%4320
</I>&gt;<i>
</I>&gt;<i> # TIMEOUTS
</I>&gt;<i> #
</I>&gt;<i> -----------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> read_timeout 15 minutes
</I>&gt;<i>
</I>&gt;<i> # X-Saucer
</I>&gt;<i> #
</I>&gt;<i> ------------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> # TAG: fqdn_xsaucer
</I>&gt;<i> # Turn this on if you wish to use fully qualified domain names instead of
</I>&gt;<i> # user names in X-Saucer. To do this Squid does a DNS lookup of all
</I>&gt;<i> # IP's connecting to it. This can (in some situations) increase
</I>&gt;<i> # latency, which makes your cache seem slower for interactive
</I>&gt;<i> # browsing. By default, it is off.
</I>&gt;<i> # The FQDN will be prepended with a backslash and converted to lower
</I>&gt;<i> case since
</I>&gt;<i> # ClientNet only accepts custom user name with backslash. If log_fqdn is
</I>&gt;<i> # also enabled, the FQDN will be logged in access.log.
</I>&gt;<i> # For example, an FQDN of www.XYz.com in access.log will require specifying
</I>&gt;<i> # a custom user &quot;\www.xyz.com&quot; (no quotes) in ClientNet.
</I>&gt;<i> #
</I>&gt;<i> # fqdn_xsaucer off
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> # TAG: hash_username_xsaucer
</I>&gt;<i> #Turn this on if you wish to apply hex representative of hashed(SHA-1)
</I>&gt;<i> #to domain name\user name (before encryption) in X-Saucer instead.
</I>&gt;<i> #
</I>&gt;<i> # hash_username_xsaucer off
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> # ACCESS CONTROLS
</I>&gt;<i> #
</I>&gt;<i> -----------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> #  TAG: acl
</I>&gt;<i> # TAG: disable password on conf file
</I>&gt;<i> #cachemgr_passwd none config
</I>&gt;<i> acl SSL_ports port 443 563 5443
</I>&gt;<i> acl Safe_ports port 80# http
</I>&gt;<i> acl Safe_ports port 21# ftp
</I>&gt;<i> acl Safe_ports port 443 563 5443# https, snews, medicare
</I>&gt;<i> acl Safe_ports port 70# gopher
</I>&gt;<i> acl Safe_ports port 210# wais
</I>&gt;<i> acl Safe_ports port 1025-65535# unregistered ports
</I>&gt;<i> acl Safe_ports port 280# http-mgmt
</I>&gt;<i> acl Safe_ports port 488# gss-http
</I>&gt;<i> acl Safe_ports port 591# filemaker
</I>&gt;<i> acl Safe_ports port 777# multiling http
</I>&gt;<i>
</I>&gt;<i> acl_uses_indirect_client on
</I>&gt;<i> acl CONNECT method CONNECT
</I>&gt;<i> acl authproxy proxy_auth REQUIRED
</I>&gt;<i> # the IP list of &quot;acl our_networks src&quot; may potentially be long while
</I>&gt;<i> the maximum number of characters supported by squid is around 500.
</I>&gt;<i> # therefore, you should try to splite long ip list to multiple lines for
</I>&gt;<i> readabilty and maintenability, see the following lines as an example:
</I>&gt;<i> # acl our_networks src x.x.x.x/z x.x.x.x/x x.x.x.x/z ....
</I>&gt;<i> # acl our_networks src y.y.y.y/z y.y.y.y/y y.y.y.y/z ....
</I>&gt;<i> acl our_networks src 192.168.0.0/16 172.16.0.0/12 10.0.0.0/8 169.254.0.0/16
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> # __________________________________________________________________________
</I>&gt;<i> acl HEAD method HEAD
</I>&gt;<i> follow_x_forwarded_for allow f5lb_prxy
</I>&gt;<i> #  TAG: http_access
</I>&gt;<i>
</I>&gt;<i> http_access allow manager localhost
</I>&gt;<i> http_access deny manager
</I>&gt;<i> http_access deny !Safe_ports
</I>&gt;<i> # __________________________________________________________________________
</I>&gt;<i> #http_access allow CONNECT SSL_ports
</I>&gt;<i> # __________________________________________________________________________
</I>&gt;<i> http_access deny CONNECT !SSL_ports
</I>&gt;<i> #Allow the header as IE does not process the Head authentication
</I>&gt;<i> http_access allow HEAD
</I>&gt;<i> http_access deny !our_networks
</I>&gt;<i> http_access allow Smartconnect
</I>&gt;<i> # __________________________________________________________________________
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> # __________________________________________________________________________
</I>&gt;<i> # NTLM bypasses and specific domain bypass come after this comment block.
</I>&gt;<i> # http_access = NTLM bypass. always_direct = bypasses the MessageLabs proxy
</I>&gt;<i> # and sends the connection directly. The first sample below creates a
</I>&gt;<i> bypass
</I>&gt;<i> # named 'uniqueBypass1' which bypasses NTLM and sends the connection
</I>&gt;<i> directly
</I>&gt;<i> # for sample.com. The second sample will bypass NTLM authentication for
</I>&gt;<i> # connections to sample.com.
</I>&gt;<i> # Begin Sample 1:
</I>&gt;<i> #acl uniqueBypass1 dstdomain sample.com
</I>&gt;<i> # http_access allow uniqueBypass1
</I>&gt;<i> # always_direct allow uniqueBypass1
</I>&gt;<i> # Begin Sample 2:
</I>&gt;<i> #acl NTLMBypass dstdomain sample.com
</I>&gt;<i> #http_access allow NTLMBypass
</I>&gt;<i>
</I>&gt;<i> http_access allow authproxy
</I>&gt;<i> http_access deny all
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> #  TAG: icp_access
</I>&gt;<i> icp_access allow all
</I>&gt;<i>
</I>&gt;<i> #  TAG: httpd_suppress_version_stringon|off
</I>&gt;<i> #Suppress Squid version string info in HTTP headers and HTML error pages.
</I>&gt;<i> #
</I>&gt;<i> httpd_suppress_version_string on
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> # ADMINISTRATIVE PARAMETERS
</I>&gt;<i> #
</I>&gt;<i> -----------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> #  TAG: visible_hostname
</I>&gt;<i> visible_hostname ClientSiteProxy
</I>&gt;<i>
</I>&gt;<i> # OPTIONS FOR THE CACHE REGISTRATION SERVICE
</I>&gt;<i> #
</I>&gt;<i> -----------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> # HTTPD-ACCELERATOR OPTIONS
</I>&gt;<i> #
</I>&gt;<i> -----------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> # MISCELLANEOUS
</I>&gt;<i> #
</I>&gt;<i> -----------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> # Forwarding proxy client IP addresses in X-Forwarded-For header.
</I>&gt;<i> # Disabled to prevent leakage of internal network configuration details.
</I>&gt;<i> forwarded_for truncate
</I>&gt;<i>
</I>&gt;<i> # Do not reveal CSP version in &quot;Via&quot; HTTP header
</I>&gt;<i> header_access Via deny all
</I>&gt;<i>
</I>&gt;<i> #  TAG: never_direct
</I>&gt;<i> never_direct allow all
</I>&gt;<i>
</I>&gt;<i> # DELAY POOL PARAMETERS (all require DELAY_POOLS compilation option)
</I>&gt;<i> #
</I>&gt;<i> -----------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> #  TAG: coredump_dir
</I>&gt;<i> #  completely disable checks for cache consistency (and/or garbage
</I>&gt;<i> collection) and
</I>&gt;<i> #  there will be no need to initialize cache dirs which amount to be
</I>&gt;<i> over 2000 dir.
</I>&gt;<i> cache_dir null c:/ClientSiteProxy
</I>&gt;<i> coredump_dir c:/clientsiteproxy/var/cache
</I>&gt;<i>
</I>&gt;<i> http_port 80
</I>&gt;<i> http_port 8080
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Tuesday, 1 March 2016 11:49 AM, Eliezer Croitoru
</I>&gt;<i> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Can you send me or the list your squid.conf?
</I>&gt;<i> Also are you using SSl-BUMP? is this a https site?
</I>&gt;<i>
</I>&gt;<i> Eliezer
</I>&gt;<i>
</I>&gt;<i> On 01/03/2016 00:36, Ryan Slick wrote:
</I>&gt;<i>  &gt; Hi Guys,
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; So here is an issue I am having,
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; there is a external website some of our users need to access. When
</I>&gt;<i>  &gt; accessing via the Squid proxy, the site throws this error on the page:
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; iisnode encountered an error when processing the request.
</I>&gt;<i>  &gt; HRESULT: 0xb
</I>&gt;<i>  &gt; HTTP status: 500
</I>&gt;<i>  &gt; HTTP reason: Internal Server Error
</I>&gt;<i>  &gt; You are receiving this HTTP 200 response because
</I>&gt;<i>  &gt; system.webServer/iisnode/@devErrorsEnabled
</I>&gt;<i>  &gt; &lt;mailto:system.webServer/iisnode/@devErrorsEnabled&gt; configuration
</I>&gt;<i>  &gt; setting is 'true'.
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; We configured on a pc that goes directly to the internet the page loads
</I>&gt;<i>  &gt; fine, when going via a bluecoat proxy on a different network it loads
</I>&gt;<i>  &gt; fine, When I put in a direct access rule on squid the error is still
</I>&gt;<i> thrown.
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; I am convinced the issue is on the external webserver, however it would
</I>&gt;<i>  &gt; appear squid is not playing nice with it, is there anything I can do to
</I>&gt;<i>  &gt; attempt to fix it? Now the users have tested on their remote devices and
</I>&gt;<i>  &gt; from home they are convinced the issue lies on the proxy.
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; regards
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt; _______________________________________________
</I>&gt;<i>  &gt; squid-users mailing list
</I>&gt;<i>  &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i>  &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i>  &gt;
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009428.html">[squid-users] IIS error with one website
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9429">[ date ]</a>
              <a href="thread.html#9429">[ thread ]</a>
              <a href="subject.html#9429">[ subject ]</a>
              <a href="author.html#9429">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
