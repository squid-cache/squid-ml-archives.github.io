<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Delay Pools or Traffic Shaping per port?!
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Delay%20Pools%20or%20Traffic%20Shaping%20per%20port%3F%21&In-Reply-To=%3C568A5B82.6040603%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008549.html">
   <LINK REL="Next"  HREF="008558.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Delay Pools or Traffic Shaping per port?!</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Delay%20Pools%20or%20Traffic%20Shaping%20per%20port%3F%21&In-Reply-To=%3C568A5B82.6040603%40treenet.co.nz%3E"
       TITLE="[squid-users] Delay Pools or Traffic Shaping per port?!">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Jan  4 11:46:10 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008549.html">[squid-users] Delay Pools or Traffic Shaping per port?!
</A></li>
        <LI>Next message (by thread): <A HREF="008558.html">[squid-users] Delay Pools or Traffic Shaping per port?!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8555">[ date ]</a>
              <a href="thread.html#8555">[ thread ]</a>
              <a href="subject.html#8555">[ subject ]</a>
              <a href="author.html#8555">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 4/01/2016 9:42 a.m., Christian Kunkel wrote:
&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> How many users do you have?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> i wanted to put about 200-500 users on a server. is that possible?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Certainly no problem for Squid, and I guess you could assign that number of 
</I>&gt;&gt;<i> separate listening ports for use one per user, but I'll let someone who knows 
</I>&gt;&gt;<i> more about Squid's internals for such an unusual setup comment on that if 
</I>&gt;&gt;<i> needed.
</I>&gt;<i> 
</I>&gt;<i> ok.
</I>
Squid is limited to 64 listening ports. That can be extended a little in
exchange for reducing Squid operating speed, but 200-500 is going very
far. This will cause problems with your stated goal of handling Gbps,
Squid will need some fine tuning to get near that speed as it is.

&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> - are you trying to limit the *inbound* bandwidth to Squid per user, or
</I>&gt;&gt;&gt;&gt;<i> the *outbound* bandwidth from Squid to each user?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> i want to limit the bandwidth. lets say user has 50mbit but i want him only
</I>&gt;&gt;&gt;<i> to use 10mbit.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So, that's the outbound bandwidth from Squid to the user, then?  You don't 
</I>&gt;&gt;<i> mind if Squid fetches the requested content faster than that if it can, and 
</I>&gt;&gt;<i> then feeds it to the user no faster than 10Mbps?
</I>&gt;<i> 
</I>&gt;<i> yep. that can work this way.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Is this limit true for all users - ie: is there a single bandwidth limit you 
</I>&gt;&gt;<i> want to apply to all users, or are you trying to set different limits for 
</I>&gt;&gt;<i> different users?
</I>&gt;<i> 
</I>&gt;<i> only one limit for every user.
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> - what's the primary reason for wanting to restrict the bandwidth per
</I>&gt;&gt;&gt;&gt;<i> user?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> server has not unlimited speed. better control of the server bandwidth.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> What total bandwidth are you dealing with?
</I>&gt;<i> 1gbit/s (but i guess its a bit less than that. maybe it will peak at 500mbit)
</I>&gt;&gt;<i> What's the server load when it runs into problems?
</I>&gt;<i> have not tested it so far with so many users.
</I>&gt;&gt;<i> How many concurrent user sessions do you have when the problems occur?
</I>&gt;<i> no problems right. cause not enough load.
</I>&gt;&gt;<i> What are the effects of the problems you're having?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Is there any reason you can't use authentication to identify different users?
</I>&gt;<i> it does not work with nated ips.
</I>
Authentication does.

&gt;<i> it autheticates with ip adress anyway.
</I>
That is *not* Authentication. That is IP based authorization (access
control).

&gt;<i> so it will limit the ip to 10mbit but behind that ip there are maybe 10 or more ppl.
</I>
With authentication each of these &quot;ppl&quot; has different credentials and
messages using those credentials are used to count the bandwidth shaping
towards each user.

If your system defines a &quot;user&quot; as being one IP address. Then the IP
address is what the traffic needs to be accounted against.

&gt;&gt;<i>
</I>&gt;&gt;<i> What stops users &quot;investigating&quot; the system, and finding out they can get extra 
</I>&gt;&gt;<i> bandwidth by using ports which haven't been assigned to them?
</I>&gt;<i> 
</I>&gt;<i> thats the second problem to deal with. there is some kind of a captive portal with login but it opens the port after user autheticates so actually someone else can use that port. so if you have an idea. i would be really thankful :)
</I>&gt;<i> 
</I>
FYI: the only thing that Squid can do that OS level QoS controls cannot
easily do is base its shaping on HTTP message header values (ie the
users proxy-auth credentials).

Since you want to do this shaping &quot;per-user&quot; without authentication
credentials to correctly identify what a single &quot;user&quot; actually is and
are instead basing the definition of &quot;user&quot; as stuff coming from an IP
address (that IP based authorization) - then OS level QoS controls
shaping the traffic based on IP address is the best you are going to
get. Despite the NAT related issues.

The captive portal device is the right place for the bandwidth shaping
to be enacted. It has access to both the original client IP and whatever
authentication details is uses.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008549.html">[squid-users] Delay Pools or Traffic Shaping per port?!
</A></li>
	<LI>Next message (by thread): <A HREF="008558.html">[squid-users] Delay Pools or Traffic Shaping per port?!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8555">[ date ]</a>
              <a href="thread.html#8555">[ thread ]</a>
              <a href="subject.html#8555">[ subject ]</a>
              <a href="author.html#8555">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
