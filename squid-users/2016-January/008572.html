<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Question about delay pools again
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Question%20about%20delay%20pools%20again&In-Reply-To=%3C568B1EF5.9010204%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008566.html">
   <LINK REL="Next"  HREF="008574.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Question about delay pools again</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Question%20about%20delay%20pools%20again&In-Reply-To=%3C568B1EF5.9010204%40treenet.co.nz%3E"
       TITLE="[squid-users] Question about delay pools again">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Jan  5 01:40:05 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008566.html">[squid-users] Question about delay pools again
</A></li>
        <LI>Next message (by thread): <A HREF="008574.html">[squid-users] Question about delay pools again
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8572">[ date ]</a>
              <a href="thread.html#8572">[ thread ]</a>
              <a href="subject.html#8572">[ subject ]</a>
              <a href="author.html#8572">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 5/01/2016 1:38 p.m., Alex Samad wrote:
&gt;<i> So thought I would try it out
</I>&gt;<i> 
</I>&gt;<i> #
</I>&gt;<i> # Delay Pools
</I>&gt;<i> # <A HREF="http://wiki.squid-cache.org/Features/DelayPools">http://wiki.squid-cache.org/Features/DelayPools</A>
</I>&gt;<i> # <A HREF="http://www.serverwatch.com/tutorials/article.php/3357241/Reining-in-Bandwidth-With-Squid-Proxying.htm">http://www.serverwatch.com/tutorials/article.php/3357241/Reining-in-Bandwidth-With-Squid-Proxying.htm</A>
</I>&gt;<i> delay_pools 1
</I>&gt;<i> delay_class 1 1
</I>&gt;<i> 
</I>&gt;<i> # 10Mb/s fille rate , 20Mb/s reserve
</I>&gt;<i> # 10485760/8 = 1310720
</I>&gt;<i> # 20971520/8 = 2621440
</I>&gt;<i> delay_parameters 1 1310720/2621440
</I>&gt;<i> 
</I>&gt;<i> # What to delay
</I>&gt;<i> acl Delay_ALL src all
</I>
Might as well just use &quot;all&quot; instead of &quot;Delay_ALL&quot; in your rule lines.
No need for this custom re-definition of a default ACL.

&gt;<i> acl Delay_Domain dstdomain -i &quot;/etc/squid/lists/delayDom.lst&quot;
</I>&gt;<i> 
</I>&gt;<i> delay_access 1 allow Delay_Domain
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> /etc/squid/lists/delayDom.lst
</I>&gt;<i> .windowsupdate.com
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> and I can just add domains to the file as needed
</I>&gt;<i> 
</I>
.. and then reconfigure Squid. Yes.

What the above does is not limit any particular user. But limits the
total server bandwidth to those domains (combined) to 10Mbps. It is a
good solution, but still has a few problems.

WU will now be very slow, proportional to how many users are downloading
the updates as MISS rather than HIT. Remembering that until each update
object is fully fetched once it will not HIT.


&gt;<i> 
</I>&gt;<i> On 5 January 2016 at 10:57, Alex Samad wrote:
</I>&gt;&gt;<i> Hi
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Just wanted to confirm my understanding of delay pools and the ability
</I>&gt;&gt;<i> to ratelimit inbound traffic.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Today one of our W10 machines did it windows update .. New patch ..
</I>&gt;&gt;<i> .MS SQL SP3 - 384M big patch
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So it contacts our squid proxy with then downloaded it from WSUS
</I>&gt;&gt;<i> update ... which is geocached with out local ISP.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This then flooded our 100Mb wan port.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> My understanding is that delay pools will not help me with rate
</I>&gt;&gt;<i> limiting that to a cap of say 10Mb/s
</I>
On the contrary. This is the exact case the old pools are designed to
help with.

&gt;&gt;<i>
</I>&gt;&gt;<i> The only thing that Squid or Linux can do is delay ACK's and thus rate
</I>&gt;&gt;<i> limit that way.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Delay pools are more for SQUID -&gt; End user ...
</I>
No they are for Server-&gt;Squid data flow. Done by delaying the read(2)
Squid does from the TCP I/O buffer of server delivered data. That has
the outward appearance of delaying ACKs the Squid machine sends to the
server.

HTH
Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008566.html">[squid-users] Question about delay pools again
</A></li>
	<LI>Next message (by thread): <A HREF="008574.html">[squid-users] Question about delay pools again
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8572">[ date ]</a>
              <a href="thread.html#8572">[ thread ]</a>
              <a href="subject.html#8572">[ subject ]</a>
              <a href="author.html#8572">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
