<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] confused over ipv6 failing on ipv4-only network
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20confused%20over%20ipv6%20failing%20on%20ipv4-only%20network&In-Reply-To=%3C568C9A7F.3090707%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008598.html">
   <LINK REL="Next"  HREF="008600.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] confused over ipv6 failing on ipv4-only network</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20confused%20over%20ipv6%20failing%20on%20ipv4-only%20network&In-Reply-To=%3C568C9A7F.3090707%40treenet.co.nz%3E"
       TITLE="[squid-users] confused over ipv6 failing on ipv4-only network">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Jan  6 04:39:27 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008598.html">[squid-users] confused over ipv6 failing on ipv4-only network
</A></li>
        <LI>Next message (by thread): <A HREF="008600.html">[squid-users] confused over ipv6 failing on ipv4-only network
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8599">[ date ]</a>
              <a href="thread.html#8599">[ thread ]</a>
              <a href="subject.html#8599">[ subject ]</a>
              <a href="author.html#8599">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 6/01/2016 5:04 p.m., Jason Haar wrote:
&gt;<i> Hi there
</I>&gt;<i> 
</I>&gt;<i> Weird - several times in the past couple of months I have found I cannot
</I>&gt;<i> get to <A HREF="http://wiki.squid-cache.org/">http://wiki.squid-cache.org/</A> - I get the error below from my
</I>&gt;<i> squid-3.5.11 server which does not have a Global ipv6 address (it has a
</I>&gt;<i> Local ipv6/fe80: on the Ethernet card - but nothing else). Google.com
</I>&gt;<i> (which is fully ipv6 capable) works fine - so far only
</I>&gt;<i> wiki.squid-cache.org has shown up this way to me (ie I don't see this
</I>&gt;<i> error message.
</I>&gt;<i> 
</I>&gt;<i> On the squid server, &quot;dig a&quot; shows valid ipv4 addresses and &quot;dig aaaa&quot;
</I>&gt;<i> shows the ipv6 address - but why is squid even trying to connect over
</I>&gt;<i> ipv6 If doesn't have an ipv6 address?
</I>&gt;<i> 
</I>&gt;<i> Could this be a case of the &quot;A&quot; record failing to return fast enough,
</I>&gt;<i> forcing squid to only try ipv6 - which then leads to the error message
</I>&gt;<i> referring to the ipv6 address?
</I>
Squid waits for both A and AAAA before continuing after DNS lookup. The
only way to get only IPv6 results is for your DNS server to produce no A
results at all. Timeout _could_ do that, but the default is 30 sec so
unlikely.


&gt;<i> This error message may be correct, but is
</I>&gt;<i> very confusing to anyone who knows they are only running ipv4: maybe
</I>&gt;<i> squid should know how to differentiate between locally routable and
</I>&gt;<i> globally routable ipv6 addresses and basically disable ipv6 if there is
</I>&gt;<i> no Global route?
</I>
It does. That knowledge (gained only by trying the connection) is what
is producing the 'connection failed' error page you mention below.
Otherwise it would be a timeout error or &quot;hung&quot; connection from the
client viewpoint.

The same things will happen if you remove all IPv4 WAN routes from the
Squid machine. There is no difference in this between v4 and v6.


&gt;<i> Obviously I could recompile squid without ipv6 support,
</I>&gt;<i> but Amos has made it clear that is &quot;the wrong way&quot; - so how else could
</I>&gt;<i> that be done (as adding ipv6 support to an entire network is not an
</I>&gt;<i> option either - if it was I wouldn't be sending this email! :-)
</I>&gt;<i> 
</I>
The Squid wiki is dual-stacked with IPv4 addresses. Sice you have
v4-only network the thing to do is find out why the IPv4 are not working
for your Squid.


&gt;<i> As an aside - I've seen this several times and yet only with
</I>&gt;<i> wiki.squid-cache.org - perhaps there's a performance issue/bug with one
</I>&gt;<i> of the associated DNS servers there?
</I>&gt;<i> 
</I>&gt;<i> The following error was encountered while trying to retrieve the URL:
</I>&gt;<i> <A HREF="http://wiki.squid-cache.org/SquidFaq/SquidAcl">http://wiki.squid-cache.org/SquidFaq/SquidAcl</A>
</I>&gt;<i> 
</I>&gt;<i>     Connection to 2001:4b78:2003::1 failed.
</I>
This just means that IPv6 was the *last* thing tried. It is entirely
probable that IPv4 were tried first and also failed. Particularly if you
have dns_v4_first turned on.

NP: if you have dns_v4_first off (default) then the error message should
say some IPv4 failed. Since it gets tried last.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008598.html">[squid-users] confused over ipv6 failing on ipv4-only network
</A></li>
	<LI>Next message (by thread): <A HREF="008600.html">[squid-users] confused over ipv6 failing on ipv4-only network
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8599">[ date ]</a>
              <a href="thread.html#8599">[ thread ]</a>
              <a href="subject.html#8599">[ subject ]</a>
              <a href="author.html#8599">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
