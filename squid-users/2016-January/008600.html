<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] confused over ipv6 failing on ipv4-only network
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20confused%20over%20ipv6%20failing%20on%20ipv4-only%20network&In-Reply-To=%3C568CB453.9080706%40trimble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008599.html">
   <LINK REL="Next"  HREF="008602.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] confused over ipv6 failing on ipv4-only network</H1>
    <B>Jason Haar</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20confused%20over%20ipv6%20failing%20on%20ipv4-only%20network&In-Reply-To=%3C568CB453.9080706%40trimble.com%3E"
       TITLE="[squid-users] confused over ipv6 failing on ipv4-only network">Jason_Haar at trimble.com
       </A><BR>
    <I>Wed Jan  6 06:29:39 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008599.html">[squid-users] confused over ipv6 failing on ipv4-only network
</A></li>
        <LI>Next message (by thread): <A HREF="008602.html">[squid-users] confused over ipv6 failing on ipv4-only network
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8600">[ date ]</a>
              <a href="thread.html#8600">[ thread ]</a>
              <a href="subject.html#8600">[ subject ]</a>
              <a href="author.html#8600">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 06/01/16 17:39, Amos Jeffries wrote:
&gt;<i> On 6/01/2016 5:04 p.m., Jason Haar wrote:
</I>&gt;&gt;<i> Hi there
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Weird - several times in the past couple of months I have found I cannot
</I>&gt;&gt;<i> get to <A HREF="http://wiki.squid-cache.org/">http://wiki.squid-cache.org/</A> - I get the error below from my
</I>&gt;&gt;<i> squid-3.5.11 server which does not have a Global ipv6 address (it has a
</I>&gt;&gt;<i> Local ipv6/fe80: on the Ethernet card - but nothing else). Google.com
</I>&gt;&gt;<i> (which is fully ipv6 capable) works fine - so far only
</I>&gt;&gt;<i> wiki.squid-cache.org has shown up this way to me (ie I don't see this
</I>&gt;&gt;<i> error message.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On the squid server, &quot;dig a&quot; shows valid ipv4 addresses and &quot;dig aaaa&quot;
</I>&gt;&gt;<i> shows the ipv6 address - but why is squid even trying to connect over
</I>&gt;&gt;<i> ipv6 If doesn't have an ipv6 address?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Could this be a case of the &quot;A&quot; record failing to return fast enough,
</I>&gt;&gt;<i> forcing squid to only try ipv6 - which then leads to the error message
</I>&gt;&gt;<i> referring to the ipv6 address?
</I>&gt;<i> Squid waits for both A and AAAA before continuing after DNS lookup. The
</I>&gt;<i> only way to get only IPv6 results is for your DNS server to produce no A
</I>&gt;<i> results at all. Timeout _could_ do that, but the default is 30 sec so
</I>&gt;<i> unlikely.
</I>
I think that must be the case, because when I saw the problem this
morning, I immediately ssh'ed into the squid server and nslookup showed
it was resolving the name to it's A record just fine (by then) - and
telnet-ing to the IPv4 address was fine too. So it must have either
timed out on the A lookups (but not the AAAA records), or the DNS server
didn't return A records at all? I don't think there's a way to query
squid to see what it's current DNS cache is? That would definitively
answer that question


&gt;<i> The Squid wiki is dual-stacked with IPv4 addresses. Sice you have
</I>&gt;<i> v4-only network the thing to do is find out why the IPv4 are not
</I>&gt;<i> working for your Squid. 
</I>
Well yeah  - but I frankly don't see this on any other website (like
google.com) - just wiki.squid-cache.org - so I think there's something
going on between those DNS servers and my squid server sitting on a
SPARK NZ network
&gt;<i> This just means that IPv6 was the *last* thing tried. It is entirely
</I>&gt;<i> probable that IPv4 were tried first and also failed. Particularly if you
</I>&gt;<i> have dns_v4_first turned on.
</I>
No - I don't have dns_v4_first defined at all - so that should be trying
both ipv4 and ipv6 if both DNS records were available.

&gt;<i>
</I>&gt;<i> NP: if you have dns_v4_first off (default) then the error message should
</I>&gt;<i> say some IPv4 failed. Since it gets tried last.
</I>Well that isn't happening - which is why I suspect I'm not getting any
&quot;A&quot; records back at all (or very late). Sadly this isn't repeatable at
will - right now the wiki is working fine


-- 
Cheers

Jason Haar
Corporate Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008599.html">[squid-users] confused over ipv6 failing on ipv4-only network
</A></li>
	<LI>Next message (by thread): <A HREF="008602.html">[squid-users] confused over ipv6 failing on ipv4-only network
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8600">[ date ]</a>
              <a href="thread.html#8600">[ thread ]</a>
              <a href="subject.html#8600">[ subject ]</a>
              <a href="author.html#8600">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
