<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] confused over ipv6 failing on ipv4-only network
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20confused%20over%20ipv6%20failing%20on%20ipv4-only%20network&In-Reply-To=%3C568CFB4C.8010106%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008602.html">
   <LINK REL="Next"  HREF="008601.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] confused over ipv6 failing on ipv4-only network</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20confused%20over%20ipv6%20failing%20on%20ipv4-only%20network&In-Reply-To=%3C568CFB4C.8010106%40treenet.co.nz%3E"
       TITLE="[squid-users] confused over ipv6 failing on ipv4-only network">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Jan  6 11:32:28 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008602.html">[squid-users] confused over ipv6 failing on ipv4-only network
</A></li>
        <LI>Next message (by thread): <A HREF="008601.html">[squid-users] how to generate errors when blocking https urls in transparent with peek+splice mode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8607">[ date ]</a>
              <a href="thread.html#8607">[ thread ]</a>
              <a href="subject.html#8607">[ subject ]</a>
              <a href="author.html#8607">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 6/01/2016 7:29 p.m., Jason Haar wrote:
&gt;<i> On 06/01/16 17:39, Amos Jeffries wrote:
</I>&gt;&gt;<i> On 6/01/2016 5:04 p.m., Jason Haar wrote:
</I>&gt;&gt;&gt;<i> Hi there
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Weird - several times in the past couple of months I have found I cannot
</I>&gt;&gt;&gt;<i> get to <A HREF="http://wiki.squid-cache.org/">http://wiki.squid-cache.org/</A> - I get the error below from my
</I>&gt;&gt;&gt;<i> squid-3.5.11 server which does not have a Global ipv6 address (it has a
</I>&gt;&gt;&gt;<i> Local ipv6/fe80: on the Ethernet card - but nothing else). Google.com
</I>&gt;&gt;&gt;<i> (which is fully ipv6 capable) works fine - so far only
</I>&gt;&gt;&gt;<i> wiki.squid-cache.org has shown up this way to me (ie I don't see this
</I>&gt;&gt;&gt;<i> error message.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On the squid server, &quot;dig a&quot; shows valid ipv4 addresses and &quot;dig aaaa&quot;
</I>&gt;&gt;&gt;<i> shows the ipv6 address - but why is squid even trying to connect over
</I>&gt;&gt;&gt;<i> ipv6 If doesn't have an ipv6 address?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Could this be a case of the &quot;A&quot; record failing to return fast enough,
</I>&gt;&gt;&gt;<i> forcing squid to only try ipv6 - which then leads to the error message
</I>&gt;&gt;&gt;<i> referring to the ipv6 address?
</I>&gt;&gt;<i> Squid waits for both A and AAAA before continuing after DNS lookup. The
</I>&gt;&gt;<i> only way to get only IPv6 results is for your DNS server to produce no A
</I>&gt;&gt;<i> results at all. Timeout _could_ do that, but the default is 30 sec so
</I>&gt;&gt;<i> unlikely.
</I>&gt;<i> 
</I>&gt;<i> I think that must be the case, because when I saw the problem this
</I>&gt;<i> morning, I immediately ssh'ed into the squid server and nslookup showed
</I>&gt;<i> it was resolving the name to it's A record just fine (by then) - and
</I>&gt;<i> telnet-ing to the IPv4 address was fine too. So it must have either
</I>&gt;<i> timed out on the A lookups (but not the AAAA records), or the DNS server
</I>&gt;<i> didn't return A records at all? I don't think there's a way to query
</I>&gt;<i> squid to see what it's current DNS cache is? That would definitively
</I>&gt;<i> answer that question
</I>
The cache manager &quot;ipcache&quot; report contains a listing of the DNS cache:
 squidclient mgr:ipcache


&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> The Squid wiki is dual-stacked with IPv4 addresses. Sice you have
</I>&gt;&gt;<i> v4-only network the thing to do is find out why the IPv4 are not
</I>&gt;&gt;<i> working for your Squid. 
</I>&gt;<i> 
</I>&gt;<i> Well yeah  - but I frankly don't see this on any other website (like
</I>&gt;<i> google.com) - just wiki.squid-cache.org - so I think there's something
</I>&gt;<i> going on between those DNS servers and my squid server sitting on a
</I>&gt;<i> SPARK NZ network
</I>
Hmm. Wiki is in Italy IIRC so almost worst case RTT for us. Though I've
not seen such issues from my Orcon POP.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008602.html">[squid-users] confused over ipv6 failing on ipv4-only network
</A></li>
	<LI>Next message (by thread): <A HREF="008601.html">[squid-users] how to generate errors when blocking https urls in transparent with peek+splice mode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8607">[ date ]</a>
              <a href="thread.html#8607">[ thread ]</a>
              <a href="subject.html#8607">[ subject ]</a>
              <a href="author.html#8607">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
