<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Questions about tcp_outgoing_address
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Questions%20about%20tcp_outgoing_address&In-Reply-To=%3C5691E47D.8050409%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008634.html">
   <LINK REL="Next"  HREF="008635.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Questions about tcp_outgoing_address</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Questions%20about%20tcp_outgoing_address&In-Reply-To=%3C5691E47D.8050409%40treenet.co.nz%3E"
       TITLE="[squid-users] Questions about tcp_outgoing_address">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Jan 10 04:56:29 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008634.html">[squid-users] Questions about tcp_outgoing_address
</A></li>
        <LI>Next message (by thread): <A HREF="008635.html">[squid-users] URL Rewrite for https via Squidguard
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8646">[ date ]</a>
              <a href="thread.html#8646">[ thread ]</a>
              <a href="subject.html#8646">[ subject ]</a>
              <a href="author.html#8646">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 9/01/2016 4:54 p.m., Ver&#243;nica Ovando wrote:
&gt;<i> Hi!
</I>&gt;<i> 
</I>&gt;<i> I have a some specific questions about the directive
</I>&gt;<i> /tcp_outgoing_address/. I need to know if it could works for my deployment:
</I>&gt;<i> 
</I>&gt;<i> My Squid 34.8 runs over Debian Jessie. I have a multiwan environment
</I>&gt;<i> with dual internet connection.
</I>&gt;<i> 
</I>&gt;<i> There are some clients that visit web pages that only allow certain
</I>&gt;<i> public IPs to access them. Only one of my two public IPs is allowed to
</I>&gt;<i> access those services. I red some examples about /tcp_outgoing_address/
</I>&gt;<i> from de Squid docs and other resources and they are all like this one:
</I>&gt;<i>    
</I>&gt;<i>     acl abc src 10.0.0.0/24
</I>&gt;<i>     acl xyz 10.0.2.0/24
</I>&gt;<i>     tcp_outgoing_address 10.1.0.1 abc
</I>&gt;<i>     tcp_outgoing_address 10.1.0.2 xyz
</I>&gt;<i>     tcp_outgoing_address 10.1.0.3
</I>&gt;<i> 
</I>&gt;<i> I am not sure (this is the reason of my question) if I can use the
</I>&gt;<i> directive in this way:
</I>&gt;<i> 
</I>&gt;<i>     acl pages url_regex -i &quot;/path/to/restricted_access_pages&quot;
</I>&gt;<i>     tcp_outgoing_address my_gateway_ip abc
</I>&gt;<i> 
</I>
You can. The directive ACLs have access to anything in the HTTP request
message, TCP client connection state, and the destination server IP but
no other server details than IP.

Just be aware that order is important, the first line to match for any
connection will be applied and the remainder ignored.


&gt;<i> Also, in multiwan environments frequent disconnect issues are common.
</I>&gt;<i> Can Squid handle the problem with /tcp_outgoing_address/, for example
</I>&gt;<i> when users need to access to email, for avoid those disconnection
</I>&gt;<i> problems? (I don't have load balancing, so the http requests use both
</I>&gt;<i> ADSL connections) Example:
</I>&gt;<i> 
</I>&gt;<i>     acl email url_regex -i &quot;/path/to/email_pages&quot;
</I>&gt;<i>     tcp_outgoing_address my_gateway_ip email
</I>&gt;<i>  
</I>
No. All it does is select which IP to set on the TCP packets when
opening a new outbound TCP connection. That in turn hints to the OS
about which routing needs to be applied, but no more than that.

It is also restricted in that the rules will only affect traffic of the
same IP version as the address wanting to be set. A line with IPv4
address will have no effect on IPv6 outbound connections, and vice versa.

PS / FYI: there is no good reason for a multi-WAN environment to
encounter disconnection issues. If you are seeing such, then something
is broken in your network routing or traffic management software. That
is off topic here, but hopefully will head you in the right direction
for a useful fix.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008634.html">[squid-users] Questions about tcp_outgoing_address
</A></li>
	<LI>Next message (by thread): <A HREF="008635.html">[squid-users] URL Rewrite for https via Squidguard
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8646">[ date ]</a>
              <a href="thread.html#8646">[ thread ]</a>
              <a href="subject.html#8646">[ subject ]</a>
              <a href="author.html#8646">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
