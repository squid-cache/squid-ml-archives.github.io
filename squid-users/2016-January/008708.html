<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] kerberos authentication with a machine account doesn't work
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20kerberos%20authentication%20with%20a%20machine%20account%0A%20doesn%27t%20work&In-Reply-To=%3CCAJrMMC-daMkp6NpNLq5XecCrhefrhKfiMnaPRH7aoVV7rwAu4A%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008687.html">
   <LINK REL="Next"  HREF="008743.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] kerberos authentication with a machine account doesn't work</H1>
    <B>Fabio Bucci</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20kerberos%20authentication%20with%20a%20machine%20account%0A%20doesn%27t%20work&In-Reply-To=%3CCAJrMMC-daMkp6NpNLq5XecCrhefrhKfiMnaPRH7aoVV7rwAu4A%40mail.gmail.com%3E"
       TITLE="[squid-users] kerberos authentication with a machine account doesn't work">fabietto82 at gmail.com
       </A><BR>
    <I>Wed Jan 13 08:30:46 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008687.html">[squid-users] kerberos authentication with a machine account	doesn't work
</A></li>
        <LI>Next message (by thread): <A HREF="008743.html">[squid-users] kerberos authentication with a machine account	doesn't work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8708">[ date ]</a>
              <a href="thread.html#8708">[ thread ]</a>
              <a href="subject.html#8708">[ subject ]</a>
              <a href="author.html#8708">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi All,
i want to terminate a previous job did by ex colleague is changed
company. Now there is a cluster of 2 nodes of squid with NTLM
transparent authentication and one spare node i'm using as test and
configured with kerberos instead. Reading a lot of info i understood
kerberos is more stable than NTLM and my plan is to migrate the
production cluster to this kind of authentication. Configurations
(squid and kerberos) seem to be ok but everytime with browser i point
to squid i'm unable to go to internet, popup requires me credentials
but even i put the right ones it doesn't work. Coudl you help me?

2016-01-12 0:28 GMT+01:00 LYMN &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">brett.lymn at baesystems.com</A>&gt;:
&gt;<i> On Mon, Jan 11, 2016 at 09:06:27PM +1300, Amos Jeffries wrote:
</I>&gt;&gt;<i> On 11/01/2016 2:48 p.m., LYMN wrote:
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; I did manage to get this working, you did mention the correct solution
</I>&gt;&gt;<i> &gt; right down the end of your message.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Correct for you yes. That can happen when making half-blind guesses at
</I>&gt;&gt;<i> what the problem actually is based on partial information. It might have
</I>&gt;&gt;<i> been any of the issues mentioned or any of the solutions mentioned.
</I>&gt;&gt;<i> Others in future may find differently depending on what they have mucked
</I>&gt;&gt;<i> up or payed around with before asking.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Yes, correct for me.  It indeed could be one or more of the suggestions
</I>&gt;<i> that were made.  Kerberos errors are such fun to debug made more so by
</I>&gt;<i> multiple problems causing the same error message.  I have had a
</I>&gt;<i> situation where I had a few different problems and it wasn't until I had
</I>&gt;<i> sorted them all that the error message went away but it is so unsettling
</I>&gt;<i> to get the same error after you have made a change that you are sure
</I>&gt;<i> makes things correct.
</I>&gt;<i>
</I>&gt;&gt;<i> &gt; On Thu, Jan 07, 2016 at 09:37:46AM +0100, L.P.H. van Belle wrote:
</I>&gt;&gt;<i> &gt;&gt; Hai,
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; Few things to check.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; /etc/krb5.keytab should have rights 600 (root:root)
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; And this was the problem but it should not, in my case, be as you
</I>&gt;&gt;<i> &gt; stated. In fact, /etc/krb5.keytab needed to have rights 640 with
</I>&gt;&gt;<i> &gt; ownership root:nobody.  This is because the kerberos authenticator runs
</I>&gt;&gt;<i> &gt; as the user nobody and needs access to the keytab.  I am not so sure I
</I>&gt;&gt;<i> &gt; like this situation because this does mean the nobody user now has
</I>&gt;&gt;<i> &gt; access to the machine kerberos keys not just the ones for the http SPN.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &quot;nobody&quot; is the default low-privileged user account unless you build
</I>&gt;&gt;<i> Squid with the --with-default-user=X - in which cases it will default to
</I>&gt;&gt;<i> the &quot;X&quot; account.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> You can also configure &quot;cache_effective_user X&quot; in squid.conf to
</I>&gt;&gt;<i> override the default if your Squid was built with one you dont want to use.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Yes.  I think you have clarified the point that I was trying to make
</I>&gt;<i> which was the user/group used may depend on your configuration or squid
</I>&gt;<i> build.
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Brett Lymn
</I>&gt;<i> This email has been sent on behalf of one of the following companies within the BAE Systems Australia group of companies:
</I>&gt;<i>
</I>&gt;<i>     BAE Systems Australia Limited - Australian Company Number 008 423 005
</I>&gt;<i>     BAE Systems Australia Defence Pty Limited - Australian Company Number 006 870 846
</I>&gt;<i>     BAE Systems Australia Logistics Pty Limited - Australian Company Number 086 228 864
</I>&gt;<i>
</I>&gt;<i> Our registered office is Evans Building, Taranaki Road, Edinburgh Parks,
</I>&gt;<i> Edinburgh, South Australia, 5111. If the identity of the sending company is
</I>&gt;<i> not clear from the content of this email please contact the sender.
</I>&gt;<i>
</I>&gt;<i> This email and any attachments may contain confidential and legally
</I>&gt;<i> privileged information.  If you are not the intended recipient, do not copy or
</I>&gt;<i> disclose its content, but please reply to this email immediately and highlight
</I>&gt;<i> the error to the sender and then immediately delete the message.
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008687.html">[squid-users] kerberos authentication with a machine account	doesn't work
</A></li>
	<LI>Next message (by thread): <A HREF="008743.html">[squid-users] kerberos authentication with a machine account	doesn't work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8708">[ date ]</a>
              <a href="thread.html#8708">[ thread ]</a>
              <a href="subject.html#8708">[ subject ]</a>
              <a href="author.html#8708">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
