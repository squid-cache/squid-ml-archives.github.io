<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] V3.5.12 SSL Bumping Issue with one Website
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20V3.5.12%20SSL%20Bumping%20Issue%20with%20one%20Website&In-Reply-To=%3C56969519.8020804%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008732.html">
   <LINK REL="Next"  HREF="008734.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] V3.5.12 SSL Bumping Issue with one Website</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20V3.5.12%20SSL%20Bumping%20Issue%20with%20one%20Website&In-Reply-To=%3C56969519.8020804%40gmail.com%3E"
       TITLE="[squid-users] V3.5.12 SSL Bumping Issue with one Website">yvoinov at gmail.com
       </A><BR>
    <I>Wed Jan 13 18:19:05 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008732.html">[squid-users] V3.5.12 SSL Bumping Issue with one Website
</A></li>
        <LI>Next message (by thread): <A HREF="008734.html">[squid-users] Squid config is failing to cache data
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8738">[ date ]</a>
              <a href="thread.html#8738">[ thread ]</a>
              <a href="subject.html#8738">[ subject ]</a>
              <a href="author.html#8738">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256
 
I seen the same - just no lough! - with <A HREF="https://instagram.com">https://instagram.com</A>

:<i>)
</I>
Yes, I know, selfie is evil :)

13.01.16 23:10, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid at data-core.org</A> &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i>
</I>&gt;<i> Hello together,
</I>&gt;<i>
</I>&gt;<i> I am using Squid 3.5.12 with Kerberos Authentication only and ClamAV
</I>on Debian Jessie.
&gt;<i>
</I>&gt;<i> My Proxy is working very nice, but now I've found an issue with just
</I>one SSL Website.
&gt;<i>
</I>&gt;<i> It would be nice to know if others can reproduce this Issue.
</I>&gt;<i>
</I>&gt;<i> Target website is: <A HREF="https://www.shop-fonic-mobile.de/">https://www.shop-fonic-mobile.de/</A>
</I>&gt;<i>
</I>&gt;<i> While trying to access this website, a blank page is displayed without
</I>any source code in it.
&gt;<i>
</I>&gt;<i> Cache Log says on each attempt:
</I>&gt;<i> Squid 2016/01/13 17:43:43 kid1| Error negotiating SSL on FD 22:
</I>error:14090086:SSL routines:ssl3_get_server_certificate:certificate
verify failed (1/-1/0)
&gt;<i>
</I>&gt;<i> Access Log for each attempt:
</I>&gt;<i> 1452703599.547      0 10.0.0.4 TCP_DENIED/407 4189 CONNECT
</I>www.shop-fonic-mobile.de:443 - HIER_NONE/- text/html
&gt;<i> 1452703599.832    272 10.0.0.4 TAG_NONE/200 0 CONNECT
</I>www.shop-fonic-mobile.de:443 MYUSER HIER_NONE/- -
&gt;<i> 1452703599.888     52 10.0.0.4 TCP_MISS/503 402 GET
</I><A HREF="https://www.shop-fonic-mobile.de/">https://www.shop-fonic-mobile.de/</A> MYUSER HIER_DIRECT/85.158.6.195 text/html
&gt;<i>
</I>&gt;<i> SSL Bumping generated a valid certificate for this site using my
</I>internal CA.
&gt;<i>
</I>&gt;<i> I can reproduce the error only on this website everything else is
</I>working nicely and if Squid can't validate an external SSL Certificate
it display an error of course.
&gt;<i>
</I>&gt;<i> I currently fixed it by adding it to my SSL_TrustedSites ACL.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This is my Bump config:
</I>&gt;<i>
</I>&gt;<i> http_port 8080 ssl-bump generate-host-certificates=on
</I>dynamic_cert_mem_cache_size=16MB cert=/etc/squid/ssl/myca.pem
&gt;<i> ssl_bump splice localhost
</I>&gt;<i> ssl_bump bump all
</I>&gt;<i> sslproxy_cert_error allow SSL_TrustedSites
</I>&gt;<i> sslproxy_cert_error deny all
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Expected behavior of Squid: If Squid can't validate an SSL Certificate
</I>then an error should be displayed as it does on all other sites with
invalid certificates.
&gt;<i> But it seems that the first check of squid recognizes the Certificate
</I>as valid otherwise it would display an error and squid generates a valid
cert for the client and then squid seems to no beeing able to validate
it at this point again.
&gt;<i>
</I>&gt;<i> The Target Website SSL Chain is as follows:
</I>&gt;<i> CA  &lt;- Part of the Ca certificates
</I>&gt;<i> -- Intermediate &lt;- not a part of the ca-certificates
</I>&gt;<i> -----website
</I>&gt;<i>
</I>&gt;<i> So I believe somehow on the initial request squid can validate the
</I>full chain and as soon as the client receives the generated cert it
can't look up the whole chain because it trys to validate against the
intermediate CA only and lost the path to the Root CA and fails of
course. Again only the Root CA is known by the system (ca-certificates).
&gt;<i>
</I>&gt;<i> Please let me know if someone can reproduce this Issue.
</I>&gt;<i>
</I>&gt;<i> BTW:
</I>&gt;<i> Found another Issue in Squid 3.5.12 regarding Error Messages,
</I>&quot;mailto:&quot; links which are generating an error mail do not work anymore.
Maybe this is related to Kerberos Authentication which maybe makes the
url encoded string longer than before. I've found out that somewhere at
the last part of the urlencoded link the error is in. Couldn't pin point it.
&gt;<i>
</I>&gt;<i> Best regards,
</I>&gt;<i>
</I>&gt;<i> Enrico
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBCAAGBQJWlpUYAAoJENNXIZxhPexGpHAH/0T20R7PapqhQMYethDrnntK
eWpKSIyASFs0dHErJ7YLdvqsY/JXkLH2WLO6B8v16JqaizLzELQZNu8sENCF92nG
1F68GFyWEtqgD5yynOHsxVwY2wrNInV1FeC3Ll+iwP5tZKcU4dN/GZotzUZdvkMr
FNLNjzp03bXCq9kM+mvOqD0iaYi+kZjliwKQ6LiuzF0ItFsJlOL/eR5y9oAdgU5N
HE7jTEt3DU1oXZp48QKKOLDj2LfQuQbhCcZJ/XmAL9mZePvJeEf9JaRka2Qz6M1U
0Nl/Mh2oDplZhobmVRSNLGa+iyb/pbCtwX7cUbLkpiagb9aZwaHWc8Jv+kv40dw=
=2ClN
-----END PGP SIGNATURE-----


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008732.html">[squid-users] V3.5.12 SSL Bumping Issue with one Website
</A></li>
	<LI>Next message (by thread): <A HREF="008734.html">[squid-users] Squid config is failing to cache data
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8738">[ date ]</a>
              <a href="thread.html#8738">[ thread ]</a>
              <a href="subject.html#8738">[ subject ]</a>
              <a href="author.html#8738">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
