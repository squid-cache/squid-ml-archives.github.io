<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Fwd: Squid https bump and google apps
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Fwd%3A%20Squid%20https%20bump%20and%20google%20apps&In-Reply-To=%3C5699FF79.2010905%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008784.html">
   <LINK REL="Next"  HREF="008780.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Fwd: Squid https bump and google apps</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Fwd%3A%20Squid%20https%20bump%20and%20google%20apps&In-Reply-To=%3C5699FF79.2010905%40gmail.com%3E"
       TITLE="[squid-users] Fwd: Squid https bump and google apps">yvoinov at gmail.com
       </A><BR>
    <I>Sat Jan 16 08:29:45 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008784.html">[squid-users] Fwd: Squid https bump and google apps
</A></li>
        <LI>Next message (by thread): <A HREF="008780.html">[squid-users] I can&#180;t block streaming !!!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8788">[ date ]</a>
              <a href="thread.html#8788">[ thread ]</a>
              <a href="subject.html#8788">[ subject ]</a>
              <a href="author.html#8788">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256
 


16.01.16 7:57, Lucas Castro &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 15-01-2016 17:26, Yuri Voinov wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # -------------------------------------
</I>&gt;&gt;<i> # Access Control Lists
</I>&gt;&gt;<i> # -------------------------------------
</I>&gt;&gt;<i> acl localnet src 192.168.0.0/16    # RFC1918 possible internal network
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> acl SSL_ports port 443
</I>&gt;&gt;<i> acl SSL_ports port 8443        # Telecom exclusion
</I>&gt;&gt;<i> acl SSL_ports port 2041        # ICQ/MRA
</I>&gt;&gt;<i> acl SSL_ports port 2042        # ICQ/MRA
</I>&gt;&gt;<i> acl SSL_ports port 5160        # ICQ/MRA
</I>&gt;&gt;<i> acl SSL_ports port 5228        # ICQ/MRA
</I>&gt;&gt;<i> acl SSL_ports port 10443    # GZakup exclusion
</I>&gt;&gt;<i> acl Safe_ports port 80        # http
</I>&gt;&gt;<i> acl Safe_ports port 21        # ftp
</I>&gt;&gt;<i> acl Safe_ports port 443        # https
</I>&gt;&gt;<i> acl Safe_ports port 70        # gopher
</I>&gt;&gt;<i> acl Safe_ports port 210        # wais
</I>&gt;&gt;<i> acl Safe_ports port 1025-65535    # unregistered ports
</I>&gt;&gt;<i> acl Safe_ports port 280        # http-mgmt
</I>&gt;&gt;<i> acl Safe_ports port 488        # gss-http
</I>&gt;&gt;<i> acl Safe_ports port 591        # filemaker
</I>&gt;&gt;<i> acl Safe_ports port 777        # multiling http
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Common methods
</I>&gt;&gt;<i> acl CONNECT method CONNECT
</I>&gt;&gt;<i> acl PURGE method PURGE
</I>&gt;&gt;<i> acl GET method GET
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Windows update acls
</I>&gt;&gt;<i> acl windowsupdate dstdomain sls.update.microsoft.com.akadns.net
</I>&gt;&gt;<i> acl windowsupdate dstdomain windowsupdate.microsoft.com
</I>&gt;&gt;<i> acl windowsupdate dstdomain .update.microsoft.com
</I>&gt;&gt;<i> acl windowsupdate dstdomain download.windowsupdate.com
</I>&gt;&gt;<i> acl windowsupdate dstdomain redir.metaservices.microsoft.com
</I>&gt;&gt;<i> acl windowsupdate dstdomain images.metaservices.microsoft.com
</I>&gt;&gt;<i> acl windowsupdate dstdomain c.microsoft.com
</I>&gt;&gt;<i> acl windowsupdate dstdomain www.download.windowsupdate.com
</I>&gt;&gt;<i> acl windowsupdate dstdomain wustat.windows.com
</I>&gt;&gt;<i> acl windowsupdate dstdomain crl.microsoft.com
</I>&gt;&gt;<i> acl windowsupdate dstdomain sls.microsoft.com
</I>&gt;&gt;<i> acl windowsupdate dstdomain productactivation.one.microsoft.com
</I>&gt;&gt;<i> acl windowsupdate dstdomain ntservicepack.microsoft.com
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Windows update methods
</I>&gt;&gt;<i> acl wuCONNECT dstdomain www.update.microsoft.com
</I>&gt;&gt;<i> acl wuCONNECT dstdomain sls.microsoft.com
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Youtube &amp; CDN store rewrite ACLs
</I>&gt;&gt;<i> acl store_rewrite_list urlpath_regex
</I>&gt;&gt;<i>
</I>\.(jp(e?g|e|2)|gif|png|bmp|ico|svg|web(p|m)|wm(v|a)|flv|f4f|mp(3|4)|ttf|eot|woff2?|(c|x|j)ss|js(t?|px?))\?
&gt;&gt;<i> \/ads\?
</I>&gt;&gt;<i> acl store_rewrite_list_web url_regex
</I>&gt;&gt;<i> &quot;/usr/local/squid/etc/url.rewrite_web&quot;
</I>&gt;&gt;<i> acl store_rewrite_list_web_cdn url_regex
</I>&gt;&gt;<i> &quot;/usr/local/squid/etc/url.rewrite_cdn&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Adobe/Java and other updates
</I>&gt;&gt;<i> acl adobe_java_updates url_regex &quot;/usr/local/squid/etc/url.updates&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # No-cache
</I>&gt;&gt;<i> acl dont_cache_url url_regex &quot;/usr/local/squid/etc/url.nocache&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Tor acl
</I>&gt;&gt;<i> acl tor_url dstdom_regex -i &quot;/usr/local/squid/etc/url.tor&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # SSL bump acl
</I>&gt;&gt;<i> acl net_bump src &quot;/usr/local/squid/etc/net.bump&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # TLD acl
</I>&gt;&gt;<i> acl block_tld dstdomain &quot;/usr/local/squid/etc/dstdom.tld&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # -------------------------------------
</I>&gt;&gt;<i> # Access parameters
</I>&gt;&gt;<i> # -------------------------------------
</I>&gt;&gt;<i> # Deny requests to unsafe ports
</I>&gt;&gt;<i> http_access deny !Safe_ports
</I>&gt;&gt;<i> # Deny CONNECT to other than SSL ports
</I>&gt;&gt;<i> http_access deny CONNECT !SSL_ports
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Only allow cachemgr access from localhost
</I>&gt;&gt;<i> http_access allow localhost manager
</I>&gt;&gt;<i> http_access deny manager
</I>&gt;&gt;<i> http_access deny to_localhost
</I>&gt;&gt;<i> # Allow purge from localhost
</I>&gt;&gt;<i> http_access allow PURGE localhost
</I>&gt;&gt;<i> http_access deny PURGE
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Normalize Accept-Encoding to support compression via eCAP
</I>&gt;&gt;<i> request_header_access Accept-Encoding deny all
</I>&gt;&gt;<i> request_header_replace Accept-Encoding gzip;q=1.0, identity;q=0.5, *;q=0
</I>&gt;&gt;<i> # Disable alternate protocols
</I>&gt;&gt;<i> request_header_access Alternate-Protocol deny all
</I>&gt;&gt;<i> reply_header_access Alternate-Protocol deny all
</I>&gt;&gt;<i> # Disable HSTS
</I>&gt;&gt;<i> reply_header_access Strict-Transport-Security deny all
</I>&gt;&gt;<i> reply_header_replace Strict-Transport-Security max-age=0;
</I>&gt;&gt;<i> includeSubDomains
</I>&gt;&gt;<i> # Remove User-Agent from Vary
</I>&gt;&gt;<i> reply_header_access Vary deny all
</I>&gt;&gt;<i> reply_header_replace Vary Accept-Encoding
</I>&gt;&gt;<i> # Workaround 4253
</I>&gt;&gt;<i> request_header_access Surrogate-Capability deny all
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Block top level domains
</I>&gt;&gt;<i> http_access deny block_tld
</I>&gt;&gt;<i> deny_info TCP_RESET block_tld
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Rule allowing access from local networks
</I>&gt;&gt;<i> http_access allow localnet
</I>&gt;&gt;<i> http_access allow localhost
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # No cache directives
</I>&gt;&gt;<i> cache deny dont_cache_url
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # ICP/HTCP access
</I>&gt;&gt;<i> icp_access allow localnet
</I>&gt;&gt;<i> icp_access deny all
</I>&gt;&gt;<i> htcp_access allow localnet
</I>&gt;&gt;<i> htcp_access deny all
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # 302 loop
</I>&gt;&gt;<i> acl text_mime rep_mime_type text/html text/plain
</I>&gt;&gt;<i> acl http302 http_status 302
</I>&gt;&gt;<i> store_miss deny text_mime http302
</I>&gt;&gt;<i> send_hit deny text_mime http302
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Windows updates rules
</I>&gt;&gt;<i> http_access allow CONNECT wuCONNECT localnet
</I>&gt;&gt;<i> http_access allow CONNECT wuCONNECT localhost
</I>&gt;&gt;<i> http_access allow windowsupdate localnet
</I>&gt;&gt;<i> http_access allow windowsupdate localhost
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Minimum ICQ configuration,
</I>&gt;&gt;<i> # works for QIP 2012 and squid/ssl_bump, login.icq.com port should be
</I>&gt;&gt;<i> either 443 or 5190
</I>&gt;&gt;<i> #
</I>&gt;&gt;<i> acl icq dstdomain login.icq.com
</I>&gt;&gt;<i> acl icqport port 443
</I>&gt;&gt;<i> acl icqport port 2041
</I>&gt;&gt;<i> acl icqport port 2042
</I>&gt;&gt;<i> acl icqport port 5190
</I>&gt;&gt;<i> # mail.ru network where ICQ/MRIM servers reside
</I>&gt;&gt;<i> acl icqip dst 178.237.16.0/20
</I>&gt;&gt;<i> acl icqip dst 217.69.128.0/20
</I>&gt;&gt;<i> # isgeek.info jabber
</I>&gt;&gt;<i> acl icqip dst 94.23.0.0/16
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> http_access allow CONNECT icq
</I>&gt;&gt;<i> http_access allow CONNECT icqip icqport
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # SSL bump rules
</I>&gt;&gt;<i> acl DiscoverSNIHost at_step SslBump1
</I>&gt;&gt;<i> # ICQ/MRA must splice first
</I>&gt;&gt;<i> ssl_bump splice DiscoverSNIHost icq
</I>&gt;&gt;<i> ssl_bump splice DiscoverSNIHost icqip icqport
</I>&gt;&gt;<i> ssl_bump peek DiscoverSNIHost
</I>&gt;&gt;<i> acl NoSSLIntercept ssl::server_name_regex -i
</I>&gt;&gt;<i> &quot;/usr/local/squid/etc/url.nobump&quot;
</I>&gt;&gt;<i> acl NoSSLIntercept ssl::server_name_regex -i
</I>&gt;&gt;<i> &quot;/usr/local/squid/etc/url.tor&quot;
</I>&gt;&gt;<i> ssl_bump splice NoSSLIntercept
</I>&gt;&gt;<i> ssl_bump bump net_bump
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Privoxy+Tor access rules
</I>&gt;&gt;<i> never_direct allow tor_url
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # And finally deny all other access to this proxy
</I>&gt;&gt;<i> http_access deny all
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # -------------------------------------
</I>&gt;&gt;<i> # HTTP parameters
</I>&gt;&gt;<i> # -------------------------------------
</I>&gt;&gt;<i> # Local Privoxy is cache parent
</I>&gt;&gt;<i> cache_peer 127.0.0.1 parent 8118 0 no-query no-digest default
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> cache_peer_access 127.0.0.1 allow tor_url
</I>&gt;&gt;<i> cache_peer_access 127.0.0.1 deny all
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Don't cache 404 long time
</I>&gt;&gt;<i> negative_ttl 5 minutes
</I>&gt;&gt;<i> positive_dns_ttl 15 hours
</I>&gt;&gt;<i> negative_dns_ttl 1 minutes
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # -------------------------------------
</I>&gt;&gt;<i> # Cache parameters
</I>&gt;&gt;<i> # -------------------------------------
</I>&gt;&gt;<i> # dhparams is before squid-3.5.12-20151222-r13967
</I>&gt;&gt;<i> # tls-dh is AFTER squid-3.5.12-20151222-r13967
</I>&gt;&gt;<i> http_port 3126 ssl-bump generate-host-certificates=on
</I>&gt;&gt;<i> dynamic_cert_mem_cache_size=4MB cert=/usr/local/squid/etc/rootCA.crt
</I>&gt;&gt;<i> key=/usr/local/squid/etc/rootCA.key options=NO_SSLv3
</I>&gt;&gt;<i> tls-dh=/usr/local/squid/etc/dhparam.pem
</I>&gt;<i> I've never ever understood why configure ssl-bump related on http_port,
</I>&gt;<i> It's redirected port 80 to it, or just serve the certificate to client?
</I>My server use both proxy modes: transparent interception and forwarding.
This line is forwarding port. Clients points to it using PAC.
&gt;<i>
</I>&gt;&gt;<i> http_port 3127
</I>&gt;&gt;<i> http_port 3128 intercept
</I>&gt;&gt;<i> # dhparams is before squid-3.5.12-20151222-r13967
</I>&gt;&gt;<i> # tls-dh is AFTER squid-3.5.12-20151222-r13967
</I>&gt;&gt;<i> https_port 3129 intercept ssl-bump generate-host-certificates=on
</I>&gt;&gt;<i> dynamic_cert_mem_cache_size=4MB cert=/usr/local/squid/etc/rootCA.crt
</I>&gt;&gt;<i> key=/usr/local/squid/etc/rootCA.key options=NO_SSLv3
</I>&gt;&gt;<i> tls-dh=/usr/local/squid/etc/dhparam.pem
</I>&gt;&gt;<i> sslproxy_capath /etc/opt/csw/ssl/certs
</I>&gt;&gt;<i> # SINGLE_DH_USE is 3.5 before squid-3.5.12-20151222-r13967
</I>&gt;&gt;<i> #sslproxy_options NO_SSLv3,SINGLE_DH_USE
</I>&gt;&gt;<i> # SINGLE_ECDH_USE is AFTER squid-3.5.12-20151222-r13967
</I>&gt;&gt;<i> sslproxy_options NO_SSLv3,SINGLE_ECDH_USE
</I>&gt;&gt;<i> sslproxy_cipher
</I>&gt;&gt;<i>
</I>EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH+aRSA+RC4:EECDH:EDH+aRSA:HIGH:!RC4:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS
&gt;&gt;<i> sslcrtd_program /usr/local/squid/libexec/ssl_crtd -s /var/lib/ssl_db
</I>&gt;&gt;<i> -M 4MB
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Specify ICP/HTCP explicity
</I>&gt;&gt;<i> icp_port 3130
</I>&gt;&gt;<i> htcp_port 4827
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Cache manager
</I>&gt;&gt;<i> cache_mgr <A HREF="https://lists.squid-cache.org/listinfo/squid-users">mymail at gmail.com</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Cache manager password
</I>&gt;&gt;<i> cachemgr_passwd disable shutdown reconfigure rotate
</I>&gt;&gt;<i> cachemgr_passwd xxxxxxxx all
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Cache user
</I>&gt;&gt;<i> cache_effective_user squid
</I>&gt;&gt;<i> cache_effective_group squid
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Forces reload-into-ims
</I>&gt;&gt;<i> reload_into_ims on
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Hide internal networks details outside
</I>&gt;&gt;<i> via off
</I>&gt;&gt;<i> forwarded_for delete
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Do not show Squid version
</I>&gt;&gt;<i> httpd_suppress_version_string on
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # WCCPv2 parameters
</I>&gt;&gt;<i> wccp2_router 192.168.200.2
</I>&gt;&gt;<i> wccp2_forwarding_method l2
</I>&gt;&gt;<i> wccp2_return_method l2
</I>&gt;&gt;<i> wccp2_rebuild_wait off
</I>&gt;&gt;<i> wccp2_service standard 0
</I>&gt;&gt;<i> wccp2_service dynamic 70
</I>&gt;&gt;<i> wccp2_service_info 70 protocol=tcp
</I>&gt;&gt;<i> flags=dst_ip_hash,src_ip_alt_hash,src_port_alt_hash priority=240
</I>ports=443
&gt;&gt;<i>
</I>&gt;&gt;<i> # Prioritization of local hits
</I>&gt;&gt;<i> qos_flows tos local-hit=0x68
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Specify local DNS cache
</I>&gt;&gt;<i> dns_nameservers 127.0.0.1
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> dns_v4_first on
</I>&gt;&gt;<i> ipcache_size 4096
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # -------------------------------------
</I>&gt;&gt;<i> # Adaptation parameters
</I>&gt;&gt;<i> # -------------------------------------
</I>&gt;&gt;<i> icap_enable on
</I>&gt;&gt;<i> icap_send_client_ip on
</I>&gt;&gt;<i> icap_send_client_username on
</I>&gt;&gt;<i> icap_client_username_header X-Authenticated-User
</I>&gt;&gt;<i> icap_preview_enable on
</I>&gt;&gt;<i> icap_preview_size 1024
</I>&gt;&gt;<i> icap_service service_avi_req reqmod_precache
</I>&gt;&gt;<i> <A HREF="icap://localhost:1344/squidclamav">icap://localhost:1344/squidclamav</A> bypass=off
</I>&gt;&gt;<i> adaptation_access service_avi_req allow all
</I>&gt;&gt;<i> icap_service service_avi_resp respmod_precache
</I>&gt;&gt;<i> <A HREF="icap://localhost:1344/squidclamav">icap://localhost:1344/squidclamav</A> bypass=on
</I>&gt;&gt;<i> adaptation_access service_avi_resp allow all
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ecap_enable on
</I>&gt;&gt;<i> acl HTTP_STATUS_OK http_status 200
</I>&gt;&gt;<i> loadable_modules /usr/local/lib/ecap_adapter_gzip.so
</I>&gt;&gt;<i> ecap_service gzip_service respmod_precache
</I>&gt;&gt;<i> <A HREF="ecap://www.vigos.com/ecap_gzip">ecap://www.vigos.com/ecap_gzip</A> bypass=off
</I>&gt;&gt;<i> adaptation_access gzip_service allow HTTP_STATUS_OK
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # -------------------------------------
</I>&gt;&gt;<i> # Memory parameters
</I>&gt;&gt;<i> # -------------------------------------
</I>&gt;&gt;<i> cache_mem 512 Mb
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> #memory_pools off
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> maximum_object_size_in_memory 1 MB
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # -------------------------------------
</I>&gt;&gt;<i> # Tuning parameters
</I>&gt;&gt;<i> # -------------------------------------
</I>&gt;&gt;<i> memory_replacement_policy heap LRU
</I>&gt;&gt;<i> cache_replacement_policy heap LFUDA
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> store_avg_object_size 85 KB
</I>&gt;&gt;<i> # Default is 20
</I>&gt;&gt;<i> store_objects_per_bucket 32
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Shutdown delay before terminate connections
</I>&gt;&gt;<i> shutdown_lifetime 15 second
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # SMP
</I>&gt;&gt;<i> #workers 2
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # -------------------------------------
</I>&gt;&gt;<i> # Store parameters
</I>&gt;&gt;<i> # -------------------------------------
</I>&gt;&gt;<i> maximum_object_size 8 Gb
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> cache_dir diskd /data/cache/d1 32767 16 256
</I>&gt;&gt;<i> cache_dir diskd /data/cache/d2 32767 16 256
</I>&gt;&gt;<i> cache_dir diskd /data/cache/d3 32767 16 256
</I>&gt;&gt;<i> cache_dir diskd /data/cache/d4 32767 16 256
</I>&gt;&gt;<i>                                                      
</I>&gt;&gt;<i> # -------------------------------------
</I>&gt;&gt;<i> # Process/log parameters
</I>&gt;&gt;<i> # -------------------------------------
</I>&gt;&gt;<i> #logformat my_squid %tl %6tr %&gt;a %Ss/%03&gt;Hs %&lt;st %rm %ru %[un %Sh/%&lt;a %mt
</I>&gt;&gt;<i> #access_log daemon:/data/cache/log/access.log buffer-size=256KB
</I>&gt;&gt;<i> logformat=my_squid !tor_url
</I>&gt;&gt;<i> access_log daemon:/data/cache/log/access.log buffer-size=256KB
</I>&gt;&gt;<i> logformat=squid !tor_url
</I>&gt;&gt;<i> # Don't log ICP queries
</I>&gt;&gt;<i> log_icp_queries off
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Turn off internal log rotation
</I>&gt;&gt;<i> logfile_rotate 0
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> cache_log /data/cache/log/cache.log
</I>&gt;&gt;<i> #cache_log /data/cache/log/cache${process_number}.log
</I>&gt;&gt;<i> cache_store_log none
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Default is off
</I>&gt;&gt;<i> buffered_logs on
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> coredump_dir /var/core
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> pid_filename /tmp/squid.pid
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> strip_query_terms off
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # -------------------------------------
</I>&gt;&gt;<i> # Content parameters
</I>&gt;&gt;<i> # -------------------------------------
</I>&gt;&gt;<i> #range_offset_limit none store_rewrite_list
</I>&gt;&gt;<i> #range_offset_limit none store_rewrite_list_web
</I>&gt;&gt;<i> #range_offset_limit none store_rewrite_list_web_cdn
</I>&gt;&gt;<i> #range_offset_limit none adobe_java_updates
</I>&gt;&gt;<i> #range_offset_limit none windowsupdate
</I>&gt;&gt;<i> range_offset_limit none all
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Updates: Windows, Adobe, Java
</I>&gt;&gt;<i> refresh_pattern -i
</I>&gt;&gt;<i> microsoft.com.*\.(cab|exe|ms[i|u|f|p]|asf|wm[v|a]|dat|zip)    4320 80%
</I>&gt;&gt;<i> 43200    reload-into-ims
</I>&gt;&gt;<i> refresh_pattern -i
</I>&gt;&gt;<i> windowsupdate.com.*\.(cab|exe|ms[i|u|f|p]|asf|wm[v|a]|dat|zip)    4320
</I>&gt;&gt;<i> 80% 43200    reload-into-ims
</I>&gt;&gt;<i> refresh_pattern -i
</I>&gt;&gt;<i>
</I>my.windowsupdate.website.com.*\.(cab|exe|ms[i|u|f|p]|asf|wm[v|a]|dat|zip)
&gt;&gt;<i> 
</I>&gt;&gt;<i> 4320 80% 43200    reload-into-ims
</I>&gt;&gt;<i> refresh_pattern -i adobe.com.*\.(zip|exe)    4320    80%    43200  
</I>&gt;&gt;<i> reload-into-ims
</I>&gt;&gt;<i> refresh_pattern -i java.com.*\.(zip|exe)    4320    80%    43200  
</I>&gt;&gt;<i> reload-into-ims
</I>&gt;&gt;<i> refresh_pattern -i sun.com.*\.(zip|exe)        4320    80%    43200  
</I>&gt;&gt;<i> reload-into-ims
</I>&gt;&gt;<i> refresh_pattern -i google\.com.*\.(zip|exe)    4320    80%    43200  
</I>&gt;&gt;<i> reload-into-ims
</I>&gt;&gt;<i> refresh_pattern -i macromedia\.com.*\.(zip|exe)    4320    80%  
</I>&gt;&gt;<i> 43200    reload-into-ims
</I>&gt;&gt;<i> # Other setups and updates
</I>&gt;&gt;<i> refresh_pattern -i \.(zip|(g|b)z2?|exe|msi|cvd)$    4320    80%  
</I>&gt;&gt;<i> 43200    reload-into-ims
</I>&gt;&gt;<i> # Cacle squidinternal
</I>&gt;&gt;<i> refresh_pattern    -i    video-srv\.youtube\.squidinternal    0   
</I>0%    0
&gt;&gt;<i> refresh_pattern    -i    squidinternal    14400    100%    518400  
</I>&gt;&gt;<i> override-expire override-lastmod refresh-ims reload-into-ims
</I>&gt;&gt;<i> ignore-private ignore-auth ignore-must-revalidate store-stale
</I>&gt;&gt;<i> ignore-no-store
</I>&gt;&gt;<i> # Keep swf in cache
</I>&gt;&gt;<i> refresh_pattern -i \.swf$    10080    100%    43200    override-expire
</I>&gt;&gt;<i> reload-into-ims ignore-private
</I>&gt;&gt;<i> # .NET cache
</I>&gt;&gt;<i> refresh_pattern -i \.((a|m)s(h|p)x?)$        10080    100%    43200  
</I>&gt;&gt;<i> reload-into-ims ignore-private
</I>&gt;&gt;<i> # Other long-lived items
</I>&gt;&gt;<i> refresh_pattern -i
</I>&gt;&gt;<i>
</I>\.(jp(e?g|e|2)|gif|png|bmp|ico|svg|web(p|m)|wm(v|a)|flv|f4f|mp(3|4)|ttf|eot|woff2?|(c|x|j)ss|js(t?|px?))(\?.*)?$

&gt;&gt;<i> 
</I>&gt;&gt;<i> 14400    100%    518400    override-expire override-lastmod
</I>&gt;&gt;<i> reload-into-ims ignore-private ignore-no-store ignore-must-revalidate
</I>&gt;&gt;<i> refresh_pattern -i
</I>&gt;&gt;<i>
</I>\.((cs|d?|m?|p?|r?|s?|w?|x?|z?)h?t?m?(l?)|php(3?|5?)|rss|atom|vr(t|ml))(\?.*)?$

&gt;&gt;<i> 
</I>&gt;&gt;<i> 10080    100%    86400    override-expire override-lastmod
</I>&gt;&gt;<i> reload-into-ims ignore-private ignore-no-store ignore-must-revalidate
</I>&gt;&gt;<i> # Default patterns
</I>&gt;&gt;<i> refresh_pattern -i (/cgi-bin/|\?)    0    0%    0
</I>&gt;&gt;<i> refresh_pattern    .    0    20%    4320    reload-into-ims
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # -------------------------------------
</I>&gt;&gt;<i> # Rewriter parameters
</I>&gt;&gt;<i> # -------------------------------------
</I>&gt;&gt;<i> # ufdbGuard rewriter
</I>&gt;&gt;<i> url_rewrite_program /usr/local/ufdbguard/bin/ufdbgclient -C
</I>&gt;&gt;<i> url_rewrite_children 64 startup=0 idle=1 concurrency=2
</I>&gt;&gt;<i> redirector_bypass off
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Storeurl rewriter
</I>&gt;&gt;<i> store_id_program /usr/local/squid/libexec/storeid_file_rewrite
</I>&gt;&gt;<i> /usr/local/squid/etc/storeid.conf
</I>&gt;&gt;<i> store_id_children 32 startup=0 idle=1 concurrency=4
</I>&gt;&gt;<i> # Store ID access
</I>&gt;&gt;<i> store_id_access deny !GET
</I>&gt;&gt;<i> store_id_access allow store_rewrite_list
</I>&gt;&gt;<i> store_id_access allow store_rewrite_list_web
</I>&gt;&gt;<i> store_id_access allow store_rewrite_list_web_cdn
</I>&gt;&gt;<i> store_id_access allow adobe_java_updates
</I>&gt;&gt;<i> store_id_access deny all
</I>&gt;&gt;<i> store_id_bypass off
</I>&gt;&gt;<i> ###
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I procrastinate to extract only ssl bump related rows and comments, so
</I>&gt;&gt;<i> this is full 3.5.x config from production server. :)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 16.01.16 1:56, Lucas Castro &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On 15-01-2016 16:18, Yuri Voinov wrote:
</I>&gt;&gt;&gt;&gt;<i> _MISS/200 30415 GET
</I>&gt;&gt;&gt;&gt;<i>   
</I>&gt;&gt;<i>
</I><A HREF="https://www.google.com/search?q=Sun+2540-M2+Performance+enhancer&amp;biw=1280&amp;bih=699&amp;noj=1&amp;ei=oAmZVvnxCsW3afKevLAO&amp;start=10&amp;sa=N">https://www.google.com/search?q=Sun+2540-M2+Performance+enhancer&amp;biw=1280&amp;bih=699&amp;noj=1&amp;ei=oAmZVvnxCsW3afKevLAO&amp;start=10&amp;sa=N</A>
&gt;&gt;&gt;&gt;<i>     HIER_DIRECT/216.58.208.227 text/html
</I>&gt;&gt;&gt;&gt;<i>     15/Jan/2016:21:03:23 +0600    356 127.0.0.1 TAG_NONE/200 0 CONNECT
</I>&gt;&gt;&gt;&gt;<i>     ssl.gstatic.com:443 - HIER_DIRECT/178.88.163.157 -
</I>&gt;&gt;&gt;&gt;<i>     15/Jan/2016:21:03:24 +0600    518 127.0.0.1 TCP_MISS/20
</I>&gt;&gt;&gt;<i> Can you share your ssl setup?
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBCAAGBQJWmf95AAoJENNXIZxhPexG0/4H/RPiw0gQ7V0eKhUUepI02Ux8
X+XVeT5uo4jv8j4UL/Q2RwPV5E784x5U1m0aipPl/9zT++IP85vSPbX3F818+oE4
9woW9DPJzC1p60WIOTFQFSlSmgTvVvD5u+68vJbHMMsdkalikYp6Ayw6iLqrYco7
yOlhX1mRRx6Difs6hYBDaYDYyL4pzFkzrPBxK3hFi+dGfdfkUiQpTKmtCqYpLFlT
qUySISE+WFbTlt+ZHLPEW5roktHqj8U/0jMRRljdBjjcEXgm7P9XPfSoViCYXlVU
yzRf7ThZ07ta19PZMhpAdst1gswFFAxPd1uQ+eqw8OcoNyJoWqNaSzBreTTZlbM=
=qFrf
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160116/77264836/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160116/77264836/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008784.html">[squid-users] Fwd: Squid https bump and google apps
</A></li>
	<LI>Next message (by thread): <A HREF="008780.html">[squid-users] I can&#180;t block streaming !!!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8788">[ date ]</a>
              <a href="thread.html#8788">[ thread ]</a>
              <a href="subject.html#8788">[ subject ]</a>
              <a href="author.html#8788">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
