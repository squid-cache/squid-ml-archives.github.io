<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] https full url
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20https%20full%20url&In-Reply-To=%3C569A6A83.3010209%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008786.html">
   <LINK REL="Next"  HREF="008794.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] https full url</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20https%20full%20url&In-Reply-To=%3C569A6A83.3010209%40measurement-factory.com%3E"
       TITLE="[squid-users] https full url">rousskov at measurement-factory.com
       </A><BR>
    <I>Sat Jan 16 16:06:27 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008786.html">[squid-users] https full url
</A></li>
        <LI>Next message (by thread): <A HREF="008794.html">[squid-users] https full url
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8793">[ date ]</a>
              <a href="thread.html#8793">[ thread ]</a>
              <a href="subject.html#8793">[ subject ]</a>
              <a href="author.html#8793">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 01/15/2016 07:52 PM, xxiao8 wrote:
&gt;<i> Just found out ssl::server_name_regex that should cover url_regex, for
</I>&gt;<i> urlpath_regex and referer_regex I think I can not get them for
</I>&gt;<i> https/sslbump, to get them an icap/ecap has to be used to read the
</I>&gt;<i> decrypted content at the moment, will squid plan to provide directives
</I>&gt;<i> similar to urlpath_regex/refere_regex for-sslbump in the future?
</I>
Your understanding of how HTTPS transactions work still does not match
the reality, resulting in confusion about applicability of various Squid
features, especially ACLs.

One way to improve your understanding of reality is to stop thinking
about HTTPS transaction as a single request/response pair. *Roughly
speaking*, an HTTPS transaction is a sequence of several stages:

1. TCP connection establishment.
2. CONNECT transaction(s) that are HTTP transactions with limited info.
3. SSL connection establishment (and bumping).
4. Bumped HTTPS transaction(s) treated as regular HTTP transactions.

Most HTTP-focused ACLs like url_regex are meant for regular HTTP
transactions (stage #4). They are of limited use for CONNECT
transactions (stage #2) and usually do not work during stages #1 and #3.

ICAP/eCAP adaptation may be applied during stage #2 (with limited
information) and stage #4.

The statement &quot;referer_regex does not work for https/sslbump&quot; is neither
true nor false. Thus, you are getting conflicting responses and are
likely to create poorly working configurations until you realize that
&quot;referer_regex&quot; works well at stage #4 but may also be applied at stage
#2 where it does not work well (not enough information in the CONNECT
requests) or at stages #1 and #3 where it should not be used at all.


ACL is just a &quot;named condition&quot; or a &quot;function&quot;. You can type an ACL
name X in any squid.conf directives that use ACLs. That does not mean
that ACL X works with all directives at all times. Someday, Squid or
some squid.conf lint tool would warn about ACLs used in wrong places.
For now, you have to understand what stage-dependent information the
directive has access to and avoid ACLs that require information
unavailable to the directive at the current processing stage.


Good luck,

Alex.
P.S. For intercepted connections, CONNECT transactions in stage #2 are
faked by Squid. For forward-proxied connections, they are real.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008786.html">[squid-users] https full url
</A></li>
	<LI>Next message (by thread): <A HREF="008794.html">[squid-users] https full url
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8793">[ date ]</a>
              <a href="thread.html#8793">[ thread ]</a>
              <a href="subject.html#8793">[ subject ]</a>
              <a href="author.html#8793">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
