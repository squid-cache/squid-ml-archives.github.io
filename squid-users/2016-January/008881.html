<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] external acl helpers working with deny_info
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20external%20acl%20helpers%20working%20with%20deny_info&In-Reply-To=%3CCALgKBSn1W5kuxbyNmD%3Dsq2vD0YT5o%3D2JrsMq%3D22-X_wWvFzmMw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008875.html">
   <LINK REL="Next"  HREF="008884.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] external acl helpers working with deny_info</H1>
    <B>Sreenath BH</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20external%20acl%20helpers%20working%20with%20deny_info&In-Reply-To=%3CCALgKBSn1W5kuxbyNmD%3Dsq2vD0YT5o%3D2JrsMq%3D22-X_wWvFzmMw%40mail.gmail.com%3E"
       TITLE="[squid-users] external acl helpers working with deny_info">bhsreenath at gmail.com
       </A><BR>
    <I>Sun Jan 24 16:18:42 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="008875.html">[squid-users] behavior of external acl helper in Squid 3.5.13
</A></li>
        <LI>Next message (by thread): <A HREF="008884.html">[squid-users] external acl helpers working with deny_info
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8881">[ date ]</a>
              <a href="thread.html#8881">[ thread ]</a>
              <a href="subject.html#8881">[ subject ]</a>
              <a href="author.html#8881">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi All,

I am trying to validate my understanding of external acl, deny_info
and http_access deny all&quot; interaction.

My squid conf has just two rules. First is external ACL helper and
then the &quot;deny all&quot; as follows:

Case (1)
-----------
external_acl_type my_helper ttl=0 negative_ttl=0 children-max=2 %PATH
/usr/local/bin/acl
acl AclName external my_helper
deny_info 404:ERR_MY_ACL      AclName
http_access allow AclName

http_access deny all
--------

I want a default error code of 404 to be returned, along with a custom
error message file being sent.
My observations are as follows:

1. If my external ACL prints OK, it proceeds with processing.
2. If it prints ERR, instead of using the custom message, it proceeds
to next access rule, which is &quot;http_access deny all&quot;

When that fails it prints a default 403 message.

If I remove &quot;deny all&quot; line it works well.

Case (2)
I tried changing &quot;http_access  allow&quot; to &quot;http_access deny&quot; follows:

--------
external_acl_type my_helper ttl=0 negative_ttl=0 children-max=2 %PATH
/usr/local/bin/acl
acl AclName external my_helper
deny_info 404:ERR_MY_ACL    AclName
http_access deny !AclName

http_access deny all
----------

In this case, whenever the acl helpers send &quot;ERR&quot;, it prints the
correct error message.
But now, if it succeeds (prints OK), it goes to next line and fails
there, instead of proceeding with further processing.

Even in this case, removing the next &quot;deny all&quot;  will work correctly.

I find is strange that even when external ACL Helper matches and
prints OK, because of the way
the http_access line worded, it does not take it as a pass and goes to
check next http_access line.

Is this expected behavior? Or am I missing something?

thanks,
Sreenath

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="008875.html">[squid-users] behavior of external acl helper in Squid 3.5.13
</A></li>
	<LI>Next message (by thread): <A HREF="008884.html">[squid-users] external acl helpers working with deny_info
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8881">[ date ]</a>
              <a href="thread.html#8881">[ thread ]</a>
              <a href="subject.html#8881">[ subject ]</a>
              <a href="author.html#8881">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
