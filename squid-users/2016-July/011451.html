<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] host_verify_strict and wildcard SNI
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20host_verify_strict%20and%20wildcard%20SNI&In-Reply-To=%3C099101d1d7c6%246a084b80%243e18e280%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011450.html">
   <LINK REL="Next"  HREF="011452.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] host_verify_strict and wildcard SNI</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20host_verify_strict%20and%20wildcard%20SNI&In-Reply-To=%3C099101d1d7c6%246a084b80%243e18e280%24%40ngtech.co.il%3E"
       TITLE="[squid-users] host_verify_strict and wildcard SNI">eliezer at ngtech.co.il
       </A><BR>
    <I>Wed Jul  6 20:38:55 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011450.html">[squid-users] host_verify_strict and wildcard SNI
</A></li>
        <LI>Next message (by thread): <A HREF="011452.html">[squid-users] host_verify_strict and wildcard SNI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11451">[ date ]</a>
              <a href="thread.html#11451">[ thread ]</a>
              <a href="subject.html#11451">[ subject ]</a>
              <a href="author.html#11451">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Yuri,

I am not the &quot;standards&quot; guy but I do know that if something can be encoded
it can be &quot;decoded&quot;.
There are special cases which needs special &quot;spice&quot; which sometimes is not
present here or there on the shelves.
To my disappointment and happiness there are very good products out there
which are not squid with much better fines invested in them.
I can clearly say that the Squid-Cache project is not the most &quot;advanced&quot;
piece of software in the market and I know that it cannot compare to let say
even 500 coding programmers work.
I have seen couple products that are open source which tries to provide
functionality which is similar to squid only in the protocol level and a
simple proxy with great luck.
Some of them are not as great as they might seems but I think that a young
programmer with enough investment can learn the required subjects to
implement a solution.
However, here admins, users, programmers can ask questions as they please
and I encourage to ask.
I try to answer as much as I can and in many cases my knowledge might not
be enough but I am trying to answer what I can with hope that it will help.
And unlike MD Doctors SysAdmins do not need to swear on something like &quot;do
not harm&quot; and I think it's a good aspect on things.

I am still looking for clues about cloudflare since I have yet to see the
person who hold the keys for them.

Eliezer

----
Eliezer Croitoru &lt;<A HREF="http://ngtech.co.il/lmgtfy/">http://ngtech.co.il/lmgtfy/</A>&gt; 
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>
 

From: Yuri Voinov [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A>] 
Sent: Wednesday, July 6, 2016 11:15 PM
To: Eliezer Croitoru; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] host_verify_strict and wildcard SNI


-----BEGIN PGP SIGNED MESSAGE----- 
Hash: SHA256 
 
I know. Just asked. Since I am familiar with the standards.

07.07.2016 1:54, Eliezer Croitoru &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> Hey Yuri,
</I>
      &gt;

      &gt; These two subjects are not related directly to each other but
      they might have something in common.

      &gt; Squid expects clients connections to meet the basic RFC6066
      section 3:

      &gt; <A HREF="https://tools.ietf.org/html/rfc6066#section-3">https://tools.ietf.org/html/rfc6066#section-3</A>
&lt;<A HREF="https://tools.ietf.org/html/rfc6066">https://tools.ietf.org/html/rfc6066</A>&gt; 

      &gt;

      &gt; Which states that a host name should be there and the legal
      characters of a hostname from both rfc1035 and rc6066 are very
      speicifc.

      &gt; If a specific software are trying to request a wrong sni name
      it's an issue in the client side request or software error
      handling and enforcement.

      &gt; A http server would probably respond with a 4XX response code
      or the default certificate.

      &gt; There are other options of course but the first thing to
      check is if the client is a real browser or some special creature
      that tries it's luck with a special form of ssl.

      &gt; To my understanding host_verify_strict tries to enforce basic
      security levels while in a transparent proxy the rules will always
      change.

      &gt;

      &gt; Eliezer

      &gt;

      &gt; ----

      &gt; Eliezer Croitoru

      &gt; Linux System Administrator

      &gt; Mobile: +972-5-28704261

      &gt; Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt; 

      &gt;

      &gt;

      &gt; -----Original Message-----

      &gt; From: squid-users
      [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of
      Yuri Voinov

      &gt; Sent: Wednesday, July 6, 2016 10:43 PM

      &gt; To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt; 

      &gt; Subject: Re: [squid-users] host_verify_strict and wildcard
      SNI

      &gt;

      &gt;

      &gt; Sounds familiar.

      &gt;

      &gt; Do you experience occasional problems with CloudFlare sites?

      &gt;

      &gt;

      &gt; 06.07.2016 20:36, Steve Hill &#1087;&#1080;&#1096;&#1077;&#1090;:

      &gt;

      &gt; &gt; I'm using a transparent proxy and SSL-peek and have hit
      a problem with

      &gt; an iOS app which seems to be doing broken things with the
      SNI.

      &gt;

      &gt; &gt; The app is making an HTTPS connection to a server and
      presenting an

      &gt; SNI with a wildcard in it - i.e. &quot;*.example.com&quot;.  I'm not
      sure if this

      &gt; behaviour is actually illegal, but it certainly doesn't seem
      to make a

      &gt; lot of sense to me.

      &gt;

      &gt; &gt; Squid then internally generates a &quot;CONNECT
      *.example.com:443&quot; request

      &gt; based on the peeked SNI, which is picked up by
      hostHeaderIpVerify().

      &gt; Since *.example.com isn't a valid DNS name, Squid rejects the
      connection

      &gt; on the basis that *.example.com doesn't match the IP address
      that the

      &gt; client is connecting to.

      &gt;

      &gt; &gt; Unfortunately, I can't see any way of working around the
      problem -

      &gt; &quot;host_verify_strict&quot; is disabled, but according to the docs,

      &gt; &gt; &quot;For now suspicious intercepted CONNECT requests are
      always responded

      &gt; to with an HTTP 409 (Conflict) error page.&quot;

      &gt;

      &gt; &gt; As I understand it, turning host_verify_strict on causes
      problems with

      &gt; CDNs which use DNS tricks for load balancing, so I'm not sure
      I

      &gt; understand the rationale behind preventing it from being
      turned off for

      &gt; CONNECT requests?

      &gt;

      &gt;

      &gt;

      &gt;

-----BEGIN PGP SIGNATURE----- 
Version: GnuPG v2 
 
iQEcBAEBCAAGBQJXfWanAAoJENNXIZxhPexGvqgH/2IuLJk7Aa4D7migO+zAFZ5p 
AheNbsZcXjkT5eno1WqNkGuVROK/L97HHazYz/QvbZp4ioFJ4PZ40nHknP679KqH 
RSiavQlKCmL0AuW6/ztAb7VJRbokUTRGJy39uG9ecw2uEvbS6Iq/LSAH8L9LYZgQ 
vf1wd9y7iCVUDJDz++rl36XY6aqZK2u8mUVhlxoBFsOOLVSbupXIQuVEkdXL61Oo 
Vrau9hUALBk5zWJ+PBlIIs578zIf36J9OhApBa/bR7/tNdVNYnB7uvSbhrgk3N1N 
ChHbm2P2E1mgSMQycVW+I2E5+GvJRvi8K9wMD7TsSwWKJviY7KTS5SFyxDOY224= 
=Ox2x 
-----END PGP SIGNATURE----- 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: winmail.dat
Type: application/ms-tnef
Size: 67365 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160706/ff38c8f5/attachment.bin">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160706/ff38c8f5/attachment.bin</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011450.html">[squid-users] host_verify_strict and wildcard SNI
</A></li>
	<LI>Next message (by thread): <A HREF="011452.html">[squid-users] host_verify_strict and wildcard SNI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11451">[ date ]</a>
              <a href="thread.html#11451">[ thread ]</a>
              <a href="subject.html#11451">[ subject ]</a>
              <a href="author.html#11451">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
