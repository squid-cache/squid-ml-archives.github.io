<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] host_verify_strict and wildcard SNI
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20host_verify_strict%20and%20wildcard%20SNI&In-Reply-To=%3C45d4588e-3d87-8a4d-d6e2-f8384b5ab0eb%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011451.html">
   <LINK REL="Next"  HREF="011453.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] host_verify_strict and wildcard SNI</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20host_verify_strict%20and%20wildcard%20SNI&In-Reply-To=%3C45d4588e-3d87-8a4d-d6e2-f8384b5ab0eb%40gmail.com%3E"
       TITLE="[squid-users] host_verify_strict and wildcard SNI">yvoinov at gmail.com
       </A><BR>
    <I>Wed Jul  6 20:48:57 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011451.html">[squid-users] host_verify_strict and wildcard SNI
</A></li>
        <LI>Next message (by thread): <A HREF="011453.html">[squid-users] host_verify_strict and wildcard SNI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11452">[ date ]</a>
              <a href="thread.html#11452">[ thread ]</a>
              <a href="subject.html#11452">[ subject ]</a>
              <a href="author.html#11452">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256
 
I am very seriously concerned about the issue CDN, because every day I
discover more and more problematic sites, namely in connection with the
CDN and HTTPS. For more than four Squid servers are experiencing these
problems in my network. And I still do not see any reason why any
solutions to these problems.

Moreover, the splice does not solve these problems.

Just skip the whole networks in the proxy bypass.

What is totally unacceptable. Traffic is money. And a lot of money.

07.07.2016 2:38, Eliezer Croitoru &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> Hey Yuri,
</I>&gt;<i>
</I>&gt;<i> I am not the &quot;standards&quot; guy but I do know that if something can be
</I>encoded
&gt;<i> it can be &quot;decoded&quot;.
</I>&gt;<i> There are special cases which needs special &quot;spice&quot; which sometimes is not
</I>&gt;<i> present here or there on the shelves.
</I>&gt;<i> To my disappointment and happiness there are very good products out there
</I>&gt;<i> which are not squid with much better fines invested in them.
</I>&gt;<i> I can clearly say that the Squid-Cache project is not the most &quot;advanced&quot;
</I>&gt;<i> piece of software in the market and I know that it cannot compare to
</I>let say
&gt;<i> even 500 coding programmers work.
</I>&gt;<i> I have seen couple products that are open source which tries to provide
</I>&gt;<i> functionality which is similar to squid only in the protocol level and a
</I>&gt;<i> simple proxy with great luck.
</I>&gt;<i> Some of them are not as great as they might seems but I think that a young
</I>&gt;<i> programmer with enough investment can learn the required subjects to
</I>&gt;<i> implement a solution.
</I>&gt;<i> However, here admins, users, programmers can ask questions as they please
</I>&gt;<i> and I encourage to ask.
</I>&gt;<i> I try to answer as much as I can and in many cases my knowledge might not
</I>&gt;<i> be enough but I am trying to answer what I can with hope that it will
</I>help.
&gt;<i> And unlike MD Doctors SysAdmins do not need to swear on something like &quot;do
</I>&gt;<i> not harm&quot; and I think it's a good aspect on things.
</I>&gt;<i>
</I>&gt;<i> I am still looking for clues about cloudflare since I have yet to see the
</I>&gt;<i> person who hold the keys for them.
</I>&gt;<i>
</I>&gt;<i> Eliezer
</I>&gt;<i>
</I>&gt;<i> ----
</I>&gt;<i> Eliezer Croitoru &lt;<A HREF="http://ngtech.co.il/lmgtfy/">http://ngtech.co.il/lmgtfy/</A>&gt;
</I>&gt;<i> Linux System Administrator
</I>&gt;<i> Mobile: +972-5-28704261
</I>&gt;<i> Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>
</I>&gt;<i> 
</I>&gt;<i>
</I>&gt;<i> From: Yuri Voinov [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A>]
</I>&gt;<i> Sent: Wednesday, July 6, 2016 11:15 PM
</I>&gt;<i> To: Eliezer Croitoru; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: Re: [squid-users] host_verify_strict and wildcard SNI
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I know. Just asked. Since I am familiar with the standards.
</I>&gt;<i>
</I>&gt;<i> 07.07.2016 1:54, Eliezer Croitoru &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;<i> &gt; Hey Yuri,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt; These two subjects are not related directly to each other but
</I>&gt;<i>       they might have something in common.
</I>&gt;<i>
</I>&gt;<i>       &gt; Squid expects clients connections to meet the basic RFC6066
</I>&gt;<i>       section 3:
</I>&gt;<i>
</I>&gt;<i>       &gt; <A HREF="https://tools.ietf.org/html/rfc6066#section-3">https://tools.ietf.org/html/rfc6066#section-3</A>
</I>&gt;<i> &lt;<A HREF="https://tools.ietf.org/html/rfc6066">https://tools.ietf.org/html/rfc6066</A>&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt; Which states that a host name should be there and the legal
</I>&gt;<i>       characters of a hostname from both rfc1035 and rc6066 are very
</I>&gt;<i>       speicifc.
</I>&gt;<i>
</I>&gt;<i>       &gt; If a specific software are trying to request a wrong sni name
</I>&gt;<i>       it's an issue in the client side request or software error
</I>&gt;<i>       handling and enforcement.
</I>&gt;<i>
</I>&gt;<i>       &gt; A http server would probably respond with a 4XX response code
</I>&gt;<i>       or the default certificate.
</I>&gt;<i>
</I>&gt;<i>       &gt; There are other options of course but the first thing to
</I>&gt;<i>       check is if the client is a real browser or some special creature
</I>&gt;<i>       that tries it's luck with a special form of ssl.
</I>&gt;<i>
</I>&gt;<i>       &gt; To my understanding host_verify_strict tries to enforce basic
</I>&gt;<i>       security levels while in a transparent proxy the rules will always
</I>&gt;<i>       change.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt; Eliezer
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt; ----
</I>&gt;<i>
</I>&gt;<i>       &gt; Eliezer Croitoru
</I>&gt;<i>
</I>&gt;<i>       &gt; Linux System Administrator
</I>&gt;<i>
</I>&gt;<i>       &gt; Mobile: +972-5-28704261
</I>&gt;<i>
</I>&gt;<i>       &gt; Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt; -----Original Message-----
</I>&gt;<i>
</I>&gt;<i>       &gt; From: squid-users
</I>&gt;<i>       [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of
</I>&gt;<i>       Yuri Voinov
</I>&gt;<i>
</I>&gt;<i>       &gt; Sent: Wednesday, July 6, 2016 10:43 PM
</I>&gt;<i>
</I>&gt;<i>       &gt; To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i>
</I>&gt;<i>       &gt; Subject: Re: [squid-users] host_verify_strict and wildcard
</I>&gt;<i>       SNI
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt; Sounds familiar.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt; Do you experience occasional problems with CloudFlare sites?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt; 06.07.2016 20:36, Steve Hill &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt; &gt; I'm using a transparent proxy and SSL-peek and have hit
</I>&gt;<i>       a problem with
</I>&gt;<i>
</I>&gt;<i>       &gt; an iOS app which seems to be doing broken things with the
</I>&gt;<i>       SNI.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt; &gt; The app is making an HTTPS connection to a server and
</I>&gt;<i>       presenting an
</I>&gt;<i>
</I>&gt;<i>       &gt; SNI with a wildcard in it - i.e. &quot;*.example.com&quot;.  I'm not
</I>&gt;<i>       sure if this
</I>&gt;<i>
</I>&gt;<i>       &gt; behaviour is actually illegal, but it certainly doesn't seem
</I>&gt;<i>       to make a
</I>&gt;<i>
</I>&gt;<i>       &gt; lot of sense to me.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt; &gt; Squid then internally generates a &quot;CONNECT
</I>&gt;<i>       *.example.com:443&quot; request
</I>&gt;<i>
</I>&gt;<i>       &gt; based on the peeked SNI, which is picked up by
</I>&gt;<i>       hostHeaderIpVerify().
</I>&gt;<i>
</I>&gt;<i>       &gt; Since *.example.com isn't a valid DNS name, Squid rejects the
</I>&gt;<i>       connection
</I>&gt;<i>
</I>&gt;<i>       &gt; on the basis that *.example.com doesn't match the IP address
</I>&gt;<i>       that the
</I>&gt;<i>
</I>&gt;<i>       &gt; client is connecting to.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt; &gt; Unfortunately, I can't see any way of working around the
</I>&gt;<i>       problem -
</I>&gt;<i>
</I>&gt;<i>       &gt; &quot;host_verify_strict&quot; is disabled, but according to the docs,
</I>&gt;<i>
</I>&gt;<i>       &gt; &gt; &quot;For now suspicious intercepted CONNECT requests are
</I>&gt;<i>       always responded
</I>&gt;<i>
</I>&gt;<i>       &gt; to with an HTTP 409 (Conflict) error page.&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>       &gt; &gt; As I understand it, turning host_verify_strict on causes
</I>&gt;<i>       problems with
</I>&gt;<i>
</I>&gt;<i>       &gt; CDNs which use DNS tricks for load balancing, so I'm not sure
</I>&gt;<i>       I
</I>&gt;<i>
</I>&gt;<i>       &gt; understand the rationale behind preventing it from being
</I>&gt;<i>       turned off for
</I>&gt;<i>
</I>&gt;<i>       &gt; CONNECT requests?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBCAAGBQJXfW65AAoJENNXIZxhPexGWaYIAM0SDMtDNaeqMhQAzPn2vIBL
enqBVF1yyg532T3zGg/QwznS6dz2qKiNuMTmVfRgX0Z7QWOe/IiLlDPHboe11MXe
Y2r5JOsPht3uq/iWBPewdFlEkzLxvWlLuG65Rd9TOTmuTvM5OKTnHIHUIhXzEQXW
NUITE/FlVKoUQb5mK4wOMoDCX1gXQ1FKm77F8HxsGdwlLqx4YbMqH4J1AVJu/FwZ
IRNbnXvqXQIEn+iePPwghPxsIDl7iDzQ2H70RDeATdClaPco9bEbvxv/6pdS2hI0
Al9bCx7vNbp0pEgUmzX+O9KOWQAu0s2qhxbJ1z9eZnXFciysPBsZJf1LJ4JPbrg=
=bLEa
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160707/0db3b166/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160707/0db3b166/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x613DEC46.asc
Type: application/pgp-keys
Size: 2437 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160707/0db3b166/attachment.key">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160707/0db3b166/attachment.key</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011451.html">[squid-users] host_verify_strict and wildcard SNI
</A></li>
	<LI>Next message (by thread): <A HREF="011453.html">[squid-users] host_verify_strict and wildcard SNI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11452">[ date ]</a>
              <a href="thread.html#11452">[ thread ]</a>
              <a href="subject.html#11452">[ subject ]</a>
              <a href="author.html#11452">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
