<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] host_verify_strict and wildcard SNI
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20host_verify_strict%20and%20wildcard%20SNI&In-Reply-To=%3C004201d1d7d0%24e10b2b30%24a3218190%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011452.html">
   <LINK REL="Next"  HREF="011474.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] host_verify_strict and wildcard SNI</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20host_verify_strict%20and%20wildcard%20SNI&In-Reply-To=%3C004201d1d7d0%24e10b2b30%24a3218190%24%40ngtech.co.il%3E"
       TITLE="[squid-users] host_verify_strict and wildcard SNI">eliezer at ngtech.co.il
       </A><BR>
    <I>Wed Jul  6 21:53:49 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011452.html">[squid-users] host_verify_strict and wildcard SNI
</A></li>
        <LI>Next message (by thread): <A HREF="011474.html">[squid-users] host_verify_strict and wildcard SNI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11453">[ date ]</a>
              <a href="thread.html#11453">[ thread ]</a>
              <a href="subject.html#11453">[ subject ]</a>
              <a href="author.html#11453">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>If the splice doesn&#8217;t solve the issue what would you expect squid to do?

Spilce equals routing&#8230;

The other solution which ufdbguard implements is probing the destination hosts.

If you want a solution I can try to see if it is possible but I cannot guarantee that you or anyone will like it.

 

Eliezer

 

----

 &lt;<A HREF="http://ngtech.co.il/lmgtfy/">http://ngtech.co.il/lmgtfy/</A>&gt; Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>



 

From: Yuri Voinov [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A>] 
Sent: Wednesday, July 6, 2016 11:49 PM
To: Eliezer Croitoru; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] host_verify_strict and wildcard SNI

 


-----BEGIN PGP SIGNED MESSAGE----- 
Hash: SHA256 
 
I am very seriously concerned about the issue CDN, because every day I discover more and more problematic sites, namely in connection with the CDN and HTTPS. For more than four Squid servers are experiencing these problems in my network. And I still do not see any reason why any solutions to these problems.

Moreover, the splice does not solve these problems.

Just skip the whole networks in the proxy bypass.

What is totally unacceptable. Traffic is money. And a lot of money.

07.07.2016 2:38, Eliezer Croitoru &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> Hey Yuri,
</I>


      &gt;



      &gt; I am not the &quot;standards&quot; guy but I do know that if something

      can be encoded



      &gt; it can be &quot;decoded&quot;.



      &gt; There are special cases which needs special &quot;spice&quot; which

      sometimes is not



      &gt; present here or there on the shelves.



      &gt; To my disappointment and happiness there are very good

      products out there



      &gt; which are not squid with much better fines invested in them.



      &gt; I can clearly say that the Squid-Cache project is not the

      most &quot;advanced&quot;



      &gt; piece of software in the market and I know that it cannot

      compare to let say



      &gt; even 500 coding programmers work.



      &gt; I have seen couple products that are open source which tries

      to provide



      &gt; functionality which is similar to squid only in the protocol

      level and a



      &gt; simple proxy with great luck.



      &gt; Some of them are not as great as they might seems but I think

      that a young



      &gt; programmer with enough investment can learn the required

      subjects to



      &gt; implement a solution.



      &gt; However, here admins, users, programmers can ask questions as

      they please



      &gt; and I encourage to ask.



      &gt; I try to answer as much as I can and in many cases my

      knowledge might not



      &gt; be enough but I am trying to answer what I can with hope that

      it will help.



      &gt; And unlike MD Doctors SysAdmins do not need to swear on

      something like &quot;do



      &gt; not harm&quot; and I think it's a good aspect on things.



      &gt;



      &gt; I am still looking for clues about cloudflare since I have

      yet to see the



      &gt; person who hold the keys for them.



      &gt;



      &gt; Eliezer



      &gt;



      &gt; ----



      &gt; Eliezer Croitoru  &lt;<A HREF="http://ngtech.co.il/lmgtfy/">http://ngtech.co.il/lmgtfy/</A>&gt; &lt;<A HREF="http://ngtech.co.il/lmgtfy/">http://ngtech.co.il/lmgtfy/</A>&gt; 



      &gt; Linux System Administrator



      &gt; Mobile: +972-5-28704261



      &gt; Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>



      &gt;  



      &gt;



      &gt; From: Yuri Voinov [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A>] 



      &gt; Sent: Wednesday, July 6, 2016 11:15 PM



      &gt; To: Eliezer Croitoru; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt; 



      &gt; Subject: Re: [squid-users] host_verify_strict and wildcard

      SNI



      &gt;



      &gt;



      &gt; I know. Just asked. Since I am familiar with the standards.



      &gt;



      &gt; 07.07.2016 1:54, Eliezer Croitoru &#1087;&#1080;&#1096;&#1077;&#1090;:



      &gt; &gt; Hey Yuri,



      &gt;



      &gt;



      &gt;



      &gt;       &gt; These two subjects are not related directly to

      each other but



      &gt;       they might have something in common.



      &gt;



      &gt;       &gt; Squid expects clients connections to meet the

      basic RFC6066



      &gt;       section 3:



      &gt;



      &gt;       &gt; <A HREF="https://tools.ietf.org/html/rfc6066#section-3">https://tools.ietf.org/html/rfc6066#section-3</A>



      &gt;  &lt;<A HREF="https://tools.ietf.org/html/rfc6066">https://tools.ietf.org/html/rfc6066</A>&gt; &lt;<A HREF="https://tools.ietf.org/html/rfc6066">https://tools.ietf.org/html/rfc6066</A>&gt;



      &gt;



      &gt;



      &gt;



      &gt;       &gt; Which states that a host name should be there and

      the legal



      &gt;       characters of a hostname from both rfc1035 and rc6066

      are very



      &gt;       speicifc.



      &gt;



      &gt;       &gt; If a specific software are trying to request a

      wrong sni name



      &gt;       it's an issue in the client side request or software

      error



      &gt;       handling and enforcement.



      &gt;



      &gt;       &gt; A http server would probably respond with a 4XX

      response code



      &gt;       or the default certificate.



      &gt;



      &gt;       &gt; There are other options of course but the first

      thing to



      &gt;       check is if the client is a real browser or some

      special creature



      &gt;       that tries it's luck with a special form of ssl.



      &gt;



      &gt;       &gt; To my understanding host_verify_strict tries to

      enforce basic



      &gt;       security levels while in a transparent proxy the rules

      will always



      &gt;       change.



      &gt;



      &gt;



      &gt;



      &gt;       &gt; Eliezer



      &gt;



      &gt;



      &gt;



      &gt;       &gt; ----



      &gt;



      &gt;       &gt; Eliezer Croitoru



      &gt;



      &gt;       &gt; Linux System Administrator



      &gt;



      &gt;       &gt; Mobile: +972-5-28704261



      &gt;



      &gt;       &gt; Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt; 

       &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt; &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;



      &gt;



      &gt;



      &gt;



      &gt;



      &gt;



      &gt;       &gt; -----Original Message-----



      &gt;



      &gt;       &gt; From: squid-users



      &gt;       [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On

      Behalf Of



      &gt;       Yuri Voinov



      &gt;



      &gt;       &gt; Sent: Wednesday, July 6, 2016 10:43 PM



      &gt;



      &gt;       &gt; To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt; 



      &gt;  &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt; &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;



      &gt;



      &gt;       &gt; Subject: Re: [squid-users] host_verify_strict and

      wildcard



      &gt;       SNI



      &gt;



      &gt;



      &gt;



      &gt;



      &gt;



      &gt;       &gt; Sounds familiar.



      &gt;



      &gt;



      &gt;



      &gt;       &gt; Do you experience occasional problems with

      CloudFlare sites?



      &gt;



      &gt;



      &gt;



      &gt;



      &gt;



      &gt;       &gt; 06.07.2016 20:36, Steve Hill &#1087;&#1080;&#1096;&#1077;&#1090;:



      &gt;



      &gt;



      &gt;



      &gt;       &gt; &gt; I'm using a transparent proxy and SSL-peek

      and have hit



      &gt;       a problem with



      &gt;



      &gt;       &gt; an iOS app which seems to be doing broken things

      with the



      &gt;       SNI.



      &gt;



      &gt;



      &gt;



      &gt;       &gt; &gt; The app is making an HTTPS connection to a

      server and



      &gt;       presenting an



      &gt;



      &gt;       &gt; SNI with a wildcard in it - i.e. &quot;*.example.com&quot;. 

      I'm not



      &gt;       sure if this



      &gt;



      &gt;       &gt; behaviour is actually illegal, but it certainly

      doesn't seem



      &gt;       to make a



      &gt;



      &gt;       &gt; lot of sense to me.



      &gt;



      &gt;



      &gt;



      &gt;       &gt; &gt; Squid then internally generates a &quot;CONNECT



      &gt;       *.example.com:443&quot; request



      &gt;



      &gt;       &gt; based on the peeked SNI, which is picked up by



      &gt;       hostHeaderIpVerify().



      &gt;



      &gt;       &gt; Since *.example.com isn't a valid DNS name, Squid

      rejects the



      &gt;       connection



      &gt;



      &gt;       &gt; on the basis that *.example.com doesn't match the

      IP address



      &gt;       that the



      &gt;



      &gt;       &gt; client is connecting to.



      &gt;



      &gt;



      &gt;



      &gt;       &gt; &gt; Unfortunately, I can't see any way of working

      around the



      &gt;       problem -



      &gt;



      &gt;       &gt; &quot;host_verify_strict&quot; is disabled, but according to

      the docs,



      &gt;



      &gt;       &gt; &gt; &quot;For now suspicious intercepted CONNECT

      requests are



      &gt;       always responded



      &gt;



      &gt;       &gt; to with an HTTP 409 (Conflict) error page.&quot;



      &gt;



      &gt;



      &gt;



      &gt;       &gt; &gt; As I understand it, turning

      host_verify_strict on causes



      &gt;       problems with



      &gt;



      &gt;       &gt; CDNs which use DNS tricks for load balancing, so

      I'm not sure



      &gt;       I



      &gt;



      &gt;       &gt; understand the rationale behind preventing it from

     being



      &gt;       turned off for



      &gt;



      &gt;       &gt; CONNECT requests?



      &gt;



      &gt;



      &gt;



      &gt;



      &gt;



      &gt;



      &gt;



      &gt;



      &gt;
-----BEGIN PGP SIGNATURE----- 
Version: GnuPG v2 
 
iQEcBAEBCAAGBQJXfW65AAoJENNXIZxhPexGWaYIAM0SDMtDNaeqMhQAzPn2vIBL 
enqBVF1yyg532T3zGg/QwznS6dz2qKiNuMTmVfRgX0Z7QWOe/IiLlDPHboe11MXe 
Y2r5JOsPht3uq/iWBPewdFlEkzLxvWlLuG65Rd9TOTmuTvM5OKTnHIHUIhXzEQXW 
NUITE/FlVKoUQb5mK4wOMoDCX1gXQ1FKm77F8HxsGdwlLqx4YbMqH4J1AVJu/FwZ 
IRNbnXvqXQIEn+iePPwghPxsIDl7iDzQ2H70RDeATdClaPco9bEbvxv/6pdS2hI0 
Al9bCx7vNbp0pEgUmzX+O9KOWQAu0s2qhxbJ1z9eZnXFciysPBsZJf1LJ4JPbrg= 
=bLEa 
-----END PGP SIGNATURE----- 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160707/f796037e/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160707/f796037e/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 11297 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160707/f796037e/attachment.png">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160707/f796037e/attachment.png</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011452.html">[squid-users] host_verify_strict and wildcard SNI
</A></li>
	<LI>Next message (by thread): <A HREF="011474.html">[squid-users] host_verify_strict and wildcard SNI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11453">[ date ]</a>
              <a href="thread.html#11453">[ thread ]</a>
              <a href="subject.html#11453">[ subject ]</a>
              <a href="author.html#11453">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
