<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Skype, SSL bump and go.trouter.io
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Skype%2C%20SSL%20bump%20and%20go.trouter.io&In-Reply-To=%3C01ce01d1d837%2459c6d9a0%240d548ce0%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011462.html">
   <LINK REL="Next"  HREF="011472.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Skype, SSL bump and go.trouter.io</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Skype%2C%20SSL%20bump%20and%20go.trouter.io&In-Reply-To=%3C01ce01d1d837%2459c6d9a0%240d548ce0%24%40ngtech.co.il%3E"
       TITLE="[squid-users] Skype, SSL bump and go.trouter.io">eliezer at ngtech.co.il
       </A><BR>
    <I>Thu Jul  7 10:07:20 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011462.html">[squid-users] Skype, SSL bump and go.trouter.io
</A></li>
        <LI>Next message (by thread): <A HREF="011472.html">[squid-users] Skype, SSL bump and go.trouter.io
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11463">[ date ]</a>
              <a href="thread.html#11463">[ thread ]</a>
              <a href="subject.html#11463">[ subject ]</a>
              <a href="author.html#11463">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Can you verify please using a debug 11,9 that squid is not altering the request in any form?
Such as mentioned at: <A HREF="http://bugs.squid-cache.org/show_bug.cgi?id=4253">http://bugs.squid-cache.org/show_bug.cgi?id=4253</A>

Have you tried adding:
request_header_access Surrogate-Capability deny all

Microsoft is in the edge of technology compared to what some might think but if they do not reveal their cards it doesn't mean they are stupid(not directed to you).
If there is a security expert out there for Linux, there is more then one for MS.

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>


-----Original Message-----
From: Steve Hill [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">steve at opendium.com</A>] 
Sent: Thursday, July 7, 2016 11:45 AM
To: Eliezer Croitoru; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Skype, SSL bump and go.trouter.io

On 06/07/16 20:44, Eliezer Croitoru wrote:

&gt;<i> There are couple options to the issue and a bad request can happen if
</I>&gt;<i> squid transforms or modifies the request. Did you tried to use basic
</I>&gt;<i> debug sections output to verify if you are able to &quot;replicate&quot; the
</I>&gt;<i> request using a tiny script or curl? I think that section 11 is the
</I>&gt;<i> right one to start with
</I>&gt;<i> (<A HREF="http://wiki.squid-cache.org/KnowledgeBase/DebugSections">http://wiki.squid-cache.org/KnowledgeBase/DebugSections</A>) There were
</I>&gt;<i> couple issues with intercepted https connections in the past but a
</I>&gt;<i> 400 means that something is bad and mainly in the expected input and
</I>&gt;<i> not a certificate but it is possible that other reasons are there. I
</I>&gt;<i> have not tried to use skype in a transparent environment for a very
</I>&gt;<i> long time but I can try to test it later.
</I>
I tcpdumped the icap REQMOD session to retrieve the request and tried it
manually (direct to the Skype server) with openssl s_client.  The Skype
server (not Squid) returned a 400.  But of course, the Skype request
contains various data that the server will probably (correctly) see as a
replay attack, so it isn't a very good test - all I can really say is
that the real Skype client was getting exactly the same error from the
server when the connection is bumped, but works fine when it is tunnelled.

Annoyingly, Skype doesn't include an SNI in the handshake, so peeking in
order to exclude it from being bumped isn't an option.

The odd thing is that I have had Skype working in a transparent 
environment previously (with the unprivalidged ports unfirewalled), so I 
wonder if this is something new from Microsoft.

-- 
  - Steve Hill
    Technical Director
    Opendium Limited     <A HREF="http://www.opendium.com">http://www.opendium.com</A>

Direct contacts:
    Instant messager: xmpp:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">steve at opendium.com</A>
    Email:            <A HREF="https://lists.squid-cache.org/listinfo/squid-users">steve at opendium.com</A>
    Phone:            sip:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">steve at opendium.com</A>

Sales / enquiries contacts:
    Email:            <A HREF="https://lists.squid-cache.org/listinfo/squid-users">sales at opendium.com</A>
    Phone:            +44-1792-824568 / sip:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">sales at opendium.com</A>

Support contacts:
    Email:            <A HREF="https://lists.squid-cache.org/listinfo/squid-users">support at opendium.com</A>
    Phone:            +44-1792-825748 / sip:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">support at opendium.com</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011462.html">[squid-users] Skype, SSL bump and go.trouter.io
</A></li>
	<LI>Next message (by thread): <A HREF="011472.html">[squid-users] Skype, SSL bump and go.trouter.io
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11463">[ date ]</a>
              <a href="thread.html#11463">[ thread ]</a>
              <a href="subject.html#11463">[ subject ]</a>
              <a href="author.html#11463">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
