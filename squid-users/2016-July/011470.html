<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] host_verify_strict and wildcard SNI
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20host_verify_strict%20and%20wildcard%20SNI&In-Reply-To=%3C577E6053.2030300%40urlfilterdb.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011469.html">
   <LINK REL="Next"  HREF="011471.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] host_verify_strict and wildcard SNI</H1>
    <B>Marcus Kool</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20host_verify_strict%20and%20wildcard%20SNI&In-Reply-To=%3C577E6053.2030300%40urlfilterdb.com%3E"
       TITLE="[squid-users] host_verify_strict and wildcard SNI">marcus.kool at urlfilterdb.com
       </A><BR>
    <I>Thu Jul  7 13:59:47 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011469.html">[squid-users] host_verify_strict and wildcard SNI
</A></li>
        <LI>Next message (by thread): <A HREF="011471.html">[squid-users] host_verify_strict and wildcard SNI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11470">[ date ]</a>
              <a href="thread.html#11470">[ thread ]</a>
              <a href="subject.html#11470">[ subject ]</a>
              <a href="author.html#11470">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

On 07/07/2016 10:49 AM, Yuri wrote:

&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> A similar question can be asked about SNI names containing unusual
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> characters. At some point, it would be too dangerous to include SNI
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> information in the fake CONNECT request because it will interfere with
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> HTTP rules, but it is not clear where that point is exactly.
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> To support the weirdest apps Squid might have to simply copy all
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> unusual characters to present the same parameter values to the server.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> It is being mapped into the HTTP equivalent value. Which are Host:
</I>&gt;&gt;&gt;&gt;&gt;<i> header and authority-URI. Only valid FQDN names can make it through the
</I>&gt;&gt;&gt;&gt;&gt;<i> mapping.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Here things get complicated.
</I>&gt;&gt;&gt;&gt;<i> It is correct that Squid enforces apps to follow standards or
</I>&gt;&gt;&gt;&gt;<i> should Squid try to proxy connections for apps when it can?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Squid isn't enforcing standards here. As Steve original messge says it:
</I>&gt;&gt;&gt;<i> &quot;generates a &quot;CONNECT *.example.com:443&quot; request based on the peeked SNI&quot;
</I>&gt;&gt;&gt;<i>   - which is arguably invalid HTTP syntax, but oh well.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> It then is unable to do a DNS lookup for *.example.com to find out what
</I>&gt;&gt;&gt;<i> its IPs are and does the error handling action for a failure to verify
</I>&gt;&gt;&gt;<i> on a CONNECT message.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> yes, the fake CONNECT is dealt with like a regular CONNECT including
</I>&gt;&gt;<i> DNS lookup.  I fear for other apps (besides the one ios app that Steve
</I>&gt;&gt;<i> refers to) to break because Squid may connect to a different IP than
</I>&gt;&gt;<i> the client/app is requesting.
</I>&gt;&gt;<i> If Squid uses the original IP to connect without doing a DNS lookup,
</I>&gt;&gt;<i> Steve's app will work and potential issues with other apps are
</I>&gt;&gt;<i> prevented.
</I>
&gt;<i> Interestingly, Marcus. Does this mean that the CDN may be at different points in time different IP connection and it makes it impossible for client connections through Squid?
</I>
It all depends on the app/client: if it uses a servername/SNI that
resolves to multiple IP addresses but needs to connect to the one
that it specifically wants to CONNECT to, the app can fail since
Squid might choose an other IP address to connect to.

Or, apps might become slow since it might be faster when it reconnects
to the same server that it connected to before.
I think it is best to prevent issues and that Squid should connect
to the IP that the client is trying to connect to.

Marcus

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011469.html">[squid-users] host_verify_strict and wildcard SNI
</A></li>
	<LI>Next message (by thread): <A HREF="011471.html">[squid-users] host_verify_strict and wildcard SNI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11470">[ date ]</a>
              <a href="thread.html#11470">[ thread ]</a>
              <a href="subject.html#11470">[ subject ]</a>
              <a href="author.html#11470">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
