<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] host_verify_strict and wildcard SNI
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20host_verify_strict%20and%20wildcard%20SNI&In-Reply-To=%3C577E886C.80007%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011471.html">
   <LINK REL="Next"  HREF="011480.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] host_verify_strict and wildcard SNI</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20host_verify_strict%20and%20wildcard%20SNI&In-Reply-To=%3C577E886C.80007%40measurement-factory.com%3E"
       TITLE="[squid-users] host_verify_strict and wildcard SNI">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Jul  7 16:50:52 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011471.html">[squid-users] host_verify_strict and wildcard SNI
</A></li>
        <LI>Next message (by thread): <A HREF="011480.html">[squid-users] host_verify_strict and wildcard SNI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11476">[ date ]</a>
              <a href="thread.html#11476">[ thread ]</a>
              <a href="subject.html#11476">[ subject ]</a>
              <a href="author.html#11476">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07/07/2016 06:23 AM, Amos Jeffries wrote:
&gt;<i> On 7/07/2016 11:30 p.m., Marcus Kool wrote:
</I>&gt;&gt;&gt;&gt;<i> On 07/06/2016 10:07 PM, Alex Rousskov wrote:
</I>&gt;&gt;&gt;&gt;&gt;<i> Q3. What should Squid do when receiving a wildcard SNI?
</I>
&gt;&gt;<i> Squid _has_ the original IP so why would Squid potentially connect to an
</I>&gt;&gt;<i> other IP ?
</I>
&gt;<i> Because the inbound and outbound connections are not related. 
</I>
For intercepted connections they should be IMHO. By default, we should
[if allowed by all the internal checks] connect to the exact IP the
client was connecting to when we intercepted (cache peering, cache hits,
and similar special cases aside, of course).

Amos, are you sure we not doing that already for intercepted
connections? If we are not, I think this is a missing feature essential
for many (most?) deployments! I certainly understand that some admins
will need to &quot;reroute&quot; some intercepted requests, but rerouting ought to
be an exception, not the norm. Do you agree?

Please note that going to where the client went does not have to weaken
any internal checks.


&gt;<i> The
</I>&gt;<i> outbound is normally done to any of the IPs that the request message
</I>&gt;<i> domain/Host header resolve to.
</I>
For intercepted SSL connections, there is no HTTP request message with
that information so it is especially pressing to connect to where the
client was going.

Perhaps we screwed it up by replacing the IP address with SNI in the
fake CONNECT target at some point? If that is what changed Squid
behavior, then we should fix the code so that Squid connects to the
intended destination IP regardless of the fake CONNECT target. One way
to do that would be to provide that intended IP address in the fake
CONNECT request itself, via X-Going-To or similar -- doing so would
allow adaptation services to adjust Squid behavior as needed.

[Wildcard] SNI validation is a separate problem that also needs a
solution. The feature/fix discussed above is not sufficient alone.


Thank you,

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011471.html">[squid-users] host_verify_strict and wildcard SNI
</A></li>
	<LI>Next message (by thread): <A HREF="011480.html">[squid-users] host_verify_strict and wildcard SNI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11476">[ date ]</a>
              <a href="thread.html#11476">[ thread ]</a>
              <a href="subject.html#11476">[ subject ]</a>
              <a href="author.html#11476">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
