<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] HTTPS bump doesn't work with websites that require SNI
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20HTTPS%20bump%20doesn%27t%20work%20with%20websites%20that%20require%20SNI&In-Reply-To=%3CCANBz0h4--oFWUn_pX2ftMAhq%2B1W3_ydG0HqMEpS4vOHDf6ZEOA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011466.html">
   <LINK REL="Next"  HREF="011495.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] HTTPS bump doesn't work with websites that require SNI</H1>
    <B>Yi&#287;itcan U&#199;UM</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20HTTPS%20bump%20doesn%27t%20work%20with%20websites%20that%20require%20SNI&In-Reply-To=%3CCANBz0h4--oFWUn_pX2ftMAhq%2B1W3_ydG0HqMEpS4vOHDf6ZEOA%40mail.gmail.com%3E"
       TITLE="[squid-users] HTTPS bump doesn't work with websites that require SNI">yucum at amonra.com.tr
       </A><BR>
    <I>Sun Jul 10 12:48:56 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011466.html">[squid-users] how to connect machine linux to squid proxy,	not in browser?
</A></li>
        <LI>Next message (by thread): <A HREF="011495.html">[squid-users] HTTPS bump doesn't work with websites that	require SNI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11494">[ date ]</a>
              <a href="thread.html#11494">[ thread ]</a>
              <a href="subject.html#11494">[ subject ]</a>
              <a href="author.html#11494">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello there. We're using pfsense and squid-proxy to bump https connections
between some of our machines and www. The setup seems to works fine for
most of the https sites, but it doesn't work for the others.

One example to this sites is &quot;docs.docker.com&quot;. Even though we can connect
to &quot;docker.com&quot;, we can't connect to &quot;docs.docker.com&quot;.

The error we get is:

(92) Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)

Handshake with SSL server failed: error:14077410:SSL
routines:SSL23_GET_SERVER_HELLO:sslv3 alert handshake failure

Upon further investigation we found out that this happens because some
sites require SNI to supply correct SSL certificate.

You can test this out with:

-------------------------------

openssl s_client -connect docs.docker.com:443 -&gt; ERROR

140612823746464:error:14077410:SSL routines:SSL23_GET_SERVER_HELLO:sslv3
alert handshake failure:s23_clnt.c:744:

-------------------------------

openssl s_client -connect docs.docker.com:443 -servername docs.docker.com -&gt;
Works

--------------------------------

Squid seems to make https request without the SNI. How can we configure
Squid to use SNI? Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160710/f286f6bb/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160710/f286f6bb/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011466.html">[squid-users] how to connect machine linux to squid proxy,	not in browser?
</A></li>
	<LI>Next message (by thread): <A HREF="011495.html">[squid-users] HTTPS bump doesn't work with websites that	require SNI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11494">[ date ]</a>
              <a href="thread.html#11494">[ thread ]</a>
              <a href="subject.html#11494">[ subject ]</a>
              <a href="author.html#11494">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
