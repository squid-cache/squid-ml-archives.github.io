<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] HTTPS bump doesn't work with websites that	require SNI
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20HTTPS%20bump%20doesn%27t%20work%20with%20websites%20that%0A%09require%20SNI&In-Reply-To=%3C010301d1dab5%241be36c40%2453aa44c0%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011494.html">
   <LINK REL="Next"  HREF="011498.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] HTTPS bump doesn't work with websites that	require SNI</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20HTTPS%20bump%20doesn%27t%20work%20with%20websites%20that%0A%09require%20SNI&In-Reply-To=%3C010301d1dab5%241be36c40%2453aa44c0%24%40ngtech.co.il%3E"
       TITLE="[squid-users] HTTPS bump doesn't work with websites that	require SNI">eliezer at ngtech.co.il
       </A><BR>
    <I>Sun Jul 10 14:12:36 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011494.html">[squid-users] HTTPS bump doesn't work with websites that require SNI
</A></li>
        <LI>Next message (by thread): <A HREF="011498.html">[squid-users] HTTPS bump doesn't work with websites that	require SNI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11495">[ date ]</a>
              <a href="thread.html#11495">[ thread ]</a>
              <a href="subject.html#11495">[ subject ]</a>
              <a href="author.html#11495">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey,

 

What version of squid is provided on pfsense and what version are you using?

 

Eliezer

 

----

 &lt;<A HREF="http://ngtech.co.il/lmgtfy/">http://ngtech.co.il/lmgtfy/</A>&gt; Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>



 

From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Yi?itcan U?UM
Sent: Sunday, July 10, 2016 3:49 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [squid-users] HTTPS bump doesn't work with websites that require SNI

 

Hello there. We're using pfsense and squid-proxy to bump https connections between some of our machines and www. The setup seems to works fine for most of the https sites, but it doesn't work for the others.

 

One example to this sites is &quot;docs.docker.com &lt;<A HREF="http://docs.docker.com/">http://docs.docker.com/</A>&gt; &quot;. Even though we can connect to &quot;docker.com &lt;<A HREF="http://docker.com/">http://docker.com/</A>&gt; &quot;, we can't connect to &quot;docs.docker.com &lt;<A HREF="http://docs.docker.com/">http://docs.docker.com/</A>&gt; &quot;.

 

The error we get is:

(92) Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)

Handshake with SSL server failed: error:14077410:SSL routines:SSL23_GET_SERVER_HELLO:sslv3 alert handshake failure

Upon further investigation we found out that this happens because some sites require SNI to supply correct SSL certificate.

You can test this out with:

-------------------------------

openssl s_client -connect docs.docker.com:443 &lt;<A HREF="http://docs.docker.com:443/">http://docs.docker.com:443/</A>&gt;  -&gt; ERROR

140612823746464:error:14077410:SSL routines:SSL23_GET_SERVER_HELLO:sslv3 alert handshake failure:s23_clnt.c:744:

-------------------------------

openssl s_client -connect docs.docker.com:443 &lt;<A HREF="http://docs.docker.com:443/">http://docs.docker.com:443/</A>&gt;  -servername docs.docker.com &lt;<A HREF="http://docs.docker.com/">http://docs.docker.com/</A>&gt;  -&gt; Works

--------------------------------

Squid seems to make https request without the SNI. How can we configure Squid to use SNI? Thanks.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160710/235f2362/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160710/235f2362/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 11298 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160710/235f2362/attachment.png">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160710/235f2362/attachment.png</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011494.html">[squid-users] HTTPS bump doesn't work with websites that require SNI
</A></li>
	<LI>Next message (by thread): <A HREF="011498.html">[squid-users] HTTPS bump doesn't work with websites that	require SNI
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11495">[ date ]</a>
              <a href="thread.html#11495">[ thread ]</a>
              <a href="subject.html#11495">[ subject ]</a>
              <a href="author.html#11495">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
