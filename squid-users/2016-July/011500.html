<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] HTTPS bump doesn't work with websites that require SNI
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20HTTPS%20bump%20doesn%27t%20work%20with%20websites%20that%0A%20require%20SNI&In-Reply-To=%3C5783B099.4000203%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011498.html">
   <LINK REL="Next"  HREF="011496.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] HTTPS bump doesn't work with websites that require SNI</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20HTTPS%20bump%20doesn%27t%20work%20with%20websites%20that%0A%20require%20SNI&In-Reply-To=%3C5783B099.4000203%40measurement-factory.com%3E"
       TITLE="[squid-users] HTTPS bump doesn't work with websites that require SNI">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Jul 11 14:43:37 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011498.html">[squid-users] HTTPS bump doesn't work with websites that	require SNI
</A></li>
        <LI>Next message (by thread): <A HREF="011496.html">[squid-users] Squid 3.5.19 how to find banking server name for	no bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11500">[ date ]</a>
              <a href="thread.html#11500">[ thread ]</a>
              <a href="subject.html#11500">[ subject ]</a>
              <a href="author.html#11500">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07/11/2016 01:16 AM, Yi&#287;itcan U&#199;UM wrote:

&gt;<i> Squid Cache: Version 3.4.10
</I>
&gt;<i> ssl_bump none localhost
</I>&gt;<i> ssl_bump server-first all
</I>&gt;<i> 
</I>&gt;<i> sslproxy_cert_error allow all
</I>&gt;<i> sslproxy_flags DONT_VERIFY_PEER
</I>

Your Squid version does not support SslBump well. Please upgrade to the
latest Squid v3.5 or, if you prefer beta software with arguably better
SslBump support, v4.0.

Your squid.conf prohibits SNI forwarding. Together with the Squid
upgrade, please review modern SslBump configurations that use such
actions as &quot;splice&quot; and &quot;bump&quot;:
<A HREF="http://wiki.squid-cache.org/Features/SslPeekAndSplice">http://wiki.squid-cache.org/Features/SslPeekAndSplice</A>

Finally, ignoring certificate validation errors is rarely a good idea.
You may want to review that part of your configuration as well.


HTH,

Alex.


&gt;<i> On Sun, Jul 10, 2016 at 5:12 PM, Eliezer Croitoru wrote:
</I>&gt;<i> 
</I>&gt;<i>     Hey,____
</I>&gt;<i> 
</I>&gt;<i>     __ __
</I>&gt;<i> 
</I>&gt;<i>     What version of squid is provided on pfsense and what version are
</I>&gt;<i>     you using?____
</I>&gt;<i> 
</I>&gt;<i>     __ __
</I>&gt;<i> 
</I>&gt;<i>     Eliezer____
</I>&gt;<i> 
</I>&gt;<i>     __ __
</I>&gt;<i> 
</I>&gt;<i>     ----____
</I>&gt;<i> 
</I>&gt;<i>     Eliezer Croitoru &lt;<A HREF="http://ngtech.co.il/lmgtfy/">http://ngtech.co.il/lmgtfy/</A>&gt;
</I>&gt;<i>     Linux System Administrator
</I>&gt;<i>     Mobile: +972-5-28704261
</I>&gt;<i>     Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;____
</I>&gt;<i> 
</I>&gt;<i>     ____
</I>&gt;<i> 
</I>&gt;<i>     __ __
</I>&gt;<i> 
</I>&gt;<i>     *From:*squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt;] *On Behalf Of
</I>&gt;<i>     *Yi?itcan U?UM
</I>&gt;<i>     *Sent:* Sunday, July 10, 2016 3:49 PM
</I>&gt;<i>     *To:* <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i>     &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i>     *Subject:* [squid-users] HTTPS bump doesn't work with websites that
</I>&gt;<i>     require SNI____
</I>&gt;<i> 
</I>&gt;<i>     __ __
</I>&gt;<i> 
</I>&gt;<i>     Hello there. We're using pfsense and squid-proxy to bump https
</I>&gt;<i>     connections between some of our machines and www. The setup seems to
</I>&gt;<i>     works fine for most of the https sites, but it doesn't work for the
</I>&gt;<i>     others.____
</I>&gt;<i> 
</I>&gt;<i>     __ __
</I>&gt;<i> 
</I>&gt;<i>     One example to this sites is &quot;docs.docker.com
</I>&gt;<i>     &lt;<A HREF="http://docs.docker.com/">http://docs.docker.com/</A>&gt;&quot;. Even though we can connect to
</I>&gt;<i>     &quot;docker.com &lt;<A HREF="http://docker.com/">http://docker.com/</A>&gt;&quot;, we can't connect to
</I>&gt;<i>     &quot;docs.docker.com &lt;<A HREF="http://docs.docker.com/">http://docs.docker.com/</A>&gt;&quot;.____
</I>&gt;<i> 
</I>&gt;<i>     __ __
</I>&gt;<i> 
</I>&gt;<i>     The error we get is:____
</I>&gt;<i> 
</I>&gt;<i>     (92) Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)____
</I>&gt;<i> 
</I>&gt;<i>     Handshake with SSL server failed: error:14077410:SSL
</I>&gt;<i>     routines:SSL23_GET_SERVER_HELLO:sslv3 alert handshake failure____
</I>&gt;<i> 
</I>&gt;<i>     Upon further investigation we found out that this happens because
</I>&gt;<i>     some sites require SNI to supply correct SSL certificate.____
</I>&gt;<i> 
</I>&gt;<i>     You can test this out with:____
</I>&gt;<i> 
</I>&gt;<i>     -------------------------------____
</I>&gt;<i> 
</I>&gt;<i>     openssl s_client -connect docs.docker.com:443
</I>&gt;<i>     &lt;<A HREF="http://docs.docker.com:443/">http://docs.docker.com:443/</A>&gt; -&gt; ERROR____
</I>&gt;<i> 
</I>&gt;<i>     140612823746464:error:14077410:SSL
</I>&gt;<i>     routines:SSL23_GET_SERVER_HELLO:sslv3 alert handshake
</I>&gt;<i>     failure:s23_clnt.c:744:____
</I>&gt;<i> 
</I>&gt;<i>     -------------------------------____
</I>&gt;<i> 
</I>&gt;<i>     openssl s_client -connect docs.docker.com:443
</I>&gt;<i>     &lt;<A HREF="http://docs.docker.com:443/">http://docs.docker.com:443/</A>&gt; -servername docs.docker.com
</I>&gt;<i>     &lt;<A HREF="http://docs.docker.com/">http://docs.docker.com/</A>&gt; -&gt; Works____
</I>&gt;<i> 
</I>&gt;<i>     --------------------------------____
</I>&gt;<i> 
</I>&gt;<i>     Squid seems to make https request without the SNI. How can we
</I>&gt;<i>     configure Squid to use SNI? Thanks.____
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011498.html">[squid-users] HTTPS bump doesn't work with websites that	require SNI
</A></li>
	<LI>Next message (by thread): <A HREF="011496.html">[squid-users] Squid 3.5.19 how to find banking server name for	no bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11500">[ date ]</a>
              <a href="thread.html#11500">[ thread ]</a>
              <a href="subject.html#11500">[ subject ]</a>
              <a href="author.html#11500">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
