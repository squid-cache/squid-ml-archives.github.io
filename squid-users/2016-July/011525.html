<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] time based range_offset_limit
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20time%20based%20range_offset_limit&In-Reply-To=%3C031e01d1dd78%24c316cb40%24494461c0%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011524.html">
   <LINK REL="Next"  HREF="011514.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] time based range_offset_limit</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20time%20based%20range_offset_limit&In-Reply-To=%3C031e01d1dd78%24c316cb40%24494461c0%24%40ngtech.co.il%3E"
       TITLE="[squid-users] time based range_offset_limit">eliezer at ngtech.co.il
       </A><BR>
    <I>Thu Jul 14 02:38:10 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011524.html">[squid-users] time based range_offset_limit
</A></li>
        <LI>Next message (by thread): <A HREF="011514.html">[squid-users] time based range_offset_limit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11525">[ date ]</a>
              <a href="thread.html#11525">[ thread ]</a>
              <a href="subject.html#11525">[ subject ]</a>
              <a href="author.html#11525">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Just to add the Microsoft BITS client uses a If-Unmodified-Since header and not a no-cache.
The above is as far as I can tell from dumps I have for windows 7 and up.
There are cases which a client would want to abort the connection but I have not seen these from windows for a long time.

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>


-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Heiler Bemerguy
Sent: Wednesday, July 13, 2016 6:35 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] time based range_offset_limit


1468423415.143 160645 10.1.4.7 TCP_MISS_ABORTED/206 510 GET 
<A HREF="http://au.v4.download.windowsupdate.com/d/msdownload/update/software/secu/2016/06/word-x-none_48e3c2f2bb14dd57321ae5a53cf8de2ca0fe6114.cab">http://au.v4.download.windowsupdate.com/d/msdownload/update/software/secu/2016/06/word-x-none_48e3c2f2bb14dd57321ae5a53cf8de2ca0fe6114.cab</A> 
- HIER_DIRECT/201.48.38.146 application/octet-stream
1468423415.146 160651 10.1.4.7 TCP_MISS_ABORTED/206 510 GET 
<A HREF="http://au.v4.download.windowsupdate.com/d/msdownload/update/software/secu/2016/06/word-x-none_48e3c2f2bb14dd57321ae5a53cf8de2ca0fe6114.cab">http://au.v4.download.windowsupdate.com/d/msdownload/update/software/secu/2016/06/word-x-none_48e3c2f2bb14dd57321ae5a53cf8de2ca0fe6114.cab</A> 
- HIER_DIRECT/201.48.38.146 application/octet-stream
1468423415.146 160509 10.1.4.7 TCP_MISS_ABORTED/206 510 GET 
<A HREF="http://au.v4.download.windowsupdate.com/d/msdownload/update/software/secu/2016/06/word-x-none_48e3c2f2bb14dd57321ae5a53cf8de2ca0fe6114.cab">http://au.v4.download.windowsupdate.com/d/msdownload/update/software/secu/2016/06/word-x-none_48e3c2f2bb14dd57321ae5a53cf8de2ca0fe6114.cab</A> 
- HIER_DIRECT/201.48.38.146 application/octet-stream
1468423415.147 160579 10.1.4.7 TCP_MISS_ABORTED/206 510 GET 
<A HREF="http://au.v4.download.windowsupdate.com/d/msdownload/update/software/secu/2016/06/word-x-none_48e3c2f2bb14dd57321ae5a53cf8de2ca0fe6114.cab">http://au.v4.download.windowsupdate.com/d/msdownload/update/software/secu/2016/06/word-x-none_48e3c2f2bb14dd57321ae5a53cf8de2ca0fe6114.cab</A> 
- HIER_DIRECT/201.48.38.146 application/octet-stream
1468423415.643 251033 10.1.4.7 TCP_MISS/206 103141 GET 
<A HREF="http://au.v4.download.windowsupdate.com/d/msdownload/update/software/secu/2016/06/excel-x-none_2acf846b28d580d20f1d5973c9697cb54dc1ad21.cab">http://au.v4.download.windowsupdate.com/d/msdownload/update/software/secu/2016/06/excel-x-none_2acf846b28d580d20f1d5973c9697cb54dc1ad21.cab</A> 
- HIER_DIRECT/201.48.38.146 application/octet-stream


For some reason, it seems the client is aborting the range connection.. 
and squid keeps downloading it all simultaneously because it triggers 
range_offset_limit. But why would BITS (background intelligent transfer 
services - microsoft) cancel these downloads?

It really seems to use some no-cache headers:

Cache-Control: no-cache
Pragma: no-cache


How to ignore it?


-- 
Best Regards,

Heiler Bemerguy
Network Manager - CINBESA
55 91 98151-4894/3184-1751


Em 13/07/2016 10:26, Amos Jeffries escreveu:
&gt;<i> On 14/07/2016 12:43 a.m., Heiler Bemerguy wrote:
</I>&gt;&gt;<i> Em 12/07/2016 23:43, Alex Rousskov escreveu:
</I>&gt;&gt;&gt;&gt;<i> (without using Range: header).
</I>&gt;&gt;&gt;<i> That's your squid.conf customization, I presume.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i> The squid won't send a Range: header to the server because the request
</I>&gt;&gt;<i> is matching the range_offset_limit -1 ACL. I presume. So squid will try
</I>&gt;&gt;<i> to fetch the file from the beginning, faking a full request, right?
</I>&gt;<i> No faking. Is making.
</I>&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> That's why I don't understand why it does not work on a REAL
</I>&gt;&gt;&gt;&gt;<i> enviroment.
</I>&gt;&gt;&gt;<i> Many things can go wrong -- the real requests may require collapsed
</I>&gt;&gt;&gt;<i> forwarding that you do not test, the real requests may have no-cache,
</I>&gt;&gt;&gt;<i> the real response may not be cachable, or there is some Range handling
</I>&gt;&gt;&gt;<i> bug that your test scripts do not tickle (e.g., they request ranges that
</I>&gt;&gt;&gt;<i> are always close to each other and are always available at the same
</I>&gt;&gt;&gt;<i> time).
</I>&gt;&gt;<i> Well, if I turn off collapsed_forwarding and try to GET the same file on
</I>&gt;&gt;<i> the same server in a row (only changing the Range), it will create *two
</I>&gt;&gt;<i> *connections to the server instead of only *one*.
</I>&gt;&gt;<i> I use &quot;override-expire ignore-private ignore-no-store ignore-reload
</I>&gt;&gt;<i> ignore-must-revalidate store-stale&quot; for this particular request, won't
</I>&gt;&gt;<i> it override the no-cache or whatever?
</I>&gt;<i> No. Those refresh_pattern options are overriding the response
</I>&gt;<i> requirements mandated by the server.
</I>&gt;<i>
</I>&gt;<i> The &quot;no-cache&quot; Alex speaks of is a client requirement that no cached
</I>&gt;<i> data be sent. Which also means that client request cannot be collapsed
</I>&gt;<i> with others, since collapsing is essentially just using 'cached' data
</I>&gt;<i> before it gets stored to the cache.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011524.html">[squid-users] time based range_offset_limit
</A></li>
	<LI>Next message (by thread): <A HREF="011514.html">[squid-users] time based range_offset_limit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11525">[ date ]</a>
              <a href="thread.html#11525">[ thread ]</a>
              <a href="subject.html#11525">[ subject ]</a>
              <a href="author.html#11525">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
