<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Failure URL
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Failure%20URL&In-Reply-To=%3C143ad170-73e3-a1eb-7a43-fe9bce982d3c%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011550.html">
   <LINK REL="Next"  HREF="011557.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Failure URL</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Failure%20URL&In-Reply-To=%3C143ad170-73e3-a1eb-7a43-fe9bce982d3c%40treenet.co.nz%3E"
       TITLE="[squid-users] Failure URL">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Jul 15 09:06:53 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011550.html">[squid-users] Failure URL
</A></li>
        <LI>Next message (by thread): <A HREF="011557.html">[squid-users] Skype+intercept+ssl_bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11552">[ date ]</a>
              <a href="thread.html#11552">[ thread ]</a>
              <a href="subject.html#11552">[ subject ]</a>
              <a href="author.html#11552">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 15/07/2016 5:19 p.m., Filip Maroul wrote:
&gt;<i> Hello,
</I>&gt;<i> I am running squid3 in version 3.4 on Debian 8 x64. I am using block list
</I>&gt;<i> for some domain's it works but if I try to put failure url it not work.
</I>
Please explain &quot;it not work&quot;.


&gt;<i> Here is my conf file:
</I>&gt;<i> -----------------------------------------------------------------------------------
</I>&gt;<i> http_port 3128
</I>&gt;<i> 
</I>&gt;<i> refresh_pattern ^ftp:           1440    20%     10080
</I>&gt;<i> refresh_pattern ^gopher:        1440    0%      1440
</I>&gt;<i> refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
</I>&gt;<i> refresh_pattern .               0       20%     4320
</I>&gt;<i> refresh_pattern -i \.(gif|png|jpg|jpeg|ico)$ 3600       90%     43200
</I>&gt;<i> 
</I>
Problem #1: your custom refresh_pattern is never used.

 ** Order is important. **

You should add custom refresh_pattern lines to the top of the list.

Squid stops processing refresh_pattern lines when it finds a match for
the current transactions URL. The &quot;.&quot; pattern is listed last in the
defaults because it matches *everything* that reaches it.


&gt;<i> #acl localnet src 10.0.0.0/8     # RFC 1918 possible internal network
</I>&gt;<i> acl dmz_net src 172.100.200.0/27 # RFC 1918 possible internal network
</I>&gt;<i> #acl localnet src 192.168.0.0/16 # RFC 1918 possible internal network
</I>&gt;<i> #acl localnet src fc00::/7       # RFC 4193 local private network range
</I>&gt;<i> #acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged)
</I>&gt;<i> machines
</I>&gt;<i> 
</I>&gt;<i> acl SSL_ports port 443 # https
</I>&gt;<i> 
</I>&gt;<i> acl Safe_ports port 80 # http
</I>&gt;<i> acl Safe_ports port 21 # ftp
</I>&gt;<i> acl Safe_ports port 443 # https
</I>&gt;<i> acl Safe_ports port 70 # gopher
</I>&gt;<i> acl Safe_ports port 210 # wais
</I>&gt;<i> acl Safe_ports port 1025-65535 # unregistered ports
</I>&gt;<i> acl Safe_ports port 280 # http-mgmt
</I>&gt;<i> acl Safe_ports port 488 # gss-http
</I>&gt;<i> acl Safe_ports port 591 # filemaker
</I>&gt;<i> acl Safe_ports port 777 # multiling http
</I>&gt;<i> 
</I>&gt;<i> acl CONNECT method CONNECT
</I>&gt;<i> acl Social_block dstdom_regex .app.facebook.com .facebook.com
</I>
Problem #2: using regex to match a dstdomain value.

I guess you are using this either out of a misplaced enthusiasm or
beliefe in regex. Or to avoid the warning Squid displays about
&quot;.app.facebook.com&quot; when the two are combined.

Squdi is warning about .app.facebook.com being redundant. Any URL
matching .app.facebook.com is by definition also matched by
.facebook.com. To avoid some very real matching problems you should not
list it.

You should use:
  acl Social_block dstdomain .facebook.com .fbcdn.net

Note that &quot;facebook.com&quot; and subdomains are not commonly used by
Facebook. Their actual data objects domain is *.fbcdn.net


&gt;<i> acl Bulvar dstdom_regex .super.cz
</I>&gt;<i> 
</I>
acl Bulvat dstdomain .super.cz


&gt;<i> http_access deny !Safe_ports
</I>&gt;<i> http_access deny CONNECT !SSL_ports
</I>&gt;<i> http_access deny Social_block
</I>&gt;<i> http_access deny Bulvar
</I>&gt;<i> http_access allow localhost manager
</I>&gt;<i> http_access deny manager
</I>&gt;<i> http_access allow dmz_net
</I>&gt;<i> http_access allow localhost
</I>&gt;<i> http_access deny all
</I>&gt;<i> 
</I>&gt;<i> #Disk cache directory
</I>&gt;<i> cache_dir ufs /var/spool/squid3 1024 16 256
</I>&gt;<i> 
</I>&gt;<i> #Max memory cache usage
</I>&gt;<i> cache_mem 1024 MB
</I>&gt;<i> 
</I>&gt;<i> deny_info <A HREF="http://www.seznam.cz">http://www.seznam.cz</A> Bulvar
</I>
This redirects when the Bulvar ACL matches. That is all. Only the
*.super.cz domains listed in Bulvar will be redirected.


Amos



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011550.html">[squid-users] Failure URL
</A></li>
	<LI>Next message (by thread): <A HREF="011557.html">[squid-users] Skype+intercept+ssl_bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11552">[ date ]</a>
              <a href="thread.html#11552">[ thread ]</a>
              <a href="subject.html#11552">[ subject ]</a>
              <a href="author.html#11552">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
