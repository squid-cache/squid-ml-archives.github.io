<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] acl maxconn and max_user_ip config help please
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20acl%20maxconn%20and%20max_user_ip%20config%20help%20please&In-Reply-To=%3C3d5568e3-1544-04ff-7705-28cdd109604a%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011580.html">
   <LINK REL="Next"  HREF="011585.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] acl maxconn and max_user_ip config help please</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20acl%20maxconn%20and%20max_user_ip%20config%20help%20please&In-Reply-To=%3C3d5568e3-1544-04ff-7705-28cdd109604a%40treenet.co.nz%3E"
       TITLE="[squid-users] acl maxconn and max_user_ip config help please">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Jul 18 05:14:57 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011580.html">[squid-users] acl maxconn and max_user_ip config help please
</A></li>
        <LI>Next message (by thread): <A HREF="011585.html">[squid-users] acl maxconn and max_user_ip config help please
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11583">[ date ]</a>
              <a href="thread.html#11583">[ thread ]</a>
              <a href="subject.html#11583">[ subject ]</a>
              <a href="author.html#11583">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 18/07/2016 11:49 a.m., B. Henry wrote:
&gt;<i> I want to limit max simultanious connections for any user in group foo, and also limit how may different IPs they can have devices logged in from at any 
</I>&gt;<i> one time.
</I>&gt;<i> 
</I>&gt;<i> I've had squid3 working well with a very simple policy for years just allowing access from two different ip ranges, but now want to make my proxy server 
</I>&gt;<i> available to others. 
</I>&gt;<i> I have things working well with one group called foo listing some names, after using something very similar to the recommended minimum defaults. 
</I>&gt;<i> 
</I>&gt;<i> acl foo proxy_auth user1 dumbuser someoneelse
</I>&gt;<i> 
</I>&gt;<i> But when I add the lines below to try and set a limit for group fooI can not connect at all, get a connection denied error.
</I>&gt;<i> acl foo maxconn 15
</I>&gt;<i> acl foo max_user_ip -s 5
</I>
The name &quot;foo&quot; is being assigned to two distincly different types of ACL
action. Squid will not start with this mis-configuration.

You should have seen Squid reporting FATAL errors about that in your logs.

Pleasse read the FAQ entries:
&lt;<A HREF="http://wiki.squid-cache.org/SquidFaq/SquidAcl#Common_Mistakes">http://wiki.squid-cache.org/SquidFaq/SquidAcl#Common_Mistakes</A>&gt;


&gt;<i> And these were the last httpaccess lines
</I>&gt;<i> http_access deny !foo
</I>&gt;<i> #http_access allow localnet
</I>&gt;<i> 
</I>&gt;<i> I am very new to anything other than some very basic configuration,
</I>&gt;<i> so may be misunderstanding almost anything, so all help will be well
</I>&gt;<i> received even if it just confirms something I thought.
</I>
If you are familiar with boolean logic it should not be hard to
understand. The FAQ reference above goes into examples.


&gt;<i> 
</I>&gt;<i> Also if I want to make a more restrictive policy, i.e. fewer
</I>&gt;<i> connections for folks not in group fooam I correct in thinking it
</I>&gt;<i> would go before, the foo rule? I guess I'd either make another
</I>&gt;<i> groupand give them access and change foo's access to allow insteal of
</I>&gt;<i> deny, or is there a better way? Sometimes I think I understand the
</I>&gt;<i> basic rules about order and such pretty weell, but feel confused at
</I>&gt;<i> the moment...lol
</I>
To answer that fully you need to have an understanding of how ACLs and
access lists building blocks work. So lets come back to these after you
understand whats wrong with your initial 'foo' attempt

&gt;<i> 
</I>&gt;<i> Actually my current working configuration has the allow localnet line
</I>&gt;<i> above the foo acl line and these as the last acl and httpaccess
</I>&gt;<i> lines http_access deny !foo At this point should I have an allow all
</I>
No. &quot;allow all&quot; permits the entire Internet community through your
proxy, to do anything they like. Which is very, very rarely a desirable
proxy behaviour (even rare for reverse-proxy / CDN configurations).


&gt;<i> line since the httpaccess line for foo is deny, or should the last
</I>&gt;<i> line always be deny all?
</I>
Best Practice is to always use &quot;deny all&quot; for the last http_access line,
to make sure it is clear and obvious what will happen to any given
request. ie. if your custom rules above that line dont hande the request
it gets denied.

Omitting the final &quot;deny all&quot; is possible, but only safe if you have
advanced understanding Squid behaviour and actually want what will happen.


&gt;<i> 
</I>&gt;<i> Thanks in advance for any and all help. BTW, I am stuck using 3.1.19
</I>&gt;<i> I think it is as my server is running ubuntu 12.04 for a bit still,
</I>&gt;<i> i.e. I know some options have changed a bit since squid3.1.
</I>&gt;<i> 
</I>
Specific options have changed, and some useful ACL types been added. But
the logic of how to construct ACLs and access lists has not.

The default config file is included at:
 &lt;<A HREF="http://wiki.squid-cache.org/Squid-3.1">http://wiki.squid-cache.org/Squid-3.1</A>&gt;
(you can copy-n-paste the entire thing as your squid.conf and it works
as-is).

There is a guide to the full set of directives and how they work
specifically in 3.1 available at:
&lt;<A HREF="http://www.squid-cache.org/Versions/v3/3.1/cfgman/">http://www.squid-cache.org/Versions/v3/3.1/cfgman/</A>&gt;

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011580.html">[squid-users] acl maxconn and max_user_ip config help please
</A></li>
	<LI>Next message (by thread): <A HREF="011585.html">[squid-users] acl maxconn and max_user_ip config help please
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11583">[ date ]</a>
              <a href="thread.html#11583">[ thread ]</a>
              <a href="subject.html#11583">[ subject ]</a>
              <a href="author.html#11583">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
