<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] acl maxconn and max_user_ip config help please
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20acl%20maxconn%20and%20max_user_ip%20config%20help%20please&In-Reply-To=%3C20160718062346.GA29776%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011583.html">
   <LINK REL="Next"  HREF="011587.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] acl maxconn and max_user_ip config help please</H1>
    <B>B. Henry</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20acl%20maxconn%20and%20max_user_ip%20config%20help%20please&In-Reply-To=%3C20160718062346.GA29776%40gmail.com%3E"
       TITLE="[squid-users] acl maxconn and max_user_ip config help please">burt1iband at gmail.com
       </A><BR>
    <I>Mon Jul 18 06:23:46 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011583.html">[squid-users] acl maxconn and max_user_ip config help please
</A></li>
        <LI>Next message (by thread): <A HREF="011587.html">[squid-users] acl maxconn and max_user_ip config help please
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11585">[ date ]</a>
              <a href="thread.html#11585">[ thread ]</a>
              <a href="subject.html#11585">[ subject ]</a>
              <a href="author.html#11585">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>First, thanks for answering.
Second, I have read the entire default conf file, yes, once made the mistake of reading one for a different squid version than mine, but then got a fresh 
copy of the one for my exact version.
I've also read the FAQ, and most all the configuration guide, but if I had not I certainly would be greatful for the links.
My misunderstanding then is now in how to apply a rule that will only effect group foo with out reusing the name.
Would I first name the group as I have and then make a maxconn line, e.g.
acl foo_MC maxconn 15
and then
 http_access allow foo
http_access foo_MC

and if this is correct, is it just the ordering there that means that this maxconn will only apply to group foo?
If not, how do I make the rule only apply to group foo?
And I read the posts that came up in the archive before askig as well. 
&gt;<i> &gt; line since the httpaccess line for foo is deny, or should the last
</I>&gt;<i> &gt; line always be deny all?
</I>&gt;<i> 
</I>&gt;<i> Best Practice is to always use &quot;deny all&quot; for the last http_access line,
</I>&gt;<i> to make sure it is clear and obvious what will happen to any given
</I>&gt;<i> request. ie. if your custom rules above that line dont hande the request
</I>snip
Good, that's what made sense to me, but one statement in the documentation, don't remember exactly where, had me doubting myself.
Regards,    
  
-- 
     B.H.
   Registerd Linux User 521886


  Amos Jeffries wrote:
Mon, Jul 18, 2016 at 05:14:57PM +1200

&gt;<i> On 18/07/2016 11:49 a.m., B. Henry wrote:
</I>&gt;<i> &gt; I want to limit max simultanious connections for any user in group foo, and also limit how may different IPs they can have devices logged in from at any 
</I>&gt;<i> &gt; one time.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I've had squid3 working well with a very simple policy for years just allowing access from two different ip ranges, but now want to make my proxy server 
</I>&gt;<i> &gt; available to others. 
</I>&gt;<i> &gt; I have things working well with one group called foo listing some names, after using something very similar to the recommended minimum defaults. 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; acl foo proxy_auth user1 dumbuser someoneelse
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; But when I add the lines below to try and set a limit for group fooI can not connect at all, get a connection denied error.
</I>&gt;<i> &gt; acl foo maxconn 15
</I>&gt;<i> &gt; acl foo max_user_ip -s 5
</I>&gt;<i> 
</I>&gt;<i> The name &quot;foo&quot; is being assigned to two distincly different types of ACL
</I>&gt;<i> action. Squid will not start with this mis-configuration.
</I>&gt;<i> 
</I>&gt;<i> You should have seen Squid reporting FATAL errors about that in your logs.
</I>&gt;<i> 
</I>&gt;<i> Pleasse read the FAQ entries:
</I>&gt;<i> &lt;<A HREF="http://wiki.squid-cache.org/SquidFaq/SquidAcl#Common_Mistakes">http://wiki.squid-cache.org/SquidFaq/SquidAcl#Common_Mistakes</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt; And these were the last httpaccess lines
</I>&gt;<i> &gt; http_access deny !foo
</I>&gt;<i> &gt; #http_access allow localnet
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I am very new to anything other than some very basic configuration,
</I>&gt;<i> &gt; so may be misunderstanding almost anything, so all help will be well
</I>&gt;<i> &gt; received even if it just confirms something I thought.
</I>&gt;<i> 
</I>&gt;<i> If you are familiar with boolean logic it should not be hard to
</I>&gt;<i> understand. The FAQ reference above goes into examples.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Also if I want to make a more restrictive policy, i.e. fewer
</I>&gt;<i> &gt; connections for folks not in group fooam I correct in thinking it
</I>&gt;<i> &gt; would go before, the foo rule? I guess I'd either make another
</I>&gt;<i> &gt; groupand give them access and change foo's access to allow insteal of
</I>&gt;<i> &gt; deny, or is there a better way? Sometimes I think I understand the
</I>&gt;<i> &gt; basic rules about order and such pretty weell, but feel confused at
</I>&gt;<i> &gt; the moment...lol
</I>&gt;<i> 
</I>&gt;<i> To answer that fully you need to have an understanding of how ACLs and
</I>&gt;<i> access lists building blocks work. So lets come back to these after you
</I>&gt;<i> understand whats wrong with your initial 'foo' attempt
</I>&gt;<i> 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Actually my current working configuration has the allow localnet line
</I>&gt;<i> &gt; above the foo acl line and these as the last acl and httpaccess
</I>&gt;<i> &gt; lines http_access deny !foo At this point should I have an allow all
</I>&gt;<i> 
</I>&gt;<i> No. &quot;allow all&quot; permits the entire Internet community through your
</I>&gt;<i> proxy, to do anything they like. Which is very, very rarely a desirable
</I>&gt;<i> proxy behaviour (even rare for reverse-proxy / CDN configurations).
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt; line since the httpaccess line for foo is deny, or should the last
</I>&gt;<i> &gt; line always be deny all?
</I>&gt;<i> 
</I>&gt;<i> Best Practice is to always use &quot;deny all&quot; for the last http_access line,
</I>&gt;<i> to make sure it is clear and obvious what will happen to any given
</I>&gt;<i> request. ie. if your custom rules above that line dont hande the request
</I>&gt;<i> it gets denied.
</I>&gt;<i> 
</I>&gt;<i> Omitting the final &quot;deny all&quot; is possible, but only safe if you have
</I>&gt;<i> advanced understanding Squid behaviour and actually want what will happen.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Thanks in advance for any and all help. BTW, I am stuck using 3.1.19
</I>&gt;<i> &gt; I think it is as my server is running ubuntu 12.04 for a bit still,
</I>&gt;<i> &gt; i.e. I know some options have changed a bit since squid3.1.
</I>&gt;<i> &gt; 
</I>&gt;<i> 
</I>&gt;<i> Specific options have changed, and some useful ACL types been added. But
</I>&gt;<i> the logic of how to construct ACLs and access lists has not.
</I>&gt;<i> 
</I>&gt;<i> The default config file is included at:
</I>&gt;<i>  &lt;<A HREF="http://wiki.squid-cache.org/Squid-3.1">http://wiki.squid-cache.org/Squid-3.1</A>&gt;
</I>&gt;<i> (you can copy-n-paste the entire thing as your squid.conf and it works
</I>&gt;<i> as-is).
</I>&gt;<i> 
</I>&gt;<i> There is a guide to the full set of directives and how they work
</I>&gt;<i> specifically in 3.1 available at:
</I>&gt;<i> &lt;<A HREF="http://www.squid-cache.org/Versions/v3/3.1/cfgman/">http://www.squid-cache.org/Versions/v3/3.1/cfgman/</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> Amos
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011583.html">[squid-users] acl maxconn and max_user_ip config help please
</A></li>
	<LI>Next message (by thread): <A HREF="011587.html">[squid-users] acl maxconn and max_user_ip config help please
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11585">[ date ]</a>
              <a href="thread.html#11585">[ thread ]</a>
              <a href="subject.html#11585">[ subject ]</a>
              <a href="author.html#11585">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
