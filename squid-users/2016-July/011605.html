<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Skype+intercept+ssl_bump
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Skype%2Bintercept%2Bssl_bump&In-Reply-To=%3C000501d1e11d%242c7807a0%24856816e0%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011588.html">
   <LINK REL="Next"  HREF="011609.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Skype+intercept+ssl_bump</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Skype%2Bintercept%2Bssl_bump&In-Reply-To=%3C000501d1e11d%242c7807a0%24856816e0%24%40ngtech.co.il%3E"
       TITLE="[squid-users] Skype+intercept+ssl_bump">eliezer at ngtech.co.il
       </A><BR>
    <I>Mon Jul 18 17:52:38 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011588.html">[squid-users] Skype+intercept+ssl_bump
</A></li>
        <LI>Next message (by thread): <A HREF="011609.html">[squid-users] Skype+intercept+ssl_bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11605">[ date ]</a>
              <a href="thread.html#11605">[ thread ]</a>
              <a href="subject.html#11605">[ subject ]</a>
              <a href="author.html#11605">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>To clear out my idea,

I was thinking about an option to decide if to bump or not based on a SSL handshake test on the destination Service.
I do not know skype traffic that much but I do know that a PTR can be &quot;faked&quot; and have seen it couple times in the past.
I considered what to do and one of the options is to do the bump in two steps and to identify requests that was not supposed to be bumped.
It's a bit complicated since in the nature of the idea there would be at least one failure for the client attempt to reach a destination.
I do not like the idea and I know it's not a nice one but I think that if an admin can identify the goal and determine that he doesn't care about traffic
detained to a specific host for both filtering and  caching then all traffic to these hosts can be tunneled or spliced.

The methods I have in mind are:
- Using firewall\kernel level of bumping exceptions
- Using some no-bump external_acl helper

I have a specific model for doing such a thing with Linux ipset and I only need couple domains to evaluate the concept.

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>


-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Amos Jeffries
Sent: Monday, July 18, 2016 10:27 AM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Skype+intercept+ssl_bump

On 15/07/2016 10:38 p.m., Evgeniy Kononov wrote:
&gt;<i>  Hello!
</I>&gt;<i> 
</I>&gt;<i> Can you help me with correct settings for squid to use skype ?
</I>&gt;<i> 
</I>
FYI: there are currently no known &quot;correct&quot; setting for Skype when SSL-Bump is involved.

There are settings known to work when Squid is setup as an explicit proxy, and some which almost-always (but only 99.999%) working for Squid intercepting port 80.

Intercepting port 443 and bumping the crypto has issues distinguishing Skype-TLS from real TLS and HTTPS.


That said, I have been giving it some thought today and suspect that since MS are apparently filtering Skype traffic through their own machines these days we could maybe use the &quot;dst&quot; ACL reverse-DNS behaviour to detect and splice that traffic.

If you want to experiment with that and have good results there are many here who would like some good news on this.



&gt;<i> With this setup I have problem with group chats, calls and attachments in messages.
</I>&gt;<i> Attachments sended, but not delivered to respondent.
</I>&gt;<i> Unable to create group chats and if it created, what respondents do not see the chat or can not make calls.
</I>&gt;<i> I tried add IP regexp to access list, but after that all https traffic was spliced.
</I>&gt;<i> Skype work well when I change ssl_bump bump all to ssl_bump splice all 
</I>&gt;<i> How can I exclude skype from SSL bumping ?
</I>
The problem is with identifying it in fairly reliable way from all the other traffic. That is where we are currently all stuck.

Yuri and Eliezer have been trying various things and talking about it on-list in recent weeks/months. But so far no results I'm confident about recommending.

Amos

_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160718/c8133747/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160718/c8133747/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011588.html">[squid-users] Skype+intercept+ssl_bump
</A></li>
	<LI>Next message (by thread): <A HREF="011609.html">[squid-users] Skype+intercept+ssl_bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11605">[ date ]</a>
              <a href="thread.html#11605">[ thread ]</a>
              <a href="subject.html#11605">[ subject ]</a>
              <a href="author.html#11605">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
