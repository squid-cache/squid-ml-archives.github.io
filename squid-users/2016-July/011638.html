<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Wrong req_header result in cache_peer_access when using ssl_bump
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Wrong%20req_header%20result%20in%20cache_peer_access%20when%0A%20using%20ssl_bump&In-Reply-To=%3Cf3187d66-b768-56c6-e857-5a41ea9c5aab%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011628.html">
   <LINK REL="Next"  HREF="011643.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Wrong req_header result in cache_peer_access when using ssl_bump</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Wrong%20req_header%20result%20in%20cache_peer_access%20when%0A%20using%20ssl_bump&In-Reply-To=%3Cf3187d66-b768-56c6-e857-5a41ea9c5aab%40treenet.co.nz%3E"
       TITLE="[squid-users] Wrong req_header result in cache_peer_access when using ssl_bump">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Jul 20 12:32:28 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011628.html">[squid-users] Wrong req_header result in cache_peer_access when using ssl_bump
</A></li>
        <LI>Next message (by thread): <A HREF="011643.html">[squid-users] Wrong req_header result in cache_peer_access when using ssl_bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11638">[ date ]</a>
              <a href="thread.html#11638">[ thread ]</a>
              <a href="subject.html#11638">[ subject ]</a>
              <a href="author.html#11638">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 20/07/2016 2:37 a.m., Mihai Ene wrote:
&gt;<i> I did some further testing, and it would appear that even when `cache_peer`
</I>&gt;<i> uses `ssl` option, ERR_CANNOT_FORWARD is returned.
</I>&gt;<i> 
</I>&gt;<i> I believe `cache_peer` ACLs are incompatible with `ssl_bump`ed traffic.
</I>&gt;<i> 
</I>&gt;<i> These restrictions should be documented. I'd be happy to contribute to the
</I>&gt;<i> docs, but the procedure either seems too complicated, or the `man` pages
</I>&gt;<i> aren't the place. Anyway, contributing should be a separate thread.
</I>&gt;<i> 
</I>&gt;<i> Can a maintainer confirm that `cache_peer` does not work with `ssl_bump`ed
</I>&gt;<i> traffic, even when `ssl` option is used?
</I>&gt;<i> 
</I>
I can confirm the following ...

 Squid SHOULD be able to send SSL-bump decrypted traffic to a cache_peer
with 'ssl' flag set.


The requirement Squid is enforcing is that the decrypted traffic is only
ever transmitted over secure (ie TLS) connections. As long as the peer
connection meets that criteria, it should be fine.

Two gotcha's though when using peers:

 1) if your bumping at step 3, it involves the serverHello details.
Squid will mimic the *peer certificate*. Which may not be the origin
server certificate the client expects to see.

 2) if your bumping is at step 1 or 2, it involves only the clientHello
details, no server cert. Then the client will receive the *Squid
certificate*, which is almost certainly not what the client expects to see.


As to your error message. ERR_CANNOT_FORWARD is an indication that your
rules prevent any accessible destination. In other words, the ones
permitted are not responding.

Amos
[ maintainer hat usually on when responding here :-P ]


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011628.html">[squid-users] Wrong req_header result in cache_peer_access when using ssl_bump
</A></li>
	<LI>Next message (by thread): <A HREF="011643.html">[squid-users] Wrong req_header result in cache_peer_access when using ssl_bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11638">[ date ]</a>
              <a href="thread.html#11638">[ thread ]</a>
              <a href="subject.html#11638">[ subject ]</a>
              <a href="author.html#11638">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
