<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid Intercept - From inside LAN with DNAT on	router and docker on host
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20Intercept%20-%20From%20inside%20LAN%20with%20DNAT%20on%0A%09router%20and%20docker%20on%20host&In-Reply-To=%3C201607202210.21824.Antony.Stone%40squid.open.source.it%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011648.html">
   <LINK REL="Next"  HREF="011649.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid Intercept - From inside LAN with DNAT on	router and docker on host</H1>
    <B>Antony Stone</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20Intercept%20-%20From%20inside%20LAN%20with%20DNAT%20on%0A%09router%20and%20docker%20on%20host&In-Reply-To=%3C201607202210.21824.Antony.Stone%40squid.open.source.it%3E"
       TITLE="[squid-users] Squid Intercept - From inside LAN with DNAT on	router and docker on host">Antony.Stone at squid.open.source.it
       </A><BR>
    <I>Wed Jul 20 20:10:21 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011648.html">[squid-users] Squid Intercept - From inside LAN with DNAT on router and docker on host
</A></li>
        <LI>Next message (by thread): <A HREF="011649.html">[squid-users] Squid Intercept - From inside LAN with DNAT on router and docker on host
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11647">[ date ]</a>
              <a href="thread.html#11647">[ thread ]</a>
              <a href="subject.html#11647">[ subject ]</a>
              <a href="author.html#11647">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wednesday 20 July 2016 at 21:42:27, Guilherme Scaglia wrote:

&gt;<i> I'm aiming for a transparent proxy - with squid in intercept mode.
</I>&gt;<i> 
</I>&gt;<i> In my network setup, the squid server is inside the LAN together with its
</I>&gt;<i> clients, and not siting between the clients and the router/modem
</I>
That will be a problem for intercept mode.

&gt;<i> My router is a Mikrotik router board, so it's trivial to setup a DNAT rule
</I>&gt;<i> to redirect all TCP requests to the squid server.
</I>
That won't work.  You *must* perform the DNAT on the machine running Squid, 
which means that the packets from your clients must pass through the Squid 
server, either because it is in the default route, or because you use some 
form of policy routing (not NAT) to direct port 80 requests through it.

&gt;<i> What's happening? why doesn't squid tries to fetch the request pages at
</I>&gt;<i> all?
</I>
Because you are not doing NAT on the Squid machine.

&gt;<i> From my understanding, my setup is roughly equivalent to
</I>&gt;<i> <A HREF="http://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxDnat,">http://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxDnat,</A> only the
</I>&gt;<i> DNAT is happening outside the squid box; There is no reason this should
</I>&gt;<i> interfere with anything.
</I>
Oh yes there is :)

&gt;<i> <A HREF="http://wiki.squid-cache.org/ConfigExamples/Intercept/IptablesPolicyRoute">http://wiki.squid-cache.org/ConfigExamples/Intercept/IptablesPolicyRoute</A>
</I>&gt;<i> seens to recommend routing without DNAT; This seems weird, as the only way
</I>&gt;<i> I can see this working is if the squid machine accepted packets to any
</I>&gt;<i> address as their own.
</I>
No, you are not sending the packets *to* the Squid machine, you are routing 
them *via* the Squid machine.

After all, you are currently sending packet to addresses all over the Internet 
via your Microtik board, and it's quite happy with those :)


Regards,


Antony.

-- 
I think broken pencils are pointless.

                                                   Please reply to the list;
                                                         please *don't* CC me.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011648.html">[squid-users] Squid Intercept - From inside LAN with DNAT on router and docker on host
</A></li>
	<LI>Next message (by thread): <A HREF="011649.html">[squid-users] Squid Intercept - From inside LAN with DNAT on router and docker on host
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11647">[ date ]</a>
              <a href="thread.html#11647">[ thread ]</a>
              <a href="subject.html#11647">[ subject ]</a>
              <a href="author.html#11647">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
