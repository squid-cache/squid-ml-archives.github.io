<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid Intercept - From inside LAN with DNAT on router and docker on host
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20Intercept%20-%20From%20inside%20LAN%20with%20DNAT%20on%0A%20router%20and%20docker%20on%20host&In-Reply-To=%3Cf760fa87-6e3f-2b7c-a512-6a9aa9ca08dc%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011680.html">
   <LINK REL="Next"  HREF="011651.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid Intercept - From inside LAN with DNAT on router and docker on host</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20Intercept%20-%20From%20inside%20LAN%20with%20DNAT%20on%0A%20router%20and%20docker%20on%20host&In-Reply-To=%3Cf760fa87-6e3f-2b7c-a512-6a9aa9ca08dc%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid Intercept - From inside LAN with DNAT on router and docker on host">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Jul 21 13:48:29 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011680.html">[squid-users] Squid Intercept - From inside LAN with DNAT on router and docker on host
</A></li>
        <LI>Next message (by thread): <A HREF="011651.html">[squid-users] Problem site
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11683">[ date ]</a>
              <a href="thread.html#11683">[ thread ]</a>
              <a href="subject.html#11683">[ subject ]</a>
              <a href="author.html#11683">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 22/07/2016 12:00 a.m., Guilherme Scaglia wrote:
&gt;<i> Amos,
</I>&gt;<i> 
</I>&gt;&gt;<i> There is a different config example for REDIRECT &lt;
</I>&gt;<i> <A HREF="http://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxRedirect">http://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxRedirect</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> Ty, I'm going to try it using REDIRECT. I was unwilling to follow the DNAT
</I>&gt;<i> guide because of having to enable ip-forwarding in a non-router machine.
</I>&gt;<i> The REDIRECT version seems cleaner and is similar to what I've being doing
</I>&gt;<i> using the embedded proxy on the Mikrotik router.
</I>
If that is right I think that is an oversight in the REDIRECT example.
In order to receive packets with destination IP of another machine, the
Squid machine needs to be configured and operating as a router. You
cannot avoid that either, since non-router machines drop those type of
packets at the interface before even iptables gets to see them.

It does not need to route *all* traffic of course. Just the (port 80
only?) stuff delivered to it by the Mikrotik.

&gt;<i> 
</I>&gt;<i> Antony,
</I>&gt;<i> 
</I>&gt;&gt;<i> That won't work.  You *must* perform the DNAT on the machine running Squid
</I>&gt;<i> 
</I>&gt;<i> Just for curiosity's sake, why there is such restriction? I thought squid
</I>&gt;<i> didn't entered the picture until after DNAT was done, and that by then it
</I>&gt;<i> wouldn't know where it happened. Does it somehow queries the system to know
</I>&gt;<i> the original request destination? Wouldn't simply relying on the HOST
</I>&gt;<i> header of the request suffice?
</I>&gt;<i> 
</I>
Because CVE-2009-0801. Using Host header without verifying that its
content is accurate allows attackers to place arbitrary content in your
cache for any URL of their choice. Resulting in all the nasty side
effects you can imagine that ability allows them. There is/was some
active malware as well.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011680.html">[squid-users] Squid Intercept - From inside LAN with DNAT on router and docker on host
</A></li>
	<LI>Next message (by thread): <A HREF="011651.html">[squid-users] Problem site
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11683">[ date ]</a>
              <a href="thread.html#11683">[ thread ]</a>
              <a href="subject.html#11683">[ subject ]</a>
              <a href="author.html#11683">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
