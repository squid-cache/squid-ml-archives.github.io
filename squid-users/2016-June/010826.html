<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSLBump non-HTTPs connections
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSLBump%20non-HTTPs%20connections&In-Reply-To=%3CCAPa6PsFO4PrLcXocwW0zG4fZcwtB9dLpk24HAdi79XdRwaGNfQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010820.html">
   <LINK REL="Next"  HREF="010953.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSLBump non-HTTPs connections</H1>
    <B>Peter Viskup</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSLBump%20non-HTTPs%20connections&In-Reply-To=%3CCAPa6PsFO4PrLcXocwW0zG4fZcwtB9dLpk24HAdi79XdRwaGNfQ%40mail.gmail.com%3E"
       TITLE="[squid-users] SSLBump non-HTTPs connections">skupko.sk at gmail.com
       </A><BR>
    <I>Thu Jun  2 06:33:32 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010820.html">[squid-users] squid-users Digest, Vol 21, Issue 124
</A></li>
        <LI>Next message (by thread): <A HREF="010953.html">[squid-users] SSLBump non-HTTPs connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10826">[ date ]</a>
              <a href="thread.html#10826">[ thread ]</a>
              <a href="subject.html#10826">[ subject ]</a>
              <a href="author.html#10826">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello all,
just wondering whether it is possible to perform SSLBump/SSLSplit for
non-HTTPs connections. At the moment we are interested in FTPs.
We are running Squid 3.4.2 version.

Configured the SSLBump and in that case not able to receive SSL Certificates

proxy:/etc/squid3# grep server-first squid.conf
ssl_bump server-first all
proxy:/etc/squid3# socat TCP-LISTEN:9999,reuseaddr,fork
PROXY:127.0.0.1:www.ftpsservicedomain.net:990,proxyport=8080
proxy:/etc/squid3# openssl s_client -connect localhost:9999 -showcerts
CONNECTED(00000003)
140535877478056:error:140790E5:SSL routines:SSL23_WRITE:ssl handshake
failure:s23_lib.c:177:
---
no peer certificate available
---
No client certificate CA names sent
---
SSL handshake has read 0 bytes and written 308 bytes
---
New, (NONE), Cipher is (NONE)
Secure Renegotiation IS NOT supported
Compression: NONE
Expansion: NONE
---

With ssl_bump disabled for the particular destination domain we are
able to receive SSL Certificates:

proxy:/etc/squid3# openssl s_client -connect localhost:9999 -showcerts
CONNECTED(00000003)
depth=1 C = US, ST = Washington, L = Redmond, O = Microsoft
Corporation, OU = Microsoft IT, CN = Microsoft IT SSL SHA2
verify error:num=20:unable to get local issuer certificate
verify return:0
---
Certificate chain
 0 s:/CN=www.ftpsservicedomain.net
   i:/C=US/ST=Washington/L=Redmond/O=Microsoft
Corporation/OU=Microsoft IT/CN=Microsoft IT SSL SHA2
-----BEGIN CERTIFICATE-----
MIIGQzCCBCugAwIBAgITWgAAuYCRJAQnIMZ1CwABAAC5gDANBgkqhkiG9w0BAQsF
....

In both cases the only log entry we see is the CONNECT request:
01/Jun/2016:10:16:23 +0200    681 127.0.0.1 TAG_NONE/200 0 CONNECT
www.ftpsservicedomain.net:990 - HIER_DIRECT/www.ftpsservicedomain.net
- [Host: www.ftpsservicedomain.net:990\r\n] [-]

Best regards,
-- 
Peter Viskup

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010820.html">[squid-users] squid-users Digest, Vol 21, Issue 124
</A></li>
	<LI>Next message (by thread): <A HREF="010953.html">[squid-users] SSLBump non-HTTPs connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10826">[ date ]</a>
              <a href="thread.html#10826">[ thread ]</a>
              <a href="subject.html#10826">[ subject ]</a>
              <a href="author.html#10826">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
