<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] DNS lookup fails initially for FQDN in squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20DNS%20lookup%20fails%20initially%20for%20FQDN%20in%20squid&In-Reply-To=%3CC1506728-8998-40A3-AF8D-1117BE92616E%40ncsu.edu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010836.html">
   <LINK REL="Next"  HREF="010988.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] DNS lookup fails initially for FQDN in squid</H1>
    <B>Aashima Madaan</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20DNS%20lookup%20fails%20initially%20for%20FQDN%20in%20squid&In-Reply-To=%3CC1506728-8998-40A3-AF8D-1117BE92616E%40ncsu.edu%3E"
       TITLE="[squid-users] DNS lookup fails initially for FQDN in squid">amadaan at ncsu.edu
       </A><BR>
    <I>Thu Jun  2 15:23:24 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010836.html">[squid-users] DNS lookup fails initially for FQDN in squid
</A></li>
        <LI>Next message (by thread): <A HREF="010988.html">[squid-users] DNS lookup fails initially for FQDN in squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10839">[ date ]</a>
              <a href="thread.html#10839">[ thread ]</a>
              <a href="subject.html#10839">[ subject ]</a>
              <a href="author.html#10839">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey,

The patch mentioned is applicable to 4.0.10 beta release . For older versions I was not able to merge the patch.
So even for beta release it throws segmentation fault. Let me know if am using wrong version of code

Backtrace from gdb tool if it can be of any help

Program received signal SIGSEGV, Segmentation fault.
hash_lookup (hid=0x0, k=0xcd4200) at hash.cc:152
152	    b = hid-&gt;hash(k, hid-&gt;size);
Missing separate debuginfos, use: debuginfo-install glibc-2.17-106.el7_2.6.x86_64 libattr-2.4.46-12.el7.x86_64 libcap-2.22-8.el7.x86_64 libgcc-4.8.5-4.el7.x86_64 libstdc++-4.8.5-4.el7.x86_64 libtool-ltdl-2.4.2-21.el7_2.x86_64 nss-softokn-freebl-3.16.2.3-13.el7_1.x86_64

(gdb) backtrace
#0  hash_lookup (hid=0x0, k=0xcd4200) at hash.cc:152
#1  0x000000000056059f in idnsCachedLookup (key=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">key at entry</A>=0xcd4200 &quot;atld-mcafee01.airwatch.dev&quot;, callback=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">callback at entry</A>=0x5d96a0 &lt;ipcacheHandleReply(void*, rfc1035_rr const*, int, char const*)&gt;, 
    data=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">data at entry</A>=0xcd4608) at dns_internal.cc:1675
#2  0x00000000005667ee in idnsALookup (name=0xcd4200 &quot;atld-mcafee01.airwatch.dev&quot;, callback=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">callback at entry</A>=0x5d96a0 &lt;ipcacheHandleReply(void*, rfc1035_rr const*, int, char const*)&gt;, data=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">data at entry</A>=0xcd4608)
    at dns_internal.cc:1742
#3  0x00000000005d9033 in ipcache_nbgethostbyname (name=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">name at entry</A>=0xcd3db0 &quot;atld-mcafee01.airwatch.dev&quot;, handler=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">handler at entry</A>=0x0, handlerData=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">handlerData at entry</A>=0x0) at ipcache.cc:561
#4  0x00000000005d95cc in ipcache_gethostbyname (name=0xcd3db0 &quot;atld-mcafee01.airwatch.dev&quot;, flags=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">flags at entry</A>=1) at ipcache.cc:653
#5  0x00000000007fae8c in Adaptation::ServiceConfig::grokUri (this=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">this at entry</A>=0xcd3ad0, value=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">value at entry</A>=0xcd3cf0 &quot;<A HREF="icap://atld-mcafee01.airwatch.dev:1344/">icap://atld-mcafee01.airwatch.dev:1344/</A>&quot;) at ServiceConfig.cc:239
#6  0x00000000007fc41f in Adaptation::ServiceConfig::parse (this=0xcd3ad0) at ServiceConfig.cc:122
#7  0x00000000007f2773 in Adaptation::Config::parseService (this=0xcb57a0 &lt;Adaptation::Icap::TheConfig&gt;) at Config.cc:136
#8  0x000000000050737b in parse_icap_service_type (cfg=&lt;optimized out&gt;) at cache_cf.cc:4235
#9  parse_line (buff=&lt;optimized out&gt;) at cf_parser.cci:3185
#10 0x0000000000510e89 in parseOneConfigFile (file_name=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">file_name at entry</A>=0xcc9860 &quot;/etc/squid/squid.conf&quot;, depth=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">depth at entry</A>=0) at cache_cf.cc:544
#11 0x000000000051190f in parseConfigFile (file_name=0xcc9860 &quot;/etc/squid/squid.conf&quot;) at cache_cf.cc:585
#12 0x00000000005ddc97 in SquidMain (argc=&lt;optimized out&gt;, argv=0x7fffffffe478) at main.cc:1523
#13 0x00000000004e77ad in SquidMainSafe (argv=&lt;optimized out&gt;, argc=&lt;optimized out&gt;) at main.cc:1374
#14 main (argc=&lt;optimized out&gt;, argv=&lt;optimized out&gt;) at main.cc:1367

(gdb) frame 5
#5  0x00000000007fae8c in Adaptation::ServiceConfig::grokUri (this=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">this at entry</A>=0xcd3ad0, value=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">value at entry</A>=0xcd3cf0 &quot;<A HREF="icap://atld-mcafee01.airwatch.dev:1344/">icap://atld-mcafee01.airwatch.dev:1344/</A>&quot;) at ServiceConfig.cc:239
239	    (void)ipcache_gethostbyname(host.termedBuf(), IP_LOOKUP_IF_MISS);

(gdb) frame 4
#4  0x00000000005d95cc in ipcache_gethostbyname (name=0xcd3db0 &quot;atld-mcafee01.airwatch.dev&quot;, flags=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">flags at entry</A>=1) at ipcache.cc:653
653	        ipcache_nbgethostbyname(name, NULL, NULL);

(gdb) frame 3
#3  0x00000000005d9033 in ipcache_nbgethostbyname (name=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">name at entry</A>=0xcd3db0 &quot;atld-mcafee01.airwatch.dev&quot;, handler=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">handler at entry</A>=0x0, handlerData=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">handlerData at entry</A>=0x0) at ipcache.cc:561
561	    idnsALookup(hashKeyStr(&amp;i-&gt;hash), ipcacheHandleReply, c);

(gdb) frame 2
#2  0x00000000005667ee in idnsALookup (name=0xcd4200 &quot;atld-mcafee01.airwatch.dev&quot;, callback=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">callback at entry</A>=0x5d96a0 &lt;ipcacheHandleReply(void*, rfc1035_rr const*, int, char const*)&gt;, data=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">data at entry</A>=0xcd4608)
    at dns_internal.cc:1742
1742	    if (idnsCachedLookup(name, callback, data))

(gdb) frame 1
#1  0x000000000056059f in idnsCachedLookup (key=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">key at entry</A>=0xcd4200 &quot;atld-mcafee01.airwatch.dev&quot;, callback=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">callback at entry</A>=0x5d96a0 &lt;ipcacheHandleReply(void*, rfc1035_rr const*, int, char const*)&gt;, 
    data=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">data at entry</A>=0xcd4608) at dns_internal.cc:1675
1675	    idns_query *old = (idns_query *) hash_lookup(idns_lookup_hash, key);

(gdb) frame 0
#0  hash_lookup (hid=0x0, k=0xcd4200) at hash.cc:152
152	    b = hid-&gt;hash(k, hid-&gt;size);
(gdb) 


Thanks
Aashima

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160602/1c369fff/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160602/1c369fff/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010836.html">[squid-users] DNS lookup fails initially for FQDN in squid
</A></li>
	<LI>Next message (by thread): <A HREF="010988.html">[squid-users] DNS lookup fails initially for FQDN in squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10839">[ date ]</a>
              <a href="thread.html#10839">[ thread ]</a>
              <a href="subject.html#10839">[ subject ]</a>
              <a href="author.html#10839">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
