<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Establishing secure conection problems (Chrome)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Establishing%20secure%20conection%20problems%20%28Chrome%29&In-Reply-To=%3C1ca7252d-0b08-bafe-ae99-b4d0b4500b21%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011089.html">
   <LINK REL="Next"  HREF="010830.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Establishing secure conection problems (Chrome)</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Establishing%20secure%20conection%20problems%20%28Chrome%29&In-Reply-To=%3C1ca7252d-0b08-bafe-ae99-b4d0b4500b21%40treenet.co.nz%3E"
       TITLE="[squid-users] Establishing secure conection problems (Chrome)">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Jun  3 05:43:54 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011089.html">[squid-users] Establishing secure conection problems (Chrome)
</A></li>
        <LI>Next message (by thread): <A HREF="010830.html">[squid-users] Establishing secure conection problems (Chrome)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10842">[ date ]</a>
              <a href="thread.html#10842">[ thread ]</a>
              <a href="subject.html#10842">[ subject ]</a>
              <a href="author.html#10842">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 3/06/2016 1:35 a.m., William Ivanski wrote:
&gt;<i> Thank you for your quick response.
</I>&gt;<i> 
</I>&gt;<i> First of all forgive me for the lack of information in the first
</I>&gt;<i> email. I've tried to disable QUIC a few minutes ago and the problem
</I>&gt;<i> persists. Follow the information requested:
</I>&gt;<i> 
</I>&gt;<i> -&gt; Compilation:
</I>&gt;<i> 
</I>&gt;<i> I've installed squid using the following commands:
</I>&gt;<i> 
</I>&gt;<i>     cd /usr/src
</I>&gt;<i> 
</I>&gt;<i>     apt-get install squid3
</I>&gt;<i> 
</I>&gt;<i>     wget <A HREF="http://www.squid-cache.org/Versions/v3/3.5/squid-3.5.15-20160330-r14015.tar.gz">http://www.squid-cache.org/Versions/v3/3.5/squid-3.5.15-20160330-r14015.tar.gz</A>
</I>&gt;<i> 
</I>&gt;<i>     tar xvzf squid-3.5.15-20160330-r14015.tar.gz
</I>&gt;<i> 
</I>&gt;<i>     cd squid-3.5.15-20160330-r14015
</I>&gt;<i> 
</I>
NP: when building your own always build the latest. Today that would be
one of the 3.5.19 snapshots.


&gt;<i>     apt-get build-dep squid3 &amp;&amp; apt-get install build-essential libssl-dev
</I>&gt;<i> 
</I>&gt;<i>     ./configure --enable-icap-client --enable-ssl --enable-ssl-crtd
</I>&gt;<i> --prefix=/usr --includedir=/usr/include --mandir=/usr/share/man
</I>&gt;<i> --infodir=/usr/share/info --sysconfdir=/etc --localstatedir=/var
</I>&gt;<i> --libexecdir=/lib/squid3 --srcdir=. --datadir=/usr/share/squid3
</I>&gt;<i> --sysconfdir=/etc/squid3 --mandir=/usr/share/man
</I>&gt;<i> --with-default-user=squid --with- cppunit-config-basedir=/usr
</I>&gt;<i> --with-logdir=/var/log/squid3 --with-pidfile=/var/run/squid3.pid
</I>&gt;<i> --with-openssl --disable-optimizations --disable-arch-native
</I>&gt;<i> 
</I>&gt;<i>     service squid3 stop
</I>&gt;<i> 
</I>&gt;<i>     make all &amp;&amp; make install
</I>&gt;<i> 
</I>&gt;<i>     useradd squid &amp;&amp; chown -R squid:squid /var/log/squid3
</I>
Don't. The squid3 package install created the necessary user and
permissions for all required things.

You just need to build with the same default-user settings as Debian.
IIRC that is --with-default-user=proxy

&gt;<i> 
</I>&gt;<i>     mv /usr/sbin/squid3 /usr/sbin/squid3.old &amp;&amp; mv/usr/sbin/squid
</I>&gt;<i> /usr/sbin/squid3
</I>&gt;<i> 
</I>&gt;<i>     /lib/squid3/ssl_crtd -c -s /var/lib/ssl_db -M 4 MB
</I>&gt;<i> 
</I>&gt;<i>     chown -R squid:squid /var/lib/ssl_db
</I>&gt;<i> 
</I>&gt;<i>     service squid3 restart &amp;&amp; service squid3 stop &amp;&amp; chmod 777
</I>&gt;<i> /var/spool/squid3 &amp;&amp; squid3 -z &amp;&amp; service squid3 restart
</I>
Same here.

&gt;<i> 
</I>&gt;<i> OBS: We're not using ssl_crtd/ssl_db anymore. Our previous squid conf
</I>&gt;<i> was using intercept, but the actual one isn't configured as
</I>&gt;<i> transparent proxy.
</I>
If that is so then any problems Chrome or other agents might be having
are not related to Squid.

They are just creating opaque tunnels through the proxy and doing TLS
stuff end-to-end. There is no reason for the proxy to have TLS/SSL
capabilities at all in that kind of setup.


The config you posted confirms. The OpenSSL abilities you custom
compiled to add to the proxy are not being used in any way.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011089.html">[squid-users] Establishing secure conection problems (Chrome)
</A></li>
	<LI>Next message (by thread): <A HREF="010830.html">[squid-users] Establishing secure conection problems (Chrome)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10842">[ date ]</a>
              <a href="thread.html#10842">[ thread ]</a>
              <a href="subject.html#10842">[ subject ]</a>
              <a href="author.html#10842">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
