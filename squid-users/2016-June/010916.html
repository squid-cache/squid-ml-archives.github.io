<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Vary object loop returns
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Vary%20object%20loop%20returns&In-Reply-To=%3C1465234584830-4677865.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010912.html">
   <LINK REL="Next"  HREF="010913.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Vary object loop returns</H1>
    <B>joe</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Vary%20object%20loop%20returns&In-Reply-To=%3C1465234584830-4677865.post%40n4.nabble.com%3E"
       TITLE="[squid-users] Vary object loop returns">chip_pop at hotmail.com
       </A><BR>
    <I>Mon Jun  6 17:36:24 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010912.html">[squid-users] Vary object loop returns
</A></li>
        <LI>Next message (by thread): <A HREF="010913.html">[squid-users] Vary object loop returns
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10916">[ date ]</a>
              <a href="thread.html#10916">[ thread ]</a>
              <a href="subject.html#10916">[ subject ]</a>
              <a href="author.html#10916">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>right the acsess.log dose not show  those  %20 
20 ar space in real accept-encoding: gzip, deflate   &lt;-- notice the space
wen it reach function
varyEvaluateMatch  it shange some how to 20   and the %  is mark  the one
internally wen its used by the destination server  it has no mark %20   
example  accept-encoding=&quot;gzip,%20deflate&quot;  &lt;--here the server use gzip
notice its not marked
accept-encoding=&quot;%20gzip,%20deflate,identity&quot; &lt;-- here identity used by the
destination sever sending this to squid with mark %20   depend i gess on
dest..server compression can handle
so those wen it come to squid they use the vary as extra key to save the
object in cache 
we dont need them   since there is many browser or app  asking the
dest...server for different compression
hit %  become low cause squid use vary with wat ever string as key to save
the object
now for us  its very bad caching and if we remove filtering out those with
%20 so other variant browser can benefit of those object from the cache  so
the 20 is hex converted from the string space to 20  and the %  is mark as i
understand it after lots a research 



Heiler Bemerguy wrote
&gt;<i> These are the variations for the &quot;accept-encoding&quot; tag I found when 
</I>&gt;<i> sniffing my client's connections. And they're of all kind. Newer and 
</I>&gt;<i> older browsers, mobile phones, windows updates, whatever..
</I>&gt;<i> 
</I>&gt;<i> It got a total of 11.437 requests from clients to squid.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> *accept-encoding: gzip, deflate**
</I>&gt;<i> **Accept-Encoding: gzip, deflate**
</I>&gt;<i> **Accept-Encoding: gzip,deflate**
</I>&gt;<i> **Accept-Encoding: gzip, deflate, lzma, sdch**
</I>&gt;<i> **Accept-Encoding: gzip, deflate, sdch**
</I>&gt;<i> **Accept-Encoding: gzip,deflate,sdch**
</I>&gt;<i> **Accept-Encoding: gzip, xeflate, sdch**
</I>&gt;<i> **Accept-Encoding: identity**
</I>&gt;<i> **Accept-Encoding: identity;q=1, *;q=0*
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Notice that some have spaces, some not, but I haven't seen any &quot;%20&quot; 
</I>&gt;<i> representing a space. Is the &quot;%20&quot; put there by squid itself?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -- 
</I>&gt;<i> Best Regards,
</I>&gt;<i> 
</I>&gt;<i> Heiler Bemerguy
</I>&gt;<i> Network Manager - CINBESA
</I>&gt;<i> 55 91 98151-4894/3184-1751
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Em 06/06/2016 12:08, Yuri Voinov escreveu:
</I>&gt;&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;&gt;<i> Hash: SHA256
</I>&gt;&gt;<i>   
</I>&gt;&gt;<i> Ok, why not to replace %20 to original space symbol?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 06.06.2016 20:27, joe &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;&gt;&gt;<i> not good just to strip %20 lol as i post it remove also  string was
</I>&gt;&gt;&gt;<i> belong to
</I>&gt;&gt;&gt;<i> the date
</I>&gt;&gt;&gt;<i> we need to remove all of those string start with ,%20    as ,%20sdch so
</I>&gt;&gt;&gt;<i> its not eassy detection
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> it kill  
</I>&gt;&gt;&gt;<i> if-modified-since=&quot;Mon,%2006%20Jun%202016%2014%3A31%3A32%20GMT&quot;,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> if you notice this string in vary  has %20 so just wide search and
</I>&gt;&gt;<i> clear it
</I>&gt;&gt;&gt;<i> remove those :(
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> --
</I>&gt;&gt;&gt;<i> View this message in context:
</I>&gt;&gt;<i> <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Vary-object-loop-returns-tp4677716p4677856.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Vary-object-loop-returns-tp4677716p4677856.html</A>
</I>&gt;&gt;&gt;<i> Sent from the Squid - Users mailing list archive at Nabble.com.
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;&gt;<i> 
</I>
&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at .squid-cache</A>
</I>
&gt;&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i> -----BEGIN PGP SIGNATURE-----
</I>&gt;&gt;<i> Version: GnuPG v2
</I>&gt;&gt;<i>   
</I>&gt;&gt;<i> iQEcBAEBCAAGBQJXVZH5AAoJENNXIZxhPexG4w0IAJr6eWxVVostrUXcOaTHVKxC
</I>&gt;&gt;<i> Hg1p9MlRko/B+fPpNKZmWPStvklZL7jOwaLLKY6E2ZCHIOOotDV+L7WXlqb2tnml
</I>&gt;&gt;<i> M3E9aGWSpBPhX61Se1vDI9gCOEZmhf+GcriOdSysjJpqqlKVEIZVFNpnjE05I5Lc
</I>&gt;&gt;<i> 6MBV0Lteag/nrRjSM46ajJjSKSVUY0dOcRtHPZkv3iCeh6WEALfB7jZ67GYiiAjy
</I>&gt;&gt;<i> BcBhI8i4bjWUu9yQwYUBvN+OIp2FlLoM7JQqPRDQn3i2b5Miq4MI4cdZ5Sntrt/n
</I>&gt;&gt;<i> yEgWXl90w16TASjbUQjs6wB8xSHeMYKFdpOlsI1o/m8/aqCa1kIANyDYPBIUiWg=
</I>&gt;&gt;<i> =DYz3
</I>&gt;&gt;<i> -----END PGP SIGNATURE-----
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> 
</I>
&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at .squid-cache</A>
</I>
&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>
&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at .squid-cache</A>
</I>
&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

new patch vary_experimental4

vary_experimental4.patch
&lt;<A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/file/n4677865/vary_experimental4.patch">http://squid-web-proxy-cache.1019090.n4.nabble.com/file/n4677865/vary_experimental4.patch</A>&gt;  




--
View this message in context: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Vary-object-loop-returns-tp4677716p4677865.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Vary-object-loop-returns-tp4677716p4677865.html</A>
Sent from the Squid - Users mailing list archive at Nabble.com.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010912.html">[squid-users] Vary object loop returns
</A></li>
	<LI>Next message (by thread): <A HREF="010913.html">[squid-users] Vary object loop returns
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10916">[ date ]</a>
              <a href="thread.html#10916">[ thread ]</a>
              <a href="subject.html#10916">[ subject ]</a>
              <a href="author.html#10916">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
