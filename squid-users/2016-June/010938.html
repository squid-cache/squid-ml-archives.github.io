<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Vary object loop returns
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Vary%20object%20loop%20returns&In-Reply-To=%3C012e53d8-fb0c-1a75-71db-56a7a41e523a%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010937.html">
   <LINK REL="Next"  HREF="010965.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Vary object loop returns</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Vary%20object%20loop%20returns&In-Reply-To=%3C012e53d8-fb0c-1a75-71db-56a7a41e523a%40gmail.com%3E"
       TITLE="[squid-users] Vary object loop returns">yvoinov at gmail.com
       </A><BR>
    <I>Tue Jun  7 10:48:27 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010937.html">[squid-users] Vary object loop returns
</A></li>
        <LI>Next message (by thread): <A HREF="010965.html">[squid-users] Vary object loop returns
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10938">[ date ]</a>
              <a href="thread.html#10938">[ thread ]</a>
              <a href="subject.html#10938">[ subject ]</a>
              <a href="author.html#10938">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256
 


07.06.2016 16:36, Amos Jeffries &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> On 7/06/2016 8:48 p.m., Yuri Voinov wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 07.06.2016 4:57, Amos Jeffries &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;&gt;&gt;<i> On 7/06/2016 5:55 a.m., Yuri Voinov wrote:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> So.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Squid DOES NOT and DON'T BE support gzip. The only way to do it - use
</I>&gt;&gt;&gt;&gt;<i> ecap + desupported ecap gzip adapter. Let's accept this. We can support
</I>&gt;&gt;&gt;&gt;<i> gzip. With restrictions. Ok.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> any other compression - false. No. No way. Get out. and so on.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>  identity - this is uncompressed type.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> That's all, folks.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Finally. As Joe does, we can remain only gzip and identity in
</I>&gt;&gt;&gt;&gt;<i> Accept-Encoding and truncate all remaining.
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Locking the entire Internet to using your personal choice of gzip
</I>&gt;&gt;&gt;<i> compression or none.
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> gzip is the slowest and more resource hungry type of compression there
</I>&gt;&gt;&gt;<i> is. deflate is actually faster for clients and just as widely supported.
</I>&gt;&gt;<i> Unfortunately, Amos, no one has written any other compression algorithms
</I>&gt;&gt;<i> support module. We have to eat what they give.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Like I said deflate is widely available. Heiler's recent info shows that
</I>&gt;<i> lzma is becomming more visible on the public web, which should help fix
</I>&gt;<i> the one issue deflate has.
</I>&gt;<i>
</I>&gt;<i> And noone appears to be fixing the remaining issues in the Squid gzip
</I>&gt;<i> eCAP module.
</I>&gt;<i>
</I>&gt;<i> There also seems to be a big push back from browser and some server
</I>&gt;<i> vendors about compression in general. We had a fairly major fight in
</I>&gt;<i> IETF to get HTTP/2 to contain data compression at all. It is still only
</I>&gt;<i> in there as an optional extension that some are openly refusing to
</I>&gt;<i> implement.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Without any problem. Moreover, this type of can be push to all brunches
</I>&gt;&gt;&gt;&gt;<i> of squid without any problem, because of this dramatically increases
</I>&gt;&gt;&gt;&gt;<i> byte HIT.
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Responding with a single object to all requests makes your HIT ratio
</I>&gt;&gt;&gt;<i> 100% guaranteed. The clients wont like you though if all they ever see
</I>&gt;&gt;&gt;<i> is the same cat picture.
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> It sounds ridiculous when put that way, but that is what these patches
</I>&gt;&gt;&gt;<i> are doing for a unknown number of those &quot;gained&quot; HITs. See my previous
</I>&gt;&gt;&gt;<i> post about how none of these patches are changing the request the server
</I>&gt;&gt;&gt;<i> gets.
</I>&gt;&gt;<i> But no one asked the question - why Squid in production installations
</I>&gt;&gt;<i> has such a low hit ratio
</I>&gt;<i>
</I>&gt;<i> Yes that has been asked, even investigated. The reason(s) are many
</I>&gt;<i> complex details and small issues adding together to a big loss.
</I>&gt;<i>
</I>&gt;<i> They range from protocol things like Vary not being fine-grained enough
</I>&gt;<i> (Key header being developed fixes that), through to client behaviour
</I>&gt;<i> (Chrome sdch doubles the variant count - almost halving useful cache
</I>&gt;<i> space), to server behaviour (Apache changing Vary header).
</I>&gt;<i>
</I>&gt;<i> What your testing of joes patches is showing is that the sdch effect
</I>&gt;<i> Chrome has is probably way bigger than one would expect to be reasonable.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> that raises the question of expediency of
</I>&gt;&gt;<i> application caching proxy. We do believe that this is a caching proxy?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> You are once again sweeping asside the critical requirement of content
</I>&gt;&gt;&gt;<i> integrity to achieve high HIT ratio. Which is not something that I can
</I>&gt;&gt;&gt;<i> accept into Squid as a default action.
</I>&gt;&gt;<i> I continue to believe that 20% is unacceptably low cache hit ratio,
</I>&gt;&gt;<i> given the very aggressive settings and the active use of Store ID. Which
</I>&gt;&gt;<i> brings us back to the idea of the feasibility of using the SQUID as a
</I>whole.
&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> That kind of &quot;unacceptable&quot; statement simply cannot be made about cache
</I>&gt;<i> HIT ratio. It is what it is. One cannot change the speed of light
</I>&gt;<i> because it takes unacceptable long to travel through space.
</I>Yes and no.

We're not just talking about the abstract ratio of cache hits. But,
above all, about the measured byte hit ratio. It is who gives the
maximum gain traffic. Even an increase in latency cache in many cases
can be neglected. Traffic is money. Often very large sum.
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Two properly working caches in serial will have extremely different
</I>&gt;<i> caching ratios. The one with most direct client connections trends
</I>&gt;<i> towards 50-100% and the upstream one towards the servers will trend
</I>&gt;<i> towards zero. The total cacheable ratio is unchanged, but each cache
</I>&gt;<i> sees a different proportion of it and so shows different HIT ratios
</I>&gt;<i> relative to their clients portion.
</I>Sure, but not all of us can afford two cache. In most installations,
only one box. And we, of course, desirable to have maximum possible
efficiency. In addition, I am currently working on the optimization of a
single installation with two storage arrays in order to obtain the best
possible hit rate by only one server Squid.
&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Also, don't forget that browser cache disk space available are
</I>&gt;<i> increasingly large as well. So their caches are growing in size and
</I>&gt;<i> taking up a larger share of the total achievable HIT ratios in recent
</I>years.
Browser's cache in this case, not quite. It still is not shared.

Which brings us to the fact that customers download the same content
multiple times, and for a shared cache that content is unique.
Duplication is a problem. Serious problem. Caches have become more
content increased quantitatively. We have a huge amount of duplicate
content, which, in many cases, is apparently identical. StoreID only
partially solves the problem, because it requires a huge amount of
manual work for maintenance, and continuous. For example, first I worked
Instagram own means, then went under Akamai. URL structure has changed
and needed to radically change the rewrite rule.

If we are at the level of application protocols to reduce the amount of
work for maintenance of shared cache, and it will increase the
efficiency of our work and solve a lot of problems for future changes in
the Web.
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBCAAGBQJXVqZ6AAoJENNXIZxhPexGneEIALt1pIyoti9R7iegTRnW1kQc
x3r/PeE9j4zx1xH+PayHvf+Wfr3QqBtIpxd9hvJ+epn9V//8D6NBwSGnUSJJKpxQ
DFWWOHV12du/BT3ZUEt3EY/rfE7xVj+tZ6vEBXRhKYSzzlbfARpB9rE6JXx2cuqG
Q/2vcKzpMfcItMsE8yqejcPBe+Lf8pSO1vvMut3m4QHkge4OQhhyzrnwzyh9QMwp
AXXD4SSBoMxCZ5Z2BFr1aqSZ1F+TRPW/nn5CB+pr3U+XEzIb8lp3XMz0ZeUwuYnh
Zgc1E7hIn/CEybT0IyMi24ojc1CB4YY7V1BaePYdsbGdXS0up58Ea6jP5bD0DTc=
=Dw5f
-----END PGP SIGNATURE-----

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x613DEC46.asc
Type: application/pgp-keys
Size: 2437 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160607/308b5300/attachment.key">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160607/308b5300/attachment.key</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010937.html">[squid-users] Vary object loop returns
</A></li>
	<LI>Next message (by thread): <A HREF="010965.html">[squid-users] Vary object loop returns
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10938">[ date ]</a>
              <a href="thread.html#10938">[ thread ]</a>
              <a href="subject.html#10938">[ subject ]</a>
              <a href="author.html#10938">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
