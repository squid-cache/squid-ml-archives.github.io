<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Vary object loop returns
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Vary%20object%20loop%20returns&In-Reply-To=%3C7030597c-3da7-d600-bbd6-2c76af22f162%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010939.html">
   <LINK REL="Next"  HREF="010941.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Vary object loop returns</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Vary%20object%20loop%20returns&In-Reply-To=%3C7030597c-3da7-d600-bbd6-2c76af22f162%40gmail.com%3E"
       TITLE="[squid-users] Vary object loop returns">yvoinov at gmail.com
       </A><BR>
    <I>Tue Jun  7 11:17:34 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010939.html">[squid-users] Vary object loop returns
</A></li>
        <LI>Next message (by thread): <A HREF="010941.html">[squid-users] Vary object loop returns
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10940">[ date ]</a>
              <a href="thread.html#10940">[ thread ]</a>
              <a href="subject.html#10940">[ subject ]</a>
              <a href="author.html#10940">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256
 


07.06.2016 17:00, Amos Jeffries &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> On 7/06/2016 9:12 p.m., Yuri Voinov wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 07.06.2016 5:13, Amos Jeffries &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;&gt;&gt;<i> On 7/06/2016 6:20 a.m., Yuri Voinov wrote:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> By the way, we have another problem. Caching is greatly reduced by the
</I>&gt;&gt;&gt;&gt;<i> presence of User-Agent header Vary. Although I know that Amos says - he
</I>&gt;&gt;&gt;&gt;<i> says, we should break the Internet and cached separately all types of
</I>&gt;&gt;&gt;&gt;<i> user agents.
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Please do not put your own beliefs into my mouth. I am very much in
</I>&gt;&gt;<i> Sorry, Amos. This was sarcasm. May be, not too relevant.
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> favour of denying Vary:User-Agent from being cached *at all* until the
</I>&gt;&gt;&gt;<i> UA start sending sensible contents in the header. That would lower your
</I>&gt;&gt;&gt;<i> precious HIT ratio a tiny amount.
</I>&gt;&gt;<i> Maybe. However, this greatly increases the content duplication. &#1040;gree?
</I>&gt;<i>
</I>&gt;<i> I'm not sure what you are asking me to agree with there.
</I>&gt;<i>
</I>&gt;<i> The Vary:User-Agent has three cases that can happen:
</I>&gt;<i>
</I>&gt;<i> 1) caching it properly results in huge number of probably duplicated
</I>&gt;<i> variants in the cache. Each response though is guaranteed to be correct
</I>&gt;<i> for that UA when HIT happen.
</I>&gt;<i>  I think we agree that situation is bad. Currently the store_miss
</I>&gt;<i> directive is the best way to avoid that. Which makes #2 happen instead
</I>&gt;<i> of this #1 case.
</I>&gt;<i>
</I>&gt;<i> 2) not caching it at all will lower the HIT ratio from sites using it.
</I>&gt;<i> However a potentially large amount of cache space will become available
</I>&gt;<i> for other better caching sites to use and raise their HIT ratio.
</I>&gt;<i> Again each response is guaranteed to be correct for that UA.
</I>&gt;<i>
</I>&gt;<i> 3) caching one random copy from the server and delivering it to all
</I>&gt;<i> clients regardless of their UA will produce a high HIT ratio. Something
</I>&gt;<i> like the HIT ratio from #1 plus ratio gained by #2.
</I>&gt;<i>  However, each response will randomy break a) clients expectations, b)
</I>&gt;<i> the servers expectations, and c) the site authors behaviour expectations
</I>&gt;<i> (ie security model).
</I>&gt;<i>
</I>&gt;<i> I believe #2 is the best tradeoff. You seem to be arguing for #3 solely
</I>&gt;<i> on the IT ratio numbers, without considering the actual nasty side effect.
</I>
It's understandable reasons, Amos. We discussed them previously. You
proceed from the presumption of good faith Webmasters. However,
experience has shown that it is not. Many - including especially Google!
- Actively oppose caching, using all possible mechanisms. Adding the
hash in the URL - and this is the most harmless! - URL encryption,
header modifications, including UA. Accordingly, I want to have a
mechanism for combating such unscrupulous webmasters. And if possible
without a huge amount of night work by hand. I have things to do, and
besides nightly reverse engineering sites.


&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> BTW: Do you know what &quot;breaking the Internet&quot; actually means? It's a bit
</I>&gt;&gt;&gt;<i> ironic that you would throw that insult at me while praising what these
</I>&gt;&gt;&gt;<i> patches currently do.
</I>&gt;&gt;<i> :) Really sorry.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Sometimes our experiments scratching the hell out of the display content
</I>&gt;&gt;<i> in browsers. That's what I called &quot;break the Internet&quot;. :) But
</I>&gt;&gt;<i> seriously, we're trying to find a compromise between a high cache and
</I>&gt;&gt;<i> the desire to satisfy customers. It seems to me, mutually exclusive
</I>things.
&gt;<i>
</I>&gt;<i> Ah. What I have been trying to get across is that they are not mutually
</I>&gt;<i> exclusive like that.
</I>&gt;<i>
</I>&gt;<i> You have seen the display breakage. That is caused directly by things
</I>&gt;<i> like client requesting identity encoding but being delivered a cached
</I>&gt;<i> gzip object. Or worse, the garbage output from trying to decompress an
</I>&gt;<i> identity object with gzip decompressor. The display gets F*'d.
</I>&gt;<i>
</I>&gt;<i> Note that the reason the wrong content came back in all the above
</I>&gt;<i> display problems was that it was a cache HIT and the proxy ignored part
</I>&gt;<i> of the Vary header when producing its response.
</I>Side effects in some cases, can be ignored. (By the way, I just have
reason to doubt the integrity of users with respect to me and my work,
to seriously worry about the invisible side effects. On the grave
violations in the sites notified me. Everything else is on my conscience).

In the case of a number of sites that create problems in caching for me,
I am ready to come to terms with some inaccuracy in the work - for
example, this applies to ad networks or Web sites opposing caching for
selfish purposes. I have often wondered what, in fact, the devil so
counteracts Google caching terabytes Youtube content. When the counting
of views was enough to make a tiny non-cached JS who have recorded the
client-side viewing.
&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Meanwhile, Amos, I still believe that the team should now, in 2016, to
</I>&gt;&gt;<i> seriously reconsider attitude to compress the content and possibly
</I>&gt;&gt;<i> revise Vary processing algorithms in favor of more vysokgo cache hit
</I>&gt;&gt;<i> ratio. Under the conditions of high-speed Internet only a high hit ratio
</I>&gt;&gt;<i> justifies the use of caching proxy.
</I>&gt;<i>
</I>&gt;<i> What attitude? For my part the response (to every submission) is that a
</I>&gt;<i> patch doing it right will go in, not another hacked up job.
</I>&gt;<i>
</I>&gt;<i> Who is this &quot;the team&quot; ? It is all of us including you.
</I>&gt;<i>
</I>&gt;<i> We cannot revise the Vary algorithm, it is RFC defined. The best we can
</I>&gt;<i> do for the forseeable future is hacked up tricks like filtering what
</I>&gt;<i> headers get sent through to the server. I am part-time working with the
</I>&gt;<i> Apache and Chrome devs in IETF to design a replacement Key header that
</I>&gt;<i> works far better.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBCAAGBQJXVq1NAAoJENNXIZxhPexG/24H/Rq8gfS/eAs621wtx1kV0pGW
T68B0ov3ywkchtomlQVUfN5NqTBnvKj3t5Lfy4QppW+3W2K/OHO4C5Gbjlj2W8z1
+bJJ7t1ZJRlGHnY4MREeR//MqxuvAj0e17JcHjbOq0Me7mhKkMqaK8ZNdcPCeK8O
o+ori1mJnCgRldveqHA4JwLDGYawAU6ApBL/VbZlRZO206dqtgWjdNwGYRi7lgY7
xyduwAZiuvNVnGHSFZk9ikGMs4Wax0XEt1t33vY4VnesF0hKdQrT4OwAQ9xadJ/j
EychwK5+zjZ90dq0c3SkbPJkdCQlk3EOLTuuYE9Gh5fB7BDm7Zz9oh2y27S/e8g=
=QWqB
-----END PGP SIGNATURE-----

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x613DEC46.asc
Type: application/pgp-keys
Size: 2437 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160607/84d822d4/attachment.key">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160607/84d822d4/attachment.key</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010939.html">[squid-users] Vary object loop returns
</A></li>
	<LI>Next message (by thread): <A HREF="010941.html">[squid-users] Vary object loop returns
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10940">[ date ]</a>
              <a href="thread.html#10940">[ thread ]</a>
              <a href="subject.html#10940">[ subject ]</a>
              <a href="author.html#10940">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
