<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] server request timeout not working
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20server%20request%20timeout%20not%20working&In-Reply-To=%3C9a4f600d-bbae-4f0d-5b4c-b97e50f16ad0%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010950.html">
   <LINK REL="Next"  HREF="010967.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] server request timeout not working</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20server%20request%20timeout%20not%20working&In-Reply-To=%3C9a4f600d-bbae-4f0d-5b4c-b97e50f16ad0%40treenet.co.nz%3E"
       TITLE="[squid-users] server request timeout not working">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Jun  8 09:43:39 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010950.html">[squid-users] Response timeout for upstream HTTP servers
</A></li>
        <LI>Next message (by thread): <A HREF="010967.html">[squid-users] Somewhat OT: Content Filter with https
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10955">[ date ]</a>
              <a href="thread.html#10955">[ thread ]</a>
              <a href="subject.html#10955">[ subject ]</a>
              <a href="author.html#10955">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 25/05/2016 8:26 a.m., Heiler Bemerguy wrote:
&gt;<i> 
</I>&gt;<i> If you connect to squid and ask it to get a file on a server which
</I>&gt;<i> accepts the tcp connection but won't reply anything, the connection will
</I>&gt;<i> never timeout.
</I>&gt;<i> 
</I>&gt;<i> Like this: (client side)
</I>&gt;<i> 
</I>&gt;<i> GET <A HREF="http://10.1.4.60:8080/pehasuzyjireohwwlik.txt">http://10.1.4.60:8080/pehasuzyjireohwwlik.txt</A> HTTP/1.1
</I>&gt;<i> Accept: */*
</I>&gt;<i> Accept-Encoding: identity
</I>&gt;<i> Range: bytes=20-80
</I>&gt;<i> User-Agent: FakeUser/0.0
</I>&gt;<i> Proxy-Connection: Keep-Alive
</I>&gt;<i> Host: 10.1.4.60
</I>&gt;<i> 
</I>&gt;<i> Gives this on server side:
</I>&gt;<i> 
</I>&gt;<i> GET /pehasuzyjireohwwlik.txt HTTP/1.1
</I>&gt;<i> Accept: */*
</I>&gt;<i> Accept-Encoding: identity
</I>&gt;<i> User-Agent: FakeUser/0.0
</I>&gt;<i> Host: 10.1.4.60:8080
</I>&gt;<i> Via: 1.1 jasperserver (squid)
</I>&gt;<i> X-Forwarded-For: 10.1.4.60
</I>&gt;<i> Cache-Control: max-age=29030400
</I>&gt;<i> Connection: keep-alive
</I>&gt;<i> 
</I>&gt;<i> It does connect to 10.1.4.60:8080, this port is open and accepting
</I>&gt;<i> connections.. but it won't reply anything to squid, and squid will
</I>&gt;<i> remain connected to it and waiting forever
</I>
How long was the longest actual test you made?
 read_timeout is 15 minutes.


&gt;<i> 
</I>&gt;<i> client_idle_pconn_timeout 30 seconds
</I>
 - how long to wait for the next client request to arrive on a
persistent connection.

 NP: ideally you want long-ish client persistence and short server
persistence.

This is because clients may be a browser waiting for user to read a page
before clicking onwards. CLosing them early means higher latency when
user clicks on web links, etc.

But server connections are multiplexed and shared for outgoing requests.
So many active clients will use them more frequently than a single
client. Holding onto these for long times also ties up the server
resources needlessly and risks being disconnected from the other end
which causes problems.


&gt;<i> 
</I>&gt;<i> client_persistent_connections on
</I>&gt;<i> server_persistent_connections on
</I>
 - enable &quot;Connection:keep-alive&quot; feature of HTTP on both client and
server connections.


&gt;<i> connect_timeout 60 seconds
</I>
 - how long to wait for TCP SYN ACK packet when making an outbound
connection to some server.


&gt;<i> request_timeout 30 seconds
</I>
 - how long to wait for *client* to *send us* the request headers after
is connects.

&gt;<i> persistent_request_timeout 30 seconds
</I>
 - An obsolete directive replaced by client_idle_pconn_timeout in Squid-3.2.


&gt;<i> collapsed_forwarding on
</I>&gt;<i> 
</I>
Allow client requests to get a HIT on a transaction that has not yet
completed, or possibly only just started being sent to the server.


Notice how none of those settings is related to outgoing server request
timing.

Once the request is written (governed by write_timeout) the next thing
Squid does on that connection is wait for the response (governed by
read_timeout). When the response is finished it gets put back into the
idle pool (governed by server_idle_pconn_timeout).


Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010950.html">[squid-users] Response timeout for upstream HTTP servers
</A></li>
	<LI>Next message (by thread): <A HREF="010967.html">[squid-users] Somewhat OT: Content Filter with https
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10955">[ date ]</a>
              <a href="thread.html#10955">[ thread ]</a>
              <a href="subject.html#10955">[ subject ]</a>
              <a href="author.html#10955">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
