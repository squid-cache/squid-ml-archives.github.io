<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Unable to IPv6 DNAT &amp; intercept (Debian Stretch,	Linux 3.16.0, Squid 3.5.19)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Unable%20to%20IPv6%20DNAT%20%26%20intercept%20%28Debian%20Stretch%2C%0A%09Linux%203.16.0%2C%20Squid%203.5.19%29&In-Reply-To=%3CCAE8g12H0VsdaOv2Xo54_h4HLCx7qyHVyBAYwgmtYW4QbrS-%2B2g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010984.html">
   <LINK REL="Next"  HREF="010991.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Unable to IPv6 DNAT &amp; intercept (Debian Stretch,	Linux 3.16.0, Squid 3.5.19)</H1>
    <B>Joni K&#228;h&#228;r&#228;</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Unable%20to%20IPv6%20DNAT%20%26%20intercept%20%28Debian%20Stretch%2C%0A%09Linux%203.16.0%2C%20Squid%203.5.19%29&In-Reply-To=%3CCAE8g12H0VsdaOv2Xo54_h4HLCx7qyHVyBAYwgmtYW4QbrS-%2B2g%40mail.gmail.com%3E"
       TITLE="[squid-users] Unable to IPv6 DNAT &amp; intercept (Debian Stretch,	Linux 3.16.0, Squid 3.5.19)">joni.kahara at gmail.com
       </A><BR>
    <I>Thu Jun  9 15:48:53 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010984.html">[squid-users] squid-3.5.19 crash(Segment Violation)
</A></li>
        <LI>Next message (by thread): <A HREF="010991.html">[squid-users] Unable to IPv6 DNAT &amp; intercept (Debian Stretch, Linux 3.16.0, Squid 3.5.19)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10985">[ date ]</a>
              <a href="thread.html#10985">[ thread ]</a>
              <a href="subject.html#10985">[ subject ]</a>
              <a href="author.html#10985">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello list,

I'm approaching you with a question regarding intercept proxying and IPv6.
I have a working IPv4 setup that redirects port 80 traffic to a port that
Squid is listening on:

    -A PREROUTING -s &lt;source-net&gt; -p tcp -m tcp --dport 80 -j REDIRECT
--to-ports &lt;squid-port&gt;

When I try to duplicate this behaviour on IPv6 side, it does not work. This
does not seem to be an ACL issue as the symptoms are the same even with an
all-allowing ACL, and because I'm unable to get even an &quot;access denied&quot;
error from Squid. I can reach the IPv6 Squid port by accessing it directly
from the local machine.

Also, if the REDIRECT is changed to a DNAT, the behaviour is identical
(i.e. not working):

    -A PREROUTING -s &lt;source-net&gt; -p tcp -m tcp --dport 80 -j DNAT
--to-destination [&lt;squid-ip&gt;]:&lt;squid-port&gt;

By looking at ip6tables packet counters and tcpdump I have come to a
conclusion that a SYN packet hits the REDIRECT rule, but even if it ever
reaches Squid, it looks as if Squid is ignoring it and not returning
anything. Enabling debug sections 5 and 89 show nothing in cache.log while
the connection establishment is supposed to be happening. While trying to
figure out what is going on, I also tried the following in an attempt to
rule out e.g. firewall restrictions causing the failure (this works, TCP
handshake occurs and a web page is returned):

    -A PREROUTING -s &lt;source-net&gt; -p tcp -m tcp --dport 80 -j DNAT
--to-destination [&lt;external-ip&gt;]:80

Does anyone here have experience with anything resembling the above? Any
advice would be appreciated.


    Joni
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160609/14287e43/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160609/14287e43/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010984.html">[squid-users] squid-3.5.19 crash(Segment Violation)
</A></li>
	<LI>Next message (by thread): <A HREF="010991.html">[squid-users] Unable to IPv6 DNAT &amp; intercept (Debian Stretch, Linux 3.16.0, Squid 3.5.19)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10985">[ date ]</a>
              <a href="thread.html#10985">[ thread ]</a>
              <a href="subject.html#10985">[ subject ]</a>
              <a href="author.html#10985">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
