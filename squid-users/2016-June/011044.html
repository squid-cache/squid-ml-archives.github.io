<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid not allowing HTTPS access
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20not%20allowing%20HTTPS%20access&In-Reply-To=%3COFBCDC9673.C1AAE7FA-ON80257FD3.0033F968-80257FD3.003466A6%40tcs.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011040.html">
   <LINK REL="Next"  HREF="011028.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid not allowing HTTPS access</H1>
    <B>Nilesh Gavali</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20not%20allowing%20HTTPS%20access&In-Reply-To=%3COFBCDC9673.C1AAE7FA-ON80257FD3.0033F968-80257FD3.003466A6%40tcs.com%3E"
       TITLE="[squid-users] Squid not allowing HTTPS access">nilesh.gavali at tcs.com
       </A><BR>
    <I>Wed Jun 15 09:32:24 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011040.html">[squid-users] Squid not allowing HTTPS access
</A></li>
        <LI>Next message (by thread): <A HREF="011028.html">[squid-users] Excessive TCP memory usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11044">[ date ]</a>
              <a href="thread.html#11044">[ thread ]</a>
              <a href="subject.html#11044">[ subject ]</a>
              <a href="author.html#11044">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Amos for update. I tried the same as explain by you in earlier 
reply.
but after this, Proxy response degraded like anything. also HTTPS site are 
not opening. So reverted back to the solution given by Eliezer.
 
Next, I want to restrict the URL access based on AD OU membership for 
users, can you quickly help me with some starting points.

regards;
Nilesh Gavali





From:   <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-request at lists.squid-cache.org</A>
To:     <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Date:   14/06/2016 18:37
Subject:        squid-users Digest, Vol 22, Issue 66
Sent by:        &quot;squid-users&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt;



Send squid-users mailing list submissions to
                 <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>

To subscribe or unsubscribe via the World Wide Web, visit
                 <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
or, via email, send a message with subject or body 'help' to
                 <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-request at lists.squid-cache.org</A>

You can reach the person managing the list at
                 <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-owner at lists.squid-cache.org</A>

When replying, please edit your Subject line so it is more specific
than &quot;Re: Contents of squid-users digest...&quot;


Today's Topics:

   1. Re: Squid not allowing HTTPS access (Amos Jeffries)
   2. Squid not allowing HTTPS access (Nilesh Gavali)


----------------------------------------------------------------------

Message: 1
Date: Wed, 15 Jun 2016 05:13:41 +1200
From: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Squid not allowing HTTPS access
Message-ID: &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">84e6c6e1-2a1a-6502-2f34-f1a2aa29f89d at treenet.co.nz</A>&gt;
Content-Type: text/plain; charset=utf-8

On 15/06/2016 4:59 a.m., Eliezer Croitoru wrote:
&gt;<i> Hey,
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> The issue is that CONNECT request can be passed only directly to the 
</I>origin
&gt;<i> server on 3.1.
</I>&gt;<i> Try to add:
</I>&gt;<i> never_direct allow all
</I>&gt;<i> 
</I>
Not quite. CONNECT is a type of message that makes no sense sending
through another proxy if its able to go direct.


So while the never_direct rule above will make it go through the peer.
It will also make everything go through the peer, always. If the peer
goes down traffic stops going anywhere.
  If you want that, then fine above is fine.


An alternative which leaves DIRECT, but only as a backup when the peer
is down is to configure:

 nonhierarchical_direct off
 prefer_direct on


Amos



------------------------------

Message: 2
Date: Tue, 14 Jun 2016 18:36:46 +0100
From: Nilesh Gavali &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">nilesh.gavali at tcs.com</A>&gt;
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [squid-users] Squid not allowing HTTPS access
Message-ID:
 &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">OF1029EE48.A3374641-ON80257FD2.0060A8E1-80257FD2.0060BEB3 at tcs.com</A>&gt;
Content-Type: text/plain; charset=&quot;utf-8&quot;

Hello Eliezer;

Many Thanks, It work for me on 3.1.10

Thanks &amp; Regards
Nilesh Gavali



From:   Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;
To:     'Nilesh Gavali' &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">nilesh.gavali at tcs.com</A>&gt;, 
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">Antony.Stone at squid.open.source.it</A>
Date:   14/06/2016 18:00
Subject:        RE: [squid-users] Squid not allowing HTTPS access



Hey,
 
The issue is that CONNECT request can be passed only directly to the 
origin server on 3.1.
Try to add:
never_direct allow all
 
To your squid.conf and see if it works.
I do not remember if it works for all versions.
 
Eliezer
 
----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>

 
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On 
Behalf Of Nilesh Gavali
Sent: Tuesday, June 14, 2016 4:43 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">Antony.Stone at squid.open.source.it</A>
Subject: [squid-users] Squid not allowing HTTPS access
 
Hello Antony; 
I have setup like below :- 

end user &gt;&gt; LinuxProxy(3.1.10) &gt;&gt; External Proxy(3.4)&gt;&gt; Internet 
when we configure external proxy ip in end user's IE, all HTTP &amp; HTTPS 
site work properly. 
when we configure Linux proxy ip in end user's IE, HTTP works fine but 
none of the HTTPS site open. 
when we access https site from LinuxProxy, below logs are appearing in 
access.log 
        TCP_DENIED/407 CONNECT sitename:443 -  NONE/ text/html 
        TCP_MISS/503 0 CONNECT sitename:443 <A HREF="https://lists.squid-cache.org/listinfo/squid-users">username at MYDOMAIN.COM</A> DIRECT / 

- - 
        TCP_MISS/200 23456 GET <A HREF="http://www.anysite.com">http://www.anysite.com</A> 
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">username at MYDOMAIN.COM</A>         DEFAULT_PARENT/10.10.x.x text/html 


what I making out from log is ( I might be wrong) - HTTPS request are 
going directly instead . 

attached is my Linux Proxy config- 

================= 
# 
# Recommended minimum configuration: 
# 

#auth_param negotiate program /usr/lib64/squid/squid_kerb_auth -d -s 
GSS_C_NO_NAME 
auth_param negotiate program /usr/lib64/squid/squid_kerb_auth -s 
HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy02.abcd.com at ABCD.COM</A> -d 
auth_param negotiate children 10 
auth_param negotiate keep_alive on 
auth_param basic credentialsttl 2 hours 
acl ad_auth proxy_auth REQUIRED 

acl manager proto cache_object 
acl localhost src 127.0.0.1/32 ::1 
acl to_localhost dst 127.0.0.0/8 0.0.0.0/32 ::1 

# Example rule allowing access from your local networks. 
# Adapt to list your (internal) IP networks from where browsing 
# should be allowed 
acl localnet src 10.0.0.0/8        # RFC1918 possible internal network 
acl localnet src 172.16.0.0/12        # RFC1918 possible internal network 
acl localnet src 192.168.0.0/16        # RFC1918 possible internal network 


acl localnet src fc00::/7       # RFC 4193 local private network range 
acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged) 
machines 

acl SSL_ports port 443 
acl Safe_ports port 80                # http 
acl Safe_ports port 21                # ftp 
acl Safe_ports port 443                # https 
acl Safe_ports port 70                # gopher 
acl Safe_ports port 210                # wais 
acl Safe_ports port 1025-65535        # unregistered ports 
acl Safe_ports port 280                # http-mgmt 
acl Safe_ports port 488                # gss-http 
acl Safe_ports port 591                # filemaker 
acl Safe_ports port 777                # multiling http 
acl CONNECT method CONNECT 

# 
# Recommended minimum Access Permission configuration: 
# 
# Only allow cachemgr access from localhost 
http_access allow manager localhost 
http_access deny manager 

# Deny requests to certain unsafe ports 
http_access deny !Safe_ports 

# Deny CONNECT to other than secure SSL ports 
http_access deny CONNECT !SSL_ports 

# We strongly recommend the following be uncommented to protect innocent 
# web applications running on the proxy server who think the only 
# one who can access services on &quot;localhost&quot; is a local user 
#http_access deny to_localhost 

# 
# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS 
# 
# 
# Example rule allowing access from your local networks. 
# Adapt localnet in the ACL section to list your (internal) IP networks 
# from where browsing should be allowed 
#http_access allow localnet 
#http_access allow localhost 
http_access deny !ad_auth 
http_access allow ad_auth 


# And finally deny all other access to this proxy 
http_access deny all 

# Squid normally listens to port 3128 
http_port 8080 

cache_peer xx.xx.2.108 parent 8080 0 default 
#dns_nameservers ABCDNS.ABCD.COM 
dns_nameservers xx.xx.2.108 

# We recommend you to use at least the following line. 
#hierarchy_stoplist cgi-bin ? 

# Uncomment and adjust the following to add a disk cache directory. 
cache_dir ufs /var/spool/squid 2048 16 256 

# Leave coredumps in the first cache dir 
coredump_dir /var/spool/squid 
# Log forwarding to SysLog 
access_log syslog:local1.info 

# Add any of your own refresh_pattern entries above these. 
refresh_pattern ^ftp:                1440        20%        10080 
refresh_pattern ^gopher:        1440        0%        1440 
refresh_pattern -i (/cgi-bin/|\?) 0        0%        0 
refresh_pattern .                0        20%        4320 
-====================================== 


Thanks &amp; Regards
Nilesh Suresh Gavali
Tata Consultancy Services
3rd Floor, Tithebarn House
Tithebarn Street
Liverpool - L2 2NZ
United Kingdom
Mailto: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">nilesh.gavali at tcs.com</A>
Website: <A HREF="http://www.tcs.com">http://www.tcs.com</A>
____________________________________________
Experience certainty.        IT Services
                       Business Solutions
                       Consulting
____________________________________________

Tata Consultancy Services Limited , incorporated  with limited liability 
and registered with Registrar of Companies, Mumbai, India - No: 11-84781
HQ : Nirmal Building , 9th Floor, Nariman Point, Mumbai - 400 021, India - 

 Registered  in UK : 18 Grosvenor Place, London SW1X 7HS - BR :007627

----- Forwarded by Nilesh Gavali/MUM/TCS on 14/06/2016 14:41 ----- 

From:        Nilesh Gavali/MUM/TCS 
To:        <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> 
Date:        13/06/2016 14:00 
Subject:        Squid not allowing HTTPS access 




Hello All; 
Facing issue while accessing HTTPS via squid, normal http traffic working 
fine. I have squid 3.1.10 on RHEL.6.0 

attached is my squid .conf for your reference,..help will be much 
appreciated. 



Thanks &amp; Regards
Nilesh Suresh Gavali
=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;
<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160614/f175dc50/attachment.html">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160614/f175dc50/attachment.html</A>
&gt;<i>
</I>-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 11307 bytes
Desc: not available
URL: &lt;
<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160614/f175dc50/attachment.png">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160614/f175dc50/attachment.png</A>
&gt;<i>
</I>
------------------------------

Subject: Digest Footer

_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


------------------------------

End of squid-users Digest, Vol 22, Issue 66
*******************************************

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160615/e2074ec1/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160615/e2074ec1/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011040.html">[squid-users] Squid not allowing HTTPS access
</A></li>
	<LI>Next message (by thread): <A HREF="011028.html">[squid-users] Excessive TCP memory usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11044">[ date ]</a>
              <a href="thread.html#11044">[ thread ]</a>
              <a href="subject.html#11044">[ subject ]</a>
              <a href="author.html#11044">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
