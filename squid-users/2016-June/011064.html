<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] URL access based on AD group membership
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20URL%20access%20based%20on%20AD%20group%20membership&In-Reply-To=%3COF00EEB6B5.2CF01D59-ON80257FD4.00312616-80257FD4.00313974%40tcs.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011059.html">
   <LINK REL="Next"  HREF="011067.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] URL access based on AD group membership</H1>
    <B>Nilesh Gavali</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20URL%20access%20based%20on%20AD%20group%20membership&In-Reply-To=%3COF00EEB6B5.2CF01D59-ON80257FD4.00312616-80257FD4.00313974%40tcs.com%3E"
       TITLE="[squid-users] URL access based on AD group membership">nilesh.gavali at tcs.com
       </A><BR>
    <I>Thu Jun 16 08:57:43 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011059.html">[squid-users] URL access based on AD group membership
</A></li>
        <LI>Next message (by thread): <A HREF="011067.html">[squid-users] URL access based on AD group membership
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11064">[ date ]</a>
              <a href="thread.html#11064">[ thread ]</a>
              <a href="subject.html#11064">[ subject ]</a>
              <a href="author.html#11064">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Team/Amos;
can you pls...awaiting reply

Thanks &amp; Regards
Nilesh Suresh Gavali




From:   Nilesh Gavali/MUM/TCS
To:     <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>
Date:   15/06/2016 20:14
Subject:        URL access based on AD group membership


Thanks Amos, for reply;
My squid and AD kerberos authentication working as expected. users are 
getting authenticated and able to access internet via proxy. access logs 
also capturing user account details.

now I need to restrict user access based on AD group membership. 


Thanks &amp; Regards
Nilesh Suresh Gavali





From:   <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-request at lists.squid-cache.org</A>
To:     <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Date:   15/06/2016 18:27
Subject:        squid-users Digest, Vol 22, Issue 70
Sent by:        &quot;squid-users&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt;



Send squid-users mailing list submissions to
                 <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>

To subscribe or unsubscribe via the World Wide Web, visit
                 <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
or, via email, send a message with subject or body 'help' to
                 <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-request at lists.squid-cache.org</A>

You can reach the person managing the list at
                 <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-owner at lists.squid-cache.org</A>

When replying, please edit your Subject line so it is more specific
than &quot;Re: Contents of squid-users digest...&quot;


Today's Topics:

   1. Re: HTTPS issues with squidguard after upgrading from squid
      2.7 to 3.5 (Marcus Kool)
   2. URL access based on AD group membership (<A HREF="https://lists.squid-cache.org/listinfo/squid-users">nilesh.gavali at tcs.com</A>)
   3. Re: URL access based on AD group membership (Amos Jeffries)
   4. Re: Queue incoming requests when fetching from origin
      (Alex Rousskov)
   5. Re: URL access based on AD group membership
      (Bruno de Paula Larini)


----------------------------------------------------------------------

Message: 1
Date: Wed, 15 Jun 2016 09:37:40 -0300
From: Marcus Kool &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">marcus.kool at urlfilterdb.com</A>&gt;
To: reqman &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">reqman at freemail.gr</A>&gt;
Cc: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] HTTPS issues with squidguard after
                 upgrading from squid 2.7 to 3.5
Message-ID: &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">57614C14.4010002 at urlfilterdb.com</A>&gt;
Content-Type: text/plain; charset=utf-8; format=flowed



On 06/15/2016 08:24 AM, reqman wrote:

&gt;<i> I have been using squidGuard for 10+ years. Not the best one could
</I>&gt;<i> have, but I am accustomed to its use and idiosyncrasies. Furthermore,
</I>&gt;<i> it is package well supported on FreeBSD.
</I>&gt;<i>
</I>&gt;<i> You are mentioning ufdbGuard. Are its lists free for government use?
</I>&gt;<i> If not, then I can not use it, since we have very strict purchasing
</I>&gt;<i> requirements, even if it costs $1. And of course, I would have to go
</I>&gt;<i> through evaluation, the usual learning curve etc.
</I>
ufdbGard is free software.
You can use it with any database you desire...  the free ones, your own or
a commercial one.

There is little learning curve since it is a fork of squidguard and there
is a Reference Manual and email support from URLfilterDB, even for those
who use a free database.

Marcus


&gt;<i> Don't get me wrong here, I'm not saying no. I'm just saying that even
</I>&gt;<i> though it seems to be easy to say &quot;yes&quot;, reality is much different.
</I>&gt;<i>
</I>&gt;<i> M.-
</I>

------------------------------

Message: 2
Date: Wed, 15 Jun 2016 14:50:38 +0100
From: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">nilesh.gavali at tcs.com</A>
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [squid-users] URL access based on AD group membership
Message-ID:
 &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">OF29EE7DFD.2BD1A317-ON80257FD3.004390E8-80257FD3.004C0BDD at tcs.com</A>&gt;
Content-Type: text/plain; charset=&quot;utf-8&quot;

Hi Team;
I have setup as below-
Squid Kerberos authentication with windows AD 2012r2. - works fine.
Now need to restrict access based on AD Group membership.

Below configuration done but no luck. when try to access with user who is 
not part of the group mention, still he is able to browse Internet.

================================
#
# Recommended minimum configuration:
#

#auth_param negotiate program /usr/lib64/squid/squid_kerb_auth -d -s 
GSS_C_NO_NAME
auth_param negotiate program /usr/lib64/squid/squid_kerb_auth -s 
HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy02.abcd.co.uk at abcd.co.uk</A> -d
auth_param negotiate children 10
auth_param negotiate keep_alive on
auth_param basic credentialsttl 2 hours
acl ad_auth proxy_auth REQUIRED

external_acl_type Domain_Admin %LOGIN /usr/lib64/squid/squid_ldap_group -b 

&quot;dc=abcd,dc=co,dc=uk&quot; -D &quot;cn=Nilesh Gavali,ou=Admin User,ou=TCS 
Users,ou=Staff,dc=abcd,dc=co,dc=uk&quot; -w &quot;123456&quot; -f 
&quot;(&amp;(objectclass=person)(sAMAccountName=%v)(memberof=cn=lgInternetAccess,ou=Internet 

Access,ou=Groups,dc=abcd,dc=co,dc=uk))&quot; -h xx.xx.2.101
acl AllowDomainAdmin external Domain_Admin lgInternetAccess

acl manager proto cache_object
acl localhost src 127.0.0.1/32 ::1
acl to_localhost dst 127.0.0.0/8 0.0.0.0/32 ::1

# Example rule allowing access from your local networks.
# Adapt to list your (internal) IP networks from where browsing
# should be allowed
acl localnet src 10.0.0.0/8     # RFC1918 possible internal network
acl localnet src 172.16.0.0/12  # RFC1918 possible internal network
acl localnet src 192.168.0.0/16 # RFC1918 possible internal network
acl localnet src fc00::/7       # RFC 4193 local private network range
acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged) 
machines

acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl CONNECT method CONNECT

#
# Recommended minimum Access Permission configuration:
#
# Only allow cachemgr access from localhost
http_access allow manager localhost
http_access deny manager

# Deny requests to certain unsafe ports
http_access deny !Safe_ports

# Deny CONNECT to other than secure SSL ports
http_access deny CONNECT !SSL_ports


# We strongly recommend the following be uncommented to protect innocent
# web applications running on the proxy server who think the only
# one who can access services on &quot;localhost&quot; is a local user
#http_access deny to_localhost

#
# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
#
#
# Example rule allowing access from your local networks.
# Adapt localnet in the ACL section to list your (internal) IP networks
# from where browsing should be allowed
#http_access allow localnet
#http_access allow localhost
http_access deny !ad_auth
http_access allow ad_auth
http_access deny !AllowDomainAdmin
http_access allow AllowDomainAdmin

# And finally deny all other access to this proxy
http_access deny all

# Squid normally listens to port 3128
http_port 8080
never_direct allow all

cache_peer xx.xx.2.108 parent 8080 0 default
dns_nameservers xx.xx.2.108

# We recommend you to use at least the following line.
#hierarchy_stoplist cgi-bin ?

# Uncomment and adjust the following to add a disk cache directory.
cache_dir ufs /var/spool/squid 2048 16 256

# Leave coredumps in the first cache dir
coredump_dir /var/spool/squid

# Log forwarding to SysLog
access_log syslog:local1.info

# Add any of your own refresh_pattern entries above these.
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320
=================================================



Thanks &amp; Regards
Nilesh Suresh Gavali
=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;
<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160615/a91ac994/attachment-0001.html">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160615/a91ac994/attachment-0001.html</A>
&gt;<i>
</I>
------------------------------

Message: 3
Date: Thu, 16 Jun 2016 02:21:54 +1200
From: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] URL access based on AD group membership
Message-ID: &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">f7557bf2-bae0-e661-8368-6f4497454c89 at treenet.co.nz</A>&gt;
Content-Type: text/plain; charset=utf-8

On 16/06/2016 1:50 a.m., nilesh.gavali wrote:
&gt;<i> Hi Team;
</I>&gt;<i> I have setup as below-
</I>&gt;<i> Squid Kerberos authentication with windows AD 2012r2. - works fine.
</I>&gt;<i> Now need to restrict access based on AD Group membership.
</I>&gt;<i> 
</I>&gt;<i> Below configuration done but no luck. when try to access with user who 
</I>is 
&gt;<i> not part of the group mention, still he is able to browse Internet.
</I>&gt;<i> 
</I>
This is because:

&lt;snip&gt;
Step 0) check the basic security rules that deny bad behaviour.

&gt;<i>
</I>&gt;<i> http_access deny !ad_auth
</I>
Step 1) deny with a &quot;require authentication&quot; message if there are no
valid credentials sent.

&gt;<i> http_access allow ad_auth
</I>
Step 2) allow anyone who has valid credentials to use the proxy.

... Uh, Stop.

Users either sent valid credentials [2 happened] or they did not [1
happened]. There are no other possibilities.


&gt;<i> http_access deny !AllowDomainAdmin
</I>&gt;<i> http_access allow AllowDomainAdmin
</I>&gt;<i> 
</I>
As explained in the FAQ
&lt;<A HREF="http://wiki.squid-cache.org/SquidFaq/SquidAcl#Access_Lists">http://wiki.squid-cache.org/SquidFaq/SquidAcl#Access_Lists</A>&gt;

Amos



------------------------------

Message: 4
Date: Wed, 15 Jun 2016 09:19:52 -0600
From: Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;
To: Jaap Dam &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">jaap.dam at gmail.com</A>&gt;, Amos Jeffries
                 &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
Cc: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Queue incoming requests when fetching from
                 origin
Message-ID: &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">57617218.5050802 at measurement-factory.com</A>&gt;
Content-Type: text/plain; charset=utf-8

On 06/14/2016 02:51 AM, Jaap Dam wrote:

&gt;<i> I've part of the logging as an attachment. I'm requesting a single URL
</I>&gt;<i> in this log. The log starts with a stale cache of the item. 
</I>
Collapsed forwarding does not apply to cache revalidation requests yet.
Factory is working on implementing collapsed revalidations (in some
environments), but I cannot promise a specific delivery date or that
your particular environment will be covered.

Alex.




&gt;<i> 2016-06-13 15:34 GMT+02:00 Amos Jeffries:
</I>&gt;<i> 
</I>&gt;<i>     On 14/06/2016 12:29 a.m., Jaap Dam wrote:
</I>&gt;<i>     &gt; Is the collapsed_forwarding directive the correct one to use for 
</I>my
&gt;<i>     &gt; use-case or am i missing something?
</I>&gt;<i> 
</I>&gt;<i>     Yes it is correct so far as I am understanding your need.
</I>&gt;<i> 
</I>&gt;<i>     For further debugging about what is going on you will need the HTTP
</I>&gt;<i>     messages involved. Add the directive &quot;debug_options 11,2 20,3&quot; to 
</I>your
&gt;<i>     config to get them logged in cache.log.
</I>


------------------------------

Message: 5
Date: Wed, 15 Jun 2016 14:27:14 -0300
From: Bruno de Paula Larini &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">bruno.larini at riosoft.com.br</A>&gt;
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] URL access based on AD group membership
Message-ID: &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eb67a218-c749-aa16-4b00-941bdac1d0a5 at riosoft.com.br</A>&gt;
Content-Type: text/plain; charset=&quot;utf-8&quot;; Format=&quot;flowed&quot;

Em 15/06/2016 10:50, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">nilesh.gavali at tcs.com</A> escreveu:
&gt;<i> Hi Team;
</I>&gt;<i> I have setup as below-
</I>&gt;<i>
</I>&gt;<i>   * Squid Kerberos authentication with windows AD 2012r2. - works fine.
</I>&gt;<i>   * Now need to restrict access based on AD Group membership.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Below configuration done but no luck. when try to access with user who 
</I>&gt;<i> is not part of the group mention, still he is able to browse Internet.
</I>
The following works fine for me and in my opinion works better than 
LDAP. The authentication is integrated, so it doesn't keep asking for 
password (when the current user is a domain account). But you have to 
add the Squid server to the domain using 'smb.conf', 'krb5.conf' and 
then 'net ads join'. The service 'winbind' must be running too.
I'm using Squid 3.5.19.


     auth_param ntlm program /usr/bin/ntlm_auth 
--helper-protocol=squid-2.5-ntlmssp --domain=MYDOMAIN 
--enable-external-acl-helpers=&quot;ext_wbinfo_group_acl&quot;
     auth_param ntlm children 10 startup=0 idle=2

     external_acl_type NTGroup children-startup=10 children-idle=2 
children-max=50 %LOGIN /usr/lib64/squid/ext_wbinfo_group_acl

     acl authenticated proxy_auth REQUIRED

     acl ad_group external NTGroup MYDOMAIN\AD_Group
     acl denied_websites dstdom_regex -i &quot;/etc/squid/denied-websites.txt&quot;
     http_access deny ad_group denied_websites


So all the members of MYDOMAIN\AD_Group won't have access to whatever 
the file contains.

Bruno
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;
<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160615/810a3d96/attachment.html">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160615/810a3d96/attachment.html</A>
&gt;<i>
</I>
------------------------------

Subject: Digest Footer

_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


------------------------------

End of squid-users Digest, Vol 22, Issue 70
*******************************************

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160616/a1843db1/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160616/a1843db1/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011059.html">[squid-users] URL access based on AD group membership
</A></li>
	<LI>Next message (by thread): <A HREF="011067.html">[squid-users] URL access based on AD group membership
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11064">[ date ]</a>
              <a href="thread.html#11064">[ thread ]</a>
              <a href="subject.html#11064">[ subject ]</a>
              <a href="author.html#11064">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
