<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Queue incoming requests when fetching from origin
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Queue%20incoming%20requests%20when%20fetching%20from%20origin&In-Reply-To=%3C5762C3D5.3070000%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011062.html">
   <LINK REL="Next"  HREF="011087.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Queue incoming requests when fetching from origin</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Queue%20incoming%20requests%20when%20fetching%20from%20origin&In-Reply-To=%3C5762C3D5.3070000%40measurement-factory.com%3E"
       TITLE="[squid-users] Queue incoming requests when fetching from origin">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Jun 16 15:20:53 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011062.html">[squid-users] Queue incoming requests when fetching from origin
</A></li>
        <LI>Next message (by thread): <A HREF="011087.html">[squid-users] Queue incoming requests when fetching from origin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11069">[ date ]</a>
              <a href="thread.html#11069">[ thread ]</a>
              <a href="subject.html#11069">[ subject ]</a>
              <a href="author.html#11069">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 06/16/2016 01:45 AM, Jaap Dam wrote:

&gt;<i> Thanks for the information. Could you elaborate on when collapsed
</I>&gt;<i> forwarding does apply?
</I>
Squid is currently able to collapse HTTP client [miss] requests (but not
internally generated HTTP requests triggered by HTTP client requests).
Furthermore, to be collapsable, the request must have no markings that
make the future response uncachable.


&gt;<i> With your extra information, my assumption would
</I>&gt;<i> be that it only applies on requests of a resource that has never been
</I>&gt;<i> cached before.
</I>
I would not phrase it like that because Squid does not remember was has
been cached before, only what is still cached at the query time. There
are three primary cases for an HTTP client request to consider here:

* pure cache hit: Collapsing is inapplicable because Squid does not send
any requests (there is nothing to collapse). Each HTTP client request is
satisfied from the Squid cache.

* pure cache miss: Multiple requests for the same missing object can be
collapsed if collapsed_forwarding is enabled. Collapsable requests have
no markings that make the future response uncachable.

* revalidation: The requested object was found in the cache but it was
stale. Squid sends an internal &quot;revalidation&quot; request to the origin
server or peer. These internal requests are currently not collapsed. We
are working on collapsing them as well.


&gt;<i> Secondly would you have a suggestion for solving the issue I'm facing?
</I>

I have not studied the issue you are facing, but if you think collapsing
revalidation requests would solve your problem, then either wait for us
to finish initial collapsed revalidation support (and then see if it
solves your problem) or co-sponsor that ongoing development (to make
sure it solves your problem).


HTH,

Alex.



&gt;<i> 2016-06-15 17:19 GMT+02:00 Alex Rousskov:
</I>&gt;<i> 
</I>&gt;<i>     On 06/14/2016 02:51 AM, Jaap Dam wrote:
</I>&gt;<i> 
</I>&gt;<i>     &gt; I've part of the logging as an attachment. I'm requesting a single URL
</I>&gt;<i>     &gt; in this log. The log starts with a stale cache of the item.
</I>&gt;<i> 
</I>&gt;<i>     Collapsed forwarding does not apply to cache revalidation requests yet.
</I>&gt;<i>     Factory is working on implementing collapsed revalidations (in some
</I>&gt;<i>     environments), but I cannot promise a specific delivery date or that
</I>&gt;<i>     your particular environment will be covered.
</I>&gt;<i> 
</I>&gt;<i>     Alex.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     &gt; 2016-06-13 15:34 GMT+02:00 Amos Jeffries:
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;     On 14/06/2016 12:29 a.m., Jaap Dam wrote:
</I>&gt;<i>     &gt;     &gt; Is the collapsed_forwarding directive the correct one to use
</I>&gt;<i>     for my
</I>&gt;<i>     &gt;     &gt; use-case or am i missing something?
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;     Yes it is correct so far as I am understanding your need.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt;     For further debugging about what is going on you will need the
</I>&gt;<i>     HTTP
</I>&gt;<i>     &gt;     messages involved. Add the directive &quot;debug_options 11,2 20,3&quot;
</I>&gt;<i>     to your
</I>&gt;<i>     &gt;     config to get them logged in cache.log.
</I>&gt;<i> 
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011062.html">[squid-users] Queue incoming requests when fetching from origin
</A></li>
	<LI>Next message (by thread): <A HREF="011087.html">[squid-users] Queue incoming requests when fetching from origin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11069">[ date ]</a>
              <a href="thread.html#11069">[ thread ]</a>
              <a href="subject.html#11069">[ subject ]</a>
              <a href="author.html#11069">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
