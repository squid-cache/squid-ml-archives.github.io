<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Regex optimization
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Regex%20optimization&In-Reply-To=%3C330fe702-2bd8-e212-4f90-475191c5f7ec%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011085.html">
   <LINK REL="Next"  HREF="011078.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Regex optimization</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Regex%20optimization&In-Reply-To=%3C330fe702-2bd8-e212-4f90-475191c5f7ec%40treenet.co.nz%3E"
       TITLE="[squid-users] Regex optimization">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Jun 17 02:57:01 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011085.html">[squid-users] Regex optimization
</A></li>
        <LI>Next message (by thread): <A HREF="011078.html">[squid-users] SQUID and accessing https urls failing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11082">[ date ]</a>
              <a href="thread.html#11082">[ thread ]</a>
              <a href="subject.html#11082">[ subject ]</a>
              <a href="author.html#11082">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 27/04/2016 11:32 p.m., Alfredo Rezinovsky wrote:
&gt;<i> I saw in debug log that when an ACL has many regexes each one is compared
</I>&gt;<i> sequentially.
</I>&gt;<i> 
</I>&gt;<i> If I have
</I>&gt;<i> 
</I>&gt;<i> www.facebook.com
</I>&gt;<i> facebook.com
</I>&gt;<i> www.google.com
</I>&gt;<i> google.com
</I>&gt;<i> 
</I>&gt;<i> If will be faster to check just ONE optimized regex like
</I>&gt;<i> (www\.)?(facebook|google).com than the previous three?
</I>&gt;<i> 
</I>&gt;<i> I'm really talking about optimizing about 3000 url regexes in one huge
</I>&gt;<i> regex because comparing each and every url to 3000 regexes is too slow.
</I>&gt;<i> 
</I>&gt;<i> I know using
</I>&gt;<i> (www\.facebook\.com)|(facebook\.com)|(www\.google\.com)|(google\.com) with
</I>&gt;<i> PCRE will produce the same optimized result as
</I>&gt;<i> (www\.)?(facebook|google)\.com. Squid uses GnuRegex. Does GNURegex lib
</I>&gt;<i> optimizes this as well ?
</I>
1) It is kind of a myth that Squid uses GNURegex.

Squid *bundles* with a copy of GNURegex. For use on systems which do not
provide their own regex library.

Most of the time Squid uses the system -lregex. Which on some systems is
an updated version of GNURegex, sometimes is a Perl based library, and
others the PCRE library. On the latest OS the C++11 stdlib itself builds
in regex components, so those are possibly used as well.

AFAICT, the only system where the Squid bundled GNURegex library is
still actually used is Windows.


2) sort of. You are thinking it compacts down to a differnet textual
form. It does not.

All regex libraries compact the initial pattern down to a binary format
which is equivalent (but not the same) as the second pattern you wrote.
Squid uses the library API which does that compaction.

Current Squid versions will also load multiple sequential lines from
your config file and explicitly append them together. No need to do it
manually for regex ACLs.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011085.html">[squid-users] Regex optimization
</A></li>
	<LI>Next message (by thread): <A HREF="011078.html">[squid-users] SQUID and accessing https urls failing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11082">[ date ]</a>
              <a href="thread.html#11082">[ thread ]</a>
              <a href="subject.html#11082">[ subject ]</a>
              <a href="author.html#11082">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
