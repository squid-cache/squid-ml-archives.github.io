<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] dead gateway, not dead peer..
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20dead%20gateway%2C%20not%20dead%20peer..&In-Reply-To=%3C52b9139f-a4cc-c5a9-2c47-b663c18a9737%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011134.html">
   <LINK REL="Next"  HREF="011147.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] dead gateway, not dead peer..</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20dead%20gateway%2C%20not%20dead%20peer..&In-Reply-To=%3C52b9139f-a4cc-c5a9-2c47-b663c18a9737%40treenet.co.nz%3E"
       TITLE="[squid-users] dead gateway, not dead peer..">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Jun 22 04:46:33 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011134.html">[squid-users] dead gateway, not dead peer..
</A></li>
        <LI>Next message (by thread): <A HREF="011147.html">[squid-users] dead gateway, not dead peer..
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11138">[ date ]</a>
              <a href="thread.html#11138">[ thread ]</a>
              <a href="subject.html#11138">[ subject ]</a>
              <a href="author.html#11138">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 22/06/2016 7:12 a.m., B. Cook wrote:
&gt;<i> On Tue, Jun 21, 2016 at 3:18 AM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So you're trolling. The FAQ it is then:
</I>&gt;&gt;<i>  &lt;<A HREF="http://wiki.squid-cache.org/Features/CacheHierarchy">http://wiki.squid-cache.org/Features/CacheHierarchy</A>&gt;
</I>&gt;&gt;<i>  &lt;<A HREF="http://wiki.squid-cache.org/Features/LoadBalance">http://wiki.squid-cache.org/Features/LoadBalance</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i> &#8203;Thank you the response..
</I>&gt;<i> 
</I>&gt;<i> squid.conf (3.5.19 debian host 192.168.10.115)
</I>&gt;<i> cache_peer 10.20.12.144 parent 3128 0 no-digest no-netdb-exchange
</I>&gt;<i> proxy-only
</I>&gt;<i> cache_peer 10.20.12.194 parent 3128 0 no-digest no-netdb-exchange
</I>&gt;<i> proxy-only
</I>&gt;<i> cache_peer 10.20.32.99 parent 3128 0 no-digest no-netdb-exchange proxy-only
</I>&gt;<i> default
</I>&gt;<i> prefer_direct off
</I>&gt;<i> nonhierarchical_direct off
</I>&gt;<i> 
</I>&gt;<i> Turing off squid on host 10.20.12.144 immediately got 10.115 to pass
</I>&gt;<i> connections over to 12.194 (great) as denoted in the logs below..
</I>&gt;<i> 
</I>&gt;<i> &#8203;2016/06/21 15:02:16 kid1| TCP connection to 10.20.12.144/3128 failed
</I>&gt;<i> 2016/06/21 15:02:16 kid1| TCP connection to 10.20.12.144/3128 failed
</I>&gt;<i> 2016/06/21 15:02:24 kid1| TCP connection to 10.20.12.144/3128 failed
</I>&gt;<i> 2016/06/21 15:02:24 kid1| TCP connection to 10.20.12.144/3128 failed
</I>&gt;<i> 2016/06/21 15:02:24 kid1| TCP connection to 10.20.12.144/3128 failed
</I>&gt;<i> 2016/06/21 15:02:24 kid1| TCP connection to 10.20.12.144/3128 failed
</I>&gt;<i> 2016/06/21 15:02:24 kid1| TCP connection to 10.20.12.144/3128 failed
</I>&gt;<i> 2016/06/21 15:02:24 kid1| TCP connection to 10.20.12.144/3128 failed
</I>&gt;<i> 2016/06/21 15:02:24 kid1| TCP connection to 10.20.12.144/3128 failed
</I>&gt;<i> 2016/06/21 15:02:24 kid1| TCP connection to 10.20.12.144/3128 failed
</I>&gt;<i> 2016/06/21 15:02:24 kid1| Detected DEAD Parent: 10.20.12.144
</I>&gt;<i> 2016/06/21 15:02:32 kid1| Detected REVIVED Parent: 10.20.12.144&#8203;
</I>&gt;<i> 
</I>&gt;<i> When I enabled squid on host 10.20.12.144 squid detected dead -&gt; revived
</I>&gt;<i> and passed traffic again.. (also great)..
</I>&gt;<i> 
</I>&gt;<i> but when host 10.20.12.144 loses it's gateway, the default route on 12.144
</I>&gt;<i> is dead.. traffic is still to 12.144.. squid didn't die, the process is
</I>&gt;<i> still running..
</I>&gt;<i> 
</I>&gt;<i> Nothing is detected and 12.194 is never contacted..
</I>&gt;<i> 
</I>&gt;<i> How do I get squid to detect that no valid data is being returned from
</I>&gt;<i> 12.144.. or am I missing something?
</I>
You have a router misconfiguration somewhere. Probably ICMP is not
working on your network. Which is causing connnections to hang for long
periods instead of failing over to the other peer.

Attempts by Squid to contact 12.144 when there is no way to route
traffic to it should be getting an ICMP &quot;no route to host&quot; error back.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011134.html">[squid-users] dead gateway, not dead peer..
</A></li>
	<LI>Next message (by thread): <A HREF="011147.html">[squid-users] dead gateway, not dead peer..
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11138">[ date ]</a>
              <a href="thread.html#11138">[ thread ]</a>
              <a href="subject.html#11138">[ subject ]</a>
              <a href="author.html#11138">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
