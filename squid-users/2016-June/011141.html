<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] cache_peer directive with SNI
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20cache_peer%20directive%20with%20SNI&In-Reply-To=%3Cf1316501-f300-8501-cd37-f521ca01aa77%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011212.html">
   <LINK REL="Next"  HREF="011142.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] cache_peer directive with SNI</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20cache_peer%20directive%20with%20SNI&In-Reply-To=%3Cf1316501-f300-8501-cd37-f521ca01aa77%40treenet.co.nz%3E"
       TITLE="[squid-users] cache_peer directive with SNI">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Jun 22 05:31:43 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011212.html">[squid-users] cache_peer directive with SNI
</A></li>
        <LI>Next message (by thread): <A HREF="011142.html">[squid-users] Forward loop when intercepting mode to proxy traffic	to local VM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11141">[ date ]</a>
              <a href="thread.html#11141">[ thread ]</a>
              <a href="subject.html#11141">[ subject ]</a>
              <a href="author.html#11141">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 22/06/2016 3:14 p.m., Kristopher Lalletti wrote:
&gt;<i> Hi All,
</I>&gt;<i> 
</I>&gt;<i> I'm replacing an Apache setup as a reverse-proxy with Squid v3.5, and
</I>&gt;<i> I've hit a small snag.
</I>&gt;<i> 
</I>&gt;<i> Basically, I need to tell squid to pass the proper SSL SNI name to
</I>&gt;<i> the backend webserver which is accessed via SSL, and naturally, the
</I>&gt;<i> SSL SNI service-name (service.foo.com) is not the server-hostname
</I>&gt;<i> (webserver1.foo.com), because I've got 3 servers providing for that
</I>&gt;<i> service-name.
</I>&gt;<i> 
</I>
You understanding of &quot;proper&quot; behaviour is not correct.

TLS is a point-to-point protocol.

For clients end-to-end and point-to-point are not distinguishable, so a
lot of misunderstanding exists. For a reverse-proxy / CDN the
distinction is critical for correct crytography.


That means the SNI (plus keys, ciphers and certificates etc) on the
connection between Squid and that origin peer are specifically and
exactly supposed to be the &quot;webserver1&quot; details. Because Squid is
talking to the Server Name(d) &quot;webserver1.foo.com&quot; not to itself.

 --&gt; the client will never see the the TLS details the origin sent to
Squid. They are private to the Squid&lt;-&gt;origin connection.


The SNI and crypto details between client and Squid is the only place
&quot;service.foo.com&quot; is proper in the TLS layer. Since outside your CDN /
reverse-proxy structure &quot;service.foo.com&quot; (aka Squid) is the Server Name.


Also be aware that the TLS details like SNI on the Squid&lt;-&gt;origin
connection have *nothing* to do with the HTTP layer messages. That
should continue to be Host:service.foo.com or whatever the client is
requesting in its HTTP (S) messages.

SNI is not equivalent to HTTP virtual hosting despite what some known
bugs in Apache may have led you to believe.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011212.html">[squid-users] cache_peer directive with SNI
</A></li>
	<LI>Next message (by thread): <A HREF="011142.html">[squid-users] Forward loop when intercepting mode to proxy traffic	to local VM
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11141">[ date ]</a>
              <a href="thread.html#11141">[ thread ]</a>
              <a href="subject.html#11141">[ subject ]</a>
              <a href="author.html#11141">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
