<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] dead gateway, not dead peer..
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20dead%20gateway%2C%20not%20dead%20peer..&In-Reply-To=%3CCAOyb_Ez6S3_m25SmGEwuE2%2BN9rUSjBiH6ec3X3S7AMwyopQQtQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011138.html">
   <LINK REL="Next"  HREF="011154.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] dead gateway, not dead peer..</H1>
    <B>B. Cook</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20dead%20gateway%2C%20not%20dead%20peer..&In-Reply-To=%3CCAOyb_Ez6S3_m25SmGEwuE2%2BN9rUSjBiH6ec3X3S7AMwyopQQtQ%40mail.gmail.com%3E"
       TITLE="[squid-users] dead gateway, not dead peer..">bcook at poughkeepsieschools.org
       </A><BR>
    <I>Wed Jun 22 13:25:06 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011138.html">[squid-users] dead gateway, not dead peer..
</A></li>
        <LI>Next message (by thread): <A HREF="011154.html">[squid-users] dead gateway, not dead peer..
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11147">[ date ]</a>
              <a href="thread.html#11147">[ thread ]</a>
              <a href="subject.html#11147">[ subject ]</a>
              <a href="author.html#11147">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&#8203;when the one of the proxies loses its internet connection.. the default
route is gone.  Not the route to the machine..

the 12.194 proxy then gives this message:

The following error was encountered while trying to retrieve the URL:
<A HREF="http://www.tmz.com/">http://www.tmz.com/</A>

Connection to 54.230.36.213 failed.

The system returned: (101) Network is unreachable

The remote host or network may be down. Please try the request again.&#8203;

12.194 can not get to 54.230.36.213 (tmz.com)..

I can still get to 12.194..

Squid is still running on 12.194, 12.194 has no gateway.. the Internet
connection FROM 12.194 TO the outside is dead and gone.

That is what I am trying to fix..

When a cache_peer has a connectivity problem..


On Wed, Jun 22, 2016 at 12:46 AM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
wrote:

&gt;<i> On 22/06/2016 7:12 a.m., B. Cook wrote:
</I>&gt;<i> &gt; On Tue, Jun 21, 2016 at 3:18 AM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; So you're trolling. The FAQ it is then:
</I>&gt;<i> &gt;&gt;  &lt;<A HREF="http://wiki.squid-cache.org/Features/CacheHierarchy">http://wiki.squid-cache.org/Features/CacheHierarchy</A>&gt;
</I>&gt;<i> &gt;&gt;  &lt;<A HREF="http://wiki.squid-cache.org/Features/LoadBalance">http://wiki.squid-cache.org/Features/LoadBalance</A>&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt; &#8203;Thank you the response..
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; squid.conf (3.5.19 debian host 192.168.10.115)
</I>&gt;<i> &gt; cache_peer 10.20.12.144 parent 3128 0 no-digest no-netdb-exchange
</I>&gt;<i> &gt; proxy-only
</I>&gt;<i> &gt; cache_peer 10.20.12.194 parent 3128 0 no-digest no-netdb-exchange
</I>&gt;<i> &gt; proxy-only
</I>&gt;<i> &gt; cache_peer 10.20.32.99 parent 3128 0 no-digest no-netdb-exchange
</I>&gt;<i> proxy-only
</I>&gt;<i> &gt; default
</I>&gt;<i> &gt; prefer_direct off
</I>&gt;<i> &gt; nonhierarchical_direct off
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Turing off squid on host 10.20.12.144 immediately got 10.115 to pass
</I>&gt;<i> &gt; connections over to 12.194 (great) as denoted in the logs below..
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &#8203;2016/06/21 15:02:16 kid1| TCP connection to 10.20.12.144/3128 failed
</I>&gt;<i> &gt; 2016/06/21 15:02:16 kid1| TCP connection to 10.20.12.144/3128 failed
</I>&gt;<i> &gt; 2016/06/21 15:02:24 kid1| TCP connection to 10.20.12.144/3128 failed
</I>&gt;<i> &gt; 2016/06/21 15:02:24 kid1| TCP connection to 10.20.12.144/3128 failed
</I>&gt;<i> &gt; 2016/06/21 15:02:24 kid1| TCP connection to 10.20.12.144/3128 failed
</I>&gt;<i> &gt; 2016/06/21 15:02:24 kid1| TCP connection to 10.20.12.144/3128 failed
</I>&gt;<i> &gt; 2016/06/21 15:02:24 kid1| TCP connection to 10.20.12.144/3128 failed
</I>&gt;<i> &gt; 2016/06/21 15:02:24 kid1| TCP connection to 10.20.12.144/3128 failed
</I>&gt;<i> &gt; 2016/06/21 15:02:24 kid1| TCP connection to 10.20.12.144/3128 failed
</I>&gt;<i> &gt; 2016/06/21 15:02:24 kid1| TCP connection to 10.20.12.144/3128 failed
</I>&gt;<i> &gt; 2016/06/21 15:02:24 kid1| Detected DEAD Parent: 10.20.12.144
</I>&gt;<i> &gt; 2016/06/21 15:02:32 kid1| Detected REVIVED Parent: 10.20.12.144&#8203;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; When I enabled squid on host 10.20.12.144 squid detected dead -&gt; revived
</I>&gt;<i> &gt; and passed traffic again.. (also great)..
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; but when host 10.20.12.144 loses it's gateway, the default route on
</I>&gt;<i> 12.144
</I>&gt;<i> &gt; is dead.. traffic is still to 12.144.. squid didn't die, the process is
</I>&gt;<i> &gt; still running..
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Nothing is detected and 12.194 is never contacted..
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; How do I get squid to detect that no valid data is being returned from
</I>&gt;<i> &gt; 12.144.. or am I missing something?
</I>&gt;<i>
</I>&gt;<i> You have a router misconfiguration somewhere. Probably ICMP is not
</I>&gt;<i> working on your network. Which is causing connnections to hang for long
</I>&gt;<i> periods instead of failing over to the other peer.
</I>&gt;<i>
</I>&gt;<i> Attempts by Squid to contact 12.144 when there is no way to route
</I>&gt;<i> traffic to it should be getting an ICMP &quot;no route to host&quot; error back.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>


-- 
Network Analyst
Poughkeepsie City School District
SMS &amp; Mobile: (202) 810-5827
twitter.com/bcookatpcsd

If you can't explain it simply, you don't understand it well enough.

-- 

This message may contain confidential information and is intended only for 
the individual(s) named. If you are not an intended recipient you are not 
authorized to disseminate, distribute or copy this e-mail. Please notify 
the sender immediately if you have received this e-mail by mistake and 
delete this e-mail from your system.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160622/72a1585b/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160622/72a1585b/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011138.html">[squid-users] dead gateway, not dead peer..
</A></li>
	<LI>Next message (by thread): <A HREF="011154.html">[squid-users] dead gateway, not dead peer..
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11147">[ date ]</a>
              <a href="thread.html#11147">[ thread ]</a>
              <a href="subject.html#11147">[ subject ]</a>
              <a href="author.html#11147">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
