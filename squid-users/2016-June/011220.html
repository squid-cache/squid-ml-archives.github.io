<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] flickr.com redirect error
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20flickr.com%20redirect%20error&In-Reply-To=%3CVI1PR04MB1359499FE2D9A57B3C0C33638F2E0%40VI1PR04MB1359.eurprd04.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011219.html">
   <LINK REL="Next"  HREF="011221.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] flickr.com redirect error</H1>
    <B>Rafael Akchurin</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20flickr.com%20redirect%20error&In-Reply-To=%3CVI1PR04MB1359499FE2D9A57B3C0C33638F2E0%40VI1PR04MB1359.eurprd04.prod.outlook.com%3E"
       TITLE="[squid-users] flickr.com redirect error">rafael.akchurin at diladele.com
       </A><BR>
    <I>Fri Jun 24 15:29:29 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011219.html">[squid-users] flickr.com redirect error
</A></li>
        <LI>Next message (by thread): <A HREF="011221.html">[squid-users] flickr.com redirect error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11220">[ date ]</a>
              <a href="thread.html#11220">[ thread ]</a>
              <a href="subject.html#11220">[ subject ]</a>
              <a href="author.html#11220">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Ozgur, Yuri,

I also see this error. Actually it is even present on videos.yahoo.com if I am not mistaken.
The reason for this is unclear for me (incorrect handling of &#8220;Via&#8221; header by some of back office servers of Yahoo???)

I was able to fix it by setting &#8220;via off&#8221; in squid.conf. I am not sure if this is the recommended way ( I presume not) and how to disable Via only for yahoo servers. Hopefully Amos has better answers.

Via looks like:

Via:&quot;http/1.1 fts110.flickr.bf1.yahoo.com (ApacheTrafficServer [cMs f ]), http/1.1 r02.ycpi.ams.yahoo.net (ApacheTrafficServer [cMsSf ]), 1.1 qlproxy (squid/3.3.8)&quot;

Best regards,
Rafael Akchurin
Diladele B.V.

From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Ozgur Batur
Sent: Friday, June 24, 2016 4:23 PM
To: Yuri &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A>&gt;
Cc: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] flickr.com redirect error

Hi Yuri,

Thank you. I put the #301 loop directives and restarted squid unfortunately result is the same. Here is the access logs:

1466777191.791    235 ::1 TCP_MISS/301 987 GET <A HREF="https://www.flickr.com/">https://www.flickr.com/</A> - HIER_DIRECT/188.125.93.100&lt;<A HREF="http://188.125.93.100">http://188.125.93.100</A>&gt; text/html
1466777192.031    237 ::1 TCP_MISS/301 987 GET <A HREF="https://www.flickr.com/">https://www.flickr.com/</A> - HIER_DIRECT/188.125.93.100&lt;<A HREF="http://188.125.93.100">http://188.125.93.100</A>&gt; text/html
1466777192.386    352 ::1 TCP_MISS/301 987 GET <A HREF="https://www.flickr.com/">https://www.flickr.com/</A> - HIER_DIRECT/188.125.93.100&lt;<A HREF="http://188.125.93.100">http://188.125.93.100</A>&gt; text/html
1466777192.612    223 ::1 TCP_MISS/301 987 GET <A HREF="https://www.flickr.com/">https://www.flickr.com/</A> - HIER_DIRECT/188.125.93.100&lt;<A HREF="http://188.125.93.100">http://188.125.93.100</A>&gt; text/html
...

As I understand all responses are from origin server, there is no cache hit with or without store_miss and send_hit. Confusing part is when directly connected to server without proxy, flickr server does not send 301 response. When squid sends the same request somehow flickr server returns 301 with same URL.

Ozgur


On Fri, Jun 24, 2016 at 3:50 PM, Yuri &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A>&gt;&gt; wrote:

Try to do something like:



# 301 loop
acl text_mime rep_mime_type text/html text/plain

acl http301 http_status 301

store_miss deny text_mime http301
send_hit deny text_mime http301

24.06.2016 18:14, Ozgur Batur &#1087;&#1080;&#1096;&#1077;&#1090;:

I receive too many redirects(301 responses with same page URL) error on browser when opening <A HREF="https://www.flickr.com">https://www.flickr.com</A> via Squid 3.5 proxy with SSL interception. If I connect to flickr website directly without Squid error does not happen.



I tested it on two different systems one is Centos other is Ubuntu. There is no acl, redirect or any other configuration in squid.conf except enabling SSL interception.



I opened <A HREF="http://bugs.squid-cache.org/show_bug.cgi?id=4537">http://bugs.squid-cache.org/show_bug.cgi?id=4537</A> for this issue but later thought it is better to ask if you also experience the same issue.


Ozgur


_______________________________________________

squid-users mailing list

<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;

<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160624/6b230df6/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160624/6b230df6/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011219.html">[squid-users] flickr.com redirect error
</A></li>
	<LI>Next message (by thread): <A HREF="011221.html">[squid-users] flickr.com redirect error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11220">[ date ]</a>
              <a href="thread.html#11220">[ thread ]</a>
              <a href="subject.html#11220">[ subject ]</a>
              <a href="author.html#11220">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
