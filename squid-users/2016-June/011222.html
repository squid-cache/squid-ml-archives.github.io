<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] flickr.com redirect error
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20flickr.com%20redirect%20error&In-Reply-To=%3Ce98e89ff-cb01-51a1-c6ca-6c9a714ddecb%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011221.html">
   <LINK REL="Next"  HREF="011230.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] flickr.com redirect error</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20flickr.com%20redirect%20error&In-Reply-To=%3Ce98e89ff-cb01-51a1-c6ca-6c9a714ddecb%40gmail.com%3E"
       TITLE="[squid-users] flickr.com redirect error">yvoinov at gmail.com
       </A><BR>
    <I>Fri Jun 24 16:02:49 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011221.html">[squid-users] flickr.com redirect error
</A></li>
        <LI>Next message (by thread): <A HREF="011230.html">[squid-users] flickr.com redirect error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11222">[ date ]</a>
              <a href="thread.html#11222">[ thread ]</a>
              <a href="subject.html#11222">[ subject ]</a>
              <a href="author.html#11222">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256
 
Be careful, guys. Via is reauired to HTTP by RFC.


24.06.2016 21:40, Ozgur Batur &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> Hi Rafael, Yuri,
</I>&gt;<i>
</I>&gt;<i> Thank you very much, &quot;via off&quot; did the trick. It is probably a server
</I>specific issue as you said.
&gt;<i>
</I>&gt;<i> Best Regards,
</I>&gt;<i>
</I>&gt;<i> On Fri, Jun 24, 2016 at 6:29 PM, Rafael Akchurin
</I>&lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rafael.akchurin at diladele.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rafael.akchurin at diladele.com</A>&gt;&gt; wrote:
&gt;<i>
</I>&gt;<i>     Hello Ozgur, Yuri,
</I>&gt;<i>
</I>&gt;<i>     
</I>&gt;<i>
</I>&gt;<i>     I also see this error. Actually it is even present on
</I>videos.yahoo.com &lt;<A HREF="http://videos.yahoo.com">http://videos.yahoo.com</A>&gt; if I am not mistaken.
&gt;<i>
</I>&gt;<i>     The reason for this is unclear for me (incorrect handling of &#8220;Via&#8221;
</I>header by some of back office servers of Yahoo???)
&gt;<i>
</I>&gt;<i>     
</I>&gt;<i>
</I>&gt;<i>     I was able to fix it by setting &#8220;via off&#8221; in squid.conf. I am not
</I>sure if this is the recommended way ( I presume not) and how to disable
Via only for yahoo servers. Hopefully Amos has better answers.
&gt;<i>
</I>&gt;<i>     
</I>&gt;<i>
</I>&gt;<i>     Via looks like:
</I>&gt;<i>
</I>&gt;<i>     
</I>&gt;<i>
</I>&gt;<i>     Via:&quot;http/1.1 fts110.flickr.bf1.yahoo.com
</I>&lt;<A HREF="http://fts110.flickr.bf1.yahoo.com">http://fts110.flickr.bf1.yahoo.com</A>&gt; (ApacheTrafficServer [cMs f ]),
http/1.1 r02.ycpi.ams.yahoo.net &lt;<A HREF="http://r02.ycpi.ams.yahoo.net">http://r02.ycpi.ams.yahoo.net</A>&gt;
(ApacheTrafficServer [cMsSf ]), 1.1 qlproxy (squid/3.3.8)&quot;
&gt;<i>
</I>&gt;<i>     
</I>&gt;<i>
</I>&gt;<i>     Best regards,
</I>&gt;<i>
</I>&gt;<i>     Rafael Akchurin
</I>&gt;<i>
</I>&gt;<i>     Diladele B.V.
</I>&gt;<i>
</I>&gt;<i>     
</I>&gt;<i>
</I>&gt;<i>     *From:*squid-users
</I>[mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>
&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt;] *On Behalf Of *Ozgur
Batur
&gt;<i>     *Sent:* Friday, June 24, 2016 4:23 PM
</I>&gt;<i>     *To:* Yuri &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A>&gt;&gt;
</I>&gt;<i>     *Cc:* <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
&gt;<i>     *Subject:* Re: [squid-users] flickr.com &lt;<A HREF="http://flickr.com">http://flickr.com</A>&gt;
</I>redirect error
&gt;<i>
</I>&gt;<i>     
</I>&gt;<i>
</I>&gt;<i>     Hi Yuri,
</I>&gt;<i>
</I>&gt;<i>     
</I>&gt;<i>
</I>&gt;<i>     Thank you. I put the #301 loop directives and restarted squid
</I>unfortunately result is the same. Here is the access logs:
&gt;<i>
</I>&gt;<i>     
</I>&gt;<i>
</I>&gt;<i>     1466777191.791    235 ::1 TCP_MISS/301 987 GET
</I><A HREF="https://www.flickr.com/">https://www.flickr.com/</A> - HIER_DIRECT/188.125.93.100
&lt;<A HREF="http://188.125.93.100">http://188.125.93.100</A>&gt; text/html
&gt;<i>
</I>&gt;<i>     1466777192.031    237 ::1 TCP_MISS/301 987 GET
</I><A HREF="https://www.flickr.com/">https://www.flickr.com/</A> - HIER_DIRECT/188.125.93.100
&lt;<A HREF="http://188.125.93.100">http://188.125.93.100</A>&gt; text/html
&gt;<i>
</I>&gt;<i>     1466777192.386    352 ::1 TCP_MISS/301 987 GET
</I><A HREF="https://www.flickr.com/">https://www.flickr.com/</A> - HIER_DIRECT/188.125.93.100
&lt;<A HREF="http://188.125.93.100">http://188.125.93.100</A>&gt; text/html
&gt;<i>
</I>&gt;<i>     1466777192.612    223 ::1 TCP_MISS/301 987 GET
</I><A HREF="https://www.flickr.com/">https://www.flickr.com/</A> - HIER_DIRECT/188.125.93.100
&lt;<A HREF="http://188.125.93.100">http://188.125.93.100</A>&gt; text/html
&gt;<i>
</I>&gt;<i>     ...
</I>&gt;<i>
</I>&gt;<i>     
</I>&gt;<i>
</I>&gt;<i>     As I understand all responses are from origin server, there is no
</I>cache hit with or without store_miss and send_hit. Confusing part is
when directly connected to server without proxy, flickr server does not
send 301 response. When squid sends the same request somehow flickr
server returns 301 with same URL.
&gt;<i>
</I>&gt;<i>     
</I>&gt;<i>
</I>&gt;<i>     Ozgur
</I>&gt;<i>
</I>&gt;<i>     
</I>&gt;<i>
</I>&gt;<i>     
</I>&gt;<i>
</I>&gt;<i>     On Fri, Jun 24, 2016 at 3:50 PM, Yuri &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A>
</I>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A>&gt;&gt; wrote:
&gt;<i>
</I>&gt;<i>         Try to do something like:
</I>&gt;<i>
</I>&gt;<i>         
</I>&gt;<i>
</I>&gt;<i>         # 301 loop
</I>&gt;<i>         acl text_mime rep_mime_type text/html text/plain
</I>&gt;<i>
</I>&gt;<i>         acl http301 http_status 301
</I>&gt;<i>
</I>&gt;<i>         store_miss deny text_mime http301
</I>&gt;<i>         send_hit deny text_mime http301
</I>&gt;<i>
</I>&gt;<i>         
</I>&gt;<i>
</I>&gt;<i>         24.06.2016 18:14, Ozgur Batur &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;<i>
</I>&gt;<i>             I receive too many redirects(301 responses with same page
</I>URL) error on browser when opening <A HREF="https://www.flickr.com">https://www.flickr.com</A> via Squid 3.5
proxy with SSL interception. If I connect to flickr website directly
without Squid error does not happen.
&gt;<i>
</I>&gt;<i>             
</I>&gt;<i>
</I>&gt;<i>             I tested it on two different systems one is Centos other
</I>is Ubuntu. There is no acl, redirect or any other configuration in
squid.conf except enabling SSL interception.
&gt;<i>
</I>&gt;<i>             
</I>&gt;<i>
</I>&gt;<i>             I opened <A HREF="http://bugs.squid-cache.org/show_bug.cgi?id=4537">http://bugs.squid-cache.org/show_bug.cgi?id=4537</A>
</I>for this issue but later thought it is better to ask if you also
experience the same issue.
&gt;<i>
</I>&gt;<i>             
</I>&gt;<i>
</I>&gt;<i>             
</I>&gt;<i>
</I>&gt;<i>             Ozgur
</I>&gt;<i>
</I>&gt;<i>             
</I>&gt;<i>
</I>&gt;<i>             _______________________________________________
</I>&gt;<i>
</I>&gt;<i>             squid-users mailing list
</I>&gt;<i>
</I>&gt;<i>             <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
&gt;<i>
</I>&gt;<i>             <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i>         
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>         _______________________________________________
</I>&gt;<i>         squid-users mailing list
</I>&gt;<i>         <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
&gt;<i>         <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i>     
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> H &#214;zg&#252;r Batur
</I>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBCAAGBQJXbVmoAAoJENNXIZxhPexGPFgH/ib6RKjQ/JhhnvTtBQnM6euV
+F6e/rrf6B295OpsrUgqFdogmCshJZGivdSBd8266KPOlvxE3I0F01SNBtAt96wC
1pL3Sam+TmFwbOGa5vYStQ+ZAkn5ReiSHppKVdeR1lXxBlMuhcDJovIxDtXvVV5G
SZcmJWT1q+LS8vcS+mGybXOt0H7J32sSUyor+qJ0CZEfG5HEPb1XKjave1mJNxUj
JEwsL0/B5zVw8LtL2yOzZY7E3ERY0r2ieGqQ4GpzYUVoDwoc5q8xwKaU08j5qyrP
iS2fW8wbAZ2RoZmvJRxnFpFKel0NgzwrAOUeSAs8hPONUUpWaklFTL55lezNY+A=
=t07f
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160624/a81be37d/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160624/a81be37d/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x613DEC46.asc
Type: application/pgp-keys
Size: 2437 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160624/a81be37d/attachment.key">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160624/a81be37d/attachment.key</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011221.html">[squid-users] flickr.com redirect error
</A></li>
	<LI>Next message (by thread): <A HREF="011230.html">[squid-users] flickr.com redirect error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11222">[ date ]</a>
              <a href="thread.html#11222">[ thread ]</a>
              <a href="subject.html#11222">[ subject ]</a>
              <a href="author.html#11222">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
