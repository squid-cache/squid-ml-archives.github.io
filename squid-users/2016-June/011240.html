<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Problem with certificates and SSLBump
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problem%20with%20certificates%20and%20SSLBump&In-Reply-To=%3C20160625161011.GA18133%40beagle.bcn.sia.es%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011365.html">
   <LINK REL="Next"  HREF="011242.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Problem with certificates and SSLBump</H1>
    <B>C. L. Martinez</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problem%20with%20certificates%20and%20SSLBump&In-Reply-To=%3C20160625161011.GA18133%40beagle.bcn.sia.es%3E"
       TITLE="[squid-users] Problem with certificates and SSLBump">carlopmart at gmail.com
       </A><BR>
    <I>Sat Jun 25 16:10:11 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011365.html">[squid-users] Skype Issues
</A></li>
        <LI>Next message (by thread): <A HREF="011242.html">[squid-users] Problem with certificates and SSLBump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11240">[ date ]</a>
              <a href="thread.html#11240">[ thread ]</a>
              <a href="subject.html#11240">[ subject ]</a>
              <a href="author.html#11240">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

 I have some problems with my squid config when I use certificates generated with my internal CA. First, my ssl-bump config:

acl DiscoverSNIHost at_step SslBump1
acl NoSSLIntercept ssl::server_name_regex -i &quot;/etc/squid/acls/domains.nobump&quot;
ssl_bump peek DiscoverSNIHost
ssl_bump splice NoSSLIntercept
ssl_bump bump all

 With this config, all works as expected (I need to add some domains to domains.nobump, but gmail or google works without problems) only when I use a self-signed certificate in squid generated using the following commands:

openssl genrsa -out server.key 4096
openssl req -new -key server.key -x509 -days 365 -out server.crt

 But when I sign squid's request certificate with my internal CA (based on OpenBSD's LibreSSL), nothing works: gmail fails, google fails, startpage fails, etc ... My internal CA is configured to use elliptic cryptographic curve (secp384r1 for CA and prime256v1 for host's certifcates).

 Maybe is this the problem? Why when I use self-signed certificate all works ok and not when I sign squid's certificate with my Internal CA?

Thanks.

-- 
Greetings,
C. L. Martinez

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011365.html">[squid-users] Skype Issues
</A></li>
	<LI>Next message (by thread): <A HREF="011242.html">[squid-users] Problem with certificates and SSLBump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11240">[ date ]</a>
              <a href="thread.html#11240">[ thread ]</a>
              <a href="subject.html#11240">[ subject ]</a>
              <a href="author.html#11240">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
