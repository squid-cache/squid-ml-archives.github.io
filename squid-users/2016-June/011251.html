<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Preparing for shutdown after xxx requests
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Preparing%20for%20shutdown%20after%20xxx%20requests&In-Reply-To=%3C862f00a7-7405-f7de-722e-474b247e7d79%40ublun.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011214.html">
   <LINK REL="Next"  HREF="011253.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Preparing for shutdown after xxx requests</H1>
    <B>Ublun</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Preparing%20for%20shutdown%20after%20xxx%20requests&In-Reply-To=%3C862f00a7-7405-f7de-722e-474b247e7d79%40ublun.com%3E"
       TITLE="[squid-users] Preparing for shutdown after xxx requests">info at ublun.com
       </A><BR>
    <I>Sun Jun 26 19:33:57 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011214.html">[squid-users] Preparing for shutdown after xxx requests
</A></li>
        <LI>Next message (by thread): <A HREF="011253.html">[squid-users] Preparing for shutdown after xxx requests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11251">[ date ]</a>
              <a href="thread.html#11251">[ thread ]</a>
              <a href="subject.html#11251">[ subject ]</a>
              <a href="author.html#11251">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi there, I having still that problem, but it maybe Archlinux related, 
not sure. Have also with Docker a Squid container tested and it results 
in the same way. squid -zN creates all the directories and Squid works 
also nice for some time, but at once Squid shutdown.

any idea - regards David

acl localnet src 10.0.0.0/8    # RFC1918 possible internal network
acl localnet src 172.16.0.0/12 # RFC1918 possible internal network
acl localnet src 192.168.0.0/16        # RFC1918 possible internal network
acl localnet src fc00::/7       # RFC 4193 local private network range
acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged) 
machines

http_access allow localnet

acl SSL_ports port 443
acl SSL_ports port 10000
acl SSL_ports port 20000
acl Safe_ports port 80        # http
acl Safe_ports port 21        # ftp
acl Safe_ports port 443        # https
acl Safe_ports port 70        # gopher
acl Safe_ports port 210        # wais
acl Safe_ports port 1025-65535    # unregistered ports
acl Safe_ports port 280        # http-mgmt
acl Safe_ports port 488        # gss-http
acl Safe_ports port 591        # filemaker
acl Safe_ports port 777        # multiling http
acl CONNECT method CONNECT
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
http_access allow localhost
http_access deny all
http_port 3128
maximum_object_size 140 MB
cache_dir aufs /var/cache/squid 10000 32 256
coredump_dir /var/cache/squid
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern -i \.(gif|png|jpg|jpeg|ico)$ 10080 90% 43200 
override-expire ignore-no-cache ignore-no-store ignore-private
refresh_pattern -i \.(iso|avi|mkv|wav|mp3|mp4|mpeg|swf|flv|x-flv)$ 43200 
90% 432000 override-expire ignore-no-cache ignore-no-store ignore-private
refresh_pattern -i 
\.(tar|xz|run|deb|pkg|bz2|rpm|exe|zip|tar|tgz|ram|rar|bin|ppt|doc|tiff)$ 
10080 90% 43200 override-expire ignore-no-cache ignore-no-store 
ignore-private
refresh_pattern -i \.index.(html|htm)$ 0 40% 10080
refresh_pattern -i \.(html|htm|css|js)$ 1440 40% 40320
refresh_pattern . 0 40% 40320

--------------

&#9679; squid.service - Web Proxy Cache Server
    Loaded: loaded (/usr/lib/systemd/system/squid.service; disabled; 
vendor preset: disabled)
    Active: inactive (dead)

Jun 26 22:05:08 bigbox squid[2988]: /var/cache/squid/00/01/00000100
Jun 26 22:05:09 bigbox squid[2988]: DiskThreadsDiskFile::openDone: (2) 
No such file or directory
Jun 26 22:05:09 bigbox squid[2988]: /var/cache/squid/00/00/000000FB
Jun 26 22:05:09 bigbox squid[2988]: DiskThreadsDiskFile::openDone: (2) 
No such file or directory
Jun 26 22:05:09 bigbox squid[2988]: /var/cache/squid/00/01/00000104
Jun 26 22:19:01 bigbox systemd[1]: Stopping Web Proxy Cache Server...
Jun 26 22:19:01 bigbox squid[2988]: Preparing for shutdown after 774 
requests
Jun 26 22:19:01 bigbox squid[2988]: Waiting 30 seconds for active 
connections to finish
Jun 26 22:19:01 bigbox squid[2988]: Closing HTTP port [::]:3128
Jun 26 22:19:01 bigbox systemd[1]: Stopped Web Proxy Cache Server.


Am 23.06.2016 um 10:48 schrieb Eliezer Croitoru:
&gt;<i> Hey David,
</I>&gt;<i>
</I>&gt;<i> Are you using a squid instance with some old config file?
</I>&gt;<i>
</I>&gt;<i> Eliezer
</I>&gt;<i>
</I>&gt;<i> ----
</I>&gt;<i> Eliezer Croitoru
</I>&gt;<i> Linux System Administrator
</I>&gt;<i> Mobile: +972-5-28704261
</I>&gt;<i> Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of David
</I>&gt;<i> Sent: Thursday, June 23, 2016 8:17 AM
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: [squid-users] Preparing for shutdown after xxx requests
</I>&gt;<i>
</I>&gt;<i> So far Squid worked nice, but recently it shutdown again and again with:
</I>&gt;<i>
</I>&gt;<i> Preparing for shutdown after xxx requests
</I>&gt;<i>
</I>&gt;<i> has someone a hint what that causes squid to shutdown
</I>&gt;<i>
</I>&gt;<i> Squid Cache: Version 3.5.19
</I>&gt;<i> on Archlinux
</I>&gt;<i>
</I>&gt;<i> free -h:
</I>&gt;<i>                          total          used        free      shared
</I>&gt;<i> Puffer/Cache cached
</I>&gt;<i> Mem:              7.7G        3.4G        672M        333M 3.7G        3.7G
</I>&gt;<i> Swap:             4.0G         41M        4.0G
</I>&gt;<i>
</I>&gt;<i> 2016/06/23 07:45:06| Set Current Directory to /var/cache/squid
</I>&gt;<i> 2016/06/23 07:45:06 kid1| Preparing for shutdown after 967 requests
</I>&gt;<i> 2016/06/23 07:45:06 kid1| Waiting 10 seconds for active connections to
</I>&gt;<i> finish
</I>&gt;<i> 2016/06/23 07:45:06 kid1| Closing HTTP port [::]:3128
</I>&gt;<i> 2016/06/23 07:45:06 kid1| Set Current Directory to /var/cache/squid
</I>&gt;<i> 2016/06/23 07:45:06 kid1| Starting Squid Cache version 3.5.19 for
</I>&gt;<i> x86_64-pc-linux-gnu...
</I>&gt;<i> 2016/06/23 07:45:06 kid1| Service Name: squid
</I>&gt;<i> 2016/06/23 07:45:06 kid1| Process ID 17879
</I>&gt;<i> 2016/06/23 07:45:06 kid1| Process Roles: worker
</I>&gt;<i> 2016/06/23 07:45:06 kid1| With 1024 file descriptors available
</I>&gt;<i> 2016/06/23 07:45:06 kid1| Initializing IP Cache...
</I>&gt;<i> 2016/06/23 07:45:06 kid1| DNS Socket created at [::], FD 8
</I>&gt;<i> 2016/06/23 07:45:06 kid1| DNS Socket created at 0.0.0.0, FD 9
</I>&gt;<i> 2016/06/23 07:45:06 kid1| Adding nameserver 192.168.2.1 from
</I>&gt;<i> /etc/resolv.conf
</I>&gt;<i> 2016/06/23 07:45:06 kid1| Logfile: opening log
</I>&gt;<i> daemon:/var/log/squid/access.log
</I>&gt;<i> 2016/06/23 07:45:06 kid1| Logfile Daemon: opening log
</I>&gt;<i> /var/log/squid/access.log
</I>&gt;<i> 2016/06/23 07:45:06 kid1| Local cache digest enabled; rebuild/rewrite
</I>&gt;<i> every 3600/3600 sec
</I>&gt;<i> 2016/06/23 07:45:06 kid1| Store logging disabled
</I>&gt;<i> 2016/06/23 07:45:06 kid1| Swap maxSize 61440000 + 3072000 KB, estimated
</I>&gt;<i> 4962461 objects
</I>&gt;<i> 2016/06/23 07:45:06 kid1| Target number of buckets: 248123
</I>&gt;<i> 2016/06/23 07:45:06 kid1| Using 262144 Store buckets
</I>&gt;<i> 2016/06/23 07:45:06 kid1| Max Mem  size: 3072000 KB
</I>&gt;<i> 2016/06/23 07:45:06 kid1| Max Swap size: 61440000 KB
</I>&gt;<i> 2016/06/23 07:45:06 kid1| Rebuilding storage in /var/cache/squid (dirty log)
</I>&gt;<i> 2016/06/23 07:45:06 kid1| Using Least Load store dir selection
</I>&gt;<i> 2016/06/23 07:45:06 kid1| Set Current Directory to /var/cache/squid
</I>&gt;<i> 2016/06/23 07:45:06 kid1| Finished loading MIME types and icons.
</I>&gt;<i> 2016/06/23 07:45:06 kid1| HTCP Disabled.
</I>&gt;<i> 2016/06/23 07:45:06 kid1| Squid plugin modules loaded: 0
</I>&gt;<i> 2016/06/23 07:45:06 kid1| Adaptation support is off.
</I>&gt;<i> 2016/06/23 07:45:06 kid1| Accepting HTTP Socket connections at
</I>&gt;<i> local=[::]:3128 remote=[::] FD 14 flags=9
</I>&gt;<i> 2016/06/23 07:45:07 kid1| Store rebuilding is 53.75% complete
</I>&gt;<i> 2016/06/23 07:45:07 kid1| Done reading /var/cache/squid swaplog (7441
</I>&gt;<i> entries)
</I>&gt;<i> 2016/06/23 07:45:07 kid1| Finished rebuilding storage from disk.
</I>&gt;<i> 2016/06/23 07:45:07 kid1|      7422 Entries scanned
</I>&gt;<i> 2016/06/23 07:45:07 kid1|         0 Invalid entries.
</I>&gt;<i> 2016/06/23 07:45:07 kid1|         0 With invalid flags.
</I>&gt;<i> 2016/06/23 07:45:07 kid1|      7403 Objects loaded.
</I>&gt;<i> 2016/06/23 07:45:07 kid1|         0 Objects expired.
</I>&gt;<i> 2016/06/23 07:45:07 kid1|         0 Objects cancelled.
</I>&gt;<i> 2016/06/23 07:45:07 kid1|        19 Duplicate URLs purged.
</I>&gt;<i> 2016/06/23 07:45:07 kid1|         0 Swapfile clashes avoided.
</I>&gt;<i> 2016/06/23 07:45:07 kid1|   Took 0.07 seconds (100137.97 objects/sec).
</I>&gt;<i> 2016/06/23 07:45:07 kid1| Beginning Validation Procedure
</I>&gt;<i> 2016/06/23 07:45:07 kid1|   Completed Validation Procedure
</I>&gt;<i> 2016/06/23 07:45:07 kid1|   Validated 7403 Entries
</I>&gt;<i> 2016/06/23 07:45:07 kid1|   store_swap_size = 490076.00 KB
</I>&gt;<i> 2016/06/23 07:45:07 kid1| storeLateRelease: released 0 objects
</I>&gt;<i> 2016/06/23 07:51:30| Set Current Directory to /var/cache/squid
</I>&gt;<i> 2016/06/23 07:51:30 kid1| Preparing for shutdown after 28 requests
</I>&gt;<i> 2016/06/23 07:51:30 kid1| Waiting 10 seconds for active connections to
</I>&gt;<i> finish
</I>&gt;<i> 2016/06/23 07:51:30 kid1| Closing HTTP port [::]:3128
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011214.html">[squid-users] Preparing for shutdown after xxx requests
</A></li>
	<LI>Next message (by thread): <A HREF="011253.html">[squid-users] Preparing for shutdown after xxx requests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11251">[ date ]</a>
              <a href="thread.html#11251">[ thread ]</a>
              <a href="subject.html#11251">[ subject ]</a>
              <a href="author.html#11251">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
