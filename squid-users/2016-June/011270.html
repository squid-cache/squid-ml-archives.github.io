<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Some websites doesn't work with squid anymore
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Some%20websites%20doesn%27t%20work%20with%20squid%20anymore&In-Reply-To=%3C17c781aa-8768-f58b-2308-8120ecac7826%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011267.html">
   <LINK REL="Next"  HREF="011271.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Some websites doesn't work with squid anymore</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Some%20websites%20doesn%27t%20work%20with%20squid%20anymore&In-Reply-To=%3C17c781aa-8768-f58b-2308-8120ecac7826%40treenet.co.nz%3E"
       TITLE="[squid-users] Some websites doesn't work with squid anymore">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Jun 27 14:32:36 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011267.html">[squid-users] Some websites doesn't work with squid anymore
</A></li>
        <LI>Next message (by thread): <A HREF="011271.html">[squid-users] Some websites doesn't work with squid anymore
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11270">[ date ]</a>
              <a href="thread.html#11270">[ thread ]</a>
              <a href="subject.html#11270">[ subject ]</a>
              <a href="author.html#11270">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>[ Please reply to the mailing list I dont do private support except for
paying customers. And you have not arranged for that in advance. ]

On 28/06/2016 2:06 a.m., Adam Wright wrote:
&gt;<i> - Ok, ISP will see my http traffic, but will the ISP see which websites I'm
</I>&gt;<i> surfing?
</I>
If anyone can see HTTP traffic they can see what the traffic is about.


&gt;<i> 
</I>&gt;<i> - Browser is using the proxy. But access.log only shows the websites which
</I>&gt;<i> the browser connected successfully. For example I see cisco.com which I
</I>&gt;<i> entered minutes ago for Yuri.
</I>&gt;<i> 
</I>&gt;<i> 1467035091.072  15004 85.107.208.29 TCP_MISS/200 246 CONNECT
</I>&gt;<i> supportforums.cisco.com:443 yeni DIRECT/141.101.115.192
</I>
The proxy log records every transaction through the proxy, at the time
that transaction completed. Whether it succeeded or not. Anything that
get started is prone to being logged.

In the case above it was a CONNECT tunnel transferring some TLS wrapped
protocol - probably HTTPS, SPDY or WebSockets on port 443. It took
15.004 seconds to do whatever took 246 bytes to transfer.

So nothing in the log indicates either the browser is *not* using the
proxy for those transactions, or they are still ongoing as far as Squid
is concerned.

It could be a case of browser using SPDY, QUICK or WebSockets protocols
instead of HTTP inside a TLS tunnel, or directly without the proxy.
Particularly if Chrome is involved.

The case of ongoing connections is unfortunate. You can tune Squid
timeouts somewhat to make the proxy more sensitive and do its failover
to working destinations faster. But otherwise its a browser specific
problem that can only be fixed by the browser.

It might be that whatever was happening inside that tunnel above got
stuck and timed out. To Squid the tunnel is opaque, so any type of error
in there is strictly between the browser and server.

The tiny size on that log entry makes me suspect its TLS handshake
hanging and a 15sec timeout somewhere closes it down. If so the issue is
not Squid, its whatever in the server or browser is causing the TLS to hang.

&gt;<i> 
</I>&gt;<i> - Right now I'm using maxthon, it also says &quot;Error code 101
</I>&gt;<i> (net::ERR_CONNECTION_RESET)&quot; while I try to connect to those xxx websites.
</I>&gt;<i> 
</I>
That seems to mean the proxy is closing the connection. But that would
mean the proxy is aware of it ending and record in the log what
transaction finished with aborting the connection.

If there no log record, thats a very strong sign that the browser is not
using the proxy for that request.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011267.html">[squid-users] Some websites doesn't work with squid anymore
</A></li>
	<LI>Next message (by thread): <A HREF="011271.html">[squid-users] Some websites doesn't work with squid anymore
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11270">[ date ]</a>
              <a href="thread.html#11270">[ thread ]</a>
              <a href="subject.html#11270">[ subject ]</a>
              <a href="author.html#11270">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
