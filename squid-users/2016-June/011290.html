<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Running squid on a machine with only one network	interface.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Running%20squid%20on%20a%20machine%20with%20only%20one%20network%0A%09interface.&In-Reply-To=%3C9b4a8999cb6d17fbfa45643d48304b0c%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011288.html">
   <LINK REL="Next"  HREF="011291.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Running squid on a machine with only one network	interface.</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Running%20squid%20on%20a%20machine%20with%20only%20one%20network%0A%09interface.&In-Reply-To=%3C9b4a8999cb6d17fbfa45643d48304b0c%40treenet.co.nz%3E"
       TITLE="[squid-users] Running squid on a machine with only one network	interface.">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Jun 28 02:26:14 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011288.html">[squid-users] Running squid on a machine with only one network	interface.
</A></li>
        <LI>Next message (by thread): <A HREF="011291.html">[squid-users] Running squid on a machine with only one network interface.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11290">[ date ]</a>
              <a href="thread.html#11290">[ thread ]</a>
              <a href="subject.html#11290">[ subject ]</a>
              <a href="author.html#11290">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2016-06-28 08:57, Antony Stone wrote:
&gt;<i> On Monday 27 June 2016 at 22:45:19, Ataro wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> Hi there,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I've set up a FreeBSD machine inside a VirtualBox machine and used 
</I>&gt;&gt;<i> IPFW to
</I>&gt;&gt;<i> forward all the requests to the internet through a squid server 
</I>&gt;&gt;<i> running on
</I>&gt;&gt;<i> the same machine in port 3128 in intercept mode.
</I>&gt;<i> 
</I>&gt;<i> Please show us your IPFW rules.
</I>&gt;<i> 
</I>&gt;&gt;<i> The problem is that I get 403 http responses on every site I try to 
</I>&gt;&gt;<i> access
</I>&gt;&gt;<i> to, even on the sites that I've explicitly allowed in the squid.conf 
</I>&gt;&gt;<i> file.
</I>&gt;<i> 
</I>&gt;<i> Maybe show us your squid.conf as well (without comments or blank 
</I>&gt;<i> lines).
</I>&gt;<i> 
</I>&gt;&gt;<i> I also get a warning message on the tty that squid is running on (I've 
</I>&gt;&gt;<i> run
</I>&gt;&gt;<i> squid in no daemon mode) which says: Warning: Forwarding loop detected
</I>&gt;&gt;<i> for:.....
</I>&gt;<i> 
</I>&gt;<i> So, NAT is not working correctly...
</I>&gt;<i> 
</I>
I think that is the problem right there.

 From the description given it sounds like the NAT rules are on the 
'outer' machine. The requirement that NAT be performed on the same 
machine as Squid applies to VM as much as to hardware. The NAT *must* be 
performed on the VM where Squid is running, the outer machine must only 
route packets - not port forward or NAT them to the VM.

&gt;&gt;<i> I guess that this error occurs since the squid server and the IPFW 
</I>&gt;&gt;<i> firewall
</I>&gt;&gt;<i> are running on the same machine which have only one network interface.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Am I right?
</I>&gt;<i> 
</I>&gt;<i> Not in the sense that &quot;you can't do this with only one interface&quot;, no.
</I>&gt;<i> 
</I>
Nod. Squid does not know nor care about interfaces.

&gt;<i> However, quite possibly in the sense that you haven't told IPFW how to
</I>&gt;<i> distinguish between requests in from your clients, and requests out 
</I>&gt;<i> from your
</I>&gt;<i> squid instance.
</I>&gt;<i> 
</I>&gt;<i> The former need to go to squid, the latter need to go to the Internet.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Give us a bit more information and we might be able to give you a bit 
</I>&gt;<i> more
</I>&gt;<i> help.
</I>&gt;<i> 
</I>&gt;<i> Antony.
</I>
Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011288.html">[squid-users] Running squid on a machine with only one network	interface.
</A></li>
	<LI>Next message (by thread): <A HREF="011291.html">[squid-users] Running squid on a machine with only one network interface.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11290">[ date ]</a>
              <a href="thread.html#11290">[ thread ]</a>
              <a href="subject.html#11290">[ subject ]</a>
              <a href="author.html#11290">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
