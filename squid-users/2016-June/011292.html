<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Strange NTLM problem.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Strange%20NTLM%20problem.&In-Reply-To=%3C77b351c584e272d8fb9ec0f637e6ef79%40wm10.email.it%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011321.html">
   <LINK REL="Next"  HREF="011304.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Strange NTLM problem.</H1>
    <B>drcimino drcimino</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Strange%20NTLM%20problem.&In-Reply-To=%3C77b351c584e272d8fb9ec0f637e6ef79%40wm10.email.it%3E"
       TITLE="[squid-users] Strange NTLM problem.">drcimino at email.it
       </A><BR>
    <I>Tue Jun 28 06:14:34 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011321.html">[squid-users] Running squid on a machine with only one network interface.
</A></li>
        <LI>Next message (by thread): <A HREF="011304.html">[squid-users] Strange NTLM problem.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11292">[ date ]</a>
              <a href="thread.html#11292">[ thread ]</a>
              <a href="subject.html#11292">[ subject ]</a>
              <a href="author.html#11292">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dear all,


&nbsp;


i have a strange problem with my squid 3.5.19 and authentication NTLM.


On my configuration i have 2 auth method:


&nbsp;


NTLM negotiated with ntlm_auth from samba 3


&nbsp;


auth_param ntlm program /usr/local/samba/bin/ntlm_auth
--helper-protocol=squid-2.5-ntlmssp

auth_param ntlm children 200 startup=100 idle=10 concurrency=0

auth_param ntlm keep_alive on




and as a fallback basic ntlm


&nbsp;


auth_param basic program /usr/local/samba/bin/ntlm_auth
--helper-protocol=squid-2.5-basic

auth_param basic children 25 startup=15 idle=5 concurrency=0

auth_param basic realm PROXY AUTHORIZATION REQUIRED

auth_param basic credentialsttl 30 minutes


&nbsp;


TTL




authenticate_cache_garbage_interval 1 hours

authenticate_ttl 30 minutes

authenticate_ip_ttl 30 minutes




Groups identification with LDAPS


&nbsp;


external_acl_type NAV children-max=200 children-startup=100 children-idle=10
ttl=1800 %LOGIN

/usr/local/squid/libexec/ext_ldap_group_acl -s sub -b &quot;dc=domain,dc=xxx&quot; -D
&quot;cn=squid,cn=Users,dc

=domain,dc=xxx&quot; -w &quot;password&quot; -f
&quot;(&amp;(objectclass=person)(sAMAccountName=%v)(membero

f=cn=%a,ou=INTERNET,ou=AAA,dc=domain,dc=xxx))&quot; -S -K -H
<A HREF="ldaps://domain.xxx:3269">ldaps://domain.xxx:3269</A>


&nbsp;


... and all work very well.


Sometimes and randomly, my users reported to me that squid cannot do ntlm
transparent authentication and request for user/password pair (falling back
to ntlm basic).


Entering right credential does not work and to proceed further&nbsp; users
need to click on &quot;abort&quot; button many times.


&nbsp;


On my cache.log i see:


&nbsp;


Login for user [DOMAIN]\[userx]@[PC_XXX] failed due to [Access denied]

NTLMSSP BH: NT_STATUS_ACCESS_DENIED

2016/06/27 22:59:06 kid1| ERROR: NTLM Authentication validating user.
Result: {result=BH, notes={mes

sage: NT_STATUS_ACCESS_DENIED; }}

2016/06/27 23:00:02| Set Current Directory to /squid/log

2016/06/27 23:10:01| Set Current Directory to /squid/log

2016/06/27 23:20:01| Set Current Directory to /squid/log

2016/06/27 23:21:09 kid1| Logfile: opening log
stdio:/var/log/squid/netdb.state

2016/06/27 23:21:09 kid1| Logfile: closing log
stdio:/var/log/squid/netdb.state


&nbsp;


every times a user receive credential request.


After aborting each requests squid do, users can surf the internet without
problems and i cannot replicate the issue.


Trying to close the browser, clear cache, and going to the same site does
not produce same error.


Stopping squid, remove cache, starting squid does not produce same error.


It's totally random and i'm going mad to understand why.


Can someone help me to debug and understand the problem?


Any help will be appreciated.


&nbsp;


Many thanks.


Giulius.




 
 
 --
 ZE-Light e ZE-Pro: servizi zimbra per caselle con dominio email.it, per tutti i dettagli 
Clicca qui <A HREF="http://posta.email.it/caselle-di-posta-z-email-it/?utm_campaign=email_Zimbra_102014=main_footer/f">http://posta.email.it/caselle-di-posta-z-email-it/?utm_campaign=email_Zimbra_102014=main_footer/f</A>
 
 Sponsor:
 Registra i domini che desideri ed inizia a creare il tuo sito web
 Clicca qui: <A HREF="http://adv.email.it/cgi-bin/foclick.cgi?mid=13323&amp;d=28-6">http://adv.email.it/cgi-bin/foclick.cgi?mid=13323&amp;d=28-6</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160628/17414eef/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160628/17414eef/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011321.html">[squid-users] Running squid on a machine with only one network interface.
</A></li>
	<LI>Next message (by thread): <A HREF="011304.html">[squid-users] Strange NTLM problem.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11292">[ date ]</a>
              <a href="thread.html#11292">[ thread ]</a>
              <a href="subject.html#11292">[ subject ]</a>
              <a href="author.html#11292">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
