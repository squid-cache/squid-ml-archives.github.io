<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3.5.19 how to find banking server name for	no bump
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.19%20how%20to%20find%20banking%20server%20name%20for%0A%09no%20bump&In-Reply-To=%3CCANLNtGQAMssG976sXt%2B5SK%2BddDGBBYzPdcr5qDSSNWKRb5H76A%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011314.html">
   <LINK REL="Next"  HREF="011319.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3.5.19 how to find banking server name for	no bump</H1>
    <B>Stanford Prescott</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.19%20how%20to%20find%20banking%20server%20name%20for%0A%09no%20bump&In-Reply-To=%3CCANLNtGQAMssG976sXt%2B5SK%2BddDGBBYzPdcr5qDSSNWKRb5H76A%40mail.gmail.com%3E"
       TITLE="[squid-users] Squid 3.5.19 how to find banking server name for	no bump">stan.prescott at gmail.com
       </A><BR>
    <I>Tue Jun 28 23:47:47 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="011314.html">[squid-users] Squid 3.5.19 how to find banking server name for no bump
</A></li>
        <LI>Next message (by thread): <A HREF="011319.html">[squid-users] Squid 3.5.19 how to find banking server name for	no bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11318">[ date ]</a>
              <a href="thread.html#11318">[ thread ]</a>
              <a href="subject.html#11318">[ subject ]</a>
              <a href="author.html#11318">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>When I enter .wellsfargo.com in

*acl tls_s1_connect at_step SslBump1*
*acl tls_s2_client_hello at_step SslBump2*
*acl tls_s3_server_hello at_step SslBump3*

*acl tls_server_name_is_ip ssl::server_name_regex
^[0-9]+.[0-9]+.[0-9]+.[0-9]+n*
*acl tls_allowed_hsts ssl::server_name .akamaihd.net &lt;<A HREF="http://akamaihd.net">http://akamaihd.net</A>&gt;*
*acl tls_server_is_bank ssl::server_name .wellsfargo.com
&lt;<A HREF="http://wellsfargo.com">http://wellsfargo.com</A>&gt;*
*acl tls_to_splice any-of tls_allowed_hsts tls_server_is_bank*

*ssl_bump peek tls_s1_connect all*
*ssl_bump splice tls_s2_client_hello tls_to_splice*
*ssl_bump stare tls_s2_client_hello all*
*ssl_bump bump tls_s3_server_hello all*


it appears that the banking site is still getting bumped i.e.like in this
access.log snippet

*1467156887.817    257 10.40.40.100 TAG_NONE/200 0 CONNECT
54.149.224.177:443 &lt;<A HREF="http://54.149.224.177:443">http://54.149.224.177:443</A>&gt; -
ORIGINAL_DST/54.149.224.177 &lt;<A HREF="http://54.149.224.177">http://54.149.224.177</A>&gt; -*
*1467156888.008     94 10.40.40.100 TCP_MISS/200 213 POST
<A HREF="https://tiles.services.mozilla.com/v2/links/view">https://tiles.services.mozilla.com/v2/links/view</A>
&lt;<A HREF="https://tiles.services.mozilla.com/v2/links/view">https://tiles.services.mozilla.com/v2/links/view</A>&gt; -
ORIGINAL_DST/54.149.224.177 &lt;<A HREF="http://54.149.224.177">http://54.149.224.177</A>&gt; application/json*
*1467156893.774     75 10.40.40.100 TAG_NONE/200 0 CONNECT
172.230.102.185:443 &lt;<A HREF="http://172.230.102.185:443">http://172.230.102.185:443</A>&gt; -
ORIGINAL_DST/172.230.102.185 &lt;<A HREF="http://172.230.102.185">http://172.230.102.185</A>&gt; -*
*1467156893.847    117 10.40.40.100 TAG_NONE/200 0 CONNECT
172.230.102.185:443 &lt;<A HREF="http://172.230.102.185:443">http://172.230.102.185:443</A>&gt; -
ORIGINAL_DST/172.230.102.185 &lt;<A HREF="http://172.230.102.185">http://172.230.102.185</A>&gt; -*
*1467156893.875    120 10.40.40.100 TAG_NONE/200 0 CONNECT
172.230.221.75:443 &lt;<A HREF="http://172.230.221.75:443">http://172.230.221.75:443</A>&gt; -
ORIGINAL_DST/172.230.221.75 &lt;<A HREF="http://172.230.221.75">http://172.230.221.75</A>&gt; -*
*1467156893.875    111 10.40.40.100 TAG_NONE/200 0 CONNECT
172.230.102.185:443 &lt;<A HREF="http://172.230.102.185:443">http://172.230.102.185:443</A>&gt; -
ORIGINAL_DST/172.230.102.185 &lt;<A HREF="http://172.230.102.185">http://172.230.102.185</A>&gt; -*
*1467156893.875    117 10.40.40.100 TAG_NONE/200 0 CONNECT
172.230.221.75:443 &lt;<A HREF="http://172.230.221.75:443">http://172.230.221.75:443</A>&gt; -
ORIGINAL_DST/172.230.221.75 &lt;<A HREF="http://172.230.221.75">http://172.230.221.75</A>&gt; -*
*1467156893.875    117 10.40.40.100 TAG_NONE/200 0 CONNECT
172.230.221.75:443 &lt;<A HREF="http://172.230.221.75:443">http://172.230.221.75:443</A>&gt; -
ORIGINAL_DST/172.230.221.75 &lt;<A HREF="http://172.230.221.75">http://172.230.221.75</A>&gt; -*
*1467156893.875    112 10.40.40.100 TAG_NONE/200 0 CONNECT
172.230.102.185:443 &lt;<A HREF="http://172.230.102.185:443">http://172.230.102.185:443</A>&gt; -
ORIGINAL_DST/172.230.102.185 &lt;<A HREF="http://172.230.102.185">http://172.230.102.185</A>&gt; -*
*1467156893.875    111 10.40.40.100 TAG_NONE/200 0 CONNECT
172.230.102.185:443 &lt;<A HREF="http://172.230.102.185:443">http://172.230.102.185:443</A>&gt; -
ORIGINAL_DST/172.230.102.185 &lt;<A HREF="http://172.230.102.185">http://172.230.102.185</A>&gt; -*
*1467156894.109    307 10.40.40.100 TAG_NONE/200 0 CONNECT
172.230.102.185:443 &lt;<A HREF="http://172.230.102.185:443">http://172.230.102.185:443</A>&gt; -
ORIGINAL_DST/172.230.102.185 &lt;<A HREF="http://172.230.102.185">http://172.230.102.185</A>&gt; -*
*1467156894.109    306 10.40.40.100 TAG_NONE/200 0 CONNECT
172.230.102.185:443 &lt;<A HREF="http://172.230.102.185:443">http://172.230.102.185:443</A>&gt; -
ORIGINAL_DST/172.230.102.185 &lt;<A HREF="http://172.230.102.185">http://172.230.102.185</A>&gt; -*
*1467156894.109    307 10.40.40.100 TAG_NONE/200 0 CONNECT
172.230.102.185:443 &lt;<A HREF="http://172.230.102.185:443">http://172.230.102.185:443</A>&gt; -
ORIGINAL_DST/172.230.102.185 &lt;<A HREF="http://172.230.102.185">http://172.230.102.185</A>&gt; -*
*1467156894.109    308 10.40.40.100 TAG_NONE/200 0 CONNECT
172.230.102.185:443 &lt;<A HREF="http://172.230.102.185:443">http://172.230.102.185:443</A>&gt; -
ORIGINAL_DST/172.230.102.185 &lt;<A HREF="http://172.230.102.185">http://172.230.102.185</A>&gt; -*
*1467156895.488     72 10.40.40.100 TAG_NONE/200 0 CONNECT
216.58.194.98:443 &lt;<A HREF="http://216.58.194.98:443">http://216.58.194.98:443</A>&gt; - ORIGINAL_DST/216.58.194.98
&lt;<A HREF="http://216.58.194.98">http://216.58.194.98</A>&gt; -*
*1467156895.513     98 10.40.40.100 TAG_NONE/200 0 CONNECT
216.58.194.70:443 &lt;<A HREF="http://216.58.194.70:443">http://216.58.194.70:443</A>&gt; - ORIGINAL_DST/216.58.194.70
&lt;<A HREF="http://216.58.194.70">http://216.58.194.70</A>&gt; -*
*1467156895.648     66 10.40.40.100 TCP_MISS/302 739 GET
<A HREF="https://googleads.g.doubleclick.net/pagead/viewthroughconversion/974108101/?value=0&amp;guid=ON&amp;script=0&amp;data.prod=&amp;data.subprod=&amp;data.pageid=">https://googleads.g.doubleclick.net/pagead/viewthroughconversion/974108101/?value=0&amp;guid=ON&amp;script=0&amp;data.prod=&amp;data.subprod=&amp;data.pageid=</A>
&lt;<A HREF="https://googleads.g.doubleclick.net/pagead/viewthroughconversion/974108101/?value=0&amp;guid=ON&amp;script=0&amp;data.prod=&amp;data.subprod=&amp;data.pageid=">https://googleads.g.doubleclick.net/pagead/viewthroughconversion/974108101/?value=0&amp;guid=ON&amp;script=0&amp;data.prod=&amp;data.subprod=&amp;data.pageid=</A>&gt;
- ORIGINAL_DST/216.58.194.98 &lt;<A HREF="http://216.58.194.98">http://216.58.194.98</A>&gt; image/gif*
*1467156895.664     82 10.40.40.100 TCP_MISS/200 649 GET
<A HREF="https://ad.doubleclick.net/activity;src=2549153;type=allv40;cat=all_a00;u1=11201507281102291611922021;ord=6472043235332.808">https://ad.doubleclick.net/activity;src=2549153;type=allv40;cat=all_a00;u1=11201507281102291611922021;ord=6472043235332.808</A>
&lt;<A HREF="https://ad.doubleclick.net/activity;src=2549153;type=allv40;cat=all_a00;u1=11201507281102291611922021;ord=6472043235332.808">https://ad.doubleclick.net/activity;src=2549153;type=allv40;cat=all_a00;u1=11201507281102291611922021;ord=6472043235332.808</A>&gt;?
- ORIGINAL_DST/216.58.194.70 &lt;<A HREF="http://216.58.194.70">http://216.58.194.70</A>&gt; image/gif*
*1467156895.920    250 10.40.40.100 TAG_NONE/200 0 CONNECT 24.155.92.60:443
&lt;<A HREF="http://24.155.92.60:443">http://24.155.92.60:443</A>&gt; - ORIGINAL_DST/24.155.92.60 &lt;<A HREF="http://24.155.92.60">http://24.155.92.60</A>&gt;
-*
*1467156896.061     79 10.40.40.100 TCP_MISS/200 503 GET
<A HREF="https://www.google.com/ads/user-lists/974108101/?script=0&amp;random=2433874630">https://www.google.com/ads/user-lists/974108101/?script=0&amp;random=2433874630</A>
&lt;<A HREF="https://www.google.com/ads/user-lists/974108101/?script=0&amp;random=2433874630">https://www.google.com/ads/user-lists/974108101/?script=0&amp;random=2433874630</A>&gt;
- ORIGINAL_DST/24.155.92.60 &lt;<A HREF="http://24.155.92.60">http://24.155.92.60</A>&gt; image/gif*
*1467156899.837   5727 10.40.40.100 TAG_NONE/200 0 CONNECT
159.45.66.156:443 &lt;<A HREF="http://159.45.66.156:443">http://159.45.66.156:443</A>&gt; - HIER_NONE/- -*
*1467156899.837   5587 10.40.40.100 TCP_TUNNEL/200 165 CONNECT
connect.secure.wellsfargo.com:443
&lt;<A HREF="http://connect.secure.wellsfargo.com:443">http://connect.secure.wellsfargo.com:443</A>&gt; - ORIGINAL_DST/159.45.66.156
&lt;<A HREF="http://159.45.66.156">http://159.45.66.156</A>&gt; -*
*1467156899.837   5679 10.40.40.100 TAG_NONE/200 0 CONNECT
159.45.66.156:443 &lt;<A HREF="http://159.45.66.156:443">http://159.45.66.156:443</A>&gt; - HIER_NONE/- -*
*1467156899.837   5587 10.40.40.100 TCP_TUNNEL/200 165 CONNECT
connect.secure.wellsfargo.com:443
&lt;<A HREF="http://connect.secure.wellsfargo.com:443">http://connect.secure.wellsfargo.com:443</A>&gt; - ORIGINAL_DST/159.45.66.156
&lt;<A HREF="http://159.45.66.156">http://159.45.66.156</A>&gt; -*
*1467156899.838   5680 10.40.40.100 TAG_NONE/200 0 CONNECT
159.45.66.156:443 &lt;<A HREF="http://159.45.66.156:443">http://159.45.66.156:443</A>&gt; - HIER_NONE/- -*
*1467156899.838   5588 10.40.40.100 TCP_TUNNEL/200 165 CONNECT
connect.secure.wellsfargo.com:443
&lt;<A HREF="http://connect.secure.wellsfargo.com:443">http://connect.secure.wellsfargo.com:443</A>&gt; - ORIGINAL_DST/159.45.66.156
&lt;<A HREF="http://159.45.66.156">http://159.45.66.156</A>&gt; -*
*1467156900.836   5421 10.40.40.100 TAG_NONE/200 0 CONNECT
159.45.170.145:443 &lt;<A HREF="http://159.45.170.145:443">http://159.45.170.145:443</A>&gt; - HIER_NONE/- -*
*1467156900.836   5042 10.40.40.100 TCP_TUNNEL/200 4631 CONNECT
www.wellsfargo.com:443 &lt;<A HREF="http://www.wellsfargo.com:443">http://www.wellsfargo.com:443</A>&gt; -
ORIGINAL_DST/159.45.170.145 &lt;<A HREF="http://159.45.170.145">http://159.45.170.145</A>&gt; -*
*1467156900.837   5423 10.40.40.100 TAG_NONE/200 0 CONNECT 159.45.2.142:443
&lt;<A HREF="http://159.45.2.142:443">http://159.45.2.142:443</A>&gt; - HIER_NONE/- -*
*1467156900.837   5139 10.40.40.100 TCP_TUNNEL/200 4043 CONNECT
static.wellsfargo.com:443 &lt;<A HREF="http://static.wellsfargo.com:443">http://static.wellsfargo.com:443</A>&gt; -
ORIGINAL_DST/159.45.2.142 &lt;<A HREF="http://159.45.2.142">http://159.45.2.142</A>&gt; -*
*1467156900.838   5423 10.40.40.100 TAG_NONE/200 0 CONNECT
159.45.170.145:443 &lt;<A HREF="http://159.45.170.145:443">http://159.45.170.145:443</A>&gt; - HIER_NONE/- -*
*1467156900.838   5088 10.40.40.100 TCP_TUNNEL/200 4631 CONNECT
www.wellsfargo.com:443 &lt;<A HREF="http://www.wellsfargo.com:443">http://www.wellsfargo.com:443</A>&gt; -
ORIGINAL_DST/159.45.170.145 &lt;<A HREF="http://159.45.170.145">http://159.45.170.145</A>&gt; -*

If I disable sslbumping then the bank site does not get bumped, of course.

1467157349.321    230 10.40.40.100 TCP_MISS/301 243 GET
<A HREF="http://wellsfargo.com/">http://wellsfargo.com/</A> - ORIGINAL_DST/159.45.66.143 -

Here is my squid.conf with bumping enabled.

visible_hostname smoothwall

# Uncomment the following to send debug info to /var/log/squid/cache.log
#debug_options ALL,1 33,2 28,9

# ACCESS CONTROLS
# ----------------------------------------------------------------
acl localhostgreen src 10.40.40.1
acl localnetgreen src 10.40.40.0/24
acl SWE_subnets          src
&quot;/var/smoothwall/mods/proxy/acls/src_subnets.acl&quot;

acl SSL_ports port 445 443 441 563
acl Safe_ports port 80     # http
acl Safe_ports port 81     # smoothwall http
acl Safe_ports port 21     # ftp
acl Safe_ports port 445 443 441 563 # https, snews
acl Safe_ports port 70     # gopher
acl Safe_ports port 210       # wais
acl Safe_ports port 1025-65535 # unregistered ports
acl Safe_ports port 280       # http-mgmt
acl Safe_ports port 488       # gss-http
acl Safe_ports port 591       # filemaker
acl Safe_ports port 777       # multiling http

acl CONNECT method CONNECT

# TAG: http_access
# ----------------------------------------------------------------

http_access allow SWE_subnets


http_access allow localhost
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

http_access allow localnetgreen
http_access allow CONNECT localnetgreen

http_access allow localhostgreen
http_access allow CONNECT localhostgreen

# http_port and https_port
#----------------------------------------------------------------------------

# For forward-proxy port. Squid uses this port to serve error pages, ftp
icons and communication with other proxies.
#----------------------------------------------------------------------------
http_port 3127

http_port 10.40.40.1:800 intercept
https_port 10.40.40.1:808 intercept ssl-bump generate-host-certificates=on
dynamic_cert_mem_cache_size=4MB
cert=/var/smoothwall/mods/proxy/ssl_cert/squidCA.pem
sslflags=VERIFY_CRL_ALL options=NO_SSLv2,NO_SSLv3,No_Compression
dhparams=/var/smoothwall/mods/proxy/ssl_cert/dhparam.pem


http_port 127.0.0.1:800 intercept

sslproxy_session_cache_size 4 MB

ssl_bump none localhostgreen

sslproxy_options NO_SSLv2,NO_SSLv3,No_Compression
sslproxy_cipher
ALL:!SSLv2:!SSLv3:!ADH:!DSS:!MD5:!EXP:!DES:!PSK:!SRP:!RC4:!IDEA:!SEED:!aNULL:!eNULL

acl tls_s1_connect at_step SslBump1
acl tls_s2_client_hello at_step SslBump2
acl tls_s3_server_hello at_step SslBump3

acl tls_allowed_hsts ssl::server_name .akamaihd.net
acl tls_server_is_bank ssl::server_name .wellsfargo.com
acl tls_to_splice any-of tls_allowed_hsts tls_server_is_bank

ssl_bump peek tls_s1_connect all
ssl_bump splice tls_s2_client_hello tls_to_splice
ssl_bump stare tls_s2_client_hello all
ssl_bump bump tls_s3_server_hello all

sslproxy_cert_error deny all
sslproxy_flags DONT_VERIFY_PEER
sslcrtd_program /var/smoothwall/mods/proxy/libexec/ssl_crtd -s
/var/smoothwall/mods/proxy/lib/ssl_db -M 4MB
sslcrtd_children 5

http_access deny all

cache_replacement_policy heap GDSF
memory_replacement_policy heap GDSF

# CACHE OPTIONS
#
----------------------------------------------------------------------------
cache_effective_user squid
cache_effective_group squid

cache_swap_high 100
cache_swap_low 80

cache_access_log stdio:/var/log/squid/access.log
cache_log /var/log/squid/cache.log
cache_mem 64 MB

cache_dir aufs /var/spool/squid/cache 1024 16 256

maximum_object_size 33 MB

minimum_object_size 0 KB


request_body_max_size 0 KB

# OTHER OPTIONS
#
----------------------------------------------------------------------------
#via off
forwarded_for off

pid_filename /var/run/squid.pid

shutdown_lifetime 10 seconds
#icp_port 3130

half_closed_clients off

umask 022

logfile_rotate 0

strip_query_terms off





On Tue, Jun 28, 2016 at 9:56 AM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:

&gt;<i> On 29/06/2016 2:02 a.m., Stanford Prescott wrote:
</I>&gt;<i> &gt; I have the proper peek and splice and bump configuration of acls setup in
</I>&gt;<i> &gt; my squid.conf file for no-bump of some web sites. I need help how to
</I>&gt;<i> enter
</I>&gt;<i> &gt; the banking hosts and or server names in a way that the peek and splice
</I>&gt;<i> &gt; configuration will determine it is a banking site that I don't want
</I>&gt;<i> bumped.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; For example, if a user enters www.wellsfargo.com for online banking my
</I>&gt;<i> &gt; current config still bumps wellsfargo.com. What would I need to enter
</I>&gt;<i> for
</I>&gt;<i> &gt; wellsfargo.com so that banking server will not be bumped?
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> Depends on what you mean by &quot;enter&quot;.
</I>&gt;<i>
</I>&gt;<i> Are you asking for the ACL value?
</I>&gt;<i>   .wellfargo.com
</I>&gt;<i>
</I>&gt;<i> Are you asking for the ACL definition?
</I>&gt;<i>  acl banks ssl::server_name .wellsfargo.com
</I>&gt;<i>
</I>&gt;<i> Or are you asking for a whole SSL-Bump configuration example?
</I>&gt;<i>  &lt;<A HREF="http://wiki.squid-cache.org/Features/SslPeekAndSplice">http://wiki.squid-cache.org/Features/SslPeekAndSplice</A>&gt; has a few.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160628/bc409bc1/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160628/bc409bc1/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="011314.html">[squid-users] Squid 3.5.19 how to find banking server name for no bump
</A></li>
	<LI>Next message (by thread): <A HREF="011319.html">[squid-users] Squid 3.5.19 how to find banking server name for	no bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11318">[ date ]</a>
              <a href="thread.html#11318">[ thread ]</a>
              <a href="subject.html#11318">[ subject ]</a>
              <a href="author.html#11318">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
