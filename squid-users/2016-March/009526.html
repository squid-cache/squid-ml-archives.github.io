<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Bizarrely slow, timing out DNS only via Squid :D
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Bizarrely%20slow%2C%20timing%20out%20DNS%20only%20via%20Squid%20%3AD&In-Reply-To=%3C56D90DC7.5030203%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009522.html">
   <LINK REL="Next"  HREF="009525.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Bizarrely slow, timing out DNS only via Squid :D</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Bizarrely%20slow%2C%20timing%20out%20DNS%20only%20via%20Squid%20%3AD&In-Reply-To=%3C56D90DC7.5030203%40treenet.co.nz%3E"
       TITLE="[squid-users] Bizarrely slow, timing out DNS only via Squid :D">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Mar  4 04:23:35 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009522.html">[squid-users] Bizarrely slow, timing out DNS only via Squid :D
</A></li>
        <LI>Next message (by thread): <A HREF="009525.html">[squid-users] Bizarrely slow, timing out DNS only via Squid :D
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9526">[ date ]</a>
              <a href="thread.html#9526">[ thread ]</a>
              <a href="subject.html#9526">[ subject ]</a>
              <a href="author.html#9526">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 4/03/2016 3:04 p.m., Dan Charlesworth wrote:
&gt;<i> Eliezer,
</I>&gt;<i> 
</I>&gt;<i> I haven&#8217;t had time to put together a current squid.conf and make it readable, remove sensitive stuff. But we don&#8217;t have any DNS-related directives set, it&#8217;s all just defaults for that stuff.
</I>&gt;<i> 
</I>
FYI:

  (squid -k parse 2&gt;&amp;1 ) | grep -o &quot;Processing.*&quot; | grep &quot;dns_&quot;

will quickly generate a sufficiently readable copy of whatever the proxy
is actually using for the DNS settings. Also to verify lack of presence
for them if as you say, its not supposed to have any configured.

Also grep for ipcache_* and fqdncache_* settings. If they are overly
large (or small) it can impact.



&gt;<i> As for the other things you asked about:
</I>&gt;<i> 
</I>&gt;<i> 1. The current resolv.conf looks like this:
</I>&gt;<i> ```
</I>&gt;<i> search tceo
</I>&gt;<i> 
</I>&gt;<i> nameserver 192.231.203.3
</I>&gt;<i> nameserver 172.16.100.5
</I>&gt;<i> ```
</I>&gt;<i> 
</I>&gt;<i> 2. Using `dns_v4_first on` and `dns_nameservers 192.231.203.3 172.16.100.5`, doesn&#8217;t make any difference.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 3. Here&#8217;s a test to your site with a single IPv4 address:
</I>&gt;<i> 
</I>&gt;<i> # time squidclient -h 10.100.128.1 <A HREF="http://ngtech.co.il">http://ngtech.co.il</A>
</I>&gt;<i> 
</I>&gt;<i> HTTP/1.1 200 OK
</I>&gt;<i> Server: nginx/1.8.0
</I>&gt;<i> Date: Fri, 04 Mar 2016 01:51:34 GMT
</I>&gt;<i> Content-Type: text/html
</I>&gt;<i> Content-Length: 10167
</I>&gt;<i> Last-Modified: Tue, 09 Feb 2016 15:56:55 GMT
</I>&gt;<i> Accept-Ranges: bytes
</I>&gt;<i> Vary: Accept-Encoding
</I>&gt;<i> X-Cache: MISS from livestream.tceo
</I>&gt;<i> X-Cache-Lookup: MISS from livestream.tceo:3128
</I>&gt;<i> Via: 1.1 livestream.tceo (squid/3.5.13)
</I>&gt;<i> Connection: close
</I>&gt;<i> 
</I>&gt;<i> &lt;content remove for brevity&gt;
</I>&gt;<i> 
</I>&gt;<i> real	0m16.339s
</I>&gt;<i> user	0m0.000s
</I>&gt;<i> sys	0m0.002s
</I>&gt;<i> 
</I>&gt;<i> 4. Reverse DNS lookups for both DNS servers
</I>&gt;<i> 
</I>&gt;<i> # dig -x 192.231.203.3
</I>&gt;<i> 
</I>&gt;<i> ; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.37.rc1.el6_7.6 &lt;&lt;&gt;&gt; -x 192.231.203.3
</I>&gt;<i> ;; global options: +cm
</I>&gt;<i> ;; Got answer:
</I>&gt;<i> ;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 31360
</I>&gt;<i> ;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 4, ADDITIONAL: 8
</I>&gt;<i> 
</I>&gt;<i> ;; QUESTION SECTION:
</I>&gt;<i> ;3.203.231.192.in-addr.arpa.	IN	PTR
</I>&gt;<i> 
</I>&gt;<i> ;; ANSWER SECTION:
</I>&gt;<i> 3.203.231.192.in-addr.arpa. 149	IN	PTR	resolv2.internode.on.net.
</I>&gt;<i> 
</I>&gt;<i> ;; AUTHORITY SECTION:
</I>&gt;<i> 203.231.192.in-addr.arpa. 149	IN	NS	ns4.on.net.
</I>&gt;<i> 203.231.192.in-addr.arpa. 149	IN	NS	ns3.on.net.
</I>&gt;<i> 203.231.192.in-addr.arpa. 149	IN	NS	ns1.on.net.
</I>&gt;<i> 203.231.192.in-addr.arpa. 149	IN	NS	ns2.on.net.
</I>&gt;<i> 
</I>&gt;<i> ;; ADDITIONAL SECTION:
</I>&gt;<i> ns1.on.net.		13301	IN	A	203.16.213.172
</I>&gt;<i> ns1.on.net.		4681	IN	AAAA	2001:44b8:f020:ff00::80
</I>&gt;<i> ns2.on.net.		13906	IN	A	192.231.203.2
</I>&gt;<i> ns2.on.net.		12151	IN	AAAA	2001:44b8:8020:ff00::80
</I>&gt;<i> ns3.on.net.		13407	IN	A	150.101.197.131
</I>&gt;<i> ns3.on.net.		4681	IN	AAAA	2001:44b8:b070:ff00::80
</I>&gt;<i> ns4.on.net.		13374	IN	A	192.231.203.4
</I>&gt;<i> ns4.on.net.		9533	IN	AAAA	2001:44b8:8060:ff00::80
</I>&gt;<i> 
</I>&gt;<i> ;; Query time: 23 msec
</I>&gt;<i> ;; SERVER: 192.231.203.3#53(192.231.203.3)
</I>&gt;<i> ;; WHEN: Fri Mar  4 12:59:02 2016
</I>&gt;<i> ;; MSG SIZE  rcvd: 330
</I>&gt;<i> 
</I>&gt;<i> # dig -x 172.16.100.5
</I>&gt;<i> 
</I>&gt;<i> ; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.37.rc1.el6_7.6 &lt;&lt;&gt;&gt; -x 172.16.100.5
</I>&gt;<i> ;; global options: +cmd
</I>&gt;<i> ;; Got answer:
</I>&gt;<i> ;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NXDOMAIN, id: 35335
</I>&gt;<i> ;; flags: qr aa rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 0
</I>&gt;<i> 
</I>&gt;<i> ;; QUESTION SECTION:
</I>&gt;<i> ;5.100.16.172.in-addr.arpa.	IN	PTR
</I>&gt;<i> 
</I>&gt;<i> ;; AUTHORITY SECTION:
</I>&gt;<i> 16.172.in-addr.arpa.	86400	IN	SOA	localhost. root.localhost. 1 604800 86400 2419200 86400
</I>&gt;<i> 
</I>&gt;<i> ;; Query time: 21 msec
</I>&gt;<i> ;; SERVER: 192.231.203.3#53(192.231.203.3)
</I>&gt;<i> ;; WHEN: Fri Mar  4 12:59:14 2016
</I>&gt;<i> ;; MSG SIZE  rcvd: 93
</I>&gt;<i> 
</I>&gt;<i> ---
</I>&gt;<i> 
</I>&gt;<i> Was there there anything else I missed?
</I>

&quot; squidclient mgr:idns &quot; may have more info about the DNS lookups. eg
whether Squid is having to retry often or such.


Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009522.html">[squid-users] Bizarrely slow, timing out DNS only via Squid :D
</A></li>
	<LI>Next message (by thread): <A HREF="009525.html">[squid-users] Bizarrely slow, timing out DNS only via Squid :D
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9526">[ date ]</a>
              <a href="thread.html#9526">[ thread ]</a>
              <a href="subject.html#9526">[ subject ]</a>
              <a href="author.html#9526">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
