<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Bizarrely slow, timing out DNS only via Squid :D
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Bizarrely%20slow%2C%20timing%20out%20DNS%20only%20via%20Squid%20%3AD&In-Reply-To=%3CB9A7F908-4A54-4ED3-B500-CEF095FE5F67%40getbusi.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009525.html">
   <LINK REL="Next"  HREF="009530.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Bizarrely slow, timing out DNS only via Squid :D</H1>
    <B>Dan Charlesworth</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Bizarrely%20slow%2C%20timing%20out%20DNS%20only%20via%20Squid%20%3AD&In-Reply-To=%3CB9A7F908-4A54-4ED3-B500-CEF095FE5F67%40getbusi.com%3E"
       TITLE="[squid-users] Bizarrely slow, timing out DNS only via Squid :D">dan at getbusi.com
       </A><BR>
    <I>Fri Mar  4 04:32:10 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009525.html">[squid-users] Bizarrely slow, timing out DNS only via Squid :D
</A></li>
        <LI>Next message (by thread): <A HREF="009530.html">[squid-users] Bizarrely slow, timing out DNS only via Squid :D
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9528">[ date ]</a>
              <a href="thread.html#9528">[ thread ]</a>
              <a href="subject.html#9528">[ subject ]</a>
              <a href="author.html#9528">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Amos,

Yeah 30 other happy sites which also have basically identical squid boxes, and very similar networks.

They did also mention to me that that they had IPv6 going on this network for quite a while, but switched it off recently (around when this problem started) due to nothing related to squid.

---

Squid conf grepped (just stuff Eliezer suggested I try):

# (squid -k parse 2&gt;&amp;1 ) | grep -o &quot;Processing.*&quot; | grep &quot;dns_\|ipcache_\|fqdncache_&quot;
Processing: dns_v4_first on
Processing: dns_nameservers 192.231.203.3 172.16.100.5


Huge paste of successful digs (this what you&#8217;re after)?:


# dig @192.231.203.3 www.v6.facebook.com AAAA

; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.37.rc1.el6_7.6 &lt;&lt;&gt;&gt; @192.231.203.3 www.v6.facebook.com AAAA
; (1 server found)
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 30264
;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 2, ADDITIONAL: 4

;; QUESTION SECTION:
;www.v6.facebook.com.		IN	AAAA

;; ANSWER SECTION:
www.v6.facebook.com.	3508	IN	CNAME	v6.vvv.facebook.com.
v6.vvv.facebook.com.	208	IN	AAAA	2a03:2880:20:8f08:face:b00c:0:1

;; AUTHORITY SECTION:
vvv.facebook.com.	7050	IN	NS	b.ns.vvv.facebook.com.
vvv.facebook.com.	7050	IN	NS	a.ns.vvv.facebook.com.

;; ADDITIONAL SECTION:
a.ns.vvv.facebook.com.	8598	IN	A	69.171.239.11
a.ns.vvv.facebook.com.	8598	IN	AAAA	2a03:2880:fffe:b:face:b00c:0:99
b.ns.vvv.facebook.com.	13843	IN	A	69.171.255.11
b.ns.vvv.facebook.com.	13843	IN	AAAA	2a03:2880:ffff:b:face:b00c:0:99

;; Query time: 21 msec
;; SERVER: 192.231.203.3#53(192.231.203.3)
;; WHEN: Fri Mar  4 15:20:51 2016
;; MSG SIZE  rcvd: 209


# time dig @192.231.203.3 -x 69.171.239.11

; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.37.rc1.el6_7.6 &lt;&lt;&gt;&gt; @192.231.203.3 -x 69.171.239.11
; (1 server found)
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NXDOMAIN, id: 49571
;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 0

;; QUESTION SECTION:
;11.239.171.69.in-addr.arpa.	IN	PTR

;; AUTHORITY SECTION:
239.171.69.in-addr.arpa. 1	IN	SOA	a.ns.facebook.com. dns.facebook.com. 1457064868 7200 1800 604800 3600

;; Query time: 32 msec
;; SERVER: 192.231.203.3#53(192.231.203.3)
;; WHEN: Fri Mar  4 15:23:07 2016
;; MSG SIZE  rcvd: 101



&gt;<i> On 4 Mar 2016, at 3:15 PM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> On 4/03/2016 11:42 a.m., Dan Charlesworth wrote:
</I>&gt;&gt;<i> Thanks for your input Eliezer.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I've tested against various public DNS servers at this point so I'm ruling
</I>&gt;&gt;<i> out any DNS-server-side problems. The only time there's any timeouts or
</I>&gt;&gt;<i> slowness is when the request is going through squid. Doesn't seem to matter
</I>&gt;&gt;<i> which HTTP server I'm requesting, whether it returns multiple IPs or not.
</I>&gt;<i> 
</I>&gt;<i> dig tested for all of A, AAAA, and PTR ?
</I>&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Also worth noting that this company has about 30 other sites with mostly
</I>&gt;&gt;<i> identical network topologies and equipment where it's completely fine.
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Does that include other Squid which are okay?
</I>&gt;<i> 
</I>&gt;<i> Amos
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009525.html">[squid-users] Bizarrely slow, timing out DNS only via Squid :D
</A></li>
	<LI>Next message (by thread): <A HREF="009530.html">[squid-users] Bizarrely slow, timing out DNS only via Squid :D
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9528">[ date ]</a>
              <a href="thread.html#9528">[ thread ]</a>
              <a href="subject.html#9528">[ subject ]</a>
              <a href="author.html#9528">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
