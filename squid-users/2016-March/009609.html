<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Sudden but sustained high bandwidth usage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Sudden%20but%20sustained%20high%20bandwidth%20usage&In-Reply-To=%3C56DDFBD5.8040501%40cinbesa.com.br%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009608.html">
   <LINK REL="Next"  HREF="009611.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Sudden but sustained high bandwidth usage</H1>
    <B>Heiler Bemerguy</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Sudden%20but%20sustained%20high%20bandwidth%20usage&In-Reply-To=%3C56DDFBD5.8040501%40cinbesa.com.br%3E"
       TITLE="[squid-users] Sudden but sustained high bandwidth usage">heiler.bemerguy at cinbesa.com.br
       </A><BR>
    <I>Mon Mar  7 22:08:21 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009608.html">[squid-users] Sudden but sustained high bandwidth usage
</A></li>
        <LI>Next message (by thread): <A HREF="009611.html">[squid-users] Sudden but sustained high bandwidth usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9609">[ date ]</a>
              <a href="thread.html#9609">[ thread ]</a>
              <a href="subject.html#9609">[ subject ]</a>
              <a href="author.html#9609">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

I know what is happening. I just don't know how to fix it without 
breaking windows updates caching.
The &quot;extra&quot; traffic is coming from windows updates mirrors.

/acl wupdatecachable url_regex -i 
(microsoft|windowsupdate)\.com.*\.(cab|exe|ms[i|u|f]|dat|zip|psf|appx|appxbundle|esd)//
//range_offset_limit none wupdatecachable/

Commenting this second line is enough to put an end to the insane 
downloads. But then all the RANGE requests of windows updates won't be 
cached.

I don't know how to explain these FD numbers. I'm using EXT4 and I don't 
know what are vmware cache disks.

Oh, and it seems not only windows updates' range requests are giving 
trouble:

1457381845.725    241 10.101.1.23 TCP_SWAPFAIL_MISS/206 33123 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381846.036    293 10.101.1.23 TCP_SWAPFAIL_MISS/206 151352 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381846.120     66 10.101.1.23 TCP_SWAPFAIL_MISS/206 33129 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381846.310     66 10.101.1.23 TCP_SWAPFAIL_MISS/206 33129 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381846.397     60 10.101.1.23 TCP_SWAPFAIL_MISS/206 33129 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381846.514     63 10.101.1.23 TCP_SWAPFAIL_MISS/206 33129 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381846.633     65 10.101.1.23 TCP_SWAPFAIL_MISS/206 33129 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381846.747     63 10.101.1.23 TCP_SWAPFAIL_MISS/206 33129 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381846.839     63 10.101.1.23 TCP_SWAPFAIL_MISS/206 33129 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381846.949     81 10.101.1.23 TCP_SWAPFAIL_MISS/206 33129 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381847.041     61 10.101.1.23 TCP_SWAPFAIL_MISS/206 33129 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381847.192    118 10.101.1.23 TCP_SWAPFAIL_MISS/206 65897 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381847.447    207 10.101.1.23 TCP_SWAPFAIL_MISS/206 121720 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381862.824    639 10.101.1.23 TCP_SWAPFAIL_MISS/206 33122 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381865.720   2879 10.101.1.23 TCP_SWAPFAIL_MISS/206 221234 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381866.078    343 10.101.1.23 TCP_SWAPFAIL_MISS/206 33130 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381867.107    995 10.101.1.23 TCP_SWAPFAIL_MISS/206 33128 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381867.523    400 10.101.1.23 TCP_SWAPFAIL_MISS/206 33128 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381867.830    291 10.101.1.23 TCP_SWAPFAIL_MISS/206 33128 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381868.082    238 10.101.1.23 TCP_SWAPFAIL_MISS/206 33128 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381868.318    219 10.101.1.23 TCP_SWAPFAIL_MISS/206 33128 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381868.503    171 10.101.1.23 TCP_SWAPFAIL_MISS/206 33128 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381868.695    174 10.101.1.23 TCP_SWAPFAIL_MISS/206 33128 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381868.880    170 10.101.1.23 TCP_SWAPFAIL_MISS/206 33128 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381869.179    286 10.101.1.23 TCP_SWAPFAIL_MISS/206 65896 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381869.424    231 10.101.1.23 TCP_SWAPFAIL_MISS/206 65896 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381869.761    322 10.101.1.23 TCP_SWAPFAIL_MISS/206 65896 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381870.008    232 10.101.1.23 TCP_SWAPFAIL_MISS/206 65896 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381870.236    214 10.101.1.23 TCP_SWAPFAIL_MISS/206 65896 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381870.429    178 10.101.1.23 TCP_SWAPFAIL_MISS/206 65896 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381870.609    174 10.101.1.23 TCP_SWAPFAIL_MISS/206 65896 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381870.805    180 10.101.1.23 TCP_SWAPFAIL_MISS/206 65897 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf
1457381871.008    189 10.101.1.23 TCP_SWAPFAIL_MISS/206 65898 GET 
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> 
- HIER_DIRECT/201.49.144.135 application/pdf

Best Regards,

-- 
Heiler Bemerguy - (91) 98151-4894
Assessor T&#233;cnico - CINBESA (91) 3184-1751


Em 07/03/2016 18:00, Eliezer Croitoru escreveu:
&gt;<i> On 07/03/2016 22:08, Yuri Voinov wrote:
</I>&gt;&gt;<i> 90 Gb first, 300 Gb second.
</I>&gt;<i> Thanks but...
</I>&gt;<i> Wouldn't it be much simpler and cheaper to just use WSUS instead all 
</I>&gt;<i> of the hassle??(if it's a closed business environment)
</I>&gt;<i> And when does the TCP_SWAPFAIL_MISS happens? always?
</I>&gt;<i> And a little tweak for the squid.conf
</I>&gt;<i> read_ahead_gap 4096 KB
</I>&gt;<i>
</I>&gt;<i> The above doesn't match your environment bandwidth.
</I>&gt;<i> You are just spending too much bandwidth on requests that might not be 
</I>&gt;<i> fulfilled.
</I>&gt;<i> Try changing the settings to:
</I>&gt;<i> read_ahead_gap 128 KB
</I>&gt;<i>
</I>&gt;<i> and see if it helps with something.
</I>&gt;<i> Also since your issue is bandwidth and users are not allowed to the 
</I>&gt;<i> Internet without the proxy I would try to dump the pfsense pf states 
</I>&gt;<i> to see what happens in the network layer, what src IP is consuming all 
</I>&gt;<i> this bandwidth.(or get a wider picture)
</I>&gt;<i> Also squid would not be the answer for a fully reasonable network 
</I>&gt;<i> usage, it only comes to help with couple specific things and not to 
</I>&gt;<i> mirror the whole Internet or even just MS as it is.(not saying that 
</I>&gt;<i> your case is a trial such as this)
</I>&gt;<i> MS has more then one API that can be mistaken as a download and it can 
</I>&gt;<i> consume more then actually required caching.
</I>&gt;<i>
</I>&gt;<i> I do not know exactly what this means from the info page:
</I>&gt;<i>         Maximum number of file descriptors:   81920
</I>&gt;<i>         Largest file desc currently in use:   6157
</I>&gt;<i>         Number of file desc currently in use: 8216
</I>&gt;<i>
</I>&gt;<i> If the number of FD currently in use is 8216 then the largest file 
</I>&gt;<i> desc currently in use doesn't match.
</I>&gt;<i> This specific question might be a bug or expected result but I do not 
</I>&gt;<i> know and Amos or Alex or others might know the answer for this 
</I>&gt;<i> specific info page issue.
</I>&gt;<i>
</I>&gt;<i> Another question I have which might be related(I have experienced such 
</I>&gt;<i> issues with GlusterFS in the past), how is the VM cache disk\s are 
</I>&gt;<i> connected? Is it connected directly to the VM or in the hypervisor level?
</I>&gt;<i> How do you mount them(fstab)? are these on the root disk or do you 
</I>&gt;<i> have couple disks mounted?
</I>&gt;<i> Did you had the chance to try to use other FS then EXT4? reiserFS? 
</I>&gt;<i> XFS? other?
</I>&gt;<i>
</I>&gt;<i> The above questions are related to the TCP_SWAPFAIL_MISS.
</I>&gt;<i> Since there is an issue and you are probably only on the &quot;buffering&quot; 
</I>&gt;<i> testing stage of the cache_dir I would try to somehow reproduce the 
</I>&gt;<i> issue but it's not clear to me what is the exact way to replicate the 
</I>&gt;<i> issue.
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> Eliezer
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160307/3ecfcab9/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160307/3ecfcab9/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009608.html">[squid-users] Sudden but sustained high bandwidth usage
</A></li>
	<LI>Next message (by thread): <A HREF="009611.html">[squid-users] Sudden but sustained high bandwidth usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9609">[ date ]</a>
              <a href="thread.html#9609">[ thread ]</a>
              <a href="subject.html#9609">[ subject ]</a>
              <a href="author.html#9609">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
