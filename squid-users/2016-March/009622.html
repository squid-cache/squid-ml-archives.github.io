<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSL Bump matching Subject Alternative Names
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20Bump%20matching%20Subject%20Alternative%20Names&In-Reply-To=%3CD304BA31.50D04%25adam.cohen-rose%40sky.uk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009674.html">
   <LINK REL="Next"  HREF="009635.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSL Bump matching Subject Alternative Names</H1>
    <B>Cohen-Rose, Adam</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20Bump%20matching%20Subject%20Alternative%20Names&In-Reply-To=%3CD304BA31.50D04%25adam.cohen-rose%40sky.uk%3E"
       TITLE="[squid-users] SSL Bump matching Subject Alternative Names">Adam.Cohen-Rose at sky.uk
       </A><BR>
    <I>Tue Mar  8 17:49:57 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009674.html">[squid-users] intercepting roku traffic
</A></li>
        <LI>Next message (by thread): <A HREF="009635.html">[squid-users] SSL Bump matching Subject Alternative Names
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9622">[ date ]</a>
              <a href="thread.html#9622">[ thread ]</a>
              <a href="subject.html#9622">[ subject ]</a>
              <a href="author.html#9622">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 27/02/2016 01:54, &quot;squid-users on behalf of Amos Jeffries&quot;
&lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A> on behalf of
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:


&gt;<i>On 27/02/2016 6:33 a.m., Cohen-Rose, Adam wrote:
</I>&gt;&gt;<i> Amos, thanks so much for your help -- we're now seeing those requests
</I>&gt;&gt;<i>get
</I>&gt;&gt;<i> through when they were just being dropped before.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> We still have a couple of puzzles left...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Firstly, we're not seeing those cdn.teads.tv requests being marked as
</I>&gt;&gt;<i> spliced in our access log, despite including the %ssl::bump_mode
</I>&gt;&gt;<i> %ssl::&gt;sni fields in our logformat.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> We do see some other whitelisted hosts in the access logs -- they appear
</I>&gt;&gt;<i> as a couple of lines, the first one saying &quot;...TAG_NONE:HIER_NONE peek
</I>&gt;&gt;<i> [hostname]&quot; and the second saying &quot;...TCP_TUNNEL:ORIGINAL_DST splice
</I>&gt;&gt;<i> [hostname]&quot;)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> However, the cdn.teads.tv requests log the first of those lines (the
</I>&gt;&gt;<i> &quot;...TAG_NONE:HIER_NONE peek [hostname]&quot;) followed by a second peek log
</I>&gt;&gt;<i> line &quot;...TCP_TUNNEL:ORIGINAL_DST peek [hostname]&quot; but no splice (even
</I>&gt;&gt;<i> though the requests do appear to be spliced as we&#185;re getting traffic!)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>I'm not sure about that one. Things only get logged on completion
</I>&gt;<i>though, so is it possible they are just very long active connections?
</I>

We&#185;re still seeing this &#8249; even for connections from curl where the client
process totally finishes. Not sure what&#185;s going on here with the logging,
but it works from a client point of view.



&gt;&gt;<i>Secondly, we deal with a *lot* of traffic through our SSL bumping proxy
</I>&gt;&gt;<i> and we are finding that Squid is using a lot of memory -- often running
</I>&gt;&gt;<i> out and needing to be restarted!
</I>&gt;<i>
</I>&gt;<i>There are some leaks being fixed right up to the latest release.
</I>&gt;<i>And OpenSSL has a tendency to attach things into sessions and contexts
</I>&gt;<i>which can cause a lot of memory. We are working to minimize that, but
</I>&gt;<i>its taking a while.
</I>&gt;<i>
</I>&gt;<i>Looking at using flags=NO_DEFAULT_CA on your http(s)_port lines if you
</I>&gt;<i>have a Squid older than 4.0.4. Default CA use a lot of memory
</I>&gt;<i>per-session and are useless on client connections, usually on cache_peer
</I>&gt;<i>too but that latter varies.
</I>

Thank you, adding sslflags=NO_DEFAULT_CA to our https_port line made a
massive difference! CPU time and latency dropped by two thirds :-)


We&#185;re planning to test how switching to an SMP config affects performance
&#8249; will hopefully post our results when we see them.


One remaining puzzle: we see the latency creep upwards overnight when the
traffic drops &#8249; reaching 140ms when it&#185;s normally 25ms. Is this just an
artefact of the servers being lightly loaded?


Thanks once again for your help!

Adam

Information in this email including any attachments may be privileged, confidential and is intended exclusively for the addressee. The views expressed may not be official policy, but the personal views of the originator. If you have received it in error, please notify the sender by return e-mail and delete it from your system. You should not reproduce, distribute, store, retransmit, use or disclose its contents to anyone. Please note we reserve the right to monitor all e-mail communication through our internal and external networks. SKY and the SKY marks are trademarks of Sky plc and Sky International AG and are used under licence. Sky UK Limited (Registration No. 2906991), Sky-In-Home Service Limited (Registration No. 2067075) and Sky Subscribers Services Limited (Registration No. 2340150) are direct or indirect subsidiaries of Sky plc (Registration No. 2247735). All of the companies mentioned in this paragraph are incorporated in England and Wales and share the same registered office at Grant Way, Isleworth, Middlesex TW7 5QD.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009674.html">[squid-users] intercepting roku traffic
</A></li>
	<LI>Next message (by thread): <A HREF="009635.html">[squid-users] SSL Bump matching Subject Alternative Names
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9622">[ date ]</a>
              <a href="thread.html#9622">[ thread ]</a>
              <a href="subject.html#9622">[ subject ]</a>
              <a href="author.html#9622">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
