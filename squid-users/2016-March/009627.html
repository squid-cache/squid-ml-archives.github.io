<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Sudden but sustained high bandwidth usage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Sudden%20but%20sustained%20high%20bandwidth%20usage&In-Reply-To=%3Cvmime.56dfd7d6.774e.3fc562da37dcd636%40ms249-lin-003.rotterdam.bazuin.nl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009623.html">
   <LINK REL="Next"  HREF="009628.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Sudden but sustained high bandwidth usage</H1>
    <B>L.P.H. van Belle</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Sudden%20but%20sustained%20high%20bandwidth%20usage&In-Reply-To=%3Cvmime.56dfd7d6.774e.3fc562da37dcd636%40ms249-lin-003.rotterdam.bazuin.nl%3E"
       TITLE="[squid-users] Sudden but sustained high bandwidth usage">belle at bazuin.nl
       </A><BR>
    <I>Wed Mar  9 07:59:18 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009623.html">[squid-users] Sudden but sustained high bandwidth usage
</A></li>
        <LI>Next message (by thread): <A HREF="009628.html">[squid-users] Sudden but sustained high bandwidth usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9627">[ date ]</a>
              <a href="thread.html#9627">[ thread ]</a>
              <a href="subject.html#9627">[ subject ]</a>
              <a href="author.html#9627">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>With the settings i already told you. &#160;Today is ms update day and hee..&#160; its caching my windows updates .. &#160;so go try them out. 

&#160;

1457510088.427&#160;&#160;&#160;&#160;&#160; 1 192.168.249.141 TCP_HIT/200 575 HEAD <A HREF="http://au.download.windowsupdate.com/d/msdownload/update/software/secu/2016/02/windows6.1-kb3139852-x64_90af4c434e6fc8b0ed83cbd545b7488b0b84f2d7.psf">http://au.download.windowsupdate.com/d/msdownload/update/software/secu/2016/02/windows6.1-kb3139852-x64_90af4c434e6fc8b0ed83cbd545b7488b0b84f2d7.psf</A> - HIER_NONE/- application/octet-stream

1457510090.608&#160;&#160;&#160;&#160;&#160; 1 192.168.249.190 TCP_HIT/200 575 HEAD <A HREF="http://au.download.windowsupdate.com/d/msdownload/update/software/secu/2016/02/windows6.1-kb3139852-x64_90af4c434e6fc8b0ed83cbd545b7488b0b84f2d7.psf">http://au.download.windowsupdate.com/d/msdownload/update/software/secu/2016/02/windows6.1-kb3139852-x64_90af4c434e6fc8b0ed83cbd545b7488b0b84f2d7.psf</A> - HIER_NONE/- application/octet-stream

1457510090.609&#160;&#160;&#160; &#160;&#160;1 192.168.249.190 TCP_HIT/200 576 HEAD <A HREF="http://au.download.windowsupdate.com/d/msdownload/update/software/secu/2016/02/windows6.1-kb3139940-x64_da3dd52959aed99d211cd36b503e387213bf07c4.psf">http://au.download.windowsupdate.com/d/msdownload/update/software/secu/2016/02/windows6.1-kb3139940-x64_da3dd52959aed99d211cd36b503e387213bf07c4.psf</A> - HIER_NONE/- application/octet-stream

1457510090.611&#160;&#160;&#160;&#160;&#160; 1 192.168.249.190 TCP_HIT/200 576 HEAD <A HREF="http://au.download.windowsupdate.com/d/msdownload/update/software/secu/2016/02/windows6.1-kb3139940-x64_da3dd52959aed99d211cd36b503e387213bf07c4.psf">http://au.download.windowsupdate.com/d/msdownload/update/software/secu/2016/02/windows6.1-kb3139940-x64_da3dd52959aed99d211cd36b503e387213bf07c4.psf</A> - HIER_NONE/- application/octet-stream

1457510091.060&#160;&#160;&#160;&#160; 29 192.168.249.190 TCP_MISS/206 40207 GET <A HREF="http://au.download.windowsupdate.com/d/msdownload/update/software/secu/2016/02/windows6.1-kb3139852-x64_90af4c434e6fc8b0ed83cbd545b7488b0b84f2d7.psf">http://au.download.windowsupdate.com/d/msdownload/update/software/secu/2016/02/windows6.1-kb3139852-x64_90af4c434e6fc8b0ed83cbd545b7488b0b84f2d7.psf</A> - HIER_DIRECT/8.253.82.142 multipart/byteranges

1457510091.899&#160;&#160;&#160;&#160;&#160; 1 192.168.249.190 TCP_HIT/200 591 HEAD <A HREF="http://au.download.windowsupdate.com/c/msdownload/update/software/secu/2016/02/windows6.1-kb3139398-x64_22584717f067444ad85f4e7a0333bc05273d4d73.psf">http://au.download.windowsupdate.com/c/msdownload/update/software/secu/2016/02/windows6.1-kb3139398-x64_22584717f067444ad85f4e7a0333bc05273d4d73.psf</A> - HIER_NONE/- application/octet-stream

1457510091.901&#160;&#160;&#160;&#160;&#160; 0 192.168.249.190 TCP_HIT/200 591 HEAD <A HREF="http://au.download.windowsupdate.com/c/msdownload/update/software/secu/2016/02/windows6.1-kb3139398-x64_22584717f067444ad85f4e7a0333bc05273d4d73.psf">http://au.download.windowsupdate.com/c/msdownload/update/software/secu/2016/02/windows6.1-kb3139398-x64_22584717f067444ad85f4e7a0333bc05273d4d73.psf</A> - HIER_NONE/- application/octet-stream

1457510093.151&#160;&#160;&#160;&#160;&#160; 1 192.168.249.190 TCP_HIT/200 577 HEAD <A HREF="http://au.download.windowsupdate.com/d/msdownload/update/software/updt/2016/02/windows6.1-kb3138612-x64_72ea89719674b61f69a5bbc93d9377e2ce56e7bd.psf">http://au.download.windowsupdate.com/d/msdownload/update/software/updt/2016/02/windows6.1-kb3138612-x64_72ea89719674b61f69a5bbc93d9377e2ce56e7bd.psf</A> - HIER_NONE/- application/octet-stream

1457510093.153&#160;&#160;&#160;&#160;&#160; 0 192.168.249.190 TCP_HIT/200 577 HEAD <A HREF="http://au.download.windowsupdate.com/d/msdownload/update/software/updt/2016/02/windows6.1-kb3138612-x64_72ea89719674b61f69a5bbc93d9377e2ce56e7bd.psf">http://au.download.windowsupdate.com/d/msdownload/update/software/updt/2016/02/windows6.1-kb3138612-x64_72ea89719674b61f69a5bbc93d9377e2ce56e7bd.psf</A> - HIER_NONE/- application/octet-stream

&#160;

&#160;


Van: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] Namens Heiler Bemerguy
Verzonden: dinsdag 8 maart 2016 23:39
Aan: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Onderwerp: Re: [squid-users] Sudden but sustained high bandwidth usage


&#160;


While debugging, found this:

2016/03/08 18:22:49.212 kid2| 88,3| client_side_reply.cc(463) cacheHit: clientCacheHit: <A HREF="http://au.v4.download.windowsupdate.com/c/msdownload/update/software/uprl/2016/03/windows-kb890830-x64-v5.34_e0074d1fa34d00f8b35e6d5c7be867292222c263.exe,">http://au.v4.download.windowsupdate.com/c/msdownload/update/software/uprl/2016/03/windows-kb890830-x64-v5.34_e0074d1fa34d00f8b35e6d5c7be867292222c263.exe,</A> 0 bytes
2016/03/08 18:22:49.212 kid2| 88,3| client_side_reply.cc(470) cacheHit: clientCacheHit: swapin failure for <A HREF="http://au.v4.download.windowsupdate.com/c/msdownload/update/software/uprl/2016/03/windows-kb890830-x64-v5.34_e0074d1fa34d00f8b35e6d5c7be867292222c263.exe">http://au.v4.download.windowsupdate.com/c/msdownload/update/software/uprl/2016/03/windows-kb890830-x64-v5.34_e0074d1fa34d00f8b35e6d5c7be867292222c263.exe</A>

This is what generating TCP_SWAPFAIL_MISS for a lot of files, and it redownloads them over and over




Em 07/03/2016 19:08, Heiler Bemerguy escreveu:




I know what is happening. I just don't know how to fix it without breaking windows updates caching.
The &quot;extra&quot; traffic is coming from windows updates mirrors.

acl wupdatecachable url_regex -i (microsoft|windowsupdate)\.com.*\.(cab|exe|ms[i|u|f]|dat|zip|psf|appx|appxbundle|esd)
range_offset_limit none wupdatecachable

Commenting this second line is enough to put an end to the insane downloads. But then all the RANGE requests of windows updates won't be cached.

I don't know how to explain these FD numbers. I'm using EXT4 and I don't know what are vmware cache disks.

Oh, and it seems not only windows updates' range requests are giving trouble:

1457381845.725&#160;&#160;&#160; 241 10.101.1.23 TCP_SWAPFAIL_MISS/206 33123 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381846.036&#160;&#160;&#160; 293 10.101.1.23 TCP_SWAPFAIL_MISS/206 151352 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381846.120&#160;&#160;&#160;&#160; 66 10.101.1.23 TCP_SWAPFAIL_MISS/206 33129 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381846.310&#160;&#160;&#160;&#160; 66 10.101.1.23 TCP_SWAPFAIL_MISS/206 33129 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381846.397&#160;&#160;&#160;&#160; 60 10.101.1.23 TCP_SWAPFAIL_MISS/206 33129 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381846.514&#160;&#160;&#160;&#160; 63 10.101.1.23 TCP_SWAPFAIL_MISS/206 33129 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381846.633&#160;&#160;&#160;&#160; 65 10.101.1.23 TCP_SWAPFAIL_MISS/206 33129 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381846.747&#160;&#160;&#160;&#160; 63 10.101.1.23 TCP_SWAPFAIL_MISS/206 33129 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381846.839&#160;&#160;&#160;&#160; 63 10.101.1.23 TCP_SWAPFAIL_MISS/206 33129 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381846.949&#160;&#160;&#160;&#160; 81 10.101.1.23 TCP_SWAPFAIL_MISS/206 33129 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381847.041&#160;&#160;&#160;&#160; 61 10.101.1.23 TCP_SWAPFAIL_MISS/206 33129 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381847.192&#160;&#160;&#160; 118 10.101.1.23 TCP_SWAPFAIL_MISS/206 65897 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381847.447&#160;&#160;&#160; 207 10.101.1.23 TCP_SWAPFAIL_MISS/206 121720 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381862.824&#160;&#160;&#160; 639 10.101.1.23 TCP_SWAPFAIL_MISS/206 33122 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381865.720&#160;&#160; 2879 10.101.1.23 TCP_SWAPFAIL_MISS/206 221234 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381866.078&#160;&#160;&#160; 343 10.101.1.23 TCP_SWAPFAIL_MISS/206 33130 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381867.107&#160;&#160;&#160; 995 10.101.1.23 TCP_SWAPFAIL_MISS/206 33128 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381867.523&#160;&#160;&#160; 400 10.101.1.23 TCP_SWAPFAIL_MISS/206 33128 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381867.830&#160;&#160;&#160; 291 10.101.1.23 TCP_SWAPFAIL_MISS/206 33128 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381868.082&#160;&#160;&#160; 238 10.101.1.23 TCP_SWAPFAIL_MISS/206 33128 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381868.318&#160;&#160;&#160; 219 10.101.1.23 TCP_SWAPFAIL_MISS/206 33128 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381868.503&#160;&#160;&#160; 171 10.101.1.23 TCP_SWAPFAIL_MISS/206 33128 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381868.695&#160;&#160;&#160; 174 10.101.1.23 TCP_SWAPFAIL_MISS/206 33128 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381868.880&#160;&#160;&#160; 170 10.101.1.23 TCP_SWAPFAIL_MISS/206 33128 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381869.179&#160;&#160;&#160; 286 10.101.1.23 TCP_SWAPFAIL_MISS/206 65896 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381869.424&#160;&#160;&#160; 231 10.101.1.23 TCP_SWAPFAIL_MISS/206 65896 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381869.761&#160;&#160;&#160; 322 10.101.1.23 TCP_SWAPFAIL_MISS/206 65896 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381870.008&#160;&#160;&#160; 232 10.101.1.23 TCP_SWAPFAIL_MISS/206 65896 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381870.236&#160;&#160;&#160; 214 10.101.1.23 TCP_SWAPFAIL_MISS/206 65896 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381870.429&#160;&#160;&#160; 178 10.101.1.23 TCP_SWAPFAIL_MISS/206 65896 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381870.609&#160;&#160;&#160; 174 10.101.1.23 TCP_SWAPFAIL_MISS/206 65896 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381870.805&#160;&#160;&#160; 180 10.101.1.23 TCP_SWAPFAIL_MISS/206 65897 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf
1457381871.008&#160;&#160;&#160; 189 10.101.1.23 TCP_SWAPFAIL_MISS/206 65898 GET <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2016-02/1022313/sumario.pdf</A> - HIER_DIRECT/201.49.144.135 application/pdf

Best Regards,




-- 

Heiler Bemerguy - (91) 98151-4894

Assessor T&#233;cnico - CINBESA (91) 3184-1751

&#160;

Em 07/03/2016 18:00, Eliezer Croitoru escreveu:


On 07/03/2016 22:08, Yuri Voinov wrote: 



90 Gb first, 300 Gb second. 

Thanks but... 
Wouldn't it be much simpler and cheaper to just use WSUS instead all of the hassle??(if it's a closed business environment) 
And when does the TCP_SWAPFAIL_MISS happens? always? 
And a little tweak for the squid.conf 
read_ahead_gap 4096 KB 

The above doesn't match your environment bandwidth. 
You are just spending too much bandwidth on requests that might not be fulfilled. 
Try changing the settings to: 
read_ahead_gap 128 KB 

and see if it helps with something. 
Also since your issue is bandwidth and users are not allowed to the Internet without the proxy I would try to dump the pfsense pf states to see what happens in the network layer, what src IP is consuming all this bandwidth.(or get a wider picture) 
Also squid would not be the answer for a fully reasonable network usage, it only comes to help with couple specific things and not to mirror the whole Internet or even just MS as it is.(not saying that your case is a trial such as this) 
MS has more then one API that can be mistaken as a download and it can consume more then actually required caching. 

I do not know exactly what this means from the info page: 
&#160;&#160;&#160;&#160;&#160;&#160;&#160; Maximum number of file descriptors:&#160;&#160; 81920 
&#160;&#160;&#160;&#160;&#160;&#160;&#160; Largest file desc currently in use:&#160;&#160; 6157 
&#160;&#160;&#160;&#160;&#160;&#160;&#160; Number of file desc currently in use: 8216 

If the number of FD currently in use is 8216 then the largest file desc currently in use doesn't match. 
This specific question might be a bug or expected result but I do not know and Amos or Alex or others might know the answer for this specific info page issue. 

Another question I have which might be related(I have experienced such issues with GlusterFS in the past), how is the VM cache disk\s are connected? Is it connected directly to the VM or in the hypervisor level? 
How do you mount them(fstab)? are these on the root disk or do you have couple disks mounted? 
Did you had the chance to try to use other FS then EXT4? reiserFS? XFS? other? 

The above questions are related to the TCP_SWAPFAIL_MISS. 
Since there is an issue and you are probably only on the &quot;buffering&quot; testing stage of the cache_dir I would try to somehow reproduce the issue but it's not clear to me what is the exact way to replicate the issue. 

Thanks, 
Eliezer 







_______________________________________________

squid-users mailing list

<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>

<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>





-- 

Heiler Bemerguy - (91) 98151-4894

Assessor T&#233;cnico - CINBESA (91) 3184-1751


-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160309/74eb09c7/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160309/74eb09c7/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009623.html">[squid-users] Sudden but sustained high bandwidth usage
</A></li>
	<LI>Next message (by thread): <A HREF="009628.html">[squid-users] Sudden but sustained high bandwidth usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9627">[ date ]</a>
              <a href="thread.html#9627">[ thread ]</a>
              <a href="subject.html#9627">[ subject ]</a>
              <a href="author.html#9627">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
