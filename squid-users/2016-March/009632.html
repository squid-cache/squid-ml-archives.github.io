<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Sudden but sustained high bandwidth usage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Sudden%20but%20sustained%20high%20bandwidth%20usage&In-Reply-To=%3C56DFFF9F.7030809%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009619.html">
   <LINK REL="Next"  HREF="009606.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Sudden but sustained high bandwidth usage</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Sudden%20but%20sustained%20high%20bandwidth%20usage&In-Reply-To=%3C56DFFF9F.7030809%40treenet.co.nz%3E"
       TITLE="[squid-users] Sudden but sustained high bandwidth usage">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Mar  9 10:49:03 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009619.html">[squid-users] Sudden but sustained high bandwidth usage
</A></li>
        <LI>Next message (by thread): <A HREF="009606.html">[squid-users] Sudden but sustained high bandwidth usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9632">[ date ]</a>
              <a href="thread.html#9632">[ thread ]</a>
              <a href="subject.html#9632">[ subject ]</a>
              <a href="author.html#9632">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 9/03/2016 4:26 a.m., Heiler Bemerguy wrote:
&gt;<i> 
</I>&gt;<i> This way it won't cache any &quot;range&quot; downloads as &quot;range_offset_limit 0&quot;
</I>&gt;<i> is the default option and it will make squid only download what the
</I>&gt;<i> client requested.
</I>&gt;<i> 
</I>&gt;<i> From squid-cache.org: &quot;A size of 0 causes Squid to never fetch more than
</I>&gt;<i> the client requested. (default)&quot;
</I>&gt;<i> 
</I>&gt;<i> What I'm trying to accomplish here, and have done while using AUFS, is
</I>&gt;<i> to make squid CACHE/STORE RANGED REQUESTS for windowsupdate.com, instead
</I>&gt;<i> of its default action of aborting.
</I>&gt;<i> 
</I>&gt;<i> How can I monitor whats the reason of all the &quot;TCP_SWAPFAIL_MISS&quot; on
</I>&gt;<i> range downloads like these:
</I>
The two details are a little confusing unless you are aware that the 206
is not related to the SWAPFAIL, nor to the MISS.

&gt;<i> 
</I>&gt;<i> 1457381845.725    241 10.101.1.23 TCP_SWAPFAIL_MISS/206 33123 GET
</I>&gt;<i> <A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf</A>
</I>&gt;<i> - HIER_DIRECT/201.49.144.135 application/pdf
</I>
Lets break this log line down:

At 1457381845.484 (being 1457381845.725 - 0.241) the client
(10.101.1.23) connected to Squid and requested (GET) a Range of bytes
from
<A HREF="http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf.">http://www.stf.jus.br/arquivo/biblioteca/NovasAquisicoes/2015-10/1043520/sumario.pdf.</A>

Squid found a cache entry claiming to be that resource. But upon loading
it _something_ went wrong (SWAPFAIL) - possibly disk corruption,
possibly I/O error, possibly a different object was found.

Whatever happened, Squid was unable to continue with the cached content
and instead used DNS (DIRECT) to find the origin server.

Squid then contacted the origin (201.49.144.135) and requested
_something_. Received the servers reply and delivered the Range reply to
the client (206).

All of this took 241 milliseconds, and 33123 bytes were transferred to
the client.

Note that there is noting logged about what was requested of the origin
server (no indication whether it was a Range or something else), and no
info about whether the origin produced a small 206 reply, or a
multi-MB/GB full-sized file which Squid would then have to prune down to
the small 3KB Range the client wanted.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009619.html">[squid-users] Sudden but sustained high bandwidth usage
</A></li>
	<LI>Next message (by thread): <A HREF="009606.html">[squid-users] Sudden but sustained high bandwidth usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9632">[ date ]</a>
              <a href="thread.html#9632">[ thread ]</a>
              <a href="subject.html#9632">[ subject ]</a>
              <a href="author.html#9632">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
