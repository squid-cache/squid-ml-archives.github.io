<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] http host rewrite for origin (reverse proxy)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20http%20host%20rewrite%20for%20origin%20%28reverse%20proxy%29&In-Reply-To=%3C56E036A9.5020106%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009653.html">
   <LINK REL="Next"  HREF="009654.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] http host rewrite for origin (reverse proxy)</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20http%20host%20rewrite%20for%20origin%20%28reverse%20proxy%29&In-Reply-To=%3C56E036A9.5020106%40treenet.co.nz%3E"
       TITLE="[squid-users] http host rewrite for origin (reverse proxy)">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Mar  9 14:43:53 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009653.html">[squid-users] http host rewrite for origin (reverse proxy)
</A></li>
        <LI>Next message (by thread): <A HREF="009654.html">[squid-users] http host rewrite for origin (reverse proxy)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9650">[ date ]</a>
              <a href="thread.html#9650">[ thread ]</a>
              <a href="subject.html#9650">[ subject ]</a>
              <a href="author.html#9650">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/03/2016 3:29 a.m., Tomas Mozes wrote:
&gt;<i> 
</I>&gt;<i> Hello Amos,
</I>&gt;<i> the origin server has multiple virtual hosts configured, so if it does not
</I>&gt;<i> receive the Host: header by which it is configured (like storage.example.com),
</I>&gt;<i> it will emit a 404.
</I>&gt;<i> 
</I>&gt;<i> Currently, this does the following. The clients requests:
</I>&gt;<i> GET /test.txt HTTP/1.1
</I>&gt;<i> Host: cdn.example.com
</I>&gt;<i> 
</I>&gt;<i> This comes to squid, it will then send the same request to the origin:
</I>&gt;<i> GET <A HREF="http://cdn.example.com/test.txt">http://cdn.example.com/test.txt</A> HTTP/1.1
</I>&gt;<i> Host: cdn.example.com
</I>&gt;<i> 
</I>&gt;<i> The result is a 404. I would need squid to alter the Host: to
</I>&gt;<i> storage.example.com. Is that possible?
</I>
It is (cache_peer forcedomain=X option). But if you do so you have to
ensure that nothing, anywhere, ever references that 'private' domain in
anything produced by the virtual host. That means everything from HTTP
headers, down to embeded object links in PDFs / images / etc , and links
generated by scripts from string bits.
 It is rather a PITA to be sure you got everything if the site was not
designed to be that way from the very beginning.

&gt;<i> 
</I>&gt;<i> What I can do is to add a cdn.example.com server alias to the origin, then
</I>&gt;<i> it works of course.
</I>
Or you could use storage.example.com as the public domain name, with DNS
records pointing at the proxy IPs and let them handle the traffic
delivery like they are designed to.
 If this is a vhost on the server, then it already has a different
private name you can put in the cache_peer to get to it.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009653.html">[squid-users] http host rewrite for origin (reverse proxy)
</A></li>
	<LI>Next message (by thread): <A HREF="009654.html">[squid-users] http host rewrite for origin (reverse proxy)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9650">[ date ]</a>
              <a href="thread.html#9650">[ thread ]</a>
              <a href="subject.html#9650">[ subject ]</a>
              <a href="author.html#9650">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
