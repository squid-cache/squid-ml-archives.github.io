<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Sudden but sustained high bandwidth usage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Sudden%20but%20sustained%20high%20bandwidth%20usage&In-Reply-To=%3C56E2F195.8060101%40cinbesa.com.br%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009718.html">
   <LINK REL="Next"  HREF="009725.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Sudden but sustained high bandwidth usage</H1>
    <B>Heiler Bemerguy</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Sudden%20but%20sustained%20high%20bandwidth%20usage&In-Reply-To=%3C56E2F195.8060101%40cinbesa.com.br%3E"
       TITLE="[squid-users] Sudden but sustained high bandwidth usage">heiler.bemerguy at cinbesa.com.br
       </A><BR>
    <I>Fri Mar 11 16:25:57 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009718.html">[squid-users] Sudden but sustained high bandwidth usage
</A></li>
        <LI>Next message (by thread): <A HREF="009725.html">[squid-users] Sudden but sustained high bandwidth usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9719">[ date ]</a>
              <a href="thread.html#9719">[ thread ]</a>
              <a href="subject.html#9719">[ subject ]</a>
              <a href="author.html#9719">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
I managed to track down with GDB one of these swapfails...

Breakpoint 1, clientReplyContext::cacheHit (this=0x33bff58, result=...) 
at client_side_reply.cc:471
471             http-&gt;logType = LOG_TCP_SWAPFAIL_MISS;
(gdb) l
466             debugs(88, 3, &quot;clientCacheHit: request aborted&quot;);
467             return;
468         } else if (result.flags.error) {
469             /* swap in failure */
470             debugs(88, 3, &quot;clientCacheHit: swapin failure for &quot; &lt;&lt; 
http-&gt;uri);
471             http-&gt;logType = LOG_TCP_SWAPFAIL_MISS;
472             removeClientStoreReference(&amp;sc, http);
473             processMiss();
474             return;
475         }

(gdb) p *this
$2 = {&lt;Lock&gt; = {_vptr.Lock = 0x84e668, count_ = 1}, &lt;StoreClient&gt; = 
{_vptr.StoreClient = 0x84e638}, purgeStatus = Http::scNone,
   lookingforstore = 5, http = 0x1eadb398, headers_sz = 0, sc = 
0x3034028, tempBuffer = {flags = {error = 0}, length = 0, offset = 0,
     data = 0x0}, old_reqsize = 0, reqsize = 210, reqofs = 0, tempbuf = 
'\000' &lt;repeats 4095 times&gt;, flags = {storelogiccomplete = 0,
     complete = 0, headersSent = false}, ourNode = 0xaa32198, 
holdingBuffer = {flags = {error = 0}, length = 0, offset = 0, data = 0x0},
   reply = 0x0, old_entry = 0x0, old_sc = 0x0, deleting = false, static 
CBDATA_clientReplyContext = 24}
(gdb) p result
$3 = {flags = {error = 1}, length = 0, offset = 0,
   data = 0x9ef18d8 &quot;HTTP/1.1 200 Internal marker object\r\nServer: 
squid\r\nMime-Version: 1.0\r\nDate: Fri, 11 Mar 2016 15:57:32 
GMT\r\nContent-Type: x-squid-internal/vary\r\nExpires: Sat, 12 Mar 2016 
19:44:12 GMT\r\nVary: Accept-En&quot;...}

It already came to client_side_reply.cc with &quot;ERROR&quot; set to 1...

(gdb) bt
#0  clientReplyContext::cacheHit (this=0x33bff58, result=...) at 
client_side_reply.cc:471
#1  0x000000000064dcbd in store_client::callback (this=0x3034028, 
sz=&lt;optimized out&gt;, error=&lt;optimized out&gt;) at store_client.cc:130
#2  0x000000000064e6c1 in store_client::startSwapin 
(this=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">this at entry</A>=0x3034028) at store_client.cc:382
#3  0x00000000006501d3 in store_client::doCopy 
(this=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">this at entry</A>=0x3034028, anEntry=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">anEntry at entry</A>=0xab07eb0) at 
store_client.cc:359
#4  0x000000000065033c in storeClientCopy2 (e=0xab07eb0, 
sc=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">sc at entry</A>=0x3034028) at store_client.cc:315
#5  0x0000000000650db9 in storeClientCopy2 (sc=0x3034028, e=&lt;optimized 
out&gt;) at store_client.cc:281
#6  store_client::copy (this=0x3034028, anEntry=0xab07eb0, copyRequest=...,
     callback_fn=0x55b250 &lt;clientReplyContext::CacheHit(void*, 
StoreIOBuffer)&gt;, data=0x33bff58) at store_client.cc:232
#7  0x0000000000558111 in clientReplyContext::doGetMoreData 
(this=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">this at entry</A>=0x33bff58) at client_side_reply.cc:1799
#8  0x0000000000558422 in clientReplyContext::identifyFoundObject 
(this=0x33bff58, newEntry=&lt;optimized out&gt;) at client_side_reply.cc:1649
#9  0x000000000055a8b8 in clientReplyContext::cacheHit (this=0x33bff58, 
result=...) at client_side_reply.cc:525
#10 0x000000000064dcbd in store_client::callback (this=0x51d5b08, 
sz=&lt;optimized out&gt;, error=&lt;optimized out&gt;) at store_client.cc:130
#11 0x000000000064e1ba in store_client::readBody 
(this=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">this at entry</A>=0x51d5b08, buf=&lt;optimized out&gt;, len=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">len at entry</A>=210) at 
store_client.cc:497
#12 0x000000000064f76b in store_client::readHeader (this=0x51d5b08, 
buf=&lt;optimized out&gt;, len=&lt;optimized out&gt;) at store_client.cc:611
#13 0x0000000000732790 in Rock::IoState::callReaderBack (this=&lt;optimized 
out&gt;,
     buf=0x9ef18d8 &quot;HTTP/1.1 200 Internal marker object\r\nServer: 
squid\r\nMime-Version: 1.0\r\nDate: Fri, 11 Mar 2016 15:57:32 
GMT\r\nContent-Type: x-squid-internal/vary\r\nExpires: Sat, 12 Mar 2016 
19:44:12 GMT\r\nVary: Accept-En&quot;..., rlen=428) at rock/RockIoState.cc:143
#14 0x0000000000726ec1 in Rock::SwapDir::readCompleted (this=&lt;optimized 
out&gt;, buf=&lt;optimized out&gt;, rlen=428, errflag=0, r=...)
     at rock/RockSwapDir.cc:822
#15 0x00000000006f22c0 in IpcIoFile::readCompleted (this=&lt;optimized 
out&gt;, readRequest=0x5417008, response=&lt;optimized out&gt;)
     at DiskIO/IpcIo/IpcIoFile.cc:255
#16 0x00000000006f6bcc in IpcIoFile::handleResponse (this=&lt;optimized 
out&gt;, ipcIo=...) at DiskIO/IpcIo/IpcIoFile.cc:462
#17 0x00000000006f6fde in IpcIoFile::HandleResponses 
(when=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">when at entry</A>=0x851324 &quot;after notification&quot;) at 
DiskIO/IpcIo/IpcIoFile.cc:449

...help!


-- 
Heiler Bemerguy - (91) 98151-4894
Assessor T&#233;cnico - CINBESA (91) 3184-1751



Em 11/03/2016 10:55, Heiler Bemerguy escreveu:
&gt;<i>
</I>&gt;<i> Hi Eliezer,
</I>&gt;<i>
</I>&gt;<i> We usually don't restart it ever. Only recently I've been restarting 
</I>&gt;<i> it because of these issues. The shutdown_lifetime is set to 5 seconds 
</I>&gt;<i> only.
</I>&gt;<i>
</I>&gt;<i> We are still getting SWAPFAIL_MISS without any apparent reason, and if 
</I>&gt;<i> it is for a RANGE request, it would multiply it to many parallel 
</I>&gt;<i> connections.... I'd like to track it down but I'm afraid I don't have 
</I>&gt;<i> the knowledge to do it...
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at proxy</A>:/var/log/squid# tail -f access.log |grep SWAPF
</I>&gt;<i> 1457703376.593    383 10.88.100.100 TCP_SWAPFAIL_MISS/206 533 GET 
</I>&gt;<i> <A HREF="http://vdownloader.com/wp-content/uploads/multiwebsite-570x321.png">http://vdownloader.com/wp-content/uploads/multiwebsite-570x321.png</A> - 
</I>&gt;<i> HIER_DIRECT/104.25.245.28 image/png
</I>&gt;<i> 1457703376.942    726 10.88.100.100 TCP_SWAPFAIL_MISS/206 530 GET 
</I>&gt;<i> <A HREF="http://vdownloader.com/wp-content/uploads/social-media-share-570x321.jpg">http://vdownloader.com/wp-content/uploads/social-media-share-570x321.jpg</A> 
</I>&gt;<i> - HIER_DIRECT/104.25.244.28 image/jpeg
</I>&gt;<i> 1457703376.964    746 10.88.100.100 TCP_SWAPFAIL_MISS/206 529 GET 
</I>&gt;<i> <A HREF="http://vdownloader.com/wp-content/uploads/Cnet-logo.png">http://vdownloader.com/wp-content/uploads/Cnet-logo.png</A> - 
</I>&gt;<i> HIER_DIRECT/104.25.244.28 image/png
</I>&gt;<i> 1457703540.685 106669 10.101.1.50 TCP_SWAPFAIL_MISS/200 3342325 GET 
</I>&gt;<i> <A HREF="http://www.rarlab.com/rar/wrar531br.exe">http://www.rarlab.com/rar/wrar531br.exe</A> - HIER_DIRECT/5.135.104.98 
</I>&gt;<i> application/octet-stream
</I>&gt;<i> 1457703631.055   4088 10.101.1.130 TCP_SWAPFAIL_MISS/206 33062 GET 
</I>&gt;<i> <A HREF="http://www.cetapnet.com.br/arquivos_cetap/arquivos/pma_001_2015_anexo_03.pdf">http://www.cetapnet.com.br/arquivos_cetap/arquivos/pma_001_2015_anexo_03.pdf</A> 
</I>&gt;<i> - HIER_DIRECT/200.219.214.204 application/pdf
</I>&gt;<i> 1457703637.471   6407 10.101.1.130 TCP_SWAPFAIL_MISS/206 352287 GET 
</I>&gt;<i> <A HREF="http://www.cetapnet.com.br/arquivos_cetap/arquivos/pma_001_2015_anexo_03.pdf">http://www.cetapnet.com.br/arquivos_cetap/arquivos/pma_001_2015_anexo_03.pdf</A> 
</I>&gt;<i> - HIER_DIRECT/200.219.214.204 application/pdf
</I>&gt;<i> 1457703755.673    262 10.72.0.24 TCP_SWAPFAIL_MISS/206 21736 GET 
</I>&gt;<i> <A HREF="http://ciac.ufpa.br/phocadownload/EDITAL_018-2016-RET-HOM_REC_2-CH-SISU-2016.pdf">http://ciac.ufpa.br/phocadownload/EDITAL_018-2016-RET-HOM_REC_2-CH-SISU-2016.pdf</A> 
</I>&gt;<i> - HIER_DIRECT/200.239.64.160 application/pdf
</I>&gt;<i> 1457703755.712     35 10.72.0.24 TCP_SWAPFAIL_MISS/206 65938 GET 
</I>&gt;<i> <A HREF="http://ciac.ufpa.br/phocadownload/EDITAL_018-2016-RET-HOM_REC_2-CH-SISU-2016.pdf">http://ciac.ufpa.br/phocadownload/EDITAL_018-2016-RET-HOM_REC_2-CH-SISU-2016.pdf</A> 
</I>&gt;<i> - HIER_DIRECT/200.239.64.160 application/pdf
</I>&gt;<i>
</I>&gt;<i> Best Regards,
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009718.html">[squid-users] Sudden but sustained high bandwidth usage
</A></li>
	<LI>Next message (by thread): <A HREF="009725.html">[squid-users] Sudden but sustained high bandwidth usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9719">[ date ]</a>
              <a href="thread.html#9719">[ thread ]</a>
              <a href="subject.html#9719">[ subject ]</a>
              <a href="author.html#9719">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
