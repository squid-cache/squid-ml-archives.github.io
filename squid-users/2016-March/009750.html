<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Sudden but sustained high bandwidth usage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Sudden%20but%20sustained%20high%20bandwidth%20usage&In-Reply-To=%3C56E6CB83.8090601%40cinbesa.com.br%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009729.html">
   <LINK REL="Next"  HREF="009752.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Sudden but sustained high bandwidth usage</H1>
    <B>Heiler Bemerguy</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Sudden%20but%20sustained%20high%20bandwidth%20usage&In-Reply-To=%3C56E6CB83.8090601%40cinbesa.com.br%3E"
       TITLE="[squid-users] Sudden but sustained high bandwidth usage">heiler.bemerguy at cinbesa.com.br
       </A><BR>
    <I>Mon Mar 14 14:32:35 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009729.html">[squid-users] Sudden but sustained high bandwidth usage
</A></li>
        <LI>Next message (by thread): <A HREF="009752.html">[squid-users] Sudden but sustained high bandwidth usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9750">[ date ]</a>
              <a href="thread.html#9750">[ thread ]</a>
              <a href="subject.html#9750">[ subject ]</a>
              <a href="author.html#9750">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi Eliezer and Joe!!!

Thank you very much for your support.

I have done a test here too. I've replaced 3.5.15 with 3.5.14 and the 
high bandwidth (associated with SWAPFAIL) is GONE.

I've checked twice the sources diffs between 14 and 15 and can't tell 
what break this.. but I'm running 3.5.14 for 3 days without any 
download-loop sucking all our bandwidth.

I'm still having a SWAPFAIL here and there, and a lot of MISSES for 
files that should have been cached... but no high bandwidth !!

access.log:
1457958469.926    152 10.101.1.163 TCP_MISS/206 6674 GET 
<A HREF="http://au.download.windowsupdate.com/c/msdownload/update/software/uprl/2016/03/windows-kb890830-v5.34_1a3d7e16cc62bb4fc4322eabde9cd8c9605f33ce.exe">http://au.download.windowsupdate.com/c/msdownload/update/software/uprl/2016/03/windows-kb890830-v5.34_1a3d7e16cc62bb4fc4322eabde9cd8c9605f33ce.exe</A> 
- HIER_DIRECT/13.107.4.50 application/octet-stream
1457958474.598    356 10.101.1.163 TCP_SWAPFAIL_MISS/206 9142 GET 
<A HREF="http://au.download.windowsupdate.com/c/msdownload/update/software/uprl/2016/03/windows-kb890830-v5.34_1a3d7e16cc62bb4fc4322eabde9cd8c9605f33ce.exe">http://au.download.windowsupdate.com/c/msdownload/update/software/uprl/2016/03/windows-kb890830-v5.34_1a3d7e16cc62bb4fc4322eabde9cd8c9605f33ce.exe</A> 
- HIER_DIRECT/13.107.4.50 application/octet-stream
1457958478.292    676 10.101.1.163 TCP_MISS/206 10509 GET 
<A HREF="http://au.download.windowsupdate.com/c/msdownload/update/software/uprl/2016/03/windows-kb890830-v5.34_1a3d7e16cc62bb4fc4322eabde9cd8c9605f33ce.exe">http://au.download.windowsupdate.com/c/msdownload/update/software/uprl/2016/03/windows-kb890830-v5.34_1a3d7e16cc62bb4fc4322eabde9cd8c9605f33ce.exe</A> 
- HIER_DIRECT/13.107.4.50 application/octet-stream
1457958481.165    220 10.101.1.163 TCP_MISS/206 11681 GET 
<A HREF="http://au.download.windowsupdate.com/c/msdownload/update/software/uprl/2016/03/windows-kb890830-v5.34_1a3d7e16cc62bb4fc4322eabde9cd8c9605f33ce.exe">http://au.download.windowsupdate.com/c/msdownload/update/software/uprl/2016/03/windows-kb890830-v5.34_1a3d7e16cc62bb4fc4322eabde9cd8c9605f33ce.exe</A> 
- HIER_DIRECT/13.107.4.50 application/octet-stream
1457958483.012    958 10.101.1.163 TCP_MISS/206 14003 GET 
<A HREF="http://au.download.windowsupdate.com/c/msdownload/update/software/uprl/2016/03/windows-kb890830-v5.34_1a3d7e16cc62bb4fc4322eabde9cd8c9605f33ce.exe">http://au.download.windowsupdate.com/c/msdownload/update/software/uprl/2016/03/windows-kb890830-v5.34_1a3d7e16cc62bb4fc4322eabde9cd8c9605f33ce.exe</A> 
- HIER_DIRECT/13.107.4.50 application/octet-stream
1457958484.334   1155 10.101.1.163 TCP_MISS/206 19973 GET 
<A HREF="http://au.download.windowsupdate.com/c/msdownload/update/software/uprl/2016/03/windows-kb890830-v5.34_1a3d7e16cc62bb4fc4322eabde9cd8c9605f33ce.exe">http://au.download.windowsupdate.com/c/msdownload/update/software/uprl/2016/03/windows-kb890830-v5.34_1a3d7e16cc62bb4fc4322eabde9cd8c9605f33ce.exe</A> 
- HIER_DIRECT/13.107.4.50 application/octet-stream
1457958485.967   1630 10.101.1.163 TCP_MISS/206 33511 GET 
<A HREF="http://au.download.windowsupdate.com/c/msdownload/update/software/uprl/2016/03/windows-kb890830-v5.34_1a3d7e16cc62bb4fc4322eabde9cd8c9605f33ce.exe">http://au.download.windowsupdate.com/c/msdownload/update/software/uprl/2016/03/windows-kb890830-v5.34_1a3d7e16cc62bb4fc4322eabde9cd8c9605f33ce.exe</A> 
- HIER_DIRECT/13.107.4.50 application/octet-stream
1457958488.804   2835 10.101.1.163 TCP_MISS/206 37266 GET 
<A HREF="http://au.download.windowsupdate.com/c/msdownload/update/software/uprl/2016/03/windows-kb890830-v5.34_1a3d7e16cc62bb4fc4322eabde9cd8c9605f33ce.exe">http://au.download.windowsupdate.com/c/msdownload/update/software/uprl/2016/03/windows-kb890830-v5.34_1a3d7e16cc62bb4fc4322eabde9cd8c9605f33ce.exe</A> 
- HIER_DIRECT/13.107.4.50 application/octet-stream
1457958492.630   3824 10.101.1.163 TCP_MISS/206 43918 GET 
<A HREF="http://au.download.windowsupdate.com/c/msdownload/update/software/uprl/2016/03/windows-kb890830-v5.34_1a3d7e16cc62bb4fc4322eabde9cd8c9605f33ce.exe">http://au.download.windowsupdate.com/c/msdownload/update/software/uprl/2016/03/windows-kb890830-v5.34_1a3d7e16cc62bb4fc4322eabde9cd8c9605f33ce.exe</A> 
- HIER_DIRECT/13.107.4.50 application/octet-stream
1457958498.908   6274 10.101.1.163 TCP_MISS/206 93504 GET 
<A HREF="http://au.download.windowsupdate.com/c/msdownload/update/software/uprl/2016/03/windows-kb890830-v5.34_1a3d7e16cc62bb4fc4322eabde9cd8c9605f33ce.exe">http://au.download.windowsupdate.com/c/msdownload/update/software/uprl/2016/03/windows-kb890830-v5.34_1a3d7e16cc62bb4fc4322eabde9cd8c9605f33ce.exe</A> 
- HIER_DIRECT/13.107.4.50 application/octet-stream
1457958505.432   6523 10.101.1.163 TCP_MISS/206 72478 GET 
<A HREF="http://au.download.windowsupdate.com/c/msdownload/update/software/uprl/2016/03/windows-kb890830-v5.34_1a3d7e16cc62bb4fc4322eabde9cd8c9605f33ce.exe">http://au.download.windowsupdate.com/c/msdownload/update/software/uprl/2016/03/windows-kb890830-v5.34_1a3d7e16cc62bb4fc4322eabde9cd8c9605f33ce.exe</A> 
- HIER_DIRECT/13.107.4.50 application/octet-stream

conf:
cache_mem 4 GB
maximum_object_size_in_memory 512 KB
memory_replacement_policy heap GDSF
cache_replacement_policy heap LFUDA
maximum_object_size 10 GB

cache_dir rock /cache2/rock1 90000 min-size=0 max-size=32768
cache_dir rock /cache/rock1 150000 min-size=32769 max-size=5368725504
cache_dir rock /cache/rock2 150000 min-size=5368725505 max-size=10737418240

acl wupdatecachable url_regex -i 
(microsoft|windowsupdate)\.com.*\.(cab|exe|ms[i|u|f]|dat|zip|psf|appx|appxbundle|esd)
range_offset_limit -1 wupdatecachable
quick_abort_pct 90
refresh_pattern -i 
(microsoft|windowsupdate)\.com.*\.(cab|exe|ms[i|u|f]|dat|zip|psf|appx|appxbundle|esd) 
483840 80% 483840 override-expire ignore-private ignore-no-store

Best Regards,

-- 
Heiler Bemerguy - (91) 98151-4894
Assessor T&#233;cnico - CINBESA (91) 3184-1751


Em 13/03/2016 03:32, Eliezer Croitoru escreveu:
&gt;<i> OK it's pretty simple to reproduce on any machine what so ever on 
</I>&gt;<i> 3.5.15-2.
</I>&gt;<i>
</I>&gt;<i> open two terminals on two machines more or less.
</I>&gt;<i> Then run on one the next command
</I>&gt;<i> watch -n 0.2 &quot;http_proxy=<A HREF="http://IP_OP_PROXY:3128/">http://IP_OP_PROXY:3128/</A> curl --silent 
</I>&gt;<i> --range 20-40 <A HREF="http://ngtech.co.il/squid/videos/sosp2011_27.mp4">http://ngtech.co.il/squid/videos/sosp2011_27.mp4</A> | wc -c&quot;
</I>&gt;<i>
</I>&gt;<i> And on the other one:
</I>&gt;<i> &quot;http_proxy=<A HREF="http://IP_OP_PROXY:3128/">http://IP_OP_PROXY:3128/</A> wget 
</I>&gt;<i> <A HREF="http://ngtech.co.il/squid/videos/sosp2011_27.mp4">http://ngtech.co.il/squid/videos/sosp2011_27.mp4</A>
</I>&gt;<i>
</I>&gt;<i> You will see that when the download is finished and at the same time 
</I>&gt;<i> the download of the partial content is still running, the 
</I>&gt;<i> SWAPFAIL_MISS happens.
</I>&gt;<i>
</I>&gt;<i> If for some reason it won't work for someone(I doubt that there is 
</I>&gt;<i> faster then full env RAM only (hypervisor+vms+disks) so lower the 0.2 
</I>&gt;<i> to 0.1 .
</I>&gt;<i>
</I>&gt;<i> Please file a bug report with the above details,
</I>&gt;<i>
</I>&gt;<i> Eliezer
</I>&gt;<i>
</I>&gt;<i> On 11/03/2016 15:55, Heiler Bemerguy wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hi Eliezer,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> We usually don't restart it ever. Only recently I've been restarting it
</I>&gt;&gt;<i> because of these issues. The shutdown_lifetime is set to 5 seconds only.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> We are still getting SWAPFAIL_MISS without any apparent reason, and if
</I>&gt;&gt;<i> it is for a RANGE request, it would multiply it to many parallel
</I>&gt;&gt;<i> connections.... I'd like to track it down but I'm afraid I don't have
</I>&gt;&gt;<i> the knowledge to do it...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at proxy</A>:/var/log/squid# tail -f access.log |grep SWAPF
</I>&gt;&gt;<i> 1457703376.593    383 10.88.100.100 TCP_SWAPFAIL_MISS/206 533 GET
</I>&gt;&gt;<i> <A HREF="http://vdownloader.com/wp-content/uploads/multiwebsite-570x321.png">http://vdownloader.com/wp-content/uploads/multiwebsite-570x321.png</A> -
</I>&gt;&gt;<i> HIER_DIRECT/104.25.245.28 image/png
</I>&gt;&gt;<i> 1457703376.942    726 10.88.100.100 TCP_SWAPFAIL_MISS/206 530 GET
</I>&gt;&gt;<i> <A HREF="http://vdownloader.com/wp-content/uploads/social-media-share-570x321.jpg">http://vdownloader.com/wp-content/uploads/social-media-share-570x321.jpg</A>
</I>&gt;&gt;<i> - HIER_DIRECT/104.25.244.28 image/jpeg
</I>&gt;&gt;<i> 1457703376.964    746 10.88.100.100 TCP_SWAPFAIL_MISS/206 529 GET
</I>&gt;&gt;<i> <A HREF="http://vdownloader.com/wp-content/uploads/Cnet-logo.png">http://vdownloader.com/wp-content/uploads/Cnet-logo.png</A> -
</I>&gt;&gt;<i> HIER_DIRECT/104.25.244.28 image/png
</I>&gt;&gt;<i> 1457703540.685 106669 10.101.1.50 TCP_SWAPFAIL_MISS/200 3342325 GET
</I>&gt;&gt;<i> <A HREF="http://www.rarlab.com/rar/wrar531br.exe">http://www.rarlab.com/rar/wrar531br.exe</A> - HIER_DIRECT/5.135.104.98
</I>&gt;&gt;<i> application/octet-stream
</I>&gt;&gt;<i> 1457703631.055   4088 10.101.1.130 TCP_SWAPFAIL_MISS/206 33062 GET
</I>&gt;&gt;<i> <A HREF="http://www.cetapnet.com.br/arquivos_cetap/arquivos/pma_001_2015_anexo_03.pdf">http://www.cetapnet.com.br/arquivos_cetap/arquivos/pma_001_2015_anexo_03.pdf</A> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> - HIER_DIRECT/200.219.214.204 application/pdf
</I>&gt;&gt;<i> 1457703637.471   6407 10.101.1.130 TCP_SWAPFAIL_MISS/206 352287 GET
</I>&gt;&gt;<i> <A HREF="http://www.cetapnet.com.br/arquivos_cetap/arquivos/pma_001_2015_anexo_03.pdf">http://www.cetapnet.com.br/arquivos_cetap/arquivos/pma_001_2015_anexo_03.pdf</A> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> - HIER_DIRECT/200.219.214.204 application/pdf
</I>&gt;&gt;<i> 1457703755.673    262 10.72.0.24 TCP_SWAPFAIL_MISS/206 21736 GET
</I>&gt;&gt;<i> <A HREF="http://ciac.ufpa.br/phocadownload/EDITAL_018-2016-RET-HOM_REC_2-CH-SISU-2016.pdf">http://ciac.ufpa.br/phocadownload/EDITAL_018-2016-RET-HOM_REC_2-CH-SISU-2016.pdf</A> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> - HIER_DIRECT/200.239.64.160 application/pdf
</I>&gt;&gt;<i> 1457703755.712     35 10.72.0.24 TCP_SWAPFAIL_MISS/206 65938 GET
</I>&gt;&gt;<i> <A HREF="http://ciac.ufpa.br/phocadownload/EDITAL_018-2016-RET-HOM_REC_2-CH-SISU-2016.pdf">http://ciac.ufpa.br/phocadownload/EDITAL_018-2016-RET-HOM_REC_2-CH-SISU-2016.pdf</A> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> - HIER_DIRECT/200.239.64.160 application/pdf
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Best Regards,
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009729.html">[squid-users] Sudden but sustained high bandwidth usage
</A></li>
	<LI>Next message (by thread): <A HREF="009752.html">[squid-users] Sudden but sustained high bandwidth usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9750">[ date ]</a>
              <a href="thread.html#9750">[ thread ]</a>
              <a href="subject.html#9750">[ subject ]</a>
              <a href="author.html#9750">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
