<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] FreeBSD and Kerberos: RC4 keytabs work, AES256 don't
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FreeBSD%20and%20Kerberos%3A%20RC4%20keytabs%20work%2C%0A%20AES256%20don%27t&In-Reply-To=%3C20160316082424.GA39707%40admin.sibptus.tomsk.ru%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009781.html">
   <LINK REL="Next"  HREF="009777.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] FreeBSD and Kerberos: RC4 keytabs work, AES256 don't</H1>
    <B>Victor Sudakov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FreeBSD%20and%20Kerberos%3A%20RC4%20keytabs%20work%2C%0A%20AES256%20don%27t&In-Reply-To=%3C20160316082424.GA39707%40admin.sibptus.tomsk.ru%3E"
       TITLE="[squid-users] FreeBSD and Kerberos: RC4 keytabs work, AES256 don't">sudakov at sibptus.tomsk.ru
       </A><BR>
    <I>Wed Mar 16 08:24:24 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009781.html">[squid-users] FreeBSD and Kerberos: RC4 keytabs work, AES256 don't
</A></li>
        <LI>Next message (by thread): <A HREF="009777.html">[squid-users] how i will avoid the warning info ? &quot;This cache hit is still fresh and more than 1 day old&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9799">[ date ]</a>
              <a href="thread.html#9799">[ thread ]</a>
              <a href="subject.html#9799">[ subject ]</a>
              <a href="author.html#9799">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Victor Sudakov wrote:
&gt;<i> &gt; 
</I>&gt;<i> &gt; I am setting up new AD-integrated squid server, so I thought I might as
</I>&gt;<i> &gt; well upgrade kerberos crypto on keytabs.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; It seems that, at least on FreeBSD 10.2-RELEASE-p13, squid-3.5.15
</I>&gt;<i> &gt; compiled with GSSAPI_BASE (kerberos from base system) can't
</I>&gt;<i> &gt; authenticate users via kerberos using AES256 keytabs.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Testing with kinit works, but squid auth does not. I am getting these
</I>&gt;<i> &gt; in cache.log:
</I>&gt;<i> &gt; BH gss_accept_sec_context() failed:  Miscellaneous failure (see text).
</I>&gt;<i> &gt; unknown mech-code 0 for mech unknown
</I>&gt;<i> 
</I>&gt;<i> What encryption type is the ticket (for the HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy at YOUR.REALM</A>) the
</I>&gt;<i> Windows KDC gives you? You can figure this out from klist.exe or
</I>&gt;<i> kerbtray.exe.
</I>&gt;<i> 
</I>&gt;<i> In my case, the Windows KDC never issues an AES256 ticket for some
</I>&gt;<i> reason, even if the squid service principal has one in the AD.
</I>
I mean, though the squid service principal in the AD has lots of
enctypes, which is evident from the keytab exported with 
&quot;ktpass -princ HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.domain.example at DOMAIN.EXAMPLE</A>&quot;: 

/usr/local/etc/squid/2/squid.keytab:

Vno  Type                     Principal
  1  des-cbc-crc              HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy2.XXXXXXX at YYYYYYYY</A>
  1  des-cbc-md5              HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy2.XXXXXXX at YYYYYYYY</A>
  1  arcfour-hmac-md5         HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy2.XXXXXXX at YYYYYYYY</A>
  1  aes256-cts-hmac-sha1-96  HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy2.XXXXXXX at YYYYYYYY</A>
  1  aes128-cts-hmac-sha1-96  HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy2.XXXXXXX at YYYYYYYY</A>
  3  arcfour-hmac-md5         HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy2.XXXXXXX at YYYYYYYY</A>

the ticket received from the domain controller always has the only &quot;RSADSI
RC4-HMAC(NT)&quot; enctype.  I don't really know the reason for that. I might as
well delete all other enctypes from the squid keytab without any ill
effect.

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
sip:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">sudakov at sibptus.tomsk.ru</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009781.html">[squid-users] FreeBSD and Kerberos: RC4 keytabs work, AES256 don't
</A></li>
	<LI>Next message (by thread): <A HREF="009777.html">[squid-users] how i will avoid the warning info ? &quot;This cache hit is still fresh and more than 1 day old&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9799">[ date ]</a>
              <a href="thread.html#9799">[ thread ]</a>
              <a href="subject.html#9799">[ subject ]</a>
              <a href="author.html#9799">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
