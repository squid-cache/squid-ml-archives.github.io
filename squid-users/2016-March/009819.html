<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] gzip deflate
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20gzip%20deflate&In-Reply-To=%3C1458208562176-4676725.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009815.html">
   <LINK REL="Next"  HREF="009822.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] gzip deflate</H1>
    <B>joe</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20gzip%20deflate&In-Reply-To=%3C1458208562176-4676725.post%40n4.nabble.com%3E"
       TITLE="[squid-users] gzip deflate">chip_pop at hotmail.com
       </A><BR>
    <I>Thu Mar 17 09:56:02 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009815.html">[squid-users] gzip deflate
</A></li>
        <LI>Next message (by thread): <A HREF="009822.html">[squid-users] gzip deflate
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9819">[ date ]</a>
              <a href="thread.html#9819">[ thread ]</a>
              <a href="subject.html#9819">[ subject ]</a>
              <a href="author.html#9819">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Alex Rousskov wrote
&gt;<i> On 03/16/2016 02:21 AM, joe wrote:
</I>&gt;&gt;<i> You need to direct messages to the service(s) using adaptation_access
</I>&gt;&gt;<i> directives:
</I>&gt;&gt;<i> isn't faster if we use gzip library instead that will minimize the
</I>&gt;&gt;<i> redirect
</I>&gt;&gt;<i> ms..direct decompress
</I>&gt;<i> 
</I>&gt;<i> Virtually everything would be faster if done directly in Squid. The
</I>&gt;<i> processing speed is not the primary acceptance criteria, or we would
</I>&gt;<i> never have ICAP, eCAP, URL rewriters, authentication helpers, SSL
</I>&gt;<i> certificate validators, and other &quot;helpers&quot;.
</I>&gt;<i> 
</I>&gt;<i> Compressing and uncompressing content on-the-fly is a lot more difficult
</I>&gt;<i> than adding a couple of zlib function calls. It probably also requires
</I>&gt;<i> several configuration/tuning options to accommodate various deployment
</I>&gt;<i> environments. To make it worth implementing inside Squid, decompression
</I>&gt;<i> has to be a very frequent feature request OR it has to be nearly
</I>&gt;<i> impossible to do well outside of Squid (while still being reasonably
</I>&gt;<i> popular). AFAICT, neither is true but please submit a more detailed
</I>&gt;<i> proposal if I am wrong.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Thank you,
</I>&gt;<i> 
</I>&gt;<i> Alex.
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>
&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at .squid-cache</A>
</I>
&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
it will be start for the future technologies  squid-gzip-deflate
Content-Encoding can be hook the code to decomp... insted of using ecap


yes there is a lot of work to have it fuly working but its start to the
develop....to continue working on it
there is lots a free snipe code arount and not hard to use it it fit in
recent squid code

just a sample code to adapt can be start of the work
#include &lt;string&gt;
#include &lt;sstream&gt;
#include &lt;stdexcept&gt;
#include &lt;string.h&gt;
#include &quot;zlib.h&quot;

using std::string;
using std::stringstream;

// Found these here
<A HREF="http://mail-archives.apache.org/mod_mbox/trafficserver-dev/201110.mbox/%3CCACJPjhYf=+br1W39vyazP=ix">http://mail-archives.apache.org/mod_mbox/trafficserver-dev/201110.mbox/%3CCACJPjhYf=+br1W39vyazP=ix</A>
//<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eQZ-4Gh9-U6TtiEdReG3S4ZZng at mail.gmail.com</A>%3E
#define MOD_GZIP_ZLIB_WINDOWSIZE 15
/** Decompress an STL string using zlib and return the original data. */
std::string decompress_deflate(const std::string&amp; str)
{
    z_stream zst;                        // z_stream is zlib's control
structure
    memset(&amp;zst, 0, sizeof(zst));

    if (inflateInit(&amp;zst) != Z_OK)
    debugs(98,1, &quot;inflateInit failed while decompressing.&quot;);
    zst.next_in = (Bytef*)str.data();
    zst.avail_in = str.size();
    int ret;
    char outbuffer[32768];
    std::string outstring;

    // get the decompressed bytes blockwise using repeated calls to inflate
    do {
        zst.next_out = reinterpret_cast&lt;Bytef*&gt;(outbuffer);
        zst.avail_out = sizeof(outbuffer);
        ret = inflate(&amp;zst, 0);
        if (outstring.size() &lt; zst.total_out) {
            outstring.append(outbuffer,
                             zst.total_out - outstring.size());
        }

    } while (ret == Z_OK);

    inflateEnd(&amp;zst);

    if (ret != Z_STREAM_END) {          // an error occurred that was not
EOF
        std::ostringstream oss;
		 debugs(98,2, oss &lt;&lt; &quot;Exception during deflate decompression: (&quot; &lt;&lt; ret &lt;&lt;
&quot;) &quot; &lt;&lt; zst.msg);
    }

    return outstring;
}

std::string decompress_gzip(const std::string&amp; str)
{
    z_stream zst;                        // z_stream is zlib's control
structure
    memset(&amp;zst, 0, sizeof(zst));
    if (inflateInit2(&amp;zst, MOD_GZIP_ZLIB_WINDOWSIZE + 16) != Z_OK)
	    debugs(98,1, &quot;error failed while decompressing.&quot;);
    zst.next_in = (Bytef*)str.data();
    zst.avail_in = str.size();
    int ret;
    char outbuffer[32768];
    std::string outstring;

    // get the decompressed bytes blockwise using repeated calls to inflate
    do {
        zst.next_out = reinterpret_cast&lt;Bytef*&gt;(outbuffer);
        zst.avail_out = sizeof(outbuffer);
        ret = inflate(&amp;zst, 0);

        if (outstring.size() &lt; zst.total_out) {
            outstring.append(outbuffer, zst.total_out - outstring.size());
        }

    } while (ret == Z_OK);

    inflateEnd(&amp;zst);

    if (ret != Z_STREAM_END) {          // an error occurred that was not
EOF
        std::ostringstream oss;
		debugs(98,2, oss &lt;&lt; &quot;Exception during zlib decompression: (&quot; &lt;&lt; ret &lt;&lt; &quot;)
&quot; &lt;&lt; zst.msg);	
    }

    return outstring;
}

=========
 i know squid its hard coded to work with but its a start nothing essay but
it will be step to the future better then waiting for apps in the web to
become fully compressed and like the most preferred that then ecap  




--
View this message in context: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/gzip-deflate-tp4676698p4676725.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/gzip-deflate-tp4676698p4676725.html</A>
Sent from the Squid - Users mailing list archive at Nabble.com.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009815.html">[squid-users] gzip deflate
</A></li>
	<LI>Next message (by thread): <A HREF="009822.html">[squid-users] gzip deflate
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9819">[ date ]</a>
              <a href="thread.html#9819">[ thread ]</a>
              <a href="subject.html#9819">[ subject ]</a>
              <a href="author.html#9819">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
