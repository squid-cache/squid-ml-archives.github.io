<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Negotiate wrappter returns AF = on Debian Jessie
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Negotiate%20wrappter%20returns%20AF%20%3D%20on%20Debian%20Jessie&In-Reply-To=%3C990e2a8c65134281a95e860ef1f7abf4%40City-Exch-DB2.cbj.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009836.html">
   <LINK REL="Next"  HREF="009884.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Negotiate wrappter returns AF = on Debian Jessie</H1>
    <B>James Zuelow</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Negotiate%20wrappter%20returns%20AF%20%3D%20on%20Debian%20Jessie&In-Reply-To=%3C990e2a8c65134281a95e860ef1f7abf4%40City-Exch-DB2.cbj.local%3E"
       TITLE="[squid-users] Negotiate wrappter returns AF = on Debian Jessie">James.Zuelow at juneau.org
       </A><BR>
    <I>Thu Mar 17 18:29:19 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009836.html">[squid-users] Squid with ICAP filter?
</A></li>
        <LI>Next message (by thread): <A HREF="009884.html">[squid-users] Negotiate wrappter returns AF = on Debian Jessie
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9829">[ date ]</a>
              <a href="thread.html#9829">[ thread ]</a>
              <a href="subject.html#9829">[ subject ]</a>
              <a href="author.html#9829">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello -

I have Squid 3.4.8 installed on Debian Jessie.

I'm using the negotiate wrapper configured like this:

auth_param negotiate program /usr/lib/squid3/negotiate_wrapper_auth -d \
   --kerberos /usr/lib/squid3/negotiate_kerberos_auth -s HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.domain.local at DOMAIN.LOCAL</A> \
   --ntlm /usr/bin/ntlm_auth --helper-protocol=gss-spnego --domain=DOMAIN.LOCAL

The proxy works as intended - authentication happens, and usernames are logged for users that authenticate via Kerberos.

However my logs don't show user names for anyone that authenticates via NTLM.  The user name is replaced with an asterisk.

I am testing by configuring my browser to use the FQDN of the proxy (which results in Kerberos authentication) or by using the IP address (which results in NTLM).

Anyway, cache log does show the username but it is apparently in the wrong location to be parsed into the access log:

2016/03/16 16:38:29| negotiate_wrapper: Return 'AF = * james_zuelow
'

This is a problem for me, as my organization wants the username in the log.

Researching the issue I found this:

<A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/negotiate-wrapper-Return-AF-username-td4674765.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/negotiate-wrapper-Return-AF-username-td4674765.html</A>

In which Amos says this was fixed &quot;a long while back.&quot;  My google-fu is not strong enough to discover an upstream fix for this issue though.

I want to submit a bug report to Debian that says &quot;please apply this fix to Jessie, and the fix can be found at X.&quot;

Can you help me find X?

Specific versions of Squid and Samba are:  Squid3 3.4.8-6+deb8u1 and Samba/Winbind 4.1.17+dsfg-2+deb8u2.

Thanks!


James Zuelow
Systems Operations Manager
City and Borough of Juneau - MIS
(907) 586-0236


-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160317/ef4f2350/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160317/ef4f2350/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009836.html">[squid-users] Squid with ICAP filter?
</A></li>
	<LI>Next message (by thread): <A HREF="009884.html">[squid-users] Negotiate wrappter returns AF = on Debian Jessie
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9829">[ date ]</a>
              <a href="thread.html#9829">[ thread ]</a>
              <a href="subject.html#9829">[ subject ]</a>
              <a href="author.html#9829">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
