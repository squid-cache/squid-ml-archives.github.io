<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Does reload_into_ims not effective for HTTPS?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Does%20reload_into_ims%20not%20effective%20for%20HTTPS%3F&In-Reply-To=%3C56EC0D17.8080201%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009844.html">
   <LINK REL="Next"  HREF="009846.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Does reload_into_ims not effective for HTTPS?</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Does%20reload_into_ims%20not%20effective%20for%20HTTPS%3F&In-Reply-To=%3C56EC0D17.8080201%40gmail.com%3E"
       TITLE="[squid-users] Does reload_into_ims not effective for HTTPS?">yvoinov at gmail.com
       </A><BR>
    <I>Fri Mar 18 14:13:43 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009844.html">[squid-users] Does reload_into_ims not effective for HTTPS?
</A></li>
        <LI>Next message (by thread): <A HREF="009846.html">[squid-users] Does reload_into_ims not effective for HTTPS?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9845">[ date ]</a>
              <a href="thread.html#9845">[ thread ]</a>
              <a href="subject.html#9845">[ subject ]</a>
              <a href="author.html#9845">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256
 


18.03.16 19:42, Amos Jeffries &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> On 18/03/2016 11:49 p.m., Yuri Voinov wrote:
</I>&gt;&gt;<i> Hi gents,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I see strange behaviour for many URL's.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Im my setups reload_into_ims is on globally.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This time I see:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> - when I pressed Ctrl+F5 in browsers, for HTTP URLs
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> TCP_REFRESH_UNMODIFIED/200 6447 GET
</I>&gt;&gt;<i>
</I><A HREF="http://icdn.lenta.ru/images/2016/03/17/09/20160317091221731/tabloid_8a08b3a372ff4499c0d95723ad4dc382.jpg">http://icdn.lenta.ru/images/2016/03/17/09/20160317091221731/tabloid_8a08b3a372ff4499c0d95723ad4dc382.jpg</A>
&gt;&gt;<i> - ORIGINAL_DST/81.19.76.10 image/jpeg
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> occurs.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> - when I goes under HTTPS for the same URLs, i see TCP_MISS:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> TCP_MISS/200 6447 GET
</I>&gt;&gt;<i>
</I><A HREF="https://icdn.lenta.ru/images/2016/03/17/09/20160317091221731/tabloid_8a08b3a372ff4499c0d95723ad4dc382.jpg">https://icdn.lenta.ru/images/2016/03/17/09/20160317091221731/tabloid_8a08b3a372ff4499c0d95723ad4dc382.jpg</A>
&gt;&gt;<i> - ORIGINAL_DST/81.19.76.10 image/jpeg
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> When I've test HTTPS URL with redbot, I've seen no problem with caching
</I>&gt;&gt;<i> content:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="http://i.imgur.com/9dm7VWV.png">http://i.imgur.com/9dm7VWV.png</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> As you can see, this site is news, with no private headers and no
</I>&gt;&gt;<i> authentication.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> What's up? Is it bug or documented behaviour? I see absolutely no
</I>&gt;&gt;<i> problem with caching either http or https versions of URL.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> What headers are on the two requests?
</I>
root @ cthulhu /patch # wget -S
<A HREF="http://icdn.lenta.ru/images/2016/03/17/09/20160317091221731/tabloid_8a08b3a372ff4499c0d95723ad4dc382.jpg">http://icdn.lenta.ru/images/2016/03/17/09/20160317091221731/tabloid_8a08b3a372ff4499c0d95723ad4dc382.jpg</A>
- --2016-03-18 19:44:56-- 
<A HREF="http://icdn.lenta.ru/images/2016/03/17/09/20160317091221731/tabloid_8a08b3a372ff4499c0d95723ad4dc382.jpg">http://icdn.lenta.ru/images/2016/03/17/09/20160317091221731/tabloid_8a08b3a372ff4499c0d95723ad4dc382.jpg</A>
Connecting to 127.0.0.1:3128... connected.
Proxy request sent, awaiting response...
  HTTP/1.1 200 OK
  Content-Type: image/jpeg
  Content-Length: 5308
  Accept-Ranges: bytes
  Server: nginx
  Date: Fri, 18 Mar 2016 10:50:33 GMT
  Last-Modified: Thu, 17 Mar 2016 06:12:22 GMT
  ETag: &quot;56ea4ac6-14bc&quot;
  Cache-Control: max-age=604800
  Age: 10463
  X-Cache: HIT from cthulhu
  X-Cache-Lookup: HIT from cthulhu:3128
  Connection: keep-alive
Length: 5308 (5.2K) [image/jpeg]
Saving to: 'tabloid_8a08b3a372ff4499c0d95723ad4dc382.jpg'

tabloid_8a08b3a372f 100%[=====================&gt;]   5.18K  --.-KB/s   in
0s  

2016-03-18 19:44:56 (70.4 MB/s) -
'tabloid_8a08b3a372ff4499c0d95723ad4dc382.jpg' saved [5308/5308]

root @ cthulhu /patch # wget -S
<A HREF="https://icdn.lenta.ru/images/2016/03/17/09/20160317091221731/tabloid_8a08b3a372ff4499c0d95723ad4dc382.jpg">https://icdn.lenta.ru/images/2016/03/17/09/20160317091221731/tabloid_8a08b3a372ff4499c0d95723ad4dc382.jpg</A>
- --2016-03-18 19:45:18-- 
<A HREF="https://icdn.lenta.ru/images/2016/03/17/09/20160317091221731/tabloid_8a08b3a372ff4499c0d95723ad4dc382.jpg">https://icdn.lenta.ru/images/2016/03/17/09/20160317091221731/tabloid_8a08b3a372ff4499c0d95723ad4dc382.jpg</A>
Connecting to 127.0.0.1:3128... connected.
Proxy request sent, awaiting response...
  HTTP/1.1 200 OK
  Server: nginx
  Date: Fri, 18 Mar 2016 13:45:19 GMT
  Content-Type: image/jpeg
  Content-Length: 5308
  Last-Modified: Thu, 17 Mar 2016 06:12:22 GMT
  Connection: keep-alive
  ETag: &quot;56ea4ac6-14bc&quot;
  Cache-Control: max-age=604800
  Accept-Ranges: bytes
Length: 5308 (5.2K) [image/jpeg]
Saving to: 'tabloid_8a08b3a372ff4499c0d95723ad4dc382.jpg.1'

tabloid_8a08b3a372f 100%[=====================&gt;]   5.18K  --.-KB/s   in
0s  

2016-03-18 19:45:19 (630 MB/s) -
'tabloid_8a08b3a372ff4499c0d95723ad4dc382.jpg.1' saved [5308/5308]

root @ cthulhu /patch # wget -S
<A HREF="https://icdn.lenta.ru/images/2016/03/17/09/20160317091221731/tabloid_8a08b3a372ff4499c0d95723ad4dc382.jpg">https://icdn.lenta.ru/images/2016/03/17/09/20160317091221731/tabloid_8a08b3a372ff4499c0d95723ad4dc382.jpg</A>
- --2016-03-18 19:45:42-- 
<A HREF="https://icdn.lenta.ru/images/2016/03/17/09/20160317091221731/tabloid_8a08b3a372ff4499c0d95723ad4dc382.jpg">https://icdn.lenta.ru/images/2016/03/17/09/20160317091221731/tabloid_8a08b3a372ff4499c0d95723ad4dc382.jpg</A>
Connecting to 127.0.0.1:3128... connected.
Proxy request sent, awaiting response...
  HTTP/1.1 200 OK
  Server: nginx
  Date: Fri, 18 Mar 2016 13:45:42 GMT
  Content-Type: image/jpeg
  Content-Length: 5308
  Last-Modified: Thu, 17 Mar 2016 06:12:22 GMT
  Connection: keep-alive
  ETag: &quot;56ea4ac6-14bc&quot;
  Cache-Control: max-age=604800
  Accept-Ranges: bytes
Length: 5308 (5.2K) [image/jpeg]
Saving to: 'tabloid_8a08b3a372ff4499c0d95723ad4dc382.jpg.2'

tabloid_8a08b3a372f 100%[=====================&gt;]   5.18K  --.-KB/s   in
0s  

2016-03-18 19:45:42 (695 MB/s) -
'tabloid_8a08b3a372ff4499c0d95723ad4dc382.jpg.2' saved [5308/5308]



&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Did the cache contain the <A HREF="https://">https://</A> URL object prior to the refresh?
</I>Looks like this URL does not saving correctly:

root @ cthulhu / # purge -e
^https\:\/\/icdn\.lenta\.ru\/images\/2016\/03\/17\/09\/20160317091221731\/tabloid_8a08b3a372ff4499c0d95723ad4dc382\.jpg$
### Use at your own risk! No guarantees whatsoever. You were warned. ###
WARNING: open &quot;/data/cache/d1/00/C7/00018FD8&quot;: No such file or directory
^Creceived signal: Interrupt

Cache entry exists, but it is empty.

I don't want to say HTTPS completely not cached. Daily cache statistics
show:

# TCP-Request-protocol
protocol          request      %   hit-% sec/req   Byte       %   hit-%
kB/sec
- ---------------- --------- ------ ------ ------- -------- ------
------ -------
https:               48237  49.26  28.38    1.79  417322K  40.04 
25.18    4.84
&lt;secure&gt;             34253  34.98   0.00    7.77   21148K   2.03  
0.00    0.08
http:                14220  14.52  47.85    3.21  599333K  57.51 
54.06   13.11
&lt;error&gt;               1209   1.23   0.17   23.16    4332K   0.42  
0.59    0.15
- ---------------- --------- ------ ------ ------- -------- ------
------ -------
Sum                  97919 100.00  20.93    4.35 1042135K 100.00 
41.17    2.51

As you can see, byte hit is significantly high for HTTP. But for HTTPS
it two times lower in average. With agressive caching settings + store
ID using.
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBCAAGBQJW7A0WAAoJENNXIZxhPexG+lIIAKBc/8z2B0HLcU255s848K4q
jZ3FY+lnoYW1u/NjnEPSzV9NbokyDZMAmWTFdSV5oZ30klSKiLI4nGLiynlHW2z7
b5p0SmNdc9xY1YT3ZZXlEmvecfy6s1JIXvO/MRsG61F0uEdQESSYKP8k40Kur2Qw
ZcOvms/JoSmAHJzZhdeYJIikEBdLEoCmAdUAf4rEvOzLp4zbTKw+yfYpv4mumMys
TMT0PmE+pm19GrThP8ToQ8bK0l8SlTa0tO8SJSGXXdfoc3kznDifD0z9URkTAHZT
BSqPhhhg+0q1WOs3ZQUek6EkwDs0QJfGukrmqarrpYnx/NhuFB3WBdI5PZbLHBg=
=lmNM
-----END PGP SIGNATURE-----

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x613DEC46.asc
Type: application/pgp-keys
Size: 2437 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160318/aabd7708/attachment.key">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160318/aabd7708/attachment.key</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009844.html">[squid-users] Does reload_into_ims not effective for HTTPS?
</A></li>
	<LI>Next message (by thread): <A HREF="009846.html">[squid-users] Does reload_into_ims not effective for HTTPS?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9845">[ date ]</a>
              <a href="thread.html#9845">[ thread ]</a>
              <a href="subject.html#9845">[ subject ]</a>
              <a href="author.html#9845">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
