<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] caching js/css references with parameters, possible squid bug
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20caching%20js/css%20references%20with%20parameters%2C%0A%20possible%20squid%20bug&In-Reply-To=%3C56F0BF0C.7010204%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009853.html">
   <LINK REL="Next"  HREF="009880.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] caching js/css references with parameters, possible squid bug</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20caching%20js/css%20references%20with%20parameters%2C%0A%20possible%20squid%20bug&In-Reply-To=%3C56F0BF0C.7010204%40treenet.co.nz%3E"
       TITLE="[squid-users] caching js/css references with parameters, possible squid bug">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Mar 22 03:42:04 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009853.html">[squid-users] caching js/css references with parameters, possible squid bug
</A></li>
        <LI>Next message (by thread): <A HREF="009880.html">[squid-users] caching js/css references with parameters, possible squid bug
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9867">[ date ]</a>
              <a href="thread.html#9867">[ thread ]</a>
              <a href="subject.html#9867">[ subject ]</a>
              <a href="author.html#9867">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 20/03/2016 12:50 a.m., Waitman Gobble wrote:
&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On 2016-03-18 01:00, Amos Jeffries wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> On 18/03/2016 3:46 a.m., Waitman Gobble wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> When a script reference on an HTML page includes a parameter, the script
</I>&gt;&gt;&gt;<i> does not appear to be cached when using squid in accel mode (https).
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> For example,
</I>&gt;&gt;&gt;<i> &lt;script type='text/javascript'
</I>&gt;&gt;&gt;<i> src='/wp-includes/js/jquery/jquery.js?ver=1.1.13'&gt;&lt;/script&gt;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> jquery.js does not appear to be cached in that case, each page request
</I>&gt;&gt;&gt;<i> hits the originserver with a request for jquery.js. (also seems browser
</I>&gt;&gt;&gt;<i> does not cache, either).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> How are you determining that?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Dynamic content (as signalled by the '?query-string') is expected to
</I>&gt;&gt;<i> revalidate on each use unless that origin has sent explicit cacheability
</I>&gt;&gt;<i> headers. In HTTP/1.1 contact with the origin server is not always a full
</I>&gt;&gt;<i> fetch.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I was watching HTTP logs on origin server, every page request was also
</I>&gt;<i> creating request for css, js, etc.
</I>&gt;<i> 
</I>&gt;<i> waitman.net - [19/Mar/2016:03:47:04 -0700] &quot;GET
</I>&gt;<i> /wp-content/themes/mh-magazine-lite/style.css?ver=2.1.2 HTTP/1.1&quot; 200
</I>&gt;<i> 38550 &quot;-&quot;
</I>&gt;<i> 
</I>&gt;<i> After removing ?ver from html page, there was initial request:
</I>&gt;<i> 
</I>&gt;<i> waitman.net - [19/Mar/2016:03:50:15 -0700] &quot;GET
</I>&gt;<i> /wp-content/themes/mh-magazine-lite/style.css HTTP/1.1&quot; 200 38550 &quot;-&quot;
</I>&gt;<i> 
</I>&gt;<i> but after that it was served from cache and no more hits on origin.
</I>&gt;<i> 
</I>&gt;<i> Perhaps it was not doing a &quot;full request&quot;, but I was looking at the
</I>&gt;<i> content length in the logs, 38550
</I>&gt;<i> 
</I>
What you describe appears to be the visible behaviour when the URL
contains a &quot;?&quot; and the reply lacks explicit expiry information.
The requirement that Squid is obeying and its reason for existence is
documented in &lt;<A HREF="http://tools.ietf.org/html/rfc2616#section-13.9">http://tools.ietf.org/html/rfc2616#section-13.9</A>&gt; paragraph 2.

The current RFC 7230 document lifted that restriction, making it
OPTIONAL simply because the Internet has not broken too badly with very
few implementations (other than Squid) following that requirement.

Current Squid implement it in the form of the default &quot;refresh_pattern
-i (/cgibin/|\?) 0 0% 0&quot; rule - which is only used on replies lacking
Expires or Cache-Control headers. You can add a previous rule to handle
WP responses caching times if you like, or comment out that pattern if
you are certain that the situation documented by RFC 2616 is not going
to occur on *any* URL served by your Squid.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009853.html">[squid-users] caching js/css references with parameters, possible squid bug
</A></li>
	<LI>Next message (by thread): <A HREF="009880.html">[squid-users] caching js/css references with parameters, possible squid bug
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9867">[ date ]</a>
              <a href="thread.html#9867">[ thread ]</a>
              <a href="subject.html#9867">[ subject ]</a>
              <a href="author.html#9867">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
