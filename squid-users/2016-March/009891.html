<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] substituing sniproxy for squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20substituing%20sniproxy%20for%20squid&In-Reply-To=%3CCAFLo2QxUE3arFjKVCm8Y%2BU%3DngkKYkryZDMrWbVyPoVGMfZuYtA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009885.html">
   <LINK REL="Next"  HREF="009892.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] substituing sniproxy for squid</H1>
    <B>Luis Daniel Lucio Quiroz</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20substituing%20sniproxy%20for%20squid&In-Reply-To=%3CCAFLo2QxUE3arFjKVCm8Y%2BU%3DngkKYkryZDMrWbVyPoVGMfZuYtA%40mail.gmail.com%3E"
       TITLE="[squid-users] substituing sniproxy for squid">luis.daniel.lucio at gmail.com
       </A><BR>
    <I>Thu Mar 24 12:24:08 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009885.html">[squid-users] substituing sniproxy for squid
</A></li>
        <LI>Next message (by thread): <A HREF="009892.html">[squid-users] substituing sniproxy for squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9891">[ date ]</a>
              <a href="thread.html#9891">[ thread ]</a>
              <a href="subject.html#9891">[ subject ]</a>
              <a href="author.html#9891">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I understand, buggy I really need to take out this sniproxy in favor of
squid.

I'm planning that this path needs the HTTP violation flag on compile time,
and by default value is off.  So when turning on, it won't be an accident.
Host_verify_header would be a good name for this on/off option
Le 24 mars 2016 4:05 AM, &quot;Amos Jeffries&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; a &#233;crit :

&gt;<i> On 24/03/2016 3:56 p.m., Luis Daniel Lucio Quiroz wrote:
</I>&gt;<i> &gt; As A side note, I am reading the code seems file
</I>&gt;<i> &gt; src/client_side_request.cc function
</I>&gt;<i> &gt; ClientRequestContext::hostHeaderVerify() is responsible for this.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; And to be exact this option:
</I>&gt;<i> &gt;     if (ia != NULL &amp;&amp; ia-&gt;count &gt; 0) {
</I>&gt;<i> &gt;        // Is the NAT destination IP in DNS?
</I>&gt;<i> &gt;        for (int i = 0; i &lt; ia-&gt;count; ++i) {
</I>&gt;<i> &gt;            if (clientConn-&gt;local.matchIPAddr(ia-&gt;in_addrs[i]) == 0) {
</I>&gt;<i> &gt;                debugs(85, 3, HERE &lt;&lt; &quot;validate IP &quot; &lt;&lt; clientConn-&gt;local
</I>&gt;<i> &lt;&lt;
</I>&gt;<i> &gt; &quot; possible from Host:&quot;);
</I>&gt;<i> &gt;                http-&gt;request-&gt;flags.hostVerified = true;
</I>&gt;<i> &gt;                http-&gt;doCallouts();
</I>&gt;<i> &gt;                return;
</I>&gt;<i> &gt;            }
</I>&gt;<i> &gt;            debugs(85, 3, HERE &lt;&lt; &quot;validate IP &quot; &lt;&lt; clientConn-&gt;local &lt;&lt; &quot;
</I>&gt;<i> &gt; non-match from Host: IP &quot; &lt;&lt; ia-&gt;in_addrs[i]);
</I>&gt;<i> &gt;        }
</I>&gt;<i> &gt;    }
</I>&gt;<i> &gt;    debugs(85, 3, HERE &lt;&lt; &quot;FAIL: validate IP &quot; &lt;&lt; clientConn-&gt;local &lt;&lt; &quot;
</I>&gt;<i> &gt; possible from Host:&quot;);
</I>&gt;<i> &gt;    hostHeaderVerifyFailed(&quot;local IP&quot;, &quot;any domain IP&quot;);
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; As far as I understand there is no a possible way.
</I>&gt;<i> &gt; Would you be interested on a patch to allow this behaivour optional?
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> This is the CVE-2009-0801 protection.
</I>&gt;<i>
</I>&gt;<i> Any patch altering it needs to retain that protection as there are known
</I>&gt;<i> attacks in the wild.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Also be aware that the SNI field of TLS is *not* a exact equivalent for
</I>&gt;<i> Host. SNI lacks the ability to distinguish relative vs absoute domains
</I>&gt;<i> and aternative port numbers - both of which are common occurances in
</I>&gt;<i> Host headers.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160324/7001f81a/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160324/7001f81a/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009885.html">[squid-users] substituing sniproxy for squid
</A></li>
	<LI>Next message (by thread): <A HREF="009892.html">[squid-users] substituing sniproxy for squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9891">[ date ]</a>
              <a href="thread.html#9891">[ thread ]</a>
              <a href="subject.html#9891">[ subject ]</a>
              <a href="author.html#9891">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
