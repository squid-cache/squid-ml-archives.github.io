<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] &quot;ACCESS DENIED&quot; page by ssl_bump terminate
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%22ACCESS%20DENIED%22%20page%20by%20ssl_bump%20terminate&In-Reply-To=%3C56F97718.4050204%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009924.html">
   <LINK REL="Next"  HREF="009898.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] &quot;ACCESS DENIED&quot; page by ssl_bump terminate</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%22ACCESS%20DENIED%22%20page%20by%20ssl_bump%20terminate&In-Reply-To=%3C56F97718.4050204%40measurement-factory.com%3E"
       TITLE="[squid-users] &quot;ACCESS DENIED&quot; page by ssl_bump terminate">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Mar 28 18:25:28 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009924.html">[squid-users] &quot;ACCESS DENIED&quot; page by ssl_bump terminate
</A></li>
        <LI>Next message (by thread): <A HREF="009898.html">[squid-users] squid4.07 - ale missing adapted httprequest object
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9925">[ date ]</a>
              <a href="thread.html#9925">[ thread ]</a>
              <a href="subject.html#9925">[ subject ]</a>
              <a href="author.html#9925">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 03/28/2016 12:01 PM, Yuri Voinov wrote:
&gt;<i> 28.03.16 20:59, Alex Rousskov &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;&gt;<i> On 03/27/2016 11:59 PM, Alexandr Yatskin wrote:
</I>&gt;&gt;&gt;<i> Directive &quot;deny_info&quot; didn't work when we blocked https site with option
</I>&gt;&gt;&gt;<i> &quot;ssl_bump&quot;.
</I>

&gt;&gt;<i> &quot;deny_info&quot; is not compatible with the ssl_bump &quot;terminate&quot; action. The
</I>&gt;&gt;<i> &quot;terminate&quot; action means &quot;Close client and server connections&quot;. It is
</I>&gt;&gt;<i> impossible to serve an [error] response on a closed connection.
</I>
&gt;&gt;<i> IIRC, blocking the CONNECT request (fake or real) with http_access is
</I>&gt;&gt;<i> enough to force Squid to respond with an &quot;access denied&quot; error -- Squid
</I>&gt;&gt;<i> should automatically bump the client connection (if that is still
</I>&gt;&gt;<i> possible when the CONNECT request is blocked) to serve an error response.
</I>

&gt;<i> I.e., to use deny_info bump is required?
</I>

I cannot respond to that question with a &quot;yes&quot; or &quot;no&quot; answer because
the question is imprecise and any answer is likely to mislead.


To serve an HTTP error to an SSL client, Squid has to establish an SSL
connection with that client. In SslBump environments, the latter usually
means bumping the client connection. Bumping the client connection may
happen implicitly (e.g., if http_access rules block fake or real
CONNECT) or explicitly (i.e., if an ssl_bump bump action matches during
one of the SslBump steps).

Outside of ssl-bump http_ports, it is possible to respond with a plain
Squid error to the real HTTP CONNECT request (i.e., without establishing
the SSL connection first). IIRC, older Squids used to do that in some
SslBump cases as well. If there is still such a way to do this for an
ssl-bump port, then please note that it will probably have no desirable
effect on most browsers because most browsers do not render HTTP [error]
responses to CONNECT requests.

The deny_info configuration is consulted after Squid has decided to deny
access and is generating an error page. AFAIK, the deny_info directive
itself does not affect the deny/allow decision and does not &quot;know&quot; the
context of that decision except for the ability to match the name of the
last http_access ACL evaluated (or equivalent).


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009924.html">[squid-users] &quot;ACCESS DENIED&quot; page by ssl_bump terminate
</A></li>
	<LI>Next message (by thread): <A HREF="009898.html">[squid-users] squid4.07 - ale missing adapted httprequest object
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9925">[ date ]</a>
              <a href="thread.html#9925">[ thread ]</a>
              <a href="subject.html#9925">[ subject ]</a>
              <a href="author.html#9925">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
