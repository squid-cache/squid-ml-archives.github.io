<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] cache_peer sourcehash and X-Forwarded-For
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20cache_peer%20sourcehash%20and%20X-Forwarded-For&In-Reply-To=%3C56FD2387.3050608%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="009958.html">
   <LINK REL="Next"  HREF="009960.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] cache_peer sourcehash and X-Forwarded-For</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20cache_peer%20sourcehash%20and%20X-Forwarded-For&In-Reply-To=%3C56FD2387.3050608%40treenet.co.nz%3E"
       TITLE="[squid-users] cache_peer sourcehash and X-Forwarded-For">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Mar 31 13:17:59 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="009958.html">[squid-users] cache_peer sourcehash and X-Forwarded-For
</A></li>
        <LI>Next message (by thread): <A HREF="009960.html">[squid-users] Slowly rising CPU load (eventually hits 100)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9959">[ date ]</a>
              <a href="thread.html#9959">[ thread ]</a>
              <a href="subject.html#9959">[ subject ]</a>
              <a href="author.html#9959">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/04/2016 1:33 a.m., Chandan Kumar wrote:
&gt;<i> Hello, 
</I>&gt;<i> I am using Squid 2.7 and have below question:
</I>
Please upgrade. 2.7 was end-of-life'd 5 years ago. A lot has changed in
the Internet since then.

&gt;<i> while selecting cache_peer using sourcehash, can Squid use
</I>&gt;<i> X-Forwarded-For address ?
</I>
No sourcehash is based on the real TCP connection details. Not easily
forged headers content.

&gt;<i> my requests are coming from a front end loadbalanced apache servers
</I>&gt;<i> and for selecting cache_peer , requests are going only to one peer
</I>&gt;<i> because it's taking IP of my &quot;front end loadbalanced apache&quot; instead
</I>&gt;<i> of Actual client IP which is in X-Forwarded-For.
</I>
Actually the &quot;Actual&quot; client *is* the LB. The indirect client IP is what
_might_ be found somewhere in the XFF header path sequence.


The load balancing algorithms are designed for use when Squid is the LB.
Not really when some other software is doing the LB in front of it.
sourcehash hits the limits implied by that pretty hard. Any one of the
other algorithms is more appropriate for your setup.

I suggest carp or round-robin if you just want to spread the messages
around some peers.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="009958.html">[squid-users] cache_peer sourcehash and X-Forwarded-For
</A></li>
	<LI>Next message (by thread): <A HREF="009960.html">[squid-users] Slowly rising CPU load (eventually hits 100)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9959">[ date ]</a>
              <a href="thread.html#9959">[ thread ]</a>
              <a href="subject.html#9959">[ subject ]</a>
              <a href="author.html#9959">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
