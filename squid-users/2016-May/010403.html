<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] change between squid 3.1 and 3.3.8
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20change%20between%20squid%203.1%20and%203.3.8&In-Reply-To=%3C57275F26.7070006%40developpement-durable.gouv.fr%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010400.html">
   <LINK REL="Next"  HREF="010406.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] change between squid 3.1 and 3.3.8</H1>
    <B>TRIFILETTI Frank (Adjoint au chef du DO Sud-Est / Chef du groupe expertise technique) - SG/SPSSI/CPII/DOSE/ET</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20change%20between%20squid%203.1%20and%203.3.8&In-Reply-To=%3C57275F26.7070006%40developpement-durable.gouv.fr%3E"
       TITLE="[squid-users] change between squid 3.1 and 3.3.8">Frank.Trifiletti at developpement-durable.gouv.fr
       </A><BR>
    <I>Mon May  2 14:07:34 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010400.html">[squid-users] Delay pool class 2
</A></li>
        <LI>Next message (by thread): <A HREF="010406.html">[squid-users] change between squid 3.1 and 3.3.8
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10403">[ date ]</a>
              <a href="thread.html#10403">[ thread ]</a>
              <a href="subject.html#10403">[ subject ]</a>
              <a href="author.html#10403">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Amos,

i have this error in my cache.log (no helper entry available)

2016/05/02 14:35:37.732| external_acl.cc(793) aclMatchExternal: acl=&quot;ldap_group&quot;
2016/05/02 14:35:37.732| external_acl.cc(822) aclMatchExternal: No helper entry 
available
2016/05/02 14:35:37.732| external_acl.cc(826) aclMatchExternal: ldap_group check 
user authenticated.
2016/05/02 14:35:37.732| external_acl.cc(832) aclMatchExternal: ldap_group user 
is authenticated.
2


and i read you link
&lt;<A HREF="http://wiki.squid-cache.org/SquidFaq/SquidAcl#Fast_and_Slow_ACLs">http://wiki.squid-cache.org/SquidFaq/SquidAcl#Fast_and_Slow_ACLs</A>&gt;

in my squid.conf i use a slow ACLs (external)
with one SLOW access clauses (http_access) and another one which is FAST access 
clauses (cache_peer_access)

but i made another test with the same squid.conf with squid 3.1.20 on an Ubuntu 
12.04.5 LTS it works (no DUNNO error in cache.log)

but it doesn't with squid 3.3.8 on an Ubuntu 14.04.4 LTS

the only differencies are the change of the external helper use :

1/in squid 3.3
	/usr/lib/squid3/digest_file_auth
for squid 3.1
	/usr/lib/squid3/basic_ldap_auth
2/in squid 3.3
	/usr/lib/squid3/ext_ldap_group_acl
for squid 3.1
	/usr/lib/squid3/squid_ldap_group

with same parameters, the point 1 for authentification works both 3.1 and 3.3
and for the ldap_group request

in squid 3.3
external_acl_type ldap_group ipv4 %LOGIN /usr/lib/squid3/ext_ldap_group_acl -d 
-b dc=eq,dc=fr -f &quot;(&amp;(objectclass=person)(mineqAccesInternet=%g)(uid=%u))&quot; 
myldapserver

in squid 3.1
external_acl_type ldap_group ipv4 %LOGIN /usr/lib/squid3/squid_ldap_group -d -b 
dc=eq,dc=fr -f &quot;(&amp;(objectclass=person)(mineqAccesInternet=%g)(uid=%u))&quot; myldapserver


thanks for reading me

Frank


Le 25/04/2016 20:25, &quot;&gt; Amos Jeffries (par Internet, d&#233;p&#244;t 
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>)&quot; a &#233;crit :
&gt;<i> On 26/04/2016 4:41 a.m., TRIFILETTI Frank (Adjoint au chef du DO Sud-Est
</I>&gt;<i> / Chef du groupe expertise technique) - SG/SPSSI/CPII/DOSE/ET wrote:
</I>&gt;&gt;<i> Hello Amos,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> thanks for your answer
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> my answer in the body of the message below
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Frank
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Le 23/04/2016 05:29, &quot;&gt; Amos Jeffries (par Internet, d&#233;p&#244;t
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>)&quot; a &#233;crit :
</I>&gt;&gt;&gt;<i> On 23/04/2016 2:40 a.m., FTRIF wrote:
</I>&gt;&gt;&gt;&gt;<i> Hello,
</I>&gt;&gt;&gt;&gt;<i> i have a problem using /usr/lib/squid3/ext_ldap_group_acl which
</I>&gt;&gt;&gt;&gt;<i> appears in
</I>&gt;&gt;&gt;&gt;<i> 3.3.8
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> i have a ldap attribut called InternetAccess which contains the value
</I>&gt;&gt;&gt;&gt;<i> &quot;ACCESSINTER&quot;
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> i want to make an ACL to authorize such people to surf on the net by
</I>&gt;&gt;&gt;&gt;<i> using a
</I>&gt;&gt;&gt;&gt;<i> ldap_group, built with the people who had the value ACCESSINTER in
</I>&gt;&gt;&gt;&gt;<i> the ldap
</I>&gt;&gt;&gt;&gt;<i> attribut called InternetAccess
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> in command line it works both with squid 3.1 and 3.3.8, the answer is
</I>&gt;&gt;&gt;&gt;<i> OK:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> /usr/lib/squid3/ext_ldap_group_acl -d -b dc=eq,dc=fr -f
</I>&gt;&gt;&gt;&gt;<i> &quot;(&amp;(objectclass=person)(InternetAccess=%a)(uid=%u))&quot; myLdapDNSname
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> fk.tf ACCESSINTER
</I>&gt;&gt;&gt;&gt;<i> ext_ldap_group_acl.cc(587): pid=25599 :Connected OK
</I>&gt;&gt;&gt;&gt;<i> ext_ldap_group_acl.cc(726): pid=25599 :group filter
</I>&gt;&gt;&gt;&gt;<i> '(&amp;(objectclass=person)(InternetAccess=ACCESSINTER)(uid=fk.tf))',
</I>&gt;&gt;&gt;&gt;<i> searchbase
</I>&gt;&gt;&gt;&gt;<i> 'dc=eq,dc=fr'
</I>&gt;&gt;&gt;&gt;<i> OK
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Use '%g' macro for group. It will not to collide with URL-encoding of
</I>&gt;&gt;&gt;<i> the parameters.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> in the squid.conf i forget indicate that i have a line
</I>&gt;&gt;<i> acl profil_ACCESSINTERNET external ldap_group ACCESSINTER
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> in command line i replace %a by '%g' in command line but it doesn't work
</I>&gt;&gt;<i> only if i put %g
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> but in squid.conf i put '%g' instead of %a and i have the same result
</I>&gt;&gt;<i> with in the cache.log
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 2016/04/25 18:17:25.835| Acl.cc(319) checklistMatches:
</I>&gt;&gt;<i> ACL::checklistMatches: checking 'profil_ACCESSINTERNET'
</I>&gt;&gt;<i> 2016/04/25 18:17:25.835| external_acl.cc(793) aclMatchExternal:
</I>&gt;&gt;<i> acl=&quot;ldap_group&quot;
</I>&gt;&gt;<i> 2016/04/25 18:17:25.835| external_acl.cc(822) aclMatchExternal: No
</I>&gt;&gt;<i> helper entry available
</I>&gt;&gt;<i> 2016/04/25 18:17:25.835| external_acl.cc(826) aclMatchExternal:
</I>&gt;&gt;<i> ldap_group check user authenticated.
</I>&gt;&gt;<i> 2016/04/25 18:17:25.835| external_acl.cc(832) aclMatchExternal:
</I>&gt;&gt;<i> ldap_group user is authenticated.
</I>&gt;&gt;<i> 2016/04/25 18:17:25.835| external_acl.cc(856) aclMatchExternal:
</I>&gt;&gt;<i> ldap_group(&quot;fk.tf ACCESSINTER&quot;) = lookup needed
</I>&gt;&gt;<i> 2016/04/25 18:17:25.835| external_acl.cc(858) aclMatchExternal: &quot;fk.tf
</I>&gt;&gt;<i> ACCESSINTER&quot;: entry=@0, age=0
</I>&gt;&gt;<i> 2016/04/25 18:17:25.835| external_acl.cc(861) aclMatchExternal: &quot;fk.tf
</I>&gt;&gt;<i> ACCESSINTER&quot;: queueing a call.
</I>&gt;&gt;<i> 2016/04/25 18:17:25.835| external_acl.cc(863) aclMatchExternal: &quot;fk.tf
</I>&gt;&gt;<i> ACCESSINTER&quot;: return -1.
</I>&gt;&gt;<i> 2016/04/25 18:17:25.835| Acl.cc(321) checklistMatches:
</I>&gt;&gt;<i> ACL::ChecklistMatches: result for 'profil_ACCESSINTERNET' is -1
</I>&gt;<i>
</I>&gt;<i> These lines are important:
</I>&gt;<i>
</I>&gt;&gt;<i> 2016/04/25 18:17:25.835| Acl.cc(346) matches: profil_ACCESSINTERNET
</I>&gt;&gt;<i> needs async lookup
</I>&gt;&gt;<i> 2016/04/25 18:17:25.835| Acl.cc(354) matches: profil_ACCESSINTERNET
</I>&gt;&gt;<i> result is false
</I>&gt;&gt;<i> 2016/04/25 18:30:36.709| Checklist.cc(275) matchNode: 0x7ffdc7f66fb0
</I>&gt;&gt;<i> matched=0 async=1 finished=0
</I>&gt;&gt;<i> 2016/04/25 18:30:36.709| Checklist.cc(146) markFinished: 0x7ffdc7f66fb0
</I>&gt;&gt;<i> answer DUNNO for async required but prohibited
</I>&gt;&gt;<i> 2016/04/25 18:30:36.709| Checklist.cc(308) matchNode: 0x7ffdc7f66fb0
</I>&gt;&gt;<i> DUNNO because cannot async
</I>&gt;&gt;<i> 2016/04/25 18:30:36.709| FilledChecklist.cc(77) ~ACLFilledChecklist:
</I>&gt;&gt;<i> ACLFilledChecklist destroyed 0x7ffdc7f66fb0
</I>&gt;&gt;<i> 2016/04/25 18:30:36.709| Checklist.cc(334) ~ACLChecklist:
</I>&gt;&gt;<i> ACLChecklist::~ACLChecklist: destroyed 0x7ffdc7f66fb0
</I>&gt;&gt;<i> 2016/04/25 18:30:36.709| Checklist.cc(153) preCheck: 0x7ffdc7f66fb0
</I>&gt;&gt;<i> checking fast rules
</I>&gt;&gt;<i> 2016/04/25 18:30:36.709| Checklist.cc(414) fastCheck: aclCheckFast:
</I>&gt;&gt;<i> list: 0x56353080b548
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> is it these last lines indicate the followup where the helper responds
</I>&gt;&gt;<i> you asked for ?
</I>&gt;<i>
</I>&gt;<i> Better. Those lines are saying you are using the group lookup in an
</I>&gt;<i> access control list which cannot do group lookups or any other kind of
</I>&gt;<i> delayed (async) data lookup.
</I>&gt;<i>
</I>&gt;<i> The answer is needed immediately by the access control and all Squid has
</I>&gt;<i> to work with is DUNNO / &quot;insufficient data&quot;.
</I>&gt;<i>
</I>&gt;<i> See &lt;<A HREF="http://wiki.squid-cache.org/SquidFaq/SquidAcl#Fast_and_Slow_ACLs">http://wiki.squid-cache.org/SquidFaq/SquidAcl#Fast_and_Slow_ACLs</A>&gt;
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> if not which type of text i have to search ?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> my debug_options 28,9 82,9 84,9
</I>&gt;&gt;<i> section 82 External AC
</I>&gt;&gt;<i> section 84 Helper process maintenance
</I>&gt;&gt;<i> section 28 Access Control
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Okay.
</I>&gt;<i>
</I>&gt;<i> The -d parameter on the helper command line for Squid helpers produces
</I>&gt;<i> their internal debug.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010400.html">[squid-users] Delay pool class 2
</A></li>
	<LI>Next message (by thread): <A HREF="010406.html">[squid-users] change between squid 3.1 and 3.3.8
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10403">[ date ]</a>
              <a href="thread.html#10403">[ thread ]</a>
              <a href="subject.html#10403">[ subject ]</a>
              <a href="author.html#10403">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
