<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSL Bump missing facebook app traffic (resumed SSL	sessions?)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20Bump%20missing%20facebook%20app%20traffic%20%28resumed%20SSL%0A%09sessions%3F%29&In-Reply-To=%3CD3561F85.535B7%25adam.cohen-rose%40sky.uk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010468.html">
   <LINK REL="Next"  HREF="010513.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSL Bump missing facebook app traffic (resumed SSL	sessions?)</H1>
    <B>Cohen-Rose, Adam</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20Bump%20missing%20facebook%20app%20traffic%20%28resumed%20SSL%0A%09sessions%3F%29&In-Reply-To=%3CD3561F85.535B7%25adam.cohen-rose%40sky.uk%3E"
       TITLE="[squid-users] SSL Bump missing facebook app traffic (resumed SSL	sessions?)">Adam.Cohen-Rose at sky.uk
       </A><BR>
    <I>Mon May  9 10:05:43 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010468.html">[squid-users] [squid-announce] [ADVISORY] SQUID-2016:9 Multiple Denial of Service issues in ESI Response processing.
</A></li>
        <LI>Next message (by thread): <A HREF="010513.html">[squid-users] SSL Bump missing facebook app traffic (resumed SSL sessions?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10469">[ date ]</a>
              <a href="thread.html#10469">[ thread ]</a>
              <a href="subject.html#10469">[ subject ]</a>
              <a href="author.html#10469">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi there,

We&#185;re running squid with SSL bump as a transparent proxy in order to
control access to particular SSL sites.

We&#185;ve noticed an issue with access to facebook from within the facebook
app -- specifically it can get through the proxy even though it is *not*
listed as a domain to splice. Accessing the facebook site from a web
browser is blocked as expected.

Looking at packets in Wireshark, the app traffic that gets through seems
to use a different style of SSL handshake from the web traffic as follows:

App traffic:
&gt;<i> client hello
</I>&lt; server hello, change cipher spec
  - change cipher spec message: this session reuses previously negotiated
keys (session resumption)
&lt; encrypted handshake message
&gt;<i> change cipher spec, encrypted handshake message, application data
</I>&gt;<i> application data
</I>

Web traffic:
&gt;<i> client hello
</I>&lt; server hello
&lt; certificate
&lt; server key exchange
&gt;<i> client key exchange
</I>&gt;<i> change cipher spec
</I>&gt;<i> encryped handshake message
</I>&lt; new session ticket, change cipher spec, encrypted handshake message
&gt;<i> application data
</I>


I suspect this may be the same or a similar issue referred to in the
3.5.19 release changes (TLS: Fix SSL alert message and session resume
handling) -- would someone please confirm or deny?

And if we were to upgrade to 3.5.19, is the build on Centos 6 a relatively
easy one? We&#185;ve been using Eliezer Croitoru&#185;s builds so far, but I don&#185;t
think he&#185;s had time to make the latest build yet!


For reference, the relevant parts of our squid configuration are as
follows:

https_port {squid-ip}:443 cert=/path/to/cert key=/path/to/key
sslflags=NO_DEFAULT_CA intercept ssl-bump
acl to_teads_tv_ssl ssl::server_name .teads.tv
ssl_bump splice to_teads_tv_ssl

acl hello at_step SslBump1 SslBump2
ssl_bump peek hello
ssl_bump terminate all



Thank you for your help!

Adam

Information in this email including any attachments may be privileged, confidential and is intended exclusively for the addressee. The views expressed may not be official policy, but the personal views of the originator. If you have received it in error, please notify the sender by return e-mail and delete it from your system. You should not reproduce, distribute, store, retransmit, use or disclose its contents to anyone. Please note we reserve the right to monitor all e-mail communication through our internal and external networks. SKY and the SKY marks are trademarks of Sky plc and Sky International AG and are used under licence. Sky UK Limited (Registration No. 2906991), Sky-In-Home Service Limited (Registration No. 2067075) and Sky Subscribers Services Limited (Registration No. 2340150) are direct or indirect subsidiaries of Sky plc (Registration No. 2247735). All of the companies mentioned in this paragraph are incorporated in England and Wales and share the same registered office at Grant Way, Isleworth, Middlesex TW7 5QD.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010468.html">[squid-users] [squid-announce] [ADVISORY] SQUID-2016:9 Multiple Denial of Service issues in ESI Response processing.
</A></li>
	<LI>Next message (by thread): <A HREF="010513.html">[squid-users] SSL Bump missing facebook app traffic (resumed SSL sessions?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10469">[ date ]</a>
              <a href="thread.html#10469">[ thread ]</a>
              <a href="subject.html#10469">[ subject ]</a>
              <a href="author.html#10469">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
