<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSL Bump missing facebook app traffic (resumed SSL sessions?)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20Bump%20missing%20facebook%20app%20traffic%20%28resumed%0A%20SSL%20sessions%3F%29&In-Reply-To=%3Cf435a75d-ee78-c8d5-05ed-6d10bc0dbb11%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010469.html">
   <LINK REL="Next"  HREF="010470.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSL Bump missing facebook app traffic (resumed SSL sessions?)</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20Bump%20missing%20facebook%20app%20traffic%20%28resumed%0A%20SSL%20sessions%3F%29&In-Reply-To=%3Cf435a75d-ee78-c8d5-05ed-6d10bc0dbb11%40treenet.co.nz%3E"
       TITLE="[squid-users] SSL Bump missing facebook app traffic (resumed SSL sessions?)">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue May 10 12:41:30 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010469.html">[squid-users] SSL Bump missing facebook app traffic (resumed SSL	sessions?)
</A></li>
        <LI>Next message (by thread): <A HREF="010470.html">[squid-users] Can Traffic Management Settings be configured for	other TCP protocols?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10513">[ date ]</a>
              <a href="thread.html#10513">[ thread ]</a>
              <a href="subject.html#10513">[ subject ]</a>
              <a href="author.html#10513">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 9/05/2016 10:05 p.m., Cohen-Rose, Adam wrote:
&gt;<i> Hi there,
</I>&gt;<i> 
</I>&gt;<i> We&#185;re running squid with SSL bump as a transparent proxy in order to
</I>&gt;<i> control access to particular SSL sites.
</I>&gt;<i> 
</I>&gt;<i> We&#185;ve noticed an issue with access to facebook from within the facebook
</I>&gt;<i> app -- specifically it can get through the proxy even though it is *not*
</I>&gt;<i> listed as a domain to splice. Accessing the facebook site from a web
</I>&gt;<i> browser is blocked as expected.
</I>&gt;<i> 
</I>&gt;<i> Looking at packets in Wireshark, the app traffic that gets through seems
</I>&gt;<i> to use a different style of SSL handshake from the web traffic as follows:
</I>&gt;<i> 
</I>&gt;<i> App traffic:
</I>&gt;&gt;<i> client hello
</I>&gt;<i> &lt; server hello, change cipher spec
</I>&gt;<i>   - change cipher spec message: this session reuses previously negotiated
</I>&gt;<i> keys (session resumption)
</I>&gt;<i> &lt; encrypted handshake message
</I>&gt;&gt;<i> change cipher spec, encrypted handshake message, application data
</I>&gt;&gt;<i> application data
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Web traffic:
</I>&gt;&gt;<i> client hello
</I>&gt;<i> &lt; server hello
</I>&gt;<i> &lt; certificate
</I>&gt;<i> &lt; server key exchange
</I>&gt;&gt;<i> client key exchange
</I>&gt;&gt;<i> change cipher spec
</I>&gt;&gt;<i> encryped handshake message
</I>&gt;<i> &lt; new session ticket, change cipher spec, encrypted handshake message
</I>&gt;&gt;<i> application data
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I suspect this may be the same or a similar issue referred to in the
</I>&gt;<i> 3.5.19 release changes (TLS: Fix SSL alert message and session resume
</I>&gt;<i> handling) -- would someone please confirm or deny?
</I>&gt;<i> 
</I>
Not sure enough to answer that Q sorry. But if you are bumping at all
you should upgrade anyway. The problem(s) that it fixes are relatively
common even if they are not the specific one you noticed.


&gt;<i> And if we were to upgrade to 3.5.19, is the build on Centos 6 a relatively
</I>&gt;<i> easy one? We&#185;ve been using Eliezer Croitoru&#185;s builds so far, but I don&#185;t
</I>&gt;<i> think he&#185;s had time to make the latest build yet!
</I>
He should be doing it real soon now, if not already done and just
testing to make sure it works okay.

&gt;<i> 
</I>&gt;<i> For reference, the relevant parts of our squid configuration are as
</I>&gt;<i> follows:
</I>&gt;<i> 
</I>&gt;<i> https_port {squid-ip}:443 cert=/path/to/cert key=/path/to/key
</I>&gt;<i> sslflags=NO_DEFAULT_CA intercept ssl-bump
</I>
FYI: &quot;intercept ssl-bump&quot; should be the first options on the line after
the port. It doesn't matter in 3.x, but will in the future versions as
the mode determines how the following cert/key options are interpreted
and ssl-bump determines what type of properties the cert requires.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010469.html">[squid-users] SSL Bump missing facebook app traffic (resumed SSL	sessions?)
</A></li>
	<LI>Next message (by thread): <A HREF="010470.html">[squid-users] Can Traffic Management Settings be configured for	other TCP protocols?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10513">[ date ]</a>
              <a href="thread.html#10513">[ thread ]</a>
              <a href="subject.html#10513">[ subject ]</a>
              <a href="author.html#10513">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
