<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Getting the full file content on a range request,	but not on EVERY get ...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Getting%20the%20full%20file%20content%20on%20a%20range%20request%2C%0A%09but%20not%20on%20EVERY%20get%20...&In-Reply-To=%3C2575073.4c7f0552JP%40xrated%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010608.html">
   <LINK REL="Next"  HREF="010578.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Getting the full file content on a range request,	but not on EVERY get ...</H1>
    <B>Hans-Peter Jansen</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Getting%20the%20full%20file%20content%20on%20a%20range%20request%2C%0A%09but%20not%20on%20EVERY%20get%20...&In-Reply-To=%3C2575073.4c7f0552JP%40xrated%3E"
       TITLE="[squid-users] Getting the full file content on a range request,	but not on EVERY get ...">hpj at urpla.net
       </A><BR>
    <I>Thu May 12 14:06:40 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010608.html">[squid-users] Getting the full file content on a range request, but not on EVERY get ...
</A></li>
        <LI>Next message (by thread): <A HREF="010578.html">[squid-users] Getting the full file content on a range request, but not on EVERY get ...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10576">[ date ]</a>
              <a href="thread.html#10576">[ thread ]</a>
              <a href="subject.html#10576">[ subject ]</a>
              <a href="author.html#10576">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mittwoch, 11. Mai 2016 21:37:17 Heiler Bemerguy wrote:
&gt;<i> Hey guys,
</I>&gt;<i> 
</I>&gt;<i> First take a look at the log:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at proxy</A>:/var/log/squid# tail -f access.log |grep
</I>&gt;<i> <A HREF="http://download.cdn.mozilla.net/pub/firefox/releases/45.0.1/update/win32/pt-">http://download.cdn.mozilla.net/pub/firefox/releases/45.0.1/update/win32/pt-</A>&gt; BR/firefox-45.0.1.complete.mar 1463011781.572   8776 10.1.3.236 TCP_MISS/206
</I>&gt;<i> 300520 GET
</I>[...] 
&gt;<i> Now think: An user is just doing a segmented/ranged download, right?
</I>&gt;<i> Squid won't cache the file because it is a range-download, not a full
</I>&gt;<i> file download.
</I>&gt;<i> But I WANT squid to cache it. So I decide to use &quot;range_offset_limit
</I>&gt;<i> -1&quot;, but then on every GET squid will re-download the file from the
</I>&gt;<i> beginning, opening LOTs of simultaneous connections and using too much
</I>&gt;<i> bandwidth, doing just the OPPOSITE it's meant to!
</I>&gt;<i> 
</I>&gt;<i> Is there a smart way to allow squid to download it from the beginning to
</I>&gt;<i> the end (to actually cache it), but only on the FIRST request/get? Even
</I>&gt;<i> if it makes the user wait for the full download, or cancel it
</I>&gt;<i> temporarily, or.. whatever!! Anything!!
</I>
Well, this is exactly, what my squid_dedup helper was created for!

See my announcement: 

	Subject: [squid-users] New StoreID helper: squid_dedup
	Date: Mon, 09 May 2016 23:56:45 +0200

My openSUSE environment is fetching _all_ updates with byte-ranges from many 
servers. Therefor, I created squid_dedup.

Your specific config could look like this:

/etc/squid/dedup/mozilla.conf:
[mozilla]
match: http\:\/\/download\.cdn\.mozilla\.net/(.*)
replace: <A HREF="http://download.cdn.mozilla.net.%(intdomain">http://download.cdn.mozilla.net.%(intdomain</A>)s/\1
fetch: true

The fetch parameter is unique among the other StoreID helper (AFAIK): it is 
fetching the object after a certain delay with a pool of fetcher threads.

The idea is: after the first access for an object, wait a bit (global setting, 
default: 15 secs), and then fetch the whole thing once. It won't solve 
anything for the first client, but for all subsequent accesses. 

The fetcher avoids fetching anything more than once by checking the http 
headers.

This is a pretty new project, but be assured, that the basic functions are 
working fine, and I will do my best to solve any upcoming issues. It is 
implemented with Python3 and prepared for supporting additional features 
easily, while keeping a good part of an eye on efficiency.

Let me know, if you're going to try it.

Pete

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010608.html">[squid-users] Getting the full file content on a range request, but not on EVERY get ...
</A></li>
	<LI>Next message (by thread): <A HREF="010578.html">[squid-users] Getting the full file content on a range request, but not on EVERY get ...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10576">[ date ]</a>
              <a href="thread.html#10576">[ thread ]</a>
              <a href="subject.html#10576">[ subject ]</a>
              <a href="author.html#10576">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
