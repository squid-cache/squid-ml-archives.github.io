<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3.5.17 SSL-Bump Step1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.17%20SSL-Bump%20Step1&In-Reply-To=%3Cb2edf9ca-40a3-c529-6694-98231996d722%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010639.html">
   <LINK REL="Next"  HREF="010648.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3.5.17 SSL-Bump Step1</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.17%20SSL-Bump%20Step1&In-Reply-To=%3Cb2edf9ca-40a3-c529-6694-98231996d722%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid 3.5.17 SSL-Bump Step1">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon May 16 08:34:29 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010639.html">[squid-users] Squid 3.5.17 SSL-Bump Step1
</A></li>
        <LI>Next message (by thread): <A HREF="010648.html">[squid-users] Squid 3.5.17 SSL-Bump Step1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10644">[ date ]</a>
              <a href="thread.html#10644">[ thread ]</a>
              <a href="subject.html#10644">[ subject ]</a>
              <a href="author.html#10644">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 16/05/2016 5:48 p.m., admin wrote:
&gt;<i> Hi!
</I>&gt;<i> 
</I>&gt;<i> Squid 3.5.17 with SSL, intercept.
</I>
Please upgrade to 3.5.19.

&gt;<i> 
</I>&gt;<i> I use SSL-Bump only step1 that get SNI and terminate HTTPS sites by
</I>&gt;<i> domain name. The certificate's is not replaced !
</I>
The certificate is never replaced. Though if you dont know how TLS works
and look at it only from the client perspective it can appear to be so.
The reality is you either have one TLS connection or two with different
certificates on each.

&gt;<i> 
</I>&gt;<i> acl blocked_https ssl::server_name  &quot;/etc/squid/urls/block-url&quot;
</I>&gt;<i> https_port 3129 intercept ssl-bump options=ALL:NO_SSLv3:NO_SSLv2
</I>&gt;<i> connection-auth=off cert=/etc/squid/squidCA.pem
</I>&gt;<i> acl step1 at_step SslBump1
</I>&gt;<i> ssl_bump peek step1
</I>&gt;<i> ssl_bump terminate blocked_https
</I>&gt;<i> 
</I>&gt;<i> It works.
</I>
Obviously not. There is no instruction what to do other than terminate.
Squid is left to other circumstances to decide what is needed...

&gt;<i> 
</I>&gt;<i> But if I use
</I>&gt;<i> 
</I>&gt;<i> acl users_no_inet src &quot;/etc/squid/ip-groups/no-inet&quot;
</I>&gt;<i> http_access deny users_no_inet
</I>
... you force bumping to happen in order to deliver the HTTP error message.

Try adding this rule above the peek (and the ACL line too):
  ssl_bump terminate users_no_inet


&gt;<i> 
</I>&gt;<i> I see NET::ERR_CERT_AUTHORITY_INVALID in browser. I import my squid
</I>&gt;<i> cert, but I see NET::ERR_CERT_COMMON_NAME_INVALID
</I>&gt;<i> 
</I>&gt;<i> Why in this case, the squid trying to replace the certificate?
</I>
There is no server connection or certificate in existence. So nothing
exists to be replaced.

What you are seeing is Squid using its own certificate to get a TLS
connection it can deliver the HTTP error message through.


Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010639.html">[squid-users] Squid 3.5.17 SSL-Bump Step1
</A></li>
	<LI>Next message (by thread): <A HREF="010648.html">[squid-users] Squid 3.5.17 SSL-Bump Step1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10644">[ date ]</a>
              <a href="thread.html#10644">[ thread ]</a>
              <a href="subject.html#10644">[ subject ]</a>
              <a href="author.html#10644">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
