<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3.5.17 SSL-Bump Step1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.17%20SSL-Bump%20Step1&In-Reply-To=%3C573A1E84.1070100%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010648.html">
   <LINK REL="Next"  HREF="010662.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3.5.17 SSL-Bump Step1</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.17%20SSL-Bump%20Step1&In-Reply-To=%3C573A1E84.1070100%40measurement-factory.com%3E"
       TITLE="[squid-users] Squid 3.5.17 SSL-Bump Step1">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon May 16 19:24:52 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010648.html">[squid-users] Squid 3.5.17 SSL-Bump Step1
</A></li>
        <LI>Next message (by thread): <A HREF="010662.html">[squid-users] Squid 3.5.17 SSL-Bump Step1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10655">[ date ]</a>
              <a href="thread.html#10655">[ thread ]</a>
              <a href="subject.html#10655">[ subject ]</a>
              <a href="author.html#10655">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 05/16/2016 04:47 AM, admin wrote:
&gt;&gt;&gt;<i> acl blocked_https ssl::server_name  &quot;/etc/squid/urls/block-url&quot;
</I>&gt;&gt;&gt;<i> https_port 3129 intercept ssl-bump options=ALL:NO_SSLv3:NO_SSLv2
</I>&gt;&gt;&gt;<i> connection-auth=off cert=/etc/squid/squidCA.pem
</I>&gt;&gt;&gt;<i> acl step1 at_step SslBump1
</I>&gt;&gt;&gt;<i> ssl_bump peek step1
</I>&gt;&gt;&gt;<i> ssl_bump terminate blocked_https
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> It works.
</I>
&gt;&gt;<i> Obviously not. There is no instruction what to do other than terminate.
</I>&gt;&gt;<i> Squid is left to other circumstances to decide what is needed...
</I>
&gt;<i> it works! :) if you have the opportunity to check on the virtual machine
</I>
Your configuration works by accident. You should not expect it to work
across Squid upgrades, for example. It may continue to work or may stop
working. To fix the problem, be explicit regarding what to do when the
terminate rule does not match:

  ssl_bump peek step1
  ssl_bump terminate blocked_https
  ssl_bump splice all



&gt;<i> http_access deny users_no_inet
</I>
&gt;<i> Why, if access is
</I>&gt;<i> allowed everything works, and if the ban on access to HTTP, you must
</I>&gt;<i> first see a message stating that my certificate has not been able to
</I>&gt;<i> match, and then later ERR_ACCESS_DENIED.
</I>

When access is allowed, Squid works as a TCP relay. Client bytes are
sent to the origin server. Server bytes are sent to the client. No
errors or certificates to worry about.

When access is prohibited via http_access deny, Squid needs to send an
&quot;Access Denied&quot; error response to the user (this is how http_access
works). To send that error to the user, Squid needs to establish a
secure connection with the user (this is how HTTPS works). To do that,
Squid has to use its own SSL certificate (this is how SSL works).


If you want to use a splice-or-terminate design, do not deny access via
http_access. Limit yourself to &quot;ssl_bump terminate&quot; rules.


HTH,

Alex.




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010648.html">[squid-users] Squid 3.5.17 SSL-Bump Step1
</A></li>
	<LI>Next message (by thread): <A HREF="010662.html">[squid-users] Squid 3.5.17 SSL-Bump Step1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10655">[ date ]</a>
              <a href="thread.html#10655">[ thread ]</a>
              <a href="subject.html#10655">[ subject ]</a>
              <a href="author.html#10655">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
