<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid transfers much not requested data from uplink in specific cases
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20transfers%20much%20not%20requested%20data%20from%20uplink%0A%20in%20specific%20cases&In-Reply-To=%3C1463474363.19289.67.camel%40comnet.uz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010674.html">
   <LINK REL="Next"  HREF="010677.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid transfers much not requested data from uplink in specific cases</H1>
    <B>Garri Djavadyan</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20transfers%20much%20not%20requested%20data%20from%20uplink%0A%20in%20specific%20cases&In-Reply-To=%3C1463474363.19289.67.camel%40comnet.uz%3E"
       TITLE="[squid-users] Squid transfers much not requested data from uplink in specific cases">garryd at comnet.uz
       </A><BR>
    <I>Tue May 17 08:39:23 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010674.html">[squid-users] Squid unable to send full PNG file
</A></li>
        <LI>Next message (by thread): <A HREF="010677.html">[squid-users] explicit forward proxy to server requring client	authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10664">[ date ]</a>
              <a href="thread.html#10664">[ thread ]</a>
              <a href="subject.html#10664">[ subject ]</a>
              <a href="author.html#10664">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Squid community,

According to the bug report 4511 [1], Squid may transfer much useless,
not requested data from uplink after specific sequence of actions.

For example, slow client (access rate 128Kb/s) may begin transfer of
big cacheable object (4GB). After some time, another client (access
rate 1Mb/s) may begin to transfer the same object. Depending on time
interval between the requests (or the volume to data cached to disk by
the first transfer), after some time, transfer rate of the second
client will be limited to 128Kb/s too [2]. If after some time the first
client aborts the transfer, the second client's rate recovers to 1Mb/s
and Squid begin to transfer the object from origin server to disk cache
at maximum rate the uplink permits (let's assume 100Mb/s).

If the second client also aborts the transfer after some time, it may
results in much not requested data transferred from uplink. Also, if
Squid doesn't finish to transfer the object to the disk cache, the
object won't be cached finally.

For example, if the first client aborts the transfer after downloading
100MB, Squid begins to transfer the object at rate 100Mb/s. If after 4
minutes, the second client also aborts the transfer, Squid would
terminate the transfer from origin server and we get is the following
statistics:

Client #1 - 100MB
Client #2 - 100MB + 1Mb/s / 8 bits * 240 seconds = 130MB
Squid - 100MB + 100Mb/s / 8 bits * 240 seconds = 3100MB
Not requested / useless data = 3100MB - (100MB + 130MB) = 2870MB

In that scenario, Squid would get 2870MB useless data that would not be
cached (object's size 4GB). During these 4 minutes, 'Hits as % bytes
sent' counter would show extremely low value.

[1]&#160;<A HREF="http://bugs.squid-cache.org/show_bug.cgi?id=4511">http://bugs.squid-cache.org/show_bug.cgi?id=4511</A>
[2]&#160;<A HREF="http://bugs.squid-cache.org/show_bug.cgi?id=4520">http://bugs.squid-cache.org/show_bug.cgi?id=4520</A>

------------

So, I want to ask community to share ideas, best practice to cope with
the problem. Many thank in advance!

-- 
Garri Djavadyan &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">garryd at comnet.uz</A>&gt;
Comnet ISP


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010674.html">[squid-users] Squid unable to send full PNG file
</A></li>
	<LI>Next message (by thread): <A HREF="010677.html">[squid-users] explicit forward proxy to server requring client	authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10664">[ date ]</a>
              <a href="thread.html#10664">[ thread ]</a>
              <a href="subject.html#10664">[ subject ]</a>
              <a href="author.html#10664">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
