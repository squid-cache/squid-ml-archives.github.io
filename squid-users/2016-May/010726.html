<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid 3.5.19, wccp2, pf and forwarding loop
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%203.5.19%2C%20wccp2%2C%20pf%20and%20forwarding%20loop&In-Reply-To=%3C5742D53F.3010303%40ecs.vuw.ac.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010723.html">
   <LINK REL="Next"  HREF="010719.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid 3.5.19, wccp2, pf and forwarding loop</H1>
    <B>Mark Davies</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%203.5.19%2C%20wccp2%2C%20pf%20and%20forwarding%20loop&In-Reply-To=%3C5742D53F.3010303%40ecs.vuw.ac.nz%3E"
       TITLE="[squid-users] squid 3.5.19, wccp2, pf and forwarding loop">mark at ecs.vuw.ac.nz
       </A><BR>
    <I>Mon May 23 10:02:39 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010723.html">[squid-users] squid 3.5.19, wccp2, pf and forwarding loop
</A></li>
        <LI>Next message (by thread): <A HREF="010719.html">[squid-users] CPU Load 100% after implementing SSL Bump ....
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10726">[ date ]</a>
              <a href="thread.html#10726">[ thread ]</a>
              <a href="subject.html#10726">[ subject ]</a>
              <a href="author.html#10726">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 23/05/16 19:32, Amos Jeffries wrote:
&gt;<i> There are two other things to check then.
</I>&gt;<i>
</I>&gt;<i> Firstly, if the router receiving the wm0 traffic is the one doing WCCP
</I>&gt;<i>   divert into Squid. It needs a similar excemption of that outgoing traffic.
</I>
Its a different router.

&gt;<i> Secondly,
</I>&gt;<i>   in squid.conf enable &quot;debug_options 28,4&quot; and see what it logs in
</I>&gt;<i> cache.log about the bnx0 interface.
</I>&gt;<i>   I suspect Squid might be detecting it as a non-Ethernet interface and
</I>&gt;<i> so not pulling the IP details correctly from the NAT.
</I>
Given the amount of ordinary squid traffic going through the box it was
difficult to separate the log entries for the intercepted traffic from 
all the others, but this did point me at &quot;debug_options 89,9&quot; which 
showed me the actual problem.

When building I had &quot;--enable-pf-transparent&quot; but not
&quot;--with-nat-devpf&quot;.  Adding the second fixed the problem.

cheers
mark

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010723.html">[squid-users] squid 3.5.19, wccp2, pf and forwarding loop
</A></li>
	<LI>Next message (by thread): <A HREF="010719.html">[squid-users] CPU Load 100% after implementing SSL Bump ....
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10726">[ date ]</a>
              <a href="thread.html#10726">[ thread ]</a>
              <a href="subject.html#10726">[ subject ]</a>
              <a href="author.html#10726">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
