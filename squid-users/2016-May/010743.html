<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ERROR: Collapsed forwarding queue overflow for kid2 at 1024 items
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ERROR%3A%20Collapsed%20forwarding%20queue%20overflow%20for%0A%20kid2%20at%201024%20items&In-Reply-To=%3C5745D342.8020101%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010742.html">
   <LINK REL="Next"  HREF="010734.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ERROR: Collapsed forwarding queue overflow for kid2 at 1024 items</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ERROR%3A%20Collapsed%20forwarding%20queue%20overflow%20for%0A%20kid2%20at%201024%20items&In-Reply-To=%3C5745D342.8020101%40measurement-factory.com%3E"
       TITLE="[squid-users] ERROR: Collapsed forwarding queue overflow for kid2 at 1024 items">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed May 25 16:30:58 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010742.html">[squid-users] ERROR: Collapsed forwarding queue overflow for kid2 at 1024 items
</A></li>
        <LI>Next message (by thread): <A HREF="010734.html">[squid-users] Excessive TCP memory usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10743">[ date ]</a>
              <a href="thread.html#10743">[ thread ]</a>
              <a href="subject.html#10743">[ subject ]</a>
              <a href="author.html#10743">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 05/24/2016 02:32 PM, Amos Jeffries wrote:
&gt;<i> On 25/05/2016 5:46 a.m., Heiler Bemerguy wrote:
</I>&gt;&gt;<i> Is this normal?
</I>
&gt;<i> Depends on your normal.
</I>
&gt;<i> AIUI, that &quot;ERROR:&quot; message means thehre are more than 1024 concurrent
</I>&gt;<i> transactions being collapsed by your proxy and the overflowed one is
</I>&gt;<i> failing.
</I>
This is a CF notification queue overflow, not CF table overflow. The
size of the former is hard-coded to 1K. In trunk, the size of the latter
is configurable via collapsed_forwarding_shared_entries_limit and
defaults to 16K.

CF queue overflow is usually a sign of one or more of these problems:

1. UDS messages informing workers about certain important queue events
are being lost. This is likely if you have not configured your OS UDS
memory [correctly]. Unfortunately, Squid does not complain about lost
UDS messages [loudly enough].

2. Squid workers processing queued notifications get blocked on
something. This is likely if Squid is overloaded, running out of RAM,
and/or using blocking cache_dirs.

3. Squid workers processing queued notifications are slower than workers
adding new notifications. This is unlikely, especially if all workers
are configured the same.

4. Squid bugs.

If you can reproduce the problem, enabling UDS logging may help (debug
options ALL,1 54,7), but you will need to sift through a lot of messages
(or find somebody willing to look at your logs).


HTH,

Alex.

&gt;&gt;<i> conf:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> client_idle_pconn_timeout 30 seconds
</I>&gt;&gt;<i> client_persistent_connections on
</I>&gt;&gt;<i> server_persistent_connections on
</I>&gt;&gt;<i> collapsed_forwarding on
</I>




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010742.html">[squid-users] ERROR: Collapsed forwarding queue overflow for kid2 at 1024 items
</A></li>
	<LI>Next message (by thread): <A HREF="010734.html">[squid-users] Excessive TCP memory usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10743">[ date ]</a>
              <a href="thread.html#10743">[ thread ]</a>
              <a href="subject.html#10743">[ subject ]</a>
              <a href="author.html#10743">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
