<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] The system returned: (111) Connection refused;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20The%20system%20returned%3A%20%28111%29%20Connection%20refused%3B&In-Reply-To=%3C3afef1dd-8027-32a1-fd5d-ae1184898f64%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010749.html">
   <LINK REL="Next"  HREF="010759.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] The system returned: (111) Connection refused;</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20The%20system%20returned%3A%20%28111%29%20Connection%20refused%3B&In-Reply-To=%3C3afef1dd-8027-32a1-fd5d-ae1184898f64%40treenet.co.nz%3E"
       TITLE="[squid-users] The system returned: (111) Connection refused;">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri May 27 12:13:33 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010749.html">[squid-users] The system returned: (111) Connection refused;
</A></li>
        <LI>Next message (by thread): <A HREF="010759.html">[squid-users] The system returned: (111) Connection refused;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10754">[ date ]</a>
              <a href="thread.html#10754">[ thread ]</a>
              <a href="subject.html#10754">[ subject ]</a>
              <a href="author.html#10754">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 27/05/2016 8:55 p.m., deepa ganu wrote:
&gt;<i> Hi
</I>&gt;<i> I am using squid as a reverse.
</I>&gt;<i> 
</I>&gt;<i> #http_port  80 accel defaultsite=202.53.13.19
</I>&gt;<i> https_port 443 accel  cert=/var/www/html/webrtc/imp/teleuniv.net.crt
</I>&gt;<i> key=/var/www/html/webrtc/imp/teleuniv.net.key
</I>&gt;<i> cafile=/var/www/html/webrtc/imp/intermediate.crt defaultsite=202.53.13.19
</I>&gt;<i> no-vhost
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> #this ACL is url path specific which accepts only portal urls and deny
</I>&gt;<i> others.
</I>&gt;<i> acl portal urlpath_regex ^/portal6may
</I>&gt;<i> cache_peer 172.20.36.144 parent 80 0 no-query originserver name=portalserver
</I>&gt;<i> cache_peer_access portalserver allow portal
</I>&gt;<i> cache_peer_access portalserver deny all
</I>&gt;<i> http_access allow portal
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> cache_peer 172.20.36.150 parent 443 0 no-query originserver ssl
</I>&gt;<i> sslflags=DONT_VERIFY_PEER login=PASS connection-auth=off name=teleuniv
</I>&gt;<i> acl our_sites dstdomain 202.53.13.19
</I>&gt;<i> http_access allow our_sites
</I>&gt;<i> cache_peer_access teleuniv allow our_sites
</I>&gt;<i> cache_peer_access teleuniv deny all
</I>&gt;<i> 
</I>&gt;<i> SO when i try to access the url <A HREF="https://202.53.13.19/">https://202.53.13.19/</A> I get the following
</I>&gt;<i> error
</I>&gt;<i> &quot;The following error was encountered while trying to retrieve the URL: The
</I>&gt;<i> system returned: (111) Connection refused; The remote host or network may
</I>&gt;<i> be down. Please try the request again.&quot;
</I>&gt;<i> 
</I>&gt;<i> It only gives for 172.20.36.144 not for the urlpath acl.
</I>
You have configured Squid to:

 1) &quot;no-vhost&quot; - ignore the Host header the client sent indicating what
domain name it was contacting.

 2) defaultsite=202.53.13.19 - use &quot;202.53.13.19&quot; as the domain *name*
for all requests received through that https_port.

Why would you expect to see anything other than <A HREF="https://202.53.13.19">https://202.53.13.19</A> in
the URL when you have configured those?


&gt;<i> But this happens
</I>&gt;<i> only sometimes. When I physically go to that server (172.20.36.150) and
</I>&gt;<i> click on the wired connection (one of the LAN options using linux). It
</I>&gt;<i> works again. I am very confused
</I>
Your use of &quot;physically&quot; seems to be incorrect. You walked up to the
machine hardware and did what ?

&quot;Clicking&quot; seems to be that you logged in (not physically) and changed
something which affected how Squid was able to connect to it.


All traffic with the domain name &quot;202.53.13.19&quot; and not the path
&quot;/portal6may&quot; gets sent to the second cache_peer (172.20.36.150).

So what do you expect to happen when the server 172.20.36.150 receives a
request with Host: header domain name set to &quot;202.53.13.19&quot;  ?


It seems like the servers connectivity is a bit flakey and getting
disconnected occasionally. But the wrong Squid configuration could be
hiding some other issue.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010749.html">[squid-users] The system returned: (111) Connection refused;
</A></li>
	<LI>Next message (by thread): <A HREF="010759.html">[squid-users] The system returned: (111) Connection refused;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10754">[ date ]</a>
              <a href="thread.html#10754">[ thread ]</a>
              <a href="subject.html#10754">[ subject ]</a>
              <a href="author.html#10754">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
