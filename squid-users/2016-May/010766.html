<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] DNS lookup fails initially for FQDN in squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20DNS%20lookup%20fails%20initially%20for%20FQDN%20in%20squid&In-Reply-To=%3C3d45aa71-3275-2d9d-7d6b-d3829cb4728a%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010763.html">
   <LINK REL="Next"  HREF="010764.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] DNS lookup fails initially for FQDN in squid</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20DNS%20lookup%20fails%20initially%20for%20FQDN%20in%20squid&In-Reply-To=%3C3d45aa71-3275-2d9d-7d6b-d3829cb4728a%40treenet.co.nz%3E"
       TITLE="[squid-users] DNS lookup fails initially for FQDN in squid">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat May 28 11:38:00 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="010763.html">[squid-users] DNS lookup fails initially for FQDN in squid
</A></li>
        <LI>Next message (by thread): <A HREF="010764.html">[squid-users] DNS lookup fails initially for FQDN in squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10766">[ date ]</a>
              <a href="thread.html#10766">[ thread ]</a>
              <a href="subject.html#10766">[ subject ]</a>
              <a href="author.html#10766">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 28/05/2016 4:49 a.m., Antony Stone wrote:
&gt;<i> On Friday 27 May 2016 at 17:51:36, Aashima Madaan wrote:
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i> So, does the problem exist if you:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 1. Stop Squid
</I>&gt;&gt;&gt;<i> 2. Type &quot;host short.domain.name&quot; to resolve the ICAP server manually
</I>&gt;&gt;&gt;<i> 3. Start Squid
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> (The last two commands in as quick succession as possible - preferably on
</I>&gt;&gt;&gt;<i> a single line separated by a semi-colon)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> yes the problem still exists
</I>&gt;<i> 
</I>&gt;<i> That tells me that the problem is not DNS, then.
</I>&gt;<i> 
</I>&gt;<i> Command 2 verifies that DNS resolution is working.
</I>&gt;<i> 
</I>&gt;<i> Command 3 results in the problem.
</I>&gt;<i> 
</I>&gt;<i> Therefore whatever is causing the problem is not DNS.
</I>
What is causing the problem is that ICAP services need to be working
*immediately* and do not wait for DNS results to come back. If they are
not available immediately then the service is not contactable for that
transaction.

Adding /etc/hosts entries makes Squid load the name+IP details on
startup before ICAP is used. So the problem does not appear.

Also, once Squid has looked it up and got the IP back operations with
the ICAP service will start to succeed.

&gt;<i> 
</I>&gt;&gt;<i> on additional debugging by switching on tcpflow, I see squid sends
</I>&gt;&gt;<i> OPTIONS request to icap server and that is when it is able to resolve
</I>&gt;&gt;<i> DNS and which brings the service up in 3 minutes.
</I>&gt;<i> 
</I>&gt;<i> Have you tried running some sort of packet tracer (eg: wireshark) to check 
</I>&gt;<i> when Squid is sending the DNS request, where it is sending it to, and whether 
</I>&gt;<i> it gets a response?
</I>&gt;<i> 
</I>&gt;&gt;<i>  Address.cc(389) lookupHostIP: Given Non-IP 'short.domain.name': Name
</I>&gt;&gt;<i> or service not known
</I>&gt;<i> 
</I>&gt;<i> Can anyone else shed some light on what this particular message means?
</I>&gt;<i> 
</I>
That is Squid checking to see if the ICAP hostname is a raw-IP. It is
not, so that correctly wont succeed.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="010763.html">[squid-users] DNS lookup fails initially for FQDN in squid
</A></li>
	<LI>Next message (by thread): <A HREF="010764.html">[squid-users] DNS lookup fails initially for FQDN in squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10766">[ date ]</a>
              <a href="thread.html#10766">[ thread ]</a>
              <a href="subject.html#10766">[ subject ]</a>
              <a href="author.html#10766">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
