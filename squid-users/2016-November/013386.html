<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Looking to trigger reply_on_error with custom header
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Looking%20to%20trigger%20reply_on_error%20with%20custom%20header&In-Reply-To=%3CCAGYOVV0dp1gDnAmrt8MBia2nXK4we%3Do0KBEK6c5gb-03QKOERw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013387.html">
   <LINK REL="Next"  HREF="013388.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Looking to trigger reply_on_error with custom header</H1>
    <B>Daniel Dormont</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Looking%20to%20trigger%20reply_on_error%20with%20custom%20header&In-Reply-To=%3CCAGYOVV0dp1gDnAmrt8MBia2nXK4we%3Do0KBEK6c5gb-03QKOERw%40mail.gmail.com%3E"
       TITLE="[squid-users] Looking to trigger reply_on_error with custom header">dan at greywallsoftware.com
       </A><BR>
    <I>Mon Nov  7 15:48:44 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013387.html">[squid-users] squid HIT and Cisco ACL
</A></li>
        <LI>Next message (by thread): <A HREF="013388.html">[squid-users] Looking to trigger reply_on_error with custom header
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13386">[ date ]</a>
              <a href="thread.html#13386">[ thread ]</a>
              <a href="subject.html#13386">[ subject ]</a>
              <a href="author.html#13386">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

My team uses Squid to proxy and cache certain external content in our
web platform. Now, we are looking to use it to cache images that come
from the Google Static Maps API. Sometimes, however, these images fail
to load properly, but unfortunately they do not respond with any of
the usual HTTP error codes. Instead, Google simply attaches a custom
header to the response:
<A HREF="https://developers.google.com/maps/documentation/static-maps/error-messages#warnings">https://developers.google.com/maps/documentation/static-maps/error-messages#warnings</A>

So, basically, the request will return a 200 OK, and the response body
will be a valid image, but it'll have this extra header:

x-staticmap-api-warning:Failed to fetch image url
<A HREF="http://download.example.com/mapicons/1">http://download.example.com/mapicons/1</A>

This should be a transient error, so what I'd like to do is use
Squid's retry_on_error option to have it just silently fetch the
upstream image again, but customize what &quot;error&quot; means in this case to
handle this extra header that Google sends in what's otherwise a 200
Ok response.

Unfortunately I'm not all that familiar with Squid at this point. Is
such a thing even possible? If so, where would I begin?

thanks,
Dan Dormont

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013387.html">[squid-users] squid HIT and Cisco ACL
</A></li>
	<LI>Next message (by thread): <A HREF="013388.html">[squid-users] Looking to trigger reply_on_error with custom header
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13386">[ date ]</a>
              <a href="thread.html#13386">[ thread ]</a>
              <a href="subject.html#13386">[ subject ]</a>
              <a href="author.html#13386">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
