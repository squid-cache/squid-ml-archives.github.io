<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Kerberos authentication for squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Kerberos%20authentication%20for%20squid&In-Reply-To=%3C85f4d2f8-7abe-2c51-8aad-72400667d1fe%40astron.yasar.com.tr%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013407.html">
   <LINK REL="Next"  HREF="013419.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Kerberos authentication for squid</H1>
    <B>Tevfik Ceydeliler</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Kerberos%20authentication%20for%20squid&In-Reply-To=%3C85f4d2f8-7abe-2c51-8aad-72400667d1fe%40astron.yasar.com.tr%3E"
       TITLE="[squid-users] Kerberos authentication for squid">tevfik.ceydeliler at astron.yasar.com.tr
       </A><BR>
    <I>Fri Nov 11 06:50:06 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013407.html">[squid-users] providing content on a intermittent connection
</A></li>
        <LI>Next message (by thread): <A HREF="013419.html">[squid-users] Kerberos authentication for squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13408">[ date ]</a>
              <a href="thread.html#13408">[ thread ]</a>
              <a href="subject.html#13408">[ subject ]</a>
              <a href="author.html#13408">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I try to configure squid by using AD authentication via Kerberos.

And I have a keytab by using msktutil  (PROXY.keytab)

I can run kinit, klist, wbinfo (-g, -u, -t) commands without any error.

here is my authparam configuration:

########################################################

### negotiate kerberos and ntlm authentication
#auth_param negotiate program 
/usr/local/squid/libexec/negotiate_wrapper_auth --ntlm 
/usr/bin/ntlm_auth --diagnostics --helper-protocol=squid-2.5-ntlmssp 
--domain=DOMAIN --kerberos /usr/local/squid/libexec/$
auth_param negotiate program 
/usr/local/squid/libexec/negotiate_kerberos_auth -d -s GSS_C_NO_NAME
auth_param negotiate children 250
auth_param negotiate keep_alive off

### pure ntlm authentication
auth_param ntlm program /usr/bin/ntlm_auth 
--helper-protocol=squid-2.5-ntlmssp
auth_param ntlm children 100
auth_param ntlm keep_alive on

### provide basic authentication via ldap for clients not authenticated 
via kerberos/ntlm
auth_param basic program /usr/local/squid/libexec/basic_ldap_auth -R -b 
&quot;dc=domain,dc=grp&quot; -D <A HREF="https://lists.squid-cache.org/listinfo/squid-users">otpcheck at domain.grp</A> -W 
/usr/local/squid/etc/ldappass.txt -f sAMAccountName=%s -h ldapsrv
auth_param basic children 100
auth_param basic realm Internet Proxy
auth_param basic credentialsttl 1 minute

### ldap authorisation
#external_acl_type nt_group %LOGIN 
/usr/local/squid/libexec/ext_ldap_group_acl -d -R -K -b 
&quot;dc=domain,dc=grp&quot; -D <A HREF="https://lists.squid-cache.org/listinfo/squid-users">otpcheck at domain.grp</A> -W 
/usr/local/squid/etc/ldappass.txt -f &quot;(&amp;(objectclass=person)(sAMAccount$
external_acl_type nt_group ttl=1800 negative_ttl=900 children-max=150 
children-startup=10 %LOGIN /usr/local/squid/libexec/ext_ldap_group_acl 
-R -K -b &quot;dc=domain,dc=grp&quot; -D <A HREF="https://lists.squid-cache.org/listinfo/squid-users">otpcheck at domain.grp</A> -W /usr/local/s$

#external_acl_type nt_group %LOGIN 
/usr/local/squid/libexec/ext_wbinfo_group_acl -d

authenticate_cache_garbage_interval 10 seconds
# Credentials past their TTL are removed rom memory
authenticate_ttl 0 seconds
########################################################

And here is  PROXY.keytab content:

########################################################

    4 SQUIDPNBDC1$@DOMAIN.GRP
    4 SQUIDPNBDC1$@DOMAIN.GRP
    4 SQUIDPNBDC1$@DOMAIN.GRP
    4 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">SQUIDDC1.DOMAIN.grp at DOMAIN.GRP</A>
    4 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">SQUIDDC1.DOMAIN.grp at DOMAIN.GRP</A>
    4 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">SQUIDDC1.DOMAIN.grp at DOMAIN.GRP</A>
    7 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.DOMAIN.net at DOMAIN.GRP</A>
    7 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.DOMAIN.net at DOMAIN.GRP</A>
    7 HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy.DOMAIN.net at DOMAIN.GRP</A>
    8 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squiddc1.DOMAIN.grp at DOMAIN.GRP</A>
    8 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squiddc1.DOMAIN.grp at DOMAIN.GRP</A>
    8 host/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squiddc1.DOMAIN.grp at DOMAIN.GRP</A>

#######################################################

Here is the problem,

When I set my browser proxy configuration as &quot;squiddc1.DOMAIN.grp &quot; and 
then start to browse, I cant see &quot;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">username at domain.grp</A>&quot;  log entry in 
access.log.

I think, It means that kerberos not work.

Have you any idea about that?

regards


Bu elektronik postada bulunan tum fikir ve gorusler ve ekindeki dosyalar sadece adres sahip/sahiplerine ait olup, Yasar Toplulugu Sirketleri bu mesajin icerigi ile ilgili olarak hic bir hukuksal sorumlulugu kabul etmez. Eger gonderilmesi dusunulen kisi veya kurulus degilseniz, lutfen gonderen kisiyi derhal haberdar ediniz ve mesaji sisteminizden siliniz.
The information contained in this e-mail and any files transmitted with it are intended solely for the use of the individual or entity to whom they are addressed and Yasar Group Companies do not accept legal responsibility for the contents. If you are not the intended recipient, please immediately notify the sender and delete it from your system.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013407.html">[squid-users] providing content on a intermittent connection
</A></li>
	<LI>Next message (by thread): <A HREF="013419.html">[squid-users] Kerberos authentication for squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13408">[ date ]</a>
              <a href="thread.html#13408">[ thread ]</a>
              <a href="subject.html#13408">[ subject ]</a>
              <a href="author.html#13408">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
