<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Trusted CA Certificate with ssl_bump
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Trusted%20CA%20Certificate%20with%20ssl_bump&In-Reply-To=%3C0836e44e-1db5-a647-9d3c-1539fa021930%40performance-managers.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013462.html">
   <LINK REL="Next"  HREF="013467.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Trusted CA Certificate with ssl_bump</H1>
    <B>Patrick Chemla</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Trusted%20CA%20Certificate%20with%20ssl_bump&In-Reply-To=%3C0836e44e-1db5-a647-9d3c-1539fa021930%40performance-managers.com%3E"
       TITLE="[squid-users] Trusted CA Certificate with ssl_bump">patrick.chemla at performance-managers.com
       </A><BR>
    <I>Wed Nov 16 17:33:18 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013462.html">[squid-users] Trusted CA Certificate with ssl_bump
</A></li>
        <LI>Next message (by thread): <A HREF="013467.html">[squid-users] Trusted CA Certificate with ssl_bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13466">[ date ]</a>
              <a href="thread.html#13466">[ thread ]</a>
              <a href="subject.html#13466">[ subject ]</a>
              <a href="author.html#13466">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for your answers, I am not doing anything illegal, I am trying to 
build a performant platform.

I have a big server running about 10 different websites.

I have on this server virtual machines, each specialized for one-some 
websites, and squid help me to send the traffic to the destination 
website on the internal VM according to the URL.

Some VMs are paired, so squid will loadbalance the traffic on group of 
VMs according to the URL/acls.

All this works in HTTP, thanks to Amos advices few weeks ago.

Now, I need to set SSL traffic, and because the domains are different I 
need to use different IPs:443 to be able to use different certificates.

I tried many times in the past to make squid working in SSL and never 
succeed because of so many options, and this question: Does the traffic 
between squid and the backend should be SSL? If yes, it's OK for me. 
nothing illegal.

The second question: How to set up the SSL link on squid getting the SSL 
request and sending to the backend. Actually the backend can handle SSL 
traffic, it's OK for me if I find the way to make squid handle the 
traffic, according to the acls. squid must decrypt the request, compute 
the acls, then re-crypt to send to the backend.

The reason I asked not to reencrypt is because of performances. All this 
is on the same server, from the host to the VMs and decrypt, the 
reencrypt, then decrypt will be ressources consumming. But I can do it 
like that.

Now, do you have any Howto, clear, that will help? I found many on 
Google and not any gave me the solution working.

The other question is about Trusted Certificates. We have on the 
websites trusted certificates. Should we use the same on the squid?

Thanks for appeciate help

Patrick



Le 16/11/2016 &#224; 14:27, Amos Jeffries a &#233;crit :
&gt;<i> On 16/11/2016 9:11 p.m., Patrick Chemla wrote:
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have same problem, and I need to use trusted CA certificates, so what
</I>&gt;&gt;<i> is the solution?
</I>&gt;<i> Not to do illegal bad things that violate your contract with the CA.
</I>&gt;<i>
</I>&gt;<i> Any CA which lets you intercept traffic by generating sub-certificates
</I>&gt;<i> with their root *will* be blacklisted and effectively &quot;thrown off the
</I>&gt;<i> Internet&quot;. It has happened already for several CA who thought that was
</I>&gt;<i> an idle threat.
</I>&gt;<i>
</I>&gt;&gt;<i> I have a squid 3.5.20 used for multiple domains, multiple backends,
</I>&gt;&gt;<i> using both HTTP and HTTPS.
</I>&gt;<i> As Alex said, what you describe here sounds a lot more like
</I>&gt;<i> reverse-proxy than interception.
</I>&gt;<i>
</I>&gt;<i> Sergey who started this thread was intercepting HTTPS traffic sent by
</I>&gt;<i> clients to an explicit proxy. All answers so far have been about that
</I>&gt;<i> topic, which is probably *not* what you are facing.
</I>&gt;<i>
</I>&gt;<i> The configurations and limitations are very different. So first thing to
</I>&gt;<i> do is be clear about what actually you are trying to do.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> So questions:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 1/ Should I set up the squid certificate with ONLY self-signed, or there
</I>&gt;&gt;<i> is a way to use Trusted certificates? So if only self-signed, the user
</I>&gt;&gt;<i> will be always forced to accept the self-signed certificate on first
</I>&gt;&gt;<i> time? not really good for commercial sites.
</I>&gt;&gt;<i>
</I>&gt;<i> Are you the owner of the website(s) or an authorized CDN/Hosting
</I>&gt;<i> provider for them ?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> 2/ Should the backend cache_peer set as ssl on port 443, or could it be
</I>&gt;&gt;<i> simple http 80 (backends are internal VMs onto the same server, no
</I>&gt;&gt;<i> external network between squid and backends)?
</I>&gt;&gt;<i>
</I>&gt;<i> That depends on your answer to the above.
</I>&gt;<i>
</I>&gt;&gt;<i> 3/ Will the acls rules work OK to affect each request to the right
</I>&gt;&gt;<i> backend according to domain, even in HTTPS?
</I>&gt;&gt;<i>
</I>&gt;<i> Yes. But the detail may not be what you expect. It depends on the above
</I>&gt;<i> answers.
</I>&gt;<i>
</I>&gt;&gt;<i> 4/ Do you know some clear and easy howto, examples, for such settings,
</I>&gt;&gt;<i> from where I could get how to do?
</I>&gt;&gt;<i>
</I>&gt;<i> &lt;<A HREF="http://wiki.squid-cache.org/ConfigExamples/">http://wiki.squid-cache.org/ConfigExamples/</A>&gt; contains all of the
</I>&gt;<i> configurations you might need. But which one(s) are correct for you
</I>&gt;<i> depends on what you are actually needing to do.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013462.html">[squid-users] Trusted CA Certificate with ssl_bump
</A></li>
	<LI>Next message (by thread): <A HREF="013467.html">[squid-users] Trusted CA Certificate with ssl_bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13466">[ date ]</a>
              <a href="thread.html#13466">[ thread ]</a>
              <a href="subject.html#13466">[ subject ]</a>
              <a href="author.html#13466">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
