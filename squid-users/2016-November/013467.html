<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Trusted CA Certificate with ssl_bump
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Trusted%20CA%20Certificate%20with%20ssl_bump&In-Reply-To=%3Cc39f667f-d13a-22f4-306f-1baecc89d059%40nanogherkin.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013466.html">
   <LINK REL="Next"  HREF="013468.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Trusted CA Certificate with ssl_bump</H1>
    <B>Alex Crow</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Trusted%20CA%20Certificate%20with%20ssl_bump&In-Reply-To=%3Cc39f667f-d13a-22f4-306f-1baecc89d059%40nanogherkin.com%3E"
       TITLE="[squid-users] Trusted CA Certificate with ssl_bump">alex at nanogherkin.com
       </A><BR>
    <I>Wed Nov 16 18:04:55 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013466.html">[squid-users] Trusted CA Certificate with ssl_bump
</A></li>
        <LI>Next message (by thread): <A HREF="013468.html">[squid-users] Trusted CA Certificate with ssl_bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13467">[ date ]</a>
              <a href="thread.html#13467">[ thread ]</a>
              <a href="subject.html#13467">[ subject ]</a>
              <a href="author.html#13467">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

On 16/11/16 17:33, Patrick Chemla wrote:
&gt;<i> Thanks for your answers, I am not doing anything illegal, I am trying to
</I>&gt;<i> build a performant platform.
</I>&gt;<i> 
</I>&gt;<i> I have a big server running about 10 different websites.
</I>&gt;<i> 
</I>&gt;<i> I have on this server virtual machines, each specialized for one-some
</I>&gt;<i> websites, and squid help me to send the traffic to the destination
</I>&gt;<i> website on the internal VM according to the URL.
</I>&gt;<i> 
</I>&gt;<i> Some VMs are paired, so squid will loadbalance the traffic on group of
</I>&gt;<i> VMs according to the URL/acls.
</I>&gt;<i> 
</I>&gt;<i> All this works in HTTP, thanks to Amos advices few weeks ago.
</I>&gt;<i> 
</I>&gt;<i> Now, I need to set SSL traffic, and because the domains are different I
</I>&gt;<i> need to use different IPs:443 to be able to use different certificates.
</I>&gt;<i> 
</I>&gt;<i> I tried many times in the past to make squid working in SSL and never
</I>&gt;<i> succeed because of so many options, and this question: Does the traffic
</I>&gt;<i> between squid and the backend should be SSL? If yes, it's OK for me.
</I>&gt;<i> nothing illegal.
</I>&gt;<i> 
</I>&gt;<i> The second question: How to set up the SSL link on squid getting the SSL
</I>&gt;<i> request and sending to the backend. Actually the backend can handle SSL
</I>&gt;<i> traffic, it's OK for me if I find the way to make squid handle the
</I>&gt;<i> traffic, according to the acls. squid must decrypt the request, compute
</I>&gt;<i> the acls, then re-crypt to send to the backend.
</I>&gt;<i> 
</I>&gt;<i> The reason I asked not to reencrypt is because of performances. All this
</I>&gt;<i> is on the same server, from the host to the VMs and decrypt, the
</I>&gt;<i> reencrypt, then decrypt will be ressources consumming. But I can do it
</I>&gt;<i> like that.
</I>&gt;<i> 
</I>&gt;<i> Now, do you have any Howto, clear, that will help? I found many on
</I>&gt;<i> Google and not any gave me the solution working.
</I>&gt;<i> 
</I>&gt;<i> The other question is about Trusted Certificates. We have on the
</I>&gt;<i> websites trusted certificates. Should we use the same on the squid?
</I>&gt;<i> 
</I>&gt;<i> Thanks for appeciate help
</I>&gt;<i> 
</I>&gt;<i> Patrick
</I>&gt;<i> 
</I>&gt;<i> 
</I>
You are using a reverse proxy/web accelerator setup. Nothing you do
there will be illegal if you're using it for your own servers! You
should be able to use HTTP to the backend and just offer HTTPS from
squid. This will avoid loading the backend with encryption cycles. You
don't need any certificate generation as AFAIK you already have all the
certs you need.

See:

<A HREF="http://wiki.squid-cache.org/SquidFaq/ReverseProxy">http://wiki.squid-cache.org/SquidFaq/ReverseProxy</A>

for starters. You can adapt the wildcard example; if you have specific
certs for each domain, just listen on a different IP for each domain and
set up multiple https_port with a different listening IP for each site.
If you have a wildcard cert, ie *.mydomain.com, follow it directly.

Here's a couple more:

<A HREF="http://wiki.univention.com/index.php?title=Cool_Solution_-_Squid_as_Reverse_SSL_Proxy">http://wiki.univention.com/index.php?title=Cool_Solution_-_Squid_as_Reverse_SSL_Proxy</A>

(I found the above with a simple google for &quot;squid reverse ssl proxy&quot;.
Google is your friend here... )

<A HREF="http://www.squid-cache.org/Doc/config/https_port/">http://www.squid-cache.org/Doc/config/https_port/</A>

That's as far as my knowledge goes on reverse in Squid, at my site we
use nginx.But AFAIK if you're doing what I think you're doing that
should be enough. Squid does have a lot of config parameters, but then
so does any other fully capable proxy server. Just focus on the parts
you need for your role and it will be much easier. Specifically ignore
bump/peek+splice, it's just for forward proxy.

Alex

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013466.html">[squid-users] Trusted CA Certificate with ssl_bump
</A></li>
	<LI>Next message (by thread): <A HREF="013468.html">[squid-users] Trusted CA Certificate with ssl_bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13467">[ date ]</a>
              <a href="thread.html#13467">[ thread ]</a>
              <a href="subject.html#13467">[ subject ]</a>
              <a href="author.html#13467">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
