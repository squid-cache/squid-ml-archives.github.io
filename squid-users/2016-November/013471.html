<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] unexpected debug output
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20unexpected%20debug%20output&In-Reply-To=%3CBN6PR17MB1140F6A85C18A2DA73FBB0B2F7B10%40BN6PR17MB1140.namprd17.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013469.html">
   <LINK REL="Next"  HREF="013472.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] unexpected debug output</H1>
    <B>senor</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20unexpected%20debug%20output&In-Reply-To=%3CBN6PR17MB1140F6A85C18A2DA73FBB0B2F7B10%40BN6PR17MB1140.namprd17.prod.outlook.com%3E"
       TITLE="[squid-users] unexpected debug output">frio_cervesa at hotmail.com
       </A><BR>
    <I>Thu Nov 17 07:15:29 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013469.html">[squid-users] clt_conn_tag and url_rewrite_program
</A></li>
        <LI>Next message (by thread): <A HREF="013472.html">[squid-users] unexpected debug output
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13471">[ date ]</a>
              <a href="thread.html#13471">[ thread ]</a>
              <a href="subject.html#13471">[ subject ]</a>
              <a href="author.html#13471">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I discovered that 'squid -k rotate' toggles cache.log output into full debug mode as if I had done 'squid -k debug'.  Execute a second rotate and it toggles debug off. This only happens when I have an ecap adapter configured. Comment out those lines and everything works as expected.

My question is about the debug behavior. If this isn't a bug, I'd like to understand the reason rotate would do this. There are no errors when parsing or in normal operation. The ecap adapter works except for a memory leak. Someone is looking into that. I've found it necessary to execute a reconfigure to ensure debugging is off.


squid.conf has 'debug_options ALL,1'.

'squid -k reconfigure' corrects the logging.

Tried with logfile_rotate 0, 1 and 10.

Rotating the log just ends up filling the next log to max and squid halts.

I've run 3.5.19 with same results. Will be trying 22 when I get a minute.

Any ideas are appreciated.


Version and options:

squid -v
Squid Cache: Version 3.5.17
Service Name: squid
configure options:  '--enable-ecap' '--disable-arch-native' '--with-openssl' '--enable-ssl' '--enable-ltdl-convenience' '--enable-linux-netfilter' '--enable-auth' '--with-libcap' '--with-default-user=squid' '--sysconfdir=/etc/squid' '--with-logdir=/var/log/squid' '--with-swapdir=/var/spool/squid' '--enable-wccpv2' '--enable-ssl-crtd'


I don't see anything interesting in these first logged lines after executing 'squid -k rotate':

2016/11/16 21:42:22| Set Current Directory to /var/spool/squid
2016/11/16 21:42:22.952 kid1| storeDirWriteCleanLogs: Starting...
2016/11/16 21:42:22.953 kid1| 6,5| disk.cc(71) file_open: file_open: FD 10
2016/11/16 21:42:22.953 kid1| 51,3| fd.cc(198) fd_open: fd_open() FD 10 /var/spool/squid/swap.state.clean
2016/11/16 21:42:22.953 kid1| 47,3| ufs/UFSSwapDir.cc(978) writeCleanStart: opened /var/spool/squid/swap.state.clean, FD 10
2016/11/16 21:42:22.953 kid1| 6,5| disk.cc(126) file_close: file_close: FD 228 really closing

2016/11/16 21:42:22.953 kid1| 51,3| fd.cc(93) fd_close: fd_close FD 228 /var/spool/squid/swap.state
2016/11/16 21:42:22.953 kid1| 5,5| ModEpoll.cc(116) SetSelect: FD 228, type=1, handler=0, client_data=0, timeout=0
2016/11/16 21:42:22.953 kid1| 5,5| ModEpoll.cc(116) SetSelect: FD 228, type=2, handler=0, client_data=0, timeout=0
2016/11/16 21:42:22.953 kid1| 47,3| ufs/UFSSwapDir.cc(753) closeLog: Cache Dir #0 log closed on FD 228
2016/11/16 21:42:22.953 kid1| 21,2| disk.cc(503) xrename: xrename: renaming /var/spool/squid/swap.state.clean to /var/spool/squid/swap.state
2016/11/16 21:42:22.953 kid1| 6,5| disk.cc(71) file_open: file_open: FD 12
2016/11/16 21:42:22.953 kid1| 51,3| fd.cc(198) fd_open: fd_open() FD 12 /var/spool/squid/swap.state.last-clean
2016/11/16 21:42:22.954 kid1| 6,5| disk.cc(126) file_close: file_close: FD 12 really closing

2016/11/16 21:42:22.954 kid1| 51,3| fd.cc(93) fd_close: fd_close FD 12 /var/spool/squid/swap.state.last-clean
2016/11/16 21:42:22.954 kid1| 5,5| ModEpoll.cc(116) SetSelect: FD 12, type=1, handler=0, client_data=0, timeout=0
2016/11/16 21:42:22.954 kid1| 5,5| ModEpoll.cc(116) SetSelect: FD 12, type=2, handler=0, client_data=0, timeout=0
2016/11/16 21:42:22.954 kid1| 6,5| disk.cc(126) file_close: file_close: FD 10 really closing

2016/11/16 21:42:22.954 kid1| 51,3| fd.cc(93) fd_close: fd_close FD 10 /var/spool/squid/swap.state.clean
2016/11/16 21:42:22.954 kid1| 5,5| ModEpoll.cc(116) SetSelect: FD 10, type=1, handler=0, client_data=0, timeout=0
2016/11/16 21:42:22.954 kid1| 5,5| ModEpoll.cc(116) SetSelect: FD 10, type=2, handler=0, client_data=0, timeout=0
2016/11/16 21:42:22.954 kid1| 6,5| disk.cc(71) file_open: file_open: FD 10
2016/11/16 21:42:22.954 kid1| 51,3| fd.cc(198) fd_open: fd_open() FD 10 /var/spool/squid/swap.state
2016/11/16 21:42:22.954 kid1| 50,3| ufs/UFSSwapDir.cc(735) openLog: Cache Dir #0 log opened on FD 10
2016/11/16 21:42:22.954 kid1|   Finished.  Wrote 3677 entries.

Thanks for any help.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20161117/1c2948fd/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20161117/1c2948fd/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013469.html">[squid-users] clt_conn_tag and url_rewrite_program
</A></li>
	<LI>Next message (by thread): <A HREF="013472.html">[squid-users] unexpected debug output
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13471">[ date ]</a>
              <a href="thread.html#13471">[ thread ]</a>
              <a href="subject.html#13471">[ subject ]</a>
              <a href="author.html#13471">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
