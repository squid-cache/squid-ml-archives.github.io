<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Trusted CA Certificate with ssl_bump
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Trusted%20CA%20Certificate%20with%20ssl_bump&In-Reply-To=%3C6eceb328-19ad-f08e-f56e-7bd17bd2e8dc%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013518.html">
   <LINK REL="Next"  HREF="013460.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Trusted CA Certificate with ssl_bump</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Trusted%20CA%20Certificate%20with%20ssl_bump&In-Reply-To=%3C6eceb328-19ad-f08e-f56e-7bd17bd2e8dc%40treenet.co.nz%3E"
       TITLE="[squid-users] Trusted CA Certificate with ssl_bump">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Nov 21 11:36:09 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013518.html">[squid-users] Trusted CA Certificate with ssl_bump
</A></li>
        <LI>Next message (by thread): <A HREF="013460.html">[squid-users] Trusted CA Certificate with ssl_bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13519">[ date ]</a>
              <a href="thread.html#13519">[ thread ]</a>
              <a href="subject.html#13519">[ subject ]</a>
              <a href="author.html#13519">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 21/11/2016 11:44 p.m., Patrick Chemla wrote:
&gt;<i> Hi Alex, and all others
</I>&gt;<i> 
</I>&gt;<i> No I have set it for multiple domains, and it works really fine. Again
</I>&gt;<i> many thanks.
</I>&gt;<i> 
</I>&gt;<i> But I have a new demand:
</I>&gt;<i> 
</I>&gt;<i> Within one of the sites, where squid handles the https connexion then
</I>&gt;<i> communicate with internal VM through http, there is one (at least, maybe
</I>&gt;<i> we will find others), I don't kmow why, but the dev want them http only.
</I>&gt;<i> 
</I>&gt;<i> When I come to the menu to this page, the app returns a <A HREF="http://">http://</A> link to
</I>&gt;<i> squid. Squid encrypts and send a <A HREF="https://">https://</A> to the browser.,
</I>
No. Squid does nothing to the response payload.

What you are seeing as a &quot;problem&quot; is a natural side effect of telling
the origin server it is being contacted over plain-text HTTP.


&gt;<i> but then when
</I>&gt;<i> the user hit the link, somme of the components of the page should stay
</I>&gt;<i> <A HREF="http://,">http://,</A> and there the browser detects a https page with http components
</I>&gt;<i> embeded, and block them.
</I>&gt;<i> 
</I>&gt;<i> Is there a way to tell squid to let http some link?
</I>&gt;<i> 
</I>
Squid is not doing anything to page links.


&gt;<i> My domain is domain.tld:
</I>&gt;<i> 
</I>&gt;<i> the browser ask for <A HREF="https://domain.tld">https://domain.tld</A>
</I>&gt;<i> 
</I>&gt;<i> squid decrypt, recognize this domain, according to acl goes to the VM1,
</I>&gt;<i> in <A HREF="http://">http://</A> mode, not crypted.
</I>&gt;<i> 
</I>&gt;<i> The site on VM1, return a page in <A HREF="http://">http://</A> mode, with all links as http
</I>&gt;<i> too,  and squid send it back crypted to the browser with all links
</I>&gt;<i> embeded in <A HREF="https://">https://</A>
</I>
No. You have misunderstood what is going on:

- the browser contacts domain.tld on port 443 using TLS. sends a request
for domain.tld with some path.

- squid receives on port 443 and terminates/decrypts the TLS. finding
the HTTP messge inside requesting domain.tld with some path.

- squid contacts the VM1 and requests domain.tld with some path.

- the server produces some response+payload (HTTP payload is always
opaque data N bytes long).

- squid delivers the response message+payload back to browser over the
TLS connection.

That is *all* that happens.

&gt;<i> 
</I>&gt;<i> I want a special link on the page <A HREF="http://domain.tld/special/">http://domain.tld/special/</A> to stay http.
</I>&gt;<i> 
</I>&gt;<i> How I can instruct squid to leave it as it is, but all others?
</I>
Squid is already not touching it.

Squid by design does only the *transfer* (HTTP, HTTPS, etc) part of
transferring objects around. It intentionally does not to change what
those objects are.


The browser has been coded or configured to place unusual and painful
restrictions on what its user can do with it.

 - the browser could stop being so restrictive in the things it allows
its user to do. This kind of mix-match of URLs is common on the Internet.

 - the origin server could be &quot;fixed&quot; to use relative URLs instead of
absolute. Either relative-path or relative-scheme are easily done.

 - you might use ICAP/eCAP service(s) to transcode the response objects
internal strings. But that is very difficult to get right, so there will
always be some problems ocuring.


Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013518.html">[squid-users] Trusted CA Certificate with ssl_bump
</A></li>
	<LI>Next message (by thread): <A HREF="013460.html">[squid-users] Trusted CA Certificate with ssl_bump
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13519">[ date ]</a>
              <a href="thread.html#13519">[ thread ]</a>
              <a href="subject.html#13519">[ subject ]</a>
              <a href="author.html#13519">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
