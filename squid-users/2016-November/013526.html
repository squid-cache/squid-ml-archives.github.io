<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3.5.21 &quot;hangs&quot; when trying to connect using	unsupported cipher (complete DoS)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.21%20%22hangs%22%20when%20trying%20to%20connect%20using%0A%09unsupported%20cipher%20%28complete%20DoS%29&In-Reply-To=%3C114601d2441a%2461e39930%2425aacb90%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013525.html">
   <LINK REL="Next"  HREF="013528.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3.5.21 &quot;hangs&quot; when trying to connect using	unsupported cipher (complete DoS)</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.21%20%22hangs%22%20when%20trying%20to%20connect%20using%0A%09unsupported%20cipher%20%28complete%20DoS%29&In-Reply-To=%3C114601d2441a%2461e39930%2425aacb90%24%40ngtech.co.il%3E"
       TITLE="[squid-users] Squid 3.5.21 &quot;hangs&quot; when trying to connect using	unsupported cipher (complete DoS)">eliezer at ngtech.co.il
       </A><BR>
    <I>Mon Nov 21 17:12:04 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013525.html">[squid-users] Squid 3.5.21 &quot;hangs&quot; when trying to connect using unsupported cipher (complete DoS)
</A></li>
        <LI>Next message (by thread): <A HREF="013528.html">[squid-users] Squid 3.5.21 &quot;hangs&quot; when trying to connect using unsupported cipher (complete DoS)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13526">[ date ]</a>
              <a href="thread.html#13526">[ thread ]</a>
              <a href="subject.html#13526">[ subject ]</a>
              <a href="author.html#13526">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>But what happens when you are not restricting the cipher with all this mess
in the options?
Would then also the DOS from nmap result the same issue?

Eliezer

----
Eliezer Croitoru &lt;<A HREF="http://ngtech.co.il/lmgtfy/">http://ngtech.co.il/lmgtfy/</A>&gt; 
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>
 

From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On
Behalf Of Martin Tenev
Sent: Monday, November 21, 2016 19:01
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [squid-users] Squid 3.5.21 &quot;hangs&quot; when trying to connect using
unsupported cipher (complete DoS)

Hello, 

I am having problems with squid &amp; SSL. I have setup squid in reverse-proxy
configuration and overall it works fine, however for security reasons I had
to disable some of the ciphers. I have taken an example configuration from
<A HREF="http://www.rawiriblundell.com/?p=1442">http://www.rawiriblundell.com/?p=1442</A> and my https_port line looks pretty
much like this (this is the example from the website but the disabled
ciphers are the same for me as well):

https_port  443 accel defaultsite=someinternalhost vhost
cert=/etc/squid/CertAuth/supersecret.crt
key=/etc/squid/CertAuth/supersecret.key
options=NO_SSLv2,NO_SSLv3,CIPHER_SERVER_PREFERENCE
cipher=ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES25
6-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES
128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:D
HE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC
3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256
:<i>AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT
</I>:<i>!DES:!MD5:!PSK:!RC4 dhparams=/etc/squid/CertAuth/dhparams.pem
</I>
During my build I have included the config options --enable-ssl and
--with-openssl=/usr

Using the proxy through a browser works fine, but if I try nmap --script
ssl-enum-ciphers -p 443 &lt;host&gt; or openssl s_client -cipher 'RC4-SHA'
-connect &lt;host&gt; these commands result in complete DoS for a few minutes. I
figured out that only the unsupported or disabled ciphers cause this
problem. Also when I do the openssl connection as shown above the proxy will
be unresponsive as long as openssl is trying to connect using the disabled
cipher. As soon as it finishes (eg times out unable to connect using RC4)
the proxy starts serving requests again. I should mention that I am running
squid inside a docker container if this matters at all. 

The errors in my logs are : 
&quot;Error negotiating SSL connection on FD 22: error 1408A0C1:SSL
routines:SSL3_GET_CLIENT_HELLO: no shared cipher (1/-1)

&quot;Error negotiating SSL connection on FD 25: error 1408A10B:SSL
routines:SSL3_GET_CLIENT_HELLO: wrong version number (1/-1)

P.S I also tried squid 4, and got exactly the same problem.

Any help will be much appreciated 

Thanks!
-------------- next part --------------
A non-text attachment was scrubbed...
Name: winmail.dat
Type: application/ms-tnef
Size: 65301 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20161121/2d2368c2/attachment.bin">http://lists.squid-cache.org/pipermail/squid-users/attachments/20161121/2d2368c2/attachment.bin</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013525.html">[squid-users] Squid 3.5.21 &quot;hangs&quot; when trying to connect using unsupported cipher (complete DoS)
</A></li>
	<LI>Next message (by thread): <A HREF="013528.html">[squid-users] Squid 3.5.21 &quot;hangs&quot; when trying to connect using unsupported cipher (complete DoS)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13526">[ date ]</a>
              <a href="thread.html#13526">[ thread ]</a>
              <a href="subject.html#13526">[ subject ]</a>
              <a href="author.html#13526">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
