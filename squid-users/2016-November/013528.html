<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3.5.21 &quot;hangs&quot; when trying to connect using unsupported cipher (complete DoS)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.21%20%22hangs%22%20when%20trying%20to%20connect%20using%0A%20unsupported%20cipher%20%28complete%20DoS%29&In-Reply-To=%3CCAK9es_Hs6163B2y9y30FTxQFkfJpuadQ-BfxL4_D717HLn0jUw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013526.html">
   <LINK REL="Next"  HREF="013529.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3.5.21 &quot;hangs&quot; when trying to connect using unsupported cipher (complete DoS)</H1>
    <B>Martin Tenev</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.21%20%22hangs%22%20when%20trying%20to%20connect%20using%0A%20unsupported%20cipher%20%28complete%20DoS%29&In-Reply-To=%3CCAK9es_Hs6163B2y9y30FTxQFkfJpuadQ-BfxL4_D717HLn0jUw%40mail.gmail.com%3E"
       TITLE="[squid-users] Squid 3.5.21 &quot;hangs&quot; when trying to connect using unsupported cipher (complete DoS)">martintinten at gmail.com
       </A><BR>
    <I>Mon Nov 21 17:17:55 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013526.html">[squid-users] Squid 3.5.21 &quot;hangs&quot; when trying to connect using	unsupported cipher (complete DoS)
</A></li>
        <LI>Next message (by thread): <A HREF="013529.html">[squid-users] Squid 3.5.21 &quot;hangs&quot; when trying to connect using	unsupported cipher (complete DoS)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13528">[ date ]</a>
              <a href="thread.html#13528">[ thread ]</a>
              <a href="subject.html#13528">[ subject ]</a>
              <a href="author.html#13528">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>without restricting the ciphers seems to work fine, however some of the
ciphers are vulnerable to attacks...Furthermore I think if I try some weird
cipher which Squid is not supporting the same thing will happen...

On Mon, Nov 21, 2016 at 5:12 PM, Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;
wrote:

&gt;<i> But what happens when you are not restricting the cipher with all this mess
</I>&gt;<i> in the options?
</I>&gt;<i> Would then also the DOS from nmap result the same issue?
</I>&gt;<i>
</I>&gt;<i> Eliezer
</I>&gt;<i>
</I>&gt;<i> ----
</I>&gt;<i> Eliezer Croitoru &lt;<A HREF="http://ngtech.co.il/lmgtfy/">http://ngtech.co.il/lmgtfy/</A>&gt;
</I>&gt;<i> Linux System Administrator
</I>&gt;<i> Mobile: +972-5-28704261
</I>&gt;<i> Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On
</I>&gt;<i> Behalf Of Martin Tenev
</I>&gt;<i> Sent: Monday, November 21, 2016 19:01
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: [squid-users] Squid 3.5.21 &quot;hangs&quot; when trying to connect using
</I>&gt;<i> unsupported cipher (complete DoS)
</I>&gt;<i>
</I>&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> I am having problems with squid &amp; SSL. I have setup squid in reverse-proxy
</I>&gt;<i> configuration and overall it works fine, however for security reasons I had
</I>&gt;<i> to disable some of the ciphers. I have taken an example configuration from
</I>&gt;<i> <A HREF="http://www.rawiriblundell.com/?p=1442">http://www.rawiriblundell.com/?p=1442</A> and my https_port line looks pretty
</I>&gt;<i> much like this (this is the example from the website but the disabled
</I>&gt;<i> ciphers are the same for me as well):
</I>&gt;<i>
</I>&gt;<i> https_port  443 accel defaultsite=someinternalhost vhost
</I>&gt;<i> cert=/etc/squid/CertAuth/supersecret.crt
</I>&gt;<i> key=/etc/squid/CertAuth/supersecret.key
</I>&gt;<i> options=NO_SSLv2,NO_SSLv3,CIPHER_SERVER_PREFERENCE
</I>&gt;<i> cipher=ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-
</I>&gt;<i> SHA256:DHE-RSA-AES25
</I>&gt;<i> 6-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-
</I>&gt;<i> SHA384:ECDHE-RSA-AES
</I>&gt;<i> 128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-
</I>&gt;<i> RSA-AES256-SHA256:D
</I>&gt;<i> HE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:
</I>&gt;<i> ECDHE-RSA-DES-CBC
</I>&gt;<i> 3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-
</I>&gt;<i> SHA256:AES256-SHA256
</I>&gt;<i> :AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!
</I>&gt;<i> aNULL:!eNULL:!EXPORT
</I>&gt;<i> :!DES:!MD5:!PSK:!RC4 dhparams=/etc/squid/CertAuth/dhparams.pem
</I>&gt;<i>
</I>&gt;<i> During my build I have included the config options --enable-ssl and
</I>&gt;<i> --with-openssl=/usr
</I>&gt;<i>
</I>&gt;<i> Using the proxy through a browser works fine, but if I try nmap --script
</I>&gt;<i> ssl-enum-ciphers -p 443 &lt;host&gt; or openssl s_client -cipher 'RC4-SHA'
</I>&gt;<i> -connect &lt;host&gt; these commands result in complete DoS for a few minutes. I
</I>&gt;<i> figured out that only the unsupported or disabled ciphers cause this
</I>&gt;<i> problem. Also when I do the openssl connection as shown above the proxy
</I>&gt;<i> will
</I>&gt;<i> be unresponsive as long as openssl is trying to connect using the disabled
</I>&gt;<i> cipher. As soon as it finishes (eg times out unable to connect using RC4)
</I>&gt;<i> the proxy starts serving requests again. I should mention that I am running
</I>&gt;<i> squid inside a docker container if this matters at all.
</I>&gt;<i>
</I>&gt;<i> The errors in my logs are :
</I>&gt;<i> &quot;Error negotiating SSL connection on FD 22: error 1408A0C1:SSL
</I>&gt;<i> routines:SSL3_GET_CLIENT_HELLO: no shared cipher (1/-1)
</I>&gt;<i>
</I>&gt;<i> &quot;Error negotiating SSL connection on FD 25: error 1408A10B:SSL
</I>&gt;<i> routines:SSL3_GET_CLIENT_HELLO: wrong version number (1/-1)
</I>&gt;<i>
</I>&gt;<i> P.S I also tried squid 4, and got exactly the same problem.
</I>&gt;<i>
</I>&gt;<i> Any help will be much appreciated
</I>&gt;<i>
</I>&gt;<i> Thanks!
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20161121/3a36f4d6/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20161121/3a36f4d6/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013526.html">[squid-users] Squid 3.5.21 &quot;hangs&quot; when trying to connect using	unsupported cipher (complete DoS)
</A></li>
	<LI>Next message (by thread): <A HREF="013529.html">[squid-users] Squid 3.5.21 &quot;hangs&quot; when trying to connect using	unsupported cipher (complete DoS)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13528">[ date ]</a>
              <a href="thread.html#13528">[ thread ]</a>
              <a href="subject.html#13528">[ subject ]</a>
              <a href="author.html#13528">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
