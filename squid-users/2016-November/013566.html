<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] FTP interrupted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FTP%20interrupted&In-Reply-To=%3C13b301d24598%2427179c50%247546d4f0%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013558.html">
   <LINK REL="Next"  HREF="013554.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] FTP interrupted</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FTP%20interrupted&In-Reply-To=%3C13b301d24598%2427179c50%247546d4f0%24%40ngtech.co.il%3E"
       TITLE="[squid-users] FTP interrupted">eliezer at ngtech.co.il
       </A><BR>
    <I>Wed Nov 23 14:44:53 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013558.html">[squid-users] FTP interrupted
</A></li>
        <LI>Next message (by thread): <A HREF="013554.html">[squid-users] FTP interrupted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13566">[ date ]</a>
              <a href="thread.html#13566">[ thread ]</a>
              <a href="subject.html#13566">[ subject ]</a>
              <a href="author.html#13566">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>What OS are you using?
Maybe I have a ready to go binary for the one you are using.

Eliezer

----
Eliezer Croitoru &lt;<A HREF="http://ngtech.co.il/lmgtfy/">http://ngtech.co.il/lmgtfy/</A>&gt; 
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>
 

From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On
Behalf Of ludek_coufal
Sent: Wednesday, November 23, 2016 11:17
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] FTP interrupted

Hello Garri,
Thank You for explain Squid and FTP.
1. Directive read_timeout work OK
2. I will sometime upgrade Squid to ver. 3.5

Thank You
Ludek


---------- P&#367;vodn&#237; zpr&#225;va ----------
Od: Garri Djavadyan &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">garryd at comnet.uz</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">garryd at comnet.uz</A>&gt; &gt;
Komu: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt; 
Datum: 23. 11. 2016 7:58:09
P&#345;edm&#283;t: Re: [squid-users] FTP interrupted

On Wed, 2016-11-23 at 07:17 +0100, ludek_coufal wrote:
&gt;<i> Hello Garri,
</I>&gt;<i> client FTP - Total Commander (I test WinSCP, FileZilla with same
</I>&gt;<i> result - after 15 min connection interrupted) with proxy server -
</I>&gt;<i> proxy server HTTP with FTP support:
</I>&gt;<i> part of squid.conf:
</I>&gt;<i> *********************************************************************
</I>&gt;<i> ******************
</I>&gt;<i> acl SSL_ports port 21
</I>&gt;<i> acl SSL_ports port 1024-65535
</I>&gt;<i> acl SSL_ports port 443
</I>&gt;<i> acl SSL_ports port 8443
</I>&gt;<i> acl SSL_ports port 6400
</I>&gt;<i> acl Safe_ports port 80  # http
</I>&gt;<i> acl Safe_ports port 21  # ftp
</I>&gt;<i> acl Safe_ports port 443  # https
</I>&gt;<i> acl Safe_ports port 70  # gopher
</I>&gt;<i> acl Safe_ports port 210  # wais
</I>&gt;<i> acl Safe_ports port 1025-65535 # unregistered ports
</I>&gt;<i> acl Safe_ports port 280  # http-mgmt
</I>&gt;<i> acl Safe_ports port 488  # gss-http
</I>&gt;<i> acl Safe_ports port 591  # filemaker
</I>&gt;<i> acl Safe_ports port 777  # multiling http
</I>&gt;<i> acl CONNECT method CONNECT
</I>&gt;<i> acl FTP proto FTP
</I>&gt;<i> always_direct allow FTP
</I>&gt;<i> 
</I>&gt;<i> http_access deny !Safe_ports
</I>&gt;<i> # Deny CONNECT to other than secure SSL ports
</I>&gt;<i> http_access deny CONNECT !SSL_ports
</I>&gt;<i> # Only allow cachemgr access from localhost
</I>&gt;<i> http_access allow localhost manager
</I>&gt;<i> http_access deny manager
</I>&gt;<i> 
</I>&gt;<i> ###############
</I>&gt;<i> # http_access deny localnet !bandwidth_auth
</I>&gt;<i> ###############
</I>&gt;<i> http_access allow localhost
</I>&gt;<i> 
</I>&gt;<i> # And finally deny all other access to this proxy
</I>&gt;<i> http_access deny all
</I>&gt;<i> # Squid normally listens to port 3128
</I>&gt;<i> #http_port 3128 transparent
</I>&gt;<i> http_port 3128
</I>&gt;<i> ftp_port 21
</I>&gt;<i> # Uncomment and adjust the following to add a disk cache directory.
</I>&gt;<i> #cache_dir ufs /var/log/squid/cache 100 16 256
</I>&gt;<i> # Leave coredumps in the first cache dir
</I>&gt;<i> coredump_dir /var/log/squid/cache
</I>&gt;<i> #
</I>&gt;<i> # Add any of your own refresh_pattern entries above these.
</I>&gt;<i> #
</I>&gt;<i> refresh_pattern ^ftp:  1440 20% 10080
</I>&gt;<i> refresh_pattern ^gopher: 1440 0% 1440
</I>&gt;<i> refresh_pattern -i (/cgi-bin/|\?) 0 0% 0
</I>&gt;<i> refresh_pattern .  0 20% 4320
</I>&gt;<i> logfile_rotate 2
</I>&gt;<i> *********************************************************************
</I>&gt;<i> ****
</I>&gt;<i> When I add ftp_port 21 in squid.conf and proxy.reload I get this
</I>&gt;<i> message:
</I>&gt;<i> /etc/squid/squid.conf:129 unrecognized: 'ftp_port'
</I>&gt;<i> I found this: <A HREF="http://www.squid-cache.org/Doc/config/ftp_port/">http://www.squid-cache.org/Doc/config/ftp_port/</A>
</I>&gt;<i> Our version is  Squid Cache ver. 3.3.8
</I>
Hi Ludek,

With the above config, your FTP clients use CONNECT methods. Squid
simply tunnels connections from FTP client to FTP server. When you
upload a file over FTP data channel, FTP control channel is idle and
Squid terminates the control connection after 15 minutes [1] by
default. It is because Squid don't know about relations between
tunneled control channel and data channel. You can try to increase
default timeout. But more elegant solution is to use FTP relay function
(ftp_port).

The ftp_port directive only available in Squid-3.5 and above. You
should upgrade Squid to latest 3.5.22 as Eliezer already advised you.

When you configure ftp_port, in Filezilla you should disable
connection-&gt;generic proxy and enable connection-&gt;ftp-&gt;ftp proxy with
following settings:

Type: custom
---
USER %u@%h
PASS %p
---
Proxy host: Squid's IP adress


[1] <A HREF="http://www.squid-cache.org/Doc/config/read_timeout/">http://www.squid-cache.org/Doc/config/read_timeout/</A>


Garri
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt; 
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
=
-------------- next part --------------
A non-text attachment was scrubbed...
Name: winmail.dat
Type: application/ms-tnef
Size: 65977 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20161123/72177e3b/attachment.bin">http://lists.squid-cache.org/pipermail/squid-users/attachments/20161123/72177e3b/attachment.bin</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013558.html">[squid-users] FTP interrupted
</A></li>
	<LI>Next message (by thread): <A HREF="013554.html">[squid-users] FTP interrupted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13566">[ date ]</a>
              <a href="thread.html#13566">[ thread ]</a>
              <a href="subject.html#13566">[ subject ]</a>
              <a href="author.html#13566">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
