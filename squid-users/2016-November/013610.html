<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Hint for howto wanted ...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Hint%20for%20howto%20wanted%20...&In-Reply-To=%3C004a01d2493c%242c38a1a0%2484a9e4e0%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013609.html">
   <LINK REL="Next"  HREF="013611.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Hint for howto wanted ...</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Hint%20for%20howto%20wanted%20...&In-Reply-To=%3C004a01d2493c%242c38a1a0%2484a9e4e0%24%40ngtech.co.il%3E"
       TITLE="[squid-users] Hint for howto wanted ...">eliezer at ngtech.co.il
       </A><BR>
    <I>Mon Nov 28 05:56:33 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013609.html">[squid-users] Hint for howto wanted ...
</A></li>
        <LI>Next message (by thread): <A HREF="013611.html">[squid-users] Hint for howto wanted ...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13610">[ date ]</a>
              <a href="thread.html#13610">[ thread ]</a>
              <a href="subject.html#13610">[ subject ]</a>
              <a href="author.html#13610">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>OK so the next step is:
Routing over tunnel to the other proxy and on it(which has ssl-bump)
intercept.
If you have a public on the remote proxies which can use ssl-bump then route
the traffic to there using Policy Based routing.
You can selectively route by source or destination IP addresses.

Now my main question is: Can't you just install 3.5 on the 3.1.23 machine
and bump there?
Some of the content will not be blocked since 3.1.X cannot intercept SSL.
Depends on the situation you would be able to block all traffic expect ports
53, 443 and 80 and see what happens.

How are you intercepting the connections? What are the iptables rules you
are using?
What OS are you running on top of the Squid boxes?

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>


-----Original Message-----
From: Walter H. [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">Walter.H at mathemainzel.info</A>] 
Sent: Monday, November 28, 2016 06:42
To: Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;
Cc: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Hint for howto wanted ...

Hello,

yes I have full control of all three proxies,  both local proxies and 
remote proxy; and in my LAN I use static IP addresses;

cache_peer_access remote-proxy allow remote-domains &lt;-- this is 
neccessary because a few domains
 
have geo location restrictions which are bypassed with this
cache_peer_access remote-proxy allow tv-device &lt;-- but this sends 
anything from the TV there,
 
even requests that should be blocked ...
 
(selective doesn't work)

the proxy that is used by the clients is a squid 3.1.23, the one that is 
remote is a 3.4.14 and the local parent proxy is a 3.5.20

Thanks,
Walter


On 28.11.2016 04:40, Eliezer Croitoru wrote:
&gt;<i> A question that will simplify things:
</I>&gt;<i> Are you full in control of the remote and the local proxy?
</I>&gt;<i> If so you can create a tunnel from the local gateway to the remote squid
</I>and
&gt;<i> pass the web traffic in the routing level.
</I>&gt;<i> This way you would be able to intercept port 80 on the remote proxy and if
</I>&gt;<i> required also BUMP the ip addresses you want.
</I>&gt;<i>
</I>&gt;<i> If you have static IP addresses you would probably be able to decide which
</I>&gt;<i> of the clients you will bump or not.
</I>&gt;<i> I think that TV in general in the form I know of needs filtering since not
</I>&gt;<i> everything there you will want anyone to see.
</I>&gt;<i> But again maybe in your area TV is something else then in mine.
</I>&gt;<i>
</I>&gt;<i> If you need more help let me know.
</I>&gt;<i>
</I>&gt;<i> Eliezer
</I>&gt;<i>
</I>&gt;<i> ----
</I>&gt;<i> Eliezer Croitoru
</I>&gt;<i> Linux System Administrator
</I>&gt;<i> Mobile: +972-5-28704261
</I>&gt;<i> Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On
</I>&gt;<i> Behalf Of Walter H.
</I>&gt;<i> Sent: Sunday, November 27, 2016 19:17
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: [squid-users] Hint for howto wanted ...
</I>&gt;<i>
</I>&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> I've got a special problem ...
</I>&gt;<i>
</I>&gt;<i> I have several devices in my LAN:
</I>&gt;<i> - PCs, Notebooks
</I>&gt;<i> - a Tablet-PC
</I>&gt;<i> - a Smartphone
</I>&gt;<i> - a Television
</I>&gt;<i>
</I>&gt;<i> on my LAN I've two squids as VMs on my PC (both are CentOS 6)
</I>&gt;<i>
</I>&gt;<i> I also have a virtual server (a CentOS 6, too)  at a webhoster in a
</I>&gt;<i> different country, which I have configured as a proxy (squid) only for me
</I>&gt;<i> besides the web service;
</I>&gt;<i>
</I>&gt;<i> /etc/squid/squid.conf of the main proxy, which is used as proxy by the
</I>&gt;<i> clients has this ...
</I>&gt;<i>
</I>&gt;<i> acl tv-device src ip-of-tv
</I>&gt;<i>
</I>&gt;<i> cache_peer parentproxy.local                  parent 3128 0
</I>&gt;<i> name=local-proxy proxy-only no-digest default cache_peer
</I>&gt;<i> virtualserver-at-webhoster  parent 3128 0 name=remote-proxy proxy-only
</I>&gt;<i> no-digest
</I>&gt;<i>
</I>&gt;<i> acl remote-domains dstdomain &quot;/etc/squid/remote-domains-acl.squid&quot;
</I>&gt;<i>
</I>&gt;<i> cache_peer_access remote-proxy allow remote-domains cache_peer_access
</I>&gt;<i> remote-proxy allow tv-device cache_peer_access remote-proxy deny all
</I>&gt;<i>
</I>&gt;<i> cache_peer_access local-proxy allow !tv-device
</I>&gt;<i>
</I>&gt;<i> this proxy and the one at the webhoster don't do SSL-bump, only the parent
</I>&gt;<i> proxy does ...
</I>&gt;<i> at the moment only the parentproxy.local does filtering and blocks
</I>unwandted
&gt;<i> IPs, hosts, ...
</I>&gt;<i>
</I>&gt;<i> what is the easiest way to do smart filtering for the tv-device, as this
</I>&gt;<i> doesn't use parentproxy.local at all ...
</I>&gt;<i> do  I really have to do smart filtering on both, the one at the hoster
</I>(plus
&gt;<i> SSL bump) and the parentproxy that already does?
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> Walter
</I>&gt;<i>
</I>&gt;<i>
</I>



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013609.html">[squid-users] Hint for howto wanted ...
</A></li>
	<LI>Next message (by thread): <A HREF="013611.html">[squid-users] Hint for howto wanted ...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13610">[ date ]</a>
              <a href="thread.html#13610">[ thread ]</a>
              <a href="subject.html#13610">[ subject ]</a>
              <a href="author.html#13610">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
