<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Hint for howto wanted ...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Hint%20for%20howto%20wanted%20...&In-Reply-To=%3C00a001d249c0%24c63ed240%2452bc76c0%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013622.html">
   <LINK REL="Next"  HREF="013625.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Hint for howto wanted ...</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Hint%20for%20howto%20wanted%20...&In-Reply-To=%3C00a001d249c0%24c63ed240%2452bc76c0%24%40ngtech.co.il%3E"
       TITLE="[squid-users] Hint for howto wanted ...">eliezer at ngtech.co.il
       </A><BR>
    <I>Mon Nov 28 21:45:45 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013622.html">[squid-users] Hint for howto wanted ...
</A></li>
        <LI>Next message (by thread): <A HREF="013625.html">[squid-users] Hint for howto wanted ...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13624">[ date ]</a>
              <a href="thread.html#13624">[ thread ]</a>
              <a href="subject.html#13624">[ subject ]</a>
              <a href="author.html#13624">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>OK.
So much clear now to a solution.
If you don&#8217;t know what Policy Based Routing and you have a bunch of VM's and you are configuring the proxy in the browser manually you just need to install on the first proxy 3.5.22 that allows you to tunnel CONNECT requests to a parent proxy based on the request domain.
I am pretty sure that as Amos wrote you need to simplify things.
I will ask again:
What do you want to achieve? Content filtering? Special Routing(access the internet from another county)? Intercept the connections or use the browser settings to access the web?

Every question have a whole set of option and it's very simple to route CONNECT requests to a parent proxy if the client configures the proxy in it's settings.
Indeed you won't need 3.5.22 to do that but you will need something that can do that.

Now my conclusion is this:
Your need is to be able to pass CONNECT requests to a parent proxy.
Amos can you answer how it should be done and if it's possible at all using 3.1.X?

(Fastest to catch up should answer since I don't remember it by heart despite to the fact that this is one of my testing labs)

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>


-----Original Message-----
From: Walter H. [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">Walter.H at mathemainzel.info</A>] 
Sent: Monday, November 28, 2016 20:49
To: Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;
Cc: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Hint for howto wanted ...

Hey,

On 28.11.2016 14:51, Eliezer Croitoru wrote:
&gt;<i> Now to me the picture is much clear technically.
</I>&gt;<i> As Amos suggested fix the first proxy(and I am adding choose how to approach) and then move on to the next ones.
</I>why fix the first proxy, I wouldn't need it, if ssl-bump plus parent 
proxy (the remote one) worked ...
&gt;<i> There are couple subjects in your one single question which are conflicting your desire(or at least how they are written).
</I>&gt;<i> If you want to Intercept ssl traffic of clients at the network 172.16.0.0/24(or what ever you have there..) specific clients such as that cannot use a proxy, you will need to either bump them(and splice if no bump required) on the router level of the network or route their traffic towards the right next-hop.
</I>both proxies, the first and the local parent are VMs on my PC ...
&gt;<i> Since you are already blocking clients with iptables you should get familiar if not yet,
</I>this is just a few iptables rules ...
&gt;<i>   with connection marking or Policy Based Routing.
</I>I don't know what you mean by that?
&gt;<i> What router are you using a CentOS also?
</I>this is a NAT router, nothing more ...
&gt;<i> If so it would be pretty simple to configure a routing policy which will be based on the source IP address of the connections.
</I>&gt;<i> Choose if you want to bump on the first proxy ie the 3.1.23 by upgrading to 3.5.X or route the traffic over a tunnel instead of just blocking the traffic.
</I>a tunnel between 2 VMs which share the same LAN interface?
&gt;<i> Depend on your router OS you will have different instructions on how to route the &quot;blocked&quot; clients into a proxy that will intercept the connections which needs to be inspected.
</I>this is neither needed nor wanted ..., the clients configure their proxy 
manually ... this is my home LAN not a company environment ...
&gt;<i> Where are you stuck in the implementation?
</I>how to have a parent proxy even when SSL-bump is done ...
&gt;<i> Can't you upgrade the 3.1.23(First proxy)?
</I>this is just another VM like the 3.5.20 (parent proxy)
&gt;<i> What is blocking you from routing the traffic toward to the second parent proxy from the first one or from the router?
</I>these two share the same LAN interface, these are VMware guests of my 
VMware host running Windows ...

Walter



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013622.html">[squid-users] Hint for howto wanted ...
</A></li>
	<LI>Next message (by thread): <A HREF="013625.html">[squid-users] Hint for howto wanted ...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13624">[ date ]</a>
              <a href="thread.html#13624">[ thread ]</a>
              <a href="subject.html#13624">[ subject ]</a>
              <a href="author.html#13624">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
