<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Caching application/octet-stream
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Caching%20application/octet-stream&In-Reply-To=%3CCAHhBkD0JzUC75jitu74cFF_0upOhdKTVH5nfELcBxCDpO%3D2Zrg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012935.html">
   <LINK REL="Next"  HREF="012826.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Caching application/octet-stream</H1>
    <B>Michael Varun</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Caching%20application/octet-stream&In-Reply-To=%3CCAHhBkD0JzUC75jitu74cFF_0upOhdKTVH5nfELcBxCDpO%3D2Zrg%40mail.gmail.com%3E"
       TITLE="[squid-users] Caching application/octet-stream">michael.varun at inmobi.com
       </A><BR>
    <I>Mon Oct  3 08:38:25 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012935.html">[squid-users] FW: squid tproxy ssl-bump and Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)
</A></li>
        <LI>Next message (by thread): <A HREF="012826.html">[squid-users] Squid crash - 3.5.21
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12825">[ date ]</a>
              <a href="thread.html#12825">[ thread ]</a>
              <a href="subject.html#12825">[ subject ]</a>
              <a href="author.html#12825">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>There is a bug in the SSL-Bump implementation we have not sorted out
yet, which makes the &quot;ssl-bump&quot; on this port enable reverse-proxy mode
handling. That seems to be leading to Surrogate feature being enabled
and the Authorization:Bearer being removed when it should be relayed to
the server.


Can you refer to the BUD ID if there is one already opened  if not
should i submit one for reference ?


On Fri, Sep 30, 2016 at 1:06 PM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:

&gt;<i> On 30/09/2016 8:10 p.m., Michael Varun wrote:
</I>&gt;<i> &gt; Here is the snippet of debug logs
</I>&gt;<i> &gt; I dont get to see anything missing out there . It does a GET call to the
</I>&gt;<i> &gt; docker registry on behalf of the requesting client The registry listens
</I>&gt;<i> on
</I>&gt;<i> &gt; 443 so squid mimicks  client TLS connections post which does a GET call
</I>&gt;<i> to
</I>&gt;<i> &gt; the docker registry on the requested blobs
</I>&gt;<i>
</I>&gt;<i> Well firstly, going by your earlier config file the client is *not*
</I>&gt;<i> performing TLS connections. Your proxy is configured to receive
</I>&gt;<i> plain-text HTTP at port 443.
</I>&gt;<i>
</I>&gt;<i> You seem to have stumbled onto two bugs in Squid which are combining to
</I>&gt;<i> be problematic.
</I>&gt;<i>
</I>&gt;<i> There is a bug in the SSL-Bump implementation we have not sorted out
</I>&gt;<i> yet, which makes the &quot;ssl-bump&quot; on this port enable reverse-proxy mode
</I>&gt;<i> handling. That seems to be leading to Surrogate feature being enabled
</I>&gt;<i> and the Authorization:Bearer being removed when it should be relayed to
</I>&gt;<i> the server.
</I>&gt;<i>
</I>&gt;<i> The existence of Authorization header on the request combined with lack
</I>&gt;<i> of Cache-Control:public on the response means these reponses are private
</I>&gt;<i> responses associated with that auth credentials token. They cannot be
</I>&gt;<i> cached and given to anyone else.
</I>&gt;<i>
</I>&gt;<i> That brings up what I think may be a second bug. Since the request to
</I>&gt;<i> the server was sent without Auth header then Squid should be considering
</I>&gt;<i> it a non-auth response and treating it as cacheable anyway. But probably
</I>&gt;<i> is just using the client request for that decision.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> You could try adding the &quot;login=PASSTHRU&quot; option to your cache_peer
</I>&gt;<i> line. If the server sends &quot;Cache-Control:public&quot; that should enable
</I>&gt;<i> caching.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i>
</I>
-- 
_____________________________________________________________
The information contained in this communication is intended solely for the 
use of the individual or entity to whom it is addressed and others 
authorized to receive it. It may contain confidential or legally privileged 
information. If you are not the intended recipient you are hereby notified 
that any disclosure, copying, distribution or taking any action in reliance 
on the contents of this information is strictly prohibited and may be 
unlawful. If you have received this communication in error, please notify 
us immediately by responding to this email and then delete it from your 
system. The firm is neither liable for the proper and complete transmission 
of the information contained in this communication nor for any delay in its 
receipt.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20161003/0d4aecde/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20161003/0d4aecde/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012935.html">[squid-users] FW: squid tproxy ssl-bump and Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)
</A></li>
	<LI>Next message (by thread): <A HREF="012826.html">[squid-users] Squid crash - 3.5.21
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12825">[ date ]</a>
              <a href="thread.html#12825">[ thread ]</a>
              <a href="subject.html#12825">[ subject ]</a>
              <a href="author.html#12825">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
