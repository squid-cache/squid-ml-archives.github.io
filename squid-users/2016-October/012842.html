<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] FW: squid tproxy ssl-bump and Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FW%3A%20squid%20tproxy%20ssl-bump%20and%20Protocol%20error%20%28TLS%0A%20code%3A%20SQUID_ERR_SSL_HANDSHAKE%29&In-Reply-To=%3Cf4e0b806-587c-ed2e-4941-b5cccbcda0d1%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012824.html">
   <LINK REL="Next"  HREF="012855.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] FW: squid tproxy ssl-bump and Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FW%3A%20squid%20tproxy%20ssl-bump%20and%20Protocol%20error%20%28TLS%0A%20code%3A%20SQUID_ERR_SSL_HANDSHAKE%29&In-Reply-To=%3Cf4e0b806-587c-ed2e-4941-b5cccbcda0d1%40treenet.co.nz%3E"
       TITLE="[squid-users] FW: squid tproxy ssl-bump and Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Oct  4 05:17:59 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012824.html">[squid-users] FW: squid tproxy ssl-bump and Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)
</A></li>
        <LI>Next message (by thread): <A HREF="012855.html">[squid-users] FW: squid tproxy ssl-bump and Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12842">[ date ]</a>
              <a href="thread.html#12842">[ thread ]</a>
              <a href="subject.html#12842">[ subject ]</a>
              <a href="author.html#12842">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 3/10/2016 8:11 p.m., Vieri wrote:
&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> ----- Original Message -----
</I>&gt;&gt;<i> From: Yuri Voinov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A>&gt;
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i> Why is Squid negotiating cipher RC4-MD5 which is reported
</I>&gt;&gt;&gt;<i> &quot;insecure&quot; and unsupported by the google web site?&gt; Because your
</I>&gt;&gt;&gt;<i> antique client request it. XP desupported years ago.
</I>&gt;<i> 
</I>&gt;<i> [...]
</I>&gt;&gt;<i> Throw out XP and IE8 and set up W7 as minimum with IE10. I see no
</I>&gt;&gt;<i> other
</I>&gt;<i> 
</I>&gt;&gt;<i> way. I am afraid that in this case, the cactus is too large and
</I>&gt;&gt;<i> inedible.
</I>&gt;<i> 
</I>&gt;<i> I agree that XP clients shouldn't be used anymore but it's easier
</I>&gt;<i> said than done in corporate environments.
</I>&gt;<i> 
</I>&gt;<i> In any case, on a purely technical level, I don't know the internals
</I>&gt;<i> of Squid and standard proxying protocols but if a Windows XP+IE8
</I>&gt;<i> client has no problem whatsoever connecting directly (no proxy) to
</I>&gt;<i> <A HREF="https://www.google.com">https://www.google.com</A> but fails with Squid in the middle (ssl-bump)
</I>&gt;<i> then that makes me think that it could be either a Squid bug or a
</I>&gt;<i> missing feature 
</I>
TLS/SSL was designed to prevent MITM being done on the encrypted
traffic. When used properly that is exactly what it does.

SSL-Bump is an MITM process.

So the behaviour you see of &quot;working&quot; when no proxy bumping and &quot;not
working&quot; when proxy attempts to bump is exactly the way HTTPS was
designed to behave.

It is unreasonable to believe that working TLS behaviour is a bug in
Squid...

&gt;<i> Whatever the reason,
</I>&gt;<i> for an end-user like me it seems that the XP client is able to
</I>&gt;<i> negotiate TLS correctly with Google and presumably using the cipher
</I>&gt;<i> DES-CBC3-SHA (maybe after failing with RC4-MD5 on a first attempt),
</I>&gt;<i> whereas Squid immediately fails with RC4-MD5. It doesn't ever seem to
</I>&gt;<i> try DES-CBC3-SHA even though it's available in openssl.
</I>
... in this case it might be. But not for the reasons stated. The
problem known so far is that RC4-MD5 cipher. Why it is not being used by
your OpenSSL library.

That could bear some further investigation. There may be things you need
to enable in the config passed to OpenSSL, or a different build of the
library needed. Something along those lines - Im just guessing here.

&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> So I guess I'll start forcing users to use Firefox on WinXP or any
</I>&gt;<i> other sane OS. I just wanted to point out though that I'm still
</I>&gt;<i> confused as to why the client connection is failing.
</I>
That sounds like a potentially workable option or at least workaround.

I hope the above explanations can alleviate your confusion a bit despite
not providing any answer to the problem.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012824.html">[squid-users] FW: squid tproxy ssl-bump and Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)
</A></li>
	<LI>Next message (by thread): <A HREF="012855.html">[squid-users] FW: squid tproxy ssl-bump and Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12842">[ date ]</a>
              <a href="thread.html#12842">[ thread ]</a>
              <a href="subject.html#12842">[ subject ]</a>
              <a href="author.html#12842">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
