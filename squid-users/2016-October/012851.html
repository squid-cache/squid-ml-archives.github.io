<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid - AD kerberos auth and Linux Server proxy	access not working
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20-%20AD%20kerberos%20auth%20and%20Linux%20Server%20proxy%0A%09access%20not%20working&In-Reply-To=%3COF4588894B.96613DF1-ON80258042.00392BFE-80258042.0039900A%40tcs.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012850.html">
   <LINK REL="Next"  HREF="012852.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid - AD kerberos auth and Linux Server proxy	access not working</H1>
    <B>Nilesh Gavali</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20-%20AD%20kerberos%20auth%20and%20Linux%20Server%20proxy%0A%09access%20not%20working&In-Reply-To=%3COF4588894B.96613DF1-ON80258042.00392BFE-80258042.0039900A%40tcs.com%3E"
       TITLE="[squid-users] Squid - AD kerberos auth and Linux Server proxy	access not working">nilesh.gavali at tcs.com
       </A><BR>
    <I>Tue Oct  4 10:28:44 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012850.html">[squid-users] Squid - AD kerberos auth and Linux Server proxy	access not working
</A></li>
        <LI>Next message (by thread): <A HREF="012852.html">[squid-users] Squid - AD kerberos auth and Linux Server proxy	access not working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12851">[ date ]</a>
              <a href="thread.html#12851">[ thread ]</a>
              <a href="subject.html#12851">[ subject ]</a>
              <a href="author.html#12851">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Antony;
I have double checked the current working configuration of my squid.conf 
and it has same settings which I posted earlier. somehow it is working for 
us.

below is the error from access.log file.

1475518342.279      0 10.xx.15.103 TCP_DENIED/407 3589 CONNECT 
vseries-test.bottomline.com:443 - NONE/- text/html


Thanks &amp; Regards
Nilesh Suresh Gavali
------------------------------

Message: 5
Date: Tue, 4 Oct 2016 11:08:27 +0100
From: Nilesh Gavali &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">nilesh.gavali at tcs.com</A>&gt;
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [squid-users] Squid - AD kerberos auth and Linux Server proxy
                 access not working
Message-ID:
 &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">OF227B7BEA.03FD80E0-ON80258042.0036FE6D-80258042.0037B4EB at tcs.com</A>&gt;
Content-Type: text/plain; charset=&quot;utf-8&quot;

All;

we have Squid proxy configured with Windows SSO with Kerberos which work 
fine for WIndows AD users.
we have new requirement where one Linux application server need to access 
Internet via squid proxy, we allowed Linux host access via ACL but getting 

denied access error.
below is the configuration done to allow Linux Server host IWCCP02.

###################################
auth_param negotiate program /usr/lib64/squid/squid_kerb_auth -s 
HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy02.cust.in at CUST.IN</A>
auth_param negotiate children 20
auth_param negotiate keep_alive on

acl ad_auth proxy_auth REQUIRED

####  AD Group membership  ####

external_acl_type AD_Group ttl=300 negative_ttl=0 %LOGIN 
/usr/lib64/squid/squid_ldap_group -P -R -b &quot;DC=CUST, DC=IN&quot; -D svcproxy -W 

/etc/squid/pswd/pswd -f 
&quot;(&amp;(objectclass=person)(userPrincipalName=%v)(memberof=cn=%a,ou=InternetAccess,ou=Groups,DC=CUST, 

DC=IN))&quot; -h Cust.in -s sub -v 3
#
#
acl USER external AD_Group lgInternetAccess_Users
acl allowedsite dstdomain &quot;/etc/squid/sitelist/dbs_allowed_site&quot;

acl manager proto cache_object
acl localhost src 127.0.0.1/32 ::1
acl to_localhost dst 127.0.0.0/8 0.0.0.0/32 ::1

# Example rule allowing access from your local networks.
# Adapt to list your (internal) IP networks from where browsing
# should be allowed

acl IWCCP01 src 10.xx.15.103   # Linux Application server
acl localnet src 10.0.0.0/8     # RFC1918 possible internal network
acl localnet src 172.16.0.0/12  # RFC1918 possible internal network
acl localnet src 192.168.0.0/16 # RFC1918 possible internal network
acl localnet src fc00::/7       # RFC 4193 local private network range
acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged) 
machines
#
acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl CONNECT method CONNECT

# Recommended minimum Access Permission configuration:
#
# Only allow cachemgr access from localhost
http_access allow manager localhost
http_access deny manager

# Deny requests to certain unsafe ports
http_access deny !Safe_ports

# Deny CONNECT to other than secure SSL ports
http_access deny CONNECT !SSL_ports

# We strongly recommend the following be uncommented to protect innocent
# web applications running on the proxy server who think the only
# one who can access services on &quot;localhost&quot; is a local user
#http_access deny to_localhost

# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
#
# Example rule allowing access from your local networks.
# Adapt localnet in the ACL section to list your (internal) IP networks
# from where browsing should be allowed


http_access allow IWCCP01 allowedsite
http_access allow USER allowedsite
http_access deny all
http_access allow ad_auth

# And finally deny all other access to this proxy
http_access deny all

# Squid normally listens to port 3128
http_port 8080
never_direct allow all

cache_peer 10.xx.xx.108 parent 8080 0 default
#######################################################################


Thanks &amp; Regards
Nilesh Suresh Gavali
=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;
<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20161004/92d8b1fa/attachment-0001.html">http://lists.squid-cache.org/pipermail/squid-users/attachments/20161004/92d8b1fa/attachment-0001.html</A>
&gt;<i>
</I>
------------------------------

Message: 6
Date: Tue, 4 Oct 2016 12:13:28 +0200
From: Antony Stone &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">Antony.Stone at squid.open.source.it</A>&gt;
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Squid - AD kerberos auth and Linux Server
                 proxy           access not working
Message-ID: &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">201610041213.28760.Antony.Stone at squid.open.source.it</A>&gt;
Content-Type: Text/Plain;  charset=&quot;iso-8859-15&quot;

On Tuesday 04 October 2016 at 12:08:27, Nilesh Gavali wrote:

&gt;<i> All;
</I>&gt;<i> 
</I>&gt;<i> we have Squid proxy configured with Windows SSO with Kerberos which work
</I>&gt;<i> fine for WIndows AD users.
</I>&gt;<i> we have new requirement where one Linux application server need to 
</I>access
&gt;<i> Internet via squid proxy, we allowed Linux host access via ACL but 
</I>getting
&gt;<i> denied access error.
</I>
&gt;<i> http_access allow IWCCP01 allowedsite
</I>&gt;<i> http_access allow USER allowedsite
</I>&gt;<i> http_access deny all
</I>&gt;<i> http_access allow ad_auth
</I>
That makes no sense.  The last rule can never be triggered.  &quot;deny all&quot; 
does 
exactly what it says.

However, that doesn't explain your problem, so please show what you get in 

your access log for a request from this Linux machine IWCCP01.

Thanks,

Antony.

-- 
&quot;In fact I wanted to be John Cleese and it took me some time to realise 
that 
the job was already taken.&quot;

 - Douglas Adams

                                                   Please reply to the 
list;
                                                         please *don't* CC 
me.


------------------------------

Subject: Digest Footer

_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


------------------------------

End of squid-users Digest, Vol 26, Issue 10
*******************************************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20161004/2da79740/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20161004/2da79740/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012850.html">[squid-users] Squid - AD kerberos auth and Linux Server proxy	access not working
</A></li>
	<LI>Next message (by thread): <A HREF="012852.html">[squid-users] Squid - AD kerberos auth and Linux Server proxy	access not working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12851">[ date ]</a>
              <a href="thread.html#12851">[ thread ]</a>
              <a href="subject.html#12851">[ subject ]</a>
              <a href="author.html#12851">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
