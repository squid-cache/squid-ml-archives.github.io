<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid - AD kerberos auth and Linux Server proxy	access not working
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20-%20AD%20kerberos%20auth%20and%20Linux%20Server%20proxy%0A%09access%20not%20working&In-Reply-To=%3COF9164A936.4D1852E8-ON80258042.0049BA9A-80258042.004BF9B4%40tcs.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012856.html">
   <LINK REL="Next"  HREF="012885.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid - AD kerberos auth and Linux Server proxy	access not working</H1>
    <B>Nilesh Gavali</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20-%20AD%20kerberos%20auth%20and%20Linux%20Server%20proxy%0A%09access%20not%20working&In-Reply-To=%3COF9164A936.4D1852E8-ON80258042.0049BA9A-80258042.004BF9B4%40tcs.com%3E"
       TITLE="[squid-users] Squid - AD kerberos auth and Linux Server proxy	access not working">nilesh.gavali at tcs.com
       </A><BR>
    <I>Tue Oct  4 13:49:51 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012856.html">[squid-users] Squid - AD kerberos auth and Linux Server proxy access not working
</A></li>
        <LI>Next message (by thread): <A HREF="012885.html">[squid-users] Squid - AD kerberos auth and Linux Server proxy	access not working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12871">[ date ]</a>
              <a href="thread.html#12871">[ thread ]</a>
              <a href="subject.html#12871">[ subject ]</a>
              <a href="author.html#12871">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Amos;
Ok, we can discussed the issue in Two part  1. For Windows AD 
Authentication &amp; SSO and 2. Linux server unable to access via squid proxy.

For First point-
Requirement to have SSO for accessing internet via squid proxy and based 
on user's AD group membership allow access to specific sites only. I 
believe current configuration of squid is working as expected.

For Second point -
Point I would like to highlight here is, the Linux server IWCCP01 is not 
part of domain at all. Hence the below error as squid configured for 
AD_auth. So how can we allow Linux server or non domain machine to access 
specific sites?

&gt;<i> Error 407 is &quot;proxy auth required&quot;, so the proxy is expecting 
</I>authentication 
&gt;<i> for some reason.
</I>====================================
 &gt; Can you confirm that the hostname vseries-test.bottomline.com is 
contained in 
&gt;<i> your site file /etc/squid/sitelist/dbs_allowed_site ?
</I>
YES, we have entry as .bottomline.com , which work fine when access via 
windows machine having proxy enabled for that user.
==============================
&gt;<i> Can you temporarily change the line &quot;http_access allow IWCCP01 
</I>allowedsite&quot; to 
&gt;<i> &quot;http_access allow IWCCP01&quot; and see whether the machine then gets 
</I>access?

 I will test this, and update the results.
========================================
If that works, please list the output of the command:
  grep &quot;bottomline.com&quot; /etc/squid/sitelist/dbs_allowed_site

o/p of above command as below -

[<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at Proxy02</A> ~]# grep &quot;bottomline.com&quot; 
/etc/squid/sitelist/dbs_allowed_site
.bottomline.com
[<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at Proxy02</A> ~]#

=======================================

Thanks &amp; Regards
Nilesh Suresh Gavali




 
Message: 2
Date: Wed, 5 Oct 2016 00:11:08 +1300
From: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Squid - AD kerberos auth and Linux Server
                 proxy access not working
Message-ID: &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">d35ad0ca-761d-60e3-c594-04697110afdc at treenet.co.nz</A>&gt;
Content-Type: text/plain; charset=utf-8

On 4/10/2016 11:36 p.m., Antony Stone wrote:
&gt;<i> On Tuesday 04 October 2016 at 12:28:44, Nilesh Gavali wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> Hello Antony;
</I>&gt;&gt;<i> I have double checked the current working configuration of my 
</I>squid.conf
&gt;&gt;<i> and it has same settings which I posted earlier. somehow it is working 
</I>for
&gt;&gt;<i> us.
</I>&gt;<i> 
</I>&gt;<i> I'm not saying the whole thing won't work; I'm saying there is no point 
</I>in 
&gt;<i> having a line &quot;http_access allow ad_auth&quot; following the line 
</I>&quot;http_access deny 
&gt;<i> all&quot;.  The ad_auth line can never be invoked.
</I>
Not knowing why authentication works is dangerous. You might have been
allowing non-authenticated traffic and invalid user accounts through.

The only reason it does &quot;work&quot; is that the ACL called &quot;USERS&quot; is _not_
actually checking user logins. It is a group checking ACL which requires
authentication to happen before it can be checked.

In this specific case invalid logins cannot be a member of the group. So
they will not get through the proxy.

However, people who accidentally type the user/password wrong, or whose
machines automatically login with an account not a member of the group
will not be allowed any way to try again short of shutting down their
browser or maybe even logging out of the machine and trying from another
one.

That may or may not be a problem for you.

&gt;<i> 
</I>&gt;&gt;<i> below is the error from access.log file.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 1475518342.279      0 10.xx.15.103 TCP_DENIED/407 3589 CONNECT
</I>&gt;&gt;<i> vseries-test.bottomline.com:443 - NONE/- text/html
</I>&gt;<i> 
</I>&gt;<i> Error 407 is &quot;proxy auth required&quot;, so the proxy is expecting 
</I>authentication 
&gt;<i> for some reason.
</I>&gt;<i> 
</I>&gt;<i> Can you confirm that the hostname vseries-test.bottomline.com is 
</I>contained in 
&gt;<i> your site file /etc/squid/sitelist/dbs_allowed_site ?
</I>&gt;<i> 
</I>&gt;<i> Can you temporarily change the line &quot;http_access allow IWCCP01 
</I>allowedsite&quot; to 
&gt;<i> &quot;http_access allow IWCCP01&quot; and see whether the machine then gets 
</I>access?
&gt;<i> 
</I>
If that works, please list the output of the command:
  grep &quot;bottomline.com&quot; /etc/squid/sitelist/dbs_allowed_site

Amos

*******************************************

=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20161004/4f9c6b90/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20161004/4f9c6b90/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012856.html">[squid-users] Squid - AD kerberos auth and Linux Server proxy access not working
</A></li>
	<LI>Next message (by thread): <A HREF="012885.html">[squid-users] Squid - AD kerberos auth and Linux Server proxy	access not working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12871">[ date ]</a>
              <a href="thread.html#12871">[ thread ]</a>
              <a href="subject.html#12871">[ subject ]</a>
              <a href="author.html#12871">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
