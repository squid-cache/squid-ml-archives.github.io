<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] problem in configuring squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20problem%20in%20configuring%20squid&In-Reply-To=%3CCAKCdGgD-F%2BYUXP55QVUtyQVyi2PWV910CA9PV3UgyLcKfB5a_Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012867.html">
   <LINK REL="Next"  HREF="012894.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] problem in configuring squid</H1>
    <B>Shark</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20problem%20in%20configuring%20squid&In-Reply-To=%3CCAKCdGgD-F%2BYUXP55QVUtyQVyi2PWV910CA9PV3UgyLcKfB5a_Q%40mail.gmail.com%3E"
       TITLE="[squid-users] problem in configuring squid">myshark at gmail.com
       </A><BR>
    <I>Tue Oct  4 15:42:19 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012867.html">[squid-users] problem in configuring squid
</A></li>
        <LI>Next message (by thread): <A HREF="012894.html">[squid-users] problem in configuring squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12878">[ date ]</a>
              <a href="thread.html#12878">[ thread ]</a>
              <a href="subject.html#12878">[ subject ]</a>
              <a href="author.html#12878">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sorry for my bad english,

I want to make a anonymous https &amp; http proxy that pass through any
requests without decrypting or change them,
only change ip address from client ip to my server ip address and define ip
address of my websites that i want to access them from my client in
/etc/hosts,
so i try to install squid on my server and i have good experience when i
set proxy in client with server ip and port 3128 and i can access http &amp;
https behind this proxy,
but when i try to using /etc/hosts i cannot access to https websites. i try
to install squid lot of time with any install instructions that i found
from googling.
I have server with CentOS 7 with one valid internet ip address.

For more explain of what i want to do, i need my squid to work like this ip
173.161.0.227
When i add *173.161.0.227 www.iplocation.net &lt;<A HREF="http://www.iplocation.net">http://www.iplocation.net</A>&gt;* to
my client /etc/hosts
I can browse <A HREF="https://www.iplocation.net">https://www.iplocation.net</A> that tell me my client ip address
is 173.161.0.227
I want do my proxy server same as 173.161.0.227

*My problem is now with below config is:*

when i define *216.55.x.x www.iplocation.net &lt;<A HREF="http://www.iplocation.net">http://www.iplocation.net</A>&gt;* to
/etc/hosts in my client i cannot access to <A HREF="https://www.iplocation.net">https://www.iplocation.net</A> and
hang on connecting and then give me timeout error,
I`m appreciate for help me to resolve this problem.
I ask it before in
<A HREF="http://serverfault.com/questions/805413/squid-with-iptables-bypass-https">http://serverfault.com/questions/805413/squid-with-iptables-bypass-https</A>
 but i cannot resolve it

*My Iptables config is:*

iptables -t nat -A PREROUTING -p tcp --dport 443 -j REDIRECT --to-port 3130

*My squid config is:*

acl localnet src 10.0.0.0/8     # RFC1918 possible internal network
acl localnet src fc00::/7 # RFC 4193 local private network range
acl localnet src fe80::/10 # RFC 4291 link-local (directly plugged) machines
acl localnet src 127.0.0.1

acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http

acl CONNECT method CONNECT

http_access allow !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access allow manager
http_access allow localnet
http_access allow localhost
http_access allow all

http_port 3128
http_port 80
http_port 0.0.0.0:3129 ssl-bump  cert=/etc/squid/ssl_cert/myCA.pem
generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
https_port 0.0.0.0:3130 ssl-bump intercept
cert=/etc/squid/ssl_cert/myCA.pem generate-host-certificates=on
dynamic_cert_mem_cache_size=4MB

sslproxy_cert_error allow all
sslproxy_flags DONT_VERIFY_PEER

cache_dir ufs /var/cache/squid 100 16 256

coredump_dir /var/cache/squid

sslcrtd_program /usr/lib64/squid/ssl_crtd -s /var/squid/ssl_db -M 4MB
sslcrtd_children 50 startup=1 idle=1

sslproxy_cert_error allow all
sslproxy_flags DONT_VERIFY_PEER

ssl_bump peek all
ssl_bump splice all
ssl_bump bump all

refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0% 1440
refresh_pattern -i (/cgi-bin/|\?) 0     0% 0
refresh_pattern .               0       20%     4320forwarded_for delete



On Tue, Oct 4, 2016 at 4:44 PM, Antony Stone &lt;
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">Antony.Stone at squid.open.source.it</A>&gt; wrote:

&gt;<i> On Tuesday 04 October 2016 at 14:51:13, Mehdi Yeganeh wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; Thanks for quick replay,
</I>&gt;<i> &gt; I need to use my server, i configure my ip address in some software like
</I>&gt;<i> &gt; antivirus and ...
</I>&gt;<i>
</I>&gt;<i> ... and what?
</I>&gt;<i>
</I>&gt;<i> I do not understand what antivirus software has to do with our discussion.
</I>&gt;<i> Please give details, don't just write &quot;...&quot;.
</I>&gt;<i>
</I>&gt;<i> &gt; So, I want all of that working
</I>&gt;<i>
</I>&gt;<i> All of what?
</I>&gt;<i>
</I>&gt;<i> &gt; with my server ip address and for this reason I cannot use torproxy or
</I>&gt;<i> &gt; torproject. I need a proxy server (squid) on my server
</I>&gt;<i>
</I>&gt;<i> In that case install Squid on your server.  What is the problem?
</I>&gt;<i>
</I>&gt;<i> &gt; More details about 173.161.0.227:
</I>&gt;<i> &gt; Its sophos web appliance that use squid on debian and using some other
</I>&gt;<i> &gt; proxy software (Astaro HttpProxy) with squid and
</I>&gt;<i> &gt; iptables for forwarding ports. but i can`t find the other proxy software
</I>&gt;<i> &gt; for download. so, i just have squid alone (although iptables is present)
</I>&gt;<i>
</I>&gt;<i> Okay, so I understand that the machine on that IP address (which appears
</I>&gt;<i> to be
</I>&gt;<i> serving Pennoyer School in Illinois, with connectivity provided by
</I>&gt;<i> Comcast) is
</I>&gt;<i> a &quot;Sophos web appliance&quot; - some sort of combined firewall / proxy / port
</I>&gt;<i> forwarder.
</I>&gt;<i>
</I>&gt;<i> What is the relevance of that machine to your question?
</I>&gt;<i>
</I>&gt;<i> &gt; Please tell me that should i use other tools or squid can do it?
</I>&gt;<i>
</I>&gt;<i> Do what?
</I>&gt;<i>
</I>&gt;<i> Please explain exactly what it is you are trying to achieve, and hoping
</I>&gt;<i> that
</I>&gt;<i> Squid is a solution for.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Antony.
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Police have found a cartoonist dead in his house.  They say that details
</I>&gt;<i> are
</I>&gt;<i> currently sketchy.
</I>&gt;<i>
</I>&gt;<i>                                                    Please reply to the
</I>&gt;<i> list;
</I>&gt;<i>                                                          please *don't* CC
</I>&gt;<i> me.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20161004/b529445f/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20161004/b529445f/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012867.html">[squid-users] problem in configuring squid
</A></li>
	<LI>Next message (by thread): <A HREF="012894.html">[squid-users] problem in configuring squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12878">[ date ]</a>
              <a href="thread.html#12878">[ thread ]</a>
              <a href="subject.html#12878">[ subject ]</a>
              <a href="author.html#12878">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
