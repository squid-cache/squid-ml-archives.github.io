<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Introducing delay to HTTP 407 responses
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Introducing%20delay%20to%20HTTP%20407%20responses&In-Reply-To=%3C00fb01d21e93%24ab3811d0%2401a83570%24%40filter.luko.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012862.html">
   <LINK REL="Next"  HREF="012892.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Introducing delay to HTTP 407 responses</H1>
    <B>squid-users at filter.luko.org</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Introducing%20delay%20to%20HTTP%20407%20responses&In-Reply-To=%3C00fb01d21e93%24ab3811d0%2401a83570%24%40filter.luko.org%3E"
       TITLE="[squid-users] Introducing delay to HTTP 407 responses">squid-users at filter.luko.org
       </A><BR>
    <I>Tue Oct  4 23:04:32 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012862.html">[squid-users] Introducing delay to HTTP 407 responses
</A></li>
        <LI>Next message (by thread): <A HREF="012892.html">[squid-users] Introducing delay to HTTP 407 responses
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12890">[ date ]</a>
              <a href="thread.html#12890">[ thread ]</a>
              <a href="subject.html#12890">[ subject ]</a>
              <a href="author.html#12890">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> &gt; I set this up as you suggested, then triggered a 407 response from the
</I>&gt;<i> cache.  It seems that way; I couldn't see aclMatchHTTPStatus or http-
</I>&gt;<i> response-407 in the log:
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>&gt;<i> Strange. I was sure Alex did some tests recently and proved that even
</I>&gt;<i> internally generated responses get http_reply_access applied to them.
</I>&gt;<i> Yet no sign of that in your log.
</I>&gt;<i> 
</I>&gt;<i> Is this a very old Squid version?
</I>
It's a recent Squid version - 3.5.20 on CentOS 6, built from the SRPM kindly provided by Eliezer.

&gt;<i> Or are the &quot;checking http_reply_access&quot; lines just later in the log than
</I>&gt;<i> your snippet covered?
</I>
There was nothing more in the log previously posted at the point the 407 response was returned to the client.

That log did have a lot of other stuff in it though.  Using a much simpler squid.conf (attached), I tested for differences in authenticated vs unauthenticated requests, when &quot;http_reply_access deny all&quot; is in place.  When credentials are supplied, a http/403 (forbidden) response is provided, as you would expect.  But when credentials are not supplied, a http/407 response is provided.  The divergence seems to start around line 31 in cache_noauth.log:

Checklist.cc(63) markFinished: 0x331e4a8 answer AUTH_REQUIRED for AuthenticateAcl exception

Perhaps when answer=AUTH_REQUIRED (line 35), http_reply_access is not checked?  Another difference is that Acl.cc(158) reports async when an authenticated request is in place, but not otherwise.  If someone could give me some pointers where to look in the source, I can start digging to see if I can find out more.

Luke

-------------- next part --------------
A non-text attachment was scrubbed...
Name: cache_auth.log
Type: application/octet-stream
Size: 7534 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20161005/90c8d36c/attachment.obj">http://lists.squid-cache.org/pipermail/squid-users/attachments/20161005/90c8d36c/attachment.obj</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: cache_noauth.log
Type: application/octet-stream
Size: 4933 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20161005/90c8d36c/attachment-0001.obj">http://lists.squid-cache.org/pipermail/squid-users/attachments/20161005/90c8d36c/attachment-0001.obj</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: squid.conf
Type: application/octet-stream
Size: 1039 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20161005/90c8d36c/attachment-0002.obj">http://lists.squid-cache.org/pipermail/squid-users/attachments/20161005/90c8d36c/attachment-0002.obj</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012862.html">[squid-users] Introducing delay to HTTP 407 responses
</A></li>
	<LI>Next message (by thread): <A HREF="012892.html">[squid-users] Introducing delay to HTTP 407 responses
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12890">[ date ]</a>
              <a href="thread.html#12890">[ thread ]</a>
              <a href="subject.html#12890">[ subject ]</a>
              <a href="author.html#12890">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
