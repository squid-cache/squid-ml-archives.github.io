<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Multiple auth schemes in a single Squid instance
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Multiple%20auth%20schemes%20in%20a%20single%20Squid%20instance&In-Reply-To=%3C8fa245d1-ed36-421c-7bb9-f95975d14d44%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012897.html">
   <LINK REL="Next"  HREF="012898.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Multiple auth schemes in a single Squid instance</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Multiple%20auth%20schemes%20in%20a%20single%20Squid%20instance&In-Reply-To=%3C8fa245d1-ed36-421c-7bb9-f95975d14d44%40treenet.co.nz%3E"
       TITLE="[squid-users] Multiple auth schemes in a single Squid instance">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Oct  5 14:05:59 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012897.html">[squid-users] Multiple auth schemes in a single Squid instance
</A></li>
        <LI>Next message (by thread): <A HREF="012898.html">[squid-users] Bug: Missing MemObject::storeId
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12902">[ date ]</a>
              <a href="thread.html#12902">[ thread ]</a>
              <a href="subject.html#12902">[ subject ]</a>
              <a href="author.html#12902">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 6/10/2016 12:09 a.m., john jacob wrote:
&gt;<i> Hi All,
</I>&gt;<i> 
</I>&gt;<i> We have a requirement to use the same Squid instance for Basic and NTLM
</I>&gt;<i> authentication to serve various customer groups (may not be on different
</I>&gt;<i> network sections). The customer groups which are using Basic authentication
</I>&gt;<i> (for legacy reasons) should not receive NTLM scheme and the customer groups
</I>&gt;<i> which use NTLM should not receive Basic scheme.
</I>
You seem to be implying that Basic auth is somehow worse than NTLM. In
fact NTLM is the least secure of the two by a thin line. Both are almost
equally bad to use anytime in the past decade.

You should really be considering both those to be nasty legacy and
moving on to Negotiate/Kerberos as much as possible.


&gt;<i> I couldn't find a way to
</I>&gt;<i> implement this using the existing Squid 4.x config options. So I am
</I>&gt;<i> thinking of introducing a new config parameter called &quot;endpoints&quot; like
</I>&gt;<i> below.
</I>&gt;<i> 
</I>&gt;<i> auth_param basic endpoints ipofBasic portofBasic # Default is &quot;endpoints
</I>&gt;<i> all&quot;
</I>&gt;<i> 
</I>&gt;<i> auth_param ntlm endpoints ipofNTLM portofNTLM # Default is &quot;endpoints all&quot;
</I>&gt;<i> 
</I>&gt;<i> acl ipofBasic  localip 192.168.4.2
</I>&gt;<i> acl portofBasic localport 3129 3139
</I>&gt;<i> 
</I>&gt;<i> acl ipofNTLM ipofNTLM  192.168.4.2
</I>&gt;<i> acl portofNTLMlocalport 3149 3159
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> The idea is ,if Squid recieves a request on an endpoint on which only basic
</I>&gt;<i> authentication is needed (ie 192.168.4.2:3129 and192.168.4.2:3139), NTLM
</I>&gt;<i> will not be presented to the client/browser. Vice versa for NTLM. If no
</I>&gt;<i> endpoints is configured , then the existing behavior will be applied.
</I>&gt;<i> 
</I>&gt;<i> Do you think this is reasonable and is there are any obvious problems with
</I>&gt;<i> this?. If you find this useful, I am happy to contribute back when I finish
</I>&gt;<i> implementing this module (I haven't yet started developing).
</I>

The HTTP framework is negotiated thusly:
 the proxy offers what it supports,
 the client tries the most secure credential type it has access to,
 the proxy says whether that is acceptible or to try again.
 .. repeat as necessary until either a success or no more credentials
are known - in which case ask the user with popup(s).

When that framework is used properly the clients with NTLM will try that
and the ones without will try Basic.


Squid-3.5 and later have the &quot;auth_param ... key_extras ...&quot; option that
can take extra parameters for the auth helper to use when it decides if
the credentials are valid.


I suggest you try making your self a script that takes the client IP as
one of those extra parameters; returning ERR if the IP is not allowed to
use the type of auth or relays the lookup on to your real auth helper if
it is allowed.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012897.html">[squid-users] Multiple auth schemes in a single Squid instance
</A></li>
	<LI>Next message (by thread): <A HREF="012898.html">[squid-users] Bug: Missing MemObject::storeId
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12902">[ date ]</a>
              <a href="thread.html#12902">[ thread ]</a>
              <a href="subject.html#12902">[ subject ]</a>
              <a href="author.html#12902">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
