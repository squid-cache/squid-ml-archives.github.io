<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid - AD kerberos auth and Linux Server proxy access not working
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20-%20AD%20kerberos%20auth%20and%20Linux%20Server%20proxy%0A%20access%20not%20working&In-Reply-To=%3C4e608076-5ca4-cdac-a5e4-6d0af5106f1d%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012910.html">
   <LINK REL="Next"  HREF="012952.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid - AD kerberos auth and Linux Server proxy access not working</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20-%20AD%20kerberos%20auth%20and%20Linux%20Server%20proxy%0A%20access%20not%20working&In-Reply-To=%3C4e608076-5ca4-cdac-a5e4-6d0af5106f1d%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid - AD kerberos auth and Linux Server proxy access not working">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Oct  5 17:03:09 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012910.html">[squid-users] Squid - AD kerberos auth and Linux Server proxy	access not working
</A></li>
        <LI>Next message (by thread): <A HREF="012952.html">[squid-users] Squid - AD kerberos auth and Linux Server proxy	access not working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12911">[ date ]</a>
              <a href="thread.html#12911">[ thread ]</a>
              <a href="subject.html#12911">[ subject ]</a>
              <a href="author.html#12911">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 6/10/2016 5:31 a.m., Nilesh Gavali wrote:
&gt;<i> &lt;&lt;NILESH&gt;&gt; here is the compete squid.conf for your reference-
</I>&gt;<i> 
</I>&gt;<i> #
</I>&gt;<i> # Recommended minimum configuration:
</I>&gt;<i> ####  AD SSO Integration  #####
</I>&gt;<i> #auth_param negotiate program /usr/lib64/squid/squid_kerb_auth -d -s 
</I>&gt;<i> GSS_C_NO_NAME
</I>&gt;<i> auth_param negotiate program /usr/lib64/squid/squid_kerb_auth -s 
</I>&gt;<i> HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy02.CUST.IN at CUST.IN</A>
</I>&gt;<i> auth_param negotiate children 20
</I>&gt;<i> auth_param negotiate keep_alive on
</I>&gt;<i> 
</I>&gt;<i> acl ad_auth proxy_auth REQUIRED
</I>&gt;<i> 
</I>&gt;<i> ####  AD Group membership  ####
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> external_acl_type AD_Group ttl=300 negative_ttl=0 children=10 %LOGIN 
</I>&gt;<i> /usr/lib64/squid/squid_ldap_group -P -R -b &quot;DC=CUST,DC=IN&quot; -D svcproxy -W 
</I>&gt;<i> /etc/squid/pswd/pswd -f 
</I>&gt;<i> &quot;(&amp;(objectclass=person)(userPrincipalName=%v)(memberof=cn=%a,ou=InternetAccess,ou=Groups,dc=cust,dc=in))&quot; 
</I>&gt;<i> -h CUST.IN -s sub -v 3
</I>&gt;<i> 
</I>&gt;<i> acl AVWSUS external AD_Group lgOnlineUpdate
</I>&gt;<i> acl windowsupdate dstdomain &quot;/etc/squid/sitelist/infra_update_site&quot;
</I>&gt;<i> 
</I>&gt;<i> acl custUSER external AD_Group lgInternetAccess_custUsers
</I>&gt;<i> acl custallowedsite dstdomain &quot;/etc/squid/sitelist/cust_allowed_site&quot;
</I>&gt;<i> 
</I>&gt;<i> #acl SHAVLIK external AD_Group lgShavlikUpdate
</I>&gt;<i> acl shavlikupdate dstdomain &quot;/etc/squid/sitelist/shavlik_update_site&quot;
</I>&gt;<i> 
</I>&lt;snip defaults&gt;

&gt;<i> # Example rule allowing access from your local networks.
</I>&gt;<i> # Adapt to list your (internal) IP networks from where browsing
</I>&gt;<i> # should be allowed
</I>&gt;<i> acl AVSRVR src 10.50.2.107      # Cloud SEPM Servr
</I>&gt;<i> acl SHAVLIK_SRVR src 10.50.2.112     # Shavlik Server(NTLM Only Access)
</I>&gt;<i> acl IWCCP01 src 10.55.15.103   # Application access to Worldpay/bottomline 
</I>&gt;<i> Payment test site.
</I>
&lt;snip defaults&gt;
&gt;<i> # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
</I>&gt;<i> #
</I>&gt;<i> # Example rule allowing access from your local networks.
</I>&gt;<i> # Adapt localnet in the ACL section to list your (internal) IP networks
</I>&gt;<i> # from where browsing should be allowed
</I>&gt;<i> 
</I>&gt;<i> #http_access allow test shavlikupdate
</I>&gt;<i> http_access allow SHAVLIK_SRVR shavlikupdate
</I>&gt;<i> http_access allow AVSRVR windowsupdate
</I>
The &quot;AVWSUS&quot; ACL below requires authentication in order to check the
group membership. That is what triggers the 407 response to happen.

Move the IWCCP01 line up to here and it should stop.

To make your configuration clearer about which lines need auth and which
lines do not you could place the following line right here:

 http_access deny !ad_auth

All things that do need auth or group names should always go below it.
Things that need to avoid auth should always go above it.


&gt;<i> http_access allow AVWSUS windowsupdate
</I>&gt;<i> http_access allow IWCCP01
</I>&gt;<i> #http_access allow IWCCP01 custallowedsite
</I>&gt;<i> http_access allow custUSER custallowedsite
</I>&gt;<i> http_access allow ad_auth
</I>&gt;<i> # And finally deny all other access to this proxy
</I>&gt;<i> http_access deny all
</I>&gt;<i> 
</I>
Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012910.html">[squid-users] Squid - AD kerberos auth and Linux Server proxy	access not working
</A></li>
	<LI>Next message (by thread): <A HREF="012952.html">[squid-users] Squid - AD kerberos auth and Linux Server proxy	access not working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12911">[ date ]</a>
              <a href="thread.html#12911">[ thread ]</a>
              <a href="subject.html#12911">[ subject ]</a>
              <a href="author.html#12911">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
