<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Caching http google deb files
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Caching%20http%20google%20deb%20files&In-Reply-To=%3CCA%2BsSnVZ%2B6csWqt60nwwSM0QDSmx%2BDutqQeXgL-bGtYbFC6WRuw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012908.html">
   <LINK REL="Next"  HREF="012914.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Caching http google deb files</H1>
    <B>Hardik Dangar</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Caching%20http%20google%20deb%20files&In-Reply-To=%3CCA%2BsSnVZ%2B6csWqt60nwwSM0QDSmx%2BDutqQeXgL-bGtYbFC6WRuw%40mail.gmail.com%3E"
       TITLE="[squid-users] Caching http google deb files">hardikdangar+squid at gmail.com
       </A><BR>
    <I>Wed Oct  5 18:40:46 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012908.html">[squid-users] Caching http google deb files
</A></li>
        <LI>Next message (by thread): <A HREF="012914.html">[squid-users] Caching http google deb files
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12912">[ date ]</a>
              <a href="thread.html#12912">[ thread ]</a>
              <a href="subject.html#12912">[ subject ]</a>
              <a href="author.html#12912">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Jok,

Thanks for the suggetion but the big issue with that is i have to download
whole repository about ( 80-120 GB ) first and then each week i need to
download 20 to 25 GB.  We hardly use any of that except few popular repos.
big issue i always have with most of them is third party repo's.
squid-deb-proxy is quite reliable but again its squid with custom config
nothing else and it fails to cache google debs.

Squid is perfect for me because it can cache things which is requested
first time. So next time anybody requests it it's ready. The problem lies
when big companies like google and github does not wants us to cache their
content and puts various tricks so we can't do that. My issue is same
google deb files are downloaded 50 times in same day as apt updates happen
and i waste 100s of gb into same content. Country where i live bandwidth is
very very costly matter and fast connections are very costly. So this is
important for me.

@Amos,

I think it's about time Squid needs update of code which can cache use
cases like difficult to handle google and github. I am interested to create
proposal and will soon share at squid dev and ask for ideas and will try to
get official approval so i can build this according to squid standards.

but before that can you help me with few things.essentially i don't have
much experience with C code. as i have worked most of my life with
php,python and javascript side. I do know how to write C code but i am not
an expert at it. So i want to know if there is any pattern squid follows
except the oop pattern. I also want to know workflow of squid i.e. what
happens when it receives request and how acls are applied programmatically
and how refresh patterns are applied. is there a way i can debug and check
if refresh patterns are applied for given url. as well as
reply_header_replace has replaced header if i can see those lines in debug
it will help me with this. i know debug options can help me but if i turn
it with level 9 it is very difficult to go past so many debug entries.

My idea is to develop a module which will not change any of the squid code
but will be loaded only if its called explicitly within squid config. So i
want to know is there any piece of code available within squid which
behaves similarly just like your archive mode.




On Wed, Oct 5, 2016 at 9:49 PM, Jok Thuau &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">jok at spikes.com</A>&gt; wrote:

&gt;<i> This is sort of off-topic, but have you considered using a deb repo
</I>&gt;<i> mirroring software?
</I>&gt;<i> (it would mean that you need to update your clients to point to that
</I>&gt;<i> rather than google, but that's not really difficult).
</I>&gt;<i> software like aptly (aptly.info) are really good about this (though a
</I>&gt;<i> little hard to get going in the first place). or a deb-caching proxy
</I>&gt;<i> (apt-cacher-ng? squid-deb-proxy?)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Tue, Oct 4, 2016 at 7:30 AM, Hardik Dangar &lt;
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">hardikdangar+squid at gmail.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Wow, i couldn't think about that. google might need tracking data that
</I>&gt;&gt;<i> could be the reason they have blindly put vary * header. oh Irony, company
</I>&gt;&gt;<i> which talks to all of us on how to deliver content is trying to do such
</I>&gt;&gt;<i> thing.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have looked at your patch but how do i enable that ? do i need to write
</I>&gt;&gt;<i> custom ACL ? i know i need to compile and reinstall after applying patch
</I>&gt;&gt;<i> but what do i need to do exactly in squid.conf file as looking at your
</I>&gt;&gt;<i> patch i am guessing i need to write archive acl or i am too naive to
</I>&gt;&gt;<i> understand C code :)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Also
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> reply_header_replace is any good for this ?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Tue, Oct 4, 2016 at 7:47 PM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
</I>&gt;&gt;<i> wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On 5/10/2016 2:34 a.m., Hardik Dangar wrote:
</I>&gt;&gt;&gt;<i> &gt; Hey Amos,
</I>&gt;&gt;&gt;<i> &gt;
</I>&gt;&gt;&gt;<i> &gt; We have about 50 clients which downloads same google chrome update
</I>&gt;&gt;&gt;<i> every 2
</I>&gt;&gt;&gt;<i> &gt; or 3 days means 2.4 gb. although response says vary but requested file
</I>&gt;&gt;&gt;<i> is
</I>&gt;&gt;&gt;<i> &gt; same and all is downloaded via apt update.
</I>&gt;&gt;&gt;<i> &gt;
</I>&gt;&gt;&gt;<i> &gt; Is there any option just like ignore-no-store? I know i am asking for
</I>&gt;&gt;&gt;<i> too
</I>&gt;&gt;&gt;<i> &gt; much but it seems very silly on google's part that they are sending
</I>&gt;&gt;&gt;<i> very
</I>&gt;&gt;&gt;<i> &gt; header at a place where they shouldn't as no matter how you access
</I>&gt;&gt;&gt;<i> those
</I>&gt;&gt;&gt;<i> &gt; url's you are only going to get those deb files.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Some things G does only make sense whan you ignore all the PR about
</I>&gt;&gt;&gt;<i> wanting to make the web more efficient and consider it's a company whose
</I>&gt;&gt;&gt;<i> income is derived by recording data about peoples habits and activities.
</I>&gt;&gt;&gt;<i> Caching can hide that info from them.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> &gt;
</I>&gt;&gt;&gt;<i> &gt; can i hack squid source code to ignore very header ?
</I>&gt;&gt;&gt;<i> &gt;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Google are explicitly saying the response changes. I suspect there is
</I>&gt;&gt;&gt;<i> something involving Google account data being embeded in some of the
</I>&gt;&gt;&gt;<i> downloads. For tracking, etc.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> If you are wanting to test it I have added a patch to
</I>&gt;&gt;&gt;<i> &lt;<A HREF="http://bugs.squid-cache.org/show_bug.cgi?id=4604">http://bugs.squid-cache.org/show_bug.cgi?id=4604</A>&gt; that should implement
</I>&gt;&gt;&gt;<i> archival of responses where the ACLs match. It is completely untested by
</I>&gt;&gt;&gt;<i> me beyond building, so YMMV.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Amos
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20161006/98c8f171/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20161006/98c8f171/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012908.html">[squid-users] Caching http google deb files
</A></li>
	<LI>Next message (by thread): <A HREF="012914.html">[squid-users] Caching http google deb files
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12912">[ date ]</a>
              <a href="thread.html#12912">[ thread ]</a>
              <a href="subject.html#12912">[ subject ]</a>
              <a href="author.html#12912">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
