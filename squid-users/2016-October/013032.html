<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TCP_MISS/304 question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_MISS/304%20question&In-Reply-To=%3Cbad2a73a-cbe4-f616-8928-c4c666a54c86%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013031.html">
   <LINK REL="Next"  HREF="013033.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TCP_MISS/304 question</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_MISS/304%20question&In-Reply-To=%3Cbad2a73a-cbe4-f616-8928-c4c666a54c86%40measurement-factory.com%3E"
       TITLE="[squid-users] TCP_MISS/304 question">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Oct 13 19:28:40 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013031.html">[squid-users] TCP_MISS/304 question
</A></li>
        <LI>Next message (by thread): <A HREF="013033.html">[squid-users] TCP_MISS/304 question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13032">[ date ]</a>
              <a href="thread.html#13032">[ thread ]</a>
              <a href="subject.html#13032">[ subject ]</a>
              <a href="author.html#13032">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/13/2016 12:46 PM, Yuri Voinov wrote:
&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 14.10.2016 0:28, Alex Rousskov &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;&gt;<i> On 10/13/2016 11:52 AM, Yuri Voinov wrote:
</I>&gt;&gt;&gt;<i> When we seen ??????/304 with only headers - most probably content behind
</I>&gt;&gt;&gt;<i> proxy already and this is CLIENT_IMS_HIT observed.
</I>
&gt;&gt;<i> A 304 code sent by Squid to the client means &quot;Squid told the client that
</I>&gt;&gt;<i> the client has a fresh copy (or equivalent)&quot;. It does not tell us how
</I>&gt;&gt;<i> Squid came up with that answer, or what Squid has in its cache: We do
</I>&gt;&gt;<i> not know whether Squid had the corresponding entry cached when the
</I>&gt;&gt;<i> client request came. If Squid had that entry cached, then Squid may or
</I>&gt;&gt;<i> may not have tried to validate it. If Squid tried to validate, then
</I>&gt;&gt;<i> Squid may or may not have gotten an entry from the origin server.
</I>&gt;&gt;<i> Finally, we do not know whether Squid kept, replaced, or deleted the
</I>&gt;&gt;<i> cache entry as the result of that validation attempt.
</I>&gt;<i> 
</I>&gt;&gt;<i> For an extreme example, consider Squid without a cache. Such a
</I>&gt;&gt;<i> configuration will still have lots of /304 entries in access.log!
</I>&gt;<i> 
</I>&gt;&gt;<i> A single access.log line (and often even a single Squid result code on
</I>&gt;&gt;<i> that line!) is telling us what happened when Squid talked to the client
</I>&gt;&gt;<i> _and_ what happened when Squid talked to the server (if it did talk to
</I>&gt;&gt;<i> the server). One cannot gain that vital information from a single HTTP
</I>&gt;&gt;<i> status code alone.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> Many folks disagree regarding the best way to structure Squid result
</I>&gt;&gt;<i> codes. Many also disagree regarding the best definition for &quot;cache hit&quot;.
</I>&gt;&gt;<i> All the different approaches make it very difficult to discuss these
</I>&gt;&gt;<i> matters and maintain related code. A /304 field alone means the client
</I>&gt;&gt;<i> got an HTTP 304 response. Whether you call that a &quot;hit&quot; from Squid point
</I>&gt;&gt;<i> of view depends on your definition of &quot;hit&quot; _and_ (depending on that
</I>&gt;&gt;<i> definition) on other factors that /304 does not reveal. For example:
</I>&gt;<i> 
</I>&gt;&gt;<i> * if your definition of a &quot;hit&quot; is &quot;Squid did not talk to the origin
</I>&gt;&gt;<i> server or peer&quot;, then /304 alone does not necessarily mean a hit.
</I>&gt;<i> But most probably, right?
</I>
The probability is determined by the environment. I have already given
you a simple example where _all_ /304s mean that Squid talked to the
origin server. In that environment, the probability is 0. There are lots
of environments. I do not know what is &quot;most probable&quot; in yours.



&gt;&gt;<i> * if your definition of a &quot;hit&quot; is &quot;Squid did not receive a large
</I>&gt;&gt;<i> response from the origin server or peer&quot;, then /304 alone does not
</I>&gt;&gt;<i> necessarily mean a hit.
</I>&gt;<i> But still most probably, yes?
</I>
Same answer. I have seen environments where this probability will be
close to zero for this definition of a &quot;hit&quot;.


&gt;<i> Alone - agreed, Alex. But we've can see all transaction, right?
</I>
Sure, but your original question was about /304 alone and you have
resisted Amos' attempts to get more transaction information (AFAICT).


&gt;<i> So, if we've already done request to the same URL in the past, got
</I>&gt;<i> TCP_MISS, then get again, _and_ has saved copy in cache, _and_ we're got
</I>&gt;<i> 304 - this is hit. For shared cache itself.
</I>
Depends on your definition of a hit. And even if Squid cached Xv2 during
the previous transaction, does not mean Squid did not revalidate Xv2
during the last transaction, did not receive Xv3 from a peer, and the
client does not already have and is revalidating Xv4. Yes, there are
certainly lots of cases where what you think is happening is actually
happening, but there are other cases as well.


&gt;<i> But: If something behaves like a hit, it looks like a hit and quacks
</I>&gt;<i> like a hit - it hit. :)
</I>
Unfortunately, there are too many definitions of a &quot;hit&quot;.

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013031.html">[squid-users] TCP_MISS/304 question
</A></li>
	<LI>Next message (by thread): <A HREF="013033.html">[squid-users] TCP_MISS/304 question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13032">[ date ]</a>
              <a href="thread.html#13032">[ thread ]</a>
              <a href="subject.html#13032">[ subject ]</a>
              <a href="author.html#13032">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
