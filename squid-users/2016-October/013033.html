<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TCP_MISS/304 question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_MISS/304%20question&In-Reply-To=%3C0a96829a-d9f5-6d41-efda-931814b96b1f%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013032.html">
   <LINK REL="Next"  HREF="013034.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TCP_MISS/304 question</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_MISS/304%20question&In-Reply-To=%3C0a96829a-d9f5-6d41-efda-931814b96b1f%40gmail.com%3E"
       TITLE="[squid-users] TCP_MISS/304 question">yvoinov at gmail.com
       </A><BR>
    <I>Thu Oct 13 19:44:30 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013032.html">[squid-users] TCP_MISS/304 question
</A></li>
        <LI>Next message (by thread): <A HREF="013034.html">[squid-users] TCP_MISS/304 question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13033">[ date ]</a>
              <a href="thread.html#13033">[ thread ]</a>
              <a href="subject.html#13033">[ subject ]</a>
              <a href="author.html#13033">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256
 


14.10.2016 1:28, Alex Rousskov &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> On 10/13/2016 12:46 PM, Yuri Voinov wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 14.10.2016 0:28, Alex Rousskov &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;&gt;&gt;<i> On 10/13/2016 11:52 AM, Yuri Voinov wrote:
</I>&gt;&gt;&gt;&gt;<i> When we seen ??????/304 with only headers - most probably content
</I>behind
&gt;&gt;&gt;&gt;<i> proxy already and this is CLIENT_IMS_HIT observed.
</I>&gt;<i>
</I>&gt;&gt;&gt;<i> A 304 code sent by Squid to the client means &quot;Squid told the client that
</I>&gt;&gt;&gt;<i> the client has a fresh copy (or equivalent)&quot;. It does not tell us how
</I>&gt;&gt;&gt;<i> Squid came up with that answer, or what Squid has in its cache: We do
</I>&gt;&gt;&gt;<i> not know whether Squid had the corresponding entry cached when the
</I>&gt;&gt;&gt;<i> client request came. If Squid had that entry cached, then Squid may or
</I>&gt;&gt;&gt;<i> may not have tried to validate it. If Squid tried to validate, then
</I>&gt;&gt;&gt;<i> Squid may or may not have gotten an entry from the origin server.
</I>&gt;&gt;&gt;<i> Finally, we do not know whether Squid kept, replaced, or deleted the
</I>&gt;&gt;&gt;<i> cache entry as the result of that validation attempt.
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> For an extreme example, consider Squid without a cache. Such a
</I>&gt;&gt;&gt;<i> configuration will still have lots of /304 entries in access.log!
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> A single access.log line (and often even a single Squid result code on
</I>&gt;&gt;&gt;<i> that line!) is telling us what happened when Squid talked to the client
</I>&gt;&gt;&gt;<i> _and_ what happened when Squid talked to the server (if it did talk to
</I>&gt;&gt;&gt;<i> the server). One cannot gain that vital information from a single HTTP
</I>&gt;&gt;&gt;<i> status code alone.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Many folks disagree regarding the best way to structure Squid result
</I>&gt;&gt;&gt;<i> codes. Many also disagree regarding the best definition for &quot;cache hit&quot;.
</I>&gt;&gt;&gt;<i> All the different approaches make it very difficult to discuss these
</I>&gt;&gt;&gt;<i> matters and maintain related code. A /304 field alone means the client
</I>&gt;&gt;&gt;<i> got an HTTP 304 response. Whether you call that a &quot;hit&quot; from Squid point
</I>&gt;&gt;&gt;<i> of view depends on your definition of &quot;hit&quot; _and_ (depending on that
</I>&gt;&gt;&gt;<i> definition) on other factors that /304 does not reveal. For example:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> * if your definition of a &quot;hit&quot; is &quot;Squid did not talk to the origin
</I>&gt;&gt;&gt;<i> server or peer&quot;, then /304 alone does not necessarily mean a hit.
</I>&gt;&gt;<i> But most probably, right?
</I>&gt;<i>
</I>&gt;<i> The probability is determined by the environment. I have already given
</I>&gt;<i> you a simple example where _all_ /304s mean that Squid talked to the
</I>&gt;<i> origin server. In that environment, the probability is 0. There are lots
</I>&gt;<i> of environments. I do not know what is &quot;most probable&quot; in yours.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;&gt;<i> * if your definition of a &quot;hit&quot; is &quot;Squid did not receive a large
</I>&gt;&gt;&gt;<i> response from the origin server or peer&quot;, then /304 alone does not
</I>&gt;&gt;&gt;<i> necessarily mean a hit.
</I>&gt;&gt;<i> But still most probably, yes?
</I>&gt;<i>
</I>&gt;<i> Same answer. I have seen environments where this probability will be
</I>&gt;<i> close to zero for this definition of a &quot;hit&quot;.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> Alone - agreed, Alex. But we've can see all transaction, right?
</I>&gt;<i>
</I>&gt;<i> Sure, but your original question was about /304 alone and you have
</I>&gt;<i> resisted Amos' attempts to get more transaction information (AFAICT).
</I>Mea culpa. I thought it obvious that, once I show an entry from the log,
I have entire log and, of course, that this is only part of the
transaction, which sees the whole entire proxy.

However, this is nothing more than word games, Alex. The question is -
can we more or less significant differences from known what hit proxy
code level and / or transactions which, obviously, on the proxy level,
we can see in its entirety.
&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> So, if we've already done request to the same URL in the past, got
</I>&gt;&gt;<i> TCP_MISS, then get again, _and_ has saved copy in cache, _and_ we're got
</I>&gt;&gt;<i> 304 - this is hit. For shared cache itself.
</I>&gt;<i>
</I>&gt;<i> Depends on your definition of a hit. And even if Squid cached Xv2 during
</I>&gt;<i> the previous transaction, does not mean Squid did not revalidate Xv2
</I>&gt;<i> during the last transaction, did not receive Xv3 from a peer, and the
</I>&gt;<i> client does not already have and is revalidating Xv4. Yes, there are
</I>&gt;<i> certainly lots of cases where what you think is happening is actually
</I>&gt;<i> happening, but there are other cases as well.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> But: If something behaves like a hit, it looks like a hit and quacks
</I>&gt;&gt;<i> like a hit - it hit. :)
</I>&gt;<i>
</I>&gt;<i> Unfortunately, there are too many definitions of a &quot;hit&quot;.
</I>There is no many definitions of hit. We are talking about the caching
proxy, which is basically no different from all the other caches, and
subject to the same rules.

_If the first access does not find an object in the cache, it requests
from the network, saves in the cache, and re-treatment or gets a hit,
&quot;the object is not changed.&quot; Dot. Further. If the time in the cache
object lifetime expires, or a lifetime on the server timed out - the
object is requested again and a miss is recorded._

The fact that we do not know that there is a client with the object? It
is not our business. It is the client's problem. If the client cache get
miss for an object that no longer exists or its lifetime has expired -
he asks his proxy. Proxy, in the future, or fixes hit or miss. Thus, if
the proxy responds to the client &quot;has not changed&quot;, it means, in fact,
that the client has a copy of the object and a copy of the proxy object,
the proxy and responds to the client, performing REFRESH that the object
did not change. What is this, if not hit?

&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBCAAGBQJX/+QeAAoJENNXIZxhPexGXaUH/0b+UkESSCj/oFxSSOfyJyJJ
IcqBxSWh8A9H6AQKco2i8P7Gjlr7oAGZsbF3YS+Gzr3F0ixVIBHdTOW5aXrhjWzm
wyLeeZsmLh7vD4sSAA3IbO9xvvG01sIWnRekagdpE/Smg7tJNoGC84GInQKbEsCm
2wMrdhb7sxE56kc9OmpcYZ7RghwWr0rqSZZ0S62xW0jSkffbUBUTiyRPQox+uZ9a
YCwZ9Ant+6+yrNzoMA9Yn2ujRD7OvuIlsC/pNZ4GqyIU5NJ+wjvfdbt6rx5l/dcr
DICdfi/adNegw9vF9DG4lm9i2joGFo7+OPzKoQeyuO3f7bLSdyxGapxIVWjTNr8=
=jHaY
-----END PGP SIGNATURE-----

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x613DEC46.asc
Type: application/pgp-keys
Size: 2437 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20161014/b519ae93/attachment.key">http://lists.squid-cache.org/pipermail/squid-users/attachments/20161014/b519ae93/attachment.key</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013032.html">[squid-users] TCP_MISS/304 question
</A></li>
	<LI>Next message (by thread): <A HREF="013034.html">[squid-users] TCP_MISS/304 question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13033">[ date ]</a>
              <a href="thread.html#13033">[ thread ]</a>
              <a href="subject.html#13033">[ subject ]</a>
              <a href="author.html#13033">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
