<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TCP_MISS/304 question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_MISS/304%20question&In-Reply-To=%3Cb00e459b-784e-73ed-61da-8083591b42a2%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013034.html">
   <LINK REL="Next"  HREF="013038.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TCP_MISS/304 question</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_MISS/304%20question&In-Reply-To=%3Cb00e459b-784e-73ed-61da-8083591b42a2%40gmail.com%3E"
       TITLE="[squid-users] TCP_MISS/304 question">yvoinov at gmail.com
       </A><BR>
    <I>Thu Oct 13 21:44:12 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013034.html">[squid-users] TCP_MISS/304 question
</A></li>
        <LI>Next message (by thread): <A HREF="013038.html">[squid-users] TCP_MISS/304 question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13035">[ date ]</a>
              <a href="thread.html#13035">[ thread ]</a>
              <a href="subject.html#13035">[ subject ]</a>
              <a href="author.html#13035">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256
 


14.10.2016 2:48, Alex Rousskov &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> On 10/13/2016 01:44 PM, Yuri Voinov wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> However, this is nothing more than word games, Alex.
</I>&gt;<i>
</I>&gt;<i> ... unless the definition of a hit affects your billing or your
</I>&gt;<i> interpretation of Squid documentation or the developer interpretation of
</I>&gt;<i> the code. Definitions matter! You yourself have seen their importance
</I>&gt;<i> when you showed your excellent byte hit ratio results but folks were
</I>&gt;<i> looking at the ordinary document hit ratio numbers instead.
</I>Sure. But difference with TCP_HIT itself and byte hit is obvious.
&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> The question is -
</I>&gt;&gt;<i> can we more or less significant differences from known what hit proxy
</I>&gt;&gt;<i> code level and / or transactions which, obviously, on the proxy level,
</I>&gt;&gt;<i> we can see in its entirety.
</I>&gt;<i>
</I>&gt;<i> Sorry, I do not understand the question.
</I>I want to say that on the proxy level, seeing the transaction as a
whole, we are able to differentiate hit or his likeness from all other
transactions. We see the whole session in its entirety. We see repeated
queries of the same client to the same resource. Accordingly, we can
quite clearly be judged by the behavior of the header from the client or
server that is happening. Correctly?

Specifically, in this particular case. Proxy IMS settings is enabled:

refresh_all_ims on
reload_into_ims on

On web-page level we have: periodically reload/refresh directive, which
is forces to check (after initially store in shared cache) freshness of
content.

In this situation (and I've checked this web-page elements stored in
cache) TCP_MISS/304 means TCP_REFRESH_UNMODIFIED.

So, this is HIT exactly.

I'm not saying - literally. And in fact. Correctly?

&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;&gt;<i> Unfortunately, there are too many definitions of a &quot;hit&quot;.
</I>&gt;<i>
</I>&gt;&gt;<i> There is no many definitions of hit. We are talking about the caching
</I>&gt;&gt;<i> proxy, which is basically no different from all the other caches, and
</I>&gt;&gt;<i> subject to the same rules.
</I>&gt;<i>
</I>&gt;<i> You are oversimplifying a complex subject matter. If Squid delivers a
</I>&gt;<i> single response comprising 1000 bytes from the cache and 10 bytes from
</I>&gt;<i> the origin server, is that a hit or a miss? If Squid delivers the entire
</I>&gt;<i> response from the cache but spends 10 minutes talking to the origin
</I>&gt;<i> server about that object first, is that a hit or a miss? Different
</I>&gt;<i> people will give you different answers to those questions.
</I>10 minutes a bit above TCP timeout and will be aborted, I think. So,
Squid's write TCP_MISS_ABORTED in access.log. :)
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> We have [poorly defined] byte hits, document hits, revalidation hits,
</I>&gt;<i> stale hits, partial hits, etc., etc.
</I>What yes - yes. The documentation is the problem.
&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> If the first access does not find an object in the cache, it requests
</I>&gt;&gt;<i> from the network,
</I>&gt;<i>
</I>&gt;<i> yes
</I>&gt;<i>
</I>&gt;&gt;<i> saves in the cache,
</I>&gt;<i>
</I>&gt;<i> or does not
</I>Yes. May be or may be not. But in this case we are:
1) Know about transaction history and we know the object(s) in cache.
2) Proxy can easy check it, right? Just swap in object from disk in
memory. If this success, object in cache, so we can qualify it as HIT.
Otherwise, exactly MISS.
&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> and re-treatment or gets a hit,
</I>&gt;<i>
</I>&gt;<i> or does not
</I>&gt;<i>
</I>&gt;&gt;<i> &quot;the object is not changed.&quot; Dot.
</I>&gt;<i>
</I>&gt;<i> or the Squid-cached object did not change but the client-cached object
</I>&gt;<i> did. Or vice versa.
</I>Client-cached object gives from Squid. They (ideally) must not be the
different. Client cache and squid's cache operates like chain, one is
source for another.
&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> If the time in the cache
</I>&gt;&gt;<i> object lifetime expires, or a lifetime on the server timed out - the
</I>&gt;&gt;<i> object is requested again and a miss is recorded.
</I>&gt;<i>
</I>&gt;<i> * Yes, if you define a miss as &quot;contact with the origin server&quot;.
</I>I want to add: &quot;contact with the origin server for get content&quot;. Not for
revalidation purposes. If revalidation returns &quot;Object not changed&quot; -
this is positive and must be qualified as HIT IMO.
&gt;<i>
</I>&gt;<i> * No, if contact with the origin server is OK for a hit as long as the
</I>&gt;<i> server does not send the response _body_ back to Squid.
</I>.... when revalidation true - i.e. object in shared cache not stale,
this is HIT. We're not interested in client browser's cache state. Only
shared cache matters.
&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> if
</I>&gt;&gt;<i> the proxy responds to the client &quot;has not changed&quot;, it means, in fact,
</I>&gt;&gt;<i> that the client has a copy of the object
</I>&gt;<i>
</I>&gt;<i> Yes.
</I>&gt;<i>
</I>&gt;&gt;<i> and a copy of the proxy object,
</I>&gt;<i>
</I>&gt;<i> The copy in the proxy cache may be different from the copy in the client
</I>&gt;<i> cache or may not exist at all.
</I>Yes. If object not exists in proxy - this is proxy MISS. If client cache
not contains object - client go to proxy and asks it about object. Found
- excellent, for client this is MISS, for proxy - HIT. If proxy also not
contains object - it will be MISS-MISS and loading object from origin.

&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> the proxy and responds to the client, performing REFRESH that the object
</I>&gt;&gt;<i> did not change. What is this, if not hit?
</I>&gt;<i>
</I>&gt;<i> Assuming the proxy asked the origin server whether the object in the
</I>&gt;<i> client (or the proxy, depending on the circumstances) cache is fresh,
</I>&gt;<i> for many, it is
</I>&gt;<i>
</I>&gt;<i> * a [document] miss (because there was a potentially very slow contact
</I>&gt;<i> with the origin server) or
</I>&gt;<i> * a [byte] hit (because the response body came from the Squid cache and
</I>&gt;<i> not from the origin server).
</I>&gt;<i>
</I>&gt;<i> Resisting the existence of different valid hit definitions is futile
</I>&gt;<i> IMO. State what _your_ definition is (be as precise as possible; this
</I>&gt;<i> may require several iterations) and then you may ask whether a
</I>&gt;<i> particular transaction is a hit.
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>I agree that there are a number of boundary cases. However, in most
cases we are dealing with a relatively simple chain, which should be
considered and, in my opinion. How is it to be regarded revalidation
facilities and its results? If revalidation confirms that the object is
not stale and not expired - it's a hit, is not it?

If revalidation fails - object stale/expired - everything is clear and
there is nothing to discuss. Definitely miss.

Well, let's say we do not know and can not know about the object in the
client cache. Assume also that we do not want to check - whether this
object is in the cache proxy. Let us assume that we do not want to spend
resources to figure out what happened to the object in the future, in
client's browser, or on proxy's disk cache. Ok. Is, in this case, would
not be more correct to write in log TCP_NONE/304?

In this case, we're talking directly - &quot;We do not know, hit it or not.
We only know that the object has not changed since the last
request/revalidation. We do not want to know, and you can interpret it
any way you like&quot;.

 It would be more correct, it seems to me, than just to say -
&quot;TCP_MISS/304 - This is a cache miss, whatever it was not really.&quot;

WBR, Yuri
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBCAAGBQJYAAAsAAoJENNXIZxhPexGo5EH/15gr4ShSolL0I0RFZOnZbcg
UPZle45kf9ODeLHQ8RKeUwlmOo3jIEeX1WDoYV++scHsqMeBaydwG4ysjED8RhGf
TzfGJyzmTUDzcxe4QpYft3JFvml0uIc74RAPCVq7w6a4FKuPMVHvjqJwJeQtiKSU
V8zkME6SA4K2HrhtiZjvWvFV0YOmH9oQEj7t4S2lt/OJG6w0AsTV3qLHdC6kyeso
rLJkxmJDW7oH7Va+xoP7R6hflsoMv9t3MvuOS1slNyDSZ+nqsRPTJSrhksl7oCIV
I3GI4aPtOecWJOKeenbjWHDyueI6A1+1E5PKgpQW0ysziHi39HyB0Gz1yBhbeWo=
=bTMv
-----END PGP SIGNATURE-----

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x613DEC46.asc
Type: application/pgp-keys
Size: 2437 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20161014/aab382fe/attachment.key">http://lists.squid-cache.org/pipermail/squid-users/attachments/20161014/aab382fe/attachment.key</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013034.html">[squid-users] TCP_MISS/304 question
</A></li>
	<LI>Next message (by thread): <A HREF="013038.html">[squid-users] TCP_MISS/304 question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13035">[ date ]</a>
              <a href="thread.html#13035">[ thread ]</a>
              <a href="subject.html#13035">[ subject ]</a>
              <a href="author.html#13035">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
