<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TCP_MISS/304 question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_MISS/304%20question&In-Reply-To=%3C889d2834-d20a-3d49-30e7-b278878364af%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013035.html">
   <LINK REL="Next"  HREF="013040.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TCP_MISS/304 question</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_MISS/304%20question&In-Reply-To=%3C889d2834-d20a-3d49-30e7-b278878364af%40gmail.com%3E"
       TITLE="[squid-users] TCP_MISS/304 question">yvoinov at gmail.com
       </A><BR>
    <I>Fri Oct 14 09:57:15 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013035.html">[squid-users] TCP_MISS/304 question
</A></li>
        <LI>Next message (by thread): <A HREF="013040.html">[squid-users] TCP_MISS/304 question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13038">[ date ]</a>
              <a href="thread.html#13038">[ thread ]</a>
              <a href="subject.html#13038">[ subject ]</a>
              <a href="author.html#13038">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256
 
It seems I found the root of problem.

When cached object refreshed and goes via HTTP, it gives
TCP_REFRESH_UNMODIFIED in access.log, which is correct.
When the _same_ _cached_ _object_ refreshes and goes via HTTPS, it gives
TCP_MISS/304 in access.log, and this is wrong.

It seems like bug.

14.10.2016 3:44, Yuri Voinov &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 14.10.2016 2:48, Alex Rousskov &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;<i> &gt; On 10/13/2016 01:44 PM, Yuri Voinov wrote:
</I>&gt;<i>
</I>&gt;<i> &gt;&gt; However, this is nothing more than word games, Alex.
</I>&gt;<i>
</I>&gt;<i> &gt; ... unless the definition of a hit affects your billing or your
</I>&gt;<i> &gt; interpretation of Squid documentation or the developer interpretation of
</I>&gt;<i> &gt; the code. Definitions matter! You yourself have seen their importance
</I>&gt;<i> &gt; when you showed your excellent byte hit ratio results but folks were
</I>&gt;<i> &gt; looking at the ordinary document hit ratio numbers instead.
</I>&gt;<i> Sure. But difference with TCP_HIT itself and byte hit is obvious.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;&gt; The question is -
</I>&gt;<i> &gt;&gt; can we more or less significant differences from known what hit proxy
</I>&gt;<i> &gt;&gt; code level and / or transactions which, obviously, on the proxy level,
</I>&gt;<i> &gt;&gt; we can see in its entirety.
</I>&gt;<i>
</I>&gt;<i> &gt; Sorry, I do not understand the question.
</I>&gt;<i> I want to say that on the proxy level, seeing the transaction as a
</I>&gt;<i> whole, we are able to differentiate hit or his likeness from all other
</I>&gt;<i> transactions. We see the whole session in its entirety. We see repeated
</I>&gt;<i> queries of the same client to the same resource. Accordingly, we can
</I>&gt;<i> quite clearly be judged by the behavior of the header from the client or
</I>&gt;<i> server that is happening. Correctly?
</I>&gt;<i>
</I>&gt;<i> Specifically, in this particular case. Proxy IMS settings is enabled:
</I>&gt;<i>
</I>&gt;<i> refresh_all_ims on
</I>&gt;<i> reload_into_ims on
</I>&gt;<i>
</I>&gt;<i> On web-page level we have: periodically reload/refresh directive, which
</I>&gt;<i> is forces to check (after initially store in shared cache) freshness of
</I>&gt;<i> content.
</I>&gt;<i>
</I>&gt;<i> In this situation (and I've checked this web-page elements stored in
</I>&gt;<i> cache) TCP_MISS/304 means TCP_REFRESH_UNMODIFIED.
</I>&gt;<i>
</I>&gt;<i> So, this is HIT exactly.
</I>&gt;<i>
</I>&gt;<i> I'm not saying - literally. And in fact. Correctly?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;&gt;&gt; Unfortunately, there are too many definitions of a &quot;hit&quot;.
</I>&gt;<i>
</I>&gt;<i> &gt;&gt; There is no many definitions of hit. We are talking about the caching
</I>&gt;<i> &gt;&gt; proxy, which is basically no different from all the other caches, and
</I>&gt;<i> &gt;&gt; subject to the same rules.
</I>&gt;<i>
</I>&gt;<i> &gt; You are oversimplifying a complex subject matter. If Squid delivers a
</I>&gt;<i> &gt; single response comprising 1000 bytes from the cache and 10 bytes from
</I>&gt;<i> &gt; the origin server, is that a hit or a miss? If Squid delivers the entire
</I>&gt;<i> &gt; response from the cache but spends 10 minutes talking to the origin
</I>&gt;<i> &gt; server about that object first, is that a hit or a miss? Different
</I>&gt;<i> &gt; people will give you different answers to those questions.
</I>&gt;<i> 10 minutes a bit above TCP timeout and will be aborted, I think. So,
</I>&gt;<i> Squid's write TCP_MISS_ABORTED in access.log. :)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; We have [poorly defined] byte hits, document hits, revalidation hits,
</I>&gt;<i> &gt; stale hits, partial hits, etc., etc.
</I>&gt;<i> What yes - yes. The documentation is the problem.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;&gt; If the first access does not find an object in the cache, it requests
</I>&gt;<i> &gt;&gt; from the network,
</I>&gt;<i>
</I>&gt;<i> &gt; yes
</I>&gt;<i>
</I>&gt;<i> &gt;&gt; saves in the cache,
</I>&gt;<i>
</I>&gt;<i> &gt; or does not
</I>&gt;<i> Yes. May be or may be not. But in this case we are:
</I>&gt;<i> 1) Know about transaction history and we know the object(s) in cache.
</I>&gt;<i> 2) Proxy can easy check it, right? Just swap in object from disk in
</I>&gt;<i> memory. If this success, object in cache, so we can qualify it as HIT.
</I>&gt;<i> Otherwise, exactly MISS.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;&gt; and re-treatment or gets a hit,
</I>&gt;<i>
</I>&gt;<i> &gt; or does not
</I>&gt;<i>
</I>&gt;<i> &gt;&gt; &quot;the object is not changed.&quot; Dot.
</I>&gt;<i>
</I>&gt;<i> &gt; or the Squid-cached object did not change but the client-cached object
</I>&gt;<i> &gt; did. Or vice versa.
</I>&gt;<i> Client-cached object gives from Squid. They (ideally) must not be the
</I>&gt;<i> different. Client cache and squid's cache operates like chain, one is
</I>&gt;<i> source for another.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;&gt; If the time in the cache
</I>&gt;<i> &gt;&gt; object lifetime expires, or a lifetime on the server timed out - the
</I>&gt;<i> &gt;&gt; object is requested again and a miss is recorded.
</I>&gt;<i>
</I>&gt;<i> &gt; * Yes, if you define a miss as &quot;contact with the origin server&quot;.
</I>&gt;<i> I want to add: &quot;contact with the origin server for get content&quot;. Not for
</I>&gt;<i> revalidation purposes. If revalidation returns &quot;Object not changed&quot; -
</I>&gt;<i> this is positive and must be qualified as HIT IMO.
</I>&gt;<i>
</I>&gt;<i> &gt; * No, if contact with the origin server is OK for a hit as long as the
</I>&gt;<i> &gt; server does not send the response _body_ back to Squid.
</I>&gt;<i> .... when revalidation true - i.e. object in shared cache not stale,
</I>&gt;<i> this is HIT. We're not interested in client browser's cache state. Only
</I>&gt;<i> shared cache matters.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;&gt; if
</I>&gt;<i> &gt;&gt; the proxy responds to the client &quot;has not changed&quot;, it means, in fact,
</I>&gt;<i> &gt;&gt; that the client has a copy of the object
</I>&gt;<i>
</I>&gt;<i> &gt; Yes.
</I>&gt;<i>
</I>&gt;<i> &gt;&gt; and a copy of the proxy object,
</I>&gt;<i>
</I>&gt;<i> &gt; The copy in the proxy cache may be different from the copy in the client
</I>&gt;<i> &gt; cache or may not exist at all.
</I>&gt;<i> Yes. If object not exists in proxy - this is proxy MISS. If client cache
</I>&gt;<i> not contains object - client go to proxy and asks it about object. Found
</I>&gt;<i> - excellent, for client this is MISS, for proxy - HIT. If proxy also not
</I>&gt;<i> contains object - it will be MISS-MISS and loading object from origin.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;&gt; the proxy and responds to the client, performing REFRESH that the
</I>object
&gt;<i> &gt;&gt; did not change. What is this, if not hit?
</I>&gt;<i>
</I>&gt;<i> &gt; Assuming the proxy asked the origin server whether the object in the
</I>&gt;<i> &gt; client (or the proxy, depending on the circumstances) cache is fresh,
</I>&gt;<i> &gt; for many, it is
</I>&gt;<i>
</I>&gt;<i> &gt; * a [document] miss (because there was a potentially very slow contact
</I>&gt;<i> &gt; with the origin server) or
</I>&gt;<i> &gt; * a [byte] hit (because the response body came from the Squid cache and
</I>&gt;<i> &gt; not from the origin server).
</I>&gt;<i>
</I>&gt;<i> &gt; Resisting the existence of different valid hit definitions is futile
</I>&gt;<i> &gt; IMO. State what _your_ definition is (be as precise as possible; this
</I>&gt;<i> &gt; may require several iterations) and then you may ask whether a
</I>&gt;<i> &gt; particular transaction is a hit.
</I>&gt;<i>
</I>&gt;<i> &gt; Alex.
</I>&gt;<i> I agree that there are a number of boundary cases. However, in most
</I>&gt;<i> cases we are dealing with a relatively simple chain, which should be
</I>&gt;<i> considered and, in my opinion. How is it to be regarded revalidation
</I>&gt;<i> facilities and its results? If revalidation confirms that the object is
</I>&gt;<i> not stale and not expired - it's a hit, is not it?
</I>&gt;<i>
</I>&gt;<i> If revalidation fails - object stale/expired - everything is clear and
</I>&gt;<i> there is nothing to discuss. Definitely miss.
</I>&gt;<i>
</I>&gt;<i> Well, let's say we do not know and can not know about the object in the
</I>&gt;<i> client cache. Assume also that we do not want to check - whether this
</I>&gt;<i> object is in the cache proxy. Let us assume that we do not want to spend
</I>&gt;<i> resources to figure out what happened to the object in the future, in
</I>&gt;<i> client's browser, or on proxy's disk cache. Ok. Is, in this case, would
</I>&gt;<i> not be more correct to write in log TCP_NONE/304?
</I>&gt;<i>
</I>&gt;<i> In this case, we're talking directly - &quot;We do not know, hit it or not.
</I>&gt;<i> We only know that the object has not changed since the last
</I>&gt;<i> request/revalidation. We do not want to know, and you can interpret it
</I>&gt;<i> any way you like&quot;.
</I>&gt;<i>
</I>&gt;<i>  It would be more correct, it seems to me, than just to say -
</I>&gt;<i> &quot;TCP_MISS/304 - This is a cache miss, whatever it was not really.&quot;
</I>&gt;<i>
</I>&gt;<i> WBR, Yuri
</I>&gt;<i>
</I>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBCAAGBQJYAKv7AAoJENNXIZxhPexGSu4H/RWQb5rwEcT2bnxt50TdadOW
rAHLZ8ASdNDIRoumbXXqmbUTx4vIDTSp+Va77Sw1sKvcJgb/jZ7PdilyQSb60ZsS
IpBVMVbVz0gF7xe2Qqt6lB5Nl48Wmnernb/G47zdXnaJ9d8lZ/P5ed75rbzwXqDY
N7NKa9K2DBnC3PCCYehki2wnQIq7xObN3+D2wnlTSdaqnQFldE/jAmRaDT45A6Ay
awZe47loVM4zo0lTnzqHNlIgfG5ULRjbCHt/a/m4BiS6MPy9mos3yTrZ9xPA0RSX
UmqPTPGQ8gUXGm0YPRDIGT9b4pUZojuRk4ztpeqm6JdYJfF4yePpEnMsYvRWcN4=
=lkj2
-----END PGP SIGNATURE-----

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20161014/92888787/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20161014/92888787/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x613DEC46.asc
Type: application/pgp-keys
Size: 2437 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20161014/92888787/attachment.key">http://lists.squid-cache.org/pipermail/squid-users/attachments/20161014/92888787/attachment.key</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013035.html">[squid-users] TCP_MISS/304 question
</A></li>
	<LI>Next message (by thread): <A HREF="013040.html">[squid-users] TCP_MISS/304 question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13038">[ date ]</a>
              <a href="thread.html#13038">[ thread ]</a>
              <a href="subject.html#13038">[ subject ]</a>
              <a href="author.html#13038">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
