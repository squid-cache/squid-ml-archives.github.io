<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid SMP workers crash
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20SMP%20workers%20crash&In-Reply-To=%3CCAHQdsZ-DQQ_wAJZBVxnd0gRcHKyao-JMdCancuhEsSZ5QXCfTw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013057.html">
   <LINK REL="Next"  HREF="013018.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid SMP workers crash</H1>
    <B>Deniz Eren</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20SMP%20workers%20crash&In-Reply-To=%3CCAHQdsZ-DQQ_wAJZBVxnd0gRcHKyao-JMdCancuhEsSZ5QXCfTw%40mail.gmail.com%3E"
       TITLE="[squid-users] Squid SMP workers crash">denizlist at denizeren.net
       </A><BR>
    <I>Mon Oct 17 08:45:30 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013057.html">[squid-users] Squid SMP workers crash
</A></li>
        <LI>Next message (by thread): <A HREF="013018.html">[squid-users] TCP_MISS/304 question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13071">[ date ]</a>
              <a href="thread.html#13071">[ thread ]</a>
              <a href="subject.html#13071">[ subject ]</a>
              <a href="author.html#13071">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sun, Oct 16, 2016 at 2:57 AM, Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt; wrote:
&gt;<i> Hey,
</I>&gt;<i>
</I>&gt;<i> I can try to replicate the same configuration removing couple settings just to make it simpler to verify if the issue since it's similar to the next testing lab I have planned.
</I>&gt;<i> Can you give more detail about the OS? CentOS, Ubuntu, Other?
</I>CentOS 5

&gt;<i> If it's a self compiled versions then &quot;squid -v&quot; output.
</I>Squid Cache: Version 3.5.20
Service Name: squid
configure options:  '--build=i686-redhat-linux-gnu'
'--host=i686-redhat-linux-gnu' '--target=i386-redhat-linux-gnu'
'--program-prefix=' '--exec-prefix=/opt/squid'
'--datadir=/opt/squid/share' '--libdir=/opt/squid/lib'
'--libexecdir=/opt/squid/libexec' '--localstatedir=/var'
'--sharedstatedir=/opt/squid/com' '--infodir=/usr/share/info'
'--prefix=/opt/squid' '--exec_prefix=/opt/squid'
'--bindir=/opt/squid/bin' '--sbindir=/opt/squid/sbin'
'--sysconfdir=/opt/squid/etc' '--datadir=/opt/squid/share/squid'
'--includedir=/opt/squid/include' '--libdir=/opt/squid/lib/squid'
'--libexecdir=/opt/squid/lib/squid' '--localstatedir=/opt/squid/var'
'--mandir=/opt/squid/share/man' '--infodir=/opt/squid/share/info'
'--enable-epoll' '--disable-dependency-tracking' '--enable-arp-acl'
'--enable-auth' '--enable-auth-negotiate' '--enable-auth-digest'
'--enable-auth-basic' '--enable-auth-ntlm' '--enable-cache-digests'
'--enable-cachemgr-hostname=localhost' '--enable-delay-pools'
'--enable-external-acl-helpers' '--enable-icap-client'
'--with-large-files' '--enable-linux-netfilter' '--enable-referer-log'
'--enable-removal-policies=heap,lru' '--enable-snmp' '--enable-ssl'
'--enable-storeio=aufs,diskd,ufs' '--enable-useragent-log'
'--enable-wccpv2' '--with-aio' '--with-default-user=squid'
'--with-filedescriptors=32768' '--with-dl' '--enable-ssl-crtd'
'--with-openssl=/opt/openssl101' '--with-pthreads'
'--enable-http-violations' '--enable-follow-x-forwarded-for'
'--disable-ipv6' 'build_alias=i686-redhat-linux-gnu'
'host_alias=i686-redhat-linux-gnu'
'target_alias=i386-redhat-linux-gnu' 'CFLAGS=-fPIE -Os -g -pipe
-fsigned-char -I /usr/kerberos/include -I/opt/openssl101/include -O2
-g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
--param=ssp-buffer-size=4 -m32 -march=i386 -mtune=generic
-fasynchronous-unwind-tables' 'LDFLAGS=-pie -L/opt/openssl101/lib'
'CXXFLAGS=-fPIE -I/opt/openssl101/include -O2 -g -pipe -Wall
-Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector
--param=ssp-buffer-size=4 -m32 -march=i386 -mtune=generic
-fasynchronous-unwind-tables'
'PKG_CONFIG_PATH=/opt/squid/lib/pkgconfig:/opt/squid/share/pkgconfig'
--enable-ltdl-convenience


&gt;<i> I have also seen that you are intercepting both http and https traffic, have you tried looking at the logs?
</I>You are right I'm intercepting both http and https traffic. Yes I have
looked at logs and only suspicious thing is this line:
2016/10/17 11:22:37 kid1| assertion failed:
../../src/ipc/AtomicWord.h:71: &quot;Enabled()&quot;

&gt;<i>
</I>&gt;<i> If you don't hear me from me fast enough just bump me with an email.
</I>&gt;<i>
</I>&gt;<i> Eliezer
</I>&gt;<i>
</I>&gt;<i> ----
</I>&gt;<i> Eliezer Croitoru
</I>&gt;<i> Linux System Administrator
</I>&gt;<i> Mobile+WhatsApp: +972-5-28704261
</I>&gt;<i> Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Deniz Eren
</I>&gt;<i> Sent: Thursday, October 13, 2016 10:53 AM
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: [squid-users] Squid SMP workers crash
</I>&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I'm using squid's SMP functionality to distribute requests to many
</I>&gt;<i> squid instances and distribute workload to multiple processors.
</I>&gt;<i> However while running squid's workers after a while worker processes
</I>&gt;<i> crash with the error below and coordinator does not start them again:
</I>&gt;<i> ...
</I>&gt;<i> FATAL: Ipc::Mem::Segment::open failed to
</I>&gt;<i> shm_open(/squid-cf__metadata.shm): (2) No such file or directory
</I>&gt;<i> Squid Cache (Version 3.5.20): Terminated abnormally.
</I>&gt;<i> ...
</I>&gt;<i>
</I>&gt;<i> Does a solution exists for this problem? (permissions are OK in /dev/shm)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> When everything is OK coordinator listens to http_ports/https_port and
</I>&gt;<i> distributes connections to workers(at least that's the conclusion I
</I>&gt;<i> got from looking access.logs).
</I>&gt;<i> [<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at squidbox</A> ~]# netstat -nlp|grep squid
</I>&gt;<i> tcp        0      0 0.0.0.0:8080                0.0.0.0:*
</I>&gt;<i>      LISTEN      7887/(squid-coord-1
</I>&gt;<i> tcp        0      0 0.0.0.0:3127                0.0.0.0:*
</I>&gt;<i>      LISTEN      7887/(squid-coord-1
</I>&gt;<i> tcp        0      0 0.0.0.0:3128                0.0.0.0:*
</I>&gt;<i>      LISTEN      7887/(squid-coord-1
</I>&gt;<i> tcp        0      0 0.0.0.0:3130                0.0.0.0:*
</I>&gt;<i>      LISTEN      7887/(squid-coord-1
</I>&gt;<i> tcp        0      0 0.0.0.0:8443                0.0.0.0:*
</I>&gt;<i>      LISTEN      7887/(squid-coord-1
</I>&gt;<i> udp        0      0 0.0.0.0:57850               0.0.0.0:*
</I>&gt;<i>                  7897/(squid-1)
</I>&gt;<i> udp        0      0 0.0.0.0:33643               0.0.0.0:*
</I>&gt;<i>                  7894/(squid-4)
</I>&gt;<i> udp        0      0 0.0.0.0:50485               0.0.0.0:*
</I>&gt;<i>                  7896/(squid-2)
</I>&gt;<i> udp        0      0 0.0.0.0:46427               0.0.0.0:*
</I>&gt;<i>                  7887/(squid-coord-1
</I>&gt;<i> udp        0      0 0.0.0.0:58938               0.0.0.0:*
</I>&gt;<i>                  7895/(squid-3)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Also is my way of using SMP functionality correct, since I want to
</I>&gt;<i> distribute all connections between workers and to listen only specific
</I>&gt;<i> ports?
</I>&gt;<i>
</I>&gt;<i> I have attached the squid.conf.
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013057.html">[squid-users] Squid SMP workers crash
</A></li>
	<LI>Next message (by thread): <A HREF="013018.html">[squid-users] TCP_MISS/304 question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13071">[ date ]</a>
              <a href="thread.html#13071">[ thread ]</a>
              <a href="subject.html#13071">[ subject ]</a>
              <a href="author.html#13071">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
