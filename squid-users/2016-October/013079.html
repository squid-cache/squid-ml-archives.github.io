<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid SMP workers crash
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20SMP%20workers%20crash&In-Reply-To=%3C203e89fd-c1b7-3b02-1b30-d66505e24ff0%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013077.html">
   <LINK REL="Next"  HREF="013080.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid SMP workers crash</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20SMP%20workers%20crash&In-Reply-To=%3C203e89fd-c1b7-3b02-1b30-d66505e24ff0%40measurement-factory.com%3E"
       TITLE="[squid-users] Squid SMP workers crash">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Oct 18 05:16:27 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013077.html">[squid-users] Squid SMP workers crash
</A></li>
        <LI>Next message (by thread): <A HREF="013080.html">[squid-users] Squid SMP workers crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13079">[ date ]</a>
              <a href="thread.html#13079">[ thread ]</a>
              <a href="subject.html#13079">[ subject ]</a>
              <a href="author.html#13079">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/17/2016 10:37 PM, Deniz Eren wrote:
&gt;<i> On Mon, Oct 17, 2016 at 7:43 PM, Alex Rousskov wrote:
</I>&gt;&gt;<i> On 10/17/2016 02:38 AM, Deniz Eren wrote:
</I>&gt;&gt;&gt;<i> 2016/10/17 11:22:37 kid1| assertion failed:
</I>&gt;&gt;&gt;<i> ../../src/ipc/AtomicWord.h:71: &quot;Enabled()&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Either your Squid does not support SMP (a build environment problem) or
</I>&gt;&gt;<i> Squid is trying to use SMP features when SMP is not enabled (a Squid bug).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> What does the following command show?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   fgrep -RI HAVE_ATOMIC_OPS config.status include/autoconf.h
</I>&gt;<i> fgrep -RI HAVE_ATOMIC_OPS config.status include/autoconf.h
</I>&gt;<i> config.status:D[&quot;HAVE_ATOMIC_OPS&quot;]=&quot; 0&quot;
</I>&gt;<i> include/autoconf.h:#define HAVE_ATOMIC_OPS 0
</I>
Your Squid does not support SMP. The ./configure script failed to find
the necessary APIs for SMP support. I wish Squid would tell you that in
a less obscure way than an Enabled() assertion; feel free to file a bug
report about that, but that is a reporting/UI problem; the assertion
itself is correct.

I do not know why your build environment lacks atomics support (or why
Squid cannot detect that support), but I hope that others on the mailing
list would be able to help you with that investigation.


Finally, in the interest of full disclosure, I have to note that, IIRC,
atomics are not actually required for some of the primitive SMP
features, but Squid attempts to create a few shared memory tables even
when those tables are not needed, and those tables do require atomics
(and will hit the Enabled() assertion you have reported).

There have been improvements in this area; eventually no unnecessary
shared memory tables will be created, but it is probably easier for you
to get a build with working atomics (usually does not require any
development) than to get rid of those tables (which probably require
more development).

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013077.html">[squid-users] Squid SMP workers crash
</A></li>
	<LI>Next message (by thread): <A HREF="013080.html">[squid-users] Squid SMP workers crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13079">[ date ]</a>
              <a href="thread.html#13079">[ thread ]</a>
              <a href="subject.html#13079">[ subject ]</a>
              <a href="author.html#13079">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
