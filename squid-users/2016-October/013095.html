<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 4.x and Peek and Splice - Host Header	Forgery
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%204.x%20and%20Peek%20and%20Splice%20-%20Host%20Header%0A%09Forgery&In-Reply-To=%3CCACU80L4YreyqiXtURO3OEwcbsQkqLnGFCO_p%3D7iPgBSYjMjNWg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013093.html">
   <LINK REL="Next"  HREF="013096.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 4.x and Peek and Splice - Host Header	Forgery</H1>
    <B>John Wright</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%204.x%20and%20Peek%20and%20Splice%20-%20Host%20Header%0A%09Forgery&In-Reply-To=%3CCACU80L4YreyqiXtURO3OEwcbsQkqLnGFCO_p%3D7iPgBSYjMjNWg%40mail.gmail.com%3E"
       TITLE="[squid-users] Squid 4.x and Peek and Splice - Host Header	Forgery">unixdeaf at gmail.com
       </A><BR>
    <I>Tue Oct 18 18:10:47 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013093.html">[squid-users] Squid 4.x and Peek and Splice - Host Header	Forgery
</A></li>
        <LI>Next message (by thread): <A HREF="013096.html">[squid-users] Squid 4.x and Peek and Splice - Host Header	Forgery
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13095">[ date ]</a>
              <a href="thread.html#13095">[ thread ]</a>
              <a href="subject.html#13095">[ subject ]</a>
              <a href="author.html#13095">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>In response to it not being a false positive , maybe its not specifically
the TTL but in this other article on the mailing lists someone else had the
same issue


Here is the response Amos gave, this is a known issue and apparently there
is no way to &quot;ignore host header forgery issues&quot; or bypass them in the
squid config.
My understanding is that , maybe the short TTL is ok, but it is small
enough to where when a cloud based client is connecting to server a server
b to amazon S3 etc it can take a few seconds
Thus that 5 second TTL (which again is often 2-3 seconds) is small enough
to hurt.

Specifically some of these people (aws , google) in some dns situations
they are doing things that squid has been known to identify as host header
forgery just becuse it doesnt understand whats happening.
Also if im doing an S3 call pulling or pushing a big file which is very
common in cloud environments it can take 10-20 seconds for the request to
process , and if TTL expires mid stream , squid is for some reason flagging
as forgery and it hangs until it either returns to the same ip in
DNS by chance or until the connection is dropped.

<A HREF="http://lists.squid-cache.org/pipermail/squid-users/2016-August/012261.html">http://lists.squid-cache.org/pipermail/squid-users/2016-August/012261.html</A>
Here is the note from Amos

&gt;&gt;<i>* The cases where Squid still gets it wrong are where the popular CDN
</I>*&gt;&gt;* service(s) in question are performing DNS actions indistinguishable to
*&gt;&gt;* those malware attacks. If Squid can't tell the difference between an
*&gt;&gt;* attack and normal DNS behaviour the only code change possible is to
*&gt;&gt;* disable the check (see above about the risk level).
*&gt;&gt;


On Tue, Oct 18, 2016 at 2:01 PM, &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">garryd at comnet.uz</A>&gt; wrote:

&gt;<i> On 2016-10-18 22:42, John Wright wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Replying to the list
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Yes i get that error on many different sites same exact error about
</I>&gt;&gt;<i> host headers.
</I>&gt;&gt;<i> Also if you watch the TTL on the amazonaws url i provided it changes
</I>&gt;&gt;<i> from 3 to 5 to 10 seconds to 60 to 10 back and forth.
</I>&gt;&gt;<i> If you go online to an dns lookup site like kloth i see via kloth 5
</I>&gt;&gt;<i> seconds TTL
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> i get a different TTL value at different times, it appears they dont
</I>&gt;&gt;<i> have a set TTL but they change it often and it varies.
</I>&gt;&gt;<i> Right now it appears to be a ttl of 60 seconds as you found but
</I>&gt;&gt;<i> earlier and over the weekend it has shown 5 seconds and even AWS
</I>&gt;&gt;<i> support verified it can vary as low as 5 seconds.
</I>&gt;&gt;<i> That being said , when it is changing every 3-5 seconds which comes
</I>&gt;&gt;<i> and goes , squid gives the header forgery errors as shown before.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The time interval between client's and Squid's name lookup is measured in
</I>&gt;<i> milliseconds. So, in most cases, the would not be false positives in
</I>&gt;<i> environments where same cashing DNS server is used.
</I>&gt;<i>
</I>&gt;<i> That specific issue you encounter except alert messages and Squid's
</I>&gt;<i> inability to cache HTTP responses for &quot;forged&quot; HTTP requests?
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>


-- 
Thank you for your time,

John Wright
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20161018/313870b6/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20161018/313870b6/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013093.html">[squid-users] Squid 4.x and Peek and Splice - Host Header	Forgery
</A></li>
	<LI>Next message (by thread): <A HREF="013096.html">[squid-users] Squid 4.x and Peek and Splice - Host Header	Forgery
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13095">[ date ]</a>
              <a href="thread.html#13095">[ thread ]</a>
              <a href="subject.html#13095">[ subject ]</a>
              <a href="author.html#13095">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
