<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Peeking on TLS traffic: unknown cipher returned
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Peeking%20on%20TLS%20traffic%3A%20unknown%20cipher%20returned&In-Reply-To=%3C8b73df74-68ce-6443-ab01-9a61e6a1d481%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013111.html">
   <LINK REL="Next"  HREF="013117.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Peeking on TLS traffic: unknown cipher returned</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Peeking%20on%20TLS%20traffic%3A%20unknown%20cipher%20returned&In-Reply-To=%3C8b73df74-68ce-6443-ab01-9a61e6a1d481%40measurement-factory.com%3E"
       TITLE="[squid-users] Peeking on TLS traffic: unknown cipher returned">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Oct 20 06:17:21 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013111.html">[squid-users] Peeking on TLS traffic: unknown cipher returned
</A></li>
        <LI>Next message (by thread): <A HREF="013117.html">[squid-users] Peeking on TLS traffic: unknown cipher returned
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13112">[ date ]</a>
              <a href="thread.html#13112">[ thread ]</a>
              <a href="subject.html#13112">[ subject ]</a>
              <a href="author.html#13112">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/19/2016 10:12 PM, Jason Haar wrote:

&gt;<i> This is a complex situation for most people (myself included), can you
</I>&gt;<i> tell us how to &quot;peek and make a decision based on SNI&quot;?
</I>
I have (long time ago) in the &quot;Peek at SNI and Bump&quot; and other examples
at <A HREF="http://wiki.squid-cache.org/Features/SslPeekAndSplice">http://wiki.squid-cache.org/Features/SslPeekAndSplice</A>

Since then, that page have been significantly improved, mostly by others
(thanks, Marcus!) so you may find better examples there.

In short, if you want to do everything based on SNI, then do not let
Squid to get to SslBump step3. Make all final (splice, bump, or
terminate) decisions during step2 (or earlier). That implies that your
ssl_bump rules have to be shaped without step2 and step3 ACLs.


&gt;<i> I'm probably like the original poster in that I simply want to be able
</I>&gt;<i> to do transparent proxy of TCP/443 so as to better log HTTPS
</I>&gt;<i> transactions. I wouldn't even bother with the &quot;terminate&quot; bit - if I
</I>&gt;<i> wanted to blacklist some HTTPS sites, I'd rather rely on the normal
</I>&gt;<i> non-bumping ACLs, the SNI-learnt domain names -  and &quot;deny&quot; - I don't
</I>&gt;<i> care if a cleartext blob is sent through to a client who thinks it's TLS
</I>&gt;<i> - it will break and that's all that matters.
</I>
Squid does not work that way. If you tell Squid to &quot;deny&quot; something,
Squid will most likely try to bump the client connection to serve the
corresponding error page. The early developers, reviewers, and users all
thought that serving a plain text error response to an SSL client is
pointless. If you want to avoid bumping at all costs, then &quot;ssl_bump
terminate&quot; is your best option.

Virtually all errors, including certificate validation and OpenSSL
failures are treated similar to access denials and result in bumping.
This is often the right default, but it would be good to add a knob for
fine-tuning that behavior, similar to how the recently added
on_unsupported_protocol fine-tunes treatment of parsing errors.


HTH,

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013111.html">[squid-users] Peeking on TLS traffic: unknown cipher returned
</A></li>
	<LI>Next message (by thread): <A HREF="013117.html">[squid-users] Peeking on TLS traffic: unknown cipher returned
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13112">[ date ]</a>
              <a href="thread.html#13112">[ thread ]</a>
              <a href="subject.html#13112">[ subject ]</a>
              <a href="author.html#13112">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
