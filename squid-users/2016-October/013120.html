<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] FTP : Squid sending private IP in PASV response
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FTP%20%3A%20Squid%20sending%20private%20IP%20in%20PASV%20response&In-Reply-To=%3C1477040524.18948.30.camel%40comnet.uz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013119.html">
   <LINK REL="Next"  HREF="013155.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] FTP : Squid sending private IP in PASV response</H1>
    <B>Garri Djavadyan</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FTP%20%3A%20Squid%20sending%20private%20IP%20in%20PASV%20response&In-Reply-To=%3C1477040524.18948.30.camel%40comnet.uz%3E"
       TITLE="[squid-users] FTP : Squid sending private IP in PASV response">garryd at comnet.uz
       </A><BR>
    <I>Fri Oct 21 09:02:04 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013119.html">[squid-users] FTP : Squid sending private IP in PASV response
</A></li>
        <LI>Next message (by thread): <A HREF="013155.html">[squid-users] FTP : Squid sending private IP in PASV response
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13120">[ date ]</a>
              <a href="thread.html#13120">[ thread ]</a>
              <a href="subject.html#13120">[ subject ]</a>
              <a href="author.html#13120">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, 2016-10-21 at 08:27 +0000, Gael Ancelin wrote:
&gt;<i> WAN_IP---[FW]-------localIP1-[SQUID]-localIP2------------localIP3-
</I>&gt;<i> [FTP_Server]
</I>&gt;<i> 
</I>&gt;<i> I was expecting something like &quot;227 Entering Passive Mode
</I>&gt;<i> (54,xx,xx,xx,213,249).&quot;&#160;
</I>&gt;<i> with public ip.
</I>&gt;<i> What I want is a response like (WAN_IP,port), but what I obtain is&#160;
</I>&gt;<i> (localIP1,port) instead.
</I>&gt;<i> 
</I>&gt;<i> Squid does not respond with the FTP server address, so I presume that
</I>&gt;<i> Squid is
</I>&gt;<i> understanding enough FTP protocol to modify response and put his own
</I>&gt;<i> ip address
</I>&gt;<i> instead of the real FTP server's.
</I>
According to your scheme, FW is DNAT device and it forwards packets
destined to FTP control channel port (21) on public IP of FW to private
localIP1 of SQUID. In that scenario Squid don't even know that the
client used WAN_IP to access FTP service and therefore it can't use the
public IP even if it wish.


&gt;<i> So I'm wondering if it exists a way to force squid to respond with a
</I>&gt;<i>&#160;fixed IP&#160;&gt;&#160;address instead of his own local address.
</I>
Here&#160;<A HREF="http://www.squid-cache.org/Doc/config/&#160;you">http://www.squid-cache.org/Doc/config/&#160;you</A> can find all available
options.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013119.html">[squid-users] FTP : Squid sending private IP in PASV response
</A></li>
	<LI>Next message (by thread): <A HREF="013155.html">[squid-users] FTP : Squid sending private IP in PASV response
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13120">[ date ]</a>
              <a href="thread.html#13120">[ thread ]</a>
              <a href="subject.html#13120">[ subject ]</a>
              <a href="author.html#13120">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
