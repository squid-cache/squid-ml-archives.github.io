<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Objects with values below 60 second for Cache-Control max-age are not cached
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Objects%20with%20values%20below%2060%20second%20for%0A%20Cache-Control%20max-age%20are%20not%20cached&In-Reply-To=%3Cea5d1b64-334a-45f9-deb4-832019630155%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013244.html">
   <LINK REL="Next"  HREF="013256.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Objects with values below 60 second for Cache-Control max-age are not cached</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Objects%20with%20values%20below%2060%20second%20for%0A%20Cache-Control%20max-age%20are%20not%20cached&In-Reply-To=%3Cea5d1b64-334a-45f9-deb4-832019630155%40treenet.co.nz%3E"
       TITLE="[squid-users] Objects with values below 60 second for Cache-Control max-age are not cached">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Oct 26 10:58:39 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013244.html">[squid-users] Objects with values below 60 second for Cache-Control max-age are not cached
</A></li>
        <LI>Next message (by thread): <A HREF="013256.html">[squid-users] Objects with values below 60 second for Cache-Control max-age are not cached
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13248">[ date ]</a>
              <a href="thread.html#13248">[ thread ]</a>
              <a href="subject.html#13248">[ subject ]</a>
              <a href="author.html#13248">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 26/10/2016 7:21 p.m., Garri Djavadyan wrote:
&gt;<i> On Wed, 2016-08-24 at 19:09 +0500, Garri Djavadyan wrote:
</I>&gt;&gt;<i> On Mon, 2016-08-22 at 16:46 +0500, Garri Djavadyan wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Hello Squid users,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Can anyone explain, why Squid doesn't cache the objects with max-
</I>&gt;&gt;&gt;<i> age
</I>&gt;&gt;&gt;<i> values below 60 seconds?
</I>
Several possible reasons...

&gt;<i> For example:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> $ http_proxy=&quot;127.0.0.1:3128&quot; curl --head &quot;<A HREF="http://sandbox.comnet.lo">http://sandbox.comnet.lo</A>
</I>&gt;&gt;&gt;<i> ca
</I>&gt;&gt;&gt;<i> l/
</I>&gt;&gt;&gt;<i> cgi-bin/hello.cgi&quot; &amp;&amp; date
</I>&gt;&gt;&gt;<i> HTTP/1.1 200 OK
</I>&gt;&gt;&gt;<i> Date: Mon, 22 Aug 2016 11:31:16 GMT
</I>&gt;&gt;&gt;<i> Server: Apache
</I>&gt;&gt;&gt;<i> Cache-Control: max-age=60
</I>&gt;&gt;&gt;<i> Content-Type: text/plain
</I>&gt;&gt;&gt;<i> X-Cache: MISS from gentoo.comnet.uz
</I>&gt;&gt;&gt;<i> Via: 1.1 gentoo.comnet.uz (squid/3.5.20)
</I>&gt;&gt;&gt;<i> Connection: keep-alive
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Mon Aug 22 16:31:19 UZT 2016
</I>&gt;&gt;&gt;<i>
</I>
1) This is not a GET request.

There is no object data returned on a HEAD request. So Squid does not
have anything to cache.

If you did a GET before this request, then the caching time is relative
to that request, not this one.


2) There is no Last-Modified header.

Squid older than 3.5.22 do not revalidate properly with only a Date
header. Meaning new content is required fetching if the cached object
was stale.

3) The response to a HEAD request is supposed to be the headers that
would be sent in an equivalent GET. So the servers upstream response
headers are the right output here in light of (2) and/or (1).

&gt;&gt;&gt;<i> ---
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> $ http_proxy=&quot;127.0.0.1:3128&quot; curl --head &quot;<A HREF="http://sandbox.comnet.lo">http://sandbox.comnet.lo</A>
</I>&gt;&gt;&gt;<i> ca
</I>&gt;&gt;&gt;<i> l/
</I>&gt;&gt;&gt;<i> cgi-bin/hello.cgi&quot; &amp;&amp; date
</I>&gt;&gt;&gt;<i> HTTP/1.1 200 OK
</I>&gt;&gt;&gt;<i> Date: Mon, 22 Aug 2016 11:31:23 GMT
</I>&gt;&gt;&gt;<i> Server: Apache
</I>&gt;&gt;&gt;<i> Cache-Control: max-age=60
</I>&gt;&gt;&gt;<i> Content-Type: text/plain
</I>&gt;&gt;&gt;<i> X-Cache: MISS from gentoo.comnet.uz
</I>&gt;&gt;&gt;<i> Via: 1.1 gentoo.comnet.uz (squid/3.5.20)
</I>&gt;&gt;&gt;<i> Connection: keep-alive
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Mon Aug 22 16:31:26 UZT 2016
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> No problems with values above 60 seconds. For example:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> $ http_proxy=&quot;127.0.0.1:3128&quot; curl --head &quot;<A HREF="http://sandbox.comnet.lo">http://sandbox.comnet.lo</A>
</I>&gt;&gt;&gt;<i> ca
</I>&gt;&gt;&gt;<i> l/
</I>&gt;&gt;&gt;<i> cgi-bin/hello.cgi&quot; &amp;&amp; date
</I>&gt;&gt;&gt;<i> HTTP/1.1 200 OK
</I>&gt;&gt;&gt;<i> Date: Mon, 22 Aug 2016 11:36:06 GMT
</I>&gt;&gt;&gt;<i> Server: Apache
</I>&gt;&gt;&gt;<i> Cache-Control: max-age=70
</I>&gt;&gt;&gt;<i> Content-Type: text/plain
</I>&gt;&gt;&gt;<i> X-Cache: MISS from gentoo.comnet.uz
</I>&gt;&gt;&gt;<i> Via: 1.1 gentoo.comnet.uz (squid/3.5.20)
</I>&gt;&gt;&gt;<i> Connection: keep-alive
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Mon Aug 22 16:36:09 UZT 2016
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> ---
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> $ http_proxy=&quot;127.0.0.1:3128&quot; curl --head &quot;<A HREF="http://sandbox.comnet.lo">http://sandbox.comnet.lo</A>
</I>&gt;&gt;&gt;<i> ca
</I>&gt;&gt;&gt;<i> l/
</I>&gt;&gt;&gt;<i> cgi-bin/hello.cgi&quot; &amp;&amp; date
</I>&gt;&gt;&gt;<i> HTTP/1.1 200 OK
</I>&gt;&gt;&gt;<i> Date: Mon, 22 Aug 2016 11:36:06 GMT
</I>&gt;&gt;&gt;<i> Server: Apache
</I>&gt;&gt;&gt;<i> Cache-Control: max-age=70
</I>&gt;&gt;&gt;<i> Content-Type: text/plain
</I>&gt;&gt;&gt;<i> Age: 5
</I>&gt;&gt;&gt;<i> X-Cache: HIT from gentoo.comnet.uz
</I>&gt;&gt;&gt;<i> Via: 1.1 gentoo.comnet.uz (squid/3.5.20)
</I>&gt;&gt;&gt;<i> Connection: keep-alive
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Mon Aug 22 16:36:11 UZT 2016
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> As you can see, time difference between origin server and localhost
</I>&gt;&gt;&gt;<i> is
</I>&gt;&gt;&gt;<i> 3 seconds (UZT is +5 offset).
</I>
Your interpretation of the timestamps is flawed.

The message header contains teh timestamp the servre generated teh message.
The 'date' tool produces the timestamp at teh time the transaction
delivering it was completed.

All that is evident is that the transaction took ~5 seconds from message
generation to completion of delivery. That may contain any amount of +N
or -N difference in the three machines clocks (server, proxy, and client).

...


&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Configuration is minimal:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> # diff -u etc/squid.conf.default etc/squid.conf
</I>&gt;&gt;&gt;<i> --- etc/squid.conf.default	2016-08-12 17:21:48.877474780
</I>&gt;&gt;&gt;<i> +0500
</I>&gt;&gt;&gt;<i> +++ etc/squid.conf	2016-08-22 16:41:47.759766991 +0500
</I>&gt;&gt;&gt;<i> @@ -71,3 +71,5 @@
</I>&gt;&gt;&gt;<i>  refresh_pattern ^gopher:	1440	0%	1440
</I>&gt;&gt;&gt;<i>  refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
</I>&gt;&gt;&gt;<i>  refresh_pattern .		0	20%	4320
</I>&gt;&gt;&gt;<i> +
</I>&gt;&gt;&gt;<i> +cache_mem 64 MB
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Thanks in advance!
</I>&gt;&gt;&gt;<i> Garri
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Dear Squid developers,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Is the situation described above intended behaviour, or a bug which
</I>&gt;&gt;<i> should be reported? Thanks.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Garri
</I>&gt;<i> 
</I>&gt;<i> Squid debugging led me to:
</I>&gt;<i> <A HREF="http://www.squid-cache.org/Doc/config/minimum_expiry_time/">http://www.squid-cache.org/Doc/config/minimum_expiry_time/</A>
</I>&gt;<i> 
</I>
HTTP requires a full second resolution of time, no shorter due to clock
skew across the length and breadth of the Internet. And for the same
reason 60sec resolution on caching is recommended for best response
accuracy if any type of long-distance exists between servers and proxy.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013244.html">[squid-users] Objects with values below 60 second for Cache-Control max-age are not cached
</A></li>
	<LI>Next message (by thread): <A HREF="013256.html">[squid-users] Objects with values below 60 second for Cache-Control max-age are not cached
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13248">[ date ]</a>
              <a href="thread.html#13248">[ thread ]</a>
              <a href="subject.html#13248">[ subject ]</a>
              <a href="author.html#13248">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
