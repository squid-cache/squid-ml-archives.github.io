<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] HTTPS chrome - SHA1 this page is insecure
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20HTTPS%20chrome%20-%20SHA1%20this%20page%20is%20insecure&In-Reply-To=%3CDB6PR0401MB26800E07801A286AF0410BC38FE20%40DB6PR0401MB2680.eurprd04.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012294.html">
   <LINK REL="Next"  HREF="012296.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] HTTPS chrome - SHA1 this page is insecure</H1>
    <B>Rafael Akchurin</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20HTTPS%20chrome%20-%20SHA1%20this%20page%20is%20insecure&In-Reply-To=%3CDB6PR0401MB26800E07801A286AF0410BC38FE20%40DB6PR0401MB2680.eurprd04.prod.outlook.com%3E"
       TITLE="[squid-users] HTTPS chrome - SHA1 this page is insecure">rafael.akchurin at diladele.com
       </A><BR>
    <I>Thu Sep  1 09:54:43 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012294.html">[squid-users] HTTPS chrome - SHA1 this page is insecure
</A></li>
        <LI>Next message (by thread): <A HREF="012296.html">[squid-users] Web Whatsapp, Dropbox... problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12295">[ date ]</a>
              <a href="thread.html#12295">[ thread ]</a>
              <a href="subject.html#12295">[ subject ]</a>
              <a href="author.html#12295">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello everyone,

It also may be you are using old Squid that does not support signing faked certificate with algorithm other than SHA-1 (because it was hardcoded at that time). This is the case of Squid 3.3.8 usually present in stable Ubuntu 14 LTS and CentOS 7.

In order to fix it you either need to go to most recent Squid (preferred) or recompile your Squid after applying a small patch like the following:

--- gadgets.cc  2013-07-13 15:25:14.000000000 +0200
+++ gadgets.cc.new      2015-11-09 23:00:47.591124352 +0100
@@ -389,9 +389,9 @@

     /*Now sign the request */
     if (properties.signAlgorithm != Ssl::algSignSelf &amp;&amp; properties.signWithPkey.get())
-        ret = X509_sign(cert.get(), properties.signWithPkey.get(), EVP_sha1());
+        ret = X509_sign(cert.get(), properties.signWithPkey.get(), EVP_sha256());
     else //else sign with self key (self signed request)
-        ret = X509_sign(cert.get(), pkey.get(), EVP_sha1());
+        ret = X509_sign(cert.get(), pkey.get(), EVP_sha256());

     if (!ret)
         return false;

There is doc article and repo that has it all explained:
<A HREF="http://docs.diladele.com/administrator_guide_4_4/install/ubuntu14/squid.html">http://docs.diladele.com/administrator_guide_4_4/install/ubuntu14/squid.html</A>
<A HREF="https://github.com/ra-at-diladele-com/qlproxy_external/tree/master/src/va/scripts.ubuntu14">https://github.com/ra-at-diladele-com/qlproxy_external/tree/master/src/va/scripts.ubuntu14</A>

But please take it with a huge grain of salt if you can.

Best regards,
Rafael Akchurin
Diladele B.V.
<A HREF="http://www.quintolabs.com">http://www.quintolabs.com</A>
<A HREF="http://www.diladele.com">http://www.diladele.com</A>

--
Please take a look at Web Safety - our ICAP based web filter server for Squid proxy.




From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Diogenes S. Jesus
Sent: Thursday, September 1, 2016 11:37 AM
To: Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;
Cc: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>; erdosain9 &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">erdosain9 at gmail.com</A>&gt;
Subject: Re: [squid-users] HTTPS chrome - SHA1 this page is insecure

The answer why you only see it on Chrome is because since Chrome &gt;= 41:

&quot;Sites with end-entity certificates that expire on or after 1 January 2017, and which include a SHA-1-based signature as part of the certificate chain, will be treated as &#8220;affirmatively insecure&#8221;. Subresources from such domain will be treated as &#8220;active mixed content&#8221;.&quot;
Source: <A HREF="https://security.googleblog.com/2014/09/gradually-sunsetting-sha-1.html">https://security.googleblog.com/2014/09/gradually-sunsetting-sha-1.html</A>

Best regards

On Wed, Aug 31, 2016 at 5:24 PM, Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;&gt; wrote:
On 08/31/2016 09:15 AM, Amos Jeffries wrote:
&gt;<i> On 1/09/2016 2:26 a.m., erdosain9 wrote:
</I>&gt;&gt;<i> Hi.
</I>&gt;&gt;<i> Im using ssl-bump.. all ir working fine, but i want to know if it is
</I>&gt;&gt;<i> possible that which is not seen crossed out and red &quot;https&quot;.
</I>&gt;&gt;<i> This happen just in Chrome
</I>&gt;&gt;<i> This page is insecure (broken HTTPS)
</I>&gt;&gt;<i> SHA-1 Certificate
</I>&gt;&gt;<i> The certificate for this site expires in 2017 or later, and the certificate
</I>&gt;&gt;<i> chain contains a certificate signed using SHA-1.
</I>
Sounds like you are running an old Squid version.


&gt;<i> This requires changes to the certificate generator used by SSL-Bump.
</I>&gt;<i> IIRC there were some patches, but I can't find them right now in the
</I>&gt;<i> changesets. If the issue exists in current releases then please ask on
</I>&gt;<i> squid-dev.
</I>
See <A HREF="http://www.squid-cache.org/Doc/config/sslproxy_cert_sign_hash/">http://www.squid-cache.org/Doc/config/sslproxy_cert_sign_hash/</A>


&gt;<i> Of course, its possible the site realy does have a SHA1 certificate and
</I>&gt;<i> Squid is just passing on the real details. The mimic feature is designed
</I>&gt;<i> to ensure TLS is actually transparent as best we can manage.
</I>
I have not checked, but I doubt we mimic the signing algorithm (because
it would make client-Squid communication less secure?). If we do, we
should update the wiki page that lists what is being mimicked.


HTH,

Alex.

_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>



--

--------

Diogenes S. de Jesus
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160901/b609f2cf/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160901/b609f2cf/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012294.html">[squid-users] HTTPS chrome - SHA1 this page is insecure
</A></li>
	<LI>Next message (by thread): <A HREF="012296.html">[squid-users] Web Whatsapp, Dropbox... problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12295">[ date ]</a>
              <a href="thread.html#12295">[ thread ]</a>
              <a href="subject.html#12295">[ subject ]</a>
              <a href="author.html#12295">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
