<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Problems with Linux Worstations
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problems%20with%20Linux%20Worstations&In-Reply-To=%3CCA%2B0Tdyoer7WW0Sfvy_5z5T3JQ3j_hw1Yf%3DmDLFtF2gJZmyMfew%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012326.html">
   <LINK REL="Next"  HREF="012347.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Problems with Linux Worstations</H1>
    <B>Marcio Demetrio Bacci</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problems%20with%20Linux%20Worstations&In-Reply-To=%3CCA%2B0Tdyoer7WW0Sfvy_5z5T3JQ3j_hw1Yf%3DmDLFtF2gJZmyMfew%40mail.gmail.com%3E"
       TITLE="[squid-users] Problems with Linux Worstations">marciobacci at gmail.com
       </A><BR>
    <I>Sun Sep  4 22:41:59 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012326.html">[squid-users] Problems with Linux Worstations
</A></li>
        <LI>Next message (by thread): <A HREF="012347.html">[squid-users] Problems with Linux Worstations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12345">[ date ]</a>
              <a href="thread.html#12345">[ thread ]</a>
              <a href="subject.html#12345">[ subject ]</a>
              <a href="author.html#12345">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have used debug_options 11,2 in squid.conf file. After I have following
results in logs files:

/var/log/squid3/access.log
1473026084.048    253 192.168.200.85 TCP_MISS_ABORTED/000 0 POST
<A HREF="http://m.addthis.com/live/red_lojson/100eng.json?">http://m.addthis.com/live/red_lojson/100eng.json?</A> marcio HIER_NONE/- -
1473026086.275      0 192.168.200.85 TCP_DENIED/407 3792 CONNECT
tiles.services.mozilla.com:443 - HIER_NONE/- text/html
1473026086.778      0 192.168.200.85 TCP_DENIED/407 3995 GET
<A HREF="http://start.ubuntu.com/14.04/Google/?">http://start.ubuntu.com/14.04/Google/?</A> - HIER_NONE/- text/html
1473026088.908      0 192.168.200.85 TCP_DENIED/407 3796 CONNECT
shavar.services.mozilla.com:443 - HIER_NONE/- text/html
1473026091.932      0 192.168.200.85 TCP_DENIED/407 3780 CONNECT
self-repair.mozilla.org:443 - HIER_NONE/- text/html
1473026096.418    180 192.168.200.85 TCP_MISS/200 960 POST
<A HREF="http://ocsp.digicert.com/">http://ocsp.digicert.com/</A> marcio HIER_DIRECT/192.16.58.8
application/ocsp-response
1473026096.467     85 192.168.200.85 TCP_MISS/200 960 POST
<A HREF="http://ocsp.digicert.com/">http://ocsp.digicert.com/</A> marcio HIER_DIRECT/192.16.58.8
application/ocsp-response
1473026102.051    525 192.168.200.85 TCP_REFRESH_UNMODIFIED/200 2907 GET
<A HREF="http://start.ubuntu.com/14.04/Google/?">http://start.ubuntu.com/14.04/Google/?</A> marcio HIER_DIRECT/91.189.90.41
text/html
1473026102.091      0 192.168.200.85 TCP_HIT/200 22099 GET
<A HREF="http://start.ubuntu.com/12.04/sprite.png">http://start.ubuntu.com/12.04/sprite.png</A> marcio HIER_NONE/- image/png
1473026104.855      0 10.133.85.3 TCP_DENIED/407 3929 GET
<A HREF="http://ctldl.windowsupdate.com/msdownload/update/v3/static/trustedr/en/authrootstl.cab?">http://ctldl.windowsupdate.com/msdownload/update/v3/static/trustedr/en/authrootstl.cab?</A>
- HIER_NONE/- text/html
1473026146.453     83 192.168.200.85 TCP_MISS/200 960 POST
<A HREF="http://ocsp.digicert.com/">http://ocsp.digicert.com/</A> marcio HIER_DIRECT/192.16.58.8
application/ocsp-response
1473026147.447     83 192.168.200.85 TCP_MISS/200 960 POST
<A HREF="http://ocsp.digicert.com/">http://ocsp.digicert.com/</A> marcio HIER_DIRECT/192.16.58.8
application/ocsp-response
1473026148.923      0 192.168.200.85 TCP_DENIED/407 3796 CONNECT
shavar.services.mozilla.com:443 - HIER_NONE/- text/html
1473026157.117  61506 192.168.200.85 TCP_MISS/200 3525 CONNECT
tiles.services.mozilla.com:443 marcio HIER_DIRECT/52.24.123.95 -
1473026157.195  61584 192.168.200.85 TCP_MISS/200 4521 CONNECT
self-repair.mozilla.org:443 marcio HIER_DIRECT/54.69.9.44 -
1473026160.190  63085 192.168.200.85 TCP_MISS/200 5449 CONNECT
self-repair.mozilla.org:443 marcio HIER_DIRECT/54.69.9.44 -
1473026204.518      0 192.168.200.85 TCP_DENIED/407 3780 CONNECT
safebrowsing.google.com:443 - HIER_NONE/- text/html
1473026207.807  62056 192.168.200.85 TCP_MISS/200 3686 CONNECT
incoming.telemetry.mozilla.org:443 marcio HIER_DIRECT/52.89.83.186 -
1473026207.808  61159 192.168.200.85 TCP_MISS/200 390 CONNECT
incoming.telemetry.mozilla.org:443 marcio HIER_DIRECT/52.89.83.186 -
1473026207.808  61159 192.168.200.85 TCP_MISS/200 390 CONNECT
incoming.telemetry.mozilla.org:443 marcio HIER_DIRECT/52.89.83.186 -
1473026207.808  61160 192.168.200.85 TCP_MISS/200 390 CONNECT
incoming.telemetry.mozilla.org:443 marcio HIER_DIRECT/52.89.83.186 -
1473026207.809  61160 192.168.200.85 TCP_MISS/200 390 CONNECT
incoming.telemetry.mozilla.org:443 marcio HIER_DIRECT/52.89.83.186 -
1473026207.814  61165 192.168.200.85 TCP_MISS/200 390 CONNECT
incoming.telemetry.mozilla.org:443 marcio HIER_DIRECT/52.89.83.186 -
1473026207.866  61052 192.168.200.85 TCP_MISS/200 3821 CONNECT
aus5.mozilla.org:443 marcio HIER_DIRECT/52.34.235.152 -
1473026212.687 116018 192.168.200.85 TCP_MISS/200 61971 CONNECT
normandy.cdn.mozilla.net:443 marcio HIER_DIRECT/52.84.177.125 -
1473026264.532      0 192.168.200.85 TCP_DENIED/407 3780 CONNECT
safebrowsing.google.com:443 - HIER_NONE/- text/html
1473026299.647      0 10.133.85.3 TCP_DENIED/407 3813 CONNECT
iecvlist.microsoft.com:443 - HIER_NONE/- text/html
1473026335.221      0 10.133.85.3 TCP_DENIED/407 3813 CONNECT
ieonline.microsoft.com:443 - HIER_NONE/- text/html
1473026592.061   6624 10.133.85.3 TCP_MISS/200 3582 CONNECT
forum.zentyal.org:443 marcio HIER_DIRECT/162.13.13.134 -
1473026793.073      0 192.168.200.96 TCP_DENIED/407 3780 CONNECT
safebrowsing.google.com:443 - HIER_NONE/- text/html

/var/log/squid3/cache.log

----------
2016/09/04 19:06:33.073 kid1| client_side.cc(2407) parseHttpRequest: HTTP
Client local=192.168.200.7:3128 remote=192.168.200.96:56302 FD 12 flags=1
2016/09/04 19:06:33.073 kid1| client_side.cc(2408) parseHttpRequest: HTTP
Client REQUEST:
---------
CONNECT safebrowsing.google.com:443 HTTP/1.1
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:35.0) Gecko/20100101
Firefox/35.0
Proxy-Connection: keep-alive
Connection: keep-alive
Host: safebrowsing.google.com:443


----------
2016/09/04 19:06:33.073 kid1| client_side.cc(1459) sendStartOfMessage: HTTP
Client local=192.168.200.7:3128 remote=192.168.200.96:56302 FD 12 flags=1
2016/09/04 19:06:33.073 kid1| client_side.cc(1460) sendStartOfMessage: HTTP
Client REPLY:
---------
HTTP/1.1 407 Proxy Authentication Required
Server: squid/3.4.8
Mime-Version: 1.0
Date: Sun, 04 Sep 2016 22:06:33 GMT
Content-Type: text/html
Content-Length: 3357
X-Squid-Error: *ERR_CACHE_ACCESS_DENIED 0*
Proxy-Authenticate: Basic realm=&quot;CMS&quot;
X-Cache: MISS from proxy.cms.ensino.br
X-Cache-Lookup: NONE from proxy.cms.ensino.br:3128
Via: 1.1 proxy.cms.ensino.br (squid/3.4.8)
Connection: keep-alive

----------

Sorry, but I didn't discover the problem!

Anybody have an idea?

Regards,

M&#225;rcio

2016-09-02 11:10 GMT-03:00 Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;:

&gt;<i> On 2/09/2016 3:21 p.m., Marcio Demetrio Bacci wrote:
</I>&gt;<i> &gt; In my Windows workstations the authentication works correctly, however in
</I>&gt;<i> &gt; Ubuntu 14.04 the user and password are asked twice.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I am using the basic_ncsa_auth with Squid 3.4.8
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Is there any setting that I do in Squid?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Bellow is my squid.conf
</I>&gt;<i> &gt;
</I>&gt;<i> ...
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; auth_param basic program /usr/lib/squid3/basic_ncsa_auth
</I>&gt;<i> /etc/squid3/passwd
</I>&gt;<i> &gt; auth_param basic children 5
</I>&gt;<i> &gt; auth_param basic realm AUTENTICACAO
</I>&gt;<i> &gt; auth_param basic credentialsttl 2 hours
</I>&gt;<i> &gt; auth_param basic casesensitive off
</I>&gt;<i> &gt;
</I>&gt;<i> ...
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ### Regras iniciais do Squid
</I>&gt;<i> &gt; http_access allow localhost
</I>&gt;<i> &gt; http_access allow purge localhost
</I>&gt;<i> &gt; http_access deny purge
</I>&gt;<i> &gt; http_access deny !Safe_ports
</I>&gt;<i> &gt; http_access deny CONNECT !SSL_ports
</I>&gt;<i>
</I>&gt;<i> Please re-order the above security rules to be:
</I>&gt;<i>
</I>&gt;<i>   http_access deny !Safe_ports
</I>&gt;<i>   http_access deny CONNECT !SSL_ports
</I>&gt;<i>   http_access allow localhost
</I>&gt;<i>   http_access deny purge
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ### Exige autenticacao
</I>&gt;<i> &gt; acl autenticados proxy_auth REQUIRED
</I>&gt;<i> &gt; http_access allow autenticados
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ### Bloqueia extensoes de arquivos
</I>&gt;<i> &gt; acl extensoes_bloqueadas url_regex -i &quot;/etc/squid3/acls/extensoes-
</I>&gt;<i> proibidas&quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ### Liberar alguns sites
</I>&gt;<i> &gt; acl sites_liberados url_regex -i &quot;/etc/squid3/acls/sites-permitidos&quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ### Bloqueia sites por URL
</I>&gt;<i> &gt; acl sites_bloqueados url_regex -i &quot;/etc/squid3/acls/sites-proibidos&quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; #bloqueios basicos
</I>&gt;<i> &gt; http_access allow sites_liberados
</I>&gt;<i> &gt; http_access deny extensoes_bloqueadas
</I>&gt;<i> &gt; http_access deny sites_bloqueados
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ### LAN #####
</I>&gt;<i> &gt; acl rede_lan src 192.168.200.0/22
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ### Nega acesso de quem nao esta na rede local do CMB
</I>&gt;<i> &gt; http_access allow rede_lan
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; #negando o acesso para todos que nao estiverem nas regras anteriores
</I>&gt;<i> &gt; http_access deny all
</I>&gt;<i> &gt;
</I>&gt;<i> ...
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> With your config Squid will only challenge the browser to send some if
</I>&gt;<i> they are completely missing. It will not deny access when invalid
</I>&gt;<i> credentials are sent.
</I>&gt;<i>
</I>&gt;<i> That means the browser probably does not have access to any Basic auth
</I>&gt;<i> credentials it can send.
</I>&gt;<i>
</I>&gt;<i> The two popups are probably from two TCP connections being made with no
</I>&gt;<i> credentials (maybe the result of the &quot;Happy Eyeballs&quot; algorithm doing
</I>&gt;<i> its thing). You can check for that with &quot;debug_options 11,2&quot; and seeing
</I>&gt;<i> what HTTP messages are happening with what IP:port details.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160904/39fdd078/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160904/39fdd078/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012326.html">[squid-users] Problems with Linux Worstations
</A></li>
	<LI>Next message (by thread): <A HREF="012347.html">[squid-users] Problems with Linux Worstations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12345">[ date ]</a>
              <a href="thread.html#12345">[ thread ]</a>
              <a href="subject.html#12345">[ subject ]</a>
              <a href="author.html#12345">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
