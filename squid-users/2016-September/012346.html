<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] More host header forgery pain with peek/splice
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20More%20host%20header%20forgery%20pain%20with%20peek/splice&In-Reply-To=%3Cac05d49c-fe7f-f0f3-af19-7a065d2fe228%40urlfilterdb.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012344.html">
   <LINK REL="Next"  HREF="012349.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] More host header forgery pain with peek/splice</H1>
    <B>Marcus Kool</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20More%20host%20header%20forgery%20pain%20with%20peek/splice&In-Reply-To=%3Cac05d49c-fe7f-f0f3-af19-7a065d2fe228%40urlfilterdb.com%3E"
       TITLE="[squid-users] More host header forgery pain with peek/splice">marcus.kool at urlfilterdb.com
       </A><BR>
    <I>Sun Sep  4 23:35:59 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012344.html">[squid-users] More host header forgery pain with peek/splice
</A></li>
        <LI>Next message (by thread): <A HREF="012349.html">[squid-users] More host header forgery pain with peek/splice
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12346">[ date ]</a>
              <a href="thread.html#12346">[ thread ]</a>
              <a href="subject.html#12346">[ subject ]</a>
              <a href="author.html#12346">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for your reply.

The 13-year old child in me says &quot;I want it fixed yesterday&quot;
since false positives are very painful and cannot always
be prevented since the environment where Squid works is
not always that easy to control.

You mentioned earlier that a fix will probably go in squid 5
which is long due and there is no workaround.  A second
thought is to have an acl that determines for which domains
the check must be skipped, but this is not optimal since
the admin gains an extra job.

My vote goes to re-prioritizing the fix and put it in Squid 4.
Of course I have no idea about the implications.

Thanks
Marcus


On 09/04/2016 01:12 PM, Amos Jeffries wrote:
&gt;<i> On 31/08/2016 5:25 a.m., Marcus Kool wrote:
</I>&gt;&gt;<i> Do I understand it correctly that Squid in normal proxy mode
</I>&gt;&gt;<i> allows malware to do a CONNECT to any destination, while in
</I>&gt;&gt;<i> transparent proxy mode does extra security checks which causes
</I>&gt;&gt;<i> some regular (non-malware) clients to fail?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Intercepted traffic has different processing applied, different
</I>&gt;<i> assumptions made about the traffic, and different security model
</I>&gt;<i> relevant to its messages.
</I>&gt;<i>
</I>&gt;<i> The short answer is &quot;yes&quot;, but reality is not that simple black/white.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> And philosophical questions: is Squid the right tool
</I>&gt;&gt;<i> to stop malware?  If yes, is it acceptable that connections
</I>&gt;&gt;<i> of regular (non-malware) clients are wrongly dropped?
</I>&gt;<i>
</I>&gt;<i> No more or less than any software.
</I>&gt;<i>
</I>&gt;<i> Squid manages the HTTP that flows through it. If the malware uses HTTP
</I>&gt;<i> messages to communicate then it very much part of Squid's job to prevent
</I>&gt;<i> that. Other protocols Squid is not responsible for, except to prevent
</I>&gt;<i> itself being a vector of attack.
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> IMO Squid should do all it can to be a secure proxy.
</I>&gt;<i>
</I>&gt;<i> Which is the case for Host forgery atacks. If Squid did not MITM the
</I>&gt;<i> network traffic, there would not be a vulnerability to Host forgery
</I>&gt;<i> issues. Therefore an intercept/tproxy Squid is very much responsible for
</I>&gt;<i> preventing this particular type of attack which it causes to exist.
</I>&gt;<i>
</I>&gt;<i> A forward-proxy or reverse-proxy does not have that vulnerability,
</I>&gt;<i> therefore does not need to check the same things.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> Doing security checks on connections in an attempt
</I>&gt;&gt;<i> to stop malware sounds like a job for an antivirus / IDS tool.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Additional to what Squid does. Indeed many of those tools use a proxy
</I>&gt;<i> service which performs the same or similar checks to what Squid does,
</I>&gt;<i> with far more intrusive behaviour, or are themselves also vulnerable to
</I>&gt;<i> becoming vectors of the Host attack(s). The Host attack(s) are
</I>&gt;<i> vulnerability built into the concept of MITM'ing HTTP(S) traffic. It is
</I>&gt;<i> not something specific to Squid.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012344.html">[squid-users] More host header forgery pain with peek/splice
</A></li>
	<LI>Next message (by thread): <A HREF="012349.html">[squid-users] More host header forgery pain with peek/splice
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12346">[ date ]</a>
              <a href="thread.html#12346">[ thread ]</a>
              <a href="subject.html#12346">[ subject ]</a>
              <a href="author.html#12346">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
