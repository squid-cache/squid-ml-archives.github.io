<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Problems with Linux Worstations
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problems%20with%20Linux%20Worstations&In-Reply-To=%3C5de64bba-dcc9-d809-c5b6-3f9e50da9f09%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012345.html">
   <LINK REL="Next"  HREF="012354.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Problems with Linux Worstations</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problems%20with%20Linux%20Worstations&In-Reply-To=%3C5de64bba-dcc9-d809-c5b6-3f9e50da9f09%40treenet.co.nz%3E"
       TITLE="[squid-users] Problems with Linux Worstations">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Sep  5 04:17:44 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012345.html">[squid-users] Problems with Linux Worstations
</A></li>
        <LI>Next message (by thread): <A HREF="012354.html">[squid-users] Problems with Linux Worstations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12347">[ date ]</a>
              <a href="thread.html#12347">[ thread ]</a>
              <a href="subject.html#12347">[ subject ]</a>
              <a href="author.html#12347">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 5/09/2016 10:41 a.m., Marcio Demetrio Bacci wrote:
&gt;<i> I have used debug_options 11,2 in squid.conf file. After I have following
</I>&gt;<i> results in logs files:
</I>&gt;<i> 
</I>&gt;<i> /var/log/squid3/access.log
</I>&gt;<i> 1473026084.048    253 192.168.200.85 TCP_MISS_ABORTED/000 0 POST
</I>&gt;<i> <A HREF="http://m.addthis.com/live/red_lojson/100eng.json?">http://m.addthis.com/live/red_lojson/100eng.json?</A> marcio HIER_NONE/- -
</I>&gt;<i> 1473026086.275      0 192.168.200.85 TCP_DENIED/407 3792 CONNECT
</I>&gt;<i> tiles.services.mozilla.com:443 - HIER_NONE/- text/html
</I>&gt;<i> 1473026086.778      0 192.168.200.85 TCP_DENIED/407 3995 GET
</I>&gt;<i> <A HREF="http://start.ubuntu.com/14.04/Google/?">http://start.ubuntu.com/14.04/Google/?</A> - HIER_NONE/- text/html
</I>&gt;<i> 1473026088.908      0 192.168.200.85 TCP_DENIED/407 3796 CONNECT
</I>&gt;<i> shavar.services.mozilla.com:443 - HIER_NONE/- text/html
</I>&gt;<i> 1473026091.932      0 192.168.200.85 TCP_DENIED/407 3780 CONNECT
</I>&gt;<i> self-repair.mozilla.org:443 - HIER_NONE/- text/html
</I>&gt;<i> 1473026096.418    180 192.168.200.85 TCP_MISS/200 960 POST
</I>&gt;<i> <A HREF="http://ocsp.digicert.com/">http://ocsp.digicert.com/</A> marcio HIER_DIRECT/192.16.58.8
</I>&gt;<i> application/ocsp-response
</I>&gt;<i> 1473026096.467     85 192.168.200.85 TCP_MISS/200 960 POST
</I>&gt;<i> <A HREF="http://ocsp.digicert.com/">http://ocsp.digicert.com/</A> marcio HIER_DIRECT/192.16.58.8
</I>&gt;<i> application/ocsp-response
</I>&gt;<i> 1473026102.051    525 192.168.200.85 TCP_REFRESH_UNMODIFIED/200 2907 GET
</I>&gt;<i> <A HREF="http://start.ubuntu.com/14.04/Google/?">http://start.ubuntu.com/14.04/Google/?</A> marcio HIER_DIRECT/91.189.90.41
</I>&gt;<i> text/html
</I>&gt;<i> 1473026102.091      0 192.168.200.85 TCP_HIT/200 22099 GET
</I>&gt;<i> <A HREF="http://start.ubuntu.com/12.04/sprite.png">http://start.ubuntu.com/12.04/sprite.png</A> marcio HIER_NONE/- image/png
</I>&gt;<i> 1473026104.855      0 10.133.85.3 TCP_DENIED/407 3929 GET
</I>&gt;<i> <A HREF="http://ctldl.windowsupdate.com/msdownload/update/v3/static/trustedr/en/authrootstl.cab?">http://ctldl.windowsupdate.com/msdownload/update/v3/static/trustedr/en/authrootstl.cab?</A>
</I>&gt;<i> - HIER_NONE/- text/html
</I>&gt;<i> 1473026146.453     83 192.168.200.85 TCP_MISS/200 960 POST
</I>&gt;<i> <A HREF="http://ocsp.digicert.com/">http://ocsp.digicert.com/</A> marcio HIER_DIRECT/192.16.58.8
</I>&gt;<i> application/ocsp-response
</I>&gt;<i> 1473026147.447     83 192.168.200.85 TCP_MISS/200 960 POST
</I>&gt;<i> <A HREF="http://ocsp.digicert.com/">http://ocsp.digicert.com/</A> marcio HIER_DIRECT/192.16.58.8
</I>&gt;<i> application/ocsp-response
</I>&gt;<i> 1473026148.923      0 192.168.200.85 TCP_DENIED/407 3796 CONNECT
</I>&gt;<i> shavar.services.mozilla.com:443 - HIER_NONE/- text/html
</I>&gt;<i> 1473026157.117  61506 192.168.200.85 TCP_MISS/200 3525 CONNECT
</I>&gt;<i> tiles.services.mozilla.com:443 marcio HIER_DIRECT/52.24.123.95 -
</I>&gt;<i> 1473026157.195  61584 192.168.200.85 TCP_MISS/200 4521 CONNECT
</I>&gt;<i> self-repair.mozilla.org:443 marcio HIER_DIRECT/54.69.9.44 -
</I>&gt;<i> 1473026160.190  63085 192.168.200.85 TCP_MISS/200 5449 CONNECT
</I>&gt;<i> self-repair.mozilla.org:443 marcio HIER_DIRECT/54.69.9.44 -
</I>&gt;<i> 1473026204.518      0 192.168.200.85 TCP_DENIED/407 3780 CONNECT
</I>&gt;<i> safebrowsing.google.com:443 - HIER_NONE/- text/html
</I>&gt;<i> 1473026207.807  62056 192.168.200.85 TCP_MISS/200 3686 CONNECT
</I>&gt;<i> incoming.telemetry.mozilla.org:443 marcio HIER_DIRECT/52.89.83.186 -
</I>&gt;<i> 1473026207.808  61159 192.168.200.85 TCP_MISS/200 390 CONNECT
</I>&gt;<i> incoming.telemetry.mozilla.org:443 marcio HIER_DIRECT/52.89.83.186 -
</I>&gt;<i> 1473026207.808  61159 192.168.200.85 TCP_MISS/200 390 CONNECT
</I>&gt;<i> incoming.telemetry.mozilla.org:443 marcio HIER_DIRECT/52.89.83.186 -
</I>&gt;<i> 1473026207.808  61160 192.168.200.85 TCP_MISS/200 390 CONNECT
</I>&gt;<i> incoming.telemetry.mozilla.org:443 marcio HIER_DIRECT/52.89.83.186 -
</I>&gt;<i> 1473026207.809  61160 192.168.200.85 TCP_MISS/200 390 CONNECT
</I>&gt;<i> incoming.telemetry.mozilla.org:443 marcio HIER_DIRECT/52.89.83.186 -
</I>&gt;<i> 1473026207.814  61165 192.168.200.85 TCP_MISS/200 390 CONNECT
</I>&gt;<i> incoming.telemetry.mozilla.org:443 marcio HIER_DIRECT/52.89.83.186 -
</I>&gt;<i> 1473026207.866  61052 192.168.200.85 TCP_MISS/200 3821 CONNECT
</I>&gt;<i> aus5.mozilla.org:443 marcio HIER_DIRECT/52.34.235.152 -
</I>&gt;<i> 1473026212.687 116018 192.168.200.85 TCP_MISS/200 61971 CONNECT
</I>&gt;<i> normandy.cdn.mozilla.net:443 marcio HIER_DIRECT/52.84.177.125 -
</I>&gt;<i> 1473026264.532      0 192.168.200.85 TCP_DENIED/407 3780 CONNECT
</I>&gt;<i> safebrowsing.google.com:443 - HIER_NONE/- text/html
</I>&gt;<i> 1473026299.647      0 10.133.85.3 TCP_DENIED/407 3813 CONNECT
</I>&gt;<i> iecvlist.microsoft.com:443 - HIER_NONE/- text/html
</I>&gt;<i> 1473026335.221      0 10.133.85.3 TCP_DENIED/407 3813 CONNECT
</I>&gt;<i> ieonline.microsoft.com:443 - HIER_NONE/- text/html
</I>&gt;<i> 1473026592.061   6624 10.133.85.3 TCP_MISS/200 3582 CONNECT
</I>&gt;<i> forum.zentyal.org:443 marcio HIER_DIRECT/162.13.13.134 -
</I>
Notice how the 407 occur in bunches. 2-3 getting a 407 reject, then many
requests going through with user credentials. Then again some without
any getting a 407.
Those bunches of 407 will be matching some type of credentials timeout
in the browser, or opening of new tabs.


This request below is the only one from 192.168.200.96 so appears to be
the one you provide cache.log trace for...


&gt;<i> 1473026793.073      0 192.168.200.96 TCP_DENIED/407 3780 CONNECT
</I>&gt;<i> safebrowsing.google.com:443 - HIER_NONE/- text/html
</I>&gt;<i> 
</I>&gt;<i> /var/log/squid3/cache.log
</I>&gt;<i> 
</I>&gt;<i> ----------
</I>&gt;<i> 2016/09/04 19:06:33.073 kid1| client_side.cc(2407) parseHttpRequest: HTTP
</I>&gt;<i> Client local=192.168.200.7:3128 remote=192.168.200.96:56302 FD 12 flags=1
</I>&gt;<i> 2016/09/04 19:06:33.073 kid1| client_side.cc(2408) parseHttpRequest: HTTP
</I>&gt;<i> Client REQUEST:
</I>&gt;<i> ---------
</I>&gt;<i> CONNECT safebrowsing.google.com:443 HTTP/1.1
</I>&gt;<i> User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:35.0) Gecko/20100101
</I>&gt;<i> Firefox/35.0
</I>&gt;<i> Proxy-Connection: keep-alive
</I>&gt;<i> Connection: keep-alive
</I>&gt;<i> Host: safebrowsing.google.com:443
</I>
Notice the abence of any Proxy-Authorization header containing credentials.

&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ----------
</I>&gt;<i> 2016/09/04 19:06:33.073 kid1| client_side.cc(1459) sendStartOfMessage: HTTP
</I>&gt;<i> Client local=192.168.200.7:3128 remote=192.168.200.96:56302 FD 12 flags=1
</I>&gt;<i> 2016/09/04 19:06:33.073 kid1| client_side.cc(1460) sendStartOfMessage: HTTP
</I>&gt;<i> Client REPLY:
</I>&gt;<i> ---------
</I>&gt;<i> HTTP/1.1 407 Proxy Authentication Required
</I>&gt;<i> Server: squid/3.4.8
</I>&gt;<i> Mime-Version: 1.0
</I>&gt;<i> Date: Sun, 04 Sep 2016 22:06:33 GMT
</I>&gt;<i> Content-Type: text/html
</I>&gt;<i> Content-Length: 3357
</I>&gt;<i> X-Squid-Error: *ERR_CACHE_ACCESS_DENIED 0*
</I>&gt;<i> Proxy-Authenticate: Basic realm=&quot;CMS&quot;
</I>
That realm=&quot;CMS&quot; does not match the realm value of &quot;AUTENTICACAO&quot; which
your earlier config contained.

Unless you changed your auth_param settings that is a sign that some
other proxy is generating that response message. BUT, your access.log
entry shows no server being contacted.



&gt;<i> X-Cache: MISS from proxy.cms.ensino.br
</I>&gt;<i> X-Cache-Lookup: NONE from proxy.cms.ensino.br:3128
</I>&gt;<i> Via: 1.1 proxy.cms.ensino.br (squid/3.4.8)
</I>&gt;<i> Connection: keep-alive
</I>&gt;<i> 
</I>&gt;<i> ----------
</I>&gt;<i> 
</I>&gt;<i> Sorry, but I didn't discover the problem!
</I>&gt;<i> 
</I>&gt;<i> Anybody have an idea?
</I>
If you altered your squid.conf settings as above in the auth details,
did you also remove 192.168.200.7 from the &quot;localhost&quot; ACL ?

Your rule &quot;http_access allow localhost&quot; occurs before anything that
requires authentication. That means these requests coming from
192.168.200.7 to your proxy would not use authentication for the above
CONNECT request. So no reason for your proxy to generate any 407 response.


Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012345.html">[squid-users] Problems with Linux Worstations
</A></li>
	<LI>Next message (by thread): <A HREF="012354.html">[squid-users] Problems with Linux Worstations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12347">[ date ]</a>
              <a href="thread.html#12347">[ thread ]</a>
              <a href="subject.html#12347">[ subject ]</a>
              <a href="author.html#12347">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
