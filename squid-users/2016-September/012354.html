<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Problems with Linux Worstations
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problems%20with%20Linux%20Worstations&In-Reply-To=%3CCA%2B0Tdyp938vvpvgSk2_L2%3Dbhuo6MCE7FsWt%3DS83WT%2BkA7XYNwg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012347.html">
   <LINK REL="Next"  HREF="012355.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Problems with Linux Worstations</H1>
    <B>Marcio Demetrio Bacci</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problems%20with%20Linux%20Worstations&In-Reply-To=%3CCA%2B0Tdyp938vvpvgSk2_L2%3Dbhuo6MCE7FsWt%3DS83WT%2BkA7XYNwg%40mail.gmail.com%3E"
       TITLE="[squid-users] Problems with Linux Worstations">marciobacci at gmail.com
       </A><BR>
    <I>Mon Sep  5 16:25:19 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012347.html">[squid-users] Problems with Linux Worstations
</A></li>
        <LI>Next message (by thread): <A HREF="012355.html">[squid-users] Problems with Linux Worstations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12354">[ date ]</a>
              <a href="thread.html#12354">[ thread ]</a>
              <a href="subject.html#12354">[ subject ]</a>
              <a href="author.html#12354">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Amos

Now, my squid.conf is as follow (very simple):

############ START #################
http_port 3128

debug_options 11,2

cache_mem 512 MB
cache_swap_low 80
cache_swap_high 90

maximum_object_size 512 MB
minimum_object_size 0 KB

maximum_object_size_in_memory 4096 KB

cache_replacement_policy heap LFUDA
memory_replacement_policy heap LFUDA

fqdncache_size 1024

### Parametros de atualizacao da memoria cache
refresh_pattern ^ftp:    1440      20%    10080
refresh_pattern ^gopher:    1440    0%    1440
refresh_pattern -i (/cgi-bin/|\?) 0 0%     0
refresh_pattern .        0    20%    4320

### Localizacao dos logs
access_log /var/log/squid3/access.log
cache_log /var/log/squid3/cache.log

cache_dir aufs /var/spool/squid3 600 16 256

visible_hostname proxy

### acls
acl localhost src 192.168.200.7/32
acl to_localhost dst 192.168.200.7/32
acl SSL_ports port 22 443 563 7071 10000
acl Safe_ports port 21 70 80 88 210 280 389 443 488 563 591 777
1025-65535

acl purge method PURGE
acl CONNECT method CONNECT

http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access deny purge

auth_param basic program /usr/lib/squid3/basic_ncsa_auth /etc/squid3/passwd
auth_param basic children 5
auth_param basic realm CMS
auth_param basic credentialsttl 2 hours
auth_param basic casesensitive off

### Exige autenticacao
acl autenticados proxy_auth REQUIRED
http_access deny !autenticados

### Rede do CMS #####
acl lannet src 192.168.200.0/22

### Nega acesso de quem nao esta na rede local do CMS
http_access allow lannet
http_access allow localhost

#negando o acesso para todos que nao estiverem nas regras anteriores
http_access deny all

### Erros em portugues
error_directory /usr/share/squid3/errors/pt-br

#cache_effective_user proxy
coredump_dir /var/spool/squid3

########## END ###########################

I have some doubts:

1) I open my browser to test the authentication. It seems OK, but  when I
open new tab in browser the Squid3 ask the user and password again. Is this
normal behavior  ?

2) Is necessary to declare LOCALHOST acl as &quot;acl localhost src
192.168.200.7/32&quot; ?

3) Isn't necessary MANAGER acl as &quot;acl manager proto cache_object&quot; ?

4) Is correct order of the ACL in my squid.conf ? How do I improve it?

5) In my access.log, I have saw many &quot;TCP_MISS/200&quot;. Does mean only the
website is not in cache or is a strange behavior?


Sorry, but I'm still learning about Squid!


Regards,

M&#225;rcio




2016-09-05 1:17 GMT-03:00 Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;:

&gt;<i> On 5/09/2016 10:41 a.m., Marcio Demetrio Bacci wrote:
</I>&gt;<i> &gt; I have used debug_options 11,2 in squid.conf file. After I have following
</I>&gt;<i> &gt; results in logs files:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; /var/log/squid3/access.log
</I>&gt;<i> &gt; 1473026084.048    253 192.168.200.85 TCP_MISS_ABORTED/000 0 POST
</I>&gt;<i> &gt; <A HREF="http://m.addthis.com/live/red_lojson/100eng.json?">http://m.addthis.com/live/red_lojson/100eng.json?</A> marcio HIER_NONE/- -
</I>&gt;<i> &gt; 1473026086.275      0 192.168.200.85 TCP_DENIED/407 3792 CONNECT
</I>&gt;<i> &gt; tiles.services.mozilla.com:443 - HIER_NONE/- text/html
</I>&gt;<i> &gt; 1473026086.778      0 192.168.200.85 TCP_DENIED/407 3995 GET
</I>&gt;<i> &gt; <A HREF="http://start.ubuntu.com/14.04/Google/?">http://start.ubuntu.com/14.04/Google/?</A> - HIER_NONE/- text/html
</I>&gt;<i> &gt; 1473026088.908      0 192.168.200.85 TCP_DENIED/407 3796 CONNECT
</I>&gt;<i> &gt; shavar.services.mozilla.com:443 - HIER_NONE/- text/html
</I>&gt;<i> &gt; 1473026091.932      0 192.168.200.85 TCP_DENIED/407 3780 CONNECT
</I>&gt;<i> &gt; self-repair.mozilla.org:443 - HIER_NONE/- text/html
</I>&gt;<i> &gt; 1473026096.418    180 192.168.200.85 TCP_MISS/200 960 POST
</I>&gt;<i> &gt; <A HREF="http://ocsp.digicert.com/">http://ocsp.digicert.com/</A> marcio HIER_DIRECT/192.16.58.8
</I>&gt;<i> &gt; application/ocsp-response
</I>&gt;<i> &gt; 1473026096.467     85 192.168.200.85 TCP_MISS/200 960 POST
</I>&gt;<i> &gt; <A HREF="http://ocsp.digicert.com/">http://ocsp.digicert.com/</A> marcio HIER_DIRECT/192.16.58.8
</I>&gt;<i> &gt; application/ocsp-response
</I>&gt;<i> &gt; 1473026102.051    525 192.168.200.85 TCP_REFRESH_UNMODIFIED/200 2907 GET
</I>&gt;<i> &gt; <A HREF="http://start.ubuntu.com/14.04/Google/?">http://start.ubuntu.com/14.04/Google/?</A> marcio HIER_DIRECT/91.189.90.41
</I>&gt;<i> &gt; text/html
</I>&gt;<i> &gt; 1473026102.091      0 192.168.200.85 TCP_HIT/200 22099 GET
</I>&gt;<i> &gt; <A HREF="http://start.ubuntu.com/12.04/sprite.png">http://start.ubuntu.com/12.04/sprite.png</A> marcio HIER_NONE/- image/png
</I>&gt;<i> &gt; 1473026104.855      0 10.133.85.3 TCP_DENIED/407 3929 GET
</I>&gt;<i> &gt; <A HREF="http://ctldl.windowsupdate.com/msdownload/update/v3/static/trustedr/en/">http://ctldl.windowsupdate.com/msdownload/update/v3/static/trustedr/en/</A>
</I>&gt;<i> authrootstl.cab?
</I>&gt;<i> &gt; - HIER_NONE/- text/html
</I>&gt;<i> &gt; 1473026146.453     83 192.168.200.85 TCP_MISS/200 960 POST
</I>&gt;<i> &gt; <A HREF="http://ocsp.digicert.com/">http://ocsp.digicert.com/</A> marcio HIER_DIRECT/192.16.58.8
</I>&gt;<i> &gt; application/ocsp-response
</I>&gt;<i> &gt; 1473026147.447     83 192.168.200.85 TCP_MISS/200 960 POST
</I>&gt;<i> &gt; <A HREF="http://ocsp.digicert.com/">http://ocsp.digicert.com/</A> marcio HIER_DIRECT/192.16.58.8
</I>&gt;<i> &gt; application/ocsp-response
</I>&gt;<i> &gt; 1473026148.923      0 192.168.200.85 TCP_DENIED/407 3796 CONNECT
</I>&gt;<i> &gt; shavar.services.mozilla.com:443 - HIER_NONE/- text/html
</I>&gt;<i> &gt; 1473026157.117  61506 192.168.200.85 TCP_MISS/200 3525 CONNECT
</I>&gt;<i> &gt; tiles.services.mozilla.com:443 marcio HIER_DIRECT/52.24.123.95 -
</I>&gt;<i> &gt; 1473026157.195  61584 192.168.200.85 TCP_MISS/200 4521 CONNECT
</I>&gt;<i> &gt; self-repair.mozilla.org:443 marcio HIER_DIRECT/54.69.9.44 -
</I>&gt;<i> &gt; 1473026160.190 63085 192.168.200.85 TCP_MISS/200 5449 CONNECT
</I>&gt;<i> &gt; self-repair.mozilla.org:443 marcio HIER_DIRECT/54.69.9.44 -
</I>&gt;<i> &gt; 1473026204.518      0 192.168.200.85 TCP_DENIED/407 3780 CONNECT
</I>&gt;<i> &gt; safebrowsing.google.com:443 - HIER_NONE/- text/html
</I>&gt;<i> &gt; 1473026207.807  62056 192.168.200.85 TCP_MISS/200 3686 CONNECT
</I>&gt;<i> &gt; incoming.telemetry.mozilla.org:443 marcio HIER_DIRECT/52.89.83.186 -
</I>&gt;<i> &gt; 1473026207.808  61159 192.168.200.85 TCP_MISS/200 390 CONNECT
</I>&gt;<i> &gt; incoming.telemetry.mozilla.org:443 marcio HIER_DIRECT/52.89.83.186 -
</I>&gt;<i> &gt; 1473026207.808  61159 192.168.200.85 TCP_MISS/200 390 CONNECT
</I>&gt;<i> &gt; incoming.telemetry.mozilla.org:443 marcio HIER_DIRECT/52.89.83.186 -
</I>&gt;<i> &gt; 1473026207.808  61160 192.168.200.85 TCP_MISS/200 390 CONNECT
</I>&gt;<i> &gt; incoming.telemetry.mozilla.org:443 marcio HIER_DIRECT/52.89.83.186 -
</I>&gt;<i> &gt; 1473026207.809  61160 192.168.200.85 TCP_MISS/200 390 CONNECT
</I>&gt;<i> &gt; incoming.telemetry.mozilla.org:443 marcio HIER_DIRECT/52.89.83.186 -
</I>&gt;<i> &gt; 1473026207.814  61165 192.168.200.85 TCP_MISS/200 390 CONNECT
</I>&gt;<i> &gt; incoming.telemetry.mozilla.org:443 marcio HIER_DIRECT/52.89.83.186 -
</I>&gt;<i> &gt; 1473026207.866  61052 192.168.200.85 TCP_MISS/200 3821 CONNECT
</I>&gt;<i> &gt; aus5.mozilla.org:443 marcio HIER_DIRECT/52.34.235.152 -
</I>&gt;<i> &gt; 1473026212.687 116018 192.168.200.85 TCP_MISS/200 61971 CONNECT
</I>&gt;<i> &gt; normandy.cdn.mozilla.net:443 marcio HIER_DIRECT/52.84.177.125 -
</I>&gt;<i> &gt; 1473026264.532      0 192.168.200.85 TCP_DENIED/407 3780 CONNECT
</I>&gt;<i> &gt; safebrowsing.google.com:443 - HIER_NONE/- text/html
</I>&gt;<i> &gt; 1473026299.647      0 10.133.85.3 TCP_DENIED/407 3813 CONNECT
</I>&gt;<i> &gt; iecvlist.microsoft.com:443 - HIER_NONE/- text/html
</I>&gt;<i> &gt; 1473026335.221      0 10.133.85.3 TCP_DENIED/407 3813 CONNECT
</I>&gt;<i> &gt; ieonline.microsoft.com:443 - HIER_NONE/- text/html
</I>&gt;<i> &gt; 1473026592.061   6624 10.133.85.3 TCP_MISS/200 3582 CONNECT
</I>&gt;<i> &gt; forum.zentyal.org:443 marcio HIER_DIRECT/162.13.13.134 -
</I>&gt;<i>
</I>&gt;<i> Notice how the 407 occur in bunches. 2-3 getting a 407 reject, then many
</I>&gt;<i> requests going through with user credentials. Then again some without
</I>&gt;<i> any getting a 407.
</I>&gt;<i> Those bunches of 407 will be matching some type of credentials timeout
</I>&gt;<i> in the browser, or opening of new tabs.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This request below is the only one from 192.168.200.96 so appears to be
</I>&gt;<i> the one you provide cache.log trace for...
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; 1473026793.073      0 192.168.200.96 TCP_DENIED/407 3780 CONNECT
</I>&gt;<i> &gt; safebrowsing.google.com:443 - HIER_NONE/- text/html
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; /var/log/squid3/cache.log
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ----------
</I>&gt;<i> &gt; 2016/09/04 19:06:33.073 kid1| client_side.cc(2407) parseHttpRequest: HTTP
</I>&gt;<i> &gt; Client local=192.168.200.7:3128 remote=192.168.200.96:56302 FD 12
</I>&gt;<i> flags=1
</I>&gt;<i> &gt; 2016/09/04 19:06:33.073 kid1| client_side.cc(2408) parseHttpRequest: HTTP
</I>&gt;<i> &gt; Client REQUEST:
</I>&gt;<i> &gt; ---------
</I>&gt;<i> &gt; CONNECT safebrowsing.google.com:443 HTTP/1.1
</I>&gt;<i> &gt; User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:35.0)
</I>&gt;<i> Gecko/20100101
</I>&gt;<i> &gt; Firefox/35.0
</I>&gt;<i> &gt; Proxy-Connection: keep-alive
</I>&gt;<i> &gt; Connection: keep-alive
</I>&gt;<i> &gt; Host: safebrowsing.google.com:443
</I>&gt;<i>
</I>&gt;<i> Notice the abence of any Proxy-Authorization header containing credentials.
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ----------
</I>&gt;<i> &gt; 2016/09/04 19:06:33.073 kid1| client_side.cc(1459) sendStartOfMessage:
</I>&gt;<i> HTTP
</I>&gt;<i> &gt; Client local=192.168.200.7:3128 remote=192.168.200.96:56302 FD 12
</I>&gt;<i> flags=1
</I>&gt;<i> &gt; 2016/09/04 19:06:33.073 kid1| client_side.cc(1460) sendStartOfMessage:
</I>&gt;<i> HTTP
</I>&gt;<i> &gt; Client REPLY:
</I>&gt;<i> &gt; ---------
</I>&gt;<i> &gt; HTTP/1.1 407 Proxy Authentication Required
</I>&gt;<i> &gt; Server: squid/3.4.8
</I>&gt;<i> &gt; Mime-Version: 1.0
</I>&gt;<i> &gt; Date: Sun, 04 Sep 2016 22:06:33 GMT
</I>&gt;<i> &gt; Content-Type: text/html
</I>&gt;<i> &gt; Content-Length: 3357
</I>&gt;<i> &gt; X-Squid-Error: *ERR_CACHE_ACCESS_DENIED 0*
</I>&gt;<i> &gt; Proxy-Authenticate: Basic realm=&quot;CMS&quot;
</I>&gt;<i>
</I>&gt;<i> That realm=&quot;CMS&quot; does not match the realm value of &quot;AUTENTICACAO&quot; which
</I>&gt;<i> your earlier config contained.
</I>&gt;<i>
</I>&gt;<i> Unless you changed your auth_param settings that is a sign that some
</I>&gt;<i> other proxy is generating that response message. BUT, your access.log
</I>&gt;<i> entry shows no server being contacted.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; X-Cache: MISS from proxy.cms.ensino.br
</I>&gt;<i> &gt; X-Cache-Lookup: NONE from proxy.cms.ensino.br:3128
</I>&gt;<i> &gt; Via: 1.1 proxy.cms.ensino.br (squid/3.4.8)
</I>&gt;<i> &gt; Connection: keep-alive
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ----------
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Sorry, but I didn't discover the problem!
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Anybody have an idea?
</I>&gt;<i>
</I>&gt;<i> If you altered your squid.conf settings as above in the auth details,
</I>&gt;<i> did you also remove 192.168.200.7 from the &quot;localhost&quot; ACL ?
</I>&gt;<i>
</I>&gt;<i> Your rule &quot;http_access allow localhost&quot; occurs before anything that
</I>&gt;<i> requires authentication. That means these requests coming from
</I>&gt;<i> 192.168.200.7 to your proxy would not use authentication for the above
</I>&gt;<i> CONNECT request. So no reason for your proxy to generate any 407 response.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160905/285d83ad/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160905/285d83ad/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012347.html">[squid-users] Problems with Linux Worstations
</A></li>
	<LI>Next message (by thread): <A HREF="012355.html">[squid-users] Problems with Linux Worstations
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12354">[ date ]</a>
              <a href="thread.html#12354">[ thread ]</a>
              <a href="subject.html#12354">[ subject ]</a>
              <a href="author.html#12354">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
