<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Transparent Proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Transparent%20Proxy&In-Reply-To=%3C48eea6e3dbdb46f6b7281bb5be42855d%40IT-S-MAIL1.asd.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012386.html">
   <LINK REL="Next"  HREF="012392.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Transparent Proxy</H1>
    <B>John Sayce</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Transparent%20Proxy&In-Reply-To=%3C48eea6e3dbdb46f6b7281bb5be42855d%40IT-S-MAIL1.asd.local%3E"
       TITLE="[squid-users] Transparent Proxy">jsayce at asdlighting.com
       </A><BR>
    <I>Wed Sep  7 08:51:49 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012386.html">[squid-users] Transparent Proxy
</A></li>
        <LI>Next message (by thread): <A HREF="012392.html">[squid-users] Transparent Proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12387">[ date ]</a>
              <a href="thread.html#12387">[ thread ]</a>
              <a href="subject.html#12387">[ subject ]</a>
              <a href="author.html#12387">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I believe so.  The specific command I used was:

iptables -t nat -A PREROUTING -i ens33 -p tcp --dport 80 -j REDIRECT --to-port 3128

(For some reason my adapter is ens33, I have no idea why it's not eth0.  Squid is set to run on 3128.)

And after running this command port 80 now shows as being open with nmap.

And the output from iptables -t nat -L

Chain PREROUTING (policy ACCEPT)
target     prot opt source               destination
REDIRECT   tcp  --  anywhere             anywhere             tcp dpt:http redir ports 3128

Chain INPUT (policy ACCEPT)
target     prot opt source               destination

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination

Chain POSTROUTING (policy ACCEPT)
target     prot opt source               destination


It's fair to say I have almost no experience with iptables.  Is it iptables that should be doing the address translation? when the packet is sent back to the client? 



-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Antony Stone
Sent: 07 September 2016 09:28
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Transparent Proxy

On Wednesday 07 September 2016 at 10:23:02, John Sayce wrote:

&gt;<i> I'm trying to set up a transparent proxy but I'm fairly sure I'm 
</I>&gt;<i> missing something.
</I>&gt;<i> 
</I>&gt;<i> I've followed the instructions on the juniper website along with a 
</I>&gt;<i> couple of other blogs as per:
</I>&gt;<i> <A HREF="https://damn.technology/using-squid-juniper-pbr-transparent-proxy">https://damn.technology/using-squid-juniper-pbr-transparent-proxy</A>
</I>
You *have* applied the iptables rule on the machine running squid as described on that page, yes?

iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j REDIRECT --to-port
3128


Antony.

-- 
This email was created using 100% recycled electrons.

                                                   Please reply to the list;
                                                         please *don't* CC me.
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012386.html">[squid-users] Transparent Proxy
</A></li>
	<LI>Next message (by thread): <A HREF="012392.html">[squid-users] Transparent Proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12387">[ date ]</a>
              <a href="thread.html#12387">[ thread ]</a>
              <a href="subject.html#12387">[ subject ]</a>
              <a href="author.html#12387">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
