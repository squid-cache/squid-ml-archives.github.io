<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Transparent Proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Transparent%20Proxy&In-Reply-To=%3C201609071127.06411.Antony.Stone%40squid.open.source.it%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012387.html">
   <LINK REL="Next"  HREF="012396.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Transparent Proxy</H1>
    <B>Antony Stone</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Transparent%20Proxy&In-Reply-To=%3C201609071127.06411.Antony.Stone%40squid.open.source.it%3E"
       TITLE="[squid-users] Transparent Proxy">Antony.Stone at squid.open.source.it
       </A><BR>
    <I>Wed Sep  7 09:27:06 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012387.html">[squid-users] Transparent Proxy
</A></li>
        <LI>Next message (by thread): <A HREF="012396.html">[squid-users] Transparent Proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12392">[ date ]</a>
              <a href="thread.html#12392">[ thread ]</a>
              <a href="subject.html#12392">[ subject ]</a>
              <a href="author.html#12392">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wednesday 07 September 2016 at 10:51:49, John Sayce wrote:

&gt;<i> I believe so.  The specific command I used was:
</I>&gt;<i> 
</I>&gt;<i> iptables -t nat -A PREROUTING -i ens33 -p tcp --dport 80 -j REDIRECT
</I>&gt;<i> --to-port 3128
</I>&gt;<i> 
</I>&gt;<i> (For some reason my adapter is ens33, I have no idea why it's not eth0. 
</I>&gt;<i> Squid is set to run on 3128.)
</I>
That looks okay, then.

&gt;<i> It's fair to say I have almost no experience with iptables.  Is it iptables
</I>&gt;<i> that should be doing the address translation?
</I>
Yes - the rule above tells the machine to take any packet addressed to port 80 
on any address and send it instead to the local machine (REDIRECT changes the 
destination address to 127.0.0.1, even though that's not obvious) and port 
3128.

&gt;<i> when the packet is sent back to the client?
</I>
Correct.  IPtables' address translation rules are automatically symmetrical - 
when a packet gets translated in one direction, a record is kept that it was 
done, and then the reply packet is automatically reverse-translated when it 
comes back in the other direction.

This is true no matter whether packets are going *through* the IPtables 
machine (ie: it's acting as a router), or whether they're being processed *on* 
the IPtables machine (as in this case).

I think we need to know more about your squid setup.

Please tell us which version of squid you are using, and post here your 
squid.conf file without comments or blank lines.


Antony.

-- 
Software development can be quick, high quality, or low cost.

The customer gets to pick any two out of three.

                                                   Please reply to the list;
                                                         please *don't* CC me.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012387.html">[squid-users] Transparent Proxy
</A></li>
	<LI>Next message (by thread): <A HREF="012396.html">[squid-users] Transparent Proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12392">[ date ]</a>
              <a href="thread.html#12392">[ thread ]</a>
              <a href="subject.html#12392">[ subject ]</a>
              <a href="author.html#12392">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
