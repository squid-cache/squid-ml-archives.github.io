<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Transparent Proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Transparent%20Proxy&In-Reply-To=%3C33c42e19-87f1-a463-f7eb-bc0423217444%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012392.html">
   <LINK REL="Next"  HREF="012413.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Transparent Proxy</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Transparent%20Proxy&In-Reply-To=%3C33c42e19-87f1-a463-f7eb-bc0423217444%40treenet.co.nz%3E"
       TITLE="[squid-users] Transparent Proxy">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Sep  7 13:44:21 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012392.html">[squid-users] Transparent Proxy
</A></li>
        <LI>Next message (by thread): <A HREF="012413.html">[squid-users] Transparent Proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12396">[ date ]</a>
              <a href="thread.html#12396">[ thread ]</a>
              <a href="subject.html#12396">[ subject ]</a>
              <a href="author.html#12396">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 7/09/2016 9:27 p.m., Antony Stone wrote:
&gt;<i> On Wednesday 07 September 2016 at 10:51:49, John Sayce wrote:
</I>&gt;<i> 
</I>
FYI: Jon. Please be careful about yoru use of teh word &quot;forward&quot; and
&quot;forwarding&quot;. Both NAT and routing  are methods of forwarding, but which
one is used at each particular step of the packets path through your
network from client to Squid matters A LOT.

Some routers offer &quot;forwarding&quot; options / settings, which actually NAT.
That will break MITM Squid installations which require routing only
outside the Squid machine.


&gt;&gt;<i> I believe so.  The specific command I used was:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> iptables -t nat -A PREROUTING -i ens33 -p tcp --dport 80 -j REDIRECT
</I>&gt;&gt;<i> --to-port 3128
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> (For some reason my adapter is ens33, I have no idea why it's not eth0. 
</I>&gt;&gt;<i> Squid is set to run on 3128.)
</I>&gt;<i> 
</I>&gt;<i> That looks okay, then.
</I>&gt;<i> 
</I>&gt;&gt;<i> It's fair to say I have almost no experience with iptables.  Is it iptables
</I>&gt;&gt;<i> that should be doing the address translation?
</I>&gt;<i> 
</I>&gt;<i> Yes - the rule above tells the machine to take any packet addressed to port 80 
</I>&gt;<i> on any address and send it instead to the local machine (REDIRECT changes the 
</I>&gt;<i> destination address to 127.0.0.1, even though that's not obvious) and port 
</I>&gt;<i> 3128.
</I>
No it does not change the IP to localhost. It changes the address to the
machines primary IP. If that is localhost IP then something is wrong in
the machines network interface configuration - which may lead to trouble.


&gt;<i> 
</I>&gt;&gt;<i> when the packet is sent back to the client?
</I>&gt;<i> 
</I>&gt;<i> Correct.  IPtables' address translation rules are automatically symmetrical - 
</I>&gt;<i> when a packet gets translated in one direction, a record is kept that it was 
</I>&gt;<i> done, and then the reply packet is automatically reverse-translated when it 
</I>&gt;<i> comes back in the other direction.
</I>&gt;<i> 
</I>&gt;<i> This is true no matter whether packets are going *through* the IPtables 
</I>&gt;<i> machine (ie: it's acting as a router), or whether they're being processed *on* 
</I>&gt;<i> the IPtables machine (as in this case).
</I>&gt;<i> 
</I>&gt;<i> I think we need to know more about your squid setup.
</I>&gt;<i> 
</I>&gt;<i> Please tell us which version of squid you are using, and post here your 
</I>&gt;<i> squid.conf file without comments or blank lines.
</I>&gt;<i> 
</I>

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012392.html">[squid-users] Transparent Proxy
</A></li>
	<LI>Next message (by thread): <A HREF="012413.html">[squid-users] Transparent Proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12396">[ date ]</a>
              <a href="thread.html#12396">[ thread ]</a>
              <a href="subject.html#12396">[ subject ]</a>
              <a href="author.html#12396">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
