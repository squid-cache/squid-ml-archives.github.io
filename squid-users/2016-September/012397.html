<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TCP_RESET non http requests on port 80
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_RESET%20non%20http%20requests%20on%20port%2080&In-Reply-To=%3C7e9d08ca-d36e-e3c1-4430-b0e0ebd8224f%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012384.html">
   <LINK REL="Next"  HREF="012359.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TCP_RESET non http requests on port 80</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_RESET%20non%20http%20requests%20on%20port%2080&In-Reply-To=%3C7e9d08ca-d36e-e3c1-4430-b0e0ebd8224f%40measurement-factory.com%3E"
       TITLE="[squid-users] TCP_RESET non http requests on port 80">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Sep  7 13:47:17 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012384.html">[squid-users] TCP_RESET non http requests on port 80
</A></li>
        <LI>Next message (by thread): <A HREF="012359.html">[squid-users] Squid CPU usage in cachemgr.cgi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12397">[ date ]</a>
              <a href="thread.html#12397">[ thread ]</a>
              <a href="subject.html#12397">[ subject ]</a>
              <a href="author.html#12397">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 09/07/2016 01:56 AM, Matus UHLAR - fantomas wrote:

&gt;<i> and how is this done? Which system or library call does drop connection to
</I>&gt;<i> send a RST immediately?
</I>
This is not a squid-users question, but Squid calls comm_reset_close()
(quoted below) to reset the connection. That function uses zero
SO_LINGER option value to trigger a TCP reset when the connection is
closed. AFAICT, this is a &quot;standard&quot; approach.

I do not know whether that approach results in an actual TCP reset
packet immediately sent (as opposed to responding to any incoming
packets on the same connection with TCP reset packets).


HTH,

Alex.

&gt;<i> /**
</I>&gt;<i>  * enable linger with time of 0 so that when the socket is
</I>&gt;<i>  * closed, TCP generates a RESET
</I>&gt;<i>  */
</I>&gt;<i> void
</I>&gt;<i> comm_reset_close(const Comm::ConnectionPointer &amp;conn)
</I>&gt;<i> {
</I>&gt;<i>     struct linger L;
</I>&gt;<i>     L.l_onoff = 1;
</I>&gt;<i>     L.l_linger = 0;
</I>&gt;<i> 
</I>&gt;<i>     if (setsockopt(conn-&gt;fd, SOL_SOCKET, SO_LINGER, (char *) &amp;L, sizeof(L)) &lt; 0) {
</I>&gt;<i>         int xerrno = errno;
</I>&gt;<i>         debugs(50, DBG_CRITICAL, &quot;ERROR: Closing &quot; &lt;&lt; conn &lt;&lt; &quot; with TCP RST: &quot; &lt;&lt; xstrerr(xerrno));
</I>&gt;<i>     }
</I>&gt;<i>     conn-&gt;close();
</I>&gt;<i> }
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012384.html">[squid-users] TCP_RESET non http requests on port 80
</A></li>
	<LI>Next message (by thread): <A HREF="012359.html">[squid-users] Squid CPU usage in cachemgr.cgi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12397">[ date ]</a>
              <a href="thread.html#12397">[ thread ]</a>
              <a href="subject.html#12397">[ subject ]</a>
              <a href="author.html#12397">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
