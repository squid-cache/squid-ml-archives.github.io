<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] caching store increase then decrease during caching windows updates and all request are TCP_MISS ??!!!
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20caching%20store%20increase%20then%20decrease%20during%0A%20caching%20windows%20updates%20and%20all%20request%20are%20TCP_MISS%20%3F%3F%21%21%21&In-Reply-To=%3C3aea9e0f-f149-f20e-57c6-0a466445e011%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012446.html">
   <LINK REL="Next"  HREF="012464.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] caching store increase then decrease during caching windows updates and all request are TCP_MISS ??!!!</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20caching%20store%20increase%20then%20decrease%20during%0A%20caching%20windows%20updates%20and%20all%20request%20are%20TCP_MISS%20%3F%3F%21%21%21&In-Reply-To=%3C3aea9e0f-f149-f20e-57c6-0a466445e011%40treenet.co.nz%3E"
       TITLE="[squid-users] caching store increase then decrease during caching windows updates and all request are TCP_MISS ??!!!">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Sep 12 14:13:05 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012446.html">[squid-users] caching store increase then decrease during caching	windows updates and all request are TCP_MISS ??!!!
</A></li>
        <LI>Next message (by thread): <A HREF="012464.html">[squid-users] caching store increase then decrease during	caching windows updates and all request are TCP_MISS ??!!!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12449">[ date ]</a>
              <a href="thread.html#12449">[ thread ]</a>
              <a href="subject.html#12449">[ subject ]</a>
              <a href="author.html#12449">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12/09/2016 9:47 p.m., --Ahmad-- wrote:
&gt;<i> hi 
</I>&gt;<i> 
</I>&gt;<i> i have caching store increase then decrease  during caching windows updates and all request are TCP_MISS ??!!!
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at raspberrypi</A>:~# du -sh /var/cache/squid/
</I>&gt;<i> 558M    /var/cache/squid/
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at raspberrypi</A>:~# du -sh /var/cache/squid/
</I>&gt;<i> 561M    /var/cache/squid/
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at raspberrypi</A>:~# du -sh /var/cache/squid/
</I>&gt;<i> 564M    /var/cache/squid/
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at raspberrypi</A>:~# du -sh /var/cache/squid/
</I>&gt;<i> 647M    /var/cache/squid/
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at raspberrypi</A>:~# du -sh /var/cache/squid/
</I>&gt;<i> 650M    /var/cache/squid/
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at raspberrypi</A>:~# du -sh /var/cache/squid/
</I>&gt;<i> 652M    /var/cache/squid/
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at raspberrypi</A>:~# du -sh /var/cache/squid/
</I>&gt;<i> 604M    /var/cache/squid/
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at raspberrypi</A>:~# du -sh /var/cache/squid/
</I>&gt;<i> 605M    /var/cache/squid/
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at raspberrypi</A>:~# du -sh /var/cache/squid/
</I>&gt;<i> 605M    /var/cache/squid/
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at raspberrypi</A>:~# du -sh /var/cache/squid/
</I>&gt;<i> 606M    /var/cache/squid/
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at raspberrypi</A>:~# du -sh /var/cache/squid/
</I>&gt;<i> 606M    /var/cache/squid/
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at raspberrypi</A>:~# du -sh /var/cache/squid/
</I>&gt;<i> 595M    /var/cache/squid/
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at raspberrypi</A>:~# du -sh /var/cache/squid/
</I>&gt;<i> 
</I>
What relevance is this?


&gt;<i> 
</I>&gt;<i> here is sample of logs :
</I>&gt;<i> 
</I>&gt;<i> 1473672787.641    444 192.168.0.10 TCP_CLIENT_REFRESH_MISS/200 872 HEAD <A HREF="http://tlu.dl.delivery.mp.microsoft.com/filestreamingservice/files/ee82a2cb-f2cf-4cb3-907a-4f5496d2dc56?">http://tlu.dl.delivery.mp.microsoft.com/filestreamingservice/files/ee82a2cb-f2cf-4cb3-907a-4f5496d2dc56?</A> - ORIGINAL_DST/13.107.4.50 application/octet-stream
</I>
HEAD request. None of the object got downloaded.

&gt;<i> 1473672799.084  11876 192.168.0.10 TCP_MISS/206 615396 GET <A HREF="http://tlu.dl.delivery.mp.microsoft.com/filestreamingservice/files/ee82a2cb-f2cf-4cb3-907a-4f5496d2dc56?">http://tlu.dl.delivery.mp.microsoft.com/filestreamingservice/files/ee82a2cb-f2cf-4cb3-907a-4f5496d2dc56?</A> - ORIGINAL_DST/13.107.4.50 application/octet-stream
</I>&gt;<i> 1473672808.553   8396 192.168.0.10 TCP_MISS/206 615396 GET <A HREF="http://tlu.dl.delivery.mp.microsoft.com/filestreamingservice/files/ee82a2cb-f2cf-4cb3-907a-4f5496d2dc56?">http://tlu.dl.delivery.mp.microsoft.com/filestreamingservice/files/ee82a2cb-f2cf-4cb3-907a-4f5496d2dc56?</A> - ORIGINAL_DST/13.107.4.50 application/octet-stream
</I>&gt;<i> 1473672811.054  24905 192.168.0.10 TCP_MISS/206 1017331 GET <A HREF="http://tlu.dl.delivery.mp.microsoft.com/filestreamingservice/files/1fc27b6e-d563-415b-b11a-9e7e6f1ad33c?">http://tlu.dl.delivery.mp.microsoft.com/filestreamingservice/files/1fc27b6e-d563-415b-b11a-9e7e6f1ad33c?</A> - ORIGINAL_DST/13.107.4.50 application/octet-stream
</I>
Some Range requests for URI with ?query parameters. You need to add
&quot;strip_query_terms no&quot; to your squid.conf. Then you will be able to see
if these are identical URI or not.

Right now all that can be said is the script on the server which is
producing objects is the same one for many of the requests. There is no
way to know if they are requesting the same object or different ones.


&gt;<i> 1473672812.922   2687 192.168.0.10 TCP_CLIENT_REFRESH_MISS/206 1049501 GET <A HREF="http://tlu.dl.delivery.mp.microsoft.com/filestreamingservice/files/ee82a2cb-f2cf-4cb3-907a-4f5496d2dc56?">http://tlu.dl.delivery.mp.microsoft.com/filestreamingservice/files/ee82a2cb-f2cf-4cb3-907a-4f5496d2dc56?</A> - ORIGINAL_DST/13.107.4.50 application/octet-stream
</I>
A request where the client required new content to be fetched.

The rest of your log shows a lot of repeats of the above things happening.


&gt;<i> 
</I>&gt;<i> #refresh_pattern ([^.]+.|)(download|(windows|)update|).(microsoft.|)com/.*.(cab|exe|msi|msp) 4320 100% 43200 reload-into-ims
</I>&gt;<i> refresh_pattern ([^.]+.)?(download|(windows)?update).(microsoft.)?com/.*.(cab|exe|msi|msp|psf) 4320 100% 43200 reload-into-ims
</I>&gt;<i> refresh_pattern ([^.]+.|)(download|adcdownload).(apple.|)com/.*.(pkg|dmg) 4320 100% 43200 reload-into-ims
</I>
These refresh_pattern contain broken regex patterns.


1) Unless you explicitly use start/end anchors regex have implicit .*
sequences before and after the provided pattern.

 That means &quot;([^.]+.|)&quot; and &quot;([^.]+.)?&quot; are just a very complex (and
slow to compare) ways to write .*


2) '.' is a reserved character. If you want it to match a '.' in the
domain name you need to write it as \.


Hint both above regex will match the non-Microsoft, non-Apple URI:
  <A HREF="http://download.com/?pkg=caddy">http://download.com/?pkg=caddy</A>


Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012446.html">[squid-users] caching store increase then decrease during caching	windows updates and all request are TCP_MISS ??!!!
</A></li>
	<LI>Next message (by thread): <A HREF="012464.html">[squid-users] caching store increase then decrease during	caching windows updates and all request are TCP_MISS ??!!!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12449">[ date ]</a>
              <a href="thread.html#12449">[ thread ]</a>
              <a href="subject.html#12449">[ subject ]</a>
              <a href="author.html#12449">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
