<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] caching store increase then decrease during	caching windows updates and all request are TCP_MISS ??!!!
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20caching%20store%20increase%20then%20decrease%20during%0A%09caching%20windows%20updates%20and%20all%20request%20are%20TCP_MISS%20%3F%3F%21%21%21&In-Reply-To=%3C01f701d20d84%2478c7cd50%246a5767f0%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012465.html">
   <LINK REL="Next"  HREF="012458.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] caching store increase then decrease during	caching windows updates and all request are TCP_MISS ??!!!</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20caching%20store%20increase%20then%20decrease%20during%0A%09caching%20windows%20updates%20and%20all%20request%20are%20TCP_MISS%20%3F%3F%21%21%21&In-Reply-To=%3C01f701d20d84%2478c7cd50%246a5767f0%24%40ngtech.co.il%3E"
       TITLE="[squid-users] caching store increase then decrease during	caching windows updates and all request are TCP_MISS ??!!!">eliezer at ngtech.co.il
       </A><BR>
    <I>Tue Sep 13 06:02:55 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012465.html">[squid-users] caching store increase then decrease during caching windows updates and all request are TCP_MISS ??!!!
</A></li>
        <LI>Next message (by thread): <A HREF="012458.html">[squid-users] Lost of all squid cache
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12468">[ date ]</a>
              <a href="thread.html#12468">[ thread ]</a>
              <a href="subject.html#12468">[ subject ]</a>
              <a href="author.html#12468">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Just as a side note to the server insisting on the full object:
Since we believe and estimate that SHA digests are considered collision safe on the 100+ MB files sizes for the next couple years it is safe to assume(from my point of view on things) that if the whole file was digested with a SHA1 and forward and the full object was found to match this same SHA1 (or other digest) it is safe to be cached.
However I must admit that if these is some communication channel over this url such as in the headers, it would be possible to assume that you cannot cache this content.
With all the above in mind I think that Caching Windows Updates in most cases might not be the right path.
Only if you can provide much  beefier compute and storage resources then the original source it would be smart to cache these.

When an admin will try to cache with a much slower and less performing system then the original one it would be pretty simple to estimate that it will &quot;slow down&quot; things for the clients in many cases.
The practical example I can give is using a 5400RPM spinning disk for a cache which utilizes more then 100 IOPs from disk.

I believe that this should only be used when there are cases which you took anything you can into consideration and consulted any engineer which you should.

All The Bests,
Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>


-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Amos Jeffries
Sent: Tuesday, September 13, 2016 6:05 AM
To: --Ahmad--
Cc: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] caching store increase then decrease during caching windows updates and all request are TCP_MISS ??!!!

On 13/09/2016 8:26 a.m., --Ahmad-- wrote:
&gt;<i> amos thank you so much for reply 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> how can i correct the patterns below ?
</I>&gt;<i> 
</I>
Remove the ([^.]+.)? and ([^.]+.|) parts.

Replace the . where you want to match a '.' with \.


&gt;<i> 
</I>&gt;<i> im not sure if the other patterns are doing the game 
</I>&gt;<i> 
</I>&gt;<i> but so far i don&#8217;t have disk increasing at all
</I>&gt;<i> 
</I>&gt;<i> only  the disk start increase when only i add :
</I>&gt;&gt;&gt;<i> refresh_pattern ([^.]+.)?(download|(windows)?update).(microsoft.)?com/.*.(cab|exe|msi|msp|psf) 4320 100% 43200 reload-into-ims
</I>&gt;&gt;&gt;<i> refresh_pattern ([^.]+.|)(download|adcdownload).(apple.|)com/.*.(pkg|dmg) 4320 100% 43200 reload-into-ins
</I>&gt;<i> 
</I>&gt;<i> but  i still don&#8217;t have HITs 
</I>&gt;<i> 
</I>
You have many CLIENT_REFRESH/20x. Which means cached content was found,
but the client required it to be refreshed. When revalidated the server
returned an entire new object.

With the above refresh_rattern, the client may have required the cached
data to be reloaded (Cache-Control:max-age=0) and the reload-into-ims
converted it to a CLIENT_REFRESH from a MISS.


&gt;<i> im not sure where should i tune ?
</I>
There is not much you can do when the server returns whole objects in
response to revalidation requests.

The client is requiring that only the latest copy be used, and the
server is insisting that the object has changed.

Since this is an OS update process it is exremely unsafe to make
assumptions yourself about anything being differently cacheable than
what the server is insisting. It is entirely possible that each response
is encrypted and hashed independently - so actually is different.


&gt;<i> 
</I>&gt;<i> i also added stip query terms to off
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> not sure  what should i do next &#8230;&#8230;. all i need is windows updates go ok , I&#8217;m not interested with other caching 
</I>&gt;<i> 
</I>
With query-terms in the access.log you can better see what requests
should be MISS and which ones have a chance of being HITs (or near-HITs).

Once you can tell which requests actually should be HIT-able you can
then look at the messages going through (in cache.log with debug_options
11,2) for those requests to see what else might be done.

Amos

_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012465.html">[squid-users] caching store increase then decrease during caching windows updates and all request are TCP_MISS ??!!!
</A></li>
	<LI>Next message (by thread): <A HREF="012458.html">[squid-users] Lost of all squid cache
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12468">[ date ]</a>
              <a href="thread.html#12468">[ thread ]</a>
              <a href="subject.html#12468">[ subject ]</a>
              <a href="author.html#12468">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
