<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Rock store status
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Rock%20store%20status&In-Reply-To=%3Cab9de679-f835-5ba9-59fe-87b064304c18%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012470.html">
   <LINK REL="Next"  HREF="012496.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Rock store status</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Rock%20store%20status&In-Reply-To=%3Cab9de679-f835-5ba9-59fe-87b064304c18%40measurement-factory.com%3E"
       TITLE="[squid-users] Rock store status">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Sep 13 17:24:30 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012470.html">[squid-users] Rock store status
</A></li>
        <LI>Next message (by thread): <A HREF="012496.html">[squid-users] Rock store status
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12479">[ date ]</a>
              <a href="thread.html#12479">[ thread ]</a>
              <a href="subject.html#12479">[ subject ]</a>
              <a href="author.html#12479">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 09/13/2016 05:01 AM, FredB wrote:
&gt;<i> One thing, squid restart is very slow because of time required to rebuild the cache
</I>&gt;<i> 
</I>&gt;<i> 2016/09/13 00:25:34|   Took 1498.42 seconds (3972.24 objects/sec). -&gt; Rock
</I>&gt;<i> 2016/09/13 00:00:51|   Took 5.71 seconds (533481.90 objects/sec). -&gt; Diskd
</I>
This is a known problem, with several important wrinkles, including:

* Squid start itself is not slow. Cache index build is slow.

* Squid can serve requests, including cache hits while it builds rock
index, but indexing does affect overall Squid performance and hit ratios.

* Avoid comparing loading a &quot;few&quot; ufs entries (from the clean swap
state) with scanning all available cache slots for rock. The biggest
difference is observed for a virtually empty ufs cache that was in use
for a short time (small swap.state). Rock focus is on Squid running for
a long time with a full cache (the common and intended use case).

* We are essentially comparing a from-scratch index build for rock with
a clean index loading for ufs. If you remove all swap state files, ufs
indexing time will probably be worse than that of rock. If you leave
dirty swap state files, then ufs indexing may slow down significantly;
this happens after Squid crashes, for example. Rock indexing does not
depend on the previous Squid state.

* Rock indexing can be optimized in various ways, of course. Many trade
offs are involved, and some optimizations may hurt runtime performance.
For example, there is a trade-off between
    - maintaining a disk index (i.e., swap state files) at runtime
     (and then saving a clean index at shutdown) like UFS stores do and
    - building an index from scratch by scanning the entire cache at
      start like rock stores do.


This is now documented at

<A HREF="http://wiki.squid-cache.org/Features/LargeRockStore#Slow_cache_index_build">http://wiki.squid-cache.org/Features/LargeRockStore#Slow_cache_index_build</A>


HTH,

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012470.html">[squid-users] Rock store status
</A></li>
	<LI>Next message (by thread): <A HREF="012496.html">[squid-users] Rock store status
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12479">[ date ]</a>
              <a href="thread.html#12479">[ thread ]</a>
              <a href="subject.html#12479">[ subject ]</a>
              <a href="author.html#12479">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
