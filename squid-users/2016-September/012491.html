<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Introducing delay to HTTP 407 responses
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Introducing%20delay%20to%20HTTP%20407%20responses&In-Reply-To=%3C000301d20e1d%247476f840%245d64e8c0%24%40filter.luko.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012644.html">
   <LINK REL="Next"  HREF="012493.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Introducing delay to HTTP 407 responses</H1>
    <B>squid-users at filter.luko.org</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Introducing%20delay%20to%20HTTP%20407%20responses&In-Reply-To=%3C000301d20e1d%247476f840%245d64e8c0%24%40filter.luko.org%3E"
       TITLE="[squid-users] Introducing delay to HTTP 407 responses">squid-users at filter.luko.org
       </A><BR>
    <I>Wed Sep 14 00:18:01 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012644.html">[squid-users] SSO (kerberos)
</A></li>
        <LI>Next message (by thread): <A HREF="012493.html">[squid-users] Introducing delay to HTTP 407 responses
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12491">[ date ]</a>
              <a href="thread.html#12491">[ thread ]</a>
              <a href="subject.html#12491">[ subject ]</a>
              <a href="author.html#12491">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Squid users,

Seeking advice on how to slow down 407 responses to broken Apple &amp; MS
clients, which seem to retry at very short intervals and quickly fill the
access.log with garbage.  The problem is very similar to this:

<A HREF="http://www.squid-cache.org/mail-archive/squid-users/201404/0326.html">http://www.squid-cache.org/mail-archive/squid-users/201404/0326.html</A>

However the config below doesn't seem to slow down the response:

acl delaydomains dstdomain .live.net .apple.com
acl authresponse http_status 407
external_acl_type delay ttl=0 negative_ttl=0 cache=0 %SRC /tmp/delay.pl
acl delay external delay
http_reply_access deny delaydomains authresponse delay
http_reply_access allow all

The helper is never asked by Squid to process the request.  Just wondering
if http_status ACLs can be used in http_reply_access?

My other thinking, if this isn't possible, was to mark 407 responses with
clientside_tos so they could be delayed/throttled with tc or iptables.  Ie,

acl authresponse http_status 407
clientside_tos 0x20 authresponse

However, auth response packets don't get the desired tos markings.  Instead
the following message appears in cache.log:

2016/09/13 11:35:43 kid1| WARNING: authresponse ACL is used in context
without an HTTP response. Assuming mismatch.

After reviewing
<A HREF="http://lists.squid-cache.org/pipermail/squid-users/2016-May/010630.html">http://lists.squid-cache.org/pipermail/squid-users/2016-May/010630.html</A> it
seems like this has cropped up before.  The suggestion in that thread was to
exclude 407 responses from the access log.  Fortunately this works.  But I'm
wondering if there is a way to introduce delay into the 407 response itself?
Partly to minimise load associated with serving broken clients, and also to
maintain logging of actual intrusion attempts.  Any suggestions?

Luke



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012644.html">[squid-users] SSO (kerberos)
</A></li>
	<LI>Next message (by thread): <A HREF="012493.html">[squid-users] Introducing delay to HTTP 407 responses
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12491">[ date ]</a>
              <a href="thread.html#12491">[ thread ]</a>
              <a href="subject.html#12491">[ subject ]</a>
              <a href="author.html#12491">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
