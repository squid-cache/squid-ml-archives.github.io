<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] cache github zip repositories
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20cache%20github%20zip%20repositories&In-Reply-To=%3CCA%2BsSnVYRRMPz6ZSBbZnMvAeLzL3%3D4sAG%3DBkvr5U-B%3DOxpKMnhQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012522.html">
   <LINK REL="Next"  HREF="012510.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] cache github zip repositories</H1>
    <B>Hardik Dangar</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20cache%20github%20zip%20repositories&In-Reply-To=%3CCA%2BsSnVYRRMPz6ZSBbZnMvAeLzL3%3D4sAG%3DBkvr5U-B%3DOxpKMnhQ%40mail.gmail.com%3E"
       TITLE="[squid-users] cache github zip repositories">hardikdangar+squid at gmail.com
       </A><BR>
    <I>Wed Sep 14 23:54:27 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012522.html">[squid-users] Cannot get ACL to work
</A></li>
        <LI>Next message (by thread): <A HREF="012510.html">[squid-users] cache github zip repositories
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12509">[ date ]</a>
              <a href="thread.html#12509">[ thread ]</a>
              <a href="subject.html#12509">[ subject ]</a>
              <a href="author.html#12509">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I am trying to cache Github zip URL's so it can be effectively cached as a
composer(php dependency management tool) uses them and in our local setup (
we are about 40 developers on a Lan and it will really help us managing
cache.). My squid version is 3.5.12 and our squid cache server is ubuntu
16.04. Here is squid.conf file we use,
<A HREF="https://gist.github.com/hardikdangar/df31d5bce725eff66e06f3abd6e77600">https://gist.github.com/hardikdangar/df31d5bce725eff66e06f3abd6e77600</A>

Here is the part which I want to cache,
say for example you want to download repo from GitHub then URL looks like
<A HREF="https://github.com/hardikdangar/test/archive/master.zip">https://github.com/hardikdangar/test/archive/master.zip</A>
but it redirects to the following,
<A HREF="https://codeload.github.com/hardikdangar/test/zip/master">https://codeload.github.com/hardikdangar/test/zip/master</A>

You can see the response parameters via redbot.org
<A HREF="https://redbot.org/?uri=https%3A%2F%2Fcodeload.github.com%">https://redbot.org/?uri=https%3A%2F%2Fcodeload.github.com%</A>
2Fhardikdangar%2Ftest%2Fzip%2Fmaster

  HTTP/1.1 200 OK
    Content-Length: 929
    Access-Control-Allow-Origin: <A HREF="https://render.githubusercontent.com">https://render.githubusercontent.com</A>
    Content-Security-Policy: default-src 'none'; style-src 'unsafe-inline'
    Strict-Transport-Security: max-age=31536000
    Vary: Authorization,Accept-Encoding
    X-Content-Type-Options: nosniff
    X-Frame-Options: deny
    X-XSS-Protection: 1; mode=block
    ETag: &quot;9ea9838812d6f7bc53763eb1577da04e2fa473d5&quot;
    Content-Type: application/zip
    Content-Disposition: attachment; filename=test-master.zip
    X-Geo-Block-List:
    Date: Wed, 14 Sep 2016 23:24:44 GMT
    X-GitHub-Request-Id: 77092BF1:7F40:346461:57D9DC3C

Now if i do any change to above repository github does change ETAG and if i
don't change anything then ETAG remains the same so i believe we should be
able to cache those .zip files.

By default, squid does not cache codeload.github.com, to put it into cache,
I added,
refresh_pattern codeload.github.com 900 20% 4320 reload-into-ims

Now as per my understanding this should check etag as Last-Modified is not
provided by github for each new request. This does cache the zip file but
what happens is in next request even if i change the content and etag
changes squid sends the cached file from its cache instead of downloading
new file.

I have no clue why this happens. Can anyone help me figure out what's wrong
here? why squid does not detect new etag when repository is updated? why it
sends cache file even though there is new file available.

Thank you very much in advance for reading upto this point and have a good
day.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160915/3acc26a2/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160915/3acc26a2/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012522.html">[squid-users] Cannot get ACL to work
</A></li>
	<LI>Next message (by thread): <A HREF="012510.html">[squid-users] cache github zip repositories
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12509">[ date ]</a>
              <a href="thread.html#12509">[ thread ]</a>
              <a href="subject.html#12509">[ subject ]</a>
              <a href="author.html#12509">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
