<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3.5.21 ssl bump and x-forward
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.21%20ssl%20bump%20and%20x-forward&In-Reply-To=%3C801c5135-4270-4c86-6c3a-49ba4cf6296f%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012513.html">
   <LINK REL="Next"  HREF="012515.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3.5.21 ssl bump and x-forward</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.21%20ssl%20bump%20and%20x-forward&In-Reply-To=%3C801c5135-4270-4c86-6c3a-49ba4cf6296f%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid 3.5.21 ssl bump and x-forward">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Sep 15 10:18:45 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012513.html">[squid-users] Squid 3.5.21 ssl bump and x-forward
</A></li>
        <LI>Next message (by thread): <A HREF="012515.html">[squid-users] Squid 3.5.21 ssl bump and x-forward
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12514">[ date ]</a>
              <a href="thread.html#12514">[ thread ]</a>
              <a href="subject.html#12514">[ subject ]</a>
              <a href="author.html#12514">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 15/09/2016 8:53 p.m., FredB wrote:
&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> I'm testing SSlBump and it works good, however I'm seeing something strange with two proxies and x-forwarded enabled to the first, some requests are wrote with the first proxy address. 
</I>&gt;<i> 
</I>&gt;<i> user -&gt; squid (fowarded_for on) -&gt; squid (follow_x_forwarded_for allow all) -&gt; Net 
</I>&gt;<i> 
</I>&gt;<i> Here log from the second squids, on same server, (same result when there are separate 127.0.0.1 = IP FIRST SQUID) 
</I>&gt;<i> 
</I>&gt;<i> 10.x.x.x.x - myaccount [15/Sep/2016:09:40:07 +0200] &quot;CONNECT www.google.fr:443 HTTP/1.0&quot; 200 0 440 TAG_NONE:HIER_NONE &quot;Mozilla/5.0 (Windows NT 6.1; rv:48.0) Gecko/20100101 Firefox/48.0&quot; 
</I>&gt;<i> 10.x.x.x.x - myaccount [15/Sep/2016:09:40:07 +0200] &quot;GET <A HREF="http://www.google.fr/">http://www.google.fr/</A> HTTP/1.0&quot; 302 643 1575 TCP_MISS:HIER_DIRECT &quot;Mozilla/5.0 (Windows NT 6.1; rv:48.0) Gecko/20100101 Firefox/48.0&quot; 
</I>&gt;<i> 10.x.x.x.x - myaccount [15/Sep/2016:09:40:07 +0200] &quot;CONNECT www.google.fr:443 HTTP/1.0&quot; 200 0 440 TAG_NONE:HIER_NONE &quot;Mozilla/5.0 (Windows NT 6.1; rv:48.0) Gecko/20100101 Firefox/48.0&quot; 
</I>
Above are HTTP requests sent from proxy #1 to proxy #2.

&gt;<i> 127.0.0.1 - myaccount [15/Sep/2016:09:40:07 +0200] &quot;POST <A HREF="https://www.google.fr/gen_204?atyp=i&amp;ct=slh&amp;cad=&amp;ei=EVDaV-rAOcS7adLmucAF&amp;s=3&amp;v=2&amp;pv=0.19272099408438004&amp;me=4:1473925301533,e,U&amp;zx=1473925301536">https://www.google.fr/gen_204?atyp=i&amp;ct=slh&amp;cad=&amp;ei=EVDaV-rAOcS7adLmucAF&amp;s=3&amp;v=2&amp;pv=0.19272099408438004&amp;me=4:1473925301533,e,U&amp;zx=1473925301536</A> HTTP/1.1&quot; 204 401 1571 TCP_MISS:HIER_DIRECT &quot;Mozilla/5.0 (Windows NT 6.1; rv:48.0) Gecko/20100101 Firefox/48.0&quot; 
</I>&gt;<i> 127.0.0.1 - myaccount [15/Sep/2016:09:40:08 +0200] &quot;GET <A HREF="https://www.google.fr/?gws_rd=ssl">https://www.google.fr/?gws_rd=ssl</A> HTTP/1.1&quot; 200 61953 1387 TCP_MISS:HIER_DIRECT &quot;Mozilla/5.0 (Windows NT 6.1; rv:48.0) Gecko/20100101 Firefox/48.0&quot; 
</I>&gt;<i> 127.0.0.1 - myaccount [15/Sep/2016:09:40:08 +0200] &quot;POST <A HREF="https://www.google.fr/gen_204?atyp=i&amp;ct=slh&amp;cad=&amp;ei=EVDaV-rAOcS7adLmucAF&amp;s=4&amp;v=2&amp;pv=0.19272099408438004&amp;me=5:1473925302218,e,H&amp;zx=1473925302220">https://www.google.fr/gen_204?atyp=i&amp;ct=slh&amp;cad=&amp;ei=EVDaV-rAOcS7adLmucAF&amp;s=4&amp;v=2&amp;pv=0.19272099408438004&amp;me=5:1473925302218,e,H&amp;zx=1473925302220</A> HTTP/1.1&quot; 204 401 1571 TCP_MISS:HIER_DIRECT &quot;Mozilla/5.0 (Windows NT 6.1; rv:48.0) Gecko/20100101 Firefox/48.0&quot; 
</I>&gt;<i> 127.0.0.1 - myaccount [15/Sep/2016:09:40:08 +0200] &quot;GET <A HREF="https://www.google.fr/complete/search?sclient=psy-ab&amp;site=&amp;source=hp&amp;q=&amp;oq=&amp;gs_l=&amp;pbx=1&amp;bav=on.2,or.r_cp.&amp;fp=1&amp;biw=995&amp;bih=554&amp;dpr=1.25&amp;pf=p&amp;gs_rn=64&amp;gs_ri=psy-ab&amp;tok=yZHeL-_L5Be_JazeSm0Mtg&amp;cp=0&amp;gs_id=0&amp;xhr=t&amp;tch=1&amp;ech=1&amp;psi=tVDaV7_DMsXqauCygeAF.1473925302436.1">https://www.google.fr/complete/search?sclient=psy-ab&amp;site=&amp;source=hp&amp;q=&amp;oq=&amp;gs_l=&amp;pbx=1&amp;bav=on.2,or.r_cp.&amp;fp=1&amp;biw=995&amp;bih=554&amp;dpr=1.25&amp;pf=p&amp;gs_rn=64&amp;gs_ri=psy-ab&amp;tok=yZHeL-_L5Be_JazeSm0Mtg&amp;cp=0&amp;gs_id=0&amp;xhr=t&amp;tch=1&amp;ech=1&amp;psi=tVDaV7_DMsXqauCygeAF.1473925302436.1</A> HTTP/1.1&quot; 200 913 1618 TCP_MISS:HIER_DIRECT &quot;Mozilla/5.0 (Windows NT 6.1; rv:48.0) Gecko/20100101 Firefox/48.0&quot; 
</I>&gt;<i> 127.0.0.1 - myaccount [15/Sep/2016:09:40:08 +0200] &quot;GET <A HREF="https://www.google.fr/gen_204?v=3&amp;s=webhp&amp;atyp=csi&amp;ei=tVDaV7_DMsXqauCygeAF&amp;imc=2&amp;imn=2&amp;imp=0&amp;adh=&amp;xjs=init.26.20.sb.18.p.3.jsa.1.abd.1.foot.1&amp;ima=0&amp;rt=xjsls.21,prt.41,iml.41,dcl.82,xjses.124,jraids.149,jraide.153,xjsee.185,xjs.185,ol.217,aft.41,wsrt.748,cst.1,dnst.0,rqst.522,rspt.533,rqstt.161,unt.143,cstt.144,dit.816">https://www.google.fr/gen_204?v=3&amp;s=webhp&amp;atyp=csi&amp;ei=tVDaV7_DMsXqauCygeAF&amp;imc=2&amp;imn=2&amp;imp=0&amp;adh=&amp;xjs=init.26.20.sb.18.p.3.jsa.1.abd.1.foot.1&amp;ima=0&amp;rt=xjsls.21,prt.41,iml.41,dcl.82,xjses.124,jraids.149,jraide.153,xjsee.185,xjs.185,ol.217,aft.41,wsrt.748,cst.1,dnst.0,rqst.522,rspt.533,rqstt.161,unt.143,cstt.144,dit.816</A> HTTP/1.1&quot; 204 401 1616 TCP_MISS:HIER_DIRECT &quot;Mozilla/5.0 (Windows NT 6.1; rv:48.0) Gecko/20100101 Firefox/48.0&quot; 
</I>
Above are bumped requests sent inside the tunnel. Proxy #1 did not
interact with them, so it has no way to add XFF headers.

The SSL-Bump logic does not yet store some things like indirect client
IP and associate them with the bumped requests.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012513.html">[squid-users] Squid 3.5.21 ssl bump and x-forward
</A></li>
	<LI>Next message (by thread): <A HREF="012515.html">[squid-users] Squid 3.5.21 ssl bump and x-forward
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12514">[ date ]</a>
              <a href="thread.html#12514">[ thread ]</a>
              <a href="subject.html#12514">[ subject ]</a>
              <a href="author.html#12514">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
