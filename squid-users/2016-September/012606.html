<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid https intercept mode and ubuntu third party repositories issue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20https%20intercept%20mode%20and%20ubuntu%20third%20party%0A%20repositories%20issue&In-Reply-To=%3Cdb9016e0-b147-812d-8fb6-c43215ca8123%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012586.html">
   <LINK REL="Next"  HREF="012607.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid https intercept mode and ubuntu third party repositories issue</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20https%20intercept%20mode%20and%20ubuntu%20third%20party%0A%20repositories%20issue&In-Reply-To=%3Cdb9016e0-b147-812d-8fb6-c43215ca8123%40treenet.co.nz%3E"
       TITLE="[squid-users] squid https intercept mode and ubuntu third party repositories issue">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Sep 20 10:28:15 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012586.html">[squid-users] squid https intercept mode and ubuntu third party	repositories issue
</A></li>
        <LI>Next message (by thread): <A HREF="012607.html">[squid-users] squid https intercept mode and ubuntu third party repositories issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12606">[ date ]</a>
              <a href="thread.html#12606">[ thread ]</a>
              <a href="subject.html#12606">[ subject ]</a>
              <a href="author.html#12606">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 20/09/2016 4:42 a.m., Hardik Dangar wrote:
&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> I am using squid 3.5.12(detailed version info is below) on Ubuntu 16.04.1
</I>&gt;<i> LTS server. My squid config is at, <A HREF="http://pastebin.com/raw/b8RZ67u9">http://pastebin.com/raw/b8RZ67u9</A>
</I>&gt;<i> 
</I>&gt;<i> I have configured squid as intercept proxy bumping all SSL https
</I>&gt;<i> connections. Setup is working fine for many things like browsing,
</I>&gt;<i> even on command line like wget i can download via https as i have installed
</I>&gt;<i> root certificate within my client os.
</I>&gt;<i> 
</I>&gt;<i> My issue is whenever i try to add extra repository via command, i.e.
</I>&gt;<i> sudo add-apt-repository ppa:ondrej/php
</I>&gt;<i> command fails with output &quot;Cannot add PPA: 'ppa:~ondrej/ubuntu/php'.ERROR:
</I>&gt;<i> '~ondrej' user or team does not exist.&quot; and in squid's cache and access.log
</I>&gt;<i> following entries can be located for this request,
</I>&gt;<i> 
</I>&gt;<i> ==&gt; /var/log/squid/access.log &lt;==
</I>&gt;<i> 1474302162.378    439 192.168.1.66 TAG_NONE/200 0 CONNECT 91.189.89.223:443
</I>&gt;<i> - ORIGINAL_DST/91.189.89.223 -
</I>&gt;<i> 
</I>&gt;<i> ==&gt; /var/log/squid/cache.log &lt;==
</I>&gt;<i> 2016/09/19 21:52:42 kid1| Error negotiating SSL connection on FD 21:
</I>&gt;<i> error:14094418:SSL routines:ssl3_read_bytes:tlsv1 alert unknown ca (1/0)
</I>&gt;<i> 2016/09/19 21:52:42 kid1| hold write on SSL connection on FD 22
</I>&gt;<i> 
</I>&gt;<i> ==&gt; /var/log/squid/access.log &lt;==
</I>&gt;<i> 1474302162.885    403 192.168.1.66 TAG_NONE/200 0 CONNECT 91.189.89.223:443
</I>&gt;<i> - ORIGINAL_DST/91.189.89.223 -
</I>&gt;<i> 
</I>&gt;<i> ==&gt; /var/log/squid/cache.log &lt;==
</I>&gt;<i> 2016/09/19 21:52:42 kid1| Error negotiating SSL connection on FD 21:
</I>&gt;<i> error:14094418:SSL routines:ssl3_read_bytes:tlsv1 alert unknown ca (1/0)
</I>&gt;<i> 
</I>&gt;<i> in the above output 192.168.1.66 is my client requesting that request and
</I>&gt;<i> as you can see in cache.log there is certificate negotiation error. I have
</I>&gt;<i> tried to fiddle with all options provided at <A HREF="http://wiki.squid-cache.org/">http://wiki.squid-cache.org/</A>
</I>&gt;<i> ConfigExamples/Intercept/SslBumpExplicit but it seems i am out of luck
</I>&gt;<i> after almost half of my day battling this issue.
</I>&gt;<i> 
</I>&gt;<i> Can someone tell me they are successful with this issue? if so can you
</I>&gt;<i> share your squid.conf relevant section?
</I>&gt;<i> 
</I>&gt;<i> $ squid -v
</I>&gt;<i> Squid Cache: Version 3.5.12
</I>
Ubuntu Squid package does not build with SSL functionality.

When re-building your Squid with SSL-Bump features it is important to
always use teh very latest Squid release. SSL/TLS and bumping are part
of an ongoing arms race situation. Things are constantly changing and
software from as little as a year ago is unlikly to work 100% well with
intercepting ('bumping') encryption from today.

First thing to try is to rebuild with squid 3.5.20 or .21 and see if the
problem remains.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012586.html">[squid-users] squid https intercept mode and ubuntu third party	repositories issue
</A></li>
	<LI>Next message (by thread): <A HREF="012607.html">[squid-users] squid https intercept mode and ubuntu third party repositories issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12606">[ date ]</a>
              <a href="thread.html#12606">[ thread ]</a>
              <a href="subject.html#12606">[ subject ]</a>
              <a href="author.html#12606">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
