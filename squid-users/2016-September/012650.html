<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Accelerator Mode - HSTS and Redirect
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Accelerator%20Mode%20-%20HSTS%20and%20Redirect&In-Reply-To=%3Cdc4e839f-dceb-5850-2c71-20a85c459b53%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012649.html">
   <LINK REL="Next"  HREF="012663.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Accelerator Mode - HSTS and Redirect</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Accelerator%20Mode%20-%20HSTS%20and%20Redirect&In-Reply-To=%3Cdc4e839f-dceb-5850-2c71-20a85c459b53%40treenet.co.nz%3E"
       TITLE="[squid-users] Accelerator Mode - HSTS and Redirect">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Sep 23 03:03:56 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012649.html">[squid-users] Accelerator Mode  - HSTS and Redirect
</A></li>
        <LI>Next message (by thread): <A HREF="012663.html">[squid-users] Accelerator Mode - HSTS and Redirect
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12650">[ date ]</a>
              <a href="thread.html#12650">[ thread ]</a>
              <a href="subject.html#12650">[ subject ]</a>
              <a href="author.html#12650">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 23/09/2016 12:45 p.m., creditu wrote:
&gt;<i> We have been using squid in accelerator mode for a number of years. In
</I>&gt;<i> the current setup we have the squid frontends that send all the http
</I>&gt;<i> requests to the backend apache webservers using a simple redirect
</I>&gt;<i> script.  We need to switch to https for the public presence.
</I>
redirect/rewrite script is very rarely a suitable way to do this for
reverse-proxy.

Use cache_peer to configure what backend servers exist and
cache_peer_access rules to determine which one(s) any given request can
be sent to.

The backends should be capable of accepting the traffic as if the proxy
were not there. If for some reason it has to have a different domain
name (actual need for this is rare), then the cache_peer forcedomain=
option can be used.

&gt;<i> 
</I>&gt;<i> So, our initial thought would be to use https_port for public HTTPS
</I>&gt;<i> presence and send the requests using cache_peer to the backend apache
</I>&gt;<i> servers using plain http.  Basically terminating HTTPS from clients and
</I>&gt;<i> relaying it to backend servers using HTTP.  
</I>&gt;<i> 
</I>&gt;<i> We will need to implement HSTS at some point (i.e.
</I>&gt;<i> Strict-Transport-Security: max-age=8888; includeSubDomains; preload),
</I>&gt;<i> will we be able to do this in the above scenario?
</I>&gt;<i> 
</I>
Yes. Provided you can get rid of that redirect/rewrite script. The
background things cache_peer logic does to the traffic will be needed
for the HTTPS transition.


&gt;<i> Also, we will initially be providing both http and https, but will need
</I>&gt;<i> to stop http at some point.  Is there a way to redirect the clients that
</I>&gt;<i> try to connect via http to use https with squid?  Something like the
</I>&gt;<i> rewrite engine in apache?
</I>
cache_peer can be configured to contact the peer over TLS. This can be
done individually, and before the HSTS gets added for public viewing.

&gt;<i> 
</I>&gt;<i> We use RH 6.x which comes with squid 3.1.  Thanks for any feedback. 
</I>
For your particular use a build of that with OpenSSL support should be
okay. But if you can, an upgrade to more recent version would be better
as there have been some important OpenSSL and TLS protocol changes since
3.1 was designed.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012649.html">[squid-users] Accelerator Mode  - HSTS and Redirect
</A></li>
	<LI>Next message (by thread): <A HREF="012663.html">[squid-users] Accelerator Mode - HSTS and Redirect
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12650">[ date ]</a>
              <a href="thread.html#12650">[ thread ]</a>
              <a href="subject.html#12650">[ subject ]</a>
              <a href="author.html#12650">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
