<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3.5.21 - High CPU (100%)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.21%20-%20High%20CPU%20%28100%25%29&In-Reply-To=%3Ceda6e7a2-c172-d9be-905c-825b48365261%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012680.html">
   <LINK REL="Next"  HREF="012688.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3.5.21 - High CPU (100%)</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.21%20-%20High%20CPU%20%28100%25%29&In-Reply-To=%3Ceda6e7a2-c172-d9be-905c-825b48365261%40measurement-factory.com%3E"
       TITLE="[squid-users] Squid 3.5.21 - High CPU (100%)">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Sep 26 14:03:14 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012680.html">[squid-users] Squid 3.5.21 - High CPU (100%)
</A></li>
        <LI>Next message (by thread): <A HREF="012688.html">[squid-users] Squid 3.5.21 - High CPU (100%)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12685">[ date ]</a>
              <a href="thread.html#12685">[ thread ]</a>
              <a href="subject.html#12685">[ subject ]</a>
              <a href="author.html#12685">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 09/26/2016 12:59 AM, Jasper Van Der Westhuizen wrote:
&gt;<i> On Wed, 2016-09-21 at 08:34 -0600, Alex Rousskov wrote:
</I>&gt;&gt;<i> On 09/21/2016 07:53 AM, Jasper Van Der Westhuizen wrote:
</I>&gt;&gt;&gt;<i> I have been having some problems with Squid using 100% CPU at times
</I>&gt;&gt;&gt;<i> which impacts my users browsing experience.
</I>
&gt;&gt;<i> Sustained 100% CPU load at ~100/s rates with regular traffic on
</I>&gt;&gt;<i> reasonable hardware is a sign (albeit not a proof!) of a Squid bug
</I>&gt;&gt;<i> (including long searches and similar optimization problems).
</I>
&gt;<i> What I found now after making
</I>&gt;<i> changes to my squid.conf file, my cache drive gets *hammered* at times
</I>&gt;<i> of high usage.
</I>
That is a different problem that requires different approaches.


&gt;&gt;<i> Next time this happens, consider getting a stack trace or two from the
</I>&gt;&gt;<i> process showing sustained 100% CPU utilization.
</I>
&gt;<i> I do not have much experience with strace.
</I>
I was not talking about strace but a stack trace produced by gdb and
such. However, I was trying to help you solve a different problem so you
should ignore those instructions.


&gt;<i> I have huge amounts of writes happening and this creates CPU wait and
</I>&gt;<i> the user experience goes out of the window.
</I>
Yes, disk write queue overflow/flushing is a common performance problem.
IIRC, it does not manifest as 100% CPU usage but perhaps that is what
you see with aufs which I am not intimately familiar with.


&gt;<i> Is there anything that you guys can suggest I do around the cache?
</I>&gt;<i> Should I try a different store type? A different filesystem type perhaps?
</I>
If your store has a configuration knob that effectively limits disk
writing rate, then use it to limit that rate to avoid overflowing the queue.

You can also consider using rock store that has an explicit write rate
limiting option (but comes with other problems that may or may not
affect your setup).

Adding more physical disk spindles helps, of course.

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012680.html">[squid-users] Squid 3.5.21 - High CPU (100%)
</A></li>
	<LI>Next message (by thread): <A HREF="012688.html">[squid-users] Squid 3.5.21 - High CPU (100%)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12685">[ date ]</a>
              <a href="thread.html#12685">[ thread ]</a>
              <a href="subject.html#12685">[ subject ]</a>
              <a href="author.html#12685">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
