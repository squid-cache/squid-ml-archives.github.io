<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] connections from particular users sometimes get stuck
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20connections%20from%20particular%20users%20sometimes%20get%0A%20stuck&In-Reply-To=%3C6bb1cbbd-226a-23fe-5922-78dbb14459b7%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012780.html">
   <LINK REL="Next"  HREF="012796.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] connections from particular users sometimes get stuck</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20connections%20from%20particular%20users%20sometimes%20get%0A%20stuck&In-Reply-To=%3C6bb1cbbd-226a-23fe-5922-78dbb14459b7%40treenet.co.nz%3E"
       TITLE="[squid-users] connections from particular users sometimes get stuck">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Sep 30 07:10:52 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012780.html">[squid-users] connections from particular users sometimes get stuck
</A></li>
        <LI>Next message (by thread): <A HREF="012796.html">[squid-users] connections from particular users sometimes get	stuck
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12783">[ date ]</a>
              <a href="thread.html#12783">[ thread ]</a>
              <a href="subject.html#12783">[ subject ]</a>
              <a href="author.html#12783">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 30/09/2016 7:38 p.m., Eugene M. Zheganin wrote:
&gt;<i> On 29.09.2016 23:17, Alex Rousskov wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In summary, your browser is probably stuck because Squid could not
</I>&gt;&gt;<i> accept a connection. Why did that accept call fail with ECONNABORTED? I
</I>&gt;&gt;<i> cannot say for sure -- the packet trace is rather dirty/misleading
</I>&gt;&gt;<i> (e.g., it shows the redirect packet being sent to the client _after_ the
</I>&gt;&gt;<i> client follows that redirect which does not make sense).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Any relevant errors in you system logs?
</I>&gt;<i> Nothing except
</I>&gt;<i> 
</I>&gt;<i> Limiting closed port RST response from 294 to 200 packets/sec
</I>&gt;<i> 
</I>&gt;<i> repeated by many times, which doesn't look related to this, because they
</I>&gt;<i> keep popping even when nobody's complaining. I've already did the
</I>&gt;<i> initial investigation and found no signs of resource starvation -
</I>&gt;<i> meaning no connection/files/mbufs/memory/pf states starvation happens.
</I>&gt;<i> At least I didn't find it. Plus, it would affect all of the clients
</I>&gt;<i> randomly, right ? Not this particular one.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If you cancel browser wait and repeat the request, will it work?
</I>&gt;<i> Sometimes, but this means like 3-5% percents. Most of the time
</I>&gt;<i> rerequests lead to the same timeout, Chrome shows the request is
</I>&gt;<i> &quot;pending&quot; in the developer's tools/network tab for dozens of seconds,
</I>&gt;<i> and so on.
</I>&gt;&gt;<i>  If this
</I>&gt;&gt;<i> was just a random accept failure, then it should work on the second try.
</I>&gt;&gt;<i> If it does not work again, then there is something more serious going on
</I>&gt;&gt;<i> (but you would need to collect more logs to study that).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The connection accepting code in Squid is in poor shape, but I do not
</I>&gt;&gt;<i> think those minor code problems affect this particular use case.
</I>&gt;&gt;<i>
</I>&gt;<i> I still have this machine in stuck state (I think), what should I focus on ?
</I>
I think the TCP packets, particularly the SYN and first few after that
between the client and Squid.
There may be some clues in the TCP features which they are trying to
negotiate for use. Or the timings relative to when Squid calls accept()
to receive the connection (TCP queues too big etc).

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012780.html">[squid-users] connections from particular users sometimes get stuck
</A></li>
	<LI>Next message (by thread): <A HREF="012796.html">[squid-users] connections from particular users sometimes get	stuck
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12783">[ date ]</a>
              <a href="thread.html#12783">[ thread ]</a>
              <a href="subject.html#12783">[ subject ]</a>
              <a href="author.html#12783">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
