<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] FW: squid tproxy ssl-bump and Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FW%3A%20squid%20tproxy%20ssl-bump%20and%20Protocol%20error%20%28TLS%0A%20code%3A%20SQUID_ERR_SSL_HANDSHAKE%29&In-Reply-To=%3Caf92d108-b205-decb-13c4-fecb7a554b5e%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012790.html">
   <LINK REL="Next"  HREF="012791.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] FW: squid tproxy ssl-bump and Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FW%3A%20squid%20tproxy%20ssl-bump%20and%20Protocol%20error%20%28TLS%0A%20code%3A%20SQUID_ERR_SSL_HANDSHAKE%29&In-Reply-To=%3Caf92d108-b205-decb-13c4-fecb7a554b5e%40gmail.com%3E"
       TITLE="[squid-users] FW: squid tproxy ssl-bump and Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)">yvoinov at gmail.com
       </A><BR>
    <I>Fri Sep 30 11:56:43 UTC 2016</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="012790.html">[squid-users] FW: squid tproxy ssl-bump and Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)
</A></li>
        <LI>Next message (by thread): <A HREF="012791.html">[squid-users] FW: squid tproxy ssl-bump and Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12792">[ date ]</a>
              <a href="thread.html#12792">[ thread ]</a>
              <a href="subject.html#12792">[ subject ]</a>
              <a href="author.html#12792">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256
 


30.09.2016 17:36, Vieri &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> ----- Original Message -----
</I>&gt;&gt;<i> From: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Squid mimics the client details when contacting the server. So you would
</I>&gt;<i>
</I>&gt;&gt;<i> get the same problem (though maybe different description) if going
</I>&gt;<i>
</I>&gt;&gt;<i> directly without the proxy.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> If I try connecting to <A HREF="https://www.google.com">https://www.google.com</A> with this client and
</I>going directly without proxy then I have no problem whatsoever. I'm sure
any Windows XP user still out there with IE8 can confirm that a direct
connection to <A HREF="https://www.google.com">https://www.google.com</A> still works fine. I hit the issue
only when using Squid.
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> So from the squid server I ran:
</I>&gt;<i>
</I>&gt;<i> # nmap --script ssl-enum-ciphers google.com
</I>&gt;<i> [...]
</I>&gt;<i> | ssl-enum-ciphers:
</I>&gt;<i> |   TLSv1.0:
</I>&gt;<i> |     ciphers:
</I>&gt;<i> |       TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA - strong
</I>&gt;<i> |       TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA - strong
</I>&gt;<i> |       TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA - strong
</I>&gt;<i> |       TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA - strong
</I>&gt;<i> |       TLS_RSA_WITH_3DES_EDE_CBC_SHA - strong
</I>&gt;<i> |       TLS_RSA_WITH_AES_128_CBC_SHA - strong
</I>&gt;<i> |       TLS_RSA_WITH_AES_256_CBC_SHA - strong
</I>&gt;<i> |     compressors:
</I>&gt;<i> |
</I>&gt;<i> |   TLSv1.1:
</I>&gt;<i> |     ciphers:
</I>&gt;<i> |       TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA - strong
</I>&gt;<i> |       TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA - strong
</I>&gt;<i> |       TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA - strong
</I>&gt;<i> |       TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA - strong
</I>&gt;<i> |       TLS_RSA_WITH_3DES_EDE_CBC_SHA - strong
</I>&gt;<i> |       TLS_RSA_WITH_AES_128_CBC_SHA - strong
</I>&gt;<i> |       TLS_RSA_WITH_AES_256_CBC_SHA - strong
</I>&gt;<i> |     compressors:
</I>&gt;<i> |
</I>&gt;<i> |   TLSv1.2:
</I>&gt;<i> |     ciphers:
</I>&gt;<i> |       TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA - strong
</I>&gt;<i> |       TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256 - strong
</I>&gt;<i> |       TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 - strong
</I>&gt;<i> |       TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA - strong
</I>&gt;<i> |       TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384 - strong
</I>&gt;<i> |       TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 - strong
</I>&gt;<i> |       TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256 - strong
</I>&gt;<i> |       TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA - strong
</I>&gt;<i> |       TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256 - strong
</I>&gt;<i> |       TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 - strong
</I>&gt;<i> |       TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA - strong
</I>&gt;<i> |       TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384 - strong
</I>&gt;<i> |       TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 - strong
</I>&gt;<i> |       TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 - strong
</I>&gt;<i> |       TLS_RSA_WITH_3DES_EDE_CBC_SHA - strong
</I>&gt;<i> |       TLS_RSA_WITH_AES_128_CBC_SHA - strong
</I>&gt;<i> |       TLS_RSA_WITH_AES_128_CBC_SHA256 - strong
</I>&gt;<i> |       TLS_RSA_WITH_AES_128_GCM_SHA256 - strong
</I>&gt;<i> |       TLS_RSA_WITH_AES_256_CBC_SHA - strong
</I>&gt;<i> |       TLS_RSA_WITH_AES_256_CBC_SHA256 - strong
</I>&gt;<i> |       TLS_RSA_WITH_AES_256_GCM_SHA384 - strong
</I>&gt;<i> |     compressors:
</I>&gt;<i> |
</I>&gt;<i> |_  least strength: strong
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> So if TLS 1.0 is supported by Google then the Windows XP clients
</I>should be able to connect.
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Can a cipher issue trigger the error message &quot;Handshake with SSL
</I>server failed: error:1409F07F:SSL routines:ssl3_write_pending:bad write
retry&quot;?
&gt;<i>
</I>&gt;<i> I ran:
</I>&gt;<i>
</I>&gt;<i> # openssl ciphers
</I>&gt;<i>
</I>ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:SRP-DSS-AES-256-CBC-SHA:SRP-RSA-AES-256-CBC-SHA:SRP-AES-256-CBC-SHA:DH-DSS-AES256-GCM-SHA384:DHE-DSS-AES256-GCM-SHA384:DH-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA256:DH-RSA-AES256-SHA256:DH-DSS-AES256-SHA256:DHE-RSA-AES256-SHA:DHE-DSS-AES256-SHA:DH-RSA-AES256-SHA:DH-DSS-AES256-SHA:DHE-RSA-CAMELLIA256-SHA:DHE-DSS-CAMELLIA256-SHA:DH-RSA-CAMELLIA256-SHA:DH-DSS-CAMELLIA256-SHA:ECDH-RSA-AES256-GCM-SHA384:ECDH-ECDSA-AES256-GCM-SHA384:ECDH-RSA-AES256-SHA384:ECDH-ECDSA-AES256-SHA384:ECDH-RSA-AES256-SHA:ECDH-ECDSA-AES256-SHA:AES256-GCM-SHA384:AES256-SHA256:AES256-SHA:CAMELLIA256-SHA:PSK-AES256-CBC-SHA:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:SRP-DSS-AES-128-CBC-SHA:SRP-RSA-AES-128-CBC-SHA:SRP-AES-128-CBC-SHA:DH-DSS-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:DH-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-SHA256:DHE-DSS-AES128-SHA256:DH-RSA-AES128-SHA256:DH-DSS-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA:DH-RSA-AES128-SHA:DH-DSS-AES128-SHA:DHE-RSA-SEED-SHA:DHE-DSS-SEED-SHA:DH-RSA-SEED-SHA:DH-DSS-SEED-SHA:DHE-RSA-CAMELLIA128-SHA:DHE-DSS-CAMELLIA128-SHA:DH-RSA-CAMELLIA128-SHA:DH-DSS-CAMELLIA128-SHA:ECDH-RSA-AES128-GCM-SHA256:ECDH-ECDSA-AES128-GCM-SHA256:ECDH-RSA-AES128-SHA256:ECDH-ECDSA-AES128-SHA256:ECDH-RSA-AES128-SHA:ECDH-ECDSA-AES128-SHA:AES128-GCM-SHA256:AES128-SHA256:AES128-SHA:SEED-SHA:CAMELLIA128-SHA:IDEA-CBC-SHA:PSK-AES128-CBC-SHA:KRB5-IDEA-CBC-SHA:KRB5-IDEA-CBC-MD5:ECDHE-RSA-RC4-SHA:ECDHE-ECDSA-RC4-SHA:ECDH-RSA-RC4-SHA:ECDH-ECDSA-RC4-SHA:RC4-SHA:RC4-MD5:PSK-RC4-SHA:KRB5-RC4-SHA:KRB5-RC4-MD5:ECDHE-RSA-DES-CBC3-SHA:ECDHE-ECDSA-DES-CBC3-SHA:SRP-DSS-3DES-EDE-CBC-SHA:SRP-RSA-3DES-EDE-CBC-SHA:SRP-3DES-EDE-CBC-SHA:EDH-RSA-DES-CBC3-SHA:EDH-DSS-DES-CBC3-SHA:DH-RSA-DES-CBC3-SHA:DH-DSS-DES-CBC3-SHA:ECDH-RSA-DES-CBC3-SHA:ECDH-ECDSA-DES-CBC3-SHA:DES-CBC3-SHA:PSK-3DES-EDE-CBC-SHA:KRB5-DES-CBC3-SHA:KRB5-DES-CBC3-MD5:EDH-RSA-DES-CBC-SHA:EDH-DSS-DES-CBC-SHA:DH-RSA-DES-CBC-SHA:DH-DSS-DES-CBC-SHA:DES-CBC-SHA:KRB5-DES-CBC-SHA:KRB5-DES-CBC-MD5
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> # openssl s_client -connect google.com:443 -tls1
</I>&gt;<i> [...]
</I>&gt;<i> SSL-Session:
</I>&gt;<i> Protocol  : TLSv1
</I>&gt;<i> Cipher    : ECDHE-RSA-AES128-SHA
</I>&gt;<i>
</I>&gt;<i> [...]
</I>&gt;<i>
</I>&gt;<i> I also tried the following on the Squid server:
</I>&gt;<i>
</I>&gt;<i> # curl --tlsv1.0 --trace trace.log <A HREF="https://www.google.com">https://www.google.com</A> &amp;&amp; grep &quot;SSL
</I>connection using&quot; trace.log[...]
&gt;<i> == Info: SSL connection using TLSv1.0 / ECDHE-RSA-AES128-SHA
</I>&gt;<i> [...]
</I>&gt;<i>
</I>&gt;<i> From the Windows XP IE8 client I connected to this web site to quickly
</I>see all the supported protocols and ciphers:
&gt;<i> <A HREF="https://www.ssllabs.com/ssltest/viewMyClient.html">https://www.ssllabs.com/ssltest/viewMyClient.html</A>
</I>&gt;<i> I can see TLS 1.0 support and the following cipher list:
</I>&gt;<i>
</I>&gt;<i> TLS_RSA_WITH_RC4_128_MD5 (0x4)   INSECURE 128
</I>&gt;<i> TLS_RSA_WITH_RC4_128_SHA (0x5)   INSECURE 128
</I>&gt;<i> TLS_RSA_WITH_3DES_EDE_CBC_SHA (0xa)  112
</I>&gt;<i> TLS_RSA_WITH_DES_CBC_SHA (0x9)   WEAK 56
</I>&gt;<i> TLS_RSA_EXPORT1024_WITH_RC4_56_SHA (0x64)   INSECURE 56
</I>&gt;<i> TLS_RSA_EXPORT1024_WITH_DES_CBC_SHA (0x62)   WEAK 56
</I>&gt;<i> TLS_RSA_EXPORT_WITH_RC4_40_MD5 (0x3)   INSECURE 40
</I>&gt;<i> TLS_RSA_EXPORT_WITH_RC2_CBC_40_MD5 (0x6)   INSECURE 40
</I>&gt;<i> TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA (0x13)   Forward Secrecy2  112
</I>&gt;<i> TLS_DHE_DSS_WITH_DES_CBC_SHA (0x12)   WEAK 56
</I>&gt;<i> TLS_DHE_DSS_EXPORT1024_WITH_DES_CBC_SHA (0x63)   WEAK 56
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On a Windows 7 IE8 client with no Squid proxy issues I can see the
</I>following list of ciphers:
&gt;<i>
</I>&gt;<i> TLS_RSA_WITH_AES_128_CBC_SHA256 (0x3c)  128
</I>&gt;<i> TLS_RSA_WITH_AES_128_CBC_SHA (0x2f)  128
</I>&gt;<i> TLS_RSA_WITH_AES_256_CBC_SHA256 (0x3d)  256
</I>&gt;<i> TLS_RSA_WITH_AES_256_CBC_SHA (0x35)  256
</I>&gt;<i> TLS_RSA_WITH_RC4_128_SHA (0x5)   INSECURE 128
</I>&gt;<i> TLS_RSA_WITH_3DES_EDE_CBC_SHA (0xa)  112
</I>&gt;<i> TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256 (0xc027)   Forward Secrecy  128
</I>&gt;<i> TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA (0xc013)   Forward Secrecy  128
</I>&gt;<i> TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA (0xc014)   Forward Secrecy  256
</I>&gt;<i> TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 (0xc02b)   Forward Secrecy  128
</I>&gt;<i> TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256 (0xc023)   Forward Secrecy  128
</I>&gt;<i> TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 (0xc02c)   Forward Secrecy  256
</I>&gt;<i> TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384 (0xc024)   Forward Secrecy  256
</I>&gt;<i> TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA (0xc009)   Forward Secrecy  128
</I>&gt;<i> TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA (0xc00a)   Forward Secrecy  256
</I>&gt;<i> TLS_DHE_DSS_WITH_AES_128_CBC_SHA256 (0x40)   Forward Secrecy2  128
</I>&gt;<i> TLS_DHE_DSS_WITH_AES_128_CBC_SHA (0x32)   Forward Secrecy2  128
</I>&gt;<i> TLS_DHE_DSS_WITH_AES_256_CBC_SHA256 (0x6a)   Forward Secrecy2  256
</I>&gt;<i> TLS_DHE_DSS_WITH_AES_256_CBC_SHA (0x38)   Forward Secrecy2  256
</I>&gt;<i> TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA (0x13)   Forward Secrecy2  112
</I>&gt;<i> TLS_RSA_WITH_RC4_128_MD5 (0x4)   INSECURE 128
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I suppose that the Windows XP client successfully connects to
</I><A HREF="https://www.google.com">https://www.google.com</A> because it uses TLS_RSA_WITH_3DES_EDE_CBC_SHA
(when NOT using Squid). Am I right? Is there a way I can confirm that?
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> So, back on the squid server I checked the openssl ciphers for one
</I>that is supported by the Windows XP system. I searched for the oepnssl
cipher name from the RFC cipher name at
<A HREF="https://testssl.sh/openssl-rfc.mappping.html.">https://testssl.sh/openssl-rfc.mappping.html.</A>
&gt;<i>
</I>&gt;<i> I found the following:
</I>&gt;<i> TLS_RSA_WITH_3DES_EDE_CBC_SHA = DES-CBC3-SHA
</I>&gt;<i> The other &quot;strong&quot; cipher supported by Windows XP seems to be:
</I>&gt;<i> TLS_DHE_DSS_WITH_3DES_EDE_CBC_SHA = EDH-DSS-DES-CBC3-SHA
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> # curl --tlsv1.0 --ciphers SRP-RSA-3DES-EDE-CBC-SHA --trace trace.log
</I><A HREF="https://www.google.com">https://www.google.com</A>
&gt;<i> curl: (35) error:140740B5:SSL routines:SSL23_CLIENT_HELLO:no ciphers
</I>available
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> So I tried these commands on the Squid server:
</I>&gt;<i>
</I>&gt;<i> # openssl s_client -connect google.com:443 -tls1 -cipher DES-CBC3-SHA
</I>&gt;<i> [...]
</I>&gt;<i> SSL-Session:
</I>&gt;<i> Protocol  : TLSv1
</I>&gt;<i> Cipher    : DES-CBC3-SHA
</I>&gt;<i>
</I>&gt;<i> [...]
</I>&gt;<i> (that went well)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> # openssl s_client -connect google.com:443 -tls1 -cipher
</I>EDH-DSS-DES-CBC3-SHA
&gt;<i>
</I>&gt;<i> CONNECTED(00000003)
</I>&gt;<i> 3072018108:error:14094410:SSL routines:ssl3_read_bytes:sslv3 alert
</I>handshake failure:s3_pkt.c:1472:SSL alert number 40
&gt;<i> 3072018108:error:1409E0E5:SSL routines:ssl3_write_bytes:ssl handshake
</I>failure:s3_pkt.c:656:
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> So this failed. Why?
</I>&gt;<i> Is google wrongly advertising the supported cipher (I doubt it)?
</I>&gt;<i>
</I>&gt;<i> I have OpenSSL 1.0.2d 9 Jul 2015 and Squid 3.5.14.
</I>&gt;<i>
</I>&gt;<i> How do I know if Squid is also trying to use the same cipher
</I>EDH-DSS-DES-CBC3-SHA instead of DES-CBC3-SHA?
&gt;<i>
</I>&gt;<i> I tried setting debug_options rotate=1 ALL,5 but found nothing related
</I>to the cipher in the log:
&gt;<i>
</I>&gt;<i> # tail -n 1000000 /var/log/squid/cache.log | grep &quot;10.215.144.47&quot; |
</I>grep -i cipher
&gt;<i>
</I>&gt;&gt;<i> To get around this you require the latest Squid version (with&gt;
</I>peek-and-splice feature) doing the &quot;bump&quot; action on these clients
&gt;<i>
</I>&gt;&gt;<i> traffic so that it can upgrade the TLS/SSL handshake and use some
</I>&gt;&gt;<i> ciphers etc the server will accept on their connections.
</I>&gt;<i>
</I>&gt;<i> I'm already using sslbump with squid 3.5. As posted in my first
</I>message I have:
&gt;<i> https_port 3130 tproxy ssl-bump generate-host-certificates=on
</I>dynamic_cert_mem_cache_size=16MB cert=/etc/ssl/squid/proxyserver.pem
&gt;<i>
</I>&gt;<i> How can I tell which TLS/cipher versions Squid is using? What exactly
</I>should I search for in the log?
&gt;<i>
</I>&gt;<i> I tried this while connecting from the Windows XP client:
</I>&gt;<i> # watch -n 1 &quot;tail -n 10000 /var/log/squid/cache.log | grep
</I>clientNegotiateSSL&quot;
&gt;<i> 2016/09/30 13:19:06.633 kid1| 83,2| client_side.cc(3796)
</I>clientNegotiateSSL: clientNegotiateSSL: New session 0x870088d8 on FD 151
(10.215.144.47:1649)
&gt;<i> 2016/09/30 13:19:06.633 kid1| 83,3| client_side.cc(3800)
</I>clientNegotiateSSL: clientNegotiateSSL: FD 151 negotiated cipher RC4-MD5
&gt;<i> 2016/09/30 13:19:06.633 kid1| 83,5| client_side.cc(3816)
</I>clientNegotiateSSL: clientNegotiateSSL: FD 151 has no certificate.
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Why is Squid negotiating cipher RC4-MD5 which is reported &quot;insecure&quot;
</I>and unsupported by the google web site?
Because your antique client request it. XP desupported years ago.
&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I finally tried this on the Squid server:
</I>&gt;<i>
</I>&gt;<i> # openssl s_client -connect google.com:443 -tls1 -cipher RC4-MD5
</I>&gt;<i> CONNECTED(00000003)
</I>&gt;<i> 3071960764:error:14094410:SSL routines:ssl3_read_bytes:sslv3 alert
</I>handshake failure:s3_pkt.c:1472:SSL alert number 40
&gt;<i> 3071960764:error:1409E0E5:SSL routines:ssl3_write_bytes:ssl handshake
</I>failure:s3_pkt.c:656:
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> If I watch the Squid log when performing a connection to google from a
</I>Windows 7 IE8 with no issues, I get this:
&gt;<i> 2016/09/30 13:30:55.266 kid1| 83,2| client_side.cc(3764)
</I>clientNegotiateSSL: clientNegotiateSSL: Session 0x8331ee98 reused on FD
40 (10.215.144.48:21962)
&gt;<i> 2016/09/30 13:30:55.266 kid1| 83,3| client_side.cc(3800)
</I>clientNegotiateSSL: clientNegotiateSSL: FD 40 negotiated cipher
AES256-GCM-SHA384
&gt;<i> 2016/09/30 13:30:55.267 kid1| 83,5| client_side.cc(3816)
</I>clientNegotiateSSL: clientNegotiateSSL: FD 40 has no certificate.
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Any more ideas?
</I>Throw out XP and IE8 and set up W7 as minimum with IE10. I see no other
way. I am afraid that in this case, the cactus is too large and inedible.
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Vieri
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
 
iQEcBAEBCAAGBQJX7lL7AAoJENNXIZxhPexGw5oIALIpfdV1EESJFy3h92PkKgSH
10/swwaKKzDT3mOcPVSAW6V4y6M8H9MGvR8oUHws1RnHrSsOcdwAoFrlKgRdHmvP
B51iuyrIas/QdOmjuCm5UFYE/ZxAqcMfcyyqC7Y9+ctyRClG16Kn8mdyxwDioqfq
Qv+NNP8X216t/7enO99oUam/Q3sBowfo/r2ZR2zbsTWiM9o7TQLl9rPOrhSsVu8M
K8/dmzGvk2J8KPJQBp5nZNvzt9+pyoulQwMywg7vlsoCUC7MCal/CzgcdW9jLGy8
pjLFV385VoS2CJCIx3ORDJE0NlUfaEzfu+/Ihwic2jZGQOSZVNcD2N+rjvSyarA=
=nXdM
-----END PGP SIGNATURE-----

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x613DEC46.asc
Type: application/pgp-keys
Size: 2437 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20160930/0671979f/attachment.key">http://lists.squid-cache.org/pipermail/squid-users/attachments/20160930/0671979f/attachment.key</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="012790.html">[squid-users] FW: squid tproxy ssl-bump and Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)
</A></li>
	<LI>Next message (by thread): <A HREF="012791.html">[squid-users] FW: squid tproxy ssl-bump and Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12792">[ date ]</a>
              <a href="thread.html#12792">[ thread ]</a>
              <a href="subject.html#12792">[ subject ]</a>
              <a href="author.html#12792">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
