<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid Authentication if URL is on a Blacklist	from SquidGuard
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20Authentication%20if%20URL%20is%20on%20a%20Blacklist%0A%09from%20SquidGuard&In-Reply-To=%3C1491378492676-4681995.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014879.html">
   <LINK REL="Next"  HREF="014893.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid Authentication if URL is on a Blacklist	from SquidGuard</H1>
    <B>CrossfireAUT</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20Authentication%20if%20URL%20is%20on%20a%20Blacklist%0A%09from%20SquidGuard&In-Reply-To=%3C1491378492676-4681995.post%40n4.nabble.com%3E"
       TITLE="[squid-users] Squid Authentication if URL is on a Blacklist	from SquidGuard">kevinmuehlparzer at hotmail.de
       </A><BR>
    <I>Wed Apr  5 07:48:12 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014879.html">[squid-users] Squid Authentication if URL is on a Blacklist from SquidGuard
</A></li>
        <LI>Next message (by thread): <A HREF="014893.html">[squid-users] Squid Authentication if URL is on a Blacklist from SquidGuard
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14884">[ date ]</a>
              <a href="thread.html#14884">[ thread ]</a>
              <a href="subject.html#14884">[ subject ]</a>
              <a href="author.html#14884">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>/If you have such a thing as AD and the ability to push Group Policy to
the users there is no need to avoid authentication./

I have a running AD on Ubuntu 16.04 with samba4.


/Perhapse the client is actually asking to get away from lots of annoying
popups the browsers are forcing on them? if that is happening it is a
strong sign that the authentication system needs fixing. When it works
there should be zero popups./

The client gets asked for his username/password everytime he closes &amp; opens
the browser, while surfing, there are no PopUps so the client can surf
undisturbed.
At first, my client wanted to authenticate everytime someone opens &amp; closes
the browser, now he wants to authenticate ONLY if someone calls up &quot;a bad
Website&quot;.



/Er, credentials are valid for 2 hours, but the &quot;users&quot; are jumping
around between IPs every second?
NP: the authenticate_ip_* stuff is irrelevant unless a maxuserip type
ACL is being used.
/

Thanks, the thing with &quot;authenticate_ip_ttl 1 second&quot; was my fallacy.



/Funky.
Have you check that is not simple the browser &quot;Password Manager&quot;
feature requesting access to their machine or AD &quot;Domain login&quot; details?/

Browsers with &quot;Password-Manager&quot;-Features can save the password, but only
fill in the saved username and password.
So you would have to press Enter in order to continue. If you don't use this
Feature, you will get asked everytime you close &amp; open the browser and have
to enter it yourself.


/
To use SG as requested you need to make an external_acl_type helper that
receives the same things SG needs and passes them on to it, mapping the
result back to an OK/ERR result for Squid ACL use.
 [ IIRC Eliezer has posted a helper that does that to the list . ]

Then you can do something like:
  external_acl_type sgMapper ...
  acl testWithSg external sgMapper

  http_access allow testWithSG
  http_access deny !auth
  ...

Note that this does not involve the url_rewrite_* API. You can drop that
entirely. Unless you want some traffic to still be redirected/rewritten
by SG. In which case you need url_rewrite_access to define which traffic
SG applies to./

I have to excuse myself, I'm still a beginner in the world of Squid.
Thanks for understanding.
You are right, I don't need to redirect to Blockpages anymore.
If the user authenticates because he called up a bad url, he should be
allowed to pass.

I don't understand that solution, why do I need to make that
external_acl_type helper?
Isn't it the same as my external_acl_type?

/external_acl_type webusers %LOGIN /usr/lib/squid/ext_ldap_group_acl -b
&quot;dc=xxxx,dc=local&quot; -D <A HREF="https://lists.squid-cache.org/listinfo/squid-users">testuser at xxxx.local</A> -W /etc/squid/squid.secrets -f
&quot;(&amp;(sAMAccountName=%v)(memberOf=cn=%a,cn=Users,dc=xxxx,dc=local))&quot; -h
172.30.0.36

acl ldapgroup_webusers external webusers webusers

http_access allow ldapgroup_webusers
/

My helper are working well:
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">xxxx at xxxx-testproxy01</A>:~# /usr/lib/squid/basic_ldap_auth -R -b
&quot;dc=xxxx,dc=local&quot; -D <A HREF="https://lists.squid-cache.org/listinfo/squid-users">testuser at xxxx.local</A> -W /etc/squid/squid.secrets -f
sAMAccountName=%s -h 172.30.0.36
testuser xxxx
OK

<A HREF="https://lists.squid-cache.org/listinfo/squid-users">xxxx at xxxx-testproxy01</A>:~# /usr/lib/squid/ext_ldap_group_acl -b
&quot;dc=xxxx,dc=local&quot; -D <A HREF="https://lists.squid-cache.org/listinfo/squid-users">testuser at xxxx.local</A> -W /etc/squid/squid.secrets -f
&quot;(&amp;(sAMAccountName=%v)(memberOf=cn=%a,cn=Users,dc=xxxx,dc=local))&quot; -h
172.30.0.36
testuser webusers
OK

How can I match the requested URL against the Blacklists without SquidGuard?
I still need to match it against the Blacklist, and then it has to get
decided if he needs to authenticate or not.

Thanks for answering!



--
View this message in context: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Authentication-if-URL-is-on-a-Blacklist-from-SquidGuard-tp4681950p4681995.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Authentication-if-URL-is-on-a-Blacklist-from-SquidGuard-tp4681950p4681995.html</A>
Sent from the Squid - Users mailing list archive at Nabble.com.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014879.html">[squid-users] Squid Authentication if URL is on a Blacklist from SquidGuard
</A></li>
	<LI>Next message (by thread): <A HREF="014893.html">[squid-users] Squid Authentication if URL is on a Blacklist from SquidGuard
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14884">[ date ]</a>
              <a href="thread.html#14884">[ thread ]</a>
              <a href="subject.html#14884">[ subject ]</a>
              <a href="author.html#14884">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
