<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] What squid should do with RFC non-compliant response header?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20What%20squid%20should%20do%20with%20RFC%20non-compliant%0A%20response%20header%3F&In-Reply-To=%3Cf0a8e957-80c2-881c-7bd4-8f4494e35756%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014887.html">
   <LINK REL="Next"  HREF="014898.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] What squid should do with RFC non-compliant response header?</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20What%20squid%20should%20do%20with%20RFC%20non-compliant%0A%20response%20header%3F&In-Reply-To=%3Cf0a8e957-80c2-881c-7bd4-8f4494e35756%40treenet.co.nz%3E"
       TITLE="[squid-users] What squid should do with RFC non-compliant response header?">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Apr  6 16:07:03 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014887.html">[squid-users] What squid should do with RFC non-compliant	response	header?
</A></li>
        <LI>Next message (by thread): <A HREF="014898.html">[squid-users] What squid should do with RFC non-compliant response header?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14894">[ date ]</a>
              <a href="thread.html#14894">[ thread ]</a>
              <a href="subject.html#14894">[ subject ]</a>
              <a href="author.html#14894">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 6/04/2017 7:32 a.m., Eliezer  Croitoru wrote:
&gt;<i> Thanks for the reponse.
</I>&gt;<i> Actually browsers ignore the header as a response header and do not show it at all.
</I>&gt;<i> (at least firefox)
</I>&gt;<i> Technically I would expect squid to pass it but it's might have the potential for a CVE in some casese.
</I>&gt;<i> 
</I>
There is actually a CVE problem &quot;HTTP request/response smuggling&quot; in all
cases of the type you described.

I dont know why you are asking for votes or opinions on this. Once the
message formatting has been violated there is exactly zero ways for
software to tell where that broken header ends. What any particular
person expects does not enter into it. Zero is zero.


All the rest of the bytes received from the sender may be part of that
single broken header.  That includes the ':' that you *assumed* was end
of header name, and CRLF bytes which would in real HTTP syntax normally
signify end of header and/or end of message. The header is not HTTP
syntax, therefore HTTP syntax no longer applies and the CRLF plus other
lines that look on the surface like HTTP syntax could all be part of its
middle.
 Thus the smuggling CVE applies to all cases where the headers are
invalid at the syntax/format level.

There are exactly two things that can be done by a proxy when this type
of error is encountered:

 1) what the RFC says to do (and should be expected from any HTTP proxy)
- deliver the client a 4xx for broken requests or 5xx for broken
responses. Terminating the connection when the error is sent.

or
  2) truncate the message at the CRLF before the garbage and drop all
other bytes received on that connection. Terminate the connection when
the HTTP transaction is &quot;completed&quot;.


Doing (2) might sound attractive in terms of getting something to the
user at any cost. But what the user actually sees is a range of bad
behaviour from incomplete web pages, to broken web applications, to
plain wrong responses coming back. With no indication of what is going
wrong.
 To give a clear idea of what is broken and where the problems is - the
best option for a proxy is (1). To do the same thing as a browser is
just creating harm.


FYI: The HTTP RFCs are based squarely in running code implementations
with decades of testing behind them now. Going against what is written
there is exactly the best way to cause yourself (and users) trouble and
pain when interacting with other HTTP software.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014887.html">[squid-users] What squid should do with RFC non-compliant	response	header?
</A></li>
	<LI>Next message (by thread): <A HREF="014898.html">[squid-users] What squid should do with RFC non-compliant response header?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14894">[ date ]</a>
              <a href="thread.html#14894">[ thread ]</a>
              <a href="subject.html#14894">[ subject ]</a>
              <a href="author.html#14894">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
