<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] General security and usage questions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20General%20security%20and%20usage%20questions&In-Reply-To=%3C481b6136-1160-7c57-aa03-904bdce383d5%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014906.html">
   <LINK REL="Next"  HREF="014948.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] General security and usage questions</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20General%20security%20and%20usage%20questions&In-Reply-To=%3C481b6136-1160-7c57-aa03-904bdce383d5%40treenet.co.nz%3E"
       TITLE="[squid-users] General security and usage questions">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Apr 11 02:52:20 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014906.html">[squid-users] General security and usage questions
</A></li>
        <LI>Next message (by thread): <A HREF="014948.html">[squid-users] General security and usage questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14927">[ date ]</a>
              <a href="thread.html#14927">[ thread ]</a>
              <a href="subject.html#14927">[ subject ]</a>
              <a href="author.html#14927">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 8/04/2017 1:01 a.m., j m wrote:
&gt;<i> I have a Ubuntu server set up that does various things in addition to
</I>&gt;<i> being a web proxy (squid 3.3.8) to use remotely over the internet.
</I>&gt;<i> This allows me to directly access internal devices with a web page on
</I>&gt;<i> my LAN since my employer, like most, blocks VPN connections.
</I>
Please upgrade to a current Ubuntu (Xenial or later) - that will give
you access to a much better version of Squid.


&gt;<i>  My
</I>&gt;<i> intention is to have the squid service running at all times, with a
</I>&gt;<i> login, so I can use it any time.  However, there's a few things I
</I>&gt;<i> have not been able to answer/resolve through my own research:
</I>
&gt;<i> 1. I am
</I>&gt;<i> not able to SSH into my server from my employer.  It's rare I'd need
</I>&gt;<i> to do this, but ethical considerations aside, could this work with
</I>&gt;<i> PuTTY over the squid proxy?  I'm confused over how or if this would
</I>&gt;<i> work using the Connection -&gt; Proxy config in PuTTY.  I can
</I>&gt;<i> successfully use my proxy from a web browser, but have had no luck
</I>&gt;<i> with SSH despite entering the proxy info into PuTTY.  Supposedly the
</I>&gt;<i> proxy needs to support the CONNECT method, but I'm unclear what this
</I>&gt;<i> is or how to enable this.  As an aside, I have experimented with
</I>&gt;<i> shellinabox, but abandoned it when I learned it's not encrypted by
</I>&gt;<i> default.
</I>
PuTTY should be doable. You just have to configure it to use an HTTP proxy.

Then you have to configure your squid.conf to allow those requests. You
do that by:

 1) adding port 22 to the SSL_Ports and Safe_ports ACLs.

 2) adding extra custom rules to permit CONNECT to port 22 from the
IP(s) your PuTTY connections will be coming from.

 3) explicitly deny all other port 22 connections since the default
securuty lines no longer do that for you.

PuTTY should now be able to go through the proxy to wherever, the rest
is up to the server permissions at the destination.

I highly recommend that you use client cert verification and good cert
crypto rather than user:pass login - the login method would be visible
across the whole Internet to (and from) the proxy.


&gt;<i> 
</I>&gt;<i> 2. How good is squid's security as far as leaving its port open to
</I>&gt;<i> the Internet, which I obviously have to do in my case?
</I>
Depends on what you are meaning by &quot;security&quot;.

Squid can be used as a relay to reach anywhere your http_access rules
permit. That is why the very first things we do is close off ports
0-1024 tight as possible.

So treat it as being an open hole in your network firewall to *any*
machines port 22.



&gt;<i>  I found it
</I>&gt;<i> interesting that if I enter <A HREF="http://myip:myport">http://myip:myport</A> from over the
</I>&gt;<i> Internet, it responds with a &quot;The requested URL could not be
</I>&gt;<i> retrieved&quot; page, along with information that identifies it as squid,
</I>&gt;<i> along with the version number and server name, without asking for a
</I>&gt;<i> login. Being unfamiliar with web proxies, this might be the norm for
</I>&gt;<i> all I know.  If I set up a browser to use it as a proxy, it does ask
</I>&gt;<i> for a login.  It appears the error pages are in
</I>&gt;<i> /usr/share/squid/errors, but is there a way for it to be more
</I>&gt;<i> discrete, preferably to not respond at all or ask for a login? Below
</I>&gt;<i> is my squid.conf.  I removed all the commented lines, and pieced one
</I>&gt;<i> together from information online.  My goal is to have it proxy
</I>&gt;<i> basically anything thrown at it if authenticated,
</I>
That is not possible. As my most frequent comment says &quot;Squid is an HTTP
proxy&quot;.

Meaning it only proxies/relays the protocols it understands - primary
HTTP, nowdays also FTP. Nothing else.

Any other protocol must use an HTTP CONNECT request to get through
reliably, and that depend on the sending software being aware of the
proxy being an HTTP one. Which is why the default behaviour is to
respond with an HTTP error page - so smart senders can use that info to
switch to HTTP.


&gt;<i> be as secure as
</I>&gt;<i> reasonably possible,
</I>
FYI: Proxying anything and being secure are opposites. You only get to
pick one.


&gt;<i> absolutely no caching, and enable SSH
</I>&gt;<i> connections through it, if possible. Thanks in advance. auth_param
</I>&gt;<i> basic program /usr/lib/squid3/basic_ncsa_auth
</I>&gt;<i> /etc/squid3/passwordsauth_param basic realm proxyacl authenticated
</I>&gt;<i> proxy_auth REQUIREDhttp_access allow authenticated # Choose the port
</I>&gt;<i> you want. Below we set it to default 3128.http_port 8092cache deny
</I>&gt;<i> allaccess_log none acl CONNECT method CONNECT
</I>&gt;<i> 
</I>
Please use at minimum the config file lines shown here for your current
Squid version:
 &lt;<A HREF="http://wiki.squid-cache.org/Squid-3.3">http://wiki.squid-cache.org/Squid-3.3</A>&gt;
(or if you upgrade the relevant wiki page for that series)

Your own customisations should be added to those, not replacing.

NP: while debugging this new configuration it is a good idea to
re-enable the access.log outputs so you can see what is actually going
on. There is no way to decide if something is actually correct if you
cannot see it happening.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014906.html">[squid-users] General security and usage questions
</A></li>
	<LI>Next message (by thread): <A HREF="014948.html">[squid-users] General security and usage questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14927">[ date ]</a>
              <a href="thread.html#14927">[ thread ]</a>
              <a href="subject.html#14927">[ subject ]</a>
              <a href="author.html#14927">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
