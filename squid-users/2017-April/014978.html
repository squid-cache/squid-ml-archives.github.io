<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] [RFC] Changes to http_access defaults
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5BRFC%5D%20Changes%20to%20http_access%20defaults&In-Reply-To=%3Ca027e213-30e6-9c95-09c1-b314d3d02a9d%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014966.html">
   <LINK REL="Next"  HREF="014964.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] [RFC] Changes to http_access defaults</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5BRFC%5D%20Changes%20to%20http_access%20defaults&In-Reply-To=%3Ca027e213-30e6-9c95-09c1-b314d3d02a9d%40measurement-factory.com%3E"
       TITLE="[squid-users] [RFC] Changes to http_access defaults">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Apr 14 15:47:57 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014966.html">[squid-users] [squid-dev] [RFC] Changes to http_access defaults
</A></li>
        <LI>Next message (by thread): <A HREF="014964.html">[squid-users] [squid-dev] [RFC] Changes to http_access defaults
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14978">[ date ]</a>
              <a href="thread.html#14978">[ thread ]</a>
              <a href="subject.html#14978">[ subject ]</a>
              <a href="author.html#14978">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 04/14/2017 06:22 AM, Amos Jeffries wrote:

&gt;<i> To override the propsed default you *add* ports to the Safe_ports and
</I>&gt;<i> CONNECT_ports (ala SSL_Ports) lines to make them no longer be denied.
</I>
&gt;<i>  acl Safe_ports port 0-65535
</I>&gt;<i>  acl SSL_Ports port 0-65535
</I>
Thank you for sharing this important detail! I like this clever design
and agree that this approach allows admins to overwrite the proposed
default behavior/functionality.

This approach carries the following overwriting price:

* For every access, Squid will pointlessly evaluate the following:
  http_access deny !all_ports
  http_access deny CONNECT !all_ports

Is this an acceptable price to pay?

(The evaluation is pointless because the rules never match (because
all_ports always matches). In this context, the admin wants the rules to
never match, so that she can insert her own rules overwriting the
default. So the functionality is correct, but the default rules cannot
be removed and are evaluated.)

We could add a rule optimizer that will detect and remove some
never-matching rules, including the above ones. If the overwriting price
is too high, adding such an optimizer may become a precondition. The
optimizing logic is straightforward, but things like deny_info will
complicate implementation.

All other alternatives proposed so far do not have this performance penalty.


&gt;<i> I've have two goals here:
</I>&gt;<i> 
</I>&gt;<i> 1) reduce peoples ability to shoot themselves in the foot.
</I>&gt;<i> 2) further reduce the things people are required to manually configure
</I>
All three proposed options satisfy #1.

All three proposed options satisfy #2 if &quot;manual configuration&quot; is
defined as editing squid.conf.default. The lint option does not satisfy
#2 if &quot;manual configuration&quot; is defined as editing squid.conf.empty. How
should we define &quot;manual configuration&quot; in this context so that we can
compare options using a common set of criteria?


&gt;<i> I expect [squid.conf.default to look like this]:
</I>
&gt;<i>   http_access allow localhost manager
</I>&gt;<i>   http_access deny manager
</I>&gt;<i> 
</I>&gt;<i>   # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
</I>&gt;<i> 
</I>&gt;<i>   http_access allow localnet
</I>&gt;<i>   http_access allow localhost
</I>&gt;<i>   http_access deny all
</I>
I think the proposal would be a lot more attractive if it results in
elimination of all of the http_access rules from squid.conf.default. As
it currently stands, the changes imply many headaches, but still do not
solve the &quot;reasonable default access restrictions&quot; problem. In other
words, we are already paying a lot but still gaining little.

What if we raise the bar and declare reaching the &quot;reasonable default
access restrictions&quot; as the goal? Can we solve that problem instead,
with comparable headache severity of the original proposal?

For example, Squid could automatically add something like the following:

  # always added at the top of user-configured http_access rules
  http_access deny usuallyDenied
  http_access allow manager

  # always added at the bottom of user-configured http_access rules
  http_access allow usuallyAllowed
  http_access deny all

And remove all of the http_access rules from squid.conf.default.

The admin will be able to adjust usuallyDenied, usuallyAllowed, and
manager any-of ACLs to effectively disable them (just like in your
proposal). And we can add an optimizer to remove effectively disabled ACLs.


&gt;<i> the proposed rename of SSL_ports to CONNECT_ports
</I>
Let's discuss the exact ACL names later (when/if there is a principle
agreement to implement the proposed changes). For now, I will only note
that we should not use ACL names that might clash with those used by
existing configurations (for hopefully obvious reasons).


Thank you,

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014966.html">[squid-users] [squid-dev] [RFC] Changes to http_access defaults
</A></li>
	<LI>Next message (by thread): <A HREF="014964.html">[squid-users] [squid-dev] [RFC] Changes to http_access defaults
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14978">[ date ]</a>
              <a href="thread.html#14978">[ thread ]</a>
              <a href="subject.html#14978">[ subject ]</a>
              <a href="author.html#14978">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
