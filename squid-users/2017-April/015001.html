<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] HTTPS woes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20HTTPS%20woes&In-Reply-To=%3C72028742.2640554.1492519597289%40mail.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014985.html">
   <LINK REL="Next"  HREF="015002.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] HTTPS woes</H1>
    <B>Olly Lennox</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20HTTPS%20woes&In-Reply-To=%3C72028742.2640554.1492519597289%40mail.yahoo.com%3E"
       TITLE="[squid-users] HTTPS woes">oliver at lennox-it.uk
       </A><BR>
    <I>Tue Apr 18 12:46:37 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014985.html">[squid-users] HTTPS woes
</A></li>
        <LI>Next message (by thread): <A HREF="015002.html">[squid-users] HTTPS woes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15001">[ date ]</a>
              <a href="thread.html#15001">[ thread ]</a>
              <a href="subject.html#15001">[ subject ]</a>
              <a href="author.html#15001">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi All,

Still having problems here. This is my https config now:


---------------------------------https_port 3129 intercept ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB cert=/etc/squid3/ssl_cert/squid.crt key=/etc/squid3/ssl_cert/squid.key options=NO_SSLv3 dhparams=/etc/squid3/ssl_cert/dhparam.pem

acl step1 at_step SslBump1
ssl_bump peek step1
ssl_bump bump all 
sslproxy_options NO_SSLv2,NO_SSLv3,SINGLE_DH_USE
sslproxy_cipher EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH+aRSA+RC4:EECDH:EDH+aRSA:!RC4:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS

sslcrtd_program /usr/lib/squid3/ssl_crtd -s /var/lib/ssl_db -M 4MB
sslcrtd_children 8 startup=1 idle=1

--------------------------------- 


I'm running version 3.5.23 with openssl 1.0. I've had to disable libecap because I couldn't build 3.5 with ecap enabled. I'm getting the following error when trying to connect with SSL:

---------------------------------

The following error was encountered while trying to retrieve the URL: <A HREF="https://www.google.co.uk/*">https://www.google.co.uk/*</A> 

Failed to establish a secure connection to 216.58.198.67 

The system returned: 

(71) Protocol error (TLS code: X509_V_ERR_UNABLE_TO_GET_ISSUER_CERT_LOCALLY) 
SSL Certficate error: certificate issuer (CA) not known: /C=US/O=Equifax/OU=Equifax Secure Certificate Authority 

This proxy and the remote host failed to negotiate a mutually acceptable security settings for handling your request. It is possible that the remote host does not support secure connections, or the proxy is not satisfied with the host security credentials. 

Your cache administrator is webmaster. 

Generated Tue, 18 Apr 2017 12:23:40 GMT by raspberrypi (squid/3.5.23)
---------------------------------

The CA is always listed as not known not matter what site I try I always get this error.

Any ideas?

Thanks,

Olly

________________________________
From: Olly Lennox &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">oliver at lennox-it.uk</A>&gt;
To: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;; &quot;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt; 
Sent: Sunday, 16 April 2017, 9:31
Subject: Re: [squid-users] HTTPS woes



Thanks Amos, it's finally built but I had to disabled ecap, for whatever reason this kept failing (with version 1.0.1 installed). It failed on a reference to the Area function I think but I don't have the error message copied. I'm trying now to configure the ssl stare/peek and will let you know how it goes.

Olly
 
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">oliver at lennox-it.uk</A>
lennox-it.uk
tel: 07900 648 252



________________________________
From: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> 
Sent: Saturday, 15 April 2017, 23:07
Subject: Re: [squid-users] HTTPS woes



On 15/04/2017 9:59 a.m., Olly Lennox wrote:
&gt;<i> Hi Guys.
</I>&gt;<i> I'm still struggling with this. I'm trying to build a version of 3.5 but I just can't get it to work. I'm currently attempting to rebuild the stretch package with SSL enabled but build keeps failing with the following:
</I>&gt;<i> ../../src/ssl/gadgets.h:83:45: error: &#226;CRYPTO_LOCK_X509&#226; was not declared in this scope typedef LockingPointer&lt;X509, X509_free_cpp, CRYPTO_LOCK_X509&gt; X509_Pointer;                                             ^~~~~~~~~~~~~~~~../../src/ssl/gadgets.h:83:61: error: template argument 3 is invalid typedef LockingPointer&lt;X509, X509_free_cpp, CRYPTO_LOCK_X509&gt; X509_Pointer;                                                             ^../../src/ssl/gadgets.h:89:53: error: &#226;CRYPTO_LOCK_EVP_PKEY&#226; was not declared in this scope typedef LockingPointer&lt;EVP_PKEY, EVP_PKEY_free_cpp, CRYPTO_LOCK_EVP_PKEY&gt; EVP_PKEY_Pointer;                                                     ^~~~~~~~~~~~~~~~~~~~../../src/ssl/gadgets.h:89:73: error: template argument 3 is invalid typedef LockingPointer&lt;EVP_PKEY, EVP_PKEY_free_cpp, CRYPTO_LOCK_EVP_PKEY&gt; EVP_PKEY_Pointer;                                                                         ^../../src/ssl/gadgets.h:116:43: error: &#226;CRYPTO_LOCK_SSL&#226; was not declared in this scope typedef LockingPointer&lt;SSL, SSL_free_cpp, CRYPTO_LOCK_SSL&gt; SSL_Pointer;                                           ^~~~~~~~~~~~~~~../../src/ssl/gadgets.h:116:58: error: template argument 3 is invalid typedef LockingPointer&lt;SSL, SSL_free_cpp, CRYPTO_LOCK_SSL&gt; SSL_Pointer;                                                          ^
</I>&gt;<i> Any ideas?
</I>


On Jesse/stable:

apt-get build-dep squid3
apt-get install libss-dev


On stretch/testing/unstable:

apt-get build-dep squid
apt-get install libss1.0-dev


That should do it for you.

Amos


_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>



_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014985.html">[squid-users] HTTPS woes
</A></li>
	<LI>Next message (by thread): <A HREF="015002.html">[squid-users] HTTPS woes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15001">[ date ]</a>
              <a href="thread.html#15001">[ thread ]</a>
              <a href="subject.html#15001">[ subject ]</a>
              <a href="author.html#15001">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
