<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] HTTPS woes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20HTTPS%20woes&In-Reply-To=%3Ccad1fc14-3f0e-3eb0-7ae2-523f7b552506%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015003.html">
   <LINK REL="Next"  HREF="015005.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] HTTPS woes</H1>
    <B>Yuri</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20HTTPS%20woes&In-Reply-To=%3Ccad1fc14-3f0e-3eb0-7ae2-523f7b552506%40gmail.com%3E"
       TITLE="[squid-users] HTTPS woes">yvoinov at gmail.com
       </A><BR>
    <I>Tue Apr 18 13:03:19 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015003.html">[squid-users] HTTPS woes
</A></li>
        <LI>Next message (by thread): <A HREF="015005.html">[squid-users] HTTPS woes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15004">[ date ]</a>
              <a href="thread.html#15004">[ thread ]</a>
              <a href="subject.html#15004">[ subject ]</a>
              <a href="author.html#15004">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

18.04.2017 18:56, Olly Lennox &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> I'm using
</I>&gt;<i>
</I>&gt;<i> sslproxy_foreign_intermediate_certs
</I>&gt;<i>
</I>&gt;<i> Is this the same thing?
</I>No. You firstly required CA roots available for squid. CA roots and 
intermediate is the different things.
&gt;<i>
</I>&gt;<i> Also is there anywhere to get a bundle of all the major CA intermdiate 
</I>&gt;<i> certs or do you have to download them all manually?
</I>No. You should build it by yourself.
&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">oliver at lennox-it.uk</A>
</I>&gt;<i> lennox-it.uk &lt;<A HREF="http://lennox-it.uk/">http://lennox-it.uk/</A>&gt;
</I>&gt;<i> tel: 07900 648 252
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------------------------------------------------
</I>&gt;<i> *From:* Yuri &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A>&gt;
</I>&gt;<i> *To:* <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> *Sent:* Tuesday, 18 April 2017, 13:51
</I>&gt;<i> *Subject:* Re: [squid-users] HTTPS woes
</I>&gt;<i>
</I>&gt;<i> Try to specify roots CA bundle/dir explicity by specifying one of this
</I>&gt;<i> params:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> #  TAG: sslproxy_cafile
</I>&gt;<i> #    file containing CA certificates to use when verifying server
</I>&gt;<i> #    certificates while proxying <A HREF="https://">https://</A> URLs
</I>&gt;<i> #Default:
</I>&gt;<i> # none
</I>&gt;<i>
</I>&gt;<i> #  TAG: sslproxy_capath
</I>&gt;<i> #    directory containing CA certificates to use when verifying
</I>&gt;<i> #    server certificates while proxying <A HREF="https://">https://</A> URLs
</I>&gt;<i> #Default:
</I>&gt;<i> # none
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 18.04.2017 18:46, Olly Lennox &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;<i> &gt; Hi All,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Still having problems here. This is my https config now:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ---------------------------------https_port 3129 intercept ssl-bump 
</I>&gt;<i> generate-host-certificates=on dynamic_cert_mem_cache_size=4MB 
</I>&gt;<i> cert=/etc/squid3/ssl_cert/squid.crt key=/etc/squid3/ssl_cert/squid.key 
</I>&gt;<i> options=NO_SSLv3 dhparams=/etc/squid3/ssl_cert/dhparam.pem
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; acl step1 at_step SslBump1
</I>&gt;<i> &gt; ssl_bump peek step1
</I>&gt;<i> &gt; ssl_bump bump all
</I>&gt;<i> &gt; sslproxy_options NO_SSLv2,NO_SSLv3,SINGLE_DH_USE
</I>&gt;<i> &gt; sslproxy_cipher 
</I>&gt;<i> EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH+aRSA+RC4:EECDH:EDH+aRSA:!RC4:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; sslcrtd_program /usr/lib/squid3/ssl_crtd -s /var/lib/ssl_db -M 4MB
</I>&gt;<i> &gt; sslcrtd_children 8 startup=1 idle=1
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ---------------------------------
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I'm running version 3.5.23 with openssl 1.0. I've had to disable 
</I>&gt;<i> libecap because I couldn't build 3.5 with ecap enabled. I'm getting 
</I>&gt;<i> the following error when trying to connect with SSL:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ---------------------------------
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The following error was encountered while trying to retrieve the 
</I>&gt;<i> URL: <A HREF="https://www.google.co.uk/*">https://www.google.co.uk/*</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Failed to establish a secure connection to 216.58.198.67
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The system returned:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; (71) Protocol error (TLS code: 
</I>&gt;<i> X509_V_ERR_UNABLE_TO_GET_ISSUER_CERT_LOCALLY)
</I>&gt;<i> &gt; SSL Certficate error: certificate issuer (CA) not known: 
</I>&gt;<i> /C=US/O=Equifax/OU=Equifax Secure Certificate Authority
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This proxy and the remote host failed to negotiate a mutually 
</I>&gt;<i> acceptable security settings for handling your request. It is possible 
</I>&gt;<i> that the remote host does not support secure connections, or the proxy 
</I>&gt;<i> is not satisfied with the host security credentials.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Your cache administrator is webmaster.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Generated Tue, 18 Apr 2017 12:23:40 GMT by raspberrypi (squid/3.5.23)
</I>&gt;<i> &gt; ---------------------------------
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The CA is always listed as not known not matter what site I try I 
</I>&gt;<i> always get this error.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Any ideas?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thanks,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Olly
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ________________________________
</I>&gt;<i> &gt; From: Olly Lennox &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">oliver at lennox-it.uk</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">oliver at lennox-it.uk</A>&gt;&gt;
</I>&gt;<i> &gt; To: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A> 
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;&gt;; &quot;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> 
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;&quot; 
</I>&gt;<i> &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> 
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;&gt;
</I>&gt;<i> &gt; Sent: Sunday, 16 April 2017, 9:31
</I>&gt;<i> &gt; Subject: Re: [squid-users] HTTPS woes
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thanks Amos, it's finally built but I had to disabled ecap, for 
</I>&gt;<i> whatever reason this kept failing (with version 1.0.1 installed). It 
</I>&gt;<i> failed on a reference to the Area function I think but I don't have 
</I>&gt;<i> the error message copied. I'm trying now to configure the ssl 
</I>&gt;<i> stare/peek and will let you know how it goes.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Olly
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">oliver at lennox-it.uk</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">oliver at lennox-it.uk</A>&gt;
</I>&gt;<i> &gt; lennox-it.uk
</I>&gt;<i> &gt; tel: 07900 648 252
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ________________________________
</I>&gt;<i> &gt; From: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;&gt;
</I>&gt;<i> &gt; To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> 
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i> &gt; Sent: Saturday, 15 April 2017, 23:07
</I>&gt;<i> &gt; Subject: Re: [squid-users] HTTPS woes
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On 15/04/2017 9:59 a.m., Olly Lennox wrote:
</I>&gt;<i> &gt;&gt; Hi Guys.
</I>&gt;<i> &gt;&gt; I'm still struggling with this. I'm trying to build a version of 
</I>&gt;<i> 3.5 but I just can't get it to work. I'm currently attempting to 
</I>&gt;<i> rebuild the stretch package with SSL enabled but build keeps failing 
</I>&gt;<i> with the following:
</I>&gt;<i> &gt;&gt; ../../src/ssl/gadgets.h:83:45: error: &#226;CRYPTO_LOCK_X509&#226; was not 
</I>&gt;<i> declared in this scope typedef LockingPointer&lt;X509, X509_free_cpp, 
</I>&gt;<i> CRYPTO_LOCK_X509&gt; X509_Pointer; 
</I>&gt;<i> ^~~~~~~~~~~~~~~~../../src/ssl/gadgets.h:83:61: error: template 
</I>&gt;<i> argument 3 is invalid typedef LockingPointer&lt;X509, X509_free_cpp, 
</I>&gt;<i> CRYPTO_LOCK_X509&gt; X509_Pointer; ^../../src/ssl/gadgets.h:89:53: error: 
</I>&gt;<i> &#226;CRYPTO_LOCK_EVP_PKEY&#226; was not declared in this scope typedef 
</I>&gt;<i> LockingPointer&lt;EVP_PKEY, EVP_PKEY_free_cpp, CRYPTO_LOCK_EVP_PKEY&gt; 
</I>&gt;<i> EVP_PKEY_Pointer; ^~~~~~~~~~~~~~~~~~~~../../src/ssl/gadgets.h:89:73: 
</I>&gt;<i> error: template argument 3 is invalid typedef LockingPointer&lt;EVP_PKEY, 
</I>&gt;<i> EVP_PKEY_free_cpp, CRYPTO_LOCK_EVP_PKEY&gt; EVP_PKEY_Pointer;       
</I>&gt;<i> ^../../src/ssl/gadgets.h:116:43: error: &#226;CRYPTO_LOCK_SSL&#226; was not 
</I>&gt;<i> declared in this scope typedef LockingPointer&lt;SSL, SSL_free_cpp, 
</I>&gt;<i> CRYPTO_LOCK_SSL&gt; SSL_Pointer; 
</I>&gt;<i> ^~~~~~~~~~~~~~~../../src/ssl/gadgets.h:116:58: error: template 
</I>&gt;<i> argument 3 is invalid typedef LockingPointer&lt;SSL, SSL_free_cpp, 
</I>&gt;<i> CRYPTO_LOCK_SSL&gt; SSL_Pointer;                                     ^
</I>&gt;<i> &gt;&gt; Any ideas?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On Jesse/stable:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; apt-get build-dep squid3
</I>&gt;<i> &gt; apt-get install libss-dev
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On stretch/testing/unstable:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; apt-get build-dep squid
</I>&gt;<i> &gt; apt-get install libss1.0-dev
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; That should do it for you.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Amos
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; squid-users mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> 
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i> &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; squid-users mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> 
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i> &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; squid-users mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> 
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i> &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> 
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170418/6759453c/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170418/6759453c/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015003.html">[squid-users] HTTPS woes
</A></li>
	<LI>Next message (by thread): <A HREF="015005.html">[squid-users] HTTPS woes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15004">[ date ]</a>
              <a href="thread.html#15004">[ thread ]</a>
              <a href="subject.html#15004">[ subject ]</a>
              <a href="author.html#15004">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
