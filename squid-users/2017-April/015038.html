<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid stopped working after cache.log and access.log rotation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20stopped%20working%20after%20cache.log%20and%0A%20access.log%20rotation&In-Reply-To=%3CCAMyAatDNZ2H8R56y50yr%2Br7bnekH3knLMegfE_cYQ0pwzOHW0g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015037.html">
   <LINK REL="Next"  HREF="015039.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid stopped working after cache.log and access.log rotation</H1>
    <B>Chee M Gui</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20stopped%20working%20after%20cache.log%20and%0A%20access.log%20rotation&In-Reply-To=%3CCAMyAatDNZ2H8R56y50yr%2Br7bnekH3knLMegfE_cYQ0pwzOHW0g%40mail.gmail.com%3E"
       TITLE="[squid-users] Squid stopped working after cache.log and access.log rotation">cheemeng at function.com
       </A><BR>
    <I>Thu Apr 20 21:54:03 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015037.html">[squid-users] Squid stopped working after cache.log and access.log rotation
</A></li>
        <LI>Next message (by thread): <A HREF="015039.html">[squid-users] Can squid work as http response parse  only ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15038">[ date ]</a>
              <a href="thread.html#15038">[ thread ]</a>
              <a href="subject.html#15038">[ subject ]</a>
              <a href="author.html#15038">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Some more info:


cache.log is able to rotate.
Only access.log not rotating

<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at paproxy</A>:/# ls -alt /var/log/squid
total 15540
drwxrwxr-x 9 root  syslog     4096 Apr 20 14:42 ..
drwxr-xr-x 2 proxy proxy      4096 Apr 20 06:25 .
-rw-r----- 1 proxy proxy        63 Apr 20 06:25 cache.log
-rw-r----- 1 proxy proxy        63 Apr 19 06:25 cache.log.1
-rw-r----- 1 proxy proxy        83 Apr 18 06:25 cache.log.2.gz
-rw-r----- 1 proxy proxy        63 Mar 19 06:25 cache.log.2
-rw-r----- 1 proxy proxy  15759111 Mar 17 06:24 access.log.1
-rw-r----- 1 proxy proxy    117223 Mar 17 05:52 netdb.state
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at paproxy</A>:/#


We installed squid on 3/15/2017/



<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at paproxy</A>:/etc/logrotate.d# date +%s
1492724638
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at paproxy</A>:/etc/logrotate.d# more /var/log/squid/access.log.1
1489614186.653      6 192.168.5.103 TCP_MISS/503 3992 GET
<A HREF="http://ipv6.msftncsi.com/ncsi.txt">http://ipv6.msftncsi.com/ncsi.txt</A> - HIER_DIRECT/2001:5a8:100::b817:9fae
text/html
1489614186.668     21 192.168.5.103 TCP_MISS/200 280 GET
<A HREF="http://www.msftncsi.com/ncsi.txt">http://www.msftncsi.com/ncsi.txt</A> - HIER_DIRECT/184.23.159.169 text/plain
1489614186.997    214 192.168.5.103 TCP_MISS/200 617 GET
<A HREF="http://login.live.com/ppcrlcheck.srf">http://login.live.com/ppcrlcheck.srf</A> - HIER_DIRECT/131.253.61.66 text/htm
l



1489757088.048  10750 192.168.5.103 TCP_TUNNEL/200 5454 CONNECT
p.ebdr2.com:443 - HIER_DIRECT/74.217.250.5 -
1489757099.057  10783 192.168.5.103 TCP_TUNNEL/200 5454 CONNECT
p.ebdr2.com:443 - HIER_DIRECT/74.217.250.5 -


First entry in the access.log.1 file
<A HREF="https://www.epochconverter.com/">https://www.epochconverter.com/</A>
GMT: Wed, 15 Mar 2017 21:43:06 GMT
Your time zone: 3/15/2017, 2:43:06 PM GMT-7:00 DST

Last entry in the access.log.1 file
GMT: Fri, 17 Mar 2017 13:24:59 GMT
Your time zone: 3/17/2017, 6:24:59 AM GMT-7:00 DST


Squid was installed on 3/15/2017 on the server.


<A HREF="https://bugs.launchpad.net/ubuntu/+source/squid-deb-proxy/+bug/1544719">https://bugs.launchpad.net/ubuntu/+source/squid-deb-proxy/+bug/1544719</A>

<A HREF="https://bugs.launchpad.net/ubuntu/+source/logrotate/+bug/1414754">https://bugs.launchpad.net/ubuntu/+source/logrotate/+bug/1414754</A>


On Thu, Apr 20, 2017 at 2:34 PM, Chee M Gui &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">cheemeng at function.com</A>&gt; wrote:

&gt;<i> Hi Eliezer
</I>&gt;<i>
</I>&gt;<i> Thank you for the fast reply.
</I>&gt;<i> Squid is listening on 3128 on the server.    See netstat output below.
</I>&gt;<i> We would like to fix the logrotate script (if this is being used?) rather
</I>&gt;<i> that wait for Ubuntu to fix the Squid package (which may take a while).
</I>&gt;<i> There is no cron job under root or proxy or any other users on the server.
</I>&gt;<i> The logrotate file in  /etc/cron.daily is also a very old one.
</I>&gt;<i>
</I>&gt;<i> Thank you once again
</I>&gt;<i>
</I>&gt;<i> CMG
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at paproxy</A>:/etc/logrotate.d# netstat -an | more
</I>&gt;<i>
</I>&gt;<i> Active Internet connections (servers and established)
</I>&gt;<i> Proto Recv-Q Send-Q Local Address           Foreign Address         State
</I>&gt;<i> tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN
</I>&gt;<i> tcp        0      0 0.0.0.0:3128            0.0.0.0:*               LISTEN
</I>&gt;<i> tcp    13382      0 192.168.5.244:3128      192.168.5.103:49953
</I>&gt;<i> CLOSE_WAIT
</I>&gt;<i> tcp       90      0 198.27.136.41:52652     198.252.206.25:443
</I>&gt;<i>  CLOSE_WAIT
</I>&gt;<i> tcp      232      0 192.168.5.244:3128      192.168.5.126:63442
</I>&gt;<i> CLOSE_WAIT
</I>&gt;<i> tcp      440      0 192.168.5.244:3128      192.168.5.126:63423
</I>&gt;<i> CLOSE_WAIT
</I>&gt;<i> tcp      221      0 192.168.5.244:3128      192.168.5.103:54521
</I>&gt;<i> CLOSE_WAIT
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at paproxy</A>:/etc/logrotate.d# crontab -l
</I>&gt;<i> no crontab for root
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at paproxy</A>:/etc/logrotate.d# crontab -u proxy -l
</I>&gt;<i> no crontab for proxy
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at paproxy</A>:/etc/logrotate.d# vi squid
</I>&gt;<i> #
</I>&gt;<i> #       Logrotate fragment for squid.
</I>&gt;<i> #
</I>&gt;<i> /var/log/squid/*.log {
</I>&gt;<i>         daily
</I>&gt;<i>         compress
</I>&gt;<i>         delaycompress
</I>&gt;<i>         rotate 2
</I>&gt;<i>         missingok
</I>&gt;<i>         nocreate
</I>&gt;<i>         sharedscripts
</I>&gt;<i>         prerotate
</I>&gt;<i>                 test ! -x /usr/sbin/sarg-reports || /usr/sbin/sarg-reports
</I>&gt;<i>         endscript
</I>&gt;<i>         postrotate
</I>&gt;<i>                 test ! -e /var/run/squid.pid || test ! -x /usr/sbin/squid
</I>&gt;<i> || /usr/sbin/squid -k rotate
</I>&gt;<i>         endscript
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at paproxy</A>:/etc/logrotate.d# dpkg -s squid
</I>&gt;<i> Package: squid
</I>&gt;<i> Status: install ok installed
</I>&gt;<i> Priority: optional
</I>&gt;<i> Section: web
</I>&gt;<i> Installed-Size: 7464
</I>&gt;<i> Maintainer: Ubuntu Developers &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ubuntu-devel-discuss at lists.ubuntu.com</A>&gt;
</I>&gt;<i> Architecture: amd64
</I>&gt;<i> Source: squid3
</I>&gt;<i> Version: 3.5.12-1ubuntu7.3
</I>&gt;<i> Replaces: squid3 (&lt;&lt; 3.5.12-1ubuntu1~)
</I>&gt;<i> Depends: libc6 (&gt;= 2.15), libcap2 (&gt;= 1:2.10), libcomerr2 (&gt;= 1.01),
</I>&gt;<i> libdb5.3, libecap3 (&gt;= 1.0.1), libexpat1 (&gt;= 2.0.1), libgcc1 (&gt;= 1:3.0),
</I>&gt;<i> libgssapi-krb5-2 (&gt;= 1.10+dfsg~), libkrb5-3 (&gt;= 1.10+dfsg~), libldap-2.4-2
</I>&gt;<i> (&gt;= 2.4.7), libltdl7 (&gt;= 2.4.6), libnetfilter-conntrack3, libnettle6,
</I>&gt;<i> libpam0g (&gt;= 0.99.7.1), libsasl2-2, libstdc++6 (&gt;= 5.2), libxml2 (&gt;=
</I>&gt;<i> 2.7.4), netbase, logrotate (&gt;= 3.5.4-1), squid-common (=
</I>&gt;<i> 3.5.12-1ubuntu7.3), lsb-base, ssl-cert, init-system-helpers (&gt;&gt; 1.22ubuntu5)
</I>&gt;<i> Pre-Depends: adduser
</I>&gt;<i> Suggests: squidclient, squid-cgi, squid-purge, resolvconf (&gt;= 0.40),
</I>&gt;<i> smbclient, ufw, winbindd, apparmor
</I>&gt;<i> Breaks: squid3 (&lt;&lt; 3.5.12-1ubuntu1~), ufw (&lt;&lt; 0.35-0ubuntu2~)
</I>&gt;<i> Conffiles:
</I>&gt;<i>  /etc/apparmor.d/usr.sbin.squid 08e05266f0ef7a9a4ac2c62be29a3ef2
</I>&gt;<i>  /etc/init.d/squid f67c63ce21e0ac57a4d16e90909b3e34
</I>&gt;<i>  /etc/logrotate.d/squid 2be386088ead3641de5401a9c73a7a57
</I>&gt;<i>  /etc/resolvconf/update-libc.d/squid 9968dc6f2fcde9f38a6faea7dfe95dd1
</I>&gt;<i>  /etc/squid/errorpage.css 7f1cc06116c222d49d641f0e830ff615
</I>&gt;<i>  /etc/squid/squid.conf e73b82ed9d76b47c8b5963175f0ada1e
</I>&gt;<i>  /etc/ufw/applications.d/squid 710e7b8ded49bbcd41eb072a0fe1691f
</I>&gt;<i> Description: Full featured Web Proxy cache (HTTP proxy)
</I>&gt;<i>  Squid is a high-performance proxy caching server for web clients,
</I>&gt;<i> supporting
</I>&gt;<i>  FTP, gopher, ICY and HTTP data objects.
</I>&gt;<i>  .
</I>&gt;<i>  Squid version 3 is a major rewrite of Squid in C++ and introduces a
</I>&gt;<i> number of
</I>&gt;<i>  new features including ICAP and ESI support.
</I>&gt;<i> Homepage: <A HREF="http://www.squid-cache.org">http://www.squid-cache.org</A>
</I>&gt;<i> Original-Maintainer: Luigi Gangitano &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">luigi at debian.org</A>&gt;
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at paproxy</A>:/etc/logrotate.d#
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at paproxy</A>:/etc/logrotate.d# ls -al /etc/cron.daily
</I>&gt;<i> total 56
</I>&gt;<i> drwxr-xr-x  2 root root 4096 Mar 13 16:30 .
</I>&gt;<i> drwxr-xr-x 91 root root 4096 Apr  3 13:43 ..
</I>&gt;<i> -rwxr-xr-x  1 root root  376 Mar 31  2016 apport
</I>&gt;<i> -rwxr-xr-x  1 root root 1474 Oct 31 07:31 apt-compat
</I>&gt;<i> -rwxr-xr-x  1 root root  355 May 22  2012 bsdmainutils
</I>&gt;<i> -rwxr-xr-x  1 root root 1597 Nov 26  2015 dpkg
</I>&gt;<i> -rwxr-xr-x  1 root root  372 May  5  2015 logrotate
</I>&gt;<i> -rwxr-xr-x  1 root root 1293 Nov  6  2015 man-db
</I>&gt;<i> -rwxr-xr-x  1 root root  539 Jul 16  2014 mdadm
</I>&gt;<i> -rwxr-xr-x  1 root root  435 Nov 17  2014 mlocate
</I>&gt;<i> -rwxr-xr-x  1 root root  249 Nov 12  2015 passwd
</I>&gt;<i> -rw-r--r--  1 root root  102 Apr  5  2016 .placeholder
</I>&gt;<i> -rwxr-xr-x  1 root root 3449 Feb 26  2016 popularity-contest
</I>&gt;<i> -rwxr-xr-x  1 root root  214 May 24  2016 update-notifier-common
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Thu, Apr 20, 2017 at 12:24 PM, Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hey CM,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> From the output I understand that there wasn't a change in squid
</I>&gt;&gt;<i> packaging for 16.04 and they still use rc\init.d startup scripts.
</I>&gt;&gt;<i> Also they probably use the same logrotate scripts from very long ago.
</I>&gt;&gt;<i> We first must understand if squid is running and it seems that systemd
</I>&gt;&gt;<i> sees it as running.
</I>&gt;&gt;<i> I do not see in lsof output any port listening mentioned so I assume this
</I>&gt;&gt;<i> is the reason for the issue in hands.
</I>&gt;&gt;<i> The first thing I would do is run a crontab that will check if squid is
</I>&gt;&gt;<i> alive using a cache manager info page fetch and check if it's listening
</I>&gt;&gt;<i> using netstat or ss.
</I>&gt;&gt;<i> (did you tried to see if squid is listening using netstat or ss??)
</I>&gt;&gt;<i> The next step would be to check your squid roatate script and to verify
</I>&gt;&gt;<i> it's doing what it suppose to do.
</I>&gt;&gt;<i> After all this I would recommend changing from the rc\init.d startup
</I>&gt;&gt;<i> script to a real system based one and abandon the old rotation scripts of
</I>&gt;&gt;<i> Ubuntu or fix them.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If you are looking for a fix it's one path and if you are looking to get
</I>&gt;&gt;<i> the work done properly by Ubuntu it's a whole new wagon.
</I>&gt;&gt;<i> I have been working on squid packages for Ubuntu and Debian that uses
</I>&gt;&gt;<i> system scripts but the packages are not perfected yet.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Let me know the path you want to choose and also your approach to things
</I>&gt;&gt;<i> and I will try to help you with which of the options you will choose to
</I>&gt;&gt;<i> resolve the issues.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Eliezer
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ----
</I>&gt;&gt;<i> <A HREF="http://ngtech.co.il/lmgtfy/">http://ngtech.co.il/lmgtfy/</A>
</I>&gt;&gt;<i> Linux System Administrator
</I>&gt;&gt;<i> Mobile: +972-5-28704261
</I>&gt;&gt;<i> Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> From: Chee M Gui [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">cheemeng at function.com</A>]
</I>&gt;&gt;<i> Sent: Thursday, April 20, 2017 7:17 PM
</I>&gt;&gt;<i> To: Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;
</I>&gt;&gt;<i> Cc: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> Subject: Re: [squid-users] Squid stopped working after cache.log and
</I>&gt;&gt;<i> access.log rotation
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hi Eliezer
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thank you for the response, and sorry for the late reply.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> As requested, here are the output of the commands you suggested:
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at paproxy</A>:/# systemctl status squid
</I>&gt;&gt;<i> &#9679; squid.service - LSB: Squid HTTP Proxy version 3.x
</I>&gt;&gt;<i>    Loaded: loaded (/etc/init.d/squid; bad; vendor preset: enabled)
</I>&gt;&gt;<i>    Active: active (running) since Wed 2017-03-15 14:47:53 PDT; 1 months 5
</I>&gt;&gt;<i> days ago
</I>&gt;&gt;<i>      Docs: man:systemd-sysv-generator(8)
</I>&gt;&gt;<i>     Tasks: 4
</I>&gt;&gt;<i>    Memory: 54.4M
</I>&gt;&gt;<i>       CPU: 2min 38.957s
</I>&gt;&gt;<i>    CGroup: /system.slice/squid.service
</I>&gt;&gt;<i>            &#9500;&#9472;25482 /usr/sbin/squid -YC -f /etc/squid/squid.conf
</I>&gt;&gt;<i>            &#9500;&#9472;25484 (squid-1) -YC -f /etc/squid/squid.conf
</I>&gt;&gt;<i>            &#9500;&#9472;25485 (logfile-daemon) /var/log/squid/access.log
</I>&gt;&gt;<i>            &#9492;&#9472;25486 (unlinkd)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Warning: Journal has been rotated since unit was started. Log output is
</I>&gt;&gt;<i> incomplete or unavailable.
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at paproxy</A>:/#
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> top - 09:11:45 up 54 days, 23:51,  2 users,  load average: 0.00, 0.00,
</I>&gt;&gt;<i> 0.00
</I>&gt;&gt;<i> Tasks: 141 total,   1 running, 140 sleeping,   0 stopped,   0 zombie
</I>&gt;&gt;<i> %Cpu(s):  0.0 us,  0.0 sy,  0.0 ni, 99.9 id,  0.0 wa,  0.0 hi,  0.0 si,
</I>&gt;&gt;<i> 0.0 st
</I>&gt;&gt;<i> KiB Mem :  6043140 total,  4844728 free,   135292 used,  1063120
</I>&gt;&gt;<i> buff/cache
</I>&gt;&gt;<i> KiB Swap:  6222844 total,  6222844 free,        0 used.  5556300 avail Mem
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+
</I>&gt;&gt;<i> COMMAND
</I>&gt;&gt;<i> 23355 root      20   0   41668   3776   3236 R   6.7  0.1   0:00.01 top
</I>&gt;&gt;<i>     1 root      20   0   37884   5968   4020 S   0.0  0.1   0:27.20
</I>&gt;&gt;<i> systemd
</I>&gt;&gt;<i>     2 root      20   0       0      0      0 S   0.0  0.0   0:00.22
</I>&gt;&gt;<i> kthreadd
</I>&gt;&gt;<i>     3 root      20   0       0      0      0 S   0.0  0.0   0:01.01
</I>&gt;&gt;<i> ksoftirqd/0
</I>&gt;&gt;<i>     5 root       0 -20       0      0      0 S   0.0  0.0   0:00.00
</I>&gt;&gt;<i> kworker/0:0H
</I>&gt;&gt;<i>     7 root      20   0       0      0      0 S   0.0  0.0   1:28.65
</I>&gt;&gt;<i> rcu_sched
</I>&gt;&gt;<i>     8 root      20   0       0      0      0 S   0.0  0.0   0:00.00 rcu_bh
</I>&gt;&gt;<i>     9 root      rt   0       0      0      0 S   0.0  0.0   0:00.14
</I>&gt;&gt;<i> migration/0
</I>&gt;&gt;<i>    10 root      rt   0       0      0      0 S   0.0  0.0   0:05.53
</I>&gt;&gt;<i> watchdog/0
</I>&gt;&gt;<i>    11 root      rt   0       0      0      0 S   0.0  0.0   0:05.75
</I>&gt;&gt;<i> watchdog/1
</I>&gt;&gt;<i>    12 root      rt   0       0      0      0 S   0.0  0.0   0:00.14
</I>&gt;&gt;<i> migration/1
</I>&gt;&gt;<i>    13 root      20   0       0      0      0 S   0.0  0.0   0:02.48
</I>&gt;&gt;<i> ksoftirqd/1
</I>&gt;&gt;<i>    15 root       0 -20       0      0      0 S   0.0  0.0   0:00.00
</I>&gt;&gt;<i> kworker/1:0H
</I>&gt;&gt;<i>    16 root      20   0       0      0      0 S   0.0  0.0   0:00.00
</I>&gt;&gt;<i> kdevtmpfs
</I>&gt;&gt;<i>    17 root       0 -20       0      0      0 S   0.0  0.0   0:00.00 netns
</I>&gt;&gt;<i>    18 root       0 -20       0      0      0 S   0.0  0.0   0:00.00 perf
</I>&gt;&gt;<i>    19 root      20   0       0      0      0 S   0.0  0.0   0:01.26
</I>&gt;&gt;<i> khungtaskd
</I>&gt;&gt;<i>    20 root       0 -20       0      0      0 S   0.0  0.0   0:00.00
</I>&gt;&gt;<i> writeback
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at paproxy</A>:/# ps -aux | grep squid
</I>&gt;&gt;<i> root     23358  0.0  0.0  14224   976 pts/0    S+   09:12   0:00 grep
</I>&gt;&gt;<i> --color=auto squid
</I>&gt;&gt;<i> root     25482  0.0  0.1 109272  6416 ?        Ss   Mar15   0:00
</I>&gt;&gt;<i> /usr/sbin/squid -YC -f /etc/squid/squid.conf
</I>&gt;&gt;<i> proxy    25484  0.0  0.7 166684 45184 ?        S    Mar15   2:27
</I>&gt;&gt;<i> (squid-1) -YC -f /etc/squid/squid.conf
</I>&gt;&gt;<i> proxy    25485  0.0  0.0  13280  1648 ?        S    Mar15   0:03
</I>&gt;&gt;<i> (logfile-daemon) /var/log/squid/access.log
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at paproxy</A>:/#
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at paproxy</A>:/# df -h
</I>&gt;&gt;<i> Filesystem      Size  Used Avail Use% Mounted on
</I>&gt;&gt;<i> udev            2.9G     0  2.9G   0% /dev
</I>&gt;&gt;<i> tmpfs           591M   60M  531M  11% /run
</I>&gt;&gt;<i> /dev/sda1       911G  1.9G  863G   1% /
</I>&gt;&gt;<i> tmpfs           2.9G   12K  2.9G   1% /dev/shm
</I>&gt;&gt;<i> tmpfs           5.0M     0  5.0M   0% /run/lock
</I>&gt;&gt;<i> tmpfs           2.9G     0  2.9G   0% /sys/fs/cgroup
</I>&gt;&gt;<i> tmpfs           591M     0  591M   0% /run/user/1000
</I>&gt;&gt;<i> tmpfs           591M     0  591M   0% /run/user/0
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at paproxy</A>:/#
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at paproxy</A>:/# df -h
</I>&gt;&gt;<i> Filesystem      Size  Used Avail Use% Mounted on
</I>&gt;&gt;<i> udev            2.9G     0  2.9G   0% /dev
</I>&gt;&gt;<i> tmpfs           591M   60M  531M  11% /run
</I>&gt;&gt;<i> /dev/sda1       911G  1.9G  863G   1% /
</I>&gt;&gt;<i> tmpfs           2.9G   12K  2.9G   1% /dev/shm
</I>&gt;&gt;<i> tmpfs           5.0M     0  5.0M   0% /run/lock
</I>&gt;&gt;<i> tmpfs           2.9G     0  2.9G   0% /sys/fs/cgroup
</I>&gt;&gt;<i> tmpfs           591M     0  591M   0% /run/user/1000
</I>&gt;&gt;<i> tmpfs           591M     0  591M   0% /run/user/0
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at paproxy</A>:/#
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at paproxy</A>:/# lsof -n|egrep &quot;proxy|squid&quot; | more
</I>&gt;&gt;<i> squid     25482                  root  cwd       DIR                8,1
</I>&gt;&gt;<i>    4096          2 /
</I>&gt;&gt;<i> squid     25482                  root  rtd       DIR                8,1
</I>&gt;&gt;<i>    4096          2 /
</I>&gt;&gt;<i> squid     25482                  root  txt       REG                8,1
</I>&gt;&gt;<i> 6430816   41946763 /usr/sbin/squid
</I>&gt;&gt;<i> squid     25482                  root  mem       REG                8,1
</I>&gt;&gt;<i>   47648   10093387 /lib/x86_64-linux-gnu/libnss_nis-2.23.
</I>&gt;&gt;<i> so
</I>&gt;&gt;<i> squid     25482                  root  mem       REG                8,1
</I>&gt;&gt;<i>   93128   10093399 /lib/x86_64-linux-gnu/<A HREF="http://libnsl-2.23.so">http://libnsl-2.23.so</A>
</I>&gt;&gt;<i> squid     25482                  root  mem       REG                8,1
</I>&gt;&gt;<i>   35688   10093400 /lib/x86_64-linux-gnu/libnss_compat-2.
</I>&gt;&gt;<i> 23.so
</I>&gt;&gt;<i> squid     25482                  root  mem       REG                8,1
</I>&gt;&gt;<i>   47600   10093403 /lib/x86_64-linux-gnu/libnss_files-2.2
</I>&gt;&gt;<i> 3.so
</I>&gt;&gt;<i> squid     25482                  root  mem       REG                8,1
</I>&gt;&gt;<i> 25913104   41944015 /usr/lib/x86_64-linux-gnu/libicudata.s
</I>&gt;&gt;<i> o.55.1
</I>&gt;&gt;<i> squid     25482                  root  mem       REG                8,1
</I>&gt;&gt;<i>   22520   10093098 /lib/x86_64-linux-gnu/libmnl.so.0.1.0
</I>&gt;&gt;<i> squid     25482                  root  mem       REG                8,1
</I>&gt;&gt;<i>   26248   41948589 /usr/lib/x86_64-linux-gnu/libnfnetlink
</I>&gt;&gt;<i> .so.0.2.0
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thank you once again
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> CM
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Thu, Mar 23, 2017 at 1:59 PM, Eliezer Croitoru &lt;mailto:
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt; wrote:
</I>&gt;&gt;<i> There is another option!
</I>&gt;&gt;<i> The log rotate script is doing something nasty or the systemd service
</I>&gt;&gt;<i> file start up squid in a weird way.
</I>&gt;&gt;<i> The output of:
</I>&gt;&gt;<i> $ systemctl status squid
</I>&gt;&gt;<i> $ top -n1 -b
</I>&gt;&gt;<i> $ ps aux
</I>&gt;&gt;<i> $ df -h
</I>&gt;&gt;<i> $ netstat -ntulp
</I>&gt;&gt;<i> $ lsof -n|egrep &quot;proxy|squid&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> How many clients this system has?
</I>&gt;&gt;<i> Is the system facing the Internet directly or behind some nat(aws or
</I>&gt;&gt;<i> another provider)?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The above are the basic required data to understand the situation.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> All The Bests,
</I>&gt;&gt;<i> Eliezer
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ----
</I>&gt;&gt;<i> <A HREF="http://ngtech.co.il/lmgtfy/">http://ngtech.co.il/lmgtfy/</A>
</I>&gt;&gt;<i> Linux System Administrator
</I>&gt;&gt;<i> Mobile: tel:%2B972-5-28704261
</I>&gt;&gt;<i> Email: mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> From: squid-users [mailto:mailto:squid-users-bou
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">nces at lists.squid-cache.org</A>] On Behalf Of Chee M Gui
</I>&gt;&gt;<i> Sent: Wednesday, March 22, 2017 5:18 PM
</I>&gt;&gt;<i> To: mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> Subject: [squid-users] Squid stopped working after cache.log and
</I>&gt;&gt;<i> access.log rotation
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hi All
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> We recently installed Squid 3.5.12-1ubuntu7.3 on Ubuntu 16.04.2 LTS.  It
</I>&gt;&gt;<i> ran fine at first but stopped working after a while.   telnet server 3128
</I>&gt;&gt;<i> still works, i.e., opens a blank window, but Squid is just not accepting
</I>&gt;&gt;<i> requests.    Then we realized that there is no new access.log file.   The
</I>&gt;&gt;<i> access.log file stopped rotated at 6:24AM on 3/17/2017.    It looks like
</I>&gt;&gt;<i> Squid wasn't able to create a new access.log?  We could not find any error
</I>&gt;&gt;<i> message in syslog or the cache.log.      We haven't rebooted the server
</I>&gt;&gt;<i> because we want to know what went wrong.   It isn't the firewall blocking
</I>&gt;&gt;<i> Squid because Squid was working fine all the while until recently.  Also
</I>&gt;&gt;<i> after it stopped working, we disabled the firewall to see if it would work
</I>&gt;&gt;<i> but it still didn't work.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at paproxy</A>:/var/log/squid# ls -alt
</I>&gt;&gt;<i> total 15536
</I>&gt;&gt;<i> drwxr-xr-x 2 proxy proxy      4096 Mar 21 06:25 .
</I>&gt;&gt;<i> -rw-r----- 1 proxy proxy        63 Mar 21 06:25 cache.log
</I>&gt;&gt;<i> drwxrwxr-x 9 root  syslog     4096 Mar 21 06:25 ..
</I>&gt;&gt;<i> -rw-r----- 1 proxy proxy        63 Mar 20 06:25 cache.log.1
</I>&gt;&gt;<i> -rw-r----- 1 proxy proxy        83 Mar 19 06:25 cache.log.2.gz
</I>&gt;&gt;<i> -rw-r----- 1 proxy proxy  15759111 Mar 17 06:24 access.log.1
</I>&gt;&gt;<i> -rw-r----- 1 proxy proxy    117223 Mar 17 05:52 netdb.state
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Any ideas what went wrong?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thank you very much in anticipation.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Gui
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> Chee Meng Gui
</I>&gt;&gt;<i> Function Engineering
</I>&gt;&gt;<i> 650-833-0660
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Chee Meng Gui
</I>&gt;<i> Function Engineering
</I>&gt;<i> 650-833-0660 &lt;(650)%20833-0660&gt;
</I>&gt;<i>
</I>


-- 
Chee Meng Gui
Function Engineering
650-833-0660
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170420/fabb995b/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170420/fabb995b/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015037.html">[squid-users] Squid stopped working after cache.log and access.log rotation
</A></li>
	<LI>Next message (by thread): <A HREF="015039.html">[squid-users] Can squid work as http response parse  only ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15038">[ date ]</a>
              <a href="thread.html#15038">[ thread ]</a>
              <a href="subject.html#15038">[ subject ]</a>
              <a href="author.html#15038">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
