<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] https_port Connection reset by peer; http_port works
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20https_port%20Connection%20reset%20by%20peer%3B%0A%20http_port%20works&In-Reply-To=%3C0ab52c0a-7546-b803-1855-8a3bfd63adee%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015045.html">
   <LINK REL="Next"  HREF="015051.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] https_port Connection reset by peer; http_port works</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20https_port%20Connection%20reset%20by%20peer%3B%0A%20http_port%20works&In-Reply-To=%3C0ab52c0a-7546-b803-1855-8a3bfd63adee%40treenet.co.nz%3E"
       TITLE="[squid-users] https_port Connection reset by peer; http_port works">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Apr 23 16:03:25 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015045.html">[squid-users] https_port Connection reset by peer; http_port works
</A></li>
        <LI>Next message (by thread): <A HREF="015051.html">[squid-users] https_port Connection reset by peer;	http_port works
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15050">[ date ]</a>
              <a href="thread.html#15050">[ thread ]</a>
              <a href="subject.html#15050">[ subject ]</a>
              <a href="author.html#15050">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

On 23/04/17 04:32, chiasa.men wrote:
&gt;<i> Hello folks
</I>&gt;<i>
</I>&gt;<i> I tried to encrypt the connection between client and squid. Therefore I
</I>&gt;<i> generated certificates which are accepted by the clients and configured squid
</I>&gt;<i> as followed:
</I>&gt;<i>
</I>&gt;<i> Squid.conf
</I>&gt;<i>    https_port 10.0.13.10:8443 cert=/cert.pem key=/cert.key
</I>&gt;<i>    http_port 10.0.13.10:8080
</I>&gt;<i>    http_access allow all
</I>&gt;<i>
</I>&gt;<i> My following tests show that I can use the http port for internet access but
</I>&gt;<i> the https port wont work.
</I>&gt;<i>    openssl s_client -connect proxy:8443
</I>&gt;<i>    # Verify return code: 0 (ok)
</I>&gt;<i>
</I>&gt;<i>    export https_proxy=&quot;proxy:8443&quot;
</I>&gt;<i>    export http_proxy=&quot;proxy:8080&quot;
</I>&gt;<i>    curl <A HREF="https://www.google.de">https://www.google.de</A>
</I>&gt;<i>    # curl: (56) Recv failure: Connection reset by peer
</I>&gt;<i>    curl <A HREF="http://www.google.de">http://www.google.de</A>
</I>&gt;<i>    # works
</I>&gt;<i>    
</I>&gt;<i>    export https_proxy=&quot;proxy:8443&quot;
</I>&gt;<i>    export http_proxy=&quot;$https_proxy&quot;
</I>&gt;<i>    curl <A HREF="https://www.google.de">https://www.google.de</A>
</I>&gt;<i>    # curl: (56) Recv failure: Connection reset by peer
</I>&gt;<i>    curl <A HREF="http://www.google.de">http://www.google.de</A>
</I>&gt;<i>    # curl: (56) Recv failure: Connection reset by peer
</I>&gt;<i>    
</I>&gt;<i>    export http_proxy=&quot;proxy:8080&quot;
</I>&gt;<i>    export https_proxy=&quot;$http_proxy&quot;
</I>&gt;<i>    curl <A HREF="https://www.google.de">https://www.google.de</A>
</I>&gt;<i>    # works
</I>&gt;<i>    curl <A HREF="http://www.google.de">http://www.google.de</A>
</I>&gt;<i>    # works
</I>&gt;<i>
</I>&gt;<i> What did I wrong? Do I misunderstand something regarding the configuration
</I>&gt;<i> options?
</I>
You appear not to be using curl correctly.

Test #1 and #3 show that curl is probably sending the <A HREF="https://">https://</A> requests 
through port 8080 on your proxy as a CONNECT request. Check that in your 
Squid log to confirm.

Test #2 is misconfigured. port 8443 on your proxy is not able to accept 
plain-text traffic.


AFAIK the &quot;https_proxy&quot; environment variable is a custom things invented 
by Google in part of their insistence not to allow users to configure 
TLS to a proxy via the Chrome GUI. It is not part of the normal POSIX 
environment like http_proxy is. So you cannot rely on non-Browser tools 
like curl supporting it.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015045.html">[squid-users] https_port Connection reset by peer; http_port works
</A></li>
	<LI>Next message (by thread): <A HREF="015051.html">[squid-users] https_port Connection reset by peer;	http_port works
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15050">[ date ]</a>
              <a href="thread.html#15050">[ thread ]</a>
              <a href="subject.html#15050">[ subject ]</a>
              <a href="author.html#15050">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
