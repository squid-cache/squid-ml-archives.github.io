<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Transparent Squidding Teething Issues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Transparent%20Squidding%20Teething%20Issues&In-Reply-To=%3C2080294681.3302809.1493052640777%40mail.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015071.html">
   <LINK REL="Next"  HREF="015066.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Transparent Squidding Teething Issues</H1>
    <B>Olly Lennox</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Transparent%20Squidding%20Teething%20Issues&In-Reply-To=%3C2080294681.3302809.1493052640777%40mail.yahoo.com%3E"
       TITLE="[squid-users] Transparent Squidding Teething Issues">oliver at lennox-it.uk
       </A><BR>
    <I>Mon Apr 24 16:50:40 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015071.html">[squid-users] Huge memory required for squid 3.5
</A></li>
        <LI>Next message (by thread): <A HREF="015066.html">[squid-users] Squid with MySQL auth not denying pages with
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15057">[ date ]</a>
              <a href="thread.html#15057">[ thread ]</a>
              <a href="subject.html#15057">[ subject ]</a>
              <a href="author.html#15057">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi All,

First week testing the transparent squid proxy on the Raspberry Pi is going well so far but I've hit a few snags that I was hoping someone might be able to advise on. My current (SSL) config is:


------------------------http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow all

http_port 3130

http_port 3128 intercept 
https_port 3129 intercept ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB cert=/etc/squid3/ssl_cert/squid.crt key=/etc/squid3/ssl_cert/squid.key options=NO_SSLv3 dhparams=/etc/squid3/ssl_cert/dhparam.pem

acl nobumpserver ssl::server_name src &quot;/etc/squid/nobump&quot;
acl step1 at_step SslBump1

ssl_bump peek nobumpserver
ssl_bump splice nobumpserver

ssl_bump stare step1 !nobumpserver
ssl_bump bump !nobumpserver

sslproxy_cafile /etc/squid/ssl_cert/ca-bundle.crt

sslproxy_session_cache_size 0
sslcrtd_program /usr/lib/squid/ssl_crtd -s /var/spool/squid_ssldb -M 4MB
sslcrtd_children 8 startup=1 idle=1
sslproxy_cert_error allow all
sslproxy_flags DONT_VERIFY_PEER
sslproxy_cipher EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH+aRSA+RC4:EECDH:EDH+aRSA:!RC4:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS

I've also disabled caching for now since the little pi wasn't quite coping with it (I think the flash memory cards they use are a bit slow) and overall internet performance was suffering.

-----------------------

My questions are:

1. Are there any techniques / acls to handle streaming content? Ideally I'd like all streaming content to be spliced not bumped

2. There seems to be a problem with sending larger content over bumped HTTPS (receiving is fine). For example WhatsApp and Snapchat receive messages and rich content fine and you can send messages fine but trying to send rich content like video or images fails with connection errors.

3. Skype doesn't seem to work unless you specify explicit proxy settings in the config (point it at the proxy server / 3130 port). Is this to be expected or could it be fixed in the config?

4. Sorry I know this is probably in the wiki but is there an acl for source (client) address? For devices like Smart TV where it is difficult to install the certificate it would be useful to set these to always splice 

Thanks very much!

Olly
 
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">oliver at lennox-it.uk</A>
lennox-it.uk
tel: 07900 648 252

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015071.html">[squid-users] Huge memory required for squid 3.5
</A></li>
	<LI>Next message (by thread): <A HREF="015066.html">[squid-users] Squid with MySQL auth not denying pages with
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15057">[ date ]</a>
              <a href="thread.html#15057">[ thread ]</a>
              <a href="subject.html#15057">[ subject ]</a>
              <a href="author.html#15057">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
