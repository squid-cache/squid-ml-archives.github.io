<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] 3.5.25: (71) Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%203.5.25%3A%20%2871%29%20Protocol%20error%20%28TLS%20code%3A%0A%20SQUID_ERR_SSL_HANDSHAKE%29&In-Reply-To=%3C7b204020-8394-b61d-6545-57d8c7d9bd49%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015078.html">
   <LINK REL="Next"  HREF="015081.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] 3.5.25: (71) Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%203.5.25%3A%20%2871%29%20Protocol%20error%20%28TLS%20code%3A%0A%20SQUID_ERR_SSL_HANDSHAKE%29&In-Reply-To=%3C7b204020-8394-b61d-6545-57d8c7d9bd49%40gmail.com%3E"
       TITLE="[squid-users] 3.5.25: (71) Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)">yvoinov at gmail.com
       </A><BR>
    <I>Thu Apr 27 17:28:34 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015078.html">[squid-users] 3.5.25: (71) Protocol error (TLS	code:	SQUID_ERR_SSL_HANDSHAKE)
</A></li>
        <LI>Next message (by thread): <A HREF="015081.html">[squid-users] 3.5.25: (71) Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15080">[ date ]</a>
              <a href="thread.html#15080">[ thread ]</a>
              <a href="subject.html#15080">[ subject ]</a>
              <a href="author.html#15080">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This one?

<A HREF="http://i.imgur.com/kI9SxiN.png">http://i.imgur.com/kI9SxiN.png</A>

It's works under bump.


27.04.2017 22:47, David Touzeau &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> Hi,
</I>&gt;<i> I'm unable to access to <A HREF="https://www.boutique.afnor.org">https://www.boutique.afnor.org</A> website.
</I>&gt;<i> I would like to know if this issue cannot be fixed and must deny bump
</I>&gt;<i> website to fix it.
</I>&gt;<i> Without Squid the website is correctly displayed 
</I>&gt;<i>
</I>&gt;<i> Squid claim an error page with &quot;(71) Protocol error (TLS code:
</I>&gt;<i> SQUID_ERR_SSL_HANDSHAKE)&quot;
</I>&gt;<i>
</I>&gt;<i> In cache.log: &quot;Error negotiating SSL on FD 17:
</I>&gt;<i> error:00000000:lib(0):func(0):reason(0) (5/0/0)&quot;
</I>&gt;<i>
</I>&gt;<i> Using the following configuration:
</I>&gt;<i>
</I>&gt;<i> http_port 0.0.0.0:3128  name=MyPortNameID20 ssl-bump
</I>&gt;<i> generate-host-certificates=on dynamic_cert_mem_cache_size=4MB
</I>
&gt;<i> cert=/etc/squid3/ssl/0c451f46b4d05031560d8195f30165cb.dyn
</I>What's is this? Which certificate?
&gt;<i> sslproxy_foreign_intermediate_certs /etc/squid3/intermediate_ca.pem
</I>&gt;<i> sslcrtd_program /lib/squid3/ssl_crtd -s /var/lib/squid/session/ssl/ssl_db -M
</I>&gt;<i> 8MB
</I>&gt;<i> sslcrtd_children 16 startup=5 idle=1
</I>&gt;<i> acl FakeCert ssl::server_name .apple.com
</I>&gt;<i> acl FakeCert ssl::server_name .icloud.com
</I>&gt;<i> acl FakeCert ssl::server_name .mzstatic.com
</I>&gt;<i> acl FakeCert ssl::server_name .dropbox.com
</I>&gt;<i> acl ssl_step1 at_step SslBump1
</I>&gt;<i> acl ssl_step2 at_step SslBump2
</I>&gt;<i> acl ssl_step3 at_step SslBump3
</I>&gt;<i> ssl_bump peek ssl_step1
</I>&gt;<i> ssl_bump splice FakeCert
</I>&gt;<i> ssl_bump bump ssl_step2 all
</I>&gt;<i> ssl_bump splice all
</I>&gt;<i>
</I>&gt;<i> sslproxy_options NO_SSLv2,NO_SSLv3,No_Compression
</I>&gt;<i> sslproxy_cipher
</I>&gt;<i> ALL:!SSLv2:!SSLv3:!ADH:!DSS:!MD5:!EXP:!DES:!PSK:!SRP:!RC4:!IDEA:!SEED:!aNULL
</I>&gt;<i> :!eNULL
</I>&gt;<i> sslproxy_flags DONT_VERIFY_PEER
</I>&gt;<i> sslproxy_cert_error allow all
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Openssl info 
</I>&gt;<i> ----------------------------------------------------------------------------
</I>&gt;<i> ----------------------------------------------------------------------------
</I>&gt;<i> ---
</I>&gt;<i>
</I>&gt;<i> openssl s_client -connect 195.115.26.58:443 -showcerts
</I>&gt;<i>
</I>&gt;<i> CONNECTED(00000003)
</I>&gt;<i> depth=2 C = US, O = &quot;VeriSign, Inc.&quot;, OU = VeriSign Trust Network, OU = &quot;(c)
</I>&gt;<i> 2006 VeriSign, Inc. - For authorized use only&quot;, CN = VeriSign Class 3 Public
</I>&gt;<i> Primary Certification Authority - G5
</I>&gt;<i> verify return:1
</I>&gt;<i> depth=1 C = US, O = Symantec Corporation, OU = Symantec Trust Network, CN =
</I>&gt;<i> Symantec Class 3 Secure Server CA - G4
</I>&gt;<i> verify return:1
</I>&gt;<i> depth=0 C = FR, ST = Seine Saint Denis, L = ST DENIS, O = ASSOCIATION
</I>&gt;<i> FRANCAISE DE NORMALISATION, OU = ASSOCIATION FRANCAISE DE NORMALISATION, CN
</I>&gt;<i> = www.boutique.afnor.org
</I>&gt;<i> verify return:1
</I>&gt;<i> ---
</I>&gt;<i> Certificate chain
</I>&gt;<i>  0 s:/C=FR/ST=Seine Saint Denis/L=ST DENIS/O=ASSOCIATION FRANCAISE DE
</I>&gt;<i> NORMALISATION/OU=ASSOCIATION FRANCAISE DE
</I>&gt;<i> NORMALISATION/CN=www.boutique.afnor.org
</I>&gt;<i>    i:/C=US/O=Symantec Corporation/OU=Symantec Trust Network/CN=Symantec
</I>&gt;<i> Class 3 Secure Server CA - G4
</I>&gt;<i> -----BEGIN CERTIFICATE-----
</I>&gt;<i> ../..
</I>&gt;<i> -----END CERTIFICATE-----
</I>&gt;<i>  1 s:/C=US/O=Symantec Corporation/OU=Symantec Trust Network/CN=Symantec
</I>&gt;<i> Class 3 Secure Server CA - G4
</I>&gt;<i>    i:/C=US/O=VeriSign, Inc./OU=VeriSign Trust Network/OU=(c) 2006 VeriSign,
</I>&gt;<i> Inc. - For authorized use only/CN=VeriSign Class 3 Public Primary
</I>&gt;<i> Certification Authority - G5
</I>&gt;<i> -----BEGIN CERTIFICATE-----
</I>&gt;<i> ../..
</I>&gt;<i> -----END CERTIFICATE-----
</I>&gt;<i> ---
</I>&gt;<i> Server certificate
</I>&gt;<i> subject=/C=FR/ST=Seine Saint Denis/L=ST DENIS/O=ASSOCIATION FRANCAISE DE
</I>&gt;<i> NORMALISATION/OU=ASSOCIATION FRANCAISE DE
</I>&gt;<i> NORMALISATION/CN=www.boutique.afnor.org
</I>&gt;<i> issuer=/C=US/O=Symantec Corporation/OU=Symantec Trust Network/CN=Symantec
</I>&gt;<i> Class 3 Secure Server CA - G4
</I>&gt;<i> ---
</I>&gt;<i> No client certificate CA names sent
</I>&gt;<i> ---
</I>&gt;<i> SSL handshake has read 3105 bytes and written 616 bytes
</I>&gt;<i> ---
</I>&gt;<i> New, TLSv1/SSLv3, Cipher is AES128-SHA
</I>&gt;<i> Server public key is 2048 bit
</I>&gt;<i> Secure Renegotiation IS supported
</I>&gt;<i> Compression: NONE
</I>&gt;<i> Expansion: NONE
</I>&gt;<i> SSL-Session:
</I>&gt;<i>     Protocol  : TLSv1
</I>&gt;<i>     Cipher    : AES128-SHA
</I>&gt;<i>     Session-ID:
</I>&gt;<i> 833B0000A2346F50C5AAFC6B5188B4EBD9304CD25411BECFF0713F8D76C65D9D
</I>&gt;<i>     Session-ID-ctx:
</I>&gt;<i>     Master-Key:
</I>&gt;<i> D2DF6C62264D03D7D44AF44EB8C0B1B7AD0E650D34DF6EBEB1CBEBFE4F30CB9C6F5080AA94F5
</I>&gt;<i> D6B5955DD8DF06608416
</I>&gt;<i>     Key-Arg   : None
</I>
&gt;<i>     PSK identity: None
</I>&gt;<i>     PSK identity hint: None
</I>&gt;<i>     SRP username: None
</I>&gt;<i>     Start Time: 1493311275
</I>&gt;<i>     Timeout   : 300 (sec)
</I>&gt;<i>     Verify return code: 0 (ok)
</I>&gt;<i> ---
</I>&gt;<i> read:errno=0
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
-- 
Bugs to the Future
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x613DEC46.asc
Type: application/pgp-keys
Size: 2437 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170427/e6003008/attachment.key">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170427/e6003008/attachment.key</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170427/e6003008/attachment.sig">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170427/e6003008/attachment.sig</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015078.html">[squid-users] 3.5.25: (71) Protocol error (TLS	code:	SQUID_ERR_SSL_HANDSHAKE)
</A></li>
	<LI>Next message (by thread): <A HREF="015081.html">[squid-users] 3.5.25: (71) Protocol error (TLS code: SQUID_ERR_SSL_HANDSHAKE)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15080">[ date ]</a>
              <a href="thread.html#15080">[ thread ]</a>
              <a href="subject.html#15080">[ subject ]</a>
              <a href="author.html#15080">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
