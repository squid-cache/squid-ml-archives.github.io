<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] concurrency with ecap
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20concurrency%20with%20ecap&In-Reply-To=%3Cfbb481fa-acaa-d2e4-28f7-6fc84e41d352%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015088.html">
   <LINK REL="Next"  HREF="015090.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] concurrency with ecap</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20concurrency%20with%20ecap&In-Reply-To=%3Cfbb481fa-acaa-d2e4-28f7-6fc84e41d352%40measurement-factory.com%3E"
       TITLE="[squid-users] concurrency with ecap">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Apr 28 00:03:00 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015088.html">[squid-users] concurrency with ecap
</A></li>
        <LI>Next message (by thread): <A HREF="015090.html">[squid-users] Squid proxy without name resolution for internet adresses behind parent proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15089">[ date ]</a>
              <a href="thread.html#15089">[ thread ]</a>
              <a href="subject.html#15089">[ subject ]</a>
              <a href="author.html#15089">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 04/27/2017 03:33 PM, Yuri Voinov wrote:

&gt;<i> is it possible to get comprehensive example?
</I>
FYI: This is an eCAP question, not a Squid-specific question; you also
start discussing development. Such questions are better asked via eCAP
support channels[1] rather than on squid-users:

  [1] <A HREF="http://www.e-cap.org/Support">http://www.e-cap.org/Support</A>

Virtually any eCAP adapter supports concurrent transactions. Concurrency
is built into the API. Many adapters do not make costly/lengthy
decisions so they do not need &quot;threads&quot; (just like many Squids do not
need threads to process thousands of transactions concurrently). Some
adapters that do make those lengthy decisions block the application
process while others use multiple threads (or multiple processes) to
minimize blocking.

IIRC, the eCAP ClamAV adapter[2] uses threads to minimize blocking. You
may use it as a comprehensive example.

  [2] <A HREF="http://www.e-cap.org/Downloads">http://www.e-cap.org/Downloads</A>


&gt;<i> Adapter sample is non-obvious, not complete (non-obvious where to put
</I>&gt;<i> mutex locking) and contains C-style rudiments (like external call,
</I>&gt;<i> pthread.h etc.).
</I>&gt;<i> 
</I>&gt;<i> I think, this will be actual in 2017, with CMT world around.
</I>
I doubt there are high-quality public adapters that use C++11 threading
interfaces (if that is what you are looking for). Several aspects
contribute to that, including:

* There were no stable host applications that supported C++11 until
recently and few are going to rewrite older working adapters just to add
C++11 bells and whistles.

* IIRC, initial attempts to use C++11 thread-related atomic APIs in
Squid have failed due to poor compiler support (this is not related to
eCAP but illustrates that you are talking about state-of-the-art
features rather than something that is widely supported, used, and
understood like pthreads).

* The official libecap library itself is still using a couple of
pre-C++11 components (and changing that is difficult[3,4]!).

  [3] <A HREF="https://bugs.launchpad.net/ecap/+bug/1595488">https://bugs.launchpad.net/ecap/+bug/1595488</A>
  [4] <A HREF="https://bugs.launchpad.net/ecap/+bug/1595562">https://bugs.launchpad.net/ecap/+bug/1595562</A>

In summary, it may take some time for that C++11 threading technology to
surface in eCAP adapters.


HTH,

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015088.html">[squid-users] concurrency with ecap
</A></li>
	<LI>Next message (by thread): <A HREF="015090.html">[squid-users] Squid proxy without name resolution for internet adresses behind parent proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15089">[ date ]</a>
              <a href="thread.html#15089">[ thread ]</a>
              <a href="subject.html#15089">[ subject ]</a>
              <a href="author.html#15089">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
