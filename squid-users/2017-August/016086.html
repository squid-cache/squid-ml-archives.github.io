<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] i need to match 2 access list into 1 access list action
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20i%20need%20to%20match%202%20access%20list%20into%201%20access%20list%0A%20action&In-Reply-To=%3Ce1cd1a81-1b5f-3cfb-688c-8a20a79241e6%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016083.html">
   <LINK REL="Next"  HREF="016084.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] i need to match 2 access list into 1 access list action</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20i%20need%20to%20match%202%20access%20list%20into%201%20access%20list%0A%20action&In-Reply-To=%3Ce1cd1a81-1b5f-3cfb-688c-8a20a79241e6%40treenet.co.nz%3E"
       TITLE="[squid-users] i need to match 2 access list into 1 access list action">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Aug  7 10:48:26 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016083.html">[squid-users] i need to match 2 access list into 1 access list	action
</A></li>
        <LI>Next message (by thread): <A HREF="016084.html">[squid-users] FATAL: The session helpers are crashing too rapidly,	need help!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16086">[ date ]</a>
              <a href="thread.html#16086">[ thread ]</a>
              <a href="subject.html#16086">[ subject ]</a>
              <a href="author.html#16086">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07/08/17 10:05, Ahmed Alzaeem wrote:
&gt;<i> the game I&#8217;m looking for may be complex a bit .
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> well here is the game :
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> i have squid ruling on IPV6 and 1 ipv4
</I>&gt;<i> 
</I>&gt;<i> so i have an ipv4  1.1.1.1 address which go to null 0 network  which mean a fake route .
</I>&gt;<i> 
</I>&gt;<i> buy that i prevent the IPV4 websites from loading .
</I>&gt;<i> so  above is sufficient for that :
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i> acl ip1 myip 12.58.120.72
</I>&gt;&gt;&gt;<i> tcp_outgoing_address 1.1.1.1 ip1
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> but sometimes i want to allow the IPV4 websites but for certain source of ips but i cant match the src ip address with the acl &#8220;myip&#8221; so that some ips get ipv6 websites only and other get both ipv4/ipv6
</I>
Ah. Maybe understanding now.

The current Squid compare the IP address type on tcp_outgoing_address 
with the IP type of the server connection. So lines containing an IPv4 
are never applied to IPv6 outbound traffic, and lines with a v6 are 
never used for IPv4 outbound traffic.

So, to let every body reach IPv6 servers, just do not set 
tcp_outgoing_address lines with IPv6 address. That includes any IPv4 
clients using Squid to reach IPv6 servers.


For the clients that you want to block IPv4 outgoing connections, since 
you have two criteria (X clients going to Y domains) you need two ACLs; 
one to match the clients IPs and one to match the domains.

  # the clients which might be allowed
  acl special_clients src 12.58.70.10/32

  # the domains those clients are allowed to visit over IPv4
  acl special_domains dstdomain .example.com

  # ... and maybe some servers only known by their IPv4
  acl special_domain_ips dst 192.168.0.1


  # match if both client AND domain criteria match
  acl allow_ipv4 all-of special_clients special_domains

  # or, match if both client and domain-IP criteria match
  acl allow_ipv4 all-of special_clients special_domain_ips

  # ... send other clients (non-allowed) out the nul-route IPv4
  tcp_outgoing_address 1.1.1.1 !allow_ipv4


If you have a Squid lacking the 'all-of' ACL type (older than 3.4) the 
below should work instead of those last three lines, though I have not 
tried it:


   tcp_outgoing_address 0.0.0.0 special_clients special_domains
   tcp_outgoing_address 0.0.0.0 special_clients special_domain_ips

   # otherwise use the nul-routed outgoing IP
   tcp_outgoing_address 1.1.1.1




&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> thats why i posted the question , I&#8217;m sure amos u will give me magical solution next post :)
</I>&gt;<i> 
</I>
:<i>-) maybe, I'm still not sure I understand you completely yet. But the 
</I>above certainly seems like magic.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016083.html">[squid-users] i need to match 2 access list into 1 access list	action
</A></li>
	<LI>Next message (by thread): <A HREF="016084.html">[squid-users] FATAL: The session helpers are crashing too rapidly,	need help!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16086">[ date ]</a>
              <a href="thread.html#16086">[ thread ]</a>
              <a href="subject.html#16086">[ subject ]</a>
              <a href="author.html#16086">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
