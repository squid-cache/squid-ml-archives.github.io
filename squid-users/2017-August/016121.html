<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Crash: every 19 hours: kernel: Out of memory: Kill	process (squid)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Crash%3A%20every%2019%20hours%3A%20kernel%3A%20Out%20of%20memory%3A%0A%20Kill%09process%20%28squid%29&In-Reply-To=%3C89638057A560FB458C01C197F81C7F5D18A860CD%40PACERS.amscan.corp%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016120.html">
   <LINK REL="Next"  HREF="016122.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Crash: every 19 hours: kernel: Out of memory: Kill	process (squid)</H1>
    <B>Cherukuri, Naresh</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Crash%3A%20every%2019%20hours%3A%20kernel%3A%20Out%20of%20memory%3A%0A%20Kill%09process%20%28squid%29&In-Reply-To=%3C89638057A560FB458C01C197F81C7F5D18A860CD%40PACERS.amscan.corp%3E"
       TITLE="[squid-users] Crash: every 19 hours: kernel: Out of memory: Kill	process (squid)">ncherukuri at partycity.com
       </A><BR>
    <I>Thu Aug 10 13:26:32 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016120.html">[squid-users] Crash: every 19 hours: kernel: Out of memory:	Kill	process (squid)
</A></li>
        <LI>Next message (by thread): <A HREF="016122.html">[squid-users] Crash: every 19 hours: kernel: Out of memory:	Kill	process (squid)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16121">[ date ]</a>
              <a href="thread.html#16121">[ thread ]</a>
              <a href="subject.html#16121">[ subject ]</a>
              <a href="author.html#16121">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>No this a physical box and we are using only for squid. We have 4 cpu's and 16 cores. Please find below for reference

Accesslogs : redirected to /cache/squid



/dev/mapper/*****-root  351G  5.2G  328G   2% /

devtmpfs                          5.8G     0  5.8G   0% /dev

tmpfs                             5.8G  2.1M  5.8G   1% /dev/shm

tmpfs                             5.8G  385M  5.5G   7% /run

tmpfs                             5.8G     0  5.8G   0% /sys/fs/cgroup

/dev/sda1                         462M   62M  373M  15% /boot

/dev/mapper/*****-var   9.2G  616M  8.2G   7% /var

/dev/mapper/*****-home   20G   45M   19G   1% /home

tmpfs                             1.2G     0  1.2G   0% /run/user/537

tmpfs                             1.2G     0  1.2G   0% /run/user/536



[root@**** squid]# cat /proc/cpuinfo

processor       : 0

vendor_id       : GenuineIntel

cpu family      : 6

model           : 44

model name      : Intel(R) Xeon(R) CPU           E5606  @ 2.13GHz

stepping        : 2

microcode       : 0x14

cpu MHz         : 2133.000

cache size      : 8192 KB

physical id     : 0

siblings        : 4

core id         : 0

cpu cores       : 4

apicid          : 0

initial apicid  : 0

fpu             : yes

fpu_exception   : yes

cpuid level     : 11

wp              : yes

flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf pni dtes64 monitor ds_cpl vmx smx est tm2 ssse3 cx16 xtpr pdcm pcid dca sse4_1 sse4_2 popcnt lahf_lm arat epb dtherm tpr_shadow vnmi flexpriority ept vpid

bogomips        : 4267.00

clflush size    : 64

cache_alignment : 64

address sizes   : 40 bits physical, 48 bits virtual

power management:



processor       : 1

vendor_id       : GenuineIntel

cpu family      : 6

model           : 44

model name      : Intel(R) Xeon(R) CPU           E5606  @ 2.13GHz

stepping        : 2

microcode       : 0x14

cpu MHz         : 2133.000

cache size      : 8192 KB

physical id     : 0

siblings        : 4

core id         : 1

cpu cores       : 4

apicid          : 2

initial apicid  : 2

fpu             : yes

fpu_exception   : yes

cpuid level     : 11

wp              : yes

flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf pni dtes64 monitor ds_cpl vmx smx est tm2 ssse3 cx16 xtpr pdcm pcid dca sse4_1 sse4_2 popcnt lahf_lm arat epb dtherm tpr_shadow vnmi flexpriority ept vpid

bogomips        : 4267.00

clflush size    : 64

cache_alignment : 64

address sizes   : 40 bits physical, 48 bits virtual

power management:



processor       : 2

vendor_id       : GenuineIntel

cpu family      : 6

model           : 44

model name      : Intel(R) Xeon(R) CPU           E5606  @ 2.13GHz

stepping        : 2

microcode       : 0x14

cpu MHz         : 2133.000

cache size      : 8192 KB

physical id     : 0

siblings        : 4

core id         : 9

cpu cores       : 4

apicid          : 18

initial apicid  : 18

fpu             : yes

fpu_exception   : yes

cpuid level     : 11

wp              : yes

flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf pni dtes64 monitor ds_cpl vmx smx est tm2 ssse3 cx16 xtpr pdcm pcid dca sse4_1 sse4_2 popcnt lahf_lm arat epb dtherm tpr_shadow vnmi flexpriority ept vpid

bogomips        : 4267.00

clflush size    : 64

cache_alignment : 64

address sizes   : 40 bits physical, 48 bits virtual

power management:



processor       : 3

vendor_id       : GenuineIntel

cpu family      : 6

model           : 44

model name      : Intel(R) Xeon(R) CPU           E5606  @ 2.13GHz

stepping        : 2

microcode       : 0x14

cpu MHz         : 2133.000

cache size      : 8192 KB

physical id     : 0

siblings        : 4

core id         : 10

cpu cores       : 4

apicid          : 20

initial apicid  : 20

fpu             : yes

fpu_exception   : yes

cpuid level     : 11

wp              : yes

flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf pni dtes64 monitor ds_cpl vmx smx est tm2 ssse3 cx16 xtpr pdcm pcid dca sse4_1 sse4_2 popcnt lahf_lm arat epb dtherm tpr_shadow vnmi flexpriority ept vpid

bogomips        : 4267.00

clflush size    : 64

cache_alignment : 64

address sizes   : 40 bits physical, 48 bits virtual

power management:



-----Original Message-----
From: Eliezer Croitoru [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>]
Sent: Thursday, August 10, 2017 9:19 AM
To: Cherukuri, Naresh; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: RE: [squid-users] Crash: every 19 hours: kernel: Out of memory: Kill process (squid)



Hey,



Let start from 0.

How many CPU's and\or core's are on this machine?

Is it a VM?

How many users will be sitting behind this proxy?

Depends on the above we can decide on the right approach.



Eliezer



----

Eliezer Croitoru

Linux System Administrator

Mobile: +972-5-28704261

Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;







-----Original Message-----

From: Cherukuri, Naresh [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ncherukuri at partycity.com</A>]

Sent: Thursday, August 10, 2017 16:03

To: Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;&gt;; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;

Subject: RE: [squid-users] Crash: every 19 hours: kernel: Out of memory:

Kill process (squid)



Hello Eliezer,



We are using OS &quot;Redhat 7&quot; and squid version 3.5.20.



As of now we are not using any cache, we already commented out. You want me try using cache by uncommenting the following line.



# Uncomment and adjust the following to add a disk cache directory.

#cache_dir ufs /cache/squid 10000 16 256



Thanks,

Naresh

-----Original Message-----

From: Eliezer Croitoru [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>]

Sent: Wednesday, August 9, 2017 8:08 PM

To: Cherukuri, Naresh; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;

Subject: RE: [squid-users] Crash: every 19 hours: kernel: Out of memory:

Kill process (squid)



Hey Naresh,



The RAM you need would differ by the nature, hardware and couple other things about the nature of the machine.

What you need is start from the bottom and move up.

List for yourself the machine specs and your goals.

It really helps to start from low ie the default 256MB ram cache and without any cache_dire and then see how it all moves on from there.

For now you are getting to the 19 hours of up time and you need to overcome this so just start with a dry run of no disk cache at all and stick to squid defaults for the next 24-48 hours.

Also what OS are you running?



Eliezer



----

<A HREF="http://ngtech.co.il/lmgtfy/">http://ngtech.co.il/lmgtfy/</A>

Linux System Administrator

Mobile: +972-5-28704261

Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;





From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Cherukuri, Naresh

Sent: Tuesday, August 8, 2017 16:28

To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;

Subject: [squid-users] Crash: every 19 hours: kernel: Out of memory: Kill process (squid)



Hello,



I am new to squid. I am getting a problem every 19 hours squid takes all RAM memory, then started taking swap in  20 minutes my swap is full. Then server side (OOM) is activating and killing all squid child's then finally killing squid parent. Can someone help me how to address this problem?



Why every 19 hours my memory is going to full?



How much Ram do I need for following squid version?



Squid Cache: Version 3.5.20



             total       used       free     shared    buffers     cached

Mem:         11845       2713       9132         14         71       1641 -/+ buffers/cache:       1000      10845

Swap:        25551        421      25130



Thanks,

Naresh




-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170810/6c4cc6cf/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170810/6c4cc6cf/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016120.html">[squid-users] Crash: every 19 hours: kernel: Out of memory:	Kill	process (squid)
</A></li>
	<LI>Next message (by thread): <A HREF="016122.html">[squid-users] Crash: every 19 hours: kernel: Out of memory:	Kill	process (squid)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16121">[ date ]</a>
              <a href="thread.html#16121">[ thread ]</a>
              <a href="subject.html#16121">[ subject ]</a>
              <a href="author.html#16121">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
