<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Crash: every 19 hours: kernel: Out of memory:	Kill	process (squid)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Crash%3A%20every%2019%20hours%3A%20kernel%3A%20Out%20of%20memory%3A%0A%09Kill%09process%20%28squid%29&In-Reply-To=%3C1a4201d31200%241a464870%244ed2d950%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016121.html">
   <LINK REL="Next"  HREF="016123.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Crash: every 19 hours: kernel: Out of memory:	Kill	process (squid)</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Crash%3A%20every%2019%20hours%3A%20kernel%3A%20Out%20of%20memory%3A%0A%09Kill%09process%20%28squid%29&In-Reply-To=%3C1a4201d31200%241a464870%244ed2d950%24%40ngtech.co.il%3E"
       TITLE="[squid-users] Crash: every 19 hours: kernel: Out of memory:	Kill	process (squid)">eliezer at ngtech.co.il
       </A><BR>
    <I>Thu Aug 10 17:42:57 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016121.html">[squid-users] Crash: every 19 hours: kernel: Out of memory: Kill	process (squid)
</A></li>
        <LI>Next message (by thread): <A HREF="016123.html">[squid-users] Crash: every 19 hours: kernel: Out of memory: Kill	process (squid)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16122">[ date ]</a>
              <a href="thread.html#16122">[ thread ]</a>
              <a href="subject.html#16122">[ subject ]</a>
              <a href="author.html#16122">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>For how many users this squid should act as a proxy?
Ie client, machines,networks?

Eliezer

----
<A HREF="http://ngtech.co.il/lmgtfy/">http://ngtech.co.il/lmgtfy/</A>
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>


From: Cherukuri, Naresh [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ncherukuri at partycity.com</A>] 
Sent: Thursday, August 10, 2017 16:27
To: Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;;
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: RE: [squid-users] Crash: every 19 hours: kernel: Out of memory:
Kill process (squid)

No this a physical box and we are using only for squid. We have 4 cpu&#8217;s and
16 cores. Please find below for reference
Accesslogs : redirected to /cache/squid

/dev/mapper/*****-root&#160; 351G&#160; 5.2G&#160; 328G&#160;&#160; 2% /
devtmpfs&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 5.8G&#160;&#160;&#160;&#160; 0&#160; 5.8G&#160;&#160; 0% /dev
tmpfs&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 5.8G&#160; 2.1M&#160; 5.8G&#160;&#160; 1% /dev/shm
tmpfs&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 5.8G&#160; 385M&#160; 5.5G&#160;&#160; 7% /run
tmpfs&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 5.8G&#160;&#160;&#160;&#160; 0&#160; 5.8G&#160;&#160; 0% /sys/fs/cgroup
/dev/sda1&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 462M&#160;&#160; 62M&#160; 373M&#160; 15% /boot
/dev/mapper/*****-var&#160;&#160; 9.2G&#160; 616M&#160; 8.2G&#160;&#160; 7% /var
/dev/mapper/*****-home&#160;&#160; 20G&#160;&#160; 45M&#160;&#160; 19G&#160;&#160; 1% /home
tmpfs&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 1.2G&#160;&#160;&#160;&#160; 0&#160; 1.2G&#160;&#160; 0% /run/user/537
tmpfs&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 1.2G&#160;&#160;&#160;&#160; 0&#160; 1.2G&#160;&#160; 0% /run/user/536

[root@**** squid]# cat /proc/cpuinfo
processor&#160;&#160;&#160;&#160;&#160;&#160; : 0
vendor_id&#160;&#160;&#160;&#160;&#160;&#160; : GenuineIntel
cpu family&#160;&#160;&#160;&#160;&#160; : 6
model&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 44
model name&#160;&#160;&#160;&#160;&#160; : Intel(R) Xeon(R) CPU&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; E5606&#160; @ 2.13GHz
stepping&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 2
microcode&#160;&#160;&#160;&#160;&#160;&#160; : 0x14
cpu MHz&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 2133.000
cache size&#160;&#160;&#160;&#160;&#160; : 8192 KB
physical id&#160;&#160;&#160;&#160; : 0
siblings&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 4
core id&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 0
cpu cores&#160;&#160;&#160;&#160;&#160;&#160; : 4
apicid&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 0
initial apicid&#160; : 0
fpu&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : yes
fpu_exception&#160;&#160; : yes
cpuid level&#160;&#160;&#160;&#160; : 11
wp&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : yes
flags&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca
cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx
pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology
nonstop_tsc aperfmperf pni dtes64 monitor ds_cpl vmx smx est tm2 ssse3 cx16
xtpr pdcm pcid dca sse4_1 sse4_2 popcnt lahf_lm arat epb dtherm tpr_shadow
vnmi flexpriority ept vpid
bogomips&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 4267.00
clflush size&#160;&#160;&#160; : 64
cache_alignment : 64
address sizes&#160;&#160; : 40 bits physical, 48 bits virtual
power management:

processor&#160;&#160;&#160;&#160;&#160;&#160; : 1
vendor_id&#160;&#160;&#160;&#160;&#160;&#160; : GenuineIntel
cpu family&#160;&#160;&#160;&#160;&#160; : 6
model&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 44
model name&#160;&#160;&#160;&#160;&#160; : Intel(R) Xeon(R) CPU&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; E5606&#160; @ 2.13GHz
stepping&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 2
microcode&#160;&#160;&#160;&#160;&#160;&#160; : 0x14
cpu MHz&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 2133.000
cache size&#160;&#160;&#160;&#160;&#160; : 8192 KB
physical id&#160;&#160;&#160;&#160; : 0
siblings&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 4
core id&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 1
cpu cores&#160;&#160;&#160;&#160;&#160;&#160; : 4
apicid&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 2
initial apicid&#160; : 2
fpu&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : yes
fpu_exception&#160;&#160; : yes
cpuid level&#160;&#160;&#160;&#160; : 11
wp&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : yes
flags&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca
cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx
pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology
nonstop_tsc aperfmperf pni dtes64 monitor ds_cpl vmx smx est tm2 ssse3 cx16
xtpr pdcm pcid dca sse4_1 sse4_2 popcnt lahf_lm arat epb dtherm tpr_shadow
vnmi flexpriority ept vpid
bogomips&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 4267.00
clflush size&#160;&#160;&#160; : 64
cache_alignment : 64
address sizes&#160;&#160; : 40 bits physical, 48 bits virtual
power management:

processor&#160;&#160;&#160;&#160;&#160;&#160; : 2
vendor_id&#160;&#160;&#160;&#160;&#160;&#160; : GenuineIntel
cpu family&#160;&#160;&#160;&#160;&#160; : 6
model&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 44
model name&#160;&#160;&#160;&#160;&#160; : Intel(R) Xeon(R) CPU&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; E5606&#160; @ 2.13GHz
stepping&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 2
microcode&#160;&#160;&#160;&#160;&#160;&#160; : 0x14
cpu MHz&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 2133.000
cache size&#160;&#160;&#160;&#160;&#160; : 8192 KB
physical id&#160;&#160;&#160;&#160; : 0
siblings&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 4
core id&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 9
cpu cores&#160;&#160;&#160;&#160;&#160;&#160; : 4
apicid&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 18
initial apicid&#160; : 18
fpu&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : yes
fpu_exception&#160;&#160; : yes
cpuid level&#160;&#160; &#160;&#160;: 11
wp&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : yes
flags&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca
cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx
pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology
nonstop_tsc aperfmperf pni dtes64 monitor ds_cpl vmx smx est tm2 ssse3 cx16
xtpr pdcm pcid dca sse4_1 sse4_2 popcnt lahf_lm arat epb dtherm tpr_shadow
vnmi flexpriority ept vpid
bogomips&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 4267.00
clflush size&#160;&#160;&#160; : 64
cache_alignment : 64
address sizes&#160;&#160; : 40 bits physical, 48 bits virtual
power management:

processor&#160;&#160;&#160;&#160;&#160;&#160; : 3
vendor_id&#160;&#160;&#160;&#160;&#160;&#160; : GenuineIntel
cpu family&#160;&#160;&#160;&#160;&#160; : 6
model&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 44
model name&#160;&#160;&#160;&#160;&#160; : Intel(R) Xeon(R) CPU&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; E5606&#160; @ 2.13GHz
stepping&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 2
microcode&#160;&#160;&#160;&#160;&#160;&#160; : 0x14
cpu MHz&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 2133.000
cache size&#160;&#160;&#160;&#160;&#160; : 8192 KB
physical id&#160;&#160;&#160;&#160; : 0
siblings&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 4
core id&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 10
cpu cores&#160;&#160;&#160;&#160;&#160;&#160; : 4
apicid&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 20
initial apicid&#160; : 20
fpu&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : yes
fpu_exception&#160;&#160; : yes
cpuid level&#160; &#160;&#160;&#160;: 11
wp&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : yes
flags&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca
cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx
pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology
nonstop_tsc aperfmperf pni dtes64 monitor ds_cpl vmx smx est tm2 ssse3 cx16
xtpr pdcm pcid dca sse4_1 sse4_2 popcnt lahf_lm arat epb dtherm tpr_shadow
vnmi flexpriority ept vpid
bogomips&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 4267.00
clflush size&#160;&#160;&#160; : 64
cache_alignment : 64
address sizes&#160;&#160; : 40 bits physical, 48 bits virtual
power management:

-----Original Message-----
From: Eliezer Croitoru [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>] 
Sent: Thursday, August 10, 2017 9:19 AM
To: Cherukuri, Naresh; mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: RE: [squid-users] Crash: every 19 hours: kernel: Out of memory:
Kill process (squid)

Hey,

Let start from 0.
How many CPU's and\or core's are on this machine?
Is it a VM?
How many users will be sitting behind this proxy?
Depends on the above we can decide on the right approach.

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>



-----Original Message-----
From: Cherukuri, Naresh [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ncherukuri at partycity.com</A>]
Sent: Thursday, August 10, 2017 16:03
To: Eliezer Croitoru &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;;
mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: RE: [squid-users] Crash: every 19 hours: kernel: Out of memory:
Kill process (squid)

Hello Eliezer,

We are using OS &quot;Redhat 7&quot; and squid version 3.5.20. 

As of now we are not using any cache, we already commented out. You want me
try using cache by uncommenting the following line. 

# Uncomment and adjust the following to add a disk cache directory.
#cache_dir ufs /cache/squid 10000 16 256

Thanks,
Naresh
-----Original Message-----
From: Eliezer Croitoru [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>]
Sent: Wednesday, August 9, 2017 8:08 PM
To: Cherukuri, Naresh; mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: RE: [squid-users] Crash: every 19 hours: kernel: Out of memory:
Kill process (squid)

Hey Naresh,

The RAM you need would differ by the nature, hardware and couple other
things about the nature of the machine.
What you need is start from the bottom and move up.
List for yourself the machine specs and your goals.
It really helps to start from low ie the default 256MB ram cache and without
any cache_dire and then see how it all moves on from there.
For now you are getting to the 19 hours of up time and you need to overcome
this so just start with a dry run of no disk cache at all and stick to squid
defaults for the next 24-48 hours.
Also what OS are you running?

Eliezer

----
<A HREF="http://ngtech.co.il/lmgtfy/">http://ngtech.co.il/lmgtfy/</A>
Linux System Administrator
Mobile: +972-5-28704261
Email: mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>


From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On
Behalf Of Cherukuri, Naresh
Sent: Tuesday, August 8, 2017 16:28
To: mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [squid-users] Crash: every 19 hours: kernel: Out of memory: Kill
process (squid)

Hello,

I am new to squid. I am getting a problem every 19 hours squid takes all RAM
memory, then started taking swap in &#160;20 minutes my swap is full. Then server
side (OOM) is activating and killing all squid child's then finally killing
squid parent. Can someone help me how to address this problem? 

Why every 19 hours my memory is going to full?

How much Ram do I need for following squid version?

Squid Cache: Version 3.5.20

&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; total&#160;&#160;&#160;&#160;&#160;&#160; used&#160;&#160;&#160;&#160;&#160;&#160; free&#160;&#160;&#160;&#160; shared&#160;&#160;&#160; buffers&#160;&#160;&#160;&#160; cached
Mem:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 11845&#160;&#160;&#160;&#160;&#160;&#160; 2713&#160;&#160;&#160;&#160;&#160;&#160; 9132&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 14&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 71&#160;&#160;&#160;&#160;&#160;&#160; 1641
-/+ buffers/cache:&#160;&#160;&#160;&#160;&#160;&#160; 1000&#160;&#160;&#160;&#160;&#160; 10845
Swap:&#160;&#160;&#160;&#160;&#160;&#160;&#160; 25551 &#160;&#160;&#160;&#160;&#160;&#160;&#160;421&#160;&#160;&#160;&#160;&#160; 25130

Thanks,
Naresh




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016121.html">[squid-users] Crash: every 19 hours: kernel: Out of memory: Kill	process (squid)
</A></li>
	<LI>Next message (by thread): <A HREF="016123.html">[squid-users] Crash: every 19 hours: kernel: Out of memory: Kill	process (squid)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16122">[ date ]</a>
              <a href="thread.html#16122">[ thread ]</a>
              <a href="subject.html#16122">[ subject ]</a>
              <a href="author.html#16122">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
