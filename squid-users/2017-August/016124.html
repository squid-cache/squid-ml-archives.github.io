<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Crash: every 19 hours: kernel: Out of memory: Kill process (squid)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Crash%3A%20every%2019%20hours%3A%20kernel%3A%20Out%20of%20memory%3A%0A%20Kill%20process%20%28squid%29&In-Reply-To=%3Cd24f9d79-f107-ca72-7805-b155587958eb%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016123.html">
   <LINK REL="Next"  HREF="016129.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Crash: every 19 hours: kernel: Out of memory: Kill process (squid)</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Crash%3A%20every%2019%20hours%3A%20kernel%3A%20Out%20of%20memory%3A%0A%20Kill%20process%20%28squid%29&In-Reply-To=%3Cd24f9d79-f107-ca72-7805-b155587958eb%40treenet.co.nz%3E"
       TITLE="[squid-users] Crash: every 19 hours: kernel: Out of memory: Kill process (squid)">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Aug 11 04:50:43 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016123.html">[squid-users] Crash: every 19 hours: kernel: Out of memory: Kill	process (squid)
</A></li>
        <LI>Next message (by thread): <A HREF="016129.html">[squid-users] Crash: every 19 hours: kernel: Out of memory: Kill process (squid)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16124">[ date ]</a>
              <a href="thread.html#16124">[ thread ]</a>
              <a href="subject.html#16124">[ subject ]</a>
              <a href="author.html#16124">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/08/17 06:36, Cherukuri, Naresh wrote:
&gt;<i> Eliezer,
</I>&gt;<i> 
</I>&gt;<i> I cannot say by client or network. But, for sure I can say we have around 7000 computers using squid as a proxy.
</I>&gt;<i> 
</I>
FYI: that number means peak load may be as high as 70K RPS (~100 
req/client), a quad-core machine might be able to handle that but the 
2.13 GHz CPU speed makes me doubtful. I'd plan for up to 4 machines of 
this type to be built in the medium-long term.


&gt;<i> 
</I>&gt;<i> From: Cherukuri, Naresh
</I>&gt;<i> Sent: Thursday, August 10, 2017 16:27
</I>&gt;<i> 
</I>&gt;<i> No this a physical box and we are using only for squid. We have 4 cpu's and
</I>&gt;<i> 16 cores. Please find below for reference Accesslogs : redirected to /cache/squid
</I>&gt;<i> 
</I>
NP: I don't see any access logs details in your post. Just CPU specs and 
disk FS mappings.


&gt;<i> -----Original Message-----
</I>&gt;<i> From: Cherukuri, Naresh
</I>&gt;<i> Sent: Thursday, August 10, 2017 16:03
</I>&gt;<i> 
</I>&gt;<i> Hello Eliezer,
</I>&gt;<i> 
</I>&gt;<i> We are using OS &quot;Redhat 7&quot; and squid version 3.5.20.
</I>&gt;<i> 
</I>&gt;<i> As of now we are not using any cache, we already commented out. You want me try using cache by uncommenting the following line.
</I>&gt;<i> 
</I>&gt;<i> # Uncomment and adjust the following to add a disk cache directory.
</I>&gt;<i> #cache_dir ufs /cache/squid 10000 16 256
</I>&gt;<i> 
</I>
No, suggestion was for the default memory-only cache. Which means no 
cache_mem or cache_dir entries in your squid.conf (letting Squid use its 
defaults). It should still be caching, just much less.


&gt;<i> From: squid-users On Behalf Of Cherukuri, Naresh
</I>&gt;<i> Sent: Tuesday, August 8, 2017 16:28
</I>&gt;<i> 
</I>&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> I am new to squid. I am getting a problem every 19 hours squid takes all RAM memory, then started taking swap in  20 minutes my swap is full. Then server side (OOM) is activating and killing all squid child's then finally killing squid parent. Can someone help me how to address this problem?
</I>&gt;<i> 
</I>
FYI: My brief understanding of the OOM is that when the sum total of all 
processes on the machine start consuming too mush RAM it kills off the 
largest user. So it may be that Squid is using some large (but 
reasonable) amount of RAM and something else entirely pushes it over the 
edge - OOM just killing Squid because it has the most memory at that time.

So, if you have any record of the machines memory usage by process over 
time it would be good to know for certain whether it is Squid alone, or 
squid + something else that is the problem. Something along the lines of 
a log processor that kicks in once a day and uses lots of RAM briefly 
may exist.


&gt;<i> Why every 19 hours my memory is going to full?
</I>&gt;<i> 
</I>&gt;<i> How much Ram do I need for following squid version?
</I>&gt;<i> 
</I>&gt;<i> Squid Cache: Version 3.5.20
</I>&gt;<i> 
</I>&gt;<i>               total       used       free     shared    buffers     cached
</I>&gt;<i> Mem:         11845       2713       9132         14         71       1641 -/+ buffers/cache:       1000      10845
</I>&gt;<i> Swap:        25551        421      25130
</I>

The biggest problem I see here is that there are no units. These could 
be KB or GB for all we know.


Please clarify that missing info.


FWIW: Squid with some minimal tuning runs fine on embeded devices with 
32MB of RAM and has not had a memory leak in a long time. So it is 
usually a matter of some feature misconfigured. That said there is an 
issue with OpenSSL objects that can look like a memory leak in 3.x if 
one is not careful.

To see if anything is misconfigured please post your squid.conf (without 
the #commented out lines) so we can review it for problems.



Cheers
Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016123.html">[squid-users] Crash: every 19 hours: kernel: Out of memory: Kill	process (squid)
</A></li>
	<LI>Next message (by thread): <A HREF="016129.html">[squid-users] Crash: every 19 hours: kernel: Out of memory: Kill process (squid)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16124">[ date ]</a>
              <a href="thread.html#16124">[ thread ]</a>
              <a href="subject.html#16124">[ subject ]</a>
              <a href="author.html#16124">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
