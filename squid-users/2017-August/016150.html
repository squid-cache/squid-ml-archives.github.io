<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid IPv4:port to IPv6
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20IPv4%3Aport%20to%20IPv6&In-Reply-To=%3C7cef6c46-4660-b472-0811-bb90dd896130%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016149.html">
   <LINK REL="Next"  HREF="016154.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid IPv4:port to IPv6</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20IPv4%3Aport%20to%20IPv6&In-Reply-To=%3C7cef6c46-4660-b472-0811-bb90dd896130%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid IPv4:port to IPv6">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Aug 19 12:43:04 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016149.html">[squid-users] Squid IPv4:port to IPv6
</A></li>
        <LI>Next message (by thread): <A HREF="016154.html">[squid-users] Content Adaptation with HTTPs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16150">[ date ]</a>
              <a href="thread.html#16150">[ thread ]</a>
              <a href="subject.html#16150">[ subject ]</a>
              <a href="author.html#16150">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 19/08/17 18:15, Walter H. wrote:
&gt;<i> On 19.08.2017 04:03, davidjesse091 wrote:
</I>&gt;&gt;<i> I'm trying to connect to Squid with one IPv4 IP and based on the port 
</I>&gt;&gt;<i> I'm connecting with, I want Squid to use a different IPv6 IP for the 
</I>&gt;&gt;<i> connection.
</I>
NP: you are making two wrong assumptions here.

1) that Squid only uses outbound IPv6.

Ideally it would, but not all servers are IPv6-enabled, nor the 
connection to any that are guaranteed to be working. As a proxy part of 
Squids job is to detect failures and seamlessly workaround them &quot;at 
line-speed&quot;.


2) that the inbound connection has any relationship to the outbound one.

HTTP is stateless and multiplexed. That means any client request can go 
out any outbound connection, or none, or *multiple* servers. Likewise 
for server responses being delivered to any client, or none, or multiple 
clients.

HTTP and Squid permit what you are doing, but neither implies anything 
about whether it is a good idea or not. Be aware that by forcing 
specific traffic flows you are artificially inhibiting what Squid can do 
and potentially causing breakage in normal HTTP behaviour.


&gt;&gt;<i>
</I>&gt;&gt;<i> Below is my config file
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> |acl SSL_ports port 443 acl Safe_ports port 80 acl Safe_ports port 21 
</I>&gt;&gt;<i> acl Safe_ports port 443 acl Safe_ports port 70 acl Safe_ports port 210 
</I>&gt;&gt;<i> acl Safe_ports port 1025-65535 acl Safe_ports port 280 acl Safe_ports 
</I>&gt;&gt;<i> port 488 acl Safe_ports port 591 acl Safe_ports port 777 acl CONNECT 
</I>&gt;&gt;<i> method CONNECT http_access deny !Safe_ports http_access deny CONNECT 
</I>&gt;&gt;<i> !SSL_ports http_access allow localhost manager http_access deny 
</I>&gt;&gt;<i> manager http_access allow localhost #http_access deny all http_port 
</I>&gt;&gt;<i> 3128 coredump_dir /var/spool/squid refresh_pattern ^ftp: 1440 20% 
</I>&gt;&gt;<i> 10080 refresh_pattern ^gopher: 1440 0% 1440 refresh_pattern -i 
</I>&gt;&gt;<i> (/cgi-bin/|\?) 0 0% 0 refresh_pattern . 0 20% 4320
</I>
&gt;&gt;<i> # Allow all 
</I>&gt;&gt;<i> machines to all sites http_access allow all
</I>
Really *anybody* on the entire Internet is allowed to use this 
anonymizing proxy to perform any abuse they want to?
  Including bypassing hardware-level protection on your 'lo' NIC 
hardware to attack the proxy machine from the inside?
  uh.

There are definitely far better ways to configure client access. But we 
need to know what your intended use of the proxy really is make good 
suggestions.



&gt;&gt;<i> #Privacy Things via off 
</I>&gt;&gt;<i> forwarded_for off follow_x_forwarded_for deny all
</I>
Question is &quot;privacy for whom?&quot; - these settings are hiding the proxy. 
Increasing the *proxy* privacy. While leaving the client details exposed 
to servers.

If you are seeking to increase client and end-user privacy, you want to 
be telling the server that there is a proxy in the way so it cannot 
trust any of the 'user' values it sees to be user-unique.



&gt;&gt;<i>  ## designate acl 
</I>&gt;&gt;<i> based on inbound connection name acl user1 myportname 3128 acl user2 
</I>&gt;&gt;<i> myportname 3129 acl user3 myportname 3130 acl user4 myportname 3131 
</I>&gt;&gt;<i> acl user5 myportname 3132 ## define outgoing IPv6 per user 
</I>&gt;&gt;<i> tcp_outgoing_address 2000:3c03:e000:25f::1:0 user1 
</I>&gt;&gt;<i> tcp_outgoing_address 2000:3c03:e000:25f::1:1 user2 
</I>&gt;&gt;<i> tcp_outgoing_address 2000:3c03:e000:25f::1:2 user3 
</I>&gt;&gt;<i> tcp_outgoing_address 2000:3c03:e000:25f::1:3 user4 
</I>&gt;&gt;<i> tcp_outgoing_address 2000:3c03:e000:25f::1:4 user5|
</I>&gt;&gt;<i>
</I>
Here you are mixing up the concepts of authentication, IP address, and 
port numbers in a way which is horribly confusing.

The entity which connects to a port is a *client* not a user.


A) Why don't you let Squid just perform HTTP the way it is supposed to work?
  HTTP is stateless with proxying as a designed part of the protocol. 
The more people go out of their way to hide proxies existence from 
server scripts the more the server-side script developers write broken 
code assuming proxies don't exist. Reality is that almost all web 
traffic goes through at least a handful of proxies. Bad scripts need to 
be eradicated and the only way that is going to happen is if it is made 
very clear to the naive authors how broken they are.

B) If you really have to break the stateless behaviour of HTTP why not 
use the clients IP (or Squid receiving IP) instead of the Squid 
receiving port?



&gt;&gt;<i>
</I>&gt;&gt;<i> The issue I'm facing is that I can only use the proxy with port 3128, 
</I>&gt;&gt;<i> and it does proxy it to &quot;2000:3c03:e000:25f::1:0&quot; as it should. But if 
</I>&gt;&gt;<i> I use port 3129 then I can not connect to the proxy.
</I>&gt;<i> because you only have
</I>&gt;<i> http_port 3128
</I>&gt;<i> you also need
</I>&gt;<i> http_port 3129
</I>&gt;<i> http_port 3130
</I>&gt;<i> http_port 3131
</I>&gt;<i> http_port 3132
</I>&gt;<i> and in case there is a firewall, these ports must be open, too ...
</I>&gt;<i> 
</I>&gt;<i> by the way this setting only makes sense, when there is a restriction, 
</I>&gt;<i> that only a specific IP can use port 3128,
</I>&gt;<i> a specific IP can use port 3129, ....
</I>&gt;<i> need not be IPv4 can also be IPv6 ...
</I>&gt;<i> 
</I>&gt;<i> Walter
</I>&gt;<i> 
</I>
As Walter said that is your current problem. But when you get over that 
you will hit the ones I've mentioned above - though they may not be 
easily noticed.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016149.html">[squid-users] Squid IPv4:port to IPv6
</A></li>
	<LI>Next message (by thread): <A HREF="016154.html">[squid-users] Content Adaptation with HTTPs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16150">[ date ]</a>
              <a href="thread.html#16150">[ thread ]</a>
              <a href="subject.html#16150">[ subject ]</a>
              <a href="author.html#16150">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
