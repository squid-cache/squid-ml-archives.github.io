<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Content Adaptation with HTTPs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Content%20Adaptation%20with%20HTTPs&In-Reply-To=%3C43feabd1-8744-2692-0959-faa3b07601ed%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016159.html">
   <LINK REL="Next"  HREF="016164.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Content Adaptation with HTTPs</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Content%20Adaptation%20with%20HTTPs&In-Reply-To=%3C43feabd1-8744-2692-0959-faa3b07601ed%40treenet.co.nz%3E"
       TITLE="[squid-users] Content Adaptation with HTTPs">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Aug 20 08:19:11 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016159.html">[squid-users] Content Adaptation with HTTPs
</A></li>
        <LI>Next message (by thread): <A HREF="016164.html">[squid-users] Content Adaptation with HTTPs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16160">[ date ]</a>
              <a href="thread.html#16160">[ thread ]</a>
              <a href="subject.html#16160">[ subject ]</a>
              <a href="author.html#16160">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 20/08/17 16:05, Christopher Ahrens wrote:
&gt;<i> 
</I>&gt;<i> The current solution doesn't work for me since it only supports a very 
</I>&gt;<i> limited number of clients.  I am working with a charity that provides 
</I>&gt;<i> internet services to those with impaired vision, the intention of my 
</I>&gt;<i> project was to set up a semi-public proxy for recipient of the charity 
</I>&gt;<i> (EG, we would install DD-WRT like routers within their homes that would 
</I>&gt;<i> create a tunnel into our network so that they could browse the internet 
</I>&gt;<i> using off-the-shelf systems.  We recently received a large number of 
</I>&gt;<i> tablets form a corporate donor, the tablets themselves will work for our 
</I>&gt;<i> recipients, but unfortunately the internet at large does not.
</I>
FYI: If you can get the adaptation part to be small enough a non-caching 
Squid should be able to run on those WRT-like devices with under 32 MB 
of RAM needed. So the tunnel may not be necessary, just a way to update 
the software and its config.

&gt;<i> 
</I>&gt;<i> We've looked into commercial systems in the past, but we cannot afford 
</I>&gt;<i> the cost of commercial systems, especially since we are unsure about the 
</I>&gt;<i> exact licensing that would be needed for our endeavor.  We have also 
</I>&gt;<i> been burnt in the past with commercial software where the project either 
</I>&gt;<i> goes dead, begins to require insanely expensive appliances, or the 
</I>&gt;<i> license price is sent sky-high.
</I>&gt;<i> 
</I>&gt;<i> Would it be possible to use a setup of Squid &lt;-&gt; Privoxy &lt;-&gt; Squid to 
</I>&gt;<i> execute this?  I figure we'd build an internal instance that will handle 
</I>&gt;<i> the client&lt;-&gt;proxy part, Privoxy handles the content modification, then 
</I>&gt;<i> a second Squid instance to handle the web server&lt;-&gt;proxy part.
</I>
Squid will only send SSL-Bump'ed HTTPS traffic over encrypted 
connections. So that is only possible if privoxy accepts TLS connections 
from Squid. In which case you probably do not need the second Squid, as 
privoxy would also be doing the HTTPS to-server part easily enough itself.


&gt;<i> 
</I>&gt;<i> SO it looks like the solution would be to find a developer to write an 
</I>&gt;<i> ECAP to cycle through regexes to replace/remove HTML/CSS content.  So 
</I>&gt;<i> time to dig out my old C++ books and get to work...
</I>
If the existing ICAP/eCAP options are not suitable, then yes a custom 
one would be needed.

It is not as easy as a few regex replacements though. Adaptors are 
streamed the full on-wire HTTP message format with only minor 
sanitization by Squids parser. To alter the content you will have to 
deal with data encodings, object ranges, partially received objects. And 
it is best to assume everything is of infinite length unless explicitly 
told otherwise - so no buffer-then-adapt code.
  eCAP is simpler than ICAP, but still has to deal with these HTTP features.

Those are a big part of why available software is so sparse. The other 
part being that HTTP traffic payloads are copyright content, so there 
are legal issues with selling software for the purpose of altering 
copyright content sans authors permission.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016159.html">[squid-users] Content Adaptation with HTTPs
</A></li>
	<LI>Next message (by thread): <A HREF="016164.html">[squid-users] Content Adaptation with HTTPs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16160">[ date ]</a>
              <a href="thread.html#16160">[ thread ]</a>
              <a href="subject.html#16160">[ subject ]</a>
              <a href="author.html#16160">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
