<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] IPv6 and TPROXY
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20IPv6%20and%20TPROXY&In-Reply-To=%3C02a401d319aa%2415879c60%244096d520%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016157.html">
   <LINK REL="Next"  HREF="016163.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] IPv6 and TPROXY</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20IPv6%20and%20TPROXY&In-Reply-To=%3C02a401d319aa%2415879c60%244096d520%24%40ngtech.co.il%3E"
       TITLE="[squid-users] IPv6 and TPROXY">eliezer at ngtech.co.il
       </A><BR>
    <I>Sun Aug 20 11:47:21 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016157.html">[squid-users] IPv6 and TPROXY
</A></li>
        <LI>Next message (by thread): <A HREF="016163.html">[squid-users] IPv6 and TPROXY
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16162">[ date ]</a>
              <a href="thread.html#16162">[ thread ]</a>
              <a href="subject.html#16162">[ subject ]</a>
              <a href="author.html#16162">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am still waiting for couple answers about the system and the setup.
Also to resolve the issue it will be required to know if the issue is on squid side or the kernel side(ipv6 related) or iptables rules.
All of the above will allow us to help Walter make this system work.

And Amos, about the part of avoiding using tproxy for the outgoing traffic and only use it to intercept the connections:
For a CentOS 6 system it's the only option to run an INTERCEPT proxy which hides the client IPv6 address so I think it's something that need to be documented somewhere in the wiki.
I would be happy to write the article if I would have known how to disable tproxy for the outgoing traffic.

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>



-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Amos Jeffries
Sent: Sunday, August 20, 2017 03:45
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] IPv6 and TPROXY

On 20/08/17 12:08, Eliezer Croitoru wrote:
&gt;<i> You can use tproxy but you will need to somehow make it so squid will do &quot;NAT&quot; instead of only tproxy or to findout what is causing the issue to happen in the network layer of the connection.
</I>&gt;<i> It can be a simple iptables rule which block traffic or another issue like rp_filter.
</I>&gt;<i> If you are up to it I will be willing to try and setup a more advanced ipv6 setup that might help to inspect the issue.
</I>&gt;<i> 
</I>&gt;<i> In the mean while I am missing one piece which maybe Amos can help with:
</I>&gt;<i> Is it possible to use tproxy for interception but force a non tproxy connection on the outgoing traffic?
</I>
I'm not sure what problem that would solve. If TPROXY is not working 
fully it wont magically start half-working.

AFAICS, Walters problem with TPROXY is that his firewall rules are setup 
for accepting only traffic with 2001::/16 IP addresses. With TPROXY the 
original 2a02::/16 IP remains present so the rules based on 2001::/16 
wont let the traffic into the proxy.

Amos
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016157.html">[squid-users] IPv6 and TPROXY
</A></li>
	<LI>Next message (by thread): <A HREF="016163.html">[squid-users] IPv6 and TPROXY
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16162">[ date ]</a>
              <a href="thread.html#16162">[ thread ]</a>
              <a href="subject.html#16162">[ subject ]</a>
              <a href="author.html#16162">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
