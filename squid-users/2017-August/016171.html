<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] client--&gt;iptables--&gt;squid-proxy-&gt;another-proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20client--%3Eiptables--%3Esquid-proxy-%3Eanother-proxy&In-Reply-To=%3C5f60efb0-61fb-89e8-106e-910e45a9b337%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016167.html">
   <LINK REL="Next"  HREF="016168.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] client--&gt;iptables--&gt;squid-proxy-&gt;another-proxy</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20client--%3Eiptables--%3Esquid-proxy-%3Eanother-proxy&In-Reply-To=%3C5f60efb0-61fb-89e8-106e-910e45a9b337%40treenet.co.nz%3E"
       TITLE="[squid-users] client--&gt;iptables--&gt;squid-proxy-&gt;another-proxy">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Aug 21 15:20:47 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016167.html">[squid-users] client--&gt;iptables--&gt;squid-proxy-&gt;another-proxy
</A></li>
        <LI>Next message (by thread): <A HREF="016168.html">[squid-users] Introducing Charcoal - Centralised URL Filter for squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16171">[ date ]</a>
              <a href="thread.html#16171">[ thread ]</a>
              <a href="subject.html#16171">[ subject ]</a>
              <a href="author.html#16171">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 21/08/17 09:53, Diogenes S. Jesus wrote:
&gt;<i> Hi Amos. Thanks for pointing it out - but this has never been an 
</I>&gt;<i> acl-related issue, more like a https_port / ssl-bump configuration 
</I>&gt;<i> question when the upstream ssl request was not sending a &quot;CONNECT 
</I>&gt;<i> www.example.org:443 &lt;<A HREF="http://www.example.org:443">http://www.example.org:443</A>&gt;&quot; but a &quot;GET 
</I>&gt;<i> <A HREF="htttps://www.example.org">htttps://www.example.org</A> &lt;<A HREF="http://www.example.org">http://www.example.org</A>&gt;&quot;.
</I>&gt;<i> 
</I>
There are a couple of things wrong with that.

Firstly, port 443 traffic does not validly contain &quot;GET <A HREF="https://...">https://...</A>&quot; 
requests. It should only contain origin-form requests same as port 80. 
The 'https' part is generated by Squid from the fact those requests are 
received by an https_port and thus must have been wrapped by TLS/SSL for 
the HTTP portion to become handled by Squid.


Secondly, Squid internally generates synthetic/fake CONNECT messages to 
represent the intercepted traffic on an https_port. Simulating HTTPS 
sent through a forward/explicit proxy. At step1 that is done with the 
TCP SYN packet details, at step2 with the client TLS SNI details.
  Splice simply tells bumping not to decrypt any CONNECT message, 
including those synthetic ones. The Squid-generated CONNECT is then 
caused to be sent upstream to the peer by not being unwrapped/decrypted. 
This type of generated CONNECT is implemented any nobody having trouble 
with it that I'm aware of.


Thirdly, What is being asked for by JerlyCook and others is some form of 
filtering to be done at the front-end proxy for <A HREF="https://">https://</A> traffic before 
it gets sent to the parent/sibling proxy. So splicing is not always a 
viable choice for those use-cases even if it is technically the best and 
safest thing to do.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016167.html">[squid-users] client--&gt;iptables--&gt;squid-proxy-&gt;another-proxy
</A></li>
	<LI>Next message (by thread): <A HREF="016168.html">[squid-users] Introducing Charcoal - Centralised URL Filter for squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16171">[ date ]</a>
              <a href="thread.html#16171">[ thread ]</a>
              <a href="subject.html#16171">[ subject ]</a>
              <a href="author.html#16171">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
