<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] extract http headers from CONNECT / bumped ssl?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20extract%20http%20headers%20from%20CONNECT%20/%20bumped%20ssl%3F&In-Reply-To=%3Cc85b1970-51af-2c94-f78a-cad1bbb645f2%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016202.html">
   <LINK REL="Next"  HREF="016211.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] extract http headers from CONNECT / bumped ssl?</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20extract%20http%20headers%20from%20CONNECT%20/%20bumped%20ssl%3F&In-Reply-To=%3Cc85b1970-51af-2c94-f78a-cad1bbb645f2%40treenet.co.nz%3E"
       TITLE="[squid-users] extract http headers from CONNECT / bumped ssl?">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Aug 25 08:35:51 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016202.html">[squid-users] extract http headers from CONNECT / bumped ssl?
</A></li>
        <LI>Next message (by thread): <A HREF="016211.html">[squid-users] extract http headers from CONNECT / bumped ssl?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16205">[ date ]</a>
              <a href="thread.html#16205">[ thread ]</a>
              <a href="subject.html#16205">[ subject ]</a>
              <a href="author.html#16205">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 25/08/17 15:37, Alex Rousskov wrote:
&gt;<i> On 08/24/2017 06:31 PM, Aaron Turner wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> Actually, looks like I was misunderstanding the access.log, it was working:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 1503620688.280      0 10.93.3.85 TAG_NONE/200 0 CONNECT synfin.net:443
</I>&gt;&gt;<i> - HIER_NONE/- - ip_index=0,client=-
</I>&gt;&gt;<i> 1503620689.241    947 10.93.3.85 TCP_MISS/200 57810 GET
</I>&gt;&gt;<i> <A HREF="https://synfin.net/sock_stream/">https://synfin.net/sock_stream/</A> - HIER_DIRECT/45.79.73.39 text/html
</I>&gt;&gt;<i> ip_index=2,client=foobar1
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I didn't initially understand that each CONNECT then generates a
</I>&gt;&gt;<i> second entry.
</I>&gt;<i> 
</I>&gt;<i> Each bumped CONNECT tunnel generates one or two CONNECT entries
</I>&gt;<i> (depending on the configuration) followed by zero or more HTTP requests
</I>&gt;<i> found inside the decrypted tunnel.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> external_acl_type client_ip_map_0 %&gt;{My-Custom-Client-Id}
</I>&gt;&gt;&gt;&gt;<i> /usr/lib64/squid/user_loadbalance.py 0 4
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i> That is not your actual external_acl_type line, I hope. The %&gt;h part
</I>&gt;&gt;&gt;<i> looks malformed.
</I>&gt;<i> 
</I>&gt;&gt;<i> Really?  Works and seems to match the instructions indicating &quot;%&gt;{Header}&quot;
</I>&gt;<i> 
</I>&gt;<i> If some instructions imply that omitting &quot;h&quot; from &quot;%&gt;h&quot; is a good idea,
</I>&gt;<i> then I do not recommend following them, even if omiting &quot;h&quot; works.
</I>&gt;<i> 
</I>&gt;<i> The {header-field-name} parameter is fine. It is the missing &quot;h&quot; that I
</I>&gt;<i> would worry about.
</I>

FWIW: The non-h forms are only accepted by current Squid-3 for backward 
compatibility and should be producing a high level WARNING on use. That 
has been removed with Squid-4.
  (thanks for the reminder I'm going to have to mention that in the 
release notes).


Please run &quot;squid -k parse&quot; and fix any config problems it highlights. 
This command should be used after upgrades and when editing the config 
to make sure it will actually do what you want in production.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016202.html">[squid-users] extract http headers from CONNECT / bumped ssl?
</A></li>
	<LI>Next message (by thread): <A HREF="016211.html">[squid-users] extract http headers from CONNECT / bumped ssl?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16205">[ date ]</a>
              <a href="thread.html#16205">[ thread ]</a>
              <a href="subject.html#16205">[ subject ]</a>
              <a href="author.html#16205">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
