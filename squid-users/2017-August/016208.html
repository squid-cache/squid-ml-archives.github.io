<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid stops replying
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20stops%20replying&In-Reply-To=%3Ce6caa8ab-16c8-5d54-9a41-bf2ba017c393%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016204.html">
   <LINK REL="Next"  HREF="016219.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid stops replying</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20stops%20replying&In-Reply-To=%3Ce6caa8ab-16c8-5d54-9a41-bf2ba017c393%40treenet.co.nz%3E"
       TITLE="[squid-users] squid stops replying">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Aug 25 09:51:19 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016204.html">[squid-users] squid stops replying
</A></li>
        <LI>Next message (by thread): <A HREF="016219.html">[squid-users] squid stops replying
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16208">[ date ]</a>
              <a href="thread.html#16208">[ thread ]</a>
              <a href="subject.html#16208">[ subject ]</a>
              <a href="author.html#16208">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 25/08/17 20:34, Vieri wrote:
&gt;<i> ________________________________
</I>&gt;<i> From: Amos Jeffries
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> At ALL,9 that is a sign of major trouble. The log data is not going
</I>&gt;<i> 
</I>&gt;&gt;<i> where it should be. Please check your squid.conf that it is not sending
</I>&gt;&gt;<i> cache_log directive to /dev/null, a pipe or something.
</I>&gt;<i> I do not define cache_log, so it should take the default value of &quot;/var/log/squid/cache.log&quot;.
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i> # ps -ae | grep squid
</I>&gt;&gt;&gt;<i> 4439 ?        05:29:57 squid
</I>&gt;&gt;&gt;<i> 9059 ?        00:00:00 squid
</I>&gt;&gt;&gt;<i> 9160 ?        00:00:00 squid
</I>&gt;&gt;&gt;<i> 9162 ?        00:11:42 squid
</I>&gt;&gt;&gt;<i> 9206 ?        00:00:00 squid
</I>&gt;&gt;&gt;<i> 9208 ?        00:02:04 squid
</I>&gt;&gt;&gt;<i> 9254 ?        00:00:00 squid
</I>&gt;&gt;&gt;<i> 9257 ?        00:00:28 squid
</I>&gt;&gt;&gt;<i> 9313 ?        00:00:00 squid
</I>&gt;&gt;&gt;<i> 9315 ?        00:00:55 squid
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> That seems a lot. What exactly are those processes each doing?
</I>&gt;&gt;<i>    &quot;ps aux | grep squid&quot; should show the process roles.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> There are 4 reverse proxies, each one with their own squid conf file, and a caching HTTP/S proxy (tproxy).
</I>&gt;<i> The one failing is the latter.
</I>
cache_log is one of the Squid directives which require a unique file 
path+name per instance when running multiple instances.

As the wiki page &lt;<A HREF="https://wiki.squid-cache.org/MultipleInstances">https://wiki.squid-cache.org/MultipleInstances</A>&gt; says, 
it *might* work but the result is *probably* a garbled mess. And in your 
case I'm relatively sure that some critical information is being 
delivered into nul-space.

Also there will be issues with shared memory and such things on current 
Squid if you run multiple instances on one machine without proper 
instance naming - this will happen for some things even if you are not 
using SMP workers.
  Add the -n (lower case) command line option to your startup script(s), 
with a unique instance name for each.

First thing to do is fix the above issues. Then whatever the pause is 
about will be much easier to track down.


&gt;<i> 
</I>&gt;<i> Here's the process list (also includes external processes):
</I>&gt;<i> 
</I>&gt;<i> # ps aux | grep squid
</I>&gt;<i> squid     7139  7.9  0.6 276064 200472 ?       S    10:10   1:11 (squid-1) -YC -f /etc/squid/squid.conf
</I>&gt;<i> squid     7156  0.0  0.0   4012   640 ?        S    10:10   0:00 (unlinkd)
</I>&gt;<i> squid     7157  0.0  0.0  13904  3292 ?        S    10:10   0:00 diskd 7310340 7310341 7310342
</I>&gt;<i> squid    17857  0.0  0.0   4156   736 ?        S    10:20   0:00 (logfile-daemon) /var/log/squid/access.log
</I>&gt;<i> squid    17858  5.2  0.0  41780  7804 ?        S    10:20   0:15 (ssl_crtd) -s /var/lib/squid/ssl_db -M 16MB
</I>&gt;<i> squid    17859  0.6  0.0  41792  8000 ?        S    10:20   0:01 (ssl_crtd) -s /var/lib/squid/ssl_db -M 16MB
</I>&gt;<i> squid    17860  0.0  0.0  41780  7800 ?        S    10:20   0:00 (ssl_crtd) -s /var/lib/squid/ssl_db -M 16MB
</I>&gt;<i> squid    17861  0.0  0.0  41776  7608 ?        S    10:20   0:00 (ssl_crtd) -s /var/lib/squid/ssl_db -M 16MB
</I>&gt;<i> squid    17862  0.0  0.0  41776  7612 ?        S    10:20   0:00 (ssl_crtd) -s /var/lib/squid/ssl_db -M 16MB
</I>&gt;<i> squid    17863  0.0  0.0  27204  9120 ?        S    10:20   0:00 /usr/bin/perl -w /usr/libexec/squid/ext_wbinfo_group_acl -K
</I>&gt;<i> squid    17864  0.0  0.0  27140  8872 ?        S    10:20   0:00 /usr/bin/perl -w /usr/libexec/squid/ext_wbinfo_group_acl -K
</I>&gt;<i> squid    17865  0.0  0.0  27140  8872 ?        S    10:20   0:00 /usr/bin/perl -w /usr/libexec/squid/ext_wbinfo_group_acl -K
</I>&gt;<i> squid    17866  0.0  0.0  27140  8912 ?        S    10:20   0:00 /usr/bin/perl -w /usr/libexec/squid/ext_wbinfo_group_acl -K
</I>&gt;<i> squid    17867  0.0  0.0  27140  8912 ?        S    10:20   0:00 /usr/bin/perl -w /usr/libexec/squid/ext_wbinfo_group_acl -K
</I>&gt;<i> squid    17868  0.8  0.0  68920 15488 ?        S    10:20   0:02 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
</I>&gt;<i> squid    17869  0.1  0.0  68916 15380 ?        S    10:20   0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
</I>&gt;<i> squid    17870  0.0  0.0  68904 15400 ?        S    10:20   0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
</I>&gt;<i> squid    17871  0.0  0.0  68904 15484 ?        S    10:20   0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
</I>&gt;<i> squid    17872  0.0  0.0  68792 15292 ?        S    10:20   0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
</I>&gt;<i> squid    17873  0.0  0.0  19852  1812 ?        S    10:20   0:00 (pinger)
</I>&gt;<i> squid    18274  0.0  0.0  68792 15288 ?        S    10:20   0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
</I>&gt;<i> squid    18405  0.0  0.0  68792 15288 ?        S    10:20   0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
</I>&gt;<i> root     19737  0.0  0.0  87440  5856 ?        Ss   Aug23   0:00 /usr/sbin/squid -YC -f /etc/squid/squid.conf
</I>&gt;<i> squid    21262  0.0  0.0  68792 15400 ?        S    10:22   0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
</I>&gt;<i> squid    21263  0.0  0.0  68792 15400 ?        S    10:22   0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
</I>&gt;<i> squid    21264  0.0  0.0  68792 15400 ?        S    10:22   0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
</I>&gt;<i> squid    21265  0.0  0.0  68792 15292 ?        S    10:22   0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
</I>&gt;<i> squid    21266  0.0  0.0  68792 15292 ?        S    10:22   0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
</I>&gt;<i> squid    21267  0.0  0.0  68792 15384 ?        S    10:22   0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
</I>&gt;<i> squid    21268  0.0  0.0  68792 15396 ?        S    10:22   0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
</I>&gt;<i> squid    21269  0.0  0.0  68792 15400 ?        S    10:22   0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
</I>&gt;<i> squid    21270  0.0  0.0  68792 15400 ?        S    10:22   0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
</I>&gt;<i> squid    21276  0.0  0.0  68792 15400 ?        S    10:22   0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
</I>&gt;<i> squid    22971  0.0  0.0  41772  7604 ?        S    10:24   0:00 (ssl_crtd) -s /var/lib/squid/ssl_db -M 16MB
</I>&gt;<i> root     23964  0.0  0.0   8968   944 pts/0    S+   10:24   0:00 grep --colour=auto squid
</I>&gt;<i> root     27129  0.0  0.0  84856  5140 ?        Ss   Aug24   0:00 /usr/sbin/squid -YC -f /etc/squid/squid.http.conf
</I>&gt;<i> squid    27132  0.0  0.0 100980 26652 ?        S    Aug24   0:04 (squid-1) -YC -f /etc/squid/squid.http.conf
</I>&gt;<i> squid    27134  0.0  0.0  19852  1716 ?        S    Aug24   0:03 (pinger)
</I>&gt;<i> root     27281  0.0  0.0  86912  5192 ?        Ss   Aug24   0:00 /usr/sbin/squid -YC -f /etc/squid/squid.https.conf
</I>&gt;<i> squid    27284  0.0  0.0 106484 31408 ?        S    Aug24   0:13 (squid-1) -YC -f /etc/squid/squid.https.conf
</I>&gt;<i> squid    27290  0.0  0.0  19852  1816 ?        S    Aug24   0:03 (pinger)
</I>&gt;<i> root     27956  0.0  0.0  86908  5172 ?        Ss   Aug24   0:00 /usr/sbin/squid -YC -f /etc/squid/squid.owa.conf
</I>&gt;<i> squid    27958  0.0  0.0  99560 25016 ?        S    Aug24   1:24 (squid-1) -YC -f /etc/squid/squid.owa.conf
</I>&gt;<i> squid    27961  0.0  0.0  19852  1812 ?        S    Aug24   0:04 (pinger)
</I>&gt;<i> root     28106  0.0  0.0  86908  5188 ?        Ss   Aug24   0:00 /usr/sbin/squid -YC -f /etc/squid/squid.owa2.conf
</I>&gt;<i> squid    28109  0.0  0.2 141024 66372 ?        S    Aug24   0:34 (squid-1) -YC -f /etc/squid/squid.owa2.conf
</I>&gt;<i> squid    28113  0.0  0.0  19852  1716 ?        S    Aug24   0:04 (pinger)
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> If you run &quot;squid -k shutdown ; squid -k shutdown&quot; do they all fully stop?&gt; (exactly that command, shutdown twice in a row)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Once Squid is fully stopped, start it again. Is the problem resolved
</I>&gt;&gt;<i> when it comes back up?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I'd have to wait for Squid to stop replying. That usually takes several days, maybe more than a week.
</I>
Okay. The above test was to see if the squid processes were all 
correctly operating.
  Since it is now clear that you have multiple instances stepping over 
each others feet in the background please fix the issues with -n and the 
multi-instance critical directives. *Then* do the above to ensure that 
all instances are fully using the fixed setup.

If/when the problem occurs again you should be better placed to see what 
is going on.

  * crash recovery can be very slow on caching Squid as the cache_dir 
require a full disk scan to load all the objects back in.

  * a suddenly overloaded Squid that is using a lot of memory (ie huge 
disk cache index) can take a lot of time to startup new dynamic helpers.

Both of the above can result in user-visible service pauses. There is 
not much that can be done about it except workaround the cause of the 
delay (better peak configuration, or patching the crash not to happen).




&gt;<i> The failing squid process is currently set up with:
</I>&gt;<i> debug_options rotate=1 ALL,1
</I>&gt;<i> 
</I>&gt;<i> Should I set a different level BEFORE it &quot;stops working&quot;, ie. &quot;now&quot;?
</I>&gt;<i> I'm asking because it's going to take a long while to reproduce this issue, and I just want to make sure I'll have enough info when it happens.
</I>&gt;<i> 
</I>
Probably not then. ALL,1 is sufficient to show crash issues if they 
occur, and if nothing at all appears in the log later you can strace the 
paused process to see what it is doing and maybe send it a &quot;squid -n 
_instance_name -d 9 &quot; debug level change from the command line (if what 
it is doing allows signals to get through before it is finished).


PS; are you using CentOS 6 or an older RHEL with kernel 2.6.x ?
  It has recently just come up that they are still actively using those 
old kernels containing broken TPROXY implementations. I vaguely recall 
the symptoms are not always immediately visible, but triggered by 
certain ICMP or TCP conditions.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016204.html">[squid-users] squid stops replying
</A></li>
	<LI>Next message (by thread): <A HREF="016219.html">[squid-users] squid stops replying
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16208">[ date ]</a>
              <a href="thread.html#16208">[ thread ]</a>
              <a href="subject.html#16208">[ subject ]</a>
              <a href="author.html#16208">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
