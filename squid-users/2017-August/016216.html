<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] FATAL: shm_open(/squid-ssl_session_cache.shm)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FATAL%3A%20shm_open%28/squid-ssl_session_cache.shm%29&In-Reply-To=%3C948cd450-d368-2315-d16e-dd7701377249%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016214.html">
   <LINK REL="Next"  HREF="016223.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] FATAL: shm_open(/squid-ssl_session_cache.shm)</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FATAL%3A%20shm_open%28/squid-ssl_session_cache.shm%29&In-Reply-To=%3C948cd450-d368-2315-d16e-dd7701377249%40measurement-factory.com%3E"
       TITLE="[squid-users] FATAL: shm_open(/squid-ssl_session_cache.shm)">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Aug 25 22:13:17 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016214.html">[squid-users] FATAL: shm_open(/squid-ssl_session_cache.shm)
</A></li>
        <LI>Next message (by thread): <A HREF="016223.html">[squid-users] FATAL: shm_open(/squid-ssl_session_cache.shm)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16216">[ date ]</a>
              <a href="thread.html#16216">[ thread ]</a>
              <a href="subject.html#16216">[ subject ]</a>
              <a href="author.html#16216">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 08/25/2017 11:21 AM, Aaron Turner wrote:
&gt;<i> FATAL: Ipc::Mem::Segment::open failed to
</I>&gt;<i> shm_open(/squid-ssl_session_cache.shm): (2) No such file or directory
</I>
&gt;<i> I've verified that /dev/shm is mounted and based on the list of files
</I>&gt;<i> in there, clearly squid is able to create files there, so it's not a
</I>&gt;<i> Linux/shm config issue.
</I>
Yes, moreover, this is not a segment creation failure. This is a failure
to open a segment that should exist but is missing. That segment should
have been created by the master process, but since your config (ab)uses
SMP macros, I am guessing that depending on the configuration details,
the master process may not know that it needs to create that segment.

For the record, the same error happens in older Squids (including v3.5)
when there are two concurrent Squid instances running. However, I
speculate that you are suffering from a misconfiguration, not broken PID
file management here.


&gt;<i> So here's the funny thing... this worked fine until I enabled
</I>&gt;<i> ssl-bumping on the backends (I was debugging some problems and on a
</I>&gt;<i> whim I tried enabling it).  That didn't solve my problem and so I
</I>&gt;<i> disabled ssl bumping on the backends.  And that's when this SHM error
</I>&gt;<i> started happening with my frontend.   Re-enabling ssl-bump on the
</I>&gt;<i> backends fixes the SHM error, but I don't think that would be a
</I>&gt;<i> correct config?
</I>
This is one of the reasons folks should not abuse SMP Squid for
implementing CARP clusters IMHO -- the config on that wiki page is
conceptually wrong, even though it may work in some cases.

SMP macros are useful for simple, localized hacks like splitting
cache.log into worker-specific files or adding worker ID to access.log
entries. However, the more process-specific changes you introduce, the
higher are the changes that Squid will get confused.

The overall principle is that all Squid processes should see the same
configuration. YMMV, but the number of places where SMP Squid relies on
that principle keeps growing...

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016214.html">[squid-users] FATAL: shm_open(/squid-ssl_session_cache.shm)
</A></li>
	<LI>Next message (by thread): <A HREF="016223.html">[squid-users] FATAL: shm_open(/squid-ssl_session_cache.shm)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16216">[ date ]</a>
              <a href="thread.html#16216">[ thread ]</a>
              <a href="subject.html#16216">[ subject ]</a>
              <a href="author.html#16216">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
