<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] acl problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20acl%20problem&In-Reply-To=%3Cb7f42d3a-3678-11b8-4df7-8dbb15863ef8%40dvm.esines.cu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016222.html">
   <LINK REL="Next"  HREF="016237.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] acl problem</H1>
    <B>Alex Guti&#233;rrez Mart&#237;nez</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20acl%20problem&In-Reply-To=%3Cb7f42d3a-3678-11b8-4df7-8dbb15863ef8%40dvm.esines.cu%3E"
       TITLE="[squid-users] acl problem">alex at dvm.esines.cu
       </A><BR>
    <I>Tue Aug 29 15:12:15 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016222.html">[squid-users] FATAL: shm_open(/squid-ssl_session_cache.shm)
</A></li>
        <LI>Next message (by thread): <A HREF="016237.html">[squid-users] acl problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16231">[ date ]</a>
              <a href="thread.html#16231">[ thread ]</a>
              <a href="subject.html#16231">[ subject ]</a>
              <a href="author.html#16231">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello community, I just installed squid 3.3.8 on ubuntu 14.04. The use 
of this software is only providing the Internet to my users. But 
something is wrong with my setup. I must clarify that I use as an 
authentication system the Ldap plug-in that comes with squid.
The problem is that some acl, although apparently well written, are not 
working the way I expect. Specifically those blocking social sites and 
prohibited sites.
Here I post my config. Thanks in advance.

#Escondemos la version del squid
httpd_suppress_version_string on
#nombre que queremos que muestre el squid como nuestro host
visible_hostname Hermes
#no permitimos que nada pase por nuestro proxy
via off
forwarded_for off
follow_x_forwarded_for deny all
#puertos que permitiremos
acl SSL_ports port 443
acl Safe_ports port 80 # http
acl Safe_ports port 21 # ftp
acl Safe_ports port 443 # https
acl Safe_ports port 70 # gopher
acl Safe_ports port 210 # wais
acl Safe_ports port 1025-65535 # unregistered ports
acl Safe_ports port 280 # http-mgmt
acl Safe_ports port 488 # gss-http
acl Safe_ports port 591 # filemaker
acl Safe_ports port 777 # multiling http
acl CONNECT method CONNECT
http_access allow localhost manager
http_access deny manager
# Permitimos los puertos inseguros
http_access allow !Safe_ports
http_access allow CONNECT !SSL_ports
debug_options ALL,9
########################################################
#auth ldap#
########################################################
auth_param basic program /usr/lib/squid3/basic_ldap_auth&#160; -P&#160; -R -b 
&quot;dc=empresa,dc=cuba,dc=cu&quot; -D cn=ldap,ou=squid,dc=empresa,dc=cuba,dc=cu 
-W /etc/squid3/clave.txt -f sAMAccountName=%s -v 3 -s sub -h 172.16.4.10
external_acl_type Group %LOGIN /usr/lib/squid3/ext_ldap_group_acl -R -b 
&quot;dc=empresa,dc=cuba,dc=cu&quot; -D 
cn=cn=ldap,ou=squid,dc=empresa,dc=cuba,dc=cu -W /etc/squid3/clave.txt -f 
&quot;(&amp;(objectclass=user)(sAMAccountName=%u) 
(memberof=cn=%g,dc=empresa,dc=cuba,dc=cu))&quot; -h 172.16.4.10
#######################################################
#auth que no funcionan y deben arreglarse
##########################################################
auth_param basic children 10
auth_param basic realm hermes.empresa.cuba.cu
auth_param basic credentialsttl 2 hour
acl basic_ldap_auth proxy_auth REQUIRED
http_access allow basic_ldap_auth
#http_access deny all
########################################################
#restricciones selectivas#
########################################################
acl dmz src 172.16.4.0/27
acl navegacion src 192.168.9.0/24
acl full external Group InternetFull
acl limitado external Group InternetLimitado
acl sociales dstdomain -n &quot;/etc/squid3/bloqueo/sociales&quot;
acl extensiones urlpath_regex -i &quot;/etc/squid3/bloqueo/listaextensiones&quot;
http_access allow full sociales
http_access allow full limitado navegacion
http_access allow full dmz
########################################################
#restricciones obligadas#
########################################################
#acl blacklist url_regex -i &quot;/etc/squid3/listanegra&quot;
#http_access deny blacklist
acl bl7 dstdomain -n &quot;/etc/squid3/bloqueo/correos&quot;
http_access allow full !limitado bl7
acl bl1 url_regex -i &quot;/etc/squid3/bloqueo/porno&quot;
http_access deny bl1
acl bl2 url_regex -i &quot;/etc/squid3/bloqueo/android&quot;
http_access deny bl2
acl bl3 url_regex -i &quot;/etc/squid3/bloqueo/prox1&quot;
http_access deny bl3
acl bl4 url_regex -i &quot;/etc/squid3/bloqueo/prox2&quot;
http_access deny bl4
acl bl5 url_regex -i &quot;/etc/squid3/bloqueo/prox3&quot;
http_access deny bl5
acl bl6 url_regex -i &quot;/etc/squid3/bloqueo/prox4&quot;
http_access deny bl6
#acl ladmin src &quot;/etc/squid3/ladmin&quot;
http_access deny all
#########################################################################
#proxy_padre #
#########################################################################
cache_peer 172.16.1.24 parent 8000 0
#nunca permitimos conexiones directas, siempre a traves del proxy
never_direct allow all
#######################################################################
# puerto en que el proxy nos escuchara
http_port 3128
#Establecemos la cache
###############################################################################
#Aqui creo una cache de 3GB, el archivo m&#195;&#161;s grande que dejo cachear es 
de 1GB #
#la memoria m&#195;&#161;xima que le asigno al squid es de 300 MB #
#Este espacio para la cache es muy peque&#195;&#177;o, para las necesidades 
b&#195;&#161;sicas funciona correctamente#
#Recomiendo cambiarlo si tienen una pc con recursos, la que yo uso es 
muy antigua #
###############################################################################
#maximum_object_size 100 MB
cache_dir aufs /var/cache/squid3 1024000 16 256
cache_mem 128 MB
cache_store_log /var/cache/squid3/cache_store.log
coredump_dir /var/cache/squid3/dump
#minimum_expiry_time 600 seconds
############################
client_db off
offline_mode off
cache_swap_low 5
cache_swap_high 10
cache_replacement_policy heap GDSF
maximum_object_size_in_memory 256 KB
chunked_request_body_max_size 4096 KB
half_closed_clients off
quick_abort_min 2 KB
############################
# establecemos los archivos de volcado en /var/cache/squid3/
coredump_dir /var/cache/squid3/
###############################################################################
#Establecemos los patrones de refrescamiento de la cache #
#patron de refrescamiento -- tipo de archivo -- tiempo del objeto -- %de 
refrescamiento -- tiempo #
#1440 minutos equivalen a 24 horas #
###############################################################################
refresh_pattern ^ftp: 1440 20% 10080
refresh_pattern ^gopher: 1440 0% 1440
refresh_pattern -i .(gif|png|jpg|jpeg|ico)$ 10080 20% 43200 
override-expire ignore-no-store ignore-private
refresh_pattern -i .(iso|avi|wav|mp3|mp4|mpeg|swf|flv|x-flv)$ 43200 20% 
432000 override-expire ignore-no-store ignore-private
#refresh_pattern -i (/cgi-bin/|?) 0 0% 0
refresh_pattern . 0 20% 4320
max_filedescriptors 3200
##cuanto el squid intenta cachear en mi nombre
read_ahead_gap 256 KB
#################
#sqstat
#################
#acl manager proto cache_object
# replace 10.0.0.1 with your webserver IP
acl webserver src 172.16.4.25/27
http_access allow manager webserver
http_access allow localhost manager
http_access deny manager
###############################################################################
#Delay#
###############################################################################
client_delay_initial_bucket_level 60
delay_initial_bucket_level 75
delay_pools 2
memory_pools off

#Canal 1 extensiones.
delay_class 1 2
delay_parameters 1 16384/32768 8192/16384
delay_access 1 allow sociales extensiones
delay_access 1 deny all

#Canal 2 para usuarios.
delay_class 2 2
delay_parameters 2 65536/65536 32768/32768
delay_access 2 allow navegacion
delay_access 2 deny all

-- 

Saludos Cordiales

Lic. Alex Guti&#233;rrez Mart&#237;nez




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016222.html">[squid-users] FATAL: shm_open(/squid-ssl_session_cache.shm)
</A></li>
	<LI>Next message (by thread): <A HREF="016237.html">[squid-users] acl problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16231">[ date ]</a>
              <a href="thread.html#16231">[ thread ]</a>
              <a href="subject.html#16231">[ subject ]</a>
              <a href="author.html#16231">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
