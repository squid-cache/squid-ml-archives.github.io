<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid stops replying
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20stops%20replying&In-Reply-To=%3C433056430.2668841.1504020437871%40mail.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016219.html">
   <LINK REL="Next"  HREF="016187.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid stops replying</H1>
    <B>Vieri</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20stops%20replying&In-Reply-To=%3C433056430.2668841.1504020437871%40mail.yahoo.com%3E"
       TITLE="[squid-users] squid stops replying">rentorbuy at yahoo.com
       </A><BR>
    <I>Tue Aug 29 15:27:17 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016219.html">[squid-users] squid stops replying
</A></li>
        <LI>Next message (by thread): <A HREF="016187.html">[squid-users] How to block WebRTC leak using Squid - Local IP information and Public IP information
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16233">[ date ]</a>
              <a href="thread.html#16233">[ thread ]</a>
              <a href="subject.html#16233">[ subject ]</a>
              <a href="author.html#16233">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Good news. My Squid process &quot;failed&quot; earlier than expected.

This is one of the first warning messages I see in the log when it happens:
WARNING! Your cache is running out of filedescriptors

# squidclient mgr:info | grep 'file descri'
Maximum number of file descriptors:  1024
Available number of file descriptors:  255
Reserved number of file descriptors:  100

# ulimit -a
core file size          (blocks, -c) 0
data seg size          (kbytes, -d) unlimited
scheduling priority            (-e) 0
file size              (blocks, -f) unlimited
pending signals                (-i) 127521
max locked memory      (kbytes, -l) 64
max memory size        (kbytes, -m) unlimited
open files                      (-n) 1024
pipe size            (512 bytes, -p) 8
POSIX message queues    (bytes, -q) 819200
real-time priority              (-r) 0
stack size              (kbytes, -s) 8192
cpu time              (seconds, -t) unlimited
max user processes              (-u) 127521
virtual memory          (kbytes, -v) unlimited
file locks                      (-x) unlimited

I'm not sure whether this is the root cause, and if I need to change it with something like:

echo '*              hard    nofile          8192' &gt;&gt; /etc/security/limits.conf
echo '*              soft    nofile          4096' &gt;&gt; /etc/security/limits.conf

I'm not even sure how to determine which values I need.

I'm getting high CPU usage during the &quot;failure&quot; such as:
PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM    TIME+ COMMAND
20010 squid    20  0 1050808 878424  13152 R 100.0  2.7  80:06.23 squid

8430 root      20  0  76524  50096  3632 R 100.0  0.2  0:34.85 perl
20010 squid    20  0 1052948 900864  13152 R 100.0  2.7  81:22.71 squid

However, I don't think it's too high because a reading with top + 1 shows values such as:

load average: 1.59, 1.73, 1.94
Tasks: 342 total,  3 running, 339 sleeping,  0 stopped,  0 zombie
%Cpu0  : 58.3 us,  1.0 sy,  0.0 ni, 39.1 id,  0.0 wa,  0.0 hi,  1.7 si,  0.0 st
%Cpu1  :  4.3 us,  0.0 sy,  2.3 ni, 90.7 id,  0.0 wa,  0.0 hi,  2.6 si,  0.0 st
%Cpu2  : 10.9 us,  0.3 sy,  4.3 ni, 82.1 id,  0.0 wa,  0.0 hi,  2.3 si,  0.0 st
%Cpu3  :  5.3 us,  0.7 sy,  0.7 ni, 91.1 id,  0.0 wa,  0.0 hi,  2.3 si,  0.0 st
%Cpu4  :  6.6 us,  0.3 sy,  0.7 ni, 88.4 id,  0.0 wa,  0.0 hi,  4.0 si,  0.0 st
%Cpu5  :  3.3 us,  0.3 sy,  0.0 ni, 95.0 id,  0.0 wa,  0.0 hi,  1.3 si,  0.0 st
%Cpu6  : 10.6 us,  2.0 sy,  1.0 ni, 85.1 id,  0.0 wa,  0.0 hi,  1.3 si,  0.0 st
%Cpu7  :  6.3 us,  0.7 sy,  0.7 ni, 80.5 id,  0.3 wa,  0.0 hi, 11.6 si,  0.0 st
KiB Mem : 32865056 total, 12159836 free,  5675908 used, 15029312 buff/cache
KiB Swap: 37036988 total, 36947156 free,    89832 used. 26689368 avail Mem

PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM    TIME+ COMMAND
21118 squid    20  0  253520 166112  12856 R  80.8  0.5  2:19.69 squid

Anyway, here's a process list during the &quot;failure&quot;:

# ps aux | grep squid
squid    1882  0.0  0.0  41796  7880 ?        S    10:23  0:01 (ssl_crtd) -s /var/lib/squid/ssl_db -M 16MB
squid    1883  0.0  0.0  41804  8016 ?        S    10:23  0:01 (ssl_crtd) -s /var/lib/squid/ssl_db -M 16MB
squid    1884  0.0  0.0  41792  7876 ?        S    10:23  0:01 (ssl_crtd) -s /var/lib/squid/ssl_db -M 16MB
squid    2043  0.0  0.0  41788  7964 ?        S    09:28  0:02 (ssl_crtd) -s /var/lib/squid/ssl_db -M 16MB
root      9100  0.0  0.0  8968  844 pts/0    S+  12:26  0:00 grep --colour=auto squid
squid    10375  0.0  0.0  4156  740 ?        S    08:50  0:07 (logfile-daemon) /var/log/squid/access.log
squid    10376  2.4  0.0  41788  7996 ?        S    08:50  5:22 (ssl_crtd) -s /var/lib/squid/ssl_db -M 16MB
squid    10377  0.4  0.0  41780  7992 ?        S    08:50  1:00 (ssl_crtd) -s /var/lib/squid/ssl_db -M 16MB
squid    10378  0.1  0.0  41800  8012 ?        S    08:50  0:22 (ssl_crtd) -s /var/lib/squid/ssl_db -M 16MB
squid    10379  0.0  0.0  41788  7872 ?        S    08:50  0:11 (ssl_crtd) -s /var/lib/squid/ssl_db -M 16MB
squid    10380  0.0  0.0  41788  7876 ?        S    08:50  0:06 (ssl_crtd) -s /var/lib/squid/ssl_db -M 16MB
squid    10381  0.0  0.0  27140  8912 ?        S    08:50  0:00 /usr/bin/perl -w /usr/libexec/squid/ext_wbinfo_group_acl -K
squid    10382  0.0  0.0  27140  8872 ?        S    08:50  0:00 /usr/bin/perl -w /usr/libexec/squid/ext_wbinfo_group_acl -K
squid    10383  0.0  0.0  27204  8904 ?        S    08:50  0:00 /usr/bin/perl -w /usr/libexec/squid/ext_wbinfo_group_acl -K
squid    10384  0.0  0.0  27204  9156 ?        S    08:50  0:00 /usr/bin/perl -w /usr/libexec/squid/ext_wbinfo_group_acl -K
squid    10385  0.0  0.0  27204  9112 ?        S    08:50  0:00 /usr/bin/perl -w /usr/libexec/squid/ext_wbinfo_group_acl -K
squid    10386  0.2  0.0  68904 15368 ?        S    08:50  0:36 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
squid    10387  0.0  0.0  68912 15400 ?        S    08:50  0:05 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
squid    10388  0.0  0.0  68920 15396 ?        S    08:50  0:02 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
squid    10389  0.0  0.0  68904 15400 ?        S    08:50  0:01 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
squid    10390  0.0  0.0  68920 15292 ?        S    08:50  0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
squid    10391  0.0  0.0  19852  1816 ?        S    08:50  0:01 (pinger)
squid    10406  0.0  0.0  68920 15292 ?        S    08:50  0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
squid    12021  0.0  0.0  68920 15292 ?        S    08:53  0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
squid    12022  0.0  0.0  68904 15396 ?        S    08:53  0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
squid    12023  0.0  0.0  68792 15396 ?        S    08:53  0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
squid    12024  0.0  0.0  68908 15292 ?        S    08:53  0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
squid    12025  0.0  0.0  68792 15400 ?        S    08:53  0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
squid    12026  0.0  0.0  68792 15288 ?        S    08:53  0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
squid    13535  0.0  0.0  68792 15120 ?        S    11:30  0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
squid    13536  0.0  0.0  68792 15104 ?        S    11:30  0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
squid    13537  0.0  0.0  68792 15140 ?        S    11:30  0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
squid    13538  0.0  0.0  68792 15072 ?        S    11:30  0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
squid    13539  0.0  0.0  68792 15064 ?        S    11:30  0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
root    19635  0.0  0.0  84856  5116 ?        Ss  Aug27  0:00 /usr/sbin/squid -YC -f /etc/squid/squid.http.conf -n squidhttp
squid    19639  0.0  0.0 100572 26420 ?        S    Aug27  0:03 (squid-1) -YC -f /etc/squid/squid.http.conf -n squidhttp
squid    19641  0.0  0.0  19852  1812 ?        S    Aug27  0:02 (pinger)
squid    20010 32.0  2.7 1052948 900864 ?      R    08:10  81:59 (squid-1) -YC -f /etc/squid/squid.conf -n squid
root    20019  0.0  0.0  86912  5168 ?        Ss  Aug27  0:00 /usr/sbin/squid -YC -f /etc/squid/squid.https.conf -n squidhttps
squid    20022  0.0  0.0  99100 23484 ?        S    Aug27  0:06 (squid-1) -YC -f /etc/squid/squid.https.conf -n squidhttps
squid    20024  0.0  0.0  19852  1716 ?        S    Aug27  0:02 (pinger)
squid    20030  0.0  0.0  4012  732 ?        S    08:10  0:00 (unlinkd)
squid    20035  0.0  0.0  13904  3080 ?        S    08:10  0:05 diskd 20490244 20490245 20490246
root    20615  0.0  0.0  86908  5164 ?        Ss  Aug27  0:00 /usr/sbin/squid -YC -f /etc/squid/squid.owa.conf -n squidowa
squid    20617  0.1  0.1 118488 43868 ?        S    Aug27  1:20 (squid-1) -YC -f /etc/squid/squid.owa.conf -n squidowa
squid    20620  0.0  0.0  19852  1720 ?        S    Aug27  0:02 (pinger)
root    20978  0.0  0.0  86908  5180 ?        Ss  Aug27  0:00 /usr/sbin/squid -YC -f /etc/squid/squid.owa2.conf -n squidowa2
squid    20981  0.0  0.1 123380 48140 ?        S    Aug27  0:15 (squid-1) -YC -f /etc/squid/squid.owa2.conf -n squidowa2
squid    20983  0.0  0.0  19852  1812 ?        S    Aug27  0:02 (pinger)
root    22620  0.0  0.0  87440  5160 ?        Ss  Aug25  0:00 /usr/sbin/squid -YC -f /etc/squid/squid.conf -n squid
squid    23415  0.0  0.0  68792 15288 ?        S    10:58  0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
squid    23416  0.0  0.0  68792 15384 ?        S    10:58  0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
squid    23417  0.0  0.0  68792 15280 ?        S    10:58  0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
squid    23418  0.0  0.0  68792 15288 ?        S    10:58  0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
squid    23419  0.0  0.0  68792 15292 ?        S    10:58  0:00 /usr/bin/perl -w -s /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl -tbl_name=shallalist_bl adv,aggressive,alcohol,anonvpn,automobile_bikes,automobile_boats,automobile_cars,automobile_planes,chat,costtraps,dating,drugs,dynamic,finance_insurance,finance_moneylending,finance_other,finance_realestate,finance_trading,fortunetelling,forum,gamble,hacking,hobby_cooking,hobby_games-misc,hobby_games-online,hobby_gardening,hobby_pets,homestyle,imagehosting,isp,jobsearch,military,models,movies,music,podcasts,politics,porn,radiotv,recreation_humor,recreation_martialarts,recreation_restaurants,recreation_sports,recreation_travel,recreation_wellness,redirector,religion,remotecontrol,ringtones,science_astronomy,science_chemistry,sex_education,sex_lingerie,shopping,socialnet,spyware,tracker,updatesites,urlshortener,violence,warez,weapons,webphone,webradio,webtv
squid    29575  0.0  0.0  41800  7884 ?        S    09:18  0:04 (ssl_crtd) -s /var/lib/squid/ssl_db -M 16MB

I saved the output of 'strace /usr/sbin/squid -YC -f /etc/squid/squid.conf -n squid' if you require it.

The command &quot;squid -n squid -d 9&quot; doesn't seem to change the logging output, at least not immediately.

I see lines such as the following in the log:

kid1| BUG: Unexpected state while connecting to a cache_peer or origin server
kid1| WARNING! Your cache is running out of filedescriptors
kid1| WARNING: 10 pending requests queued
kid1| Queue overload, rejecting
kid1| WARNING: All 10/10 ssl_crtd processes are busy.
kid1| WARNING: Consider increasing the number of ssl_crtd processes in your config file.
kid1| comm_open: socket failure: (24) Too many open files
kid1| helperDispatch: invalid callback data

This is the sslcrtd_program I'm using:

sslcrtd_program /usr/libexec/squid/ssl_crtd -s /var/lib/squid/ssl_db -M 16MB
sslcrtd_children 10

I don't remember why I set it to 10. Probably a bad idea since the default is &quot;sslcrtd_children 32 startup=5 idle=1&quot;.

So, I'm going to either comment out sslcrtd_children, or change it to:

sslcrtd_children 64 startup=10 idle=2

Could this alone explain the issue I'm seeing?

Vieri

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016219.html">[squid-users] squid stops replying
</A></li>
	<LI>Next message (by thread): <A HREF="016187.html">[squid-users] How to block WebRTC leak using Squid - Local IP information and Public IP information
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16233">[ date ]</a>
              <a href="thread.html#16233">[ thread ]</a>
              <a href="subject.html#16233">[ subject ]</a>
              <a href="author.html#16233">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
