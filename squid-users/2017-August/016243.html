<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Your cache is running out of filedescriptors
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Your%20cache%20is%20running%20out%20of%20filedescriptors&In-Reply-To=%3C254d01d321de%24bf12e820%243d38b860%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016242.html">
   <LINK REL="Next"  HREF="016244.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Your cache is running out of filedescriptors</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Your%20cache%20is%20running%20out%20of%20filedescriptors&In-Reply-To=%3C254d01d321de%24bf12e820%243d38b860%24%40ngtech.co.il%3E"
       TITLE="[squid-users] Your cache is running out of filedescriptors">eliezer at ngtech.co.il
       </A><BR>
    <I>Wed Aug 30 22:24:29 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016242.html">[squid-users] Your cache is running out of filedescriptors
</A></li>
        <LI>Next message (by thread): <A HREF="016244.html">[squid-users] Your cache is running out of filedescriptors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16243">[ date ]</a>
              <a href="thread.html#16243">[ thread ]</a>
              <a href="subject.html#16243">[ subject ]</a>
              <a href="author.html#16243">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey,

Just so you would notice:
open files                      (-n) 4096

you should first make it at least 16384 if not more...
It's not harmful to start with 65535 and then see if the issue still persists or things get resolved.
Maybe the issue with the ssl_crtd is related to the FD issue but I'm not 100% sure.
What OS are you using?

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>



-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Vieri
Sent: Thursday, August 31, 2017 00:48
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [squid-users] Your cache is running out of filedescriptors

Hi,

I'm opening a new thread realted to my previous post here: <A HREF="http://lists.squid-cache.org/pipermail/squid-users/2017-August/016233.html">http://lists.squid-cache.org/pipermail/squid-users/2017-August/016233.html</A>
I'm doing so because the subject is more specific now.

I'm obviously having trouble with file descriptors since I'm gettign the following message in the log on a regular basis.

WARNING! Your cache is running out of filedescriptors

Sometimes, but not always, I also get the message &quot;WARNING: Consider increasing the number of ssl_crtd processes in your config file&quot;.

I've upped twice now the value of &quot;children&quot;, but I'm still getting the same warnigns and performance issues. Here are some values:

external_acl_type bllookup ttl=86400 children-max=100 ...
sslcrtd_children 128 startup=20 idle=4

I also increased nofiles in ulimit:

# ulimit -a
core file size          (blocks, -c) 0
data seg size           (kbytes, -d) unlimited
scheduling priority             (-e) 0
file size               (blocks, -f) unlimited
pending signals                 (-i) 127521
max locked memory       (kbytes, -l) 64
max memory size         (kbytes, -m) unlimited
open files                      (-n) 4096
pipe size            (512 bytes, -p) 8
POSIX message queues     (bytes, -q) 819200
real-time priority              (-r) 0
stack size              (kbytes, -s) 8192
cpu time               (seconds, -t) unlimited
max user processes              (-u) 127521
virtual memory          (kbytes, -v) unlimited
file locks                      (-x) unlimited

If I run &quot;lsof&quot; I get a huge listing.

I could keep increasing the ulimit nofiles and squid &quot;children&quot; values, but I'd like to know if I'm on the right path or not.

What do you suggest?

I appreciate any tip you can share.

Regards,

Vieri
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016242.html">[squid-users] Your cache is running out of filedescriptors
</A></li>
	<LI>Next message (by thread): <A HREF="016244.html">[squid-users] Your cache is running out of filedescriptors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16243">[ date ]</a>
              <a href="thread.html#16243">[ thread ]</a>
              <a href="subject.html#16243">[ subject ]</a>
              <a href="author.html#16243">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
