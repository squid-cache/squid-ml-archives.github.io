<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid reverse-proxy. How it decides when to	refresh?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20reverse-proxy.%20How%20it%20decides%20when%20to%0A%09refresh%3F&In-Reply-To=%3CCACG7tM8GxTL2wnePzdbnP%3D7YfHstv1e5ye-UDr4z%3Duj6df7q2w%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016212.html">
   <LINK REL="Next"  HREF="016214.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid reverse-proxy. How it decides when to	refresh?</H1>
    <B>Alexander Lazarev</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20reverse-proxy.%20How%20it%20decides%20when%20to%0A%09refresh%3F&In-Reply-To=%3CCACG7tM8GxTL2wnePzdbnP%3D7YfHstv1e5ye-UDr4z%3Duj6df7q2w%40mail.gmail.com%3E"
       TITLE="[squid-users] Squid reverse-proxy. How it decides when to	refresh?">gummeah at gmail.com
       </A><BR>
    <I>Thu Aug 31 17:26:50 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016212.html">[squid-users] Squid reverse-proxy. How it decides when to refresh?
</A></li>
        <LI>Next message (by thread): <A HREF="016214.html">[squid-users] FATAL: shm_open(/squid-ssl_session_cache.shm)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16249">[ date ]</a>
              <a href="thread.html#16249">[ thread ]</a>
              <a href="subject.html#16249">[ subject ]</a>
              <a href="author.html#16249">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thank you for reply!
I still don't understand what's happening.
I create file 1.txt with a little bit of text data. Request it with curl.
Web-server returns it without any cache related headers to squid, squid
returns it to me. Getting it with curl one more time, squid serves it
straight from cache without validation(no entries in log on origin server).
I create one more file 2.txt with some data. Do same things, same headers
in response. Second response from squid is from cache but validated from
origin server(i see 304 in origin server logs).
What could be wrong?
I have thought maybe squid applying heuristic freshness, but i didn't see
any warnings in headers.
Maybe some sort of a bug?

On Fri, Aug 25, 2017 at 6:18 PM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:

&gt;<i> On 26/08/17 00:37, Alexander Lazarev wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hello guys!
</I>&gt;&gt;<i> I'm using squid as a reverse-proxy. And I can't understand how squid
</I>&gt;&gt;<i> decides when to check for fresh version of file from origin server.
</I>&gt;&gt;<i> It looks like for some documents it sends 'If-Modified-Since' or similar
</I>&gt;&gt;<i> headers and if it gets 304, it serves file from cache. And for some
</I>&gt;&gt;<i> documents it doesn't check for fresh version and always serves from cache.
</I>&gt;&gt;<i> &gt; I was testing that with curl without any additional headers.
</I>&gt;&gt;<i> Can some explain how that works or where I can read about that in detail?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The HTTP specification RFC 723x series was re-written to be a lot more
</I>&gt;<i> easily understood, so those are probably the best place to read up about it.
</I>&gt;<i>
</I>&gt;<i> The features you are asking about are covered in:
</I>&gt;<i>
</I>&gt;<i> Hypertext Transfer Protocol (HTTP/1.1): Conditional Requests
</I>&gt;<i>  &lt;<A HREF="https://tools.ietf.org/html/rfc7232">https://tools.ietf.org/html/rfc7232</A>&gt;
</I>&gt;<i>
</I>&gt;<i> Hypertext Transfer Protocol (HTTP/1.1): Caching
</I>&gt;<i>  &lt;<A HREF="https://tools.ietf.org/html/rfc7234">https://tools.ietf.org/html/rfc7234</A>&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> And is it possible to make squid always check for fresh version before
</I>&gt;&gt;<i> serving from cache?
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> It does when needed. The situation may be clearer after reading the above.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170831/4283a2d4/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170831/4283a2d4/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016212.html">[squid-users] Squid reverse-proxy. How it decides when to refresh?
</A></li>
	<LI>Next message (by thread): <A HREF="016214.html">[squid-users] FATAL: shm_open(/squid-ssl_session_cache.shm)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16249">[ date ]</a>
              <a href="thread.html#16249">[ thread ]</a>
              <a href="subject.html#16249">[ subject ]</a>
              <a href="author.html#16249">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
