<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] net::err_cert_common_name_invalid just in squid page with dstdomain block
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20net%3A%3Aerr_cert_common_name_invalid%20just%20in%20squid%0A%20page%20with%20dstdomain%20block&In-Reply-To=%3C74418a25-e6b2-844a-91bf-dd600498bf15%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017085.html">
   <LINK REL="Next"  HREF="017087.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] net::err_cert_common_name_invalid just in squid page with dstdomain block</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20net%3A%3Aerr_cert_common_name_invalid%20just%20in%20squid%0A%20page%20with%20dstdomain%20block&In-Reply-To=%3C74418a25-e6b2-844a-91bf-dd600498bf15%40measurement-factory.com%3E"
       TITLE="[squid-users] net::err_cert_common_name_invalid just in squid page with dstdomain block">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Dec  5 17:29:18 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017085.html">[squid-users] net::err_cert_common_name_invalid just in squid page with dstdomain block
</A></li>
        <LI>Next message (by thread): <A HREF="017087.html">[squid-users] net::err_cert_common_name_invalid just in squid page with dstdomain block
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17086">[ date ]</a>
              <a href="thread.html#17086">[ thread ]</a>
              <a href="subject.html#17086">[ subject ]</a>
              <a href="author.html#17086">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12/05/2017 10:05 AM, erdosain9 wrote:
&gt;<i> &quot;Does that error match the generated certificate sent by Squid to a
</I>&gt;<i> blocked Chrome user? In other words, does that certificate have an
</I>&gt;<i> invalid common name (CN) field? &quot;
</I>
&gt;<i> No, is the same certificate. 
</I>
Your statement does not answer my question. I can ask a different
question if you prefer: What is is common name (CN) field of the
generated certificate sent by Squid to a blocked Chrome user?


&gt;<i> &quot;I suggest comparing the following two certificates:
</I>&gt;<i>   * the certificate sent by Squid to a blocked FireFox user
</I>&gt;<i>   * the certificate sent by Squid to a blocked Chrome user &quot;
</I>&gt;<i> 
</I>&gt;<i> Is the same certificate.
</I>
How do you compare the two certificates?


&gt;<i> &quot;I also suggest comparing the following access.log entries:
</I>&gt;<i> 
</I>&gt;<i>   * the line(s) corresponding to the blocked FireFox user request
</I>&gt;<i>   * the line(s) corresponding to the blocked Chrome user request &quot;
</I>

&gt;<i> Line corresponding to blocked Chrome
</I>&gt;<i> 
</I>&gt;<i> 1512493257.523    175 192.168.1.121 TCP_DENIED/200 0 CONNECT es-la.facebook.com:443 <A HREF="https://lists.squid-cache.org/listinfo/squid-users">user at DOMAIN.LAN</A> HIER_NONE/- -
</I>&gt;<i> 1512493257.716    169 192.168.1.121 TCP_MISS/204 193 GET <A HREF="http://www.gstatic.com/generate_204">http://www.gstatic.com/generate_204</A> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">user at DOMAIN.LAN</A> HIER_DIRECT/172.217.30.163 -
</I>
The allowed GET request looks out of place here. It is possible that
that request was sent by Chrome after (or during) Chrome error page
generation and, hence, should be ignored during this analysis. To make
sure you look at requests on one TCP connection, log the source TCP port
number of the client connection to Squid (%&gt;p).


&gt;<i> Line corresponding to blocked Firefox
</I>
&gt;<i> 1512493386.314     43 192.168.1.121 TCP_DENIED/200 0 CONNECT es-la.facebook.com:443 <A HREF="https://lists.squid-cache.org/listinfo/squid-users">user at DOMAIN.LAN</A> HIER_NONE/- -
</I>&gt;<i> 1512493386.317      0 192.168.1.121 TAG_NONE/403 6569 GET <A HREF="https://es-la.facebook.com/">https://es-la.facebook.com/</A> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">user at DOMAIN.LAN</A> HIER_NONE/- text/html
</I>
This group looks OK to me: The CONNECT request was denied (without
letting the browser know). The following GET request (presumably on the
same TCP connection) was bumped to serve the denial error page to the
browser.


&gt;<i> 1512493386.397     45 192.168.1.121 TCP_DENIED/200 0 CONNECT es-la.facebook.com:443 <A HREF="https://lists.squid-cache.org/listinfo/squid-users">user at DOMAIN.LAN</A> HIER_NONE/- -
</I>&gt;<i> 1512493386.400      0 192.168.1.121 TAG_NONE/403 6561 GET <A HREF="http://squid.DOMAIN.lan:3128/squid-internal-static/icons/SN.png">http://squid.DOMAIN.lan:3128/squid-internal-static/icons/SN.png</A>
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">user at DOMAIN.LAN</A> HIER_NONE/- text/html
</I>
Something went wrong here. The denied GET request is (logged as) a plain
HTTP request (no &quot;<A HREF="https://">https://</A>&quot;). Perhaps it is unrelated to the denied
CONNECT attempt, but then why did that GET get a 403 response? The above
%&gt;p logging suggestion applies here as well.

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017085.html">[squid-users] net::err_cert_common_name_invalid just in squid page with dstdomain block
</A></li>
	<LI>Next message (by thread): <A HREF="017087.html">[squid-users] net::err_cert_common_name_invalid just in squid page with dstdomain block
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17086">[ date ]</a>
              <a href="thread.html#17086">[ thread ]</a>
              <a href="subject.html#17086">[ subject ]</a>
              <a href="author.html#17086">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
