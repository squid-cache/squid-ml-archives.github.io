<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] net::err_cert_common_name_invalid just in squid page with dstdomain block
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20net%3A%3Aerr_cert_common_name_invalid%20just%20in%20squid%0A%20page%20with%20dstdomain%20block&In-Reply-To=%3Cf0329ce7-5080-9ac8-a07a-db332833001a%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017127.html">
   <LINK REL="Next"  HREF="017126.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] net::err_cert_common_name_invalid just in squid page with dstdomain block</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20net%3A%3Aerr_cert_common_name_invalid%20just%20in%20squid%0A%20page%20with%20dstdomain%20block&In-Reply-To=%3Cf0329ce7-5080-9ac8-a07a-db332833001a%40measurement-factory.com%3E"
       TITLE="[squid-users] net::err_cert_common_name_invalid just in squid page with dstdomain block">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Dec  7 17:56:48 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017127.html">[squid-users] net::err_cert_common_name_invalid just in squid page with dstdomain block
</A></li>
        <LI>Next message (by thread): <A HREF="017126.html">[squid-users] net::err_cert_common_name_invalid just in squid page with dstdomain block
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17125">[ date ]</a>
              <a href="thread.html#17125">[ thread ]</a>
              <a href="subject.html#17125">[ subject ]</a>
              <a href="author.html#17125">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12/07/2017 08:05 AM, erdosain9 wrote:
&gt;<i> Yes, Chrome tell this when i look the certificate
</I>&gt;<i> 
</I>&gt;<i> &quot;The certificate for this site does not contain a Subject Alternative Name
</I>&gt;<i> extension containing a domain name or IP address.&quot;
</I>
That is not the only error reported by your Chrome, but you can try to
solve one error at a time.

The first step is to understand which certificate the browser is talking
about. Is that a Squid-generated certificate or an origin server
certificate? If it is a Squid-generated certificate, does it mimic an
erroneous property of the origin server certificate? Or did Squid fail
to (or decided not to) mimic something?

The next step, for this specific error, would be to make sure that your
Squid version has as fix for Bug 4711:

&gt;<i> bug 4711: SubjectAlternativeNames is missing in some generated certificates
</I>&gt;<i> 
</I>&gt;<i> Squid may generate certificates which have a Common Name, but do not have
</I>&gt;<i> a subjectAltName extension. For example when squid generated certificates
</I>&gt;<i> do not mimic an origin certificate or when the certificate adaptation
</I>&gt;<i> algorithm sslproxy_cert_adapt/setCommonName is used.
</I>&gt;<i> 
</I>&gt;<i> This is causes problems to some browsers, which validates a certificate using
</I>&gt;<i> the SubjectAlternativeNames but ignore the CommonName field.
</I>&gt;<i> 
</I>&gt;<i> This patch fixes squid to always add a SubjectAlternativeNames extension in
</I>&gt;<i> generated certificates which do not mimic an origin certificate.
</I>&gt;<i> 
</I>&gt;<i> Squid still will not add a subjectAltName extension when mimicking an origin
</I>&gt;<i> server certificate, even if that origin server certificate does not include
</I>&gt;<i> the subjectAltName extension. Such origin server may have problems when
</I>&gt;<i> talking directly to browsers, and patched Squid is not trying to fix those
</I>&gt;<i> problems.
</I>&gt;<i> 
</I>&gt;<i> This is a Measurement Factory project
</I>&gt;<i> 
</I>&gt;<i> Fixes: <A HREF="http://bugs.squid-cache.org/show_bug.cgi?id=4711">http://bugs.squid-cache.org/show_bug.cgi?id=4711</A> fixed
</I>&gt;<i> Bzr-Reference: master r15131
</I>
If your Squid does not have the above fix, then it might explain the
second problem reported by Chrome as well, provided the origin server
certificate lacks any CN for Squid to mimic.


&gt;<i> So, my certificate does not have a Subject Alternative Name.
</I>&gt;<i> But, this is not a problem with Firefox.
</I>
Yes, different browsers (and different browser versions) may impose
different requirements on certificates (and other traffic parameters).

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017127.html">[squid-users] net::err_cert_common_name_invalid just in squid page with dstdomain block
</A></li>
	<LI>Next message (by thread): <A HREF="017126.html">[squid-users] net::err_cert_common_name_invalid just in squid page with dstdomain block
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17125">[ date ]</a>
              <a href="thread.html#17125">[ thread ]</a>
              <a href="subject.html#17125">[ subject ]</a>
              <a href="author.html#17125">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
