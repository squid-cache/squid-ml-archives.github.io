<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] FTP proxy chain with native ftp
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FTP%20proxy%20chain%20with%20native%20ftp&In-Reply-To=%3C4287fdf6-49e5-81b9-f559-ec0121dd4ed9%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017182.html">
   <LINK REL="Next"  HREF="017190.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] FTP proxy chain with native ftp</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FTP%20proxy%20chain%20with%20native%20ftp&In-Reply-To=%3C4287fdf6-49e5-81b9-f559-ec0121dd4ed9%40measurement-factory.com%3E"
       TITLE="[squid-users] FTP proxy chain with native ftp">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Dec 12 17:13:52 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017182.html">[squid-users] FTP proxy chain with native ftp
</A></li>
        <LI>Next message (by thread): <A HREF="017190.html">[squid-users] TCP_MISS_ABORTED
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17183">[ date ]</a>
              <a href="thread.html#17183">[ thread ]</a>
              <a href="subject.html#17183">[ subject ]</a>
              <a href="author.html#17183">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12/12/2017 09:56 AM, Amos Jeffries wrote:
&gt;<i> On 13/12/17 04:51, Sticher, Jascha wrote:
</I>&gt;&gt;<i> Is there a way (yet) to tell my first squid instance
</I>&gt;&gt;<i> to use another squid as a forward proxy with native FTP?
</I>

&gt;<i> The FTP traffic arriving at Squids ftp_port is converted from a stream
</I>&gt;<i> of FTP messages to a stream of HTTP messages for handling.
</I>
&gt;<i> AFAIK those resulting HTTP messages can be routed through a cache_peer
</I>&gt;<i> same as any other HTTP traffic. 
</I>
I hope such routing is not possible today, but I do not know for sure.
AFAIK, no peer would be able to convert those wrapper HTTP messages back
into FTP. I hope the wrapper messages are always routed to FTP Client
code inside Squid using pinned Squid-FTP-server connections or something
like that.


&gt;<i> BUT at very least the peer needs to also
</I>&gt;<i> have the same &quot;native FTP&quot; implementation to successfully convert them
</I>&gt;<i> from HTTP back to FTP native messages on the outgoing server connections
</I>&gt;<i> at the other side of the cache hierarchy.
</I>
* The &quot;native FTP&quot; Server implementation inside Squid does not convert
HTTP wrapper messages into FTP native messages. It converts FTP commands
into HTTP wrapper messages.

* The native FTP Client implementation inside Squid does the opposite
conversion, but it partners with the FTP Server implementation inside
Squid, not the HTTP Server implementation inside Squid.

* If wrapper HTTP messages reach a Squid peer, they will be handled by
the HTTP Server implementation inside peer Squid.

Thus, one cannot use another Squid to unwrap HTTP wrapper messages sent
by the child Squid, even if the routing code allows for those wrapper
messages to escape a Squid instance. The pieces required for everything
to work together are missing.


&gt;<i> Do allow the front-end Squid to
</I>&gt;<i> re-FTP the traffic to the appropriate server then intercept it
</I>&gt;<i> independently into the backend with its own ftp_port accepting the
</I>&gt;<i> &quot;native FTP&quot; coming out of the frontend.
</I>
Good idea! Interception should work indeed. The &quot;child&quot; Squid will not
know what is going on, but both Squids will receive and send native FTP
traffic.


CHeers,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017182.html">[squid-users] FTP proxy chain with native ftp
</A></li>
	<LI>Next message (by thread): <A HREF="017190.html">[squid-users] TCP_MISS_ABORTED
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17183">[ date ]</a>
              <a href="thread.html#17183">[ thread ]</a>
              <a href="subject.html#17183">[ subject ]</a>
              <a href="author.html#17183">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
