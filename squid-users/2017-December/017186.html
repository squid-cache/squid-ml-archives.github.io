<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Groups and authorization SQUID
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Groups%20and%20authorization%20SQUID&In-Reply-To=%3CBN6PR15MB1203A8F78C56178C3EB18992E3340%40BN6PR15MB1203.namprd15.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017162.html">
   <LINK REL="Next"  HREF="017189.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Groups and authorization SQUID</H1>
    <B>Edwin Quijada</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Groups%20and%20authorization%20SQUID&In-Reply-To=%3CBN6PR15MB1203A8F78C56178C3EB18992E3340%40BN6PR15MB1203.namprd15.prod.outlook.com%3E"
       TITLE="[squid-users] Groups and authorization SQUID">listas_quijada at hotmail.com
       </A><BR>
    <I>Tue Dec 12 21:48:23 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017162.html">[squid-users] Groups and authorization SQUID
</A></li>
        <LI>Next message (by thread): <A HREF="017189.html">[squid-users] Groups and authorization SQUID
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17186">[ date ]</a>
              <a href="thread.html#17186">[ thread ]</a>
              <a href="subject.html#17186">[ subject ]</a>
              <a href="author.html#17186">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>


________________________________
From: squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; on behalf of Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
Sent: Tuesday, December 12, 2017 1:03 AM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Groups and authorization SQUID

On 12/12/17 09:48, Edwin Quijada wrote:
&gt;<i>
</I>&gt;<i> ------------------------------------------------------------------------
</I>&gt;<i> *From:* Antony Stone
</I>&gt;<i> On Saturday 09 December 2017 at 15:35:51, Edwin Quijada wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> &gt; On Friday 08 December 2017 at 22:08:33, Edwin Quijada wrote:
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; &gt; I have 4 different groups in my company each group has access different
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Please explain what &quot;access different&quot; means.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The first group has accees to 2 pages, second 3 differents pages and  3 and
</I>&gt;&gt;<i> 4 everything
</I>&gt;<i>
</I>&gt;<i> Okay, understood.
</I>&gt;<i>
</I>
FYI: please be aware that HTTP has no concept of &quot;page&quot;. That is a human
UI concept. Squid and HTTP deal only with messages about URLs. A &quot;page&quot;
as we know it can be many different transactions and URL messages.

We can get into that more later when you have auth working, just be
aware for now that there is no natural connection between auth
credentials and &quot;page&quot;.

OK, I understood. My problem then is when Squid shows the authorization screen I put the credentials but doenst work ,
This is a simple helper but doesnt work, it continues ask me for user/pass


&gt;<i> This helper that I created
</I>&gt;<i> &lt;?php
</I>&gt;<i>
</I>&gt;<i> $f = fopen(&quot;<A HREF="php://stdin">php://stdin</A>&quot;, &quot;r&quot;);
</I>&gt;<i> while (!(feof($f))) {
</I>&gt;<i>      $line = fgets($f);
</I>&gt;<i>      if ($line) {
</I>&gt;<i>          $fields = explode(' ', trim($line));
</I>&gt;<i>          $username = rawurldecode($fields[0]);
</I>&gt;<i>          $password = rawurldecode($fields[1]);
</I>&gt;<i> //
</I>&gt;<i>          if ($username==&quot;edwin&quot; &amp;&amp;  $password==&quot;1234&quot;)
</I>&gt;<i>                fwrite(STDOUT, &quot;OK\n&quot;);
</I>&gt;<i>          else
</I>&gt;<i>               fwrite(STDOUT, &quot;ERR\n&quot;);
</I>&gt;<i>      }
</I>&gt;<i> }
</I>&gt;<i> ?&gt;
</I>&gt;<i> This helper is just for testing , but when I tested it doent work
</I>&gt;<i>
</I>
What are your squid.conf settings using that helper?

#acl manager proto cache_object
http_port 3128
cache_dir ufs /var/spool/squid3 2048 16 256
maximum_object_size 100 MB
cache_swap_low 90
cache_swap_high 95

#--------------- Reglas de Autorizacion -------------
auth_param basic program  /usr/bin/php /root/squid_helper2.php
auth_param basic children 20
auth_param basic realm Proxy Quijada Usuario Y Clave
auth_param basic credentialsttl 5 hours
#----------------------------------------------------
#------------- ACL de accesos para los usuarios------
#----------------------------------------------------
#
#
acl AuthenticatedUsers proxy_auth REQUIRED
http_access allow AuthenticatedUsers
#-------------------- ACL Puertos --------------------
acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http

acl CONNECT method CONNECT

#---------------------- HTTP ACCES DEFAULT-------------
#http_access allow manager localhost
#http_access deny manager
#http_access deny !Safe_ports

#http_access deny to_localhost
#icp_access deny all
#htcp_access deny all

#---------------------- HTTP_ACCESS DE USUARIOS---------


#======================================================================

#Suggested default:
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0 0% 0
refresh_pattern .               0       20%     4320




FYI: PHP has known problems that prevent it being a successful helper
language most of the time
&lt;<A HREF="https://wiki.squid-cache.org/Features/AddonHelpers#What_language_are_helper_meant_to_be_written_in.3F">https://wiki.squid-cache.org/Features/AddonHelpers#What_language_are_helper_meant_to_be_written_in.3F</A>&gt;
Features/AddonHelpers - Squid Web Proxy Wiki&lt;<A HREF="https://wiki.squid-cache.org/Features/AddonHelpers#What_language_are_helper_meant_to_be_written_in.3F">https://wiki.squid-cache.org/Features/AddonHelpers#What_language_are_helper_meant_to_be_written_in.3F</A>&gt;
wiki.squid-cache.org
Perl, Python : Certain methods of writing output to stdout automatically append newline characters. Care must be taken that only one set of newlines are output with ...



Squid bundles with *_fake_auth helpers you can base your code on when
developing a custom helper. They handle the I/O with Squid properly for
their matching Squid version and should be easily extended for doing
actual auth checks.


&gt;&gt;<i> &gt; How does it identify one group from another?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Uhm...the structere are differents , really there are in different tables
</I>&gt;&gt;<i> in my DB that is in the server
</I>&gt;<i>
</I>&gt;<i> So, you're doing an HTTP request to a web server, which then looks up
</I>&gt;<i> the user
</I>&gt;<i> in a database, and returns a result as an HTTP response...
</I>&gt;<i>
</I>&gt;<i> Surely it would be easier (and quicker / more efficient) to get Squid to
</I>&gt;<i> interrogate the database?
</I>&gt;<i>
</I>&gt;&gt;<i> &gt; &gt; the problem is how can i do this ACL
</I>&gt;<i>
</I>&gt;<i> I wouldn't start from there, so I hope someone else here can suggest a
</I>&gt;<i> way of
</I>&gt;<i> getting this to work.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> What made you start with this approach in the first place?
</I>&gt;<i>
</I>&gt;<i> Now, I changed the approach , I just want one group for everything and
</I>&gt;<i> other, localnet restricted,instead of use 4 groups just 2 one for admin,
</I>&gt;<i> other for
</I>&gt;<i>
</I>
The weird thing is this use of a web server as an intermediary between
Squid and the actual user/group database. What made you use it in the
first place instead of connecting Squid to the database?

It just why the database is in another server and this DB doesnt have external access . IN this server just has an API responding request so I wanna use this for authorization. I cant connect directly to DB

[ I am one of the people who can help you get it to work, but it is only
with the trouble doing at all if there is a good reason. Auth is a
complex enough topic already just by itself. ]

Thks for your help, I will continue trying to authorize with Squid


Amos
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
squid-users Info Page&lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>&gt;
lists.squid-cache.org
squid-users -- General discussion relating to Squid. The membership of this list is thousands of Squid users from around the world About squid-users


-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20171212/3094d4be/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20171212/3094d4be/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017162.html">[squid-users] Groups and authorization SQUID
</A></li>
	<LI>Next message (by thread): <A HREF="017189.html">[squid-users] Groups and authorization SQUID
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17186">[ date ]</a>
              <a href="thread.html#17186">[ thread ]</a>
              <a href="subject.html#17186">[ subject ]</a>
              <a href="author.html#17186">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
