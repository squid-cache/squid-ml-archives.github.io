<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Doesnt authorize with Squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Doesnt%20authorize%20with%20Squid&In-Reply-To=%3Ccb86f1ba-926c-e712-2c4e-ab16503f8d66%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017201.html">
   <LINK REL="Next"  HREF="017209.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Doesnt authorize with Squid</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Doesnt%20authorize%20with%20Squid&In-Reply-To=%3Ccb86f1ba-926c-e712-2c4e-ab16503f8d66%40treenet.co.nz%3E"
       TITLE="[squid-users] Doesnt authorize with Squid">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Dec 14 04:02:11 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017201.html">[squid-users] Doesnt authorize with Squid
</A></li>
        <LI>Next message (by thread): <A HREF="017209.html">[squid-users] reference_age 1 week
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17217">[ date ]</a>
              <a href="thread.html#17217">[ thread ]</a>
              <a href="subject.html#17217">[ subject ]</a>
              <a href="author.html#17217">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 14/12/17 06:03, Edwin Quijada wrote:
&gt;<i> Hi!
</I>&gt;<i> I have installed a debian server with Squid3 to authorize surf for 
</I>&gt;<i> internet. My problem is when I get the screen for credentials I put my 
</I>&gt;<i> rigth credentials and always I get denied.
</I>&gt;<i> 
</I>
Is this &quot;screen&quot; a popup box or an actual visual page displayed?
HTTP auth popups should be relatively small and grey outlined, asking 
only for username and password with the proxy Realm string as the title 
or initial text.


&gt;<i> I have used a different helpers for authentication and I did my own using C
</I>&gt;<i> 
</I>&gt;<i> but the authorization is continue
</I>&gt;<i> 
</I>
Whether to show the popup is a Browser decision. Properly working you 
should only ever see 0 or 1 of them.

&gt;<i> 
</I>&gt;<i> There is a way to see or debug the autorization process?
</I>&gt;<i> 
</I>
The available helpers should all provide a -d command line option for 
testing and troubleshooting. You can configure that in their 'auth_param 
... program' squid.conf line. Squid logs the debug info from helpers to 
cache.log.

Your custom helper is up to you how it gets debugged. Anything it sends 
to stderr is sent to cache.log so you can use that instead of having to 
worry about custom log files yourself.


&gt;<i> 
</I>&gt;<i> It is the squid.conf. The helper just takes the values but always 
</I>&gt;<i> autorize, Always print OK
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> #Recommended minimum configuration:
</I>&gt;<i> http_port 3128
</I>&gt;<i> cache_dir ufs /var/spool/squid3 2048 16 256
</I>&gt;<i> maximum_object_size 100 MB
</I>&gt;<i> cache_swap_low 90
</I>&gt;<i> cache_swap_high 95
</I>&gt;<i> 
</I>&gt;<i> #--------------- Reglas de Autorizacion -------------
</I>&gt;<i> auth_param basic program&#160;&#160; /root/squid_helper3
</I>&gt;<i> auth_param basic children 20
</I>&gt;<i> auth_param basic casesensitive off
</I>&gt;<i> auth_param basic realm Proxy Test --&gt; Usuario Y Clave
</I>&gt;<i> auth_param basic credentialsttl 5 hours
</I>
That credentialsttl setting is how long Squid remembers helper responses 
about credentials. Once credentials are given an OK/ERR result no 
further changes to the auth system for that credential pair (eg, user 
account addition, removal or password changes) are noticed by Squid 
until that TTL expires and a fresh lookup performed.

This is a value you should tune to be short, but long enough not to 
overload the helpers and slow your clients traffic down at peak times.

For initial testing of auth leave it *very* short until you are sure the 
auth is working okay. Then test longer timings until you are happy with 
the performance vs security tradeoff.


&gt;<i> #----------------------------------------------------
</I>&gt;<i> #
</I>&gt;<i> acl AuthenticatedUsers proxy_auth REQUIRED
</I>&gt;<i> http_access allow AuthenticatedUsers
</I>
The best way to perform auth is to deny non-authenticated users. That 
includes the ones with *invalid* credentials (attackers or forgotten 
passwords etc.).

Then further access controls can rely on credentials being both present 
and valid and do allows for various reasons. For example; client being 
on the LAN / localnet.


&gt;<i> #-------------------- ACL Puertos --------------------
</I>&gt;<i> acl SSL_ports port 443
</I>&gt;<i> acl Safe_ports port 80&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # http
</I>&gt;<i> acl Safe_ports port 21&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # ftp
</I>&gt;<i> acl Safe_ports port 443&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # https
</I>&gt;<i> acl Safe_ports port 70&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # gopher
</I>&gt;<i> acl Safe_ports port 210&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # wais
</I>&gt;<i> acl Safe_ports port 1025-65535&#160; # unregistered ports
</I>&gt;<i> acl Safe_ports port 280&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # http-mgmt
</I>&gt;<i> acl Safe_ports port 488&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # gss-http
</I>&gt;<i> acl Safe_ports port 591&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # filemaker
</I>&gt;<i> acl Safe_ports port 777&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # multiling http
</I>&gt;<i> 
</I>&gt;<i> acl CONNECT method CONNECT
</I>&gt;<i> 
</I>&gt;<i> #---------------------- HTTP ACCES DEFAULT-------------
</I>&gt;<i> #http_access allow manager localhost
</I>&gt;<i> #http_access deny manager
</I>&gt;<i> http_access deny !Safe_ports
</I>&gt;<i> 
</I>&gt;<i> Any help ?
</I>&gt;<i> 
</I>
Your custom rules should all be down below the !Safe_Ports and &quot;CONNECT 
!SSL_Ports&quot; protections. So attacks using those DoS methods cannot 
overload your auth system and more complicated ACL things.


While the http_access rules are not great they should still have 
&quot;worked&quot; for the request(s) after you entered the credentials.

What I'd do along with enabling debug in the auth helper is to also 
configure &quot;debug_options 11,2&quot; in squid.conf to get a trace of whet the 
HTTP messages contain. That may show some clues about where the problem 
is starting.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017201.html">[squid-users] Doesnt authorize with Squid
</A></li>
	<LI>Next message (by thread): <A HREF="017209.html">[squid-users] reference_age 1 week
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17217">[ date ]</a>
              <a href="thread.html#17217">[ thread ]</a>
              <a href="subject.html#17217">[ subject ]</a>
              <a href="author.html#17217">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
