<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Caching HTTPS with a parent squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Caching%20HTTPS%20with%20a%20parent%20squid&In-Reply-To=%3C6df7f3359b94affec0e898ffbd77d4b2%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017264.html">
   <LINK REL="Next"  HREF="017266.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Caching HTTPS with a parent squid</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Caching%20HTTPS%20with%20a%20parent%20squid&In-Reply-To=%3C6df7f3359b94affec0e898ffbd77d4b2%40treenet.co.nz%3E"
       TITLE="[squid-users] Caching HTTPS with a parent squid">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Dec 28 03:44:46 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017264.html">[squid-users] Caching HTTPS with a parent squid
</A></li>
        <LI>Next message (by thread): <A HREF="017266.html">[squid-users] Caching HTTPS with a parent squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17265">[ date ]</a>
              <a href="thread.html#17265">[ thread ]</a>
              <a href="subject.html#17265">[ subject ]</a>
              <a href="author.html#17265">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2017-12-28 07:53, Mauricio Garavaglia wrote:
&gt;<i> Hello! I have a squid 3.5 caching HTTPS doing BumpSSL, everything
</I>&gt;<i> works ok butI need to add another one as a parent (bigger storage and
</I>&gt;<i> but different SLA...) of the first one, while still allowing it to go
</I>&gt;<i> direct if the parent is not available.
</I>&gt;<i> 
</I>&gt;<i> [Client]----&gt;[Squid 1]-----&gt;[Squid 2]----&gt;[Origin Server]
</I>&gt;<i> 
</I>&gt;<i> To proper cache both, I would need to bump, but that's not available
</I>&gt;<i> per
</I>&gt;<i> <A HREF="https://github.com/squid-cache/squid/blob/v3.5/src/FwdState.cc#L813">https://github.com/squid-cache/squid/blob/v3.5/src/FwdState.cc#L813</A>
</I>&gt;<i> 
</I>&gt;<i> What would be the correct way to accomplish that? Tried making the
</I>&gt;<i> first one to just peek but I still want to allow to cache the
</I>&gt;<i> responses and not just bypass the connection.
</I>

The way to do this is to use MARK or TOS to label the child proxy 
outgoing traffic so routing can send it to the parent proxy where it 
gets re-bumped. Both proxies otherwise operate as stand-alone 
interceptors.

DO NOT use cache_peer originserver connections between them - while this 
can appear to work for some traffic it removes TLS properties needed by 
many modern clients.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017264.html">[squid-users] Caching HTTPS with a parent squid
</A></li>
	<LI>Next message (by thread): <A HREF="017266.html">[squid-users] Caching HTTPS with a parent squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17265">[ date ]</a>
              <a href="thread.html#17265">[ thread ]</a>
              <a href="subject.html#17265">[ subject ]</a>
              <a href="author.html#17265">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
