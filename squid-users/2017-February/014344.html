<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] High utilization of CPU squid-3.5.23, squid-3.5.24
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20High%20utilization%20of%20CPU%20squid-3.5.23%2C%20squid-3.5.24&In-Reply-To=%3C06e701d27cd3%24058631b0%2410929510%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014343.html">
   <LINK REL="Next"  HREF="014346.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] High utilization of CPU squid-3.5.23, squid-3.5.24</H1>
    <B>Eliezer  Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20High%20utilization%20of%20CPU%20squid-3.5.23%2C%20squid-3.5.24&In-Reply-To=%3C06e701d27cd3%24058631b0%2410929510%24%40ngtech.co.il%3E"
       TITLE="[squid-users] High utilization of CPU squid-3.5.23, squid-3.5.24">eliezer at ngtech.co.il
       </A><BR>
    <I>Wed Feb  1 21:34:51 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014343.html">[squid-users] High utilization of CPU squid-3.5.23, squid-3.5.24
</A></li>
        <LI>Next message (by thread): <A HREF="014346.html">[squid-users] High utilization of CPU squid-3.5.23, squid-3.5.24
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14344">[ date ]</a>
              <a href="thread.html#14344">[ thread ]</a>
              <a href="subject.html#14344">[ subject ]</a>
              <a href="author.html#14344">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I believe that the squid manager info page should give some clue about the number of concurrent requests.

If it's above some number(300-400 and above) per second then removing the cache_dir from the server for a windows of a day will answer if it's a DISK IO bottle neck or something else.

All The Bests,
Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>


-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Vitaly Lavrov
Sent: Wednesday, February 1, 2017 10:56 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at squid-cache.org</A>
Subject: [squid-users] High utilization of CPU squid-3.5.23,squid-3.5.24

Periodically squid begins to linearly increase the use of the CPU.
Sometimes this process reaches 100%. At random moment of time the CPU usage is reduced to 5-15%, and in the presence of client requests can again start linearly increasing use of CPU.

In the protocols are no error messages.

CPU consumption does not correlate with the number of requests and traffic.

The increase CPU consumption from 0 to 60% occurs in about 4-5 hours, and to 100% for 6-8 hours.

A typical graph of CPU usage can be viewed on <A HREF="http://devel.aanet.ru/tmp/squid-cpu-x.png">http://devel.aanet.ru/tmp/squid-cpu-x.png</A>

With the &quot;perf record -p` pgrep -f squid-1` - sleep 30&quot; I have received the following information:

At 100% CPU load most of the time took 3 calls

  49.15% squid squid [.] MemObject :: dump
  25.11% squid squid [.] Mem_hdr :: freeDataUpto
  20.03% squid squid [.] Mem_hdr :: copy

When loading CPU 30-60% most of the time took 3 calls

  37.26% squid squid [.] Mem_node :: dataRange
  22.61% squid squid [.] Mem_hdr :: NodeCompare
  17.31% squid squid [.] Mem_hdr :: freeDataUpto

What is it ? Is it possible to somehow fix it?

System: slackware64 14.2

sslbump not used. http only.

Part of config:

memory_pools off
memory_pools_limit 512 MB
cache_mem 768 MB
maximum_object_size_in_memory 64 KB
cache_dir ufs           /cache/sq_c1 16312 16 256
cache_dir ufs           /cache/sq_c2 16312 16 256
cache_dir ufs           /cache/sq_c3 16312 16 256
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014343.html">[squid-users] High utilization of CPU squid-3.5.23, squid-3.5.24
</A></li>
	<LI>Next message (by thread): <A HREF="014346.html">[squid-users] High utilization of CPU squid-3.5.23, squid-3.5.24
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14344">[ date ]</a>
              <a href="thread.html#14344">[ thread ]</a>
              <a href="subject.html#14344">[ subject ]</a>
              <a href="author.html#14344">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
