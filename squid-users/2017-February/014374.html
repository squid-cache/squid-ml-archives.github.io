<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] DiskThreadsDiskFile::openDone squid 3.5.0.4
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20DiskThreadsDiskFile%3A%3AopenDone%20squid%203.5.0.4&In-Reply-To=%3C5dbddc65-bdbf-60cf-e09c-1a334b504364%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014370.html">
   <LINK REL="Next"  HREF="014375.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] DiskThreadsDiskFile::openDone squid 3.5.0.4</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20DiskThreadsDiskFile%3A%3AopenDone%20squid%203.5.0.4&In-Reply-To=%3C5dbddc65-bdbf-60cf-e09c-1a334b504364%40treenet.co.nz%3E"
       TITLE="[squid-users] DiskThreadsDiskFile::openDone squid 3.5.0.4">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Feb  2 23:51:41 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014370.html">[squid-users] DiskThreadsDiskFile::openDone  squid 3.5.0.4
</A></li>
        <LI>Next message (by thread): <A HREF="014375.html">[squid-users] DiskThreadsDiskFile::openDone squid 3.5.0.4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14374">[ date ]</a>
              <a href="thread.html#14374">[ thread ]</a>
              <a href="subject.html#14374">[ subject ]</a>
              <a href="author.html#14374">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 3/02/2017 7:56 a.m., <A HREF="https://lists.squid-cache.org/listinfo/squid-users">tmblue at gmail.com</A> wrote:
&gt;<i> asnani_satish wrote
</I>&gt;&gt;<i> This happens when size specified in cache_mem &gt;= cache_dir 
</I>&gt;&gt;<i> Example:
</I>&gt;&gt;<i> cache_dir aufs /var/spool/squid 1000 32 512 
</I>&gt;&gt;<i>    implies 1000 MB physical disk space allotted for cache in specified
</I>&gt;&gt;<i> directory
</I>&gt;&gt;<i> cache_mem 900 MB
</I>&gt;&gt;<i>    cache size to be used by squid which must be less than the size
</I>&gt;&gt;<i> specified in cache_dir directive.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Dont forget to restart squid
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> We cannot just ignore the error because if this error keeps on occurring
</I>&gt;&gt;<i> the performance of squid degrades.
</I>&gt;<i> 
</I>&gt;<i> Are you sure???
</I>&gt;<i> 
</I>&gt;<i> i'm getting this error when turning back on a squid system that I had down
</I>&gt;<i> (out of production for 2 days). My config does not indicate an issue that
</I>&gt;<i> you advise to be the cause of the error.
</I>&gt;<i> 
</I>&gt;<i> cache_mem 1 GB
</I>&gt;<i> cache_dir aufs /cache 65000 16 256
</I>&gt;<i> 
</I>&gt;<i> I'm not seeing any issue but the error is rampant at this point
</I>&gt;<i> 
</I>&gt;<i> 2017/02/02 10:58:59 kid1| 	/cache/07/49/003749FE
</I>&gt;<i> 2017/02/02 10:59:00 kid1| DiskThreadsDiskFile::openDone: (2) No such file or
</I>&gt;<i> directory
</I>&gt;<i> 2017/02/02 10:59:00 kid1| 	/cache/05/3E/00053EA0
</I>&gt;<i> 2017/02/02 10:59:00 kid1| DiskThreadsDiskFile::openDone: (2) No such file or
</I>&gt;<i> directory
</I>&gt;<i> 2017/02/02 10:59:00 kid1| 	/cache/0D/EB/005DEB19
</I>&gt;<i> 2017/02/02 10:59:00 kid1| DiskThreadsDiskFile::openDone: (2) No such file or
</I>&gt;<i> directory
</I>&gt;<i> 2017/02/02 10:59:00 kid1| 	/cache/02/27/0002273A
</I>&gt;<i> 
</I>
Squid uses a journal file swap.state to store changes to the cache. On
restart it is used to reconstruct the cache index fast. If you cause
Squid to shutdown very fast (kill -9, systemd crashing it, or
shutdown_lifetime too short) then it does not have time to fully update
the journal entries.

When it gets restarted after one of those abrupt shutdowns one of these
messages (not errors!) gets logged for each entry which the journal
indicates are present - but are not really there because their removal
was not recorded on shutdown.

NP: There are also things in the cache being orphaned then just
overwritten because the journal does not record them as existing. But no
messages about that because its not detected.

These messages should decrease exponentially proportional to your
traffics normal HIT rate. But in a very large cache like yours it still
may take many hours to become noticably slower and days to disappear
entirely. That is of course assuming your Squid does not have another
restart event to begin the process all over again.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014370.html">[squid-users] DiskThreadsDiskFile::openDone  squid 3.5.0.4
</A></li>
	<LI>Next message (by thread): <A HREF="014375.html">[squid-users] DiskThreadsDiskFile::openDone squid 3.5.0.4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14374">[ date ]</a>
              <a href="thread.html#14374">[ thread ]</a>
              <a href="subject.html#14374">[ subject ]</a>
              <a href="author.html#14374">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
