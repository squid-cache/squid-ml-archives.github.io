<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] heart beet between squid peers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20heart%20beet%20between%20squid%20peers&In-Reply-To=%3C07973c37-056a-6ddc-1798-4300e1b47dbc%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014373.html">
   <LINK REL="Next"  HREF="014323.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] heart beet between squid peers</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20heart%20beet%20between%20squid%20peers&In-Reply-To=%3C07973c37-056a-6ddc-1798-4300e1b47dbc%40measurement-factory.com%3E"
       TITLE="[squid-users] heart beet between squid peers">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Feb  3 00:19:26 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014373.html">[squid-users] heart beet between squid peers
</A></li>
        <LI>Next message (by thread): <A HREF="014323.html">[squid-users] irregular traffic when using proxy, not if NATed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14376">[ date ]</a>
              <a href="thread.html#14376">[ thread ]</a>
              <a href="subject.html#14376">[ subject ]</a>
              <a href="author.html#14376">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 02/02/2017 04:43 PM, salil GK wrote:

&gt;<i> we provide an interface for the admin to set
</I>&gt;<i> whether forward proxy is enabled or not - and also specify which all
</I>&gt;<i> peers need to be involved in the squid chaining ( parent child ). If I
</I>&gt;<i> have say 4 machines - A,B,C and D. Admin can decide machine A and B are
</I>&gt;<i> the child  and machine C and D as parents. Both A and B can use C and D
</I>&gt;<i> as parents - for load balancing and redundancy. 
</I>&gt;<i> 
</I>&gt;<i> A -&gt; parent -&gt; C
</I>&gt;<i> A -&gt; parent -&gt; D
</I>&gt;<i> B -&gt; parent -&gt; C
</I>&gt;<i> B -&gt; parent -&gt; D
</I>&gt;<i> 
</I>&gt;<i> In the UI interface admin will specify this. When it is done, in the
</I>&gt;<i> back end I will create a tunnel and reconfigure squid config file and
</I>&gt;<i> start squid. Now in the UI I need to specify whether every thing is
</I>&gt;<i> perfect and A and B can talk to C and D seamlessly - or the traffic is
</I>&gt;<i> perfect or not. Only if the traffic between squid A and squid C and
</I>&gt;<i> squid D are perfect, I should mention that it is ACTIVE. For this I
</I>&gt;<i> thought if have some mechanism in both sides to do ping kind of
</I>&gt;<i> functionality, it would be good.
</I>
Thank you for detailing your problem!

Others on this list should be able to offer much better solutions, but
if you do not hear any, then I would use curl or wget(**) to send HTTP
requests to each child and have special rules in child squid.confs to
route those requests to the specified-in-the-request parent (probably by
matching a custom HTTP header). Your script can the analyze the Via
headers in each successful response to confirm that the transaction went
to the right parent.

Given your example above, four requests would be sufficient to confirm
connectivity. Please note that those requests cannot confirm whether A
is also _not_ using B as a parent and C is not using D as a parent (for
example). To prove all those &quot;negatives&quot;, you will need a few more
requests (and possibly slightly fancier routing rules in squid.conf).

You may be able to send HTTP TRACE requests with Max-Forwards:1 header
if your Squids support that. That way, you will be testing the
connectivity between Squids without being dependent on the outside
connectivity and can analyze forwarded request headers as well, but this
is optional.


Needless to say, you can run a similar script/analysis every T minutes
if you wish to monitor connectivity continuously, after everything has
been configured. However, at runtime, your focus should be on monitoring
for errors, response times, hit ratios, and other measurements that may
reveal Squid problems.


FWIW, &quot;pinging&quot; in the reverse direction (e.g., from C to A) does not
make sense to me and should not be necessary to confirm connectivity
that normal requests will use.


HTH,

Alex.
(**) You may use squidclient as well but I do not recommend that because
it lacks polish and some advanced features that you may eventually find
useful.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014373.html">[squid-users] heart beet between squid peers
</A></li>
	<LI>Next message (by thread): <A HREF="014323.html">[squid-users] irregular traffic when using proxy, not if NATed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14376">[ date ]</a>
              <a href="thread.html#14376">[ thread ]</a>
              <a href="subject.html#14376">[ subject ]</a>
              <a href="author.html#14376">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
