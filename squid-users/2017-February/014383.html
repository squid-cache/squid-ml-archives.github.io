<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Basic HTTPS filtering via CONNECT in Squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Basic%20HTTPS%20filtering%20via%20CONNECT%20in%20Squid&In-Reply-To=%3CCABUhpQU5WC3ntYoNx%2BZzyDmeE_%3DU466x_BmoNQMMQqhXsJehEA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014382.html">
   <LINK REL="Next"  HREF="014394.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Basic HTTPS filtering via CONNECT in Squid</H1>
    <B>Varun Singh</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Basic%20HTTPS%20filtering%20via%20CONNECT%20in%20Squid&In-Reply-To=%3CCABUhpQU5WC3ntYoNx%2BZzyDmeE_%3DU466x_BmoNQMMQqhXsJehEA%40mail.gmail.com%3E"
       TITLE="[squid-users] Basic HTTPS filtering via CONNECT in Squid">varun.singh at gslab.com
       </A><BR>
    <I>Mon Feb  6 13:46:07 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014382.html">[squid-users] Basic HTTPS filtering via CONNECT in Squid
</A></li>
        <LI>Next message (by thread): <A HREF="014394.html">[squid-users] Basic HTTPS filtering via CONNECT in Squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14383">[ date ]</a>
              <a href="thread.html#14383">[ thread ]</a>
              <a href="subject.html#14383">[ subject ]</a>
              <a href="author.html#14383">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Feb 6, 2017 at 11:39 AM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:
&gt;<i> On 6/02/2017 6:10 p.m., Varun Singh wrote:
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i> I have a Squid 3 installed on Ubuntu 16.04. It works perfectly as an
</I>&gt;&gt;<i> HTTP proxy server in transparent mode.
</I>&gt;&gt;<i> I wanted to know whether it can be configured to run as HTTPS proxy
</I>&gt;&gt;<i> server without ssl-bump i.e. without 'man in the middle attack'
</I>&gt;&gt;<i> technique.
</I>&gt;<i>
</I>&gt;<i> The Ubuntu package of squid/squid3 can tunnel CONNECT requests. That is
</I>&gt;<i> all. It has no support for anything more complicated.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I read the documentation page of HTTPS support. It says that when a
</I>&gt;&gt;<i> browser comes across an HTTPS website, it opens a TCP tunnel through
</I>&gt;&gt;<i> Squid to the origin server using CONNECT reuqest method.
</I>&gt;&gt;<i> With this setting the server can filter URLs based on URL scheme, URL
</I>&gt;&gt;<i> path and query string. The payload is still encrypted.
</I>&gt;<i>
</I>&gt;<i> What documentation? it is wrong, or you are misunderstanding it. The URL
</I>&gt;<i> path?query is definitely *not* available without decrypting.
</I>&gt;<i>
</I>&gt;<i> FWIW the squid wiki page on HTTPS documents all three of the
</I>&gt;<i> installation types that are all called &quot;HTTPS&quot;.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> After that the documentation goes on to explain how can we use
</I>&gt;&gt;<i> SSL-bump to decrypt the payload.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Now, I only want setup basic HTTPS proxy via CONNECT tunnel in which
</I>&gt;&gt;<i> you can only filter URL path and string. I am not looking to setup
</I>&gt;&gt;<i> SSL-bump but still want to setup Squid for HTTPS filtering. I'm not
</I>&gt;&gt;<i> able to find a good tutorial for that.
</I>&gt;&gt;<i> Every tutorial I have found points to setting up SSL-bump.
</I>&gt;<i>
</I>&gt;<i> Because the only way to access more than hostname/IP and port is to decrypt.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

Hi,
Please find my reply inline:

&gt;<i> What documentation? it is wrong, or you are misunderstanding it. The URL
</I>&gt;<i> path?query is definitely *not* available without decrypting.
</I>&gt;<i>
</I>
Correct, I mis-read it.


&gt;<i> Because the only way to access more than hostname/IP and port is to decrypt.
</I>
Okay. In that, case I am okay with only being able to see hostname/IP and port.
But whenever I search for setting up HTTPS with Squid, I always come
across SSL-bump.
Could you point me to a tutorial which perform just basic HTTPS setup?

What I have tried so far is, configuring Squid to listen to port 3129
to expect HTTPS traffic. I did this by adding following line to
squid.conf:

https_port 3129

Once this was done, I redirected all the traffic coming to port 443 to
port 3129 using iptables. This is because my clients connect to proxy
via VPN.
But this had no effect. After connecting clients to proxy, when I try
to access an HTTPS website, the clients get no response and nothing
shows in access.log file. The browser behaves as if it could not
connect to internet.

Please note that this setup works perfectly for HTTP requests. Only
HTTPS requests give problems.



FYI, by documentation I was referring to below link:
<A HREF="http://wiki.squid-cache.org/Features/HTTPS">http://wiki.squid-cache.org/Features/HTTPS</A>


-- 
Regards,
Varun

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014382.html">[squid-users] Basic HTTPS filtering via CONNECT in Squid
</A></li>
	<LI>Next message (by thread): <A HREF="014394.html">[squid-users] Basic HTTPS filtering via CONNECT in Squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14383">[ date ]</a>
              <a href="thread.html#14383">[ thread ]</a>
              <a href="subject.html#14383">[ subject ]</a>
              <a href="author.html#14383">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
