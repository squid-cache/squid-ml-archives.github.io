<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Is it possible to modify cached object?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Is%20it%20possible%20to%20modify%20cached%20object%3F&In-Reply-To=%3C65b40acc-3dcb-8843-aefe-5150404f6eca%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014395.html">
   <LINK REL="Next"  HREF="014402.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Is it possible to modify cached object?</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Is%20it%20possible%20to%20modify%20cached%20object%3F&In-Reply-To=%3C65b40acc-3dcb-8843-aefe-5150404f6eca%40measurement-factory.com%3E"
       TITLE="[squid-users] Is it possible to modify cached object?">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Feb  7 00:55:43 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014395.html">[squid-users] Is it possible to modify cached object?
</A></li>
        <LI>Next message (by thread): <A HREF="014402.html">[squid-users] Is it possible to modify cached object?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14397">[ date ]</a>
              <a href="thread.html#14397">[ thread ]</a>
              <a href="subject.html#14397">[ subject ]</a>
              <a href="author.html#14397">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 02/06/2017 03:27 PM, boruc wrote:

&gt;<i> So I've installed squid 3.5.12, libecap 1.0.1 and sample adapter 1.0.0. I
</I>&gt;<i> was able to test a simple &quot;the -&gt; a&quot; replacement shown in  documentation
</I>&gt;<i> &lt;<A HREF="http://www.e-cap.org/Documentation">http://www.e-cap.org/Documentation</A>&gt;  . Next I tried some HTML injection,
</I>&gt;<i> also from documentation. However, it didn't work and I got error like below:
</I>
&gt;<i> 2017/02/06 17:56:30 kid1| FATAL: dying from an unhandled exception:
</I>&gt;<i> Modifying Adapter: configuration error: unsupported configuration parameter:
</I>&gt;<i> replacement-src
</I>
As you have figured out already, the following bug report adds
replacement-src support to sample adapter v1.0:
<A HREF="https://bugs.launchpad.net/ecap/+bug/1634621">https://bugs.launchpad.net/ecap/+bug/1634621</A>


&gt;<i> What is more, when I try regular text replacement and I use space in
</I>&gt;<i> replacement text I get no error message in cache.log, but browser says that
</I>&gt;<i> &quot;proxy server is refusing connections&quot; and executing command &quot;squid -k
</I>&gt;<i> check&quot; gives me this:
</I>
Squid is picky about spaces because they often separate various
configuration tokens. You can try to quote your replacement string,
possibly after turning configuration_includes_quoted_values on.

On the other hand, virtually all production adapters that inject content
into HTML pages need a far more sophisticated injection algorithm then
the primitive sample adapter you are using, so it probably does not make
sense to spend time on making spaces work in this configuration context.


&gt;<i> 2017/02/06 19:11:11| /etc/squid/squid.conf:84: Duplicate option &quot;uri&quot; in
</I>&gt;<i> adaptation service definition
</I>&gt;<i> FATAL: /etc/squid/squid.conf:84: malformed adaptation service configuration
</I>&gt;<i> Squid Cache (Version 3.5.12): Terminated abnormally.
</I>&gt;<i> 
</I>&gt;<i> I managed to find a  bugfix &lt;<A HREF="https://bugs.launchpad.net/ecap/+bug/1634621">https://bugs.launchpad.net/ecap/+bug/1634621</A>&gt;  
</I>&gt;<i> to *replacement-src* problem, but how should I
</I>&gt;<i> appy this? Just add lines with &quot;+&quot; at the beginning and recompile sources
</I>&gt;<i> one more time?
</I>
You should use a &quot;patch&quot; program to apply the patch to the adapter
sample sources and then rebuild the adapter from scratch.


&gt;<i> Will it work with spaces in replacement text? 
</I>
Yes, spaces are supported in the replacement text loaded from a file.


&gt;<i> My main goal is to add a
</I>&gt;<i> paragraph to requested page, with link or image, but tags for those require
</I>&gt;<i> spaces in string.
</I>
If you have not already, please read the following FAQ page for various
problems you will need to solve. The sample adapter does _not_ solve
most of them: <A HREF="https://answers.launchpad.net/ecap/+faq/1793">https://answers.launchpad.net/ecap/+faq/1793</A>


&gt;<i> Or maybe I have to write my own adapter to this?
</I>
YMMV, but I speculate that most folks that do not know how to patch
source files would have to learn a lot of complex topics before they
would be able to write a quality injection adapter from scratch. That
speculation, together with the complications mentioned at the above FAQ
page, prompt me to discourage you from attempting to write your own
adapter in C++.

I have not tried it myself yet, but you might be interested in the
following Tcl wrapper for eCAP API:
<A HREF="https://github.com/petasis/ecap-tcl">https://github.com/petasis/ecap-tcl</A>

The other standard options include, if your project allows for that,
finding a capable C++ developer to write an adapter for you and buying a
ready-to-use adapter.


HTH,

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014395.html">[squid-users] Is it possible to modify cached object?
</A></li>
	<LI>Next message (by thread): <A HREF="014402.html">[squid-users] Is it possible to modify cached object?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14397">[ date ]</a>
              <a href="thread.html#14397">[ thread ]</a>
              <a href="subject.html#14397">[ subject ]</a>
              <a href="author.html#14397">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
