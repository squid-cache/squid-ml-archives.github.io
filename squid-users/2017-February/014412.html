<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Transparent Squid issue with Appstore in MacOS	Sierra
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Transparent%20Squid%20issue%20with%20Appstore%20in%20MacOS%0A%09Sierra&In-Reply-To=%3CCA%2BsSnVYET8o0C_MoRLsQwrp1SRbodU_KNE9Cp96w70EodwoWzA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014408.html">
   <LINK REL="Next"  HREF="014415.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Transparent Squid issue with Appstore in MacOS	Sierra</H1>
    <B>Hardik Dangar</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Transparent%20Squid%20issue%20with%20Appstore%20in%20MacOS%0A%09Sierra&In-Reply-To=%3CCA%2BsSnVYET8o0C_MoRLsQwrp1SRbodU_KNE9Cp96w70EodwoWzA%40mail.gmail.com%3E"
       TITLE="[squid-users] Transparent Squid issue with Appstore in MacOS	Sierra">hardikdangar+squid at gmail.com
       </A><BR>
    <I>Wed Feb  8 11:08:53 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014408.html">[squid-users] Transparent Squid issue with Appstore in MacOS Sierra
</A></li>
        <LI>Next message (by thread): <A HREF="014415.html">[squid-users] Transparent Squid issue with Appstore in MacOS	Sierra
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14412">[ date ]</a>
              <a href="thread.html#14412">[ thread ]</a>
              <a href="subject.html#14412">[ subject ]</a>
              <a href="author.html#14412">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>here is my squid.conf <A HREF="http://pastebin.com/raw/9BTcpVkL">http://pastebin.com/raw/9BTcpVkL</A>

Here is what log looks like when i grep packates from Apple Devices when
app store is opened.

1486551793.635    742 192.168.1.12 TAG_NONE/200 0 CONNECT 17.110.234.27:443
- ORIGINAL_DST/17.110.234.27 -
1486551796.343  30610 192.168.1.12 TAG_NONE/200 0 CONNECT 104.113.210.17:443
- HIER_NONE/- -
1486551796.343  30605 192.168.1.12 TCP_TUNNEL/200 30574 CONNECT
init.itunes.apple.com:443 - ORIGINAL_DST/104.113.210.17 -
1486551799.097  30326 192.168.1.12 TAG_NONE/200 0 CONNECT 104.113.210.17:443
- HIER_NONE/- -
1486551799.097  30324 192.168.1.12 TCP_TUNNEL/200 30584 CONNECT
init.itunes.apple.com:443 - ORIGINAL_DST/104.113.210.17 -
1486551799.502    726 192.168.1.12 TAG_NONE/200 0 CONNECT 17.110.234.27:443
- ORIGINAL_DST/17.110.234.27 -
2017/02/08 16:33:19 kid1| SECURITY ALERT: Host header forgery detected on
local=17.173.66.101:443 remote=192.168.1.12:53158 FD 477 flags=33 (local IP
does not match any domain IP)
1486551805.013  59549 192.168.1.12 TAG_NONE/200 0 CONNECT 17.110.234.27:443
- ORIGINAL_DST/17.110.234.27 -
2017/02/08 16:33:33 kid1| SECURITY ALERT: Host header forgery detected on
local=104.113.210.17:443 remote=192.168.1.12:53159 FD 659 flags=33 (local
IP does not match any domain IP)
1486551826.441  57130 192.168.1.12 TAG_NONE/200 0 CONNECT 17.173.66.96:443
- HIER_NONE/- -
1486551826.441  57052 192.168.1.12 TCP_TUNNEL/200 6671 CONNECT
pd-st.itunes.apple.com:443 - ORIGINAL_DST/17.173.66.96 -
1486551852.061    211 192.168.1.12 TAG_NONE/200 0 CONNECT 104.113.210.11:443
- ORIGINAL_DST/104.113.210.11 -
1486551852.434    216 192.168.1.12 TCP_MISS/200 7010 GET
<A HREF="https://configuration.apple.com/configurations/internetservices/cloudkit/cloudkit-1.0.plist">https://configuration.apple.com/configurations/internetservices/cloudkit/cloudkit-1.0.plist</A>
- ORIGINAL_DST/104.113.210.11 text/xml
1486551881.425    234 192.168.1.12 TAG_NONE/200 0 CONNECT 17.252.172.5:443
- ORIGINAL_DST/17.252.172.5 -
1486551881.791    130 192.168.1.12 TCP_MISS_ABORTED/200 620 ACE
<A HREF="https://guzzoni.apple.com/ace">https://guzzoni.apple.com/ace</A> - ORIGINAL_DST/17.252.172.5 -
1486551882.684    207 192.168.1.12 TAG_NONE/200 0 CONNECT 17.252.172.5:443
- ORIGINAL_DST/17.252.172.5 -
1486551882.829    348 192.168.1.12 TCP_REFRESH_MODIFIED/200 415 HEAD
<A HREF="http://www.apple.com/">http://www.apple.com/</A> - ORIGINAL_DST/104.113.211.46 text/html
1486551882.859     68 192.168.1.12 TCP_MISS/200 101 HEAD
<A HREF="https://guzzoni.apple.com/salt">https://guzzoni.apple.com/salt</A> - ORIGINAL_DST/17.252.172.5 -
1486551883.004    207 192.168.1.12 TAG_NONE/200 0 CONNECT 17.252.172.5:443
- ORIGINAL_DST/17.252.172.5 -
1486551883.083     67 192.168.1.12 TCP_MISS/406 133 HEAD
<A HREF="https://guzzoni.apple.com/ace">https://guzzoni.apple.com/ace</A> - ORIGINAL_DST/17.252.172.5 -
1486551884.123    202 192.168.1.12 TAG_NONE/200 0 CONNECT 17.252.172.5:443
- ORIGINAL_DST/17.252.172.5 -
1486551884.301     81 192.168.1.12 TCP_MISS_ABORTED/200 622 ACE
<A HREF="https://guzzoni.apple.com/ace">https://guzzoni.apple.com/ace</A> - ORIGINAL_DST/17.252.172.5 -
1486551886.908     43 192.168.1.12 TCP_REFRESH_MODIFIED/200 415 HEAD
<A HREF="http://www.apple.com/">http://www.apple.com/</A> - ORIGINAL_DST/104.113.211.46 text/html
1486551887.085    207 192.168.1.12 TAG_NONE/200 0 CONNECT 17.252.172.5:443
- ORIGINAL_DST/17.252.172.5 -
1486551887.168     67 192.168.1.12 TCP_MISS/406 133 HEAD
<A HREF="https://guzzoni.apple.com/ace">https://guzzoni.apple.com/ace</A> - ORIGINAL_DST/17.252.172.5 -
1486551887.310    200 192.168.1.12 TAG_NONE/200 0 CONNECT 17.252.172.5:443
- ORIGINAL_DST/17.252.172.5 -
1486551887.416     68 192.168.1.12 TCP_MISS/200 101 HEAD
<A HREF="https://guzzoni.apple.com/salt">https://guzzoni.apple.com/salt</A> - ORIGINAL_DST/17.252.172.5 -


On Wed, Feb 8, 2017 at 12:35 AM, Hardik Dangar &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">hardikdangar+squid at gmail.com</A>
&gt;<i> wrote:
</I>
&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Here is some information about my squid version,
</I>&gt;<i>
</I>&gt;<i> Squid Cache: Version 3.5.23
</I>&gt;<i> Service Name: squid
</I>&gt;<i> configure options:  '--prefix=/usr' '--localstatedir=/var/squid'
</I>&gt;<i> '--libexecdir=/lib/squid' '--srcdir=.' '--datadir=/share/squid'
</I>&gt;<i> '--sysconfdir=/etc/squid' '--with-default-user=proxy'
</I>&gt;<i> '--with-logdir=/var/log/squid' '--with-pidfile=/var/run/squid.pid'
</I>&gt;<i> '--with-openssl' '--enable-ssl-crtd' '--enable-inline'
</I>&gt;<i> '--disable-arch-native' '--enable-async-io=8' '--enable-storeio=ufs,aufs,diskd,rock'
</I>&gt;<i> '--enable-removal-policies=lru,heap' '--enable-delay-pools'
</I>&gt;<i> '--enable-follow-x-forwarded-for' '--enable-url-rewrite-helpers=fake'
</I>&gt;<i> '--enable-ecap'
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> We are running squid as transparent proxy and have certs installed in all
</I>&gt;<i> systems. Until recently all our systems were ubuntu or windows. Recently we
</I>&gt;<i> added mac os Seirra and the biggest issue we had with mac is even after
</I>&gt;<i> installing certificates. Few apps have problems.
</I>&gt;<i>
</I>&gt;<i> Our biggest problem is Itunes Store. It just doesn't work for some reason.
</I>&gt;<i> if we check the log we get random ip's trying to connect via 443 port but
</I>&gt;<i> it doesn't connect.
</I>&gt;<i> Also Skype for Mac does not work. strangely this works for windows and
</I>&gt;<i> ubuntu in our network. Again we see the same behavior.
</I>&gt;<i>
</I>&gt;<i> both of these apps does not work even in Iphone and Ipad.
</I>&gt;<i>
</I>&gt;<i> I believe someone must be able to configure transparent squid with Mac.
</I>&gt;<i> can anyone tell me if i need to do anything extra for Mac setup.
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170208/2e50c5de/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170208/2e50c5de/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014408.html">[squid-users] Transparent Squid issue with Appstore in MacOS Sierra
</A></li>
	<LI>Next message (by thread): <A HREF="014415.html">[squid-users] Transparent Squid issue with Appstore in MacOS	Sierra
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14412">[ date ]</a>
              <a href="thread.html#14412">[ thread ]</a>
              <a href="subject.html#14412">[ subject ]</a>
              <a href="author.html#14412">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
