<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Transparent Squid issue with Appstore in	MacOS	Sierra
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Transparent%20Squid%20issue%20with%20Appstore%20in%0A%09MacOS%09Sierra&In-Reply-To=%3CDB6PR0401MB26808B9DF421C29411E983BE8F450%40DB6PR0401MB2680.eurprd04.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014422.html">
   <LINK REL="Next"  HREF="014418.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Transparent Squid issue with Appstore in	MacOS	Sierra</H1>
    <B>Rafael Akchurin</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Transparent%20Squid%20issue%20with%20Appstore%20in%0A%09MacOS%09Sierra&In-Reply-To=%3CDB6PR0401MB26808B9DF421C29411E983BE8F450%40DB6PR0401MB2680.eurprd04.prod.outlook.com%3E"
       TITLE="[squid-users] Transparent Squid issue with Appstore in	MacOS	Sierra">rafael.akchurin at diladele.com
       </A><BR>
    <I>Thu Feb  9 14:47:59 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014422.html">[squid-users] Transparent Squid issue with Appstore in MacOS	Sierra
</A></li>
        <LI>Next message (by thread): <A HREF="014418.html">[squid-users] Tunnelling requests using squid-cache
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14423">[ date ]</a>
              <a href="thread.html#14423">[ thread ]</a>
              <a href="subject.html#14423">[ subject ]</a>
              <a href="author.html#14423">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Hardik and all,

Try adding  .mzstatic.com to your exclusion from SSL bump as indicated on  <A HREF="https://docs.diladele.com/faq/squid/sslbump_exlusions/apple_app_store.html">https://docs.diladele.com/faq/squid/sslbump_exlusions/apple_app_store.html</A>
Please note you need to adapt it to regex as we use it in ssl::server_name directive.

Best regards,
Rafael Akchurin
Diladele B.V.

From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Hardik Dangar
Sent: Thursday, February 9, 2017 3:44 PM
To: Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;; Squid Users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
Subject: Re: [squid-users] Transparent Squid issue with Appstore in MacOS Sierra

hey eliezer,

thanks for quick response i am actually using following,

acl DiscoverSNIHost at_step SslBump1
acl NoSSLIntercept ssl::server_name_regex -i &quot;/etc/squid/url.nobump&quot;
ssl_bump splice NoSSLIntercept
ssl_bump peek DiscoverSNIHost
ssl_bump bump all

contents of url.nobump file are,

update\.microsoft\.com$
update\.microsoft\.com\.akadns\.net$
v10\.vortex\-win\.data\.microsoft.com&lt;<A HREF="http://microsoft.com">http://microsoft.com</A>&gt;$
settings\-win\.data\.microsoft\.com$
# The next are trusted SKYPE addresses
a\.config\.skype\.com$
pipe\.skype\.com$
w[0-9]+\.web\.whatsapp\.com$
tty\.scaleway\.com$
eaadhaar\.uidai\.gov\.in$
facebook\.com$
opera\.com$
itunes\.apple\.com$


Do i need to do anything additional? or are you suggesting i remove bumping completely and just use splice feature only.


On Thu, Feb 9, 2017 at 3:52 PM, Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;&gt; wrote:
Thanks for sharing the details.
But you didn&#8217;t answered if you tried slice with ssl bump.
Let me know if you have tried it.

Eliezer

----
Eliezer Croitoru&lt;<A HREF="http://ngtech.co.il/lmgtfy/">http://ngtech.co.il/lmgtfy/</A>&gt;
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;
[cid:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">image001.png at 01D282EB.E03F0E80</A>]

From: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">hardikdangar at gmail.com</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">hardikdangar at gmail.com</A>&gt; [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">hardikdangar at gmail.com</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">hardikdangar at gmail.com</A>&gt;] On Behalf Of Hardik Dangar
Sent: Wednesday, February 8, 2017 10:17 PM
To: Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;&gt;
Cc: Squid Users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;&gt;
Subject: Re: [squid-users] Transparent Squid issue with Appstore in MacOS Sierra

I am using following command,

i am converting pem file into cer using openssl and then putting that file using this command into keychain.
sudo security add-trusted-cert -d -r trustRoot -k &quot;/Library/Keychains/System.keychain&quot; &quot;~/mycert.cer&quot;

On Wed, Feb 8, 2017 at 9:36 PM, Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;&gt; wrote:
Can you give me\us a link to instructions how you have installed the certificate on MAC OS?
I know how to do it on Windows and Linux but not MAC OS.

Also, have you tried using peek and splice? From your email it seems you have not tried to use these.(If you need instructions I would be happy to share what I am using for windows updates and it can be adapted to appstore).

Thanks,
Eliezer

----
<A HREF="http://ngtech.co.il/lmgtfy/">http://ngtech.co.il/lmgtfy/</A>
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;


From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt;] On Behalf Of Hardik Dangar
Sent: Tuesday, February 7, 2017 9:06 PM
To: Squid Users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;&gt;
Subject: [squid-users] Transparent Squid issue with Appstore in MacOS Sierra

Hello,


Here is some information about my squid version,

Squid Cache: Version 3.5.23
Service Name: squid
configure options:  '--prefix=/usr' '--localstatedir=/var/squid' '--libexecdir=/lib/squid' '--srcdir=.' '--datadir=/share/squid' '--sysconfdir=/etc/squid' '--with-default-user=proxy' '--with-logdir=/var/log/squid' '--with-pidfile=/var/run/squid.pid' '--with-openssl' '--enable-ssl-crtd' '--enable-inline' '--disable-arch-native' '--enable-async-io=8' '--enable-storeio=ufs,aufs,diskd,rock' '--enable-removal-policies=lru,heap' '--enable-delay-pools' '--enable-follow-x-forwarded-for' '--enable-url-rewrite-helpers=fake' '--enable-ecap'


We are running squid as transparent proxy and have certs installed in all systems. Until recently all our systems were ubuntu or windows. Recently we added mac os Seirra and the biggest issue we had with mac is even after installing certificates. Few apps have problems.

Our biggest problem is Itunes Store. It just doesn't work for some reason. if we check the log we get random ip's trying to connect via 443 port but it doesn't connect.
Also Skype for Mac does not work. strangely this works for windows and ubuntu in our network. Again we see the same behavior.

both of these apps does not work even in Iphone and Ipad.

I believe someone must be able to configure transparent squid with Mac. can anyone tell me if i need to do anything extra for Mac setup.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170209/38181d0f/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170209/38181d0f/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 11297 bytes
Desc: image001.png
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170209/38181d0f/attachment.png">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170209/38181d0f/attachment.png</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014422.html">[squid-users] Transparent Squid issue with Appstore in MacOS	Sierra
</A></li>
	<LI>Next message (by thread): <A HREF="014418.html">[squid-users] Tunnelling requests using squid-cache
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14423">[ date ]</a>
              <a href="thread.html#14423">[ thread ]</a>
              <a href="subject.html#14423">[ subject ]</a>
              <a href="author.html#14423">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
