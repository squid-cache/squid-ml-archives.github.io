<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Basic HTTPS filtering via CONNECT in Squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Basic%20HTTPS%20filtering%20via%20CONNECT%20in%20Squid&In-Reply-To=%3CCABUhpQWZ%2B47EE7LWs%3DBxok5rnbNN%2BAb7WYFkj%3Du6-FGbm%2Bqn%2Bw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014394.html">
   <LINK REL="Next"  HREF="014434.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Basic HTTPS filtering via CONNECT in Squid</H1>
    <B>Varun Singh</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Basic%20HTTPS%20filtering%20via%20CONNECT%20in%20Squid&In-Reply-To=%3CCABUhpQWZ%2B47EE7LWs%3DBxok5rnbNN%2BAb7WYFkj%3Du6-FGbm%2Bqn%2Bw%40mail.gmail.com%3E"
       TITLE="[squid-users] Basic HTTPS filtering via CONNECT in Squid">varun.singh at gslab.com
       </A><BR>
    <I>Fri Feb 10 11:05:56 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014394.html">[squid-users] Basic HTTPS filtering via CONNECT in Squid
</A></li>
        <LI>Next message (by thread): <A HREF="014434.html">[squid-users] Basic HTTPS filtering via CONNECT in Squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14428">[ date ]</a>
              <a href="thread.html#14428">[ thread ]</a>
              <a href="subject.html#14428">[ subject ]</a>
              <a href="author.html#14428">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Feb 7, 2017 at 3:48 AM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:
&gt;<i> On 7/02/2017 2:46 a.m., Varun Singh wrote:
</I>&gt;&gt;<i> On Mon, Feb 6, 2017 at 11:39 AM, Amos Jeffries wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i> Please find my reply inline:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> What documentation? it is wrong, or you are misunderstanding it. The URL
</I>&gt;&gt;&gt;<i> path?query is definitely *not* available without decrypting.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Correct, I mis-read it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Because the only way to access more than hostname/IP and port is to decrypt.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Okay. In that, case I am okay with only being able to see hostname/IP and port.
</I>&gt;&gt;<i> But whenever I search for setting up HTTPS with Squid, I always come
</I>&gt;&gt;<i> across SSL-bump.
</I>&gt;&gt;<i> Could you point me to a tutorial which perform just basic HTTPS setup?
</I>&gt;<i>
</I>&gt;<i> The Squid default config handles as much of HTTPS as can be handled
</I>&gt;<i> without the SSL-Bump feature.
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> What I have tried so far is, configuring Squid to listen to port 3129
</I>&gt;&gt;<i> to expect HTTPS traffic. I did this by adding following line to
</I>&gt;&gt;<i> squid.conf:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> https_port 3129
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Once this was done, I redirected all the traffic coming to port 443 to
</I>&gt;&gt;<i> port 3129 using iptables. This is because my clients connect to proxy
</I>&gt;&gt;<i> via VPN.
</I>&gt;<i>
</I>&gt;<i> Since you are intercepting port 443 that port is missing the 'intercept'
</I>&gt;<i> flag. Also, interceptig port 443 requires SSL-Bump.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> But this had no effect. After connecting clients to proxy, when I try
</I>&gt;&gt;<i> to access an HTTPS website, the clients get no response and nothing
</I>&gt;&gt;<i> shows in access.log file. The browser behaves as if it could not
</I>&gt;&gt;<i> connect to internet.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Please note that this setup works perfectly for HTTP requests. Only
</I>&gt;&gt;<i> HTTPS requests give problems.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Port 80 (HTTP) and port 443 (HTTPS) have totally different transport
</I>&gt;<i> protocols. The port 443 one is designed to break when being intercepted.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> FYI, by documentation I was referring to below link:
</I>&gt;&gt;<i> <A HREF="http://wiki.squid-cache.org/Features/HTTPS">http://wiki.squid-cache.org/Features/HTTPS</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Amos
</I>
Thanks Amos. Sorry I couldn't reply early.

So in this case, say I want to configure HTTPS proxy from a
web-browser directly and not through VPN. In that case there will be
no port forwarding involved and hence 443 shouldn't break. To achieve
this, what configurations will have to be set in squid.conf file? I am
assuming we will have to at least provide a port number by adding
'https_port 3129'. Is there anything else I will have to do?

Thanks for your help.



-- 
Regards,
Varun

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014394.html">[squid-users] Basic HTTPS filtering via CONNECT in Squid
</A></li>
	<LI>Next message (by thread): <A HREF="014434.html">[squid-users] Basic HTTPS filtering via CONNECT in Squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14428">[ date ]</a>
              <a href="thread.html#14428">[ thread ]</a>
              <a href="subject.html#14428">[ subject ]</a>
              <a href="author.html#14428">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
