<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid on separate box and it can't see packets
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20on%20separate%20box%20and%20it%20can%27t%20see%20packets&In-Reply-To=%3CCAKNtY_za61AyNijVgLv%3D%2BM4tW8JeWgHQVNwvs1pJjfU62vCWTw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014451.html">
   <LINK REL="Next"  HREF="014464.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid on separate box and it can't see packets</H1>
    <B>John Pearson</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20on%20separate%20box%20and%20it%20can%27t%20see%20packets&In-Reply-To=%3CCAKNtY_za61AyNijVgLv%3D%2BM4tW8JeWgHQVNwvs1pJjfU62vCWTw%40mail.gmail.com%3E"
       TITLE="[squid-users] Squid on separate box and it can't see packets">johnpearson555 at gmail.com
       </A><BR>
    <I>Tue Feb 14 20:18:25 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014451.html">[squid-users] Squid on separate box and it can't see packets
</A></li>
        <LI>Next message (by thread): <A HREF="014464.html">[squid-users] Squid on separate box and it can't see packets
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14455">[ date ]</a>
              <a href="thread.html#14455">[ thread ]</a>
              <a href="subject.html#14455">[ subject ]</a>
              <a href="author.html#14455">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

Is this squid box a router or just a proxy?
- just a proxy

What tcpdump command did you ran?
- sudo tcpdump -i eth0

What is the networks that are involved?
Setup:

&gt;<i> Client        (192.168.1.8) ---&gt;  |     Rotuer        |
</I>&gt;<i>                                                | gateway/dhcp | ---&gt;
</I>&gt;<i> Internet
</I>&gt;<i> Squid box (192.168.1.2) ---&gt;  |  192.168.1.1   |
</I>

Here Client (debian), squid (debian) and router are three separate devices.

What is the gateway and dhcp for this network?
- Router is both gateway and dhcp server

If the client is a linux box then we need the output of:

ifconfig:

&gt;<i> eth0   Link encap:Ethernet  HWaddr b8:27:eb:91:83:20
</I>&gt;<i>           inet addr:192.168.1.8  Bcast:192.168.1.255  Mask:255.255.255.0
</I>&gt;<i>           inet6 addr: fe80::6236:7570:1f1e:d238/64 Scope:Link
</I>&gt;<i>           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
</I>&gt;<i>           RX packets:3214 errors:0 dropped:0 overruns:0 frame:0
</I>&gt;<i>           TX packets:8985 errors:0 dropped:0 overruns:0 carrier:0
</I>&gt;<i>           collisions:0 txqueuelen:1000
</I>&gt;<i>           RX bytes:478898 (467.6 KiB)  TX bytes:2308050 (2.2 MiB)
</I>


ip route:

&gt;<i> default via 192.168.1.1 dev eth0
</I>&gt;<i> 169.254.0.0/16 dev eth0  proto kernel  scope link  src 169.254.219.186
</I>&gt;<i>  metric 202
</I>

On Mon, Feb 13, 2017 at 10:44 PM, Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;
wrote:

&gt;<i> Hey,
</I>&gt;<i>
</I>&gt;<i> There are couple missing pieces(in my eyes) in order to understand the
</I>&gt;<i> picture.
</I>&gt;<i> Is this squid box a router or just a proxy?
</I>&gt;<i> What tcpdump command did you ran?
</I>&gt;<i> What is the networks that are involved?
</I>&gt;<i> What is the gateway and dhcp for this network?
</I>&gt;<i> If the client is a linux box then we need the output of:
</I>&gt;<i> $ ifconfig
</I>&gt;<i> $ route -n
</I>&gt;<i> Or
</I>&gt;<i> $ ip route
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> Eliezer
</I>&gt;<i>
</I>&gt;<i> ----
</I>&gt;<i> <A HREF="http://ngtech.co.il/lmgtfy/">http://ngtech.co.il/lmgtfy/</A>
</I>&gt;<i> Linux System Administrator
</I>&gt;<i> Mobile: +972-5-28704261
</I>&gt;<i> Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On
</I>&gt;<i> Behalf Of John Pearson
</I>&gt;<i> Sent: Tuesday, February 14, 2017 8:25 AM
</I>&gt;<i> To: Squid Users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
</I>&gt;<i> Subject: [squid-users] Squid on separate box and it can't see packets
</I>&gt;<i>
</I>&gt;<i> Hi all,
</I>&gt;<i> I have squid on a separate box on my network with ip address 192.168.1.2
</I>&gt;<i>
</I>&gt;<i> In squid.conf I have:
</I>&gt;<i>
</I>&gt;<i> http_port <A HREF="http://0.0.0.0:3128">http://0.0.0.0:3128</A>
</I>&gt;<i> http_port <A HREF="http://0.0.0.0:3129">http://0.0.0.0:3129</A> intercept
</I>&gt;<i>
</I>&gt;<i> -------
</I>&gt;<i>
</I>&gt;<i> On squid box:
</I>&gt;<i>
</I>&gt;<i> $ sudo netstat -lnp | grep squid
</I>&gt;<i> tcp        0      0 <A HREF="http://0.0.0.0:3128">http://0.0.0.0:3128</A>            0.0.0.0:*
</I>&gt;<i>  LISTEN      2639/(squid-1)
</I>&gt;<i> tcp        0      0 <A HREF="http://0.0.0.0:3129">http://0.0.0.0:3129</A>            0.0.0.0:*
</I>&gt;<i>  LISTEN      2639/(squid-1)
</I>&gt;<i> udp        0      0 <A HREF="http://0.0.0.0:37444">http://0.0.0.0:37444</A>           0.0.0.0:*
</I>&gt;<i>              2639/(squid-1)
</I>&gt;<i> udp6       0      0 :::41465                :::*
</I>&gt;<i>       2639/(squid-1)
</I>&gt;<i>
</I>&gt;<i> -------
</I>&gt;<i>
</I>&gt;<i> I followed this example: <A HREF="http://wiki.squid-cache.org/">http://wiki.squid-cache.org/</A>
</I>&gt;<i> ConfigExamples/Intercept/LinuxRedirect
</I>&gt;<i>
</I>&gt;<i> iptables:
</I>&gt;<i>
</I>&gt;<i> # your proxy IP
</I>&gt;<i> SQUIDIP=192.168.1.2
</I>&gt;<i>
</I>&gt;<i> # your proxy listening port
</I>&gt;<i> SQUIDPORT=3129
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> iptables -t nat -A PREROUTING -s $SQUIDIP -p tcp --dport 80 -j ACCEPT
</I>&gt;<i> iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-port
</I>&gt;<i> $SQUIDPORT
</I>&gt;<i> iptables -t nat -A POSTROUTING -j MASQUERADE
</I>&gt;<i> iptables -t mangle -A PREROUTING -p tcp --dport $SQUIDPORT -j DROP
</I>&gt;<i>
</I>&gt;<i> ------
</I>&gt;<i>
</I>&gt;<i> I am redirecting port 80 packets on my router to squid box
</I>&gt;<i>
</I>&gt;<i> On one of the clients: 192.168.1.8, I am running
</I>&gt;<i> wget -v --bind-address=192.168.1.8 <A HREF="http://squid-cache.org:80">http://squid-cache.org:80</A>
</I>&gt;<i>
</I>&gt;<i> On squid box, I am running tcpdump and I am able to see those packets:
</I>&gt;<i>
</I>&gt;<i> 22:09:58.962316 IP 192.168.1.8.52219 &gt; lists.squid-cache.org.http: Flags
</I>&gt;<i> [S], seq 1999822717, win 29200, options [mss 1460,sackOK,TS val 26932460
</I>&gt;<i> ecr 0,nop,wscale 7], length 0
</I>&gt;<i> 22:09:59.958994 IP 192.168.1.8.52219 &gt; lists.squid-cache.org.http: Flags
</I>&gt;<i> [S], seq 1999822717, win 29200, options [mss 1460,sackOK,TS val 26932560
</I>&gt;<i> ecr 0,nop,wscale 7], length 0
</I>&gt;<i> 22:10:01.958981 IP 192.168.1.8.52219 &gt; lists.squid-cache.org.http: Flags
</I>&gt;<i> [S], seq 1999822717, win 29200, options [mss 1460,sackOK,TS val 26932760
</I>&gt;<i> ecr 0,nop,wscale 7], length 0
</I>&gt;<i>
</I>&gt;<i> But squid is not seeing them. Squid log is empty.
</I>&gt;<i>
</I>&gt;<i> Need advice. Thanks!
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170214/837091ee/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170214/837091ee/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014451.html">[squid-users] Squid on separate box and it can't see packets
</A></li>
	<LI>Next message (by thread): <A HREF="014464.html">[squid-users] Squid on separate box and it can't see packets
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14455">[ date ]</a>
              <a href="thread.html#14455">[ thread ]</a>
              <a href="subject.html#14455">[ subject ]</a>
              <a href="author.html#14455">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
