<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] question about : NOTICE: Authentication not	applicable onintercepted requests.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20question%20about%20%3A%20NOTICE%3A%20Authentication%20not%0A%09applicable%20onintercepted%20requests.&In-Reply-To=%3Cvmime.58a4251d.54d0.118595cb592d426d%40ms249-lin-003.rotterdam.bazuin.nl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014463.html">
   <LINK REL="Next"  HREF="014492.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] question about : NOTICE: Authentication not	applicable onintercepted requests.</H1>
    <B>L.P.H. van Belle</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20question%20about%20%3A%20NOTICE%3A%20Authentication%20not%0A%09applicable%20onintercepted%20requests.&In-Reply-To=%3Cvmime.58a4251d.54d0.118595cb592d426d%40ms249-lin-003.rotterdam.bazuin.nl%3E"
       TITLE="[squid-users] question about : NOTICE: Authentication not	applicable onintercepted requests.">belle at bazuin.nl
       </A><BR>
    <I>Wed Feb 15 09:53:33 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014463.html">[squid-users] ACL dst handled differently in intercept after rewrite
</A></li>
        <LI>Next message (by thread): <A HREF="014492.html">[squid-users] question about : NOTICE: Authentication	not	applicable onintercepted requests.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14457">[ date ]</a>
              <a href="thread.html#14457">[ thread ]</a>
              <a href="subject.html#14457">[ subject ]</a>
              <a href="author.html#14457">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hai, 

&#160;

In configuring my debian jessie with squid 3.5.24 ( with ssl enabled ) &#160;c-icap squidclamav and winbind 4.5.5 for kerberos keytab refresing. 

&#160;

Now, im at the point of reducing my logs and i nocited : 

NOTICE: Authentication not applicable on intercepted requests. 

Messages in squid/cache.log 

&#160;

I know this is some misconfiguration somewhere but im having a hardtime to finding/understanding it. 

Where and why, so is anyone can help me finding and understanding it, that would be very nice. 

&#160;

I cant see my error and everything else is working fine, execept i havent tested the kerberos group acl yet. 

So i didnt set that http_access yet. 

&#160;

Im having the following firewall rules 

&#160;

# Not authenticated web traffice, redirected to squid in intercept mode.

-A PREROUTING -p tcp -i eth0 --dport 80 -j DNAT --to-destination 192.168.0.2:3128

-A PREROUTING -p tcp -i eth0 --dport 443 -j DNAT --to-destination 192.168.0.2:3129

Port 8080 is also open. 

&#160;

Web traffic for pc&#8217;s which are domain joint have set the proxy by GPO to hostname.domain.tld port 8080 

Web traffic for other devices dont need to authenticate. 

WPAD and DNS wpad is also set. 

&#160;

Below is mostly from the updated wiki pages. 

A big thank you to Amos Victor and others who changed the pages, looks good.

I have some small changed for a pure debian based setup with samba4 as addc and winbind for the squid member server. 

&#160;

&#160;

This is my squid config. 

# Created from a running squid version : 3.5.24

# Running os : Debian GNU/Linux 8 (jessie)

# Creation date: 2017-02-15

&#160;

auth_param negotiate program /usr/lib/squid/negotiate_wrapper_auth --kerberos /usr/lib/squid/negotiate_kerberos_auth -s HTTP/<A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy2.internal.domain.tld at INTERNAL.DOMAIN.TLD</A> --ntlm /usr/bin/ntlm_auth --helper-protocol=gss-spnego --domain=NTDOM

auth_param negotiate children 10 startup=5 idle=5

auth_param negotiate keep_alive on

external_acl_type memberof ttl=3600 negative_ttl=3600 %LOGIN /usr/lib/squid3/ext_kerberos_ldap_group_acl -d -i -m 4 -g <A HREF="https://lists.squid-cache.org/listinfo/squid-users">internet-allowed at INTERNAL.DOMAIN.TLD</A> -N <A HREF="https://lists.squid-cache.org/listinfo/squid-users">NTDOM at INTERNAL.DOMAIN.TLD</A> -S <A HREF="https://lists.squid-cache.org/listinfo/squid-users">dc1.internal.domain.tld at INTERNAL.DOMAIN.TLD</A> -D INTERNAL.DOMAIN.TLD

acl authenticated proxy_auth REQUIRED

&#160;

acl certificates rep_mime_type -i ^application/pkix-crl$

&#160;

acl windows-updates dstdomain &quot;/etc/squid/lists/updates-windows&quot;

acl antivirus-updates dstdomain &quot;/etc/squid/lists/updates-antivirus&quot;

acl localnet src fc00::/7&#160;&#160;&#160;&#160;&#160;&#160; # RFC 4193 local private network range

acl localnet src fe80::/10&#160;&#160;&#160;&#160;&#160; # RFC 4291 link-local (directly plugged) machines

acl localnet src 192.168.249.0/24&#160;&#160;&#160; # Company-1

acl localnet src 10.249.2.0/24&#160;&#160;&#160;&#160;&#160;&#160; # Company-2

acl localnet src 10.249.3.0/24&#160;&#160;&#160;&#160;&#160;&#160; # Company-3

acl localnet src 10.249.4.0/24&#160;&#160;&#160;&#160;&#160;&#160; # Company-4

acl localnet src 10.249.5.0/24&#160;&#160;&#160;&#160; &#160;&#160;# Company-5

&#160;

acl SSL_ports port 443&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # https

acl SSL_ports port 3952&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # CIC client

acl SSL_ports port 10443&#160;&#160;&#160;&#160;&#160;&#160;&#160; # https Cisco 5506x

acl Safe_ports port 80&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # http

acl Safe_ports port 21&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # ftp

acl Safe_ports port 443&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # https

acl Safe_ports port 70&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # gopher

acl Safe_ports port 210&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # wais

acl Safe_ports port 1025-65535&#160; # unregistered ports

acl Safe_ports port 280&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # http-mgmt

acl Safe_ports port 488&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # gss-http

acl Safe_ports port 591&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # filemaker

acl Safe_ports port 777&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; # multiling http

acl Safe_ports port 3952&#160;&#160;&#160;&#160;&#160;&#160;&#160; # CIC client

acl Safe_ports port 10443&#160;&#160;&#160;&#160;&#160;&#160; # https Cisco 5506x

acl CONNECT method CONNECT

&#160;

## Added : Advertising Server Block List merge from YoYo.org and Host-file.net

acl block-asbl dstdomain &quot;/etc/squid/lists/block-asbl-merged-dstdomain&quot;

http_access deny block-asbl

&#160;

acl google_recaptcha urlpath_regex ^\/recaptcha\/api.js

http_access allow google_recaptcha

&#160;

acl NO-CACHE-SITES url_regex &quot;/etc/squid/lists/no-cache-sites&quot;

no_cache deny NO-CACHE-SITES

always_direct allow NO-CACHE-SITES

cache deny NO-CACHE-SITES

&#160;

# 

http_access deny !Safe_ports

http_access deny CONNECT !SSL_ports

http_access allow localhost manager

http_access deny manager

http_access deny to_localhost

&#160;

## allow before auth so all pc's get the needed updates

http_access allow windows-updates

http_access allow antivirus-updates

&#160;

http_access allow authenticated

http_access allow localnet

http_access allow localhost

http_access deny all

&#160;

http_port 192.168.249.222:3128 intercept connection-auth=off

https_port 192.168.249.222:3129 intercept connection-auth=off ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB cert=/etc/ssl/local/CAcert.pem options=NO_SSLv3 key=/etc/ssl/local/CAkey.pem

&#160;

http_port 192.168.249.222:8080 ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB cert=/etc/ssl/local/CAcert.pem options=NO_SSLv3 key=/etc/ssl/local/CAkey.pem

sslcrtd_program /usr/lib/squid/ssl_crtd -s /var/lib/ssl_db -M 8MB

acl step1 at_step SslBump1

ssl_bump peek step1

ssl_bump bump all

sslproxy_options NO_SSLv2,NO_SSLv3,SINGLE_DH_USE

sslproxy_cipher EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH+aRSA+RC4:EECDH:EDH+aRSA:!RC4:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS

cache_mem 4096 MB

coredump_dir /var/spool/squid

ftp_user <A HREF="https://lists.squid-cache.org/listinfo/squid-users">anonymousftp at domain.tld</A>

&#160;

# 

refresh_pattern -i windowsupdate.com/.*\.(cab|exe|ms[i|u|f|p]|[ap]sf|wm[v|a]|dat|zip|psf) 43200 80% 129600 reload-into-ims

refresh_pattern -i microsoft.com/.*\.(cab|exe|ms[i|u|f|p]|[ap]sf|wm[v|a]|dat|zip|psf) 43200 80% 129600 reload-into-ims

refresh_pattern -i windows.com/.*\.(cab|exe|ms[i|u|f|p]|[ap]sf|wm[v|a]|dat|zip|psf) 43200 80% 129600 reload-into-ims

refresh_pattern -i microsoft.com.akadns.net/.*\.(cab|exe|ms[i|u|f|p]|[ap]sf|wm[v|a]|dat|zip|psf) 43200 80% 129600 reload-into-ims

refresh_pattern -i deploy.akamaitechnologies.com/.*\.(cab|exe|ms[i|u|f|p]|[ap]sf|wm[v|a]|dat|zip|psf) 43200 80% 129600 reload-into-ims

&#160;

## todo, make this list more complete, see icap excludes

refresh_pattern -i \.symantecliveupdate\.com\/.*\.(zip|7z|irn|[m|x][0-9][0-9])&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 4320&#160;&#160;&#160; 100%&#160;&#160;&#160; 43200&#160;&#160; reload-into-ims

refresh_pattern -i .*dnl.*\.geo\.kaspersky\.(com|ru)\/.*\.(zip|avc|kdc|nhg|klz|d[at|if])&#160;&#160;&#160;&#160;&#160;&#160;&#160; 4320&#160;&#160;&#160; 100%&#160;&#160;&#160; 43200&#160;&#160; reload-into-ims

refresh_pattern -i \.kaspersky-labs\.(com|ru)\/.*\.(cab|zip|exe|ms[i|p])&#160;&#160;&#160;&#160;&#160;&#160;&#160; 4320&#160;&#160;&#160; 100%&#160;&#160;&#160; 43200&#160;&#160; reload-into-ims

refresh_pattern -i \.kaspersky\.(com|ru)\/.*\.(cab|zip|exe|ms[i|p]|avc) 4320&#160;&#160;&#160; 100%&#160;&#160;&#160; 43200&#160;&#160; reload-into-ims

refresh_pattern -i .update\.geo\.drweb\.com&#160;&#160;&#160;&#160; 4320&#160;&#160;&#160; 100%&#160;&#160;&#160; 43200&#160;&#160; reload-into-ims

refresh_pattern -i \.avast.com\/.*\.(vp[u|aa])&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;4320&#160;&#160;&#160; 100%&#160;&#160;&#160; 43200&#160;&#160; reload-into-ims

refresh_pattern -i \.avg.com\/.*\.(bin)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 4320&#160;&#160;&#160; 100%&#160;&#160;&#160; 43200&#160;&#160; reload-into-ims

&#160;

## todo, add .deb files caching

refresh_pattern ^(ht|f)<A HREF="tp://.*debian.*/Packages\.(bz2|gz|diff/Index">tp://.*debian.*/Packages\.(bz2|gz|diff/Index</A>)$&#160;&#160; 0&#160;&#160;&#160;&#160;&#160;&#160; 0%&#160;&#160;&#160;&#160;&#160; 0

refresh_pattern ^(ht|f)<A HREF="tp://.*debian.*/Release(\.gpg">tp://.*debian.*/Release(\.gpg</A>)?$&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160;&#160; 0%&#160;&#160;&#160;&#160;&#160; 0

refresh_pattern ^(ht|f)<A HREF="tp://.*debian.*/Sources\.(bz2|gz|diff/Index">tp://.*debian.*/Sources\.(bz2|gz|diff/Index</A>)$&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160;&#160; 0%&#160;&#160;&#160;&#160;&#160; 0

refresh_pattern ^(ht|f)<A HREF="tp://.*debian.*/Translation-en_GB\.bz2">tp://.*debian.*/Translation-en_GB\.bz2</A>)$&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160;&#160; 0%&#160;&#160;&#160;&#160;&#160; 0

&#160;

## The defaults as last.

refresh_pattern -i \.(zip|[g|b]z2?|exe|ms[i|p]|cvd|cdiff|mar)$&#160; 43200&#160;&#160; 100%&#160;&#160;&#160; 129600&#160; reload-into-ims

refresh_pattern ^ftp:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 1440&#160;&#160;&#160; 20%&#160;&#160;&#160;&#160; 10080

refresh_pattern ^gopher:&#160;&#160;&#160;&#160;&#160;&#160;&#160; 1440&#160;&#160;&#160; 0%&#160;&#160;&#160;&#160;&#160; 1440

refresh_pattern -i (/cgi-bin/|\?) 0&#160;&#160;&#160;&#160; 0%&#160;&#160;&#160;&#160;&#160; 0

refresh_pattern .&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160;&#160; 20%&#160;&#160;&#160;&#160; 4320

cache_mgr <A HREF="https://lists.squid-cache.org/listinfo/squid-users">changed2protectme at somedomain.tld</A>

mail_from <A HREF="https://lists.squid-cache.org/listinfo/squid-users">proxy2 at internal.domain.tld</A>

visible_hostname proxy2.internal.domain.tld

hostname_aliases proxy2.internal.domain.tld

&#160;

httpd_suppress_version_string on

&#160;

icap_enable on

icap_send_client_ip on

icap_send_client_username on

icap_client_username_header X-Authenticated-User

icap_persistent_connections on

icap_preview_enable on

icap_preview_size 1024

icap_service service_req reqmod_precache <A HREF="icap://127.0.0.1:1344/squidclamav">icap://127.0.0.1:1344/squidclamav</A> bypass=off

adaptation_access service_req allow all

icap_service service_resp respmod_precache <A HREF="icap://127.0.0.1:1344/squidclamav">icap://127.0.0.1:1344/squidclamav</A> bypass=off

adaptation_access service_resp allow all

&#160;

dns_v4_first on

maximum_object_size 4096 KB

minimum_object_size 0 KB

maximum_object_size_in_memory 64 KB

cache_mem 256 MB

quick_abort_min -1 KB

fqdncache_size 4096

cache_swap_low 90

cache_swap_high 95

&#160;

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170215/94b6bf80/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170215/94b6bf80/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014463.html">[squid-users] ACL dst handled differently in intercept after rewrite
</A></li>
	<LI>Next message (by thread): <A HREF="014492.html">[squid-users] question about : NOTICE: Authentication	not	applicable onintercepted requests.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14457">[ date ]</a>
              <a href="thread.html#14457">[ thread ]</a>
              <a href="subject.html#14457">[ subject ]</a>
              <a href="author.html#14457">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
