<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] WARNING: Ignoring cache entry due to a SIZE MISMATCH
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20WARNING%3A%20Ignoring%20cache%20entry%20due%20to%20a%20SIZE%0A%20MISMATCH&In-Reply-To=%3Cd5baa8ad-2473-6433-3ac6-0027315ee15e%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014465.html">
   <LINK REL="Next"  HREF="014461.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] WARNING: Ignoring cache entry due to a SIZE MISMATCH</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20WARNING%3A%20Ignoring%20cache%20entry%20due%20to%20a%20SIZE%0A%20MISMATCH&In-Reply-To=%3Cd5baa8ad-2473-6433-3ac6-0027315ee15e%40treenet.co.nz%3E"
       TITLE="[squid-users] WARNING: Ignoring cache entry due to a SIZE MISMATCH">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Feb 19 08:03:50 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014465.html">[squid-users] WARNING: Ignoring cache entry due to a SIZE MISMATCH
</A></li>
        <LI>Next message (by thread): <A HREF="014461.html">[squid-users] squid-avira-update-cache
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14478">[ date ]</a>
              <a href="thread.html#14478">[ thread ]</a>
              <a href="subject.html#14478">[ subject ]</a>
              <a href="author.html#14478">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 18/02/2017 3:18 a.m., Heiler Bemerguy wrote:
&gt;<i> 
</I>&gt;<i> Em 17/02/2017 09:44, Amos Jeffries escreveu:
</I>&gt;&gt;<i> On 16/02/2017 10:40 a.m., Heiler Bemerguy wrote:
</I>&gt;&gt;&gt;<i> Is it normal, on every restart?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i> Well, this is a check that is only performed on restart. So in a way it
</I>&gt;&gt;<i> is &quot;normal&quot; that it occurs on restart. It should not happen at all
</I>&gt;&gt;<i> though. AFAIK, it is a sign of cache corruption...
</I>&gt;<i> 
</I>&gt;<i> Right. But cache corruption, by a hardware/disc error, can not be. These
</I>&gt;<i> disks were formatted and tested, 3 times already, while trying to solve
</I>&gt;<i> this errors and some other stuff.
</I>&gt;<i> 
</I>
Hardware errors are the most well-known, but not the only source of
corruption.

The second most common source of cache corruption is Squid being forced
to shutdown before it has fully saved the cache data. These messages are
the rock equivalent of the UFS &quot;No such file or directory&quot; warnings on
startup/restart.

The chances of these issues showing up increases with the size of the
cache, size of traffic going through the proxy at the shutdown time, and
shortness of the shutdown wait period.
Your 480 GB of rock caches is something I would expect to have at least
some issues with.

&gt;<i> 
</I>&gt;&gt;&gt;<i> maximum_object_size 2 GB
</I>&gt;&gt;&gt;<i> cache_dir rock /cache  120000 min-size=0 max-size=12288
</I>&gt;&gt;&gt;<i> slot-size=12288 max-swap-rate=250 swap-timeout=350
</I>&gt;&gt;&gt;<i> cache_dir rock /cache2 120000 min-size=10240 max-size=65536
</I>&gt;&gt;&gt;<i> max-swap-rate=250 swap-timeout=360
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i> These caches cannot store objects larger than 64KB. So where do you
</I>&gt;&gt;<i> expect the 64KB thru 2GB objects to go?
</I>&gt;<i> 
</I>&gt;<i> There are another cache_dirs just below these, like:
</I>&gt;<i> cache_dir rock /cache3 120000 min-size=65537 max-size=262144
</I>&gt;<i> max-swap-rate=250 swap-timeout=380
</I>&gt;<i> cache_dir rock /cache4 120000 min-size=262145 max-swap-rate=250
</I>&gt;<i> swap-timeout=500
</I>&gt;<i> 
</I>
Ah. Okay.

&gt;<i> 
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 2017/02/15 18:38:50 kid7| WARNING: Ignoring cache entry due to a SIZE
</I>&gt;&gt;&gt;<i> MISMATCH 5852!=5853
</I>&gt;&gt;&gt;<i> 2017/02/15 18:38:51 kid7| WARNING: Ignoring cache entry due to a SIZE
</I>&gt;&gt;&gt;<i> MISMATCH 6223!=6222
</I>&gt;&gt;&gt;<i> 2017/02/15 18:38:51 kid7| WARNING: Ignoring cache entry due to a SIZE
</I>&gt;&gt;&gt;<i> MISMATCH 4198!=4202
</I>&gt;&gt;<i> ...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> That last line means the rock database contains an object of size 4198
</I>&gt;&gt;<i> bytes, with 4202 bytes of data in it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   4202 &gt; 4198. So 4 bytes of what? the next database slot? padding data?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> You have any custom patches applied to this Squid? what version is it?
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> No patches. Squid Cache: Version 4.0.18 configure options:
</I>
Okay problems in alpha and beta code should be brought up in squid-dev
so the guys working on the changes can actually find out about problems.

&quot;If you have any problems with a development release please write to our
... <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-dev at squid-cache.org</A> lists. DO NOT write to squid-users with
code-related problems.&quot;


&gt;<i> '--enable-htcp' '--disable-maintainer-mode'
</I>&gt;<i> '--disable-dependency-tracking' '--disable-wccp' '--disable-snmp'
</I>&gt;<i> '--enable-inline' '--enable-async-io=32' '--enable-storeio=aufs,rock'
</I>&gt;<i> '--enable-underscores' '--enable-removal-policies=lru,heap'
</I>&gt;<i> '--enable-http-violations' '--disable-ident-lookups'
</I>&gt;<i> '--with-large-files' '--enable-ssl' '--enable-ltdl-convenience'
</I>&gt;<i> '--prefix=/usr' '--localstatedir=/var' '--libexecdir=/lib/squid'
</I>&gt;<i> '--srcdir=.' '--datadir=/usr/share/squid' '--sysconfdir=/etc/squid'
</I>&gt;<i> '--with-default-user=proxy' '--with-logdir=/var/log'
</I>&gt;<i> '--with-pidfile=/var/run/squid.pid' '--with-filedescriptors=16384'
</I>&gt;<i> '--with-aufs-threads=32' '--disable-translation'
</I>&gt;<i> 
</I>&gt;<i> My only */Suspicion/* is the different slot-size from kid7 (/cache). But
</I>&gt;<i> these messages also appears on kid8 (/cache2), although  with much, MUCH
</I>&gt;<i> less frequency..... (while rebuilding/restarting, always)
</I>&gt;<i> 
</I>
I dont think that matters in this case. The slot size is a multiple (3x)
of the common disk I/O page size (4KB).

The sizes being mentioned by Squid are the amont of data stored in the
slot. The slot metadata says there are N bytes inside, the object
metadata says it is M bytes big ... &quot; SIZE MISMATCH   M != N&quot;.

If &quot;kill -9&quot; or equivalent was used on kid7 during previous shutdown.
Then is will not be able to save all the slot updates it is probably
still waiting to write to disk. Resulting in what you see.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014465.html">[squid-users] WARNING: Ignoring cache entry due to a SIZE MISMATCH
</A></li>
	<LI>Next message (by thread): <A HREF="014461.html">[squid-users] squid-avira-update-cache
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14478">[ date ]</a>
              <a href="thread.html#14478">[ thread ]</a>
              <a href="subject.html#14478">[ subject ]</a>
              <a href="author.html#14478">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
