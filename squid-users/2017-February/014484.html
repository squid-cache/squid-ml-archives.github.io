<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Proxyfy spice protocol behind nat
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Proxyfy%20spice%20protocol%20behind%20nat&In-Reply-To=%3CCAJq8taGhxhmgNR0YQOBiLSz8SP%2Bvg4S4AxWmLiRkU%2BNLzQyUrw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014483.html">
   <LINK REL="Next"  HREF="014485.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Proxyfy spice protocol behind nat</H1>
    <B>Oscar Segarra</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Proxyfy%20spice%20protocol%20behind%20nat&In-Reply-To=%3CCAJq8taGhxhmgNR0YQOBiLSz8SP%2Bvg4S4AxWmLiRkU%2BNLzQyUrw%40mail.gmail.com%3E"
       TITLE="[squid-users] Proxyfy spice protocol behind nat">oscar.segarra at gmail.com
       </A><BR>
    <I>Sun Feb 19 22:48:42 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014483.html">[squid-users] Proxyfy spice protocol behind nat
</A></li>
        <LI>Next message (by thread): <A HREF="014485.html">[squid-users] Squid 3.5.24 - Url_rewrite with ssl_bump in	Transparent Mode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14484">[ date ]</a>
              <a href="thread.html#14484">[ thread ]</a>
              <a href="subject.html#14484">[ subject ]</a>
              <a href="author.html#14484">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE> Hi,
&gt;<i>
</I>&gt;<i> In my environment I have deployed two KVM hypervisors. I'd like to deploy
</I>&gt;<i> in my DMZ a squid proxy host in order to hide hypervisor IPs and Ports
</I>from
&gt;<i> the clients.
</I>
Why?  What's the problem with the clients knowing the true values?

--&gt; I want to publis VDI Desktops through Internet. If I have 10
hypervisors I don't want to publish 10 public IPs, I prefer just tu publish
a proxy server.

&gt;<i> Each virtual machine has a unique port but VMs can run on any hypervisor.
</I>
It doesn't sound to me like the VMs are actually part of what you're trying
to
do here?  You're just talking about client connections to hypervisors; the
VMs
are not part of that.

--&gt; The hypervisor has a specific port for each VM. If you connect to the
hypervisor by that port, you are connecting directly to the virtual
machine. This is how SPICE works.

&gt;<i> Is it possible to achieve this with squid?
</I>
What protocol do the clients use to communicate with the KVM Hypervisors?

--&gt; The protocol is SPICE (<A HREF="https://www.spice-space.org/">https://www.spice-space.org/</A>)

If it's HTTP, HTTPS or FTP, then you can probably configure Squid in
accelerator mode and use it to do what you want.

However, why are you trying to do this?  What is the risk involved in the
clients knowing the true IPs and ports of the hypervisors, which would be
mitigated by having them connect via a proxy instead?

Have you considered using HAproxy or LVS, both of which are far more generic
network proxies than Squid is?

--&gt; I have not considered it yet...

&gt;<i> Is there any example how to configure this?
</I>
Not that I have ever heard of, however if it is a protocol which Squid can
handle, it really doesn't matter what the specific backend system is; there
are
plenty of examples on how to do HTTP, HTTPS and FTP.

2017-02-19 23:15 GMT+01:00 Antony Stone &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">Antony.Stone at squid.open.source.it</A>&gt;:

&gt;<i> On Sunday 19 February 2017 at 19:05:57, Oscar Segarra wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; Hi,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; In my environment I have deployed two KVM hypervisors. I'd like to deploy
</I>&gt;<i> &gt; in my DMZ a squid proxy host in order to hide hypervisor IPs and Ports
</I>&gt;<i> from
</I>&gt;<i> &gt; the clients.
</I>&gt;<i>
</I>&gt;<i> Why?  What's the problem with the clients knowing the true values?
</I>&gt;<i>
</I>&gt;<i> &gt; Each virtual machine has a unique port but VMs can run on any hypervisor.
</I>&gt;<i>
</I>&gt;<i> It doesn't sound to me like the VMs are actually part of what you're
</I>&gt;<i> trying to
</I>&gt;<i> do here?  You're just talking about client connections to hypervisors; the
</I>&gt;<i> VMs
</I>&gt;<i> are not part of that.
</I>&gt;<i>
</I>&gt;<i> &gt; Is it possible to achieve this with squid?
</I>&gt;<i>
</I>&gt;<i> What protocol do the clients use to communicate with the KVM Hypervisors?
</I>&gt;<i>
</I>&gt;<i> If it's HTTP, HTTPS or FTP, then you can probably configure Squid in
</I>&gt;<i> accelerator mode and use it to do what you want.
</I>&gt;<i>
</I>&gt;<i> However, why are you trying to do this?  What is the risk involved in the
</I>&gt;<i> clients knowing the true IPs and ports of the hypervisors, which would be
</I>&gt;<i> mitigated by having them connect via a proxy instead?
</I>&gt;<i>
</I>&gt;<i> Have you considered using HAproxy or LVS, both of which are far more
</I>&gt;<i> generic
</I>&gt;<i> network proxies than Squid is?
</I>&gt;<i>
</I>&gt;<i> &gt; Is there any example how to configure this?
</I>&gt;<i>
</I>&gt;<i> Not that I have ever heard of, however if it is a protocol which Squid can
</I>&gt;<i> handle, it really doesn't matter what the specific backend system is;
</I>&gt;<i> there are
</I>&gt;<i> plenty of examples on how to do HTTP, HTTPS and FTP.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Antony.
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Numerous psychological studies over the years have demonstrated that the
</I>&gt;<i> majority of people genuinely believe they are not like the majority of
</I>&gt;<i> people.
</I>&gt;<i>
</I>&gt;<i>                                                    Please reply to the
</I>&gt;<i> list;
</I>&gt;<i>                                                          please *don't* CC
</I>&gt;<i> me.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170219/bfb30dec/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170219/bfb30dec/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014483.html">[squid-users] Proxyfy spice protocol behind nat
</A></li>
	<LI>Next message (by thread): <A HREF="014485.html">[squid-users] Squid 3.5.24 - Url_rewrite with ssl_bump in	Transparent Mode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14484">[ date ]</a>
              <a href="thread.html#14484">[ thread ]</a>
              <a href="subject.html#14484">[ subject ]</a>
              <a href="author.html#14484">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
