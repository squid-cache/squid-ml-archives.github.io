<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid on separate box and it can't see packets
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20on%20separate%20box%20and%20it%20can%27t%20see%20packets&In-Reply-To=%3Cde1a9318-afe0-5199-ebfd-b760d619a41b%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014490.html">
   <LINK REL="Next"  HREF="014454.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid on separate box and it can't see packets</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20on%20separate%20box%20and%20it%20can%27t%20see%20packets&In-Reply-To=%3Cde1a9318-afe0-5199-ebfd-b760d619a41b%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid on separate box and it can't see packets">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Feb 21 04:06:54 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014490.html">[squid-users] Squid on separate box and it can't see packets
</A></li>
        <LI>Next message (by thread): <A HREF="014454.html">[squid-users] ACL dst handled differently in intercept after rewrite
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14494">[ date ]</a>
              <a href="thread.html#14494">[ thread ]</a>
              <a href="subject.html#14494">[ subject ]</a>
              <a href="author.html#14494">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 21/02/2017 10:25 a.m., Eliezer  Croitoru wrote:
&gt;<i> And just wanted to add a note that some Linux machines will act as an
</I>&gt;<i> HUB\BRIDGE by default in a similar scenario(will not drop
</I>&gt;<i> packets..). I noticed it while working on some tiny lab and it's
</I>&gt;<i> better to have the linux machine with ipv4_forward turned on with an
</I>&gt;<i> iptables DROP rule rather then without(with some distros and some
</I>&gt;<i> specific kernels).
</I>
Nod.

If the machine is working as a true bridge then the packets will not be
going to Squid. It still needs the routing rules to route the packets
from its bridge interface to Squid, and from Squid to its bridge
outerface. Or for that matter to pass them from the bridge
inter/outerfaces and the NAT system.

Amos



&gt;<i> 
</I>&gt;<i> Eliezer
</I>&gt;<i> ----
</I>&gt;<i> Eliezer Croitoru
</I>&gt;<i> Linux System Administrator
</I>&gt;<i> Mobile: +972-5-28704261
</I>&gt;<i> Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Amos Jeffries
</I>&gt;<i> Sent: Friday, February 17, 2017 3:59 PM
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: Re: [squid-users] Squid on separate box and it can't see packets
</I>&gt;<i> 
</I>&gt;<i> On 15/02/2017 9:18 a.m., John Pearson wrote:
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Is this squid box a router or just a proxy?
</I>&gt;&gt;<i> - just a proxy
</I>&gt;<i> 
</I>&gt;<i> There is the first problem.
</I>&gt;<i> 
</I>&gt;<i> NAT interception needs the machine Squid is running on to be configured
</I>&gt;<i> to operate as a router. It will be receiving packets destined to a
</I>&gt;<i> machine other than itself.
</I>&gt;<i> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> What tcpdump command did you ran?
</I>&gt;&gt;<i> - sudo tcpdump -i eth0
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> What is the networks that are involved?
</I>&gt;&gt;<i> Setup:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Client        (192.168.1.8) ---&gt;  |     Rotuer        |
</I>&gt;&gt;&gt;<i>                                                | gateway/dhcp | ---&gt;
</I>&gt;&gt;&gt;<i> Internet
</I>&gt;&gt;&gt;<i> Squid box (192.168.1.2) ---&gt;  |  192.168.1.1   |
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Here Client (debian), squid (debian) and router are three separate devices.
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> So the Squid machine;
</I>&gt;<i> 
</I>&gt;<i> requires this bit you did:
</I>&gt;<i>  &lt;<A HREF="http://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxRedirect">http://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxRedirect</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> PLUS the system TCP stack controls to turn it from a origin-server host
</I>&gt;<i> to a routing host. Otherwise the machine will silently drop packets not
</I>&gt;<i> destined to itself.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> The router machine requires this:
</I>&gt;<i>  &lt;<A HREF="http://wiki.squid-cache.org/ConfigExamples/Intercept/IptablesPolicyRoute#When_Squid_is_Internal_amongst_clients">http://wiki.squid-cache.org/ConfigExamples/Intercept/IptablesPolicyRoute#When_Squid_is_Internal_amongst_clients</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> The router machine probably also needs the &quot;Routing Setup&quot;:
</I>&gt;<i>  &lt;<A HREF="http://wiki.squid-cache.org/ConfigExamples/Intercept/IptablesPolicyRoute#Routing_Setup">http://wiki.squid-cache.org/ConfigExamples/Intercept/IptablesPolicyRoute#Routing_Setup</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> Amos
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014490.html">[squid-users] Squid on separate box and it can't see packets
</A></li>
	<LI>Next message (by thread): <A HREF="014454.html">[squid-users] ACL dst handled differently in intercept after rewrite
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14494">[ date ]</a>
              <a href="thread.html#14494">[ thread ]</a>
              <a href="subject.html#14494">[ subject ]</a>
              <a href="author.html#14494">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
