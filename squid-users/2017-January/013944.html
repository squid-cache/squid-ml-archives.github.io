<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid Websocket Issue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20Websocket%20Issue&In-Reply-To=%3C012a01d264fe%24bd3120f0%24379362d0%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013943.html">
   <LINK REL="Next"  HREF="013946.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid Websocket Issue</H1>
    <B>Eliezer  Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20Websocket%20Issue&In-Reply-To=%3C012a01d264fe%24bd3120f0%24379362d0%24%40ngtech.co.il%3E"
       TITLE="[squid-users] Squid Websocket Issue">eliezer at ngtech.co.il
       </A><BR>
    <I>Mon Jan  2 13:47:20 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013943.html">[squid-users] Squid Websocket Issue
</A></li>
        <LI>Next message (by thread): <A HREF="013946.html">[squid-users] Squid Websocket Issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13944">[ date ]</a>
              <a href="thread.html#13944">[ thread ]</a>
              <a href="subject.html#13944">[ subject ]</a>
              <a href="author.html#13944">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Can we start from 0.
Currently when squid knows about the Connection being a one with websocket support it is already too late to do anything about this specific connection.
The only option for now is to identify these using some ICAP service that will for example redirect the request after a small delay that will add the destination domain ip address to a bypass list.
It&#8217;s not trivial but I have seen such implementation on ssl bump.

Can you please redirect me to the specific email with the bug details?

Eliezer

----
<A HREF="http://ngtech.co.il/lmgtfy/">http://ngtech.co.il/lmgtfy/</A>
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>


From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Hardik Dangar
Sent: Monday, January 2, 2017 8:47 AM
To: Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;
Cc: Squid Users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
Subject: Re: [squid-users] Squid Websocket Issue

@amos or anyone else from dev team

Can you confirm this is intentional behavior or bug ?

On Mon, Jan 2, 2017 at 9:18 AM, Alex Rousskov &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:
On 12/27/2016 04:50 AM, Hardik Dangar wrote:

&gt;<i> If i remove !serverIsws somehow websockets will not work.
</I>
Then there is a bug somewhere AFAICT. It is your call whether to find
out what that bug is [while continuing to use a potentially dangerous
workaround].

Alex.


&gt;<i> On Tue, Dec 20, 2016 at 10:27 PM, Alex Rousskov wrote:
</I>&gt;<i>
</I>&gt;<i>     On 12/20/2016 02:42 AM, Hardik Dangar wrote:
</I>&gt;<i>     &gt; Following changes in config works and whatsapp starts working,
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; acl serverIsws ssl::server_name_regex ^w[0-9]+\.web\.whatsapp\.com$
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; acl step1 at_step SslBump1
</I>&gt;<i>     &gt; ssl_bump peek step1
</I>&gt;<i>     &gt; ssl_bump splice serverIsws
</I>&gt;<i>     &gt; ssl_bump bump !serverIsws all
</I>&gt;<i>
</I>&gt;<i>     You do not need the &quot;!serverIsws&quot; part because if serverIsws matches,
</I>&gt;<i>     then the splice rule wins, and Squid does not reach the bump rule. This
</I>&gt;<i>     configuration is sufficient:
</I>&gt;<i>
</I>&gt;<i>       ssl_bump peek step1
</I>&gt;<i>       ssl_bump splice serverIsws
</I>&gt;<i>       ssl_bump bump all
</I>&gt;<i>
</I>&gt;<i>     In theory, adding &quot;!serverIsws&quot; does not hurt. However, negating complex
</I>&gt;<i>     ACLs is tricky/dangerous and should be avoided when possible.
</I>&gt;<i>
</I>&gt;<i>     Alex.
</I>&gt;<i>
</I>&gt;<i>
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013943.html">[squid-users] Squid Websocket Issue
</A></li>
	<LI>Next message (by thread): <A HREF="013946.html">[squid-users] Squid Websocket Issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13944">[ date ]</a>
              <a href="thread.html#13944">[ thread ]</a>
              <a href="subject.html#13944">[ subject ]</a>
              <a href="author.html#13944">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
