<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Intercept mode failing
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Intercept%20mode%20failing&In-Reply-To=%3Cfc527d12-bb42-0621-6931-36152849bb94%40wheres5.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014023.html">
   <LINK REL="Next"  HREF="013955.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Intercept mode failing</H1>
    <B>Hoggins!</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Intercept%20mode%20failing&In-Reply-To=%3Cfc527d12-bb42-0621-6931-36152849bb94%40wheres5.com%3E"
       TITLE="[squid-users] Intercept mode failing">fuckspam at wheres5.com
       </A><BR>
    <I>Tue Jan  3 09:17:54 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014023.html">[squid-users] Squid 3.5.22 Bug when using Mimetype Detection? rep_mime_type
</A></li>
        <LI>Next message (by thread): <A HREF="013955.html">[squid-users] Intercept mode failing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13954">[ date ]</a>
              <a href="thread.html#13954">[ thread ]</a>
              <a href="subject.html#13954">[ subject ]</a>
              <a href="author.html#13954">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello list,

I'm trying to do a simple intercept with Squid. Here is my setup :

I have a LAN with machines on 192.168.22.0/24. Their gateway is
192.168.22.10. On this machine, I have set the following iptables rule :

    iptables -t nat -A PREROUTING -i eth0.100 ! -d 192.168.0.0/16 -p tcp
--dport 80 -j DNAT --to 192.168.55.3:3129

    - eth0.100 because it's on a VLAN
    - 192.168.55.3 being the Squid server, directly connected to the
Internet, on a network my gateway has the routes for

On the Squid server (192.168.55.3), I have configured the following
options in squid.conf :

    - (default localnet ACLs were fine, as well as Safe_ports setting)
    - tcp_outgoing_address 1.2.3.4 (the public address the server is
attached to. There are several interfaces)
    - http_port 3129 intercept
    - http_access allow localnet
    - http_access allow localhost
    - http_access deny all

Now, if I issue a curl <A HREF="http://google.fr">http://google.fr</A> on a LAN machine
(192.168.22.129), I get the Squid error page saying &quot;Acces Denied&quot;, and
the Squid server log shows the following :

    1483434892.803      0 1.2.3.4 TCP_DENIED/403 4032 GET
<A HREF="http://google.fr/">http://google.fr/</A> - HIER_NONE/- text/html
    1483434892.804     17 192.168.22.129 TCP_MISS/403 4146 GET
<A HREF="http://google.fr/">http://google.fr/</A> - ORIGINAL_DST/192.168.55.3 text/html


&quot;Normal&quot; proxying works fine with this Squid setup (I also have a
&quot;http_port 3128&quot; with no option, and explicitly setting the proxy
address on the LAN hosts works fine).

Do you have an idea of what are my mistakes ?

Thank you for your inputs !

    Hoggins!

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 181 bytes
Desc: OpenPGP digital signature
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170103/db72d1da/attachment.sig">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170103/db72d1da/attachment.sig</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014023.html">[squid-users] Squid 3.5.22 Bug when using Mimetype Detection? rep_mime_type
</A></li>
	<LI>Next message (by thread): <A HREF="013955.html">[squid-users] Intercept mode failing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13954">[ date ]</a>
              <a href="thread.html#13954">[ thread ]</a>
              <a href="subject.html#13954">[ subject ]</a>
              <a href="author.html#13954">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
