<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Intercept mode failing
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Intercept%20mode%20failing&In-Reply-To=%3C201701031033.53399.Antony.Stone%40squid.open.source.it%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013954.html">
   <LINK REL="Next"  HREF="013956.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Intercept mode failing</H1>
    <B>Antony Stone</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Intercept%20mode%20failing&In-Reply-To=%3C201701031033.53399.Antony.Stone%40squid.open.source.it%3E"
       TITLE="[squid-users] Intercept mode failing">Antony.Stone at squid.open.source.it
       </A><BR>
    <I>Tue Jan  3 09:33:53 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013954.html">[squid-users] Intercept mode failing
</A></li>
        <LI>Next message (by thread): <A HREF="013956.html">[squid-users] Intercept mode failing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13955">[ date ]</a>
              <a href="thread.html#13955">[ thread ]</a>
              <a href="subject.html#13955">[ subject ]</a>
              <a href="author.html#13955">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tuesday 03 January 2017 at 10:17:54, Hoggins! wrote:

&gt;<i> Hello list,
</I>&gt;<i> 
</I>&gt;<i> I'm trying to do a simple intercept with Squid. Here is my setup :
</I>&gt;<i> 
</I>&gt;<i> I have a LAN with machines on 192.168.22.0/24. Their gateway is
</I>&gt;<i> 192.168.22.10. On this machine, I have set the following iptables rule :
</I>&gt;<i> 
</I>&gt;<i>     iptables -t nat -A PREROUTING -i eth0.100 ! -d 192.168.0.0/16 -p tcp
</I>&gt;<i> --dport 80 -j DNAT --to 192.168.55.3:3129
</I>&gt;<i> 
</I>&gt;<i>     - 192.168.55.3 being the Squid server
</I>
No - you must do the NAT (or REDIRECT) rule *on the Squid server*.

If you need to use policy routing to get the packets to the Squid machine in 
the first place, that's okay, but this *must* be packet routing, not address 
translation.

See <A HREF="http://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxDnat">http://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxDnat</A> 
<A HREF="http://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxRedirect">http://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxRedirect</A> and 
<A HREF="http://wiki.squid-cache.org/ConfigExamples/Intercept/IptablesPolicyRoute">http://wiki.squid-cache.org/ConfigExamples/Intercept/IptablesPolicyRoute</A>


Antony.

-- 
In Heaven, the beer is Belgian, the chefs are Italian, the supermarkets are 
British, the mechanics are German, the lovers are French, the entertainment is 
American, and everything is organised by the Swiss.

In Hell, the beer is American, the chefs are British, the supermarkets are 
German, the mechanics are French, the lovers are Swiss, the entertainment is 
Belgian, and everything is organised by the Italians.

                                                   Please reply to the list;
                                                         please *don't* CC me.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013954.html">[squid-users] Intercept mode failing
</A></li>
	<LI>Next message (by thread): <A HREF="013956.html">[squid-users] Intercept mode failing
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13955">[ date ]</a>
              <a href="thread.html#13955">[ thread ]</a>
              <a href="subject.html#13955">[ subject ]</a>
              <a href="author.html#13955">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
