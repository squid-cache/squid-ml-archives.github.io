<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ssl_bump with intermediate CA
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ssl_bump%20with%20intermediate%20CA&In-Reply-To=%3CCAHaxnUKG6-r_s_POpU7kVB8OkHnwypKFZPD8j2NxnnTF02bS6Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013984.html">
   <LINK REL="Next"  HREF="013987.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ssl_bump with intermediate CA</H1>
    <B>Bruce Rosenberg</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ssl_bump%20with%20intermediate%20CA&In-Reply-To=%3CCAHaxnUKG6-r_s_POpU7kVB8OkHnwypKFZPD8j2NxnnTF02bS6Q%40mail.gmail.com%3E"
       TITLE="[squid-users] ssl_bump with intermediate CA">bruce.rosenberg.au at gmail.com
       </A><BR>
    <I>Fri Jan  6 00:57:08 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013984.html">[squid-users] ssl_bump with intermediate CA
</A></li>
        <LI>Next message (by thread): <A HREF="013987.html">[squid-users] ssl_bump with intermediate CA
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13985">[ date ]</a>
              <a href="thread.html#13985">[ thread ]</a>
              <a href="subject.html#13985">[ subject ]</a>
              <a href="author.html#13985">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The cafile option specifies the &quot;chain&quot; file squid should send back to the
client along with the cert, exactly as you would normally do with Apache
httpd or Nginx.
In the example the generated server cert is depth 0, CA2 is depth 1 and CA1
is depth 2.
If the client has CA1 installed as a trust anchor then technically you
don't need to send CA1 as it is discarded by the client once the trust
relationship for CA2 is established.
It's good practice to send the full chain though as it makes
troubleshooting easier.
&gt;<i>From a client perspective you can quickly grab the whole chain with openssl
</I>s_client and check if CA1 is in the trust store.

On Fri, Jan 6, 2017 at 10:40 AM, senor &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">frio_cervesa at hotmail.com</A>&gt; wrote:

&gt;<i> Hello All.
</I>&gt;<i> I'd like clarification of the documentation at
</I>&gt;<i> <A HREF="http://wiki.squid-cache.org/ConfigExamples/Intercept/">http://wiki.squid-cache.org/ConfigExamples/Intercept/</A>
</I>&gt;<i> SslBumpWithIntermediateCA
</I>&gt;<i>
</I>&gt;<i> In section &quot;CA certificate preparation&quot; it is stated that a file should
</I>&gt;<i> be created with &quot;intermediate CA2 followed by root CA1 in PEM format&quot;.
</I>&gt;<i> CA1 is the cert trusted by the clients. CA2 is used to sign the mimicked
</I>&gt;<i> certs. And finally the statement &quot;Now Squid can send the intermediate
</I>&gt;<i> CA2 public key with root CA1 to client and does not need to install
</I>&gt;<i> intermediate CA2 to clients.&quot;
</I>&gt;<i>
</I>&gt;<i> The specification states that the clients MUST NOT use CA1 provided in
</I>&gt;<i> the TLS exchange. CA1 must be (and in this scenario is) already included
</I>&gt;<i> in its trusted store of CAs.
</I>&gt;<i>
</I>&gt;<i> As I understand it, the TLS exchange with the client for a bumped
</I>&gt;<i> connection should have the mimicked server cert followed by the
</I>&gt;<i> intermediate cert (CA2) and that's all. The client completes the chain
</I>&gt;<i> with the already trusted CA1.
</I>&gt;<i>
</I>&gt;<i> The example file created is used for cafile= option to http_port which
</I>&gt;<i> is supposed to be for verifying client certs which is not part of this
</I>&gt;<i> scenario.
</I>&gt;<i>
</I>&gt;<i> This is getting a little long-winded so I'll wait to see what anyone has
</I>&gt;<i> to say about my assumptions or understanding.
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> Senor
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170106/c128e4a3/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170106/c128e4a3/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013984.html">[squid-users] ssl_bump with intermediate CA
</A></li>
	<LI>Next message (by thread): <A HREF="013987.html">[squid-users] ssl_bump with intermediate CA
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13985">[ date ]</a>
              <a href="thread.html#13985">[ thread ]</a>
              <a href="subject.html#13985">[ subject ]</a>
              <a href="author.html#13985">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
