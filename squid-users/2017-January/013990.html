<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] [3.5x]: identd lookup made before proxy_protocol	checking and failed [help]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5B3.5x%5D%3A%20identd%20lookup%20made%20before%20proxy_protocol%0A%09checking%20and%20failed%20%5Bhelp%5D&In-Reply-To=%3C1f32a2106420fe90ddf8ab09062c36dd%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013988.html">
   <LINK REL="Next"  HREF="013992.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] [3.5x]: identd lookup made before proxy_protocol	checking and failed [help]</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5B3.5x%5D%3A%20identd%20lookup%20made%20before%20proxy_protocol%0A%09checking%20and%20failed%20%5Bhelp%5D&In-Reply-To=%3C1f32a2106420fe90ddf8ab09062c36dd%40treenet.co.nz%3E"
       TITLE="[squid-users] [3.5x]: identd lookup made before proxy_protocol	checking and failed [help]">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Jan  6 10:26:34 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013988.html">[squid-users] [3.5x]: identd lookup made before proxy_protocol	checking and failed [help]
</A></li>
        <LI>Next message (by thread): <A HREF="013992.html">[squid-users] [3.5x]: identd lookup made before	proxy_protocol	checking and failed [help]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13990">[ date ]</a>
              <a href="thread.html#13990">[ thread ]</a>
              <a href="subject.html#13990">[ subject ]</a>
              <a href="author.html#13990">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2017-01-06 22:12, David Touzeau wrote:
&gt;<i> Added in bugtrack
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://bugs.squid-cache.org/show_bug.cgi?id=4657">http://bugs.squid-cache.org/show_bug.cgi?id=4657</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -----Message d'origine-----
</I>&gt;<i> De : David Touzeau
</I>&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> We need to use ident daemon in order to authenticate users.
</I>&gt;<i> 
</I>&gt;<i> Squid works fine when computers are directly connected to the proxy.
</I>&gt;<i> 
</I>&gt;<i> We have added HaProxy * * * Load-balancer * * * using *proxy_protocol*
</I>&gt;<i> between users and 2 Squid proxies With the load balancer, squid want
</I>&gt;<i> to query identd port directly on the load balancer but not on the
</I>&gt;<i> client source IP address.
</I>&gt;<i> If you see this piece of logs, you can see that the source client
</I>&gt;<i> address is correctly understood by Squid but * * after * *  the ident
</I>&gt;<i> verification.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> How can i fix this behaviour ?
</I>
IDENT relies on using the exact random TCP port from the connection the 
client opened to HAProxy being used as part of the IDENT connection back 
to the client.

Since there is HAProxy between Squid and the client, Squid will be 
unable to open the port already in use by the HAProxy client-connection.

So, HAProxy has to be the agent doing the IDENT lookup and sending the 
ident info to Squid - probably as part of the PROXY wrapper.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013988.html">[squid-users] [3.5x]: identd lookup made before proxy_protocol	checking and failed [help]
</A></li>
	<LI>Next message (by thread): <A HREF="013992.html">[squid-users] [3.5x]: identd lookup made before	proxy_protocol	checking and failed [help]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13990">[ date ]</a>
              <a href="thread.html#13990">[ thread ]</a>
              <a href="subject.html#13990">[ subject ]</a>
              <a href="author.html#13990">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
