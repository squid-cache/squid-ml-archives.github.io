<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] [3.5x]: identd lookup made before	proxy_protocol	checking and failed [help]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5B3.5x%5D%3A%20identd%20lookup%20made%20before%0A%09proxy_protocol%09checking%20and%20failed%20%5Bhelp%5D&In-Reply-To=%3C00bb01d26816%2478f07740%246ad165c0%24%40articatech.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013990.html">
   <LINK REL="Next"  HREF="013982.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] [3.5x]: identd lookup made before	proxy_protocol	checking and failed [help]</H1>
    <B>David Touzeau</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5B3.5x%5D%3A%20identd%20lookup%20made%20before%0A%09proxy_protocol%09checking%20and%20failed%20%5Bhelp%5D&In-Reply-To=%3C00bb01d26816%2478f07740%246ad165c0%24%40articatech.com%3E"
       TITLE="[squid-users] [3.5x]: identd lookup made before	proxy_protocol	checking and failed [help]">david at articatech.com
       </A><BR>
    <I>Fri Jan  6 12:14:47 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013990.html">[squid-users] [3.5x]: identd lookup made before proxy_protocol	checking and failed [help]
</A></li>
        <LI>Next message (by thread): <A HREF="013982.html">[squid-users] Squid 3.3.8 is available
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13992">[ date ]</a>
              <a href="thread.html#13992">[ thread ]</a>
              <a href="subject.html#13992">[ subject ]</a>
              <a href="author.html#13992">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

-----Message d'origine-----
De : squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] De la
part de Amos Jeffries
Envoy&#233; : vendredi 6 janvier 2017 11:27
&#192; : <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Objet : Re: [squid-users] [3.5x]: identd lookup made before proxy_protocol
checking and failed [help]

On 2017-01-06 22:12, David Touzeau wrote:
&gt;<i> Added in bugtrack
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://bugs.squid-cache.org/show_bug.cgi?id=4657">http://bugs.squid-cache.org/show_bug.cgi?id=4657</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -----Message d'origine-----
</I>&gt;<i> De : David Touzeau
</I>&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> We need to use ident daemon in order to authenticate users.
</I>&gt;<i>
</I>&gt;<i> Squid works fine when computers are directly connected to the proxy.
</I>&gt;<i>
</I>&gt;<i> We have added HaProxy * * * Load-balancer * * * using *proxy_protocol*
</I>&gt;<i> between users and 2 Squid proxies With the load balancer, squid want
</I>&gt;<i> to query identd port directly on the load balancer but not on the
</I>&gt;<i> client source IP address.
</I>&gt;<i> If you see this piece of logs, you can see that the source client
</I>&gt;<i> address is correctly understood by Squid but * * after * *  the ident
</I>&gt;<i> verification.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> How can i fix this behaviour ?
</I>
IDENT relies on using the exact random TCP port from the connection the
client opened to HAProxy being used as part of the IDENT connection back to
the client.

Since there is HAProxy between Squid and the client, Squid will be unable to
open the port already in use by the HAProxy client-connection.

So, HAProxy has to be the agent doing the IDENT lookup and sending the ident
info to Squid - probably as part of the PROXY wrapper.

Amos
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


Hi Amos,

It is more complicated to found a &quot;load-balancer&quot; that supports ident 
lookup.
Are you considering this behaviour as a &quot;Feature request&quot; instead bug ?













</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013990.html">[squid-users] [3.5x]: identd lookup made before proxy_protocol	checking and failed [help]
</A></li>
	<LI>Next message (by thread): <A HREF="013982.html">[squid-users] Squid 3.3.8 is available
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13992">[ date ]</a>
              <a href="thread.html#13992">[ thread ]</a>
              <a href="subject.html#13992">[ subject ]</a>
              <a href="author.html#13992">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
