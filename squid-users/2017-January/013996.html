<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ssl_bump with intermediate CA
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ssl_bump%20with%20intermediate%20CA&In-Reply-To=%3C029701d2689e%24043b43c0%240cb1cb40%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013989.html">
   <LINK REL="Next"  HREF="013999.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ssl_bump with intermediate CA</H1>
    <B>Eliezer  Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ssl_bump%20with%20intermediate%20CA&In-Reply-To=%3C029701d2689e%24043b43c0%240cb1cb40%24%40ngtech.co.il%3E"
       TITLE="[squid-users] ssl_bump with intermediate CA">eliezer at ngtech.co.il
       </A><BR>
    <I>Sat Jan  7 04:25:02 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="013989.html">[squid-users] ssl_bump with intermediate CA
</A></li>
        <LI>Next message (by thread): <A HREF="013999.html">[squid-users] ssl_bump with intermediate CA
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13996">[ date ]</a>
              <a href="thread.html#13996">[ thread ]</a>
              <a href="subject.html#13996">[ subject ]</a>
              <a href="author.html#13996">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Amos,

We can use the discussion section of the wiki to add some comments but the thing is that reality is almost the only answer to some questions.
IE a &quot;cafile&quot; in the normal world would be a certificate on the wall or in some database(back yard archive).
When in most places and cases one's diploma certificate is enough since not most of the world are certificate forgers.
Depends on the locality different measures to enforce the diploma validation are in place.
So if we would compare the real CA's world to the Computer Based one's there would be a big enough different.
Most web applications are more &quot;aware&quot; to these issues then any normal citizen would understand and know about.
The simple answer in most cases is that on the stage of validation there are  two things to validate:
- Authenticity
- Validity(expiration)

When a client probes for a connection it would first verify the chain in some places, but, let say I have a hospital and doctors inside, most clients of the hospital would not require validation of authenticity for the doctor diploma since the hospital is the proxy for this part of the connection and the client left alone to only present the request for care.

With the above real world &quot;example&quot; in hands we know that in the servers world we need to be able to inspect the certificate at-least once in period and we as sysadmins are required to present a full chain in order to meet the clients requests at-least once if not more.

I believe that a proxy should be required to be able to present the full chain certificates to be compatible with the way web applications themselves present their certificates.

And the simplest way to not open an &quot;Edit&quot; war is in most cases comments on the wiki discussion section..
But I do understand that there are wars which needs to be left alone.

All The Bests,
Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>


-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Amos Jeffries
Sent: Friday, January 6, 2017 12:06 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] ssl_bump with intermediate CA

On 2017-01-06 21:27, senor wrote:
&gt;<i> Thank you for the response but I think my question is still unanswered.
</I>&gt;<i> Comments below:
</I>&gt;<i> 
</I>&gt;<i> On 1/5/2017 16:57, Bruce Rosenberg wrote:
</I>&gt;&gt;<i> The cafile option specifies the &quot;chain&quot; file squid should send back to
</I>&gt;&gt;<i> the client along with the cert, exactly as you would normally do with
</I>&gt;&gt;<i> Apache httpd or Nginx.
</I>&gt;<i> (For clarity: I'm using 3.5.23. cafile was replaced in squid-4)
</I>&gt;<i> This may be what cafile is used for but that does not match the
</I>&gt;<i> directive description.
</I>&gt;<i> <A HREF="http://www.squid-cache.org/Versions/v3/3.5/cfgman/http_port.html">http://www.squid-cache.org/Versions/v3/3.5/cfgman/http_port.html</A>
</I>&gt;<i> My suspicion is that the description is a confusion between the same
</I>&gt;<i> option in openssl and web server options (Apache SSLCACertificateFile
</I>&gt;<i> and similar).
</I>&gt;<i> What's it really used for? Chain completion, client cert verification 
</I>&gt;<i> or
</I>&gt;<i> both?
</I>
It is used for chain completion. *which* chain is being completed 
depends on the traffic mode.

clientca= should be the one used *only* for client cert verification (I 
think). But neither was used consistently in Squid-3, so YMMV based on 
the traffic modes.

&gt;<i> 
</I>&gt;&gt;<i> In the example the generated server cert is depth 0, CA2 is depth 1 
</I>&gt;&gt;<i> and
</I>&gt;&gt;<i> CA1 is depth 2.
</I>&gt;&gt;<i> If the client has CA1 installed as a trust anchor then technically you
</I>&gt;&gt;<i> don't need to send CA1 as it is discarded by the client once the trust
</I>&gt;&gt;<i> relationship for CA2 is established.
</I>&gt;&gt;<i> It's good practice to send the full chain though as it makes
</I>&gt;&gt;<i> troubleshooting easier.
</I>&gt;&gt;<i> From a client perspective you can quickly grab the whole chain with
</I>&gt;&gt;<i> openssl s_client and check if CA1 is in the trust store.
</I>&gt;<i> I have to disagree with this. The anchor (CA1) is discarded regardless.
</I>&gt;<i> It cannot be used. If included it bloats the TLS handshake. Even 
</I>&gt;<i> openssl
</I>&gt;<i> will discard it and then look in the trusted CA store.
</I>&gt;<i> 
</I>&gt;<i> I see with a packet cap that the mimicked server cert and the signing
</I>&gt;<i> cert are both included even without the cafile option specified.
</I>&gt;<i> 
</I>&gt;<i> So is it safe to say that the referenced wiki page has just become
</I>&gt;<i> outdated? If cafile is used to fill in the cert chain it wouldn't be
</I>&gt;<i> needed unless there were additional intermediate certs between the mitm
</I>&gt;<i> cert and the trusted CA known to the client. (As in CA1 is trusted by
</I>&gt;<i> clients, CA1 signs CA2 which signs CA3 which is used as MITM cert,
</I>&gt;<i> cafile=CA2)
</I>
That wiki page was incorrect at the time of creation. But the author 
refuses to agree that root cert are discarded so I left it there instead 
of inciting an edit war. Saving the root CA into the file should be 
harmless anyway.

Amos

_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="013989.html">[squid-users] ssl_bump with intermediate CA
</A></li>
	<LI>Next message (by thread): <A HREF="013999.html">[squid-users] ssl_bump with intermediate CA
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13996">[ date ]</a>
              <a href="thread.html#13996">[ thread ]</a>
              <a href="subject.html#13996">[ subject ]</a>
              <a href="author.html#13996">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
