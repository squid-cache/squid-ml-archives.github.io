<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] A bunch of SSL errors I am not sure why
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20A%20bunch%20of%20SSL%20errors%20I%20am%20not%20sure%20why&In-Reply-To=%3C2403F106-B288-4780-BF4F-06AE58E1A52F%40solcv.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014074.html">
   <LINK REL="Next"  HREF="014080.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] A bunch of SSL errors I am not sure why</H1>
    <B>Sameh Onaissi</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20A%20bunch%20of%20SSL%20errors%20I%20am%20not%20sure%20why&In-Reply-To=%3C2403F106-B288-4780-BF4F-06AE58E1A52F%40solcv.com%3E"
       TITLE="[squid-users] A bunch of SSL errors I am not sure why">sameh.onaissi at solcv.com
       </A><BR>
    <I>Fri Jan 13 15:27:05 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014074.html">[squid-users] A bunch of SSL errors I am not sure why
</A></li>
        <LI>Next message (by thread): <A HREF="014080.html">[squid-users] A bunch of SSL errors I am not sure why
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14078">[ date ]</a>
              <a href="thread.html#14078">[ thread ]</a>
              <a href="subject.html#14078">[ subject ]</a>
              <a href="author.html#14078">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Eliezer, all,


I removed the cipher and the problem is still there:


2017/01/13 10:20:50 kid1| Error negotiating SSL connection on FD 138: error:14094418:SSL routines:ssl3_read_bytes:tlsv1 alert unknown ca (1/0)
2017/01/13 10:21:05 kid1| Error negotiating SSL connection on FD 191: error:14094416:SSL routines:ssl3_read_bytes:sslv3 alert certificate unknown (1/0)
2017/01/13 10:21:17 kid1| Error negotiating SSL connection on FD 194: error:14094416:SSL routines:ssl3_read_bytes:sslv3 alert certificate unknown (1/0)
2017/01/13 10:21:17 kid1| Error negotiating SSL connection on FD 198: error:14094416:SSL routines:ssl3_read_bytes:sslv3 alert certificate unknown (1/0)
2017/01/13 10:21:18 kid1| Error negotiating SSL connection on FD 194: error:14094416:SSL routines:ssl3_read_bytes:sslv3 alert certificate unknown (1/0)
2017/01/13 10:21:18 kid1| Error negotiating SSL connection on FD 194: error:14094416:SSL routines:ssl3_read_bytes:sslv3 alert certificate unknown (1/0)
2017/01/13 10:21:19 kid1| Error negotiating SSL connection on FD 194: error:14094416:SSL routines:ssl3_read_bytes:sslv3 alert certificate unknown (1/0)
2017/01/13 10:21:24 kid1| Error negotiating SSL connection on FD 163: Closed by client
2017/01/13 10:21:39 kid1| Error negotiating SSL connection on FD 250: error:14094418:SSL routines:ssl3_read_bytes:tlsv1 alert unknown ca (1/0)
2017/01/13 10:21:42 kid1| Error negotiating SSL on FD 298: error:14090086:SSL routines:ssl3_get_server_certificate:certificate verify failed (1/-1/0)
2017-01-13 10:21:53 [29866] Request(everyone/deny/-) <A HREF="https://accounts.youtube.com/accounts/CheckConnection?pmpo=https://accounts.google.com&amp;v=-1574475776&amp;timestamp=1484320896449">https://accounts.youtube.com/accounts/CheckConnection?pmpo=https://accounts.google.com&amp;v=-1574475776&amp;timestamp=1484320896449</A> 10.0.0.127/10.0.0.127 - GET REDIRECT
2017/01/13 10:21:56 kid1| Error negotiating SSL connection on FD 109: error:14094418:SSL routines:ssl3_read_bytes:tlsv1 alert unknown ca (1/0)
2017/01/13 10:21:56 kid1| Error negotiating SSL connection on FD 309: error:14094416:SSL routines:ssl3_read_bytes:sslv3 alert certificate unknown (1/0)
2017/01/13 10:22:25 kid1| Error negotiating SSL connection on FD 155: Closed by client




Thanks.

On Jan 12, 2017, at 7:28 PM, Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt;&gt; wrote:

Try removing:
cipher=ECDHE-RSA-RC4-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES128-SHA:DHE-RSA-CAMELLIA128-SHA:AES128-SHA:RC4-SHA:HIGH:!aNULL:!MD5:!ADH

From the ssl-bump line and see what happens.

----
<A HREF="http://ngtech.co.il/lmgtfy/">http://ngtech.co.il/lmgtfy/</A>
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>


From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Sameh Onaissi
Sent: Thursday, January 12, 2017 11:10 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [squid-users] A bunch of SSL errors I am not sure why

System info:
Squid Cache: Version 3.5.22
Ubuntu linux 16.04


Hello,


Last couple of days I have started seeing SSL errors in my cache.log which I don&#8217;t really understand: <A HREF="http://pastebin.com/mDHVm7cQ">http://pastebin.com/mDHVm7cQ</A>

My SSL bump configs:

http_port 3127 intercept
http_port 3128
https_port 3129 intercept ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB cert=/etc/squid/ssl_certs/squid.crt key=/etc/squid/ssl_certs/squid.key cipher=ECDHE-RSA-RC4-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES128-SHA:DHE-RSA-CAMELLIA128-SHA:AES128-SHA:RC4-SHA:HIGH:!aNULL:!MD5:!ADH

acl step1 at_step SslBump1
acl step2 at_step SslBump2
acl step3 at_step SslBump3
ssl_bump peek step1 all
ssl_bump bump all




I have tried deleting /var/lib/ssh_db and recreating a fresh one, restarted squid, and no luck.


While the service still works fine, some websites like <A HREF="https://web.dlinkla.com/websys">https://web.dlinkla.com/websys</A> were showing a handshake error until I added the site IP into a bypass list.
The internet speed also drops every now and then due to this.


Any help is appreciated with these errors.


Thanks,
Sam






-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170113/147c2d7a/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170113/147c2d7a/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014074.html">[squid-users] A bunch of SSL errors I am not sure why
</A></li>
	<LI>Next message (by thread): <A HREF="014080.html">[squid-users] A bunch of SSL errors I am not sure why
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14078">[ date ]</a>
              <a href="thread.html#14078">[ thread ]</a>
              <a href="subject.html#14078">[ subject ]</a>
              <a href="author.html#14078">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
