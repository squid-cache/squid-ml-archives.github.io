<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Configuration for cache_peer doesn't work
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Configuration%20for%20cache_peer%20doesn%27t%20work&In-Reply-To=%3CCAPACB-xfzwPhEkguSDOAxX4p6o8V8EiAc0MYnoTg%3D9WkL7Ws4Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014133.html">
   <LINK REL="Next"  HREF="014116.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Configuration for cache_peer doesn't work</H1>
    <B>salil GK</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Configuration%20for%20cache_peer%20doesn%27t%20work&In-Reply-To=%3CCAPACB-xfzwPhEkguSDOAxX4p6o8V8EiAc0MYnoTg%3D9WkL7Ws4Q%40mail.gmail.com%3E"
       TITLE="[squid-users] Configuration for cache_peer doesn't work">gksalil at gmail.com
       </A><BR>
    <I>Thu Jan 19 15:39:16 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014133.html">[squid-users] Users inserted incorrectly in access.log
</A></li>
        <LI>Next message (by thread): <A HREF="014116.html">[squid-users] Configuration for cache_peer doesn't work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14114">[ date ]</a>
              <a href="thread.html#14114">[ thread ]</a>
              <a href="subject.html#14114">[ subject ]</a>
              <a href="author.html#14114">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello

  I am new to squid and I have a use case that I need to configure a
forward proxy with squid. But there will be two squid servers chained to
isolate the networks. So when client machine wanted to access some internet
site, they will specify proxy as my first squid server. This proxy in turn
will forward the packet to squid server 2 and from there traffic will be
forwarded to origin server and response will come through the same path.

  I could achieve this by configuring cache_peer.

&gt;&gt;&gt;&gt;&gt;<i>  configuration in SquidServer1
</I>
http_port 3223

include &quot;/etc/squid3/blockedhosts.lst&quot;

http_access allow all

cache_peer 10.106.251.90 parent 3223 0 no-query default

&lt;&lt;&lt;&lt;&lt;

So this will forward packets to SquidServer2 ( 10.106.251.90 ) and then
will be forwarded further from there to origin server


Now I want to make ssl connection between SquidServer1 and SquidServer2.

I tried the following line for cache_peer

&gt;&gt;&gt;&gt;<i>
</I>
cache_peer 10.106.251.90 parent 3223 0 no-query default ssl
sslcert=&quot;/tmp/server_90.pem&quot; sslkey=&quot;/tmp/privkey_90.pem&quot;

&lt;&lt;&lt;&lt;&lt;

But this doesn't work.

when I try to start quid - it gives the following error

&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>
~ # /usr/sbin/squid3 -N -Y -d 5 -f /tmp/minsquid.conf

2017/01/19 21:04:24| parse_peer: token='ssl'

FATAL: Bungled minsquid.conf line 12: cache_peer 10.106.251.90 parent 3223
0 no-query default ssl sslcert=&quot;/tmp/server_90.pem&quot;
sslkey=&quot;/tmp/privkey_90.pem&quot;

Squid Cache (Version 3.1.19): Terminated abnormally.

CPU Usage: 0.004 seconds = 0.004 user + 0.000 sys

Maximum Resident Size: 28224 KB

Page faults with physical i/o: 0

&lt;&lt;&lt;&lt;&lt;&lt;

what could be the issue .

-----

In SquidServer2 I think I need to specify https port for the client to
access. I have put this line in config file

&gt;&gt;&gt;&gt;&gt;<i>
</I>
https_port 3224  cert=self_s_cert.pem key=key.pem

&lt;&lt;&lt;&lt;&lt;

There while executing squid, getting the following error


&gt;&gt;&gt;&gt;<i>
</I>
~ # /usr/sbin/squid3 -N -Y -d 5 -f /tmp/minsquid.conf

2017/01/19 15:37:40| cache_cf.cc(381) parseOneConfigFile: minsquid.conf:4
unrecognized: 'https_port'

&lt;&lt;&lt;&lt;


Thanks

~S
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170119/474f9848/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170119/474f9848/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014133.html">[squid-users] Users inserted incorrectly in access.log
</A></li>
	<LI>Next message (by thread): <A HREF="014116.html">[squid-users] Configuration for cache_peer doesn't work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14114">[ date ]</a>
              <a href="thread.html#14114">[ thread ]</a>
              <a href="subject.html#14114">[ subject ]</a>
              <a href="author.html#14114">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
