<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] HTTPS site filtering
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20HTTPS%20site%20filtering&In-Reply-To=%3Cd8e6bb40-2471-4607-37b6-24adf91d1dd6%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014140.html">
   <LINK REL="Next"  HREF="014143.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] HTTPS site filtering</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20HTTPS%20site%20filtering&In-Reply-To=%3Cd8e6bb40-2471-4607-37b6-24adf91d1dd6%40treenet.co.nz%3E"
       TITLE="[squid-users] HTTPS site filtering">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Jan 20 17:45:37 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014140.html">[squid-users] HTTPS site filtering
</A></li>
        <LI>Next message (by thread): <A HREF="014143.html">[squid-users] HTTPS site filtering
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14142">[ date ]</a>
              <a href="thread.html#14142">[ thread ]</a>
              <a href="subject.html#14142">[ subject ]</a>
              <a href="author.html#14142">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 21/01/2017 5:52 a.m., roadrage27 wrote:
&gt;<i> I was able to resolve my issue partially.  I burned down the server and
</I>&gt;<i> rebuilt it clean so all previous changes that were made attempting to make
</I>&gt;<i> SSL work were gone.  Once i reloaded squid and the config files i was able
</I>&gt;<i> to allow SSL traffic using the dstdomain acl type.  I currently have a few
</I>&gt;<i> URLS that are regex type that need to be allowed so im currently cranking
</I>&gt;<i> out those.
</I>&gt;<i> 
</I>&gt;<i> On Fri, Jan 20, 2017 at 8:36 AM roadrage27 wrote:
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i> That tells me either you have screwed up the CONNECT ACL definition. Or
</I>&gt;&gt;&gt;<i> the SSL_ports one.
</I>&gt;&gt;<i> Very possible as im pretty green on squid, my current conf file is below.
</I>&gt;&gt;<i>  with that conf the SSL sites just sit and spin until the eventually time
</I>&gt;&gt;<i> out.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> acl site_squid_art url_regex ^<A HREF="http://www.squid-cache.org/Artwork">http://www.squid-cache.org/Artwork</A>
</I>&gt;&gt;<i> acl keepgoing dstdomain .plateau.com .skillwsa.com .successfactors.com
</I>&gt;&gt;<i>
</I>
Whats the idea behind this &quot;keepgoing&quot; ACL ?
 Is this proxy supposed to have reverse-proxy duties for them?

&gt;&gt;<i> acl SSL_ports port 443
</I>&gt;&gt;<i> acl Safe_ports port 80 # http
</I>&gt;&gt;<i> acl Safe_ports port 21 # ftp
</I>&gt;&gt;<i> acl Safe_ports port 443 # https
</I>&gt;&gt;<i> acl Safe_ports port 70 # gopher
</I>&gt;&gt;<i> acl Safe_ports port 210 # wais
</I>&gt;&gt;<i> acl Safe_ports port 1025-65535 # unregistered ports
</I>&gt;&gt;<i> acl Safe_ports port 280 # http-mgmt
</I>&gt;&gt;<i> acl Safe_ports port 488 # gss-http
</I>&gt;&gt;<i> acl Safe_ports port 591 # filemaker
</I>&gt;&gt;<i> acl Safe_ports port 777 # multiling http
</I>&gt;&gt;<i> acl CONNECT method CONNECT
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> http_access allow keepgoing
</I>&gt;&gt;<i> http_access deny !Safe_ports
</I>&gt;&gt;<i> http_access deny CONNECT !SSL_ports
</I>&gt;&gt;<i> #http_access allow CONNECT SSL_ports
</I>&gt;&gt;<i> http_access allow localhost manager
</I>&gt;&gt;<i> http_access allow site_squid_art
</I>&gt;&gt;<i> http_access allow localhost
</I>&gt;&gt;<i>
</I>
I see no 'localnet' ACL use. If this proxy is supposed to be servicing
LAN clients, that will be needed and the keepgoing and artwork ACLs
probably not needed.

The final &quot;http_access deny all&quot; is missing as well. Squid is just doing
that impicitly anyway. So its more needed to remind you of what is
happening and prevent possible mistakes implicitly allowing lots of
unexpected things through the proxy later.


&gt;&gt;<i>
</I>&gt;&gt;<i> http_port 3132
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> access_log /var/log/squid3/squid3132.log squid
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> pid_filename /var/run/squid3132.pid
</I>&gt;&gt;<i> coredump_dir /var/spool/squid3
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> refresh_pattern ^ftp: 1440 20% 10080
</I>&gt;&gt;<i> refresh_pattern ^gopher: 1440 0% 1440
</I>&gt;&gt;<i> #refresh_pattern -i (/cgi-bin/|\?) 0 0% 0
</I>
FYI: The above commented out line is rather critical to the correct
behaviour for dynamic web content.

If the server is not producing the required cache controls dynamically
changing data should not be allowed to store for one second, let alone
the default 7 days.

&gt;&gt;<i> refresh_pattern (Release|Packages(.gz)*)$      0       20%     2880
</I>&gt;&gt;<i> #refresh_pattern . 0 20% 4320
</I>&gt;&gt;<i>
</I>
Whats the point of commenting that out?

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014140.html">[squid-users] HTTPS site filtering
</A></li>
	<LI>Next message (by thread): <A HREF="014143.html">[squid-users] HTTPS site filtering
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14142">[ date ]</a>
              <a href="thread.html#14142">[ thread ]</a>
              <a href="subject.html#14142">[ subject ]</a>
              <a href="author.html#14142">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
