<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] [3.5.23]: mozilla.org failed using	SSL	transparent SSL23_GET_SERVER_HELLO:unknown protocol
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5B3.5.23%5D%3A%20mozilla.org%20failed%20using%0A%09SSL%09transparent%20SSL23_GET_SERVER_HELLO%3Aunknown%20protocol&In-Reply-To=%3C042201d27637%24fe1c1da0%24fa5458e0%24%40articatech.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014205.html">
   <LINK REL="Next"  HREF="014164.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] [3.5.23]: mozilla.org failed using	SSL	transparent SSL23_GET_SERVER_HELLO:unknown protocol</H1>
    <B>David Touzeau</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5B3.5.23%5D%3A%20mozilla.org%20failed%20using%0A%09SSL%09transparent%20SSL23_GET_SERVER_HELLO%3Aunknown%20protocol&In-Reply-To=%3C042201d27637%24fe1c1da0%24fa5458e0%24%40articatech.com%3E"
       TITLE="[squid-users] [3.5.23]: mozilla.org failed using	SSL	transparent SSL23_GET_SERVER_HELLO:unknown protocol">david at articatech.com
       </A><BR>
    <I>Tue Jan 24 11:50:00 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014205.html">[squid-users] [3.5.23]: mozilla.org failed using SSL	transparent SSL23_GET_SERVER_HELLO:unknown protocol
</A></li>
        <LI>Next message (by thread): <A HREF="014164.html">[squid-users] cert mem cache
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14207">[ date ]</a>
              <a href="thread.html#14207">[ thread ]</a>
              <a href="subject.html#14207">[ subject ]</a>
              <a href="author.html#14207">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

-----Message d'origine-----
De : squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] De la part de David Touzeau
Envoy&#233; : mardi 24 janvier 2017 11:42
&#192; : <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Objet : Re: [squid-users] [3.5.23]: mozilla.org failed using SSL transparent SSL23_GET_SERVER_HELLO:unknown protocol


This is a different log trace from David's.

Here Squid is setting up a TUNNEL to the clients original dst-IP, successfully. Any TLS funky stuff going on for this transaction is done directly between server and client. Squid's only involvement is to peek at the Hello messages and record them for its log.

But some of those details (ie the agreed cipher) come from the ServerHello on successful TLS setup. So I think no errors happened in that log entries transaction.

Amos

______________________________________________________________________________________________


Hi tried with

acl nossl dst 104.16.41.2
acl nossl2 dstdomain -i .mozilla.org
ssl_bump splice nossl
ssl_bump splice nossl2
acl ssl_step1 at_step SslBump1
acl ssl_step2 at_step SslBump2
acl ssl_step3 at_step SslBump3
ssl_bump peek ssl_step1
ssl_bump splice all
sslproxy_flags DONT_VERIFY_PEER
sslproxy_cert_error allow all

1485252508.663      2 192.168.1.236 TAG_NONE/403 6263 CONNECT 
104.16.41.2:443 - HIER_NONE/- text/html
1485252509.385      2 192.168.1.236 TAG_NONE/403 6263 CONNECT 
104.16.41.2:443 - HIER_NONE/- text/html

Using squid port 3128 without any bump allow accessing to mozilla 

So if there are any acl it will be blocked on both.

Return back to list with a full debug mode..


_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>



Using acl nossl ssl::server_name working like a charme.
Also after restarting C-ICAP everything is fine.
Thanks everyone 

* * * TOPIC CLOSED * * * 



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014205.html">[squid-users] [3.5.23]: mozilla.org failed using SSL	transparent SSL23_GET_SERVER_HELLO:unknown protocol
</A></li>
	<LI>Next message (by thread): <A HREF="014164.html">[squid-users] cert mem cache
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14207">[ date ]</a>
              <a href="thread.html#14207">[ thread ]</a>
              <a href="subject.html#14207">[ subject ]</a>
              <a href="author.html#14207">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
