<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] LDAP acl groups
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20LDAP%20acl%20groups&In-Reply-To=%3C219f3c68-59f5-51b9-77b1-4b38d34a2d3d%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014235.html">
   <LINK REL="Next"  HREF="014237.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] LDAP acl groups</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20LDAP%20acl%20groups&In-Reply-To=%3C219f3c68-59f5-51b9-77b1-4b38d34a2d3d%40treenet.co.nz%3E"
       TITLE="[squid-users] LDAP acl groups">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Jan 25 23:18:18 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014235.html">[squid-users] LDAP acl groups
</A></li>
        <LI>Next message (by thread): <A HREF="014237.html">[squid-users] Antivirus for squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14242">[ date ]</a>
              <a href="thread.html#14242">[ thread ]</a>
              <a href="subject.html#14242">[ subject ]</a>
              <a href="author.html#14242">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 26/01/2017 4:28 a.m., Leonardo Bacha Abrantes wrote:
&gt;<i> Hi guys,
</I>&gt;<i> 
</I>&gt;<i> I have an active directory running on windows server 2008 r2 and squid
</I>&gt;<i> (version 3.5.20 - CentOS 7) authenticating via LDAP (without kerberos).
</I>&gt;<i> The ldap authentication is working, the trouble is to create ACLs based on
</I>&gt;<i> active directory groups.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> OBS: When I run both basic_ldap_auth and ext_ldap_group_acl commands
</I>&gt;<i> manually as squid user in console to test, I receive 'OK' as answer.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ---&gt;&gt;&gt; My squid.conf:
</I>&gt;<i> 
</I>&gt;<i> auth_param basic program /usr/lib64/squid/basic_ldap_auth -P -R -b
</I>&gt;<i> ou=Users,ou=city,ou=country,dc=company,dc=local -D
</I>&gt;<i> CN=bindUser,DC=company,DC=local -W PasswdFile -f sAMAccountName=%s -h
</I>&gt;<i> 192.168.1.9
</I>&gt;<i> auth_param basic children 10
</I>&gt;<i> auth_param basic realm XXXXX
</I>&gt;<i> auth_param basic credentialsttl 10 minutes
</I>&gt;<i> 
</I>&gt;<i> external_acl_type memberof %LOGIN /usr/lib64/squid/ext_ldap_group_acl -P -R
</I>&gt;<i> -b OU=city,OU=country,DC=company,DC=local -D
</I>&gt;<i> CN=bindUser,DC=company,DC=local -W PasswdFile -h 192.168.1.9 -f
</I>&gt;<i> '(&amp;(objectClass=person)(sAMAccountName=%v)(memberOf=CN=%a,OU=Groups,OU=city,OU=country,dc=company,dc=local))'
</I>&gt;<i> 
</I>&gt;<i> #Also tried memberOf=CN=%*g*
</I>&gt;<i> 
</I>&gt;<i> acl fullaccess  external memberof squid_fullaccess
</I>&gt;<i> 
</I>&gt;<i> acl LdapUsers proxy_auth REQUIRED
</I>&gt;<i> http_access allow fullaccess LdapUsers
</I>

Two things that you really NEED to know:

1) Order is important.
&lt;<A HREF="http://wiki.squid-cache.org/SquidFaq/OrderIsImportant">http://wiki.squid-cache.org/SquidFaq/OrderIsImportant</A>&gt;

So the http_access line you are using tells Squid to check the group and
only for members of the group is authentication to be performed.

How exactly do you expect Squid to know what user to check the groups
for *before* authentication has happened?


2) the popup is a browser decision.

All Squid is doing is telling the browser that credentials are needed to
use the proxy, and what types it can accept. If the browser were
properly doing its SSO the popup would not happen. There is nothing we
can do about that.


What you should do is deny non-authenticated users and only then check
the groups for people who have authenticated:

 http_access deny !LdapUsers
 http_access allow fullaccess

If the popup still occurs, then consder whether the browser was supposed
to have the right credentials to begin with (ie. registered to the AD
domin controller). If it does why is it not sending them instead of
doing the popup.


Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014235.html">[squid-users] LDAP acl groups
</A></li>
	<LI>Next message (by thread): <A HREF="014237.html">[squid-users] Antivirus for squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14242">[ date ]</a>
              <a href="thread.html#14242">[ thread ]</a>
              <a href="subject.html#14242">[ subject ]</a>
              <a href="author.html#14242">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
