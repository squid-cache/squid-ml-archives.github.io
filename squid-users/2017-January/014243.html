<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Not all html objects are being cached
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Not%20all%20html%20objects%20are%20being%20cached&In-Reply-To=%3C609d443c-daeb-8c0e-b4b8-ab5be13f8d76%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014241.html">
   <LINK REL="Next"  HREF="014253.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Not all html objects are being cached</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Not%20all%20html%20objects%20are%20being%20cached&In-Reply-To=%3C609d443c-daeb-8c0e-b4b8-ab5be13f8d76%40treenet.co.nz%3E"
       TITLE="[squid-users] Not all html objects are being cached">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Jan 26 01:01:54 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014241.html">[squid-users] Not all html objects are being cached
</A></li>
        <LI>Next message (by thread): <A HREF="014253.html">[squid-users] Not all html objects are being cached
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14243">[ date ]</a>
              <a href="thread.html#14243">[ thread ]</a>
              <a href="subject.html#14243">[ subject ]</a>
              <a href="author.html#14243">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 26/01/2017 9:44 a.m., Yuri Voinov wrote:
&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 26.01.2017 2:22, boruc &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;&gt;<i> After a little bit of analyzing requests and responses with WireShark I
</I>&gt;&gt;<i> noticed that many sites that weren't cached had different combination of
</I>&gt;&gt;<i> below parameters:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Cache-Control: no-cache, no-store, must-revalidate, post-check, pre-check,
</I>&gt;&gt;<i> private, public, max-age, public
</I>&gt;&gt;<i> Pragma: no-cache
</I>&gt;<i> If the webmaster has done this - he had good reason to. Trying to break
</I>&gt;<i> the RFC in this way, you break the Internet.
</I>
Instead use the latest Squid you can. Squid by default caches as much as
it can within the restrictions imposed by the web environment. But
'latest is best' etc. since we are still working on support for HTTP/1.1
features.


I recommend you use the tool at &lt;<A HREF="http://redbot.org">http://redbot.org</A>&gt; to check URLs
cacheability instead of wireshark. It will tell you what those controls
actually *mean* in regards to cacheability, not just that they are used.
And whether there are other problems you may not have noticed in the
various different ways there are to fetch any given URL.


The Squid options available are mostly for disabling some caching
operation - so that if you are in a situation where disabling operation
X causes operation Y to cache better you can tune the behaviour.

You can't really *force* things which are not cacheable to be stored.
They will just be replaced with a newer copy shortly after with no
benefit gained - just some possibly nasty side effects, or real monetary
costs.


&gt;&gt;<i>
</I>&gt;&gt;<i> There is a possibility to disable this in squid by using
</I>&gt;<i> Don't do it.
</I>&gt;&gt;<i> request_header_access and reply_header_access, however it doesn't work for
</I>&gt;&gt;<i> me, many pages aren't still in cache. I am currently using lines below:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> request_header_access Cache-Control deny all
</I>&gt;&gt;<i> request_header_access Pragma deny all
</I>&gt;&gt;<i> request_header_access Accept-Encoding deny all
</I>&gt;&gt;<i> reply_header_access Cache-Control deny all
</I>&gt;&gt;<i> reply_header_access Pragma deny all
</I>&gt;&gt;<i> reply_header_access Accept-Encoding deny all
</I>&gt;&gt;<i>
</I>
Ah, changing the headers on the *outgoing* traffic does not in any way
affect how Squid interprets the _previously_ received inbound messages.

==&gt; In other words; doing the above is pointless and screws everybody
using your proxy over. Dont do that.


By erasing the Cache-Controls response header delivered along with that
content you are technically in violation of International copyright laws.
==&gt; Dont do that.


By removing the Accept-Encoding on requests (only) you can improve HIT
ratio (only a small amount), but at cost of 50-90% bandwidth increase on
each MISS - so the cost increase usually swamps the gains.

==&gt; Making this change lead to the opposite of what you intended. Dont
do that.


Removing the Accept-Encoding header on responses. Is just pointless. It
controls POST/PUT payload data, which Squid cannot cache anyway. So all
you did was prevent the clients using less bandwidth.

==&gt; More bandwidth, more costs. Dont do that.


Removing the Pragma header is also pointless. It's used by very ancient
software from the 1990's and such.

==&gt; if the web application was actually using the Pragma for anything
important (some do) you just screwed them over with no gains to
yourself. Dont do that.


&gt;&gt;<i> I could also try refresh_pattern, but I don't think that code below will
</I>&gt;&gt;<i> work because not every URL ends with .html or .htm (because you visit
</I>&gt;&gt;<i> /www.example.com/, not /www.example.com/index.html/)
</I>&gt;&gt;<i> refresh_pattern -i \.(html|htm)$          1440   40% 40320 ignore-no-cache
</I>&gt;&gt;<i> ignore-no-store ignore-private override-expire reload-into-ims
</I>&gt;&gt;<i>
</I>

Quite. So configure the correct options.

No software is psychic enough to do operation X which you want, when you
configure it to do *only* some other non-X operation.


Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014241.html">[squid-users] Not all html objects are being cached
</A></li>
	<LI>Next message (by thread): <A HREF="014253.html">[squid-users] Not all html objects are being cached
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14243">[ date ]</a>
              <a href="thread.html#14243">[ thread ]</a>
              <a href="subject.html#14243">[ subject ]</a>
              <a href="author.html#14243">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
