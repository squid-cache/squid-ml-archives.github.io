<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Native FTP relay: connection closes (?) after	'cannot assign requested address' error
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Native%20FTP%20relay%3A%20connection%20closes%20%28%3F%29%20after%0A%09%27cannot%20assign%20requested%20address%27%20error&In-Reply-To=%3C201701261801.27407.Antony.Stone%40squid.open.source.it%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014246.html">
   <LINK REL="Next"  HREF="014248.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Native FTP relay: connection closes (?) after	'cannot assign requested address' error</H1>
    <B>Antony Stone</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Native%20FTP%20relay%3A%20connection%20closes%20%28%3F%29%20after%0A%09%27cannot%20assign%20requested%20address%27%20error&In-Reply-To=%3C201701261801.27407.Antony.Stone%40squid.open.source.it%3E"
       TITLE="[squid-users] Native FTP relay: connection closes (?) after	'cannot assign requested address' error">Antony.Stone at squid.open.source.it
       </A><BR>
    <I>Thu Jan 26 17:01:27 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014246.html">[squid-users] Native FTP relay: connection closes (?) after 'cannot assign requested address' error
</A></li>
        <LI>Next message (by thread): <A HREF="014248.html">[squid-users] Native FTP relay: connection closes (?) after 'cannot assign requested address' error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14247">[ date ]</a>
              <a href="thread.html#14247">[ thread ]</a>
              <a href="subject.html#14247">[ subject ]</a>
              <a href="author.html#14247">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thursday 26 January 2017 at 17:41:21, Alexander wrote:

&gt;<i> It seems that I have solved the issue by using nf_conntrack_ftp and
</I>&gt;<i> redirecting &quot;NEW,RELATED&quot; traffic to squid:
</I>
Excellent news.

&gt;<i> ftp_port 2121 intercept
</I>&gt;<i> 
</I>&gt;<i> modprobe nf_conntrack_ftp ports=2121
</I>&gt;<i> 
</I>&gt;<i> iptables -t nat -A PREROUTING -p tcp --dport 21 -j REDIRECT --to-port 2121
</I>&gt;<i> iptables -t nat -A PREROUTING -p tcp -m state --state NEW,RELATED -j
</I>&gt;<i> REDIRECT
</I>
Just out of interest, how are you getting the FTP traffic to the Squid box in 
the first place?

I assume you're not routing all Internet-bound traffic via this machine 
(otherwise that second REDIRECT rule would cause problems for SSH, SMTP, IMAP, 
etc), so how are you identifying the FTP traffic to get it from your router to 
the Squid box?


Antony.

-- 
Police have found a cartoonist dead in his house.  They say that details are 
currently sketchy.

                                                   Please reply to the list;
                                                         please *don't* CC me.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014246.html">[squid-users] Native FTP relay: connection closes (?) after 'cannot assign requested address' error
</A></li>
	<LI>Next message (by thread): <A HREF="014248.html">[squid-users] Native FTP relay: connection closes (?) after 'cannot assign requested address' error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14247">[ date ]</a>
              <a href="thread.html#14247">[ thread ]</a>
              <a href="subject.html#14247">[ subject ]</a>
              <a href="author.html#14247">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
