<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Not all html objects are being cached
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Not%20all%20html%20objects%20are%20being%20cached&In-Reply-To=%3Ca9ab7ffd-8f89-b78d-df6e-bdb49cc0c27f%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014259.html">
   <LINK REL="Next"  HREF="014267.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Not all html objects are being cached</H1>
    <B>Yuri</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Not%20all%20html%20objects%20are%20being%20cached&In-Reply-To=%3Ca9ab7ffd-8f89-b78d-df6e-bdb49cc0c27f%40gmail.com%3E"
       TITLE="[squid-users] Not all html objects are being cached">yvoinov at gmail.com
       </A><BR>
    <I>Fri Jan 27 09:47:06 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014259.html">[squid-users] Not all html objects are being cached
</A></li>
        <LI>Next message (by thread): <A HREF="014267.html">[squid-users] Not all html objects are being cached
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14265">[ date ]</a>
              <a href="thread.html#14265">[ thread ]</a>
              <a href="subject.html#14265">[ subject ]</a>
              <a href="author.html#14265">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

27.01.2017 9:10, Amos Jeffries &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> On 27/01/2017 9:46 a.m., Yuri Voinov wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 27.01.2017 2:44, Matus UHLAR - fantomas &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;&gt;&gt;&gt;<i> 26.01.2017 2:22, boruc &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;&gt;&gt;&gt;&gt;<i> After a little bit of analyzing requests and responses with WireShark I
</I>&gt;&gt;&gt;&gt;&gt;<i> noticed that many sites that weren't cached had different
</I>&gt;&gt;&gt;&gt;&gt;<i> combination of
</I>&gt;&gt;&gt;&gt;&gt;<i> below parameters:
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Cache-Control: no-cache, no-store, must-revalidate, post-check,
</I>&gt;&gt;&gt;&gt;&gt;<i> pre-check,
</I>&gt;&gt;&gt;&gt;&gt;<i> private, public, max-age, public
</I>&gt;&gt;&gt;&gt;&gt;<i> Pragma: no-cache
</I>&gt;&gt;&gt;<i> On 26.01.17 02:44, Yuri Voinov wrote:
</I>&gt;&gt;&gt;&gt;<i> If the webmaster has done this - he had good reason to. Trying to break
</I>&gt;&gt;&gt;&gt;<i> the RFC in this way, you break the Internet.
</I>&gt;&gt;&gt;<i> Actually, no. If the webmaster has done the above - he has no damn
</I>&gt;&gt;&gt;<i> idea what
</I>&gt;&gt;&gt;<i> those mean (private and public?) , and how to provide properly cacheable
</I>&gt;&gt;&gt;<i> content.
</I>&gt;&gt;<i> It was sarcasm.
</I>&gt;<i>
</I>&gt;<i> You may have intended it to be. But you spoke the simple truth.
</I>&gt;<i>
</I>&gt;<i> Other than 'public' there really are situations which have &quot;good reason&quot;
</I>&gt;<i> to send that set of controls all at once.
</I>&gt;<i>
</I>&gt;<i> For example; any admin who wants a RESTful or SaaS application to
</I>&gt;<i> actually work for all their potential customers.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I have been watching the below cycle take place for the past 20 years in
</I>&gt;<i> HTTP:
</I>&gt;<i>
</I>&gt;<i> Webmaster: dont cache this please.
</I>&gt;<i>
</I>&gt;<i>    &quot;Cache-Control: no-store&quot;
</I>&gt;<i>
</I>&gt;<i> Proxy Admin: ignore-no-store
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Webmaster: I meant it. Dont deliver anything you cached without fetching
</I>&gt;<i> a updated version.
</I>&gt;<i>
</I>&gt;<i>    ... &quot;no-store, no-cache&quot;
</I>&gt;<i>
</I>&gt;<i> Proxy Admin: ignore-no-cache
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Webmaster: really you MUST revalidate before using ths data.
</I>&gt;<i>
</I>&gt;<i>   ... &quot;no-store, no-cache, must-revalidate&quot;
</I>&gt;<i>
</I>&gt;<i> Proxy Admin: ignore-must-revalidate
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Webmaster: Really I meant it. This is non-storable PRIVATE DATA!
</I>&gt;<i>
</I>&gt;<i> ... &quot;no-store, no-cache, must-revalidate, private&quot;
</I>&gt;<i>
</I>&gt;<i> Proxy Admin: ignore-private
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Webmaster: Seriously. I'm changing it on EVERY request! dont store it.
</I>&gt;<i>
</I>&gt;<i> ... &quot;no-store, no-cache, must-revalidate, private, max-age=0&quot;
</I>&gt;<i> &quot;Expires: -1&quot;
</I>&gt;<i>
</I>&gt;<i> Proxy Admin: ignore-expires
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Webmaster: are you one of those dumb HTTP/1.0 proxies who dont
</I>&gt;<i> understand Cache-Control?
</I>&gt;<i>
</I>&gt;<i> &quot;Pragma: no-cache&quot;
</I>&gt;<i> &quot;Expires: 1 Jan 1970&quot;
</I>&gt;<i>
</I>&gt;<i> Proxy Admin: hehe! I already ignore-no-cache ignore-expires
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Webmaster: F*U!  May your clients batch up their traffic to slam you
</I>&gt;<i> with it all at once!
</I>&gt;<i>
</I>&gt;<i> ... &quot;no-store, no-cache, must-revalidate, private, max-age=0,
</I>&gt;<i> pre-check=1, post-check=1&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Proxy Admin: My bandwidth! I need to cache more!
</I>&gt;<i>
</I>&gt;<i> Webmaster: Doh! Oh well, so I have to write my application to force new
</I>&gt;<i> content then.
</I>&gt;<i>
</I>&gt;<i> Proxy Admin: ignore-reload
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Webmaster: Now What? Oh HTTPS wont have any damn proxies in the way....
</I>&gt;<i>
</I>&gt;<i> ... the cycle repeats again within HTTPS. Took all of 5 years this time.
</I>&gt;<i>
</I>&gt;<i> ... the cycle repeats again within SPDY. That took only ~1 year.
</I>&gt;<i>
</I>&gt;<i> ... the cycle repeats again within CoAP. The standards are not even
</I>&gt;<i> finished yet and its underway.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Stop this cycle of stupidity. It really HAS &quot;broken the Internet&quot;.
</I>All that would be just great if a webmaster was conscientious. I will 
give just one example.

Only one example.

root @ khorne /patch # wget -S <A HREF="http://www.microsoft.com">http://www.microsoft.com</A>
--2017-01-27 15:29:54--  <A HREF="http://www.microsoft.com/">http://www.microsoft.com/</A>
Connecting to 127.0.0.1:3128... connected.
Proxy request sent, awaiting response...
   HTTP/1.1 302 Found
   Server: AkamaiGHost
   Content-Length: 0
   Location: <A HREF="http://www.microsoft.com/ru-kz/">http://www.microsoft.com/ru-kz/</A>
   Date: Fri, 27 Jan 2017 09:29:54 GMT
   X-CCC: NL
   X-CID: 2
   X-Cache: MISS from khorne
   X-Cache-Lookup: MISS from khorne:3128
   Connection: keep-alive
Location: <A HREF="http://www.microsoft.com/ru-kz/">http://www.microsoft.com/ru-kz/</A> [following]
--2017-01-27 15:29:54--  <A HREF="http://www.microsoft.com/ru-kz/">http://www.microsoft.com/ru-kz/</A>
Reusing existing connection to 127.0.0.1:3128.
Proxy request sent, awaiting response...
   HTTP/1.1 301 Moved Permanently
   Server: AkamaiGHost
   Content-Length: 0
   Location: <A HREF="https://www.microsoft.com/ru-kz/">https://www.microsoft.com/ru-kz/</A>
   Date: Fri, 27 Jan 2017 09:29:54 GMT
   Set-Cookie: 
akacd_OneRF=1493285394~rv=7~id=6a2316770abdbb58a85c16676a0f84fd; path=/; 
Expires=Thu, 27 Apr 2017 09:29:54 GMT
   X-CCC: NL
   X-CID: 2
   X-Cache: MISS from khorne
   X-Cache-Lookup: MISS from khorne:3128
   Connection: keep-alive
Location: <A HREF="https://www.microsoft.com/ru-kz/">https://www.microsoft.com/ru-kz/</A> [following]
--2017-01-27 15:29:54--  <A HREF="https://www.microsoft.com/ru-kz/">https://www.microsoft.com/ru-kz/</A>
Connecting to 127.0.0.1:3128... connected.
Proxy request sent, awaiting response...
   HTTP/1.1 200 OK
   Cache-Control: no-cache, no-store
   Pragma: no-cache
   Content-Type: text/html
   Expires: -1
   Server: Microsoft-IIS/8.0
   CorrelationVector: BzssVwiBIUaXqyOh.1.1
   X-AspNet-Version: 4.0.30319
   X-Powered-By: ASP.NET
   Access-Control-Allow-Headers: Origin, X-Requested-With, Content-Type, 
Accept
   Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS
   Access-Control-Allow-Credentials: true
   P3P: CP=&quot;ALL IND DSP COR ADM CONo CUR CUSo IVAo IVDo PSA PSD TAI TELo 
OUR SAMo CNT COM INT NAV ONL PHY PRE PUR UNI&quot;
   X-Frame-Options: SAMEORIGIN
   Vary: Accept-Encoding
   Content-Encoding: gzip
   Date: Fri, 27 Jan 2017 09:29:56 GMT
   Content-Length: 13322
   Set-Cookie: MS-CV=BzssVwiBIUaXqyOh.1; domain=.microsoft.com; 
expires=Sat, 28-Jan-2017 09:29:56 GMT; path=/
   Set-Cookie: MS-CV=BzssVwiBIUaXqyOh.2; domain=.microsoft.com; 
expires=Sat, 28-Jan-2017 09:29:56 GMT; path=/
   Strict-Transport-Security: max-age=0; includeSubDomains
   X-CCC: NL
   X-CID: 2
   X-Cache: MISS from khorne
   X-Cache-Lookup: MISS from khorne:3128
   Connection: keep-alive
Length: 13322 (13K) [text/html]
Saving to: 'index.html'

index.html          100%[==================&gt;]  13.01K --.-KB/s    in 0s

2017-01-27 15:29:57 (32.2 MB/s) - 'index.html' saved [13322/13322]

Can you explain me - for what static index.html has this:

Cache-Control: no-cache, no-store
Pragma: no-cache

?

What can be broken to ignore CC in this page?


Yes, saving traffic is the most important, because not all and not 
everywhere has terabit links with unlimited calling. Moreover, the 
number of users increases and the capacity is finite. In any case, the 
decision on how to deal with the content in such a situation should 
remain behind the proxy administrator. And not for the developers of 
this proxy, which is hardcoded own vision, even with RFC. Because the 
byte-hit 10% (vanilla Squid, after very hadr work it will be up to 30%, 
but no more) - this is ridiculous. In such a situation would be more 
honest nothing at all cache - only let's not say that the squid - a 
caching proxy. Set the path of the secondary server that requires a lot 
of attention, despite the fact that it gives a gain only 10% - a mockery 
of users.

Let me explain the situation as I see it. Webmaster hanging everywhere 
ban caching in any way possible, because on its pages full of 
advertising. For that pays money. This is the same reason that Google 
prevents caching Youtube. Big money. We do not get the money, in fact, 
our goal - to minimize the costs of traffic. We choose Squid as a tool. 
And you, with your point of view, deprived us of weapons against 
unscrupulous webmasters. So it looks.

Again. Breaking the Internet - it should be my choice, not yours. Or 
follow the RFC at 100% - or do not have to break it in part. You either 
wear pants or remove the cross, as they say.
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> HTH
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014259.html">[squid-users] Not all html objects are being cached
</A></li>
	<LI>Next message (by thread): <A HREF="014267.html">[squid-users] Not all html objects are being cached
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14265">[ date ]</a>
              <a href="thread.html#14265">[ thread ]</a>
              <a href="subject.html#14265">[ subject ]</a>
              <a href="author.html#14265">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
