<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] WARNING: Disk space over limit
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20WARNING%3A%20Disk%20space%20over%20limit&In-Reply-To=%3C5480ea5c-cf69-8902-c13e-232ff01f29dd%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015893.html">
   <LINK REL="Next"  HREF="015894.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] WARNING: Disk space over limit</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20WARNING%3A%20Disk%20space%20over%20limit&In-Reply-To=%3C5480ea5c-cf69-8902-c13e-232ff01f29dd%40treenet.co.nz%3E"
       TITLE="[squid-users] WARNING: Disk space over limit">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Jul 12 07:25:30 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015893.html">[squid-users] WARNING: Disk space over limit
</A></li>
        <LI>Next message (by thread): <A HREF="015894.html">[squid-users] WARNING: Disk space over limit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15895">[ date ]</a>
              <a href="thread.html#15895">[ thread ]</a>
              <a href="subject.html#15895">[ subject ]</a>
              <a href="author.html#15895">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12/07/17 10:47, Yuri wrote:
&gt;<i> 
</I>&gt;<i> Well. Let's read squid.conf.documented:
</I>&gt;<i> 
</I>&gt;<i> #  TAG: cache_swap_low    (percent, 0-100)
</I>&gt;<i> #    The low-water mark for AUFS/UFS/diskd cache object eviction by
</I>&gt;<i> #    the cache_replacement_policy algorithm.
</I>&gt;<i> #
</I>&gt;<i> #    Removal begins when the swap (disk) usage of a cache_dir is
</I>&gt;<i> #    above this low-water mark and attempts to maintain utilization
</I>&gt;<i> #    near the low-water mark.
</I>&gt;<i> #
</I>&gt;<i> #    As swap utilization increases towards the high-water mark set
</I>&gt;<i> #    by cache_swap_high object eviction becomes more agressive.
</I>&gt;<i> #
</I>&gt;<i> #    The value difference in percentages between low- and high-water
</I>&gt;<i> #    marks represent an eviction rate of 300 objects per second and
</I>&gt;<i> #    the rate continues to scale in agressiveness by multiples of
</I>&gt;<i> #    this above the high-water mark.
</I>&gt;<i> #
</I>&gt;<i> #    Defaults are 90% and 95%. If you have a large cache, 5% could be
</I>&gt;<i> #    hundreds of MB. If this is the case you may wish to set these
</I>&gt;<i> #    numbers closer together.
</I>&gt;<i> #
</I>&gt;<i> #    See also cache_swap_high and cache_replacement_policy
</I>&gt;<i> 
</I>&gt;<i> Eviction starts when you cache achieves cache_swap_low. So, may be you
</I>&gt;<i> traffic is more than squid can be replaced between 90 and 95%. So, you
</I>&gt;<i> can try to decrease cache_swap_low. Or, review your caching policy to be
</I>&gt;<i> less aggressive. Or, increase cache_dir limit. Or all together.
</I>&gt;<i> 
</I>
Or adjust the maximum object size that cache can store.

Since the warnings are clearly decreasing in overage value things seem 
to be recovering properly. The warning is to alert you that it happened 
in the first place, so traffic may need re-evaluation. Your proxy seems 
to be able to evict ~400 MB/cycle from disk.


Additional to traffic rate, it is rare but can happen that one or more 
very large objects are fetched very close together. Squid then discovers 
it has to throw away GB of objects to make room for them, even though 
they may not have fully arrived yet. This may exceed the eviction rate 
for a while, depending on your disk I/O speed.




The math if you are interested:

At your total cache size, the 5% high-low gap is only 750 MB, and the 
warning occurs at 100% - just another 750 MB above that gap. Giving a 
total burst size of 1.5 GB of object(s) necessary to trigger it.

NP: that 1.5GB needs to be above the regular eviction rate per garbage 
cycle. If you are having trouble the fix is to a) get faster RPM disks, 
b) spread the load over more proxies,


I notice that the overage value in the trace is only 2.2 GB which is 
within realm for DVD images, HD movies, Windows 10 updates, etc.
If you are intending to cache those you need; multiple cache disks, 
lower high/low percentages.

  You can also ensure the physical disk has a sufficient buffer of space 
to not worry about occasional of these warnings. That is effectivively 
the same as lowering the low watermark but prohibits Squid from using 
that space when traffic is not being such a problem.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015893.html">[squid-users] WARNING: Disk space over limit
</A></li>
	<LI>Next message (by thread): <A HREF="015894.html">[squid-users] WARNING: Disk space over limit
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15895">[ date ]</a>
              <a href="thread.html#15895">[ thread ]</a>
              <a href="subject.html#15895">[ subject ]</a>
              <a href="author.html#15895">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
