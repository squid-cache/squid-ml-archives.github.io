<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] What would be the maximum ufs\aufs cache_dir objects?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20What%20would%20be%20the%20maximum%20ufs%5Caufs%20cache_dir%0A%20objects%3F&In-Reply-To=%3Cd08145b1-6c4c-0b1e-26b3-78559563f4ed%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015931.html">
   <LINK REL="Next"  HREF="015943.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] What would be the maximum ufs\aufs cache_dir objects?</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20What%20would%20be%20the%20maximum%20ufs%5Caufs%20cache_dir%0A%20objects%3F&In-Reply-To=%3Cd08145b1-6c4c-0b1e-26b3-78559563f4ed%40measurement-factory.com%3E"
       TITLE="[squid-users] What would be the maximum ufs\aufs cache_dir objects?">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Jul 14 17:48:58 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015931.html">[squid-users] What would be the maximum ufs\aufs cache_dir objects?
</A></li>
        <LI>Next message (by thread): <A HREF="015943.html">[squid-users] What would be the maximum ufs\aufs cache_dir	objects?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15934">[ date ]</a>
              <a href="thread.html#15934">[ thread ]</a>
              <a href="subject.html#15934">[ subject ]</a>
              <a href="author.html#15934">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07/14/2017 10:47 AM, Amos Jeffries wrote:

&gt;<i> One UFS cache_dir can hold a maximum of (2^27)-1 safely. 
</I>
You probably meant to say (2^25)-1 but the actual number is (2^24)-1
because the sfileno is signed. This is why you get 16'777'215 (a.k.a.
0xFFFFFF) as the actual limit.


&gt;<i> The index hash entries are stored as a 32-bit bitmask (sfileno) - with 5
</I>&gt;<i> bits for cache_dir ID and 27 bits for hash of the file details.
</I>
The cache index entries are hashed on their keys, not file numbers (of
any kind). The index entry is using 25 bits for the file number, but
IIRC, those 25 bits are never merged/combined with the 7 bits of the
cache_dir ID in any meaningful way.


Alex.

&gt;<i> typedef signed_int32_t sfileno;&gt;     sfileno swap_filen:25; // keep in sync with SwapFilenMax
</I>&gt;<i>     sdirno swap_dirn:7;
</I>&gt;<i> enum { SwapFilenMax = 0xFFFFFF }; // keep in sync with StoreEntry::swap_filen
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015931.html">[squid-users] What would be the maximum ufs\aufs cache_dir objects?
</A></li>
	<LI>Next message (by thread): <A HREF="015943.html">[squid-users] What would be the maximum ufs\aufs cache_dir	objects?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15934">[ date ]</a>
              <a href="thread.html#15934">[ thread ]</a>
              <a href="subject.html#15934">[ subject ]</a>
              <a href="author.html#15934">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
