<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Packets logged as blocked even Firewall	(IPtables) accepts them ...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Packets%20logged%20as%20blocked%20even%20Firewall%0A%09%28IPtables%29%20accepts%20them%20...&In-Reply-To=%3C201707191053.46927.Antony.Stone%40squid.open.source.it%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015971.html">
   <LINK REL="Next"  HREF="015983.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Packets logged as blocked even Firewall	(IPtables) accepts them ...</H1>
    <B>Antony Stone</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Packets%20logged%20as%20blocked%20even%20Firewall%0A%09%28IPtables%29%20accepts%20them%20...&In-Reply-To=%3C201707191053.46927.Antony.Stone%40squid.open.source.it%3E"
       TITLE="[squid-users] Packets logged as blocked even Firewall	(IPtables) accepts them ...">Antony.Stone at squid.open.source.it
       </A><BR>
    <I>Wed Jul 19 09:53:46 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015971.html">[squid-users] Packets logged as blocked even Firewall (IPtables) accepts them ...
</A></li>
        <LI>Next message (by thread): <A HREF="015983.html">[squid-users] Packets logged as blocked even Firewall	(IPtables)	accepts them ...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15973">[ date ]</a>
              <a href="thread.html#15973">[ thread ]</a>
              <a href="subject.html#15973">[ subject ]</a>
              <a href="author.html#15973">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wednesday 19 July 2017 at 10:40:36, Walter H. wrote:

&gt;<i> On Wed, July 19, 2017 11:31, Antony Stone wrote:
</I>&gt;<i> &gt; On Wednesday 19 July 2017 at 10:16:30, Walter H. wrote:
</I>&gt;<i> &gt;&gt; I added these rules, and will see which packets are caught
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; -A INPUT -m state --state INVALID -j LOG --log-prefix &quot;IP[IN(invalid)]:
</I>&gt;<i> &gt;&gt; &quot; --log-level 7
</I>&gt;<i> &gt;&gt; -A FORWARD -m state --state INVALID -j LOG --log-prefix
</I>&gt;<i> &gt;&gt; &quot;IP[FWD(invalid)]: &quot; --log-level 7
</I>&gt;<i> &gt;&gt; -A OUTPUT -m state --state INVALID -j LOG --log-prefix
</I>&gt;<i> &gt;&gt; &quot;IP[OUT(invalid)]: &quot; --log-level 7
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; and not by these after:
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; -A INPUT -j LOG --log-prefix &quot;IP[IN]: &quot; --log-level 7
</I>&gt;<i> &gt;&gt; -A FORWARD -j LOG --log-prefix &quot;IP[FWD]: &quot; --log-level 7
</I>&gt;<i> &gt;&gt; -A OUTPUT -j LOG --log-prefix &quot;IP[OUT]: &quot; --log-level 7
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Note that any packets caught by the first rules will *also* be caught by
</I>&gt;<i> &gt; the second rules (since there is no DROP in between, and the second rule
</I>&gt;<i> &gt; does not exclude INVALID),
</I>&gt;<i> 
</I>&gt;<i> how would I exclude INVALID in the second rules?
</I>
If you really want to:

-A INPUT -m state ! --state INVALID -j LOG  --log-prefix....

Depending on how you enter this rule, you may need to shell-escape the ! so 
that it doesn't get interpreted by bash etc.

The alternative (IMHO uglier) way of doing it would be:

-A INPUT -m state --state NEW,ESTABLISHED,RELATED -j LOG --log-prefix....


Quoting from the iptables man page:

&quot;   state
       This module, when combined with connection tracking, allows access to 
the connection tracking state for this packet.

       [!] --state state
              Where state is a comma separated list of the connection states 
to match.  Possible states are INVALID meaning that the packet could not be 
identified for some reason which includes running out of memory and ICMP errors 
which don't correspond to any known connection, ESTABLISHED meaning that the 
packet is associated  with  a  connection which  has  seen packets in both 
directions, NEW meaning that the packet has started a new connection, or 
otherwise associated with a connection which has not seen packets in both 
directions, and RELATED meaning that the packet is starting a new connection, 
but is associated with an existing connection, such as an FTP data transfer, 
or an ICMP error.  UNTRACKED meaning that the packet is not tracked at all, 
which happens if you use the NOTRACK target in raw table.&quot;


Antony.

-- 
This email was created using 100% recycled electrons.

                                                   Please reply to the list;
                                                         please *don't* CC me.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015971.html">[squid-users] Packets logged as blocked even Firewall (IPtables) accepts them ...
</A></li>
	<LI>Next message (by thread): <A HREF="015983.html">[squid-users] Packets logged as blocked even Firewall	(IPtables)	accepts them ...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15973">[ date ]</a>
              <a href="thread.html#15973">[ thread ]</a>
              <a href="subject.html#15973">[ subject ]</a>
              <a href="author.html#15973">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
