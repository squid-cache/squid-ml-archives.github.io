<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] debugging ssl-bump
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20debugging%20ssl-bump&In-Reply-To=%3Ccfda3eac-18bb-df88-5510-b0ac434c9240%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015961.html">
   <LINK REL="Next"  HREF="015972.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] debugging ssl-bump</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20debugging%20ssl-bump&In-Reply-To=%3Ccfda3eac-18bb-df88-5510-b0ac434c9240%40treenet.co.nz%3E"
       TITLE="[squid-users] debugging ssl-bump">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Jul 20 01:40:26 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015961.html">[squid-users] debugging ssl-bump
</A></li>
        <LI>Next message (by thread): <A HREF="015972.html">[squid-users] Squid-5 ETA?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15999">[ date ]</a>
              <a href="thread.html#15999">[ thread ]</a>
              <a href="subject.html#15999">[ subject ]</a>
              <a href="author.html#15999">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 19/07/17 05:02, Marcus Kool wrote:
&gt;<i> 
</I>&gt;<i> I am trying to debug ssl-bump and am looking specifically for decisions 
</I>&gt;<i> that Squid takes with regard to bumping, splicing and unsupported protocol.
</I>&gt;<i> 
</I>&gt;<i> The config file for Squid 4.0.21 has
</I>&gt;<i> 
</I>&gt;<i> debug_options ALL,1 33,9 83,9
</I>&gt;<i> 
</I>
Section 28 is probably where you want to look for the splice detail 
since it is an access control action decision point.

There are a few TLS details going to 81, but mostly for server connections.

You may also want to include the TCP level I/O details in section 5 if 
the section 83 OpenSSL BIO is not enough.

And the 11,2 trace of when HTTP(S) messages are arriving can be useful 
to trace when and what Squid is managing to decrypt.

And section 26 for CONNECT tunnel handling. Which may show when/how 
splice or on_unsupported_protocol are being handled.

Amos



&gt;<i> http_port 10.10.10.1:3230        ssl-bump ...
</I>&gt;<i> 
</I>&gt;<i> acl tls_is_skype ssl::server_name 
</I>&gt;<i> &quot;/var/ufdbguard/blacklists/chat/skype/iplist&quot;
</I>&gt;<i> acl tls_is_skype ssl::server_name .skype.com
</I>&gt;<i> acl tls_allowed_hsts ssl::server_name www.google.com
</I>&gt;<i> acl tls_urlfilterdb ssl::server_name www.urlfilterdb.com
</I>&gt;<i> acl tls_server_is_bank ssl::server_name .abnamro.nl
</I>&gt;<i> acl tls_server_is_bank ssl::server_name .abnamro.com
</I>&gt;<i> acl tls_to_splice any-of tls_allowed_hsts tls_urlfilterdb 
</I>&gt;<i> tls_server_is_bank tls_is_skype
</I>&gt;<i> 
</I>&gt;<i> ssl_bump splice tls_to_splice
</I>&gt;<i> ssl_bump stare  all
</I>&gt;<i> ssl_bump bump   all
</I>&gt;<i> 
</I>&gt;<i> on_unsupported_protocol tunnel all
</I>&gt;<i> 
</I>&gt;<i> But I fail to see in cache.log anything that gives a clue about
</I>&gt;<i> - squid decided to splice
</I>&gt;<i> - squid decided to bump
</I>&gt;<i> - squid decided to treat a connection as &quot;unsupported protocol&quot;.
</I>&gt;<i> 
</I>&gt;<i> Are there other debug sections than 33 and 83 that need an increased 
</I>&gt;<i> debug level ?
</I>&gt;<i> what strings do I have to look for in cache.log to understand the above 
</I>&gt;<i> decisions that Squid takes ?
</I>
The regular ACL checklist and results I think for that particular 
tracing. The TLS parser and bumping logic is not all debug traced due to 
performance-first reasons. Where debugs exist it is usually at a 
problem/error handling code path initiation.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015961.html">[squid-users] debugging ssl-bump
</A></li>
	<LI>Next message (by thread): <A HREF="015972.html">[squid-users] Squid-5 ETA?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15999">[ date ]</a>
              <a href="thread.html#15999">[ thread ]</a>
              <a href="subject.html#15999">[ subject ]</a>
              <a href="author.html#15999">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
