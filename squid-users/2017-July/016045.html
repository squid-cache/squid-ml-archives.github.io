<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Kerberos access denied and reauthentication
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Kerberos%20access%20denied%20and%20reauthentication&In-Reply-To=%3C1501144027034-4683224.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016061.html">
   <LINK REL="Next"  HREF="016046.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Kerberos access denied and reauthentication</H1>
    <B>Grey</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Kerberos%20access%20denied%20and%20reauthentication&In-Reply-To=%3C1501144027034-4683224.post%40n4.nabble.com%3E"
       TITLE="[squid-users] Kerberos access denied and reauthentication">wehategrey at gmail.com
       </A><BR>
    <I>Thu Jul 27 08:27:07 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016061.html">[squid-users] SSL options on different http_port resolving into a single config for all ports
</A></li>
        <LI>Next message (by thread): <A HREF="016046.html">[squid-users] Kerberos access denied and reauthentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16045">[ date ]</a>
              <a href="thread.html#16045">[ thread ]</a>
              <a href="subject.html#16045">[ subject ]</a>
              <a href="author.html#16045">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,
I'm trying to setup a proxy server using Squid 3.5.23 on Debian 9; I've
successfully setup Kerberos authentication generating the keytab file with
ktutil and manually setting the required SPN on my Windows domain
controller.
The problem I'm encountering is that sometimes (right now I'm the only one
using this proxy and it happens a couple times every day at random times)
while visiting random sites an authentication prompt appears asking for
credentials. Hitting Ok makes the prompt reappear and leads to a loop, while
hitting the cancel button makes the prompt go away and the page display an
error saying &quot;Access denied. Authentication required.&quot; (white page with
black font; I'm not 100% sure that's the exact message, I'll come back and
update it as soon as it happens again); refreshing the page lets it load
normally and then everything works ok.

I'm posting the relevant configuration hoping that someone can help me or at
least point me in the right direction. Keep in mind that right now basic
authentication is disabled for testing sake, I'll later enable it when I've
worked out where the problem with Kerberos is.

###

auth_param negotiate program /usr/lib/squid/negotiate_kerberos_auth -r
auth_param negotiate children 150
auth_param negotiate keep_alive off

acl whitelist dstdomain &quot;/etc/squid/whitelist&quot;
acl blacklist dstdomain &quot;/etc/squid/blacklist&quot;

acl AUTH proxy_auth REQUIRED
http_access deny !AUTH all

http_access deny !Safe_ports all
http_access deny CONNECT !SSL_ports all
http_access allow localhost manager
http_access deny manager all
http_access allow localhost all

acl destsquid dstdomain .squid1 .squid2
http_access allow destsquid all

http_access allow whitelist all
http_access deny blacklist all
acl test_account proxy_auth test_account
http_access allow test_account all
http_access deny all



--
View this message in context: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Kerberos-access-denied-and-reauthentication-tp4683224.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Kerberos-access-denied-and-reauthentication-tp4683224.html</A>
Sent from the Squid - Users mailing list archive at Nabble.com.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016061.html">[squid-users] SSL options on different http_port resolving into a single config for all ports
</A></li>
	<LI>Next message (by thread): <A HREF="016046.html">[squid-users] Kerberos access denied and reauthentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16045">[ date ]</a>
              <a href="thread.html#16045">[ thread ]</a>
              <a href="subject.html#16045">[ subject ]</a>
              <a href="author.html#16045">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
