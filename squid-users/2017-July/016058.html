<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSL options on different http_port resolving into a single config for all ports
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20options%20on%20different%20http_port%20resolving%20into%0A%20a%20single%20config%20for%20all%20ports&In-Reply-To=%3CCY4PR16MB168858038D565606B7726BF6E1B20%40CY4PR16MB1688.namprd16.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016052.html">
   <LINK REL="Next"  HREF="016061.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSL options on different http_port resolving into a single config for all ports</H1>
    <B>Wahaj Ali</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20options%20on%20different%20http_port%20resolving%20into%0A%20a%20single%20config%20for%20all%20ports&In-Reply-To=%3CCY4PR16MB168858038D565606B7726BF6E1B20%40CY4PR16MB1688.namprd16.prod.outlook.com%3E"
       TITLE="[squid-users] SSL options on different http_port resolving into a single config for all ports">Wahaj_Ali at symantec.com
       </A><BR>
    <I>Mon Jul 31 07:27:44 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016052.html">[squid-users] SSL options on different http_port resolving into a single config for all ports
</A></li>
        <LI>Next message (by thread): <A HREF="016061.html">[squid-users] SSL options on different http_port resolving into a single config for all ports
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16058">[ date ]</a>
              <a href="thread.html#16058">[ thread ]</a>
              <a href="subject.html#16058">[ subject ]</a>
              <a href="author.html#16058">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for the reply, Amos. A few follow up questions:

1) Setting dynamic_cert_mem_cache_size=0 does solve the issue. However, I fail to understand why caching the cert allows the connection to continue on SSLv3, on a port that I've disabled it. Isn't cert exchange done after the protocol has been selected. I don't think curl is rejecting the cert, but rather the ssl connection fails to establish before the cert exchange, since I also tried with the following command, which ignores cert errors:

curl -k -vv -x <A HREF="https://127.0.0.1:3128">https://127.0.0.1:3128</A> <A HREF="https://uatmail02.cimb.com">https://uatmail02.cimb.com</A> -ssl3


<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at madmin-VirtualBox</A>:/home/madmin/# curl -k -vv -x <A HREF="https://127.0.0.1:3128">https://127.0.0.1:3128</A> <A HREF="https://uatmail02.cimb.com">https://uatmail02.cimb.com</A> -ssl3
* About to connect() to proxy 127.0.0.1 port 3128 (#0)
*   Trying 127.0.0.1... connected
* Establish HTTP proxy tunnel to uatmail02.cimb.com:443
&gt;<i> CONNECT uatmail02.cimb.com:443 HTTP/1.1
</I>&gt;<i> Host: uatmail02.cimb.com:443
</I>&gt;<i> User-Agent: curl/7.22.0 (x86_64-pc-linux-gnu) libcurl/7.22.0 OpenSSL/1.0.1 zlib/1.2.3.4 libidn/1.23 librtmp/2.3
</I>&gt;<i> Proxy-Connection: Keep-Alive
</I>&gt;<i>
</I>&lt; HTTP/1.1 200 Connection established
&lt;
* Proxy replied OK to CONNECT request
* successfully set certificate verify locations:
*   CAfile: none
  CApath: /etc/ssl/certs
* SSLv3, TLS handshake, Client hello (1):
* SSLv3, TLS alert, Server hello (2):
* error:14094410:SSL routines:SSL3_READ_BYTES:sslv3 alert handshake failure
* Closing connection #0


2) You mentioned &quot;leaving port 443 for encrypted connections&quot;, can you please elaborate on why it might be problematic to use &quot;http_port&quot; directive - i.e. have both plain-text and SSL connections?


Thanks.

________________________________
From: Wahaj Ali
Sent: Thursday, July 27, 2017 12:57:14 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: SSL options on different http_port resolving into a single config for all ports


Resending the logs as they were not formatted correctly:


First request going to port 3128
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at madmin-VirtualBox</A>:/home/madmin# export https_proxy=&quot;127.0.0.1:3128&quot;
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at madmin-VirtualBox</A>:/home/madmin# curl -v <A HREF="https://uatmail02.cimb.com">https://uatmail02.cimb.com</A> -ssl3
* About to connect() to proxy 127.0.0.1 port 3128 (#0)
*   Trying 127.0.0.1... connected
* Establish HTTP proxy tunnel to uatmail02.cimb.com:443
&gt;<i> CONNECT uatmail02.cimb.com:443 HTTP/1.1
</I>&gt;<i> Host: uatmail02.cimb.com:443
</I>&gt;<i> User-Agent: curl/7.22.0 (x86_64-pc-linux-gnu) libcurl/7.22.0 OpenSSL/1.0.1 zlib/1.2.3.4 libidn/1.23 librtmp/2.3
</I>&gt;<i> Proxy-Connection: Keep-Alive
</I>&gt;<i>
</I>&lt; HTTP/1.1 200 Connection established
&lt;
* Proxy replied OK to CONNECT request
* successfully set certificate verify locations:
*   CAfile: none
  CApath: /etc/ssl/certs
* SSLv3, TLS handshake, Client hello (1):
* SSLv3, TLS alert, Server hello (2):
* error:14094410:SSL routines:SSL3_READ_BYTES:sslv3 alert handshake failure
* Closing connection #0

Now hit port 443:

<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at madmin-VirtualBox</A>:/home/madmin# export https_proxy=&quot;127.0.0.1:443&quot;
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at madmin-VirtualBox</A>:/home/madmin# curl -v <A HREF="https://uatmail02.cimb.com">https://uatmail02.cimb.com</A> -ssl3
* About to connect() to proxy 127.0.0.1 port 443 (#0)
*   Trying 127.0.0.1... connected
* Establish HTTP proxy tunnel to uatmail02.cimb.com:443
&gt;<i> CONNECT uatmail02.cimb.com:443 HTTP/1.1
</I>&gt;<i> Host: uatmail02.cimb.com:443
</I>&gt;<i> User-Agent: curl/7.22.0 (x86_64-pc-linux-gnu) libcurl/7.22.0 OpenSSL/1.0.1 zlib/1.2.3.4 libidn/1.23 librtmp/2.3
</I>&gt;<i> Proxy-Connection: Keep-Alive
</I>&gt;<i>
</I>&lt; HTTP/1.1 200 Connection established
&lt;
* Proxy replied OK to CONNECT request
* successfully set certificate verify locations:
*   CAfile: none
  CApath: /etc/ssl/certs
* SSLv3, TLS handshake, Client hello (1):
* SSLv3, TLS alert, Server hello (2):
* error:14094410:SSL routines:SSL3_READ_BYTES:sslv3 alert handshake failure
* Closing connection #0

Restart squid, then send first request on port 443 (which has ssl3 enabled):

<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at madmin-VirtualBox</A>:/home/madmin# export https_proxy=&quot;127.0.0.1:443&quot;
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at madmin-VirtualBox</A>:/home/madmin# curl -v <A HREF="https://uatmail02.cimb.com">https://uatmail02.cimb.com</A> -ssl3
* About to connect() to proxy 127.0.0.1 port 443 (#0)
*   Trying 127.0.0.1... connected
* Establish HTTP proxy tunnel to uatmail02.cimb.com:443
&gt;<i> CONNECT uatmail02.cimb.com:443 HTTP/1.1
</I>&gt;<i> Host: uatmail02.cimb.com:443
</I>&gt;<i> User-Agent: curl/7.22.0 (x86_64-pc-linux-gnu) libcurl/7.22.0 OpenSSL/1.0.1 zlib/1.2.3.4 libidn/1.23 librtmp/2.3
</I>&gt;<i> Proxy-Connection: Keep-Alive
</I>&gt;<i>
</I>&lt; HTTP/1.1 200 Connection established
&lt;
* Proxy replied OK to CONNECT request
* successfully set certificate verify locations:
*   CAfile: none
  CApath: /etc/ssl/certs
* SSLv3, TLS handshake, Client hello (1):
* SSLv3, TLS handshake, Server hello (2):
* SSLv3, TLS handshake, CERT (11):
* SSLv3, TLS handshake, Server key exchange (12):
* SSLv3, TLS handshake, Server finished (14):
* SSLv3, TLS handshake, Client key exchange (16):
* SSLv3, TLS change cipher, Client hello (1):
* SSLv3, TLS handshake, Finished (20):
* SSLv3, TLS change cipher, Client hello (1):
* SSLv3, TLS handshake, Finished (20):
* SSL connection using ECDHE-RSA-AES256-SHA
* Server certificate:
* subject: C=MY; ST=CIMB Bank Berhad ; L=Kuala Lumpur   ; OU=CIMB Bank Berhad; CN=uatmail02.cimb.com
* start date: 2017-07-03 09:00:37 GMT
* expire date: 2019-07-04 09:00:37 GMT
* common name: uatmail02.cimb.com (matched)
* issuer: C=US; ST=California; L=San Jose; O=Elastica Inc; OU=Development; emailAddress=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">service-engineering at elastica.co</A>; CN=Elastica
* SSL certificate verify ok.
&gt;<i> GET / HTTP/1.1
</I>&gt;<i> User-Agent: curl/7.22.0 (x86_64-pc-linux-gnu) libcurl/7.22.0 OpenSSL/1.0.1 zlib/1.2.3.4 libidn/1.23 librtmp/2.3
</I>&gt;<i> Host: uatmail02.cimb.com
</I>&gt;<i> Accept: */*
</I>&gt;<i>
</I>&lt; HTTP/1.1 302 Found
&lt; Date: Wed, 26 Jul 2017 10:12:48 GMT
&lt; Location: <A HREF="http://127.0.0.1:7999/gateway_auth/?__eln__=1468917241090744452&amp;elastica_relay=https%3A%2F%2Fuatmail02.cimb.com%2F">http://127.0.0.1:7999/gateway_auth/?__eln__=1468917241090744452&amp;elastica_relay=https%3A%2F%2Fuatmail02.cimb.com%2F</A>
&lt; Server: elastica-gateway-service/v1.0
&lt; Connection: close
&lt;
* SSLv3, TLS alert, Client hello (1):
* Closing connection #0
* SSLv3, TLS alert, Client hello (1):

Now send the same request on port 3128, which has ssl3 disabled:

<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at madmin-VirtualBox</A>:/home/madmin# export https_proxy=&quot;127.0.0.1:3128&quot;
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at madmin-VirtualBox</A>:/home/madmin# curl -v <A HREF="https://uatmail02.cimb.com">https://uatmail02.cimb.com</A> -ssl3
* About to connect() to proxy 127.0.0.1 port 3128 (#0)
*   Trying 127.0.0.1... connected
* Establish HTTP proxy tunnel to uatmail02.cimb.com:443
&gt;<i> CONNECT uatmail02.cimb.com:443 HTTP/1.1
</I>&gt;<i> Host: uatmail02.cimb.com:443
</I>&gt;<i> User-Agent: curl/7.22.0 (x86_64-pc-linux-gnu) libcurl/7.22.0 OpenSSL/1.0.1 zlib/1.2.3.4 libidn/1.23 librtmp/2.3
</I>&gt;<i> Proxy-Connection: Keep-Alive
</I>&gt;<i>
</I>&lt; HTTP/1.1 200 Connection established
&lt;
* Proxy replied OK to CONNECT request
* successfully set certificate verify locations:
*   CAfile: none
  CApath: /etc/ssl/certs
* SSLv3, TLS handshake, Client hello (1):
* SSLv3, TLS handshake, Server hello (2):
* SSLv3, TLS handshake, CERT (11):
* SSLv3, TLS handshake, Server key exchange (12):
* SSLv3, TLS handshake, Server finished (14):
* SSLv3, TLS handshake, Client key exchange (16):
* SSLv3, TLS change cipher, Client hello (1):
* SSLv3, TLS handshake, Finished (20):
* SSLv3, TLS change cipher, Client hello (1):
* SSLv3, TLS handshake, Finished (20):
* SSL connection using ECDHE-RSA-AES256-SHA
* Server certificate:
* subject: C=MY; ST=CIMB Bank Berhad ; L=Kuala Lumpur   ; OU=CIMB Bank Berhad; CN=uatmail02.cimb.com
* start date: 2017-07-03 09:00:37 GMT
* expire date: 2019-07-04 09:00:37 GMT
* common name: uatmail02.cimb.com (matched)
* issuer: C=US; ST=California; L=San Jose; O=Elastica Inc; OU=Development; emailAddress=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">service-engineering at elastica.co</A>; CN=Elastica
* SSL certificate verify ok.
&gt;<i> GET / HTTP/1.1
</I>&gt;<i> User-Agent: curl/7.22.0 (x86_64-pc-linux-gnu) libcurl/7.22.0 OpenSSL/1.0.1 zlib/1.2.3.4 libidn/1.23 librtmp/2.3
</I>&gt;<i> Host: uatmail02.cimb.com
</I>&gt;<i> Accept: */*
</I>&gt;<i>
</I>&lt; HTTP/1.1 302 Found
&lt; Date: Wed, 26 Jul 2017 10:12:58 GMT
&lt; Location: <A HREF="http://127.0.0.1:7999/gateway_auth/?__eln__=2303332476459826439&amp;elastica_relay=https%3A%2F%2Fuatmail02.cimb.com%2F">http://127.0.0.1:7999/gateway_auth/?__eln__=2303332476459826439&amp;elastica_relay=https%3A%2F%2Fuatmail02.cimb.com%2F</A>
&lt; Server: elastica-gateway-service/v1.0
&lt; Connection: close
&lt;
* SSLv3, TLS alert, Client hello (1):
* Closing connection #0
* SSLv3, TLS alert, Client hello (1):


________________________________
From: Wahaj Ali
Sent: Thursday, July 27, 2017 12:51:57 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: SSL options on different http_port resolving into a single config for all ports


With squid 3.5.25, I have two http_port configs, on one of which I want to disable SSLv3 while leaving it enabled on the other. Here is part of that config:

http_port 3128 ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB cert=/home/madmin/certs/elastica-ca.pem key=/home/madmin/certs/ca.key cipher=ALL:!DES-CBC-SHA:!EXP-DES-CBC-SHA:!EXP-RC4-MD5:!EXP-RC2-CBC-MD5:@STRENGTH options=NO_SSLv2,NO_SSLv3,SINGLE_ECDH_USE tls-dh=prime256v1:/etc/ssl/private/el-dhparams.pem

http_port 443 ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB cert=/home/madmin/certs/elastica-ca.pem key=/home/madmin/certs/ca.key cipher=ALL:!DES-CBC-SHA:!EXP-DES-CBC-SHA:!EXP-RC4-MD5:!EXP-RC2-CBC-MD5:@STRENGTH options=SINGLE_ECDH_USE tls-dh=prime256v1:/etc/ssl/private/el-dhparams.pem

If I first proxy my traffic to port 443, it seems to apply the port 443 config on all other ports from here on. On the other hand if my first request goes through port 3128, then squid sets whatever SSL version is supported on 3128 for all the other ports as well.

First request going to port 3128
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at madmin-VirtualBox</A>:/home/madmin# export https_proxy=&quot;127.0.0.1:3128&lt;<A HREF="http://127.0.0.1:3128/">http://127.0.0.1:3128/</A>&gt;&quot; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at madmin-VirtualBox</A>:/home/madmin# curl -v <A HREF="https://uatmail02.cimb.com&lt;https://uatmail02.cimb.com/">https://uatmail02.cimb.com&lt;https://uatmail02.cimb.com/</A>&gt; -ssl3 * About to connect() to proxy 127.0.0.1 port 3128 (#0) * Trying 127.0.0.1... connected * Establish HTTP proxy tunnel to uatmail02.cimb.com:443&lt;<A HREF="http://uatmail02.cimb.com:443/">http://uatmail02.cimb.com:443/</A>&gt; &gt; CONNECT uatmail02.cimb.com:443&lt;<A HREF="http://uatmail02.cimb.com:443/">http://uatmail02.cimb.com:443/</A>&gt; HTTP/1.1 &gt; Host: uatmail02.cimb.com:443&lt;<A HREF="http://uatmail02.cimb.com:443/">http://uatmail02.cimb.com:443/</A>&gt; &gt; User-Agent: curl/7.22.0 (x86_64-pc-linux-gnu) libcurl/7.22.0 OpenSSL/1.0.1 zlib/1.2.3.4&lt;<A HREF="http://1.2.3.4/">http://1.2.3.4/</A>&gt; libidn/1.23 librtmp/2.3 &gt; Proxy-Connection: Keep-Alive &gt; &lt; HTTP/1.1 200 Connection established &lt; * Proxy replied OK to CONNECT request * successfully set certificate verify locations: * CAfile: none CApath: /etc/ssl/certs * SSLv3, TLS handshake, Client hello (1): * SSLv3, TLS alert, Server hello (2): * error:14094410:SSL routines:SSL3_READ_BYTES:sslv3 alert handshake failure * Closing connection #0 * <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at madmin-VirtualBox</A>:/home/madmin# export https_proxy=&quot;127.0.0.1:443&lt;<A HREF="http://127.0.0.1:443/">http://127.0.0.1:443/</A>&gt;&quot; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at madmin-VirtualBox</A>:/home/madmin# curl -v <A HREF="https://uatmail02.cimb.com&lt;https://uatmail02.cimb.com/">https://uatmail02.cimb.com&lt;https://uatmail02.cimb.com/</A>&gt; -ssl3 * About to connect() to proxy 127.0.0.1 port 443 (#0) * Trying 127.0.0.1... connected * Establish HTTP proxy tunnel to uatmail02.cimb.com:443&lt;<A HREF="http://uatmail02.cimb.com:443/">http://uatmail02.cimb.com:443/</A>&gt; &gt; CONNECT uatmail02.cimb.com:443&lt;<A HREF="http://uatmail02.cimb.com:443/">http://uatmail02.cimb.com:443/</A>&gt; HTTP/1.1 &gt; Host: uatmail02.cimb.com:443&lt;<A HREF="http://uatmail02.cimb.com:443/">http://uatmail02.cimb.com:443/</A>&gt; &gt; User-Agent: curl/7.22.0 (x86_64-pc-linux-gnu) libcurl/7.22.0 OpenSSL/1.0.1 zlib/1.2.3.4&lt;<A HREF="http://1.2.3.4/">http://1.2.3.4/</A>&gt; libidn/1.23 librtmp/2.3 &gt; Proxy-Connection: Keep-Alive &gt; &lt; HTTP/1.1 200 Connection established &lt; * Proxy replied OK to CONNECT request * successfully set certificate verify locations: * CAfile: none CApath: /etc/ssl/certs * SSLv3, TLS handshake, Client hello (1): * SSLv3, TLS alert, Server hello (2): * error:14094410:SSL routines:SSL3_READ_BYTES:sslv3 alert handshake failure * Closing connection #0

First request hitting 443:
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at madmin-VirtualBox</A>:/home/madmin# export https_proxy=&quot;127.0.0.1:443&lt;<A HREF="http://127.0.0.1:443/">http://127.0.0.1:443/</A>&gt;&quot; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at madmin-VirtualBox</A>:/home/madmin# curl -v <A HREF="https://uatmail02.cimb.com&lt;https://uatmail02.cimb.com/">https://uatmail02.cimb.com&lt;https://uatmail02.cimb.com/</A>&gt; -ssl3 * About to connect() to proxy 127.0.0.1 port 443 (#0) * Trying 127.0.0.1... connected * Establish HTTP proxy tunnel to uatmail02.cimb.com:443&lt;<A HREF="http://uatmail02.cimb.com:443/">http://uatmail02.cimb.com:443/</A>&gt; &gt; CONNECT uatmail02.cimb.com:443&lt;<A HREF="http://uatmail02.cimb.com:443/">http://uatmail02.cimb.com:443/</A>&gt; HTTP/1.1 &gt; Host: uatmail02.cimb.com:443&lt;<A HREF="http://uatmail02.cimb.com:443/">http://uatmail02.cimb.com:443/</A>&gt; &gt; User-Agent: curl/7.22.0 (x86_64-pc-linux-gnu) libcurl/7.22.0 OpenSSL/1.0.1 zlib/1.2.3.4&lt;<A HREF="http://1.2.3.4/">http://1.2.3.4/</A>&gt; libidn/1.23 librtmp/2.3 &gt; Proxy-Connection: Keep-Alive &gt; &lt; HTTP/1.1 200 Connection established &lt; * Proxy replied OK to CONNECT request * successfully set certificate verify locations: * CAfile: none CApath: /etc/ssl/certs * SSLv3, TLS handshake, Client hello (1): * SSLv3, TLS handshake, Server hello (2): * SSLv3, TLS handshake, CERT (11): * SSLv3, TLS handshake, Server key exchange (12): * SSLv3, TLS handshake, Server finished (14): * SSLv3, TLS handshake, Client key exchange (16): * SSLv3, TLS change cipher, Client hello (1): * SSLv3, TLS handshake, Finished (20): * SSLv3, TLS change cipher, Client hello (1): * SSLv3, TLS handshake, Finished (20): * SSL connection using ECDHE-RSA-AES256-SHA * Server certificate: * subject: C=MY; ST=CIMB Bank Berhad ; L=Kuala Lumpur ; OU=CIMB Bank Berhad; CN=uatmail02.cimb.com&lt;<A HREF="http://uatmail02.cimb.com/">http://uatmail02.cimb.com/</A>&gt; * start date: 2017-07-03 09:00:37 GMT * expire date: 2019-07-04 09:00:37 GMT * common name: uatmail02.cimb.com&lt;<A HREF="http://uatmail02.cimb.com/">http://uatmail02.cimb.com/</A>&gt; (matched) * issuer: C=US; ST=California; L=San Jose; O=Elastica Inc; OU=Development; emailAddress=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">service-engineering at elastica.co</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">service-engineering at elastica.co</A>&gt;; CN=Elastica * SSL certificate verify ok. &gt; GET / HTTP/1.1 &gt; User-Agent: curl/7.22.0 (x86_64-pc-linux-gnu) libcurl/7.22.0 OpenSSL/1.0.1 zlib/1.2.3.4&lt;<A HREF="http://1.2.3.4/">http://1.2.3.4/</A>&gt; libidn/1.23 librtmp/2.3 &gt; Host: uatmail02.cimb.com&lt;<A HREF="http://uatmail02.cimb.com/">http://uatmail02.cimb.com/</A>&gt; &gt; Accept: */* &gt; &lt; HTTP/1.1 302 Found &lt; Date: Wed, 26 Jul 2017 10:12:48 GMT &lt; Location: <A HREF="http://127.0.0.1:7999/gateway_auth/?__eln__=1468917241090744452&amp;elastica_relay=https%3A%2F%2Fuatmail02.cimb.com%2F">http://127.0.0.1:7999/gateway_auth/?__eln__=1468917241090744452&amp;elastica_relay=https%3A%2F%2Fuatmail02.cimb.com%2F</A> &lt; Server: elastica-gateway-service/v1.0 &lt; Connection: close &lt; * SSLv3, TLS alert, Client hello (1): * Closing connection #0 * SSLv3, TLS alert, Client hello (1): <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at madmin-VirtualBox</A>:/home/madmin# <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at madmin-VirtualBox</A>:/home/madmin# <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at madmin-VirtualBox</A>:/home/madmin# export https_proxy=&quot;127.0.0.1:3128&lt;<A HREF="http://127.0.0.1:3128/">http://127.0.0.1:3128/</A>&gt;&quot; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at madmin-VirtualBox</A>:/home/madmin# curl -v <A HREF="https://uatmail02.cimb.com&lt;https://uatmail02.cimb.com/">https://uatmail02.cimb.com&lt;https://uatmail02.cimb.com/</A>&gt; -ssl3 * About to connect() to proxy 127.0.0.1 port 3128 (#0) * Trying 127.0.0.1... connected * Establish HTTP proxy tunnel to uatmail02.cimb.com:443&lt;<A HREF="http://uatmail02.cimb.com:443/">http://uatmail02.cimb.com:443/</A>&gt; &gt; CONNECT uatmail02.cimb.com:443&lt;<A HREF="http://uatmail02.cimb.com:443/">http://uatmail02.cimb.com:443/</A>&gt; HTTP/1.1 &gt; Host: uatmail02.cimb.com:443&lt;<A HREF="http://uatmail02.cimb.com:443/">http://uatmail02.cimb.com:443/</A>&gt; &gt; User-Agent: curl/7.22.0 (x86_64-pc-linux-gnu) libcurl/7.22.0 OpenSSL/1.0.1 zlib/1.2.3.4&lt;<A HREF="http://1.2.3.4/">http://1.2.3.4/</A>&gt; libidn/1.23 librtmp/2.3 &gt; Proxy-Connection: Keep-Alive &gt; &lt; HTTP/1.1 200 Connection established &lt; * Proxy replied OK to CONNECT request * successfully set certificate verify locations: * CAfile: none CApath: /etc/ssl/certs * SSLv3, TLS handshake, Client hello (1): * SSLv3, TLS handshake, Server hello (2): * SSLv3, TLS handshake, CERT (11): * SSLv3, TLS handshake, Server key exchange (12): * SSLv3, TLS handshake, Server finished (14): * SSLv3, TLS handshake, Client key exchange (16): * SSLv3, TLS change cipher, Client hello (1): * SSLv3, TLS handshake, Finished (20): * SSLv3, TLS change cipher, Client hello (1): * SSLv3, TLS handshake, Finished (20): * SSL connection using ECDHE-RSA-AES256-SHA * Server certificate: * subject: C=MY; ST=CIMB Bank Berhad ; L=Kuala Lumpur ; OU=CIMB Bank Berhad; CN=uatmail02.cimb.com&lt;<A HREF="http://uatmail02.cimb.com/">http://uatmail02.cimb.com/</A>&gt; * start date: 2017-07-03 09:00:37 GMT * expire date: 2019-07-04 09:00:37 GMT * common name: uatmail02.cimb.com&lt;<A HREF="http://uatmail02.cimb.com/">http://uatmail02.cimb.com/</A>&gt; (matched) * issuer: C=US; ST=California; L=San Jose; O=Elastica Inc; OU=Development; emailAddress=<A HREF="https://lists.squid-cache.org/listinfo/squid-users">service-engineering at elastica.co</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">service-engineering at elastica.co</A>&gt;; CN=Elastica * SSL certificate verify ok. &gt; GET / HTTP/1.1 &gt; User-Agent: curl/7.22.0 (x86_64-pc-linux-gnu) libcurl/7.22.0 OpenSSL/1.0.1 zlib/1.2.3.4&lt;<A HREF="http://1.2.3.4/">http://1.2.3.4/</A>&gt; libidn/1.23 librtmp/2.3 &gt; Host: uatmail02.cimb.com&lt;<A HREF="http://uatmail02.cimb.com/">http://uatmail02.cimb.com/</A>&gt; &gt; Accept: */* &gt; &lt; HTTP/1.1 302 Found &lt; Date: Wed, 26 Jul 2017 10:12:58 GMT &lt; Location: <A HREF="http://127.0.0.1:7999/gateway_auth/?__eln__=2303332476459826439&amp;elastica_relay=https%3A%2F%2Fuatmail02.cimb.com%2F">http://127.0.0.1:7999/gateway_auth/?__eln__=2303332476459826439&amp;elastica_relay=https%3A%2F%2Fuatmail02.cimb.com%2F</A> &lt; Server: elastica-gateway-service/v1.0 &lt; Connection: close &lt; * SSLv3, TLS alert, Client hello (1): * Closing connection #0 * SSLv3, TLS alert, Client hello (1):


In the first case, SSLv3 fails on both ports, while in the second it works for both. My expectation was that I can configure the ports independently to use different SSL versions. Wonder if this is a bug?

Regards,

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170731/a4c0a67b/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170731/a4c0a67b/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016052.html">[squid-users] SSL options on different http_port resolving into a single config for all ports
</A></li>
	<LI>Next message (by thread): <A HREF="016061.html">[squid-users] SSL options on different http_port resolving into a single config for all ports
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16058">[ date ]</a>
              <a href="thread.html#16058">[ thread ]</a>
              <a href="subject.html#16058">[ subject ]</a>
              <a href="author.html#16058">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
