<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] FW:  FW: squid proxy 3.5 redhat 7.3
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FW%3A%20%20FW%3A%20squid%20proxy%203.5%20redhat%207.3&In-Reply-To=%3Cc1c9c27f-2fa0-eba9-9dca-31698817fbde%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015545.html">
   <LINK REL="Next"  HREF="015517.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] FW:  FW: squid proxy 3.5 redhat 7.3</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FW%3A%20%20FW%3A%20squid%20proxy%203.5%20redhat%207.3&In-Reply-To=%3Cc1c9c27f-2fa0-eba9-9dca-31698817fbde%40measurement-factory.com%3E"
       TITLE="[squid-users] FW:  FW: squid proxy 3.5 redhat 7.3">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Jun  6 15:34:21 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015545.html">[squid-users] FW:  FW: squid proxy 3.5 redhat 7.3
</A></li>
        <LI>Next message (by thread): <A HREF="015517.html">[squid-users] Squid + Shibboleth/SAML Authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15550">[ date ]</a>
              <a href="thread.html#15550">[ thread ]</a>
              <a href="subject.html#15550">[ subject ]</a>
              <a href="author.html#15550">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 06/06/2017 08:22 AM, Madonna, A. (spir-it) wrote:

&gt;<i> Know issue 2012 squid proxy 3.2
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://www.squid-cache.org/Versions/v3/3.2/RELEASENOTES.html#ss1.1">http://www.squid-cache.org/Versions/v3/3.2/RELEASENOTES.html#ss1.1</A>
</I>&gt;<i> &#8226;SSL-Bump not re-wrapping decrypted traffic in CONNECT for peers.
</I>
&gt;<i> + 5 years ago this already  was a known issue. Apparently even after
</I>&gt;<i> + 5 years there is still proper solution. Can we expect anything
</I>&gt;<i> regarding this in the near future?
</I>
FWIW, I am not aware of anybody working on this problem. Going forward,
your options include those outlined at the following FAQ entry:

<A HREF="http://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F">http://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F</A>


&gt;<i> This person already describes the issue in his blog and  offers a solution although its not perfect. 
</I>
&gt;<i> <A HREF="https://www.mydlp.com/using-parent-proxy-ssl-bump-enabled-squid-3-2/">https://www.mydlp.com/using-parent-proxy-ssl-bump-enabled-squid-3-2/</A>
</I>
Yes, one can replace one problem with another. Or, to be more precise,
since we are apparently talking about going back to Squid v3.2, one can
replace one problem with a large bag of different problems. Pick your
poison.


&gt;<i> also it is still not clear to me if the traffic is encrypted again
</I>&gt;<i> after leaving the squid proxy when doing ssl bump when using a parent
</I>&gt;<i> proxy.
</I>
Bugs notwithstanding, the HTTPS traffic leaving moderns Squids is
encrypted. The workaround at the above link re-introduces an old bug
that allows Squid to emit decrypted traffic.

Alex.


&gt;<i> -----Oorspronkelijk bericht-----
</I>&gt;<i> Van: Alex Rousskov [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>] 
</I>&gt;<i> Verzonden: vrijdag 2 juni 2017 17:59
</I>&gt;<i> Aan: Madonna, A. (spir-it) &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">A.Madonna at rechtspraak.nl</A>&gt;; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Onderwerp: Re: [squid-users] FW: squid proxy 3.5 redhat 7.3
</I>&gt;<i> 
</I>&gt;<i> On 06/02/2017 01:37 AM, Madonna, A. (spir-it) wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> Clients -&gt; squid proxy -&gt; internet.
</I>&gt;&gt;<i> This works with the config as previously mentioned.
</I>&gt;<i> 
</I>&gt;<i> OK.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> Clients -&gt; squid proxy (with cache_peer) -&gt; Parent Proxy (not Squid) 
</I>&gt;&gt;<i> -&gt; internet Does not work.
</I>&gt;<i> 
</I>&gt;<i> Even for regular HTTP traffic and non-bumped HTTPS traffic? If that traffic does not work, then you have misconfigured something or the Parent Proxy is badly broken. There is nothing special in the above setup as far as regular traffic is concerned.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> However I've also setup the following:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Cleints -&gt; Squid Proxy (with cache_peer) -&gt; Parent Proxy (Squid Proxy) 
</I>&gt;&gt;<i> -&gt; internet
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This seems at least to work for http traffic, however, I don't see any HTTPS traffic coming into the Parent Proxy (Squid).
</I>&gt;<i> 
</I>&gt;<i> Squid does not know who made the parent proxy. The fact that one (presumably production-quality) proxy &quot;does not work&quot; and another &quot;seems to work&quot; implies that something is seriously misconfigured in one or both cases.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> Now this morning I will do some more tcpdumping to see where that traffic is going, but maybe you can already shed some light on this?
</I>&gt;<i> 
</I>&gt;<i> I cannot shed more light on problems described only as &quot;does not work&quot;
</I>&gt;<i> and &quot;no traffic&quot;.
</I>&gt;<i> 
</I>&gt;<i> Alex.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> -----Oorspronkelijk bericht-----
</I>&gt;&gt;<i> Van: Alex Rousskov [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>]
</I>&gt;&gt;<i> Verzonden: donderdag 1 juni 2017 18:49
</I>&gt;&gt;<i> Aan: Madonna, A. (spir-it) &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">A.Madonna at rechtspraak.nl</A>&gt;; 
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> Onderwerp: Re: [squid-users] squid proxy 3.5 redhat 7.3
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 06/01/2017 10:09 AM, Madonna, A. (spir-it) wrote:
</I>&gt;&gt;&gt;<i> can we use ssl_bump to intercept https traffic with a parent proxy (cache_peer).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> IIRC, you may be able to use limited SslBump features, but not the full SslBump functionality: Peeking or staring at the origin server through a cache_peer is not supported (yet).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> ssl_bump peek step1
</I>&gt;&gt;&gt;<i> cache_peer ... parent 8080 0 no-query no-netdb-exchange no-digest
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Bugs notwithstanding, the above combination should work because peeking at step1 does not require communication with a cache_peer and splicing at step2 should follow the regular (non-SslBump) tunneling path for CONNECTs, where modern Squids do support cache peers.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I recommend that you make everything work without a cache_peer and then add a cache_peer.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Alex.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ________________________________
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Informatie van de Raad voor de rechtspraak, de rechtbanken, de gerechtshoven en de bijzondere colleges vindt u op www.rechtspraak.nl.
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015545.html">[squid-users] FW:  FW: squid proxy 3.5 redhat 7.3
</A></li>
	<LI>Next message (by thread): <A HREF="015517.html">[squid-users] Squid + Shibboleth/SAML Authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15550">[ date ]</a>
              <a href="thread.html#15550">[ thread ]</a>
              <a href="subject.html#15550">[ subject ]</a>
              <a href="author.html#15550">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
