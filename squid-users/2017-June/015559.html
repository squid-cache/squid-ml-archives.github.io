<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Error while writing to TCP socket: Permission denied
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%3D%3Futf-8%3Fq%3FError_while_writing_to_TCP_socket%3D3A_Perm%3F%3D%0A%20%3D%3Futf-8%3Fq%3Fission_denied%3F%3D&In-Reply-To=%3C1496832886.263517883%40f227.i.mail.ru%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015589.html">
   <LINK REL="Next"  HREF="015564.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Error while writing to TCP socket: Permission denied</H1>
    <B>&#1048;&#1096;&#1072;&#1103;h&#1091; &#1051;&#1072;&#1089;&#1090;&#1086;&#1074;</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%3D%3Futf-8%3Fq%3FError_while_writing_to_TCP_socket%3D3A_Perm%3F%3D%0A%20%3D%3Futf-8%3Fq%3Fission_denied%3F%3D&In-Reply-To=%3C1496832886.263517883%40f227.i.mail.ru%3E"
       TITLE="[squid-users] Error while writing to TCP socket: Permission denied">ishayahu at mail.ru
       </A><BR>
    <I>Wed Jun  7 10:54:46 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015589.html">[squid-users] squid 3.5 ssl-bump intercept TCP_DENIED/200 on	bridge mode
</A></li>
        <LI>Next message (by thread): <A HREF="015564.html">[squid-users] Error while writing to TCP socket: Permission denied
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15559">[ date ]</a>
              <a href="thread.html#15559">[ thread ]</a>
              <a href="subject.html#15559">[ subject ]</a>
              <a href="author.html#15559">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
I use squid on freebsd 10.3. When I set proxy adress in web brouser, I can't attach files to mail on mail.ru. Whithout proxy it works. In access.log there are no errors. In cache.log I've got:
2017/05/29 21:12:16 kid1| local=217.151.68.36:34572 remote=217.69.139.216:443 FD 44 flags=1: read/write failure: (13) Permission denied
2017/05/29 21:12:16 kid1| local=217.151.68.36:36057 remote=217.69.139.216:443 FD 44 flags=1: read/write failure: (13) Permission denied
FD can change If I understand right, how to use lson, then
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at bkp_router</A>:/home/ishayahu # lsof -d44
COMMAND   PID  USER   FD   TYPE             DEVICE SIZE/OFF NODE NAME
squid   30197 squid   44u  IPv4 0xfffff80029788810      0t0  TCP broadband-68-36.clients.extel.ru:48387-&gt;e.mail.ru:https (ESTABLISHED)
broadband-68-36.clients.extel.ru is ISP's router
How can I solve that problem?
PS: settings like
#request_body_max_size 0
#reply_body_max_size 0
#request_header_max_size 64 KB
#reply_header_max_size 64 KB
#client_request_buffer_max_size 50 Mb
#acl post method POST
#http_access allow post localnet
doesn't help
#ktrace -d -p 667 kdump&gt;kdump.out
Searching in kdump.out for denied:
4529011-  6776 squid    GIO   fd 5 read 32 bytes
4529052-       0x0000 1b00 0000 0000 0000 feff 1000 0000 0000 400f 0000 0000 0000 0000 0000 0000 0000                 |<A HREF="https://lists.squid-cache.org/listinfo/squid-users">................ at ...............</A>|
4529197-
4529198-  6776 squid    RET   kevent 1
4529229-  6776 squid    CALL  write(0x1b,0x8057c3000,0x5b4)
4529281:  6776 squid    RET   write -1 errno 13 Permission denied
4529339-  6776 squid    CALL  write(0x4,0x802dbf000,0x88)
4529389-  6776 squid    GIO   fd 4 wrote 136 bytes
4529432:       &quot;2017/06/04 17:34:06 kid1| local=217.151.68.36:42442 remote=217.69.139.216:443 FD 27 flags=1: read/write failure: (13) Permission denied
4529576-       &quot;
4529585-  6776 squid    RET   write 136/0x88
4529622-  6776 squid    CALL  close(0x1b)
4529656-  6776 squid    RET   close 0
4529686-  6776 squid    CALL  close(0x19)
In kdump.out I see, that socekt was opened, was bunch of reading/writing to it, and without any seeing reason it ends with error.
Here socket opens:

<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at bkp_router</A>:/home/ishayahu # cat kdump.out | grep -b10 &quot;RET socket 27/0x1b&quot;
4534031-  6776 squid    GIO   fd 25 read 196 bytes
4534074-       &quot;CONNECT e.mail.ru:443 HTTP/1.1\r
4534115-        User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:55.0) Gecko/20100101 Firefox/55.0\r
4534204-        Proxy-Connection: keep-alive\r
4534236-        Connection: keep-alive\r
4534262-        Host: e.mail.ru:443\r
4534285-        \r
4534289-       &quot;
4534298-  6776 squid    RET   read 196/0xc4
4534334-  6776 squid    CALL  socket(PF_INET,SOCK_STREAM,IPPROTO_TCP)
4534396:  6776 squid    RET   socket 27/0x1b
4534433-  6776 squid    CALL  fcntl(0x1b,F_GETFD,0)
4534477-  6776 squid    RET   fcntl 0
4534507-  6776 squid    CALL  fcntl(0x1b,F_SETFD,FD_CLOEXEC)
4534560-  6776 squid    RET   fcntl 0
4534590-  6776 squid    CALL  fcntl(0x1b,F_GETFL,0)
4534634-  6776 squid    RET   fcntl 2
4534664-  6776 squid    CALL  fcntl(0x1b,F_SETFL,0x6&lt;O_RDWR|O_NONBLOCK&gt;)
4534729-  6776 squid    RET   fcntl 0
4534759-  6776 squid    CALL  setsockopt(0x1b,0x6,0x1,0x7fffffffe484,0x4)
4534825-  6776 squid    RET   setsockopt 0


-- 
&#1048;&#1096;&#1072;&#1103;h&#1091; &#1051;&#1072;&#1089;&#1090;&#1086;&#1074;

+7-906-772-88-86
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170607/c38c0cff/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170607/c38c0cff/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015589.html">[squid-users] squid 3.5 ssl-bump intercept TCP_DENIED/200 on	bridge mode
</A></li>
	<LI>Next message (by thread): <A HREF="015564.html">[squid-users] Error while writing to TCP socket: Permission denied
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15559">[ date ]</a>
              <a href="thread.html#15559">[ thread ]</a>
              <a href="subject.html#15559">[ subject ]</a>
              <a href="author.html#15559">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
