<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] client--&gt;iptables--&gt;squid-proxy-&gt;another-proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20client--%3Eiptables--%3Esquid-proxy-%3Eanother-proxy&In-Reply-To=%3C1497299585897-4682759.post%40n4.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015604.html">
   <LINK REL="Next"  HREF="015602.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] client--&gt;iptables--&gt;squid-proxy-&gt;another-proxy</H1>
    <B>JerylCook</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20client--%3Eiptables--%3Esquid-proxy-%3Eanother-proxy&In-Reply-To=%3C1497299585897-4682759.post%40n4.nabble.com%3E"
       TITLE="[squid-users] client--&gt;iptables--&gt;squid-proxy-&gt;another-proxy">ext.jcook at keywcorp.com
       </A><BR>
    <I>Mon Jun 12 20:33:05 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015604.html">[squid-users] Content / Message JS Injection for HTTP Pages Only
</A></li>
        <LI>Next message (by thread): <A HREF="015602.html">[squid-users] client--&gt;iptables--&gt;squid-proxy-&gt;another-proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15600">[ date ]</a>
              <a href="thread.html#15600">[ thread ]</a>
              <a href="subject.html#15600">[ subject ]</a>
              <a href="author.html#15600">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've been stuck on this for a few days :P...

 I 'thought' I had a fairly good understanding of squid + ssl_bump but not
so sure.

In a nutshell i am having an issue linking a second proxy server via
cache_peer.

we have 2 boxes.

*Configuration:*
1 box, has iptables configured to send all outbound traffic to 10.0.0.1:8999
which is the second box's squid server and port(8999)

2nd box, has squid running on 8999, we have another server running on 8998. 
both proxy servers are using the same 'CA'.

https 10.0.0.1:8999 transparent ssl-bump generate-host-certificates=on.....

cache_peer 10.0.0.1:8998 8998 0 ssl default no-query no-digest
sslflags=DONT_VERIFY_PEER....

use-case:
wget <A HREF="https://facebook.com">https://facebook.com</A> --ca-cert=/dat/sharedCa.cer  , on box 1 through
iptables..
1. squid on box 2 generates and signs a certificate with CN=facebook.com for
the client
2. client trusts the CA and cert.
3.we want squid to send this proxied https request to the second proxy
server on :8998. this proxy server is set to generate impersonation certs as
well using the same rootCAKey that squid uses...

however, we keep getting 
&quot;Failed to establish a secure connection, SQUID_ERR_SSL_HANDSHAKE&quot;,
Handshake with SSL Server failed: error:140770FC:SSL routines
SSL23_GET_SERVER_HELLO: unknown protocol&quot; 

Does squid 3.5.20 support PROXY Protocol in cache_peer if you need to link a
second proxy? or is my configuration messed up.



--
View this message in context: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/client-iptables-squid-proxy-another-proxy-tp4682759.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/client-iptables-squid-proxy-another-proxy-tp4682759.html</A>
Sent from the Squid - Users mailing list archive at Nabble.com.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015604.html">[squid-users] Content / Message JS Injection for HTTP Pages Only
</A></li>
	<LI>Next message (by thread): <A HREF="015602.html">[squid-users] client--&gt;iptables--&gt;squid-proxy-&gt;another-proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15600">[ date ]</a>
              <a href="thread.html#15600">[ thread ]</a>
              <a href="subject.html#15600">[ subject ]</a>
              <a href="author.html#15600">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
