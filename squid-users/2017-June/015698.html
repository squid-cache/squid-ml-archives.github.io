<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Do peek and stare function exact same at step 1? Also does dstdom_regex work in ssl_bump?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Do%20peek%20and%20stare%20function%20exact%20same%20at%20step%201%3F%0A%20Also%20does%20dstdom_regex%20work%20in%20ssl_bump%3F&In-Reply-To=%3Caabf5704-dbb2-bfd7-d38e-808b863ac11e%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015694.html">
   <LINK REL="Next"  HREF="015702.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Do peek and stare function exact same at step 1? Also does dstdom_regex work in ssl_bump?</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Do%20peek%20and%20stare%20function%20exact%20same%20at%20step%201%3F%0A%20Also%20does%20dstdom_regex%20work%20in%20ssl_bump%3F&In-Reply-To=%3Caabf5704-dbb2-bfd7-d38e-808b863ac11e%40measurement-factory.com%3E"
       TITLE="[squid-users] Do peek and stare function exact same at step 1? Also does dstdom_regex work in ssl_bump?">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Jun 19 17:41:53 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015694.html">[squid-users] Do peek and stare function exact same at step 1? Also does dstdom_regex work in ssl_bump?
</A></li>
        <LI>Next message (by thread): <A HREF="015702.html">[squid-users] Squid tcp_outgoing_mark issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15698">[ date ]</a>
              <a href="thread.html#15698">[ thread ]</a>
              <a href="subject.html#15698">[ subject ]</a>
              <a href="author.html#15698">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 06/19/2017 06:16 AM, Amish wrote:

&gt;<i> I was referring to:
</I>&gt;<i> <A HREF="http://wiki.squid-cache.org/Features/SslPeekAndSplice#Actions">http://wiki.squid-cache.org/Features/SslPeekAndSplice#Actions</A>
</I>&gt;<i> 
</I>&gt;<i> Based on explanation I wonder if peek and stare are exactly same at step 1?
</I>
Both look at the same Client Hello bytes but have at least one different
side effect:

* If you use &quot;peek&quot; during step 1 and Squid cannot decide what you want
to do during step 2, then Squid should splice.

* If you use &quot;stare&quot; during step 1 and Squid cannot decide what you want
to do during step 2, then Squid should bump.

IIRC, there were implementation bugs in the above algorithm but they may
have been fixed since then. As a rule of thumb, always tell Squid what
to do by making sure that at least one applicable ssl_bump rule matches,
regardless of the step.



&gt;<i> If yes, which one should I use at step 1? peek or stare?
</I>
* If you intend to splice, use peek.
* If you intend to bump, use stare.
* If you are not yet sure, it is a gray area. Use whatever you think is
best.


&gt;<i> My 2nd question is:
</I>&gt;<i> 
</I>&gt;<i> In the above link it is mentioned under &quot;Configuration Examples&quot; that:
</I>&gt;<i> &quot;At no point during ssl_bump processing will dstdomain ACL work. That
</I>&gt;<i> ACL relies on HTTP message details that are not yet decrypted&quot;
</I>
Hm.. AFAICT, that comment is misleading: dstdomain (and dstdomain_regex)
&quot;work&quot; as expected in some SslBump cases, sometimes even during step1.
However, you should use server_name if possible instead because
server_name should work as expected in all SslBump cases. And the latest
Squids (v5 r15189) can be used to fine-tune server_name behavior to
match based on SNI, server certificate, and other critically important
cases.


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015694.html">[squid-users] Do peek and stare function exact same at step 1? Also does dstdom_regex work in ssl_bump?
</A></li>
	<LI>Next message (by thread): <A HREF="015702.html">[squid-users] Squid tcp_outgoing_mark issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15698">[ date ]</a>
              <a href="thread.html#15698">[ thread ]</a>
              <a href="subject.html#15698">[ subject ]</a>
              <a href="author.html#15698">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
