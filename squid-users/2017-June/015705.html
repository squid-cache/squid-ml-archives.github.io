<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] annotation and fast / slow acl
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20annotation%20and%20fast%20/%20slow%20acl&In-Reply-To=%3Cd39110f9-fa86-6a50-756f-8ea0fab848f9%40thalesgroup.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015703.html">
   <LINK REL="Next"  HREF="015706.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] annotation and fast / slow acl</H1>
    <B>FUSTE Emmanuel</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20annotation%20and%20fast%20/%20slow%20acl&In-Reply-To=%3Cd39110f9-fa86-6a50-756f-8ea0fab848f9%40thalesgroup.com%3E"
       TITLE="[squid-users] annotation and fast / slow acl">emmanuel.fuste at thalesgroup.com
       </A><BR>
    <I>Tue Jun 20 10:55:21 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015703.html">[squid-users] Squid tcp_outgoing_mark issue
</A></li>
        <LI>Next message (by thread): <A HREF="015706.html">[squid-users] annotation and fast / slow acl
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15705">[ date ]</a>
              <a href="thread.html#15705">[ thread ]</a>
              <a href="subject.html#15705">[ subject ]</a>
              <a href="author.html#15705">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I need to select a cache peer based on the user group.
As cache_peer_access need a fast acl to have predicable result, I tried to
- annotate transactions with &quot;note&quot;
- match the annotation with a fast acl
- use the acl in the cache_peer_access directive

But I still got warning about slow acl in use where fast are required.
I am missing something ?
I saw a proper configuration for something like that in the mailing list 
but no longer find it.

Log:

2017/06/20 12:13:37.024 kid1| 82,2| external_acl.cc(788) aclMatchExternal: ldap_group(&quot;anne.test ACCESINTERNET&quot;) = lookup needed
2017/06/20 12:13:37.025 kid1| 82,2| external_acl.cc(791) aclMatchExternal: &quot;anne.test ACCESINTERNET&quot;: queueing a call.
2017/06/20 12:13:37.025 kid1| 28,2| Checklist.cc(123) goAsync: 0x7ffde8afc0e0 a fast-only directive uses a slow ACL!
2017/06/20 12:13:37.025 kid1| 82,2| external_acl.cc(793) aclMatchExternal: &quot;anne.test ACCESINTERNET&quot;: no async support!
2017/06/20 12:13:37.025 kid1| 82,2| external_acl.cc(794) aclMatchExternal: &quot;anne.test ACCESINTERNET&quot;: return -1.
2017/06/20 12:13:37.025 kid1| 82,2| external_acl.cc(788) aclMatchExternal: ldap_group(&quot;anne.test ACCESCHARGEDECOM&quot;) = lookup needed
2017/06/20 12:13:37.025 kid1| 82,2| external_acl.cc(791) aclMatchExternal: &quot;anne.test ACCESCHARGEDECOM&quot;: queueing a call.
2017/06/20 12:13:37.025 kid1| 28,2| Checklist.cc(123) goAsync: 0x7ffde8afc0e0 a fast-only directive uses a slow ACL!
2017/06/20 12:13:37.025 kid1| 82,2| external_acl.cc(793) aclMatchExternal: &quot;anne.test ACCESCHARGEDECOM&quot;: no async support!
2017/06/20 12:13:37.025 kid1| 82,2| external_acl.cc(794) aclMatchExternal: &quot;anne.test ACCESCHARGEDECOM&quot;: return -1.
2017/06/20 12:13:37.025 kid1| 82,2| external_acl.cc(788) aclMatchExternal: ldap_group(&quot;anne.test INITIAL&quot;) = lookup needed
2017/06/20 12:13:37.025 kid1| 82,2| external_acl.cc(791) aclMatchExternal: &quot;anne.test INITIAL&quot;: queueing a call.
2017/06/20 12:13:37.025 kid1| 28,2| Checklist.cc(123) goAsync: 0x7ffde8afc0e0 a fast-only directive uses a slow ACL!
2017/06/20 12:13:37.025 kid1| 82,2| external_acl.cc(793) aclMatchExternal: &quot;anne.test INITIAL&quot;: no async support!
2017/06/20 12:13:37.026 kid1| 82,2| external_acl.cc(794) aclMatchExternal: &quot;anne.test INITIAL&quot;: return -1.

conf:

acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl Safe_ports port 8002        # multiling http
acl Safe_ports port 8080        # multiling http
acl CONNECT method CONNECT
acl AuthorizedUsers proxy_auth REQUIRED
acl StandardUser external ldap_group ACCESINTERNET
acl VIPUser external ldap_group ACCESCHARGEDECOM
acl NoNetUser external ldap_group INITIAL
acl hostnoauth src &quot;/etc/squid/hosts_noauth&quot;
acl urlnoauth url_regex &quot;/etc/squid/urls_noauth&quot;

note profil StdUser StandardUser
note profil VIP VIPUser
note profil NoNet NoNetUser
acl match-StandardUser note profil StdUser
acl match-VIPUser note profil VIP
acl match-NoNetUser note profil NoNet

http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
http_access allow localhost
http_access allow urlnoauth hostnoauth
http_access allow AuthorizedUsers
http_access deny all
http_port 3128
http_port 10.10.10.10:8080
http_port 10.10.10.10:8002
http_port 10.10.10.10:8001

nonhierarchical_direct off

cache_peer 10.10.10.10         parent   8080     0  name=server_std
cache_peer 10.10.10.10         parent   8002     0  name=server_vip
cache_peer 10.10.10.10         parent   8002     0  name=server_urlnoauth
cache_peer 127.0.0.1             parent     80     0  name=server_nonet

never_direct allow all
always_direct deny all

cache_peer_access server_std allow match-StandardUser
cache_peer_access server_std deny all
cache_peer_access server_vip allow match-VIPUser
cache_peer_access server_vip deny all
cache_peer_access server_nonet allow match-NoNetUser
cache_peer_access server_nonet deny all
cache_peer_access server_urlnoauth allow urlnoauth
cache_peer_access server_urlnoauth deny all
cache_mem 2048 MB

maximum_object_size_in_memory 50 MB
logformat squid [%tl] %6tr %&gt;a %Ss/%03&gt;Hs %&lt;st %rm %ru %[un %Sh/%&lt;a %mt

debug_options ALL,2

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015703.html">[squid-users] Squid tcp_outgoing_mark issue
</A></li>
	<LI>Next message (by thread): <A HREF="015706.html">[squid-users] annotation and fast / slow acl
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15705">[ date ]</a>
              <a href="thread.html#15705">[ thread ]</a>
              <a href="subject.html#15705">[ subject ]</a>
              <a href="author.html#15705">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
