<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] annotation and fast / slow acl
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20annotation%20and%20fast%20/%20slow%20acl&In-Reply-To=%3C8017ab06-3021-cee5-8461-579c3ef7f4fd%40thalesgroup.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015705.html">
   <LINK REL="Next"  HREF="015709.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] annotation and fast / slow acl</H1>
    <B>FUSTE Emmanuel</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20annotation%20and%20fast%20/%20slow%20acl&In-Reply-To=%3C8017ab06-3021-cee5-8461-579c3ef7f4fd%40thalesgroup.com%3E"
       TITLE="[squid-users] annotation and fast / slow acl">emmanuel.fuste at thalesgroup.com
       </A><BR>
    <I>Tue Jun 20 11:02:56 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015705.html">[squid-users] annotation and fast / slow acl
</A></li>
        <LI>Next message (by thread): <A HREF="015709.html">[squid-users] annotation and fast / slow acl
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15706">[ date ]</a>
              <a href="thread.html#15706">[ thread ]</a>
              <a href="subject.html#15706">[ subject ]</a>
              <a href="author.html#15706">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Le 20/06/2017 &#224; 12:55, FUSTE Emmanuel a &#233;crit :
&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> I need to select a cache peer based on the user group.
</I>&gt;<i> As cache_peer_access need a fast acl to have predicable result, I tried to
</I>&gt;<i> - annotate transactions with &quot;note&quot;
</I>&gt;<i> - match the annotation with a fast acl
</I>&gt;<i> - use the acl in the cache_peer_access directive
</I>&gt;<i>
</I>&gt;<i> But I still got warning about slow acl in use where fast are required.
</I>&gt;<i> I am missing something ?
</I>&gt;<i> I saw a proper configuration for something like that in the mailing list
</I>&gt;<i> but no longer find it.
</I>&gt;<i>
</I>&gt;<i> Log:
</I>&gt;<i>
</I>&gt;<i> 2017/06/20 12:13:37.024 kid1| 82,2| external_acl.cc(788) aclMatchExternal: ldap_group(&quot;anne.test ACCESINTERNET&quot;) = lookup needed
</I>&gt;<i> 2017/06/20 12:13:37.025 kid1| 82,2| external_acl.cc(791) aclMatchExternal: &quot;anne.test ACCESINTERNET&quot;: queueing a call.
</I>&gt;<i> 2017/06/20 12:13:37.025 kid1| 28,2| Checklist.cc(123) goAsync: 0x7ffde8afc0e0 a fast-only directive uses a slow ACL!
</I>&gt;<i> 2017/06/20 12:13:37.025 kid1| 82,2| external_acl.cc(793) aclMatchExternal: &quot;anne.test ACCESINTERNET&quot;: no async support!
</I>&gt;<i> 2017/06/20 12:13:37.025 kid1| 82,2| external_acl.cc(794) aclMatchExternal: &quot;anne.test ACCESINTERNET&quot;: return -1.
</I>&gt;<i> 2017/06/20 12:13:37.025 kid1| 82,2| external_acl.cc(788) aclMatchExternal: ldap_group(&quot;anne.test ACCESCHARGEDECOM&quot;) = lookup needed
</I>&gt;<i> 2017/06/20 12:13:37.025 kid1| 82,2| external_acl.cc(791) aclMatchExternal: &quot;anne.test ACCESCHARGEDECOM&quot;: queueing a call.
</I>&gt;<i> 2017/06/20 12:13:37.025 kid1| 28,2| Checklist.cc(123) goAsync: 0x7ffde8afc0e0 a fast-only directive uses a slow ACL!
</I>&gt;<i> 2017/06/20 12:13:37.025 kid1| 82,2| external_acl.cc(793) aclMatchExternal: &quot;anne.test ACCESCHARGEDECOM&quot;: no async support!
</I>&gt;<i> 2017/06/20 12:13:37.025 kid1| 82,2| external_acl.cc(794) aclMatchExternal: &quot;anne.test ACCESCHARGEDECOM&quot;: return -1.
</I>&gt;<i> 2017/06/20 12:13:37.025 kid1| 82,2| external_acl.cc(788) aclMatchExternal: ldap_group(&quot;anne.test INITIAL&quot;) = lookup needed
</I>&gt;<i> 2017/06/20 12:13:37.025 kid1| 82,2| external_acl.cc(791) aclMatchExternal: &quot;anne.test INITIAL&quot;: queueing a call.
</I>&gt;<i> 2017/06/20 12:13:37.025 kid1| 28,2| Checklist.cc(123) goAsync: 0x7ffde8afc0e0 a fast-only directive uses a slow ACL!
</I>&gt;<i> 2017/06/20 12:13:37.025 kid1| 82,2| external_acl.cc(793) aclMatchExternal: &quot;anne.test INITIAL&quot;: no async support!
</I>&gt;<i> 2017/06/20 12:13:37.026 kid1| 82,2| external_acl.cc(794) aclMatchExternal: &quot;anne.test INITIAL&quot;: return -1.
</I>&gt;<i>
</I>&gt;<i> conf:
</I>&gt;<i>
</I>&gt;<i> acl SSL_ports port 443
</I>&gt;<i> acl Safe_ports port 80          # http
</I>&gt;<i> acl Safe_ports port 21          # ftp
</I>&gt;<i> acl Safe_ports port 443         # https
</I>&gt;<i> acl Safe_ports port 70          # gopher
</I>&gt;<i> acl Safe_ports port 210         # wais
</I>&gt;<i> acl Safe_ports port 1025-65535  # unregistered ports
</I>&gt;<i> acl Safe_ports port 280         # http-mgmt
</I>&gt;<i> acl Safe_ports port 488         # gss-http
</I>&gt;<i> acl Safe_ports port 591         # filemaker
</I>&gt;<i> acl Safe_ports port 777         # multiling http
</I>&gt;<i> acl Safe_ports port 8002        # multiling http
</I>&gt;<i> acl Safe_ports port 8080        # multiling http
</I>&gt;<i> acl CONNECT method CONNECT
</I>&gt;<i> acl AuthorizedUsers proxy_auth REQUIRED
</I>&gt;<i> acl StandardUser external ldap_group ACCESINTERNET
</I>&gt;<i> acl VIPUser external ldap_group ACCESCHARGEDECOM
</I>&gt;<i> acl NoNetUser external ldap_group INITIAL
</I>&gt;<i> acl hostnoauth src &quot;/etc/squid/hosts_noauth&quot;
</I>&gt;<i> acl urlnoauth url_regex &quot;/etc/squid/urls_noauth&quot;
</I>&gt;<i>
</I>&gt;<i> note profil StdUser StandardUser
</I>&gt;<i> note profil VIP VIPUser
</I>&gt;<i> note profil NoNet NoNetUser
</I>&gt;<i> acl match-StandardUser note profil StdUser
</I>&gt;<i> acl match-VIPUser note profil VIP
</I>&gt;<i> acl match-NoNetUser note profil NoNet
</I>&gt;<i>
</I>&gt;<i> http_access deny !Safe_ports
</I>&gt;<i> http_access deny CONNECT !SSL_ports
</I>&gt;<i> http_access allow localhost manager
</I>&gt;<i> http_access deny manager
</I>&gt;<i> http_access allow localhost
</I>&gt;<i> http_access allow urlnoauth hostnoauth
</I>&gt;<i> http_access allow AuthorizedUsers
</I>&gt;<i> http_access deny all
</I>&gt;<i> http_port 3128
</I>--------
&gt;<i> http_port 10.10.10.10:8080
</I>&gt;<i> http_port 10.10.10.10:8002
</I>&gt;<i> http_port 10.10.10.10:8001
</I>Forget this block : anonymization  error....
-------
&gt;<i>
</I>&gt;<i> nonhierarchical_direct off
</I>&gt;<i>
</I>&gt;<i> cache_peer 10.10.10.10         parent   8080     0  name=server_std
</I>&gt;<i> cache_peer 10.10.10.10         parent   8002     0  name=server_vip
</I>&gt;<i> cache_peer 10.10.10.10         parent   8002     0  name=server_urlnoauth
</I>&gt;<i> cache_peer 127.0.0.1             parent     80     0  name=server_nonet
</I>&gt;<i>
</I>&gt;<i> never_direct allow all
</I>&gt;<i> always_direct deny all
</I>&gt;<i>
</I>&gt;<i> cache_peer_access server_std allow match-StandardUser
</I>&gt;<i> cache_peer_access server_std deny all
</I>&gt;<i> cache_peer_access server_vip allow match-VIPUser
</I>&gt;<i> cache_peer_access server_vip deny all
</I>&gt;<i> cache_peer_access server_nonet allow match-NoNetUser
</I>&gt;<i> cache_peer_access server_nonet deny all
</I>&gt;<i> cache_peer_access server_urlnoauth allow urlnoauth
</I>&gt;<i> cache_peer_access server_urlnoauth deny all
</I>&gt;<i> cache_mem 2048 MB
</I>&gt;<i>
</I>&gt;<i> maximum_object_size_in_memory 50 MB
</I>&gt;<i> logformat squid [%tl] %6tr %&gt;a %Ss/%03&gt;Hs %&lt;st %rm %ru %[un %Sh/%&lt;a %mt
</I>&gt;<i>
</I>&gt;<i> debug_options ALL,2
</I>&gt;<i>
</I></PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015705.html">[squid-users] annotation and fast / slow acl
</A></li>
	<LI>Next message (by thread): <A HREF="015709.html">[squid-users] annotation and fast / slow acl
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15706">[ date ]</a>
              <a href="thread.html#15706">[ thread ]</a>
              <a href="subject.html#15706">[ subject ]</a>
              <a href="author.html#15706">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
