<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Header order in squid proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Header%20order%20in%20squid%20proxy&In-Reply-To=%3C880a7094-14cc-2cb2-947b-73a4b9f5c603%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015725.html">
   <LINK REL="Next"  HREF="015727.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Header order in squid proxy</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Header%20order%20in%20squid%20proxy&In-Reply-To=%3C880a7094-14cc-2cb2-947b-73a4b9f5c603%40measurement-factory.com%3E"
       TITLE="[squid-users] Header order in squid proxy">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Jun 22 18:32:14 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015725.html">[squid-users] Header order in squid proxy
</A></li>
        <LI>Next message (by thread): <A HREF="015727.html">[squid-users] Header order in squid proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15726">[ date ]</a>
              <a href="thread.html#15726">[ thread ]</a>
              <a href="subject.html#15726">[ subject ]</a>
              <a href="author.html#15726">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 06/22/2017 11:49 AM, Sonya Roy wrote:

&gt;<i> I noticed that squid changes the header order received from the client
</I>&gt;<i> before sending it to the origin server.
</I>&gt;<i> 
</I>&gt;<i> I assume this is because squid parses the header data and adds some
</I>&gt;<i> headers depending on the config file and then recreates the header data.
</I>
IIRC, modern Squids change a header field position when the received
field is deleted and then added back. This is typical for hop-by-hop
headers such as Connection, but there are other reasons for Squid to
delete and add a header field. When the value of the added field is the
same as the value of the removed field, such pointless &quot;editing&quot; looks
like mindless &quot;reordering&quot; to the outside observer.

The two actions (field deletion and addition) may happen in a single
piece of code or may be separated by lots of code and even time.
Preventing pointless editing in the former cases is straightforward, but
the latter cases are difficult to handle. Correct avoidance of pointless
editing may improve performance and, if it does, can be considered a
useful optimization on its own, regardless of your use case.


&gt;<i> Is there any way to prevent this?
</I>
Not without changing Squid code (or adding more proxies). However,
before we even talk about code changes, we should clarify the problem we
are dealing with. The questions below will guide you.

It is probably much easier to ensure some fixed field send order
(regardless of the received order) than to preserve the received order.
Will a fixed order (e.g., always alphabetical) address your use case?
This feature will hurt performance, but you might be able to convince
others to accept it if you have a very compelling/specific/detailed use
case because it can be disabled by default.


&gt;<i> I am asking because some sites detect bots using the header order and
</I>&gt;<i> they drop any such connection. So they unintentionally block squid
</I>&gt;<i> proxies even if its not being used by a bot.
</I>
Are you implying that bots often change header field order between their
requests? Or that bots often use a different (fixed) header field order
than the (fixed) field order used by non-bots? Preserving received order
may help in the former case but not in the latter case.

Also, do those blocking sites pay attention to all headers or just
end-to-end headers?

Please note that there are many other ways to detect a proxy so if a
site wants to block proxies rather than bots, then it is probably
pointless to fight it (or, at least, the Squid Project should not).


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015725.html">[squid-users] Header order in squid proxy
</A></li>
	<LI>Next message (by thread): <A HREF="015727.html">[squid-users] Header order in squid proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15726">[ date ]</a>
              <a href="thread.html#15726">[ thread ]</a>
              <a href="subject.html#15726">[ subject ]</a>
              <a href="author.html#15726">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
