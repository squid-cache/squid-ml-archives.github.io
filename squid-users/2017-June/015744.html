<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ACLs allow/deny logic
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ACLs%20allow/deny%20logic&In-Reply-To=%3C1903999605.3040033.1498545101578%40mail.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015739.html">
   <LINK REL="Next"  HREF="015758.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ACLs allow/deny logic</H1>
    <B>Vieri</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ACLs%20allow/deny%20logic&In-Reply-To=%3C1903999605.3040033.1498545101578%40mail.yahoo.com%3E"
       TITLE="[squid-users] ACLs allow/deny logic">rentorbuy at yahoo.com
       </A><BR>
    <I>Tue Jun 27 06:31:41 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015739.html">[squid-users] ACLs allow/deny logic
</A></li>
        <LI>Next message (by thread): <A HREF="015758.html">[squid-users] ACLs allow/deny logic
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15744">[ date ]</a>
              <a href="thread.html#15744">[ thread ]</a>
              <a href="subject.html#15744">[ subject ]</a>
              <a href="author.html#15744">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please bear with me because I still don't quite grasp the AND logic with ACLs.

Let's consider the logic &quot;http_access deny (if) X (and) Y (and) Z&quot; and the following squid configuration section:

[squid.conf - start]
acl denied_restricted1_mimetypes_req req_mime_type -i &quot;/usr/local/proxy-settings/denied.restricted1.mimetypes&quot;
acl denied_restricted1_mimetypes_rep rep_mime_type -i &quot;/usr/local/proxy-settings/denied.restricted1.mimetypes&quot;
acl allowed_restricted1_domains dstdomain -i &quot;/usr/local/proxy-settings/allowed.restricted1.domains&quot;
acl allowed_restricted1_ips dst &quot;/usr/local/proxy-settings/allowed.restricted1.ips&quot;

http_access deny denied_restricted1_mimetypes_req !allowed_restricted1_domains !allowed_restricted1_ips
http_reply_access deny denied_restricted1_mimetypes_rep !allowed_restricted1_domains !allowed_restricted1_ips

http_access deny intercepted !localnet

http_access allow localnet

http_access deny all
[squid.conf - finish]

In particular:

http_reply_access deny (if) denied_restricted1_mimetypes_rep (and not) allowed_restricted1_domains (and not) allowed_restricted1_ips

where 

denied_restricted1_mimetypes_rep: matches mime type application/octet-stream
allowed_restricted1_domains: matches DESTINATION domain .telegram.org
allowed_restricted1_ips: matches DESTINATION IP addresses (any one of 149.154.167.91 or 149.154.165.120)

So, it should translate to something like this:

http_reply_access deny (if) (mime type is application/octet-stream) (and) (DESTINATION domain is NOT .telegram.org) (and) (DESTINATION IP address is NOT any of 149.154.167.91 or 149.154.165.120)

Correct?
If so, then I'm still struggling to understand the first message in the log:

&quot;The reply for POST <A HREF="http://149.154.165.120/api">http://149.154.165.120/api</A> is DENIED, because it matched allowed_restricted1_ips&quot;

I don't think &quot;the server's reply (application/octet-stream) should be denied&quot; if it comes from one of 149.154.167.91 or 149.154.165.120.

Anyway, I'll try out the configuration directives you suggested and see if that logic applies correctly (at least to my undertsanding ;-) ).

Thanks for your valuable help,

Vieri

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015739.html">[squid-users] ACLs allow/deny logic
</A></li>
	<LI>Next message (by thread): <A HREF="015758.html">[squid-users] ACLs allow/deny logic
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15744">[ date ]</a>
              <a href="thread.html#15744">[ thread ]</a>
              <a href="subject.html#15744">[ subject ]</a>
              <a href="author.html#15744">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
