<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] sending proxy protocol
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20sending%20proxy%20protocol&In-Reply-To=%3C80611C94-5E1E-4D11-9593-13BB9EB5A5B6%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015777.html">
   <LINK REL="Next"  HREF="015779.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] sending proxy protocol</H1>
    <B>Marc Boschma</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20sending%20proxy%20protocol&In-Reply-To=%3C80611C94-5E1E-4D11-9593-13BB9EB5A5B6%40gmail.com%3E"
       TITLE="[squid-users] sending proxy protocol">marc.boschma at gmail.com
       </A><BR>
    <I>Thu Jun 29 22:18:31 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015777.html">[squid-users] Windows binary files for Squid Helpers download	available anywhere for 3.5.x.x?
</A></li>
        <LI>Next message (by thread): <A HREF="015779.html">[squid-users] sending proxy protocol
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15778">[ date ]</a>
              <a href="thread.html#15778">[ thread ]</a>
              <a href="subject.html#15778">[ subject ]</a>
              <a href="author.html#15778">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I&#8217;ve been trying to work out if Squid can inject a proxy protocol to down stream destinations&#8230; hopefully proxy protocol version 2 [1].

The scenario is as follows:

Server &#8212; CONNECT request + out of bound request ID in HTTP header &#8212;&gt; ELB on 3128 added proxy protocol v1 with Server&#8217;s IP details &#8212;&gt; SQUID extracts proxy protocol v1 to get Server&#8217;s IP details, extracts request ID, processes CONNECT request, injects proxy-protocol v2 in front of CONNECT TLS stream with either PP2_TYPE_NETNS TLV populated with request ID or better yet a custom TLV with the same info &#8212;&gt; Reverse Proxy that accepts proxy-protocol v2.

The main aim of the game is to:
* be able to log as much detail as each hop to allow for correlation of logs through the infrastructure. Especially since the TLS is end to end between Server and Reverse Proxy.
* give the Reverse Proxy as much detail about the origin of the request.

I&#8217;ve been able to find that SQUID can accept the proxy protocol from the ELB&#8230; I&#8217;m curious as to whether or not the proxy protocol and TLV (NETNS or another) can be set?

Regards,

Marc


[1] <A HREF="https://www.haproxy.org/download/1.8/doc/proxy-protocol.txt">https://www.haproxy.org/download/1.8/doc/proxy-protocol.txt</A>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015777.html">[squid-users] Windows binary files for Squid Helpers download	available anywhere for 3.5.x.x?
</A></li>
	<LI>Next message (by thread): <A HREF="015779.html">[squid-users] sending proxy protocol
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15778">[ date ]</a>
              <a href="thread.html#15778">[ thread ]</a>
              <a href="subject.html#15778">[ subject ]</a>
              <a href="author.html#15778">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
