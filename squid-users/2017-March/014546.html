<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSL Bump and Certificate issue - RapidSSL Intermediate Cert
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20Bump%20and%20Certificate%20issue%20-%20RapidSSL%0A%20Intermediate%20Cert&In-Reply-To=%3C899f1712-9b39-e052-a075-80609be34275%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014548.html">
   <LINK REL="Next"  HREF="014547.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSL Bump and Certificate issue - RapidSSL Intermediate Cert</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20Bump%20and%20Certificate%20issue%20-%20RapidSSL%0A%20Intermediate%20Cert&In-Reply-To=%3C899f1712-9b39-e052-a075-80609be34275%40treenet.co.nz%3E"
       TITLE="[squid-users] SSL Bump and Certificate issue - RapidSSL Intermediate Cert">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Mar  1 17:05:29 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014548.html">[squid-users] Failed to shm_open
</A></li>
        <LI>Next message (by thread): <A HREF="014547.html">[squid-users] SSL Bump and Certificate issue - RapidSSL	Intermediate Cert
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14546">[ date ]</a>
              <a href="thread.html#14546">[ thread ]</a>
              <a href="subject.html#14546">[ subject ]</a>
              <a href="author.html#14546">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 1/03/2017 4:58 a.m., stylemessiah wrote:
&gt;<i> This is driving me nuts, its the only issue ive found running ssl bump on my
</I>&gt;<i> home network for eons
</I>&gt;<i> 
</I>&gt;<i> I cant see image thumbnails on xda-developers...
</I>&gt;<i> 
</I>&gt;<i> When i access a thread with them, i get text links, not thumbnails, and if i
</I>&gt;<i> click on the links i get the following:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     (71) Protocol error (TLS code:
</I>&gt;<i> X509_V_ERR_UNABLE_TO_GET_ISSUER_CERT_LOCALLY)
</I>&gt;<i> 
</I>&gt;<i>     SSL Certficate error: certificate issuer (CA) not known:
</I>&gt;<i> /C=US/O=GeoTrust Inc./CN=RapidSSL SHA256 CA
</I>&gt;<i> 
</I>&gt;<i> I figured out by googling how to (i hope) trace the problem certificate via
</I>&gt;<i> s_client:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> OpenSSL&gt; s_client -showcerts -verify 32 -connect dl.xda-developers.com:443
</I>&gt;<i> verify depth is 32
</I>&gt;<i> CONNECTED(0000012C)
</I>&gt;<i> depth=0 CN = *.xda-developers.com
</I>&gt;<i> verify error:num=20:unable to get local issuer certificate
</I>&gt;<i> verify return:1
</I>&gt;<i> depth=0 CN = *.xda-developers.com
</I>&gt;<i> verify error:num=21:unable to verify the first certificate
</I>&gt;<i> verify return:1
</I>
That command you used does not send data through the proxy. So that
confirms that the servers TLS is broken in a way unrelated to Squid.



&gt;<i> ---
</I>&gt;<i> Certificate chain
</I>&gt;<i>  0 s:/CN=*.xda-developers.com
</I>&gt;<i>    i:/C=US/O=GeoTrust Inc./CN=RapidSSL SHA256 CA
</I>...
&gt;<i> ---
</I>&gt;<i> Server certificate
</I>&gt;<i> subject=/CN=*.xda-developers.com
</I>&gt;<i> issuer=/C=US/O=GeoTrust Inc./CN=RapidSSL SHA256 CA
</I>&gt;<i> ---
</I>&gt;<i> No client certificate CA names sent
</I>&gt;<i> Peer signing digest: SHA512
</I>&gt;<i> Server Temp Key: ECDH, P-256, 256 bits
</I>&gt;<i> ---
</I>&gt;<i> SSL handshake has read 2067 bytes and written 302 bytes
</I>&gt;<i> Verification error: unable to verify the first certificate
</I>
&gt;<i> 
</I>&gt;<i> Ive found the intermediate bundle from RapidSS, and added it to my existing
</I>&gt;<i> pem bundle...no change
</I>
You need to locate the root CA and/or intermediate CA certificates used
to sign the domain servers certificate.

You then need to identify *why* they are not being trusted by your OS
library.

Be sure to determine whether the CA which is missing is actually
trustworthy before adding it to your trusted set. More than a few of the
CA which are around are not trusted because they have been hacked or
caught signing forged certificates they should not have.


&gt;<i> Added as a separate pem i.e. sslproxy_foreign_intermediate_certs
</I>&gt;<i> /cygdrive/e/Squid/etc/ssl/extra-intermediate-CA.pem...no change
</I>&gt;<i> 
</I>&gt;<i> My sslbump related config lines are:
</I>&gt;<i> 
</I>&gt;<i> http_port 127.0.0.1:3128 ssl-bump generate-host-certificates=on
</I>&gt;<i> dynamic_cert_mem_cache_size=10MB cert=/cygdrive/e/Squid/etc/ssl/myCA.pem
</I>&gt;<i> capath=/cygdrive/e/Squid/etc/ssl
</I>&gt;<i> cafile=/cygdrive/e/Squid/etc/ssl/extra-intermediate-CA.pem
</I>&gt;<i> tls-dh=/cygdrive/e/Squid/etc/ssl/dhparam.pem
</I>&gt;<i> options=NO_SSLv2,NO_SSLv3,SINGLE_ECDH_USE 
</I>
PS.  EECDH will not work unless you configure a curve name in the
tls-dh= option. Just having dhparam.pem alone will only enable the less
secure DH ciphers.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014548.html">[squid-users] Failed to shm_open
</A></li>
	<LI>Next message (by thread): <A HREF="014547.html">[squid-users] SSL Bump and Certificate issue - RapidSSL	Intermediate Cert
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14546">[ date ]</a>
              <a href="thread.html#14546">[ thread ]</a>
              <a href="subject.html#14546">[ subject ]</a>
              <a href="author.html#14546">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
