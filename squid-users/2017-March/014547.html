<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSL Bump and Certificate issue - RapidSSL	Intermediate Cert
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20Bump%20and%20Certificate%20issue%20-%20RapidSSL%0A%09Intermediate%20Cert&In-Reply-To=%3CCAOLOQx36wSy24sDDS-Qm%3DBSAeGsS5oiT5kGK5kP7s%3DsMQEffpQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014546.html">
   <LINK REL="Next"  HREF="014550.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSL Bump and Certificate issue - RapidSSL	Intermediate Cert</H1>
    <B>stylemessiah</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20Bump%20and%20Certificate%20issue%20-%20RapidSSL%0A%09Intermediate%20Cert&In-Reply-To=%3CCAOLOQx36wSy24sDDS-Qm%3DBSAeGsS5oiT5kGK5kP7s%3DsMQEffpQ%40mail.gmail.com%3E"
       TITLE="[squid-users] SSL Bump and Certificate issue - RapidSSL	Intermediate Cert">adrian.m.miller at gmail.com
       </A><BR>
    <I>Wed Mar  1 17:03:47 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014546.html">[squid-users] SSL Bump and Certificate issue - RapidSSL Intermediate Cert
</A></li>
        <LI>Next message (by thread): <A HREF="014550.html">[squid-users] SSL Bump and Certificate issue - RapidSSL	Intermediate Cert
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14547">[ date ]</a>
              <a href="thread.html#14547">[ thread ]</a>
              <a href="subject.html#14547">[ subject ]</a>
              <a href="author.html#14547">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Amos for the info, appreciate your tireless assistance for us
numpties :)

On 2 Mar. 2017 4:06 am, &quot;Amos Jeffries [via Squid Web Proxy Cache]&quot; &lt;
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">ml-node+s1019090n4681642h47 at n4.nabble.com</A>&gt; wrote:

&gt;<i> On 1/03/2017 4:58 a.m., stylemessiah wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; This is driving me nuts, its the only issue ive found running ssl bump
</I>&gt;<i> on my
</I>&gt;<i> &gt; home network for eons
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I cant see image thumbnails on xda-developers...
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; When i access a thread with them, i get text links, not thumbnails, and
</I>&gt;<i> if i
</I>&gt;<i> &gt; click on the links i get the following:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     (71) Protocol error (TLS code:
</I>&gt;<i> &gt; X509_V_ERR_UNABLE_TO_GET_ISSUER_CERT_LOCALLY)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     SSL Certficate error: certificate issuer (CA) not known:
</I>&gt;<i> &gt; /C=US/O=GeoTrust Inc./CN=RapidSSL SHA256 CA
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I figured out by googling how to (i hope) trace the problem certificate
</I>&gt;<i> via
</I>&gt;<i> &gt; s_client:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; OpenSSL&gt; s_client -showcerts -verify 32 -connect
</I>&gt;<i> dl.xda-developers.com:443
</I>&gt;<i> &gt; verify depth is 32
</I>&gt;<i> &gt; CONNECTED(0000012C)
</I>&gt;<i> &gt; depth=0 CN = *.xda-developers.com
</I>&gt;<i> &gt; verify error:num=20:unable to get local issuer certificate
</I>&gt;<i> &gt; verify return:1
</I>&gt;<i> &gt; depth=0 CN = *.xda-developers.com
</I>&gt;<i> &gt; verify error:num=21:unable to verify the first certificate
</I>&gt;<i> &gt; verify return:1
</I>&gt;<i>
</I>&gt;<i> That command you used does not send data through the proxy. So that
</I>&gt;<i> confirms that the servers TLS is broken in a way unrelated to Squid.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; ---
</I>&gt;<i> &gt; Certificate chain
</I>&gt;<i> &gt;  0 s:/CN=*.xda-developers.com
</I>&gt;<i> &gt;    i:/C=US/O=GeoTrust Inc./CN=RapidSSL SHA256 CA
</I>&gt;<i> ...
</I>&gt;<i>
</I>&gt;<i> &gt; ---
</I>&gt;<i> &gt; Server certificate
</I>&gt;<i> &gt; subject=/CN=*.xda-developers.com
</I>&gt;<i> &gt; issuer=/C=US/O=GeoTrust Inc./CN=RapidSSL SHA256 CA
</I>&gt;<i> &gt; ---
</I>&gt;<i> &gt; No client certificate CA names sent
</I>&gt;<i> &gt; Peer signing digest: SHA512
</I>&gt;<i> &gt; Server Temp Key: ECDH, P-256, 256 bits
</I>&gt;<i> &gt; ---
</I>&gt;<i> &gt; SSL handshake has read 2067 bytes and written 302 bytes
</I>&gt;<i> &gt; Verification error: unable to verify the first certificate
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Ive found the intermediate bundle from RapidSS, and added it to my
</I>&gt;<i> existing
</I>&gt;<i> &gt; pem bundle...no change
</I>&gt;<i>
</I>&gt;<i> You need to locate the root CA and/or intermediate CA certificates used
</I>&gt;<i> to sign the domain servers certificate.
</I>&gt;<i>
</I>&gt;<i> You then need to identify *why* they are not being trusted by your OS
</I>&gt;<i> library.
</I>&gt;<i>
</I>&gt;<i> Be sure to determine whether the CA which is missing is actually
</I>&gt;<i> trustworthy before adding it to your trusted set. More than a few of the
</I>&gt;<i> CA which are around are not trusted because they have been hacked or
</I>&gt;<i> caught signing forged certificates they should not have.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; Added as a separate pem i.e. sslproxy_foreign_intermediate_certs
</I>&gt;<i> &gt; /cygdrive/e/Squid/etc/ssl/extra-intermediate-CA.pem...no change
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; My sslbump related config lines are:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; http_port 127.0.0.1:3128 ssl-bump generate-host-certificates=on
</I>&gt;<i> &gt; dynamic_cert_mem_cache_size=10MB cert=/cygdrive/e/Squid/etc/ssl/myCA.pem
</I>&gt;<i>
</I>&gt;<i> &gt; capath=/cygdrive/e/Squid/etc/ssl
</I>&gt;<i> &gt; cafile=/cygdrive/e/Squid/etc/ssl/extra-intermediate-CA.pem
</I>&gt;<i> &gt; tls-dh=/cygdrive/e/Squid/etc/ssl/dhparam.pem
</I>&gt;<i> &gt; options=NO_SSLv2,NO_SSLv3,SINGLE_ECDH_USE
</I>&gt;<i>
</I>&gt;<i> PS.  EECDH will not work unless you configure a curve name in the
</I>&gt;<i> tls-dh= option. Just having dhparam.pem alone will only enable the less
</I>&gt;<i> secure DH ciphers.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> [hidden email] &lt;<A HREF="http:///user/SendEmail.jtp?type=node&amp;node=4681642&amp;i=0">http:///user/SendEmail.jtp?type=node&amp;node=4681642&amp;i=0</A>&gt;
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i> If you reply to this email, your message will be added to the discussion
</I>&gt;<i> below:
</I>&gt;<i> <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/SSL-">http://squid-web-proxy-cache.1019090.n4.nabble.com/SSL-</A>
</I>&gt;<i> Bump-and-Certificate-issue-RapidSSL-Intermediate-Cert-
</I>&gt;<i> tp4681635p4681642.html
</I>&gt;<i> To unsubscribe from SSL Bump and Certificate issue - RapidSSL Intermediate
</I>&gt;<i> Cert, click here
</I>&gt;<i> &lt;<A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&amp;node=4681635&amp;code=YWRyaWFuLm0ubWlsbGVyQGdtYWlsLmNvbXw0NjgxNjM1fDE5ODY3MjIyMDI=">http://squid-web-proxy-cache.1019090.n4.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&amp;node=4681635&amp;code=YWRyaWFuLm0ubWlsbGVyQGdtYWlsLmNvbXw0NjgxNjM1fDE5ODY3MjIyMDI=</A>&gt;
</I>&gt;<i> .
</I>&gt;<i> NAML
</I>&gt;<i> &lt;<A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&amp;id=instant_html%21nabble%3Aemail.naml&amp;base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&amp;breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml">http://squid-web-proxy-cache.1019090.n4.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&amp;id=instant_html%21nabble%3Aemail.naml&amp;base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&amp;breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml</A>&gt;
</I>&gt;<i>
</I>



--
View this message in context: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/SSL-Bump-and-Certificate-issue-RapidSSL-Intermediate-Cert-tp4681635p4681643.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/SSL-Bump-and-Certificate-issue-RapidSSL-Intermediate-Cert-tp4681635p4681643.html</A>
Sent from the Squid - Users mailing list archive at Nabble.com.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014546.html">[squid-users] SSL Bump and Certificate issue - RapidSSL Intermediate Cert
</A></li>
	<LI>Next message (by thread): <A HREF="014550.html">[squid-users] SSL Bump and Certificate issue - RapidSSL	Intermediate Cert
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14547">[ date ]</a>
              <a href="thread.html#14547">[ thread ]</a>
              <a href="subject.html#14547">[ subject ]</a>
              <a href="author.html#14547">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
