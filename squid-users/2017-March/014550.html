<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSL Bump and Certificate issue - RapidSSL	Intermediate Cert
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20Bump%20and%20Certificate%20issue%20-%20RapidSSL%0A%09Intermediate%20Cert&In-Reply-To=%3CCAOLOQx3n5MSOZHTiKSZJ8BfA%3DQ%3DLNd7KCVsncgLz2QZt0XaEOQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014547.html">
   <LINK REL="Next"  HREF="014551.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSL Bump and Certificate issue - RapidSSL	Intermediate Cert</H1>
    <B>stylemessiah</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20Bump%20and%20Certificate%20issue%20-%20RapidSSL%0A%09Intermediate%20Cert&In-Reply-To=%3CCAOLOQx3n5MSOZHTiKSZJ8BfA%3DQ%3DLNd7KCVsncgLz2QZt0XaEOQ%40mail.gmail.com%3E"
       TITLE="[squid-users] SSL Bump and Certificate issue - RapidSSL	Intermediate Cert">adrian.m.miller at gmail.com
       </A><BR>
    <I>Thu Mar  2 01:57:30 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014547.html">[squid-users] SSL Bump and Certificate issue - RapidSSL	Intermediate Cert
</A></li>
        <LI>Next message (by thread): <A HREF="014551.html">[squid-users] SSL Bump and Certificate issue - RapidSSL	Intermediate Cert
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14550">[ date ]</a>
              <a href="thread.html#14550">[ thread ]</a>
              <a href="subject.html#14550">[ subject ]</a>
              <a href="author.html#14550">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i>That command you used does not send data through the proxy. So that
</I>&gt;<i>confirms that the servers TLS is broken in a way unrelated to Squid.
</I>
As that may be, when i go direct (sans proxy) i get thumbnails...no issues
Toggle the proxy back on and no thumbnails, and opening an image link gives
the
error initially reported.

(71) Protocol error (TLS code:
 X509_V_ERR_UNABLE_TO_GET_ISSUER_CERT_LOCALLY)

SSL Certficate error: certificate issuer (CA) not known:
/C=US/O=GeoTrust Inc./CN=RapidSSL SHA256 CA

So both Ie and FF will just load anything from dl.xda-developers.com and not
register an issue, but squid will refuse to load the content and generate
the error

&gt;<i>You need to locate the root CA and/or intermediate CA certificates used
</I>&gt;<i>to sign the domain servers certificate.
</I>
&gt;<i>You then need to identify *why* they are not being trusted by your OS
</I>&gt;<i>library.
</I>
&gt;<i>Be sure to determine whether the CA which is missing is actually
</I>&gt;<i>trustworthy before adding it to your trusted set. More than a few of the
</I>&gt;<i>CA which are around are not trusted because they have been hacked or
</I>&gt;<i>caught signing forged certificates they should not have.
</I>
I aalways learn something when youre silly enough to reply :)

When i ran dl.xda-developers.com through ssllabs (thanks google), it gave
me a less than glowing report, including
an incomplete cert chain (i say that like i understand it :) ) or as it put
it:

This server is vulnerable to the OpenSSL CCS vulnerability (CVE-2014-0224)
&lt;<A HREF="https://community.qualys.com/blogs/securitylabs/2014/06/13/ssl-pulse-49-vulnerable-to-cve-2014-0224-14-exploitable">https://community.qualys.com/blogs/securitylabs/2014/06/13/ssl-pulse-49-vulnerable-to-cve-2014-0224-14-exploitable</A>&gt;
and exploitable. Grade set to F.
This server is vulnerable to the OpenSSL Padding Oracle vulnerability
(CVE-2016-2107)
&lt;<A HREF="https://blog.cloudflare.com/yet-another-padding-oracle-in-openssl-cbc-ciphersuites/">https://blog.cloudflare.com/yet-another-padding-oracle-in-openssl-cbc-ciphersuites/</A>&gt;
and insecure. Grade set to F.
This server accepts RC4 cipher, but only with older browsers. Grade capped
to B.  MORE INFO &#187;
&lt;<A HREF="https://community.qualys.com/blogs/securitylabs/2013/03/19/rc4-in-tls-is-broken-now-what">https://community.qualys.com/blogs/securitylabs/2013/03/19/rc4-in-tls-is-broken-now-what</A>&gt;
This server's certificate chain is incomplete. Grade capped to B.

Full report here for the curious:
<A HREF="https://globalsign.ssllabs.com/analyze.html?d=dl.xda-developers.com&amp;hideResults=on">https://globalsign.ssllabs.com/analyze.html?d=dl.xda-developers.com&amp;hideResults=on</A>

For a few thumbnails im not going to torture myself, maybe ill send the
forum admin a note instead :)

&gt;<i>PS.  EECDH will not work unless you configure a curve name in the
</I>&gt;<i>tls-dh= option. Just having dhparam.pem alone will only enable the less
</I>&gt;<i>secure DH ciphers.
</I>
I did add a curve to the tls-dh param, im guessing tis correct, little info
on which one to use (grabbing the list from my local openssl had me going
what the hell)

tls-dh=prime256v1:/cygdrive/e/Squid/etc/ssl/dhparam.pem

Note: this made no difference whatsoever with my issue

Cheers,

Adrian Miller



On 2 March 2017 at 04:08, Adrian Miller &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">adrian.m.miller at gmail.com</A>&gt; wrote:

&gt;<i> Thanks Amos for the info, appreciate your tireless assistance for us
</I>&gt;<i> numpties :)
</I>&gt;<i>
</I>&gt;<i> On 2 Mar. 2017 4:06 am, &quot;Amos Jeffries [via Squid Web Proxy Cache]&quot; &lt;
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">ml-node+s1019090n4681642h47 at n4.nabble.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> On 1/03/2017 4:58 a.m., stylemessiah wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; This is driving me nuts, its the only issue ive found running ssl bump
</I>&gt;&gt;<i> on my
</I>&gt;&gt;<i> &gt; home network for eons
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; I cant see image thumbnails on xda-developers...
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; When i access a thread with them, i get text links, not thumbnails, and
</I>&gt;&gt;<i> if i
</I>&gt;&gt;<i> &gt; click on the links i get the following:
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;     (71) Protocol error (TLS code:
</I>&gt;&gt;<i> &gt; X509_V_ERR_UNABLE_TO_GET_ISSUER_CERT_LOCALLY)
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;     SSL Certficate error: certificate issuer (CA) not known:
</I>&gt;&gt;<i> &gt; /C=US/O=GeoTrust Inc./CN=RapidSSL SHA256 CA
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; I figured out by googling how to (i hope) trace the problem certificate
</I>&gt;&gt;<i> via
</I>&gt;&gt;<i> &gt; s_client:
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; OpenSSL&gt; s_client -showcerts -verify 32 -connect
</I>&gt;&gt;<i> dl.xda-developers.com:443
</I>&gt;&gt;<i> &gt; verify depth is 32
</I>&gt;&gt;<i> &gt; CONNECTED(0000012C)
</I>&gt;&gt;<i> &gt; depth=0 CN = *.xda-developers.com
</I>&gt;&gt;<i> &gt; verify error:num=20:unable to get local issuer certificate
</I>&gt;&gt;<i> &gt; verify return:1
</I>&gt;&gt;<i> &gt; depth=0 CN = *.xda-developers.com
</I>&gt;&gt;<i> &gt; verify error:num=21:unable to verify the first certificate
</I>&gt;&gt;<i> &gt; verify return:1
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> That command you used does not send data through the proxy. So that
</I>&gt;&gt;<i> confirms that the servers TLS is broken in a way unrelated to Squid.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; ---
</I>&gt;&gt;<i> &gt; Certificate chain
</I>&gt;&gt;<i> &gt;  0 s:/CN=*.xda-developers.com
</I>&gt;&gt;<i> &gt;    i:/C=US/O=GeoTrust Inc./CN=RapidSSL SHA256 CA
</I>&gt;&gt;<i> ...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; ---
</I>&gt;&gt;<i> &gt; Server certificate
</I>&gt;&gt;<i> &gt; subject=/CN=*.xda-developers.com
</I>&gt;&gt;<i> &gt; issuer=/C=US/O=GeoTrust Inc./CN=RapidSSL SHA256 CA
</I>&gt;&gt;<i> &gt; ---
</I>&gt;&gt;<i> &gt; No client certificate CA names sent
</I>&gt;&gt;<i> &gt; Peer signing digest: SHA512
</I>&gt;&gt;<i> &gt; Server Temp Key: ECDH, P-256, 256 bits
</I>&gt;&gt;<i> &gt; ---
</I>&gt;&gt;<i> &gt; SSL handshake has read 2067 bytes and written 302 bytes
</I>&gt;&gt;<i> &gt; Verification error: unable to verify the first certificate
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Ive found the intermediate bundle from RapidSS, and added it to my
</I>&gt;&gt;<i> existing
</I>&gt;&gt;<i> &gt; pem bundle...no change
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> You need to locate the root CA and/or intermediate CA certificates used
</I>&gt;&gt;<i> to sign the domain servers certificate.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> You then need to identify *why* they are not being trusted by your OS
</I>&gt;&gt;<i> library.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Be sure to determine whether the CA which is missing is actually
</I>&gt;&gt;<i> trustworthy before adding it to your trusted set. More than a few of the
</I>&gt;&gt;<i> CA which are around are not trusted because they have been hacked or
</I>&gt;&gt;<i> caught signing forged certificates they should not have.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; Added as a separate pem i.e. sslproxy_foreign_intermediate_certs
</I>&gt;&gt;<i> &gt; /cygdrive/e/Squid/etc/ssl/extra-intermediate-CA.pem...no change
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; My sslbump related config lines are:
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; http_port 127.0.0.1:3128 ssl-bump generate-host-certificates=on
</I>&gt;&gt;<i> &gt; dynamic_cert_mem_cache_size=10MB cert=/cygdrive/e/Squid/etc/ssl/myCA.pem
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; capath=/cygdrive/e/Squid/etc/ssl
</I>&gt;&gt;<i> &gt; cafile=/cygdrive/e/Squid/etc/ssl/extra-intermediate-CA.pem
</I>&gt;&gt;<i> &gt; tls-dh=/cygdrive/e/Squid/etc/ssl/dhparam.pem
</I>&gt;&gt;<i> &gt; options=NO_SSLv2,NO_SSLv3,SINGLE_ECDH_USE
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> PS.  EECDH will not work unless you configure a curve name in the
</I>&gt;&gt;<i> tls-dh= option. Just having dhparam.pem alone will only enable the less
</I>&gt;&gt;<i> secure DH ciphers.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Amos
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> [hidden email] &lt;<A HREF="http:///user/SendEmail.jtp?type=node&amp;node=4681642&amp;i=0">http:///user/SendEmail.jtp?type=node&amp;node=4681642&amp;i=0</A>&gt;
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ------------------------------
</I>&gt;&gt;<i> If you reply to this email, your message will be added to the discussion
</I>&gt;&gt;<i> below:
</I>&gt;&gt;<i> <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/SSL-Bump-">http://squid-web-proxy-cache.1019090.n4.nabble.com/SSL-Bump-</A>
</I>&gt;&gt;<i> and-Certificate-issue-RapidSSL-Intermediate-Cert-tp4681635p4681642.html
</I>&gt;&gt;<i> To unsubscribe from SSL Bump and Certificate issue - RapidSSL
</I>&gt;&gt;<i> Intermediate Cert, click here
</I>&gt;&gt;<i> &lt;<A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&amp;node=4681635&amp;code=YWRyaWFuLm0ubWlsbGVyQGdtYWlsLmNvbXw0NjgxNjM1fDE5ODY3MjIyMDI=">http://squid-web-proxy-cache.1019090.n4.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&amp;node=4681635&amp;code=YWRyaWFuLm0ubWlsbGVyQGdtYWlsLmNvbXw0NjgxNjM1fDE5ODY3MjIyMDI=</A>&gt;
</I>&gt;&gt;<i> .
</I>&gt;&gt;<i> NAML
</I>&gt;&gt;<i> &lt;<A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&amp;id=instant_html%21nabble%3Aemail.naml&amp;base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&amp;breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml">http://squid-web-proxy-cache.1019090.n4.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&amp;id=instant_html%21nabble%3Aemail.naml&amp;base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&amp;breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>

-- 
I hate to advocate *drugs*, *alcohol*,* violence *or
*insanity* to anyone, *but* they've *always* worked for* me*

- Hunter S. Thompson




--
View this message in context: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/SSL-Bump-and-Certificate-issue-RapidSSL-Intermediate-Cert-tp4681635p4681646.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/SSL-Bump-and-Certificate-issue-RapidSSL-Intermediate-Cert-tp4681635p4681646.html</A>
Sent from the Squid - Users mailing list archive at Nabble.com.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014547.html">[squid-users] SSL Bump and Certificate issue - RapidSSL	Intermediate Cert
</A></li>
	<LI>Next message (by thread): <A HREF="014551.html">[squid-users] SSL Bump and Certificate issue - RapidSSL	Intermediate Cert
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14550">[ date ]</a>
              <a href="thread.html#14550">[ thread ]</a>
              <a href="subject.html#14550">[ subject ]</a>
              <a href="author.html#14550">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
