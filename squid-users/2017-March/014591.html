<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid errors in error.log and slow internet from	squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20errors%20in%20error.log%20and%20slow%20internet%20from%0A%09squid&In-Reply-To=%3C96d601d2950f%24e04f57f0%24a0ee07d0%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014589.html">
   <LINK REL="Next"  HREF="014592.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid errors in error.log and slow internet from	squid</H1>
    <B>Eliezer  Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20errors%20in%20error.log%20and%20slow%20internet%20from%0A%09squid&In-Reply-To=%3C96d601d2950f%24e04f57f0%24a0ee07d0%24%40ngtech.co.il%3E"
       TITLE="[squid-users] squid errors in error.log and slow internet from	squid">eliezer at ngtech.co.il
       </A><BR>
    <I>Sat Mar  4 17:50:56 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014589.html">[squid-users] squid errors in error.log and slow internet from squid
</A></li>
        <LI>Next message (by thread): <A HREF="014592.html">[squid-users] reverse proxy HTTPS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14591">[ date ]</a>
              <a href="thread.html#14591">[ thread ]</a>
              <a href="subject.html#14591">[ subject ]</a>
              <a href="author.html#14591">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Two things:
First change the:
quick_abort_min -1

or remove it since it can do much harm on many cases and is useful only for specific ones.
Also try to remove all the refresh_pattern lines except for the defaults just to make sure they do not cause the server to move slow.
To understand the size of your service please attach the squid manager info page.
Have you checked CPU or memory usage when the service is slow?

using the cache manager can be seen at: <A HREF="http://wiki.squid-cache.org/Features/CacheManager#default">http://wiki.squid-cache.org/Features/CacheManager#default</A>
And you can use curl with something like <A HREF="http://mycache.example.com:3128/squid-internal-mgr/info">http://mycache.example.com:3128/squid-internal-mgr/info</A>

Eliezer

----
<A HREF="http://ngtech.co.il/lmgtfy/">http://ngtech.co.il/lmgtfy/</A>
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>


From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Hardik Dangar
Sent: Saturday, March 4, 2017 11:58 AM
To: Squid Users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
Subject: [squid-users] squid errors in error.log and slow internet from squid

Hello,

I have been facing few squid issues lately. we are about 40 users mostly linux, some mac and some windows system.

squid has become very slow for some reason. we can check that by bypassing squid and opening same urls. Second thing we are seeing swap mismatch errors and only solution we found is to remove swap file and use squid -z that will make things work for a day. other than that there are other errors in squid log too.

/var/cache/squid directory has became around 80 gb.

Here is our squid version and conf file 

Squid Cache: Version 3.5.23
Service Name: squid
configure options:  '--prefix=/usr' '--localstatedir=/var/squid' '--libexecdir=/lib/squid' '--srcdir=.' '--datadir=/share/squid' '--sysconfdir=/etc/squid' '--with-default-user=proxy' '--with-logdir=/var/log/squid' '--with-pidfile=/var/run/squid.pid' '--with-openssl' '--enable-ssl-crtd' '--enable-inline' '--disable-arch-native' '--enable-async-io=8' '--enable-storeio=ufs,aufs,diskd,rock' '--enable-removal-policies=lru,heap' '--enable-delay-pools' '--enable-follow-x-forwarded-for' '--enable-url-rewrite-helpers=fake' '--enable-ecap' '--enable-arp-acl' '--disable-translation'


Squid.conf file
<A HREF="https://gist.githubusercontent.com/hardikdangar/44f424e5a0be0a2a12ebc53a25a29629/raw/6e70682601b03732b662094ea7f4e79fb80a3851/squid.conf">https://gist.githubusercontent.com/hardikdangar/44f424e5a0be0a2a12ebc53a25a29629/raw/6e70682601b03732b662094ea7f4e79fb80a3851/squid.conf</A>

Squid error log
<A HREF="http://pastebin.com/raw/J7Ws2WKT">http://pastebin.com/raw/J7Ws2WKT</A>
if you see error log file you can see  Error negotiating SSL errors and  Ignoring malformed cache entry errors frequently.


squid access also have lot of entries like,
1488621158.416   1316 192.168.1.51 TAG_NONE/200 0 CONNECT <A HREF="http://35.154.95.34:443">http://35.154.95.34:443</A> - ORIGINAL_DST/<A HREF="http://35.154.95.34">http://35.154.95.34</A> -
1488621158.416   1315 192.168.1.51 TAG_NONE/200 0 CONNECT <A HREF="http://35.154.95.34:443">http://35.154.95.34:443</A> - ORIGINAL_DST/<A HREF="http://35.154.95.34">http://35.154.95.34</A> 
which i believe https requests which have certificate issues. this has became growing for mac machines.

Anybody else have similar issues?

We are not sure weather it was the 3.5.23 upgrade or adding Mac systems to our network is causing these issues. but squid has certainly become slow for lots of people to the point we have to bypass them.


Thank you very much for reading through the post. Let me know if you find any issues with our config or anything that can help us figuring out whats the issue.

Have a good day.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014589.html">[squid-users] squid errors in error.log and slow internet from squid
</A></li>
	<LI>Next message (by thread): <A HREF="014592.html">[squid-users] reverse proxy HTTPS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14591">[ date ]</a>
              <a href="thread.html#14591">[ thread ]</a>
              <a href="subject.html#14591">[ subject ]</a>
              <a href="author.html#14591">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
