<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Ssl bump tunneling connection by using Common Name
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Ssl%20bump%20tunneling%20connection%20by%20using%20Common%20Name&In-Reply-To=%3CCAHWcLuOGMmnPA%3DteUUSzycw_CFbfmMxQGp2XvjiaBHE52PyEBQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014612.html">
   <LINK REL="Next"  HREF="014598.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Ssl bump tunneling connection by using Common Name</H1>
    <B>Hanoch Hanoch K</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Ssl%20bump%20tunneling%20connection%20by%20using%20Common%20Name&In-Reply-To=%3CCAHWcLuOGMmnPA%3DteUUSzycw_CFbfmMxQGp2XvjiaBHE52PyEBQ%40mail.gmail.com%3E"
       TITLE="[squid-users] Ssl bump tunneling connection by using Common Name">for.work2920 at gmail.com
       </A><BR>
    <I>Mon Mar  6 13:46:42 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014612.html">[squid-users] squid 3.5.24 Host header forgery detected
</A></li>
        <LI>Next message (by thread): <A HREF="014598.html">[squid-users] Ssl bump tunneling connection by using Common Name
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14596">[ date ]</a>
              <a href="thread.html#14596">[ thread ]</a>
              <a href="subject.html#14596">[ subject ]</a>
              <a href="author.html#14596">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Greetings

We're using Squid 3.5.19 with ssl bump,
and we want to tunnel (not bump) applications such as skype, that use
pinned ssl,
so we defined an acl for splicing skype's ssl_server_name.

However skype's client app uses client certificates that don't have SNI.
The only way to identify skype is its Common Name: *.dc.trouter.io

But the Common Name is available only in step3 of ssl bump,
where tunneling the connection is no longer possible (as documented in peek
and splice step3 docs).
What we get is bumping.

Is there a way we can tunnel an acl based on Common Name?

ty


http_port 3127
http_port 3128 intercept
https_port 3129 ssl-bump intercept generate-host-certificates=on
dynamic_cert_mem_cache_size=4MB cert=/etc/squid/ssl_cert/myCA.pem
always_direct allow all
acl DiscoverSNIHost at_step SslBump1
acl NoSSLIntercept ssl::server_name_regex -i (microsoft|msn|windows|update|
skype.com|go.trouter.io|secure.adnxs.compipe.skype.com|skype-m.hotmail.com|
mobile.pipe.aria.microsoft.com|edge.skype.com|api.cc.skype.com|a.config.sky
pe.com|clientlogin.cdn.skype.com|.dc.trouter.io|ui.skype.com|apps.skype.com|
registrar-rr.prod.registrar.skype.com|secure.skypeassets.com|c1.skype.com)
ssl_bump splice NoSSLIntercept
ssl_bump peek DiscoverSNIHost
ssl_bump bump all

sslproxy_cert_error allow all
sslproxy_flags DONT_VERIFY_PEER
sslcrtd_program /usr/lib/squid/ssl_crtd -s /var/lib/ssl_db -M 4MB
sslcrtd_children 5
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170306/85700560/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170306/85700560/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014612.html">[squid-users] squid 3.5.24 Host header forgery detected
</A></li>
	<LI>Next message (by thread): <A HREF="014598.html">[squid-users] Ssl bump tunneling connection by using Common Name
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14596">[ date ]</a>
              <a href="thread.html#14596">[ thread ]</a>
              <a href="subject.html#14596">[ subject ]</a>
              <a href="author.html#14596">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
