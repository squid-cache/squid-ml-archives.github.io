<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Ssl bump tunneling connection by using Common Name
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Ssl%20bump%20tunneling%20connection%20by%20using%20Common%20Name&In-Reply-To=%3C941f65cb-fc84-0bb6-a0ca-e94c9515b3ac%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014596.html">
   <LINK REL="Next"  HREF="014599.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Ssl bump tunneling connection by using Common Name</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Ssl%20bump%20tunneling%20connection%20by%20using%20Common%20Name&In-Reply-To=%3C941f65cb-fc84-0bb6-a0ca-e94c9515b3ac%40measurement-factory.com%3E"
       TITLE="[squid-users] Ssl bump tunneling connection by using Common Name">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Mar  6 16:36:33 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014596.html">[squid-users] Ssl bump tunneling connection by using Common Name
</A></li>
        <LI>Next message (by thread): <A HREF="014599.html">[squid-users] Ssl bump tunneling connection by using Common Name
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14598">[ date ]</a>
              <a href="thread.html#14598">[ thread ]</a>
              <a href="subject.html#14598">[ subject ]</a>
              <a href="author.html#14598">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 03/06/2017 06:46 AM, Hanoch Hanoch K wrote:

&gt;<i> However skype's client app uses client certificates that don't have SNI.
</I>
SNI is not a property of a client certificate. It is a property of a
client Hello message. I do not know whether some Skype clients do not
send SNI with their Hellos, but I wanted to correct the above
misconception for the record.


&gt;<i> the Common Name is available only in step3 of ssl bump,
</I>
This part is correct. Squid receives the server handshake messages,
including the server certificate during step3.


&gt;<i> where tunneling the connection is no longer possible (as documented in
</I>&gt;<i> peek and splice step3 docs).
</I>
This is somewhat misleading: Splicing after step3 works fine, provided
the &quot;peek&quot; action matched at step2. In other words, splicing works after
peeking.

Needless to say, bumping configurations cannot peek during step3 -- they
have to either stare or bump instead.

&gt;<i> acl DiscoverSNIHost at_step SslBump1
</I>&gt;<i> acl NoSSLIntercept ssl::server_name_regex -i ...
</I>&gt;<i> ssl_bump splice NoSSLIntercept
</I>&gt;<i> ssl_bump peek DiscoverSNIHost
</I>&gt;<i> ssl_bump bump all
</I>
Your configuration usually peeks [at the client Hello] during step2 and
either splices or bumps during step3.


&gt;<i> Is there a way we can tunnel an acl based on Common Name?
</I>
Yes, but you will not be able to bump then.

If some Skype clients do not send SNI, then your options include:

* do not bump any connections;

* match Skype connections using destination IP addresses (lots of
maintenance headaches and some errors, but doable);

* enhance Squid to detect something that is unique to Skype client
handshake messages sent _before_ the client receives the server Hello.
For example, if (and only if) the Skype client sends its certificate
before receiving the server Hello, then Squid can be enhanced to detect
and interrogate that client certificate using ACLs.

Pick your poison.

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014596.html">[squid-users] Ssl bump tunneling connection by using Common Name
</A></li>
	<LI>Next message (by thread): <A HREF="014599.html">[squid-users] Ssl bump tunneling connection by using Common Name
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14598">[ date ]</a>
              <a href="thread.html#14598">[ thread ]</a>
              <a href="subject.html#14598">[ subject ]</a>
              <a href="author.html#14598">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
