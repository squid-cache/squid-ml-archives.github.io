<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] microsoft edge and proxy auth not working
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20microsoft%20edge%20and%20proxy%20auth%20not%20working&In-Reply-To=%3C2197768425D7F5479A0FFB3FEC212F7FF5D8D1A3%40aesmail.surcouf.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014640.html">
   <LINK REL="Next"  HREF="014652.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] microsoft edge and proxy auth not working</H1>
    <B>Mike Surcouf</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20microsoft%20edge%20and%20proxy%20auth%20not%20working&In-Reply-To=%3C2197768425D7F5479A0FFB3FEC212F7FF5D8D1A3%40aesmail.surcouf.local%3E"
       TITLE="[squid-users] microsoft edge and proxy auth not working">mikes at surcouf.co.uk
       </A><BR>
    <I>Thu Mar  9 17:57:37 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014640.html">[squid-users] microsoft edge and proxy auth not working
</A></li>
        <LI>Next message (by thread): <A HREF="014652.html">[squid-users] microsoft edge and proxy auth not working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14651">[ date ]</a>
              <a href="thread.html#14651">[ thread ]</a>
              <a href="subject.html#14651">[ subject ]</a>
              <a href="author.html#14651">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Rafael

Is there any reason you can't use Kerberos.
Note you will need to create a keytab but the setup is not that hard and in the docs.
I use it very successfully on window AD network.

auth_param negotiate program /usr/lib64/squid/negotiate_kerberos_auth
auth_param negotiate children 20
auth_param negotiate keep_alive on

Thanks

Mike

-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Rafael Akchurin
Sent: 09 March 2017 17:01
To: Amos Jeffries; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] microsoft edge and proxy auth not working

Hello Amos, Markus, all,

Just as a side note - I also suffered  from this error sometime before with Edge and our custom NTLM relay to domain controllers (run as auth helper by Squid). The strange thing it went away after installing some (unknown) Windows update.

I do have the &quot;auth_param ntlm keep_alive off&quot; in the config though.

It all makes me quite suspicious the error was/is in Edge or in my curly hands.

Best regards,
Rafael Akchurin
Diladele B.V.

-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Amos Jeffries
Sent: Thursday, March 9, 2017 5:12 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] microsoft edge and proxy auth not working

On 8/03/2017 11:28 p.m., Rietzler, Markus (RZF, Aufg 324 /
&lt;RIETZLER_SOFTWARE&gt;) wrote:
&gt;<i> i should add that we are using squid 3.5.24.
</I>&gt;<i> 
</I>
Try with &quot;auth_param ntlm keep_alive off&quot;. Recently the browsers have been needing that.

Though frankly I am surprised if Edge supports NTLM at all. It was deprecated in April 2006 and MS announced removal was being actively pushed in all thier software since Win7.

&gt;<i> 
</I>&gt;&gt;<i> -----Urspr&#252;ngliche Nachricht-----
</I>&gt;&gt;<i> Von: Rietzler, Markus
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> we have some windows 10 clients using microsoft edge browser.
</I>&gt;&gt;<i> access to internet is only allowed for authenticated users. we are 
</I>&gt;&gt;<i> using samba/winbind auth
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> auth_param ntlm program /usr/bin/ntlm_auth
</I>&gt;&gt;<i> --helper-protocol=squid-2.5- ntlmssp auth_param ntlm children 64
</I>&gt;&gt;<i> startup=24 idle=12 auth_param ntlm keep_alive on acl auth_user 
</I>&gt;&gt;<i> proxy_auth REQUIRED
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> on windows 10 clients with IE11 it is working (with ntlm automatic
</I>&gt;&gt;<i> auth) on the same machine, with Microsoft edge I get TCP_Denied/407 message.
</I>&gt;&gt;<i> seems I only get one single TCP_DENIED/407 line in accesslog and an 
</I>&gt;&gt;<i> auth dialog pops up. I have disabled basic auth via ntlm.
</I>&gt;&gt;<i> shouldn't there be 3 lines for proxy auth? with IE11 I see those 
</I>&gt;&gt;<i> three lines (2x TCP_DENIED/407 and 1x TCP_MISS/200), no popup at all.
</I>
Not specifically. There should be 1+ for NTLM. Success with NTLM shows
2+. Failure shows 1 or 3 or infinite loop (hello Safari and Firefox 30-ish).


&gt;&gt;<i>
</I>&gt;&gt;<i> winbind/samba itself seems to work, as I can do an user auth against 
</I>&gt;&gt;<i> apache with winbind/samba - even over some squid proxies with 
</I>&gt;&gt;<i> connection-auth allowed. but not for proxy-auth.
</I>&gt;&gt;<i> is there any option in squid.conf which prevents Edge to do a 
</I>&gt;&gt;<i> successful auth?
</I>
If other software succeeds then the only thing that might be related is the keep-alive option mentioned above. Otherwise the problem is in Edge itself.

Amos

_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014640.html">[squid-users] microsoft edge and proxy auth not working
</A></li>
	<LI>Next message (by thread): <A HREF="014652.html">[squid-users] microsoft edge and proxy auth not working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14651">[ date ]</a>
              <a href="thread.html#14651">[ thread ]</a>
              <a href="subject.html#14651">[ subject ]</a>
              <a href="author.html#14651">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
