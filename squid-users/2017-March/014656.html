<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] microsoft edge and proxy auth not working
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20microsoft%20edge%20and%20proxy%20auth%20not%20working&In-Reply-To=%3C2ee41650-b5bf-2bd4-33c7-43461da35d8f%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014655.html">
   <LINK REL="Next"  HREF="014662.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] microsoft edge and proxy auth not working</H1>
    <B>Brendan Kearney</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20microsoft%20edge%20and%20proxy%20auth%20not%20working&In-Reply-To=%3C2ee41650-b5bf-2bd4-33c7-43461da35d8f%40gmail.com%3E"
       TITLE="[squid-users] microsoft edge and proxy auth not working">bpk678 at gmail.com
       </A><BR>
    <I>Thu Mar  9 19:22:04 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014655.html">[squid-users] microsoft edge and proxy auth not working
</A></li>
        <LI>Next message (by thread): <A HREF="014662.html">[squid-users] microsoft edge and proxy auth not working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14656">[ date ]</a>
              <a href="thread.html#14656">[ thread ]</a>
              <a href="subject.html#14656">[ subject ]</a>
              <a href="author.html#14656">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>adding this back to the mailing list, for the benefit of those who 
search for it.

i do not have simple and easy to use instructions for mac os x and linux 
participation in AD.  it is not a simple task.  on linux, you will need 
to look into SSSD (Simple Security Services Daemon) and understand that 
process.

i have a mac for work, and it is a domain member object, so i know it 
can be done.  i dont know how it is done, and would think there are 
internet articles that you can search for on the subject.

On 03/09/2017 02:13 PM, Rafael Akchurin wrote:
&gt;<i> Hello Brendan,
</I>&gt;<i>
</I>&gt;<i> Yes by default we have NTLM disabled :)
</I>&gt;<i>
</I>&gt;<i> Unfortunately we must keep the proxy solution in parity with DC capabilities in AD which luckily still support NTLM authentication through LDAP.
</I>&gt;<i>
</I>&gt;<i> This allows us to relay the tokens without Samba as I described in previous mail.
</I>&gt;<i>
</I>&gt;<i> BTW if you could share the ready to use (simple) instructions to have Kerberous auth supported ftom Mac/iPhone/iPad and Linux (Ubuntu/CentOS) it would be beneficial to all.
</I>&gt;<i>
</I>&gt;<i> Best regards,
</I>&gt;<i> Rafael Akchurin
</I>&gt;<i>
</I>&gt;&gt;<i> Op 9 mrt. 2017 om 19:47 heeft Brendan Kearney &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">bpk678 at gmail.com</A>&gt; het volgende geschreven:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On 03/09/2017 01:17 PM, Rafael Akchurin wrote:
</I>&gt;&gt;&gt;<i> The thing is, when you got some machines in your network which are not joined to the domain (think apple, linux) you still need NTLM support on proxy :(
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> And having full blown Samba just because of those few is too much of admin's hassle - so we had to write NTLM relay that would rebind to domain controller with LDAP protocol passing NTLM token back and forth.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Joining Squid proxy to the domain (which is required to authenticate using Samba/NTLM) also prevents from successful reverts from vm snapshots after 30 days and requires rejoin - thus preventing us from creating easily provisioned/thrown away scalable web filter / proxy instances (think docker).
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Best regards,
</I>&gt;&gt;&gt;<i> Rafael Akchurin
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Op 9 mrt. 2017 om 19:09 heeft Mike Surcouf &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">mikes at surcouf.co.uk</A>&gt; het volgende geschreven:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Ah OK sorry
</I>&gt;&gt;&gt;&gt;<i> I am curious why you have a reason to use NTLM over Kerberos? :-)
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> -----Original Message-----
</I>&gt;&gt;&gt;&gt;<i> From: Rafael Akchurin [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rafael.akchurin at diladele.com</A>]
</I>&gt;&gt;&gt;&gt;<i> Sent: 09 March 2017 18:01
</I>&gt;&gt;&gt;&gt;<i> To: Mike Surcouf
</I>&gt;&gt;&gt;&gt;<i> Cc: Amos Jeffries; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;&gt;&gt;<i> Subject: Re: [squid-users] microsoft edge and proxy auth not working
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Hello Mike,
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> I specifically was debugging our NTLM implementation with Edge :)
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Kerberos works just fine, you are correct.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Best regards,
</I>&gt;&gt;&gt;&gt;<i> Rafael Akchurin
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Op 9 mrt. 2017 om 18:57 heeft Mike Surcouf &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">mikes at surcouf.co.uk</A>&gt; het volgende geschreven:
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Hi Rafael
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Is there any reason you can't use Kerberos.
</I>&gt;&gt;&gt;&gt;&gt;<i> Note you will need to create a keytab but the setup is not that hard and in the docs.
</I>&gt;&gt;&gt;&gt;&gt;<i> I use it very successfully on window AD network.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> auth_param negotiate program /usr/lib64/squid/negotiate_kerberos_auth
</I>&gt;&gt;&gt;&gt;&gt;<i> auth_param negotiate children 20
</I>&gt;&gt;&gt;&gt;&gt;<i> auth_param negotiate keep_alive on
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Thanks
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Mike
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> -----Original Message-----
</I>&gt;&gt;&gt;&gt;&gt;<i> From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>]
</I>&gt;&gt;&gt;&gt;&gt;<i> On Behalf Of Rafael Akchurin
</I>&gt;&gt;&gt;&gt;&gt;<i> Sent: 09 March 2017 17:01
</I>&gt;&gt;&gt;&gt;&gt;<i> To: Amos Jeffries; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;&gt;&gt;&gt;<i> Subject: Re: [squid-users] microsoft edge and proxy auth not working
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Hello Amos, Markus, all,
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Just as a side note - I also suffered  from this error sometime before with Edge and our custom NTLM relay to domain controllers (run as auth helper by Squid). The strange thing it went away after installing some (unknown) Windows update.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> I do have the &quot;auth_param ntlm keep_alive off&quot; in the config though.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> It all makes me quite suspicious the error was/is in Edge or in my curly hands.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Best regards,
</I>&gt;&gt;&gt;&gt;&gt;<i> Rafael Akchurin
</I>&gt;&gt;&gt;&gt;&gt;<i> Diladele B.V.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> -----Original Message-----
</I>&gt;&gt;&gt;&gt;&gt;<i> From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>]
</I>&gt;&gt;&gt;&gt;&gt;<i> On Behalf Of Amos Jeffries
</I>&gt;&gt;&gt;&gt;&gt;<i> Sent: Thursday, March 9, 2017 5:12 PM
</I>&gt;&gt;&gt;&gt;&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;&gt;&gt;&gt;<i> Subject: Re: [squid-users] microsoft edge and proxy auth not working
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> On 8/03/2017 11:28 p.m., Rietzler, Markus (RZF, Aufg 324 /
</I>&gt;&gt;&gt;&gt;&gt;<i> &lt;RIETZLER_SOFTWARE&gt;) wrote:
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> i should add that we are using squid 3.5.24.
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Try with &quot;auth_param ntlm keep_alive off&quot;. Recently the browsers have been needing that.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Though frankly I am surprised if Edge supports NTLM at all. It was deprecated in April 2006 and MS announced removal was being actively pushed in all thier software since Win7.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> -----Urspr&#252;ngliche Nachricht-----
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> Von: Rietzler, Markus
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> we have some windows 10 clients using microsoft edge browser.
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> access to internet is only allowed for authenticated users. we are
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> using samba/winbind auth
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> auth_param ntlm program /usr/bin/ntlm_auth
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> --helper-protocol=squid-2.5- ntlmssp auth_param ntlm children 64
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> startup=24 idle=12 auth_param ntlm keep_alive on acl auth_user
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> proxy_auth REQUIRED
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> on windows 10 clients with IE11 it is working (with ntlm automatic
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> auth) on the same machine, with Microsoft edge I get TCP_Denied/407 message.
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> seems I only get one single TCP_DENIED/407 line in accesslog and an
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> auth dialog pops up. I have disabled basic auth via ntlm.
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> shouldn't there be 3 lines for proxy auth? with IE11 I see those
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> three lines (2x TCP_DENIED/407 and 1x TCP_MISS/200), no popup at all.
</I>&gt;&gt;&gt;&gt;&gt;<i> Not specifically. There should be 1+ for NTLM. Success with NTLM shows
</I>&gt;&gt;&gt;&gt;&gt;<i> 2+. Failure shows 1 or 3 or infinite loop (hello Safari and Firefox 30-ish).
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> winbind/samba itself seems to work, as I can do an user auth against
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> apache with winbind/samba - even over some squid proxies with
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> connection-auth allowed. but not for proxy-auth.
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> is there any option in squid.conf which prevents Edge to do a
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> successful auth?
</I>&gt;&gt;&gt;&gt;&gt;<i> If other software succeeds then the only thing that might be related is the keep-alive option mentioned above. Otherwise the problem is in Edge itself.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Amos
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;&gt;&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;&gt;&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;&gt;&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;&gt;&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i> mac os x and linux can be joined to the domain and use kerberos auth.  it sounds like you have a &quot;dont want to&quot; situation, instead of a &quot;cannot&quot; situation there.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> when both kerberos and ntlm are advertised as supported by the proxy, the client will negotiate which auth method is used.  when both the client and the proxy support kerberos, that will be used.  if the client is then not able to pull a ticket from the directory to satisfy the kerberos auth to the proxy, the auth fails.  the fall back to ntlm as the auth method will not occur in this situation.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ntlm will only be used if one or both of the parties does not support kerberos, and therefore the negotiated auth method chosen is not kerberos.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> in Edge, disable the IWA (Integrated Windows Authentication) under Advanced settings, and close/relaunch any browser windows. this should get you using only ntlm.  effectively, you are forcing the client to not support kerberos and preventing that auth method from being negotiated for use.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> hth,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> brendan
</I>&gt;&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014655.html">[squid-users] microsoft edge and proxy auth not working
</A></li>
	<LI>Next message (by thread): <A HREF="014662.html">[squid-users] microsoft edge and proxy auth not working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14656">[ date ]</a>
              <a href="thread.html#14656">[ thread ]</a>
              <a href="subject.html#14656">[ subject ]</a>
              <a href="author.html#14656">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
