<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] microsoft edge and proxy auth not working
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20microsoft%20edge%20and%20proxy%20auth%20not%20working&In-Reply-To=%3CVI1PR0401MB268541F69D8382ABC23ABB3E8F200%40VI1PR0401MB2685.eurprd04.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014663.html">
   <LINK REL="Next"  HREF="014661.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] microsoft edge and proxy auth not working</H1>
    <B>Rafael Akchurin</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20microsoft%20edge%20and%20proxy%20auth%20not%20working&In-Reply-To=%3CVI1PR0401MB268541F69D8382ABC23ABB3E8F200%40VI1PR0401MB2685.eurprd04.prod.outlook.com%3E"
       TITLE="[squid-users] microsoft edge and proxy auth not working">rafael.akchurin at diladele.com
       </A><BR>
    <I>Fri Mar 10 10:35:15 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014663.html">[squid-users] microsoft edge and proxy auth not working
</A></li>
        <LI>Next message (by thread): <A HREF="014661.html">[squid-users] microsoft edge and proxy auth not working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14664">[ date ]</a>
              <a href="thread.html#14664">[ thread ]</a>
              <a href="subject.html#14664">[ subject ]</a>
              <a href="author.html#14664">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello all,

There is another way (not better but another) that does not require you do join squid machines to domain: Map proxy SPN to a designated user. I describe this at <A HREF="https://docs.diladele.com/administrator_guide_4_9/active_directory/create_user/index.html">https://docs.diladele.com/administrator_guide_4_9/active_directory/create_user/index.html</A>

Pros - have one user that can be used by farm of squid proxies without the need to join boxes to domain.
Cons - that one user needs to be managed separately from all other users - i.e. you do not want to set the password expiration policy for it - otherwise your exported keytab will be invalid.

My 2 cents.

Rafael Akchurin
Diladele B.V.


-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Mike Surcouf
Sent: Friday, March 10, 2017 10:56 AM
To: 'Rietzler, Markus (RZF, Aufg 324 / &lt;RIETZLER_SOFTWARE&gt;)' &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">markus.rietzler at fv.nrw.de</A>&gt;; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] microsoft edge and proxy auth not working

Are the browsing machines domain joined?
If so and you are just talking about joining the squid proxies to the domains for auth delegation to the dcs this is greatly simplified with realmd now.
Could probably be scripted quite easily.

-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Rietzler, Markus (RZF, Aufg 324 / &lt;RIETZLER_SOFTWARE&gt;)
Sent: 10 March 2017 09:53
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] microsoft edge and proxy auth not working

Kerberos is on the wishlist for very long. 
one reason was: the setup is a bit complicated and we do have 150 proxies in our subsidiaries. so we need 150 different Kerberos setups with 150 trusts and tickets and certificates etc. so we work on this to have it someday replaced...

thanxs

&gt;<i> -----Urspr&#252;ngliche Nachricht-----
</I>&gt;<i> Von: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] Im 
</I>&gt;<i> Auftrag von Mike Surcouf
</I>&gt;<i> Gesendet: Donnerstag, 9. M&#228;rz 2017 18:58
</I>&gt;<i> An: 'Rafael Akchurin'; Amos Jeffries; 
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Betreff: Re: [squid-users] microsoft edge and proxy auth not working
</I>&gt;<i> 
</I>&gt;<i> Hi Rafael
</I>&gt;<i> 
</I>&gt;<i> Is there any reason you can't use Kerberos.
</I>&gt;<i> Note you will need to create a keytab but the setup is not that hard 
</I>&gt;<i> and in the docs.
</I>&gt;<i> I use it very successfully on window AD network.
</I>&gt;<i> 
</I>&gt;<i> auth_param negotiate program /usr/lib64/squid/negotiate_kerberos_auth
</I>&gt;<i> auth_param negotiate children 20
</I>&gt;<i> auth_param negotiate keep_alive on
</I>&gt;<i> 
</I>&gt;<i> Thanks
</I>&gt;<i> 
</I>&gt;<i> Mike
</I>&gt;<i> 
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>]
</I>&gt;<i> On Behalf Of Rafael Akchurin
</I>&gt;<i> Sent: 09 March 2017 17:01
</I>&gt;<i> To: Amos Jeffries; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: Re: [squid-users] microsoft edge and proxy auth not working
</I>&gt;<i> 
</I>&gt;<i> Hello Amos, Markus, all,
</I>&gt;<i> 
</I>&gt;<i> Just as a side note - I also suffered  from this error sometime before 
</I>&gt;<i> with Edge and our custom NTLM relay to domain controllers (run as auth 
</I>&gt;<i> helper by Squid). The strange thing it went away after installing some
</I>&gt;<i> (unknown) Windows update.
</I>&gt;<i> 
</I>&gt;<i> I do have the &quot;auth_param ntlm keep_alive off&quot; in the config though.
</I>&gt;<i> 
</I>&gt;<i> It all makes me quite suspicious the error was/is in Edge or in my 
</I>&gt;<i> curly hands.
</I>&gt;<i> 
</I>&gt;<i> Best regards,
</I>&gt;<i> Rafael Akchurin
</I>&gt;<i> Diladele B.V.
</I>&gt;<i> 
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>]
</I>&gt;<i> On Behalf Of Amos Jeffries
</I>&gt;<i> Sent: Thursday, March 9, 2017 5:12 PM
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: Re: [squid-users] microsoft edge and proxy auth not working
</I>&gt;<i> 
</I>&gt;<i> On 8/03/2017 11:28 p.m., Rietzler, Markus (RZF, Aufg 324 /
</I>&gt;<i> &lt;RIETZLER_SOFTWARE&gt;) wrote:
</I>&gt;<i> &gt; i should add that we are using squid 3.5.24.
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>&gt;<i> Try with &quot;auth_param ntlm keep_alive off&quot;. Recently the browsers have 
</I>&gt;<i> been needing that.
</I>&gt;<i> 
</I>&gt;<i> Though frankly I am surprised if Edge supports NTLM at all. It was 
</I>&gt;<i> deprecated in April 2006 and MS announced removal was being actively 
</I>&gt;<i> pushed in all thier software since Win7.
</I>&gt;<i> 
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; -----Urspr&#252;ngliche Nachricht-----
</I>&gt;<i> &gt;&gt; Von: Rietzler, Markus
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; we have some windows 10 clients using microsoft edge browser.
</I>&gt;<i> &gt;&gt; access to internet is only allowed for authenticated users. we are 
</I>&gt;<i> &gt;&gt; using samba/winbind auth
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; auth_param ntlm program /usr/bin/ntlm_auth
</I>&gt;<i> &gt;&gt; --helper-protocol=squid-2.5- ntlmssp auth_param ntlm children 64
</I>&gt;<i> &gt;&gt; startup=24 idle=12 auth_param ntlm keep_alive on acl auth_user 
</I>&gt;<i> &gt;&gt; proxy_auth REQUIRED
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; on windows 10 clients with IE11 it is working (with ntlm automatic
</I>&gt;<i> &gt;&gt; auth) on the same machine, with Microsoft edge I get TCP_Denied/407
</I>&gt;<i> message.
</I>&gt;<i> &gt;&gt; seems I only get one single TCP_DENIED/407 line in accesslog and an 
</I>&gt;<i> &gt;&gt; auth dialog pops up. I have disabled basic auth via ntlm.
</I>&gt;<i> &gt;&gt; shouldn't there be 3 lines for proxy auth? with IE11 I see those 
</I>&gt;<i> &gt;&gt; three lines (2x TCP_DENIED/407 and 1x TCP_MISS/200), no popup at all.
</I>&gt;<i> 
</I>&gt;<i> Not specifically. There should be 1+ for NTLM. Success with NTLM shows
</I>&gt;<i> 2+. Failure shows 1 or 3 or infinite loop (hello Safari and Firefox
</I>&gt;<i> 2+30-
</I>&gt;<i> ish).
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; winbind/samba itself seems to work, as I can do an user auth 
</I>&gt;<i> &gt;&gt; against apache with winbind/samba - even over some squid proxies 
</I>&gt;<i> &gt;&gt; with connection-auth allowed. but not for proxy-auth.
</I>&gt;<i> &gt;&gt; is there any option in squid.conf which prevents Edge to do a 
</I>&gt;<i> &gt;&gt; successful auth?
</I>&gt;<i> 
</I>&gt;<i> If other software succeeds then the only thing that might be related 
</I>&gt;<i> is the keep-alive option mentioned above. Otherwise the problem is in 
</I>&gt;<i> Edge itself.
</I>&gt;<i> 
</I>&gt;<i> Amos
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014663.html">[squid-users] microsoft edge and proxy auth not working
</A></li>
	<LI>Next message (by thread): <A HREF="014661.html">[squid-users] microsoft edge and proxy auth not working
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14664">[ date ]</a>
              <a href="thread.html#14664">[ thread ]</a>
              <a href="subject.html#14664">[ subject ]</a>
              <a href="author.html#14664">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
