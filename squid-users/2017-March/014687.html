<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Data usage reported in log files
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Data%20usage%20reported%20in%20log%20files&In-Reply-To=%3C024901d29aa8%24d0a36c80%2471ea4580%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014684.html">
   <LINK REL="Next"  HREF="014674.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Data usage reported in log files</H1>
    <B>Eliezer  Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Data%20usage%20reported%20in%20log%20files&In-Reply-To=%3C024901d29aa8%24d0a36c80%2471ea4580%24%40ngtech.co.il%3E"
       TITLE="[squid-users] Data usage reported in log files">eliezer at ngtech.co.il
       </A><BR>
    <I>Sat Mar 11 20:48:19 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014684.html">[squid-users] Data usage reported in log files
</A></li>
        <LI>Next message (by thread): <A HREF="014674.html">[squid-users] Data usage reported in log files
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14687">[ date ]</a>
              <a href="thread.html#14687">[ thread ]</a>
              <a href="subject.html#14687">[ subject ]</a>
              <a href="author.html#14687">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Yosi,

Can you see if the differences is on the incoming or outgoing traffic?
Squid will only account for incoming and if you are using some kind of caching with the quick_abort and other partial content prefetch it would make sense that the actual consumption of the bits from the Internet to squid will not match from squid to clients.

If you can send me or share with others your squid.conf we might be able to understand if something there might cause such an issue.

Thanks,
Eliezer

* Feel free to contact me directly by skype or phone
----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>


-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Yosi Greenfield
Sent: Friday, March 10, 2017 11:47 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Data usage reported in log files

Gentlemen,

Thanks Antony. Yes, we are accounting for everything else. I'm talking about port 3128 and 3129 only. 

Any other traffic is being tracked both by netflow and tcpdump and they match. What does not match is 3128/9 and squid log.

I'll report back after the weekend if the discrepancy is all sslbump traffic.

Thank you all,
Yosi


-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Antony Stone
Sent: Friday, March 10, 2017 4:31 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Data usage reported in log files

On Friday 10 March 2017 at 22:22:59, Yuri Voinov wrote:

&gt;<i> Of course, there is no stream video from security cams, no voice IP, 
</I>&gt;<i> no SIP, no torrents, no RDP, no other protocol. They simple does not 
</I>&gt;<i> exists and we're all believe that's all not above over 1% of overall
</I>traffic.
&gt;<i> Yes. Sure. Really.
</I>&gt;<i> 
</I>&gt;<i> Only web-surfing :) Sure :)
</I>
Thanks for the standard sarcasm.

Has it occurred to you that Yosi might have been measuring traffic to &amp; from the IP of the Squid server, so as to ignore everything else he knows is happening on his network, so he can compare like with like?

My &quot;not more than 1%&quot; was for the additional traffic to/from the Squid server, other than HTTP/S.


Antony.

&gt;<i> 11.03.2017 3:19, Yuri Voinov &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;<i> &gt; 11.03.2017 2:57, Antony Stone &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;<i> &gt;&gt; On Friday 10 March 2017 at 21:50:19, Yuri Voinov wrote:
</I>&gt;<i> &gt;&gt;&gt; Gentlemen, and it never occurred to you that there are other types 
</I>&gt;<i> &gt;&gt;&gt; of traffic besides HTTP / HTTPS, right?
</I>&gt;<i> &gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt; DNS, ICMP, other protocols?
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; I'm assuming Yosi has been measuring only TCP traffic, but even if 
</I>&gt;<i> &gt;&gt; he's been measuring everything, I don't think DNS, ICMP and other 
</I>&gt;<i> &gt;&gt; protocols would add more than 1% on top of HTTP/S, unless (as 
</I>&gt;<i> &gt;&gt; Marcus suggested) there is also totally-non-Squid traffic on the link being measured.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Come on, sure? Even in L7? Really? Cool story, bro!
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;&gt; Antony.
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt; 11.03.2017 2:44, Yosi Greenfield &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;<i> &gt;&gt;&gt;&gt; Aha! That could be it. I use sslbump, but not for all users. I'll 
</I>&gt;<i> &gt;&gt;&gt;&gt; check that out, although I think that it's a problem even for 
</I>&gt;<i> &gt;&gt;&gt;&gt; bumped users. Even for bumped users we don't bump all sites, so 
</I>&gt;<i> &gt;&gt;&gt;&gt; that really could be it.
</I>&gt;<i> &gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt; Thanks!
</I>&gt;<i> &gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt; -----Original Message-----
</I>&gt;<i> &gt;&gt;&gt;&gt; From: squid-users 
</I>&gt;<i> &gt;&gt;&gt;&gt; [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>]
</I>&gt;<i> &gt;&gt;&gt;&gt; On Behalf Of Marcus Kool
</I>&gt;<i> &gt;&gt;&gt;&gt; Sent: Friday, March 10, 2017 3:38 PM
</I>&gt;<i> &gt;&gt;&gt;&gt; To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt;&gt;&gt;&gt; Subject: Re: [squid-users] Data usage reported in log files
</I>&gt;<i> &gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt; On 10/03/17 16:27, Yosi Greenfield wrote:
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Thanks!
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Netflow is much larger.
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; I really want to know exactly what site is costing my users data.
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Many of our users are on metered connections and are paying for 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; overage, but I can't tell where that overage is being used. Are 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; they using youtube, webmail, wetransfer? I see only a fraction 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; of their actual proxy usage in my squid logs.
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Data compression would give the opposite result, so that's not 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; what I'm seeing.
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Any other ideas?
</I>&gt;<i> &gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt; Is there any traffic that is not directed to Squid?
</I>&gt;<i> &gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt; Do you use ssl-bump in bump mode ?
</I>&gt;<i> &gt;&gt;&gt;&gt; If not, Squid has no idea how many bytes go through the (HTTPS) 
</I>&gt;<i> &gt;&gt;&gt;&gt; tunnels.
</I>&gt;<i> &gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt; Marcus
</I>&gt;<i> &gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; -----Original Message-----
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; From: squid-users 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>]
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; On Behalf Of Antony Stone
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Sent: Friday, March 10, 2017 2:21 PM
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Subject: Re: [squid-users] Data usage reported in log files
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; On Friday 10 March 2017 at 20:14:36, Yosi Greenfield wrote:
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; Hello all,
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; I'm analyzing my squid logs with sarg, and I see that the 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; number of bytes reported as used by any particular user are 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; often nowhere
</I>near
&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; the bytes reported by netflow and tcpdump.
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Which is larger?
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; I'm trying to trace my users' data usage by site, but I'm 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; unable to do so from the log files because of this.
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Well, what is it you really want to know?
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; netflow / tcpdump will give you accurate numbers for the 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; quantity of data on your Internet link - I assume this is what 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; you're most interested in?
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Squid will show you what quantity of data goes to/from the 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; clients, but is that really important?
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; Can someone please explain to me what I might be missing? Why 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; does squid log report one thing and netflow and tcpdump show 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;&gt; something else?
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Data compression?
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; HTTP responses are often gzipped, so if tcpdump is showing you 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; smaller numbers of bytes than Squid reports, that's what I'd 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; look at first.
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Antony.
</I>
--
&lt;flopsie&gt; yes, but this is #lbw, we don't do normal

                                                   Please reply to the list;
                                                         please *don't* CC me.
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>

_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014684.html">[squid-users] Data usage reported in log files
</A></li>
	<LI>Next message (by thread): <A HREF="014674.html">[squid-users] Data usage reported in log files
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14687">[ date ]</a>
              <a href="thread.html#14687">[ thread ]</a>
              <a href="subject.html#14687">[ subject ]</a>
              <a href="author.html#14687">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
