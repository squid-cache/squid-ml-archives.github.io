<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] reply_body_max_size question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20reply_body_max_size%20question&In-Reply-To=%3C5d8e9a9a-e8a0-d51e-a10b-0e45fa6ba566%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014690.html">
   <LINK REL="Next"  HREF="014740.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] reply_body_max_size question</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20reply_body_max_size%20question&In-Reply-To=%3C5d8e9a9a-e8a0-d51e-a10b-0e45fa6ba566%40treenet.co.nz%3E"
       TITLE="[squid-users] reply_body_max_size question">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Mar 15 02:49:04 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014690.html">[squid-users] reply_body_max_size question
</A></li>
        <LI>Next message (by thread): <A HREF="014740.html">[squid-users] reply_body_max_size question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14709">[ date ]</a>
              <a href="thread.html#14709">[ thread ]</a>
              <a href="subject.html#14709">[ subject ]</a>
              <a href="author.html#14709">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12/03/2017 8:11 p.m., Danny wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> Just want someone to confirm my current reply_body_max_size setup. I have a
</I>&gt;<i> simple network at home i.e: Debian with a wireless card (wlan0) which is bridged
</I>&gt;<i> (br0) to an ethernet card (eth0). All devices comes through the wireless card
</I>&gt;<i> (wlan0) and then of to the router.
</I>&gt;<i> 
</I>&gt;<i> I want &quot;localnet_sniper localnet_bridge localnet_fever localnet_44081 localnet_dannyS4&quot; to have unlimited download capabilty but
</I>&gt;<i> &quot;localnet_vS5mini localnet_anTab2 localnet_vTab3 localnet_samsungTV localnet_samsungDVD localnet_dhcp&quot; must be limited to a
</I>&gt;<i> 5MB download limit.
</I>&gt;<i> 
</I>&gt;<i> Here is my configuration:
</I>&gt;<i> ######################################################################################################################################
</I>&gt;<i> acl localnet src 10.0.0.0/24	# RFC1918 possible internal network
</I>&gt;<i> acl localnet_sniper src 10.0.0.3        #(eth0)
</I>&gt;<i> acl localnet_bridge src 10.0.0.4        #(br0)
</I>&gt;<i> acl localnet_fever src 10.0.0.5         #(wlan0)
</I>&gt;<i> acl localnet_44081 src 10.0.0.11        #(RaspberryPi3)
</I>&gt;<i> acl localnet_dannyS4 src 10.0.0.54
</I>&gt;<i> acl localnet_vS5mini src 10.0.0.55
</I>&gt;<i> acl localnet_shotgun src 10.0.0.56
</I>&gt;<i> acl localnet_anTab2 src 10.0.0.71
</I>&gt;<i> acl localnet_vTab3 src 10.0.0.73
</I>&gt;<i> acl localnet_samsungTV src 10.0.0.80
</I>&gt;<i> acl localnet_samsungDVD src 10.0.0.81
</I>&gt;<i> acl localnet_dhcp src 10.0.0.201
</I>&gt;<i> acl localnet_dhcp src 10.0.0.202
</I>&gt;<i> acl localnet_dhcp src 10.0.0.203
</I>&gt;<i> acl localnet_dhcp src 10.0.0.204
</I>&gt;<i> 
</I>&gt;<i> http_access allow password
</I>&gt;<i> http_access allow localhost
</I>&gt;<i> http_access allow localnet
</I>
The localnet ACL above matches and allows all requests from any IP in
the 10.*/24 to use the proxy.

So none of the below individual IP checks will ever be reached. They are
pointless anyway since they do the same as the more generic &quot;allow
localnet&quot;.


&gt;<i> http_access allow localnet_sniper
</I>&gt;<i> http_access allow localnet_bridge
</I>&gt;<i> http_access allow localnet_fever
</I>&gt;<i> http_access allow localnet_44081
</I>&gt;<i> http_access allow localnet_dannyS4
</I>&gt;<i> http_access allow localnet_vS5mini
</I>&gt;<i> http_access allow localnet_anTab2
</I>&gt;<i> http_access allow localnet_vTab3
</I>&gt;<i> http_access allow localnet_samsungTV
</I>&gt;<i> http_access allow localnet_samsungDVD
</I>&gt;<i> http_access allow localnet_dhcp
</I>

The default security protections for Safe_ports, SSL_ports, CONNECT,
manager access, and final &quot;deny all&quot; are missing.

I hope you have just omited them from this mail, not removed them from
your config.

&gt;<i> 
</I>&gt;<i> reply_body_max_size 9 999 999 999 MB localnet_sniper localnet_bridge localnet_fever localnet_44081 localnet_dannyS4
</I>
Squid understands the magic word &quot;none&quot; to mean no limit. The above is
setting a large, but not impossible limit of ~9.3 PB.


&gt;<i> reply_body_max_size 5 MB localnet_vS5mini localnet_anTab2 localnet_vTab3 localnet_samsungTV localnet_samsungDVD localnet_dhcp
</I>&gt;<i> 
</I>
The ACLs on both these lines are defining an impossible situation.
See &lt;<A HREF="http://wiki.squid-cache.org/SquidFaq/SquidAcl#Common_Mistakes">http://wiki.squid-cache.org/SquidFaq/SquidAcl#Common_Mistakes</A>&gt; for
what is going wrong there and ways to fix it.

Transactions which do not have a limit applied, are of course unlimited.
So drop the ACL's explicitly listing what not to limit. You only need
ACL to match what does get limited, and only one is needed (you are only
matching on IP, nothing complex).

Like so:

 acl limit_5MB src 10.0.0.201-10.0.0.204 # dhcp
 acl limit_5MB src 10.0.0.80    # samsung TV
 acl limit_5MB src 10.0.0.81    # samsung DVD
 ...
 reply_body_max_size 5 MB limit_5MB

That is it.


&gt;<i> url_rewrite_program /usr/bin/squidGuard -c /etc/squidguard/squidGuard.conf
</I>&gt;<i> redirect_program /usr/bin/squidGuard -c /etc/squidguard/squidGuard.conf
</I>

redirect_program is a deprecated alias for url_rewrite_program. You can
only have one configured for use. So, only the latter of the two
directives will do anything.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014690.html">[squid-users] reply_body_max_size question
</A></li>
	<LI>Next message (by thread): <A HREF="014740.html">[squid-users] reply_body_max_size question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14709">[ date ]</a>
              <a href="thread.html#14709">[ thread ]</a>
              <a href="subject.html#14709">[ subject ]</a>
              <a href="author.html#14709">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
