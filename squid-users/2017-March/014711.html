<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid in Private Network and Multiple WAN (Best Load Balance Solution).
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20in%20Private%20Network%20and%20Multiple%20WAN%20%28Best%0A%20Load%20Balance%20Solution%29.&In-Reply-To=%3C4b71f181-b20d-418d-6376-19f533f8630e%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014699.html">
   <LINK REL="Next"  HREF="014700.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid in Private Network and Multiple WAN (Best Load Balance Solution).</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20in%20Private%20Network%20and%20Multiple%20WAN%20%28Best%0A%20Load%20Balance%20Solution%29.&In-Reply-To=%3C4b71f181-b20d-418d-6376-19f533f8630e%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid in Private Network and Multiple WAN (Best Load Balance Solution).">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Mar 15 03:32:14 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014699.html">[squid-users] Squid in Private Network and Multiple WAN (Best Load Balance Solution).
</A></li>
        <LI>Next message (by thread): <A HREF="014700.html">[squid-users] Wiki outage - solved
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14711">[ date ]</a>
              <a href="thread.html#14711">[ thread ]</a>
              <a href="subject.html#14711">[ subject ]</a>
              <a href="author.html#14711">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 14/03/2017 6:33 a.m., Darvin Rivera Aguilar wrote:
&gt;<i> Hi,
</I>&gt;<i> I have my public squid ip (1.1.1.1:3128) on my local network and 4 wan
</I>&gt;<i> address. Two wan address (2.2.2.1 and 2.2.2.3) for Education Network
</I>&gt;<i> (example: acl for .edu site); and other two network (3.3.3.1 and
</I>&gt;<i> 4.4.4.1) for General Porpuse (example: the rest of navegation... .com,
</I>&gt;<i> .org...)
</I>
Load Balancing in the proxy is the wrong solution for this. There is
nothing to balance. What you are looking for is routing.

Do you have 2 or 4 physical WAN uplinks being used for this?

If 2 uplinks;

Then having two IPs on each does not matter. Just pick one IP that Squid
will use for each traffic type and select it with tcp_outgoing_address
like so:

 acl Education_Network dstdomain .edu
 tcp_outgoing_address 2.2.2.1 Education_Network
 # other traffic
 tcp_outgoing_address 3.3.3.1



If 4 uplinks - i.e. by two IP's you actually mean there are two uplinks
for each type of traffic;

The best approach here is to leave the load balancing in the TCP stack,
but have the proxy doing traffic classification so that TCP stack knows
where each connection / flow is needing to go.

In squid.conf use tcp_outgoing_tos directive with a dstdomain ACL
matching the Education to classify the traffic types (Education vs
General). Like so:

 acl Education_Network dstdomain .edu
 tcp_outgoing_tos 0x10 Education_Network
 # other traffic
 tcp_outgoing_tos 0x20


Then you just need TCP networking rules to use the 0x10 or 0x20 to load
balance between the two uplinks for that type of traffic.

The exact outgoing IP address does not matter to the proxy, so long as
the kernel assigns a correct one for the uplink which is going to be used.


HTH
Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014699.html">[squid-users] Squid in Private Network and Multiple WAN (Best Load Balance Solution).
</A></li>
	<LI>Next message (by thread): <A HREF="014700.html">[squid-users] Wiki outage - solved
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14711">[ date ]</a>
              <a href="thread.html#14711">[ thread ]</a>
              <a href="subject.html#14711">[ subject ]</a>
              <a href="author.html#14711">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
