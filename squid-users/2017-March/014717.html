<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] No failover when default parent proxy fails (Squid 3.5.12)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20No%20failover%20when%20default%20parent%20proxy%20fails%0A%20%28Squid%203.5.12%29&In-Reply-To=%3Ctrinity-c99337bb-091e-4bab-b503-32a36fa23906-1489591443212%403capp-gmx-bs10%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014716.html">
   <LINK REL="Next"  HREF="014718.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] No failover when default parent proxy fails (Squid 3.5.12)</H1>
    <B>Jens Offenbach</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20No%20failover%20when%20default%20parent%20proxy%20fails%0A%20%28Squid%203.5.12%29&In-Reply-To=%3Ctrinity-c99337bb-091e-4bab-b503-32a36fa23906-1489591443212%403capp-gmx-bs10%3E"
       TITLE="[squid-users] No failover when default parent proxy fails (Squid 3.5.12)">wolle5050 at gmx.de
       </A><BR>
    <I>Wed Mar 15 15:24:03 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014716.html">[squid-users] No failover when default parent proxy fails (Squid 3.5.12)
</A></li>
        <LI>Next message (by thread): <A HREF="014718.html">[squid-users] No failover when default parent proxy fails (Squid 3.5.12)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14717">[ date ]</a>
              <a href="thread.html#14717">[ thread ]</a>
              <a href="subject.html#14717">[ subject ]</a>
              <a href="author.html#14717">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>@Amos:
Thanks a lot for your help.

I have modified my squid.conf:
&#160; cache_peer proxy.mycompany.de parent 8080 0 connect-timeout=5 connect-fail-limit=3 default
&#160; cache_peer&#160; roxy.mycompany.de parent 8080 0 connect-timeout=5 connect-fail-limit=3
&#160;
Do you think this will work? It it currently a little bit difficult for my to test the new configuration.

Regards,
Jens


Gesendet:&#160;Mittwoch, 15. M&#228;rz 2017 um 15:38 Uhr
Von:&#160;&quot;Amos Jeffries&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
An:&#160;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Betreff:&#160;Re: [squid-users] No failover when default parent proxy fails (Squid 3.5.12)
On 15/03/2017 7:06 p.m., Jens Offenbach wrote:
&gt;<i> Hi,
</I>&gt;<i> I have two parent proxies configured, but Squid seems to stick to the default proxy even when the proxy cannot be reached:
</I>&gt;<i> 2017/03/15 06:40:13 kid1| TCP connection to proxy.mycompany.de/8080 failed
</I>&gt;<i> 2017/03/15 06:40:13 kid1| Detected DEAD Parent: proxy.mycompany.de
</I>&gt;<i> 2017/03/15 06:40:13 kid1| TCP connection to proxy.mycompany.de/8080 failed
</I>&gt;<i> 2017/03/15 06:40:13 kid1| TCP connection to proxy.mycompany.de/8080 failed
</I>&gt;<i> 2017/03/15 06:40:13 kid1| TCP connection to proxy.mycompany.de/8080 failed
</I>&gt;<i> 2017/03/15 06:40:13 kid1| TCP connection to proxy.mycompany.de/8080 failed
</I>&gt;<i> 2017/03/15 06:40:13 kid1| TCP connection to proxy.mycompany.de/8080 failed
</I>&gt;<i> 2017/03/15 06:40:13 kid1| TCP connection to proxy.mycompany.de/8080 failed
</I>&gt;<i> 2017/03/15 06:40:43 kid1| TCP connection to proxy.mycompany.de/8080 failed
</I>&gt;<i> 2017/03/15 06:40:43 kid1| TCP connection to proxy.mycompany.de/8080 failed
</I>&gt;<i> 2017/03/15 06:40:43 kid1| TCP connection to proxy.mycompany.de/8080 failed
</I>&gt;<i> 2017/03/15 06:40:43 kid1| TCP connection to proxy.mycompany.de/8080 failed
</I>&gt;<i> 2017/03/15 06:40:43 kid1| TCP connection to proxy.mycompany.de/8080 failed
</I>&gt;<i> 2017/03/15 06:40:43 kid1| TCP connection to proxy.mycompany.de/8080 failed
</I>&gt;<i> 2017/03/15 06:40:43 kid1| TCP connection to proxy.mycompany.de/8080 failed
</I>

Appearances can be deceiving at times. This shows that several &quot;a
connections were attempted but does not specify if that was the orider
they were initiated or not.
It also does not indicate whether that was HTTP or probe for
ressurected peer.

You have disabled the probes though (no-query no-digest) so it is
unlikely Squid will ever detect a DEAD peer as coming alive again. This
makes me suspect that the &quot;roxy&quot; peer was also detected dead some time
earlier. If that has happened then the &quot;FIRST_AVAILABLE&quot; peer selection
algorithm will produce no possible routes and Squid falls back to the
DEFAULT peer ... which happens to be that one you see in the log and
will try that peer until it works again.

If you want to see the exact route selection results add this to your
squid.conf:
debug_options 44,2


Amos

_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014716.html">[squid-users] No failover when default parent proxy fails (Squid 3.5.12)
</A></li>
	<LI>Next message (by thread): <A HREF="014718.html">[squid-users] No failover when default parent proxy fails (Squid 3.5.12)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14717">[ date ]</a>
              <a href="thread.html#14717">[ thread ]</a>
              <a href="subject.html#14717">[ subject ]</a>
              <a href="author.html#14717">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
