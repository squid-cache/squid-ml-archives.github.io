<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSL Bump issues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20Bump%20issues&In-Reply-To=%3Ce0891943-26f9-c99d-5941-9f6bbdbcb80b%40new-life.org.au%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014746.html">
   <LINK REL="Next"  HREF="014761.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSL Bump issues</H1>
    <B>Tim Bates</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20Bump%20issues&In-Reply-To=%3Ce0891943-26f9-c99d-5941-9f6bbdbcb80b%40new-life.org.au%3E"
       TITLE="[squid-users] SSL Bump issues">tin at new-life.org.au
       </A><BR>
    <I>Mon Mar 20 07:19:54 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014746.html">[squid-users] SSL Bump issues
</A></li>
        <LI>Next message (by thread): <A HREF="014761.html">[squid-users] SSL Bump issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14749">[ date ]</a>
              <a href="thread.html#14749">[ thread ]</a>
              <a href="subject.html#14749">[ subject ]</a>
              <a href="author.html#14749">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ignoring the Squid part, is it TLS 1.2 that's the root problem, or the 
ciphers?
Are you aware XP schannel.dll has some ciphers and protocols disabled by 
default, even though they're supported?

See here: 
<A HREF="https://support.microsoft.com/en-au/help/245030/how-to-restrict-the-use-of-certain-cryptographic-algorithms-and-protocols-in-schannel.dll">https://support.microsoft.com/en-au/help/245030/how-to-restrict-the-use-of-certain-cryptographic-algorithms-and-protocols-in-schannel.dll</A>

TB


On 20/03/2017 12:58 PM, mr_jrt wrote:
&gt;<i> Hello all,
</I>&gt;<i>
</I>&gt;<i> Brief version:
</I>&gt;<i> Can't get ssl_bump working to get an old XP system's schannel.dll (i.e.
</I>&gt;<i> built-in SSL) talking to a TLS 1.2 server, but works with Firefox (which has
</I>&gt;<i> it's own SSL stack).
</I>&gt;<i>
</I>&gt;<i> Long version:
</I>&gt;<i> This afternoon's task was to try and solve the issue of an old internal
</I>&gt;<i> legacy XP system (and thus stuck on TLS 1.0) that can't be upgraded, but
</I>&gt;<i> needs to be able to speak to servers running TLS 1.2. I've tried several
</I>&gt;<i> approaches, but using squid with ssl_bump seemed to be the most appropriate
</I>&gt;<i> solution, but for the life of me, I've not been able to get it to work
</I>&gt;<i> properly, so was hoping for a few pointers.
</I>&gt;<i>
</I>&gt;<i> The software that needs to run uses the built-in schannel dll, but it can
</I>&gt;<i> have a proxy specified, so things don't have to be transparent, ...but it
</I>&gt;<i> does get stuck with all the limitations of the ancient schannel dll. Does
</I>&gt;<i> however mean I can use the system's IE for testing.
</I>&gt;<i>
</I>&gt;<i> First up, I'm running Debian on my squid server. That means the distro
</I>&gt;<i> packages don't have ssl support compiled in, so I had to compile my own
</I>&gt;<i> packages. The version is 3.5.23, and the relevant configure output is:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I had to compile against the older version of openssl due to the changes in
</I>&gt;<i> their locking API, so I installed
</I>&gt;<i> <A HREF="https://packages.debian.org/stretch/libssl1.0-dev,">https://packages.debian.org/stretch/libssl1.0-dev,</A> which enabled me to
</I>&gt;<i> compile successfully.
</I>&gt;<i>
</I>&gt;<i> I've looked at countless examples, i.e.
</I>&gt;<i> <A HREF="http://wiki.squid-cache.org/ConfigExamples/Intercept/SslBumpExplicit">http://wiki.squid-cache.org/ConfigExamples/Intercept/SslBumpExplicit</A>
</I>&gt;<i>
</I>&gt;<i> ...but the only way I've got any successful SSL proxying is with:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ...but as expected, that's clearly not doing any bumping from the logs:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> When I put anything more in, i.e.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Then it turns on the mode:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ...but then I just get errors about no ciphers:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I have a test site I'm using that I can fiddle with the ciphers on, and I
</I>&gt;<i> can access it fine from the legacy system directly when I enable the old
</I>&gt;<i> stuff (TLS 1.0, etc), but even then it seems to be squid's encryption (or
</I>&gt;<i> maybe, decryption from the client?) that isn't working as it still won't
</I>&gt;<i> connect regardless of what I try.
</I>&gt;<i>
</I>&gt;<i> Even if I throw in an explicit list of ciphers, copied from the target
</I>&gt;<i> server (incidentally, the same host as squid, if that's relevant), still
</I>&gt;<i> nada.
</I>&gt;<i>
</I>&gt;<i> Interestingly, ssl_bump seems to work perfectly fine from Firefox from the
</I>&gt;<i> same machine, even when crippled down to TLS 1.0 only with the server set to
</I>&gt;<i> restrict to TLS 1.2. So it seems to be doing what I want, just not for
</I>&gt;<i> schannel.dll? I'm suspecting that openssl as used by squid can't speak any
</I>&gt;<i> ciphers that schannel can, so it seems the issue isn't actually between
</I>&gt;<i> squid and the target server, but between squid and the old client...
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> View this message in context: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/SSL-Bump-issues-tp4681843.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/SSL-Bump-issues-tp4681843.html</A>
</I>&gt;<i> Sent from the Squid - Users mailing list archive at Nabble.com.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014746.html">[squid-users] SSL Bump issues
</A></li>
	<LI>Next message (by thread): <A HREF="014761.html">[squid-users] SSL Bump issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14749">[ date ]</a>
              <a href="thread.html#14749">[ thread ]</a>
              <a href="subject.html#14749">[ subject ]</a>
              <a href="author.html#14749">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
