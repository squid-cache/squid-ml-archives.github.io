<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid blocking own OCSP/AIA requests
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20blocking%20own%20OCSP/AIA%20requests&In-Reply-To=%3C9a72eb04-124c-3222-d7b5-56d9cd2406bf%40wernig.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014773.html">
   <LINK REL="Next"  HREF="014803.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid blocking own OCSP/AIA requests</H1>
    <B>Markus Wernig</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20blocking%20own%20OCSP/AIA%20requests&In-Reply-To=%3C9a72eb04-124c-3222-d7b5-56d9cd2406bf%40wernig.net%3E"
       TITLE="[squid-users] Squid blocking own OCSP/AIA requests">listener at wernig.net
       </A><BR>
    <I>Wed Mar 22 13:20:21 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014773.html">[squid-users] Squid blocking own OCSP/AIA requests
</A></li>
        <LI>Next message (by thread): <A HREF="014803.html">[squid-users] Squid blocking own OCSP/AIA requests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14797">[ date ]</a>
              <a href="thread.html#14797">[ thread ]</a>
              <a href="subject.html#14797">[ subject ]</a>
              <a href="author.html#14797">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Small update:

- The URL <A HREF="http://apps.identrust.com/roots/dstrootcax3.p7c">http://apps.identrust.com/roots/dstrootcax3.p7c</A> is not the
OCSP responder, but the AIA for the Root CA (DST Root CA X3) embedded in
the issuing CA's certificate's CA Issuers.
- Same for
<A HREF="http://swisssign.net/cgi-bin/authority/download/5B257B96A465517EB839F3C078665EE83AE7F0EE:">http://swisssign.net/cgi-bin/authority/download/5B257B96A465517EB839F3C078665EE83AE7F0EE:</A>
AIA for Root CA.

Since squid is sslbumping the connection, it must be doing the AIA
lookups (presumably for SSL verification). Does anybody have an idea why
it is blocking its own requests?

Best /markus

On 03/21/2017 11:35 AM, Markus Wernig wrote:
&gt;<i> Hi all
</I>&gt;<i> 
</I>&gt;<i> I have configured Squid 4.0.18 (CentOS) with sslbump and clamav as
</I>&gt;<i> ecap_service. This works well.
</I>&gt;<i> 
</I>&gt;<i> One thing I've noticed though, are constant log entries like this in
</I>&gt;<i> access.log:
</I>&gt;<i> 
</I>&gt;<i> 2017-03-21 10:35:08.338 +0100 000137 - TCP_DENIED/403 3607 GET
</I>&gt;<i> <A HREF="http://apps.identrust.com/roots/dstrootcax3.p7c">http://apps.identrust.com/roots/dstrootcax3.p7c</A> - HIER_NONE/-
</I>&gt;<i> text/html;charset=utf-8 -
</I>&gt;<i> 2017-03-21 10:35:08.345 +0100 000161 10.254.254.2 NONE/200 0 CONNECT
</I>&gt;<i> letsencrypt.org:443 - HIER_DIRECT/letsencrypt.org - -
</I>&gt;<i> 
</I>&gt;<i> It appears that this is the OCSP URI for Letsencrypt certificates.
</I>&gt;<i> 
</I>&gt;<i> And in fact every time this is logged, a CONNECT to a https uri is
</I>&gt;<i> logged that is using a Letsencrypt certificate (like eg.
</I>&gt;<i> <A HREF="https://letsencrypt.org">https://letsencrypt.org</A>).
</I>&gt;<i> 
</I>&gt;<i> Given that there is no client IP logged, I assume that squid is blocking
</I>&gt;<i> its own outgoing OCSP request here (the browser is configured to NOT use
</I>&gt;<i> OCSP).
</I>&gt;<i> 
</I>&gt;<i> The same seems to happen when there's no OCSP URI, but a regular AIA URI
</I>&gt;<i> in the certificate:
</I>&gt;<i> 
</I>&gt;<i> 2017-03-21 10:36:19.773 +0100 000000 - TCP_DENIED/403 3734 GET
</I>&gt;<i> <A HREF="http://swisssign.net/cgi-bin/authority/download/5B257B96A465517EB839F3C078665EE83AE7F0EE">http://swisssign.net/cgi-bin/authority/download/5B257B96A465517EB839F3C078665EE83AE7F0EE</A>
</I>&gt;<i> - HIER_NONE/- text/html;charset=utf-8 -
</I>&gt;<i> 2017-03-21 10:36:19.782 +0100 000038 10.254.254.2 NONE/200 0 CONNECT
</I>&gt;<i> swisssign.net:443 - HIER_DIRECT/swisssign.net - -
</I>&gt;<i> 
</I>&gt;<i> I do have &quot;http_access allow localhost&quot; in squid.conf, but since there's
</I>&gt;<i> no IP associated with the request, this does not seem to help.
</I>&gt;<i> 
</I>&gt;<i> Is there a way to allow these outgoing internal requests? I've looked
</I>&gt;<i> through the FAQ and wiki, but couldn't find anything on the topic.
</I>&gt;<i> 
</I>&gt;<i> Thanks &amp; best
</I>&gt;<i> 
</I>&gt;<i> /markus
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>

-- 
Markus Wernig
Unix/Network Security Engineer
PGP: D9203D2A4AD9FC3333DEEF9DF7ACC6208E82E4DC
SIP/XMPP: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">markus at wernig.net</A>
Furch D25-SR Cut - Ovation CE C2078AX-5
-----------------------------------------
<A HREF="http://xfer.ch">http://xfer.ch</A> - <A HREF="http://markus.wernig.net">http://markus.wernig.net</A>
-----------------------------------------



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014773.html">[squid-users] Squid blocking own OCSP/AIA requests
</A></li>
	<LI>Next message (by thread): <A HREF="014803.html">[squid-users] Squid blocking own OCSP/AIA requests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14797">[ date ]</a>
              <a href="thread.html#14797">[ thread ]</a>
              <a href="subject.html#14797">[ subject ]</a>
              <a href="author.html#14797">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
