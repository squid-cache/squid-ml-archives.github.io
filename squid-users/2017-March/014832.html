<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] https_port and capath
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20https_port%20and%20capath&In-Reply-To=%3CBN6PR17MB114004712BDD997506282D99F7320%40BN6PR17MB1140.namprd17.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014831.html">
   <LINK REL="Next"  HREF="014836.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] https_port and capath</H1>
    <B>senor</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20https_port%20and%20capath&In-Reply-To=%3CBN6PR17MB114004712BDD997506282D99F7320%40BN6PR17MB1140.namprd17.prod.outlook.com%3E"
       TITLE="[squid-users] https_port and capath">frio_cervesa at hotmail.com
       </A><BR>
    <I>Tue Mar 28 22:07:30 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014831.html">[squid-users] Custom Error Messages
</A></li>
        <LI>Next message (by thread): <A HREF="014836.html">[squid-users] ECAP: How to Add header to get request
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14832">[ date ]</a>
              <a href="thread.html#14832">[ thread ]</a>
              <a href="subject.html#14832">[ subject ]</a>
              <a href="author.html#14832">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Previous questions on this list referred to using the capath= option to https_port directive to fill in certificates missing in the chain to the Root CA trusted by the clients. I can not seem to get that to work.

I see no error in parsing even with debug on (debug section 3,9). The directive is read and no error produced but also no hint that the file pointed to by capath is used for anything. The SSL negotiation is not changed. The same 2 certs are passed. Just the signing cert and the signed cert.

directive:
 https_port 192.168.12.10:8443 intercept ssl-bump cert=/etc/squid/mitm.crt key=/etc/squid/mitm.key cafile=/etc/squid/mitm_chain.crt generate-host-certificates=on dynamic_cert_mem_cache_size=32MB name=mitm

The RootCA.crt is trusted by clients.
The Root CA signed intermediate1
Intermediate1 signed intermediate2
cert=intermediate2
cafile=intermediate1

This command succeeds:
openssl verify -CAfile RootCA.crt -untrusted intermediate1.crt intermediateL2.crt
If the untrusted intermediate1 is added to client the MITM works.

I realize this wouldn't be used very often and I'd prefer not using it myself but it is necessary in this case. 
Any hints?
Thanks in advance,
Senor
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014831.html">[squid-users] Custom Error Messages
</A></li>
	<LI>Next message (by thread): <A HREF="014836.html">[squid-users] ECAP: How to Add header to get request
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14832">[ date ]</a>
              <a href="thread.html#14832">[ thread ]</a>
              <a href="subject.html#14832">[ subject ]</a>
              <a href="author.html#14832">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
