<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SMP and AUFS
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SMP%20and%20AUFS&In-Reply-To=%3Cf3c3da0e-9cdd-fcd9-a33f-896fc12d3ea6%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014837.html">
   <LINK REL="Next"  HREF="014843.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SMP and AUFS</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SMP%20and%20AUFS&In-Reply-To=%3Cf3c3da0e-9cdd-fcd9-a33f-896fc12d3ea6%40treenet.co.nz%3E"
       TITLE="[squid-users] SMP and AUFS">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Mar 30 09:49:51 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014837.html">[squid-users] SMP and AUFS
</A></li>
        <LI>Next message (by thread): <A HREF="014843.html">[squid-users] SMP and AUFS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14838">[ date ]</a>
              <a href="thread.html#14838">[ thread ]</a>
              <a href="subject.html#14838">[ subject ]</a>
              <a href="author.html#14838">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 30/03/2017 9:43 p.m., Matus UHLAR - fantomas wrote:
&gt;&gt;<i> On 03/20/2017 10:15 AM, Matus UHLAR - fantomas wrote:
</I>&gt;&gt;&gt;<i> Well, I personally will still be curious how much does SMP affect the
</I>&gt;&gt;&gt;<i> case of one worker and one or more diskers...
</I>&gt;<i> 
</I>&gt;<i> On 20.03.17 12:19, Alex Rousskov wrote:
</I>&gt;&gt;<i> I do not understand why you are asking this question in AUFS context.
</I>&gt;&gt;<i> AUFS does not use diskers!
</I>&gt;<i> 
</I>&gt;<i> because it's diskers (rock store) who switch to SMP mode when &quot;workers
</I>&gt;<i> 1&quot; is
</I>&gt;<i> used, and this may cause troubles to *ufs.
</I>&gt;<i> 
</I>&gt;&gt;<i> Today, only Rock store uses diskers (in SMP
</I>&gt;&gt;<i> mode). Some other [ufs-based] cache stores use various helper threads
</I>&gt;&gt;<i> and processes for I/O as well, but those helper processes are not
</I>&gt;&gt;<i> diskers or even kids in SMP terminology.
</I>&gt;<i> 
</I>&gt;<i> this is something I'd like to understand better...
</I>
Alex is referring to;

a) &quot;diskd&quot; cache_dir type, which uses a helper named 'diskd' to offload
parts of the file manipulations to that helper. (I've not looked closely
to see which, sorry).

b) squid builds with 'unlinkd' feature enabled, which uses an helper
called 'unlinkd' to perform file deletion outside the squid process.

c) AUFS which starts threads to perform the read/write I/O and file
deletion stuff.

... and I'm still learning of other such odd things in weird rarely
touched corners. There is something thread-like in digest creation for
walking the store index quickly and swap log rebuilding for example.


&gt;<i> 
</I>&gt;&gt;&gt;<i> do diskers only provide I/O to the requestor?
</I>&gt;<i> 
</I>&gt;&gt;<i> Diskers primary function is low-level disk cache I/O. Like all kids,
</I>&gt;&gt;<i> diskers respond to cache manager requests and Squid management events
</I>&gt;&gt;<i> (e.g. shutdown and reconfiguration). IIRC, diskers also build in-RAM
</I>&gt;&gt;<i> cache_dir index.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    <A HREF="http://wiki.squid-cache.org/Features/SmpScale#Terminology">http://wiki.squid-cache.org/Features/SmpScale#Terminology</A>
</I>&gt;<i> 
</I>&gt;<i> their own or also the shared one?
</I>
Alex may correct me but AFAIK there is currently only the shared index.
Diskers just do better with it through generic parallel-CPU efficiencies
than a non-SMP Squid would spreading the index actions between other
transaction work.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014837.html">[squid-users] SMP and AUFS
</A></li>
	<LI>Next message (by thread): <A HREF="014843.html">[squid-users] SMP and AUFS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14838">[ date ]</a>
              <a href="thread.html#14838">[ thread ]</a>
              <a href="subject.html#14838">[ subject ]</a>
              <a href="author.html#14838">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
