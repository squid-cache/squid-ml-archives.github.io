<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] HTTPS reverse proxy: SSL Certficate verification failed
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20HTTPS%20reverse%20proxy%3A%20SSL%20Certficate%20verification%0A%20failed&In-Reply-To=%3Ca9bc23dc-5638-7512-0d2f-738c954caef3%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014842.html">
   <LINK REL="Next"  HREF="014853.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] HTTPS reverse proxy: SSL Certficate verification failed</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20HTTPS%20reverse%20proxy%3A%20SSL%20Certficate%20verification%0A%20failed&In-Reply-To=%3Ca9bc23dc-5638-7512-0d2f-738c954caef3%40treenet.co.nz%3E"
       TITLE="[squid-users] HTTPS reverse proxy: SSL Certficate verification failed">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Mar 31 02:44:28 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="014842.html">[squid-users] HTTPS reverse proxy: SSL Certficate verification	failed
</A></li>
        <LI>Next message (by thread): <A HREF="014853.html">[squid-users] HTTPS reverse proxy: SSL Certficate verification	failed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14850">[ date ]</a>
              <a href="thread.html#14850">[ thread ]</a>
              <a href="subject.html#14850">[ subject ]</a>
              <a href="author.html#14850">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 31/03/2017 4:01 a.m., Eric Veiras Galisson wrote:
&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> I want to setup Squid as a HTTPS reverse proxy for several of our websites,
</I>&gt;<i> but I have a certificate verification problem on Squid access.log.
</I>&gt;<i> Our upstream webservers are behind a VPN tunnel and only the Squid server
</I>&gt;<i> can access it. (*We actually use Nginx for the same purpose but want to
</I>&gt;<i> switch to Squid)*
</I>&gt;<i> 
</I>&gt;<i>                               HTTPS                           HTTPS
</I>&gt;<i> [client browser] -----------------------&gt; [Squid]
</I>&gt;<i> --------------------------&gt; [upstream server]
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I run squid 3.4.8-6+deb8u4 recompiled with --enable-ssl
</I>&gt;<i> --with-open-ssl=&quot;/etc/ssl/openssl.cnf&quot; on Debian Jessie.
</I>&gt;<i> 
</I>&gt;<i> The certificate presented to the client is the same as on the upstream
</I>&gt;<i> server, a wildcard one signed by GeoTrust (with intermediate CA). It
</I>&gt;<i> appears correctly in the browser.
</I>&gt;<i> The problem comes from squid verification of upstream certificate.
</I>&gt;<i> 
</I>...
&gt;<i> 
</I>&gt;<i> What am I doing wrong? and what should I do to make squid work in this
</I>&gt;<i> setup?
</I>
The server (and Squid) should be supplying the intermediate cert along
with its own cert for best validation behaviour.

If it cannot, use the cache_peer sslcafile= option to provide Squid with
a PEM file containing the public certs of the whole chain (excluding the
server cert itself). Order of those certs in the file is important. I've
forgotten which end of the chain to start with sorry, but it is one or
the other and definitely sequential.

When that is working you should use the sslflags=NO_DEFAULT_CA option to
prevent MITM on those connections altering the chain - and saves a huge
amount of memory :-).

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="014842.html">[squid-users] HTTPS reverse proxy: SSL Certficate verification	failed
</A></li>
	<LI>Next message (by thread): <A HREF="014853.html">[squid-users] HTTPS reverse proxy: SSL Certficate verification	failed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14850">[ date ]</a>
              <a href="thread.html#14850">[ thread ]</a>
              <a href="subject.html#14850">[ subject ]</a>
              <a href="author.html#14850">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
