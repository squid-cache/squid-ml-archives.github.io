<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Huge memory required for squid 3.5
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Huge%20memory%20required%20for%20squid%203.5&In-Reply-To=%3C4d23dfe0-6015-c622-745b-0ec1394a6150%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015144.html">
   <LINK REL="Next"  HREF="015165.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Huge memory required for squid 3.5</H1>
    <B>Yuri Voinov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Huge%20memory%20required%20for%20squid%203.5&In-Reply-To=%3C4d23dfe0-6015-c622-745b-0ec1394a6150%40gmail.com%3E"
       TITLE="[squid-users] Huge memory required for squid 3.5">yvoinov at gmail.com
       </A><BR>
    <I>Wed May  3 15:47:08 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015144.html">[squid-users] Huge memory required for squid 3.5
</A></li>
        <LI>Next message (by thread): <A HREF="015165.html">[squid-users] Huge memory required for squid 3.5
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15145">[ date ]</a>
              <a href="thread.html#15145">[ thread ]</a>
              <a href="subject.html#15145">[ subject ]</a>
              <a href="author.html#15145">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>You sure?


<A HREF="http://wiki.squid-cache.org/SquidFaq/SquidMemory">http://wiki.squid-cache.org/SquidFaq/SquidMemory</A>


03.05.2017 21:44, Nil Nik &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Its not disk cache, its due to in memory SSL context.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Nil
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; on
</I>&gt;<i> behalf of Yuri &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">yvoinov at gmail.com</A>&gt;
</I>&gt;<i> *Sent:* Wednesday, May 3, 2017 11:55 AM
</I>&gt;<i> *To:* <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> *Subject:* Re: [squid-users] Huge memory required for squid 3.5
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;<i> How big disk cache(s) and how it full?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 03.05.2017 17:54, Nil Nik &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> NO_DEFAULT_CA doesn't help. Still goes in GB. Can anyone tell me area
</I>&gt;&gt;<i> so that i can work on?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Regards,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Nil
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ------------------------------------------------------------------------
</I>&gt;&gt;<i> *From:* squid-users &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt; on
</I>&gt;&gt;<i> behalf of Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;
</I>&gt;&gt;<i> *Sent:* Wednesday, April 26, 2017 7:37 PM
</I>&gt;&gt;<i> *To:* <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> *Subject:* Re: [squid-users] Huge memory required for squid 3.5
</I>&gt;&gt;<i>  
</I>&gt;&gt;<i> On 04/26/2017 09:35 AM, Yuri Voinov wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; This is openssl issue or squid's?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> AFAIK, the underlying issue (i.e., bug #4005) is mostly a Squid problem:
</I>&gt;&gt;<i> Squid is caching SSL contexts (instead of certificates) and does a poor
</I>&gt;&gt;<i> job maintaining that cache.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Earlier OpenSSL versions (that had to be used when the original code was
</I>&gt;&gt;<i> written) complicated solving this problem. OpenSSL v1.0.1+ added APIs
</I>&gt;&gt;<i> that simplify some aspects of the anticipated fix. Certain OpenSSL
</I>&gt;&gt;<i> aspects will continue to hurt Squid, even with OpenSSL v1.0.1, but if
</I>&gt;&gt;<i> you want to blame a single project (instead of both), blame Squid.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; Why sessions can't share CA's data cached in memory? shared_ptr
</I>&gt;&gt;<i> invented
</I>&gt;&gt;<i> &gt; already.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> OpenSSL knew how to share things well before std::shared_ptr became
</I>&gt;&gt;<i> available. However, it is the responsibility of the application to tell
</I>&gt;&gt;<i> OpenSSL what to create from scratch and what to share. A part of the
</I>&gt;&gt;<i> problem is that Squid tells OpenSSL to create many large things from
</I>&gt;&gt;<i> scratch and then caches those large things while underestimating their
</I>&gt;&gt;<i> size by several(?) orders of magnitude (and probably also missing many
</I>&gt;&gt;<i> cache hits).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> More details, including the difference between problems associated with
</I>&gt;&gt;<i> from-client and to-server connections, are documented in the &quot;Memory
</I>&gt;&gt;<i> Usage&quot; section of <A HREF="http://wiki.squid-cache.org/Features/SslBump">http://wiki.squid-cache.org/Features/SslBump</A>
</I>&gt;&gt;<i> &lt;<A HREF="http://wiki.squid-cache.org/Features/SslBump">http://wiki.squid-cache.org/Features/SslBump</A>&gt;
</I>&gt;&gt;<i> Features/SslBump - Squid Web Proxy Wiki
</I>&gt;&gt;<i> &lt;<A HREF="http://wiki.squid-cache.org/Features/SslBump">http://wiki.squid-cache.org/Features/SslBump</A>&gt;
</I>&gt;&gt;<i> wiki.squid-cache.org
</I>&gt;&gt;<i> Squid-in-the-middle decryption and encryption of straight CONNECT and
</I>&gt;&gt;<i> transparently redirected SSL traffic, using configurable CA certificates.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> FWIW, we have spent a lot of resources on triaging this problem and
</I>&gt;&gt;<i> drafting possible solutions (in various overlapping areas), but there is
</I>&gt;&gt;<i> currently no sponsor to finalize and implement any of the fixes. AFAIK,
</I>&gt;&gt;<i> bug #4005 is stuck.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I am glad that NO_DEFAULT_CA helps mitigate some of the problems in some
</I>&gt;&gt;<i> environments.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> HTH,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Alex.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; 26.04.2017 9:08, Amos Jeffries &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;&gt;<i> &gt;&gt; On 26/04/17 10:53, Yuri Voinov wrote:
</I>&gt;&gt;<i> &gt;&gt;&gt; Ok, but how NO_DEFAULT_CA should help with this?
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; It prevents OpenSSL copying that 1MB into each incoming client
</I>&gt;&gt;<i> &gt;&gt; connections memory. The CAs are only useful there when you have some
</I>&gt;&gt;<i> &gt;&gt; of the global CAs as root for client certificates - in which case you
</I>&gt;&gt;<i> &gt;&gt; still only want to trust the roots you paid for service and not all of
</I>&gt;&gt;<i> &gt;&gt; them.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; Just something to try if there are huge memory issues with TLS/SSL
</I>&gt;&gt;<i> &gt;&gt; proxying. The default behaviour is fixed for Squid-4 with the config
</I>&gt;&gt;<i> &gt;&gt; options changes. But due to being a major surprise for anyone already
</I>&gt;&gt;<i> &gt;&gt; relying on global roots for client certs it remains a problem in 3.5.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; Amos
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; _______________________________________________
</I>&gt;&gt;<i> &gt;&gt; squid-users mailing list
</I>&gt;&gt;<i> &gt;&gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> &gt;&gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i> squid-users Info Page &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;&gt;<i> lists.squid-cache.org
</I>&gt;&gt;<i> squid-users -- General discussion relating to Squid. The membership
</I>&gt;&gt;<i> of this list is thousands of Squid users from around the world About
</I>&gt;&gt;<i> squid-users
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; _______________________________________________
</I>&gt;&gt;<i> &gt; squid-users mailing list
</I>&gt;&gt;<i> &gt; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> &gt; <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i> squid-users Info Page &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;&gt;<i> lists.squid-cache.org
</I>&gt;&gt;<i> squid-users -- General discussion relating to Squid. The membership
</I>&gt;&gt;<i> of this list is thousands of Squid users from around the world About
</I>&gt;&gt;<i> squid-users
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i> squid-users Info Page &lt;<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>&gt;
</I>&gt;&gt;<i> lists.squid-cache.org
</I>&gt;&gt;<i> squid-users -- General discussion relating to Squid. The membership
</I>&gt;&gt;<i> of this list is thousands of Squid users from around the world About
</I>&gt;&gt;<i> squid-users
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>
-- 
Bugs to the Future
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170503/3c65110d/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170503/3c65110d/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x613DEC46.asc
Type: application/pgp-keys
Size: 2437 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170503/3c65110d/attachment.key">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170503/3c65110d/attachment.key</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170503/3c65110d/attachment.sig">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170503/3c65110d/attachment.sig</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015144.html">[squid-users] Huge memory required for squid 3.5
</A></li>
	<LI>Next message (by thread): <A HREF="015165.html">[squid-users] Huge memory required for squid 3.5
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15145">[ date ]</a>
              <a href="thread.html#15145">[ thread ]</a>
              <a href="subject.html#15145">[ subject ]</a>
              <a href="author.html#15145">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
