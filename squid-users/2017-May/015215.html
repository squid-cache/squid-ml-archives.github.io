<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] How to terminate (close) the active CONNECT	connection when matching ACL.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20How%20to%20terminate%20%28close%29%20the%20active%20CONNECT%0A%09connection%20when%20matching%20ACL.&In-Reply-To=%3C201705101027339230492%40ltu.sld.cu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015222.html">
   <LINK REL="Next"  HREF="015218.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] How to terminate (close) the active CONNECT	connection when matching ACL.</H1>
    <B>yuriang</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20How%20to%20terminate%20%28close%29%20the%20active%20CONNECT%0A%09connection%20when%20matching%20ACL.&In-Reply-To=%3C201705101027339230492%40ltu.sld.cu%3E"
       TITLE="[squid-users] How to terminate (close) the active CONNECT	connection when matching ACL.">yuriang at ltu.sld.cu
       </A><BR>
    <I>Wed May 10 14:27:33 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015222.html">[squid-users] Windows Updates a Caching Stub zone,	A windows updates store.
</A></li>
        <LI>Next message (by thread): <A HREF="015218.html">[squid-users] How to terminate (close) the active CONNECT connection when matching ACL.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15215">[ date ]</a>
              <a href="thread.html#15215">[ thread ]</a>
              <a href="subject.html#15215">[ subject ]</a>
              <a href="author.html#15215">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>How to terminate (close) the active CONNECT connection when matching ACL.

I have worked on version 3.5.23 on Debian 9.0, I use user authentication in addition to ACL to filter IP, MAC, all this works correctly. I have an ACL of type proxy_auth (quota_end) that contains a list of users that have exceeded a certain quota, which I deny to prohibit the user to continue the connection after having consumed its quota, that is to say when it is added to the aforementioned list . This works correctly for HTTP connections but not for HTTPS connections, these links remain active until the user performs an update to the page (press F5). Not so new HTTPS links if they are denied.
My question: Is there a way to terminate (close) the user's active HTTPS connection after matching the proxy_auth ACL (quota_end).

For more information here is my configuration, I manage several subnets, but I will only put one as an example:

# - TO AUTHENTICATE 
Acl authentication proxy_auth REQUIRED

# - (quota_end) Contains the users who consumed the assigned quota, it is used to deny the
# - browsing these users and displaying the quota page exceeded.
Acl quota_end proxy_auth &quot;/ etc / squid / users / quota_end&quot;

# ---- NETWORKS
Acl ip_ucm src &quot;/etc/squid/redes_permitidas/ip_ucm.txt&quot;
Acl mac_ucm arp &quot;/ etc / squid / allowed_networks / mac_ucm.txt&quot;

# ---- CONNECTION PORTS PERMITTED
Acl SSL_ports port 443 # https |
Acl SSL_ports port 563 # snews |
Acl SSL_ports port 873 # rsync |
Acl SSL_ports port 2187 # Iluminate |
Acl Safe_ports port 80 # http |
Acl Safe_ports port 21 # ftp |
Acl Safe_ports port 443 # https |
Acl Safe_ports port 70 # gopher |
Acl Safe_ports port 210 # wais |
Acl Safe_ports port 1025-65535 # unregistered ports
Acl Safe_ports port 280 # http-mgmt |
Acl Safe_ports port 488 # gss-http |
Acl Safe_ports port 591 # filemaker |
Acl Safe_ports port 777 # multilingual http
Acl Safe_ports port 631 # cups |
Acl Safe_ports port 873 # rsync |
Acl Safe_ports port 901 # SWAT |
Acl Safe_ports port 8888 # IRC |
Acl Safe_ports port 2187 # Iluminate |
Acl Safe_ports port 25 # smtp |
Acl Safe_ports port 110 # pop3 |

Acl CONNECT method CONNECT

# Deny requests to certain unsafe ports
Http_access deny! Safe_ports

# Deny CONNECT to other than secure SSL ports
Http_access deny CONNECT! SSL_ports

# Only allow cachemgr access from localhost
Http_access allow localhost manager
Http_access deny manager

# ----- DENY USERS EXHEDED YOUR QUOTA
Http_access deny quota_end

# - ALLOW USERS
Http_access allow ip_ucm mac_ucm authentication! Quota_end

# And finally deny all other access to this proxy
Http_access deny all


--
Este mensaje le ha llegado mediante el servicio de correo electronico que ofrece Infomed para respaldar el cumplimiento de las misiones del Sistema Nacional de Salud. La persona que envia este correo asume el compromiso de usar el servicio a tales fines y cumplir con las regulaciones establecidas

Infomed: <A HREF="http://www.sld.cu/">http://www.sld.cu/</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015222.html">[squid-users] Windows Updates a Caching Stub zone,	A windows updates store.
</A></li>
	<LI>Next message (by thread): <A HREF="015218.html">[squid-users] How to terminate (close) the active CONNECT connection when matching ACL.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15215">[ date ]</a>
              <a href="thread.html#15215">[ thread ]</a>
              <a href="subject.html#15215">[ subject ]</a>
              <a href="author.html#15215">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
