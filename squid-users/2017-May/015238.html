<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ICAP Persistent Connections vs Retries (with code review)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ICAP%20Persistent%20Connections%20vs%20Retries%20%28with%20code%0A%20review%29&In-Reply-To=%3Ccfe8696e-e243-2f5c-4646-f830bbafe4ad%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015231.html">
   <LINK REL="Next"  HREF="015243.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ICAP Persistent Connections vs Retries (with code review)</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ICAP%20Persistent%20Connections%20vs%20Retries%20%28with%20code%0A%20review%29&In-Reply-To=%3Ccfe8696e-e243-2f5c-4646-f830bbafe4ad%40measurement-factory.com%3E"
       TITLE="[squid-users] ICAP Persistent Connections vs Retries (with code review)">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri May 12 14:08:51 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015231.html">[squid-users] ICAP Persistent Connections vs Retries (with code review)
</A></li>
        <LI>Next message (by thread): <A HREF="015243.html">[squid-users] ICAP Persistent Connections vs Retries (with code	review)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15238">[ date ]</a>
              <a href="thread.html#15238">[ thread ]</a>
              <a href="subject.html#15238">[ subject ]</a>
              <a href="author.html#15238">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 05/11/2017 07:30 PM, Amos Jeffries wrote:

&gt;<i> Requests which are not retriable are not able to be re-sent [...] 
</I>&gt;<i> As such those requests need a new TCP connection to be opened to
</I>&gt;<i> guarantee the absence of immediate closure. When they complete with
</I>&gt;<i> their transaction it gets added to the pool for other traffic to use if
</I>&gt;<i> they can.
</I>
The above is accurate, including the snipped parts documenting the
rationale. BTW, since HTTP and ICAP share the same basic connection
persistency model, you may find more information reading about these
general problems in HTTP-related documents.


&gt;<i> As far as I know RESPMOD transactions should all be retriable unless the
</I>&gt;<i> body payload length is unknown at the HTTP level (lack of Content-Length
</I>&gt;<i> header).
</I>
This is inaccurate. A REQMOD or RESPMOD transaction is deemed retriable
at the time when a connection is chosen/open if:

* Squid can send a preview or
* Squid can buffer the entire HTTP message body.

The &quot;known length&quot; aspect affects the second bullet, but that bullet
covers more cases than just messages with Content-Length. And there may
be more conditions in the code than the bullets cover -- I have not checked.


&gt;<i> They can also become non-retriable when the response from the ICAP
</I>&gt;<i> server has been received by Squid and already started delivery to the
</I>&gt;<i> HTTP client.
</I>
This is accurate (including the snipped part about the irrelevance to
the connection choice).


HTH,

Alex.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015231.html">[squid-users] ICAP Persistent Connections vs Retries (with code review)
</A></li>
	<LI>Next message (by thread): <A HREF="015243.html">[squid-users] ICAP Persistent Connections vs Retries (with code	review)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15238">[ date ]</a>
              <a href="thread.html#15238">[ thread ]</a>
              <a href="subject.html#15238">[ subject ]</a>
              <a href="author.html#15238">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
