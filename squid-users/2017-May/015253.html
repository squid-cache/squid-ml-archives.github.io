<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ICAP Persistent Connections vs Retries (with code	review)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ICAP%20Persistent%20Connections%20vs%20Retries%20%28with%20code%0A%09review%29&In-Reply-To=%3C003b01d2cce5%245e33dd00%241a9b9700%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015244.html">
   <LINK REL="Next"  HREF="015233.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ICAP Persistent Connections vs Retries (with code	review)</H1>
    <B>Eliezer  Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ICAP%20Persistent%20Connections%20vs%20Retries%20%28with%20code%0A%09review%29&In-Reply-To=%3C003b01d2cce5%245e33dd00%241a9b9700%24%40ngtech.co.il%3E"
       TITLE="[squid-users] ICAP Persistent Connections vs Retries (with code	review)">eliezer at ngtech.co.il
       </A><BR>
    <I>Sun May 14 19:07:44 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015244.html">[squid-users] ICAP Persistent Connections vs Retries (with code review)
</A></li>
        <LI>Next message (by thread): <A HREF="015233.html">[squid-users] cachemgr
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15253">[ date ]</a>
              <a href="thread.html#15253">[ thread ]</a>
              <a href="subject.html#15253">[ subject ]</a>
              <a href="author.html#15253">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Juan,

Without delving into ICAP and HTTP semantics you should notice\remember one thing:
Proxies which are performing as an ICAP client should not care about a scenario which a single TCP connection is being used for a single query.
If indeed you find that this scenario, which many connections are being opened and closed towards the ICAP service, affects your service I believe you should rethink things over.
The directions you should think are:
 - Software(OS or Squid or ICAP service)
 - Hardware (CPU, RAM)
 - Network (Network interfaces, Cables Switches)

I can testify that for HTTP content filtering and adaptation there are much more efficient pieces of software out there(which includes internal content adaptation).

With the above in mind you should not really care too much about new TCP connections per request.
If you see some performance degradation in your environment I would recommend your to create a &quot;check list&quot; which will help you to decide what direction you should choose.

All The Bests,
Eliezer

* Let me know if you need some help with the check list or software which you can test.

----
<A HREF="http://ngtech.co.il/lmgtfy/">http://ngtech.co.il/lmgtfy/</A>
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>


From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Juan Ram?rez
Sent: Friday, May 12, 2017 3:50 AM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [squid-users] ICAP Persistent Connections vs Retries (with code review)

Hi,

Mi name is Juan, I am a Software Engineer from Uruguay. I think this message is more suited to the squid-dev mailing list due to the developer-oriented nature of the message but, given that the development list is for people who actually contributes code to Squid, I chose to post here.

I started using Squid a few days ago in order to test its content-adaptation capabilities. The plan was to test the ICAP implementation first and then maybe try the eCAP API as well.

In order to test ICAP, I based my code in the open source PYICAP project, I also ran some tests using the C-ICAP server.

It came to my attention that, even when persistent connections is enabled, Squid closes the ICAP connection everytime a new request arrives, like this:

1. A new request arrives
2. Squid creates a connection to the ICAP server
3. Content is adapted and returned to the client
4. Squid returns the connection to the connection pool
5. A new requests arrives
6. Squid closes the active connection
7. Squid opens a new connection to the ICAP server

Note: I am using only the RESPMOD method.
&lt;&lt;SNIP&gt;&gt;

-- 
Juan
:<i>wq
</I>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015244.html">[squid-users] ICAP Persistent Connections vs Retries (with code review)
</A></li>
	<LI>Next message (by thread): <A HREF="015233.html">[squid-users] cachemgr
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15253">[ date ]</a>
              <a href="thread.html#15253">[ thread ]</a>
              <a href="subject.html#15253">[ subject ]</a>
              <a href="author.html#15253">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
