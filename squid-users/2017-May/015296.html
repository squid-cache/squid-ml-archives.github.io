<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid custom error page
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20custom%20error%20page&In-Reply-To=%3CF9272F31-A3B4-46B7-A793-376F1A5DF562%40diladele.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015295.html">
   <LINK REL="Next"  HREF="015294.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid custom error page</H1>
    <B>Rafael Akchurin</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20custom%20error%20page&In-Reply-To=%3CF9272F31-A3B4-46B7-A793-376F1A5DF562%40diladele.com%3E"
       TITLE="[squid-users] Squid custom error page">rafael.akchurin at diladele.com
       </A><BR>
    <I>Wed May 17 14:50:06 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015295.html">[squid-users] Squid custom error page
</A></li>
        <LI>Next message (by thread): <A HREF="015294.html">[squid-users] Squid custom error page
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15296">[ date ]</a>
              <a href="thread.html#15296">[ thread ]</a>
              <a href="subject.html#15296">[ subject ]</a>
              <a href="author.html#15296">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please note if you first let the connect tunnel to succeed (forcing bump) and then block the next coming request through that tunnel - you will get the blocked message displayed.

We do it in ICAP (<A HREF="https://docs.diladele.com/faq/squid/cannot_connect_to_site_using_https.html">https://docs.diladele.com/faq/squid/cannot_connect_to_site_using_https.html</A>) - other community members may know better if it is possible to do that in Squid directly.

Beware of those using your tunnels to pump non http traffic though. Blocking the connect as it is done now in Squid keeps you on safe side.

Best regards,
Rafael Akchurin

Op 17 mei 2017 om 4:04 PM heeft Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;&gt; het volgende geschreven:

On 17/05/17 23:32, chcs wrote:
Firefox 53.0.2 , Chrome 58.3029 y Opera 44 display &quot;Proxy Server Refused
Connection&quot; page, instead of Squid custom error page, when connect to HTTPS
site which blocked by proxy server.
For example we try to connect to <A HREF="https://www.something.com">https://www.something.com</A> via Squid proxy
server which denied with 403 error this connect and send custom error page
with description of problem in older versions it's worked.
I'm using pfSense 2.4 (actual version squid 3.5.24).

Reproducible: Always

Steps to Reproduce:
1. Configure Firefox to use proxy server (SSL Proxy).
2. HTTPS/SSL Interception , Enable SSL filtering, splice all, CA: Let's
Encript autority
3. Try to connect to HTTPS site, which will be blocked by proxy server

Actual Results:
Firefox will display &quot;Page Load Error&quot; with description &quot;Proxy Server
Refused Connection. Firefox is configured to use a proxy server that is
refusing connections.&quot;
If we connect to HTTPS site which not blocked by proxy server OR using CA
self-signed issuer , all works fine.

Expected Results:
Display proxy server error page with deny info.

This is a well-known problem with Browsers, they all refuse to display any response to a CONNECT tunnel message.
&lt;On 17/05/17 23:32, chcs wrote:
Firefox 53.0.2 , Chrome 58.3029 y Opera 44 display &quot;Proxy Server Refused
Connection&quot; page, instead of Squid custom error page, when connect to HTTPS
site which blocked by proxy server.
For example we try to connect to <A HREF="https://www.something.com">https://www.something.com</A> via Squid proxy
server which denied with 403 error this connect and send custom error page
with description of problem in older versions it's worked.
I'm using pfSense 2.4 (actual version squid 3.5.24).

Reproducible: Always

Steps to Reproduce:
1. Configure Firefox to use proxy server (SSL Proxy).
2. HTTPS/SSL Interception , Enable SSL filtering, splice all, CA: Let's
Encript autority
3. Try to connect to HTTPS site, which will be blocked by proxy server

Actual Results:
Firefox will display &quot;Page Load Error&quot; with description &quot;Proxy Server
Refused Connection. Firefox is configured to use a proxy server that is
refusing connections.&quot;
If we connect to HTTPS site which not blocked by proxy server OR using CA
self-signed issuer , all works fine.

Expected Results:
Display proxy server error page with deny info.

This is a well-known problem with Browsers, they all refuse to display any response to a CONNECT tunnel message.
&lt;<A HREF="http://wiki.squid-cache.org/Features/CustomErrors#Custom_error_pages_not_displayed_for_HTTPS">http://wiki.squid-cache.org/Features/CustomErrors#Custom_error_pages_not_displayed_for_HTTPS</A>&gt;

Use of TLS to secure the connection to the proxy does not affect this browser behaviour on HTTPS traffic. The best you can hope for is to make Squid use a 511 status code with deny_info and hope that it chooses to display something halfway useful.

Amos

_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170517/2b2f2b70/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170517/2b2f2b70/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015295.html">[squid-users] Squid custom error page
</A></li>
	<LI>Next message (by thread): <A HREF="015294.html">[squid-users] Squid custom error page
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15296">[ date ]</a>
              <a href="thread.html#15296">[ thread ]</a>
              <a href="subject.html#15296">[ subject ]</a>
              <a href="author.html#15296">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
