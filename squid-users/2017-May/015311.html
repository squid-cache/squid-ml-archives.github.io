<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid works with ssl bump in intercept mode and root certificate in browser, but apps does not work
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20works%20with%20ssl%20bump%20in%20intercept%20mode%20and%0A%20root%20certificate%20in%20browser%2C%20but%20apps%20does%20not%20work&In-Reply-To=%3C277d6606-89db-da7b-9d18-cd40fa8b11f5%40urlfilterdb.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015310.html">
   <LINK REL="Next"  HREF="015314.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid works with ssl bump in intercept mode and root certificate in browser, but apps does not work</H1>
    <B>Marcus Kool</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20works%20with%20ssl%20bump%20in%20intercept%20mode%20and%0A%20root%20certificate%20in%20browser%2C%20but%20apps%20does%20not%20work&In-Reply-To=%3C277d6606-89db-da7b-9d18-cd40fa8b11f5%40urlfilterdb.com%3E"
       TITLE="[squid-users] Squid works with ssl bump in intercept mode and root certificate in browser, but apps does not work">marcus.kool at urlfilterdb.com
       </A><BR>
    <I>Thu May 18 10:59:16 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015310.html">[squid-users] Squid works with ssl bump in intercept mode and root certificate in browser, but apps does not work
</A></li>
        <LI>Next message (by thread): <A HREF="015314.html">[squid-users] Squid works with ssl bump in intercept mode and root certificate in browser, but apps does not work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15311">[ date ]</a>
              <a href="thread.html#15311">[ thread ]</a>
              <a href="subject.html#15311">[ subject ]</a>
              <a href="author.html#15311">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>You have not stated which version of Squid you are using but my guess is that it is 3.5.x.

facebook app and other apps use port 443 but do not use HTTPS and therefore Squid does not how to bump it and consequently the app does not work.

What you need is the not yet stable Squid 4.0 and use the option
    on_unsupported_protocol tunnel all
so that the non-HTTPS protocols get through without being bumped.

Marcus


On 18/05/17 07:26, arun.xavier wrote:
&gt;<i> I have configured squid with ssl-bump (intercept mode) and it works as
</I>&gt;<i> expected while accessing secure sites from browsers.
</I>&gt;<i>
</I>&gt;<i> What I have done so far.
</I>&gt;<i>
</I>&gt;<i>  - Configured squid.
</I>&gt;<i>  - created a root&amp; intermediate certificate for dynamic cert generation in
</I>&gt;<i> squid.
</I>&gt;<i>      installed the same root certificate in mobile device(iphone 6 -iOS-10).
</I>&gt;<i>  - Every website works on chrome/safari.
</I>&gt;<i>
</I>&gt;<i> But apps like facebook,twitter are not working(showing network error).
</I>&gt;<i>
</I>&gt;<i> When checking cache log of squid, I found the below log.
</I>&gt;<i>
</I>&gt;<i> /Error negotiating SSL connection on FD 12: error:14094418:SSL
</I>&gt;<i> routines:ssl3_read_bytes:tlsv1 alert unknown ca (1/0)
</I>&gt;<i> /
</I>&gt;<i> It looks like initial CONNECT/Handshake is not working.
</I>&gt;<i>
</I>&gt;<i> what I have changed in squid.conf
</I>&gt;<i> -----------------------------------------------------------------
</I>&gt;<i> acl localnet src 172.16.0.0/12
</I>&gt;<i> acl localnet src fe80::/10
</I>&gt;<i> acl allow localnet
</I>&gt;<i> ssl_bump bump all
</I>&gt;<i> always_direct allow all
</I>&gt;<i> http_port localhost:3128
</I>&gt;<i> http_port localhost:3129 intercept
</I>&gt;<i> https_port localhost:3130 intercept ssl-bump generate-host-certificates=on
</I>&gt;<i> cert=/etc/squid/cert/cert.pem
</I>&gt;<i> key=/etc/squid/cert/key.pem
</I>&gt;<i> strip_query_terms off
</I>&gt;<i> ----------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> Any idea how to fix this? or where to check? What might be my mistake ?
</I>&gt;<i> PS:
</I>&gt;<i> I use squid to get logs of all internet traffic from mobile devices.
</I>&gt;<i> Overview of my intented system is like this:
</I>&gt;<i> SmartPhone----&gt;VPN---&gt;Squid---&gt;Internet
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> View this message in context: <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-works-with-ssl-bump-in-intercept-mode-and-root-certificate-in-browser-but-apps-does-not-work-tp4682451.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-works-with-ssl-bump-in-intercept-mode-and-root-certificate-in-browser-but-apps-does-not-work-tp4682451.html</A>
</I>&gt;<i> Sent from the Squid - Users mailing list archive at Nabble.com.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015310.html">[squid-users] Squid works with ssl bump in intercept mode and root certificate in browser, but apps does not work
</A></li>
	<LI>Next message (by thread): <A HREF="015314.html">[squid-users] Squid works with ssl bump in intercept mode and root certificate in browser, but apps does not work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15311">[ date ]</a>
              <a href="thread.html#15311">[ thread ]</a>
              <a href="subject.html#15311">[ subject ]</a>
              <a href="author.html#15311">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
