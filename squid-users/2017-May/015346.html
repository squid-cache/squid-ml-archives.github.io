<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] How to redirect all squid's error pages to one?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20How%20to%20redirect%20all%20squid%27s%20error%20pages%20to%20one%3F&In-Reply-To=%3C62a3569c-f589-d4cb-d30d-0d089aeea351%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015344.html">
   <LINK REL="Next"  HREF="015351.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] How to redirect all squid's error pages to one?</H1>
    <B>Dijxie</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20How%20to%20redirect%20all%20squid%27s%20error%20pages%20to%20one%3F&In-Reply-To=%3C62a3569c-f589-d4cb-d30d-0d089aeea351%40gmail.com%3E"
       TITLE="[squid-users] How to redirect all squid's error pages to one?">dijxie at gmail.com
       </A><BR>
    <I>Fri May 19 16:22:15 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015344.html">[squid-users] How to redirect all squid's error pages to one?
</A></li>
        <LI>Next message (by thread): <A HREF="015351.html">[squid-users] How to redirect all squid's error pages to one?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15346">[ date ]</a>
              <a href="thread.html#15346">[ thread ]</a>
              <a href="subject.html#15346">[ subject ]</a>
              <a href="author.html#15346">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>W dniu 19.05.2017 o 17:16, Amos Jeffries pisze:
&gt;<i> On 20/05/17 02:55, Dijxie wrote:
</I>&gt;&gt;<i> W dniu 19.05.2017 o 15:13, Amos Jeffries pisze:
</I>&gt;&gt;&gt;<i> On 20/05/17 00:44, Dijxie wrote:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Hi list,
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> 1. I'd like to redirect **all** squid error pages to one, 
</I>&gt;&gt;&gt;&gt;<i> universal, preferably internal squid error page. For sure I can 
</I>&gt;&gt;&gt;&gt;<i> symlink every error page to one, but is there a clener way?
</I>&gt;&gt;&gt;&gt;<i> I'm not sure if I get it: 
</I>&gt;&gt;&gt;&gt;<i> <A HREF="http://www.squid-cache.org/Doc/config/deny_info/">http://www.squid-cache.org/Doc/config/deny_info/</A>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> deny_info is to provide some non-default response payload (aka. 
</I>&gt;&gt;&gt;<i> &quot;page&quot;) instead of the 403 when an ACL performs administrative 
</I>&gt;&gt;&gt;<i> denial of access.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> As to your purpose; What is this universal message that conveys all 
</I>&gt;&gt;&gt;<i> possible environmental conditions to the reader in one simple text?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Keep in mind that the reader may not be human; some errors are 
</I>&gt;&gt;&gt;<i> explanations of indirect problems and only visible when the 
</I>&gt;&gt;&gt;<i> accompanying machine instructions reach a failure (eg 30x, 401, 407 
</I>&gt;&gt;&gt;<i> messages); and some are not errors at all but instructions for a 
</I>&gt;&gt;&gt;<i> user on what they need to do to continue with communication (eg 511 
</I>&gt;&gt;&gt;<i> login pages).
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> 2. And then, using %e code and presumably external js nested in 
</I>&gt;&gt;&gt;&gt;<i> this page, display more detailed info for some error numbers.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Can it be done? Can squid internal web server handle easy js?
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Squid is not a web server. On &quot;error&quot; it produces message payloads 
</I>&gt;&gt;&gt;<i> which happen to contain HTML by default. Modern HTML can contain 
</I>&gt;&gt;&gt;<i> embedded scripts, but they are not interpreted by Squid as anything 
</I>&gt;&gt;&gt;<i> beyond opaque characters.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> If you redirect all errors to one URL any information the client 
</I>&gt;&gt;&gt;<i> might have had about the error is destroyed.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> The symlinking you though of is the &quot;best&quot; way to do what you are 
</I>&gt;&gt;&gt;<i> asking for. However, think carefully about what the purpose of 
</I>&gt;&gt;&gt;<i> displaying an error message is, see above.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Amos
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> squid-users mailing list
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The purpose is to provide unified, debug info for 1st line of 
</I>&gt;&gt;<i> support. End users in my corpo are not best IT trained people in the 
</I>&gt;&gt;<i> world and they tend to open tickets for any reason, usually pasting 
</I>&gt;&gt;<i> printscreen into ticket.
</I>&gt;&gt;<i> Simple debug info like: IP, user name, client name, cache name in 
</I>&gt;&gt;<i> short list would help service desk to divide &quot;moronic&quot; tickets from 
</I>&gt;&gt;<i> important ones, and as for default squid info pages... user do not 
</I>&gt;&gt;<i> read them anyway. I do not want to remove error codes, I just want to 
</I>&gt;&gt;<i> remove content of most error pages and replace it with unified 
</I>&gt;&gt;<i> message that also contains raw error code (%e, %E) and add some more 
</I>&gt;&gt;<i> information if %e will be nxdomain or access denied for example.
</I>&gt;&gt;<i> Unfortunately, I'm far from VPN right now, so I cannot show you the 
</I>&gt;&gt;<i> sample &quot;unified&quot; error page I've commited till now.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> But indeed, you have striked the home; cache users are both human and 
</I>&gt;&gt;<i> machine$ AD accounts, I must reconsider that. Perhaps parsing all 
</I>&gt;&gt;<i> error pages with sed ie and adding few lines will be easer and more 
</I>&gt;&gt;<i> convenient, anyway.
</I>&gt;&gt;<i> I know that squid is not web serwer, but error page is html; I assume 
</I>&gt;&gt;<i> it can contains iframe served from external web server and this will 
</I>&gt;&gt;<i> be rendered by client's browser, not squid? My idea was:
</I>&gt;&gt;<i> - js nested in squid error page looks for error code
</I>&gt;&gt;<i> - then redirects nested iframe to specific URL hosted on external 
</I>&gt;&gt;<i> httpd depending on error code. If error code is unimportant for human 
</I>&gt;&gt;<i> (user can do nothing with that anyway), iframe stays blank.
</I>&gt;&gt;<i> - human client has has his explenation like &quot;this is your error, do 
</I>&gt;&gt;<i> not open ticket please, check your URL again&quot; for nxdomain.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> We are talking about ~2K users and 3-4 cache servers. I must take 
</I>&gt;&gt;<i> comfort of first line support into concideration, they are quite 
</I>&gt;&gt;<i> heavy-loaded already.
</I>&gt;&gt;<i> I'm not feeling comfortable with this idea, but I also have a feeling 
</I>&gt;&gt;<i> that it might be necessity.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I think a better approach may be a link they can click on that 
</I>&gt;<i> automatically reports the details for them. Some of our errors already 
</I>&gt;<i> include a mailto web link to contact the administrator that embeds the 
</I>&gt;<i> error details in subject etc as an example. But you can go a bit 
</I>&gt;<i> further with a jQuery script that pulls IP etc and POSTs them to a 
</I>&gt;<i> support database API.
</I>&gt;<i>
</I>&gt;<i> You can also reduce a bit of the work editing files by pointing 
</I>&gt;<i> error_directory in squid.conf to a directory with your altered 
</I>&gt;<i> templates. That will save your changes from being overwritten when the 
</I>&gt;<i> OS packaged ones update.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
It would be yet another explanatory link they don't ever click, 
unfortunately. But yes, I know it would be a better approach. This is an 
organizational and 'political' issue and me myself can do nothing about it.
malto: is alredy removed - they cannot open tickets this way and we do 
not want to be flooded by emails like that.

That was my pimal idea: simle database/array that contains some criteria 
like:
if %e is bad gateway and %I=10.10.10.69 and %i=10.22.0.0/16 then iframe 
says: &quot;we alredy told you 10000 times that you shall not try to access 
%H server from %i network&quot;. Then I could give user info database's 
managment to the people in service desk so they can change info 
depending on the buisiness circumstances - without reconfiguration of 
all squids (that should be identical because of LB and FO) and harrasing 
my department of course :)

If they (end users) open a ticket in circumstances they were precisely 
instructed not to do so, they (their company) are extra charged. If they 
open a ticket because they do not know what to do, service desk folks 
have to do unnecessary work for nothing. And common practice is 
everybody forgets to inform users and service desk about changes or 3rd 
party supporting companies change something on their machines causing 
huge mess and 2300 identical tickets within an hour; I'm just trying to 
provide  kind of dynamic, easy managed and functional error page that 
can provide basic explenation for end users if needed.

So: js/jq + external iframe in error page(s) is something that does not 
violate standards? Let's not talk about common sense here ;)

Greets, Dijx

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170519/9c37fa0a/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170519/9c37fa0a/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015344.html">[squid-users] How to redirect all squid's error pages to one?
</A></li>
	<LI>Next message (by thread): <A HREF="015351.html">[squid-users] How to redirect all squid's error pages to one?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15346">[ date ]</a>
              <a href="thread.html#15346">[ thread ]</a>
              <a href="subject.html#15346">[ subject ]</a>
              <a href="author.html#15346">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
