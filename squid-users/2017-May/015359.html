<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] FW: squid-users Digest, Vol 33, Issue 64
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FW%3A%20squid-users%20Digest%2C%20Vol%2033%2C%20Issue%2064&In-Reply-To=%3C009601d2d1b7%2449118130%24db348390%24%40verizon.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015369.html">
   <LINK REL="Next"  HREF="015360.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] FW: squid-users Digest, Vol 33, Issue 64</H1>
    <B>vze2k3sa at verizon.net</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20FW%3A%20squid-users%20Digest%2C%20Vol%2033%2C%20Issue%2064&In-Reply-To=%3C009601d2d1b7%2449118130%24db348390%24%40verizon.net%3E"
       TITLE="[squid-users] FW: squid-users Digest, Vol 33, Issue 64">vze2k3sa at verizon.net
       </A><BR>
    <I>Sat May 20 22:20:27 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015369.html">[squid-users] It is possible to use SSL_bump on my squid server 3.5.23, if my parent cache (cache_peer) does not use ssl_bump (not configured).
</A></li>
        <LI>Next message (by thread): <A HREF="015360.html">[squid-users] clientside_mark
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15359">[ date ]</a>
              <a href="thread.html#15359">[ thread ]</a>
              <a href="subject.html#15359">[ subject ]</a>
              <a href="author.html#15359">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>----------------------------------------------------------------------------
---

 

Thanks so much Amos, I eliminated a lot of lines per your suggestion and I
see now how line precedence matters!

 

Also the directive ' http_port 80 accel' seems to have seemingly sped up the
server dramatically. It co-exists with my default listening ports which is a
bit confusing.

 

http_port 3128

http_port 80 accel

 

Do both of these (speed and co-existance) makes sense?

 

Thanks again,

Patrick

 

----------------------------------------------------------------------------
---

 

Message: 3

Date: Sat, 20 May 2017 23:22:26 +1200

From: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A> &lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; &gt;

To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt; 

Subject: Re: [squid-users] Change are not taking

Message-ID: &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">f50726c5-07fd-8b01-4eae-05cde2444b37 at treenet.co.nz</A>
&lt;mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">f50726c5-07fd-8b01-4eae-05cde2444b37 at treenet.co.nz</A>&gt; &gt;

Content-Type: text/plain; charset=utf-8; format=flowed

 

On 20/05/17 05:13, Patrick Flaherty wrote:

&gt;<i> 
</I>
&gt;<i> Hi,
</I>
&gt;<i> 
</I>
&gt;<i> I am making changes to my squid.conf, yet they don't seem to take. Is 
</I>
&gt;<i> there something I'm missing? Any help appreciated
</I>
&gt;<i> 
</I>
 

&gt;<i>From the changes below it looks like you are attempting to configure a
</I>reverse-proxy. Relevant changes below:

 

&gt;<i> # Squid Proxy Configuration
</I>
&gt;<i> 
</I>
&gt;<i> # Network(s) where proxy traffic is originating
</I>
&gt;<i> 
</I>
&gt;<i> # acl localnet src 10.0.0.0/8          # RFC1918 possible internal network
</I>
&gt;<i> 
</I>
&gt;<i> # acl localnet src 172.16.0.0/12   # RFC1918 possible internal network
</I>
&gt;<i> 
</I>
&gt;<i> # acl localnet src 192.168.0.0/16 # RFC1918 possible internal network
</I>
&gt;<i> 
</I>
&gt;<i> acl localnet src all
</I>
&gt;<i> 
</I>
 

Remove the above change.

 

&gt;<i> # acl and http_access (&quot;rmsc.txt&quot;)
</I>
&gt;<i> 
</I>
&gt;<i> acl whitelist dstdomain &quot;c:/squid/etc/squid/rmsc.txt&quot;
</I>
&gt;<i> 
</I>
&gt;<i> http_access        allow     whitelist
</I>
&gt;<i> 
</I>
Move this section down to the place marked below.

 

&gt;<i> acl http      proto      http
</I>
&gt;<i> 
</I>
&gt;<i> acl https     proto      https
</I>
&gt;<i> 
</I>
&gt;<i> acl SSL_ports port 443
</I>
&gt;<i> 
</I>
&gt;<i> acl Safe_ports port 80                    # http
</I>
&gt;<i> 
</I>
&gt;<i> acl Safe_ports port 443                  # https
</I>
&gt;<i> 
</I>
&gt;<i> acl CONNECT method CONNECT
</I>
&gt;<i> 
</I>
&gt;<i> # rules allowing proxy access
</I>
&gt;<i> 
</I>
&gt;<i> http_access allow http  Safe_ports whitelist localnet
</I>
&gt;<i> 
</I>
&gt;<i> http_access allow https SSL_ports whitelist localnet
</I>
&gt;<i> 
</I>
 

Remove the above http_access lines.

 

&gt;<i> # Deny requests to certain unsafe ports
</I>
&gt;<i> 
</I>
&gt;<i> http_access deny !Safe_ports
</I>
&gt;<i> 
</I>
&gt;<i> # Deny CONNECT to other than secure SSL ports
</I>
&gt;<i> 
</I>
&gt;<i> http_access deny CONNECT !SSL_ports
</I>
&gt;<i> 
</I>
 

This is where the whiltelist lines should be placed.

 

&gt;<i> # Lastly deny all other access to this proxy
</I>
&gt;<i> 
</I>
&gt;<i> http_access deny all
</I>
&gt;<i> 
</I>
&gt;<i> # Listens to port 3128
</I>
&gt;<i> 
</I>
&gt;<i> http_port 3128
</I>
&gt;<i> 
</I>
 

Add this line:

  http_port 80 accel

 

&gt;<i> # DNS servers (Change dns_nameservers to client dns servers for 
</I>
&gt;<i> consistency and better performance)
</I>
&gt;<i> 
</I>
&gt;<i> dns_nameservers 8.8.8.8 8.8.4.4
</I>
&gt;<i> 
</I>
 

NP: Google DNS server farm design causes DNS results to churn on every
single request. This breaks HTTP/1.x connection persistence, pipeline and
multiplexing performance features. If you want these performance enhancing
features to work properly you should run your own local DNS resolver and
have Squid and the LAN use that.

 

&gt;<i> # Roll log file daily and keep 30 days
</I>
&gt;<i> 
</I>
&gt;<i> logfile_rotate 30
</I>
&gt;<i> 
</I>
&gt;<i> # Access log format
</I>
&gt;<i> 
</I>
&gt;<i> logformat squid %tl %6tr %&gt;a %Ss/%03&gt;Hs %&lt;st %rm %ru %un %Sh/%&lt;A %mt
</I>
&gt;<i> 
</I>
&gt;<i> 
</I>
 

Do not re-define the &quot;squid&quot; default logformat the result will not be what
you want.

If you need something that is not provided by one of the default formats use
a format name of your own choosing name.

 

&gt;<i> # Debug (Only used by Rave Service Personnel)
</I>
&gt;<i> 
</I>
&gt;<i> # debug_options             ALL,2
</I>
&gt;<i> 
</I>
&gt;<i> # Use IPv4 based DNS first
</I>
&gt;<i> 
</I>
&gt;<i> dns_v4_first on
</I>
&gt;<i> 
</I>
&gt;<i> # Log definitions
</I>
&gt;<i> 
</I>
&gt;<i> access_log stdio:c:/Squid/var/log/squid/access.log
</I>
&gt;<i> 
</I>
&gt;<i> cache_store_log stdio:c:/Squid/var/log/squid/store.log
</I>
&gt;<i> 
</I>
&gt;<i> buffered_logs on
</I>
&gt;<i> 
</I>
&gt;<i> 
</I>
 

.. and finally as Dijixie mentioned dont forget to reload Squid.

 

PS: If you are using Squid-3 on one of the latest Linux with systemd that
may need to be a full stop/start cycle to make sure it works due to problems
systemd has with services like Squid-3.

 

Amos

 

 

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170520/a6911034/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170520/a6911034/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015369.html">[squid-users] It is possible to use SSL_bump on my squid server 3.5.23, if my parent cache (cache_peer) does not use ssl_bump (not configured).
</A></li>
	<LI>Next message (by thread): <A HREF="015360.html">[squid-users] clientside_mark
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15359">[ date ]</a>
              <a href="thread.html#15359">[ thread ]</a>
              <a href="subject.html#15359">[ subject ]</a>
              <a href="author.html#15359">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
