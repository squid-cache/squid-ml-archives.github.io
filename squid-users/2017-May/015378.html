<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Problem with Squid3 Authentication ( after	sambaupgrades )
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problem%20with%20Squid3%20Authentication%20%28%20after%0A%09sambaupgrades%20%29&In-Reply-To=%3Cvmime.5923e03a.7d2d.3a08459675107ada%40ms249-lin-003.rotterdam.bazuin.nl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015370.html">
   <LINK REL="Next"  HREF="015372.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Problem with Squid3 Authentication ( after	sambaupgrades )</H1>
    <B>L.P.H. van Belle</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Problem%20with%20Squid3%20Authentication%20%28%20after%0A%09sambaupgrades%20%29&In-Reply-To=%3Cvmime.5923e03a.7d2d.3a08459675107ada%40ms249-lin-003.rotterdam.bazuin.nl%3E"
       TITLE="[squid-users] Problem with Squid3 Authentication ( after	sambaupgrades )">belle at bazuin.nl
       </A><BR>
    <I>Tue May 23 07:09:46 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015370.html">[squid-users] Problem with Squid3 Authentication
</A></li>
        <LI>Next message (by thread): <A HREF="015372.html">[squid-users] a bit off topic. New user question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15378">[ date ]</a>
              <a href="thread.html#15378">[ thread ]</a>
              <a href="subject.html#15378">[ subject ]</a>
              <a href="author.html#15378">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Amos and others. 

Its not a &quot;samba&quot; thing or a squid thing.   
Maybe in the end yes, but this is a configuration thing. 

For you guys to know, samba AD DC setup this parameter as default : 
 ldap server require strong auth = yes 
Which obligates the use of TLS. 

Next, users dont configure /etc/ldap/ldap.conf when they use TLS. 
Squid and samba may need the CA root if you use TLS. 
Which should to in ldap.conf 
TLS_CACERT      /etc/ssl/certs/ca-certificates.crt
TLS_REQCERT allow

Samba sets these days: 
ntlm auth = no
Laman auth = no

Which disables NTLMv1 and last, users dont know kerberos and the need of A/PTR records. 

For others, i've posted a example auth setup and smb.conf setup for squid on Debian Jessie.
Tested as of squid 3.4.8 upto 3.5.24. ( with and without ssl bumping ) 
Google for : Problems with Samba 4.6.3 Authentication  
Post date 23-may 2017

When upgrading samba/winbind as of 4.2 upto 4.5 or 4.6. 
You MUST read the change logs at least for every samba 4.X.0 version. \
At least 4.2.0 4.3.0 4.4.0 4.5.0 and 4.6.0 

<A HREF="https://www.samba.org/samba/history/">https://www.samba.org/samba/history/</A> 
Look a the smb.conf changes. 
Like this one for 4.5 : 
smb.conf changes
================

  Parameter Name                Description             Default
  --------------                -----------             -------
  kccsrv:samba_kcc              Changed default         yes
  ntlm auth                     Changed default         no
  only user                     Removed
  password hash gpg key ids     New
  shadow:snapprefix             New
  shadow:delimiter              New                     _GMT
  smb2 leases                   Changed default         yes
  username                      Removed



Greetz, 

Louis



 

&gt;<i> -----Oorspronkelijk bericht-----
</I>&gt;<i> Van: squid-users 
</I>&gt;<i> [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] Namens 
</I>&gt;<i> Amos Jeffries
</I>&gt;<i> Verzonden: maandag 22 mei 2017 22:46
</I>&gt;<i> Aan: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Onderwerp: Re: [squid-users] Problem with Squid3 Authentication
</I>&gt;<i> 
</I>&gt;<i> On 23/05/17 02:15, Marcio Demetrio Bacci wrote:
</I>&gt;<i> &gt; I have migrated of Samba 4.2.1 to Samba 4.6.3 as DC, but 
</I>&gt;<i> now my Squid 
</I>&gt;<i> &gt; authentication doesn't work.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; In samba 4.2.1 is working properly.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This is my authentication block:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; auth_param basic program /usr/lib/squid3/basic_ldap_auth -R -b 
</I>&gt;<i> &gt; DC=empresa,DC=com,DC=br -D CN=proxy,CN=Users,DC=empresa,DC=com,DC=br
</I>&gt;<i> &gt; -w password -h 192.168.10.4 -p 389 -s sub -v 3 -f 
</I>&gt;<i> &quot;sAMAccountName=%s&quot;
</I>&gt;<i> &gt; auth_param basic children 50
</I>&gt;<i> &gt; auth_param basic realm Access Monitored auth_param basic 
</I>&gt;<i> &gt; credentialsttl 8 hours auth_param basic casesensitive off
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I'm using Squid 3.4.8
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Can anybody help me ?
</I>&gt;<i> 
</I>&gt;<i> If the only thing that changed was Samba its clearly an issue 
</I>&gt;<i> with that end of the system.
</I>&gt;<i> 
</I>&gt;<i> I suggest you compare those LDAP parameters with what the new 
</I>&gt;<i> Samba version needs, and if there is no issue there please 
</I>&gt;<i> contact your vendor or the Samba help channels.
</I>&gt;<i> 
</I>&gt;<i> Amos
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015370.html">[squid-users] Problem with Squid3 Authentication
</A></li>
	<LI>Next message (by thread): <A HREF="015372.html">[squid-users] a bit off topic. New user question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15378">[ date ]</a>
              <a href="thread.html#15378">[ thread ]</a>
              <a href="subject.html#15378">[ subject ]</a>
              <a href="author.html#15378">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
