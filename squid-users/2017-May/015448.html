<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TCP_DENIED/407 accessing webserver on same machine as squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_DENIED/407%20accessing%20webserver%20on%20same%0A%20machine%20as%20squid&In-Reply-To=%3C1930856943.805298.1495824410829%40mail.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015446.html">
   <LINK REL="Next"  HREF="015449.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TCP_DENIED/407 accessing webserver on same machine as squid</H1>
    <B>j m</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_DENIED/407%20accessing%20webserver%20on%20same%0A%20machine%20as%20squid&In-Reply-To=%3C1930856943.805298.1495824410829%40mail.yahoo.com%3E"
       TITLE="[squid-users] TCP_DENIED/407 accessing webserver on same machine as squid">acctforjunk at yahoo.com
       </A><BR>
    <I>Fri May 26 18:46:50 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015446.html">[squid-users] TCP_DENIED/407 accessing webserver on same machine as squid
</A></li>
        <LI>Next message (by thread): <A HREF="015449.html">[squid-users] TCP_DENIED/407 accessing webserver on same machine as squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15448">[ date ]</a>
              <a href="thread.html#15448">[ thread ]</a>
              <a href="subject.html#15448">[ subject ]</a>
              <a href="author.html#15448">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Here's my squid.conf.&#160; For what it's worth, shellinabox can be made to use only HTTP if that's the issue.

auth_param digest program /usr/lib/squid/digest_file_auth -c /etc/squid/passwd auth_param digest realm myrealm auth_param digest children 2  acl auth_users proxy_auth REQUIRED acl SSL_ports port 443 acl SSL_ports port SHELLINABOX_PORT acl Safe_ports port SHELLINABOX_PORT acl Safe_ports port 80 # http acl Safe_ports port 21 # ftp acl Safe_ports port 443 # https acl Safe_ports port 70 # gopher acl Safe_ports port 210 # wais #acl Safe_ports port 1025-65535 # unregistered ports acl Safe_ports port 280 # http-mgmt acl Safe_ports port 488 # gss-http acl Safe_ports port 591 # filemaker acl Safe_ports port 777 # multiling http acl CONNECT method CONNECT http_access deny !Safe_ports http_access deny CONNECT !SSL_ports http_access allow auth_users http_access allow all https_port SQUID_PORT cert=/etc/squid/squid.pem cache deny all netdb_filename none 

      From: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
 To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A> 
 Sent: Friday, May 26, 2017 12:29 PM
 Subject: Re: [squid-users] TCP_DENIED/407 accessing webserver on same machine as squid
   


On 27/05/17 04:17, j m wrote:
&gt;<i> I have a webserver and squid 3.5 running on the same Linux machine.&#160; &gt; The webserver is actually part of shellinabox, so it's only for me 
</I>to &gt; access.&#160; Shellinabox simply presents a terminal and login in a web 
 &gt; browser.&#160; I want it to be accessible only through squid for more &gt; 
security. &gt; &gt; shellinabox works fine if I access it directly, but 
through squid I &gt; see this in access.log: &gt; &gt; 1495813953.860&#160; &#160; 79 
204.155.22.30 TCP_TUNNEL/200 1440 CONNECT &gt; IP:PORT USER HIER_DIRECT/IP 
 &gt; &gt; &gt; 1495813962.001&#160; &#160; &#160; 0 204.155.22.30 TCP_DENIED/407 4397 CONNECT &gt; 
IP:PORT USER HIER_NONE/- text/html &gt; &gt; &gt; I've replaced the real IP, 
PORT, and USER with those words, however &gt; the real PORT is a 
nonstandard port number.There are some other &gt; posts I found mentioning 
a 407 error and it was said it occurs when &gt; the webpage is asking for 
authentication.&#160; However I don't understand &gt; this, since shellinabox 
only display a login prompt which I wouldn't &gt; think would be a 
problem.&#160; Another post said a 407 is when squid auth &gt; is failing, but I 
can get to external websites through squid. &gt; &gt; Does it matter that what 
I'm trying to access is HTTPS instead of &gt; HTTP?
Yes it does. Beyond the obvious encryption there are messaging 
differences that directly effect what the proxy can do.


The first log entry indicates that something has already been done to 
let the port &quot;work&quot;, so your config is already non-standard and probably 
doing something weird. The presence of a USER value other than &quot;-&quot; 
indicates that the proxy-auth is working at least for that transaction.

Yes the 407 is login to *Squid*. Nothing to do with the shellinabox 
software, the HEIR_NONE/- on the second line says shellinabox is not 
even being contacted yet for that transaction.


It is not possible to say why anything is happening here without knowing 
your config structure and intended policy. You will need to provide your 
squid.conf details to get much help.

If you need to obfuscate IP's please map them as if you were using the 
10/8 or 192.168/16 ranges so we can still identify any subtle things 
like TCP connections going wrong without revealing your public addresses.

Amos

_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170526/730f37c0/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170526/730f37c0/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015446.html">[squid-users] TCP_DENIED/407 accessing webserver on same machine as squid
</A></li>
	<LI>Next message (by thread): <A HREF="015449.html">[squid-users] TCP_DENIED/407 accessing webserver on same machine as squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15448">[ date ]</a>
              <a href="thread.html#15448">[ thread ]</a>
              <a href="subject.html#15448">[ subject ]</a>
              <a href="author.html#15448">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
