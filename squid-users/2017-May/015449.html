<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TCP_DENIED/407 accessing webserver on same machine as squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_DENIED/407%20accessing%20webserver%20on%20same%0A%20machine%20as%20squid&In-Reply-To=%3Caee71073-23aa-4478-0224-5ee40ef5081b%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015448.html">
   <LINK REL="Next"  HREF="015450.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TCP_DENIED/407 accessing webserver on same machine as squid</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_DENIED/407%20accessing%20webserver%20on%20same%0A%20machine%20as%20squid&In-Reply-To=%3Caee71073-23aa-4478-0224-5ee40ef5081b%40treenet.co.nz%3E"
       TITLE="[squid-users] TCP_DENIED/407 accessing webserver on same machine as squid">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri May 26 19:52:52 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015448.html">[squid-users] TCP_DENIED/407 accessing webserver on same machine as squid
</A></li>
        <LI>Next message (by thread): <A HREF="015450.html">[squid-users] TCP_DENIED/407 accessing webserver on same machine as squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15449">[ date ]</a>
              <a href="thread.html#15449">[ thread ]</a>
              <a href="subject.html#15449">[ subject ]</a>
              <a href="author.html#15449">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ah, your problem seems to be a misunderstanding of how authentication works.

What Squid receives on messages can have three forms:

  1) no credentials at all
  2) correct credentials
  3) invalid credentials

Your definition of the auth_users ACL using &quot;REQUIRED&quot; takes care of the 
(1) situation. Squid will respond with 407 to get credentials from any 
client that does not send any. This is what you are seeing on that 
second log line of your previous post, and the popup in your tests.

Now the &quot;http_access allow auth_users&quot; line only takes care of situation 
(2), permitting valid users.

Which leaves situation (3) undefined. ... All other traffic continues on 
to the next http_access line, which is &quot;allow all&quot;, ouch.


This is why best practice is to use a &quot;deny&quot; line like so:
   http_access deny !auth_users

... which makes it clear what is happening for every non-authenticated 
thing, both situation (1) and (2) traffic.

Rules permitting things through without authenticating go above that 
http_access line, and things applying to authenticated users go below it.

Amos


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015448.html">[squid-users] TCP_DENIED/407 accessing webserver on same machine as squid
</A></li>
	<LI>Next message (by thread): <A HREF="015450.html">[squid-users] TCP_DENIED/407 accessing webserver on same machine as squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15449">[ date ]</a>
              <a href="thread.html#15449">[ thread ]</a>
              <a href="subject.html#15449">[ subject ]</a>
              <a href="author.html#15449">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
