<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TCP_DENIED/407 accessing webserver on same machine as squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_DENIED/407%20accessing%20webserver%20on%20same%0A%20machine%20as%20squid&In-Reply-To=%3C1277246723.1033708.1495847430739%40mail.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015450.html">
   <LINK REL="Next"  HREF="015463.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TCP_DENIED/407 accessing webserver on same machine as squid</H1>
    <B>j m</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_DENIED/407%20accessing%20webserver%20on%20same%0A%20machine%20as%20squid&In-Reply-To=%3C1277246723.1033708.1495847430739%40mail.yahoo.com%3E"
       TITLE="[squid-users] TCP_DENIED/407 accessing webserver on same machine as squid">acctforjunk at yahoo.com
       </A><BR>
    <I>Sat May 27 01:10:30 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="015450.html">[squid-users] TCP_DENIED/407 accessing webserver on same machine as squid
</A></li>
        <LI>Next message (by thread): <A HREF="015463.html">[squid-users] How to intercept ssl_bump transparent NAT https	websites
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15452">[ date ]</a>
              <a href="thread.html#15452">[ thread ]</a>
              <a href="subject.html#15452">[ subject ]</a>
              <a href="author.html#15452">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Yes, I sort of pieced together what I found online, which is probably dangerous. &#160;I really need to become familiar with how exactly this works for security's sake if nothing else.

      From: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
 To: j m &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">acctforjunk at yahoo.com</A>&gt;; &quot;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt; 
 Sent: Friday, May 26, 2017 2:53 PM
 Subject: Re: [squid-users] TCP_DENIED/407 accessing webserver on same machine as squid
   
Ah, your problem seems to be a misunderstanding of how authentication works.

What Squid receives on messages can have three forms:

&#160; 1) no credentials at all
&#160; 2) correct credentials
&#160; 3) invalid credentials

Your definition of the auth_users ACL using &quot;REQUIRED&quot; takes care of the 
(1) situation. Squid will respond with 407 to get credentials from any 
client that does not send any. This is what you are seeing on that 
second log line of your previous post, and the popup in your tests.

Now the &quot;http_access allow auth_users&quot; line only takes care of situation 
(2), permitting valid users.

Which leaves situation (3) undefined. ... All other traffic continues on 
to the next http_access line, which is &quot;allow all&quot;, ouch.


This is why best practice is to use a &quot;deny&quot; line like so:
&#160; http_access deny !auth_users

... which makes it clear what is happening for every non-authenticated 
thing, both situation (1) and (2) traffic.

Rules permitting things through without authenticating go above that 
http_access line, and things applying to authenticated users go below it.

Amos



   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170527/22e9a929/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170527/22e9a929/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="015450.html">[squid-users] TCP_DENIED/407 accessing webserver on same machine as squid
</A></li>
	<LI>Next message (by thread): <A HREF="015463.html">[squid-users] How to intercept ssl_bump transparent NAT https	websites
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15452">[ date ]</a>
              <a href="thread.html#15452">[ thread ]</a>
              <a href="subject.html#15452">[ subject ]</a>
              <a href="author.html#15452">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
