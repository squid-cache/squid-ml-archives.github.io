<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] With Rock storage, it seems an object can not be copied from disk cache to memory cache after a restart
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20With%20Rock%20storage%2C%0A%20it%20seems%20an%20object%20can%20not%20be%20copied%20from%20disk%20cache%20to%20memory%0A%20cache%20after%20a%20restart&In-Reply-To=%3C0da1b165-4a46-6bf3-aab5-e12e8c9ed81d%40ustc.edu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="016781.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] With Rock storage, it seems an object can not be copied from disk cache to memory cache after a restart</H1>
    <B>duanyao</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20With%20Rock%20storage%2C%0A%20it%20seems%20an%20object%20can%20not%20be%20copied%20from%20disk%20cache%20to%20memory%0A%20cache%20after%20a%20restart&In-Reply-To=%3C0da1b165-4a46-6bf3-aab5-e12e8c9ed81d%40ustc.edu%3E"
       TITLE="[squid-users] With Rock storage, it seems an object can not be copied from disk cache to memory cache after a restart">duanyao at ustc.edu
       </A><BR>
    <I>Wed Nov  1 02:03:43 UTC 2017</I>
    <P><UL>
        
        <LI>Next message (by thread): <A HREF="016781.html">[squid-users] With Rock storage, it seems an object can not be copied from disk cache to memory cache after a restart
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16780">[ date ]</a>
              <a href="thread.html#16780">[ thread ]</a>
              <a href="subject.html#16780">[ subject ]</a>
              <a href="author.html#16780">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I have an issue: if I restart Squid (with Rock storage), I can no longer 
get TCP_MEM_HIT for any object got cached before that restart -- I 
always get TCP_HIT instead.


Steps to reproduce:

1) Stop squid.

2) Remove &amp; create a new Rock storage, start Squid.

3) Get a url via Squid, e.g.:

   curl -o /dev/null -v -x localhost:3128 
<A HREF="http://cdn.bootcss.com/font-linux/0.9/font-linux.woff">http://cdn.bootcss.com/font-linux/0.9/font-linux.woff</A>

   Suppose Squid is running on localhost:3128.

   This should get a TCP_MISS.

4) Repeat step 3, and this should get a TCP_MEM_HIT.

5) Stop &amp; start Squid.

6) Repeat step 3 for more than 2 times, and all the results are TCP_HIT, 
however I expect the 2nd and following rounds should be TCP_MEM_HIT.


So it seems an object can never be copied from disk cache to memory 
cache after a restart. Is this normal?

I tested 3.5.27 and master branch in github, the results are same. The 
configuration file is attached.


Thanks.

Duan, Yao

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20171101/b4273683/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20171101/b4273683/attachment.htm</A>&gt;
-------------- next part --------------
workers 2

shutdown_lifetime 3 second

acl localnet src 10.0.0.0/8	# RFC1918 possible internal network
acl localnet src 172.16.0.0/12	# RFC1918 possible internal network
acl localnet src 192.168.0.0/16	# RFC1918 possible internal network
acl localnet src fc00::/7       # RFC 4193 local private network range
acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged) machines

acl SSL_ports port 443
acl Safe_ports port 80		# http
acl Safe_ports port 21		# ftp
acl Safe_ports port 443		# https
acl Safe_ports port 70		# gopher
acl Safe_ports port 210		# wais
acl Safe_ports port 1025-65535	# unregistered ports
acl Safe_ports port 280		# http-mgmt
acl Safe_ports port 488		# gss-http
acl Safe_ports port 591		# filemaker
acl Safe_ports port 777		# multiling http
acl CONNECT method CONNECT

http_access deny !Safe_ports

http_access deny CONNECT !SSL_ports

acl PURGE method PURGE
http_access allow PURGE localhost
http_access deny PURGE

http_access allow localhost manager
http_access deny manager

http_access allow localnet
http_access allow localhost

http_access deny all

http_port 3128

cache_dir rock /home/duanyao/project/proxy/squid-root/var/cache/squid/rock 10

cache_effective_user duanyao

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message (by thread): <A HREF="016781.html">[squid-users] With Rock storage, it seems an object can not be copied from disk cache to memory cache after a restart
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16780">[ date ]</a>
              <a href="thread.html#16780">[ thread ]</a>
              <a href="subject.html#16780">[ subject ]</a>
              <a href="author.html#16780">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
