<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3.5 with nonblocking ecap adapter
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5%20with%20nonblocking%20ecap%20adapter&In-Reply-To=%3C572c5876-1762-3284-9b0c-93d2188f237a%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016784.html">
   <LINK REL="Next"  HREF="016790.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3.5 with nonblocking ecap adapter</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5%20with%20nonblocking%20ecap%20adapter&In-Reply-To=%3C572c5876-1762-3284-9b0c-93d2188f237a%40measurement-factory.com%3E"
       TITLE="[squid-users] Squid 3.5 with nonblocking ecap adapter">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Nov  1 15:23:38 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016784.html">[squid-users] Squid 3.5 with nonblocking ecap adapter
</A></li>
        <LI>Next message (by thread): <A HREF="016790.html">[squid-users] Squid 3.5 with nonblocking ecap adapter
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16789">[ date ]</a>
              <a href="thread.html#16789">[ thread ]</a>
              <a href="subject.html#16789">[ subject ]</a>
              <a href="author.html#16789">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/01/2017 03:20 AM, Christof Gerber wrote:

&gt;<i> [Will Squid] be blocked until the eCAP API call returns?
</I>
To answer the exact question above: Yes, the Squid worker making an eCAP
API call will block until that call returns. The same is true for all
other API calls, all system calls, and all internal calls. This is how
C/C++ works. I am stating the obvious for the record, in case somebody
with a different (or insufficient) programming languages background
stumbles upon this thread.

What you are really asking, I suspect, is whether Squid or the eCAP
library uses threads to automatically make eCAP adapter operations
asynchronous to the primary Squid operations. The answer to that
question is &quot;no&quot;: The relevant Squid code does not use threads, and
there are no threads in the eCAP library code.

Also, there is no magical layer between Squid and 99% of eCAP calls --
Squid calls go directly to your eCAP adapter code and vice versa. IIRC,
the only (unimportant) exception to that &quot;direct calls&quot; observation is
the eCAP service registry API, where there is a thin eCAP layer
insulating the adapter from the host application. That layer is also
synchronous though.


&gt;<i> Is there a way other than
</I>&gt;<i> programming the eCAP adapter in asynchronous mode?
</I>
I do not think there is a better alternative. AFAICT, you only have two
options:

  A) Change Squid to move eCAP calls to thread(s).
  B) Use threads inside the adapter to make its operations asynchronous.

As you know, the sample async adapter and the ClamAV adapter use (B).
That approach has its problems (because it currently does not require
the host application to be threads-aware), but it works reasonably well
for many use cases.


Cheers,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016784.html">[squid-users] Squid 3.5 with nonblocking ecap adapter
</A></li>
	<LI>Next message (by thread): <A HREF="016790.html">[squid-users] Squid 3.5 with nonblocking ecap adapter
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16789">[ date ]</a>
              <a href="thread.html#16789">[ thread ]</a>
              <a href="subject.html#16789">[ subject ]</a>
              <a href="author.html#16789">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
