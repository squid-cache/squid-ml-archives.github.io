<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3.5 with nonblocking ecap adapter
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5%20with%20nonblocking%20ecap%20adapter&In-Reply-To=%3C1ce51ccb-5c48-18dc-d7f8-0b3cbf7ac91c%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016791.html">
   <LINK REL="Next"  HREF="016785.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3.5 with nonblocking ecap adapter</H1>
    <B>Yuri</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5%20with%20nonblocking%20ecap%20adapter&In-Reply-To=%3C1ce51ccb-5c48-18dc-d7f8-0b3cbf7ac91c%40gmail.com%3E"
       TITLE="[squid-users] Squid 3.5 with nonblocking ecap adapter">yvoinov at gmail.com
       </A><BR>
    <I>Wed Nov  1 15:40:39 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016791.html">[squid-users] Squid 3.5 with nonblocking ecap adapter
</A></li>
        <LI>Next message (by thread): <A HREF="016785.html">[squid-users] Using HTTP headers in a store ID helper -- possible?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16792">[ date ]</a>
              <a href="thread.html#16792">[ thread ]</a>
              <a href="subject.html#16792">[ subject ]</a>
              <a href="author.html#16792">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

01.11.2017 21:23, Alex Rousskov &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> On 11/01/2017 03:20 AM, Christof Gerber wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> [Will Squid] be blocked until the eCAP API call returns?
</I>&gt;<i> To answer the exact question above: Yes, the Squid worker making an eCAP
</I>&gt;<i> API call will block until that call returns. The same is true for all
</I>&gt;<i> other API calls, all system calls, and all internal calls. This is how
</I>&gt;<i> C/C++ works. I am stating the obvious for the record, in case somebody
</I>&gt;<i> with a different (or insufficient) programming languages background
</I>&gt;<i> stumbles upon this thread.
</I>&gt;<i>
</I>&gt;<i> What you are really asking, I suspect, is whether Squid or the eCAP
</I>&gt;<i> library uses threads to automatically make eCAP adapter operations
</I>&gt;<i> asynchronous to the primary Squid operations. The answer to that
</I>&gt;<i> question is &quot;no&quot;: The relevant Squid code does not use threads, and
</I>&gt;<i> there are no threads in the eCAP library code.
</I>&gt;<i>
</I>&gt;<i> Also, there is no magical layer between Squid and 99% of eCAP calls --
</I>&gt;<i> Squid calls go directly to your eCAP adapter code and vice versa. IIRC,
</I>&gt;<i> the only (unimportant) exception to that &quot;direct calls&quot; observation is
</I>&gt;<i> the eCAP service registry API, where there is a thin eCAP layer
</I>&gt;<i> insulating the adapter from the host application. That layer is also
</I>&gt;<i> synchronous though.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> Is there a way other than
</I>&gt;&gt;<i> programming the eCAP adapter in asynchronous mode?
</I>&gt;<i> I do not think there is a better alternative. AFAICT, you only have two
</I>&gt;<i> options:
</I>&gt;<i>
</I>&gt;<i>   A) Change Squid to move eCAP calls to thread(s).
</I>This is absolutely not necessary. The interface of the store ID allows
you to write a threaded asynchronous (thread-aware) helper in
combination with a thread-unaware. This allows its interface. However,
the eCAP interface does not allow this because of the synchronous nature
of the ecap library and this restricts of its interaction with the host.
About this OP asks exactly.
&gt;<i>   B) Use threads inside the adapter to make its operations asynchronous.
</I>&gt;<i>
</I>&gt;<i> As you know, the sample async adapter and the ClamAV adapter use (B).
</I>This sample useless on whole class of cases. For example, it will not
work with gzip compression. I've spent much time in attempts to make
gzip adapter threaded/async. Without any success.
&gt;<i> That approach has its problems (because it currently does not require
</I>&gt;<i> the host application to be threads-aware), but it works reasonably well
</I>&gt;<i> for many use cases.
</I>And it does not work for a much larger number of cases due to library
limitations.
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
-- 
**************************
* C++: Bug to the future *
**************************

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20171101/3a0b5d91/attachment.key">http://lists.squid-cache.org/pipermail/squid-users/attachments/20171101/3a0b5d91/attachment.key</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20171101/3a0b5d91/attachment.sig">http://lists.squid-cache.org/pipermail/squid-users/attachments/20171101/3a0b5d91/attachment.sig</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016791.html">[squid-users] Squid 3.5 with nonblocking ecap adapter
</A></li>
	<LI>Next message (by thread): <A HREF="016785.html">[squid-users] Using HTTP headers in a store ID helper -- possible?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16792">[ date ]</a>
              <a href="thread.html#16792">[ thread ]</a>
              <a href="subject.html#16792">[ subject ]</a>
              <a href="author.html#16792">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
