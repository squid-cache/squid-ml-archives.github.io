<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3.5 with nonblocking ecap adapter
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5%20with%20nonblocking%20ecap%20adapter&In-Reply-To=%3C474c8b74-bc63-52f4-e56a-7f9b25e45195%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016790.html">
   <LINK REL="Next"  HREF="016794.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3.5 with nonblocking ecap adapter</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5%20with%20nonblocking%20ecap%20adapter&In-Reply-To=%3C474c8b74-bc63-52f4-e56a-7f9b25e45195%40measurement-factory.com%3E"
       TITLE="[squid-users] Squid 3.5 with nonblocking ecap adapter">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Nov  1 17:37:21 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016790.html">[squid-users] Squid 3.5 with nonblocking ecap adapter
</A></li>
        <LI>Next message (by thread): <A HREF="016794.html">[squid-users] Squid 3.5 with nonblocking ecap adapter
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16793">[ date ]</a>
              <a href="thread.html#16793">[ thread ]</a>
              <a href="subject.html#16793">[ subject ]</a>
              <a href="author.html#16793">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/01/2017 09:26 AM, Yuri wrote:
&gt;&gt;&gt;<i> Is there a way other than
</I>&gt;&gt;&gt;<i> programming the eCAP adapter in asynchronous mode?
</I>
&gt;&gt;<i> I do not think there is a better alternative. AFAICT, you only have two
</I>&gt;&gt;<i> options:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   A) Change Squid to move eCAP calls to thread(s).
</I>&gt;&gt;<i>   B) Use threads inside the adapter to make its operations asynchronous.
</I>
&gt;<i> AFAIK B) is impossible.
</I>
It is not only possible but implemented in sample and production
adapters (as I have said later in the same email).


&gt;<i> I see no way to push body from ecap library to adapter at whole, not
</I>&gt;<i> chunk.
</I>
This part of your assertion does not compute for me:

* First of all, it seems completely unrelated to the OP question.

* Second, the body is not pushed &quot;from the eCAP library&quot;. Body bytes are
&quot;pushed from&quot; (&quot;made available by&quot; would be a more accurate term) the
host application (e.g., Squid) to (for) the adapter and vice versa. The
amount and timing of body bytes availability are determined by the side
doing the &quot;pushing&quot; and, naturally, body data presence on that side.

Many adapters &quot;stream&quot; message content (processing each body piece on
the fly) and some adapters accumulate whole bodies before acting on
them. The best design depends on the adapter purpose and various
risk/resources/performance/complexity trade-offs.


&gt;<i> I see no documented way to do this.
</I>
Asynchronous adapter API is documented in libecap/doc/async.txt. There
are no detailed tutorials, but there is working code to study.

There is no documentation dedicated to body exchanges, but each
adapter::Xaction::ab*() and host::Xaction::vb*() method is briefly
documented and there are public working adapters that illustrate the use
of those methods.

If you have questions specific to eCAP, then this Squid mailing list is
not the right place to ask them, but see <A HREF="http://www.e-cap.org/support/">http://www.e-cap.org/support/</A>


&gt;<i> And it does not work for a much larger number of cases due to library
</I>&gt;<i> limitations.
</I>
AFAICT, you are conflating developer failures with library limitations.
The eCAP library is far from perfect, but it does not have the flaws you
allege.


HTH,

Alex.


&gt;&gt;<i> As you know, the sample async adapter and the ClamAV adapter use (B).
</I>&gt;&gt;<i> That approach has its problems (because it currently does not require
</I>&gt;&gt;<i> the host application to be threads-aware), but it works reasonably well
</I>&gt;&gt;<i> for many use cases.
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016790.html">[squid-users] Squid 3.5 with nonblocking ecap adapter
</A></li>
	<LI>Next message (by thread): <A HREF="016794.html">[squid-users] Squid 3.5 with nonblocking ecap adapter
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16793">[ date ]</a>
              <a href="thread.html#16793">[ thread ]</a>
              <a href="subject.html#16793">[ subject ]</a>
              <a href="author.html#16793">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
