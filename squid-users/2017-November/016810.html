<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Google Chrome reports &quot;Too many redirects&quot; on ssl-dumped connections with LA Times News Website
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Google%20Chrome%20reports%20%22Too%20many%20redirects%22%20on%0A%20ssl-dumped%20connections%20with%20LA%20Times%20News%20Website&In-Reply-To=%3C7f7335a6-d9a4-2415-fbd1-565424de7002%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016808.html">
   <LINK REL="Next"  HREF="016819.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Google Chrome reports &quot;Too many redirects&quot; on ssl-dumped connections with LA Times News Website</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Google%20Chrome%20reports%20%22Too%20many%20redirects%22%20on%0A%20ssl-dumped%20connections%20with%20LA%20Times%20News%20Website&In-Reply-To=%3C7f7335a6-d9a4-2415-fbd1-565424de7002%40treenet.co.nz%3E"
       TITLE="[squid-users] Google Chrome reports &quot;Too many redirects&quot; on ssl-dumped connections with LA Times News Website">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Nov  3 07:38:26 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016808.html">[squid-users] Google Chrome reports &quot;Too many redirects&quot; on ssl-dumped connections with LA Times News Website
</A></li>
        <LI>Next message (by thread): <A HREF="016819.html">[squid-users] Google Chrome reports &quot;Too many redirects&quot; on ssl-dumped connections with LA Times News Website
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16810">[ date ]</a>
              <a href="thread.html#16810">[ thread ]</a>
              <a href="subject.html#16810">[ subject ]</a>
              <a href="author.html#16810">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 03/11/17 19:45, Jeffrey Merkey wrote:
&gt;<i> This error is extremely hard to reproduce, and I found it can be
</I>&gt;<i> cleared by restarting squid, which seems to make it go away.   It
</I>&gt;<i> seems to take several hours of non-stop proxy use then once the error
</I>&gt;<i> occurs the we browser reports &quot;too many redirects&quot; and certificate
</I>&gt;<i> errors.
</I>&gt;<i> 
</I>&gt;<i> Doing a restart on Centos 7 clears it:
</I>&gt;<i> 
</I>&gt;<i> # systemctl restart squid
</I>&gt;<i> 
</I>&gt;<i> The log shows some sort of &quot;refresh unmodified state before it happens:
</I>&gt;<i> 
</I>&gt;<i> 1509690588.252    167 127.0.0.1 TAG_NONE/200 0 CONNECT
</I>&gt;<i> events.bouncex.net:443 - HIER_DIRECT/35.190.62.200 -
</I>&gt;<i> 1509690588.272    210 127.0.0.1 TAG_NONE/200 0 CONNECT
</I>&gt;<i> analytics.twitter.com:443 - HIER_DIRECT/199.59.149.200 -
</I>&gt;<i> 1509690588.280     62 127.0.0.1 TCP_REFRESH_UNMODIFIED/200 38412 GET
</I>&gt;<i> <A HREF="http://www.latimes.com/nation/la-na-vegas-shooting-sheriff-20171102-story.html">http://www.latimes.com/nation/la-na-vegas-shooting-sheriff-20171102-story.html</A>
</I>&gt;<i> - HIER_DIRECT/104.120.143.198 text/html      &lt;================== error
</I>&gt;<i> is here
</I>
This is a 200 status response. So whatever &quot;redirection&quot; is occuring is 
not part of the HTTP for that transaction.

The refresh means that something was cached beforehand but was stale so 
the server had to be asked for permission to deliver it. UNMODIFIED 
means the server responded by indicating it was okay to use.

&gt;<i> 1509690588.356    220 127.0.0.1 TCP_MISS/200 960 GET
</I>&gt;<i> <A HREF="https://partners.tremorhub.com/syncnoad?">https://partners.tremorhub.com/syncnoad?</A> - HIER_DIRECT/34.228.123.38
</I>&gt;<i> text/xml
</I>&gt;<i> 1509690588.366    304 127.0.0.1 TAG_NONE/200 0 CONNECT
</I>&gt;<i> geo.moatads.com:443 - HIER_DIRECT/52.21.172.68 -
</I>&gt;<i> 1509690588.374    303 127.0.0.1 TAG_NONE/200 0 CONNECT
</I>&gt;<i> rtr.innovid.com:443 - HIER_DIRECT/13.58.208.14 -
</I>&gt;<i> 1509690588.377     33 127.0.0.1 TCP_MISS/200 498 GET
</I>&gt;<i> <A HREF="https://tribpubdfp745347008913.s.moatpixel.com/pixel.gif?">https://tribpubdfp745347008913.s.moatpixel.com/pixel.gif?</A> - HIER_
</I>&gt;<i> 
</I>&gt;<i> If there are particulars and I attempt to recreate this problem are
</I>&gt;<i> there any specific logging parms or settings that would help you
</I>&gt;<i> understand this particular error or shed some light on it that I could
</I>&gt;<i> set on my end.
</I>
The tool at redbot.org shows the HTTP protocol and all the content at 
that refreshed URL is all relatively normal. Some Vary issues, but that 
should not be leading to redirect loops.


Since the error is showing up in the browser and not easily visible in 
the server traffic I think the best place to look would be to debug what 
the browser is doing exactly. It probably has something to do with how 
it handles those cert errors (ie TLS-Everywhere misfeatures always 
trying to do broken <A HREF="https://">https://</A> when <A HREF="http://">http://</A> works fine).


Also, which Squid version are you using may matter. You didn't say which.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016808.html">[squid-users] Google Chrome reports &quot;Too many redirects&quot; on ssl-dumped connections with LA Times News Website
</A></li>
	<LI>Next message (by thread): <A HREF="016819.html">[squid-users] Google Chrome reports &quot;Too many redirects&quot; on ssl-dumped connections with LA Times News Website
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16810">[ date ]</a>
              <a href="thread.html#16810">[ thread ]</a>
              <a href="subject.html#16810">[ subject ]</a>
              <a href="author.html#16810">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
