<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] can't block streaming
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20can%27t%20block%20streaming&In-Reply-To=%3Cd4d3675b-2865-e8fc-4cb5-850af7621e5c%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016811.html">
   <LINK REL="Next"  HREF="016813.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] can't block streaming</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20can%27t%20block%20streaming&In-Reply-To=%3Cd4d3675b-2865-e8fc-4cb5-850af7621e5c%40treenet.co.nz%3E"
       TITLE="[squid-users] can't block streaming">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Nov  3 10:30:03 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016811.html">[squid-users] can't block streaming
</A></li>
        <LI>Next message (by thread): <A HREF="016813.html">[squid-users] can't block streaming
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16812">[ date ]</a>
              <a href="thread.html#16812">[ thread ]</a>
              <a href="subject.html#16812">[ subject ]</a>
              <a href="author.html#16812">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 03/11/17 22:42, Vacheslav wrote:
&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: Amos Jeffries
</I>&gt;<i> Sent: Wednesday, November 1, 2017 3:52 PM
</I>&gt;<i> 
</I>&gt;<i> On 01/11/17 21:54, Vacheslav wrote:
</I>&gt;&gt;<i> Thanks for your time,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -----Original Message-----
</I>&gt;&gt;<i> From: Amos Jeffries
</I>&gt;&gt;<i> Sent: Tuesday, October 31, 2017 5:45 PM
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 31/10/17 22:05, Vacheslav wrote:
</I>&gt;&gt;&gt;<i> Peace,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I tired searching and debugging but I couldn&#8217;t find a solution,
</I>&gt;&gt;&gt;<i> whatever I do youtube keeps working.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Here is my configuration:
</I>&gt;&gt;<i> ...
</I>&gt;&gt;&gt;<i> # Media Streams
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> ## MediaPlayer MMS Protocol
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> acl media rep_mime_type mms
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> acl mediapr url_regex dvrplayer mediastream ^<A HREF="mms://">mms://</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> ## (Squid does not yet handle the URI as a known proto type.)
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Unsupport&gt; To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: Re: [squid-users] can't block streaming
</I>ed URI schemes should result in the client receiving an HTTP
&gt;&gt;&gt;<i> error page instead of Squid handling the traffic.
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Which also explains your problems: the Browser is either not using
</I>&gt;&gt;&gt;<i> the proxy at all for this traffic, or sending the traffic through a
</I>&gt;&gt;&gt;<i> CONNECT tunnel that is allowed to be created for other reasons.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Well I tried unchecking automatically detect proxy settings. There are
</I>&gt;&gt;<i> 2 network cards on the squid, one with a gateway, the same  is used as
</I>&gt;&gt;<i> the proxy ip port 3128 and youtube is not in the bypass proxylist. I
</I>&gt;&gt;<i> tried using opera, the same result.
</I>&gt;<i> 
</I>&gt;&gt;<i> Things like YT do not have to be on any bypass list to avoid the proxy.
</I>&gt;&gt;<i> It just has to have a URL scheme for some protocol the browser detects as not able to go through the HTTP-only proxy. eg &quot;mms:&quot;
</I>&gt;<i> 
</I>&gt;&gt;<i> Since <A HREF="mms://">mms://</A> means a non-HTTP protocol and it is not commonly supported by HTTP proxies, the browsers usually send it directly &gt;to the mms protocol port(s) AFAIK.
</I>&gt;<i> 
</I>&gt;<i> Well I tired switching the ip of the pc to one that can't do http and https at all without proxy. I tested it without proxy enabled and internet sites don't open, I switched the proxy back on and youtube works when it is forbidden.
</I>&gt;<i> 
</I>
That test is not conclusive enough I'm afraid. YouTube system is very 
complex and requires about a dozen transactions to take place in order 
to find the video content. Any one of those HTTP(S) responses may 
reference a non-HTTP video type as being in use at the end of the chain 
so your ACLs dont block it specifically.

That complexity might make it _seem_ easier to 'block' YT videos by 
breaking the chain of transactions. But unfortunately you have to 
isolate and block the right ones for that to happen without letting the 
client do any failover behaviour it might be capable of. AND many of 
them are buried inside encrypted tunnels nowdays.

So blocking one of Google service usually means blocking large areas, or 
all, of their other services as well. Unless you want to go down the 
MITM road and decrypt the HTTPS at the proxy - with limited success even 
then thanks to the cert pinning Google does.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016811.html">[squid-users] can't block streaming
</A></li>
	<LI>Next message (by thread): <A HREF="016813.html">[squid-users] can't block streaming
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16812">[ date ]</a>
              <a href="thread.html#16812">[ thread ]</a>
              <a href="subject.html#16812">[ subject ]</a>
              <a href="author.html#16812">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
