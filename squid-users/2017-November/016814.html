<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3.5 ICAP Problems
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5%20ICAP%20Problems&In-Reply-To=%3C0a3b01d3549a%2471120720%2453361560%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016805.html">
   <LINK REL="Next"  HREF="016815.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3.5 ICAP Problems</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5%20ICAP%20Problems&In-Reply-To=%3C0a3b01d3549a%2471120720%2453361560%24%40ngtech.co.il%3E"
       TITLE="[squid-users] Squid 3.5 ICAP Problems">eliezer at ngtech.co.il
       </A><BR>
    <I>Fri Nov  3 11:54:02 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016805.html">[squid-users] Squid 3.5 ICAP Problems
</A></li>
        <LI>Next message (by thread): <A HREF="016815.html">[squid-users] Squid 3.5 ICAP Problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16814">[ date ]</a>
              <a href="thread.html#16814">[ thread ]</a>
              <a href="subject.html#16814">[ subject ]</a>
              <a href="author.html#16814">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm not sure but after testing with telnet  or\and nc you can try to verify the open files limits on the system which might cause this issue.
To identify how many connections are opened to the service you can use netstat or ss tools.
netstat -ntp

and a similar on ss.

Also it's a good practice to put an ICAP periodic(2-20 seconds apparat) with an OPTIONS request to make sure that the service is alive.
If you want my testing script let me know.

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>



-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Alex Rousskov
Sent: Thursday, November 2, 2017 19:22
To: Stephen Stark &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">logic4life at gmail.com</A>&gt;; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Squid 3.5 ICAP Problems

On 11/02/2017 10:29 AM, Stephen Stark wrote:
&gt;<i> Adaptation::Icap::Xaction::noteCommConnected(local=[::]
</I>&gt;<i> remote=127.0.0.1:1344 flags=1, errno=101, ...
</I>
The logs you have provided do not show where/why exactly the TCP connection to the ICAP service fails, but error number 101 is probably &quot;network unreachable&quot;. This is unusual but not impossible for localhost traffic. The next step depends on the failure cause. There are at least two major cases to consider:

A) If Squid sends packets to 127.0.0.1:1344, then you can easily reproduce the problem using something like &quot;telnet&quot; or &quot;nc&quot; on the Squid box command line. Just make sure you use the right _source_ IP address for the connection! It has to be the same source IP address that Squid is using. It might not be 127.0.0.1. Running that command as Squid user might also be important if the Squid box have some fancy user-specific networking restrictions.

B) If Squid does not send packets to 127.0.0.1:1344, then one can figure out what goes wrong by studying relevant ALL,9 logs. You may also want to address other errors or warnings Squid logs to cache.log (if any).

You can determine whether Squid sends packets to 127.0.0.1:1344 by collecting a packet trace (for all Squid box interfaces!) and/or running strace (for the Squid worker process).


HTH,

Alex.
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016805.html">[squid-users] Squid 3.5 ICAP Problems
</A></li>
	<LI>Next message (by thread): <A HREF="016815.html">[squid-users] Squid 3.5 ICAP Problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16814">[ date ]</a>
              <a href="thread.html#16814">[ thread ]</a>
              <a href="subject.html#16814">[ subject ]</a>
              <a href="author.html#16814">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
