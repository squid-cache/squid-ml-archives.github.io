<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid and CPU 100%
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20and%20CPU%20100%25&In-Reply-To=%3C34c510cb-9ad4-ffab-7905-c0fd04ab6007%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016823.html">
   <LINK REL="Next"  HREF="016830.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid and CPU 100%</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20and%20CPU%20100%25&In-Reply-To=%3C34c510cb-9ad4-ffab-7905-c0fd04ab6007%40measurement-factory.com%3E"
       TITLE="[squid-users] Squid and CPU 100%">rousskov at measurement-factory.com
       </A><BR>
    <I>Tue Nov  7 14:55:22 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016823.html">[squid-users] Squid and CPU 100%
</A></li>
        <LI>Next message (by thread): <A HREF="016830.html">[squid-users] Squid and CPU 100%
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16825">[ date ]</a>
              <a href="thread.html#16825">[ thread ]</a>
              <a href="subject.html#16825">[ subject ]</a>
              <a href="author.html#16825">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/07/2017 04:42 AM, Vieri wrote:
&gt;<i> So I'm worried that 32768 may not be enough.
</I>&gt;<i> Is this weird, or should I really increase this value?
</I>
Think about the underlying physics of what you are observing. It may
help reduce guessing and guide you towards a solution:

You can estimate the reasonable number of file descriptors using
expected maximum request rate and mean response time. Add, say 30%, to
account for long-lived persistent connections. Remember that Squid uses
one descriptor for the from-client connection and one descriptor for the
to-server connection. If that estimate is way below 32K, then the
current limit itself is not the problem. Otherwise, it probably is (and
then you probably need more Squid workers not more descriptors per worker).

* It is possible, perhaps even likely, that some some unknown problem
suddenly consumes almost all CPU cycles, drastically slowing Squid down,
and quickly consuming all file descriptors (because accepted connections
are not served fast enough).

* It is also possible, albeit less likely, that some unknown problem
slows Squid down over time and slowly leads to excessive file descriptor
use and even 100% CPU usage.

To distinguish the two cases, consider studying transaction response
times and the total number of connections logged every minute of every
hour. You should collect such stats for many other reasons anyway!

Alex.
P.S. I trust you have already checked all system logs for more clues and
found nothing of interest there.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016823.html">[squid-users] Squid and CPU 100%
</A></li>
	<LI>Next message (by thread): <A HREF="016830.html">[squid-users] Squid and CPU 100%
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16825">[ date ]</a>
              <a href="thread.html#16825">[ thread ]</a>
              <a href="subject.html#16825">[ subject ]</a>
              <a href="author.html#16825">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
