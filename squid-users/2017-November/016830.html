<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid and CPU 100%
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20and%20CPU%20100%25&In-Reply-To=%3C1530147598.4027146.1510074969465%40mail.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016825.html">
   <LINK REL="Next"  HREF="016831.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid and CPU 100%</H1>
    <B>Vieri</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20and%20CPU%20100%25&In-Reply-To=%3C1530147598.4027146.1510074969465%40mail.yahoo.com%3E"
       TITLE="[squid-users] Squid and CPU 100%">rentorbuy at yahoo.com
       </A><BR>
    <I>Tue Nov  7 17:16:09 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016825.html">[squid-users] Squid and CPU 100%
</A></li>
        <LI>Next message (by thread): <A HREF="016831.html">[squid-users] Squid and CPU 100%
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16830">[ date ]</a>
              <a href="thread.html#16830">[ thread ]</a>
              <a href="subject.html#16830">[ subject ]</a>
              <a href="author.html#16830">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>A quick grep at access.log before the issue I reported shows that there were 1350 lines during a full minute. So I understand that would mean there were 1350 requests during that minute even though some of them were denied by squid.conf's policies. So I should estimate less than 2 * 1350. I would use that value anyway, and add 30% to that. I'd end up with 3510.

I grepped access.log for requests during other time ranges around the time of the reported issue, and I've come up with more or less the same values.

So, correct me if I'm wrong, but raising max_filedescriptors (currently at 32768) won't solve the root cause of the problem.

You mention that maybe another unknown process may suddenly consume almost all CPU cycles, drastically slowing Squid down, and quickly consuming all file descriptors.
That could be the case since I'm using c-icap + clamav. The clamd process reaches 100% peaks at times (for a very short while), but I would have to prove that this can be the cause. Wouldn't I need to monitor CPU usage by all processes at all times?

Also, wouldn't it be useful to check &quot;squidclient mgr:filedescriptors&quot; every 10 minutes or so? I have the feeling it's steadily growing over time, even when overall CPU usage is low. So the second less likely theory may also be a candidate.

Under which circumstances would &quot;squidclient mgr:filedescriptors&quot; show ever growing numbers even on very low CPU and network usage (squid seems to be very responsive)?

Vieri

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016825.html">[squid-users] Squid and CPU 100%
</A></li>
	<LI>Next message (by thread): <A HREF="016831.html">[squid-users] Squid and CPU 100%
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16830">[ date ]</a>
              <a href="thread.html#16830">[ thread ]</a>
              <a href="subject.html#16830">[ subject ]</a>
              <a href="author.html#16830">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
