<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid-users Digest, Vol 39, Issue 10
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid-users%20Digest%2C%20Vol%2039%2C%20Issue%2010&In-Reply-To=%3COF53FEDC32.BBF4751A-ON802581D1.006B20BD-802581D1.006B77B1%40tcs.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016845.html">
   <LINK REL="Next"  HREF="016835.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid-users Digest, Vol 39, Issue 10</H1>
    <B>Nilesh Gavali</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid-users%20Digest%2C%20Vol%2039%2C%20Issue%2010&In-Reply-To=%3COF53FEDC32.BBF4751A-ON802581D1.006B20BD-802581D1.006B77B1%40tcs.com%3E"
       TITLE="[squid-users] squid-users Digest, Vol 39, Issue 10">nilesh.gavali at tcs.com
       </A><BR>
    <I>Tue Nov  7 19:33:52 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016845.html">[squid-users] ERR_ICAP_FAILURE unless squid reconfigure
</A></li>
        <LI>Next message (by thread): <A HREF="016835.html">[squid-users] Non intrusive sslbump for whitelisting (asked many	times but..)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16833">[ date ]</a>
              <a href="thread.html#16833">[ thread ]</a>
              <a href="subject.html#16833">[ subject ]</a>
              <a href="author.html#16833">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Antony,
I found where was the issue,
Actually access given to the site was based on LDAP group membership when 
user try to launch recording from site, the .wax file will be played from 
local machine IP , which is getting blocked.
created ACL to allow specific ip to access the Site and it worked.
Thank for point to direction to review log file

Thanks &amp; Regards
Nilesh Suresh Gavali




From:   <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-request at lists.squid-cache.org</A>
To:     <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Date:   07/11/2017 12:47
Subject:        squid-users Digest, Vol 39, Issue 10
Sent by:        &quot;squid-users&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>&gt;



Send squid-users mailing list submissions to
                 <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>

To subscribe or unsubscribe via the World Wide Web, visit
                 <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
or, via email, send a message with subject or body 'help' to
                 <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-request at lists.squid-cache.org</A>

You can reach the person managing the list at
                 <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-owner at lists.squid-cache.org</A>

When replying, please edit your Subject line so it is more specific
than &quot;Re: Contents of squid-users digest...&quot;


Today's Topics:

   1. window media player can not play .wax file via Squid proxy
      (Nilesh Gavali)
   2. Re: window media player can not play .wax file via Squid
      proxy (Antony Stone)
   3. Squid and CPU 100% (Vieri)


----------------------------------------------------------------------

Message: 1
Date: Mon, 6 Nov 2017 12:22:11 +0000
From: Nilesh Gavali &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">nilesh.gavali at tcs.com</A>&gt;
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [squid-users] window media player can not play .wax file via
                 Squid           proxy
Message-ID:
 &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">OF06172801.D41F2471-ON802581D0.00435D9F-802581D0.0043F244 at tcs.com</A>&gt;
Content-Type: text/plain; charset=&quot;utf-8&quot;

Hi Team.
We are having squid deployed for users which work well for browsing 
internet. Recently we received complaint from some users who access one of 

the vendor URL to listen audio recordings.
The procedure they follow as
login to Vendor portal URL via squid proxy
select recording option
select recording , it will get downloaded as .wax file
user open .wax file in media player after which they get error message as 
unable to play media.

I checked the .wax file which contains link to media file on their same 
portal URL. but window media player cant access it.

Not sure what is wrong here. I traced squid access logs and able to see 
the request going to vendor portal but still window media player cant play 

this file

Need urgent help if anyone work on this kind of requirement.


Thanks &amp; Regards
Nilesh Suresh Gavali
=====-----=====-----=====
Notice: The information contained in this e-mail
message and/or attachments to it may contain 
confidential or privileged information. If you are 
not the intended recipient, any dissemination, use, 
review, distribution, printing or copying of the 
information contained in this e-mail message 
and/or attachments to it are strictly prohibited. If 
you have received this communication in error, 
please notify us by reply e-mail or telephone and 
immediately and permanently delete the message 
and any attachments. Thank you


-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;
<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20171106/44c0b16c/attachment-0001.html">http://lists.squid-cache.org/pipermail/squid-users/attachments/20171106/44c0b16c/attachment-0001.html</A>
&gt;<i>
</I>
------------------------------

Message: 2
Date: Mon, 6 Nov 2017 12:36:07 +0000
From: Antony Stone &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">Antony.Stone at squid.open.source.it</A>&gt;
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] window media player can not play .wax file
                 via             Squid proxy
Message-ID: &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">201711061236.07563.Antony.Stone at squid.open.source.it</A>&gt;
Content-Type: Text/Plain;  charset=&quot;iso-8859-15&quot;

On Monday 06 November 2017 at 12:22:11, Nilesh Gavali wrote:

&gt;<i> Hi Team.
</I>&gt;<i> We are having squid deployed for users which work well for browsing
</I>&gt;<i> internet. Recently we received complaint from some users who access one 
</I>of
&gt;<i> the vendor URL to listen audio recordings.
</I>&gt;<i> The procedure they follow as
</I>&gt;<i> login to Vendor portal URL via squid proxy
</I>&gt;<i> select recording option
</I>&gt;<i> select recording , it will get downloaded as .wax file
</I>&gt;<i> user open .wax file in media player after which they get error message 
</I>as
&gt;<i> unable to play media.
</I>&gt;<i> 
</I>&gt;<i> I checked the .wax file which contains link to media file on their same
</I>&gt;<i> portal URL. but window media player cant access it.
</I>
What type of URL is it?  HTTP?  HTTPS?  Something else?

&gt;<i> Not sure what is wrong here. I traced squid access logs and able to see
</I>&gt;<i> the request going to vendor portal
</I>
Which request?

The browser request for the .wax file, or the media player request for the 

actual media file?

&gt;<i> but still window media player cant play this file
</I>
It basically sounds as though either:

 -  Windows media player is trying to access a URL directly without going 
through the proxy, or

 - Windows media player is requesting a URL type which Squid can't handle

Tell us what URLs you're seeing in the access log, and what URL is 
contained 
in the .wax file - that might give us more of a clue.


Antony.

-- 
Douglas was one of those writers who honourably failed to get anywhere 
with 
'weekending'.  It put a premium on people who could write things that 
lasted 
thirty seconds, and Douglas was incapable of writing a single sentence 
that 
lasted less than thirty seconds.

 - Geoffrey Perkins, about Douglas Adams

                                                   Please reply to the 
list;
                                                         please *don't* CC 
me.


------------------------------

Message: 3
Date: Tue, 7 Nov 2017 11:42:11 +0000 (UTC)
From: Vieri &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rentorbuy at yahoo.com</A>&gt;
To: &quot;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&quot;
                 &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>&gt;
Subject: [squid-users] Squid and CPU 100%
Message-ID: &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">348071111.3798275.1510054931204 at mail.yahoo.com</A>&gt;
Content-Type: text/plain; charset=UTF-8

Sorry to bring this back up, but every now and then (few days) I need to 
restart squid because its CPU usage goes up to 100% for a long time 
(irresponsive).

Right before restarting Squid:

# free [11/07/17 11:18:52]
total used free shared buff/cache available
Mem: 32865056 14811320 1374212 157028 16679524 17557656
Swap: 37036988 287320 36749668

# squidclient mgr:info [11/07/17 11:18:52]

# squidclient mgr:mem [11/07/17 11:19:02]

# squidclient mgr:storedir [11/07/17 11:19:22]

# squidclient mgr:filedescriptors [11/07/17 11:19:42]

# squidclient mgr:events [11/07/17 11:20:12]

In other words, squidclient does not get any info from squid (waited max 
30 seconds - maybe I need to wait more).

I also dumped an strace here:
<A HREF="https://drive.google.com/file/d/1yed-sNWrc6KBQSOV7KPbrYOForwwtkCe/view?usp=sharing">https://drive.google.com/file/d/1yed-sNWrc6KBQSOV7KPbrYOForwwtkCe/view?usp=sharing</A>


You probably won't be able to draw any conclusions so I'll try to update 
to squid-3.5.27-20171101-re69e56c (I'm now running 
3.5.27-20170916-re69e56c).

Note that stopping Squid with:

/usr/sbin/squid -k shutdown -f /etc/squid/squid.conf -n squid

takes a LONG time, but it eventually does stop (the process dies out).

I can then restart it cleanly.

I don't need to kill the pid (unless I'm told to hurry up).

After checking the log I can see these messages:

2017/11/07 11:16:59 kid1| WARNING! Your cache is running out of 
filedescriptors
2017/11/07 11:16:59 kid1| comm_open: socket failure: (24) Too many open 
files

Now, you can notice that the max_filedescriptors is quite high, and was 
set correctly before and after the issue I'm reporting:

# tail -n 100000 /var/log/squid/cache.log | grep -i descript
2017/11/06 06:36:14 kid1| With 32768 file descriptors available
2017/11/07 11:15:15 kid1| WARNING! Your cache is running out of 
filedescriptors
2017/11/07 11:15:31 kid1| WARNING! Your cache is running out of 
filedescriptors
2017/11/07 11:16:13 kid1| WARNING! Your cache is running out of 
filedescriptors
2017/11/07 11:16:59 kid1| WARNING! Your cache is running out of 
filedescriptors
2017/11/07 11:17:35 kid1| WARNING! Your cache is running out of 
filedescriptors
2017/11/07 11:17:51 kid1| WARNING! Your cache is running out of 
filedescriptors
2017/11/07 11:18:07 kid1| WARNING! Your cache is running out of 
filedescriptors
2017/11/07 11:18:25 kid1| WARNING! Your cache is running out of 
filedescriptors
2017/11/07 11:18:45 kid1| WARNING! Your cache is running out of 
filedescriptors
2017/11/07 11:19:03 kid1| WARNING! Your cache is running out of 
filedescriptors
2017/11/07 11:19:19 kid1| WARNING! Your cache is running out of 
filedescriptors
2017/11/07 11:19:35 kid1| WARNING! Your cache is running out of 
filedescriptors
2017/11/07 11:19:53 kid1| WARNING! Your cache is running out of 
filedescriptors
2017/11/07 11:20:09 kid1| WARNING! Your cache is running out of 
filedescriptors
2017/11/07 11:20:28 kid1| WARNING! Your cache is running out of 
filedescriptors
2017/11/07 11:20:44 kid1| WARNING! Your cache is running out of 
filedescriptors
2017/11/07 11:21:01 kid1| WARNING! Your cache is running out of 
filedescriptors
2017/11/07 11:23:05 kid1| With 32768 file descriptors available

So I'm worried that 32768 may not be enough.
Is this weird, or should I really increase this value?

Thanks,

Vieri


------------------------------

Subject: Digest Footer

_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


------------------------------

End of squid-users Digest, Vol 39, Issue 10
*******************************************

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20171107/e5c6ebe0/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20171107/e5c6ebe0/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016845.html">[squid-users] ERR_ICAP_FAILURE unless squid reconfigure
</A></li>
	<LI>Next message (by thread): <A HREF="016835.html">[squid-users] Non intrusive sslbump for whitelisting (asked many	times but..)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16833">[ date ]</a>
              <a href="thread.html#16833">[ thread ]</a>
              <a href="subject.html#16833">[ subject ]</a>
              <a href="author.html#16833">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
