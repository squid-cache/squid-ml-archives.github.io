<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SQUID memory error after vm.swappines changed from 60	to 10
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SQUID%20memory%20error%20after%20vm.swappines%20changed%20from%2060%0A%09to%2010&In-Reply-To=%3CCAAPixKhsif5%2Bad1prsoFAZXVXcVAxpdqkw4RdvGbfK-UxhkzTQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016866.html">
   <LINK REL="Next"  HREF="016843.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SQUID memory error after vm.swappines changed from 60	to 10</H1>
    <B>Bike dernikov1</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SQUID%20memory%20error%20after%20vm.swappines%20changed%20from%2060%0A%09to%2010&In-Reply-To=%3CCAAPixKhsif5%2Bad1prsoFAZXVXcVAxpdqkw4RdvGbfK-UxhkzTQ%40mail.gmail.com%3E"
       TITLE="[squid-users] SQUID memory error after vm.swappines changed from 60	to 10">dernikov1 at gmail.com
       </A><BR>
    <I>Wed Nov  8 09:26:11 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016866.html">[squid-users] url_rewrite_program and ACLs
</A></li>
        <LI>Next message (by thread): <A HREF="016843.html">[squid-users] SQUID memory error after vm.swappines changed from 60 to 10
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16842">[ date ]</a>
              <a href="thread.html#16842">[ thread ]</a>
              <a href="subject.html#16842">[ subject ]</a>
              <a href="author.html#16842">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, I hope that someone can explain what happened, why squid stopped working.
The problem is related to  memory/swap handling.

After we changed vm.swappiness parameter from 60 to 10 (tuning
attempt, to lower a disk usage, because we have only 4 disks in a
RAID10, so disk subsystem  is a weak link), we got a lot of errors in
cache.log.
The problems started after scheduled logrotate after  2AM.
Squid ran out of memory, auth helpers stopped working.
It's weird because we didn't disable swap, but behavior is like we did.
After an error, we increased parameter from 10 to 40.

The server has 24GB DDR3 memory,  disk swap set to 24GB, 12 CPU (24HT cores).
We have 2800 users, using  kerberos authentication, squidguard for
filtering, ldap authorization.
When problem appeared memory was still 3GB free (free column), ram
(caching) was filled to 15GB, so 21 GB ram filled, 3GB free.

Thanks for help,


errors from cache.log.

2017/11/08 02:55:27| Set Current Directory to /var/log/squid/
2017/11/08 02:55:27 kid1| storeDirWriteCleanLogs: Starting...
2017/11/08 02:55:27 kid1|   Finished.  Wrote 0 entries.
2017/11/08 02:55:27 kid1|   Took 0.00 seconds (  0.00 entries/sec).
2017/11/08 02:55:27 kid1| logfileRotate: daemon:/var/log/squid/access.log
2017/11/08 02:55:27 kid1| logfileRotate: daemon:/var/log/squid/access.log
2017/11/08 02:55:28 kid1| Pinger socket opened on FD 30
2017/11/08 02:55:28 kid1| helperOpenServers: Starting 1/1000
'squidGuard' processes
2017/11/08 02:55:28 kid1| ipcCreate: fork: (12) Cannot allocate memory
2017/11/08 02:55:28 kid1| WARNING: Cannot run '/usr/bin/squidGuard' process.
2017/11/08 02:55:28 kid1| helperOpenServers: Starting 300/3000
'negotiate_kerberos_auth' processes
2017/11/08 02:55:28 kid1| ipcCreate: fork: (12) Cannot allocate memory
2017/11/08 02:55:28 kid1| WARNING: Cannot run
'/usr/lib/squid/negotiate_kerberos_auth' process.
2017/11/08 02:55:28 kid1| ipcCreate: fork: (12) Cannot allocate memory
2017/11/08 02:55:28 kid1| WARNING: Cannot run
'/usr/lib/squid/negotiate_kerberos_auth' process.
2017/11/08 02:55:28 kid1| ipcCreate: fork: (12) Cannot allocate memory
2017/11/08 02:55:28 kid1| WARNING: Cannot run
'/usr/lib/squid/negotiate_kerberos_auth' process.

external ACL 'memberof' queue overload. Using stale result.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016866.html">[squid-users] url_rewrite_program and ACLs
</A></li>
	<LI>Next message (by thread): <A HREF="016843.html">[squid-users] SQUID memory error after vm.swappines changed from 60 to 10
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16842">[ date ]</a>
              <a href="thread.html#16842">[ thread ]</a>
              <a href="subject.html#16842">[ subject ]</a>
              <a href="author.html#16842">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
