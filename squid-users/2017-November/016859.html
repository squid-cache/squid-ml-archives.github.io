<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] url_rewrite_program and ACLs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20url_rewrite_program%20and%20ACLs&In-Reply-To=%3C131538788.5259356.1510213867661%40mail.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016851.html">
   <LINK REL="Next"  HREF="016862.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] url_rewrite_program and ACLs</H1>
    <B>Vieri</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20url_rewrite_program%20and%20ACLs&In-Reply-To=%3C131538788.5259356.1510213867661%40mail.yahoo.com%3E"
       TITLE="[squid-users] url_rewrite_program and ACLs">rentorbuy at yahoo.com
       </A><BR>
    <I>Thu Nov  9 07:51:07 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016851.html">[squid-users] url_rewrite_program and ACLs
</A></li>
        <LI>Next message (by thread): <A HREF="016862.html">[squid-users] url_rewrite_program and ACLs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16859">[ date ]</a>
              <a href="thread.html#16859">[ thread ]</a>
              <a href="subject.html#16859">[ subject ]</a>
              <a href="author.html#16859">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
________________________________
From: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
&gt;<i>
</I>&gt;<i> acl foo ...
</I>&gt;<i>  http_access deny foo
</I>&gt;<i>  deny_info 302:<A HREF="http://example.com/">http://example.com/</A> foo
</I>&gt;<i>
</I>&gt;<i> In Squid-3.2+ the deny_info URL portion can use logformat macros for 
</I>&gt;<i> dynamic redirection - like the &quot;rew&quot; substitutions only changing 
</I>&gt;<i> portions of the URL.
</I>

I was already using deny_info like this:

deny_info <A HREF="http://squidserver/proxy-error/?a=%a&amp;B=%B&amp;e=%e&amp;E=%E&amp;H=%H&amp;i=%i&amp;M=%M&amp;o=%o&amp;R=%R&amp;T=%T&amp;U=%U&amp;u=%u&amp;w=%w&amp;x=%x&amp;acl=denied_domains">http://squidserver/proxy-error/?a=%a&amp;B=%B&amp;e=%e&amp;E=%E&amp;H=%H&amp;i=%i&amp;M=%M&amp;o=%o&amp;R=%R&amp;T=%T&amp;U=%U&amp;u=%u&amp;w=%w&amp;x=%x&amp;acl=denied_domains</A> denied_domains

I was wondering how to do an immediate redirect without doing it from my custom php script. Now I see.

I guess I'll have trouble redirecting https sites though... (TLS/SSL trust issues)

I don't know if I can &quot;cleanly&quot; redirect from an HTTPS to an HTTP site (ie. so the user's browser doesn't show a &quot;can't open page&quot; message of some sort...).

You mention that I can avoid using SG, ufdbGuard, or any other redirector/helper for access control. The problem I see when trying to use huge plain text blacklists within Squid directly is that it takes a LOT of time for the proxy cache to start up as it populates the ACLs.
I can't afford to wait for Squid to do that before serving client requests. I'd rather &quot;allow everything&quot; until the ACLs are populated than have users wait for so long.
Am I missing something? Is there a way to tell Squid to process the ACLs &quot;in the background&quot;, but start handling requests immediately. If so, is it also possible to tell squid in which order to process the ACLs, ie. first process the allowed_domains ACL, and then the denied_domains ACLs? (is ordering in squid.conf enough?)

I'm saying this because I've sometimes had the need to restart Squid during the worst time of the day (peak working hours). That usually happens when I have an issue with too many open file descriptors (working on it). Stopping it cleanly takes up to 2-3 minutes. If I had to wait several more minutes for Squid to start again because it re-populates huge blacklist ACLs then I think they'd hang me for it.

Thanks,

Vieri

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016851.html">[squid-users] url_rewrite_program and ACLs
</A></li>
	<LI>Next message (by thread): <A HREF="016862.html">[squid-users] url_rewrite_program and ACLs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16859">[ date ]</a>
              <a href="thread.html#16859">[ thread ]</a>
              <a href="subject.html#16859">[ subject ]</a>
              <a href="author.html#16859">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
