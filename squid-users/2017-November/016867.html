<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SQUID memory error after vm.swappines changed from 60 to 10
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SQUID%20memory%20error%20after%20vm.swappines%20changed%0A%20from%2060%20to%2010&In-Reply-To=%3CCAAPixKiTszJDHUDK__PFgQ_%2Bg0kR0RX4KZUNykFANKnTqzydsg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016850.html">
   <LINK REL="Next"  HREF="016869.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SQUID memory error after vm.swappines changed from 60 to 10</H1>
    <B>Bike dernikov1</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SQUID%20memory%20error%20after%20vm.swappines%20changed%0A%20from%2060%20to%2010&In-Reply-To=%3CCAAPixKiTszJDHUDK__PFgQ_%2Bg0kR0RX4KZUNykFANKnTqzydsg%40mail.gmail.com%3E"
       TITLE="[squid-users] SQUID memory error after vm.swappines changed from 60 to 10">dernikov1 at gmail.com
       </A><BR>
    <I>Thu Nov  9 13:49:39 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016850.html">[squid-users] SQUID memory error after vm.swappines changed from 60 to 10
</A></li>
        <LI>Next message (by thread): <A HREF="016869.html">[squid-users] SQUID memory error after vm.swappines changed from 60 to 10
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16867">[ date ]</a>
              <a href="thread.html#16867">[ thread ]</a>
              <a href="subject.html#16867">[ subject ]</a>
              <a href="author.html#16867">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;&gt;<i>On 11/08/2017 02:26 AM, Bike dernikov1 wrote:
</I>
&gt;&gt;<i> I hope that someone can explain what happened, why squid stopped working.
</I>
&gt;<i>I can suggest a working theory: You did not have enough RAM before
</I>&gt;<i>vm.swappiness changes and the same insufficient RAM problem led to
</I>&gt;<i>failed system calls after you told the OS to free RAM (into swap) less
</I>&gt;<i>aggressively. The changes effectively decreased the amount of
</I>&gt;<i>immediately available RAM.
</I>
&gt;<i>From &quot;free -m output&quot; (available column)  i thought that we have
</I>enough memory, because  as I can remember, available never dropped
under 2GB.
As I understood  that system with  vm.swappines set to 10, will start
draining ram to swap after 90% memory used.
So why didn't swap hop in ? That we set vm.swappines to 0 i would
understand error.
Because errors started with  logrotate, i suspect that  problem
exploded because of logrotate and swap started to write to a disk at
same time,
and because of slow disks (small IOPS) it could not drain memory fast
enough, so available memory vanished and hell lose from there.


&gt;<i>If Squid is the primary service on your server, then consider:
</I>
It isn't only service but use over 90-95 percent memory resources.

&gt;<i>1. Removing RAID (for Squid disk cache).
</I>
We don't use disk cache because of slow disks, compared to  &quot;high&quot;
bandwith (we have 500Mbit/s)

&gt;<i>2. Removing swap (or at least not counting on it and treating
</I>&gt;<i>  any non-trivial swap usage as a system misconfiguration).
</I>
What to search ? Key words, vm.swappines got us in problem, as we
tried to tune  ?

&gt;<i>3. Identify the primary RAM consumers and
</I>&gt;<i>  the factors that influence their memory usage.
</I>
Squid, we suspect on kerberos negotiator, squid helpers, we will tune
up down setting over two weeks.
We have problems with squid.conf reconfiguration, because users lose
connection (they got squid error screen for moment) so it is nightmare
if we changing configuration in work time.

&gt;<i>The above actions may not solve your &quot;insufficient RAM&quot; problem (unless
</I>&gt;<i>RAID was the primary culprit) but they will give you a better starting
</I>&gt;<i>point for finding the solution. Others on the list can help you get
</I>&gt;<i>there, especially if you have specific questions.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>Good luck,
</I>&gt;<i>
</I>&gt;<i>Alex.
</I>
Thanks for theory, and help.


On Wed, Nov 8, 2017 at 4:08 PM, Alex Rousskov
&lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:
&gt;<i> On 11/08/2017 02:26 AM, Bike dernikov1 wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> I hope that someone can explain what happened, why squid stopped working.
</I>&gt;<i>
</I>&gt;<i> I can suggest a working theory: You did not have enough RAM before
</I>&gt;<i> vm.swappiness changes and the same insufficient RAM problem led to
</I>&gt;<i> failed system calls after you told the OS to free RAM (into swap) less
</I>&gt;<i> aggressively. The changes effectively decreased the amount of
</I>&gt;<i> immediately available RAM.
</I>&gt;<i>
</I>&gt;<i> If Squid is the primary service on your server, then consider:
</I>&gt;<i>
</I>&gt;<i> 1. Removing RAID (for Squid disk cache).
</I>&gt;<i>
</I>&gt;<i> 2. Removing swap (or at least not counting on it and treating
</I>&gt;<i>    any non-trivial swap usage as a system misconfiguration).
</I>&gt;<i>
</I>&gt;<i> 3. Identify the primary RAM consumers and
</I>&gt;<i>    the factors that influence their memory usage.
</I>&gt;<i>
</I>&gt;<i> The above actions may not solve your &quot;insufficient RAM&quot; problem (unless
</I>&gt;<i> RAID was the primary culprit) but they will give you a better starting
</I>&gt;<i> point for finding the solution. Others on the list can help you get
</I>&gt;<i> there, especially if you have specific questions.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Good luck,
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i>
</I>&gt;&gt;<i> The server has 24GB DDR3 memory,  disk swap set to 24GB, 12 CPU (24HT cores).
</I>&gt;&gt;<i> We have 2800 users, using  kerberos authentication, squidguard for
</I>&gt;&gt;<i> filtering, ldap authorization.
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016850.html">[squid-users] SQUID memory error after vm.swappines changed from 60 to 10
</A></li>
	<LI>Next message (by thread): <A HREF="016869.html">[squid-users] SQUID memory error after vm.swappines changed from 60 to 10
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16867">[ date ]</a>
              <a href="thread.html#16867">[ thread ]</a>
              <a href="subject.html#16867">[ subject ]</a>
              <a href="author.html#16867">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
