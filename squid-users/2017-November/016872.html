<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] https access only for few users
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20https%20access%20only%20for%20few%20users&In-Reply-To=%3C725999985.134949.1510256171458.JavaMail.zimbra%40baladia.gov.kw%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016863.html">
   <LINK REL="Next"  HREF="016875.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] https access only for few users</H1>
    <B>Simon Dcunha</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20https%20access%20only%20for%20few%20users&In-Reply-To=%3C725999985.134949.1510256171458.JavaMail.zimbra%40baladia.gov.kw%3E"
       TITLE="[squid-users] https access only for few users">simon at baladia.gov.kw
       </A><BR>
    <I>Thu Nov  9 19:36:11 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016863.html">[squid-users] https access only for few users
</A></li>
        <LI>Next message (by thread): <A HREF="016875.html">[squid-users] https access only for few users
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16872">[ date ]</a>
              <a href="thread.html#16872">[ thread ]</a>
              <a href="subject.html#16872">[ subject ]</a>
              <a href="author.html#16872">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dear Amos,

Million thanks for the immediate reply.

i will check it out and let you know

so sorry for being so silly

regards

simon

----- Original Message -----
From: &quot;Amos Jeffries&quot; &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Sent: Thursday, November 9, 2017 1:31:47 PM
Subject: Re: [squid-users] https access only for few users

On 09/11/17 23:03, Simon Dcunha wrote:
&gt;<i> 
</I>&gt;<i> Dear All,
</I>&gt;<i> 
</I>&gt;<i> I have squid running with no issues for a long time and recently i have the below task.
</I>&gt;<i> User access to internet is based on physical machine IP address acl so only user ips listed in the conf file have access to internet
</I>&gt;<i> 
</I>&gt;<i> i need to allow access to only one site for some users and deny everything else. its a https site
</I>&gt;<i> the site is <A HREF="https://mof-sc-site.custhelp.com/">https://mof-sc-site.custhelp.com/</A>
</I>&gt;<i> 
</I>&gt;<i> the users whos ips are listed in below acl should  access the above site only and nothing else.
</I>&gt;<i> 
</I>&gt;<i> so i have a access list as follows
</I>&gt;<i> 
</I>&gt;<i> ----------------------------------------------------
</I>&gt;<i> acl onesite src 172.16.52.23 172.16.6.121
</I>&gt;<i> acl allowed_site url_regex &quot;/etc/squid/site&quot;
</I>&gt;<i> http_access allow onesite allowed_site
</I>&gt;<i> http_access deny onesite
</I>&gt;<i> ------------------------------------------------------
</I>&gt;<i> 
</I>&gt;<i> in /etc/squid/site i have
</I>&gt;<i> ------------------
</I>&gt;<i> .mof*
</I>&gt;<i> 
</I>&gt;<i> Now when I try to access the above site it says page cannot be displayed and in the squid access.log i see the below
</I>&gt;<i> --------------
</I>&gt;<i> 1510224319.009      0 172.16.6.121 TCP_DENIED/403 4201 CONNECT mof-sc-site.custhelp.com:443 - HIER_NONE/- text/html
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> but if I try to access <A HREF="http://www.mof.gov.kw">http://www.mof.gov.kw</A> the home page is displayed and works fine
</I>&gt;<i> 
</I>&gt;<i> appreciate your advice and help
</I>&gt;<i> 
</I>
You are a) using the wrong tool [regex] for the job of matching a single 
*domain*, and b) using regex VERY VERY badly.

Your regex says any URL in existence that contains _any_ single 
character followed by 'm' then 'o' is a match for the ACL - thus is 
allowed to the &quot;onesite&quot; client(s). The 'f' being optional (the *) and 
at the end of the pattern means it does not matter at all for the 
matching and may as well not exist.



What you should be doing is using an ACL type that matches domain names 
and telling it the domain that you want to match:

   acl allowed_site dstdomain mof-sc-site.custhelp.com

The rest of your config snippet was correct for what you want to do.

Amos
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.
-- 
---------
Network Administrator
Kuwait Municipality!!!

-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016863.html">[squid-users] https access only for few users
</A></li>
	<LI>Next message (by thread): <A HREF="016875.html">[squid-users] https access only for few users
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16872">[ date ]</a>
              <a href="thread.html#16872">[ thread ]</a>
              <a href="subject.html#16872">[ subject ]</a>
              <a href="author.html#16872">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
