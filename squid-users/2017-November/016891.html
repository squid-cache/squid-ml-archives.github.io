<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SQUID memory error after vm.swappines changed from 60 to 10
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SQUID%20memory%20error%20after%20vm.swappines%20changed%0A%20from%2060%20to%2010&In-Reply-To=%3CCAAPixKgzxz_hCWxW%2BT5TBuBFqG4z6b3KFy0-9qE31Vq33MWsmw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016880.html">
   <LINK REL="Next"  HREF="016898.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SQUID memory error after vm.swappines changed from 60 to 10</H1>
    <B>Bike dernikov1</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SQUID%20memory%20error%20after%20vm.swappines%20changed%0A%20from%2060%20to%2010&In-Reply-To=%3CCAAPixKgzxz_hCWxW%2BT5TBuBFqG4z6b3KFy0-9qE31Vq33MWsmw%40mail.gmail.com%3E"
       TITLE="[squid-users] SQUID memory error after vm.swappines changed from 60 to 10">dernikov1 at gmail.com
       </A><BR>
    <I>Mon Nov 13 09:34:32 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016880.html">[squid-users] SQUID memory error after vm.swappines changed from 60 to 10
</A></li>
        <LI>Next message (by thread): <A HREF="016898.html">[squid-users] SQUID memory error after vm.swappines changed from 60 to 10
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16891">[ date ]</a>
              <a href="thread.html#16891">[ thread ]</a>
              <a href="subject.html#16891">[ subject ]</a>
              <a href="author.html#16891">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, Nov 10, 2017 at 4:43 PM, Alex Rousskov
&lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:
&gt;<i> On 11/10/2017 06:16 AM, Bike dernikov1 wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> So you suggest that we totally disable disk swap (or just for
</I>&gt;&gt;<i> debuging) ?
</I>&gt;<i>
</I>&gt;<i> I would aim for totally disabling disk swap, but getting to that
</I>&gt;<i> configuration is easier if you keep swap enabled and consider any
</I>&gt;<i> non-trivial swap use as a problem that you need to fix. After all
</I>&gt;<i> non-trivial swap uses are eliminated, it does not really matter much
</I>&gt;<i> whether you keep swap enabled or not!
</I>
That is also my goal. I have other scenarios in mind.
We have free older servers  IBM X3550 (8 cores), which can be upgrade
to 48GB ram, (from other old servers)
On new ones,we have only 24GB on primary, and 16GB ram on  second server.
For disabling swap, X3550  servers would be better, but they have only 8 cores.
That could be problem, but for now we have only 0.5 load on 12/HT 24  cores.
I know that core per core new cpu-s can process  4x-8x more, so more testing :)

&gt;<i> Please note that this suggestion is specific to performance-sensitive
</I>&gt;<i> Squid servers -- many other servers have very legitimate reasons to use
</I>&gt;<i> swap. YMMV.
</I>&gt;<i>
</I>Oracle can be good example.
Yes, we have one Oracle server, swap killed him, users was wild, load
average over 10 continuosly (8 core), 16GB mem.
We upgraded ram to 48GB. Now, max load is at 4-5 in peeks, 1-2  during
day. Swap enabled :) it use 9GB, but use all ram :).
Users don't call after upgrade.

&gt;<i>
</I>&gt;&gt;<i> That setting on production can be disaster.
</I>&gt;<i>
</I>&gt;<i> Squid swapping in production is an arguably worse disaster, as you have
</I>&gt;<i> learned. In many cases, it is better to deal with a lack of swap than to
</I>&gt;<i> rely on swap's magical effects that most humans poorly understand. YMMV.
</I>
In this scenario, swap is backup cache (as I understand) ? As TIER  in  SAN-s.
Swap could be used  to translate back data to mem if used, but it
stays on disk and purge after some time if not used ?
Or I am in delusion ?

&gt;&gt;<i> We will try, we reduced number of auth helper, prolong ldap caching.
</I>&gt;&gt;<i> Little steps but at last every bit counts.
</I>
We reduced kerberos helpers to 100 on Friday, 20 of those 100
currently active, 13 of those have requests/replies different than
zero.
Now reduced to 50. No problem appear over weekend.
cache_mem 14G
swappines = 60
ldap cache set to 24h

Mem stats:

             total        used        free      shared  buff/cache   available
Mem:          24101       16032        1488         156        6580        7497
Swap:         24561        1907       22654

&gt;<i> ... unless those bits are actually hurting. You may need to understand
</I>&gt;<i> your server memory usage better to reduce the time spent on trying
</I>&gt;<i> random changes. For example, if auth helpers are close to being
</I>&gt;<i> overloaded, reducing their number may make things worse.
</I>
No overload after changes. When we saw that we don't use so much
helpers it was logicaly to reduce that  number in little steps.
I agree, random testing can be painfully, on production even more.
Can you recommend best way to analyze memory, (except free -m, top/htop).
Squid-internal-mgr/mem have nice detail, i will start there with. Do
you have better way ?

&gt;<i> Alex.
</I>
Thanks for help,

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016880.html">[squid-users] SQUID memory error after vm.swappines changed from 60 to 10
</A></li>
	<LI>Next message (by thread): <A HREF="016898.html">[squid-users] SQUID memory error after vm.swappines changed from 60 to 10
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16891">[ date ]</a>
              <a href="thread.html#16891">[ thread ]</a>
              <a href="subject.html#16891">[ subject ]</a>
              <a href="author.html#16891">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
