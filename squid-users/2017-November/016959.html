<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] block user agent
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20block%20user%20agent&In-Reply-To=%3C107610513.275578.1510932471911%40mail.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016934.html">
   <LINK REL="Next"  HREF="016960.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] block user agent</H1>
    <B>Vieri</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20block%20user%20agent&In-Reply-To=%3C107610513.275578.1510932471911%40mail.yahoo.com%3E"
       TITLE="[squid-users] block user agent">rentorbuy at yahoo.com
       </A><BR>
    <I>Fri Nov 17 15:27:51 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016934.html">[squid-users] block user agent
</A></li>
        <LI>Next message (by thread): <A HREF="016960.html">[squid-users] block user agent
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16959">[ date ]</a>
              <a href="thread.html#16959">[ thread ]</a>
              <a href="subject.html#16959">[ subject ]</a>
              <a href="author.html#16959">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>________________________________
From: Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt;
&gt;<i> 1. Your &quot;works&quot; and &quot;does not work&quot; setups currently differ in at least
</I>&gt;<i> three variables: user agent name, slash after the user agent name, and
</I>&gt;<i> acl negation in http_access. Find out which single variable is
</I>&gt;<i> responsible for the breakage by eliminating all other differences.
</I>&gt;<i> 
</I>&gt;<i> 2. Post two ALL,2 cache.logs, each containing a single transaction, one
</I>&gt;<i> for the &quot;works&quot; case and one for the &quot;does not work&quot; case polished as
</I>&gt;<i> discussed in #1.
</I>


I can't really do anything about #1 except maybe leave out the forward slash.
That's because my 2 examples are trying to achieve the opposite.
Let me just rephrase everything so it's crystal clear.

My goal is to deny all client traffic from browsers that DO NOT have a specific user-agent string. So this is a negated statement. One of the things I can't do in Squid is define an ACL with a negated lookahead such as (?!useragentname).

So I set up two examples.

Common to both:

acl allowed_useragent browser MyAllowedUAstring
acl denied_useragent browser MyDeniedUAstring

# example 1:
http_access deny denied_useragent
http_reply_access deny denied_useragent
deny_info <A HREF="http://proxy-server1/proxy-error/?a=%a&amp;B=%B&amp;e=%e&amp;E=%E&amp;H=%H&amp;i=%i&amp;M=%M&amp;o=%o&amp;R=%R&amp;T=%T&amp;U=%U&amp;u=%u&amp;w=%w&amp;x=%x&amp;acl=denied_useragent">http://proxy-server1/proxy-error/?a=%a&amp;B=%B&amp;e=%e&amp;E=%E&amp;H=%H&amp;i=%i&amp;M=%M&amp;o=%o&amp;R=%R&amp;T=%T&amp;U=%U&amp;u=%u&amp;w=%w&amp;x=%x&amp;acl=denied_useragent</A> denied_useragent

I then run this from my test client:

# curl --insecure --user-agent MyAllowedUAstring <A HREF="https://www.gentoo.org">https://www.gentoo.org</A>
-&gt; works as expected (I see the web site). I guess you don't need to see cache.log here.

Now I run this:

# curl --insecure --user-agent MyDeniedUAstring <A HREF="https://www.gentoo.org">https://www.gentoo.org</A>
-&gt; works as expected (I'm denied access and I see Squid's error page).
I guess there's no need for the full log here either. It boils down to this anyway:
2017/11/17 13:24:26.937 kid1| 28,2| RegexData.cc(73) match: aclRegexData::match: match '(MyDeniedUAstring)' found in 'MyDeniedUAstring'
2017/11/17 13:24:26.937 kid1| 85,2| client_side_request.cc(745) clientAccessCheckDone: The request GET <A HREF="https://www.gentoo.org/">https://www.gentoo.org/</A> is DENIED; last ACL checked: denied_useragent

I'm done with example 1. That's because I cannot make a consistent list of all user agents I want to actively block. Instead, I want to &quot;deny everyone except one or two&quot;.

Also, since negative lookaheads are not supported in regular expressions, I change my example 1 to:

# example 2:
http_access deny !allowed_useragent
http_reply_access deny !allowed_useragent
deny_info <A HREF="http://proxy-server1/proxy-error/?a=%a&amp;B=%B&amp;e=%e&amp;E=%E&amp;H=%H&amp;i=%i&amp;M=%M&amp;o=%o&amp;R=%R&amp;T=%T&amp;U=%U&amp;u=%u&amp;w=%w&amp;x=%x&amp;acl=denied_useragent">http://proxy-server1/proxy-error/?a=%a&amp;B=%B&amp;e=%e&amp;E=%E&amp;H=%H&amp;i=%i&amp;M=%M&amp;o=%o&amp;R=%R&amp;T=%T&amp;U=%U&amp;u=%u&amp;w=%w&amp;x=%x&amp;acl=denied_useragent</A> allowed_useragent

Then I run this from the client:

# curl --insecure --user-agent MyAllowedUAstring <A HREF="https://www.gentoo.org">https://www.gentoo.org</A>
-&gt; I was expecting to be allowed access since Squid denies &quot;everything that's not&quot; MyAllowedUAstring. Well, at least I should have passed the &quot;deny&quot; line in example 2.
However, I'm being blocked right there. This is the full log:

2017/11/17 13:30:42.216 kid1| 5,2| TcpAcceptor.cc(220) doAccept: New connection on FD 88
2017/11/17 13:30:42.216 kid1| 5,2| TcpAcceptor.cc(295) acceptNext: connection on local=[::]:3229 remote=[::] FD 88 flags=25
2017/11/17 13:30:42.216 kid1| 33,2| client_side.cc(3943) httpsSslBumpAccessCheckDone: sslBump needed for local=89.16.167.134:443 remote=10.215.144.48 FD 8 flags=17 method 4
2017/11/17 13:30:42.216 kid1| 11,2| client_side.cc(2372) parseHttpRequest: HTTP Client local=89.16.167.134:443 remote=10.215.144.48 FD 8 flags=17
2017/11/17 13:30:42.216 kid1| 11,2| client_side.cc(2373) parseHttpRequest: HTTP Client REQUEST:
---------
CONNECT 89.16.167.134:443 HTTP/1.1
Host: 89.16.167.134:443


----------
2017/11/17 13:30:42.216 kid1| 85,2| client_side_request.cc(745) clientAccessCheckDone: The request CONNECT 89.16.167.134:443 is DENIED; last ACL checked: allowed_useragent
2017/11/17 13:30:42.216 kid1| 20,2| store.cc(996) checkCachable: StoreEntry::checkCachable: NO: not cachable
2017/11/17 13:30:42.216 kid1| 20,2| store.cc(996) checkCachable: StoreEntry::checkCachable: NO: not cachable
2017/11/17 13:30:42.216 kid1| 20,2| store.cc(996) checkCachable: StoreEntry::checkCachable: NO: not cachable
2017/11/17 13:30:42.226 kid1| 83,2| client_side.cc(3843) clientNegotiateSSL: clientNegotiateSSL: New session 0x125e030 on FD 8 (10.215.144.48:65262)
2017/11/17 13:30:42.226 kid1| 11,2| client_side.cc(2372) parseHttpRequest: HTTP Client local=89.16.167.134:443 remote=10.215.144.48 FD 8 flags=17
2017/11/17 13:30:42.226 kid1| 11,2| client_side.cc(2373) parseHttpRequest: HTTP Client REQUEST:
---------
GET / HTTP/1.1
Host: www.gentoo.org
User-Agent: MyAllowedUAstring
Accept: */*


----------
2017/11/17 13:30:42.227 kid1| 28,2| RegexData.cc(73) match: aclRegexData::match: match '(MyAllowedUAstring)' found in 'MyAllowedUAstring'
2017/11/17 13:30:42.227 kid1| 88,2| client_side_reply.cc(2073) processReplyAccessResult: The reply for GET <A HREF="https://www.gentoo.org/">https://www.gentoo.org/</A> is ALLOWED, because it matched denied_mimetypes_rep
2017/11/17 13:30:42.227 kid1| 11,2| client_side.cc(1409) sendStartOfMessage: HTTP Client local=89.16.167.134:443 remote=10.215.144.48 FD 8 flags=17
2017/11/17 13:30:42.227 kid1| 11,2| client_side.cc(1410) sendStartOfMessage: HTTP Client REPLY:
---------
HTTP/1.1 307 Temporary Redirect
Server: squid
Mime-Version: 1.0
Date: Fri, 17 Nov 2017 12:30:42 GMT
Content-Type: text/html;charset=utf-8
Content-Length: 0
Location: <A HREF="http://proxy-server1/proxy-error/?a=-&amp;B=&amp;e=0&amp;E=%5BNo%20Error%5D&amp;H=89.16.167.134&amp;i=10.215.144.48&amp;M=CONNECT&amp;o=&amp;R=/&amp;T=Fri,%2017%20Nov%202017%2012%3A30%3A42%20GMT&amp;U=https%3A%2F%2F89.16.167.134%2F*&amp;u=89.16.167.134%3A443&amp;w=IT%40mydomain.org&amp;x=&amp;acl=denied_useragent">http://proxy-server1/proxy-error/?a=-&amp;B=&amp;e=0&amp;E=%5BNo%20Error%5D&amp;H=89.16.167.134&amp;i=10.215.144.48&amp;M=CONNECT&amp;o=&amp;R=/&amp;T=Fri,%2017%20Nov%202017%2012%3A30%3A42%20GMT&amp;U=https%3A%2F%2F89.16.167.134%2F*&amp;u=89.16.167.134%3A443&amp;w=IT%40mydomain.org&amp;x=&amp;acl=denied_useragent</A>
X-Squid-Error: 403 Access Denied
X-Cache: MISS from proxy-server1
X-Cache-Lookup: NONE from proxy-server1:3227
Connection: close

Note that I have these defaults in my squid conf file:

acl CONNECT method CONNECT
http_access deny CONNECT !SSL_ports

Let's try another one:

# curl --insecure --user-agent MyDeniedUAstring <A HREF="https://www.gentoo.org">https://www.gentoo.org</A>
-&gt; This is as expected, I guess.

Full log:

2017/11/17 13:30:10.365 kid1| 5,2| TcpAcceptor.cc(220) doAccept: New connection on FD 88
2017/11/17 13:30:10.365 kid1| 5,2| TcpAcceptor.cc(295) acceptNext: connection on local=[::]:3229 remote=[::] FD 88 flags=25
2017/11/17 13:30:10.365 kid1| 33,2| client_side.cc(3943) httpsSslBumpAccessCheckDone: sslBump needed for local=89.16.167.134:443 remote=10.215.144.48 FD 8 flags=17 method 4
2017/11/17 13:30:10.365 kid1| 11,2| client_side.cc(2372) parseHttpRequest: HTTP Client local=89.16.167.134:443 remote=10.215.144.48 FD 8 flags=17
2017/11/17 13:30:10.365 kid1| 11,2| client_side.cc(2373) parseHttpRequest: HTTP Client REQUEST:
---------
CONNECT 89.16.167.134:443 HTTP/1.1
Host: 89.16.167.134:443


----------
2017/11/17 13:30:10.365 kid1| 85,2| client_side_request.cc(745) clientAccessCheckDone: The request CONNECT 89.16.167.134:443 is DENIED; last ACL checked: allowed_useragent
2017/11/17 13:30:10.365 kid1| 20,2| store.cc(996) checkCachable: StoreEntry::checkCachable: NO: not cachable
2017/11/17 13:30:10.365 kid1| 20,2| store.cc(996) checkCachable: StoreEntry::checkCachable: NO: not cachable
2017/11/17 13:30:10.365 kid1| 20,2| store.cc(996) checkCachable: StoreEntry::checkCachable: NO: not cachable
2017/11/17 13:30:10.385 kid1| 83,2| client_side.cc(3843) clientNegotiateSSL: clientNegotiateSSL: New session 0xdbdc70 on FD 8 (10.215.144.48:65237)
2017/11/17 13:30:10.386 kid1| 11,2| client_side.cc(2372) parseHttpRequest: HTTP Client local=89.16.167.134:443 remote=10.215.144.48 FD 8 flags=17
2017/11/17 13:30:10.386 kid1| 11,2| client_side.cc(2373) parseHttpRequest: HTTP Client REQUEST:
---------
GET / HTTP/1.1
Host: www.gentoo.org
User-Agent: MyDeniedUAstring
Accept: */*


----------
2017/11/17 13:30:10.386 kid1| 88,2| client_side_reply.cc(2073) processReplyAccessResult: The reply for GET <A HREF="https://www.gentoo.org/">https://www.gentoo.org/</A> is DENIED, because it matched allowed_useragent
2017/11/17 13:30:10.386 kid1| 20,2| store.cc(996) checkCachable: StoreEntry::checkCachable: NO: not cachable
2017/11/17 13:30:10.386 kid1| 20,2| store.cc(996) checkCachable: StoreEntry::checkCachable: NO: not cachable
2017/11/17 13:30:10.386 kid1| 20,2| store.cc(996) checkCachable: StoreEntry::checkCachable: NO: not cachable
2017/11/17 13:30:10.386 kid1| 88,2| client_side_reply.cc(2073) processReplyAccessResult: The reply for GET <A HREF="https://www.gentoo.org/">https://www.gentoo.org/</A> is ALLOWED, because it matched allowed_useragent
2017/11/17 13:30:10.386 kid1| 11,2| client_side.cc(1409) sendStartOfMessage: HTTP Client local=89.16.167.134:443 remote=10.215.144.48 FD 8 flags=17
2017/11/17 13:30:10.386 kid1| 11,2| client_side.cc(1410) sendStartOfMessage: HTTP Client REPLY:
---------
HTTP/1.1 302 Found
Server: squid
Mime-Version: 1.0
Date: Fri, 17 Nov 2017 12:30:10 GMT
Content-Type: text/html;charset=utf-8
Content-Length: 0
Location: <A HREF="http://proxy-server1/proxy-error/?a=-&amp;B=&amp;e=0&amp;E=%5BNo%20Error%5D&amp;H=www.gentoo.org&amp;i=10.215.144.48&amp;M=GET&amp;o=&amp;R=/&amp;T=Fri,%2017%20Nov%202017%2012%3A30%3A10%20GMT&amp;U=https%3A%2F%2Fwww.gentoo.org%2F&amp;u=https%3A%2F%2Fwww.gentoo.org%2F&amp;w=IT%40mydomain.org&amp;x=&amp;acl=denied_useragent">http://proxy-server1/proxy-error/?a=-&amp;B=&amp;e=0&amp;E=%5BNo%20Error%5D&amp;H=www.gentoo.org&amp;i=10.215.144.48&amp;M=GET&amp;o=&amp;R=/&amp;T=Fri,%2017%20Nov%202017%2012%3A30%3A10%20GMT&amp;U=https%3A%2F%2Fwww.gentoo.org%2F&amp;u=https%3A%2F%2Fwww.gentoo.org%2F&amp;w=IT%40mydomain.org&amp;x=&amp;acl=denied_useragent</A>
X-Squid-Error: 403 Access Denied
X-Cache: MISS from proxy-server1
X-Cache-Lookup: NONE from proxy-server1:3227
Connection: close

Now for plain HTTP with example 2.

# curl --user-agent MyDeniedUAstring <A HREF="http://www.fltk.org/index.php">http://www.fltk.org/index.php</A>
-&gt; As expected. It blocks access.

Full log:

2017/11/17 15:56:52.648 kid1| 5,2| TcpAcceptor.cc(220) doAccept: New connection on FD 85
2017/11/17 15:56:52.648 kid1| 5,2| TcpAcceptor.cc(295) acceptNext: connection on local=[::]:3228 remote=[::] FD 85 flags=25
2017/11/17 15:56:52.648 kid1| 11,2| client_side.cc(2372) parseHttpRequest: HTTP Client local=66.39.46.122:80 remote=10.215.144.48 FD 8 flags=17
2017/11/17 15:56:52.648 kid1| 11,2| client_side.cc(2373) parseHttpRequest: HTTP Client REQUEST:
---------
GET /index.php HTTP/1.1
Host: www.fltk.org
User-Agent: MyDeniedUAstring
Accept: */*


----------
2017/11/17 15:56:52.648 kid1| 85,2| client_side_request.cc(745) clientAccessCheckDone: The request GET <A HREF="http://www.fltk.org/index.php">http://www.fltk.org/index.php</A> is DENIED; last ACL checked: allowed_useragent
2017/11/17 15:56:52.648 kid1| 20,2| store.cc(996) checkCachable: StoreEntry::checkCachable: NO: not cachable
2017/11/17 15:56:52.648 kid1| 20,2| store.cc(996) checkCachable: StoreEntry::checkCachable: NO: not cachable
2017/11/17 15:56:52.648 kid1| 20,2| store.cc(996) checkCachable: StoreEntry::checkCachable: NO: not cachable
2017/11/17 15:56:52.648 kid1| 88,2| client_side_reply.cc(2073) processReplyAccessResult: The reply for GET <A HREF="http://www.fltk.org/index.php">http://www.fltk.org/index.php</A> is ALLOWED, because it matched allowed_useragent
2017/11/17 15:56:52.648 kid1| 11,2| client_side.cc(1409) sendStartOfMessage: HTTP Client local=66.39.46.122:80 remote=10.215.144.48 FD 8 flags=17
2017/11/17 15:56:52.648 kid1| 11,2| client_side.cc(1410) sendStartOfMessage: HTTP Client REPLY:
---------
HTTP/1.1 302 Found
Server: squid
Mime-Version: 1.0
Date: Fri, 17 Nov 2017 14:56:52 GMT
Content-Type: text/html;charset=utf-8
Content-Length: 0
Location: <A HREF="http://proxy-server1/proxy-error/?a=-&amp;B=&amp;e=0&amp;E=%5BNo%20Error%5D&amp;H=www.fltk.org&amp;i=10.215.144.48&amp;M=GET&amp;o=&amp;R=/index.php&amp;T=Fri,%2017%20Nov%202017%2014%3A56%3A52%20GMT&amp;U=http%3A%2F%2Fwww.fltk.org%2Findex.php&amp;u=http%3A%2F%2Fwww.fltk.org%2Findex.php&amp;w=IT%40mydomain.org&amp;x=&amp;acl=denied_useragent">http://proxy-server1/proxy-error/?a=-&amp;B=&amp;e=0&amp;E=%5BNo%20Error%5D&amp;H=www.fltk.org&amp;i=10.215.144.48&amp;M=GET&amp;o=&amp;R=/index.php&amp;T=Fri,%2017%20Nov%202017%2014%3A56%3A52%20GMT&amp;U=http%3A%2F%2Fwww.fltk.org%2Findex.php&amp;u=http%3A%2F%2Fwww.fltk.org%2Findex.php&amp;w=IT%40mydomain.org&amp;x=&amp;acl=denied_useragent</A>
X-Squid-Error: 403 Access Denied
X-Cache: MISS from proxy-server1
X-Cache-Lookup: NONE from proxy-server1:3227
Connection: keep-alive

However, now comes the interesting part.

# curl --user-agent MyAllowedUAstring <A HREF="http://www.fltk.org/index.php">http://www.fltk.org/index.php</A>
-&gt; works as expected (I see the web site). 

Full log:

2017/11/17 15:55:23.550 kid1| 5,2| TcpAcceptor.cc(220) doAccept: New connection on FD 85
2017/11/17 15:55:23.550 kid1| 5,2| TcpAcceptor.cc(295) acceptNext: connection on local=[::]:3228 remote=[::] FD 85 flags=25
2017/11/17 15:55:23.551 kid1| 11,2| client_side.cc(2372) parseHttpRequest: HTTP Client local=66.39.46.122:80 remote=10.215.144.48 FD 8 flags=17
2017/11/17 15:55:23.551 kid1| 11,2| client_side.cc(2373) parseHttpRequest: HTTP Client REQUEST:
---------
GET /index.php HTTP/1.1
Host: www.fltk.org
User-Agent: MyAllowedUAstring
Accept: */*


----------
2017/11/17 15:55:23.551 kid1| 28,2| RegexData.cc(73) match: aclRegexData::match: match '(MyAllowedUAstring)' found in 'MyAllowedUAstring'
2017/11/17 15:55:23.551 kid1| 82,2| external_acl.cc(805) aclMatchExternal: bllookup(&quot;http www.fltk.org 80 /index.php&quot;) = lookup needed
2017/11/17 15:55:23.551 kid1| 82,2| external_acl.cc(808) aclMatchExternal: &quot;http www.fltk.org 80 /index.php&quot;: queueing a call.
2017/11/17 15:55:23.551 kid1| 82,2| external_acl.cc(1444) Start: fg lookup in 'bllookup' for 'http www.fltk.org 80 /index.php'
2017/11/17 15:55:23.551 kid1| 82,2| external_acl.cc(811) aclMatchExternal: &quot;http www.fltk.org 80 /index.php&quot;: return -1.
2017/11/17 15:55:23.553 kid1| 82,2| external_acl.cc(1372) externalAclHandleReply: reply={result=OK, notes={message: www.fltk.org site not found in blacklist; }}
2017/11/17 15:55:23.553 kid1| 82,2| external_acl.cc(1288) external_acl_cache_add: external_acl_cache_add: Adding 'http www.fltk.org 80 /index.php' = ALLOWED
2017/11/17 15:55:23.553 kid1| 82,2| external_acl.cc(841) aclMatchExternal: bllookup = ALLOWED
2017/11/17 15:55:23.553 kid1| 85,2| client_side_request.cc(745) clientAccessCheckDone: The request GET <A HREF="http://www.fltk.org/index.php">http://www.fltk.org/index.php</A> is ALLOWED; last ACL checked: bl_lookup
2017/11/17 15:55:23.553 kid1| 85,2| client_side_request.cc(721) clientAccessCheck2: No adapted_http_access configuration. default: ALLOW
2017/11/17 15:55:23.553 kid1| 85,2| client_side_request.cc(745) clientAccessCheckDone: The request GET <A HREF="http://www.fltk.org/index.php">http://www.fltk.org/index.php</A> is ALLOWED; last ACL checked: bl_lookup
2017/11/17 15:55:23.554 kid1| 88,2| client_side_reply.cc(593) cacheHit: clientProcessHit: Vary detected!
2017/11/17 15:55:23.554 kid1| 17,2| FwdState.cc(133) FwdState: Forwarding client request local=66.39.46.122:80 remote=10.215.144.48 FD 8 flags=17, url=<A HREF="http://www.fltk.org/index.php">http://www.fltk.org/index.php</A>
2017/11/17 15:55:23.554 kid1| 44,2| peer_select.cc(280) peerSelectDnsPaths: Found sources for '<A HREF="http://www.fltk.org/index.php">http://www.fltk.org/index.php</A>'
2017/11/17 15:55:23.554 kid1| 44,2| peer_select.cc(281) peerSelectDnsPaths:   always_direct = DENIED
2017/11/17 15:55:23.554 kid1| 44,2| peer_select.cc(282) peerSelectDnsPaths:    never_direct = DENIED
2017/11/17 15:55:23.554 kid1| 44,2| peer_select.cc(288) peerSelectDnsPaths:    ORIGINAL_DST = local=10.215.144.48 remote=66.39.46.122:80 flags=25
2017/11/17 15:55:23.554 kid1| 44,2| peer_select.cc(295) peerSelectDnsPaths:        timedout = 0
2017/11/17 15:55:23.708 kid1| 11,2| http.cc(2229) sendRequest: HTTP Server local=10.215.144.48:35373 remote=66.39.46.122:80 FD 13 flags=25
2017/11/17 15:55:23.708 kid1| 11,2| http.cc(2230) sendRequest: HTTP Server REQUEST:
---------
GET /index.php HTTP/1.1
User-Agent: MyAllowedUAstring
Accept: */*
Host: www.fltk.org
Cache-Control: max-age=259200
Connection: keep-alive


----------
2017/11/17 15:55:23.884 kid1| ctx: enter level  0: '<A HREF="http://www.fltk.org/index.php">http://www.fltk.org/index.php</A>'
2017/11/17 15:55:23.884 kid1| 11,2| http.cc(719) processReplyHeader: HTTP Server local=10.215.144.48:35373 remote=66.39.46.122:80 FD 13 flags=25
2017/11/17 15:55:23.884 kid1| 11,2| http.cc(720) processReplyHeader: HTTP Server REPLY:
---------
HTTP/1.1 200 OK
Date: Fri, 17 Nov 2017 14:55:23 GMT
Server: Apache/2.4.29
Cache-Control: no-cache
Vary: Accept-Encoding
Keep-Alive: timeout=5, max=100
Connection: Keep-Alive
Transfer-Encoding: chunked
Content-Type: text/html

3a02
&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.0 Transitional//EN&quot; &quot;<A HREF="http://www.w3.org/TR/html4/loose.dtd">http://www.w3.org/TR/html4/loose.dtd</A>&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Fast Light Toolkit - Fast Light Toolkit (FLTK)&lt;/title&gt;
&lt;meta http-equiv='Pragma' content='no-cache'&gt;
&lt;meta http-equiv='Content-Type' content='text/html; charset=utf-8'&gt;
&lt;link rel='stylesheet' type='text/css' href='fltk.css'&gt;
&lt;link rel='alternate' title='FLTK RSS' type='application/rss+xml' href='index.rss'&gt;
&lt;link rel='shortcut icon' href='favicon.ico' type='image/x-icon'&gt;
&lt;meta name='keywords' content='gui toolkit,c++,linux,unix,macos x,x11,windows'&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;table width='100%' border='0' cellspacing='0' cellpadding='0' summary='Page'&gt;
&lt;tr class='header'&gt;&lt;td valign='top' width='15' rowspan='2'&gt;&lt;a href='index.php'&gt;&lt;img src='images/top-left.gif' width='15' height='70' border='0' alt=''&gt;&lt;/a&gt;&lt;/td&gt;&lt;td valign='top' width='224' rowspan='2'&gt;&lt;a href='index.php'&gt;&lt;img src='images/top-middle.gif' width='224' height='70' border='0' alt=''&gt;&lt;/a&gt;&lt;/td&gt;&lt;td width='100%' height='40'&gt;&lt;h1&gt;Fast Light Toolkit&lt;/h1&gt; &lt;/td&gt;&lt;td align='right' nowrap&gt;
&lt;table cellpadding=0 cellspacing=0 border=0&gt;&lt;tr&gt;&lt;td valign=top nowrap&gt;
&lt;a href=fltk-rss.xml&gt;&lt;img src=images/rss-fee
----------
2017/11/17 15:55:23.885 kid1| ctx: exit level  0
2017/11/17 15:55:23.885 kid1| 23,2| url.cc(407) urlParse: urlParse: URI has whitespace: {<A HREF="icap://127.0.0.1:1344/clamav">icap://127.0.0.1:1344/clamav</A> ICAP/1.0
}
2017/11/17 15:55:24.038 kid1| 28,2| RegexData.cc(73) match: aclRegexData::match: match '(MyAllowedUAstring)' found in 'MyAllowedUAstring'
2017/11/17 15:55:24.038 kid1| 88,2| client_side_reply.cc(2073) processReplyAccessResult: The reply for GET <A HREF="http://www.fltk.org/index.php">http://www.fltk.org/index.php</A> is ALLOWED, because it matched denied_mimetypes_rep
2017/11/17 15:55:24.038 kid1| 11,2| client_side.cc(1409) sendStartOfMessage: HTTP Client local=66.39.46.122:80 remote=10.215.144.48 FD 8 flags=17
2017/11/17 15:55:24.038 kid1| 11,2| client_side.cc(1410) sendStartOfMessage: HTTP Client REPLY:
---------
HTTP/1.1 200 OK
Date: Fri, 17 Nov 2017 14:55:23 GMT
Server: Apache/2.4.29
Cache-Control: no-cache
Vary: Accept-Encoding
Content-Type: text/html
Via: ICAP/1.0 proxy-server1.hospitalmanacor.org (C-ICAP/0.5.2 SquidClamav/Antivirus service )
X-Cache: MISS from proxy-server1
X-Cache-Lookup: MISS from proxy-server1:3227
Transfer-Encoding: chunked
Connection: keep-alive

How can I modify my example 2 settings so this access control works the same way with both http and https in an ssl-bumped environment.

Thanks,

Vieri

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016934.html">[squid-users] block user agent
</A></li>
	<LI>Next message (by thread): <A HREF="016960.html">[squid-users] block user agent
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16959">[ date ]</a>
              <a href="thread.html#16959">[ thread ]</a>
              <a href="subject.html#16959">[ subject ]</a>
              <a href="author.html#16959">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
