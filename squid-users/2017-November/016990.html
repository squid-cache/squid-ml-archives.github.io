<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] How to configure https_port ssl-bump ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20How%20to%20configure%20https_port%20ssl-bump%20%3F&In-Reply-To=%3C68f0504b-d661-3ff8-13b8-bbd89f3c3d20%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016988.html">
   <LINK REL="Next"  HREF="016992.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] How to configure https_port ssl-bump ?</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20How%20to%20configure%20https_port%20ssl-bump%20%3F&In-Reply-To=%3C68f0504b-d661-3ff8-13b8-bbd89f3c3d20%40treenet.co.nz%3E"
       TITLE="[squid-users] How to configure https_port ssl-bump ?">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Nov 21 03:25:26 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016988.html">[squid-users] How to configure https_port ssl-bump ?
</A></li>
        <LI>Next message (by thread): <A HREF="016992.html">[squid-users] open 256 port
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16990">[ date ]</a>
              <a href="thread.html#16990">[ thread ]</a>
              <a href="subject.html#16990">[ subject ]</a>
              <a href="author.html#16990">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 21/11/17 14:31, &#36213; &#20426; wrote:
&gt;<i> Hello&#65292;I configured&#160; https_port in squid.conf . However&#160; when I access 
</I>&gt;<i> https websites&#160;using Firefox&#65292;it shows&#160; &#160;&quot;Your connection is not secure&quot; .
</I>&gt;<i> 
</I>&gt;<i> The&#160;error&#160;like&#160;this:
</I>&gt;<i> www.amazon.com &lt;<A HREF="http://www.amazon.com">http://www.amazon.com</A>&gt; used an invalid security 
</I>&gt;<i> certificate.
</I>&gt;<i> This certificate is valid for 23.13.186.212 only.
</I>&gt;<i> Error code: SSL_ERROR_BAD_CERT_DOMAIN
</I>&gt;<i> 
</I>&gt;<i> My CA produced by openssl is a Self-signed certificate.
</I>&gt;<i> 
</I>
There are two poitns of brokenness here.

Firstly, has your Firefox been configured with the DER certificate of 
that CA so that it trusts your CA?

Without that Firefox will not trust *any* certs generated by your Squid.


&gt;<i> Here is my squid.conf:
</I>&gt;<i> 
</I>&gt;<i> https_port 192.168.51.200:3129 intercept ssl-bump connection-auth=off 
</I>&gt;<i> generate-host-certificates=on dynamic_cert_mem_cache_size=4MB 
</I>&gt;<i> cert=/usr/local/squid/ssl_cert/myCA.pem 
</I>&gt;<i> key=/usr/local/squid/ssl_cert/myCA.pem
</I>&gt;<i> 
</I>&gt;<i> acl ssl_step1 at_step SslBump1
</I>&gt;<i> acl ssl_step2 at_step SslBump2
</I>&gt;<i> acl ssl_step3 at_step SslBump3
</I>&gt;<i> 
</I>&gt;<i> ssl_bump bump all
</I>&gt;<i> 
</I>
Secondly, the above configures Squid to auto-generate the server 
certificate with zero details from the real server AND zero details from 
the client TLS handshake.

All Squid has to work with at that point is the raw-IP which the client 
used to connect the TCP connection underneath everything. So of course 
that is what the cert will be bound to.


Have you read this page to learn the bare basics about what is going on?
&lt;<A HREF="https://wiki.squid-cache.org/Features/SslPeekAndSplice">https://wiki.squid-cache.org/Features/SslPeekAndSplice</A>&gt;
I know the page looks long, but that is the minimal details you need to 
know about TLS and the Squid SSL-Bump features.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016988.html">[squid-users] How to configure https_port ssl-bump ?
</A></li>
	<LI>Next message (by thread): <A HREF="016992.html">[squid-users] open 256 port
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16990">[ date ]</a>
              <a href="thread.html#16990">[ thread ]</a>
              <a href="subject.html#16990">[ subject ]</a>
              <a href="author.html#16990">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
