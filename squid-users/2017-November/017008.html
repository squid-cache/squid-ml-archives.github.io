<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Lots of &quot;BUG 3279: HTTP reply without Date:&quot; after update to squid-5.0.0-20171117-r4d27d0a
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Lots%20of%20%22BUG%203279%3A%20HTTP%20reply%20without%20Date%3A%22%0A%20after%20update%20to%20squid-5.0.0-20171117-r4d27d0a&In-Reply-To=%3C3267f287-4362-048e-338c-d226098ed38e%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017010.html">
   <LINK REL="Next"  HREF="017006.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Lots of &quot;BUG 3279: HTTP reply without Date:&quot; after update to squid-5.0.0-20171117-r4d27d0a</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Lots%20of%20%22BUG%203279%3A%20HTTP%20reply%20without%20Date%3A%22%0A%20after%20update%20to%20squid-5.0.0-20171117-r4d27d0a&In-Reply-To=%3C3267f287-4362-048e-338c-d226098ed38e%40treenet.co.nz%3E"
       TITLE="[squid-users] Lots of &quot;BUG 3279: HTTP reply without Date:&quot; after update to squid-5.0.0-20171117-r4d27d0a">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Nov 23 08:56:30 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017010.html">[squid-users] Lots of &quot;BUG 3279: HTTP reply without Date:&quot; after update to squid-5.0.0-20171117-r4d27d0a
</A></li>
        <LI>Next message (by thread): <A HREF="017006.html">[squid-users] forward_max_tries 1 has no effect
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17008">[ date ]</a>
              <a href="thread.html#17008">[ thread ]</a>
              <a href="subject.html#17008">[ subject ]</a>
              <a href="author.html#17008">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 22/11/17 23:33, Ralf Hildebrandt wrote:
&gt;<i> I was updating from squid-5.0.0-20171103-re3bf07f
</I>&gt;<i> to                  squid-5.0.0-20171117-rd816577 (and I was also testing squid-5.0.0-20171117-r4d27d0a)
</I>&gt;<i> 
</I>&gt;<i> today and immediately found lots of &quot;BUG 3279: HTTP reply without
</I>&gt;<i> Date:&quot; messages in my log (cache_dir had been cleared upon start,
</I>&gt;<i> meaning I'm starting with a clean slate!):
</I>&gt;<i> 
</I>&gt;<i> 2017/11/22 11:16:02| BUG 3279: HTTP reply without Date:
</I>...
 &gt;
&gt;<i> is this a known bug with the recent snapshot?
</I>&gt;<i> 
</I>
Yes, it still happens when a server delivers responses without a Date 
header. Though IIRC it is mostly seen in the cases where an IMS/INM 
conditional response is returning without a Date header (a message state 
which is forbidden in HTTP).
  Taking a wild guess I suspect they are probably occuring when a client 
revalidating its client-side cached content from one of the broken 
servers. Or slightly less likely one of the early responses in cache_mem 
right after the restart has the problem.


The patch joseph referred to synthesizes a fake Date header some time 
far in the past. Thus forcing the content to become 'stale' in the 
cache. That can either led to further refresh conditionals which 
perpetuate the problem, or to purging the object from cache - thus 
causing extra long fetch times for all traffic to that server.

Current Squid should only be logging that message at a relatively high 
debug level (not important anymore) and synthesizing a Date header only 
when the 2xx status is delivered to the client - the object cannot be 
used for revalidation due to the missing header.


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017010.html">[squid-users] Lots of &quot;BUG 3279: HTTP reply without Date:&quot; after update to squid-5.0.0-20171117-r4d27d0a
</A></li>
	<LI>Next message (by thread): <A HREF="017006.html">[squid-users] forward_max_tries 1 has no effect
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17008">[ date ]</a>
              <a href="thread.html#17008">[ thread ]</a>
              <a href="subject.html#17008">[ subject ]</a>
              <a href="author.html#17008">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
