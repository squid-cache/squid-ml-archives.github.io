<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] forward_max_tries 1 has no effect
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20forward_max_tries%201%20has%20no%20effect&In-Reply-To=%3C7E5CA2C7-96B6-4535-88D2-0176B0D10EC4%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017007.html">
   <LINK REL="Next"  HREF="017012.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] forward_max_tries 1 has no effect</H1>
    <B>Ivan Larionov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20forward_max_tries%201%20has%20no%20effect&In-Reply-To=%3C7E5CA2C7-96B6-4535-88D2-0176B0D10EC4%40gmail.com%3E"
       TITLE="[squid-users] forward_max_tries 1 has no effect">xeron.oskom at gmail.com
       </A><BR>
    <I>Thu Nov 23 21:03:33 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017007.html">[squid-users] forward_max_tries 1 has no effect
</A></li>
        <LI>Next message (by thread): <A HREF="017012.html">[squid-users] forward_max_tries 1 has no effect
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17011">[ date ]</a>
              <a href="thread.html#17011">[ thread ]</a>
              <a href="subject.html#17011">[ subject ]</a>
              <a href="author.html#17011">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> 
</I>&gt;<i> On Nov 23, 2017, at 12:32 AM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> On 23/11/17 14:20, Ivan Larionov wrote:
</I>&gt;&gt;<i> Hello.
</I>&gt;&gt;<i> We have an issue with squid when it tries to re-forward / retry failed request even when forward_max_tries is set to 1. The situation when it happens is when there's no response, parent just closes the connection.
</I>&gt;<i> ...
</I>&gt;&gt;<i> It doesn't happen 100% times. Sometimes squid returns 502 after the 1st try, sometimes it retries once. Also I haven't seen more than 1 retry.
</I>&gt;<i> 
</I>&gt;<i> Please enable debug_options 44,2 to see what destinations your Squid is actually finding.
</I>
I'll check this on Monday.

&gt;<i> 
</I>&gt;<i> max_forward_tries is just a rough cap on the number of server names which can be found when generating that list. The actual destinations count can exceed it if one or more of the servers happens to have multiple IPs to try.
</I>&gt;<i> 
</I>&gt;<i> The overall transaction can involve retries if one of the other layers (TCP or HTTP) contains retry semantics to a single server.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> Could it be a bug? We'd really like to disable these retries.
</I>&gt;<i> 
</I>&gt;<i> Why are trying to break HTTP?
</I>&gt;<i> What is the actual problem you are trying to resolve here?
</I>&gt;<i> 
</I>
Why do you think I'm trying to break HTTP?

squid forwards the request to parent but parent misbehaves and just closes the connection after 40 seconds. I'm trying to prevent retry of request in such situation. Why squid retries if I never asked him to do it and specifically said &quot;forward_max_tries 1&quot;.

And this is not a connection failure, squid successfully establishes the connection and sends the request, parent ACKs it, just never responses back and proactively closes the connection.

We're already fixing parent behavior, but still want to disable retries on squid side.

&gt;<i> 
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017007.html">[squid-users] forward_max_tries 1 has no effect
</A></li>
	<LI>Next message (by thread): <A HREF="017012.html">[squid-users] forward_max_tries 1 has no effect
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17011">[ date ]</a>
              <a href="thread.html#17011">[ thread ]</a>
              <a href="subject.html#17011">[ subject ]</a>
              <a href="author.html#17011">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
