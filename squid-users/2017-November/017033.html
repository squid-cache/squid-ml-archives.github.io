<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Transparent Squid
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Transparent%20Squid&In-Reply-To=%3C20171128130343.GA8443%40fantomas.sk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017030.html">
   <LINK REL="Next"  HREF="017040.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Transparent Squid</H1>
    <B>Matus UHLAR - fantomas</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Transparent%20Squid&In-Reply-To=%3C20171128130343.GA8443%40fantomas.sk%3E"
       TITLE="[squid-users] Transparent Squid">uhlar at fantomas.sk
       </A><BR>
    <I>Tue Nov 28 13:03:43 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="017030.html">[squid-users] Transparent Squid
</A></li>
        <LI>Next message (by thread): <A HREF="017040.html">[squid-users] Transparent Squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17033">[ date ]</a>
              <a href="thread.html#17033">[ thread ]</a>
              <a href="subject.html#17033">[ subject ]</a>
              <a href="author.html#17033">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 27.11.17 11:24, LINGYUN ZHAO wrote:
&gt;<i>I need Squid as a real 'transparent' proxy on Fedora without changing 5
</I>&gt;<i>tuples. Is it possible?
</I>
tuples?

&gt;<i>The setup is simple as Client ---------- Fedora --------Server
</I>
is fedora NAT device and also running squid?

&gt;<i>The Squid version is 3.5.20.The key configuration on Squid as below:
</I>&gt;<i>
</I>&gt;<i>   http_port 0.0.0.0:3128 transparent
</I>&gt;<i>
</I>&gt;<i>   acl localnet src 10.0.0.0/24
</I>&gt;<i>
</I>&gt;<i>   http_access allow localnet
</I>&gt;<i>
</I>&gt;<i>And I configured a NAT on Fedora.
</I>&gt;<i>
</I>&gt;<i>   iptables -t nat -A PREROUTING -i eth1 -p tcp --dport 80 -j DNAT --to
</I>&gt;<i>10.0.0.1:3128
</I>
this only works if &quot;fedora&quot; does the NAT and runs squid.
(just for sure)

&gt;<i>When I run curl on Client to server. I found the server receives the
</I>&gt;<i>traffic with Fedora's IP address and different source port, instead of
</I>&gt;<i>Client IP address and original source port.
</I>
when you redirect traffic tyo the squid and squid connect to the server,
it's logical that server sees squid's IP.

if you want to keep source client's IP, you need tproxy:
<A HREF="https://wiki.squid-cache.org/Features/Tproxy4">https://wiki.squid-cache.org/Features/Tproxy4</A>


-- 
Matus UHLAR - fantomas, <A HREF="https://lists.squid-cache.org/listinfo/squid-users">uhlar at fantomas.sk</A> ; <A HREF="http://www.fantomas.sk/">http://www.fantomas.sk/</A>
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Due to unexpected conditions Windows 2000 will be released
in first quarter of year 1901

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="017030.html">[squid-users] Transparent Squid
</A></li>
	<LI>Next message (by thread): <A HREF="017040.html">[squid-users] Transparent Squid
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17033">[ date ]</a>
              <a href="thread.html#17033">[ thread ]</a>
              <a href="subject.html#17033">[ subject ]</a>
              <a href="author.html#17033">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
