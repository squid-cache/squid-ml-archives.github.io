From eliezer at ngtech.co.il  Sun Oct  1 01:05:24 2017
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Sun, 1 Oct 2017 04:05:24 +0300
Subject: [squid-users] SSL Bump Failures with Google and Wikipedia
In-Reply-To: <BBEC09F5-1AB6-481E-92C4-F250C51B01D6@diladele.com>
References: <CA+ekxPVs_Nho43T=jtF+pvzs5jNn9j63mWLxpDJda=VkVhkX6w@mail.gmail.com>
 <01c001d33a31$af7c16f0$0e7444d0$@ngtech.co.il>,
 <CA+ekxPUSMGNS1tr7nztMM2NaJVQgZyOLK8S+QZKhsoWBaR8tUA@mail.gmail.com>
 <BBEC09F5-1AB6-481E-92C4-F250C51B01D6@diladele.com>
Message-ID: <023501d33a51$5cea5760$16bf0620$@ngtech.co.il>

Hey Rafael,

Where have you seen the details about brotli being used?

Thanks,
Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il



-----Original Message-----
From: Rafael Akchurin [mailto:rafael.akchurin at diladele.com] 
Sent: Sunday, October 1, 2017 01:16
To: Jeffrey Merkey <jeffmerkey at gmail.com>
Cc: Eliezer Croitoru <eliezer at ngtech.co.il>; squid-users
<squid-users at lists.squid-cache.org>
Subject: Re: [squid-users] SSL Bump Failures with Google and Wikipedia

Hello Jeff,

Do not forget Google and YouTube are now using brotli encoding extensively,
not only gzip.

Best regards,
Rafael Akchurin

> Op 30 sep. 2017 om 23:49 heeft Jeffrey Merkey <jeffmerkey at gmail.com> het
volgende geschreven:
> 
>> On 9/30/17, Eliezer Croitoru <eliezer at ngtech.co.il> wrote:
>> Hey Jeffrey,
>> 
>> What happens when you disable the next icap service this way:
>> icap_service service_avi_resp respmod_precache 
>> icap://127.0.0.1:1344/cherokee bypass=0 adaptation_access 
>> service_avi_resp deny all
>> 
>> Is it still the same?
>> What I suspect is that the requests are defined to accept gzip 
>> compressed objects and the icap service is not "gnuzip" them which 
>> results in what you see.
>> 
>> To make sure that squid is not at fault here try to disable both icap 
>> services and then add then one at a time and see which of this 
>> triangle is giving you trouble.
>> I enhanced an ICAP library which is written in GoLang at:
>> https://github.com/elico/icap
>> 
>> And I have couple examples on how to work with http requests and 
>> responses
>> at:
>> https://github.com/andybalholm/redwood/
>> https://github.com/andybalholm/redwood/search?utf8=%E2%9C%93&q=gzip&t
>> ype=
>> 
>> Let me know if you need help finding out the issue.
>> 
>> All The Bests,
>> Eliezer
>> 
>> ----
>> Eliezer Croitoru
>> Linux System Administrator
>> Mobile: +972-5-28704261
>> Email: eliezer at ngtech.co.il
>> 
>> 
>> 
>> -----Original Message-----
>> From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] 
>> On Behalf Of Jeffrey Merkey
>> Sent: Saturday, September 30, 2017 23:28
>> To: squid-users <squid-users at lists.squid-cache.org>
>> Subject: [squid-users] SSL Bump Failures with Google and Wikipedia
>> 
>> Hello All,
>> 
>> I have been working with the squid server and icap and I have been 
>> running into problems with content cached from google and wikipedia.
>> Some sites using https, such as Centos.org work perfectly with ssl 
>> bumping and I get the decrypted content as html and it's readable.
>> Other sites, such as google and wikipedia return what looks like 
>> encrypted traffic, or perhaps mime encoded data, I am not sure which.
>> 
>> Are there cases where squid will default to direct mode and not 
>> decrypt the traffic?  I am using the latest squid server 3.5.27.  I 
>> really would like to get this working with google and wikipedia.  I 
>> reviewed the page source code from the browser viewer and it looks 
>> nothing like the data I am getting via the icap server.
>> 
>> Any assistance would be greatly appreciated.
>> 
>> The config I am using is:
>> 
>> #
>> # Recommended minimum configuration:
>> #
>> 
>> # Example rule allowing access from your local networks.
>> # Adapt to list your (internal) IP networks from where browsing # 
>> should be allowed
>> 
>> acl localnet src 127.0.0.1
>> acl localnet src 10.0.0.0/8     # RFC1918 possible internal network
>> acl localnet src 172.16.0.0/12  # RFC1918 possible internal network 
>> acl localnet src 192.168.0.0/16 # RFC1918 possible internal network
>> acl localnet src fc00::/7       # RFC 4193 local private network range
>> acl localnet src fe80::/10      # RFC 4291 link-local (directly
>> plugged) machines
>> 
>> acl SSL_ports port 443
>> acl Safe_ports port 80          # http
>> acl Safe_ports port 21          # ftp
>> acl Safe_ports port 443         # https
>> acl Safe_ports port 70          # gopher
>> acl Safe_ports port 210         # wais
>> acl Safe_ports port 1025-65535  # unregistered ports
>> acl Safe_ports port 280         # http-mgmt
>> acl Safe_ports port 488         # gss-http
>> acl Safe_ports port 591         # filemaker
>> acl Safe_ports port 777         # multiling http
>> acl CONNECT method CONNECT
>> 
>> #
>> # Recommended minimum Access Permission configuration:
>> #
>> # Deny requests to certain unsafe ports http_access deny !Safe_ports
>> 
>> # Deny CONNECT to other than secure SSL ports http_access deny 
>> CONNECT !SSL_ports
>> 
>> # Only allow cachemgr access from localhost http_access allow 
>> localhost manager http_access deny manager
>> 
>> # We strongly recommend the following be uncommented to protect 
>> innocent # web applications running on the proxy server who think the 
>> only # one who can access services on "localhost" is a local user 
>> #http_access deny to_localhost
>> 
>> #
>> # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS #
>> 
>> # Example rule allowing access from your local networks.
>> # Adapt localnet in the ACL section to list your (internal) IP 
>> networks # from where browsing should be allowed http_access allow 
>> localnet http_access allow localhost
>> 
>> # And finally deny all other access to this proxy http_access deny 
>> all
>> 
>> # Squid normally listens to port 3128 #http_port 3128
>> 
>> # Uncomment and adjust the following to add a disk cache directory.
>> #cache_dir ufs /usr/local/squid/var/cache/squid 100 16 256
>> 
>> # Leave coredumps in the first cache dir coredump_dir 
>> /usr/local/squid/var/cache/squid
>> 
>> #
>> # Add any of your own refresh_pattern entries above these.
>> #
>> refresh_pattern ^ftp:           1440    20%     10080
>> refresh_pattern ^gopher:        1440    0%      1440
>> refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
>> refresh_pattern .               0       20%     4320
>> 
>> http_port 3128 ssl-bump generate-host-certificates=on 
>> dynamic_cert_mem_cache_size=4MB cert=/etc/squid/ssl_cert/myCA.pem 
>> http_port 3129
>> 
>> # SSL Bump Config
>> always_direct allow all
>> ssl_bump server-first all
>> sslproxy_cert_error deny all
>> sslproxy_flags DONT_VERIFY_PEER
>> sslcrtd_program /usr/local/squid/libexec/ssl_crtd -s /var/lib/ssl_db 
>> -M 4MB sslcrtd_children 8 startup=1 idle=1
>> 
>> # For squid 3.5.x
>> #sslcrtd_program /usr/local/squid/libexec/ssl_crtd -s /var/lib/ssl_db 
>> -M 4MB
>> 
>> # For squid 4.x
>> # sslcrtd_program /usr/local/squid/libexec/security_file_certgen -s 
>> /var/lib/ssl_db -M 4MB
>> 
>> icap_enable on
>> icap_send_client_ip on
>> icap_send_client_username on
>> icap_client_username_header X-Authenticated-User icap_preview_enable 
>> on icap_preview_size 1024 icap_service service_avi_req 
>> reqmod_precache icap://127.0.0.1:1344/request
>> bypass=1
>> adaptation_access service_avi_req allow all
>> 
>> icap_service service_avi_resp respmod_precache 
>> icap://127.0.0.1:1344/cherokee bypass=0 adaptation_access 
>> service_avi_resp allow all
>> 
>> Jeff
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>> 
>> 
> 
> Eliezer,
> 
> Well, you certainly hit the nail on the head.  I added the following 
> code to check the content being sent to the icap server from squid, 
> and here is what I found when I check the headers being sent from the 
> remote web server:
> 
> Code to check for content type and encoding received by the icap 
> server added to c-icap:
> 
>    hdrs = ci_http_response_headers(req);
>    content_type = ci_headers_value(hdrs, "Content-Type");
>    if (content_type)
>       ci_debug_printf(1,"srv_cherokee:  content-type: %s\n",
>                       content_type);
> 
>    content_encoding = ci_headers_value(hdrs, "Content-Encoding");
>    if (content_encoding)
>       ci_debug_printf(1,"srv_cherokee:  content-encoding: %s\n",
>                       content_encoding);
> 
> And the output from scanned pages sent over from squid:
> 
> srv_cherokee:  init request 0x7f3dbc008eb0 pool hits:1 allocations: 1 
> Allocating from objects pool object 5 pool hits:1 allocations: 1 
> Geting buffer from pool 4096:1 Requested service: cherokee Read 
> preview data if there are and process request
> srv_cherokee:  content-type: text/html; charset=utf-8
> srv_cherokee:  content-encoding: gzip         <-- As you stated, I am
> getting gzipped data
> srv_cherokee:  we expect to read :-1 body data Allow 204...
> Preview handler return allow 204 response
> srv_cherokee:  release request 0x7f3dbc008eb0 Store buffer to long 
> pool 4096:1 Storing to objects pool object 5 Log request to access log 
> file /var/log/i-cap_access.log
> 
> 
> Wikipedia  at https://en.wikipedia.org/wiki/HTTP_compression describes 
> the process as:
> 
> " ...
>   Compression scheme negotiation[edit]
>   In most cases, excluding the SDCH, the negotiation is done in two 
> steps, described in
>   RFC 2616:
> 
>   1. The web client advertises which compression schemes it supports 
> by including a list
>   of tokens in the HTTP request. For Content-Encoding, the list in a 
> field called Accept -
>   Encoding; for Transfer-Encoding, the field is called TE.
> 
>   GET /encrypted-area HTTP/1.1
>   Host: www.example.com
>   Accept-Encoding: gzip, deflate
> 
>   2. If the server supports one or more compression schemes, the 
> outgoing data may be
>   compressed by one or more methods supported by both parties. If this 
> is the case, the
>   server will add a Content-Encoding or Transfer-Encoding field in the 
> HTTP response with
>   the used schemes, separated by commas.
> 
>   HTTP/1.1 200 OK
>   Date: mon, 26 June 2016 22:38:34 GMT
>   Server: Apache/1.3.3.7 (Unix)  (Red-Hat/Linux)
>   Last-Modified: Wed, 08 Jan 2003 23:11:55 GMT
>   Accept-Ranges: bytes
>   Content-Length: 438
>   Connection: close
>   Content-Type: text/html; charset=UTF-8
>   Content-Encoding: gzip
> 
>   The web server is by no means obligated to use any compression method -
this
>   depends on the internal settings of the web server and also may 
> depend on the internal
>   architecture of the website in question.
> 
>   In case of SDCH a dictionary negotiation is also required, which may 
> involve additional
>   steps, like downloading a proper dictionary from .
> .."
> 
> 
> So, it looks like it is a feature of the browser.  So, is it possible 
> to have squid gunzip the data or configure the browser not to send the 
> header  to remove "Accept-Encoding: gzip, deflate" from the request 
> sent to the remote server telling it to gzip the data?
> 
> Thanks
> 
> Jeff
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From yvoinov at gmail.com  Sun Oct  1 01:08:04 2017
From: yvoinov at gmail.com (Yuri)
Date: Sun, 1 Oct 2017 07:08:04 +0600
Subject: [squid-users] SSL Bump Failures with Google and Wikipedia
In-Reply-To: <023501d33a51$5cea5760$16bf0620$@ngtech.co.il>
References: <CA+ekxPVs_Nho43T=jtF+pvzs5jNn9j63mWLxpDJda=VkVhkX6w@mail.gmail.com>
 <01c001d33a31$af7c16f0$0e7444d0$@ngtech.co.il>
 <CA+ekxPUSMGNS1tr7nztMM2NaJVQgZyOLK8S+QZKhsoWBaR8tUA@mail.gmail.com>
 <BBEC09F5-1AB6-481E-92C4-F250C51B01D6@diladele.com>
 <023501d33a51$5cea5760$16bf0620$@ngtech.co.il>
Message-ID: <3d87fae7-e104-6ef1-1ab6-67bb7e0e79a8@gmail.com>

I guess in HTTP headers. =-O :-D


01.10.2017 7:05, Eliezer Croitoru ?????:
> Hey Rafael,
>
> Where have you seen the details about brotli being used?
>
> Thanks,
> Eliezer
>
> ----
> Eliezer Croitoru
> Linux System Administrator
> Mobile: +972-5-28704261
> Email: eliezer at ngtech.co.il
>
>
>
> -----Original Message-----
> From: Rafael Akchurin [mailto:rafael.akchurin at diladele.com] 
> Sent: Sunday, October 1, 2017 01:16
> To: Jeffrey Merkey <jeffmerkey at gmail.com>
> Cc: Eliezer Croitoru <eliezer at ngtech.co.il>; squid-users
> <squid-users at lists.squid-cache.org>
> Subject: Re: [squid-users] SSL Bump Failures with Google and Wikipedia
>
> Hello Jeff,
>
> Do not forget Google and YouTube are now using brotli encoding extensively,
> not only gzip.
>
> Best regards,
> Rafael Akchurin
>
>> Op 30 sep. 2017 om 23:49 heeft Jeffrey Merkey <jeffmerkey at gmail.com> het
> volgende geschreven:
>>> On 9/30/17, Eliezer Croitoru <eliezer at ngtech.co.il> wrote:
>>> Hey Jeffrey,
>>>
>>> What happens when you disable the next icap service this way:
>>> icap_service service_avi_resp respmod_precache 
>>> icap://127.0.0.1:1344/cherokee bypass=0 adaptation_access 
>>> service_avi_resp deny all
>>>
>>> Is it still the same?
>>> What I suspect is that the requests are defined to accept gzip 
>>> compressed objects and the icap service is not "gnuzip" them which 
>>> results in what you see.
>>>
>>> To make sure that squid is not at fault here try to disable both icap 
>>> services and then add then one at a time and see which of this 
>>> triangle is giving you trouble.
>>> I enhanced an ICAP library which is written in GoLang at:
>>> https://github.com/elico/icap
>>>
>>> And I have couple examples on how to work with http requests and 
>>> responses
>>> at:
>>> https://github.com/andybalholm/redwood/
>>> https://github.com/andybalholm/redwood/search?utf8=%E2%9C%93&q=gzip&t
>>> ype=
>>>
>>> Let me know if you need help finding out the issue.
>>>
>>> All The Bests,
>>> Eliezer
>>>
>>> ----
>>> Eliezer Croitoru
>>> Linux System Administrator
>>> Mobile: +972-5-28704261
>>> Email: eliezer at ngtech.co.il
>>>
>>>
>>>
>>> -----Original Message-----
>>> From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] 
>>> On Behalf Of Jeffrey Merkey
>>> Sent: Saturday, September 30, 2017 23:28
>>> To: squid-users <squid-users at lists.squid-cache.org>
>>> Subject: [squid-users] SSL Bump Failures with Google and Wikipedia
>>>
>>> Hello All,
>>>
>>> I have been working with the squid server and icap and I have been 
>>> running into problems with content cached from google and wikipedia.
>>> Some sites using https, such as Centos.org work perfectly with ssl 
>>> bumping and I get the decrypted content as html and it's readable.
>>> Other sites, such as google and wikipedia return what looks like 
>>> encrypted traffic, or perhaps mime encoded data, I am not sure which.
>>>
>>> Are there cases where squid will default to direct mode and not 
>>> decrypt the traffic?  I am using the latest squid server 3.5.27.  I 
>>> really would like to get this working with google and wikipedia.  I 
>>> reviewed the page source code from the browser viewer and it looks 
>>> nothing like the data I am getting via the icap server.
>>>
>>> Any assistance would be greatly appreciated.
>>>
>>> The config I am using is:
>>>
>>> #
>>> # Recommended minimum configuration:
>>> #
>>>
>>> # Example rule allowing access from your local networks.
>>> # Adapt to list your (internal) IP networks from where browsing # 
>>> should be allowed
>>>
>>> acl localnet src 127.0.0.1
>>> acl localnet src 10.0.0.0/8     # RFC1918 possible internal network
>>> acl localnet src 172.16.0.0/12  # RFC1918 possible internal network 
>>> acl localnet src 192.168.0.0/16 # RFC1918 possible internal network
>>> acl localnet src fc00::/7       # RFC 4193 local private network range
>>> acl localnet src fe80::/10      # RFC 4291 link-local (directly
>>> plugged) machines
>>>
>>> acl SSL_ports port 443
>>> acl Safe_ports port 80          # http
>>> acl Safe_ports port 21          # ftp
>>> acl Safe_ports port 443         # https
>>> acl Safe_ports port 70          # gopher
>>> acl Safe_ports port 210         # wais
>>> acl Safe_ports port 1025-65535  # unregistered ports
>>> acl Safe_ports port 280         # http-mgmt
>>> acl Safe_ports port 488         # gss-http
>>> acl Safe_ports port 591         # filemaker
>>> acl Safe_ports port 777         # multiling http
>>> acl CONNECT method CONNECT
>>>
>>> #
>>> # Recommended minimum Access Permission configuration:
>>> #
>>> # Deny requests to certain unsafe ports http_access deny !Safe_ports
>>>
>>> # Deny CONNECT to other than secure SSL ports http_access deny 
>>> CONNECT !SSL_ports
>>>
>>> # Only allow cachemgr access from localhost http_access allow 
>>> localhost manager http_access deny manager
>>>
>>> # We strongly recommend the following be uncommented to protect 
>>> innocent # web applications running on the proxy server who think the 
>>> only # one who can access services on "localhost" is a local user 
>>> #http_access deny to_localhost
>>>
>>> #
>>> # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS #
>>>
>>> # Example rule allowing access from your local networks.
>>> # Adapt localnet in the ACL section to list your (internal) IP 
>>> networks # from where browsing should be allowed http_access allow 
>>> localnet http_access allow localhost
>>>
>>> # And finally deny all other access to this proxy http_access deny 
>>> all
>>>
>>> # Squid normally listens to port 3128 #http_port 3128
>>>
>>> # Uncomment and adjust the following to add a disk cache directory.
>>> #cache_dir ufs /usr/local/squid/var/cache/squid 100 16 256
>>>
>>> # Leave coredumps in the first cache dir coredump_dir 
>>> /usr/local/squid/var/cache/squid
>>>
>>> #
>>> # Add any of your own refresh_pattern entries above these.
>>> #
>>> refresh_pattern ^ftp:           1440    20%     10080
>>> refresh_pattern ^gopher:        1440    0%      1440
>>> refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
>>> refresh_pattern .               0       20%     4320
>>>
>>> http_port 3128 ssl-bump generate-host-certificates=on 
>>> dynamic_cert_mem_cache_size=4MB cert=/etc/squid/ssl_cert/myCA.pem 
>>> http_port 3129
>>>
>>> # SSL Bump Config
>>> always_direct allow all
>>> ssl_bump server-first all
>>> sslproxy_cert_error deny all
>>> sslproxy_flags DONT_VERIFY_PEER
>>> sslcrtd_program /usr/local/squid/libexec/ssl_crtd -s /var/lib/ssl_db 
>>> -M 4MB sslcrtd_children 8 startup=1 idle=1
>>>
>>> # For squid 3.5.x
>>> #sslcrtd_program /usr/local/squid/libexec/ssl_crtd -s /var/lib/ssl_db 
>>> -M 4MB
>>>
>>> # For squid 4.x
>>> # sslcrtd_program /usr/local/squid/libexec/security_file_certgen -s 
>>> /var/lib/ssl_db -M 4MB
>>>
>>> icap_enable on
>>> icap_send_client_ip on
>>> icap_send_client_username on
>>> icap_client_username_header X-Authenticated-User icap_preview_enable 
>>> on icap_preview_size 1024 icap_service service_avi_req 
>>> reqmod_precache icap://127.0.0.1:1344/request
>>> bypass=1
>>> adaptation_access service_avi_req allow all
>>>
>>> icap_service service_avi_resp respmod_precache 
>>> icap://127.0.0.1:1344/cherokee bypass=0 adaptation_access 
>>> service_avi_resp allow all
>>>
>>> Jeff
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users
>>>
>>>
>> Eliezer,
>>
>> Well, you certainly hit the nail on the head.  I added the following 
>> code to check the content being sent to the icap server from squid, 
>> and here is what I found when I check the headers being sent from the 
>> remote web server:
>>
>> Code to check for content type and encoding received by the icap 
>> server added to c-icap:
>>
>>    hdrs = ci_http_response_headers(req);
>>    content_type = ci_headers_value(hdrs, "Content-Type");
>>    if (content_type)
>>       ci_debug_printf(1,"srv_cherokee:  content-type: %s\n",
>>                       content_type);
>>
>>    content_encoding = ci_headers_value(hdrs, "Content-Encoding");
>>    if (content_encoding)
>>       ci_debug_printf(1,"srv_cherokee:  content-encoding: %s\n",
>>                       content_encoding);
>>
>> And the output from scanned pages sent over from squid:
>>
>> srv_cherokee:  init request 0x7f3dbc008eb0 pool hits:1 allocations: 1 
>> Allocating from objects pool object 5 pool hits:1 allocations: 1 
>> Geting buffer from pool 4096:1 Requested service: cherokee Read 
>> preview data if there are and process request
>> srv_cherokee:  content-type: text/html; charset=utf-8
>> srv_cherokee:  content-encoding: gzip         <-- As you stated, I am
>> getting gzipped data
>> srv_cherokee:  we expect to read :-1 body data Allow 204...
>> Preview handler return allow 204 response
>> srv_cherokee:  release request 0x7f3dbc008eb0 Store buffer to long 
>> pool 4096:1 Storing to objects pool object 5 Log request to access log 
>> file /var/log/i-cap_access.log
>>
>>
>> Wikipedia  at https://en.wikipedia.org/wiki/HTTP_compression describes 
>> the process as:
>>
>> " ...
>>   Compression scheme negotiation[edit]
>>   In most cases, excluding the SDCH, the negotiation is done in two 
>> steps, described in
>>   RFC 2616:
>>
>>   1. The web client advertises which compression schemes it supports 
>> by including a list
>>   of tokens in the HTTP request. For Content-Encoding, the list in a 
>> field called Accept -
>>   Encoding; for Transfer-Encoding, the field is called TE.
>>
>>   GET /encrypted-area HTTP/1.1
>>   Host: www.example.com
>>   Accept-Encoding: gzip, deflate
>>
>>   2. If the server supports one or more compression schemes, the 
>> outgoing data may be
>>   compressed by one or more methods supported by both parties. If this 
>> is the case, the
>>   server will add a Content-Encoding or Transfer-Encoding field in the 
>> HTTP response with
>>   the used schemes, separated by commas.
>>
>>   HTTP/1.1 200 OK
>>   Date: mon, 26 June 2016 22:38:34 GMT
>>   Server: Apache/1.3.3.7 (Unix)  (Red-Hat/Linux)
>>   Last-Modified: Wed, 08 Jan 2003 23:11:55 GMT
>>   Accept-Ranges: bytes
>>   Content-Length: 438
>>   Connection: close
>>   Content-Type: text/html; charset=UTF-8
>>   Content-Encoding: gzip
>>
>>   The web server is by no means obligated to use any compression method -
> this
>>   depends on the internal settings of the web server and also may 
>> depend on the internal
>>   architecture of the website in question.
>>
>>   In case of SDCH a dictionary negotiation is also required, which may 
>> involve additional
>>   steps, like downloading a proper dictionary from .
>> .."
>>
>>
>> So, it looks like it is a feature of the browser.  So, is it possible 
>> to have squid gunzip the data or configure the browser not to send the 
>> header  to remove "Accept-Encoding: gzip, deflate" from the request 
>> sent to the remote server telling it to gzip the data?
>>
>> Thanks
>>
>> Jeff
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 512 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171001/b922d241/attachment.sig>

From hirsch098 at gmail.com  Sun Oct  1 01:44:16 2017
From: hirsch098 at gmail.com (stern0m1)
Date: Sat, 30 Sep 2017 18:44:16 -0700 (MST)
Subject: [squid-users] Content injection
Message-ID: <1506822256791-0.post@n4.nabble.com>

I am looking for a proxy that can inject content easily. Static content to
every HTML document.
Can I do this easily with squid? Is there another proxy that can do this
easily?
Thanks



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From jeffmerkey at gmail.com  Sun Oct  1 03:12:08 2017
From: jeffmerkey at gmail.com (Jeffrey Merkey)
Date: Sat, 30 Sep 2017 21:12:08 -0600
Subject: [squid-users] SSL Bump Failures with Google and Wikipedia
	[SOLVED]
Message-ID: <CA+ekxPUfSwf4mgMwYaEsmR4-vO5jSq4dF+RX7nYujrk9V5BVPw@mail.gmail.com>

On 9/30/17, Rafael Akchurin <rafael.akchurin at diladele.com> wrote:
> Hello Jeff,
>
> Do not forget Google and YouTube are now using brotli encoding extensively,
> not only gzip.
>
> Best regards,
> Rafael Akchurin
>
>> Op 30 sep. 2017 om 23:49 heeft Jeffrey Merkey <jeffmerkey at gmail.com> het
>> volgende geschreven:
>>
>>> On 9/30/17, Eliezer Croitoru <eliezer at ngtech.co.il> wrote:
>>> Hey Jeffrey,
>>>
>>> What happens when you disable the next icap service this way:
>>> icap_service service_avi_resp respmod_precache
>>> icap://127.0.0.1:1344/cherokee bypass=0
>>> adaptation_access service_avi_resp deny all
>>>
>>> Is it still the same?
>>> What I suspect is that the requests are defined to accept gzip
>>> compressed
>>> objects and the icap service is not "gnuzip" them which results in what
>>> you
>>> see.
>>>
>>> To make sure that squid is not at fault here try to disable both icap
>>> services and then add then one at a time and see which of this triangle
>>> is
>>> giving you trouble.
>>> I enhanced an ICAP library which is written in GoLang at:
>>> https://github.com/elico/icap
>>>
>>> And I have couple examples on how to work with http requests and
>>> responses
>>> at:
>>> https://github.com/andybalholm/redwood/
>>> https://github.com/andybalholm/redwood/search?utf8=%E2%9C%93&q=gzip&type=
>>>
>>> Let me know if you need help finding out the issue.
>>>
>>> All The Bests,
>>> Eliezer
>>>
>>> ----
>>> Eliezer Croitoru
>>> Linux System Administrator
>>> Mobile: +972-5-28704261
>>> Email: eliezer at ngtech.co.il
>>>
>>>
>>>
>>> -----Original Message-----
>>> From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On
>>> Behalf Of Jeffrey Merkey
>>> Sent: Saturday, September 30, 2017 23:28
>>> To: squid-users <squid-users at lists.squid-cache.org>
>>> Subject: [squid-users] SSL Bump Failures with Google and Wikipedia
>>>
>>> Hello All,
>>>
>>> I have been working with the squid server and icap and I have been
>>> running into problems with content cached from google and wikipedia.
>>> Some sites using https, such as Centos.org work perfectly with ssl
>>> bumping and I get the decrypted content as html and it's readable.
>>> Other sites, such as google and wikipedia return what looks like
>>> encrypted traffic, or perhaps mime encoded data, I am not sure which.
>>>
>>> Are there cases where squid will default to direct mode and not
>>> decrypt the traffic?  I am using the latest squid server 3.5.27.  I
>>> really would like to get this working with google and wikipedia.  I
>>> reviewed the page source code from the browser viewer and it looks
>>> nothing like the data I am getting via the icap server.
>>>
>>> Any assistance would be greatly appreciated.
>>>
>>> The config I am using is:
>>>
>>> #
>>> # Recommended minimum configuration:
>>> #
>>>
>>> # Example rule allowing access from your local networks.
>>> # Adapt to list your (internal) IP networks from where browsing
>>> # should be allowed
>>>
>>> acl localnet src 127.0.0.1
>>> acl localnet src 10.0.0.0/8     # RFC1918 possible internal network
>>> acl localnet src 172.16.0.0/12  # RFC1918 possible internal network
>>> acl localnet src 192.168.0.0/16 # RFC1918 possible internal network
>>> acl localnet src fc00::/7       # RFC 4193 local private network range
>>> acl localnet src fe80::/10      # RFC 4291 link-local (directly
>>> plugged) machines
>>>
>>> acl SSL_ports port 443
>>> acl Safe_ports port 80          # http
>>> acl Safe_ports port 21          # ftp
>>> acl Safe_ports port 443         # https
>>> acl Safe_ports port 70          # gopher
>>> acl Safe_ports port 210         # wais
>>> acl Safe_ports port 1025-65535  # unregistered ports
>>> acl Safe_ports port 280         # http-mgmt
>>> acl Safe_ports port 488         # gss-http
>>> acl Safe_ports port 591         # filemaker
>>> acl Safe_ports port 777         # multiling http
>>> acl CONNECT method CONNECT
>>>
>>> #
>>> # Recommended minimum Access Permission configuration:
>>> #
>>> # Deny requests to certain unsafe ports
>>> http_access deny !Safe_ports
>>>
>>> # Deny CONNECT to other than secure SSL ports
>>> http_access deny CONNECT !SSL_ports
>>>
>>> # Only allow cachemgr access from localhost
>>> http_access allow localhost manager
>>> http_access deny manager
>>>
>>> # We strongly recommend the following be uncommented to protect innocent
>>> # web applications running on the proxy server who think the only
>>> # one who can access services on "localhost" is a local user
>>> #http_access deny to_localhost
>>>
>>> #
>>> # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
>>> #
>>>
>>> # Example rule allowing access from your local networks.
>>> # Adapt localnet in the ACL section to list your (internal) IP networks
>>> # from where browsing should be allowed
>>> http_access allow localnet
>>> http_access allow localhost
>>>
>>> # And finally deny all other access to this proxy
>>> http_access deny all
>>>
>>> # Squid normally listens to port 3128
>>> #http_port 3128
>>>
>>> # Uncomment and adjust the following to add a disk cache directory.
>>> #cache_dir ufs /usr/local/squid/var/cache/squid 100 16 256
>>>
>>> # Leave coredumps in the first cache dir
>>> coredump_dir /usr/local/squid/var/cache/squid
>>>
>>> #
>>> # Add any of your own refresh_pattern entries above these.
>>> #
>>> refresh_pattern ^ftp:           1440    20%     10080
>>> refresh_pattern ^gopher:        1440    0%      1440
>>> refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
>>> refresh_pattern .               0       20%     4320
>>>
>>> http_port 3128 ssl-bump generate-host-certificates=on
>>> dynamic_cert_mem_cache_size=4MB cert=/etc/squid/ssl_cert/myCA.pem
>>> http_port 3129
>>>
>>> # SSL Bump Config
>>> always_direct allow all
>>> ssl_bump server-first all
>>> sslproxy_cert_error deny all
>>> sslproxy_flags DONT_VERIFY_PEER
>>> sslcrtd_program /usr/local/squid/libexec/ssl_crtd -s /var/lib/ssl_db
>>> -M 4MB sslcrtd_children 8 startup=1 idle=1
>>>
>>> # For squid 3.5.x
>>> #sslcrtd_program /usr/local/squid/libexec/ssl_crtd -s /var/lib/ssl_db -M
>>> 4MB
>>>
>>> # For squid 4.x
>>> # sslcrtd_program /usr/local/squid/libexec/security_file_certgen -s
>>> /var/lib/ssl_db -M 4MB
>>>
>>> icap_enable on
>>> icap_send_client_ip on
>>> icap_send_client_username on
>>> icap_client_username_header X-Authenticated-User
>>> icap_preview_enable on
>>> icap_preview_size 1024
>>> icap_service service_avi_req reqmod_precache
>>> icap://127.0.0.1:1344/request
>>> bypass=1
>>> adaptation_access service_avi_req allow all
>>>
>>> icap_service service_avi_resp respmod_precache
>>> icap://127.0.0.1:1344/cherokee bypass=0
>>> adaptation_access service_avi_resp allow all
>>>
>>> Jeff
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users
>>>
>>>
>>
>> Eliezer,
>>
>> Well, you certainly hit the nail on the head.  I added the following
>> code to check the content being sent to the icap server from squid,
>> and here is what I found when I check the headers being sent from the
>> remote web server:
>>
>> Code to check for content type and encoding received by the icap
>> server added to c-icap:
>>
>>    hdrs = ci_http_response_headers(req);
>>    content_type = ci_headers_value(hdrs, "Content-Type");
>>    if (content_type)
>>       ci_debug_printf(1,"srv_cherokee:  content-type: %s\n",
>>                       content_type);
>>
>>    content_encoding = ci_headers_value(hdrs, "Content-Encoding");
>>    if (content_encoding)
>>       ci_debug_printf(1,"srv_cherokee:  content-encoding: %s\n",
>>                       content_encoding);
>>
>> And the output from scanned pages sent over from squid:
>>
>> srv_cherokee:  init request 0x7f3dbc008eb0
>> pool hits:1 allocations: 1
>> Allocating from objects pool object 5
>> pool hits:1 allocations: 1
>> Geting buffer from pool 4096:1
>> Requested service: cherokee
>> Read preview data if there are and process request
>> srv_cherokee:  content-type: text/html; charset=utf-8
>> srv_cherokee:  content-encoding: gzip         <-- As you stated, I am
>> getting gzipped data
>> srv_cherokee:  we expect to read :-1 body data
>> Allow 204...
>> Preview handler return allow 204 response
>> srv_cherokee:  release request 0x7f3dbc008eb0
>> Store buffer to long pool 4096:1
>> Storing to objects pool object 5
>> Log request to access log file /var/log/i-cap_access.log
>>
>>
>> Wikipedia  at https://en.wikipedia.org/wiki/HTTP_compression describes
>> the process as:
>>
>> " ...
>>   Compression scheme negotiation[edit]
>>   In most cases, excluding the SDCH, the negotiation is done in two
>> steps, described in
>>   RFC 2616:
>>
>>   1. The web client advertises which compression schemes it supports
>> by including a list
>>   of tokens in the HTTP request. For Content-Encoding, the list in a
>> field called Accept -
>>   Encoding; for Transfer-Encoding, the field is called TE.
>>
>>   GET /encrypted-area HTTP/1.1
>>   Host: www.example.com
>>   Accept-Encoding: gzip, deflate
>>
>>   2. If the server supports one or more compression schemes, the
>> outgoing data may be
>>   compressed by one or more methods supported by both parties. If
>> this is the case, the
>>   server will add a Content-Encoding or Transfer-Encoding field in
>> the HTTP response with
>>   the used schemes, separated by commas.
>>
>>   HTTP/1.1 200 OK
>>   Date: mon, 26 June 2016 22:38:34 GMT
>>   Server: Apache/1.3.3.7 (Unix)  (Red-Hat/Linux)
>>   Last-Modified: Wed, 08 Jan 2003 23:11:55 GMT
>>   Accept-Ranges: bytes
>>   Content-Length: 438
>>   Connection: close
>>   Content-Type: text/html; charset=UTF-8
>>   Content-Encoding: gzip
>>
>>   The web server is by no means obligated to use any compression method ?
>> this
>>   depends on the internal settings of the web server and also may
>> depend on the internal
>>   architecture of the website in question.
>>
>>   In case of SDCH a dictionary negotiation is also required, which
>> may involve additional
>>   steps, like downloading a proper dictionary from .
>> .."
>>
>>
>> So, it looks like it is a feature of the browser.  So, is it possible
>> to have squid gunzip the data or configure the browser not to send the
>> header  to remove "Accept-Encoding: gzip, deflate" from the request
>> sent to the remote server telling it to gzip the data?
>>
>> Thanks
>>
>> Jeff
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>

Well,

After reviewing this problem and all of the great technical
information folks provided, I have it working and I figured out the
best way to deal with this transparently allowing squid to remotely
spoof the server side with modified request headers.

Compile squid with the flags:

--enable-http-violation

then add the following to the squid.conf file:

# disable remote html data compression by replacing HTTP request headers
# requires squid build option --enable-http-violations
request_header_access Accept-Encoding deny all
request_header_replace Accept-Encoding *;q=0

Then tell squid to strip all Accept-Encoding request headers and
substitute the string " *;q=0 " which tells the server not to send any
compressed data.  I tested this with chrome which was configured to
always send Acccept-Encoding:gzip,deflate and all of the C-ICAP data I
am seeing is plain text html, which is what I wanted.

So adding those two header instructions transparently spoofs the
remote server into always sending uncompressed data.  I did note that
google has some nonsense going on with chrome (mozilla does not do
this) so that even if chrome request headers have been spoofed by
squid specifying no gzip or deflate, the google servers will still
send a content-encoding:gzip response header on any responses which do
not contain any data (???), which is clearly a bug of some sort on
HTTP responses .

The browser treats the data as plain text and works correctly, even
though it gets a content-encoding:gzip header.  It only seems to do
this on HTTP header only payload request/responses which have no body
text.   Responses which actually contain body data are missing the
content-encoding header, which is what I wanted to see happen.

So to summarize, the above changes will enable squid to filter and
spoof Accept-Encoding: HTTP requests to tell the server to always send
uncompressed data, and from my testing it works transparently on
Chrome and Mozilla, with C-ICAP getting the uncompressed, unencrypted
data it needs.

Jeff


From rousskov at measurement-factory.com  Sun Oct  1 03:12:43 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Sat, 30 Sep 2017 21:12:43 -0600
Subject: [squid-users] Content injection
In-Reply-To: <1506822256791-0.post@n4.nabble.com>
References: <1506822256791-0.post@n4.nabble.com>
Message-ID: <1a3aff96-5469-92b8-ca83-4d6d994ce44c@measurement-factory.com>

On 09/30/2017 07:44 PM, stern0m1 wrote:

> I am looking for a proxy that can inject content easily. Static content to
> every HTML document.
> Can I do this easily with squid? 

You can inject some "HTML documents" using Squid combined with an eCAP
or ICAP content adaptation service, but it is not going to be easy, and
you cannot inject documents delivered over secure connections to web
clients that pin origin server certificates. For more information, see

  * http://wiki.squid-cache.org/SquidFaq/ContentAdaptation
  * https://answers.launchpad.net/ecap/+faq/1793

Alex.


From squid3 at treenet.co.nz  Sun Oct  1 03:44:01 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 1 Oct 2017 16:44:01 +1300
Subject: [squid-users] Make all IPv6 ips on system to be used as a proxy
In-Reply-To: <!&!AAAAAAAAAAAuAAAAAAAAAGDVRrtF13VDjYYZR9MgvgYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAACs9EXxHh6PRok3B4eK0ibsAQAAAAA=@ngtech.co.il>
References: <CAFoK1azxn=vp7g_uwcXDrWVp-PoUFqMcC7oiAtXOkv-ge=M0jg@mail.gmail.com>
 <!&!AAAAAAAAAAAuAAAAAAAAAGDVRrtF13VDjYYZR9MgvgYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAACs9EXxHh6PRok3B4eK0ibsAQAAAAA=@ngtech.co.il>
Message-ID: <740a312b-ba70-b457-297f-85301a65e1d9@treenet.co.nz>

On 01/10/17 10:21, Eliezer Croitoru wrote:
> Anyone mentioned tproxy?
> It works for me...
> 

It serves if none wants the same IP on both incoming and outgoing 
traffic. But the question was only for determining static IPs on 
outgoing based on Squids listening *ports*, ignoring client IP - more 
like a NAT attempt than transparent proxy.

Amos


From squid3 at treenet.co.nz  Sun Oct  1 04:15:58 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 1 Oct 2017 17:15:58 +1300
Subject: [squid-users] Content injection
In-Reply-To: <1a3aff96-5469-92b8-ca83-4d6d994ce44c@measurement-factory.com>
References: <1506822256791-0.post@n4.nabble.com>
 <1a3aff96-5469-92b8-ca83-4d6d994ce44c@measurement-factory.com>
Message-ID: <233f0a6c-7465-6b74-3b9c-c75e695120e5@treenet.co.nz>

On 01/10/17 16:12, Alex Rousskov wrote:
> On 09/30/2017 07:44 PM, stern0m1 wrote:
> 
>> I am looking for a proxy that can inject content easily. Static content to
>> every HTML document.
>> Can I do this easily with squid?
> 
> You can inject some "HTML documents" using Squid combined with an eCAP
> or ICAP content adaptation service, but it is not going to be easy, and
> you cannot inject documents delivered over secure connections to web
> clients that pin origin server certificates. For more information, see
> 
>    * http://wiki.squid-cache.org/SquidFaq/ContentAdaptation
>    * https://answers.launchpad.net/ecap/+faq/1793
> 
> Alex.

For the record:

Please be aware that HTTP documents are protected by international 
copyright laws. Altering other peoples content is illegal in all 
countries signatory to the Berne Convention and many other countries 
individual copyright laws as well.

HTTP forms an informal contract for redistribute and copy permission, 
not for alteration or derivative work permissions. Unless you have 
written consent from the HTML document creators explicitly giving 
permission to alter the substance of their content it is legally 
considered "copyright piracy" or whatever the local laws wording is.

Actions like [un]compression of the content do not change its bytes, so 
are okay. But adding or removing bits from the HTML text is using their 
content to generate a derivative work - for which permission is NOT 
granted implicitly.


The legally safe way to inject notices to clients into traffic is to use 
splash page mechanisms. Where the client periodically gets delivered a 
511 status code with your message on a page you created instead of the 
item they requested. You just need to make sure to detect points in the 
trafffic which actually reach users eyeballs, and a way for them to 
continue on to get what they wanted earlier. Quite a lot of HTTP traffic 
(~80% IIRC) is software<->software and never reaches any user eyeballs.

You can modify the splash page approach by having your page use an 
iframe to embed the original requestors response. Publishers can 
explicitly indicate whether they grant permission for that to be done 
(eg opt-out).

Amos


From jeffmerkey at gmail.com  Sun Oct  1 04:26:01 2017
From: jeffmerkey at gmail.com (Jeffrey Merkey)
Date: Sat, 30 Sep 2017 22:26:01 -0600
Subject: [squid-users] Content injection
In-Reply-To: <233f0a6c-7465-6b74-3b9c-c75e695120e5@treenet.co.nz>
References: <1506822256791-0.post@n4.nabble.com>
 <1a3aff96-5469-92b8-ca83-4d6d994ce44c@measurement-factory.com>
 <233f0a6c-7465-6b74-3b9c-c75e695120e5@treenet.co.nz>
Message-ID: <CA+ekxPVR9dU3SJ3k0hX1sMTUr7SkDeSTQbxcUQWRCfa4uLO1nA@mail.gmail.com>

On 9/30/17, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> On 01/10/17 16:12, Alex Rousskov wrote:
>> On 09/30/2017 07:44 PM, stern0m1 wrote:
>>
>>> I am looking for a proxy that can inject content easily. Static content
>>> to
>>> every HTML document.
>>> Can I do this easily with squid?
>>
>> You can inject some "HTML documents" using Squid combined with an eCAP
>> or ICAP content adaptation service, but it is not going to be easy, and
>> you cannot inject documents delivered over secure connections to web
>> clients that pin origin server certificates. For more information, see
>>
>>    * http://wiki.squid-cache.org/SquidFaq/ContentAdaptation
>>    * https://answers.launchpad.net/ecap/+faq/1793
>>
>> Alex.
>
> For the record:
>
> Please be aware that HTTP documents are protected by international
> copyright laws. Altering other peoples content is illegal in all
> countries signatory to the Berne Convention and many other countries
> individual copyright laws as well.
>
> HTTP forms an informal contract for redistribute and copy permission,
> not for alteration or derivative work permissions. Unless you have
> written consent from the HTML document creators explicitly giving
> permission to alter the substance of their content it is legally
> considered "copyright piracy" or whatever the local laws wording is.
>
> Actions like [un]compression of the content do not change its bytes, so
> are okay. But adding or removing bits from the HTML text is using their
> content to generate a derivative work - for which permission is NOT
> granted implicitly.
>
>
> The legally safe way to inject notices to clients into traffic is to use
> splash page mechanisms. Where the client periodically gets delivered a
> 511 status code with your message on a page you created instead of the
> item they requested. You just need to make sure to detect points in the
> trafffic which actually reach users eyeballs, and a way for them to
> continue on to get what they wanted earlier. Quite a lot of HTTP traffic
> (~80% IIRC) is software<->software and never reaches any user eyeballs.
>
> You can modify the splash page approach by having your page use an
> iframe to embed the original requestors response. Publishers can
> explicitly indicate whether they grant permission for that to be done
> (eg opt-out).
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>

Amos,

Does this apply to folks who are providing a translation service via
eCap or C-ICAP?  Google provides web page translation so how does this
affect folks who are using squid and C-ICAP for translating content
between different languages?

Jeff


From eliezer at ngtech.co.il  Sun Oct  1 05:03:45 2017
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Sun, 1 Oct 2017 08:03:45 +0300
Subject: [squid-users] Make all IPv6 ips on system to be used as a proxy
In-Reply-To: <740a312b-ba70-b457-297f-85301a65e1d9@treenet.co.nz>
References: <CAFoK1azxn=vp7g_uwcXDrWVp-PoUFqMcC7oiAtXOkv-ge=M0jg@mail.gmail.com>
 <!&!AAAAAAAAAAAuAAAAAAAAAGDVRrtF13VDjYYZR9MgvgYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAACs9EXxHh6PRok3B4eK0ibsAQAAAAA=@ngtech.co.il>
 <740a312b-ba70-b457-297f-85301a65e1d9@treenet.co.nz>
Message-ID: <025d01d33a72$a8e159e0$faa40da0$@ngtech.co.il>

Then he doesn't need Squid but a customized proxy for ipv6 and ipv4..
Right?

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il



-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Amos Jeffries
Sent: Sunday, October 1, 2017 06:44
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Make all IPv6 ips on system to be used as a proxy

On 01/10/17 10:21, Eliezer Croitoru wrote:
> Anyone mentioned tproxy?
> It works for me...
> 

It serves if none wants the same IP on both incoming and outgoing 
traffic. But the question was only for determining static IPs on 
outgoing based on Squids listening *ports*, ignoring client IP - more 
like a NAT attempt than transparent proxy.

Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From jeffmerkey at gmail.com  Sun Oct  1 05:14:51 2017
From: jeffmerkey at gmail.com (Jeffrey Merkey)
Date: Sat, 30 Sep 2017 23:14:51 -0600
Subject: [squid-users] SSL Bump Failures with Google and Wikipedia
	[SOLVED]
In-Reply-To: <CA+ekxPUfSwf4mgMwYaEsmR4-vO5jSq4dF+RX7nYujrk9V5BVPw@mail.gmail.com>
References: <CA+ekxPUfSwf4mgMwYaEsmR4-vO5jSq4dF+RX7nYujrk9V5BVPw@mail.gmail.com>
Message-ID: <CA+ekxPVZwQXvOQEf2n+6vDHcYTOUXNMcSJoCUhyu=B7dSsBgAw@mail.gmail.com>

On 9/30/17, Jeffrey Merkey <jeffmerkey at gmail.com> wrote:
> On 9/30/17, Rafael Akchurin <rafael.akchurin at diladele.com> wrote:
>> Hello Jeff,
>>
>> Do not forget Google and YouTube are now using brotli encoding
>> extensively,
>> not only gzip.
>>
>> Best regards,
>> Rafael Akchurin
>>
>>> Op 30 sep. 2017 om 23:49 heeft Jeffrey Merkey <jeffmerkey at gmail.com> het
>>> volgende geschreven:
>>>
>>>> On 9/30/17, Eliezer Croitoru <eliezer at ngtech.co.il> wrote:
>>>> Hey Jeffrey,
>>>>
>>>> What happens when you disable the next icap service this way:
>>>> icap_service service_avi_resp respmod_precache
>>>> icap://127.0.0.1:1344/cherokee bypass=0
>>>> adaptation_access service_avi_resp deny all
>>>>
>>>> Is it still the same?
>>>> What I suspect is that the requests are defined to accept gzip
>>>> compressed
>>>> objects and the icap service is not "gnuzip" them which results in what
>>>> you
>>>> see.
>>>>
>>>> To make sure that squid is not at fault here try to disable both icap
>>>> services and then add then one at a time and see which of this triangle
>>>> is
>>>> giving you trouble.
>>>> I enhanced an ICAP library which is written in GoLang at:
>>>> https://github.com/elico/icap
>>>>
>>>> And I have couple examples on how to work with http requests and
>>>> responses
>>>> at:
>>>> https://github.com/andybalholm/redwood/
>>>> https://github.com/andybalholm/redwood/search?utf8=%E2%9C%93&q=gzip&type=
>>>>
>>>> Let me know if you need help finding out the issue.
>>>>
>>>> All The Bests,
>>>> Eliezer
>>>>
>>>> ----
>>>> Eliezer Croitoru
>>>> Linux System Administrator
>>>> Mobile: +972-5-28704261
>>>> Email: eliezer at ngtech.co.il
>>>>
>>>>
>>>>
>>>> -----Original Message-----
>>>> From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On
>>>> Behalf Of Jeffrey Merkey
>>>> Sent: Saturday, September 30, 2017 23:28
>>>> To: squid-users <squid-users at lists.squid-cache.org>
>>>> Subject: [squid-users] SSL Bump Failures with Google and Wikipedia
>>>>
>>>> Hello All,
>>>>
>>>> I have been working with the squid server and icap and I have been
>>>> running into problems with content cached from google and wikipedia.
>>>> Some sites using https, such as Centos.org work perfectly with ssl
>>>> bumping and I get the decrypted content as html and it's readable.
>>>> Other sites, such as google and wikipedia return what looks like
>>>> encrypted traffic, or perhaps mime encoded data, I am not sure which.
>>>>
>>>> Are there cases where squid will default to direct mode and not
>>>> decrypt the traffic?  I am using the latest squid server 3.5.27.  I
>>>> really would like to get this working with google and wikipedia.  I
>>>> reviewed the page source code from the browser viewer and it looks
>>>> nothing like the data I am getting via the icap server.
>>>>
>>>> Any assistance would be greatly appreciated.
>>>>
>>>> The config I am using is:
>>>>
>>>> #
>>>> # Recommended minimum configuration:
>>>> #
>>>>
>>>> # Example rule allowing access from your local networks.
>>>> # Adapt to list your (internal) IP networks from where browsing
>>>> # should be allowed
>>>>
>>>> acl localnet src 127.0.0.1
>>>> acl localnet src 10.0.0.0/8     # RFC1918 possible internal network
>>>> acl localnet src 172.16.0.0/12  # RFC1918 possible internal network
>>>> acl localnet src 192.168.0.0/16 # RFC1918 possible internal network
>>>> acl localnet src fc00::/7       # RFC 4193 local private network range
>>>> acl localnet src fe80::/10      # RFC 4291 link-local (directly
>>>> plugged) machines
>>>>
>>>> acl SSL_ports port 443
>>>> acl Safe_ports port 80          # http
>>>> acl Safe_ports port 21          # ftp
>>>> acl Safe_ports port 443         # https
>>>> acl Safe_ports port 70          # gopher
>>>> acl Safe_ports port 210         # wais
>>>> acl Safe_ports port 1025-65535  # unregistered ports
>>>> acl Safe_ports port 280         # http-mgmt
>>>> acl Safe_ports port 488         # gss-http
>>>> acl Safe_ports port 591         # filemaker
>>>> acl Safe_ports port 777         # multiling http
>>>> acl CONNECT method CONNECT
>>>>
>>>> #
>>>> # Recommended minimum Access Permission configuration:
>>>> #
>>>> # Deny requests to certain unsafe ports
>>>> http_access deny !Safe_ports
>>>>
>>>> # Deny CONNECT to other than secure SSL ports
>>>> http_access deny CONNECT !SSL_ports
>>>>
>>>> # Only allow cachemgr access from localhost
>>>> http_access allow localhost manager
>>>> http_access deny manager
>>>>
>>>> # We strongly recommend the following be uncommented to protect
>>>> innocent
>>>> # web applications running on the proxy server who think the only
>>>> # one who can access services on "localhost" is a local user
>>>> #http_access deny to_localhost
>>>>
>>>> #
>>>> # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
>>>> #
>>>>
>>>> # Example rule allowing access from your local networks.
>>>> # Adapt localnet in the ACL section to list your (internal) IP networks
>>>> # from where browsing should be allowed
>>>> http_access allow localnet
>>>> http_access allow localhost
>>>>
>>>> # And finally deny all other access to this proxy
>>>> http_access deny all
>>>>
>>>> # Squid normally listens to port 3128
>>>> #http_port 3128
>>>>
>>>> # Uncomment and adjust the following to add a disk cache directory.
>>>> #cache_dir ufs /usr/local/squid/var/cache/squid 100 16 256
>>>>
>>>> # Leave coredumps in the first cache dir
>>>> coredump_dir /usr/local/squid/var/cache/squid
>>>>
>>>> #
>>>> # Add any of your own refresh_pattern entries above these.
>>>> #
>>>> refresh_pattern ^ftp:           1440    20%     10080
>>>> refresh_pattern ^gopher:        1440    0%      1440
>>>> refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
>>>> refresh_pattern .               0       20%     4320
>>>>
>>>> http_port 3128 ssl-bump generate-host-certificates=on
>>>> dynamic_cert_mem_cache_size=4MB cert=/etc/squid/ssl_cert/myCA.pem
>>>> http_port 3129
>>>>
>>>> # SSL Bump Config
>>>> always_direct allow all
>>>> ssl_bump server-first all
>>>> sslproxy_cert_error deny all
>>>> sslproxy_flags DONT_VERIFY_PEER
>>>> sslcrtd_program /usr/local/squid/libexec/ssl_crtd -s /var/lib/ssl_db
>>>> -M 4MB sslcrtd_children 8 startup=1 idle=1
>>>>
>>>> # For squid 3.5.x
>>>> #sslcrtd_program /usr/local/squid/libexec/ssl_crtd -s /var/lib/ssl_db
>>>> -M
>>>> 4MB
>>>>
>>>> # For squid 4.x
>>>> # sslcrtd_program /usr/local/squid/libexec/security_file_certgen -s
>>>> /var/lib/ssl_db -M 4MB
>>>>
>>>> icap_enable on
>>>> icap_send_client_ip on
>>>> icap_send_client_username on
>>>> icap_client_username_header X-Authenticated-User
>>>> icap_preview_enable on
>>>> icap_preview_size 1024
>>>> icap_service service_avi_req reqmod_precache
>>>> icap://127.0.0.1:1344/request
>>>> bypass=1
>>>> adaptation_access service_avi_req allow all
>>>>
>>>> icap_service service_avi_resp respmod_precache
>>>> icap://127.0.0.1:1344/cherokee bypass=0
>>>> adaptation_access service_avi_resp allow all
>>>>
>>>> Jeff
>>>> _______________________________________________
>>>> squid-users mailing list
>>>> squid-users at lists.squid-cache.org
>>>> http://lists.squid-cache.org/listinfo/squid-users
>>>>
>>>>
>>>
>>> Eliezer,
>>>
>>> Well, you certainly hit the nail on the head.  I added the following
>>> code to check the content being sent to the icap server from squid,
>>> and here is what I found when I check the headers being sent from the
>>> remote web server:
>>>
>>> Code to check for content type and encoding received by the icap
>>> server added to c-icap:
>>>
>>>    hdrs = ci_http_response_headers(req);
>>>    content_type = ci_headers_value(hdrs, "Content-Type");
>>>    if (content_type)
>>>       ci_debug_printf(1,"srv_cherokee:  content-type: %s\n",
>>>                       content_type);
>>>
>>>    content_encoding = ci_headers_value(hdrs, "Content-Encoding");
>>>    if (content_encoding)
>>>       ci_debug_printf(1,"srv_cherokee:  content-encoding: %s\n",
>>>                       content_encoding);
>>>
>>> And the output from scanned pages sent over from squid:
>>>
>>> srv_cherokee:  init request 0x7f3dbc008eb0
>>> pool hits:1 allocations: 1
>>> Allocating from objects pool object 5
>>> pool hits:1 allocations: 1
>>> Geting buffer from pool 4096:1
>>> Requested service: cherokee
>>> Read preview data if there are and process request
>>> srv_cherokee:  content-type: text/html; charset=utf-8
>>> srv_cherokee:  content-encoding: gzip         <-- As you stated, I am
>>> getting gzipped data
>>> srv_cherokee:  we expect to read :-1 body data
>>> Allow 204...
>>> Preview handler return allow 204 response
>>> srv_cherokee:  release request 0x7f3dbc008eb0
>>> Store buffer to long pool 4096:1
>>> Storing to objects pool object 5
>>> Log request to access log file /var/log/i-cap_access.log
>>>
>>>
>>> Wikipedia  at https://en.wikipedia.org/wiki/HTTP_compression describes
>>> the process as:
>>>
>>> " ...
>>>   Compression scheme negotiation[edit]
>>>   In most cases, excluding the SDCH, the negotiation is done in two
>>> steps, described in
>>>   RFC 2616:
>>>
>>>   1. The web client advertises which compression schemes it supports
>>> by including a list
>>>   of tokens in the HTTP request. For Content-Encoding, the list in a
>>> field called Accept -
>>>   Encoding; for Transfer-Encoding, the field is called TE.
>>>
>>>   GET /encrypted-area HTTP/1.1
>>>   Host: www.example.com
>>>   Accept-Encoding: gzip, deflate
>>>
>>>   2. If the server supports one or more compression schemes, the
>>> outgoing data may be
>>>   compressed by one or more methods supported by both parties. If
>>> this is the case, the
>>>   server will add a Content-Encoding or Transfer-Encoding field in
>>> the HTTP response with
>>>   the used schemes, separated by commas.
>>>
>>>   HTTP/1.1 200 OK
>>>   Date: mon, 26 June 2016 22:38:34 GMT
>>>   Server: Apache/1.3.3.7 (Unix)  (Red-Hat/Linux)
>>>   Last-Modified: Wed, 08 Jan 2003 23:11:55 GMT
>>>   Accept-Ranges: bytes
>>>   Content-Length: 438
>>>   Connection: close
>>>   Content-Type: text/html; charset=UTF-8
>>>   Content-Encoding: gzip
>>>
>>>   The web server is by no means obligated to use any compression method
>>> ?
>>> this
>>>   depends on the internal settings of the web server and also may
>>> depend on the internal
>>>   architecture of the website in question.
>>>
>>>   In case of SDCH a dictionary negotiation is also required, which
>>> may involve additional
>>>   steps, like downloading a proper dictionary from .
>>> .."
>>>
>>>
>>> So, it looks like it is a feature of the browser.  So, is it possible
>>> to have squid gunzip the data or configure the browser not to send the
>>> header  to remove "Accept-Encoding: gzip, deflate" from the request
>>> sent to the remote server telling it to gzip the data?
>>>
>>> Thanks
>>>
>>> Jeff
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users
>>
>
> Well,
>
> After reviewing this problem and all of the great technical
> information folks provided, I have it working and I figured out the
> best way to deal with this transparently allowing squid to remotely
> spoof the server side with modified request headers.
>
> Compile squid with the flags:
>
> --enable-http-violation
>
> then add the following to the squid.conf file:
>
> # disable remote html data compression by replacing HTTP request headers
> # requires squid build option --enable-http-violations
> request_header_access Accept-Encoding deny all
> request_header_replace Accept-Encoding *;q=0
>
> Then tell squid to strip all Accept-Encoding request headers and
> substitute the string " *;q=0 " which tells the server not to send any
> compressed data.  I tested this with chrome which was configured to
> always send Acccept-Encoding:gzip,deflate and all of the C-ICAP data I
> am seeing is plain text html, which is what I wanted.
>
> So adding those two header instructions transparently spoofs the
> remote server into always sending uncompressed data.  I did note that
> google has some nonsense going on with chrome (mozilla does not do
> this) so that even if chrome request headers have been spoofed by
> squid specifying no gzip or deflate, the google servers will still
> send a content-encoding:gzip response header on any responses which do
> not contain any data (???), which is clearly a bug of some sort on
> HTTP responses .
>
> The browser treats the data as plain text and works correctly, even
> though it gets a content-encoding:gzip header.  It only seems to do
> this on HTTP header only payload request/responses which have no body
> text.   Responses which actually contain body data are missing the
> content-encoding header, which is what I wanted to see happen.
>
> So to summarize, the above changes will enable squid to filter and
> spoof Accept-Encoding: HTTP requests to tell the server to always send
> uncompressed data, and from my testing it works transparently on
> Chrome and Mozilla, with C-ICAP getting the uncompressed, unencrypted
> data it needs.
>
> Jeff
>

One caveat about this I discovered that there are quite a few websites
which completely ignore the Accept-Encoding request header and just go
ahead and send gzip html data even when you tell it not to.  Oh well,
back to the drawing board.

Jeff


From Antony.Stone at squid.open.source.it  Sun Oct  1 08:42:28 2017
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Sun, 1 Oct 2017 10:42:28 +0200
Subject: [squid-users] Content injection
In-Reply-To: <CA+ekxPVR9dU3SJ3k0hX1sMTUr7SkDeSTQbxcUQWRCfa4uLO1nA@mail.gmail.com>
References: <1506822256791-0.post@n4.nabble.com>
 <233f0a6c-7465-6b74-3b9c-c75e695120e5@treenet.co.nz>
 <CA+ekxPVR9dU3SJ3k0hX1sMTUr7SkDeSTQbxcUQWRCfa4uLO1nA@mail.gmail.com>
Message-ID: <201710011042.28434.Antony.Stone@squid.open.source.it>

On Sunday 01 October 2017 at 06:26:01, Jeffrey Merkey wrote:

> On 9/30/17, Amos Jeffries wrote:
> > 
> > For the record:
> > 
> > Please be aware that HTTP documents are protected by international
> > copyright laws. Altering other peoples content is illegal in all
> > countries signatory to the Berne Convention and many other countries
> > individual copyright laws as well.

> Amos,
> 
> Does this apply to folks who are providing a translation service via
> eCap or C-ICAP?  Google provides web page translation so how does this
> affect folks who are using squid and C-ICAP for translating content
> between different languages?
> 
> Jeff

Also, how do ad-blockers, greasemonkey and similar client-side content 
manipulation systems get away with their actions, then?

I doubt there's any legal difference whether the alteration of copyright work 
is done by some middleman, or by software running on the recipient's computer, 
so why are these things acceptable to the copyright owners?


Antony.

-- 
It is also possible that putting the birds in a laboratory setting 
inadvertently renders them relatively incompetent.

 - Daniel C Dennett

                                                   Please reply to the list;
                                                         please *don't* CC me.


From squid3 at treenet.co.nz  Sun Oct  1 10:02:29 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 1 Oct 2017 23:02:29 +1300
Subject: [squid-users] Content injection
In-Reply-To: <201710011042.28434.Antony.Stone@squid.open.source.it>
References: <1506822256791-0.post@n4.nabble.com>
 <233f0a6c-7465-6b74-3b9c-c75e695120e5@treenet.co.nz>
 <CA+ekxPVR9dU3SJ3k0hX1sMTUr7SkDeSTQbxcUQWRCfa4uLO1nA@mail.gmail.com>
 <201710011042.28434.Antony.Stone@squid.open.source.it>
Message-ID: <1b3662d6-8902-7688-3b6d-dab4bd7024d9@treenet.co.nz>

On 01/10/17 21:42, Antony Stone wrote:
> On Sunday 01 October 2017 at 06:26:01, Jeffrey Merkey wrote:
> 
>> On 9/30/17, Amos Jeffries wrote:
>>>
>>> For the record:
>>>
>>> Please be aware that HTTP documents are protected by international
>>> copyright laws. Altering other peoples content is illegal in all
>>> countries signatory to the Berne Convention and many other countries
>>> individual copyright laws as well.
> 
>> Amos,
>>
>> Does this apply to folks who are providing a translation service via
>> eCap or C-ICAP?  Google provides web page translation so how does this
>> affect folks who are using squid and C-ICAP for translating content
>> between different languages?
>>
>> Jeff

Those ones are treading a fine legal line AIUI. Note that using Googles' 
translation service TOC forbids use by software other than en-users 
browsers.


> 
> Also, how do ad-blockers, greasemonkey and similar client-side content
> manipulation systems get away with their actions, then?
> 

The client applications you mention are not publishing the content for 
other clients to view. Whereas middleware is publishing the content 
online for multiple clients to view.



> I doubt there's any legal difference whether the alteration of copyright work
> is done by some middleman, or by software running on the recipient's computer,
> so why are these things acceptable to the copyright owners?
> 

I don't think I've ever said anything was acceptible or otherwise to 
publishers. Just that the proxy middle ware modifying content is a legal 
issue.

NP: If you want to know the specifics of how the laws apply to these 
use-cases please consult a lawyer. I'm only familiar with this one case 
of injecting advertising into others HTML Pages that keeps coming up 
over, and over again.

Amos


From squid-user at tlinx.org  Sun Oct  1 23:46:05 2017
From: squid-user at tlinx.org (L A Walsh)
Date: Sun, 01 Oct 2017 16:46:05 -0700
Subject: [squid-users] SSL Bump Failures with Google and
	Wikipedia	[SOLVED]
In-Reply-To: <CA+ekxPVZwQXvOQEf2n+6vDHcYTOUXNMcSJoCUhyu=B7dSsBgAw@mail.gmail.com>
References: <CA+ekxPUfSwf4mgMwYaEsmR4-vO5jSq4dF+RX7nYujrk9V5BVPw@mail.gmail.com>
 <CA+ekxPVZwQXvOQEf2n+6vDHcYTOUXNMcSJoCUhyu=B7dSsBgAw@mail.gmail.com>
Message-ID: <59D17E3D.9010502@tlinx.org>

Jeffrey Merkey wrote:
>
> One caveat about this I discovered that there are quite a few websites
> which completely ignore the Accept-Encoding request header and just go
> ahead and send gzip html data even when you tell it not to.  Oh well,
> back to the drawing board.
>   
---
    But didn't your bump problems only happen on google and wikipedia?
If your solution works there...isn't that all that is needed?

    BTW, I'm responding, as I'm going to try your fix with a similar problem
I'm seeing in Opera.  Opera complains about the (bumped) security on 
google --
not sure about wikipedia -- but tween FF and Opera, only Opera complained --
but it said both certs were ok (one from my local sys and one from google).

    Was a bit weird -- but I was involved in something else so didn't 
persue
it.  Now am wondering if it is the same or a similar issue.

-linda

>   


From yvoinov at gmail.com  Mon Oct  2 02:17:25 2017
From: yvoinov at gmail.com (Yuri)
Date: Mon, 2 Oct 2017 08:17:25 +0600
Subject: [squid-users] SSL Bump Failures with Google and Wikipedia
 [SOLVED]
In-Reply-To: <59D17E3D.9010502@tlinx.org>
References: <CA+ekxPUfSwf4mgMwYaEsmR4-vO5jSq4dF+RX7nYujrk9V5BVPw@mail.gmail.com>
 <CA+ekxPVZwQXvOQEf2n+6vDHcYTOUXNMcSJoCUhyu=B7dSsBgAw@mail.gmail.com>
 <59D17E3D.9010502@tlinx.org>
Message-ID: <3b4227fa-878b-2bb8-0f15-d220c5ca168a@gmail.com>

Opera, AFAIK, now abandoned and can contain obsolete CA bundle (not sure
it uses system CA storage).

So, it seems this is quite different issue.


02.10.2017 5:46, L A Walsh ?????:
> Jeffrey Merkey wrote:
>>
>> One caveat about this I discovered that there are quite a few websites
>> which completely ignore the Accept-Encoding request header and just go
>> ahead and send gzip html data even when you tell it not to.? Oh well,
>> back to the drawing board.
>> ? 
> ---
> ?? But didn't your bump problems only happen on google and wikipedia?
> If your solution works there...isn't that all that is needed?
>
> ?? BTW, I'm responding, as I'm going to try your fix with a similar
> problem
> I'm seeing in Opera.? Opera complains about the (bumped) security on
> google --
> not sure about wikipedia -- but tween FF and Opera, only Opera
> complained --
> but it said both certs were ok (one from my local sys and one from
> google).
>
> ?? Was a bit weird -- but I was involved in something else so didn't
> persue
> it.? Now am wondering if it is the same or a similar issue.
>
> -linda
>
>> ? 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171002/2606f0dd/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171002/2606f0dd/attachment.sig>

From squid3 at treenet.co.nz  Mon Oct  2 02:47:11 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 2 Oct 2017 15:47:11 +1300
Subject: [squid-users] Content injection
In-Reply-To: <C67D0F69C7AFDC75.bf5dfd84-22ea-46e6-92ee-d9e0e2d6bdfb@mail.outlook.com>
References: <1506822256791-0.post@n4.nabble.com>
 <233f0a6c-7465-6b74-3b9c-c75e695120e5@treenet.co.nz>
 <CA+ekxPVR9dU3SJ3k0hX1sMTUr7SkDeSTQbxcUQWRCfa4uLO1nA@mail.gmail.com>
 <201710011042.28434.Antony.Stone@squid.open.source.it>
 <1b3662d6-8902-7688-3b6d-dab4bd7024d9@treenet.co.nz>
 <C67D0F69C7AFDC75.bf5dfd84-22ea-46e6-92ee-d9e0e2d6bdfb@mail.outlook.com>
Message-ID: <6b8bb239-4e07-6ad7-67c8-400371a2695c@treenet.co.nz>

On 02/10/17 02:33, B Hirsch wrote:
> Any legal references someone could point to?
 >

<http://www.wipo.int/treaties/en/text.jsp?file_id=283698>

"HTML" can contain almost any type of work, so it is hard to know in 
advance exactly which of the clauses or exemptions apply.

Amos


From yvoinov at gmail.com  Mon Oct  2 02:49:23 2017
From: yvoinov at gmail.com (Yuri)
Date: Mon, 2 Oct 2017 08:49:23 +0600
Subject: [squid-users] Content injection
In-Reply-To: <6b8bb239-4e07-6ad7-67c8-400371a2695c@treenet.co.nz>
References: <1506822256791-0.post@n4.nabble.com>
 <233f0a6c-7465-6b74-3b9c-c75e695120e5@treenet.co.nz>
 <CA+ekxPVR9dU3SJ3k0hX1sMTUr7SkDeSTQbxcUQWRCfa4uLO1nA@mail.gmail.com>
 <201710011042.28434.Antony.Stone@squid.open.source.it>
 <1b3662d6-8902-7688-3b6d-dab4bd7024d9@treenet.co.nz>
 <C67D0F69C7AFDC75.bf5dfd84-22ea-46e6-92ee-d9e0e2d6bdfb@mail.outlook.com>
 <6b8bb239-4e07-6ad7-67c8-400371a2695c@treenet.co.nz>
Message-ID: <c877ec80-c379-5831-6a72-614a96e9d720@gmail.com>

Hm, Amos. But 1986 - it is ancient in 2017, yes? Over 20 years.....
Ethernity in IT.


02.10.2017 8:47, Amos Jeffries ?????:
> On 02/10/17 02:33, B Hirsch wrote:
>> Any legal references someone could point to?
> >
>
> <http://www.wipo.int/treaties/en/text.jsp?file_id=283698>
>
> "HTML" can contain almost any type of work, so it is hard to know in
> advance exactly which of the clauses or exemptions apply.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171002/3838fa15/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171002/3838fa15/attachment.sig>

From yvoinov at gmail.com  Mon Oct  2 02:51:28 2017
From: yvoinov at gmail.com (Yuri)
Date: Mon, 2 Oct 2017 08:51:28 +0600
Subject: [squid-users] Content injection
In-Reply-To: <6b8bb239-4e07-6ad7-67c8-400371a2695c@treenet.co.nz>
References: <1506822256791-0.post@n4.nabble.com>
 <233f0a6c-7465-6b74-3b9c-c75e695120e5@treenet.co.nz>
 <CA+ekxPVR9dU3SJ3k0hX1sMTUr7SkDeSTQbxcUQWRCfa4uLO1nA@mail.gmail.com>
 <201710011042.28434.Antony.Stone@squid.open.source.it>
 <1b3662d6-8902-7688-3b6d-dab4bd7024d9@treenet.co.nz>
 <C67D0F69C7AFDC75.bf5dfd84-22ea-46e6-92ee-d9e0e2d6bdfb@mail.outlook.com>
 <6b8bb239-4e07-6ad7-67c8-400371a2695c@treenet.co.nz>
Message-ID: <2d30b978-06e0-594a-7225-78ff46f0fcc6@gmail.com>

In addition, hypertext is not a literary work, as it seems to me.
Moreover, it is somehow attracted to the ears, do not you think?


02.10.2017 8:47, Amos Jeffries ?????:
> On 02/10/17 02:33, B Hirsch wrote:
>> Any legal references someone could point to?
> >
>
> <http://www.wipo.int/treaties/en/text.jsp?file_id=283698>
>
> "HTML" can contain almost any type of work, so it is hard to know in
> advance exactly which of the clauses or exemptions apply.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171002/f0bd4ee2/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171002/f0bd4ee2/attachment.sig>

From yvoinov at gmail.com  Mon Oct  2 02:56:11 2017
From: yvoinov at gmail.com (Yuri)
Date: Mon, 2 Oct 2017 08:56:11 +0600
Subject: [squid-users] Content injection
In-Reply-To: <6b8bb239-4e07-6ad7-67c8-400371a2695c@treenet.co.nz>
References: <1506822256791-0.post@n4.nabble.com>
 <233f0a6c-7465-6b74-3b9c-c75e695120e5@treenet.co.nz>
 <CA+ekxPVR9dU3SJ3k0hX1sMTUr7SkDeSTQbxcUQWRCfa4uLO1nA@mail.gmail.com>
 <201710011042.28434.Antony.Stone@squid.open.source.it>
 <1b3662d6-8902-7688-3b6d-dab4bd7024d9@treenet.co.nz>
 <C67D0F69C7AFDC75.bf5dfd84-22ea-46e6-92ee-d9e0e2d6bdfb@mail.outlook.com>
 <6b8bb239-4e07-6ad7-67c8-400371a2695c@treenet.co.nz>
Message-ID: <847aac33-2c97-f74b-d596-55a335583983@gmail.com>

And it's still said softly - it's arrtacted to the ears. Speech, as I
understand it, is about the insertion of advertising banners in the
pages given to clients from the proxy (cache). What are the literary
works and copyright? The insertion of advertising is money, and
considerable. If op is to deduct a portion of the amount for advertising
to site owners (content) - it seems to me that there will be no legal
collision and there is no need to drag here a dead donkey - that is,
forgive, the ancient laws of the early 20th century.

It seems to me that the phrase "HTML can contain" (and may not contain,
and in most cases does not contain - because the Web is bullshit in most
cases) the above - it sounds extremely Jesuit.


02.10.2017 8:47, Amos Jeffries ?????:
> On 02/10/17 02:33, B Hirsch wrote:
>> Any legal references someone could point to?
> >
>
> <http://www.wipo.int/treaties/en/text.jsp?file_id=283698>
>
> "HTML" can contain almost any type of work, so it is hard to know in
> advance exactly which of the clauses or exemptions apply.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171002/5bd334cc/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171002/5bd334cc/attachment.sig>

From squid3 at treenet.co.nz  Mon Oct  2 03:04:28 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 2 Oct 2017 16:04:28 +1300
Subject: [squid-users] Content injection
In-Reply-To: <c877ec80-c379-5831-6a72-614a96e9d720@gmail.com>
References: <1506822256791-0.post@n4.nabble.com>
 <233f0a6c-7465-6b74-3b9c-c75e695120e5@treenet.co.nz>
 <CA+ekxPVR9dU3SJ3k0hX1sMTUr7SkDeSTQbxcUQWRCfa4uLO1nA@mail.gmail.com>
 <201710011042.28434.Antony.Stone@squid.open.source.it>
 <1b3662d6-8902-7688-3b6d-dab4bd7024d9@treenet.co.nz>
 <C67D0F69C7AFDC75.bf5dfd84-22ea-46e6-92ee-d9e0e2d6bdfb@mail.outlook.com>
 <6b8bb239-4e07-6ad7-67c8-400371a2695c@treenet.co.nz>
 <c877ec80-c379-5831-6a72-614a96e9d720@gmail.com>
Message-ID: <436c2a0c-7650-6b7b-a618-b35e980de00b@treenet.co.nz>

On 02/10/17 15:49, Yuri wrote:
> Hm, Amos. But 1986 - it is ancient in 2017, yes? Over 20 years.....
> Ethernity in IT.
> 

Yuri, you may want to take that up with a lawyer.

"
Berne Notification No. 162
Berne Convention for the Protection of Literary and Artistic Works
Accession by the Russian Federation

...

The Berne Convention, as revised at Paris on July 24, 1971, and amended 
on September 28, 1979, will enter into force, with respect to the 
Russian Federation, on March 13, 1995.

December 13, 1994
"

Amos


From xpro6000 at gmail.com  Mon Oct  2 05:03:49 2017
From: xpro6000 at gmail.com (xpro6000)
Date: Mon, 2 Oct 2017 01:03:49 -0400
Subject: [squid-users] Make all IPv6 ips on system to be used as a proxy
In-Reply-To: <!&!AAAAAAAAAAAuAAAAAAAAAGDVRrtF13VDjYYZR9MgvgYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAACs9EXxHh6PRok3B4eK0ibsAQAAAAA=@ngtech.co.il>
References: <CAFoK1azxn=vp7g_uwcXDrWVp-PoUFqMcC7oiAtXOkv-ge=M0jg@mail.gmail.com>
 <!&!AAAAAAAAAAAuAAAAAAAAAGDVRrtF13VDjYYZR9MgvgYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAACs9EXxHh6PRok3B4eK0ibsAQAAAAA=@ngtech.co.il>
Message-ID: <CAFoK1aw84+TFgBGs-hEgJLPvt5uhHORboBba4Hun-3XwrvuhGQ@mail.gmail.com>

I did some research on tproxy, this is pretty much the Linux firewall
right? There is not much documentation about it online

On Sat, Sep 30, 2017 at 5:21 PM, Eliezer Croitoru <eliezer at ngtech.co.il>
wrote:

> Anyone mentioned tproxy?
> It works for me...
>
> Eliezer
>
> ----
> http://ngtech.co.il/lmgtfy/
> Linux System Administrator
> Mobile: +972-5-28704261
> Email: eliezer at ngtech.co.il
>
>
> From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On
> Behalf Of xpro6000
> Sent: Saturday, September 30, 2017 00:02
> To: squid-users at lists.squid-cache.org
> Subject: [squid-users] Make all IPv6 ips on system to be used as a proxy
>
> I have multiple IPs on my Linux system and I need one of my programs to be
> able to choose which IP to use. One way to achieve this is to use a proxy
> server. But with Squid's default config file, the IP I connect to, is not
> the IP used for the outgoing connection.
>
> Is there anything I can do to enable Squid to use the same incoming IP for
> the outgoing IP?
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171002/42e37410/attachment.htm>

From squid3 at treenet.co.nz  Mon Oct  2 06:16:29 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 2 Oct 2017 19:16:29 +1300
Subject: [squid-users] Make all IPv6 ips on system to be used as a proxy
In-Reply-To: <CAFoK1aw84+TFgBGs-hEgJLPvt5uhHORboBba4Hun-3XwrvuhGQ@mail.gmail.com>
References: <CAFoK1azxn=vp7g_uwcXDrWVp-PoUFqMcC7oiAtXOkv-ge=M0jg@mail.gmail.com>
 <!&!AAAAAAAAAAAuAAAAAAAAAGDVRrtF13VDjYYZR9MgvgYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAACs9EXxHh6PRok3B4eK0ibsAQAAAAA=@ngtech.co.il>
 <CAFoK1aw84+TFgBGs-hEgJLPvt5uhHORboBba4Hun-3XwrvuhGQ@mail.gmail.com>
Message-ID: <84222408-42c1-3742-0d6d-65566d5fef34@treenet.co.nz>

On 02/10/17 18:03, xpro6000 wrote:
> I did some research on tproxy, this is pretty much the Linux firewall 
> right? There is not much documentation about it online
> 

No, netfilter/iptables is the Linux firewall.

TPROXY is a feature of the Linux TCP stack. BSD stacks have a different 
name for it, but very similar behaviour.

The docs as relate to Squid can be found here:
<https://wiki.squid-cache.org/Features/Tproxy4>

Amos


From squid3 at treenet.co.nz  Mon Oct  2 06:17:13 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 2 Oct 2017 19:17:13 +1300
Subject: [squid-users] Content injection
In-Reply-To: <2d30b978-06e0-594a-7225-78ff46f0fcc6@gmail.com>
References: <1506822256791-0.post@n4.nabble.com>
 <233f0a6c-7465-6b74-3b9c-c75e695120e5@treenet.co.nz>
 <CA+ekxPVR9dU3SJ3k0hX1sMTUr7SkDeSTQbxcUQWRCfa4uLO1nA@mail.gmail.com>
 <201710011042.28434.Antony.Stone@squid.open.source.it>
 <1b3662d6-8902-7688-3b6d-dab4bd7024d9@treenet.co.nz>
 <C67D0F69C7AFDC75.bf5dfd84-22ea-46e6-92ee-d9e0e2d6bdfb@mail.outlook.com>
 <6b8bb239-4e07-6ad7-67c8-400371a2695c@treenet.co.nz>
 <2d30b978-06e0-594a-7225-78ff46f0fcc6@gmail.com>
Message-ID: <73ea3a14-ff84-ac10-ac7a-e669d27a8f2f@treenet.co.nz>

On 02/10/17 15:51, Yuri wrote:
> In addition, hypertext is not a literary work, as it seems to me.
> Moreover, it is somehow attracted to the ears, do not you think?
> 

Lawyers told me otherwise:

"A website is copyrighted at the time of development. So putting the 
copyright notice on the bottom of a site states that the material 
displayed is not to be used without permission of the owner. In fact, 
you don?t even need the notice to claim copyright."

"It is also common for the text, HTML, and script elements of a page to 
be taken and reused. If you have not gotten permission, you have 
violated the owner's copyright."


The legal point is that by adapting the original HTML you are creating a 
*derived* HTML document which includes the other copyright contents 
contained within the page text without permission from the original 
creator - and then distributing it without their permission. That 
derivative distribution is what you get in trouble.

Amos


From eliezer at ngtech.co.il  Mon Oct  2 08:23:39 2017
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Mon, 2 Oct 2017 11:23:39 +0300
Subject: [squid-users] Make all IPv6 ips on system to be used as a proxy
In-Reply-To: <CAFoK1aw84+TFgBGs-hEgJLPvt5uhHORboBba4Hun-3XwrvuhGQ@mail.gmail.com>
References: <CAFoK1azxn=vp7g_uwcXDrWVp-PoUFqMcC7oiAtXOkv-ge=M0jg@mail.gmail.com>
 <!&!AAAAAAAAAAAuAAAAAAAAAGDVRrtF13VDjYYZR9MgvgYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAACs9EXxHh6PRok3B4eK0ibsAQAAAAA=@ngtech.co.il>
 <CAFoK1aw84+TFgBGs-hEgJLPvt5uhHORboBba4Hun-3XwrvuhGQ@mail.gmail.com>
Message-ID: <042a01d33b57$c0497730$40dc6590$@ngtech.co.il>

Hey,

Give try to give me some specs on what you need(maybe In pm) and I will see if I might sketch you a tiny NAT proxy.
Take a peek at:
https://github.com/LiamHaworth/go-tproxy

It's a very nice library which you might be able to use.

Eliezer

* There are more then one vendor out there which modified the kernel TCP stack and the TPROXY feature to make it 100% transparent which is similar to NAT.

----
http://ngtech.co.il/lmgtfy/
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il


From: arya6000 at gmail.com [mailto:arya6000 at gmail.com] On Behalf Of xpro6000
Sent: Monday, October 2, 2017 08:04
To: Eliezer Croitoru <eliezer at ngtech.co.il>
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Make all IPv6 ips on system to be used as a proxy

I did some research on tproxy, this is pretty much the Linux firewall right? There is not much documentation about it online

On Sat, Sep 30, 2017 at 5:21 PM, Eliezer Croitoru <mailto:eliezer at ngtech.co.il> wrote:
Anyone mentioned tproxy?
It works for me...

Eliezer

----
http://ngtech.co.il/lmgtfy/
Linux System Administrator
Mobile: tel:%2B972-5-28704261
Email: mailto:eliezer at ngtech.co.il


From: squid-users [mailto:mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of xpro6000
Sent: Saturday, September 30, 2017 00:02
To: mailto:squid-users at lists.squid-cache.org
Subject: [squid-users] Make all IPv6 ips on system to be used as a proxy

I have multiple IPs on my Linux system and I need one of my programs to be able to choose which IP to use. One way to achieve this is to use a proxy server. But with Squid's default config file, the IP I connect to, is not the IP used for the outgoing connection.

Is there anything I can do to enable Squid to use the same incoming IP for the outgoing IP?




From amajer at suse.de  Mon Oct  2 09:58:20 2017
From: amajer at suse.de (Adam Majer)
Date: Mon, 2 Oct 2017 11:58:20 +0200
Subject: [squid-users] ipv6 acl access not working properly
In-Reply-To: <1715375839.11166961.1506615002160@mail.yahoo.com>
References: <1715375839.11166961.1506615002160.ref@mail.yahoo.com>
 <1715375839.11166961.1506615002160@mail.yahoo.com>
Message-ID: <c2332aa1-6338-d834-a9df-9e2a92d8702b@suse.de>

On 09/28/2017 06:10 PM, anwesh tiwari wrote:
> Ipv6 acl is not working as expected, if the ipv6 address of domain is
> unrouteable and it fallbacks to ipv4 even when its denied.
> 
> Details : What I am trying to achieve :  I want to disable all IPv4
> domain access from proxy and disable all ipv4 connections.


You appear to be correct. The ACL behaviour is checked before
connections are attempted.

So, trying to connect to IPv4 only sites fails, as expected. But if you
have a dualstack site, like whatismyipv6.com, then it passes the ACL but
fails on the IPv6 connection. Then it falls back to Ipv4 and succeeds.

This seems to be the not very intuitive part of the ACL mechanism. ACL
guards access to squid-cache, not to the site themselves. So as long as
the ACL succeeds *before* connection is ever attempted (and sometimes it
may not even be attempted, because things are cached after all), then it
passes.

If you want to disable access to outside world on IPv4, you can disable
it outside of squid. Like via iptables or dropping IPv4 from your
network interface.

- Adam


From veiko at linux.ee  Mon Oct  2 14:28:36 2017
From: veiko at linux.ee (Veiko Kukk)
Date: Mon, 2 Oct 2017 17:28:36 +0300
Subject: [squid-users] Cache digest vs ICP
In-Reply-To: <5f025eaa-364e-e742-7532-c25a9575eed6@measurement-factory.com>
References: <CAG8vQeNHe1TNT4=b1JcLDu7hmCWvBTwkgUkZLKUezmQBnonQJQ@mail.gmail.com>
 <5f025eaa-364e-e742-7532-c25a9575eed6@measurement-factory.com>
Message-ID: <CAG8vQePOwrAyNEva9Bax4zy_eDHgcJTAKENYAZJn9AP9h1iyzw@mail.gmail.com>

Alex, thank you for your response!

2017-09-27 18:06 GMT+03:00 Alex Rousskov <rousskov at measurement-factory.com>:

> On 09/27/2017 03:46 AM, Veiko Kukk wrote:
>
> > Siblings are configured with no-proxy keyword to achieve that they don't
> > cache what other siblings already have in their cache.
>
> I assume that by "no-proxy" you meant "proxy-only".
>
> True, that was my mistake.

>
> > This is to minimize data usage costs from origin servers.
>
> The proxy-only option does not minimize the amount of data transmitted
> between a proxy and the origin server. It reduces cache duplication
> among cache peers.


Exactly.

>
> > So far digest_generation has been set to off and only ICP has been used
> > between siblings. Mostly because digest stats had shown many rejects
> > (not containing 100% of cache objects) and documentation about digests
> > is confusing up to statements that while rebuilding digest, squid will
> > stop serving requests.
>
> Please point me to the location of that statement. IMHO, it is not
> confusing but incorrect.


I found it in the book by Duane Wessels
http://etutorials.org/Server+Administration/Squid.+The+definitive+guide/Chapter+10.+Talking+to+Other+Squids/10.7+Cache+Digests/
Quoting: During each invocation of the rebuild function, Squid adds some
percentage of the cache to the digest. Squid doesn't process user requests
while this function runs.


>
> Cache Digests are not SMP aware (but should be). You may be able to work
> around that limitation using SMP macros, but I have not tested that. I
> do not remember whether a worker that is not configured to generate a
> digest will still look it up in the cache when a peer asks for it.
> Hopefully, the worker will do that lookup.
>
> That sounds very interesting. Could you point me to sample configuration?


>
> > Digest
> > documentation states that it's including based on refresh_pattern. It's
> > a problem because to get squid working as we want, we had to use
> > offline_mode on.
>
> If Cache Digests do not honor offline_mode, it is a (staleness
> estimation code) bug that should be reported and fixed.
>

Can't confirm this now, but we had issues with that earlier.
http://squid-web-proxy-cache.1019090.n4.nabble.com/Never-expire-any-object-Squid-configuration-td4677160.html


>
> > * Why does sibling false positive result in sending client 504 and not
> > trying next sibling or parent? CD_SIBLING_HIT/192.168.1.52
> > TCP_MISS/504. How to achieve proceeding with next cache_peer?
>
> Sounds like bug #4223 to me:
> http://bugs.squid-cache.org/show_bug.cgi?id=4223
>
> I've patched 3.5.27 with patch found under that bug and build rpm for
testing, and so far have not encountered that error anymore.

I have another issue. How frequently are cache digests refreshed from
siblings? It seems to me that it takes quite a lot time and i have not
found anything in documentation that could help enfroce digest refreshing.
In test system, i've set 'digest_rebuild_period 60 second'. With clean
cache and running test downloads sibling1 very quickly updates it's cache
digest:

Local Digest:
store digest: size: 10492 bytes
entries: count: 415 capacity: 16787 util: 2%
deletion attempts: 0
bits: per entry: 5 on: 1648 capacity: 83936 util: 2%
bit-seq: count: 3224 avg.len: 26.03
added: 415 rejected: 0 ( 0.00 %) del-ed: 0
collisions: on add: 0.00 % on rej: -1.00 %

I've waited at least 20 minutes, several times ran downloads agains
sibling2 (clean cache too) and sibling2 (192.168.1.52) still shows old,
almost empty cache digest for sibling1(192.168.1.51):

Peer Digests:
no guess stats for all peers available

Per-peer statistics:

peer digest from 192.168.1.51
no guess stats for 192.168.1.51 available

event timestamp secs from now secs from init
initialized 1506952649 -1602 +0
needed 1506953341 -910 +692
requested 1506953341 -910 +692
received 1506953341 -910 +692
next_check 1506956584 +2333 +3935
peer digest state:
needed: yes, usable: yes, requested:  no

last retry delay: 0 secs
last request response time: 0 secs
last request result: success

peer digest traffic:
requests sent: 1, volume: 0 KB
replies recv:  1, volume: 0 KB

peer digest structure:
192.168.1.51 digest: size: 32 bytes
entries: count: 51 capacity: 51 util: 100%
deletion attempts: 0
bits: per entry: 5 on: 142 capacity: 256 util: 55%
bit-seq: count: 131 avg.len: 1.95


Algorithm usage:
Cache Digest:       0 ( -1%)
Icp:                0 ( -1%)
Total:              0 ( -1%)

Local Digest:
store digest: size: 1461 bytes
entries: count: 75 capacity: 2337 util: 3%
deletion attempts: 0
bits: per entry: 5 on: 296 capacity: 11688 util: 3%
bit-seq: count: 572 avg.len: 20.43
added: 75 rejected: 0 ( 0.00 %) del-ed: 0
collisions: on add: 0.00 % on rej: -1.00 %

Why is it so?
How is cache digest from siblings refreshed?
How can sibling cache digest refreshed more frequently?

Best regards,
Veiko
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171002/47fd8c78/attachment.htm>

From synfinatic at gmail.com  Mon Oct  2 15:39:46 2017
From: synfinatic at gmail.com (Aaron Turner)
Date: Mon, 2 Oct 2017 08:39:46 -0700
Subject: [squid-users] tuning squid memory (aka avoiding the reaper)
In-Reply-To: <CANAZdzVsEGcPhCgC0tWAwumoGS4kRUJTXgY8ftP3H9L9HOYq4w@mail.gmail.com>
References: <CANAZdzXS7jFH_n44BgdYALzE_r3D7t78HRamz9qdKsbtfOVyqg@mail.gmail.com>
 <6fd4bb1b-8ec5-4883-2c57-8debb3890d9a@measurement-factory.com>
 <CANAZdzUDViPoOxXVUyd0=Krz+xdyn_R0viJXxLNEMmmGtFs5jA@mail.gmail.com>
 <54372253-c45a-7ca2-37f8-8ecbdbd3ba27@treenet.co.nz>
 <CANAZdzXK4D14OaNpBLCm5ZPcgau_2+B38sXM2mTDe_bB8QwFvg@mail.gmail.com>
 <763e182c-d966-fd6a-ed2b-0c20d17c3274@treenet.co.nz>
 <CANAZdzV293R30V4Eex7B99vCJz_5JQ=4+SiaGD-65GivsQzALw@mail.gmail.com>
 <CANAZdzVsEGcPhCgC0tWAwumoGS4kRUJTXgY8ftP3H9L9HOYq4w@mail.gmail.com>
Message-ID: <CANAZdzXWDn_FvQYdYn=ufK5-CdCPQBQWUx+0Z5+akzpwh_sMYg@mail.gmail.com>

Anyone see anything useful?
--
Aaron Turner
https://synfin.net/         Twitter: @synfinatic
My father once told me that respect for the truth comes close to being
the basis for all morality.  "Something cannot emerge from nothing,"
he said.  This is profound thinking if you understand how unstable
"the truth" can be.  -- Frank Herbert, Dune


On Fri, Sep 29, 2017 at 4:57 PM, Aaron Turner <synfinatic at gmail.com> wrote:
> One more update before I restart squid:
>
>   PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND
>  3188 squid     20   0 4821844 4.337g 1.008g R  53.0 30.4 349:31.24 squid
>  3187 squid     20   0 3539696 3.153g 1.008g R  31.9 22.1 259:15.31 squid
>  3190 squid     20   0 3198228 2.834g 1.008g S  29.2 19.8 230:23.30 squid
>  3189 squid     20   0 3033460 2.680g 1.008g R  27.0 18.8 226:17.63 squid
>
> https://synfin.net/misc/mgr_mem_1000.txt
>
> --
> Aaron Turner
> https://synfin.net/         Twitter: @synfinatic
> My father once told me that respect for the truth comes close to being
> the basis for all morality.  "Something cannot emerge from nothing,"
> he said.  This is profound thinking if you understand how unstable
> "the truth" can be.  -- Frank Herbert, Dune
>
>
> On Fri, Sep 29, 2017 at 9:45 AM, Aaron Turner <synfinatic at gmail.com> wrote:
>> So this is smelling like a mem leak to me.  First after running for a few hours:
>>
>>   PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND
>>  3188 squid     20   0 3586264 3.175g 1.007g R  63.4 22.2 162:59.38 squid
>>  3187 squid     20   0 2941332 2.585g 1.005g S  45.5 18.1 129:36.40 squid
>>  3190 squid     20   0 2641828 2.304g 1.001g R  41.4 16.1 109:49.08 squid
>>  3189 squid     20   0 2524892 2.182g 0.987g S  42.1 15.3 110:30.96 squid
>>
>> I configured squid w/ 1GB mem cache, no disk cache, ssl bumping and 4
>> workers.  Looks like they've all pretty much mapped the 1GB which is
>> what I'd expect.  However, resident memory is clearly quite high
>> considering my config.
>>
>> While this was running I was capturing the output of mgr:mem and
>> started looking at the numbers.  Now I'm not 100% I understand the
>> meanings of all the columns, but I also don't see any indication of
>> what is using all that resident memory.
>>
>> I've grabbed a few of the mgr:mem output spanning the test and
>> uploaded them here since I hate sending attachments to lists:
>>
>> https://synfin.net/misc/watch_share.tar.gz
>> --
>> Aaron Turner
>> https://synfin.net/         Twitter: @synfinatic
>> My father once told me that respect for the truth comes close to being
>> the basis for all morality.  "Something cannot emerge from nothing,"
>> he said.  This is profound thinking if you understand how unstable
>> "the truth" can be.  -- Frank Herbert, Dune
>>
>>
>> On Thu, Sep 28, 2017 at 10:05 PM, Amos Jeffries <squid3 at treenet.co.nz> wrote:
>>> On 29/09/17 12:35, Aaron Turner wrote:
>>>>
>>>> Ok, i'll work on that.  One other thing, is that if I let it run long
>>>> enough, squid will crash with errors like the following:
>>>>
>>>> FATAL: Received Bus Error...dying.
>>>> 2017/09/28 23:28:09 kid4| Closing HTTP port 10.93.3.4:3128
>>>> 2017/09/28 23:28:09 kid4| Closing HTTP port 127.0.0.1:3128
>>>> 2017/09/28 23:28:09 kid4| storeDirWriteCleanLogs: Starting...
>>>> 2017/09/28 23:28:09 kid4|   Finished.  Wrote 0 entries.
>>>> 2017/09/28 23:28:09 kid4|   Took 0.00 seconds (  0.00 entries/sec).
>>>> CPU Usage: 0.541 seconds = 0.466 user + 0.075 sys
>>>> Maximum Resident Size: 121440 KB
>>>> Page faults with physical i/o: 0
>>>>
>>>> At first I thought the bus error was hardware, but it's happened on
>>>> two different EC2 instances now.
>>>>
>>>
>>> Yes "Bus Error" is definitely hardware. The OS kernel had an error loading
>>> some data from RAM into the CPU or something along those lines.
>>>
>>> The only things we can do about it is check that your Squid is up to date
>>> with the system environment - eg fairly recent Squid version built with the
>>> OS latest compiler version against its current libc or whatever the
>>> equivalents of those are for your system. If there are binary level issues
>>> with the libc interfaces weird things can happen.
>>>
>>> Amos


From rousskov at measurement-factory.com  Mon Oct  2 16:36:58 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 2 Oct 2017 10:36:58 -0600
Subject: [squid-users] Cache digest vs ICP
In-Reply-To: <CAG8vQePOwrAyNEva9Bax4zy_eDHgcJTAKENYAZJn9AP9h1iyzw@mail.gmail.com>
References: <CAG8vQeNHe1TNT4=b1JcLDu7hmCWvBTwkgUkZLKUezmQBnonQJQ@mail.gmail.com>
 <5f025eaa-364e-e742-7532-c25a9575eed6@measurement-factory.com>
 <CAG8vQePOwrAyNEva9Bax4zy_eDHgcJTAKENYAZJn9AP9h1iyzw@mail.gmail.com>
Message-ID: <eadf68b1-4ae2-f41a-ae24-d6cc82dcf7ca@measurement-factory.com>

On 10/02/2017 08:28 AM, Veiko Kukk wrote:

> I found it in the book by Duane Wessels
> Quoting: During each invocation of the rebuild function, Squid adds some
> percentage of the cache to the digest. Squid doesn't process user
> requests while this function runs.

The quoted statement is correct: Digesting a (configurable) percentage
of cache index is a blocking action -- Squid does not process anything
else while that action runs. As we discussed earlier, digesting the
whole cache index is not blocking. This is similar to how one network
read is blocking but receiving the entire response body is not blocking.



>     Cache Digests are not SMP aware (but should be). You may be able to work
>     around that limitation using SMP macros, but I have not tested that. I
>     do not remember whether a worker that is not configured to generate a
>     digest will still look it up in the cache when a peer asks for it.
>     Hopefully, the worker will do that lookup.
> 
> That sounds very interesting. Could you point me to sample configuration?

I am not aware of any sample configurations that restrict digest
generation to a single worker, but that does not mean they do not exist.
SMP macros in general are described in the beginning of
squid.conf.documented.



> How frequently are cache digests refreshed from
> siblings? 

The short answer is "a new peer digest is fetched PeerDigestReqMinGap
seconds after its earlier cached version has expired". I believe the
details are covered by the discussion below and the following FAQ entry:
https://wiki.squid-cache.org/SquidFaq/CacheDigests#How_are_Cache_Digests_transferred_between_peers.3F



> It seems to me that it takes quite a lot time and i have not
> found anything in documentation that could help enfroce digest
> refreshing. 

digest_rebuild_period controls how often the local digest is refreshed.
Bugs notwithstanding, the local digest expiration (and the Expires field
in digest HTTP response) should be set accordingly.


> In test system, i've set 'digest_rebuild_period 60 second'.

Squid has several hard-coded rate limits for digest fetches:

* refresh a given peer digest no more than once in 5 minutes:

  /* min interval for requesting digests from a given peer */
  static const time_t PeerDigestReqMinGap = 5 * 60;   /* seconds */

* and request a digest no more frequently than once per minute:

  /* min interval for requesting digests (cumulative request stream) */
  static const time_t GlobDigestReqMinGap = 1 * 60;   /* seconds */


Notes for your future tests, if any:

* If you are running an SMP Squid, then please repeat the test without
SMP. Make sure non-SMP configuration works before you try to configure
SMP Squid (which will probably require lowering digest_rewrite_period as
well so that all workers can see the newly generated digest on disk).

* A 60 second refresh feels too aggressive to me. Any
digest_rebuild_period longer than digest generation should work in
theory, but I would be worried about various hard-coded hack interfering
with such a small value as 60 seconds. I recommend starting with 5
minute or longer periods. A longer regeneration period would also go
nicely with PeerDigestReqMinGap discussed above.


> With clean cache and running test downloads sibling1 very quickly
> updates it's cache digest:
> 
> Local Digest:
> store digest: size: 10492 bytes
> entries: count: 415 capacity: 16787 util: 2%
> deletion attempts: 0
> bits: per entry: 5 on: 1648 capacity: 83936 util: 2%
> bit-seq: count: 3224 avg.len: 26.03
> added: 415 rejected: 0 ( 0.00 %) del-ed: 0
> collisions: on add: 0.00 % on rej: -1.00 %
> 
> I've waited at least 20 minutes, several times ran downloads agains
> sibling2 (clean cache too) and sibling2 (192.168.1.52) still shows old,
> almost empty cache digest for sibling1(192.168.1.51):

Please note that if the old digest1 was generated before you changed
digest_rebuild_period for sibling1, then its old cached version will
still have that old expiration date. I am _not_ saying that is what
happens in your specific test, but please keep this caveat in mind.

Also, the 192.168.1.51 digest shown below is not "almost empty" -- the
stats below show that it has 55% of its bits turned on, with all 51
expected entries digested. AFAICT, that digest is full.


> Peer Digests:
> no guess stats for all peers available
> 
> Per-peer statistics:
> 
> peer digest from 192.168.1.51
> no guess stats for 192.168.1.51 available
> 
> event          timestamp    secs from now    secs from init
> initialized    1506952649    -1602              +0
> needed         1506953341     -910            +692
> requested      1506953341     -910            +692
> received       1506953341     -910            +692
> next_check     1506956584    +2333           +3935

> peer digest state: needed: yes, usable: yes, requested:? no

> last retry delay: 0 secs
> last request response time: 0 secs
> last request result: success

> peer digest traffic:
> requests sent: 1, volume: 0 KB
> replies recv:? 1, volume: 0 KB
> 
> peer digest structure:
> 192.168.1.51 digest: size: 32 bytes
> entries: count: 51 capacity: 51 util: 100%
> deletion attempts: 0
> bits: per entry: 5 on: 142 capacity: 256 util: 55%
> bit-seq: count: 131 avg.len: 1.95

If I am reading the above sibling2 stats correctly, then sibling2
downloaded and cached a tiny 32-byte digest1 910 seconds ago and will
refresh the cached copy in 2333 seconds. That next check will come
(3935-692)/60 = (2333+910)/60 = 54 minutes after digest1 birth. You
should be able to correlate that with digest1 generation stats reported
by 192.168.1.51 at the time when this digest was generated.


HTH,

Alex.


From rousskov at measurement-factory.com  Mon Oct  2 16:59:46 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 2 Oct 2017 10:59:46 -0600
Subject: [squid-users] Content injection
In-Reply-To: <233f0a6c-7465-6b74-3b9c-c75e695120e5@treenet.co.nz>
References: <1506822256791-0.post@n4.nabble.com>
 <1a3aff96-5469-92b8-ca83-4d6d994ce44c@measurement-factory.com>
 <233f0a6c-7465-6b74-3b9c-c75e695120e5@treenet.co.nz>
Message-ID: <b50e69de-4420-4283-7ac7-91b4884deacc@measurement-factory.com>

On 09/30/2017 10:15 PM, Amos Jeffries wrote:
> Please be aware that HTTP documents are protected by international
> copyright laws. Altering other peoples content is illegal in all
> countries signatory to the Berne Convention and many other countries
> individual copyright laws as well.


For the record: The above statement does not reflect reality well. While
most documents are protected by copyright, altering a
copyright-protected document is legal in some cases and illegal in some
other cases (with a large gray area in between).

If you cannot figure out the specifics of _your_ case, please do not
follow this thread or start another discussion on squid-users! Consult a
knowledgeable lawyer instead. And if you want to chat about copyright
law peculiarities, please do that on a mailing list that specializes in
such topics.


Thank you,

Alex.


From hectorchan at gmail.com  Mon Oct  2 17:44:24 2017
From: hectorchan at gmail.com (Hector Chan)
Date: Mon, 2 Oct 2017 10:44:24 -0700
Subject: [squid-users] Caching URL with ?
Message-ID: <CAEhCwUw-0N3Qdyc6Hj5t2fcTj90UW13tC-QZN9vNmZa57S9GLw@mail.gmail.com>

I have a question about caching URLs with an auth token embedded in the URL
parameter.  For example:

https://www.example.com/path/page?token=xxx135ynjy93tqi

The page can be uniquely identified without the URL parameters.  It appears
squid is using the full URL, including the URL parameters, as the cache
key.  Thus, causing the HIT rate to plummet.  Is there any way I can tell
squid to disregard the URL parameters when storing to or serving from
cache?  I know the store_id_program can do that, but is there any other way?

Thanks,
Hector
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171002/90a2a713/attachment.htm>

From yvoinov at gmail.com  Mon Oct  2 18:14:44 2017
From: yvoinov at gmail.com (Yuri)
Date: Tue, 3 Oct 2017 00:14:44 +0600
Subject: [squid-users] Caching URL with ?
In-Reply-To: <CAEhCwUw-0N3Qdyc6Hj5t2fcTj90UW13tC-QZN9vNmZa57S9GLw@mail.gmail.com>
References: <CAEhCwUw-0N3Qdyc6Hj5t2fcTj90UW13tC-QZN9vNmZa57S9GLw@mail.gmail.com>
Message-ID: <fccd129f-74f1-1874-c6fa-1859f8fcc7b0@gmail.com>

Not enough information.

Is token persistent from GET to GET? Or it changed from day to day (by
hash from date, for example?) If ir persistent, it can be stored by
store-ID. If not -no.

The other way here is not to blame. It is necessary to understand,
whether the token is really unique for unique content or not. This is
the subject of reverse engineering, I think.


02.10.2017 23:44, Hector Chan ?????:
> I have a question about caching URLs with an auth token embedded in
> the URL parameter.? For example:
>
> https://www.example.com/path/page?token=xxx135ynjy93tqi
>
> The page can be uniquely identified without the URL parameters.? It
> appears squid is using the full URL, including the URL parameters, as
> the cache key.? Thus, causing the HIT rate to plummet.? Is there any
> way I can tell squid to disregard the URL parameters when storing to
> or serving from cache?? I know the store_id_program can do that, but
> is there any other way?
>
> Thanks,
> Hector
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
**************************
* C++: Bug to the future *
**************************

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171003/06790970/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171003/06790970/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171003/06790970/attachment.sig>

From xpro6000 at gmail.com  Mon Oct  2 18:44:29 2017
From: xpro6000 at gmail.com (xpro6000)
Date: Mon, 2 Oct 2017 14:44:29 -0400
Subject: [squid-users] IP_FREEBIND or IP_TRANSPARENT support?
Message-ID: <CAFoK1axH9d0Cwa0hJxFqk32xG9OrwK5YyOv11Nmv3M4qfxqm7g@mail.gmail.com>

If one were to assign a whole /64 block of IPv6 IPs to a NIC on Linux then
they would use the "ip route add local" method instead of adding each IP in
the /etc/network/interfaces file.

>From the testing I have done the IPs that were assigned with the "ip route
add local" don't work with Squid and the main reason for this is because
Squid does not use IP_FREEBIND or IP_TRANSPARENT option on the socket
connection.

You can read more about it here

https://serverfault.com/a/591435/141509


Is there any option in the config file that enables this option?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171002/818883a2/attachment.htm>

From rentorbuy at yahoo.com  Mon Oct  2 19:53:51 2017
From: rentorbuy at yahoo.com (Vieri)
Date: Mon, 2 Oct 2017 19:53:51 +0000 (UTC)
Subject: [squid-users] squid and kernel options
References: <960756896.2123276.1506974031870.ref@mail.yahoo.com>
Message-ID: <960756896.2123276.1506974031870@mail.yahoo.com>

Hi,
My distro's Squid package checks for the presence of several kernel config options. In particular, it checks for these:
NF_CONNTRACK 
NETFILTER_XT_MATCH_SOCKET 
NETFILTER_XT_TARGET_TPROXY
However, in recent kernels such as 4.12.12, it seems that the following option is not available anymore:
NETFILTER_XT_MATCH_SOCKET
How does Squid use this kernel config option, and how can I be affected by its absence?
Thanks,
Vieri
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171002/cc9b5399/attachment.htm>

From rentorbuy at yahoo.com  Mon Oct  2 20:34:27 2017
From: rentorbuy at yahoo.com (Vieri)
Date: Mon, 2 Oct 2017 20:34:27 +0000 (UTC)
Subject: [squid-users] squid and kernel options
References: <1882704857.2149922.1506976467825.ref@mail.yahoo.com>
Message-ID: <1882704857.2149922.1506976467825@mail.yahoo.com>

Sorry for the confusion.I finally found the XT_MATCH_SOCKET option even in 4.12.12.
Thanks,
Vieri
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171002/be987215/attachment.htm>

From eliezer at ngtech.co.il  Mon Oct  2 20:46:45 2017
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Mon, 2 Oct 2017 23:46:45 +0300
Subject: [squid-users] IP_FREEBIND or IP_TRANSPARENT support?
In-Reply-To: <CAFoK1axH9d0Cwa0hJxFqk32xG9OrwK5YyOv11Nmv3M4qfxqm7g@mail.gmail.com>
References: <CAFoK1axH9d0Cwa0hJxFqk32xG9OrwK5YyOv11Nmv3M4qfxqm7g@mail.gmail.com>
Message-ID: <!&!AAAAAAAAAAAuAAAAAAAAAGDVRrtF13VDjYYZR9MgvgYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAAAhYuL6IN1yQ51cKD61PzxjAQAAAAA=@ngtech.co.il>

On what OS?(since it does supports it)
But if you just need a NAT proxy then it's another story.

Eliezer

----
http://ngtech.co.il/lmgtfy/
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il


From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of xpro6000
Sent: Monday, October 2, 2017 21:44
To: squid-users at lists.squid-cache.org
Subject: [squid-users] IP_FREEBIND or IP_TRANSPARENT support?

If one were to assign a whole /64 block of IPv6 IPs to a NIC on Linux then they would use the "ip route add local" method instead of adding each IP in the /etc/network/interfaces file.

>From the testing I have done the IPs that were assigned with the "ip route add local" don't work with Squid and the main reason for this is because Squid does not use IP_FREEBIND or IP_TRANSPARENT option on the socket connection.

You can read more about it here

https://serverfault.com/a/591435/141509


Is there any option in the config file that enables this option?



From eliezer at ngtech.co.il  Mon Oct  2 20:55:34 2017
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Mon, 2 Oct 2017 23:55:34 +0300
Subject: [squid-users] squid and kernel options
In-Reply-To: <960756896.2123276.1506974031870@mail.yahoo.com>
References: <960756896.2123276.1506974031870.ref@mail.yahoo.com>
 <960756896.2123276.1506974031870@mail.yahoo.com>
Message-ID: <!&!AAAAAAAAAAAuAAAAAAAAAGDVRrtF13VDjYYZR9MgvgYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAACJVhr8QKYmQI5FI8Saf/Z+AQAAAAA=@ngtech.co.il>

Hey Vieri,

I think it's specific to your distro since... it exists in the netfilter sources as you can see at:
https://github.com/torvalds/linux/blob/4ac4d584886a4f47f8ff3bca0f32ff9a2987d3e5/net/netfilter/xt_socket.c

Squid doesn't use it directly but the iptables rules for tproxy to work requires this module to be available.
It is used to identify which connections are local socket and not incoming connections and if these are local sockets these will not be hijacked by tproxy and will be treated like a local connection.
Without this you cannot use tproxy.
To test if it exists you need to run the next command:
$ iptables -t mangle -A PREROUTING -p tcp -m socket -j MARK --set-mark 1

And see what happens.
If it works, then you have the module on your OS and it should be fine.

Eliezer

----
http://ngtech.co.il/lmgtfy/
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il


From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Vieri
Sent: Monday, October 2, 2017 22:54
To: squid-users at lists.squid-cache.org
Subject: [squid-users] squid and kernel options

Hi,

My distro's Squid package checks for the presence of several kernel config options. In particular, it checks for these:

NF_CONNTRACK 
NETFILTER_XT_MATCH_SOCKET 
NETFILTER_XT_TARGET_TPROXY

However, in recent kernels such as 4.12.12, it seems that the following option is not available anymore:

NETFILTER_XT_MATCH_SOCKET

How does Squid use this kernel config option, and how can I be affected by its absence?

Thanks,

Vieri




From rentorbuy at yahoo.com  Mon Oct  2 21:05:28 2017
From: rentorbuy at yahoo.com (Vieri)
Date: Mon, 2 Oct 2017 21:05:28 +0000 (UTC)
Subject: [squid-users] squid and kernel options
In-Reply-To: <!&!AAAAAAAAAAAuAAAAAAAAAGDVRrtF13VDjYYZR9MgvgYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAACJVhr8QKYmQI5FI8Saf/Z+AQAAAAA=@ngtech.co.il>
References: <960756896.2123276.1506974031870.ref@mail.yahoo.com>
 <960756896.2123276.1506974031870@mail.yahoo.com>
 <!&!AAAAAAAAAAAuAAAAAAAAAGDVRrtF13VDjYYZR9MgvgYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAACJVhr8QKYmQI5FI8Saf/Z+AQAAAAA=@ngtech.co.il>
Message-ID: <1720762844.2173987.1506978328357@mail.yahoo.com>



________________________________
From: Eliezer Croitoru <eliezer at ngtech.co.il>
> To test if it exists you need to run the next command:
> $ iptables -t mangle -A PREROUTING -p tcp -m socket -j MARK --set-mark 1


Thanks!


From squid3 at treenet.co.nz  Tue Oct  3 01:29:39 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 3 Oct 2017 14:29:39 +1300
Subject: [squid-users] Caching URL with ?
In-Reply-To: <CAEhCwUw-0N3Qdyc6Hj5t2fcTj90UW13tC-QZN9vNmZa57S9GLw@mail.gmail.com>
References: <CAEhCwUw-0N3Qdyc6Hj5t2fcTj90UW13tC-QZN9vNmZa57S9GLw@mail.gmail.com>
Message-ID: <64a118ad-51d9-2e99-f957-b6753d48cb7f@treenet.co.nz>

On 03/10/17 06:44, Hector Chan wrote:
> I have a question about caching URLs with an auth token embedded in the 
> URL parameter.? For example:
> 
> https://www.example.com/path/page?token=xxx135ynjy93tqi
> 
> The page can be uniquely identified without the URL parameters.? It 
> appears squid is using the full URL, including the URL parameters, as 
> the cache key.? Thus, causing the HIT rate to plummet.? Is there any way 
> I can tell squid to disregard the URL parameters when storing to or 
> serving from cache?? I know the store_id_program can do that, but is 
> there any other way?

No there is not. Any change to any part of the URL means it is a 
different cache object. Store-ID is the way to de-duplicate identical 
objects caused by this type of broken URL.

PS. the token above is neither private nor secure. If you have any 
influence or contact with the devs of the software doing that please 
encourage them to use real authentication. It looks like OAuth2 Bearer 
is what that system needs to use.

Amos


From squid3 at treenet.co.nz  Tue Oct  3 02:18:43 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 3 Oct 2017 15:18:43 +1300
Subject: [squid-users] IP_FREEBIND or IP_TRANSPARENT support?
In-Reply-To: <CAFoK1axH9d0Cwa0hJxFqk32xG9OrwK5YyOv11Nmv3M4qfxqm7g@mail.gmail.com>
References: <CAFoK1axH9d0Cwa0hJxFqk32xG9OrwK5YyOv11Nmv3M4qfxqm7g@mail.gmail.com>
Message-ID: <03429e1a-958d-bcd8-1aad-eee01e7d99d9@treenet.co.nz>

On 03/10/17 07:44, xpro6000 wrote:
> If one were to assign a whole /64 block of IPv6 IPs to a NIC on Linux 
> then they would use the "ip route add local" method instead of adding 
> each IP in the /etc/network/interfaces file.
> 
>  From the testing I have done the IPs that were assigned with the "ip 
> route add local" don't work with Squid and the main reason for this is 
> because Squid does not use IP_FREEBIND or IP_TRANSPARENT option on the 
> socket connection.


Any machine can be setup to *route* traffic (ip route add ...). That is 
a very different proposition to assigning those IPs as belonging to that 
machine (ip addr add ...).

IP_TRANSPARENT is the spoofing part of the TPROXYv4 feature and is used 
by Squid when TPROXY is setup.


> 
> You can read more about it here
> 
> https://serverfault.com/a/591435/141509
> 

That whole SF entry is all kinds of mixed up. It is basically saying 
that to "assign a whole range" one has to *spoof* the IPs in that range. 
Which is a very wrong thing to do.

The list of 'ip addr add' settings in the original interfaces file is 
correct for what the person was wanting (and you?), though I'm not sure 
if there is another place to do them. I do the same but in a trigger 
script called from the interfaces file instead of listing them all in 
that file directly.

> 
> Is there any option in the config file that enables this option?
> 

Not for Squid.

Squid prefers the OS to select the IP which is used, though for a small 
number of IPs you can use tcp_outgoing_addr to tell the OS that any 
specific one of the set *assigned* to the machine should be used on 
server connections.

Amos


From eliezer at ngtech.co.il  Tue Oct  3 02:45:00 2017
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Tue, 3 Oct 2017 05:45:00 +0300
Subject: [squid-users] IP_FREEBIND or IP_TRANSPARENT support?
In-Reply-To: <03429e1a-958d-bcd8-1aad-eee01e7d99d9@treenet.co.nz>
References: <CAFoK1axH9d0Cwa0hJxFqk32xG9OrwK5YyOv11Nmv3M4qfxqm7g@mail.gmail.com>
 <03429e1a-958d-bcd8-1aad-eee01e7d99d9@treenet.co.nz>
Message-ID: <076801d33bf1$9b74b330$d25e1990$@ngtech.co.il>

I have just started reading the SF post the 10 time.
I really didn?t understood what was the requirement and what or why the FREEBIND was offered.

And Amos, in intercept\transparent mode there is no way to select the outgoing addresses but not for a tproxy setup.
Also I do not think that squid should handle a /64 for outgoing traffic based on non-automated\non-coded solution.

If tproxy does the job then why use a specific outgoing ip?
If it's for NAT then I can offer a "simple" solution to this whole thing but it involves haproxy proxy protocol.

We can use a tproxy listener\proxy\loadbalancer that will forward a "src" and a "destination" ip:port pair into a proxy protocol aware port.
Then the proxy aware protocol port will open a tproxy connection based on the source IP and whatever destination it will choose based on regular squid logic.
The LB proxy can loadbalance traffic over several "http_port ip:port ...options" to avoid the limit of ip::port->ip:port on lo.
The example would be something like:
http_port 127.0.0.2:13128 
http_port 127.0.0.3:13128
http_port 127.0.0.4:13128
...

And the LB proxy will bind automatically(the OS choice..) the right ip:port that will be used for the connection between the LB proxy to the squid ip:port.

It will require from squid to support two things:
- To be able to parse and interpret PROXY protocol V2
- To be able to spoof the outgoing ip address using tproxy based on the PROXY protocol V2 supplied source address

What do you think Amos?
If there is some interest in such a thing then it would be pretty simple to craft.

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il



-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Amos Jeffries
Sent: Tuesday, October 3, 2017 05:19
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] IP_FREEBIND or IP_TRANSPARENT support?

On 03/10/17 07:44, xpro6000 wrote:
> If one were to assign a whole /64 block of IPv6 IPs to a NIC on Linux 
> then they would use the "ip route add local" method instead of adding 
> each IP in the /etc/network/interfaces file.
> 
>  From the testing I have done the IPs that were assigned with the "ip 
> route add local" don't work with Squid and the main reason for this is 
> because Squid does not use IP_FREEBIND or IP_TRANSPARENT option on the 
> socket connection.


Any machine can be setup to *route* traffic (ip route add ...). That is 
a very different proposition to assigning those IPs as belonging to that 
machine (ip addr add ...).

IP_TRANSPARENT is the spoofing part of the TPROXYv4 feature and is used 
by Squid when TPROXY is setup.


> 
> You can read more about it here
> 
> https://serverfault.com/a/591435/141509
> 

That whole SF entry is all kinds of mixed up. It is basically saying 
that to "assign a whole range" one has to *spoof* the IPs in that range. 
Which is a very wrong thing to do.

The list of 'ip addr add' settings in the original interfaces file is 
correct for what the person was wanting (and you?), though I'm not sure 
if there is another place to do them. I do the same but in a trigger 
script called from the interfaces file instead of listing them all in 
that file directly.

> 
> Is there any option in the config file that enables this option?
> 

Not for Squid.

Squid prefers the OS to select the IP which is used, though for a small 
number of IPs you can use tcp_outgoing_addr to tell the OS that any 
specific one of the set *assigned* to the machine should be used on 
server connections.

Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users



From squid3 at treenet.co.nz  Tue Oct  3 03:25:00 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 3 Oct 2017 16:25:00 +1300
Subject: [squid-users] tuning squid memory (aka avoiding the reaper)
In-Reply-To: <CANAZdzXWDn_FvQYdYn=ufK5-CdCPQBQWUx+0Z5+akzpwh_sMYg@mail.gmail.com>
References: <CANAZdzXS7jFH_n44BgdYALzE_r3D7t78HRamz9qdKsbtfOVyqg@mail.gmail.com>
 <6fd4bb1b-8ec5-4883-2c57-8debb3890d9a@measurement-factory.com>
 <CANAZdzUDViPoOxXVUyd0=Krz+xdyn_R0viJXxLNEMmmGtFs5jA@mail.gmail.com>
 <54372253-c45a-7ca2-37f8-8ecbdbd3ba27@treenet.co.nz>
 <CANAZdzXK4D14OaNpBLCm5ZPcgau_2+B38sXM2mTDe_bB8QwFvg@mail.gmail.com>
 <763e182c-d966-fd6a-ed2b-0c20d17c3274@treenet.co.nz>
 <CANAZdzV293R30V4Eex7B99vCJz_5JQ=4+SiaGD-65GivsQzALw@mail.gmail.com>
 <CANAZdzVsEGcPhCgC0tWAwumoGS4kRUJTXgY8ftP3H9L9HOYq4w@mail.gmail.com>
 <CANAZdzXWDn_FvQYdYn=ufK5-CdCPQBQWUx+0Z5+akzpwh_sMYg@mail.gmail.com>
Message-ID: <23fca10f-f62a-7091-085d-0fb83fc1321e@treenet.co.nz>

On 03/10/17 04:39, Aaron Turner wrote:
> Anyone see anything useful?

The numbers in those reports all seem reasonable to me. Nothing is 
showing up with GB of RAM used.

Amos


From synfinatic at gmail.com  Tue Oct  3 03:37:03 2017
From: synfinatic at gmail.com (Aaron Turner)
Date: Mon, 2 Oct 2017 20:37:03 -0700
Subject: [squid-users] tuning squid memory (aka avoiding the reaper)
In-Reply-To: <23fca10f-f62a-7091-085d-0fb83fc1321e@treenet.co.nz>
References: <CANAZdzXS7jFH_n44BgdYALzE_r3D7t78HRamz9qdKsbtfOVyqg@mail.gmail.com>
 <6fd4bb1b-8ec5-4883-2c57-8debb3890d9a@measurement-factory.com>
 <CANAZdzUDViPoOxXVUyd0=Krz+xdyn_R0viJXxLNEMmmGtFs5jA@mail.gmail.com>
 <54372253-c45a-7ca2-37f8-8ecbdbd3ba27@treenet.co.nz>
 <CANAZdzXK4D14OaNpBLCm5ZPcgau_2+B38sXM2mTDe_bB8QwFvg@mail.gmail.com>
 <763e182c-d966-fd6a-ed2b-0c20d17c3274@treenet.co.nz>
 <CANAZdzV293R30V4Eex7B99vCJz_5JQ=4+SiaGD-65GivsQzALw@mail.gmail.com>
 <CANAZdzVsEGcPhCgC0tWAwumoGS4kRUJTXgY8ftP3H9L9HOYq4w@mail.gmail.com>
 <CANAZdzXWDn_FvQYdYn=ufK5-CdCPQBQWUx+0Z5+akzpwh_sMYg@mail.gmail.com>
 <23fca10f-f62a-7091-085d-0fb83fc1321e@treenet.co.nz>
Message-ID: <CANAZdzXNxt6ZgXVsA9XE0N5RHxujVyMHccro52gXOPspJH99Aw@mail.gmail.com>

So it's leaking memory and not tracking it?  Clearly 'top' is showing
it is using a lot of memory and growing over time.  I'm happy to do
more tests/etc, but right now I can't go into production with this
memory leak.  Should I try squid4?
--
Aaron Turner
https://synfin.net/         Twitter: @synfinatic
My father once told me that respect for the truth comes close to being
the basis for all morality.  "Something cannot emerge from nothing,"
he said.  This is profound thinking if you understand how unstable
"the truth" can be.  -- Frank Herbert, Dune


On Mon, Oct 2, 2017 at 8:25 PM, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> On 03/10/17 04:39, Aaron Turner wrote:
>>
>> Anyone see anything useful?
>
>
> The numbers in those reports all seem reasonable to me. Nothing is showing
> up with GB of RAM used.
>
> Amos


From montri at anasx.com  Tue Oct  3 12:01:43 2017
From: montri at anasx.com (Udomariyah, Montri)
Date: Tue, 03 Oct 2017 19:01:43 +0700
Subject: [squid-users] squid-users Digest, Vol 38, Issue 10
In-Reply-To: <mailman.3.1507032001.19013.squid-users@lists.squid-cache.org>
References: <mailman.3.1507032001.19013.squid-users@lists.squid-cache.org>
Message-ID: <7d9801a8882f8110e669d4a4f18ea9c4@anasx.com>

remove me please.

On 2017-10-03 07:00 PM, squid-users-request at lists.squid-cache.org wrote:
> Send squid-users mailing list submissions to
> 	squid-users at lists.squid-cache.org
> 
> To subscribe or unsubscribe via the World Wide Web, visit
> 	http://lists.squid-cache.org/listinfo/squid-users
> or, via email, send a message with subject or body 'help' to
> 	squid-users-request at lists.squid-cache.org
> 
> You can reach the person managing the list at
> 	squid-users-owner at lists.squid-cache.org
> 
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of squid-users digest..."
> 
> 
> Today's Topics:
> 
>    1. Re: tuning squid memory (aka avoiding the reaper) (Aaron Turner)
> 
> 
> ----------------------------------------------------------------------
> 
> Message: 1
> Date: Mon, 2 Oct 2017 20:37:03 -0700
> From: Aaron Turner <synfinatic at gmail.com>
> To: Amos Jeffries <squid3 at treenet.co.nz>
> Cc: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] tuning squid memory (aka avoiding the
> 	reaper)
> Message-ID:
> 	<CANAZdzXNxt6ZgXVsA9XE0N5RHxujVyMHccro52gXOPspJH99Aw at mail.gmail.com>
> Content-Type: text/plain; charset="UTF-8"
> 
> So it's leaking memory and not tracking it?  Clearly 'top' is showing
> it is using a lot of memory and growing over time.  I'm happy to do
> more tests/etc, but right now I can't go into production with this
> memory leak.  Should I try squid4?
> --
> Aaron Turner
> https://synfin.net/         Twitter: @synfinatic
> My father once told me that respect for the truth comes close to being
> the basis for all morality.  "Something cannot emerge from nothing,"
> he said.  This is profound thinking if you understand how unstable
> "the truth" can be.  -- Frank Herbert, Dune
> 
> 
> On Mon, Oct 2, 2017 at 8:25 PM, Amos Jeffries <squid3 at treenet.co.nz> 
> wrote:
>> On 03/10/17 04:39, Aaron Turner wrote:
>>> 
>>> Anyone see anything useful?
>> 
>> 
>> The numbers in those reports all seem reasonable to me. Nothing is 
>> showing
>> up with GB of RAM used.
>> 
>> Amos
> 
> 
> ------------------------------
> 
> Subject: Digest Footer
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 
> 
> ------------------------------
> 
> End of squid-users Digest, Vol 38, Issue 10
> *******************************************


From squid3 at treenet.co.nz  Tue Oct  3 12:47:57 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 4 Oct 2017 01:47:57 +1300
Subject: [squid-users] squid-users Digest, Vol 38, Issue 10
In-Reply-To: <7d9801a8882f8110e669d4a4f18ea9c4@anasx.com>
References: <mailman.3.1507032001.19013.squid-users@lists.squid-cache.org>
 <7d9801a8882f8110e669d4a4f18ea9c4@anasx.com>
Message-ID: <eca3bfbf-67f1-0bd3-324a-36944edd594a@treenet.co.nz>

On 04/10/17 01:01, Udomariyah, Montri wrote:
> remove me please.

Follow the instructions ...

> 
> On 2017-10-03 07:00 PM, lists.squid-cache.org wrote:
>> Send squid-users mailing list submissions to
>> ????squid-users at lists.squid-cache.org
>>
>> To subscribe or unsubscribe via the World Wide Web, visit
>> ????http://lists.squid-cache.org/listinfo/squid-users


Amos


From chip_pop at hotmail.com  Tue Oct  3 14:08:14 2017
From: chip_pop at hotmail.com (joseph)
Date: Tue, 3 Oct 2017 07:08:14 -0700 (MST)
Subject: [squid-users] squid5 build error
In-Reply-To: <82a619a6-2a42-d278-049a-7aeaa6a142b5@measurement-factory.com>
References: <1506520654560-0.post@n4.nabble.com>
 <82a619a6-2a42-d278-049a-7aeaa6a142b5@measurement-factory.com>
Message-ID: <1507039694605-0.post@n4.nabble.com>

i gess this patch you post i did befor patch it
and the problem is conversion lol   please re check

gadgets.cc: In function ???const ASN1_BIT_STRING*
Ssl::X509_get_signature(const CertPointer&)???:
gadgets.cc:960:25: error: invalid conversion from ???ASN1_BIT_STRING** {aka
asn1_string_st**}??? to ???const ASN1_BIT_STRING** {aka const
asn1_string_st**}??? [-fpermissive]
     X509_get0_signature(&sig, &sig_alg, cert.get());
                         ^~~~
In file included from /usr/include/openssl/ssl.h:50:0,
                 from ../../src/security/Context.h:16,
                 from ../../src/security/forward.h:13,
                 from ../../src/ssl/gadgets.h:13,
                 from gadgets.cc:10:
/usr/include/openssl/x509.h:552:6: note:   initializing argument 1 of
???void X509_get0_signature(const ASN1_BIT_STRING**, const X509_ALGOR**,
const X509*)???
 void X509_get0_signature(const ASN1_BIT_STRING **psig,
      ^~~~~~~~~~~~~~~~~~~
gadgets.cc:960:31: error: invalid conversion from ???X509_ALGOR** {aka
X509_algor_st**}??? to ???const X509_ALGOR** {aka const X509_algor_st**}???
[-fpermissive]
     X509_get0_signature(&sig, &sig_alg, cert.get());
                               ^~~~~~~~
In file included from /usr/include/openssl/ssl.h:50:0,
                 from ../../src/security/Context.h:16,
                 from ../../src/security/forward.h:13,
                 from ../../src/ssl/gadgets.h:13,
                 from gadgets.cc:10:
/usr/include/openssl/x509.h:552:6: note:   initializing argument 2 of
???void X509_get0_signature(const ASN1_BIT_STRING**, const X509_ALGOR**,
const X509*)???
 void X509_get0_signature(const ASN1_BIT_STRING **psig,





--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From chip_pop at hotmail.com  Tue Oct  3 14:11:07 2017
From: chip_pop at hotmail.com (joseph)
Date: Tue, 3 Oct 2017 07:11:07 -0700 (MST)
Subject: [squid-users] squid5 build error
In-Reply-To: <1507039694605-0.post@n4.nabble.com>
References: <1506520654560-0.post@n4.nabble.com>
 <82a619a6-2a42-d278-049a-7aeaa6a142b5@measurement-factory.com>
 <1507039694605-0.post@n4.nabble.com>
Message-ID: <1507039867833-0.post@n4.nabble.com>

just note i gess   its  the gcc v   6.x  and 7  strictly 



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From eliezer at ngtech.co.il  Tue Oct  3 23:54:09 2017
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Wed, 4 Oct 2017 02:54:09 +0300
Subject: [squid-users] YouTube\GoogleVideo caching is here,
	tested and verified.
Message-ID: <0aca01d33ca2$e7f1d330$b7d57990$@ngtech.co.il>

Hey All,

After quite some time I have compiled a solution for YouTube videos caching
for PC's.
The next step would be to cache it for mobile devices but I am looking for
someone who wants this solution.
The only drawback is that this solution is designed for
intercept\transparent proxies and not tproxy but it might work on these too.

The installation is pretty simple on a systemd based OS like Debian 8+9,
Ubuntu 16.04, CentOS\RHEK 7, Oracle Enterprise Linux 7 and OpenSUSE leap and
above.
It consists of four components:
- local redis DB
- ICAP service binary
- ICAP service system service unit file
- ruby StoreID script

And of course a special squid.conf with ssl_bump enabled.

For now I will not package it using RPM or DEB and will use a shell script
or README.md that describes the installation and usage steps.
Contact me here or by a PM.

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il



From squid3 at treenet.co.nz  Wed Oct  4 03:08:51 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 4 Oct 2017 16:08:51 +1300
Subject: [squid-users] squid5 build error
In-Reply-To: <1507039694605-0.post@n4.nabble.com>
References: <1506520654560-0.post@n4.nabble.com>
 <82a619a6-2a42-d278-049a-7aeaa6a142b5@measurement-factory.com>
 <1507039694605-0.post@n4.nabble.com>
Message-ID: <63731c69-d3ef-1332-bd2e-ce3386fd712c@treenet.co.nz>

On 04/10/17 03:08, joseph wrote:
> i gess this patch you post i did befor patch it
> and the problem is conversion lol   please re check
> 

Not sure what you mean by that. The fix is in git master branch and 
snapshots since Aug.

Amos


From chip_pop at hotmail.com  Wed Oct  4 09:45:32 2017
From: chip_pop at hotmail.com (joseph)
Date: Wed, 4 Oct 2017 02:45:32 -0700 (MST)
Subject: [squid-users] squid5 build error
In-Reply-To: <63731c69-d3ef-1332-bd2e-ce3386fd712c@treenet.co.nz>
References: <1506520654560-0.post@n4.nabble.com>
 <82a619a6-2a42-d278-049a-7aeaa6a142b5@measurement-factory.com>
 <1507039694605-0.post@n4.nabble.com>
 <63731c69-d3ef-1332-bd2e-ce3386fd712c@treenet.co.nz>
Message-ID: <1507110332739-0.post@n4.nabble.com>

amos i do use your patch and i get that error

here is my configure and i use debian 9.x  with gcc 7 now

libtool: compile:  x86_64-linux-gnu-g++ -DHAVE_CONFIG_H -I../..
-I../../include -I../../lib -I../../src -I../../include
-I/usr/include/openssl -Wall -Wpointer-arith -Wwrite-strings -Wcomments
-Wshadow -Woverloaded-virtual -Werror -Wno-deprecated-register -pipe
-D_REENTRANT -std=c++11 -m64 -O3 -march=native -MT gadgets.lo -MD -MP -MF
.deps/gadgets.Tpo -c gadgets.cc  -fPIC -DPIC -o .libs/gadgets.o
gadgets.cc: In function ???const ASN1_BIT_STRING*
Ssl::X509_get_signature(const CertPointer&)???:
gadgets.cc:960:25: error: invalid conversion from ???ASN1_BIT_STRING** {aka
asn1_string_st**}??? to ???const ASN1_BIT_STRING** {aka const
asn1_string_st**}??? [-fpermissive]
     X509_get0_signature(&sig, &sig_alg, cert.get());
                         ^~~~
In file included from /usr/include/openssl/ssl.h:50:0,
                 from ../../src/security/Context.h:16,
                 from ../../src/security/forward.h:13,
                 from ../../src/ssl/gadgets.h:13,
                 from gadgets.cc:10:
/usr/include/openssl/x509.h:552:6: note:   initializing argument 1 of
???void X509_get0_signature(const ASN1_BIT_STRING**, const X509_ALGOR**,
const X509*)???
 void X509_get0_signature(const ASN1_BIT_STRING **psig,
      ^~~~~~~~~~~~~~~~~~~
gadgets.cc:960:31: error: invalid conversion from ???X509_ALGOR** {aka
X509_algor_st**}??? to ???const X509_ALGOR** {aka const X509_algor_st**}???
[-fpermissive]
     X509_get0_signature(&sig, &sig_alg, cert.get());
                               ^~~~~~~~
In file included from /usr/include/openssl/ssl.h:50:0,
                 from ../../src/security/Context.h:16,
                 from ../../src/security/forward.h:13,
                 from ../../src/ssl/gadgets.h:13,
                 from gadgets.cc:10:
/usr/include/openssl/x509.h:552:6: note:   initializing argument 2 of
???void X509_get0_signature(const ASN1_BIT_STRING**, const X509_ALGOR**,
const X509*)???
 void X509_get0_signature(const ASN1_BIT_STRING **psig,
      ^~~~~~~~~~~~~~~~~~~
At global scope:
cc1plus: error: unrecognized command line option
???-Wno-deprecated-register??? [-Werror]
cc1plus: all warnings being treated as errors
Makefile:846: recipe for target 'gadgets.lo' failed
make[3]: *** [gadgets.lo] Error 1
===============================
NAME=squid
PREFIX=/usr 
FLAGSC11="-std=c++11 -m64 -O3"
FLAGSC="-m64 -O3"
CHOST="x86_64-linux-gnu" 
./configure \
--prefix=${PREFIX} \
--bindir=${PREFIX}/bin \
--sbindir=${PREFIX}/sbin \
--libexecdir=${PREFIX}/lib/${NAME} \
--sysconfdir=/etc/${NAME} \
--localstatedir=/var \
--libdir=${PREFIX}/lib \
--includedir=${PREFIX}/include \
--datadir=${PREFIX}/share/${NAME} \
--infodir=${PREFIX}/share/info \
--mandir=${PREFIX}/share/man \
--enable-storeio=ufs,aufs,diskd,rock \
--enable-removal-policies=lru,heap \
--enable-linux-netfilter \
--enable-wccpv2 \
--enable-http-violations \
--enable-eui \
--enable-esi \
--enable-follow-x-forwarded-for \
--enable-arp-acl \
--enable-htcp \
--enable-cache-digests \
--enable-auth-negotiate=none \
--enable-storeid-rewrite-helpers \
--enable-ssl-crtd \
--enable-inline \
--enable-external-acl-helpers=none \
--enable-zph-qos \
--with-pthreads \
--enable-kill-parent-hack \
--with-openssl \
--with-default-user=proxy \
--with-logdir=/var/log/${NAME} \
--with-pidfile=/var/run/${NAME}.pid \
--with-filedescriptors=200000 \
--enable-snmp \
--enable-x-accelerator-vary \
--enable-delay-pools \
--enable-epoll \
--enable-translation \
--enable-icap-client \
--enable-ecap \
--enable-useragent-log \
--host="${CHOST}" \
CFLAGS="${FLAGSC}" \
CXXFLAGS="${FLAGSC11}" \
CPPFLAGS=-I/usr/include/openssl \
PKG_CONFIG_PATH=/usr/local/lib/pkgconfig



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From squid3 at treenet.co.nz  Wed Oct  4 09:54:05 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 4 Oct 2017 22:54:05 +1300
Subject: [squid-users] squid5 build error
In-Reply-To: <1507110332739-0.post@n4.nabble.com>
References: <1506520654560-0.post@n4.nabble.com>
 <82a619a6-2a42-d278-049a-7aeaa6a142b5@measurement-factory.com>
 <1507039694605-0.post@n4.nabble.com>
 <63731c69-d3ef-1332-bd2e-ce3386fd712c@treenet.co.nz>
 <1507110332739-0.post@n4.nabble.com>
Message-ID: <3475df76-db36-328c-129c-95068929374b@treenet.co.nz>

On 04/10/17 22:45, joseph wrote:
> amos i do use your patch and i get that error
> 

Are you running bootstrap.sh after applying? It depends on changes to 
the autotools build system, so has no effect if you just apply it and 
rebuild older code.

Amos


From chip_pop at hotmail.com  Wed Oct  4 10:11:46 2017
From: chip_pop at hotmail.com (joseph)
Date: Wed, 4 Oct 2017 03:11:46 -0700 (MST)
Subject: [squid-users] squid5 build error
In-Reply-To: <3475df76-db36-328c-129c-95068929374b@treenet.co.nz>
References: <1506520654560-0.post@n4.nabble.com>
 <82a619a6-2a42-d278-049a-7aeaa6a142b5@measurement-factory.com>
 <1507039694605-0.post@n4.nabble.com>
 <63731c69-d3ef-1332-bd2e-ce3386fd712c@treenet.co.nz>
 <1507110332739-0.post@n4.nabble.com>
 <3475df76-db36-328c-129c-95068929374b@treenet.co.nz>
Message-ID: <1507111906919-0.post@n4.nabble.com>

Amos Jeffries wrote
> On 04/10/17 22:45, joseph wrote:
>> amos i do use your patch and i get that error
>> 
> 
> Are you running bootstrap.sh after applying? It depends on changes to 
> the autotools build system, so has no effect if you just apply it and 
> rebuild older code.
> 
> Amos
> _______________________________________________
> squid-users mailing list

> squid-users at .squid-cache

> http://lists.squid-cache.org/listinfo/squid-users

sorry i tough i did  :( first time i dont use the bootstrap.sh  wen change
made to the  configure.ac
or related

tks :)



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From christof.gerber1 at gmail.com  Wed Oct  4 11:08:28 2017
From: christof.gerber1 at gmail.com (Christof Gerber)
Date: Wed, 4 Oct 2017 13:08:28 +0200
Subject: [squid-users] Fwd: Display eCAP meta-information on Squid error-page
In-Reply-To: <CAFyThp+u6Dfvs4mR55+rgWy8PqiXV7dzzMQ9-jF7kqx0HwYQBg@mail.gmail.com>
References: <CAFyThp+u6Dfvs4mR55+rgWy8PqiXV7dzzMQ9-jF7kqx0HwYQBg@mail.gmail.com>
Message-ID: <CAFyThpLJHz7TG+o5v+eDD60TKdtqxrmffh_q1KsG1bKEnA-NwQ@mail.gmail.com>

Hi Squid users

I have a question concerning eCAP implementation in Squid 3.5.

My goal is to display data which is provided by an eCAP adapter on a
Squid error-page. My primary goal is to achieve this with the eCAP
transaction meta-information which is provided by the eCAP adapter
with Adapter::Xaction::visitEachOption().

I know that with "adapt::<last_h" (1) this meta-information (options)
can be logged to access.log. Is it somehow possible that Squid access
these key-value pairs and hands it over to the Error page? Similar to
"deny_info" tags (2) which ensures the availability of the URL (%U)
etc. in the html code of the error-page.

The approach that the eCAP adapter would create the error-page and
send it back to squid as response body instead of calling
blockVirgin() (3) is known by me but this would only be the second
choice if the approach in question is not possible.

References:
(1) http://www.squid-cache.org/Doc/config/logformat/
(2) http://www.squid-cache.org/Doc/config/deny_info/
(3) https://answers.launchpad.net/ecap/+faq/2516

Thanks in advance for your help.
Best

Christof

-- 
Christof Gerber
Email: christof.gerber1 at gmail.com


From tmartincpp at gmail.com  Wed Oct  4 11:30:52 2017
From: tmartincpp at gmail.com (Thomas Martin)
Date: Wed, 4 Oct 2017 13:30:52 +0200
Subject: [squid-users] http_port intercept: squid 3.1.20 VS 3.5.23.
Message-ID: <CAO1iXZ+Rvb=ZDU_B8JQPO6G52JP1S0Vj1XcSGVumJV6tFYWguw@mail.gmail.com>

Hello,

I'm having trouble to make Squid 3.5.23 work like Squid 3.1.20 does.

Here is my setup:
  <clients>     |                  <router>                      |
<squid proxy>
10.0.0.Y/24    | 10.0.0.254/24 <-> 10.100.0.254/24 |   10.100.0.100/24

The goal was to have the <squid proxy> as a transparent HTTP proxy for
all <clients>; it was achieved few years ago using Squid 3.1.20.


- <clients> have one network interface and 10.0.0.254 as default gateway

- <router> is:
-- obviously forwarding packets,
-- owning the ADSL,
-- doing the transparent redirection of <clients> to <squid proxy> using NAT:
-A PREROUTING -s 10.100.0.100 -i dmz -p tcp -m state --state NEW -m
tcp --dport 80 -j ACCEPT
-A PREROUTING -s 10.0.0.Y/32 -p tcp -m state --state NEW -m tcp
--dport 80 -j DNAT --to-destination 10.100.0.100:3128

- <squid proxy> have one network interface and 10.100.0.100 as default gateway.
Squid's configuration is quite simple:
http_access allow all
http_port 0.0.0.0:3128 intercept
cache_mgr ...
cache_mem ...
...


This is working perfectly fine with Squid 3.1.20.


But now that I have upgraded <squid proxy>  to 3.5.23 (from Debian
Wheezy to Stretch) this is not working anymore.

The test I'm using is simple: "curl  http://www.google.fr -I" from <clients>.

<clients> are getting 403 returned by <squid proxy> 3.5.23.
In Squid's logs I had: "ERROR: No forward-proxy ports configured.".
After reading Squid docs, forums, mailing, list, etc, I tried to add
another http_port:
http_access allow all
http_port 0.0.0.0:3128 intercept
http_port 0.0.0.0:8080

But it does not work either, Squid seems to loop internally with a lot
a log access_log (even for one request only).


I feel like I missed something obvious, I spent quite some time to
understand but had no luck.
Am I missing something ?

When I was reading on the web, some users claimed that I should have
two network interfaces between <router> and <squid proxy> ?
If that true, why is it working perfectly with Squid 3.1.20 ?


Any clue will be appreciated.

Thanks.


From Antony.Stone at squid.open.source.it  Wed Oct  4 11:41:41 2017
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Wed, 4 Oct 2017 13:41:41 +0200
Subject: [squid-users] http_port intercept: squid 3.1.20 VS 3.5.23.
In-Reply-To: <CAO1iXZ+Rvb=ZDU_B8JQPO6G52JP1S0Vj1XcSGVumJV6tFYWguw@mail.gmail.com>
References: <CAO1iXZ+Rvb=ZDU_B8JQPO6G52JP1S0Vj1XcSGVumJV6tFYWguw@mail.gmail.com>
Message-ID: <201710041341.41462.Antony.Stone@squid.open.source.it>

On Wednesday 04 October 2017 at 13:30:52, Thomas Martin wrote:

> Hello,
> 
> I'm having trouble to make Squid 3.5.23 work like Squid 3.1.20 does.
> 
> Here is my setup:
>   <clients>     |                  <router>                      |
> <squid proxy>
> 10.0.0.Y/24    | 10.0.0.254/24 <-> 10.100.0.254/24 |   10.100.0.100/24

> - <router> is:
> -- obviously forwarding packets,
> -- owning the ADSL,
> -- doing the transparent redirection of <clients> to <squid proxy> using
> NAT: -A PREROUTING -s 10.100.0.100 -i dmz -p tcp -m state --state NEW -m
> tcp --dport 80 -j ACCEPT
> -A PREROUTING -s 10.0.0.Y/32 -p tcp -m state --state NEW -m tcp
> --dport 80 -j DNAT --to-destination 10.100.0.100:3128

That's your problem.

You're no longer allowed to do the DNAT (or REDIRECT) on anything other than 
the machine running Squid itself.

See https://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxRedirect and 
note the emphasis "This configuration is given for use on the squid box."

See https://wiki.squid-cache.org/ConfigExamples/Intercept/IptablesPolicyRoute 
for how to get the packets correctly from the router to the separate Squid 
server.

In summary, you need to do policy routing (or any other method at your 
disposal) to get the packets from the clients to be sent to the Squid server 
*without* changing their destination address (so, DNAT isn't allowed), and 
then on the Squid server you use REDIRECT to send them to the Squid listening 
socket.


Regards,

Antony.

-- 
https://tools.ietf.org/html/rfc6890 - providing 16 million IPv4 addresses for 
talking to yourself.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From tmartincpp at gmail.com  Wed Oct  4 11:50:08 2017
From: tmartincpp at gmail.com (Thomas Martin)
Date: Wed, 4 Oct 2017 13:50:08 +0200
Subject: [squid-users] http_port intercept: squid 3.1.20 VS 3.5.23.
In-Reply-To: <201710041341.41462.Antony.Stone@squid.open.source.it>
References: <CAO1iXZ+Rvb=ZDU_B8JQPO6G52JP1S0Vj1XcSGVumJV6tFYWguw@mail.gmail.com>
 <201710041341.41462.Antony.Stone@squid.open.source.it>
Message-ID: <CAO1iXZLxokUWicau=nV_oMD7LBORF5=1Vyo0aXdfPoSSmRae7g@mail.gmail.com>

2017-10-04 13:41 GMT+02:00 Antony Stone <Antony.Stone at squid.open.source.it>:
>> - <router> is:
>> -- obviously forwarding packets,
>> -- owning the ADSL,
>> -- doing the transparent redirection of <clients> to <squid proxy> using
>> NAT: -A PREROUTING -s 10.100.0.100 -i dmz -p tcp -m state --state NEW -m
>> tcp --dport 80 -j ACCEPT
>> -A PREROUTING -s 10.0.0.Y/32 -p tcp -m state --state NEW -m tcp
>> --dport 80 -j DNAT --to-destination 10.100.0.100:3128
>
> That's your problem.
>
> You're no longer allowed to do the DNAT (or REDIRECT) on anything other than
> the machine running Squid itself.
>
> See https://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxRedirect and
> note the emphasis "This configuration is given for use on the squid box."
>
> See https://wiki.squid-cache.org/ConfigExamples/Intercept/IptablesPolicyRoute
> for how to get the packets correctly from the router to the separate Squid
> server.
>
> In summary, you need to do policy routing (or any other method at your
> disposal) to get the packets from the clients to be sent to the Squid server
> *without* changing their destination address (so, DNAT isn't allowed), and
> then on the Squid server you use REDIRECT to send them to the Squid listening
> socket.
>
>
> Regards,
>
> Antony.
>

I see.
So between 3.1 and 3.5 Squid behavior changed and my DNAT is causing the loops.

I will take a closer look to theses URLs.

Thanks a lot for your help and very quick answer !

Regards,
Thomas.


From wehategrey at gmail.com  Wed Oct  4 14:13:18 2017
From: wehategrey at gmail.com (Grey)
Date: Wed, 4 Oct 2017 07:13:18 -0700 (MST)
Subject: [squid-users] Pages sometimes load as a mess of random (?) symbols
Message-ID: <1507126398090-0.post@n4.nabble.com>

Hi,
I'm running Squid version 3.5.23 with caching disabled.
Sometimes when accessing various websites (the sites that cause this problem
are always the same, such as www.tomshardware.com for example) the page
doesn't load correctly until after a page refresh, after which it shows
without error.
When loaded the first time the only thing that appears is a random mess of
symbols like this:

???v?H? ???~5m???
?d??%?l????Ze??@6I?P?m}g^c^o??L?7Qi?n??"?\"3c????[??????M??{???/??
NZ????~o??n?
??z???v????6???9?vC?S??Cp9??0 ?? {T:v?~??E;?b?
???a??????(?z?? ?='??)Oh???t
9_?F????$
??~?s??;
???[?,<=x?@x???+A?s??~?n?b?i?o^?!7??????DH.?~KL????9u?S?^?,x?Y???7O?~??w??e?Z??G
?p? NZ_???+????????a???o??g'??
????Q???h?&A8?$?@?_?{!??]??
???/?N$?-?n}??a??_./?xr?
?\???5?J?
?U??z|48??da????JY??%?=?/
1mQl?p???
G?W????Q?u??w?Z?&??w?TatG?q5??E?=Z0I?K]|?}q??o???.'???u?????>???TD???W?Y?b??=l%l?B??WI9'~??O?$~?"???s??Z<??
d}??
?oW2?Z??U@??9???[???R!???|	?y?? z???sap????A ?I
?
???GQ??u???I???~??Q?i????K???U??Q?*??G?^
O?	?

>?o?>x?%h?v?S?
?B?l???j?c@? VaL??cI[???D???-?w?[?n??!??g???N?????s-
????P/`c?
?JU??d?F?:
???}?Ss???E%???T??d??@3??
?y?|?J???p???W1-)??	gA???x^????
????!Q?8
E????ak?
?????????$?0a?HD]g??2???*R:q?9??8
?4j?R%h?u|??k?1
Z?J??H-?F??t?O?\??_DB4@`?H?TUh?J"???)??a'>??EX?o' c?v???:m$??"pJ???74
%?>???;-???"R??4?4??3p?b???Hun?????S?C9??"?
chR?PN-?4??Vl?*?[
?c\?V????????i?~VK?~08?? x??
?????5?L&v8nM?^????x'?|'z?3?~M??05?id??#^???
u:??;?v??
?Ro\X??-1?.\???[???t?.??)50`g??????I???<}??;N? ??
??"i_
ko?B\??S?R?@r??@?L"??v?v?+??u???Z:[?%@'h??8?H[?N2??1
`?&???5??kOTN??9}?8??????}?%????'c?DN????????? #`X??
q^8I?T,\????=?:qw?nw????-?mLt)e0?
!?E??A?G?+?q???x?9??&
???%H??q???????n????]?g~?S??wV?7kw?AU?B?D4u
*~?<"??
??N?]???>?C???A?n/???\2?j^?]S
x?J?@"?~~6x?%?v?U?????p_?M?J(??*?
?{B?#??? :=I?$??E?
4R??!cWp???]??j?Zq$TKI8
c??|z??????N3e?l?<?????	?r$?88?l??A?L??I??x? ?
??n?nz??fX??x??8K-sP?X?Zn?@??3?/??|?&7??i6CMD?P??<?FQ?!W"}i??^2??t?&??]??(m:3????@B
D? ??A y(?? 
\???
????C????e{????W?????k ?4?#?Q??:?V?>!??????
????y ?(/o??X???s0????NPB??`!lS$?	$?~~I???~??t&?-DJ
??\?
_l?2?q?
?;??l??"w(?I7?Z?X?DG ???g\??}e???td??9?a<??\jG???E??'?)
??]?}?
??#}?EE/+0kd?A??:????K?^??{???W?Q?=???o:!?H??a?T??u
?!_??U?S??e]
a?A?;?E????????bx??I????l?Kj?a?=?d*??S?n7?A?sT????HN???K?b0'-.f?
n????J?B?????????3??
???y?s?u?7z??X?%`&wOR_OB?
???(9F??=?
NZG?6??_??E?>?BR%G??2?x??!i????:
WaZ???:??a?5t? z?????W{?

?^??K0z?WO??ZH0 p???]?r?!?2????? ?N??7	'?
??
?????cQ??,??????3`r??e
8(??0? %&7(?!)3?*???$??i??
??????=??ne(??R{,w[??us%?P??@D???A????
?|????????~????5???l??[???)?T???3
?>{?R??T??????h?Y???`0?]??Z????????/;.??C? ?'//?^?
??N.n??5??V???W???U?J???$??!t??J?}?1??
@??]????jt???F??L?o??Qt?:??#?j
? ?
[?[??r?aV?<6a??K?3??_?6???/???A??t??
>??a,?E????F??Qpp-?V?w???? ?
?h?W???g??K?w??p(?R???|n???W?6
?hn?e?T???????f?R'?w=??A?+??a?K?*??????I???????_???Ci???z?`?-??D?s??
T4?v/l??Y?????
O?(????`s??@AN8??E?n??/?a?]?_CjPj?B??RJr+??7c?$s????????Hh??*Z)c?$r?2?-?????
"??<?9?
`??WA??{????1?O@ ??x?4?F$?????????Q?%C.?J=t?R?
???Q?????"?o?<??_??J????
????4??R(g??mwydH_???d?S~??/L??E&w
???R5?<???L7=?/?????$?o?q.?/???-???Z???qox?P?f4T?N?s?X$q2?
I??!2??#V2h!??1??????.R?Zd?%?6Gsb?(W?
??j?rb$&?J?}??h?j?zRu????[?#?Uz+5w?H???EqA??,?L\fb ym
b)?4Ce
?3dR?<?2n[FZ?v??8??<?O?)?e?????[?4???$}?zk?????>/??E1?Of|+?`?)?g(%?wz??wn?0?>??Cz???s??M?A?
0%?? ???{~?
?o?P?y(&?z+?]??1dF?'?*/??3z??[?5??:?*:?fqN????&{???S*9l?3??L??U?j?>s(??f^u?V??f?~?^q??
??qq)?4`??}??
??	4-@'T?w?7 ??TX?~t`?_.A?v#??G?????x0?Lu??z
??

Any idea on what could be the cause of this?



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html

From yvoinov at gmail.com  Wed Oct  4 14:16:10 2017
From: yvoinov at gmail.com (Yuri)
Date: Wed, 4 Oct 2017 20:16:10 +0600
Subject: [squid-users] Pages sometimes load as a mess of random (?)
 symbols
In-Reply-To: <1507126398090-0.post@n4.nabble.com>
References: <1507126398090-0.post@n4.nabble.com>
Message-ID: <bd08fe5c-bff9-914d-a1a7-164b323cc3f7@gmail.com>

There where no idea till you show your configs. Thelepathy on vacation.


04.10.2017 20:13, Grey ?????:
> Hi,
> I'm running Squid version 3.5.23 with caching disabled.
> Sometimes when accessing various websites (the sites that cause this problem
> are always the same, such as www.tomshardware.com for example) the page
> doesn't load correctly until after a page refresh, after which it shows
> without error.
> When loaded the first time the only thing that appears is a random mess of
> symbols like this:
>
> ???v?H? ???~5m???
> ?d??%?l????Ze??@6I?P?m}g^c^o??L?7Qi?n??"?\"3c????[??????M??{???/??
> NZ????~o??n?
??z???v????6???9?vC?S??Cp9??0 ?? {T:v?~??E;?b?
> ???a??????(?z?? ?='??)Oh???t
9_?F????$
??~?s??;
> ???[?,<=x?@x???+A?s??~?n?b?i?o^?!7??????DH.?~KL????9u?S?^?,x?Y???7O?~??w??e?Z??G
> ?p? NZ_???+????????a???o??g'??
????Q???h?&A8?$?@?_?{!??]??
> ???/?N$?-?n}??a??_./?xr?
?\???5?J?
?U??z|48??da????JY??%?=?/
> 1mQl?p???
> G?W????Q?u??w?Z?&??w?TatG?q5??E?=Z0I?K]|?}q??o???.'???u?????>???TD???W?Y?b??=l%l?B??WI9'~??O?$~?"???s??Z<??
> d}??
?oW2?Z??U@??9???[???R!???|	?y?? z???sap????A ?I
?
> ???GQ??u???I???~??Q?i????K???U??Q?*??G?^
O?	?

>?o?>x?%h?v?S?
> ?B?l???j?c@? VaL??cI[???D???-?w?[?n??!??g???N?????s-
????P/`c?
> ?JU??d?F?:
???}?Ss???E%???T??d??@3??
?y?|?J???p???W1-)??	gA???x^????
> ????!Q?8
E????ak?
?????????$?0a?HD]g??2???*R:q?9??8
?4j?R%h?u|??k?1
> Z?J??H-?F??t?O?\??_DB4@`?H?TUh?J"???)??a'>??EX?o' c?v???:m$??"pJ???74
> %?>???;-???"R??4?4??3p?b???Hun?????S?C9??"?
chR?PN-?4??Vl?*?[
> ?c\?V????????i?~VK?~08?? x??
> ?????5?L&v8nM?^????x'?|'z?3?~M??05?id??#^???
u:??;?v??
> ?Ro\X??-1?.\???[???t?.??)50`g??????I???<}??;N? ??
??"i_
> ko?B\??S?R?@r??@?L"??v?v?+??u???Z:[?%@'h??8?H[?N2??1
> `?&???5??kOTN??9}?8??????}?%????'c?DN????????? #`X??
> q^8I?T,\????=?:qw?nw????-?mLt)e0?
!?E??A?G?+?q???x?9??&
> ???%H??q???????n????]?g~?S??wV?7kw?AU?B?D4u
*~?<"??
> ??N?]???>?C???A?n/???\2?j^?]S
x?J?@"?~~6x?%?v?U?????p_?M?J(??*?
> ?{B?#??? :=I?$??E?
4R??!cWp???]??j?Zq$TKI8
> c??|z??????N3e?l?<?????	?r$?88?l??A?L??I??x? ?
> ??n?nz??fX??x??8K-sP?X?Zn?@??3?/??|?&7??i6CMD?P??<?FQ?!W"}i??^2??t?&??]??(m:3????@B
> D? ??A y(?? 
\???
????C????e{????W?????k ?4?#?Q??:?V?>!??????
> ????y ?(/o??X???s0????NPB??`!lS$?	$?~~I???~??t&?-DJ
??\?
_l?2?q?
> ?;??l??"w(?I7?Z?X?DG ???g\??}e???td??9?a<??\jG???E??'?)
??]?}?
> ??#}?EE/+0kd?A??:????K?^??{???W?Q?=???o:!?H??a?T??u
?!_??U?S??e]
> a?A?;?E????????bx??I????l?Kj?a?=?d*??S?n7?A?sT????HN???K?b0'-.f?
> n????J?B?????????3??
???y?s?u?7z??X?%`&wOR_OB?
???(9F??=?
> NZG?6??_??E?>?BR%G??2?x??!i????:
WaZ???:??a?5t? z?????W{?

> ?^??K0z?WO??ZH0 p???]?r?!?2????? ?N??7	'?
??
> ?????cQ??,??????3`r??e
8(??0? %&7(?!)3?*???$??i??
> ??????=??ne(??R{,w[??us%?P??@D???A????
> ?|????????~????5???l??[???)?T???3
> ?>{?R??T??????h?Y???`0?]??Z????????/;.??C? ?'//?^?
> ??N.n??5??V???W???U?J???$??!t??J?}?1??
> @??]????jt???F??L?o??Qt?:??#?j
? ?
> [?[??r?aV?<6a??K?3??_?6???/???A??t??
>??a,?E????F??Qpp-?V?w???? ?
> ?h?W???g??K?w??p(?R???|n???W?6
> ?hn?e?T???????f?R'?w=??A?+??a?K?*??????I???????_???Ci???z?`?-??D?s??
> T4?v/l??Y?????
> O?(????`s??@AN8??E?n??/?a?]?_CjPj?B??RJr+??7c?$s????????Hh??*Z)c?$r?2?-?????
> "??<?9?
`??WA??{????1?O@ ??x?4?F$?????????Q?%C.?J=t?R?
> ???Q?????"?o?<??_??J????
????4??R(g??mwydH_???d?S~??/L??E&w
> ???R5?<???L7=?/?????$?o?q.?/???-???Z???qox?P?f4T?N?s?X$q2?
> I??!2??#V2h!??1??????.R?Zd?%?6Gsb?(W?
> ??j?rb$&?J?}??h?j?zRu????[?#?Uz+5w?H???EqA??,?L\fb ym
b)?4Ce
> ?3dR?<?2n[FZ?v??8??<?O?)?e?????[?4???$}?zk?????>/??E1?Of|+?`?)?g(%?wz??wn?0?>??Cz???s??M?A?
> 0%?? ???{~?
> ?o?P?y(&?z+?]??1dF?'?*/??3z??[?5??:?*:?fqN????&{???S*9l?3??L??U?j?>s(??f^u?V??f?~?^q??
> ??qq)?4`??}??
??	4-@'T?w?7 ??TX?~t`?_.A?v#??G?????x0?Lu??z
??
>
> Any idea on what could be the cause of this?
>
>
>
> --
> Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users



From Antony.Stone at squid.open.source.it  Wed Oct  4 14:24:43 2017
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Wed, 4 Oct 2017 16:24:43 +0200
Subject: [squid-users] Pages sometimes load as a mess of random (?)
	symbols
In-Reply-To: <bd08fe5c-bff9-914d-a1a7-164b323cc3f7@gmail.com>
References: <1507126398090-0.post@n4.nabble.com>
 <bd08fe5c-bff9-914d-a1a7-164b323cc3f7@gmail.com>
Message-ID: <201710041624.43782.Antony.Stone@squid.open.source.it>

On Wednesday 04 October 2017 at 16:16:10, Yuri wrote:

> There where no idea till you show your configs. Thelepathy on vacation.

Show us what appears in the access log as well, both for the first load 
(gibberish) and the reload (good text).

Antony.

> 04.10.2017 20:13, Grey ?????:
> > Hi,
> > I'm running Squid version 3.5.23 with caching disabled.
> > Sometimes when accessing various websites (the sites that cause this
> > problem are always the same, such as www.tomshardware.com for example)
> > the page doesn't load correctly until after a page refresh, after which
> > it shows without error.
> > When loaded the first time the only thing that appears is a random mess
> > of symbols like this:
> > 
> > ???v?H? ???~5m???
> > ?d??%?l????Ze??@6I?P?m}g^c^o??L?7Qi?n??"?\"3c????[??????M??{???/??
> > NZ????~o??n?
??z???v????6???9?vC?S??Cp9??0 ?? {T:v?~??E;?b?
> > ???a??????(?z?? ?='??)Oh???t
9_?F????$
??~?s??;
> > ???[?,<=x?@x???+A?s??~?n?b?i?o^?!7??????DH.?~KL????9u?S?^?,x?Y???7O?~
> > ??w??e?Z??G ?p?
> > NZ_???+????????a???o??g'??
????Q???h?&A8?$?@?_?{!??]??
> > ???/?N$?-?n}??a??_./?xr?
?\???5?J?
?U??z|48??da????JY??%?=?/
> > 1mQl?p???
> > G?W????Q?u??w?Z?&??w?TatG?q5??E?=Z0I?K]|?}q??o???.'???u?????>???T
> > D???W?Y?b??=l%l?B??WI9'~??O?$~?"???s??Z<??
> > d}??
?oW2?Z??U@??9???[???R!???|	?y?? z???sap????A ?I
?
> > ???GQ??u???I???~??Q?i????K???U??Q?*??G?^
O?	?

>?o?>x?%h?v?S?
> > ?B?l???j?c@? VaL??cI[???D???-?w?[?n??!??g???N?????s-
????P/`c?
> > ?JU??d?F?:
???}?Ss???E%???T??d??@3??
?y?|?J???p???W1-)??	
gA???x^???
> > ?
> > ????!Q?8
E????ak?
?????????$?0a?HD]g??2???*R:q?9??8
?4j?R%h?u|??
> > k?1 Z?J??H-?F??t?O?\??_DB4@`?H?TUh?J"???)??a'>??EX?o'
> > c?v???:m$??"pJ???74
> > %?>???;-???"R??4?4??3p?b???Hun?????S?C9??"?
chR?PN-?4??Vl?*?[
> > ?c\?V????????i?~VK?~08?? x??
> > ?????5?L&v8nM?^????x'?|'z?3?~M??05?id??#^???
u:??;?v??
> > ?Ro\X??-1?.\???[???t?.??)50`g??????I???<}??;N? ??
??"i_
> > ko?B\??S?R?@r??@?L"??v?v?+??u???Z:[?%@'h??8?H[?N2??1
> > `?&???5??kOTN??9}?8??????}?%????'c?DN????????? #`X??
> > q^8I?T,\????=?:qw?nw????-?mLt)e0?
!?E??A?G?+?q???x?9??&
> > ???%H??q???????n????]?g~?S??wV?7kw?AU?B?D4u
*~?<"??
> > ??N?]???>?C???A?n/???\2?j^?]S
x?J?@"?~~6x?%?v?U?????p_?M?J(??
> > *? ?{B?#??? :=I?$??E?
4R??!cWp???]??j?Zq$TKI8
> > c??|z??????N3e?l?<?????	?r$?88?l??A?L??I??x? ?
> > ??n?nz??fX??x??8K-sP?X?Zn?@??3?/??|?&7??i6CMD?P??<?FQ?!W"}i??^2??t?
> > &??]??(m:3????@B D? ??A y(?? 
\???
????C????e{????W?????k
> > ?4?#?Q??:?V?>!?????? ????y
> > ?(/o??X???s0????NPB??`!lS$?	$?~~I???~??t&?-DJ
??\?
_l?2?q?
> > ?;??l??"w(?I7?Z?X?DG ???g\??}e???td??9?a<??\jG???E??'?)
??]?}?
> > ??#}?EE/+0kd?A??:????K?^??{???W?Q?=???o:!?H??a?T??u
?!_??U?S??e]
> > a?A?;?E????????bx??I????l?Kj?a?=?d*??S?n7?A?sT????HN???K?b0'-.
> > f? n????J?B?????????3??
???y?s?u?7z??X?%`&wOR_OB?
???(9F??=?
> > NZG?6??_??E?>?BR%G??2?x??!i????:
WaZ???:??a?5t? z?????W{?

> > ?^??K0z?WO??ZH0 p???]?r?!?2????? ?N??7	'?
??
> > ?????cQ??,??????3`r??e
8(??0? %&7(?!)3?*???$??i??
> > ??????=??ne(??R{,w[??us%?P??@D???A????
> > ?|????????~????5???l??[???)?T???3
> > ?>{?R??T??????h?Y???`0?]??Z????????/;.??C? ?'//?^?
> > ??N.n??5??V???W???U?J???$??!t??J?}?1??
> > @??]????jt???F??L?o??Qt?:??#?j
? ?
> > [?[??r?aV?<6a??K?3??_?6???/???A??t??
>??a,?E????F??Qpp-?V?w????
> > ? ?h?W???g??K?w??p(?R???|n???W?6
> > ?hn?e?T???????f?R'?w=??A?+??a?K?*??????I???????_???Ci???z?`?-??D?s??
> > T4?v/l??Y?????
> > O?(????`s??@AN8??E?n??/?a?]?_CjPj?B??RJr+??7c?$s????????Hh??*Z)c?
> > $r?2?-????? "??<?9?
`??WA??{????1?O@
> > ??x?4?F$?????????Q?%C.?J=t?R?
> > ???Q?????"?o?<??_??J????
????4??R(g??mwydH_???d?S~??/L??E&w
> > ???R5?<???L7=?/?????$?o?q.?/???-???Z???qox?P?f4T?N?s?X$q2?
> > I??!2??#V2h!??1??????.R?Zd?%?6Gsb?(W?
> > ??j?rb$&?J?}??h?j?zRu????[?#?Uz+5w?H???EqA??,?L\fb ym
b)?4Ce
> > ?3dR?<?2n[FZ?v??8??<?O?)?e?????[?4???$}?zk?????>/??E1?Of|+?`?)?g(%?
> > wz??wn?0?>??Cz???s??M?A? 0%?? ???{~?
> > ?o?P?y(&?z+?]??1dF?'?*/??3z??[?5??:?*:?fqN????&{???S*9l?3??L??U?j?>
> > s(??f^u?V??f?~?^q?? ??qq)?4`??}??
??	4-@'T?w?7
> > ??TX?~t`?_.A?v#??G?????x0?Lu??z
??
> > 
> > Any idea on what could be the cause of this?

-- 
Numerous psychological studies over the years have demonstrated that the 
majority of people genuinely believe they are not like the majority of people.

                                                   Please reply to the list;
                                                         please *don't* CC me.

From rousskov at measurement-factory.com  Wed Oct  4 17:14:07 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 4 Oct 2017 11:14:07 -0600
Subject: [squid-users] Display eCAP meta-information on Squid error-page
In-Reply-To: <CAFyThp+u6Dfvs4mR55+rgWy8PqiXV7dzzMQ9-jF7kqx0HwYQBg@mail.gmail.com>
References: <CAFyThp+u6Dfvs4mR55+rgWy8PqiXV7dzzMQ9-jF7kqx0HwYQBg@mail.gmail.com>
Message-ID: <7a5581a4-a5bc-aa28-b026-eb99896622bd@measurement-factory.com>

On 09/27/2017 11:52 PM, Christof Gerber wrote:

> I have a question concerning eCAP implementation in Squid 3.5.

Actually, you do not :-). You have a question about using so called
annotations in Squid error pages. eCAP is just one of several annotation
sources in Squid. The other sources are ICAP services, helpers, and the
"note" directive in squid.conf.


> I know that with "adapt::<last_h" (1) this meta-information (options)
> can be logged to access.log.

FYI: It is best to use %note logformat %code for logging annotations.
The %adapt::<last_h code is meant for adaptation services debugging (and
to work around the current ICAP code lack of support for annotations).


> Is it somehow possible that Squid access
> these key-value pairs and hands it over to the Error page?

Unfortunately, Squid error page generation code is unaware of
annotations -- there is currently no code to add them to the generated
error page. Supporting %note and probably all other access.log
formatting codes (via some common namespace like %logformat::note) would
be generally useful IMO.

http://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F

Alex.


From rousskov at measurement-factory.com  Wed Oct  4 17:25:33 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 4 Oct 2017 11:25:33 -0600
Subject: [squid-users] SSL Bump Failures with Google and Wikipedia
 [SOLVED]
In-Reply-To: <CA+ekxPVZwQXvOQEf2n+6vDHcYTOUXNMcSJoCUhyu=B7dSsBgAw@mail.gmail.com>
References: <CA+ekxPUfSwf4mgMwYaEsmR4-vO5jSq4dF+RX7nYujrk9V5BVPw@mail.gmail.com>
 <CA+ekxPVZwQXvOQEf2n+6vDHcYTOUXNMcSJoCUhyu=B7dSsBgAw@mail.gmail.com>
Message-ID: <32a0dbc2-fdb0-72fb-43fb-0cc1fff2d5f2@measurement-factory.com>

On 09/30/2017 11:14 PM, Jeffrey Merkey wrote:
>> After reviewing this problem and all of the great technical
>> information folks provided, I have it working and I figured out the
>> best way to deal with this transparently allowing squid to remotely
>> spoof the server side with modified request headers.

Overall, the above is _not_ the best way to deal with the encoding
problem. The overall best way is for your eCAP or ICAP service to decode
virgin and encode adapted message bodies as needed. That way, your Squid
does not mangle client requests to lie about accepted encodings and your
service can handle cases where the origin server sends encoded messages
regardless of the request Accept headers.

Alex.


From rousskov at measurement-factory.com  Wed Oct  4 17:53:15 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 4 Oct 2017 11:53:15 -0600
Subject: [squid-users] tuning squid memory (aka avoiding the reaper)
In-Reply-To: <CANAZdzXNxt6ZgXVsA9XE0N5RHxujVyMHccro52gXOPspJH99Aw@mail.gmail.com>
References: <CANAZdzXS7jFH_n44BgdYALzE_r3D7t78HRamz9qdKsbtfOVyqg@mail.gmail.com>
 <6fd4bb1b-8ec5-4883-2c57-8debb3890d9a@measurement-factory.com>
 <CANAZdzUDViPoOxXVUyd0=Krz+xdyn_R0viJXxLNEMmmGtFs5jA@mail.gmail.com>
 <54372253-c45a-7ca2-37f8-8ecbdbd3ba27@treenet.co.nz>
 <CANAZdzXK4D14OaNpBLCm5ZPcgau_2+B38sXM2mTDe_bB8QwFvg@mail.gmail.com>
 <763e182c-d966-fd6a-ed2b-0c20d17c3274@treenet.co.nz>
 <CANAZdzV293R30V4Eex7B99vCJz_5JQ=4+SiaGD-65GivsQzALw@mail.gmail.com>
 <CANAZdzVsEGcPhCgC0tWAwumoGS4kRUJTXgY8ftP3H9L9HOYq4w@mail.gmail.com>
 <CANAZdzXWDn_FvQYdYn=ufK5-CdCPQBQWUx+0Z5+akzpwh_sMYg@mail.gmail.com>
 <23fca10f-f62a-7091-085d-0fb83fc1321e@treenet.co.nz>
 <CANAZdzXNxt6ZgXVsA9XE0N5RHxujVyMHccro52gXOPspJH99Aw@mail.gmail.com>
Message-ID: <e13ba30e-adae-3ac9-aa1e-6ef4ea22b56f@measurement-factory.com>

On 10/02/2017 09:37 PM, Aaron Turner wrote:
> So it's leaking memory and not tracking it?


That combination (or, to be more precise, its implication) is possible
but relatively unlikely in your specific case -- when GBs are leaked,
there is usually something tracked related to those GBs. Please note
that what Squid _tracks_ may not amount to GBs of RAM! For example,
Squid can track a tiny object that is included in every large untracked
leaked object.

A frequent leak often manifests itself in mgr:mem snapshots as a nearly
always increasing counter of alive associated objects. If you take one
snapshot every 30 minutes or so, then you may be able to identify
suspects by comparing same-object alive counters across 5-10 snapshots.
Sorry, I do not have the time to do that for the snapshots you have
shared (and you probably need a different collection of snapshots to
make this search more productive).

Alex.


> On Mon, Oct 2, 2017 at 8:25 PM, Amos Jeffries <squid3 at treenet.co.nz> wrote:
>> On 03/10/17 04:39, Aaron Turner wrote:
>>>
>>> Anyone see anything useful?
>>
>>
>> The numbers in those reports all seem reasonable to me. Nothing is showing
>> up with GB of RAM used.


From squid3 at treenet.co.nz  Wed Oct  4 20:02:53 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 5 Oct 2017 09:02:53 +1300
Subject: [squid-users] Pages sometimes load as a mess of random (?)
 symbols
In-Reply-To: <201710041624.43782.Antony.Stone@squid.open.source.it>
References: <1507126398090-0.post@n4.nabble.com>
 <bd08fe5c-bff9-914d-a1a7-164b323cc3f7@gmail.com>
 <201710041624.43782.Antony.Stone@squid.open.source.it>
Message-ID: <059db02d-e201-615c-613c-4d02e5a07e73@treenet.co.nz>

 >> 04.10.2017 20:13, Grey ?????:
 >>> Hi,
 >>> I'm running Squid version 3.5.23 with caching disabled.
 >>> Sometimes when accessing various websites (the sites that cause this
 >>> problem are always the same, such as www.tomshardware.com for example)
 >>> the page doesn't load correctly until after a page refresh, after which
 >>> it shows without error.
 >>> When loaded the first time the only thing that appears is a random mess
 >>> of symbols like this:
 >>>


On 05/10/17 03:24, Antony Stone wrote:
> On Wednesday 04 October 2017 at 16:16:10, Yuri wrote:
> 
>> There where no idea till you show your configs. Thelepathy on vacation.
> 
> Show us what appears in the access log as well, both for the first load
> (gibberish) and the reload (good text).
> 
 > Antony.
 >

And when it occurs paste the URL into the tool at <https://redbot.org/>. 
If it says the server has broken Vary headers that is probably the problem.

Amos



From jeffmerkey at gmail.com  Wed Oct  4 20:54:45 2017
From: jeffmerkey at gmail.com (Jeffrey Merkey)
Date: Wed, 4 Oct 2017 14:54:45 -0600
Subject: [squid-users] SSL Bump Failures with Google and Wikipedia
	[SOLVED]
In-Reply-To: <32a0dbc2-fdb0-72fb-43fb-0cc1fff2d5f2@measurement-factory.com>
References: <CA+ekxPUfSwf4mgMwYaEsmR4-vO5jSq4dF+RX7nYujrk9V5BVPw@mail.gmail.com>
 <CA+ekxPVZwQXvOQEf2n+6vDHcYTOUXNMcSJoCUhyu=B7dSsBgAw@mail.gmail.com>
 <32a0dbc2-fdb0-72fb-43fb-0cc1fff2d5f2@measurement-factory.com>
Message-ID: <CA+ekxPVFjc_JUCDGPw7ct9Xg8hacnvN6L0gG9MYfCpmbROhJUA@mail.gmail.com>

On 10/4/17, Alex Rousskov <rousskov at measurement-factory.com> wrote:
> On 09/30/2017 11:14 PM, Jeffrey Merkey wrote:
>>> After reviewing this problem and all of the great technical
>>> information folks provided, I have it working and I figured out the
>>> best way to deal with this transparently allowing squid to remotely
>>> spoof the server side with modified request headers.
>
> Overall, the above is _not_ the best way to deal with the encoding
> problem. The overall best way is for your eCAP or ICAP service to decode
> virgin and encode adapted message bodies as needed. That way, your Squid
> does not mangle client requests to lie about accepted encodings and your
> service can handle cases where the origin server sends encoded messages
> regardless of the request Accept headers.
>
> Alex.
>
Hi Alex,

great minds think alike.  I came to the same conclusion about using
that request header hackery and I have almost completed a c-icap
service called "inflate" that ungzip's the data as part of an icap
service chain.  I already have incorporated gzip and deflate libs into
the icap service , and I am now integrating brotli as well.  The
service is not fully completed but will be finished sometime this
week.

The code is stored as a branch at:

https://github.com/jeffmerkey/icap/tree/inflate

I will say this, the hack I discussed in the above thread with sending
altered request headers for "accept-encoding:*;p=0" does seem to work
in terms of spoofing remote servers into not sending compressed data,
but I also noticed that not all servers on the internet respond to it
correctly, and some web servers ignore it and send compressed gzip
data anyway.

I will post to the icap list a patch series which contains this
"inflate" service module.

Jeff


From xpro6000 at gmail.com  Thu Oct  5 02:01:49 2017
From: xpro6000 at gmail.com (xpro6000)
Date: Wed, 4 Oct 2017 22:01:49 -0400
Subject: [squid-users] Enable tproxy in Squid 3.5 running on Debian 9
Message-ID: <CAFoK1axoNtug=rrLKM8-DozBUX6j5Ld5FwGmyQDp_7o=fg=pJw@mail.gmail.com>

I'm trying to setup tproxy with Squid 3.5 for the purpose of having the
same outgoing ip as the connecting ip. (I have thousands of IPs and I can
not add them one by one)

I started with a fresh install of Debian 9, installed Squid by

apt install squid

then I added

http_port 3129 tproxy

to squid.conf

I then ran the following commands for iptables

iptables -t mangle -N DIVERT
iptables -t mangle -A DIVERT -j MARK --set-mark 1
iptables -t mangle -A DIVERT -j ACCEPT

iptables  -t mangle -A PREROUTING -p tcp -m socket -j DIVERT

iptables  -t mangle -A PREROUTING -p tcp --dport 80 -j TPROXY --tproxy-mark
0x1/0x1 --on-port 3129


I can use the proxy with no problems on port 3128, but on Firefox I get a
message "The proxy server is refusing connections" when I set the proxy to
port 3129. Did I miss any steps or am I doing something wrong?

below is my full squid.conf file

acl SSL_ports port 443
acl Safe_ports port 80
acl Safe_ports port 21
acl Safe_ports port 443
acl Safe_ports port 70
acl Safe_ports port 210
acl Safe_ports port 1025-65535
acl Safe_ports port 280
acl Safe_ports port 488
acl Safe_ports port 591
acl Safe_ports port 777
acl CONNECT method CONNECT
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
http_access allow localhost
http_access allow all
http_port 3128
http_port 3129 tproxy
coredump_dir /var/spool/squid
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171004/ac853da3/attachment.htm>

From wehategrey at gmail.com  Thu Oct  5 06:42:26 2017
From: wehategrey at gmail.com (Grey)
Date: Wed, 4 Oct 2017 23:42:26 -0700 (MST)
Subject: [squid-users] Pages sometimes load as a mess of random (?)
	symbols
In-Reply-To: <059db02d-e201-615c-613c-4d02e5a07e73@treenet.co.nz>
References: <1507126398090-0.post@n4.nabble.com>
 <bd08fe5c-bff9-914d-a1a7-164b323cc3f7@gmail.com>
 <201710041624.43782.Antony.Stone@squid.open.source.it>
 <059db02d-e201-615c-613c-4d02e5a07e73@treenet.co.nz>
Message-ID: <1507185746517-0.post@n4.nabble.com>

Sorry for not including enough informatio nin the first place.

1. Here's my config, keep in mind it's a test server that will eventually
replace the one (not updated) we're using right now so the configuration is
kinda bare-bones:

### TESTSQUID1 ###

http_port 3128
dns_v4_first on
pinger_enable off
netdb_filename none

error_default_language it
cache_mgr helpdesk at test.it

acl SSL_ports port 443
acl Safe_ports port 80		# http
acl Safe_ports port 21		# ftp
acl Safe_ports port 443		# https
acl Safe_ports port 70		# gopher
acl Safe_ports port 210		# wais
acl Safe_ports port 1025-65535	# unregistered ports
acl Safe_ports port 280		# http-mgmt
acl Safe_ports port 488		# gss-http
acl Safe_ports port 591		# filemaker
acl Safe_ports port 777		# multiling http
acl CONNECT method CONNECT

auth_param negotiate program /usr/lib/squid/negotiate_kerberos_auth -r -d
auth_param negotiate children 150
auth_param negotiate keep_alive on 

external_acl_type ProxyUser children-max=75 %LOGIN
/usr/lib/squid/ext_kerberos_ldap_group_acl -g INTERNET at TEST.LOCAL -D
TEST.LOCAL -S testldap
acl ProxyUser external ProxyUser

acl AUTH proxy_auth REQUIRED
http_access deny !AUTH all

http_access deny !Safe_ports all
http_access deny CONNECT !SSL_ports all
http_access allow localhost manager
http_access deny manager all
http_access allow localhost all

acl destsquid dstdomain .testquid1 .testsquid2
http_access allow destsquid all

http_access allow ProxyUser all
http_access deny all

icap_enable on
icap_send_client_ip on
icap_send_client_username on
icap_client_username_encode off
icap_client_username_header X-Authenticated-User
icap_preview_enable on
icap_preview_size 1024
icap_service service_req reqmod_precache bypass=1
icap://testicap:1344/REQ-Service
adaptation_access service_req allow all
icap_service service_resp respmod_precache bypass=0
icap://testicap:1344/resp
adaptation_access service_resp allow all

coredump_dir /var/spool/squid

refresh_pattern ^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
refresh_pattern .		0	20%	4320

2. This is the access log when first loading the page:

1507185342.611      0 99.99.99.99 TCP_DENIED/407 5179 GET
http://www.tomshardware.com/ - HIER_NONE/- text/html
1507185344.121   1473 99.99.99.99 TCP_MISS/200 48225 GET
http://www.tomshardware.com/ testuser HIER_DIRECT/23.40.112.227 text/html

And this is the one after reloading:

1507185356.932    187 99.99.99.99 TCP_MISS/200 47858 GET
http://www.tomshardware.com/ testuser HIER_DIRECT/23.40.112.227 text/html
1507185357.425      0 99.99.99.99 TCP_DENIED/407 4440 GET
http://platform.twitter.com/widgets.js - HIER_NONE/- text/html
1507185357.482     13 99.99.99.99 TCP_MISS/200 2019 GET
http://www.tomshardware.com/medias/favicon/favicon-32x32.png? testuser
HIER_DIRECT/23.40.112.227 image/png
1507185357.548     61 99.99.99.99 TCP_REFRESH_UNMODIFIED/304 516 GET
http://platform.twitter.com/widgets.js testuser HIER_DIRECT/199.96.57.6 -
1507185357.565      0 99.99.99.99 TCP_DENIED/407 4178 CONNECT
www.tomshardware.com:443 - HIER_NONE/- text/html
1507185357.924      0 99.99.99.99 TCP_DENIED/407 4190 CONNECT
syndication.twitter.com:443 - HIER_NONE/- text/html

3. The result of the test at redbot
(https://redbot.org/?uri=http%3A%2F%2Fwww.tomshardware.com%2F if you want to
check it yourself) is:

General
The Pragma header is deprecated.
The Content-Length header is correct.
Content Negotiation (Content Negotiation response )
The resource doesn't send Vary consistently.
The response body is different when content negotiation happens.
Content negotiation for gzip compression is supported, saving 86%.
Caching
Pragma: no-cache is a request directive, not a response directive.
This response can't be stored by a cache.

So it indeed seems that this could be the problem, right? Anything I can do
on my end to resolve/mitigate it?
Thanks for your help.



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From squid3 at treenet.co.nz  Thu Oct  5 07:39:02 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 5 Oct 2017 20:39:02 +1300
Subject: [squid-users] Pages sometimes load as a mess of random (?)
 symbols
In-Reply-To: <1507185746517-0.post@n4.nabble.com>
References: <1507126398090-0.post@n4.nabble.com>
 <bd08fe5c-bff9-914d-a1a7-164b323cc3f7@gmail.com>
 <201710041624.43782.Antony.Stone@squid.open.source.it>
 <059db02d-e201-615c-613c-4d02e5a07e73@treenet.co.nz>
 <1507185746517-0.post@n4.nabble.com>
Message-ID: <b289ed33-cd21-23b6-132a-79123716d2f8@treenet.co.nz>

On 05/10/17 19:42, Grey wrote:
> Sorry for not including enough informatio nin the first place.
> 
> 1. Here's my config, keep in mind it's a test server that will eventually
> replace the one (not updated) we're using right now so the configuration is
> kinda bare-bones:
> 
> ### TESTSQUID1 ###
> 
> http_port 3128
> dns_v4_first on
> pinger_enable off
> netdb_filename none
> 
> error_default_language it
> cache_mgr helpdesk at test.it
> 
> acl SSL_ports port 443
> acl Safe_ports port 80		# http
> acl Safe_ports port 21		# ftp
> acl Safe_ports port 443		# https
> acl Safe_ports port 70		# gopher
> acl Safe_ports port 210		# wais
> acl Safe_ports port 1025-65535	# unregistered ports
> acl Safe_ports port 280		# http-mgmt
> acl Safe_ports port 488		# gss-http
> acl Safe_ports port 591		# filemaker
> acl Safe_ports port 777		# multiling http
> acl CONNECT method CONNECT
> 
> auth_param negotiate program /usr/lib/squid/negotiate_kerberos_auth -r -d
> auth_param negotiate children 150
> auth_param negotiate keep_alive on
> 
> external_acl_type ProxyUser children-max=75 %LOGIN
> /usr/lib/squid/ext_kerberos_ldap_group_acl -g INTERNET at TEST.LOCAL -D
> TEST.LOCAL -S testldap
> acl ProxyUser external ProxyUser
> 
> acl AUTH proxy_auth REQUIRED
> http_access deny !AUTH all

So two problems.
1) 'all' here means clients with incorrect OR missing auth credentials 
do not get challenged for working credentials. Since any sane client 
security system will not present credentials until told they are 
necessary the above should rightfully prevent *any* secure clients from 
using this proxy.

2) your custom config lines should be placed below the default security 
settings. This is especially important for ACLs like auth which involve 
a lot of background work. The default settings are there to block things 
like DoS or attacks that can be trivially and quickly denied, and to do 
so with minimal CPU expense.

> 
> http_access deny !Safe_ports all
> http_access deny CONNECT !SSL_ports all
> http_access allow localhost manager
> http_access deny manager all
> http_access allow localhost all

If you place the "allow localhost" above the "deny manager" you can 
remove one extra line of checks.

> 
> acl destsquid dstdomain .testquid1 .testsquid2
> http_access allow destsquid all

The 'all' ACL is a pointless waste of CPU cycles on all of the lines above.

> 
> http_access allow ProxyUser all
The 'all' ACL here *might* prevent unauthenticated clients from being 
challenged for credentials like the 'deny !AUTH' line did. But YMMV. It 
either does that or is pointless.

The current 3.5 provides the %un format code which should not generate 
an auth challenge. That should eliminate the need for the all-hack here.


> http_access deny all
> 
> icap_enable on
> icap_send_client_ip on
> icap_send_client_username on
> icap_client_username_encode off
> icap_client_username_header X-Authenticated-User
> icap_preview_enable on
> icap_preview_size 1024
> icap_service service_req reqmod_precache bypass=1
> icap://testicap:1344/REQ-Service
> adaptation_access service_req allow all
> icap_service service_resp respmod_precache bypass=0
> icap://testicap:1344/resp
> adaptation_access service_resp allow all
> 
> coredump_dir /var/spool/squid
> 
> refresh_pattern ^ftp:		1440	20%	10080
> refresh_pattern ^gopher:	1440	0%	1440
> refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
> refresh_pattern .		0	20%	4320
> 
> 2. This is the access log when first loading the page:
> 
> 1507185342.611      0 99.99.99.99 TCP_DENIED/407 5179 GET
> http://www.tomshardware.com/ - HIER_NONE/- text/html
> 1507185344.121   1473 99.99.99.99 TCP_MISS/200 48225 GET
> http://www.tomshardware.com/ testuser HIER_DIRECT/23.40.112.227 text/html
> 
> And this is the one after reloading:
> 

By "reloading" do you mean:

  * using a testing tool that sends an identical repeat request? or
  * clicking + pressing enter in a browser address bar? or
  * pressing the browser reload button? or
  * pressing the force-refresh (F5) button? or
  * holding shift while doing any of the above?

Only the first two above methods will perform a clean HTTP test request. 
The others all deliver cache controls to force specific cache behaviour 
which void the test results.


> 1507185356.932    187 99.99.99.99 TCP_MISS/200 47858 GET
> http://www.tomshardware.com/ testuser HIER_DIRECT/23.40.112.227 text/html
> 1507185357.425      0 99.99.99.99 TCP_DENIED/407 4440 GET
> http://platform.twitter.com/widgets.js - HIER_NONE/- text/html
> 1507185357.482     13 99.99.99.99 TCP_MISS/200 2019 GET
> http://www.tomshardware.com/medias/favicon/favicon-32x32.png? testuser
> HIER_DIRECT/23.40.112.227 image/png
> 1507185357.548     61 99.99.99.99 TCP_REFRESH_UNMODIFIED/304 516 GET
> http://platform.twitter.com/widgets.js testuser HIER_DIRECT/199.96.57.6 -
> 1507185357.565      0 99.99.99.99 TCP_DENIED/407 4178 CONNECT
> www.tomshardware.com:443 - HIER_NONE/- text/html
> 1507185357.924      0 99.99.99.99 TCP_DENIED/407 4190 CONNECT
> syndication.twitter.com:443 - HIER_NONE/- text/html
> 
> 3. The result of the test at redbot
> (https://redbot.org/?uri=http%3A%2F%2Fwww.tomshardware.com%2F if you want to
> check it yourself) is:
> 
> General
> The Pragma header is deprecated.
> The Content-Length header is correct.
> Content Negotiation (Content Negotiation response )
> The resource doesn't send Vary consistently.

  ^^ this one is what I meant. There are several side effects of this - 
mostly just annoying MISS behaviours, but sometimes the wrong 
content-type can end up being associated with a cached object and things 
appear as you described the problem

Also, IIRC NginX (which appears to be the server for that site) was 
known to have several bugs that led to these types of broken 
content-type behaviour some years back. I'm not sure if that ever got fixed.


> The response body is different when content negotiation happens.
> Content negotiation for gzip compression is supported, saving 86%.
> Caching
> Pragma: no-cache is a request directive, not a response directive.
> This response can't be stored by a cache.
> 
> So it indeed seems that this could be the problem, right? Anything I can do
> on my end to resolve/mitigate it?


I see that the server is already sending out "Cache-Control: no-store" 
so the problem is not your Squid but something upstream. Just make sure 
you do not override that no-store for these sites and your proxy will 
continue not to be adding problems.

It may be the ICAP service mangling the response type from gzip to 
text/plain incorrectly (ie without actually unzipping), or removing the 
relevant cache-controls.

Or equally likely; a proxy upstream force-caching, thus making itself 
*and* yours run afoul of the Vary issue. This is where I suspect the 
NginX or some hidden intermediary.

Amos


From squid3 at treenet.co.nz  Thu Oct  5 07:49:20 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 5 Oct 2017 20:49:20 +1300
Subject: [squid-users] Enable tproxy in Squid 3.5 running on Debian 9
In-Reply-To: <CAFoK1axoNtug=rrLKM8-DozBUX6j5Ld5FwGmyQDp_7o=fg=pJw@mail.gmail.com>
References: <CAFoK1axoNtug=rrLKM8-DozBUX6j5Ld5FwGmyQDp_7o=fg=pJw@mail.gmail.com>
Message-ID: <bc173936-0f34-aec9-e3fb-28ffacb6fe4a@treenet.co.nz>

On 05/10/17 15:01, xpro6000 wrote:
> I'm trying to setup tproxy with Squid 3.5 for the purpose of having the 
> same outgoing ip as the connecting ip. (I have thousands of IPs and I 
> can not add them one by one)
> 
> I started with a fresh install of Debian 9, installed Squid by
> 
> apt install squid
> 
> then I added
> 
> http_port 3129 tproxy
> 
> to squid.conf
> 
> I then ran the following commands for iptables
> 
> iptables -t mangle -N DIVERT
> iptables -t mangle -A DIVERT -j MARK --set-mark 1
> iptables -t mangle -A DIVERT -j ACCEPT
> 
> iptables? -t mangle -A PREROUTING -p tcp -m socket -j DIVERT
> 
> iptables? -t mangle -A PREROUTING -p tcp --dport 80 -j TPROXY 
> --tproxy-mark 0x1/0x1 --on-port 3129
> 
> 
> I can use the proxy with no problems on port 3128, but on Firefox I get 
> a message "The proxy server is refusing connections" when I set the 
> proxy to port 3129. Did I miss any steps or am I doing something wrong?

You missed the fact that TPROXY is an MITM operation. You *cannot* setup 
the browser to use the proxy directly to its tproxy port. You have to 
route the packets to the proxy machine without any explicit browser or 
client configuration.

Only the Squid machine bits (and thus behaviour) are different with 
TPROXY vs NAT interception.

...
> http_access deny !Safe_ports
> http_access deny CONNECT !SSL_ports
> http_access allow localhost manager
> http_access deny manager
> http_access allow localhost
> http_access allow all

Do not do "allow all" like this. Setup the localnet ACL to your LAN 
range(s) properly and only allow those clients through the proxy.

Then you can use the recommended default:
  http_access deny !Safe_ports
  http_access deny CONNECT !SSL_ports
  http_access allow localhost
  http_access deny manager
  http_access allow localnet
  http_access deny all

Amos


From nick-liste at posteo.eu  Thu Oct  5 09:20:39 2017
From: nick-liste at posteo.eu (Nicola Ferrari (#554252))
Date: Thu, 5 Oct 2017 11:20:39 +0200
Subject: [squid-users] New Squid 3.5 reconfigure causes service down
Message-ID: <0a2436a7-42f1-3677-70fc-0834c492281f@posteo.eu>

Hi List!

We're experiencing problems with a just-upgraded squid install (from
Debian 8 to Debian 9, using packages in repos). Here are the details
from squid -version:

Squid Cache: Version 3.5.23
Service Name: squid
Debian linux

We use "negotiate kerberos" authenticators to offer Active Directory SSO.

We're also running squidguard.

Lines in config file are:

[...]
# NEGOTIATE KERBEROS AUTH
auth_param negotiate program /usr/lib/squid/negotiate_wrapper_auth
--ntlm /usr/$
auth_param negotiate children 60
auth_param negotiate keep_alive off
[...]
url_rewrite_program /usr/bin/squidGuard -c /etc/squidguard/squidGuard.conf


The problem is that, issuing the "squid -k reconfigure" command (i.e. to
adjust acls in conf file) the result is not just a configuration reload,
but authenticators processes are restarting, causing an "out-of-service"
for all users, for a courple of minutes.

Basically the same issue as in this thread:
https://serverfault.com/questions/247835/squid-3-reloading-makes-it-stop-serving-requests

I'm in doubt if reducing helpers number would be a good idea, since we
need to serve ca. 300 simultaneous users.

Before the recent upgrade, with the previous Debian8, reload took some
seconds only..

Is there any best-practice to get an "Hot-Configurable" system?
Do you have any suggestion?

Thanks!
Best regards,


PS: English isn't my first language, so please excuse any mistakes..

-- 
+---------------------+
| Linux User  #554252 |
+---------------------+



From wehategrey at gmail.com  Thu Oct  5 09:32:03 2017
From: wehategrey at gmail.com (Grey)
Date: Thu, 5 Oct 2017 02:32:03 -0700 (MST)
Subject: [squid-users] Pages sometimes load as a mess of random (?)
	symbols
In-Reply-To: <b289ed33-cd21-23b6-132a-79123716d2f8@treenet.co.nz>
References: <1507126398090-0.post@n4.nabble.com>
 <bd08fe5c-bff9-914d-a1a7-164b323cc3f7@gmail.com>
 <201710041624.43782.Antony.Stone@squid.open.source.it>
 <059db02d-e201-615c-613c-4d02e5a07e73@treenet.co.nz>
 <1507185746517-0.post@n4.nabble.com>
 <b289ed33-cd21-23b6-132a-79123716d2f8@treenet.co.nz>
Message-ID: <1507195923420-0.post@n4.nabble.com>

Firstly, thanks a lot for taking the time to check my configuration and
provide such detailed suggestions; I think I've followed all of them and
fixed the problems you pointed out.
We have a Windows domain and all those "all" directives where inherited from
our old proxy server (running Squid verson 3.1.20) and were used to let
domain users not receive any popups asking for credentials, while at the
same time presenting those credentials requests to non-domain users; if I'm
understanding your comments correctly I can safely remove them and get the
same result, am I right?
We were having an issue with authentication too, where domain users
sometimes received a popup asking for credentials (shouldn't happen since I
have only enabled kerberos auth) and would need to click "Cancel" and reload
the page to resume browsing correctly; could the presence of all those "all"
directives have caused that too in your opinion?

The new configuration should result in this if I didn't miss/misunderstand
anything (I've addedd a whitelist rule that I missed earlier):

### TESTSQUID1 ###

http_port 3128
dns_v4_first on
pinger_enable off
netdb_filename none

error_default_language it
cache_mgr helpdesk at test.it

acl SSL_ports port 443
acl Safe_ports port 80		# http
acl Safe_ports port 21		# ftp
acl Safe_ports port 443		# https
acl Safe_ports port 70		# gopher
acl Safe_ports port 210		# wais
acl Safe_ports port 1025-65535	# unregistered ports
acl Safe_ports port 280		# http-mgmt
acl Safe_ports port 488		# gss-http
acl Safe_ports port 591		# filemaker
acl Safe_ports port 777		# multiling http
acl CONNECT method CONNECT

auth_param negotiate program /usr/lib/squid/negotiate_kerberos_auth -r -d
auth_param negotiate children 150
auth_param negotiate children 150 startup=20 idle=10
auth_param negotiate keep_alive on

external_acl_type ProxyUser children-max=75 %LOGIN
/usr/lib/squid/ext_kerberos_ldap_group_acl -g INTERNET at TEST.LOCAL -D
TEST.LOCAL -S testldap
acl ProxyUser external ProxyUser

http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost
http_access deny manager

acl destsquid dstdomain .testsquid1 .testsquid2
http_access allow destsquid

acl siti_whitelist dstdomain "/etc/squid/siti_whitelist"

acl AUTH proxy_auth REQUIRED
http_access deny !AUTH

http_access allow siti_whitelist
http_access allow ProxyUser
http_access deny all

icap_enable on
icap_send_client_ip on
icap_send_client_username on
icap_client_username_encode off
icap_client_username_header X-Authenticated-User
icap_preview_enable on
icap_preview_size 1024
icap_service service_req reqmod_precache bypass=1
icap://testicap:1344/REQ-Service
adaptation_access service_req allow all
icap_service service_resp respmod_precache bypass=0
icap://testicap:1344/resp
adaptation_access service_resp allow all

coredump_dir /var/spool/squid

refresh_pattern ^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
refresh_pattern .		0	20%	4320

Getting back to the main problem, i've set "icap_enable off" and reloaded
Squid, then tried again and got the same problem; since we're not using any
cache parent and Squid isn't using ICAP at the moment, can I assume there's
nothing else I can do and just have to ignore the problem?
The thing that bugs me is that only Chrome seems to be having this
particular problem... could this even be something linked to a bug or a
simple behaviour difference between Chrome and IE/Firefox?
Thanks again for all your patience :)



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From erdosain9 at gmail.com  Thu Oct  5 14:16:09 2017
From: erdosain9 at gmail.com (erdosain9)
Date: Thu, 5 Oct 2017 07:16:09 -0700 (MST)
Subject: [squid-users] Is your kerberos ticket expired?
Message-ID: <1507212969805-0.post@n4.nabble.com>

Hi.
All is working fine, but im having this error in the mail of root

------------------------------------------------------------------------------------------------------------------


>From root at squid.domain.lan  Tue Oct  3 04:00:02 2017
Return-Path: <root at squid.domain.lan>
X-Original-To: root
Delivered-To: root at squid.domain.lan
Received: by squid.domain.lan (Postfix, from userid 0)
	id 2581F8066D7F; Tue,  3 Oct 2017 04:00:02 -0300 (ART)
From: "(Cron Daemon)" <root at squid.domain.lan>
To: root at squid.domain.lan
Subject: Cron <root at squid>  msktutil --auto-update --verbose --computer-name
squidproxy-k | logger -t msktutil > /dev/null
Content-Type: text/plain; charset=UTF-8
Auto-Submitted: auto-generated
Precedence: bulk
X-Cron-Env: <XDG_SESSION_ID=666>
X-Cron-Env: <XDG_RUNTIME_DIR=/run/user/0>
X-Cron-Env: <LANG=es_AR.UTF-8>
X-Cron-Env: <SHELL=/bin/bash>
X-Cron-Env: <PATH=/sbin:/bin:/usr/sbin:/usr/bin>
X-Cron-Env: <MAILTO=root>
X-Cron-Env: <HOME=/root>
X-Cron-Env: <LOGNAME=root>
X-Cron-Env: <USER=root>
Message-Id: <20171003070002.2581F8066D7F at squid.domain.lan>
Date: Tue,  3 Oct 2017 04:00:02 -0300 (ART)

SASL/GSSAPI authentication started
Error: ldap_sasl_interactive_bind_s failed (Local error)
Error: ldap_connect failed
--> Is your kerberos ticket expired? You might try re-"kinit"ing.

>From root at squid.domain.lan  Wed Oct  4 04:00:02 2017
Return-Path: <root at squid.domain.lan>
X-Original-To: root
Delivered-To: root at squid.domain.lan
Received: by squid.domain.lan (Postfix, from userid 0)
	id 24EC282EEFD7; Wed,  4 Oct 2017 04:00:02 -0300 (ART)
From: "(Cron Daemon)" <root at squid.domain.lan>
To: root at squid.domain.lan
Subject: Cron <root at squid>  msktutil --auto-update --verbose --computer-name
squidproxy-k | logger -t msktutil > /dev/null
Content-Type: text/plain; charset=UTF-8
Auto-Submitted: auto-generated
Precedence: bulk
X-Cron-Env: <XDG_SESSION_ID=701>
X-Cron-Env: <XDG_RUNTIME_DIR=/run/user/0>
X-Cron-Env: <LANG=es_AR.UTF-8>
X-Cron-Env: <SHELL=/bin/bash>
X-Cron-Env: <PATH=/sbin:/bin:/usr/sbin:/usr/bin>
X-Cron-Env: <MAILTO=root>
X-Cron-Env: <HOME=/root>
X-Cron-Env: <LOGNAME=root>
X-Cron-Env: <USER=root>
Message-Id: <20171004070002.24EC282EEFD7 at squid.domain.lan>
Date: Wed,  4 Oct 2017 04:00:02 -0300 (ART)

SASL/GSSAPI authentication started
Error: ldap_sasl_interactive_bind_s failed (Local error)
Error: ldap_connect failed
--> Is your kerberos ticket expired? You might try re-"kinit"ing.

>From root at squid.domain.lan  Thu Oct  5 04:00:02 2017
Return-Path: <root at squid.domain.lan>
X-Original-To: root
Delivered-To: root at squid.domain.lan
Received: by squid.domain.lan (Postfix, from userid 0)
	id 9B89F8057477; Thu,  5 Oct 2017 04:00:02 -0300 (ART)
From: "(Cron Daemon)" <root at squid.domain.lan>
To: root at squid.domain.lan
Subject: Cron <root at squid>  msktutil --auto-update --verbose --computer-name
squidproxy-k | logger -t msktutil > /dev/null
Content-Type: text/plain; charset=UTF-8
Auto-Submitted: auto-generated
Precedence: bulk
X-Cron-Env: <XDG_SESSION_ID=736>
X-Cron-Env: <XDG_RUNTIME_DIR=/run/user/0>
X-Cron-Env: <LANG=es_AR.UTF-8>
X-Cron-Env: <SHELL=/bin/bash>
X-Cron-Env: <PATH=/sbin:/bin:/usr/sbin:/usr/bin>
X-Cron-Env: <MAILTO=root>
X-Cron-Env: <HOME=/root>
X-Cron-Env: <LOGNAME=root>
X-Cron-Env: <USER=root>
Message-Id: <20171005070002.9B89F8057477 at squid.domain.lan>
Date: Thu,  5 Oct 2017 04:00:02 -0300 (ART)

SASL/GSSAPI authentication started
Error: ldap_sasl_interactive_bind_s failed (Local error)
Error: ldap_connect failed
--> Is your kerberos ticket expired? You might try re-"kinit"ing.

----------------------------------------------------------------------------------------------------------------------------

[root at squid network-scripts]# systemctl status squid
? squid.service - Squid Web Proxy Server
   Loaded: loaded (/usr/lib/systemd/system/squid.service; enabled; vendor
preset: disabled)
   Active: active (running) since vie 2017-09-22 11:17:42 ART; 1 weeks 5
days ago
     Docs: man:squid(8)
  Process: 25024 ExecStop=/usr/sbin/squidshut.sh (code=exited,
status=0/SUCCESS)
  Process: 14166 ExecReload=/usr/sbin/squid -kreconf (code=exited,
status=0/SUCCESS)
  Process: 25048 ExecStart=/usr/sbin/squid -sYC (code=exited,
status=0/SUCCESS)
  Process: 25046 ExecStartPre=/usr/bin/chown squid.squid /var/run/squid
(code=exited, status=0/SUCCESS)
  Process: 25044 ExecStartPre=/usr/bin/mkdir -p /var/run/squid (code=exited,
status=0/SUCCESS)
 Main PID: 4613 (squid)
   CGroup: /system.slice/squid.service
           ?? 4613 (squid-1) -sYC
           ?? 4630 (unlinkd)
           ?? 4631 diskd 4723716 4723717 4723718
           ??14169 (logfile-daemon) /var/log/squid/access.log
           ??14170 (ssl_crtd) -s /var/lib/ssl_db -M 4MB
           ??14171 (ssl_crtd) -s /var/lib/ssl_db -M 4MB
           ??14172 (ssl_crtd) -s /var/lib/ssl_db -M 4MB
           ??14173 (ssl_crtd) -s /var/lib/ssl_db -M 4MB
           ??14174 (ssl_crtd) -s /var/lib/ssl_db -M 4MB
           ??14175 (ext_kerberos_ldap_group_acl) -g i-full at DOMAIN.LAN
           ??14176 (ext_kerberos_ldap_group_acl) -g i-full at DOMAIN.LAN
           ??14177 (ext_kerberos_ldap_group_acl) -g i-full at DOMAIN.LAN
           ??14178 (ext_kerberos_ldap_group_acl) -g i-full at DOMAIN.LAN
           ??14179 (ext_kerberos_ldap_group_acl) -g i-full at DOMAIN.LAN
           ??14180 (ext_kerberos_ldap_group_acl) -g i-limitado at DOMAIN.LAN
           ??14181 (ext_kerberos_ldap_group_acl) -g i-limitado at DOMAIN.LAN
           ??14182 (ext_kerberos_ldap_group_acl) -g i-limitado at DOMAIN.LAN
           ??14183 (ext_kerberos_ldap_group_acl) -g i-limitado at DOMAIN.LAN
           ??14184 (ext_kerberos_ldap_group_acl) -g i-limitado at DOMAIN.LAN
  ??14185 (negotiate_kerberos_auth) -s HTTP/squid.domain.lan at DOMAIN.LAN
           ??14186 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14187 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14188 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14189 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14190 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14194 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14195 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14196 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14208 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14209 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14210 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14211 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14212 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14213 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14214 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14215 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14216 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14217 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14218 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14219 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14220 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14221 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14222 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14223 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14224 (ssl_crtd) -s /var/lib/ssl_db -M 4MB
           ??14225 (ssl_crtd) -s /var/lib/ssl_db -M 4MB
           ??14232 (ssl_crtd) -s /var/lib/ssl_db -M 4MB
           ??14233 (ssl_crtd) -s /var/lib/ssl_db -M 4MB
           ??14247 (ssl_crtd) -s /var/lib/ssl_db -M 4MB
           ??14248 (ssl_crtd) -s /var/lib/ssl_db -M 4MB
           ??14249 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14250 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14251 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14252 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14253 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14254 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??14255 (negotiate_kerberos_auth) -s
HTTP/squid.domain.lan at DOMAIN.LAN
           ??25049 /usr/sbin/squid -sYC
oct 05 10:21:21 squid.domain.lan (ext_kerberos_ldap_group_acl)[14175]:
GSSAPI client step 1
oct 05 10:21:21 squid.domain.lan (ext_kerberos_ldap_group_acl)[14175]:
GSSAPI client step 2
oct 05 10:21:42 squid.domain.lan (ext_kerberos_ldap_group_acl)[14180]:
GSSAPI client step 1
oct 05 10:21:42 squid.domain.lan (ext_kerberos_ldap_group_acl)[14180]:
GSSAPI client step 1
oct 05 10:21:42 squid.domain.lan (ext_kerberos_ldap_group_acl)[14180]:
GSSAPI client step 1
oct 05 10:21:42 squid.domain.lan (ext_kerberos_ldap_group_acl)[14180]:
GSSAPI client step 2
oct 05 10:22:41 squid.domain.lan (ext_kerberos_ldap_group_acl)[14180]:
GSSAPI client step 1
oct 05 10:22:41 squid.domain.lan (ext_kerberos_ldap_group_acl)[14180]:
GSSAPI client step 1
oct 05 10:22:41 squid.domain.lan (ext_kerberos_ldap_group_acl)[14180]:
GSSAPI client step 1
oct 05 10:22:41 squid.domain.lan (ext_kerberos_ldap_group_acl)[14180]:
GSSAPI client step 2


------------------------------------------------------------------------------------------------------------------------------------------------------

[root at squid mail]# squidclient mgr:info
HTTP/1.1 200 OK
Server: squid/3.5.20
Mime-Version: 1.0
Date: Thu, 05 Oct 2017 14:12:50 GMT
Content-Type: text/plain;charset=utf-8
Expires: Thu, 05 Oct 2017 14:12:50 GMT
Last-Modified: Thu, 05 Oct 2017 14:12:50 GMT
X-Cache: MISS from squid.domain.lan
X-Cache-Lookup: MISS from squid.domain.lan:3128
Connection: close

Squid Object Cache: Version 3.5.20
Build Info: 
Service Name: squid
Start Time:	Fri, 29 Sep 2017 15:29:16 GMT
Current Time:	Thu, 05 Oct 2017 14:12:50 GMT
Connection information for squid:
	Number of clients accessing cache:	77
	Number of HTTP requests received:	3517870
	Number of ICP messages received:	0
	Number of ICP messages sent:	0
	Number of queued ICP replies:	0
	Number of HTCP messages received:	0
	Number of HTCP messages sent:	0
	Request failure ratio:	 0.00
	Average HTTP requests per minute since start:	410.8
	Average ICP messages per minute since start:	0.0
	Select loop called: 105232451 times, 4.883 ms avg
Cache information for squid:
	Hits as % of all requests:	5min: 4.0%, 60min: 7.4%
	Hits as % of bytes sent:	5min: 14.3%, 60min: 15.7%
	Memory hits as % of hit requests:	5min: 33.1%, 60min: 35.3%
	Disk hits as % of hit requests:	5min: 24.6%, 60min: 32.5%
	Storage Swap size:	13824016 KB
	Storage Swap capacity:	90.0% used, 10.0% free
	Storage Mem size:	507084 KB
	Storage Mem capacity:	99.0% used,  1.0% free
	Mean Object Size:	24.56 KB
	Requests given to unlinkd:	3941
Median Service Times (seconds)  5 min    60 min:
	HTTP Requests (All):   0.08265  0.15048
	Cache Misses:          0.24524  0.24524
	Cache Hits:            0.00678  0.00919
	Near Hits:             0.14252  0.16775
	Not-Modified Replies:  0.00000  0.00286
	DNS Lookups:           0.01269  0.02809
	ICP Queries:           0.00000  0.00000
Resource usage for squid:
	UP Time:	513813.916 seconds
	CPU Time:	23337.602 seconds
	CPU Usage:	4.54%
	CPU Usage, 5 minute avg:	20.31%
	CPU Usage, 60 minute avg:	20.81%
	Maximum Resident Size: 6920992 KB
	Page faults with physical i/o: 1572
Memory accounted for:
	Total accounted:       690414 KB
	memPoolAlloc calls: 800654584
	memPoolFree calls:  816579303
File descriptor usage for squid:
	Maximum number of file descriptors:   16384
	Largest file desc currently in use:    822
	Number of file desc currently in use:  643
	Files queued for open:                   0
	Available number of file descriptors: 15741
	Reserved number of file descriptors:   100
	Store Disk files open:                   0
Internal Data Structures:
	563484 StoreEntries
	 25823 StoreEntries with MemObjects
	 25488 Hot Object Cache Items
	562973 on-disk objects




--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From rousskov at measurement-factory.com  Thu Oct  5 16:25:53 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 5 Oct 2017 10:25:53 -0600
Subject: [squid-users] New Squid 3.5 reconfigure causes service down
In-Reply-To: <0a2436a7-42f1-3677-70fc-0834c492281f@posteo.eu>
References: <0a2436a7-42f1-3677-70fc-0834c492281f@posteo.eu>
Message-ID: <ca4ee786-2297-0804-19a4-56ff4ba4afc9@measurement-factory.com>

On 10/05/2017 03:20 AM, Nicola Ferrari (#554252) wrote:

> issuing the "squid -k reconfigure" command (i.e. to
> adjust acls in conf file) the result is not just a configuration reload,
> but authenticators processes are restarting,

As you have discovered already, running heavy unnecessary actions is a
known problem with Squid hot reconfiguration support. An upgrade may
have an effect on certain aspects of that problem, but the problem
itself is as old as Squid.


> causing an "out-of-service" for all users, for a courple of minutes.

The "couple of minutes" part might be related to your upgrade and, if
so, you may be able to avoid such delays. For list readers not familiar
with Debian releases, which _Squid_ version are you upgrading from?


> Basically the same issue as in this thread:
> https://serverfault.com/questions/247835/squid-3-reloading-makes-it-stop-serving-requests

The symptoms are the same but the underlying cause may be different
(unless you have already checked but did not tell us).


> I'm in doubt if reducing helpers number would be a good idea, since we
> need to serve ca. 300 simultaneous users.
> 
> Before the recent upgrade, with the previous Debian8, reload took some
> seconds only..
> 
> Is there any best-practice to get an "Hot-Configurable" system?
> Do you have any suggestion?


I suggest to start by figuring our what Squid is doing during those
"couple of minutes" if you have not already. The mailing list thread
linked from the above serverfault answer shows how to do that and has
several potentially useful comments. Compare the new logs with those of
your older Squid. What has changed related to the startup delays?


FWIW, there is now a low-priority project to support fast ACL-only
reconfiguration. We have the initial high-level design and some code,
but it will take a while (possibly a year or more) to complete at its
current priority.

http://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F


HTH,

Alex.


From nick-liste at posteo.eu  Thu Oct  5 16:44:40 2017
From: nick-liste at posteo.eu (Nicola Ferrari (#554252))
Date: Thu, 5 Oct 2017 18:44:40 +0200
Subject: [squid-users] New Squid 3.5 reconfigure causes service down
In-Reply-To: <ca4ee786-2297-0804-19a4-56ff4ba4afc9@measurement-factory.com>
References: <0a2436a7-42f1-3677-70fc-0834c492281f@posteo.eu>
 <ca4ee786-2297-0804-19a4-56ff4ba4afc9@measurement-factory.com>
Message-ID: <10b637f7-af0d-2034-c2f9-04433d1bc044@posteo.eu>

On 05/10/2017 18:25, Alex Rousskov wrote:
> The "couple of minutes" part might be related to your upgrade and, if
> so, you may be able to avoid such delays. For list readers not familiar
> with Debian releases, which _Squid_ version are you upgrading from?
>

I was running squid 3.4 on top of Debian 8 (jessie)
I upgraded to squid 3.5 on top of Debian 9 (stretch)

> I suggest to start by figuring our what Squid is doing during those
> "couple of minutes" if you have not already.

What I notice by checking cache.log is that it stops for a while on

helperOpenServers: Starting 1/60 'ntlm_auth' processes
2017/10/05 11:36:06 kid1| Starting new ntlmauthenticator helpers...

This was not a usual behaviour on Squid 3.4;

At the moment of the upgrade, I had to adjust various path from
"/squid3" to "/squid" ..

I checked authenticators path and other occurrences in conf file,
everything seems to be ok.

Just for testing purposes, I would try my config on a new clean install,
just to be sure this is not related to the upgrade in some way, and let
you know!

Nick



-- 
+---------------------+
| Linux User  #554252 |
+---------------------+



From xpro6000 at gmail.com  Thu Oct  5 16:54:28 2017
From: xpro6000 at gmail.com (xpro6000)
Date: Thu, 5 Oct 2017 12:54:28 -0400
Subject: [squid-users] Enable tproxy in Squid 3.5 running on Debian 9
In-Reply-To: <bc173936-0f34-aec9-e3fb-28ffacb6fe4a@treenet.co.nz>
References: <CAFoK1axoNtug=rrLKM8-DozBUX6j5Ld5FwGmyQDp_7o=fg=pJw@mail.gmail.com>
 <bc173936-0f34-aec9-e3fb-28ffacb6fe4a@treenet.co.nz>
Message-ID: <CAFoK1ayi1pXkORh5V-BDAwbGeUC-uxM0C5N5egkWw2znNv9JKg@mail.gmail.com>

I'm back to square one then, and it looks like there is no way to tell
Squid to use the same connecting ip for the outgoing ip, which is what I
need.

On Thu, Oct 5, 2017 at 3:49 AM, Amos Jeffries <squid3 at treenet.co.nz> wrote:

> On 05/10/17 15:01, xpro6000 wrote:
>
>> I'm trying to setup tproxy with Squid 3.5 for the purpose of having the
>> same outgoing ip as the connecting ip. (I have thousands of IPs and I can
>> not add them one by one)
>>
>> I started with a fresh install of Debian 9, installed Squid by
>>
>> apt install squid
>>
>> then I added
>>
>> http_port 3129 tproxy
>>
>> to squid.conf
>>
>> I then ran the following commands for iptables
>>
>> iptables -t mangle -N DIVERT
>> iptables -t mangle -A DIVERT -j MARK --set-mark 1
>> iptables -t mangle -A DIVERT -j ACCEPT
>>
>> iptables  -t mangle -A PREROUTING -p tcp -m socket -j DIVERT
>>
>> iptables  -t mangle -A PREROUTING -p tcp --dport 80 -j TPROXY
>> --tproxy-mark 0x1/0x1 --on-port 3129
>>
>>
>> I can use the proxy with no problems on port 3128, but on Firefox I get a
>> message "The proxy server is refusing connections" when I set the proxy to
>> port 3129. Did I miss any steps or am I doing something wrong?
>>
>
> You missed the fact that TPROXY is an MITM operation. You *cannot* setup
> the browser to use the proxy directly to its tproxy port. You have to route
> the packets to the proxy machine without any explicit browser or client
> configuration.
>
> Only the Squid machine bits (and thus behaviour) are different with TPROXY
> vs NAT interception.
>
> ...
>
>> http_access deny !Safe_ports
>> http_access deny CONNECT !SSL_ports
>> http_access allow localhost manager
>> http_access deny manager
>> http_access allow localhost
>> http_access allow all
>>
>
> Do not do "allow all" like this. Setup the localnet ACL to your LAN
> range(s) properly and only allow those clients through the proxy.
>
> Then you can use the recommended default:
>  http_access deny !Safe_ports
>  http_access deny CONNECT !SSL_ports
>  http_access allow localhost
>  http_access deny manager
>  http_access allow localnet
>  http_access deny all
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171005/9aa83579/attachment.htm>

From rousskov at measurement-factory.com  Thu Oct  5 17:28:06 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 5 Oct 2017 11:28:06 -0600
Subject: [squid-users] New Squid 3.5 reconfigure causes service down
In-Reply-To: <10b637f7-af0d-2034-c2f9-04433d1bc044@posteo.eu>
References: <0a2436a7-42f1-3677-70fc-0834c492281f@posteo.eu>
 <ca4ee786-2297-0804-19a4-56ff4ba4afc9@measurement-factory.com>
 <10b637f7-af0d-2034-c2f9-04433d1bc044@posteo.eu>
Message-ID: <beda769e-8155-387e-123f-fed5d9fd7195@measurement-factory.com>

On 10/05/2017 10:44 AM, Nicola Ferrari (#554252) wrote:
> On 05/10/2017 18:25, Alex Rousskov wrote:
>> The "couple of minutes" part might be related to your upgrade and, if
>> so, you may be able to avoid such delays. For list readers not familiar
>> with Debian releases, which _Squid_ version are you upgrading from?

> I was running squid 3.4 on top of Debian 8 (jessie)
> I upgraded to squid 3.5 on top of Debian 9 (stretch)

>> I suggest to start by figuring our what Squid is doing during those
>> "couple of minutes" if you have not already.
> 
> What I notice by checking cache.log is that it stops for a while on
> 
> helperOpenServers: Starting 1/60 'ntlm_auth' processes
> 2017/10/05 11:36:06 kid1| Starting new ntlmauthenticator helpers...
> 
> This was not a usual behaviour on Squid 3.4;

The next task is to figure out what changed related to that line (i.e.,
to starting ntlmauthenticator helpers). Here are a few things you may
want to check: Do you start the same number of helpers as before? Does
starting a single helper take longer in v3.5 than in v3.4? Does Squid
v3.5 consume a lot more RAM before it tries to start that helper than
Squid v3.4 consumed? Does Squid v3.5 helper itself consume a lot more
RAM than Squid v3.4 helper?

Something must have changed. If you can pinpoint that change, it is
likely that you can reverse or work around it. Since we probably do not
know what that change is, have no access to your server, and no free
time to investigate, you have to narrow the suspects down yourself.


> Just for testing purposes, I would try my config on a new clean install

That is a good initial test as well. And remember that you are not
looking for something that broke or does not work. You are looking for
something that works differently. And your initial focus should be on
things that affect helper startup (i.e., fork() and exec() system
calls): process size, number of processes, etc. Commands like strace can
help you measure delays down to a single system call level if needed.


Good luck,

Alex.


From rightkicktech at gmail.com  Thu Oct  5 20:03:44 2017
From: rightkicktech at gmail.com (Alex K)
Date: Thu, 5 Oct 2017 23:03:44 +0300
Subject: [squid-users] Enable tproxy in Squid 3.5 running on Debian 9
In-Reply-To: <CAFoK1ayi1pXkORh5V-BDAwbGeUC-uxM0C5N5egkWw2znNv9JKg@mail.gmail.com>
References: <CAFoK1axoNtug=rrLKM8-DozBUX6j5Ld5FwGmyQDp_7o=fg=pJw@mail.gmail.com>
 <bc173936-0f34-aec9-e3fb-28ffacb6fe4a@treenet.co.nz>
 <CAFoK1ayi1pXkORh5V-BDAwbGeUC-uxM0C5N5egkWw2znNv9JKg@mail.gmail.com>
Message-ID: <CABMULtLSHTDcd2c7NbjKnLHewYKwV1VUhHWyLUT_riEM9gbuOQ@mail.gmail.com>

You will need to transpareny redirect the traffic and not explicitly
pointing your browser to squid. Seems that the mentioned firewall rules are
correct. You will need a policy route also for the marked traffic.

On Oct 5, 2017 7:54 PM, "xpro6000" <xpro6000 at gmail.com> wrote:

I'm back to square one then, and it looks like there is no way to tell
Squid to use the same connecting ip for the outgoing ip, which is what I
need.

On Thu, Oct 5, 2017 at 3:49 AM, Amos Jeffries <squid3 at treenet.co.nz> wrote:

> On 05/10/17 15:01, xpro6000 wrote:
>
>> I'm trying to setup tproxy with Squid 3.5 for the purpose of having the
>> same outgoing ip as the connecting ip. (I have thousands of IPs and I can
>> not add them one by one)
>>
>> I started with a fresh install of Debian 9, installed Squid by
>>
>> apt install squid
>>
>> then I added
>>
>> http_port 3129 tproxy
>>
>> to squid.conf
>>
>> I then ran the following commands for iptables
>>
>> iptables -t mangle -N DIVERT
>> iptables -t mangle -A DIVERT -j MARK --set-mark 1
>> iptables -t mangle -A DIVERT -j ACCEPT
>>
>> iptables  -t mangle -A PREROUTING -p tcp -m socket -j DIVERT
>>
>> iptables  -t mangle -A PREROUTING -p tcp --dport 80 -j TPROXY
>> --tproxy-mark 0x1/0x1 --on-port 3129
>>
>>
>> I can use the proxy with no problems on port 3128, but on Firefox I get a
>> message "The proxy server is refusing connections" when I set the proxy to
>> port 3129. Did I miss any steps or am I doing something wrong?
>>
>
> You missed the fact that TPROXY is an MITM operation. You *cannot* setup
> the browser to use the proxy directly to its tproxy port. You have to route
> the packets to the proxy machine without any explicit browser or client
> configuration.
>
> Only the Squid machine bits (and thus behaviour) are different with TPROXY
> vs NAT interception.
>
> ...
>
>> http_access deny !Safe_ports
>> http_access deny CONNECT !SSL_ports
>> http_access allow localhost manager
>> http_access deny manager
>> http_access allow localhost
>> http_access allow all
>>
>
> Do not do "allow all" like this. Setup the localnet ACL to your LAN
> range(s) properly and only allow those clients through the proxy.
>
> Then you can use the recommended default:
>  http_access deny !Safe_ports
>  http_access deny CONNECT !SSL_ports
>  http_access allow localhost
>  http_access deny manager
>  http_access allow localnet
>  http_access deny all
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171005/f51c523d/attachment.htm>

From commx at commx.ws  Thu Oct  5 21:12:35 2017
From: commx at commx.ws (C. Kroeger)
Date: Thu, 5 Oct 2017 23:12:35 +0200
Subject: [squid-users] SNI-based forwarding to parent proxy
Message-ID: <CAFw_dis3BbAWkBsNB4s6s_Chod_nq+oeri81GsfNdaA5LDDDJA@mail.gmail.com>

Hi there,

i've been new to squid and trying to get a certain problem solved. I
have a setup with an VPN server, redirecting any traffic to its port
80/443 to a squid server. The users within that VPN can browse the web
(both http and https) without any problems.

However, I need to redirect http(s) traffic for a list of domains to
another proxy. While this works fine for http, it doesn't work for
https, even with the peek-n-slice functionality available in 3.5+.

Below is my current configuration:

```
http_port 3128
https_port 3130 intercept ssl-bump generate-host-certificates=on
dynamic_cert_mem_cache_size=4MB cert=/etc/squid/ssl/squid.pem
options=NO_SSLv2:NO_SSLv3
sslcrtd_program /usr/lib64/squid/ssl_crtd -s /var/lib/squid/ssl_db -M
4MB sslcrtd_children 8 startup=1 idle=1

# peek SNI and splice all https connections for tunneling
acl step1 at_step SslBump1
ssl_bump peek step1
ssl_bump splice all

# ACL for SNIs that need to be forwarded to another proxy
acl sni_fwd ssl::server_name .google.com

# redirect matching traffic to another proxy
cache_peer 10.0.2.115 parent 3128 0 no-query default name=px2
cache_peer_access px2 allow sni_fwd
cache_peer_access px2 deny all
```

Surprisingly, http requests are sent to px2, but https ones are not.
What I'm doing wrong here?

Note: Requests not matching the SNI ACL shall not be forwarded and
processed directly.

Best regards,
Christian


From eliezer at ngtech.co.il  Fri Oct  6 00:33:31 2017
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Fri, 6 Oct 2017 03:33:31 +0300
Subject: [squid-users] Enable tproxy in Squid 3.5 running on Debian 9
In-Reply-To: <CAFoK1ayi1pXkORh5V-BDAwbGeUC-uxM0C5N5egkWw2znNv9JKg@mail.gmail.com>
References: <CAFoK1axoNtug=rrLKM8-DozBUX6j5Ld5FwGmyQDp_7o=fg=pJw@mail.gmail.com>
 <bc173936-0f34-aec9-e3fb-28ffacb6fe4a@treenet.co.nz>
 <CAFoK1ayi1pXkORh5V-BDAwbGeUC-uxM0C5N5egkWw2znNv9JKg@mail.gmail.com>
Message-ID: <067201d33e3a$bc6b72e0$354258a0$@ngtech.co.il>

Hey,

Can you clarify the network topology of your setup?
Also is squid another machine on lan and you are using another router or squid sits in the a DMZ?
Can you add ip addresses of:
- client machine
- squid
- router of this network?

Thanks,
Eliezer

----
http://ngtech.co.il/lmgtfy/
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il


From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of xpro6000
Sent: Thursday, October 5, 2017 19:54
To: Amos Jeffries <squid3 at treenet.co.nz>
Cc: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Enable tproxy in Squid 3.5 running on Debian 9

I'm back to square one then, and it looks like there is no way to tell Squid to use the same connecting ip for the outgoing ip, which is what I need.

On Thu, Oct 5, 2017 at 3:49 AM, Amos Jeffries <mailto:squid3 at treenet.co.nz> wrote:
On 05/10/17 15:01, xpro6000 wrote:
I'm trying to setup tproxy with Squid 3.5 for the purpose of having the same outgoing ip as the connecting ip. (I have thousands of IPs and I can not add them one by one)

I started with a fresh install of Debian 9, installed Squid by

apt install squid

then I added

http_port 3129 tproxy

to squid.conf

I then ran the following commands for iptables

iptables -t mangle -N DIVERT
iptables -t mangle -A DIVERT -j MARK --set-mark 1
iptables -t mangle -A DIVERT -j ACCEPT

iptables  -t mangle -A PREROUTING -p tcp -m socket -j DIVERT

iptables  -t mangle -A PREROUTING -p tcp --dport 80 -j TPROXY --tproxy-mark 0x1/0x1 --on-port 3129


I can use the proxy with no problems on port 3128, but on Firefox I get a message "The proxy server is refusing connections" when I set the proxy to port 3129. Did I miss any steps or am I doing something wrong?

You missed the fact that TPROXY is an MITM operation. You *cannot* setup the browser to use the proxy directly to its tproxy port. You have to route the packets to the proxy machine without any explicit browser or client configuration.

Only the Squid machine bits (and thus behaviour) are different with TPROXY vs NAT interception.

...
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
http_access allow localhost
http_access allow all

Do not do "allow all" like this. Setup the localnet ACL to your LAN range(s) properly and only allow those clients through the proxy.

Then you can use the recommended default:
 http_access deny !Safe_ports
 http_access deny CONNECT !SSL_ports
 http_access allow localhost
 http_access deny manager
 http_access allow localnet
 http_access deny all

Amos
_______________________________________________
squid-users mailing list
mailto:squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users




From eliezer at ngtech.co.il  Fri Oct  6 00:43:10 2017
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Fri, 6 Oct 2017 03:43:10 +0300
Subject: [squid-users] SSL Bump Failures with Google and Wikipedia
In-Reply-To: <3d87fae7-e104-6ef1-1ab6-67bb7e0e79a8@gmail.com>
References: <CA+ekxPVs_Nho43T=jtF+pvzs5jNn9j63mWLxpDJda=VkVhkX6w@mail.gmail.com>
 <01c001d33a31$af7c16f0$0e7444d0$@ngtech.co.il>
 <CA+ekxPUSMGNS1tr7nztMM2NaJVQgZyOLK8S+QZKhsoWBaR8tUA@mail.gmail.com>
 <BBEC09F5-1AB6-481E-92C4-F250C51B01D6@diladele.com>
 <023501d33a51$5cea5760$16bf0620$@ngtech.co.il>
 <3d87fae7-e104-6ef1-1ab6-67bb7e0e79a8@gmail.com>
Message-ID: <067401d33e3c$15bb6980$41323c80$@ngtech.co.il>

Hey Yuri and Rafael,

I have tried to find a site which uses brotli compression but yet to find one.
Also I have not seen any brotli request headers in firefox or chrome, maybe there is a specific browser which uses it?

Thanks,
Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il


-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Yuri
Sent: Sunday, October 1, 2017 04:08
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] SSL Bump Failures with Google and Wikipedia

I guess in HTTP headers. =-O :-D


01.10.2017 7:05, Eliezer Croitoru ?????:
> Hey Rafael,
>
> Where have you seen the details about brotli being used?
>
> Thanks,
> Eliezer
>
> ----
> Eliezer Croitoru
> Linux System Administrator
> Mobile: +972-5-28704261
> Email: eliezer at ngtech.co.il
>
>
>
> -----Original Message-----
> From: Rafael Akchurin [mailto:rafael.akchurin at diladele.com]
> Sent: Sunday, October 1, 2017 01:16
> To: Jeffrey Merkey <jeffmerkey at gmail.com>
> Cc: Eliezer Croitoru <eliezer at ngtech.co.il>; squid-users 
> <squid-users at lists.squid-cache.org>
> Subject: Re: [squid-users] SSL Bump Failures with Google and Wikipedia
>
> Hello Jeff,
>
> Do not forget Google and YouTube are now using brotli encoding 
> extensively, not only gzip.
>
> Best regards,
> Rafael Akchurin
>
>> Op 30 sep. 2017 om 23:49 heeft Jeffrey Merkey <jeffmerkey at gmail.com> 
>> het
> volgende geschreven:
>>> On 9/30/17, Eliezer Croitoru <eliezer at ngtech.co.il> wrote:
>>> Hey Jeffrey,
>>>
>>> What happens when you disable the next icap service this way:
>>> icap_service service_avi_resp respmod_precache 
>>> icap://127.0.0.1:1344/cherokee bypass=0 adaptation_access 
>>> service_avi_resp deny all
>>>
>>> Is it still the same?
>>> What I suspect is that the requests are defined to accept gzip 
>>> compressed objects and the icap service is not "gnuzip" them which 
>>> results in what you see.
>>>
>>> To make sure that squid is not at fault here try to disable both 
>>> icap services and then add then one at a time and see which of this 
>>> triangle is giving you trouble.
>>> I enhanced an ICAP library which is written in GoLang at:
>>> https://github.com/elico/icap
>>>
>>> And I have couple examples on how to work with http requests and 
>>> responses
>>> at:
>>> https://github.com/andybalholm/redwood/
>>> https://github.com/andybalholm/redwood/search?utf8=%E2%9C%93&q=gzip&
>>> t
>>> ype=
>>>
>>> Let me know if you need help finding out the issue.
>>>
>>> All The Bests,
>>> Eliezer
>>>
>>> ----
>>> Eliezer Croitoru
>>> Linux System Administrator
>>> Mobile: +972-5-28704261
>>> Email: eliezer at ngtech.co.il
>>>
>>>
>>>
>>> -----Original Message-----
>>> From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org]
>>> On Behalf Of Jeffrey Merkey
>>> Sent: Saturday, September 30, 2017 23:28
>>> To: squid-users <squid-users at lists.squid-cache.org>
>>> Subject: [squid-users] SSL Bump Failures with Google and Wikipedia
>>>
>>> Hello All,
>>>
>>> I have been working with the squid server and icap and I have been 
>>> running into problems with content cached from google and wikipedia.
>>> Some sites using https, such as Centos.org work perfectly with ssl 
>>> bumping and I get the decrypted content as html and it's readable.
>>> Other sites, such as google and wikipedia return what looks like 
>>> encrypted traffic, or perhaps mime encoded data, I am not sure which.
>>>
>>> Are there cases where squid will default to direct mode and not 
>>> decrypt the traffic?  I am using the latest squid server 3.5.27.  I 
>>> really would like to get this working with google and wikipedia.  I 
>>> reviewed the page source code from the browser viewer and it looks 
>>> nothing like the data I am getting via the icap server.
>>>
>>> Any assistance would be greatly appreciated.
>>>
>>> The config I am using is:
>>>
>>> #
>>> # Recommended minimum configuration:
>>> #
>>>
>>> # Example rule allowing access from your local networks.
>>> # Adapt to list your (internal) IP networks from where browsing # 
>>> should be allowed
>>>
>>> acl localnet src 127.0.0.1
>>> acl localnet src 10.0.0.0/8     # RFC1918 possible internal network
>>> acl localnet src 172.16.0.0/12  # RFC1918 possible internal network 
>>> acl localnet src 192.168.0.0/16 # RFC1918 possible internal network
>>> acl localnet src fc00::/7       # RFC 4193 local private network range
>>> acl localnet src fe80::/10      # RFC 4291 link-local (directly
>>> plugged) machines
>>>
>>> acl SSL_ports port 443
>>> acl Safe_ports port 80          # http
>>> acl Safe_ports port 21          # ftp
>>> acl Safe_ports port 443         # https
>>> acl Safe_ports port 70          # gopher
>>> acl Safe_ports port 210         # wais
>>> acl Safe_ports port 1025-65535  # unregistered ports
>>> acl Safe_ports port 280         # http-mgmt
>>> acl Safe_ports port 488         # gss-http
>>> acl Safe_ports port 591         # filemaker
>>> acl Safe_ports port 777         # multiling http
>>> acl CONNECT method CONNECT
>>>
>>> #
>>> # Recommended minimum Access Permission configuration:
>>> #
>>> # Deny requests to certain unsafe ports http_access deny !Safe_ports
>>>
>>> # Deny CONNECT to other than secure SSL ports http_access deny 
>>> CONNECT !SSL_ports
>>>
>>> # Only allow cachemgr access from localhost http_access allow 
>>> localhost manager http_access deny manager
>>>
>>> # We strongly recommend the following be uncommented to protect 
>>> innocent # web applications running on the proxy server who think 
>>> the only # one who can access services on "localhost" is a local 
>>> user #http_access deny to_localhost
>>>
>>> #
>>> # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS #
>>>
>>> # Example rule allowing access from your local networks.
>>> # Adapt localnet in the ACL section to list your (internal) IP 
>>> networks # from where browsing should be allowed http_access allow 
>>> localnet http_access allow localhost
>>>
>>> # And finally deny all other access to this proxy http_access deny 
>>> all
>>>
>>> # Squid normally listens to port 3128 #http_port 3128
>>>
>>> # Uncomment and adjust the following to add a disk cache directory.
>>> #cache_dir ufs /usr/local/squid/var/cache/squid 100 16 256
>>>
>>> # Leave coredumps in the first cache dir coredump_dir 
>>> /usr/local/squid/var/cache/squid
>>>
>>> #
>>> # Add any of your own refresh_pattern entries above these.
>>> #
>>> refresh_pattern ^ftp:           1440    20%     10080
>>> refresh_pattern ^gopher:        1440    0%      1440
>>> refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
>>> refresh_pattern .               0       20%     4320
>>>
>>> http_port 3128 ssl-bump generate-host-certificates=on 
>>> dynamic_cert_mem_cache_size=4MB cert=/etc/squid/ssl_cert/myCA.pem 
>>> http_port 3129
>>>
>>> # SSL Bump Config
>>> always_direct allow all
>>> ssl_bump server-first all
>>> sslproxy_cert_error deny all
>>> sslproxy_flags DONT_VERIFY_PEER
>>> sslcrtd_program /usr/local/squid/libexec/ssl_crtd -s /var/lib/ssl_db 
>>> -M 4MB sslcrtd_children 8 startup=1 idle=1
>>>
>>> # For squid 3.5.x
>>> #sslcrtd_program /usr/local/squid/libexec/ssl_crtd -s 
>>> /var/lib/ssl_db -M 4MB
>>>
>>> # For squid 4.x
>>> # sslcrtd_program /usr/local/squid/libexec/security_file_certgen -s 
>>> /var/lib/ssl_db -M 4MB
>>>
>>> icap_enable on
>>> icap_send_client_ip on
>>> icap_send_client_username on
>>> icap_client_username_header X-Authenticated-User icap_preview_enable 
>>> on icap_preview_size 1024 icap_service service_avi_req 
>>> reqmod_precache icap://127.0.0.1:1344/request
>>> bypass=1
>>> adaptation_access service_avi_req allow all
>>>
>>> icap_service service_avi_resp respmod_precache 
>>> icap://127.0.0.1:1344/cherokee bypass=0 adaptation_access 
>>> service_avi_resp allow all
>>>
>>> Jeff
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users
>>>
>>>
>> Eliezer,
>>
>> Well, you certainly hit the nail on the head.  I added the following 
>> code to check the content being sent to the icap server from squid, 
>> and here is what I found when I check the headers being sent from the 
>> remote web server:
>>
>> Code to check for content type and encoding received by the icap 
>> server added to c-icap:
>>
>>    hdrs = ci_http_response_headers(req);
>>    content_type = ci_headers_value(hdrs, "Content-Type");
>>    if (content_type)
>>       ci_debug_printf(1,"srv_cherokee:  content-type: %s\n",
>>                       content_type);
>>
>>    content_encoding = ci_headers_value(hdrs, "Content-Encoding");
>>    if (content_encoding)
>>       ci_debug_printf(1,"srv_cherokee:  content-encoding: %s\n",
>>                       content_encoding);
>>
>> And the output from scanned pages sent over from squid:
>>
>> srv_cherokee:  init request 0x7f3dbc008eb0 pool hits:1 allocations: 1 
>> Allocating from objects pool object 5 pool hits:1 allocations: 1 
>> Geting buffer from pool 4096:1 Requested service: cherokee Read 
>> preview data if there are and process request
>> srv_cherokee:  content-type: text/html; charset=utf-8
>> srv_cherokee:  content-encoding: gzip         <-- As you stated, I am
>> getting gzipped data
>> srv_cherokee:  we expect to read :-1 body data Allow 204...
>> Preview handler return allow 204 response
>> srv_cherokee:  release request 0x7f3dbc008eb0 Store buffer to long 
>> pool 4096:1 Storing to objects pool object 5 Log request to access 
>> log file /var/log/i-cap_access.log
>>
>>
>> Wikipedia  at https://en.wikipedia.org/wiki/HTTP_compression 
>> describes the process as:
>>
>> " ...
>>   Compression scheme negotiation[edit]
>>   In most cases, excluding the SDCH, the negotiation is done in two 
>> steps, described in
>>   RFC 2616:
>>
>>   1. The web client advertises which compression schemes it supports 
>> by including a list
>>   of tokens in the HTTP request. For Content-Encoding, the list in a 
>> field called Accept -
>>   Encoding; for Transfer-Encoding, the field is called TE.
>>
>>   GET /encrypted-area HTTP/1.1
>>   Host: www.example.com
>>   Accept-Encoding: gzip, deflate
>>
>>   2. If the server supports one or more compression schemes, the 
>> outgoing data may be
>>   compressed by one or more methods supported by both parties. If 
>> this is the case, the
>>   server will add a Content-Encoding or Transfer-Encoding field in 
>> the HTTP response with
>>   the used schemes, separated by commas.
>>
>>   HTTP/1.1 200 OK
>>   Date: mon, 26 June 2016 22:38:34 GMT
>>   Server: Apache/1.3.3.7 (Unix)  (Red-Hat/Linux)
>>   Last-Modified: Wed, 08 Jan 2003 23:11:55 GMT
>>   Accept-Ranges: bytes
>>   Content-Length: 438
>>   Connection: close
>>   Content-Type: text/html; charset=UTF-8
>>   Content-Encoding: gzip
>>
>>   The web server is by no means obligated to use any compression 
>> method -
> this
>>   depends on the internal settings of the web server and also may 
>> depend on the internal
>>   architecture of the website in question.
>>
>>   In case of SDCH a dictionary negotiation is also required, which 
>> may involve additional
>>   steps, like downloading a proper dictionary from .
>> .."
>>
>>
>> So, it looks like it is a feature of the browser.  So, is it possible 
>> to have squid gunzip the data or configure the browser not to send 
>> the header  to remove "Accept-Encoding: gzip, deflate" from the 
>> request sent to the remote server telling it to gzip the data?
>>
>> Thanks
>>
>> Jeff
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users





From mymohaja at gmail.com  Fri Oct  6 01:09:41 2017
From: mymohaja at gmail.com (Mohd Akhbar)
Date: Fri, 6 Oct 2017 09:09:41 +0800
Subject: [squid-users] YouTube\GoogleVideo caching is here,
	tested and verified.
In-Reply-To: <0aca01d33ca2$e7f1d330$b7d57990$@ngtech.co.il>
References: <0aca01d33ca2$e7f1d330$b7d57990$@ngtech.co.il>
Message-ID: <CAE2_gsXWxS28oM-5EmLr0vws26_Jv1yBrCq0RoQfHy2R46LR6w@mail.gmail.com>

Hi,
would you mind sharing the details steps, or have you documented it
anywhere that we can refer. For me, i would like to test in my school env
and maye al so be beneficial for education purposes. Another thing is, does
you solution will save a specific video res like 720p or is it vbr ?

And what squid version available for this solution ? i'm using version 3.5
(latest stable).

Thank you

On Wed, Oct 4, 2017 at 7:54 AM, Eliezer Croitoru <eliezer at ngtech.co.il>
wrote:

> Hey All,
>
> After quite some time I have compiled a solution for YouTube videos caching
> for PC's.
> The next step would be to cache it for mobile devices but I am looking for
> someone who wants this solution.
> The only drawback is that this solution is designed for
> intercept\transparent proxies and not tproxy but it might work on these
> too.
>
> The installation is pretty simple on a systemd based OS like Debian 8+9,
> Ubuntu 16.04, CentOS\RHEK 7, Oracle Enterprise Linux 7 and OpenSUSE leap
> and
> above.
> It consists of four components:
> - local redis DB
> - ICAP service binary
> - ICAP service system service unit file
> - ruby StoreID script
>
> And of course a special squid.conf with ssl_bump enabled.
>
> For now I will not package it using RPM or DEB and will use a shell script
> or README.md that describes the installation and usage steps.
> Contact me here or by a PM.
>
> Eliezer
>
> ----
> Eliezer Croitoru
> Linux System Administrator
> Mobile: +972-5-28704261
> Email: eliezer at ngtech.co.il
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171006/adbf42ca/attachment.htm>

From rafael.akchurin at diladele.com  Fri Oct  6 05:24:08 2017
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Fri, 6 Oct 2017 05:24:08 +0000
Subject: [squid-users] SSL Bump Failures with Google and Wikipedia
In-Reply-To: <067401d33e3c$15bb6980$41323c80$@ngtech.co.il>
References: <CA+ekxPVs_Nho43T=jtF+pvzs5jNn9j63mWLxpDJda=VkVhkX6w@mail.gmail.com>
 <01c001d33a31$af7c16f0$0e7444d0$@ngtech.co.il>
 <CA+ekxPUSMGNS1tr7nztMM2NaJVQgZyOLK8S+QZKhsoWBaR8tUA@mail.gmail.com>
 <BBEC09F5-1AB6-481E-92C4-F250C51B01D6@diladele.com>
 <023501d33a51$5cea5760$16bf0620$@ngtech.co.il>
 <3d87fae7-e104-6ef1-1ab6-67bb7e0e79a8@gmail.com>,
 <067401d33e3c$15bb6980$41323c80$@ngtech.co.il>
Message-ID: <539D88BC-0B89-4E64-A9B0-45389ED43878@diladele.com>

Hello Eliezer,

>From desktop ff/chrome goto youtube. It will be br encoded.

Best regards,
Rafael Akchurin

> Op 6 okt. 2017 om 02:43 heeft Eliezer Croitoru <eliezer at ngtech.co.il> het volgende geschreven:
> 
> Hey Yuri and Rafael,
> 
> I have tried to find a site which uses brotli compression but yet to find one.
> Also I have not seen any brotli request headers in firefox or chrome, maybe there is a specific browser which uses it?
> 
> Thanks,
> Eliezer
> 
> ----
> Eliezer Croitoru
> Linux System Administrator
> Mobile: +972-5-28704261
> Email: eliezer at ngtech.co.il
> 
> 
> -----Original Message-----
> From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Yuri
> Sent: Sunday, October 1, 2017 04:08
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] SSL Bump Failures with Google and Wikipedia
> 
> I guess in HTTP headers. =-O :-D
> 
> 
> 01.10.2017 7:05, Eliezer Croitoru ?????:
>> Hey Rafael,
>> 
>> Where have you seen the details about brotli being used?
>> 
>> Thanks,
>> Eliezer
>> 
>> ----
>> Eliezer Croitoru
>> Linux System Administrator
>> Mobile: +972-5-28704261
>> Email: eliezer at ngtech.co.il
>> 
>> 
>> 
>> -----Original Message-----
>> From: Rafael Akchurin [mailto:rafael.akchurin at diladele.com]
>> Sent: Sunday, October 1, 2017 01:16
>> To: Jeffrey Merkey <jeffmerkey at gmail.com>
>> Cc: Eliezer Croitoru <eliezer at ngtech.co.il>; squid-users 
>> <squid-users at lists.squid-cache.org>
>> Subject: Re: [squid-users] SSL Bump Failures with Google and Wikipedia
>> 
>> Hello Jeff,
>> 
>> Do not forget Google and YouTube are now using brotli encoding 
>> extensively, not only gzip.
>> 
>> Best regards,
>> Rafael Akchurin
>> 
>>> Op 30 sep. 2017 om 23:49 heeft Jeffrey Merkey <jeffmerkey at gmail.com> 
>>> het
>> volgende geschreven:
>>>> On 9/30/17, Eliezer Croitoru <eliezer at ngtech.co.il> wrote:
>>>> Hey Jeffrey,
>>>> 
>>>> What happens when you disable the next icap service this way:
>>>> icap_service service_avi_resp respmod_precache 
>>>> icap://127.0.0.1:1344/cherokee bypass=0 adaptation_access 
>>>> service_avi_resp deny all
>>>> 
>>>> Is it still the same?
>>>> What I suspect is that the requests are defined to accept gzip 
>>>> compressed objects and the icap service is not "gnuzip" them which 
>>>> results in what you see.
>>>> 
>>>> To make sure that squid is not at fault here try to disable both 
>>>> icap services and then add then one at a time and see which of this 
>>>> triangle is giving you trouble.
>>>> I enhanced an ICAP library which is written in GoLang at:
>>>> https://github.com/elico/icap
>>>> 
>>>> And I have couple examples on how to work with http requests and 
>>>> responses
>>>> at:
>>>> https://github.com/andybalholm/redwood/
>>>> https://github.com/andybalholm/redwood/search?utf8=%E2%9C%93&q=gzip&
>>>> t
>>>> ype=
>>>> 
>>>> Let me know if you need help finding out the issue.
>>>> 
>>>> All The Bests,
>>>> Eliezer
>>>> 
>>>> ----
>>>> Eliezer Croitoru
>>>> Linux System Administrator
>>>> Mobile: +972-5-28704261
>>>> Email: eliezer at ngtech.co.il
>>>> 
>>>> 
>>>> 
>>>> -----Original Message-----
>>>> From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org]
>>>> On Behalf Of Jeffrey Merkey
>>>> Sent: Saturday, September 30, 2017 23:28
>>>> To: squid-users <squid-users at lists.squid-cache.org>
>>>> Subject: [squid-users] SSL Bump Failures with Google and Wikipedia
>>>> 
>>>> Hello All,
>>>> 
>>>> I have been working with the squid server and icap and I have been 
>>>> running into problems with content cached from google and wikipedia.
>>>> Some sites using https, such as Centos.org work perfectly with ssl 
>>>> bumping and I get the decrypted content as html and it's readable.
>>>> Other sites, such as google and wikipedia return what looks like 
>>>> encrypted traffic, or perhaps mime encoded data, I am not sure which.
>>>> 
>>>> Are there cases where squid will default to direct mode and not 
>>>> decrypt the traffic?  I am using the latest squid server 3.5.27.  I 
>>>> really would like to get this working with google and wikipedia.  I 
>>>> reviewed the page source code from the browser viewer and it looks 
>>>> nothing like the data I am getting via the icap server.
>>>> 
>>>> Any assistance would be greatly appreciated.
>>>> 
>>>> The config I am using is:
>>>> 
>>>> #
>>>> # Recommended minimum configuration:
>>>> #
>>>> 
>>>> # Example rule allowing access from your local networks.
>>>> # Adapt to list your (internal) IP networks from where browsing # 
>>>> should be allowed
>>>> 
>>>> acl localnet src 127.0.0.1
>>>> acl localnet src 10.0.0.0/8     # RFC1918 possible internal network
>>>> acl localnet src 172.16.0.0/12  # RFC1918 possible internal network 
>>>> acl localnet src 192.168.0.0/16 # RFC1918 possible internal network
>>>> acl localnet src fc00::/7       # RFC 4193 local private network range
>>>> acl localnet src fe80::/10      # RFC 4291 link-local (directly
>>>> plugged) machines
>>>> 
>>>> acl SSL_ports port 443
>>>> acl Safe_ports port 80          # http
>>>> acl Safe_ports port 21          # ftp
>>>> acl Safe_ports port 443         # https
>>>> acl Safe_ports port 70          # gopher
>>>> acl Safe_ports port 210         # wais
>>>> acl Safe_ports port 1025-65535  # unregistered ports
>>>> acl Safe_ports port 280         # http-mgmt
>>>> acl Safe_ports port 488         # gss-http
>>>> acl Safe_ports port 591         # filemaker
>>>> acl Safe_ports port 777         # multiling http
>>>> acl CONNECT method CONNECT
>>>> 
>>>> #
>>>> # Recommended minimum Access Permission configuration:
>>>> #
>>>> # Deny requests to certain unsafe ports http_access deny !Safe_ports
>>>> 
>>>> # Deny CONNECT to other than secure SSL ports http_access deny 
>>>> CONNECT !SSL_ports
>>>> 
>>>> # Only allow cachemgr access from localhost http_access allow 
>>>> localhost manager http_access deny manager
>>>> 
>>>> # We strongly recommend the following be uncommented to protect 
>>>> innocent # web applications running on the proxy server who think 
>>>> the only # one who can access services on "localhost" is a local 
>>>> user #http_access deny to_localhost
>>>> 
>>>> #
>>>> # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS #
>>>> 
>>>> # Example rule allowing access from your local networks.
>>>> # Adapt localnet in the ACL section to list your (internal) IP 
>>>> networks # from where browsing should be allowed http_access allow 
>>>> localnet http_access allow localhost
>>>> 
>>>> # And finally deny all other access to this proxy http_access deny 
>>>> all
>>>> 
>>>> # Squid normally listens to port 3128 #http_port 3128
>>>> 
>>>> # Uncomment and adjust the following to add a disk cache directory.
>>>> #cache_dir ufs /usr/local/squid/var/cache/squid 100 16 256
>>>> 
>>>> # Leave coredumps in the first cache dir coredump_dir 
>>>> /usr/local/squid/var/cache/squid
>>>> 
>>>> #
>>>> # Add any of your own refresh_pattern entries above these.
>>>> #
>>>> refresh_pattern ^ftp:           1440    20%     10080
>>>> refresh_pattern ^gopher:        1440    0%      1440
>>>> refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
>>>> refresh_pattern .               0       20%     4320
>>>> 
>>>> http_port 3128 ssl-bump generate-host-certificates=on 
>>>> dynamic_cert_mem_cache_size=4MB cert=/etc/squid/ssl_cert/myCA.pem 
>>>> http_port 3129
>>>> 
>>>> # SSL Bump Config
>>>> always_direct allow all
>>>> ssl_bump server-first all
>>>> sslproxy_cert_error deny all
>>>> sslproxy_flags DONT_VERIFY_PEER
>>>> sslcrtd_program /usr/local/squid/libexec/ssl_crtd -s /var/lib/ssl_db 
>>>> -M 4MB sslcrtd_children 8 startup=1 idle=1
>>>> 
>>>> # For squid 3.5.x
>>>> #sslcrtd_program /usr/local/squid/libexec/ssl_crtd -s 
>>>> /var/lib/ssl_db -M 4MB
>>>> 
>>>> # For squid 4.x
>>>> # sslcrtd_program /usr/local/squid/libexec/security_file_certgen -s 
>>>> /var/lib/ssl_db -M 4MB
>>>> 
>>>> icap_enable on
>>>> icap_send_client_ip on
>>>> icap_send_client_username on
>>>> icap_client_username_header X-Authenticated-User icap_preview_enable 
>>>> on icap_preview_size 1024 icap_service service_avi_req 
>>>> reqmod_precache icap://127.0.0.1:1344/request
>>>> bypass=1
>>>> adaptation_access service_avi_req allow all
>>>> 
>>>> icap_service service_avi_resp respmod_precache 
>>>> icap://127.0.0.1:1344/cherokee bypass=0 adaptation_access 
>>>> service_avi_resp allow all
>>>> 
>>>> Jeff
>>>> _______________________________________________
>>>> squid-users mailing list
>>>> squid-users at lists.squid-cache.org
>>>> http://lists.squid-cache.org/listinfo/squid-users
>>>> 
>>>> 
>>> Eliezer,
>>> 
>>> Well, you certainly hit the nail on the head.  I added the following 
>>> code to check the content being sent to the icap server from squid, 
>>> and here is what I found when I check the headers being sent from the 
>>> remote web server:
>>> 
>>> Code to check for content type and encoding received by the icap 
>>> server added to c-icap:
>>> 
>>>   hdrs = ci_http_response_headers(req);
>>>   content_type = ci_headers_value(hdrs, "Content-Type");
>>>   if (content_type)
>>>      ci_debug_printf(1,"srv_cherokee:  content-type: %s\n",
>>>                      content_type);
>>> 
>>>   content_encoding = ci_headers_value(hdrs, "Content-Encoding");
>>>   if (content_encoding)
>>>      ci_debug_printf(1,"srv_cherokee:  content-encoding: %s\n",
>>>                      content_encoding);
>>> 
>>> And the output from scanned pages sent over from squid:
>>> 
>>> srv_cherokee:  init request 0x7f3dbc008eb0 pool hits:1 allocations: 1 
>>> Allocating from objects pool object 5 pool hits:1 allocations: 1 
>>> Geting buffer from pool 4096:1 Requested service: cherokee Read 
>>> preview data if there are and process request
>>> srv_cherokee:  content-type: text/html; charset=utf-8
>>> srv_cherokee:  content-encoding: gzip         <-- As you stated, I am
>>> getting gzipped data
>>> srv_cherokee:  we expect to read :-1 body data Allow 204...
>>> Preview handler return allow 204 response
>>> srv_cherokee:  release request 0x7f3dbc008eb0 Store buffer to long 
>>> pool 4096:1 Storing to objects pool object 5 Log request to access 
>>> log file /var/log/i-cap_access.log
>>> 
>>> 
>>> Wikipedia  at https://en.wikipedia.org/wiki/HTTP_compression 
>>> describes the process as:
>>> 
>>> " ...
>>>  Compression scheme negotiation[edit]
>>>  In most cases, excluding the SDCH, the negotiation is done in two 
>>> steps, described in
>>>  RFC 2616:
>>> 
>>>  1. The web client advertises which compression schemes it supports 
>>> by including a list
>>>  of tokens in the HTTP request. For Content-Encoding, the list in a 
>>> field called Accept -
>>>  Encoding; for Transfer-Encoding, the field is called TE.
>>> 
>>>  GET /encrypted-area HTTP/1.1
>>>  Host: www.example.com
>>>  Accept-Encoding: gzip, deflate
>>> 
>>>  2. If the server supports one or more compression schemes, the 
>>> outgoing data may be
>>>  compressed by one or more methods supported by both parties. If 
>>> this is the case, the
>>>  server will add a Content-Encoding or Transfer-Encoding field in 
>>> the HTTP response with
>>>  the used schemes, separated by commas.
>>> 
>>>  HTTP/1.1 200 OK
>>>  Date: mon, 26 June 2016 22:38:34 GMT
>>>  Server: Apache/1.3.3.7 (Unix)  (Red-Hat/Linux)
>>>  Last-Modified: Wed, 08 Jan 2003 23:11:55 GMT
>>>  Accept-Ranges: bytes
>>>  Content-Length: 438
>>>  Connection: close
>>>  Content-Type: text/html; charset=UTF-8
>>>  Content-Encoding: gzip
>>> 
>>>  The web server is by no means obligated to use any compression 
>>> method -
>> this
>>>  depends on the internal settings of the web server and also may 
>>> depend on the internal
>>>  architecture of the website in question.
>>> 
>>>  In case of SDCH a dictionary negotiation is also required, which 
>>> may involve additional
>>>  steps, like downloading a proper dictionary from .
>>> .."
>>> 
>>> 
>>> So, it looks like it is a feature of the browser.  So, is it possible 
>>> to have squid gunzip the data or configure the browser not to send 
>>> the header  to remove "Accept-Encoding: gzip, deflate" from the 
>>> request sent to the remote server telling it to gzip the data?
>>> 
>>> Thanks
>>> 
>>> Jeff
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
> 
> 
> 


From squid3 at treenet.co.nz  Fri Oct  6 06:11:40 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 6 Oct 2017 19:11:40 +1300
Subject: [squid-users] New Squid 3.5 reconfigure causes service down
In-Reply-To: <10b637f7-af0d-2034-c2f9-04433d1bc044@posteo.eu>
References: <0a2436a7-42f1-3677-70fc-0834c492281f@posteo.eu>
 <ca4ee786-2297-0804-19a4-56ff4ba4afc9@measurement-factory.com>
 <10b637f7-af0d-2034-c2f9-04433d1bc044@posteo.eu>
Message-ID: <fa33cae5-efe0-c53b-e2e7-d2ec7b21f093@treenet.co.nz>

On 06/10/17 05:44, Nicola Ferrari (#554252) wrote:
> On 05/10/2017 18:25, Alex Rousskov wrote:
>> The "couple of minutes" part might be related to your upgrade and, if
>> so, you may be able to avoid such delays. For list readers not familiar
>> with Debian releases, which _Squid_ version are you upgrading from?
>>
> 
> I was running squid 3.4 on top of Debian 8 (jessie)
> I upgraded to squid 3.5 on top of Debian 9 (stretch)
> 
>> I suggest to start by figuring our what Squid is doing during those
>> "couple of minutes" if you have not already.
> 
> What I notice by checking cache.log is that it stops for a while on
> 
> helperOpenServers: Starting 1/60 'ntlm_auth' processes
> 2017/10/05 11:36:06 kid1| Starting new ntlmauthenticator helpers...
> 
> This was not a usual behaviour on Squid 3.4;

The behaviour of starting helpers has been present since forever - 
though it may not have been logged correctly. The "Starting N/N 
'helper_name' processes" log entry was added with dynamic helper in 
Squid-3.2, so should have been visible in Jesse.

The 1/60 indicates that the number of ntlm_auth helpers running was 1 
less than your startup=N configuration value. The N defaults to the max 
value (60) if not configured explicitly.


> 
> At the moment of the upgrade, I had to adjust various path from
> "/squid3" to "/squid" ..
> 
> I checked authenticators path and other occurrences in conf file,
> everything seems to be ok.

Did Squid start properly and at least seem to work okay after the 
upgrade and before you manually ran the "-k reconfigure" ?

FYI: Stretch brings somewhat deeper SELinux integration in the 
background. The packaged init script updates the SELinux permissions for 
cache_dir. But if you have any custom directories for other things you 
may need to run /sbin/restorecon on them manually after any changes to 
the path or OS permissions - or do it anyway just in case SELinux is 
being confused.

> 
> Just for testing purposes, I would try my config on a new clean install,
> just to be sure this is not related to the upgrade in some way, and let
> you know!
> 

Please also try a full clean restart of Squid:

  Shutdown completely using the init script. If any 'squid' or 
'(squid-N)' process remains after that use kill -9 to halt that process, 
and manually delete the squid.pid / squid3.pid file if any still exists.

  Starting Squid using the Stretch package init script should then 
ensure that the expected paths have the right permissions, and runs the 
'-k parse' checks for you.

Since this is the Samba NTLM helper you should also check that the 
Samba, winbind etc components still have it enabled. Behaviour is 
undefined if the OS components are only partially functioning.

Amos


From rentorbuy at yahoo.com  Fri Oct  6 07:04:18 2017
From: rentorbuy at yahoo.com (Vieri)
Date: Fri, 6 Oct 2017 07:04:18 +0000 (UTC)
Subject: [squid-users] memory usage
References: <703812317.2441705.1507273458611.ref@mail.yahoo.com>
Message-ID: <703812317.2441705.1507273458611@mail.yahoo.com>

Hi,

On a Squid server I'm seeing how the buffer mem usage is steadily growing.

I'm running out of free memory.

top - 08:34:25 up 37 days,  1:00,  2 users,  load average: 1.39, 1.27, 1.36
Tasks: 340 total,   1 running, 339 sleeping,   0 stopped,   0 zombie
%Cpu(s):  0.6 us,  0.2 sy,  0.0 ni, 97.1 id,  0.0 wa,  0.0 hi,  2.0 si,  0.0 st
KiB Mem : 32865056 total,  1290836 free,  2768896 used, 28805324 buff/cache
KiB Swap: 37036988 total, 36864784 free,   172204 used. 29598916 avail Mem

PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND
24461 squid     20   0  185632  98884  12724 S   1.3  0.3   0:10.68 squid
24464 squid     20   0   41808   7832   5756 S   1.3  0.0   0:06.82 ssl_crtd
23809 suricata  20   0 2128940 355196   7228 S   0.7  1.1   0:12.19 Suricata-Main
24067 nobody    20   0   67600  13688   6228 S   0.7  0.0   0:00.17 policyd-spf
28110 named     20   0  811544 157968   7308 S   0.7  0.5  95:07.45 named
8000 mysql     20   0 4645052 638484   8300 S   0.3  1.9 377:43.12 mysqld
23645 postfix   23   3 1022224 526076   4284 S   0.3  1.6   0:15.28 clamd
23755 postfix   20   0  201200  83956  10348 S   0.3  0.3   0:02.33 mimedefang.pl
24061 postfix   20   0  146600  11620   9756 S   0.3  0.0   0:00.11 smtpd
24489 squid     20   0   68972  15396   6404 S   0.3  0.0   0:01.34 squid_url_looku
25202 root      20   0  294616   5572   4388 S   0.3  0.0   0:02.29 syslog-ng
27846 root      20   0   20252   2924   2180 R   0.3  0.0   0:00.03 top
27886 root      20   0  221996   8960   6804 S   0.3  0.0   3:43.46 nmbd
1 root      20   0    4176   1588   1508 S   0.0  0.0   0:19.16 init
[...]

# ps aux --sort -rss | head -n 20
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
mysql     8000  0.7  1.9 4645052 638484 ?      Ssl  Aug30 377:42 /usr/sbin/mysqld --defaults-file=/etc/mysql/my.cnf
postfix  23645  5.9  1.6 1022224 526036 ?      SNsl 08:29   0:14 /usr/sbin/clamd
suricata 23809  5.3  1.0 2128940 355196 ?      Ssl  08:30   0:11 /usr/bin/suricata --pidfile /var/run/suricata/suricata.pid -D -c /etc/suricata/suricata-HMAN.yaml -vvvv -q 0 -q 1 -q 2 -q 3 -q 4 -q 5 --set logging.outputs.1.file.filename=/var/log/suricata/suricata.log --user=suricata --group=suricata -l /var/log/suricata
named    28110  0.7  0.4 811544 157968 ?       Ssl  Sep27  95:07 /usr/sbin/named -u named
postgres 10502  0.0  0.4 202192 140904 ?       Ss   Aug30   0:59 postgres: checkpointer process
postgres 10503  0.0  0.4 201816 136828 ?       Ss   Aug30   0:17 postgres: writer process
squid    24461  5.4  0.2 181140 93988 ?        S    08:30   0:09 (squid-1) -YC -f /etc/squid/squid.conf -n squid
postfix  23755  0.9  0.2 201200 83948 ?        S    08:29   0:02 /usr/bin/perl /usr/bin/mimedefang.pl -server
postfix  23778  0.1  0.1 114564 39804 ?        S    08:29   0:00 /usr/bin/perl /usr/bin/mimedefang.pl -server
root     32046  0.0  0.1 353280 34384 ?        Ss   Sep15   0:48 /usr/sbin/apache2 -D DEFAULT_VHOST -D INFO -D SSL -D SSL_DEFAULT_VHOST -D LANGUAGE -D PHP -D PERL -D LDAP -D AUTHNZ_LDAP -D AUTH_KERB -d /usr/lib64/apache2 -f /etc/apache2/httpd.conf -k start
root     24322  0.3  0.0 810308 30316 ?        Sl   08:30   0:00 /usr/libexec/c-icap
root     27896  0.0  0.0 313080 28884 ?        S    Sep18   5:34 /usr/sbin/winbindd
squid    24094  0.3  0.0 111336 27396 ?        S    08:30   0:00 (squid-1) -YC -f /etc/squid/squid.owa2.conf -n squidowa2
apache   17435  0.0  0.0 360228 22264 ?        S    03:16   0:00 /usr/sbin/apache2 -D DEFAULT_VHOST -D INFO -D SSL -D SSL_DEFAULT_VHOST -D LANGUAGE -D PHP -D PERL -D LDAP -D AUTHNZ_LDAP -D AUTH_KERB -d /usr/lib64/apache2 -f /etc/apache2/httpd.conf -k start
apache    7477  0.0  0.0 360088 22140 ?        S    07:58   0:00 /usr/sbin/apache2 -D DEFAULT_VHOST -D INFO -D SSL -D SSL_DEFAULT_VHOST -D LANGUAGE -D PHP -D PERL -D LDAP -D AUTHNZ_LDAP -D AUTH_KERB -d /usr/lib64/apache2 -f /etc/apache2/httpd.conf -k start
apache   15963  0.0  0.0 360088 21920 ?        S    00:44   0:00 /usr/sbin/apache2 -D DEFAULT_VHOST -D INFO -D SSL -D SSL_DEFAULT_VHOST -D LANGUAGE -D PHP -D PERL -D LDAP -D AUTHNZ_LDAP -D AUTH_KERB -d /usr/lib64/apache2 -f /etc/apache2/httpd.conf -k start
apache    2064  0.0  0.0 360112 21908 ?        S    02:36   0:00 /usr/sbin/apache2 -D DEFAULT_VHOST -D INFO -D SSL -D SSL_DEFAULT_VHOST -D LANGUAGE -D PHP -D PERL -D LDAP -D AUTHNZ_LDAP -D AUTH_KERB -d /usr/lib64/apache2 -f /etc/apache2/httpd.conf -k start
apache   20307  0.0  0.0 360088 21884 ?        S    03:24   0:00 /usr/sbin/apache2 -D DEFAULT_VHOST -D INFO -D SSL -D SSL_DEFAULT_VHOST -D LANGUAGE -D PHP -D PERL -D LDAP -D AUTHNZ_LDAP -D AUTH_KERB -d /usr/lib64/apache2 -f /etc/apache2/httpd.conf -k start
apache    5871  0.0  0.0 360084 21876 ?        S    06:16   0:00 /usr/sbin/apache2 -D DEFAULT_VHOST -D INFO -D SSL -D SSL_DEFAULT_VHOST -D LANGUAGE -D PHP -D PERL -D LDAP -D AUTHNZ_LDAP -D AUTH_KERB -d /usr/lib64/apache2 -f /etc/apache2/httpd.conf -k start

I'm not familiar with how the Linux kernel manages memory, so I don't know if the "buff/cache" memory is easily reusable by user processes.
In other words, should I worry or not if the value of "free" (in top) drops that much?

I not sure how I'm supposed to interpret the output of the ps commands above.
For example, the sum of %MEM is usually between 5 and 10%. Shouldn't this mean that the overall system is not requiring that much RAM?

Also, my squid settings are quite modest in that I have this in the conf file:

cache_dir diskd /var/cache/squid 32 16 256
cache_mem 32 MB

# squidclient mgr:info
Squid Object Cache: Version 3.5.27-20170916-re69e56c
Build Info:
Service Name: squid
Start Time:     Fri, 06 Oct 2017 06:30:43 GMT
Current Time:   Fri, 06 Oct 2017 06:57:52 GMT
Connection information for squid:
Number of clients accessing cache:      210
Number of HTTP requests received:       29492
Number of ICP messages received:        0
Number of ICP messages sent:    0
Number of queued ICP replies:   0
Number of HTCP messages received:       0
Number of HTCP messages sent:   0
Request failure ratio:   0.00
Average HTTP requests per minute since start:   1086.1
Average ICP messages per minute since start:    0.0
Select loop called: 1024430 times, 1.590 ms avg
Cache information for squid:
Hits as % of all requests:      5min: 0.4%, 60min: 2.5%
Hits as % of bytes sent:        5min: 7.5%, 60min: -1.6%
Memory hits as % of hit requests:       5min: 96.2%, 60min: 77.8%
Disk hits as % of hit requests: 5min: 0.0%, 60min: 1.2%
Storage Swap size:      29488 KB
Storage Swap capacity:  90.0% used, 10.0% free
Storage Mem size:       22700 KB
Storage Mem capacity:   69.3% used, 30.7% free
Mean Object Size:       15.44 KB
Requests given to unlinkd:      301
Median Service Times (seconds)  5 min    60 min:
HTTP Requests (All):   0.19742  0.17711
Cache Misses:          0.18699  0.17711
Cache Hits:            0.00091  0.00000
Near Hits:             0.00000  0.07409
Not-Modified Replies:  0.00000  0.00000
DNS Lookups:           0.07968  0.07284
ICP Queries:           0.00000  0.00000
Resource usage for squid:
UP Time:        1629.229 seconds
CPU Time:       65.180 seconds
CPU Usage:      4.00%
CPU Usage, 5 minute avg:        5.20%
CPU Usage, 60 minute avg:       4.01%
Maximum Resident Size: 603104 KB
Page faults with physical i/o: 0
Memory accounted for:
Total accounted:        74309 KB
memPoolAlloc calls:   9509851
memPoolFree calls:    9664141
File descriptor usage for squid:
Maximum number of file descriptors:   16384
Largest file desc currently in use:    931
Number of file desc currently in use:  545
Files queued for open:                   0
Available number of file descriptors: 15839
Reserved number of file descriptors:   100
Store Disk files open:                   0
Internal Data Structures:
2115 StoreEntries
2110 StoreEntries with MemObjects
1957 Hot Object Cache Items
1910 on-disk objects

# squidclient mgr:storedir
Store Directory Statistics:
Store Entries          : 2102
Maximum Swap Size      : 32768 KB
Current Store Swap Size: 29496.00 KB
Current Capacity       : 90.01% used, 9.99% free

Store Directory #0 (diskd): /var/cache/squid
FS Block Size 4096 Bytes
First level subdirectories: 16
Second level subdirectories: 256
Maximum Size: 32768 KB
Current Size: 29496.00 KB
Percent Used: 90.01%
Filemap bits in use: 1925 of 16384 (12%)
Filesystem Space in use: 42594564/192108884 KB (22%)
Filesystem Inodes in use: 449220/12271616 (4%)
Flags: SELECTED
Pending operations: 0
Removal policy: lru
LRU reference age: 0.01 days

# squidclient mgr:mem
Current memory usage:
Pool     Obj Size       Chunks                                                  Allocated                                       In Use                      Idle                     Allocations Saved                       Rate
(bytes)        KB/ch    obj/ch (#)      used    free    part    %Frag   (#)     (KB)    high (KB)       high (hrs)      %Tot   (#)      (KB)    high (KB)    high (hrs)      %alloc (#)      (KB)    high (KB)      (#)      %cnt    %vol   (#)/sec
64K Buffer               65536                                                           373     23872   23872   0.01    32.714  350     22400   23872   0.01 93.834  23      1472    2304    33339   0.325   35.810  0.000
mem_node                 4136                                                            5630    22740   28621   0.25    31.163  5342    21577   28621   0.25 94.885  288     1164    3280    67899   0.663   4.603   0.000
32K Buffer               32768                                                           132     4224    4224    0.00    5.789   123     3936    4224    0.00 93.182  9       288     608     7093    0.069   3.809   0.000
16K Buffer               16384                                                           178     2848    4352    0.10    3.903   162     2592    4352    0.10 91.011  16      256     1104    24973   0.244   6.706   0.000
8K Buffer                8192                                                            323     2584    3704    0.08    3.541   278     2224    3704    0.08 86.068  45      360     888     32120   0.313   4.313   0.000
ExternalACLEntry          256                                                            8882    2221    2221    0.00    3.043   8882    2221    2221    0.00 100.000         0       0       953     29      0.000   0.000   0.000
16KB Strings             16384                                                           136     2176    2960    0.28    2.982   133     2128    2960    0.28 97.794  3       48      1744    9421    0.092   2.530   0.000
Short Strings              40                                                            55363   2163    2364    0.06    2.964   53894   2106    2364    0.06 97.347  1469    58      149     5660653         55.232  3.711   0.004
4K Buffer                4096                                                            425     1700    2888    0.08    2.330   377     1508    2888    0.08 88.706  48      192     928     41198   0.402   2.766   0.000
HttpHeaderEntry            56                                                            24057   1316    1438    0.06    1.803   23388   1280    1438    0.06 97.219  669     37      98      1449821         14.146  1.331   0.001
2K Buffer                2048                                                            510     1020    1126    0.06    1.398   490     980     1126    0.06 96.078  20      40      140     508424  4.961   17.066  0.000
Medium Strings            128                                                            5756    720     758     0.06    0.986   5514    690     758     0.06 95.796  242     31      63      314095  3.065   0.659   0.000
MemObject                 328                                                            2089    670     745     0.06    0.917   1987    637     745     0.06 95.117  102     33      73      28094   0.274   0.151   0.000
4KB Strings              4096                                                            165     660     1264    0.10    0.904   136     544     1264    0.10 82.424  29      116     628     26392   0.258   1.772   0.000
HttpReply                 280                                                            2336    639     699     0.06    0.875   2226    609     699     0.06 95.291  110     31      62      119177  1.163   0.547   0.000
HttpRequest              1784                                                            306     534     896     0.10    0.731   269     469     896     0.10 87.908  37      65      267     70466   0.688   2.060   0.000
Long Strings              512                                                            820     410     502     0.10    0.562   764     382     502     0.10 93.171  56      28      136     90774   0.886   0.762   0.000
StoreEntry                104                                                            2095    213     244     0.43    0.292   1994    203     244     0.43 95.179  101     11      33      28987   0.283   0.049   0.000
cbdata BodyPipe (36)      152                                                            1391    207     231     0.06    0.283   1326    197     231     0.06 95.327  65      10      23      23923   0.233   0.060   0.000
cbdata clientReplyContext (26)   4352                                                            40      170     425     0.10    0.233   13      56      425 0.10     32.500  27      115     391     30365   0.296   2.166   0.000
cbdata Server (21)        520                                                            332     169     253     0.10    0.231   311     158     253     0.10 93.675  21      11      122     11522   0.112   0.098   0.000
cbdata ClientSocketContext (25)  4256                                                            40      167     416     0.10    0.228   13      55      416 0.10     32.500  27      113     383     30365   0.296   2.118   0.000
Comm::Connection          200                                                            801     157     228     0.10    0.214   716     140     228     0.10 89.388  85      17      63      62443   0.609   0.205   0.000
cbdata MemBuf (12)         64                                                            2392    150     163     0.06    0.205   2271    142     163     0.06 94.941  121     8       15      180573  1.762   0.189   0.000
fqdncache_entry           160                                                            750     118     119     0.01    0.161   748     117     119     0.01 99.733  2       1       4       3145    0.031   0.008   0.000
HttpHdrCc                  96                                                            1170    110     124     0.07    0.150   1116    105     124     0.07 95.385  54      6       14      53676   0.524   0.084   0.000
1KB Strings              1024                                                            109     109     139     0.08    0.149   85      85      139     0.08 77.982  24      24      73      11630   0.113   0.195   0.000
cbdata IdleConnList (18)         4160                                                            26      106     163     0.39    0.145   24      98      163 0.39     92.308  2       9       122     1471    0.014   0.100   0.000
MemBlob                    48                                                            2028    96      157     0.10    0.130   1844    87      157     0.10 90.927  184     9       45      332112  3.240   0.261   0.000
ClientInfo                448                                                            213     94      94      0.00    0.128   213     94      94      0.00 100.000         0       0       0       0       0.000   0.000   0.000
netdbEntry                168                                                            564     93      93      0.00    0.127   564     93      93      0.00 100.000         0       0       0       0       0.000   0.000   0.000
LRU policy node            24                                                            3720    88      99      0.06    0.119   3577    84      99      0.06 96.156  143     4       10      5255    0.051   0.002   0.000
ipcache_entry             128                                                            658     83      83      0.02    0.113   656     82      83      0.02 99.696  2       1       2       1698    0.017   0.004   0.000
cbdata idns_query (9)    8696                                                            8       68      332     0.16    0.093   0       0       332     0.16 0.000   8       68      332     7908    0.077   1.127   0.000
cbdata ModXact (41)       512                                                            70      35      35      0.00    0.048   63      32      35      0.00 90.000  7       4       9       15463   0.151   0.130   0.000
MD5 digest                 16                                                            2095    33      38      0.43    0.045   1994    32      38      0.43 95.179  101     2       6       34226   0.334   0.009   0.000
net_db_name                32                                                            993     32      32      0.00    0.043   993     32      32      0.00 100.000         0       0       0       0       0.000   0.000   0.000
cbdata store_client (31)          160                                                            189     30      62      0.10    0.040   150     24      62  0.10     79.365  39      7       27      32142   0.314   0.084   0.000
NotePairs::Entry           48                                                            549     26      26      0.02    0.035   546     26      26      0.02 99.454  3       1       7       2516    0.025   0.002   0.000
MimeEntry                 128                                                            177     23      23      0.48    0.030   177     23      23      0.48 100.000         0       0       23      177     0.002   0.000   0.000
cbdata ClientHttpRequest (24)     392                                                            47      18      46      0.10    0.025   14      6       46  0.10     29.787  33      13      35      30303   0.296   0.195   0.000
cbdata ServerBump (30)    104                                                            167     17      38      0.10    0.023   140     15      38      0.10 83.832  27      3       17      8496    0.083   0.014   0.000
cbdata clientStreamNode (27)      128                                                            80      10      25      0.10    0.014   26      4       25  0.10     32.500  54      7       23      60730   0.593   0.127   0.000
cbdata helper_server (11)         240                                                            35      9       9       0.48    0.011   35      9       9   0.48     100.000         0       0       9       35      0.000   0.000   0.000
cbdata HttpStateData (38)         320                                                            26      9       14      0.40    0.011   8       3       14  0.40     30.769  18      6       11      15629   0.152   0.082   0.000
Acl::AndNode              160                                                            44      7       7       0.48    0.009   44      7       7       0.48 100.000         0       0       7       44      0.000   0.000   0.000
cbdata FwdState (32)      176                                                            39      7       16      0.10    0.009   12      3       16      0.10 30.769  27      5       15      23864   0.233   0.069   0.000
ACLStrategised            160                                                            19      3       3       0.48    0.004   19      3       3       0.48 100.000         0       0       3       19      0.000   0.000   0.000
cbdata ACLFilledChecklist (23)    464                                                            6       3       8       0.40    0.004   0       0       8   0.40     0.000   6       3       8       86432   0.843   0.657   0.000
cbdata ConnOpener (34)    136                                                            19      3       6       0.10    0.003   3       1       6       0.10 15.789  16      3       6       9967    0.097   0.022   0.000
cbdata Tree (4)           216                                                            11      3       3       0.48    0.003   11      3       3       0.48 100.000         0       0       3       11      0.000   0.000   0.000
cbdata Iterator (39)      168                                                            14      3       4       0.40    0.003   7       2       4       0.40 50.000  7       2       4       15496   0.151   0.043   0.000
Acl::NotNode              160                                                            14      3       3       0.48    0.003   14      3       3       0.48 100.000         0       0       3       14      0.000   0.000   0.000
cbdata ModXactLauncher (40)       160                                                            14      3       4       0.40    0.003   7       2       4   0.40     50.000  7       2       4       15496   0.151   0.041   0.000
cbdata PeerConnector (35)         136                                                            13      2       9       0.10    0.002   1       1       9   0.10     7.692   12      2       9       8148    0.080   0.018   0.000
acl_ip_data                96                                                            18      2       2       0.48    0.002   18      2       2       0.48 100.000         0       0       2       64      0.001   0.000   0.000
cbdata WriteRequest (47)           80                                                            19      2       6       0.22    0.002   0       0       6   0.22     0.000   19      2       6       27074   0.264   0.035   0.000
RegexList                  88                                                            10      1       1       0.48    0.001   10      1       1       0.48 100.000         0       0       1       10      0.000   0.000   0.000
ACLSourceIP               144                                                            6       1       1       0.48    0.001   6       1       1       0.48 100.000         0       0       1       6       0.000   0.000   0.000
ACLStrategised            160                                                            5       1       1       0.48    0.001   5       1       1       0.48 100.000         0       0       1       5       0.000   0.000   0.000
cbdata AccessCheck (29)   152                                                            5       1       2       0.45    0.001   0       0       2       0.45 0.000   5       1       2       41171   0.402   0.103   0.000
ev_entry                   48                                                            15      1       1       0.45    0.001   14      1       1       0.45 93.333  1       1       1       4992    0.049   0.004   0.000
cbdata ServiceRep (17)    344                                                            2       1       1       0.32    0.001   2       1       1       0.32 100.000         0       0       0       0       0.000   0.000   0.000
cbdata ClientRequestContext (28)          104                                                            6       1       3       0.40    0.001   0       0   3        0.40    0.000   6       1       3       30446   0.297   0.052   0.000
cbdata helper (10)        168                                                            3       1       1       0.48    0.001   3       1       1       0.48 100.000         0       0       1       3       0.000   0.000   0.000
cbdata CbDataList (2)      40                                                            12      1       1       0.48    0.001   12      1       1       0.48 100.000         0       0       1       12      0.000   0.000   0.000
ACLExternal               152                                                            3       1       1       0.48    0.001   3       1       1       0.48 100.000         0       0       1       3       0.000   0.000   0.000
ACLStringData              56                                                            8       1       1       0.48    0.001   8       1       1       0.48 100.000         0       0       1       3       0.000   0.000   0.000
ACLRegexData               16                                                            25      1       1       0.48    0.001   25      1       1       0.48 100.000         0       0       1       9       0.000   0.000   0.000
cbdata CbDataList (1)      40                                                            10      1       1       0.48    0.001   10      1       1       0.48 100.000         0       0       1       10      0.000   0.000   0.000
cbdata external_acl (5)   192                                                            2       1       1       0.48    0.001   2       1       1       0.48 100.000         0       0       1       2       0.000   0.000   0.000
ACLCertificateData        120                                                            3       1       1       0.48    0.000   3       1       1       0.48 100.000         0       0       0       0       0.000   0.000   0.000
acl_name_list              72                                                            5       1       1       0.48    0.000   5       1       1       0.48 100.000         0       0       1       5       0.000   0.000   0.000
cbdata externalAclState (14)       88                                                            4       1       2       0.40    0.000   0       0       2   0.40     0.000   4       1       2       12863   0.126   0.019   0.000
cbdata Logfile (15)       352                                                            1       1       1       0.48    0.000   1       1       1       0.48 100.000         0       0       1       1       0.000   0.000   0.000
cbdata UFSStoreState (44)         176                                                            2       1       2       0.46    0.000   0       0       2   0.46     0.000   2       1       2       5067    0.049   0.015   0.000
ACLStrategised            160                                                            2       1       1       0.48    0.000   2       1       1       0.48 100.000         0       0       1       2       0.000   0.000   0.000
cbdata TcpAcceptor (19)   104                                                            3       1       1       0.48    0.000   3       1       1       0.48 100.000         0       0       1       3       0.000   0.000   0.000
ACLDestinationIP          144                                                            2       1       1       0.48    0.000   2       1       1       0.48 100.000         0       0       1       2       0.000   0.000   0.000
cbdata generic_cbdata (22)         32                                                            9       1       2       0.16    0.000   0       0       2   0.16     0.000   9       1       2       12388   0.121   0.006   0.000
ACLUserData                64                                                            4       1       1       0.48    0.000   4       1       1       0.48 100.000         0       0       1       1       0.000   0.000   0.000
wordlist                   16                                                            16      1       2       0.32    0.000   16      1       2       0.32 100.000         0       0       1       232     0.002   0.000   0.000
cbdata ps_state (33)      256                                                            1       1       1       0.48    0.000   0       0       1       0.48 0.000   1       1       1       24363   0.238   0.102   0.000
cbdata ErrorState (37)    240                                                            1       1       1       0.47    0.000   0       0       1       0.47 0.000   1       1       1       5833    0.057   0.023   0.000
cbdata RemovalPolicy (7)          104                                                            2       1       1       0.48    0.000   2       1       1   0.48     100.000         0       0       0       0       0.000   0.000   0.000
cbdata DiskdFile (45)     104                                                            2       1       1       0.46    0.000   0       0       1       0.46 0.000   2       1       1       5067    0.049   0.009   0.000
cbdata statefulhelper (13)        192                                                            1       1       1       0.48    0.000   1       1       1   0.48     100.000         0       0       0       0       0.000   0.000   0.000
Helper::Request            48                                                            4       1       1       0.40    0.000   0       0       1       0.40 0.000   4       1       1       21018   0.205   0.017   0.000
AclDenyInfoList            32                                                            5       1       1       0.48    0.000   5       1       1       0.48 100.000         0       0       1       5       0.000   0.000   0.000
ACLStrategised            160                                                            1       1       1       0.48    0.000   1       1       1       0.48 100.000         0       0       1       1       0.000   0.000   0.000
ACLProxyAuth              152                                                            1       1       1       0.48    0.000   1       1       1       0.48 100.000         0       0       1       1       0.000   0.000   0.000
ACLDomainData              16                                                            9       1       1       0.48    0.000   9       1       1       0.48 100.000         0       0       1       7       0.000   0.000   0.000
cbdata external_acl_data (6)       48                                                            3       1       1       0.48    0.000   3       1       1   0.48     100.000         0       0       1       3       0.000   0.000   0.000
external_acl_format        64                                                            2       1       1       0.48    0.000   2       1       1       0.48 100.000         0       0       1       2       0.000   0.000   0.000
cbdata StoreSearchHashIndex (20)          104                                                            1       1       1       0.48    0.000   1       1   1        0.48    100.000         0       0       1       0       0.000   0.000   0.000
ACLHTTPHeaderData          48                                                            2       1       1       0.48    0.000   2       1       1       0.48 100.000         0       0       0       0       0.000   0.000   0.000
ACLSslErrorData            16                                                            6       1       1       0.48    0.000   6       1       1       0.48 100.000         0       0       1       5       0.000   0.000   0.000
cbdata CbDataList (49)     96                                                            1       1       1       0.00    0.000   0       0       1       0.00 0.000   1       1       1       152     0.001   0.000   0.000
cbdata nsvc (8)            72                                                            1       1       1       0.46    0.000   1       1       1       0.46 100.000         0       0       1       7       0.000   0.000   0.000
StoreSwapLogData           72                                                            1       1       1       0.48    0.000   0       0       1       0.48 0.000   1       1       1       11514   0.112   0.014   0.000
cbdata RemovalPurgeWalker (48)     72                                                            1       1       1       0.47    0.000   0       0       1   0.47     0.000   1       1       1       327     0.003   0.000   0.000
cbdata CbDataList (3)      64                                                            1       1       1       0.48    0.000   1       1       1       0.48 100.000         0       0       1       1       0.000   0.000   0.000
dwrite_q                   48                                                            1       1       1       0.48    0.000   0       0       1       0.48 0.000   1       1       1       11515   0.112   0.009   0.000
FwdServer                  24                                                            2       1       1       0.48    0.000   0       0       1       0.48 0.000   2       1       1       36749   0.359   0.014   0.000
ACLNoteData                40                                                            1       1       1       0.48    0.000   1       1       1       0.48 100.000         0       0       0       0       0.000   0.000   0.000
CacheDigest                40                                                            1       1       1       0.48    0.000   1       1       1       0.48 100.000         0       0       0       0       0.000   0.000   0.000
ACLHierCodeData            32                                                            1       1       1       0.48    0.000   1       1       1       0.48 100.000         0       0       0       0       0.000   0.000   0.000
ACLMethodData              16                                                            2       1       1       0.48    0.000   2       1       1       0.48 100.000         0       0       1       1       0.000   0.000   0.000
ACLTimeData                32                                                            1       1       1       0.48    0.000   1       1       1       0.48 100.000         0       0       0       0       0.000   0.000   0.000
ACLAtStepData              32                                                            1       1       1       0.48    0.000   1       1       1       0.48 100.000         0       0       0       0       0.000   0.000   0.000
ACLASN                     16                                                            2       1       1       0.48    0.000   2       1       1       0.48 100.000         0       0       0       0       0.000   0.000   0.000
StoreMetaMD5               32                                                            1       1       1       0.48    0.000   0       0       1       0.48 0.000   1       1       1       5021    0.049   0.003   0.000
StoreMetaSTDLFS            32                                                            1       1       1       0.48    0.000   0       0       1       0.48 0.000   1       1       1       5021    0.049   0.003   0.000
StoreMetaURL               32                                                            1       1       1       0.48    0.000   0       0       1       0.48 0.000   1       1       1       5021    0.049   0.003   0.000
StoreMetaObjSize           32                                                            1       1       1       0.48    0.000   0       0       1       0.48 0.000   1       1       1       5021    0.049   0.003   0.000
UFSStoreState::_queued_write       32                                                            1       1       1       0.48    0.000   0       0       1   0.48     0.000   1       1       1       27583   0.269   0.014   0.000
StoreMetaVary              32                                                            1       1       1       0.48    0.000   0       0       1       0.48 0.000   1       1       1       1427    0.014   0.001   0.000
ACLProtocolData            16                                                            1       1       1       0.48    0.000   1       1       1       0.48 100.000         0       0       0       0       0.000   0.000   0.000
ACLServerNameData          16                                                            1       1       1       0.48    0.000   1       1       1       0.48 100.000         0       0       0       0       0.000   0.000   0.000
link_list                  16                                                            1       1       1       0.48    0.000   0       0       1       0.48 0.000   1       1       1       27583   0.269   0.007   0.000
HttpHdrContRange           24                                                            0       0       1       0.40    0.000   0       0       1       0.40 -1.000  0       0       1       103     0.001   0.000   0.000
cbdata RebuildState (16)          944                                                            0       0       1       0.48    0.000   0       0       1   0.48     -1.000  0       0       1       0       0.000   0.000   0.000
cbdata OptXactLauncher (42)       128                                                            0       0       1       0.48    0.000   0       0       1   0.48     -1.000  0       0       1       0       0.000   0.000   0.000
cbdata OptXact (43)       320                                                            0       0       1       0.48    0.000   0       0       1       0.48 -1.000  0       0       1       0       0.000   0.000   0.000
cbdata ReadRequest (46)    72                                                            0       0       1       0.46    0.000   0       0       1       0.46 -1.000  0       0       1       475     0.005   0.001   0.000
HttpHdrRange               32                                                            0       0       1       0.40    0.000   0       0       1       0.40 -1.000  0       0       1       74      0.001   0.000   0.000
HttpHdrRangeSpec           16                                                            0       0       1       0.40    0.000   0       0       1       0.40 -1.000  0       0       1       74      0.001   0.000   0.000
Total                       1                                                            128706  72971   76562   0.27    100.000         124250  68300   72692        0.28    93.598  4456    4672    7207    9956597         97.149  97.212  0.007
Cumulative allocated volume: 6.101 GB
Current overhead: 41067 bytes (0.059%)
Idle pool limit: 5.00 MB
Total Pools created: 131
Pools ever used:     127 (shown above)
Currently in use:    96
String Pool      Impact
(%strings)      (%volume)
Short Strings            89      33
Medium Strings           9       11
Long Strings             1       6
1KB Strings              0       1
4KB Strings              0       8
16KB Strings             0       33
Other Strings            0       8

Large buffers: 0 (0 KB)

Thanks,

Vieri


From squid3 at treenet.co.nz  Fri Oct  6 07:12:18 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 6 Oct 2017 20:12:18 +1300
Subject: [squid-users] Pages sometimes load as a mess of random (?)
 symbols
In-Reply-To: <1507195923420-0.post@n4.nabble.com>
References: <1507126398090-0.post@n4.nabble.com>
 <bd08fe5c-bff9-914d-a1a7-164b323cc3f7@gmail.com>
 <201710041624.43782.Antony.Stone@squid.open.source.it>
 <059db02d-e201-615c-613c-4d02e5a07e73@treenet.co.nz>
 <1507185746517-0.post@n4.nabble.com>
 <b289ed33-cd21-23b6-132a-79123716d2f8@treenet.co.nz>
 <1507195923420-0.post@n4.nabble.com>
Message-ID: <2cfb661e-28f2-1931-9890-f2e2f72f02f5@treenet.co.nz>

On 05/10/17 22:32, Grey wrote:
> Firstly, thanks a lot for taking the time to check my configuration and
> provide such detailed suggestions; I think I've followed all of them and
> fixed the problems you pointed out.
> We have a Windows domain and all those "all" directives where inherited from
> our old proxy server (running Squid verson 3.1.20) and were used to let
> domain users not receive any popups asking for credentials, while at the
> same time presenting those credentials requests to non-domain users; if I'm
> understanding your comments correctly I can safely remove them and get the
> same result, am I right?

Most of the 'all' uses were pointless even in the old config. Only the 
ones on the lines with AUTH and ProxyUsers ACLs had any effect on popups.


As for your requirement;

If you think about it Squid has zero ways to identify on-domain vs 
off-domain users until *after* the user has logged in. Any on-domain 
user who sends invalid or no credentials is indistinguishable from a 
off-domain user sending invalid or no credentials.

So the config hack did not actually do what you were wanting in the 
first place. It just suppresses login challenges for *everybody* without 
credentials - as it was designed to do.


Popups are a feature of the client agent being used (aka Browser). The 
browser may choose to do it at any time for any reason, though the 
popular ones usually only do so if it cannot automatically locate any 
credentials to send in response to a challenge.

Whatever was working was due to some other behaviour which may change at 
any time regardless of the all hack use. Mostly likely by on-domain 
clients sending their credentials up front before any need was mentioned 
by the proxy.

FYI: The clients sending their users credentials without a challenge is 
*very bad* security practice since they will broadcast those credentials 
to anything they connect, not just your proxy.


> We were having an issue with authentication too, where domain users
> sometimes received a popup asking for credentials (shouldn't happen since I
> have only enabled kerberos auth) and would need to click "Cancel" and reload
> the page to resume browsing correctly; could the presence of all those "all"
> directives have caused that too in your opinion?


The all-hack was preventing Squid from telling the browser what it 
needed to login. So the popups themselves were caused by some other 
reason unrelated to Squid.

That said, the absence of proper instructions from Squid probably was 
involved with the horrible need to cancel and reload the page. The 
normal behaviour would have been either silent re-try with other 
automatic credentials or a popup that user could login with successfully.


FWIW: It is true that Kerberos tends to have popups less often than 
NTLM. But that is just a side-effect of Kerberos being far more 
efficient and less fragile than NTLM with its relatively static keytab 
value - the NTLM equivalent of keytab is generated fresh on every single 
TCP connection with a client connection to the DC, which takes up time 
and can be interfered with. So the chance of problems leading to a popup 
in Kerberos are far lower, but not gone completely.



> 
> The new configuration should result in this if I didn't miss/misunderstand
> anything (I've addedd a whitelist rule that I missed earlier):
> 
> ### TESTSQUID1 ###
> 
> http_port 3128
> dns_v4_first on
> pinger_enable off
> netdb_filename none
> 
> error_default_language it
> cache_mgr helpdesk at test.it
> 
> acl SSL_ports port 443
> acl Safe_ports port 80		# http
> acl Safe_ports port 21		# ftp
> acl Safe_ports port 443		# https
> acl Safe_ports port 70		# gopher
> acl Safe_ports port 210		# wais
> acl Safe_ports port 1025-65535	# unregistered ports
> acl Safe_ports port 280		# http-mgmt
> acl Safe_ports port 488		# gss-http
> acl Safe_ports port 591		# filemaker
> acl Safe_ports port 777		# multiling http
> acl CONNECT method CONNECT
> 
> auth_param negotiate program /usr/lib/squid/negotiate_kerberos_auth -r -d
> auth_param negotiate children 150
> auth_param negotiate children 150 startup=20 idle=10
> auth_param negotiate keep_alive on
> 
> external_acl_type ProxyUser children-max=75 %LOGIN
> /usr/lib/squid/ext_kerberos_ldap_group_acl -g INTERNET at TEST.LOCAL -D
> TEST.LOCAL -S testldap
> acl ProxyUser external ProxyUser
> 
> http_access deny !Safe_ports
> http_access deny CONNECT !SSL_ports
> http_access allow localhost
> http_access deny manager
> 
> acl destsquid dstdomain .testsquid1 .testsquid2
> http_access allow destsquid
> 
> acl siti_whitelist dstdomain "/etc/squid/siti_whitelist"
> 

It should be obvious, but just so that it is clearly stated:

Anything which is allowed or denied regardless of user auth (eg the 
whitelist?) should be done in an http_access line above the "deny !AUTH" 
line.


> acl AUTH proxy_auth REQUIRED
> http_access deny !AUTH
> 
> http_access allow siti_whitelist
> http_access allow ProxyUser

If you get unwanted popups after this config update, you can try adding 
the all-hack back onto the above line.

> http_access deny all
> 
> icap_enable on
> icap_send_client_ip on
> icap_send_client_username on
> icap_client_username_encode off
> icap_client_username_header X-Authenticated-User
> icap_preview_enable on
> icap_preview_size 1024
> icap_service service_req reqmod_precache bypass=1
> icap://testicap:1344/REQ-Service
> adaptation_access service_req allow all
> icap_service service_resp respmod_precache bypass=0
> icap://testicap:1344/resp
> adaptation_access service_resp allow all
> 
> coredump_dir /var/spool/squid
> 
> refresh_pattern ^ftp:		1440	20%	10080
> refresh_pattern ^gopher:	1440	0%	1440
> refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
> refresh_pattern .		0	20%	4320
> 
> Getting back to the main problem, i've set "icap_enable off" and reloaded
> Squid, then tried again and got the same problem; since we're not using any
> cache parent and Squid isn't using ICAP at the moment, can I assume there's
> nothing else I can do and just have to ignore the problem?
> The thing that bugs me is that only Chrome seems to be having this
> particular problem... could this even be something linked to a bug or a
> simple behaviour difference between Chrome and IE/Firefox?
> Thanks again for all your patience :)

There is one other thing you can do. That is to enable "debug_options 
11,2" for a while and run a test fetching with both browsers.

Squid-3.5 with that debug setting should log the HTTP request headers in 
their on-wire format so you can compare what is going on in both client 
and server connections for both browsers vs what the browsers think they 
received.

That might give you some clues about things to workaround it. Just make 
sure that workarounds are done as conservatively as possible so as not 
to break other sites in other annoying ways.

Amos



From rentorbuy at yahoo.com  Fri Oct  6 07:27:17 2017
From: rentorbuy at yahoo.com (Vieri)
Date: Fri, 6 Oct 2017 07:27:17 +0000 (UTC)
Subject: [squid-users] memory usage
References: <1531882995.2440409.1507274837774.ref@mail.yahoo.com>
Message-ID: <1531882995.2440409.1507274837774@mail.yahoo.com>

OK, I guess I'm starting to understand how Linux manages disk caching, and the meaning of "buffered".
In fact:

# free -m
total        used        free      shared  buff/cache   available
Mem:          32094        2799        1074         154       28220       28810
Swap:         36168         168       36000

...so I have 28810MB RAM available.

Thanks,

Vieri


From squid3 at treenet.co.nz  Fri Oct  6 07:36:13 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 6 Oct 2017 20:36:13 +1300
Subject: [squid-users] SSL Bump Failures with Google and Wikipedia
In-Reply-To: <539D88BC-0B89-4E64-A9B0-45389ED43878@diladele.com>
References: <CA+ekxPVs_Nho43T=jtF+pvzs5jNn9j63mWLxpDJda=VkVhkX6w@mail.gmail.com>
 <01c001d33a31$af7c16f0$0e7444d0$@ngtech.co.il>
 <CA+ekxPUSMGNS1tr7nztMM2NaJVQgZyOLK8S+QZKhsoWBaR8tUA@mail.gmail.com>
 <BBEC09F5-1AB6-481E-92C4-F250C51B01D6@diladele.com>
 <023501d33a51$5cea5760$16bf0620$@ngtech.co.il>
 <3d87fae7-e104-6ef1-1ab6-67bb7e0e79a8@gmail.com>
 <067401d33e3c$15bb6980$41323c80$@ngtech.co.il>
 <539D88BC-0B89-4E64-A9B0-45389ED43878@diladele.com>
Message-ID: <caad701b-e9cd-b686-bac7-1b658f9f330d@treenet.co.nz>

On 06/10/17 18:24, Rafael Akchurin wrote:
> Hello Eliezer,
> 
>  From desktop ff/chrome goto youtube. It will be br encoded.
> 
> Best regards,
> Rafael Akchurin
> 


Also, from the discussions in the IETF I get the impression that;

* the Firefox support is still only in their experimental version(s) 
maybe even limited to some devs project build.

* chrome support is a bit further on but only just starting to go public.

* services using it are limited to a few IETF HTTPbis and QUIC working 
group participants that are interested in it.
  - Google is the biggest player involved there and are still only 
experimentally enabling it in their services. So YMMV with any of their 
services depending on where you are in the world and how you are 
accessing them.


In general you can expect the following content encodings to be seen in 
real-world HTTP today:

  aes / aes128
  br / bro
  bz2
  chunked
  compress
  deflate / x-deflate
  diff
  gzip / x-gzip
  identity
  sdch
  zip / x-zip / x-lz

Transfer-Encoding headers can technically use all of the above too. 
Though in practice I've only seen or heard about chunked, aes and gzip 
being used for transfer encodings, and not heard of chunked being used 
in Content-Encoding.

Amos


From squid3 at treenet.co.nz  Fri Oct  6 07:54:07 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 6 Oct 2017 20:54:07 +1300
Subject: [squid-users] memory usage
In-Reply-To: <1531882995.2440409.1507274837774@mail.yahoo.com>
References: <1531882995.2440409.1507274837774.ref@mail.yahoo.com>
 <1531882995.2440409.1507274837774@mail.yahoo.com>
Message-ID: <4f034e94-1bc8-13ac-ef81-ae6b23d41476@treenet.co.nz>

On 06/10/17 20:27, Vieri wrote:
> OK, I guess I'm starting to understand how Linux manages disk caching, and the meaning of "buffered".
> In fact:
> 
> # free -m
>               total        used        free      shared  buff/cache   available
> Mem:          32094        2799        1074         154       28220       28810
> Swap:         36168         168       36000
> 
> ...so I have 28810MB RAM available.
> 


Well, sort of. You have 1074 MB free for use if anything wants it 
immediately. The rest of the 28810 MB is being used by the kernel as 
temporary storage for open disk files etc and will take some cycles to 
clean out before it can be used by other things. So it is available for 
allocation to programs, but the alloc will be somewhat slow.

(It's been a few decades since I dealt with these things in detail, so 
I'm not sure exactly on best practice with these GB-sized machines. But 
that looks reasonably healthy to me: 1GB RAM free and almost no swapping.)

Amos


From squid3 at treenet.co.nz  Fri Oct  6 08:06:10 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 6 Oct 2017 21:06:10 +1300
Subject: [squid-users] memory usage
In-Reply-To: <703812317.2441705.1507273458611@mail.yahoo.com>
References: <703812317.2441705.1507273458611.ref@mail.yahoo.com>
 <703812317.2441705.1507273458611@mail.yahoo.com>
Message-ID: <4214506a-71ca-c931-f700-6d3544630b13@treenet.co.nz>

On 06/10/17 20:04, Vieri wrote:
> Hi,
> 
> On a Squid server I'm seeing how the buffer mem usage is steadily growing.
> 

You mean mem_node? or the "*K Buffers" entries?

The mem_node is used by cache_mem entries, in-transit objects and some 
hot cache_dir index entries. So the value there need to be considered in 
light of the info report value for how full cache_mem is:

 > Storage Mem size:       22700 KB
 > Storage Mem capacity:   69.3% used, 30.7% free

Which states that 30% of you cache_mem has yet to be filled. Until that 
cache space reaches 100% mem_node will continue growing. If it continues 
to grow significantly after that point then you might have a problem, 
but definitely not before then.

You should also expect HttpRequest, HttpReply, StoreEntry, 
HttpHeaderEntry and various Buffer and Strings allocations to increase 
until that same point. These ones can be quite volatile, but no 
significant long-term growth is expected once the memory cache is full. 
ie changes in them should roughly match active traffic peaks and troughs 
with a baseline relative to the amount used by cache_mem objects.
  [thats a *very* rough description of estimates, don't count on it 
being predictable with a formula].

...
> 
> I'm not familiar with how the Linux kernel manages memory, so I don't know if the "buff/cache" memory is easily reusable by user processes.
> In other words, should I worry or not if the value of "free" (in top) drops that much?

see my post in the other thread you started about that top report.

> 
> I not sure how I'm supposed to interpret the output of the ps commands above.
> For example, the sum of %MEM is usually between 5 and 10%. Shouldn't this mean that the overall system is not requiring that much RAM?
> 

Yes, exactly that.


Amos


From squid3 at treenet.co.nz  Fri Oct  6 08:11:04 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 6 Oct 2017 21:11:04 +1300
Subject: [squid-users] Is your kerberos ticket expired?
In-Reply-To: <1507212969805-0.post@n4.nabble.com>
References: <1507212969805-0.post@n4.nabble.com>
Message-ID: <6846b493-0c6b-c2a9-336e-71b63d98f689@treenet.co.nz>

On 06/10/17 03:16, erdosain9 wrote:
> Hi.
> All is working fine, but im having this error in the mail of root
> 
> ------------------------------------------------------------------------------------------------------------------
> 
> 
>  From root at squid.domain.lan  Tue Oct  3 04:00:02 2017
...
> 
> SASL/GSSAPI authentication started
> Error: ldap_sasl_interactive_bind_s failed (Local error)
> Error: ldap_connect failed
> --> Is your kerberos ticket expired? You might try re-"kinit"ing.
> 


This is not a Squid problem. It sounds like you have setup your machine 
with a dynamically changing Kerberos account.

Please see the documentation for the tools you are using to setup and 
manage Kerberos on that machine.

Or perhapse try following the suggestion in that email to replace the 
keytab manually.


Amos


From squid3 at treenet.co.nz  Fri Oct  6 08:24:09 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 6 Oct 2017 21:24:09 +1300
Subject: [squid-users] YouTube\GoogleVideo caching is here,
 tested and verified.
In-Reply-To: <CAE2_gsXWxS28oM-5EmLr0vws26_Jv1yBrCq0RoQfHy2R46LR6w@mail.gmail.com>
References: <0aca01d33ca2$e7f1d330$b7d57990$@ngtech.co.il>
 <CAE2_gsXWxS28oM-5EmLr0vws26_Jv1yBrCq0RoQfHy2R46LR6w@mail.gmail.com>
Message-ID: <10159805-8ba3-324a-94af-56d3c2bbb013@treenet.co.nz>

On 06/10/17 14:09, Mohd Akhbar wrote:
> Hi,
> would you mind sharing the details steps, or have you documented it 
> anywhere that we can refer. For me, i would like to test in my school 
> env and maye al so be beneficial for education purposes. Another thing 
> is, does you solution will save a specific video res like 720p or is it 
> vbr ?
> 
> And what squid version available for this solution ? i'm using version 
> 3.5 (latest stable).
> 

As Eliezers post mentioned the design uses SSL-Bump functionality in the 
Squid to decrypt the HTTPS portion of the transaction before it does its 
magic on the messages themselves.

As a result of that it will still face the cert pinning and HSTS issues, 
and any other problems you may be having with the TLS MITM portion of 
things. Likewise the usual requirement about following the latest Squid 
releases and v4 being better at bumping also apply.

I can't speak as to whether it handles the video resolution cleanly 
right now. It should be possible to do though since the resolution is 
one of the URL parameters.

Amos


From wehategrey at gmail.com  Fri Oct  6 09:47:05 2017
From: wehategrey at gmail.com (Grey)
Date: Fri, 6 Oct 2017 02:47:05 -0700 (MST)
Subject: [squid-users] Pages sometimes load as a mess of random (?)
	symbols
In-Reply-To: <2cfb661e-28f2-1931-9890-f2e2f72f02f5@treenet.co.nz>
References: <1507126398090-0.post@n4.nabble.com>
 <bd08fe5c-bff9-914d-a1a7-164b323cc3f7@gmail.com>
 <201710041624.43782.Antony.Stone@squid.open.source.it>
 <059db02d-e201-615c-613c-4d02e5a07e73@treenet.co.nz>
 <1507185746517-0.post@n4.nabble.com>
 <b289ed33-cd21-23b6-132a-79123716d2f8@treenet.co.nz>
 <1507195923420-0.post@n4.nabble.com>
 <2cfb661e-28f2-1931-9890-f2e2f72f02f5@treenet.co.nz>
Message-ID: <1507283225596-0.post@n4.nabble.com>

First of all thanks a lot for the heads up on authentication and the config
"review", I've found everything really helpful. I'll keep it all in mind
moving forward.
About the problem I was having, looks like you responded while I was editing
my original message... so I'll quote it here:

I feel stupid but I think I've found the problem at last... the two test
users having the issue have uBlock installed as a Chrome addon, looks like
everything works correctly if Chrome is launched without it. That brings me
to the next question... do you think there's something I could do to make
uBlock and Squid behave correctly? or should I open a bug report on uBlock
Github? 
Thanks a lot for the patience guys, sorry for kinda wasting your time... 



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From squid3 at treenet.co.nz  Fri Oct  6 10:30:32 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 6 Oct 2017 23:30:32 +1300
Subject: [squid-users] Pages sometimes load as a mess of random (?)
 symbols
In-Reply-To: <1507283225596-0.post@n4.nabble.com>
References: <1507126398090-0.post@n4.nabble.com>
 <bd08fe5c-bff9-914d-a1a7-164b323cc3f7@gmail.com>
 <201710041624.43782.Antony.Stone@squid.open.source.it>
 <059db02d-e201-615c-613c-4d02e5a07e73@treenet.co.nz>
 <1507185746517-0.post@n4.nabble.com>
 <b289ed33-cd21-23b6-132a-79123716d2f8@treenet.co.nz>
 <1507195923420-0.post@n4.nabble.com>
 <2cfb661e-28f2-1931-9890-f2e2f72f02f5@treenet.co.nz>
 <1507283225596-0.post@n4.nabble.com>
Message-ID: <bd3ad41b-5d6d-ac8a-e107-093e7839e098@treenet.co.nz>

On 06/10/17 22:47, Grey wrote:
> First of all thanks a lot for the heads up on authentication and the config
> "review", I've found everything really helpful. I'll keep it all in mind
> moving forward.
> About the problem I was having, looks like you responded while I was editing
> my original message... so I'll quote it here:
> 
> I feel stupid but I think I've found the problem at last... the two test
> users having the issue have uBlock installed as a Chrome addon, looks like
> everything works correctly if Chrome is launched without it. That brings me
> to the next question... do you think there's something I could do to make
> uBlock and Squid behave correctly? or should I open a bug report on uBlock
> Github?

Definitely talk to the uBlock people. Maybe the chrome ones as well.

That same debug suggestion I tacked on the end of my last response is 
still relevant. It will give you more info to work with in your 
discussions with them if you can demonstrate what input message is 
getting borked.


> Thanks a lot for the patience guys, sorry for kinda wasting your time...

NO problem. It's usually interesting to see whats going on in the world.

Amos


From davide.motti at modomoto.com  Fri Oct  6 15:40:05 2017
From: davide.motti at modomoto.com (davide)
Date: Fri, 6 Oct 2017 08:40:05 -0700 (MST)
Subject: [squid-users] dasdafdsaf
Message-ID: <1507304405176-0.post@n4.nabble.com>





--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From lagged at gmail.com  Sat Oct  7 09:51:37 2017
From: lagged at gmail.com (AndreiZeeGiant)
Date: Sat, 7 Oct 2017 02:51:37 -0700 (MST)
Subject: [squid-users] Header order in squid proxy
In-Reply-To: <CALSaDe1cQvdrwXqJzZ0BXT_q6iXcS6X9i0STJ0A8TfW52CosqA@mail.gmail.com>
References: <CALSaDe1UHsVMoRLCr3CzyuhNPocPcKdc9FM7i5oLuCCJ6BD0+Q@mail.gmail.com>
 <CALSaDe0TD=sctLfc8xP_URsfRyvSo1cNm6p9+Tdsohi2sgXkhg@mail.gmail.com>
 <066801d2ef52$2f351390$8d9f3ab0$@ngtech.co.il>
 <CALSaDe1cQvdrwXqJzZ0BXT_q6iXcS6X9i0STJ0A8TfW52CosqA@mail.gmail.com>
Message-ID: <1507369897452-0.post@n4.nabble.com>

Hello,

I'm running into similar issues due to "reordering". Could you provide the
mentioned code changes, or suggest what I should be looking for? I recently
upgraded from 3.1 (had no such issues) to 3.5, and retained the same
configuration file. 



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From dijxie at gmail.com  Sun Oct  8 12:18:44 2017
From: dijxie at gmail.com (Dijxie)
Date: Sun, 8 Oct 2017 14:18:44 +0200
Subject: [squid-users] Is your kerberos ticket expired?
In-Reply-To: <1507212969805-0.post@n4.nabble.com>
References: <1507212969805-0.post@n4.nabble.com>
Message-ID: <1282d51a-be55-e77d-950b-b2e0950c4cac@gmail.com>

W dniu 05.10.2017 o?16:16, erdosain9 pisze:
> Hi.
> All is working fine, but im having this error in the mail of root
>
> ------------------------------------------------------------------------------------------------------------------
>
>
>  From root at squid.domain.lan  Tue Oct  3 04:00:02 2017
> Return-Path: <root at squid.domain.lan>
> X-Original-To: root
> Delivered-To: root at squid.domain.lan
> Received: by squid.domain.lan (Postfix, from userid 0)
> 	id 2581F8066D7F; Tue,  3 Oct 2017 04:00:02 -0300 (ART)
> From: "(Cron Daemon)" <root at squid.domain.lan>
> To: root at squid.domain.lan
> Subject: Cron <root at squid>  msktutil --auto-update --verbose --computer-name
> squidproxy-k | logger -t msktutil > /dev/null
> Content-Type: text/plain; charset=UTF-8
> Auto-Submitted: auto-generated
> Precedence: bulk
> X-Cron-Env: <XDG_SESSION_ID=666>
> X-Cron-Env: <XDG_RUNTIME_DIR=/run/user/0>
> X-Cron-Env: <LANG=es_AR.UTF-8>
> X-Cron-Env: <SHELL=/bin/bash>
> X-Cron-Env: <PATH=/sbin:/bin:/usr/sbin:/usr/bin>
> X-Cron-Env: <MAILTO=root>
> X-Cron-Env: <HOME=/root>
> X-Cron-Env: <LOGNAME=root>
> X-Cron-Env: <USER=root>
> Message-Id: <20171003070002.2581F8066D7F at squid.domain.lan>
> Date: Tue,  3 Oct 2017 04:00:02 -0300 (ART)
>
> SASL/GSSAPI authentication started
> Error: ldap_sasl_interactive_bind_s failed (Local error)
> Error: ldap_connect failed
> --> Is your kerberos ticket expired? You might try re-"kinit"ing.
>
>  From root at squid.domain.lan  Wed Oct  4 04:00:02 2017
> Return-Path: <root at squid.domain.lan>
> X-Original-To: root
> Delivered-To: root at squid.domain.lan
> Received: by squid.domain.lan (Postfix, from userid 0)
> 	id 24EC282EEFD7; Wed,  4 Oct 2017 04:00:02 -0300 (ART)
> From: "(Cron Daemon)" <root at squid.domain.lan>
> To: root at squid.domain.lan
> Subject: Cron <root at squid>  msktutil --auto-update --verbose --computer-name
> squidproxy-k | logger -t msktutil > /dev/null
> Content-Type: text/plain; charset=UTF-8
> Auto-Submitted: auto-generated
> Precedence: bulk
> X-Cron-Env: <XDG_SESSION_ID=701>
> X-Cron-Env: <XDG_RUNTIME_DIR=/run/user/0>
> X-Cron-Env: <LANG=es_AR.UTF-8>
> X-Cron-Env: <SHELL=/bin/bash>
> X-Cron-Env: <PATH=/sbin:/bin:/usr/sbin:/usr/bin>
> X-Cron-Env: <MAILTO=root>
> X-Cron-Env: <HOME=/root>
> X-Cron-Env: <LOGNAME=root>
> X-Cron-Env: <USER=root>
> Message-Id: <20171004070002.24EC282EEFD7 at squid.domain.lan>
> Date: Wed,  4 Oct 2017 04:00:02 -0300 (ART)
>
> SASL/GSSAPI authentication started
> Error: ldap_sasl_interactive_bind_s failed (Local error)
> Error: ldap_connect failed
> --> Is your kerberos ticket expired? You might try re-"kinit"ing.
>
>  From root at squid.domain.lan  Thu Oct  5 04:00:02 2017
> Return-Path: <root at squid.domain.lan>
> X-Original-To: root
> Delivered-To: root at squid.domain.lan
> Received: by squid.domain.lan (Postfix, from userid 0)
> 	id 9B89F8057477; Thu,  5 Oct 2017 04:00:02 -0300 (ART)
> From: "(Cron Daemon)" <root at squid.domain.lan>
> To: root at squid.domain.lan
> Subject: Cron <root at squid>  msktutil --auto-update --verbose --computer-name
> squidproxy-k | logger -t msktutil > /dev/null
> Content-Type: text/plain; charset=UTF-8
> Auto-Submitted: auto-generated
> Precedence: bulk
> X-Cron-Env: <XDG_SESSION_ID=736>
> X-Cron-Env: <XDG_RUNTIME_DIR=/run/user/0>
> X-Cron-Env: <LANG=es_AR.UTF-8>
> X-Cron-Env: <SHELL=/bin/bash>
> X-Cron-Env: <PATH=/sbin:/bin:/usr/sbin:/usr/bin>
> X-Cron-Env: <MAILTO=root>
> X-Cron-Env: <HOME=/root>
> X-Cron-Env: <LOGNAME=root>
> X-Cron-Env: <USER=root>
> Message-Id: <20171005070002.9B89F8057477 at squid.domain.lan>
> Date: Thu,  5 Oct 2017 04:00:02 -0300 (ART)
>
> SASL/GSSAPI authentication started
> Error: ldap_sasl_interactive_bind_s failed (Local error)
> Error: ldap_connect failed
> --> Is your kerberos ticket expired? You might try re-"kinit"ing.
>
> ----------------------------------------------------------------------------------------------------------------------------
>
> [root at squid network-scripts]# systemctl status squid
> ? squid.service - Squid Web Proxy Server
>     Loaded: loaded (/usr/lib/systemd/system/squid.service; enabled; vendor
> preset: disabled)
>     Active: active (running) since vie 2017-09-22 11:17:42 ART; 1 weeks 5
> days ago
>       Docs: man:squid(8)

<cut>

If you are using sssd (default in RHEL, CentOS)? you might be partially 
affected? by this bug:

https://bugs.freedesktop.org/show_bug.cgi?id=100118

be aware that sssd updates AD domain password (every 28 days AFAIR) ; 
you might want to disable it. If you have winbind istalled, check wbinfo -tP

-- 
Greets, Dijx



From erdosain9 at gmail.com  Mon Oct  9 13:14:40 2017
From: erdosain9 at gmail.com (erdosain9)
Date: Mon, 9 Oct 2017 06:14:40 -0700 (MST)
Subject: [squid-users] Ipv6 error
Message-ID: <1507554880116-0.post@n4.nabble.com>

Hi.
Im getting this kind of error:

------------------------------------------------------------------------------------------
The following error was encountered while trying to retrieve the URL:
https://wiki.squid-cache.org/*

    Connection to 2001:4801:7827:102:ad34:6f78:b6dc:fbed failed.

The system returned: (101) Network is unreachable

The remote host or network may be down. Please try the request again.
-------------------------------------------------------------------------------------------

So, i want disable ipv6 (because now i cant config ipv6 in my net).
Squid is on a Centos7.

I found this command: 
tcp_outgoing_address

but, have this error when i wrote it on squid.conf

2017/10/09 09:49:07 kid1| commBind: Cannot bind socket FD 19 to
190.x.xxx.xxx: (99) Cannot assign requested address
2017/10/09 09:49:07 kid1| commBind: Cannot bind socket FD 28 to
190.x.xxx.xxx: (99) Cannot assign requested address
2017/10/09 09:49:07 kid1| commBind: Cannot bind socket FD 30 to
190.x.xxx.xxx: (99) Cannot assign requested address
2017/10/09 09:49:07 kid1| commBind: Cannot bind socket FD 24 to
190.x.xxx.xxx: (99) Cannot assign requested address
2017/10/09 09:49:07 kid1| commBind: Cannot bind socket FD 24 to
190.x.xxx.xxx: (99) Cannot assign requested address
2017/10/09 09:49:07 kid1| commBind: Cannot bind socket FD 24 to
190.x.xxx.xxx: (99) Cannot assign requested address
2017/10/09 09:49:08 kid1| commBind: Cannot bind socket FD 30 to
190.x.xxx.xxx: (99) Cannot assign requested address
2017/10/09 09:49:08 kid1| commBind: Cannot bind socket FD 30 to
190.x.xxx.xxx: (99) Cannot assign requested address
2017/10/09 09:49:08 kid1| commBind: Cannot bind socket FD 30 to
190.x.xxx.xxx: (99) Cannot assign requested address


Im using this command to, for authenticate

external_acl_type i-full ipv4 %LOGIN
/usr/lib64/squid/ext_kerberos_ldap_group_acl -g i-full at DOMAIN.LAN
external_acl_type i-limitado ipv4 %LOGIN
/usr/lib64/squid/ext_kerberos_ldap_group_acl -g i-limitado at DOMAIN.LAN

(I mean the ipv4 command).

What can i do??

Thanks to all, 
and sorry for my bad english.






--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From squid3 at treenet.co.nz  Mon Oct  9 13:58:03 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 10 Oct 2017 02:58:03 +1300
Subject: [squid-users] Ipv6 error
In-Reply-To: <1507554880116-0.post@n4.nabble.com>
References: <1507554880116-0.post@n4.nabble.com>
Message-ID: <85e8f625-03bb-d9cf-743f-0de6782fad03@treenet.co.nz>

On 10/10/17 02:14, erdosain9 wrote:
> Hi.
> Im getting this kind of error:
> 
> ------------------------------------------------------------------------------------------
> The following error was encountered while trying to retrieve the URL:
> https://wiki.squid-cache.org/*
> 
>      Connection to 2001:4801:7827:102:ad34:6f78:b6dc:fbed failed.
> 
> The system returned: (101) Network is unreachable
> 
> The remote host or network may be down. Please try the request again.
> -------------------------------------------------------------------------------------------
> 
> So, i want disable ipv6 (because now i cant config ipv6 in my net).
> Squid is on a Centos7.

Configure your machine without any IPv6 routes and setup the firewall to 
reject IPv6 traffic. Squid will handle the rest automatically as long as 
ICMP is working properly.

Note that the error page you got shows the *last* destination to be 
tried and fail. All the others have to fail first - both IPv6 and IPv4.

So for this to show an IPv6 it means the site is IPv6-only or you 
configured "dns_v4_first on" so the last destination on Squids list was 
an IPv6 instead of an IPv4.

Amos


From erdosain9 at gmail.com  Mon Oct  9 16:46:59 2017
From: erdosain9 at gmail.com (erdosain9)
Date: Mon, 9 Oct 2017 09:46:59 -0700 (MST)
Subject: [squid-users] Ipv6 error
In-Reply-To: <85e8f625-03bb-d9cf-743f-0de6782fad03@treenet.co.nz>
References: <1507554880116-0.post@n4.nabble.com>
 <85e8f625-03bb-d9cf-743f-0de6782fad03@treenet.co.nz>
Message-ID: <1507567619725-0.post@n4.nabble.com>

this is weird.

This just happend to me with that web... i mean, with
https://wiki.squid-cache.org/ (not with google, not with facebook).

But the weird is that if i go trough a authenticate machine for ip, i
receive that ipv6. but if i go throug a authenticate kerberos machine i get
this net::err cert common name invalid.
?????

so, you tell me i config in iptables to reject ipv6 traffic??




--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From synfinatic at gmail.com  Tue Oct 10 00:04:41 2017
From: synfinatic at gmail.com (Aaron Turner)
Date: Mon, 9 Oct 2017 17:04:41 -0700
Subject: [squid-users] tuning squid memory (aka avoiding the reaper)
In-Reply-To: <e13ba30e-adae-3ac9-aa1e-6ef4ea22b56f@measurement-factory.com>
References: <CANAZdzXS7jFH_n44BgdYALzE_r3D7t78HRamz9qdKsbtfOVyqg@mail.gmail.com>
 <6fd4bb1b-8ec5-4883-2c57-8debb3890d9a@measurement-factory.com>
 <CANAZdzUDViPoOxXVUyd0=Krz+xdyn_R0viJXxLNEMmmGtFs5jA@mail.gmail.com>
 <54372253-c45a-7ca2-37f8-8ecbdbd3ba27@treenet.co.nz>
 <CANAZdzXK4D14OaNpBLCm5ZPcgau_2+B38sXM2mTDe_bB8QwFvg@mail.gmail.com>
 <763e182c-d966-fd6a-ed2b-0c20d17c3274@treenet.co.nz>
 <CANAZdzV293R30V4Eex7B99vCJz_5JQ=4+SiaGD-65GivsQzALw@mail.gmail.com>
 <CANAZdzVsEGcPhCgC0tWAwumoGS4kRUJTXgY8ftP3H9L9HOYq4w@mail.gmail.com>
 <CANAZdzXWDn_FvQYdYn=ufK5-CdCPQBQWUx+0Z5+akzpwh_sMYg@mail.gmail.com>
 <23fca10f-f62a-7091-085d-0fb83fc1321e@treenet.co.nz>
 <CANAZdzXNxt6ZgXVsA9XE0N5RHxujVyMHccro52gXOPspJH99Aw@mail.gmail.com>
 <e13ba30e-adae-3ac9-aa1e-6ef4ea22b56f@measurement-factory.com>
Message-ID: <CANAZdzXsCD2A4pxDRZ-9TevXvsWkUiBZenKDGEM-4iQ_3znoUw@mail.gmail.com>

So more testing.  I haven't found the line in the info:mem logs which
is the red flag, but additional testing proves that the memleak has
something to do with ssl bumping.  Once I turn that off, the memory
leaks stop.

this was the ssl related config options:

http_port 10.0.0.1:3128 ssl-bump generate-host-certificates=on
dynamic_cert_mem_cache_size=400MB cert=/etc/squid/ssl_cert/myCA.pem
sslflags=NO_DEFAULT_CA
http_port localhost:3128
ssl_bump bump all

sslcrtd_program /usr/lib64/squid/ssl_crtd -s /var/lib/squid/ssl_db -M 4MB
sslcrtd_children 32 startup=2 idle=2
sslproxy_session_cache_size 100 MB
sslproxy_cert_error allow all
sslproxy_flags DONT_VERIFY_PEER

--
Aaron Turner
https://synfin.net/         Twitter: @synfinatic
My father once told me that respect for the truth comes close to being
the basis for all morality.  "Something cannot emerge from nothing,"
he said.  This is profound thinking if you understand how unstable
"the truth" can be.  -- Frank Herbert, Dune


On Wed, Oct 4, 2017 at 10:53 AM, Alex Rousskov
<rousskov at measurement-factory.com> wrote:
> On 10/02/2017 09:37 PM, Aaron Turner wrote:
>> So it's leaking memory and not tracking it?
>
>
> That combination (or, to be more precise, its implication) is possible
> but relatively unlikely in your specific case -- when GBs are leaked,
> there is usually something tracked related to those GBs. Please note
> that what Squid _tracks_ may not amount to GBs of RAM! For example,
> Squid can track a tiny object that is included in every large untracked
> leaked object.
>
> A frequent leak often manifests itself in mgr:mem snapshots as a nearly
> always increasing counter of alive associated objects. If you take one
> snapshot every 30 minutes or so, then you may be able to identify
> suspects by comparing same-object alive counters across 5-10 snapshots.
> Sorry, I do not have the time to do that for the snapshots you have
> shared (and you probably need a different collection of snapshots to
> make this search more productive).
>
> Alex.
>
>
>> On Mon, Oct 2, 2017 at 8:25 PM, Amos Jeffries <squid3 at treenet.co.nz> wrote:
>>> On 03/10/17 04:39, Aaron Turner wrote:
>>>>
>>>> Anyone see anything useful?
>>>
>>>
>>> The numbers in those reports all seem reasonable to me. Nothing is showing
>>> up with GB of RAM used.


From davide.motti at modomoto.com  Tue Oct 10 08:19:48 2017
From: davide.motti at modomoto.com (davide.motti)
Date: Tue, 10 Oct 2017 10:19:48 +0200
Subject: [squid-users] Squid as Transparent Proxy
Message-ID: <28379a82-a12a-c56c-7907-650fb55cad6c@modomoto.com>

Hi to everybody,

Last week I've set up Squid as transparent Proxy and everything seems to
work fine, it cache HTTP and HTTPS connections without any problem.

The only think that "worries" me is that if I put the "intercept" flag
on the http_port and on the https port I'm not able to connect to any
site, but if I put off the "intercept" flag the I connect to all sites
in transparent mode (no settings on the client's browser).

So I'm running Squid-3.5.27 on Ubuntu Server 16.04 LTS and it was so
compiled:

./configure --build=x86_64-linux-gnu --prefix=/usr --localstatedir=/var
--libexecdir=${prefix}/lib/squid --datadir=${prefix}/share/squid
--sysconfdir=/etc/squid --mandir=/usr/share/man
--with-swapdir=/var/spool/squid --with-default-user=proxy
--with-logdir=/var/log/squid --with-pidfile=/var/run/squid.pid
--with-open-ssl=/etc/ssl/openssl.cnf --with-filedescriptors=65536
--enable-ssl-crtd --enable-linux-netfilter.

The main squid.config file:

http_port
3128????????????????????????????????????????????????????????????????????
http_port 192.168.21.111:3129??????????????????????????????????????????

http_port 192.168.21.111:13130 ssl-bump generate-host-certificates=on
dynamic_cert_mem_cache_size=4MB cert=/etc/squid/ssl_cert/myRCA.pem???
?????????????????????
?????????????????????
?????????????????????
acl debian src 192.168.7.112?????
acl debian src fe80::a2ce:c8ff:fe1e:bfb8
acl localhost src 127.0.0.0/32?????????????????
acl SSL_ports port 443????????????????????????????
acl Safe_ports port 80?????????????????????????????
acl Safe_ports port 443???????????????????????????

acl Safe_ports port 21
acl Safe_ports port 70
acl Safe_ports port 3128
acl Safe_ports port 3129
acl Safe_ports port 403?
acl Safe_ports port 409?
acl Safe_ports port 210???

acl Safe_ports port 1025-65535??????????????????????????????
acl Safe_ports port 280???????????????????????????????????????????

acl Safe_ports port 488??
acl Safe_ports port 591??
acl Safe_ports port 777??
acl CONNECT method CONNECT???
# HTTP ACCESS?????????????????????????????
http_access deny !Safe_ports????????
http_access deny CONNECT !SSL_ports
?????????????????????????????????????????????????????????????
http_access allow localhost manager??
http_access allow debian?????????????????????
http_access allow localhost?

visible_hostname 20150604-004.intern.modomoto.de?????????
??????????????????????????????????????????????????????????????????????????????????

??????????????????????????????????????????????????????????????????????????????????

acl step1 at_step SslBump1??????????????????????????????????????
??????????????????????????????????????????????????????????????????????????????????

ssl_bump peek step1?????????????????????????????????????????????????
ssl_bump bump all?????????????????????????????????????????????????????
sslproxy_options ALL??????????????????????????????????????????????????
sslproxy_cert_error allow all??????????????????????????????????????
sslproxy_flags DONT_VERIFY_PEER???????????????????????????
sslcrtd_program /lib/squid/ssl_crtd -s /var/lib/squid/ssl_db -M 4MB??
sslcrtd_children 10??

Squid iptables rules:

# Generated by iptables-save v1.6.0 on Mon Sep 25 09:34:12 2017
*mangle

:PREROUTING ACCEPT [41705:23328287]?
:INPUT ACCEPT [40269:23242848]????????????
:FORWARD ACCEPT [6:2262]??????????????????????

:OUTPUT ACCEPT [32950:6122247]
:POSTROUTING ACCEPT [33060:6138510]
COMMIT?????????????????????????????????????????????????????
# Completed on Mon Sep 25 09:34:12 2017
# Generated by iptables-save v1.6.0 on Mon Sep 25 09:34:12 2017
*nat??????????????????????????????????????????????????????????????????????????????

:PREROUTING ACCEPT [2731:496529]?????????????????????????
:INPUT ACCEPT [1440:370186]????????????????????????????????????
:OUTPUT ACCEPT [3278:202202]????????????????????????????????
:POSTROUTING ACCEPT [41:2041]??????????????????????????????
-A PREROUTING -s $CLIENT_IP -p tcp -m tcp --dport 80 -j DNAT
--to-destination
?$SQUID_IP:$HTTP_SQUID_PORT??????????????????????????????????????????????????????????????

-A PREROUTING -i $CLIENT_INTERF -p tcp -m tcp --dport 80 -j REDIRECT
--to-ports $HTTP_SQUID_PORT
???????????????????????????????????????????????????????????????????????????????

-A PREROUTING -s $SQUID_IP -p tcp -m tcp --dport 443 -j DNAT
--to-destination $SQUID_IP:$HTTPS_SQUID_PORT
-A PREROUTING -i $CLIENT_INTERF -p tcp -m tcp --dport 443 -j REDIRECT
--to-ports
$HTTP_CLIENT_PORT?????????????????????????????????????????????????????????????????????????????

-A POSTROUTING -o $CLIENT_INTERF -j MASQUERADE?

COMMIT????????????????????????????????????????????????????????????????????????????

# Completed on Mon Sep 25 09:34:12
2017?????????????????????????????????????
# Generated by iptables-save v1.6.0 on Mon Sep 25 09:34:12 2017
*filter??????????????????????????????????????????????????????????????????????????

:INPUT DROP
[0:0]????????????????????????????????????????????????????????????????
:FORWARD ACCEPT [6:2262]??????????????????????????????????????????????????
:OUTPUT ACCEPT [86:9379]???????????????????????????????????????????????????
-A INPUT -i lo -j
ACCEPT??????????????????????????????????????????????????????????
-A INPUT -i $CLIENT_INTERF -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -s $CLIENT_IP -j ACCEPT??????
-A INPUT -i $CLIENT_INTERF -j ACCEPT??????
-A INPUT -j LOG?????????????????????????????????????????????
-A INPUT -j DROP??????????????????????????????????????????
-A FORWARD -s $CLIENT_IP -j ACCEPT
-A OUTPUT -o lo -j ACCEPT??????????????????????????
-A OUTPUT -s $CLIENT_INTERF -j ACCEPT?
-A OUTPUT -o $CLIENT_INTERF -j ACCEPT
COMMIT?????????????????

My client act as his own router and his iptables rules are the followings:

*mangle
:PREROUTING ACCEPT [41705:23328287]
:INPUT ACCEPT [40269:23242848]
:FORWARD ACCEPT [6:2262]
:OUTPUT ACCEPT [32950:6122247]
:POSTROUTING ACCEPT [33060:6138510]
COMMIT
# Completed on Mon Sep 25 09:34:12 2017
# Generated by iptables-save v1.6.0 on Mon Sep 25 09:34:12 2017
*nat
:PREROUTING ACCEPT [2731:496529]
:INPUT ACCEPT [1440:370186]
:OUTPUT ACCEPT [3278:202202]
:POSTROUTING ACCEPT [41:2041]
-A PREROUTING -s $CLIENT_IP -p tcp -m tcp --dport 80 -j DNAT
--to-destination $SQUID_IP:$HTTP_SQUID_PORT
-A PREROUTING -i $CLIENT_INTERF -p tcp -m tcp --dport 80 -j REDIRECT
--to-ports $HTTP_SQUID_PORT
-A PREROUTING -s $CLIENT_IP -p tcp -m tcp --dport 443 -j DNAT
--to-destination $SQUID_IP:$HTTPS_SQUID_PORT
-A PREROUTING -i $CLIENT_INTERF -p tcp -m tcp --dport 443 -j REDIRECT
--to-ports $HTTPS_SQUID_PORT
-A POSTROUTING -o $CLIENT_INTERF -j MASQUERADE
??????????????????????????????????????????????????????????????????????????????????

*filter
:INPUT DROP [0:0]
:FORWARD ACCEPT [6:2262]
:OUTPUT ACCEPT [86:9379]
-A INPUT -i lo -j ACCEPT
-A INPUT -i $CLIENT_INTERF -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -s $CLIENT_IP-j ACCEPT
-A INPUT -i $CLIENT_INTERF -j ACCEPT
-A INPUT -j LOG
-A INPUT -j DROP
-A FORWARD -s $CLIENT_IP -j ACCEPT
-A OUTPUT -o lo -j ACCEPT
-A OUTPUT -s $CLIENT_IP -j ACCEPT
-A OUTPUT -o $CLIENT_INTERF -j ACCEPT
COMMIT

As I told the intercept mode works without the "intercept flag" on the
http_port directive: I would like just to know if it's normal or I miss
something in my config.

Thanks in advance to everybody.

Best,

Davide

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 870 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171010/b76c0a16/attachment.sig>

From squid3 at treenet.co.nz  Tue Oct 10 11:26:47 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 11 Oct 2017 00:26:47 +1300
Subject: [squid-users] Squid as Transparent Proxy
In-Reply-To: <28379a82-a12a-c56c-7907-650fb55cad6c@modomoto.com>
References: <28379a82-a12a-c56c-7907-650fb55cad6c@modomoto.com>
Message-ID: <be171b91-0e47-3b2f-2464-bac77eba9df0@treenet.co.nz>

On 10/10/17 21:19, davide.motti wrote:
> Hi to everybody,
> 
> Last week I've set up Squid as transparent Proxy and everything seems to
> work fine, it cache HTTP and HTTPS connections without any problem.
> 
> The only think that "worries" me is that if I put the "intercept" flag
> on the http_port and on the https port I'm not able to connect to any
> site, but if I put off the "intercept" flag the I connect to all sites
> in transparent mode (no settings on the client's browser).

The configuration you have is not a "transparent proxy" unless you have 
the tproxy or intercept flags in squid.conf port lines. They are what 
tells Squid to do the MITM "transparent" things.

Also, you do not have any https_port in this config. So port 443 traffic 
cannot be received, no matter how it gets to Squid.

> 
> So I'm running Squid-3.5.27 on Ubuntu Server 16.04 LTS and it was so
> compiled:
> 
> ./configure --build=x86_64-linux-gnu --prefix=/usr --localstatedir=/var
> --libexecdir=${prefix}/lib/squid --datadir=${prefix}/share/squid
> --sysconfdir=/etc/squid --mandir=/usr/share/man
> --with-swapdir=/var/spool/squid --with-default-user=proxy
> --with-logdir=/var/log/squid --with-pidfile=/var/run/squid.pid
> --with-open-ssl=/etc/ssl/openssl.cnf --with-filedescriptors=65536
> --enable-ssl-crtd --enable-linux-netfilter.
> 
> The main squid.config file:
> 
> http_port
> 3128
> http_port 192.168.21.111:3129
> 
> http_port 192.168.21.111:13130 ssl-bump generate-host-certificates=on
> dynamic_cert_mem_cache_size=4MB cert=/etc/squid/ssl_cert/myRCA.pem
>                       
>                       
>                       
> acl debian src 192.168.7.112
> acl debian src fe80::a2ce:c8ff:fe1e:bfb8
> acl localhost src 127.0.0.0/32
> acl SSL_ports port 443
> acl Safe_ports port 80
> acl Safe_ports port 443
> 
> acl Safe_ports port 21
> acl Safe_ports port 70
> acl Safe_ports port 3128
> acl Safe_ports port 3129
> acl Safe_ports port 403
> acl Safe_ports port 409
> acl Safe_ports port 210
> 
> acl Safe_ports port 1025-65535
> acl Safe_ports port 280
> 
> acl Safe_ports port 488
> acl Safe_ports port 591
> acl Safe_ports port 777
> acl CONNECT method CONNECT
> # HTTP ACCESS
> http_access deny !Safe_ports
> http_access deny CONNECT !SSL_ports
>                                                               
> http_access allow localhost manager
> http_access allow debian
> http_access allow localhost
> 
> visible_hostname 20150604-004.intern.modomoto.de
>                                                                                    
> 
>                                                                                    
> 
> acl step1 at_step SslBump1
>                                                                                    
> 
> ssl_bump peek step1
> ssl_bump bump all
> sslproxy_options ALL
> sslproxy_cert_error allow all
> sslproxy_flags DONT_VERIFY_PEER

The above 5 lines disable *all* security that TLS has to offer. Chances 
of your network being " p0wned " are quite high.

This is also possibly why the intercept *appears* to work.


> sslcrtd_program /lib/squid/ssl_crtd -s /var/lib/squid/ssl_db -M 4MB
> sslcrtd_children 10
> 
> Squid iptables rules:
> 
> # Generated by iptables-save v1.6.0 on Mon Sep 25 09:34:12 2017
> *mangle
> 
> :PREROUTING ACCEPT [41705:23328287]
> :INPUT ACCEPT [40269:23242848]
> :FORWARD ACCEPT [6:2262]
> 
> :OUTPUT ACCEPT [32950:6122247]
> :POSTROUTING ACCEPT [33060:6138510]
> COMMIT
> # Completed on Mon Sep 25 09:34:12 2017
> # Generated by iptables-save v1.6.0 on Mon Sep 25 09:34:12 2017
> *nat
> 
> :PREROUTING ACCEPT [2731:496529]
> :INPUT ACCEPT [1440:370186]
> :OUTPUT ACCEPT [3278:202202]
> :POSTROUTING ACCEPT [41:2041]
> -A PREROUTING -s $CLIENT_IP -p tcp -m tcp --dport 80 -j DNAT
> --to-destination
>  ?$SQUID_IP:$HTTP_SQUID_PORT
> 
> -A PREROUTING -i $CLIENT_INTERF -p tcp -m tcp --dport 80 -j REDIRECT
> --to-ports $HTTP_SQUID_PORT
>                                                                                 
> 
> -A PREROUTING -s $SQUID_IP -p tcp -m tcp --dport 443 -j DNAT
> --to-destination $SQUID_IP:$HTTPS_SQUID_PORT
> -A PREROUTING -i $CLIENT_INTERF -p tcp -m tcp --dport 443 -j REDIRECT
> --to-ports
> $HTTP_CLIENT_PORT
> 
> -A POSTROUTING -o $CLIENT_INTERF -j MASQUERADE
> 
...


Why are you looping port 443 traffic outbound from Squid back into its 
receiving port?

And you have replaced most of the other important details with variable 
names. You have three HTTP ports (with various IPs) and zero HTTPS ports 
in squid.conf so its not even clear what these variables are referring 
to by name.

Please replace your iptables rules with the ones listed at 
<https://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxRedirect>

> 
> My client act as his own router and his iptables rules are the followings:
> 

REDIRECT/DNAT erases the destination IP Squid is connecting to when in 
"transparent" intercept mode. This is what you MUST NOT have any NAT 
between the client browser and Squid machine. Packets MUST be routed 
instead (possibly through a tunnel, but still routed).

> 
> As I told the intercept mode works without the "intercept flag" on the
> http_port directive: I would like just to know if it's normal or I miss
> something in my config.
> 

That is not normal, and not good at all. It hints that; a) the client is 
somehow sending proxy-format HTTP traffic over port 80/443 where only 
origin-format is permitted, or b) the proxy has been hacked to disable 
the CVE-2009-0801 hijacking protections.

Amos


From squid3 at treenet.co.nz  Tue Oct 10 11:38:10 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 11 Oct 2017 00:38:10 +1300
Subject: [squid-users] Ipv6 error
In-Reply-To: <1507567619725-0.post@n4.nabble.com>
References: <1507554880116-0.post@n4.nabble.com>
 <85e8f625-03bb-d9cf-743f-0de6782fad03@treenet.co.nz>
 <1507567619725-0.post@n4.nabble.com>
Message-ID: <4064383f-0dbe-d81e-5bf5-d694ced2d736@treenet.co.nz>

On 10/10/17 05:46, erdosain9 wrote:
> this is weird.
> 
> This just happend to me with that web... i mean, with
> https://wiki.squid-cache.org/ (not with google, not with facebook).
> 
> But the weird is that if i go trough a authenticate machine for ip, i
> receive that ipv6. but if i go throug a authenticate kerberos machine i get
> this net::err cert common name invalid.
> ?????

"net::err" is not something from Squid. Looks more like a Chrome error.

Which exact version of Squid is this?

> 
> so, you tell me i config in iptables to reject ipv6 traffic??
> 

For each table you expect traffic to be going through:

  ip6tables -t INPUT -I 1 PREROUTING -j REJECT
  ip6tables -t FORWARD -I 1 PREROUTING -j REJECT
  ip6tables -t OUTPUT -I 1 PREROUTING -j REJECT

(been a while, that might be '-I 0' instead of 1).

Amos


From erdosain9 at gmail.com  Tue Oct 10 13:24:05 2017
From: erdosain9 at gmail.com (erdosain9)
Date: Tue, 10 Oct 2017 06:24:05 -0700 (MST)
Subject: [squid-users] Ipv6 error
In-Reply-To: <4064383f-0dbe-d81e-5bf5-d694ced2d736@treenet.co.nz>
References: <1507554880116-0.post@n4.nabble.com>
 <85e8f625-03bb-d9cf-743f-0de6782fad03@treenet.co.nz>
 <1507567619725-0.post@n4.nabble.com>
 <4064383f-0dbe-d81e-5bf5-d694ced2d736@treenet.co.nz>
Message-ID: <1507641845081-0.post@n4.nabble.com>

Ok, thats a error from chrome.

Another thing with just that web, that if i disable dns_ipv4_first.

I get this:
----------------------------------------------------------------------------------------------------------------------------------------------------------
The following error was encountered while trying to retrieve the URL:
https://wiki.squid-cache.org/*

    Failed to establish a secure connection to 104.130.201.120

The system returned:

    (71) Protocol error (TLS code:
X509_V_ERR_UNABLE_TO_GET_ISSUER_CERT_LOCALLY)

    SSL Certficate error: certificate issuer (CA) not known: /C=US/O=Let's
Encrypt/CN=Let's Encrypt Authority X3

This proxy and the remote host failed to negotiate a mutually acceptable
security settings for handling your request. It is possible that the remote
host does not support secure connections, or the proxy is not satisfied with
the host security credentials.
-----------------------------------------------------------------------------------------------------------------------------------------------------------

AND, if i reload the web, then again this, 

----------------------------------------------------------------------------------------------------------------------------------------------------------
The following error was encountered while trying to retrieve the URL:
https://wiki.squid-cache.org/*

    Connection to 2001:4801:7827:102:ad34:6f78:b6dc:fbed failed.

The system returned: (101) Network is unreachable

The remote host or network may be down. Please try the request again.
----------------------------------------------------------------------------------------------------------------------------------------------------------

First a certificate problem (with ipv4) and later that problem in ipv6...



So i put this and all have to work (or -I 0)
  ip6tables -t INPUT -I 1 PREROUTING -j REJECT
  ip6tables -t FORWARD -I 1 PREROUTING -j REJECT
  ip6tables -t OUTPUT -I 1 PREROUTING -j REJECT 

Thanks.



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From erdosain9 at gmail.com  Tue Oct 10 13:26:19 2017
From: erdosain9 at gmail.com (erdosain9)
Date: Tue, 10 Oct 2017 06:26:19 -0700 (MST)
Subject: [squid-users] Ipv6 error
In-Reply-To: <1507641845081-0.post@n4.nabble.com>
References: <1507554880116-0.post@n4.nabble.com>
 <85e8f625-03bb-d9cf-743f-0de6782fad03@treenet.co.nz>
 <1507567619725-0.post@n4.nabble.com>
 <4064383f-0dbe-d81e-5bf5-d694ced2d736@treenet.co.nz>
 <1507641845081-0.post@n4.nabble.com>
Message-ID: <1507641979145-0.post@n4.nabble.com>

Sorry, but, the problem with the certificate is a problem from the web?? i
mean, is not a problem of "my squid".
So better i exclude that web... but, so strange, squid webpage wiki with
problem in certificate???



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From hirsch098 at gmail.com  Tue Oct 10 15:37:44 2017
From: hirsch098 at gmail.com (B Hirsch)
Date: Tue, 10 Oct 2017 15:37:44 +0000 (UTC)
Subject: [squid-users] Private root certificate
Message-ID: <C67D0F69C7AFDC75.8fb11711-9d15-436f-8043-9816a71e7ee0@mail.outlook.com>

What are the security vulnerabilities with trusting your own private root certificate?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171010/4ec6a3d8/attachment.htm>

From erdosain9 at gmail.com  Tue Oct 10 15:42:17 2017
From: erdosain9 at gmail.com (erdosain9)
Date: Tue, 10 Oct 2017 08:42:17 -0700 (MST)
Subject: [squid-users] Is your kerberos ticket expired?
In-Reply-To: <6846b493-0c6b-c2a9-336e-71b63d98f689@treenet.co.nz>
References: <1507212969805-0.post@n4.nabble.com>
 <6846b493-0c6b-c2a9-336e-71b63d98f689@treenet.co.nz>
Message-ID: <1507650137299-0.post@n4.nabble.com>

Hi.
I follow this guide

https://wiki.squid-cache.org/ConfigExamples/Authenticate/WindowsActiveDirectory

But, i dont know where put this

Add the following configuration to /etc/default/squid3

KRB5_KTNAME=/etc/squid3/PROXY.keytab
export KRB5_KTNAME

i dont have that file /etc/default/squid3

Squid is installed on Centos 7.

/usr/lib/systemd/system/squid.service


[Unit]
Description=Squid Web Proxy Server
Documentation=man:squid(8)
After=network.target

[Service]
Type=forking
LimitNOFILE=16384
PIDFile=/var/run/squid.pid
ExecStartPre=/usr/bin/mkdir -p /var/run/squid
ExecStartPre=/usr/bin/chown squid.squid /var/run/squid
ExecStart=/usr/sbin/squid -sYC
ExecReload=/usr/sbin/squid -kreconf
ExecStop=/usr/sbin/squidshut.sh
TimeoutStopSec=36
KillMode=none


[Install]
WantedBy=multi-user.target

Thanks to all.
~                                                                                                                                                    
~                            



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From Antony.Stone at squid.open.source.it  Tue Oct 10 15:49:05 2017
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Tue, 10 Oct 2017 17:49:05 +0200
Subject: [squid-users] Private root certificate
In-Reply-To: <C67D0F69C7AFDC75.8fb11711-9d15-436f-8043-9816a71e7ee0@mail.outlook.com>
References: <C67D0F69C7AFDC75.8fb11711-9d15-436f-8043-9816a71e7ee0@mail.outlook.com>
Message-ID: <201710101749.06191.Antony.Stone@squid.open.source.it>

On Tuesday 10 October 2017 at 17:37:44, B Hirsch wrote:

> What are the security vulnerabilities with trusting your own private root
> certificate?

If *you* created the certificate and *you* control the CA, so you *know* what 
certificates it has signed, I don't see that there are any vulnerabilities.

A browser will warn you that the certificate is untrusted, because it cann't 
verify the CA from its list of built-in CAs, but once you've added your own CA 
certificate to the browser, all your own signed certificates will be trusted.

The only vulnerability I can imagine is if you install the CA certificate to a 
bunch of browsers, and then someone manages to get at your CA and sign a 
certificate you don't want them to.

In this case protecting the CA is the important part (as is the case for all 
CAs).


Antony.

-- 
<flopsie> yes, but this is #lbw, we don't do normal

                                                   Please reply to the list;
                                                         please *don't* CC me.


From erdosain9 at gmail.com  Tue Oct 10 15:51:36 2017
From: erdosain9 at gmail.com (erdosain9)
Date: Tue, 10 Oct 2017 08:51:36 -0700 (MST)
Subject: [squid-users] Is your kerberos ticket expired?
In-Reply-To: <1507650137299-0.post@n4.nabble.com>
References: <1507212969805-0.post@n4.nabble.com>
 <6846b493-0c6b-c2a9-336e-71b63d98f689@treenet.co.nz>
 <1507650137299-0.post@n4.nabble.com>
Message-ID: <1507650696094-0.post@n4.nabble.com>

Sorry, i found where 
/etc/sysconfig/squid

And was good, already have that config, so i dont know why is failing. 



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From sudakov at sibptus.tomsk.ru  Wed Oct 11 01:50:43 2017
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Wed, 11 Oct 2017 08:50:43 +0700
Subject: [squid-users] TCP_REFRESH_UNMODIFIEDs are really MISSes
Message-ID: <20171011015043.GA16021@admin.sibptus.transneft.ru>

Dear Colleagues,

When updating several almost identical FreeBSD hosts via a
squid-3.5.27 proxy, I expect to see lots of HITs, because the patches
on the update server should be identical too.

However, I see lots of TCP_REFRESH_UNMODIFIED lines, and only
occasional HIT statuses. Please see the log excerpt at the end of the
message, and the example exchange between client and squid.

 From the squid documentation I figure out that a
TCP_REFRESH_UNMODIFIED status means that there was an IMS request
involved. But I don't understand who made this IMS request: client to
squid or squid to the webserver.

The "fetch" HTTP client the freebsd-update utility uses is rather dumb
and does not send IMS requests (also see below). Could someone please
explain what is happening here?

The HTTP replies from the squid cache to the HTTP client are
"X-Cache-Lookup: MISS from proxy2.sibptus.ru:8080", so these
TCP_REFRESH_UNMODIFIED statuses seem to be really MISSes and I'm not
saving traffic on these updates.


1507630624.673    389 212.73.124.12 TCP_REFRESH_UNMODIFIED/200 572 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/82a25f03517d9d65b3c0af22f77ed9cbe94d09f1af6f4cd835a93b5f191122dc-63836fc812fc7b03a2ad1d2df9c59dde3178e1eaf4d0e32342a8a04a7121ac6d - HIER_DIRECT/198.148.79.66 application/octet-stream
1507630625.067    394 212.73.124.12 TCP_REFRESH_UNMODIFIED/200 574 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/584713682ac3cc86fd2bfb7edbb9030aa48efbf027465ebcce705864310140af-0981c929f128ad067d3c8c577f9c84302523e24548b561edceee28a3357a5007 - HIER_DIRECT/198.148.79.66 application/octet-stream
1507630625.515    448 212.73.124.12 TCP_REFRESH_UNMODIFIED/200 980593 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/1195d725efce75f0db6317f507d8a9514f35613c7466673a86db23100bd6fa77-c4150431df5b14b15546b3db5e30f2bd2c35d6d52812f057dc101fab20847324 - HIER_DIRECT/198.148.79.66 application/octet-stream
1507630625.914    399 212.73.124.12 TCP_REFRESH_UNMODIFIED/200 532 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/aac782643cbfaad218bf72f037624af304d353f2a12fb6a5eeb117cdd6c9bc27-2f6df820f68859d2e86a8f45777a81a7186477048893456f891fd91dae19af3b - HIER_DIRECT/198.148.79.66 application/octet-stream
1507630625.948     33 212.73.124.12 TCP_HIT/200 980593 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/1195d725efce75f0db6317f507d8a9514f35613c7466673a86db23100bd6fa77-c4150431df5b14b15546b3db5e30f2bd2c35d6d52812f057dc101fab20847324 - HIER_NONE/- application/octet-stream
1507630626.354    406 212.73.124.12 TCP_REFRESH_UNMODIFIED/200 531 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/58764b03f019f1aa9e28e24ddb9e74abf323cfc3984bd899accf7b15bb2a6462-6d53fae808e6d79c6c251f6b1fe5e26fbd84e191f84900bcf01931d49855249f - HIER_DIRECT/198.148.79.66 application/octet-stream
1507630626.391     36 212.73.124.12 TCP_HIT/200 980593 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/1195d725efce75f0db6317f507d8a9514f35613c7466673a86db23100bd6fa77-c4150431df5b14b15546b3db5e30f2bd2c35d6d52812f057dc101fab20847324 - HIER_NONE/- application/octet-stream
1507630626.391      0 212.73.124.12 TCP_MEM_HIT/200 527 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/1af4cec823d8b1f42c3b8a58ec0da40bfc2f97efacd92e7758096eba081e08db-2ac8890502bc272d65f2b7dd73fa7def11fa4d3feb2005b82b58ba43747b57e4 - HIER_NONE/- application/octet-stream
1507630626.785    393 212.73.124.12 TCP_REFRESH_UNMODIFIED/200 697 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/6c0eae2981826e2033797003f53aedba9adb7e317c936f6923912e5df2627216-341717a9aa21a95b7f9f83e29ac3de1cac6b9d58700ece767e4ab7cd028105c9 - HIER_DIRECT/198.148.79.66 application/octet-stream
1507630627.184    399 212.73.124.12 TCP_REFRESH_UNMODIFIED/200 1001 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/6f486e6baa2d057fa16d3fa43e666917ab9d045de2e59a7d05ace758c7d03373-653636793fd95f406da85e1375acd38f31b6c39c404b18cd8e0a641a2deb6065 - HIER_DIRECT/198.148.79.66 application/octet-stream
1507630627.577    392 212.73.124.12 TCP_REFRESH_UNMODIFIED/200 674 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/3c78173d804b5299f24199a125b3c52145c7e7680c97debb051d823526ae0579-595c12cd31ef1c4d084c308b7278d28bbb844873da246d88fb02db90f90b88b9 - HIER_DIRECT/198.148.79.66 application/octet-stream
1507630627.967    389 212.73.124.12 TCP_REFRESH_UNMODIFIED/200 1193 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/cc4d2e70a2c12900362eba48bae5fa8388bfd8ed9975246578d5c68fd00fb9b3-74473c002b6e269ddb7b3c385cfff0f43b4fcbf1dcba7f36dac7c7918b19f8a9 - HIER_DIRECT/198.148.79.66 application/octet-stream
1507630628.357    391 212.73.124.12 TCP_REFRESH_UNMODIFIED/200 29745 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/2f0861149594653c2b91faec675aef008728c5ba13b352ca3877714a40bffbd6-e6b495c0d23d7eb5fe43bb07e5a8a71f3bad37844a0e8a121ef2178e5fd6ca4a - HIER_DIRECT/198.148.79.66 application/octet-stream


GET http://update.FreeBSD.org/to-10.4-RELEASE/i386/bp/4b363ee1c1e681fe5a67dd7201062ee1977f1437ce9de7c7bc9c9b84839f10df-6dc4edca0bcab3f4b0ae59d1a2714aeb0df22fce043c8897079ab9914fdafbf4 HTTP/1.1
Host: update.FreeBSD.org
User-Agent: freebsd-update (upgrade, 10.3-RELEASE-p20)
Connection: Keep-Alive

HTTP/1.1 200 OK
Date: Wed, 11 Oct 2017 01:38:16 GMT
Server: Apache/2.2.16 (FreeBSD) mod_ssl/2.2.16 OpenSSL/0.9.8n DAV/2
Last-Modified: Sun, 01 Oct 2017 19:32:05 GMT
ETag: "1f0c0de-951-55a81501e5740"
Accept-Ranges: bytes
Content-Length: 2385
Content-Type: text/plain
X-Cache: MISS from proxy2.sibptus.ru
X-Cache-Lookup: MISS from proxy2.sibptus.ru:8080
Via: 1.1 proxy2.sibptus.ru (squid/3.5.27)
Connection: keep-alive

BSDIFF40.......

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
AS43859


From rousskov at measurement-factory.com  Wed Oct 11 06:08:22 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 11 Oct 2017 00:08:22 -0600
Subject: [squid-users] TCP_REFRESH_UNMODIFIEDs are really MISSes
In-Reply-To: <20171011015043.GA16021@admin.sibptus.transneft.ru>
References: <20171011015043.GA16021@admin.sibptus.transneft.ru>
Message-ID: <de9fc141-7acf-982b-ed85-f0bedd934426@measurement-factory.com>

On 10/10/2017 07:50 PM, Victor Sudakov wrote:

> When updating several almost identical FreeBSD hosts via a
> squid-3.5.27 proxy, I expect to see lots of HITs, because the patches
> on the update server should be identical too.
> 
> However, I see lots of TCP_REFRESH_UNMODIFIED lines, and only
> occasional HIT statuses.


There are many kinds of "hits":

* If your primary concern is data transfer/bandwidth usage, then you
should focus on so called byte hits. TCP_REFRESH_UNMODIFIED is
essentially one of those because the origin server sends a tiny
headers-only response to Squid.

* If your primary concern is latency, then TCP_REFRESH_UNMODIFIED should
be treated as a miss because Squid did talk to the origin server.

You may find more relevant information and discussions if you search
around for pages containing phrases like "byte hit ratio" and "document
hit ratio".


> TCP_REFRESH_UNMODIFIED status means that there was an IMS request
> involved. But I don't understand who made this IMS request: client to
> squid or squid to the webserver.

If my quick reading of the code is correct, then the
TCP_REFRESH_UNMODIFIED status itself does not distinguish those three
cases: It could be Squid; it could be client; and it could be both. The
only thing we can say based on the status alone is that Squid decided
that the cached content was stale. Many factors can contribute to that
decision.


> The "fetch" HTTP client the freebsd-update utility uses is rather dumb
> and does not send IMS requests (also see below). Could someone please
> explain what is happening here?

If the client is not sending any conditional headers, then Squid decides
that the previously cached response has expired and needs to be revalidated.


> The HTTP replies from the squid cache to the HTTP client are
> "X-Cache-Lookup: MISS from proxy2.sibptus.ru:8080", so these
> TCP_REFRESH_UNMODIFIED statuses seem to be really MISSes and I'm not
> saving traffic on these updates.

According to your pasted log and HTTP messages, the GET request URL that
resulted an "X-Cache-Lookup: MISS" response header does not match any of
the logged URLs; even the host part of the URL does not match. To be
sure that you are comparing apples to apples, you would need to log the
X-Cache-Lookup response header to access.log (or enable ALL,2 debugging
to see headers and/or collect packet traces).


HTH,

Alex.


> 1507630624.673    389 212.73.124.12 TCP_REFRESH_UNMODIFIED/200 572 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/82a25f03517d9d65b3c0af22f77ed9cbe94d09f1af6f4cd835a93b5f191122dc-63836fc812fc7b03a2ad1d2df9c59dde3178e1eaf4d0e32342a8a04a7121ac6d - HIER_DIRECT/198.148.79.66 application/octet-stream
> 1507630625.067    394 212.73.124.12 TCP_REFRESH_UNMODIFIED/200 574 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/584713682ac3cc86fd2bfb7edbb9030aa48efbf027465ebcce705864310140af-0981c929f128ad067d3c8c577f9c84302523e24548b561edceee28a3357a5007 - HIER_DIRECT/198.148.79.66 application/octet-stream
> 1507630625.515    448 212.73.124.12 TCP_REFRESH_UNMODIFIED/200 980593 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/1195d725efce75f0db6317f507d8a9514f35613c7466673a86db23100bd6fa77-c4150431df5b14b15546b3db5e30f2bd2c35d6d52812f057dc101fab20847324 - HIER_DIRECT/198.148.79.66 application/octet-stream
> 1507630625.914    399 212.73.124.12 TCP_REFRESH_UNMODIFIED/200 532 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/aac782643cbfaad218bf72f037624af304d353f2a12fb6a5eeb117cdd6c9bc27-2f6df820f68859d2e86a8f45777a81a7186477048893456f891fd91dae19af3b - HIER_DIRECT/198.148.79.66 application/octet-stream
> 1507630625.948     33 212.73.124.12 TCP_HIT/200 980593 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/1195d725efce75f0db6317f507d8a9514f35613c7466673a86db23100bd6fa77-c4150431df5b14b15546b3db5e30f2bd2c35d6d52812f057dc101fab20847324 - HIER_NONE/- application/octet-stream
> 1507630626.354    406 212.73.124.12 TCP_REFRESH_UNMODIFIED/200 531 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/58764b03f019f1aa9e28e24ddb9e74abf323cfc3984bd899accf7b15bb2a6462-6d53fae808e6d79c6c251f6b1fe5e26fbd84e191f84900bcf01931d49855249f - HIER_DIRECT/198.148.79.66 application/octet-stream
> 1507630626.391     36 212.73.124.12 TCP_HIT/200 980593 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/1195d725efce75f0db6317f507d8a9514f35613c7466673a86db23100bd6fa77-c4150431df5b14b15546b3db5e30f2bd2c35d6d52812f057dc101fab20847324 - HIER_NONE/- application/octet-stream
> 1507630626.391      0 212.73.124.12 TCP_MEM_HIT/200 527 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/1af4cec823d8b1f42c3b8a58ec0da40bfc2f97efacd92e7758096eba081e08db-2ac8890502bc272d65f2b7dd73fa7def11fa4d3feb2005b82b58ba43747b57e4 - HIER_NONE/- application/octet-stream
> 1507630626.785    393 212.73.124.12 TCP_REFRESH_UNMODIFIED/200 697 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/6c0eae2981826e2033797003f53aedba9adb7e317c936f6923912e5df2627216-341717a9aa21a95b7f9f83e29ac3de1cac6b9d58700ece767e4ab7cd028105c9 - HIER_DIRECT/198.148.79.66 application/octet-stream
> 1507630627.184    399 212.73.124.12 TCP_REFRESH_UNMODIFIED/200 1001 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/6f486e6baa2d057fa16d3fa43e666917ab9d045de2e59a7d05ace758c7d03373-653636793fd95f406da85e1375acd38f31b6c39c404b18cd8e0a641a2deb6065 - HIER_DIRECT/198.148.79.66 application/octet-stream
> 1507630627.577    392 212.73.124.12 TCP_REFRESH_UNMODIFIED/200 674 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/3c78173d804b5299f24199a125b3c52145c7e7680c97debb051d823526ae0579-595c12cd31ef1c4d084c308b7278d28bbb844873da246d88fb02db90f90b88b9 - HIER_DIRECT/198.148.79.66 application/octet-stream
> 1507630627.967    389 212.73.124.12 TCP_REFRESH_UNMODIFIED/200 1193 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/cc4d2e70a2c12900362eba48bae5fa8388bfd8ed9975246578d5c68fd00fb9b3-74473c002b6e269ddb7b3c385cfff0f43b4fcbf1dcba7f36dac7c7918b19f8a9 - HIER_DIRECT/198.148.79.66 application/octet-stream
> 1507630628.357    391 212.73.124.12 TCP_REFRESH_UNMODIFIED/200 29745 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/2f0861149594653c2b91faec675aef008728c5ba13b352ca3877714a40bffbd6-e6b495c0d23d7eb5fe43bb07e5a8a71f3bad37844a0e8a121ef2178e5fd6ca4a - HIER_DIRECT/198.148.79.66 application/octet-stream
> 
> 
> GET http://update.FreeBSD.org/to-10.4-RELEASE/i386/bp/4b363ee1c1e681fe5a67dd7201062ee1977f1437ce9de7c7bc9c9b84839f10df-6dc4edca0bcab3f4b0ae59d1a2714aeb0df22fce043c8897079ab9914fdafbf4 HTTP/1.1
> Host: update.FreeBSD.org
> User-Agent: freebsd-update (upgrade, 10.3-RELEASE-p20)
> Connection: Keep-Alive
> 
> HTTP/1.1 200 OK
> Date: Wed, 11 Oct 2017 01:38:16 GMT
> Server: Apache/2.2.16 (FreeBSD) mod_ssl/2.2.16 OpenSSL/0.9.8n DAV/2
> Last-Modified: Sun, 01 Oct 2017 19:32:05 GMT
> ETag: "1f0c0de-951-55a81501e5740"
> Accept-Ranges: bytes
> Content-Length: 2385
> Content-Type: text/plain
> X-Cache: MISS from proxy2.sibptus.ru
> X-Cache-Lookup: MISS from proxy2.sibptus.ru:8080
> Via: 1.1 proxy2.sibptus.ru (squid/3.5.27)
> Connection: keep-alive
> 
> BSDIFF40.......
> 



From squid3 at treenet.co.nz  Wed Oct 11 06:42:33 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 11 Oct 2017 19:42:33 +1300
Subject: [squid-users] Ipv6 error
In-Reply-To: <1507641979145-0.post@n4.nabble.com>
References: <1507554880116-0.post@n4.nabble.com>
 <85e8f625-03bb-d9cf-743f-0de6782fad03@treenet.co.nz>
 <1507567619725-0.post@n4.nabble.com>
 <4064383f-0dbe-d81e-5bf5-d694ced2d736@treenet.co.nz>
 <1507641845081-0.post@n4.nabble.com> <1507641979145-0.post@n4.nabble.com>
Message-ID: <81b68fb1-41c0-25cb-4d52-c82984e0f554@treenet.co.nz>

On 11/10/17 02:26, erdosain9 wrote:
> Sorry, but, the problem with the certificate is a problem from the web?? i
> mean, is not a problem of "my squid".
> So better i exclude that web... but, so strange, squid webpage wiki with
> problem in certificate???
> 

It is either your browser or the LetsEncrypt software being broken again 
(it has failed to fetch new certs a few times now).

I am forwarding your last mail to our NOC so someone can check it again.

Amos


From sudakov at sibptus.tomsk.ru  Wed Oct 11 10:31:38 2017
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Wed, 11 Oct 2017 17:31:38 +0700
Subject: [squid-users] TCP_REFRESH_UNMODIFIEDs are really MISSes
In-Reply-To: <de9fc141-7acf-982b-ed85-f0bedd934426@measurement-factory.com>
References: <20171011015043.GA16021@admin.sibptus.transneft.ru>
 <de9fc141-7acf-982b-ed85-f0bedd934426@measurement-factory.com>
Message-ID: <20171011103138.GA42252@admin.sibptus.transneft.ru>

Alex Rousskov wrote:
> On 10/10/2017 07:50 PM, Victor Sudakov wrote:
> 
> > When updating several almost identical FreeBSD hosts via a
> > squid-3.5.27 proxy, I expect to see lots of HITs, because the patches
> > on the update server should be identical too.
> > 
> > However, I see lots of TCP_REFRESH_UNMODIFIED lines, and only
> > occasional HIT statuses.
> 
> 
> There are many kinds of "hits":
> 
> * If your primary concern is data transfer/bandwidth usage, then you
> should focus on so called byte hits. TCP_REFRESH_UNMODIFIED is
> essentially one of those because the origin server sends a tiny
> headers-only response to Squid.

My primary concern is bandwidth usage. You are saying that the
TCP_REFRESH_UNMODIFIED transaction means that the bulk of the data is
not transferred from Webserver to Squid, only the headers are fetched?

If you look at this line:

1507630625.515    448 212.73.124.12 TCP_REFRESH_UNMODIFIED/200 980593 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/1195d725efce75f0db6317f507d8a9514f35613c7466673a86db23100bd6fa77-c4150431df5b14b15546b3db5e30f2bd2c35d6d52812f057dc101fab20847324 - HIER_DIRECT/198.148.79.66 application/octet-stream

There cannot be 980593 bytes of headers? What kind of gigantic header
does it make?

[dd]

> 
> > The "fetch" HTTP client the freebsd-update utility uses is rather dumb
> > and does not send IMS requests (also see below). Could someone please
> > explain what is happening here?
> 
> If the client is not sending any conditional headers, then Squid decides
> that the previously cached response has expired and needs to be revalidated.
> 
> 
> > The HTTP replies from the squid cache to the HTTP client are
> > "X-Cache-Lookup: MISS from proxy2.sibptus.ru:8080", so these
> > TCP_REFRESH_UNMODIFIED statuses seem to be really MISSes and I'm not
> > saving traffic on these updates.
> 
> According to your pasted log and HTTP messages, the GET request URL that
> resulted an "X-Cache-Lookup: MISS" response header does not match any of
> the logged URLs; even the host part of the URL does not match. 

Of course, there are just unrelated examples. There are thousands of
fetches from update*.freebsd.org

> To be sure that you are comparing apples to apples, you would need
> to log the X-Cache-Lookup response header to access.log (or enable
> ALL,2 debugging to see headers and/or collect packet traces).

I don't think the freebsd-update cares about the X-Cache-Lookup
response, I'm just trying to save bandwidth and don't quite like the
result.

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
AS43859


From squid3 at treenet.co.nz  Wed Oct 11 10:52:10 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 11 Oct 2017 23:52:10 +1300
Subject: [squid-users] TCP_REFRESH_UNMODIFIEDs are really MISSes
In-Reply-To: <20171011103138.GA42252@admin.sibptus.transneft.ru>
References: <20171011015043.GA16021@admin.sibptus.transneft.ru>
 <de9fc141-7acf-982b-ed85-f0bedd934426@measurement-factory.com>
 <20171011103138.GA42252@admin.sibptus.transneft.ru>
Message-ID: <d4488810-1e11-31a7-914b-c46c34a9839b@treenet.co.nz>

On 11/10/17 23:31, Victor Sudakov wrote:
> Alex Rousskov wrote:
>> On 10/10/2017 07:50 PM, Victor Sudakov wrote:
>>
>>> When updating several almost identical FreeBSD hosts via a
>>> squid-3.5.27 proxy, I expect to see lots of HITs, because the patches
>>> on the update server should be identical too.
>>>
>>> However, I see lots of TCP_REFRESH_UNMODIFIED lines, and only
>>> occasional HIT statuses.
>>
>>
>> There are many kinds of "hits":
>>
>> * If your primary concern is data transfer/bandwidth usage, then you
>> should focus on so called byte hits. TCP_REFRESH_UNMODIFIED is
>> essentially one of those because the origin server sends a tiny
>> headers-only response to Squid.
> 
> My primary concern is bandwidth usage. You are saying that the
> TCP_REFRESH_UNMODIFIED transaction means that the bulk of the data is
> not transferred from Webserver to Squid, only the headers are fetched?

Yes.

> 
> If you look at this line:
> 
> 1507630625.515    448 212.73.124.12 TCP_REFRESH_UNMODIFIED/200 980593 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/1195d725efce75f0db6317f507d8a9514f35613c7466673a86db23100bd6fa77-c4150431df5b14b15546b3db5e30f2bd2c35d6d52812f057dc101fab20847324 - HIER_DIRECT/198.148.79.66 application/octet-stream
> 
> There cannot be 980593 bytes of headers? What kind of gigantic header
> does it make?
> 

That is header only between Squid and server (REFRESH_UNMODIFIED), with 
full object delivered to the client (final status "200").

...
>>
>> According to your pasted log and HTTP messages, the GET request URL that
>> resulted an "X-Cache-Lookup: MISS" response header does not match any of
>> the logged URLs; even the host part of the URL does not match.
> 
> Of course, there are just unrelated examples. There are thousands of
> fetches from update*.freebsd.org

So you just posted them to waste everybody on this lists bandwidth? 
Thanks, and kind of ironic given your "problem".

> 
>> To be sure that you are comparing apples to apples, you would need
>> to log the X-Cache-Lookup response header to access.log (or enable
>> ALL,2 debugging to see headers and/or collect packet traces).
> 
> I don't think the freebsd-update cares about the X-Cache-Lookup
> response, I'm just trying to save bandwidth and don't quite like the
> result.
> 

The X-Cache* headers are debug output from Squid. Of course the updater 
software does not care about it ... you do, sort of anyway since it 
shows whether server bandwidth was involved. They do not show REFRESH, 
so MISS means a server was contacted for _something_ and HIT means local 
cache only was used.

Amos


From rousskov at measurement-factory.com  Wed Oct 11 14:49:50 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 11 Oct 2017 08:49:50 -0600
Subject: [squid-users] TCP_REFRESH_UNMODIFIEDs are really MISSes
In-Reply-To: <d4488810-1e11-31a7-914b-c46c34a9839b@treenet.co.nz>
References: <20171011015043.GA16021@admin.sibptus.transneft.ru>
 <de9fc141-7acf-982b-ed85-f0bedd934426@measurement-factory.com>
 <20171011103138.GA42252@admin.sibptus.transneft.ru>
 <d4488810-1e11-31a7-914b-c46c34a9839b@treenet.co.nz>
Message-ID: <779c664f-a183-0519-fe25-9613fa31688e@measurement-factory.com>

On 10/11/2017 04:52 AM, Amos Jeffries wrote:
> On 11/10/17 23:31, Victor Sudakov wrote:
>> Alex Rousskov wrote:
>>> To be sure that you are comparing apples to apples, you would need
>>> to log the X-Cache-Lookup response header to access.log (or enable
>>> ALL,2 debugging to see headers and/or collect packet traces).

>> I don't think the freebsd-update cares about the X-Cache-Lookup
>> response, I'm just trying to save bandwidth and don't quite like the
>> result.

> The X-Cache* headers are debug output from Squid. [...]
> MISS means a server was contacted for _something_ and HIT means local
> cache only was used.


Here is a more accurate description of the X-Cache and X-Cache-Lookup
header fields:

X-Cache-Lookup:MISS means that Squid did not find the requested object
in its cache after parsing the client request, and X-Cache-Lookup:HIT
means that it did. In either case, the X-Cache-Lookup header field does
not tell us whether the server was contacted afterwards, although:

* X-Cache-Lookup:MISS implies that the server contact is very likely
(but various errors and other corner cases may prevent any server
contact) and

* X-Cache-Lookup:HIT implies that the server contact is less likely (but
client revalidation requests, stale cached responses, and other cases
make such contact possible).

* X-Cache-Lookup:NONE means that there was no cache lookup at all.
(Listed here for completeness sake)


There is also X-Cache header field, but its value is just a mapping of
the final(?) status code to HIT or MISS categories. In Squid v3.5, the
HIT category is assigned to TCP_HIT, TCP_IMS_HIT, TCP_INM_HIT,
TCP_REFRESH_FAIL_OLD, TCP_REFRESH_UNMODIFIED, TCP_NEGATIVE_HIT,
TCP_MEM_HIT, and TCP_OFFLINE_HIT statuses. The rest are categorized as
MISSes. The X-Cache header field does not tell us whether the server was
contacted.



To avoid misunderstanding, I have provided this information to help you
triage why Squid revalidates so much in your use case, and not to
justify Squid behavior or blame the freebsd-update client. You now know
what the logged status and the header values mean. And you now know that
you have to look at the same transaction to analyze the combination of
logged values and headers. If you want to know _why_ Squid does what it
does, the information Amos and I have provided may help you dig deeper.
Once you know "why", you may be able to adjust Squid configuration (or
something else!) to reduce excessive revalidations.


HTH,

Alex.
P.S. If the above is not documented on Squid wiki, please consider
documenting it. Thank you in advance.


From sudakov at sibptus.tomsk.ru  Wed Oct 11 14:58:36 2017
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Wed, 11 Oct 2017 21:58:36 +0700
Subject: [squid-users] TCP_REFRESH_UNMODIFIEDs are really MISSes
In-Reply-To: <d4488810-1e11-31a7-914b-c46c34a9839b@treenet.co.nz>
References: <20171011015043.GA16021@admin.sibptus.transneft.ru>
 <de9fc141-7acf-982b-ed85-f0bedd934426@measurement-factory.com>
 <20171011103138.GA42252@admin.sibptus.transneft.ru>
 <d4488810-1e11-31a7-914b-c46c34a9839b@treenet.co.nz>
Message-ID: <20171011145836.GA47035@admin.sibptus.transneft.ru>

Amos Jeffries wrote:
> > Alex Rousskov wrote:
> >> On 10/10/2017 07:50 PM, Victor Sudakov wrote:
> >>
> >>> When updating several almost identical FreeBSD hosts via a
> >>> squid-3.5.27 proxy, I expect to see lots of HITs, because the patches
> >>> on the update server should be identical too.
> >>>
> >>> However, I see lots of TCP_REFRESH_UNMODIFIED lines, and only
> >>> occasional HIT statuses.
> >>
> >>
> >> There are many kinds of "hits":
> >>
> >> * If your primary concern is data transfer/bandwidth usage, then you
> >> should focus on so called byte hits. TCP_REFRESH_UNMODIFIED is
> >> essentially one of those because the origin server sends a tiny
> >> headers-only response to Squid.
> > 
> > My primary concern is bandwidth usage. You are saying that the
> > TCP_REFRESH_UNMODIFIED transaction means that the bulk of the data is
> > not transferred from Webserver to Squid, only the headers are fetched?
> 
> Yes.
> 
> > 
> > If you look at this line:
> > 
> > 1507630625.515    448 212.73.124.12 TCP_REFRESH_UNMODIFIED/200 980593 GET http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/1195d725efce75f0db6317f507d8a9514f35613c7466673a86db23100bd6fa77-c4150431df5b14b15546b3db5e30f2bd2c35d6d52812f057dc101fab20847324 - HIER_DIRECT/198.148.79.66 application/octet-stream
> > 
> > There cannot be 980593 bytes of headers? What kind of gigantic header
> > does it make?
> > 
> 
> That is header only between Squid and server (REFRESH_UNMODIFIED), with 
> full object delivered to the client (final status "200").

I see now, the 980593 bytes in the log is between Squid and client, not between Squid
and Webserver.

> >>
> >> According to your pasted log and HTTP messages, the GET request URL that
> >> resulted an "X-Cache-Lookup: MISS" response header does not match any of
> >> the logged URLs; even the host part of the URL does not match.
> > 
> > Of course, there are just unrelated examples. There are thousands of
> > fetches from update*.freebsd.org
> 
> So you just posted them to waste everybody on this lists bandwidth? 

Hmm, well, no. Consider them two separate examples: a) a sample log
output and b) a sample HTTP session. Both were necessary for
illustrating the question. I never thought someone would try to
juxtapose them.

> Thanks, and kind of ironic given your "problem".

About 30 lines of logs and Wireshark output surely wasted the lists
bandwidth. Sorry about that.

> 
> > 
> >> To be sure that you are comparing apples to apples, you would need
> >> to log the X-Cache-Lookup response header to access.log (or enable
> >> ALL,2 debugging to see headers and/or collect packet traces).
> > 
> > I don't think the freebsd-update cares about the X-Cache-Lookup
> > response, I'm just trying to save bandwidth and don't quite like the
> > result.
> > 
> 
> The X-Cache* headers are debug output from Squid. Of course the updater 
> software does not care about it ... you do, sort of anyway since it 
> shows whether server bandwidth was involved. They do not show REFRESH, 
> so MISS means a server was contacted for _something_ and HIT means local 
> cache only was used.

Thank you for clarification. I will not fear the
TCP_REFRESH_UNMODIFIEDs any more.

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
AS43859


From davide.motti at modomoto.com  Wed Oct 11 15:10:23 2017
From: davide.motti at modomoto.com (davide.motti)
Date: Wed, 11 Oct 2017 17:10:23 +0200
Subject: [squid-users] Unable to cache Windows Update
Message-ID: <58f48dd3-6175-9911-9790-eeec0e4af000@modomoto.com>

Hi to everybody,

hope that someone can help me with this issue.

I've set up squid as transparent proxy and I would like to cache the
Windows Update in order to gain bandwidth. I follow step by step the
related page on the wiki but every time I try to download the windows
updates from the setting page I get the message that because of internet
connection the download of the updates is not possible.

I would like to tell that I'm able to cache everything else comes from
the win machine, just with the windows update I got this problem.

I'm running Squid-3.5.27 on Ubuntu Server 16.04 LTS and the Win machine
is on a VM bridged with a Debian client that is cached by Squid.

Attached my config file.

Best,

Davide

-------------- next part --------------
# HTTP Rules
http_port 3128
http_port 192.168.21.111:3129 intercept
https_port 192.168.21.111:13130 intercept ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB cert=/etc/squid/ssl_cert/myROOTCA.pem


# ACL Rules 
acl localnet src 192.168.7.112          	# RFC1918 internal network
acl localnet src fe80::a2ce:c8ff:fe1e:bfb8	# RFC1918  internal network
acl localwin src 10.0.2.15                      # Win VM
acl localhost src 127.0.0.0/32                  # locahost 

acl windowsupdate dstdomain windowsupdate.com
acl windowsupdate dstdomain microsoft.com
acl windowsupdate dstdomain windows.com
acl windowsupdate dstdomain .update.microsoft.com
acl windowsupdate dstdomain sls.microsoft.com
acl windowsupdate dstdomain windowsupdate.microsoft.com
acl windowsupdate dstdomain download.windowsupdate.com
acl windowsupdate dstdomain download.microsoft.com
acl windowsupdate dstdomain test.stats.update.microsoft.com
acl windowsupdate dstdomain ntservicepack.microsoft.com

acl CONNECT method CONNECT
acl wuCONNECT dstdomain www.update.microsoft.com
acl wuCONNECT dstdomain sls.microsoft.com
acl wuCONNECT dstdomain microsoft.com
acl wuCONNECT dstdomain windows.com
acl wuCONNECT dstdomain windowsupdate.microsoft.com
acl wuCONNECT dstdomain www.windowsupdate.com
acl wuCONNECT dstdomain download.windowsupdate.com
acl wuCONNECT dstdomain download.microsoft.com
acl wuCONNECT dstdomain www.download.windowsupdate.com
acl wuCONNECT dstdomain test.stats.update.microsoft.com
acl wuCONNECT dstdomain ntservicepack.microsoft.com

http_access allow CONNECT wuCONNECT localwin
http_access allow windowsupdate localwin

acl SSL_ports port 443
acl Safe_ports port 80		# http
acl Safe_ports port 21		# ftp
acl Safe_ports port 443		# https
acl Safe_ports port 70		# gopher
acl Safe_ports port 210		# wais
acl Safe_ports port 1025-65535	# unregistered ports
acl Safe_ports port 280		# http-mgmt
acl Safe_ports port 488		# gss-http
acl Safe_ports port 591		# filemaker
acl Safe_ports port 777		# multiling http

acl step1 at_step SslBump1
#
# HTTP_ACCESS RULES
#
# Deny requests to certain unsafe ports
http_access deny !Safe_ports

# Deny CONNECT to other than secure SSL ports
http_access deny CONNECT !SSL_ports

# Only allow cachemgr access from localhost
http_access allow localhost manager
http_access deny manager

# We strongly recommend the following be uncommented to protect innocent
# web applications running on the proxy server who think the only
# one who can access services on "localhost" is a local user
#http_access deny to_localhost
http_access allow localnet
http_access allow localwin
http_access allow localhost

# And finally deny all other access to this proxy
http_access deny all

# CACHE MANAGER
visible_hostname 20150604-004.intern.modomoto.de

# SSL DIRECTIVES
ssl_bump peek step1
ssl_bump bump all
sslcrtd_program /lib/squid/ssl_crtd -s /var/lib/squid/ssl_db -M 4MB
sslcrtd_children 10
sslproxy_cert_error allow all

# Tag: minimum_object_size
# Object smaller than this size will NOT be saved on disk.
# Default:
# no limit

# Tag: maximun_object_size
# Set the default parameter for maxi-size on any cache_dir.
range_offset_limit 10 GB windowsupdate
maximum_object_size 10 GB
quick_abort_min -1
# range_offset_limit none

# Tag: cache_dir 
# Directives about storawge system in use.
# Usage: cache_dir Sotrage_Format Directory Mbytes L1 L2.
# "ufs" (Universal Flash Storage) is Squid default storage format.
# 'mbytes' ist the amount of disk space (MB) tu use under this directory.
# 'L1' is the number of first-level subdirectories which will be created under the 'Directory'.
# 'L2' is the number of second-level subdirectories which will be created under each first-level directory.
cache_dir ufs /var/spool/squid 200000 16 256


# OPTION FOR TROUBLESHOOTING
# ----------------------------------------------------------------------------
#
#Tag: cache_log
# Squid administrative loggin file.
# Default:
# cache_log /var/log/squid/cache.log

# Tag: coredump_dir
# Directory where Squid dump core files.
coredump_dir /var/spool/squid

# MEMORY CACHE OPTIONS
# --------------------------------------------------------------------------------
# Tag: cache_mem
# Memory to use for caching very popular replies.
cache_mem 2 GB

#LOG OPTIONS
# --------------------------------------------------------------------------------
# Tag: logformat
# Logformat: client IP, client FQDN, client source port, local IP addr the client
# connected to, request URL from client, HTTP status code sent to the client
# logformat agix %>a %>A %>p %>la %>ul %>ru %>Hs

# Tag: access_log
# Configure whether and how Squid logs HTTP and ICP transactions.
access_log /var/log/squid/access.log    #agix

# OPTIONS FOR TUNING THE CACHE
# 
#
refresh_pattern -i windowsupdate.com/.*\.(cab|exe|ms[i|u|f|p]|[ap]sf|wm[v|a]|dat|zip|psf) 4320  80% 43200 reload-into-ims
refresh_pattern -i microsoft.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 80%  43200 reload-into-ims
refresh_pattern -i windows.com/.*\.(cab|exe|ms[i|u|f]|[ap]sf|wm[v|a]|dat|zip) 4320 80%  43200 reload-into-ims
refresh_pattern ^ftp:		  1440	20%	10080 reload-into-ims
refresh_pattern ^gopher:          1440	20%	7200  reload-into-ims 
refresh_pattern -i (/cgi-bin/|\?) 1400	20%	7200  reload-into-ims
refresh_pattern .		  1400	20%	7200  reload-into-ims



# Tag: minimum_expiry_time  (seconds)
# The minimum caching time according to (Expires - Date) headers Squid
# honors if the object can't be revalidated.
# Default:
# minimum_expiry_time 60 seconds
minimum_expiry_time 600 seconds

# Tag: request_header_max_size  (KB)
# This specifies the maximum size for HTTP headers in a request.
# Request headers are usually relatively small (about 512 bytes).
# Placing a limit on the request header size will cacth certain
# bugs (persistent connection) and possibly bufferin-overflow
# or denial-of-service attacks.
# Default:
# request_headers_max_size 64 KB

# Tag: reply_headers_max_size  (KB)
# This specifies the maximum size for HTTP headers in a request.
# Reply headers are usually relatively small (about 512 bytes).
# Placing a limit on the reply header size will cacth certain
# bugs (persistent connection) and possibly bufferin-overflow
# or denial-of-service attacks.
# Default:
# reply_headers_max_size 64 KB


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 870 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171011/563e4037/attachment.sig>

From edouardmoran at yahoo.fr  Wed Oct 11 15:57:03 2017
From: edouardmoran at yahoo.fr (EdouardM)
Date: Wed, 11 Oct 2017 08:57:03 -0700 (MST)
Subject: [squid-users] Question about refresh_pattern and access time...
Message-ID: <1507737423398-0.post@n4.nabble.com>

Hi All,
question i have in mind about the refresh_pattern and multi-access...
let say i use a refresh_pattern about 1 month with an already cached object,
the question is:
- scenario 1: whatever the number of times the object will be requested,
once the delay (1 month) is expired the Squid will download a fresh copy
from internet ?
- scenario 2: each time the object is requested the ending-date will be
re-calculated for +1 month ?

in both scenarii, the remote object never changes...
from your point of view, what's the correct scenario here ?

thanks guys 

bye Ed.



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From yvoinov at gmail.com  Wed Oct 11 19:08:49 2017
From: yvoinov at gmail.com (Yuri)
Date: Thu, 12 Oct 2017 01:08:49 +0600
Subject: [squid-users] Unable to cache Windows Update
In-Reply-To: <58f48dd3-6175-9911-9790-eeec0e4af000@modomoto.com>
References: <58f48dd3-6175-9911-9790-eeec0e4af000@modomoto.com>
Message-ID: <1b11bdea-7ab2-89f0-042a-488d00ebd1df@gmail.com>

It is possible, with some kind of work. However, better to use more
appropriate tool to cache WU.

This tool named WSUS. With inventory functions. Squid is not most
appropriate tool for this job. At least, you will be forced not only
cache - but keep terabytes of data.


11.10.2017 21:10, davide.motti ?????:
> Hi to everybody,
>
> hope that someone can help me with this issue.
>
> I've set up squid as transparent proxy and I would like to cache the
> Windows Update in order to gain bandwidth. I follow step by step the
> related page on the wiki but every time I try to download the windows
> updates from the setting page I get the message that because of internet
> connection the download of the updates is not possible.
>
> I would like to tell that I'm able to cache everything else comes from
> the win machine, just with the windows update I got this problem.
>
> I'm running Squid-3.5.27 on Ubuntu Server 16.04 LTS and the Win machine
> is on a VM bridged with a Debian client that is cached by Squid.
>
> Attached my config file.
>
> Best,
>
> Davide
>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
**************************
* C++: Bug to the future *
**************************

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171012/7461562c/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171012/7461562c/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171012/7461562c/attachment.sig>

From yvoinov at gmail.com  Wed Oct 11 19:14:41 2017
From: yvoinov at gmail.com (Yuri)
Date: Thu, 12 Oct 2017 01:14:41 +0600
Subject: [squid-users] Unable to cache Windows Update
In-Reply-To: <58f48dd3-6175-9911-9790-eeec0e4af000@modomoto.com>
References: <58f48dd3-6175-9911-9790-eeec0e4af000@modomoto.com>
Message-ID: <c90449f7-edef-81dc-13e4-219270265950@gmail.com>

The problem to cache WU with squid is:

1507749149.193?? 6476 172.16.100.103 TCP_HIT/206 1049109 GET
http://download.win
dowsupdate.com/c/msdownload/update/software/uprl/2017/09/windows-kb890830-v5.53-
delta_b0898f8fe7445096d0e1085266012331038a729b.exe - HIER_NONE/-
application/oct
et-stream

Request size = 1,049,109

Squid does not work well with 206. Also requires some additional work
external relatively squid to cache WU.


11.10.2017 21:10, davide.motti ?????:
> Hi to everybody,
>
> hope that someone can help me with this issue.
>
> I've set up squid as transparent proxy and I would like to cache the
> Windows Update in order to gain bandwidth. I follow step by step the
> related page on the wiki but every time I try to download the windows
> updates from the setting page I get the message that because of internet
> connection the download of the updates is not possible.
>
> I would like to tell that I'm able to cache everything else comes from
> the win machine, just with the windows update I got this problem.
>
> I'm running Squid-3.5.27 on Ubuntu Server 16.04 LTS and the Win machine
> is on a VM bridged with a Debian client that is cached by Squid.
>
> Attached my config file.
>
> Best,
>
> Davide
>
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
**************************
* C++: Bug to the future *
**************************

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171012/bd9ae9e6/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171012/bd9ae9e6/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171012/bd9ae9e6/attachment.sig>

From heiler.bemerguy at cinbesa.com.br  Wed Oct 11 19:28:32 2017
From: heiler.bemerguy at cinbesa.com.br (Heiler Bemerguy)
Date: Wed, 11 Oct 2017 16:28:32 -0300
Subject: [squid-users] Unable to cache Windows Update
In-Reply-To: <c90449f7-edef-81dc-13e4-219270265950@gmail.com>
References: <58f48dd3-6175-9911-9790-eeec0e4af000@modomoto.com>
 <c90449f7-edef-81dc-13e4-219270265950@gmail.com>
Message-ID: <08e8c5bf-f6c1-cbf4-894d-75060554d871@cinbesa.com.br>


> Squid does not work well with 206. Also requires some additional work 
> external relatively squid to cache WU.
>
>

Actually it barely works with 206, there's a bug report open about it

-- 
Atenciosamente / Best Regards,

Heiler Bemerguy
Network Manager - CINBESA
55 91 98151-4894/3184-1751



From squid3 at treenet.co.nz  Wed Oct 11 20:10:03 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 12 Oct 2017 09:10:03 +1300
Subject: [squid-users] Question about refresh_pattern and access time...
In-Reply-To: <1507737423398-0.post@n4.nabble.com>
References: <1507737423398-0.post@n4.nabble.com>
Message-ID: <018b5d65-ed74-d6f5-2c76-b0db44bd8701@treenet.co.nz>

On 12/10/17 04:57, EdouardM wrote:
> Hi All,
> question i have in mind about the refresh_pattern and multi-access...
> let say i use a refresh_pattern about 1 month with an already cached object,
> the question is:
> - scenario 1: whatever the number of times the object will be requested,
> once the delay (1 month) is expired the Squid will download a fresh copy
> from internet ?
> - scenario 2: each time the object is requested the ending-date will be
> re-calculated for +1 month ?
> 
> in both scenarii, the remote object never changes...
> from your point of view, what's the correct scenario here ?

Neither of those.

HTTP defines an algorithm for calculating object freshness.
<https://tools.ietf.org/html/rfc7234#section-4.2>

What refresh_pattern does is provide default values for the 
section-4.2.2 parameters *if* the server does not deliver the values itself.

The most recent releases of Squid can also infer Date or Last-Modified 
from message arrival times for the age calculation algorithm.

Amos


From yvoinov at gmail.com  Wed Oct 11 20:31:48 2017
From: yvoinov at gmail.com (Yuri)
Date: Thu, 12 Oct 2017 02:31:48 +0600
Subject: [squid-users] Unable to cache Windows Update
In-Reply-To: <08e8c5bf-f6c1-cbf4-894d-75060554d871@cinbesa.com.br>
References: <58f48dd3-6175-9911-9790-eeec0e4af000@modomoto.com>
 <c90449f7-edef-81dc-13e4-219270265950@gmail.com>
 <08e8c5bf-f6c1-cbf4-894d-75060554d871@cinbesa.com.br>
Message-ID: <4bd69dc4-2b48-3651-d2b4-2f38753539fe@gmail.com>



12.10.2017 1:28, Heiler Bemerguy ?????:
>
>> Squid does not work well with 206. Also requires some additional work
>> external relatively squid to cache WU.
>>
>>
>
> Actually it barely works with 206, there's a bug report open about it
>

We do not talk badly about the dead and the bugs discovered by years ;-)

-- 
**************************
* C++: Bug to the future *
**************************

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171012/bb99b644/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171012/bb99b644/attachment.sig>

From geoffmaha at gmail.com  Thu Oct 12 02:04:44 2017
From: geoffmaha at gmail.com (Geoffrey)
Date: Thu, 12 Oct 2017 13:04:44 +1100
Subject: [squid-users] Squid not failing over to secondary DNS host
Message-ID: <CAEq3_tdW_PmsAh2jT_ORLPKMx+sqKa86qHGo19egzoXn_HL3xw@mail.gmail.com>

Hello folks,

I am finding that Squid will not use the secondary DNS if the first
one is taken offline. In this case the primary DNS is not able to
respond because I have taken it offline, and therefore the secondary
DNS should be queried by squid, but is not.

I have 2 Windows recursive DNS servers; 192.168.100.249 and
192.168.100.248, that are statically specified in /etc/resolv.conf. I
am authenticating against AD using i) Kerberos and ii) NTLM.

This looks like it is a Squid internal dns client response rather than
operating system. While 192.168.100.249 is offline, all other queries
done by command-line queries work OK which indicates the system is
using the secondary DNS server fine? just not Squid!

What we want to happen of course is that if the primary
(192.168.100.249) is down or it cannot contact root DNS servers, then
it contacts the secondary nameserver specified on the LAN (as per the
configuration in resolv.conf) and resolves the name.

*Squid is SUCCESSFULLY reading resolv.conf as proved in cache.log after reload
*Setting dns resolvers directly in the squid config file with
'dns_nameservers' does not resolve the issue as the symptom is
identical
*modified squid dns timeouts to a low value (less than 10 secs) for
testing but made no difference

Many thanks for any ideas you may have.

Kind regards,
Geoff


From squid3 at treenet.co.nz  Thu Oct 12 04:53:15 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 12 Oct 2017 17:53:15 +1300
Subject: [squid-users] Squid not failing over to secondary DNS host
In-Reply-To: <CAEq3_tdW_PmsAh2jT_ORLPKMx+sqKa86qHGo19egzoXn_HL3xw@mail.gmail.com>
References: <CAEq3_tdW_PmsAh2jT_ORLPKMx+sqKa86qHGo19egzoXn_HL3xw@mail.gmail.com>
Message-ID: <f998451e-2602-0a0f-382e-c1cd499a4e87@treenet.co.nz>

On 12/10/17 15:04, Geoffrey wrote:
> Hello folks,
> 
> I am finding that Squid will not use the secondary DNS if the first
> one is taken offline. In this case the primary DNS is not able to
> respond because I have taken it offline, and therefore the secondary
> DNS should be queried by squid, but is not.
> 

How are you determining that exactly?
  squid logs? DNS logs? firewall counters? packet traces?


> I have 2 Windows recursive DNS servers; 192.168.100.249 and
> 192.168.100.248, that are statically specified in /etc/resolv.conf. I
> am authenticating against AD using i) Kerberos and ii) NTLM.
> 
> This looks like it is a Squid internal dns client response rather than
> operating system. While 192.168.100.249 is offline, all other queries
> done by command-line queries work OK which indicates the system is
> using the secondary DNS server fine? just not Squid!
> 
> What we want to happen of course is that if the primary
> (192.168.100.249) is down or it cannot contact root DNS servers, then
> it contacts the secondary nameserver specified on the LAN (as per the
> configuration in resolv.conf) and resolves the name.
> 
> *Squid is SUCCESSFULLY reading resolv.conf as proved in cache.log after reload
> *Setting dns resolvers directly in the squid config file with
> 'dns_nameservers' does not resolve the issue as the symptom is
> identical
> *modified squid dns timeouts to a low value (less than 10 secs) for
> testing but made no difference
> 
> Many thanks for any ideas you may have.


What does the cachemgr "idns" report say?


command line:
   squidclient mgr:idns

or URL:
   http://$(visible_hostname):3128/squid-internal-mgr/idns


Amos


From geoffmaha at gmail.com  Thu Oct 12 05:44:27 2017
From: geoffmaha at gmail.com (Geoffrey)
Date: Thu, 12 Oct 2017 16:44:27 +1100
Subject: [squid-users] Squid not failing over to secondary DNS host
In-Reply-To: <f998451e-2602-0a0f-382e-c1cd499a4e87@treenet.co.nz>
References: <CAEq3_tdW_PmsAh2jT_ORLPKMx+sqKa86qHGo19egzoXn_HL3xw@mail.gmail.com>
 <f998451e-2602-0a0f-382e-c1cd499a4e87@treenet.co.nz>
Message-ID: <CAEq3_te+ixhoCwrTQEtxuqUuZfLHMTYwRWwUad=_Q1+xZbGOUg@mail.gmail.com>

Thanks for your reply Amos.

I just realised I left out some info in the original email that was
pertinent. :)


>How are you determining that exactly?
> squid logs? DNS logs? firewall counters? packet traces?

Quite simply by trial and error and monitoring the results of taking
the 2 DNS/DCs offline/online, and using the cachemgr report.

EG. here is the report after I loaded one page and then took the
primary DNS offline, then continued to browse to two more pages. The
latter two pages did not load and the cachemgr report seems to verify
that squid is not using the secondary dns server at all (primary dns
server having 27 queries to 9 replies and the secondary getting none).


root at websafetyv51:~# squidclient mgr:idns
HTTP/1.1 200 OK
Server: squid/3.5.23
Mime-Version: 1.0
Date: Thu, 12 Oct 2017 05:30:12 GMT
Content-Type: text/plain;charset=utf-8
Expires: Thu, 12 Oct 2017 05:30:12 GMT
Last-Modified: Thu, 12 Oct 2017 05:30:12 GMT
X-Cache: MISS from websafetyv51.localdom.local
X-Cache-Lookup: MISS from websafetyv51.localdom.local:3128
Via: 1.1 websafetyv51.localdom.local (squid/3.5.23)
Connection: close

Internal DNS Statistics:

The Queue:
                       DELAY SINCE
  ID   SIZE SENDS FIRST SEND LAST SEND M FQDN
------ ---- ----- ---------- --------- - ----

DNS jumbo-grams: not working

Nameservers:
IP ADDRESS                                     # QUERIES # REPLIES Type
---------------------------------------------- --------- --------- --------
192.168.100.249                                      27         9 recurse
192.168.100.248                                       0         0 recurse

Rcode Matrix:
RCODE ATTEMPT1 ATTEMPT2 ATTEMPT3 PROBLEM
    0     1550        0        0 : Success
    1        0        0        0 : Packet Format Error
    2        0        0        0 : DNS Server Failure
    3        4        0        0 : Non-Existent Domain
    4        0        0        0 : Not Implemented
    5        0        0        0 : Query Refused
    6        0        0        0 : Name Exists when it should not
    7        0        0        0 : RR Set Exists when it should not
    8        0        0        0 : RR Set that should exist does not
    9        0        0        0 : Server Not Authoritative for zone
   10        0        0        0 : Name not contained in zone
   16        0        0        0 : Bad OPT Version or TSIG Signature Failure

Search list:
localdom.local


Squid version: Squid Object Cache: Version 3.5.23
Ubuntu server: "Ubuntu 16.04.3 LTS"

Cheers
Geoffrey



On 12 October 2017 at 15:53, Amos Jeffries <squid3 at treenet.co.nz> wrote:
> On 12/10/17 15:04, Geoffrey wrote:
>>
>> Hello folks,
>>
>> I am finding that Squid will not use the secondary DNS if the first
>> one is taken offline. In this case the primary DNS is not able to
>> respond because I have taken it offline, and therefore the secondary
>> DNS should be queried by squid, but is not.
>>
>
> How are you determining that exactly?
>  squid logs? DNS logs? firewall counters? packet traces?
>
>
>> I have 2 Windows recursive DNS servers; 192.168.100.249 and
>> 192.168.100.248, that are statically specified in /etc/resolv.conf. I
>> am authenticating against AD using i) Kerberos and ii) NTLM.
>>
>> This looks like it is a Squid internal dns client response rather than
>> operating system. While 192.168.100.249 is offline, all other queries
>> done by command-line queries work OK which indicates the system is
>> using the secondary DNS server fine? just not Squid!
>>
>> What we want to happen of course is that if the primary
>> (192.168.100.249) is down or it cannot contact root DNS servers, then
>> it contacts the secondary nameserver specified on the LAN (as per the
>> configuration in resolv.conf) and resolves the name.
>>
>> *Squid is SUCCESSFULLY reading resolv.conf as proved in cache.log after
>> reload
>> *Setting dns resolvers directly in the squid config file with
>> 'dns_nameservers' does not resolve the issue as the symptom is
>> identical
>> *modified squid dns timeouts to a low value (less than 10 secs) for
>> testing but made no difference
>>
>> Many thanks for any ideas you may have.
>
>
>
> What does the cachemgr "idns" report say?
>
>
> command line:
>   squidclient mgr:idns
>
> or URL:
>   http://$(visible_hostname):3128/squid-internal-mgr/idns
>
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From edouardmoran at yahoo.fr  Thu Oct 12 06:43:52 2017
From: edouardmoran at yahoo.fr (EdouardM)
Date: Wed, 11 Oct 2017 23:43:52 -0700 (MST)
Subject: [squid-users] Question about refresh_pattern and access time...
In-Reply-To: <018b5d65-ed74-d6f5-2c76-b0db44bd8701@treenet.co.nz>
References: <1507737423398-0.post@n4.nabble.com>
 <018b5d65-ed74-d6f5-2c76-b0db44bd8701@treenet.co.nz>
Message-ID: <1507790632170-0.post@n4.nabble.com>

Amos,
here is an example:
http://au.download.windowsupdate.com/d/msdownload/update/software/updt/2017/09/windows10.0-kb4023814-x86_f07f9708c76807b1b19545521f17d6e2fefdd627.cab
  HTTP/1.1 200 OK
  Cache-Control: public,max-age=172800
  Content-Length: 6150968
  Content-Type: application/vnd.ms-cab-compressed
  Last-Modified: Wed, 27 Sep 2017 21:16:36 GMT
  Accept-Ranges: bytes
  ETag: "09295e6d537d31:0"
  Server: Microsoft-IIS/8.5
  X-Powered-By: ASP.NET
  X-CID: 7
  X-CCC: IN
  X-MSEdge-Ref: Ref A: 7A93444FAE0B4491BE72E049496DEC25 Ref B: BOM02EDGE0119
Ref C: 2017-10-12T06:36:40Z
  X-MSEdge-Ref-OriginShield: Ref A: C8FD899B17694B8AA6641257C2636B9B Ref B:
BOM01EDGE0318 Ref C: 2017-10-11T14:02:56Z
  Date: Thu, 12 Oct 2017 06:36:40 GMT
Length: 6150968 (5.9M) [application/vnd.ms-cab-compressed]

does it mean the object will be valid for 2 days (max-age=172800) only, then
the Squid will download a fresh copy from internet even if we set the
refresh_pattern to 1 month ?

Ed.



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From ikeda.yuuki at tokai-grp.co.jp  Thu Oct 12 06:51:05 2017
From: ikeda.yuuki at tokai-grp.co.jp (=?UTF-8?B?VE9LQUktQ09N5rGg55SwIOWLh+iytA==?=)
Date: Thu, 12 Oct 2017 15:51:05 +0900
Subject: [squid-users] =?utf-8?b?44CQc3F1aWQgMy41LjI044CRIFByb2Nlc3MgaXMg?=
 =?utf-8?q?running=2C_but_not_printed_on_the_access=2Elog?=
Message-ID: <4e820a21-1d00-7a0a-c702-ebb5c49e320d@tokai-grp.co.jp>

Dear all,

Greetings.

I want to ask a question.
I am using squid version 3.5.24

Keep starting squid process, I stopped using server about 3 days.
After that, the process is running, but access is not printed on the 
access.log.

This problem is cleared by squid process restart,
But I don't know the cause.

If you know the cause, please let me know.

And if you know the solution other than process restart,
I want you to tell me.

Is there a possibility of coincidence?

Best regards.


From sudakov at sibptus.tomsk.ru  Thu Oct 12 10:17:57 2017
From: sudakov at sibptus.tomsk.ru (Victor Sudakov)
Date: Thu, 12 Oct 2017 17:17:57 +0700
Subject: [squid-users] TCP_REFRESH_UNMODIFIEDs are really MISSes
In-Reply-To: <779c664f-a183-0519-fe25-9613fa31688e@measurement-factory.com>
References: <20171011015043.GA16021@admin.sibptus.transneft.ru>
 <de9fc141-7acf-982b-ed85-f0bedd934426@measurement-factory.com>
 <20171011103138.GA42252@admin.sibptus.transneft.ru>
 <d4488810-1e11-31a7-914b-c46c34a9839b@treenet.co.nz>
 <779c664f-a183-0519-fe25-9613fa31688e@measurement-factory.com>
Message-ID: <20171012101757.GA76454@admin.sibptus.transneft.ru>

Alex Rousskov wrote:
> On 10/11/2017 04:52 AM, Amos Jeffries wrote:
> > On 11/10/17 23:31, Victor Sudakov wrote:
> >> Alex Rousskov wrote:
> >>> To be sure that you are comparing apples to apples, you would need
> >>> to log the X-Cache-Lookup response header to access.log (or enable
> >>> ALL,2 debugging to see headers and/or collect packet traces).
> 
> >> I don't think the freebsd-update cares about the X-Cache-Lookup
> >> response, I'm just trying to save bandwidth and don't quite like the
> >> result.
> 
> > The X-Cache* headers are debug output from Squid. [...]
> > MISS means a server was contacted for _something_ and HIT means local
> > cache only was used.
> 
> 
> Here is a more accurate description of the X-Cache and X-Cache-Lookup
> header fields:
> 
> X-Cache-Lookup:MISS means that Squid did not find the requested object
> in its cache after parsing the client request, and X-Cache-Lookup:HIT
> means that it did. In either case, the X-Cache-Lookup header field does
> not tell us whether the server was contacted afterwards, although:
> 
> * X-Cache-Lookup:MISS implies that the server contact is very likely
> (but various errors and other corner cases may prevent any server
> contact) and
> 
> * X-Cache-Lookup:HIT implies that the server contact is less likely (but
> client revalidation requests, stale cached responses, and other cases
> make such contact possible).
> 
> * X-Cache-Lookup:NONE means that there was no cache lookup at all.
> (Listed here for completeness sake)
> 
> 
> There is also X-Cache header field, but its value is just a mapping of
> the final(?) status code to HIT or MISS categories. In Squid v3.5, the
> HIT category is assigned to TCP_HIT, TCP_IMS_HIT, TCP_INM_HIT,
> TCP_REFRESH_FAIL_OLD, TCP_REFRESH_UNMODIFIED, TCP_NEGATIVE_HIT,
> TCP_MEM_HIT, and TCP_OFFLINE_HIT statuses. The rest are categorized as
> MISSes. The X-Cache header field does not tell us whether the server was
> contacted.

Alex, thanks for the details. 
> 
> 
> 
> To avoid misunderstanding, I have provided this information to help you
> triage why Squid revalidates so much in your use case, and not to
> justify Squid behavior or blame the freebsd-update client. You now know
> what the logged status and the header values mean. And you now know that
> you have to look at the same transaction to analyze the combination of
> logged values and headers. If you want to know _why_ Squid does what it
> does, the information Amos and I have provided may help you dig deeper.
> Once you know "why", you may be able to adjust Squid configuration (or
> something else!) to reduce excessive revalidations.

Now that I know that the revalidations (TCP_REFRESH_UNMODIFIEDs) don't
fetch the actual bodies of the patches, I'm fine with them.

> P.S. If the above is not documented on Squid wiki, please consider
> documenting it. Thank you in advance.

You suggest I do it? 

-- 
Victor Sudakov,  VAS4-RIPE, VAS47-RIPN
AS43859


From squid3 at treenet.co.nz  Thu Oct 12 14:14:57 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 13 Oct 2017 03:14:57 +1300
Subject: [squid-users] Question about refresh_pattern and access time...
In-Reply-To: <1507790632170-0.post@n4.nabble.com>
References: <1507737423398-0.post@n4.nabble.com>
 <018b5d65-ed74-d6f5-2c76-b0db44bd8701@treenet.co.nz>
 <1507790632170-0.post@n4.nabble.com>
Message-ID: <a7b2383c-3851-fce3-25ee-53fcbed33914@treenet.co.nz>

On 12/10/17 19:43, EdouardM wrote:
> Amos,
> here is an example:
> http://au.download.windowsupdate.com/d/msdownload/update/software/updt/2017/09/windows10.0-kb4023814-x86_f07f9708c76807b1b19545521f17d6e2fefdd627.cab
>    HTTP/1.1 200 OK
>    Cache-Control: public,max-age=172800
>    Content-Length: 6150968
>    Content-Type: application/vnd.ms-cab-compressed
>    Last-Modified: Wed, 27 Sep 2017 21:16:36 GMT
>    Accept-Ranges: bytes
>    ETag: "09295e6d537d31:0"
>    Server: Microsoft-IIS/8.5
>    X-Powered-By: ASP.NET
>    X-CID: 7
>    X-CCC: IN
>    X-MSEdge-Ref: Ref A: 7A93444FAE0B4491BE72E049496DEC25 Ref B: BOM02EDGE0119
> Ref C: 2017-10-12T06:36:40Z
>    X-MSEdge-Ref-OriginShield: Ref A: C8FD899B17694B8AA6641257C2636B9B Ref B:
> BOM01EDGE0318 Ref C: 2017-10-11T14:02:56Z
>    Date: Thu, 12 Oct 2017 06:36:40 GMT
> Length: 6150968 (5.9M) [application/vnd.ms-cab-compressed]
> 
> does it mean the object will be valid for 2 days (max-age=172800) only, then
> the Squid will download a fresh copy from internet even if we set the
> refresh_pattern to 1 month ?

CC:max-age=172800 means it can be served unconditionally from cache for 
172800 seconds from Date: Thu, 12 Oct 2017 06:36:40 GMT.

After Sat, 14 Oct 2017 06:36:40 GMT (Date + CC:max-age) it is stale and 
needs revalidating before any use. The headers from the revalidation 
response will alter the above headers to provide new values for Date and 
maybe other bits.

Altering Date naturally alters the base time for the max-age freshness 
calculation. So it should be served unconditionally for the next 48hrs 
from time of revalidation. Rinse and repeat. **

refresh_pattern is irrelevant here because all the necessary algorithm 
parameters for exact expiry (Date and CC:max-age) are provided by that 
server.


** NP: that is what should happen anyway, modulo bugs in Squid 
calculations or admin configuration settings to force other behaviour.

Amos


From rousskov at measurement-factory.com  Thu Oct 12 14:32:09 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 12 Oct 2017 08:32:09 -0600
Subject: [squid-users] TCP_REFRESH_UNMODIFIEDs are really MISSes
In-Reply-To: <20171012101757.GA76454@admin.sibptus.transneft.ru>
References: <20171011015043.GA16021@admin.sibptus.transneft.ru>
 <de9fc141-7acf-982b-ed85-f0bedd934426@measurement-factory.com>
 <20171011103138.GA42252@admin.sibptus.transneft.ru>
 <d4488810-1e11-31a7-914b-c46c34a9839b@treenet.co.nz>
 <779c664f-a183-0519-fe25-9613fa31688e@measurement-factory.com>
 <20171012101757.GA76454@admin.sibptus.transneft.ru>
Message-ID: <04a28d9d-d83c-e1b9-f988-dc5c6646a053@measurement-factory.com>

On 10/12/2017 04:17 AM, Victor Sudakov wrote:
> Alex Rousskov wrote:
>> P.S. If the above is not documented on Squid wiki, please consider
>> documenting it. Thank you in advance.

> You suggest I do it? 

I suggest that you should at least consider doing it. In a nutshell,
there is nobody better than you who is likely to do it in the
foreseeable future and who can dedicate enough time/effort to do it
well. Despite our prayers, there is no magic fairy that updates the wiki
whenever some beans of wisdom are spilled on the mailing list.

Alex.


From famaro at gmail.com  Thu Oct 12 16:24:34 2017
From: famaro at gmail.com (Francisco Amaro)
Date: Thu, 12 Oct 2017 17:24:34 +0100
Subject: [squid-users] Squid 3.5.20 and 3.1.23 getting re-started with bogus
 "FATAL: Bungled" acls
Message-ID: <CAH+mwvo5MK58oGcqRgkURObnJpgoy1=Knp2vQV=E92kf7gYijQ@mail.gmail.com>

Hello all,

We are running stock CentOS 6 and CentOS 7 Squid builds, patched to the
latest version, 3.1.23 and 3.5.20.
We have several machines, running on separate locations, with an ACL file
unique to all, that get's pushed to all machines using an homemade script.
So local configuration (interfaces, cache locations, etc) is one file, and
the bulk of the ACL's are included on
a separate file, that is the same on all servers.

For some time now, but getting more frequent on the last couple of weeks,
we have been getting errors on our cache.log about bogus ACL's, forcing a
squid restart. This happens on configuration reloads, which we do very
frequently,  maybe 10-20 times a day.

On CentOS 6, the most frequent error is :

FATAL: Bungled (null) line 203: icap_retry deny all

We do not use icap_retry, it is missing from the config file, but this
seems to be fixed on 3.2.4:

Changes to squid-3.2.4 (03 Dec 2012):
- Remove 'Bungled' warning on missing component directives

On CentOS 7, the most frequent error is :

FATAL: Bungled (null) line 3: sslproxy_cert_sign signTrusted all

Now this one even has a bug entry, and was fixed on 3.3.5:

Changes to squid-3.3.5 (20 May 2013):
- Bug 3744: squid terminated: FATAL: Bungled (null) line 3:
sslproxy_cert_sign signTrusted all

But we are still seeing it on 3.5.20...

Now what is even more weird is that besides that, we are getting what seem
complete random bogus entries, like this ones:

FATAL: Bungled /etc/squid/squid_acls line 11796: acl xyz_allow_url
FATAL: Bungled /etc/squid/squid_acls line 10905: acl abc_url108 dstdomai

FATAL: Bungled squid_acls line 10033: http_access allow def_
FATAL: Bungled squid_acls line 9605: http_access allow ms_src_teste ms_t
FATAL: Bungled squid_acls line 11025: http_access allow xpto

The problem is that these lines are 100% correct , they are not "bungled"
at all,  it seems the parser as some issue with it.

Each time we get an error like this, Squid does a full restart, and that on
CentOS 6 is time consuming, maybe 2-3 minutes, time enough for our users
reaching for the Helpdesk tickets... On CentOS 7, since the restart is very
fast, we do not have many complaints...

Our ACL file is currently 7500 lines, mostly comprising of dstdomain and
url_regex entries. We support a lot of costumers (about 100) and each one
has a specific configuration. Mostly have while lists, and there are a  few
blacklists in the middle... so, not very big in terms of line numbers, but
somewhat  complex regarding site/VLAN entries...

For security/privacy reasons I cannot share my complete configuration,
namely the ACL's part, since they contain client information, but I am able
to get detailed logging and/or redacted information...

So... anyone has any clue what is happenning ?


-- 


Francisco Amaro
Email: famaro at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171012/dcd4cdf5/attachment.htm>

From squid3 at treenet.co.nz  Fri Oct 13 03:16:52 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 13 Oct 2017 16:16:52 +1300
Subject: [squid-users] Squid 3.5.20 and 3.1.23 getting re-started with
 bogus "FATAL: Bungled" acls
In-Reply-To: <CAH+mwvo5MK58oGcqRgkURObnJpgoy1=Knp2vQV=E92kf7gYijQ@mail.gmail.com>
References: <CAH+mwvo5MK58oGcqRgkURObnJpgoy1=Knp2vQV=E92kf7gYijQ@mail.gmail.com>
Message-ID: <29cb32ba-5866-d0e8-9718-3a15e74f1fb4@treenet.co.nz>

On 13/10/17 05:24, Francisco Amaro wrote:
> Hello all,
> 
> We are running stock CentOS 6 and CentOS 7 Squid builds, patched to the 
> latest version, 3.1.23 and 3.5.20.
> We have several machines, running on separate locations, with an ACL 
> file unique to all, that get's pushed to all machines using an homemade 
> script. So local configuration (interfaces, cache locations, etc) is one 
> file, and the bulk of the ACL's are included on
> a separate file, that is the same on all servers.
> 
> For some time now, but getting more frequent on the last couple of 
> weeks, we have been getting errors on our cache.log about bogus ACL's, 
> forcing a squid restart. This happens on configuration reloads, which we 
> do very frequently,? maybe 10-20 times a day.
> 
> On CentOS 6, the most frequent error is :
> 
> FATAL: Bungled (null) line 203: icap_retry deny all
> 
> We do not use icap_retry, it is missing from the config file, but this 
> seems to be fixed on 3.2.4:
> 
> Changes to squid-3.2.4 (03 Dec 2012):
> - Remove 'Bungled' warning on missing component directives
> 
> On CentOS 7, the most frequent error is :
> 
> FATAL: Bungled (null) line 3: sslproxy_cert_sign signTrusted all
> 
> Now this one even has a bug entry, and was fixed on 3.3.5:
> 
> Changes to squid-3.3.5 (20 May 2013):
> - Bug 3744: squid terminated: FATAL: Bungled (null) line 3: 
> sslproxy_cert_sign signTrusted all
> 
> But we are still seeing it on 3.5.20...
> 
> Now what is even more weird is that besides that, we are getting what 
> seem complete random bogus entries, like this ones:
> 
> FATAL: Bungled /etc/squid/squid_acls line 11796: acl xyz_allow_url
> FATAL: Bungled /etc/squid/squid_acls line 10905: acl abc_url108 dstdomai
> 
> FATAL: Bungled squid_acls line 10033: http_access allow def_
> FATAL: Bungled squid_acls line 9605: http_access allow ms_src_teste ms_t
> FATAL: Bungled squid_acls line 11025: http_access allow xpto
> 
> The problem is that these lines are 100% correct , they are not 
> "bungled" at all,? it seems the parser as some issue with it.
> 
> Each time we get an error like this, Squid does a full restart, and that 
> on CentOS 6 is time consuming, maybe 2-3 minutes, time enough for our 
> users reaching for the Helpdesk tickets... On CentOS 7, since the 
> restart is very fast, we do not have many complaints.....

Eliezer provides some more up to date packages for CentOS 
<https://wiki.squid-cache.org/KnowledgeBase/CentOS#Squid-3.5>


> So... anyone has any clue what is happenning ?
> 

Two things come to mind:

* non-ASCII characters in your config file. That used to be a regular 
problem with cut-n-paste on some systems.



* the wrong binary running somehow.

Try shutting Squid down completely then restarting it.

If that does not work by itself you can repeat with a re-install after 
the shutdown.


Amos


From msd.mazarei at gmail.com  Fri Oct 13 09:09:21 2017
From: msd.mazarei at gmail.com (masoud mazarei)
Date: Fri, 13 Oct 2017 12:39:21 +0330
Subject: [squid-users] Squid slow down after awhile
Message-ID: <CAJeef3hGAbKSi8MPyYSuix=71=c5hNFGh+=z2tbedMz8Gtm+xA@mail.gmail.com>

I setup squid as traspsrent proxy with wccp configuration(layer 2).
All things work propery but after awhile it slows down.
I try to findout whats going to happen using tcpdump
And i know packets have delay to go out from squid machine. And I guess it
may happened cause of tproxy config of linux kernel then i check linux
kernel tproxy with
https://github.com/LiamHaworth/go-tproxy
And there is not delay to send packet out. All things work correctly with
no delay. but when I stsrt to use squid after awhile I have delay in packet
sending.
Whats your opinion?


-- 
Yours Sincerely
Masoud Mazarei
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171013/f72d2b6f/attachment.htm>

From darvin at reduc.edu.cu  Fri Oct 13 15:17:34 2017
From: darvin at reduc.edu.cu (Darvin Rivera Aguilar)
Date: Fri, 13 Oct 2017 11:17:34 -0400
Subject: [squid-users] I need help to compile squid with ssldump
Message-ID: <8cd98d90-7399-652b-fb17-455bc9781ed3@reduc.edu.cu>

I need a good tutorial to compile the latest version of squid with ssldump.
Darvin.

-------------------------------------------------------------------------------
---- Universidad de Camag?ey "Ignacio Agramonte Loynaz", Cuba ----------------
-------------------------------------------------------------------------------
---- 6 de noviembre de 2017    ------------------------------------------------
----- Aniversario 50 de la Universidad de Camag?ey "Ignacio Agramonte Loynaz"-
---- "50 a?os de ciencia y compromiso" ---------------------------------------
-------------------------------------------------------------------------------
---- Aniversario 95 de la FEU -------------------------------------------------
---- https://www.reduc.edu.cu/ ------------------------------------------------
-------------------------------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171013/c17491b9/attachment.htm>

From tynli at yahoo.com  Fri Oct 13 15:18:42 2017
From: tynli at yahoo.com (Tyn Li)
Date: Fri, 13 Oct 2017 15:18:42 +0000 (UTC)
Subject: [squid-users] Compiling with OpenSSL Support
References: <669935060.1252411.1507907922939.ref@mail.yahoo.com>
Message-ID: <669935060.1252411.1507907922939@mail.yahoo.com>

Hello,
I am trying to compile squid on Debian 9 and include OpenSSL support. ?Here are the configure options I am using:
./configure --with-openssl --enable-disk-io --enable-storeio --enable-icmp --enable-delay-pools --enable-linux-netfilter --enable-log-daemon-helpers --enable-external-acl-helpers --enable-url-rewrite-helpers --enable-storeid-rewrite-helpers

The error that I'm getting during make is this:
../../src/ssl/gadgets.h:83:45: error: ?CRYPTO_LOCK_X509? was not declared in this scope?typedef LockingPointer<X509, X509_free_cpp, CRYPTO_LOCK_X509> X509_Pointer;
I cannot find the CRYPTO_LOCK_X509 macro defined anywhere in the OpenSSL headers I've installed with libssl-dev (which is probably why I'm getting the error).
How do I get around this particular compilation error? ?What additional software/steps do I need?
Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171013/f9d0c8b6/attachment.htm>

From Antony.Stone at squid.open.source.it  Fri Oct 13 15:31:46 2017
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Fri, 13 Oct 2017 17:31:46 +0200
Subject: [squid-users] I need help to compile squid with ssldump
In-Reply-To: <8cd98d90-7399-652b-fb17-455bc9781ed3@reduc.edu.cu>
References: <8cd98d90-7399-652b-fb17-455bc9781ed3@reduc.edu.cu>
Message-ID: <201710131731.46568.Antony.Stone@squid.open.source.it>

On Friday 13 October 2017 at 17:17:34, Darvin Rivera Aguilar wrote:

> I need a good tutorial to compile the latest version of squid with ssldump.

Surely squid and ssldump are two separate applications which you run on the 
machine - squid does the proxying and ssldump tells you about the SSL/TLS 
exchanges?

I don't understand the concept of "compiling squid with ssldump"...

Does http://squid-web-proxy-cache.1019090.n4.nabble.com/Capturing-HTTPS-traffic-
td4355360.html help at all?


Antony.

-- 
"It would appear we have reached the limits of what it is possible to achieve 
with computer technology, although one should be careful with such statements; 
they tend to sound pretty silly in five years."

 - John von Neumann (1949)

                                                   Please reply to the list;
                                                         please *don't* CC me.


From klaus at tachtler.net  Fri Oct 13 15:40:53 2017
From: klaus at tachtler.net (Klaus Tachtler)
Date: Fri, 13 Oct 2017 17:40:53 +0200
Subject: [squid-users] Question about: ext_session_acl Splash/Portal
	solution.
Message-ID: <20171013174053.Horde.x7SZ4RI4K6WkCTFcw_ZSTyp@buero.tachtler.net>

Hi,

i have a running squid and I would like to show a splash screen and  
did following configuration:


--- code snipped ---
external_acl_type session concurrency=100 ttl=12000 negative_ttl=0  
children=1 %LOGIN /usr/lib64/squid/ext_session_acl -a -T 12000 -b  
/var/lib/squid/sessions/

acl session_login external session LOGIN

external_acl_type session_active_def concurrency=100 ttl=12000  
negative_ttl=0 children-max=1 %LOGIN /usr/lib64/squid/ext_session_acl  
-a -T 12000 -b /var/lib/squid/sessions/

acl session_is_active external session_active_def

acl clicked_login_url url_regex -i http://my.page.net/accept.php

http_access allow clicked_login_url session_login

http_access deny !session_is_active

deny_info http://my.page.net/splash.php?url=%u session_is_active
--- code snipped ---


After user authentication against ldap and enter the URL google.de the  
http://my.page.net/splash.php?url=%u will be shown, no problem to this  
point.

BUT, after reaching the http://my.page.net/accept.php (by pressing a  
button on the splash page) the splash page comes over and over again.

The /var/log/squid/access.log will show me that:

--- log ---

1507908437.361      1 192.168.0.10 TCP_DENIED/302 448 GET  
http://google.de/ username HIER_NONE/- text/html

--- log ---

Why I'm on a loop between splash page and accept page?

Thank you for any help!
Klaus.


-- 

------------------------------------------
e-Mail  : klaus at tachtler.net
Homepage: http://www.tachtler.net
DokuWiki: http://www.dokuwiki.tachtler.net
------------------------------------------
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-keys
Size: 3120 bytes
Desc: ?ffentlicher PGP-Schl?ssel
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171013/b2f0d502/attachment.key>

From sergioabrantes at gmail.com  Fri Oct 13 16:19:42 2017
From: sergioabrantes at gmail.com (=?UTF-8?Q?S=C3=A9rgio_Abrantes_Junior?=)
Date: Fri, 13 Oct 2017 13:19:42 -0300
Subject: [squid-users] Compiling with OpenSSL Support
In-Reply-To: <669935060.1252411.1507907922939@mail.yahoo.com>
References: <669935060.1252411.1507907922939.ref@mail.yahoo.com>
 <669935060.1252411.1507907922939@mail.yahoo.com>
Message-ID: <CAN+1GvWxCXhuO--WM205QK5GD8kWiPznJdaLfd8rkE3EVsQPEg@mail.gmail.com>

Hello,

I installed this package to resolve this: libssl1.0-dev

2017-10-13 12:18 GMT-03:00 Tyn Li <tynli at yahoo.com>:

> Hello,
>
> I am trying to compile squid on Debian 9 and include OpenSSL support.
> Here are the configure options I am using:
>
> ./configure --with-openssl --enable-disk-io --enable-storeio --enable-icmp
> --enable-delay-pools --enable-linux-netfilter --enable-log-daemon-helpers
> --enable-external-acl-helpers --enable-url-rewrite-helpers
> --enable-storeid-rewrite-helpers
>
> The error that I'm getting during make is this:
>
> ../../src/ssl/gadgets.h:83:45: error: ?CRYPTO_LOCK_X509? was not declared
> in this scope
>  typedef LockingPointer<X509, X509_free_cpp, CRYPTO_LOCK_X509>
> X509_Pointer;
>
> I cannot find the CRYPTO_LOCK_X509 macro defined anywhere in the OpenSSL
> headers I've installed with libssl-dev (which is probably why I'm getting
> the error).
>
> How do I get around this particular compilation error?  What additional
> software/steps do I need?
>
> Thanks!
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171013/11e8e043/attachment.htm>

From marcus.kool at urlfilterdb.com  Fri Oct 13 18:16:19 2017
From: marcus.kool at urlfilterdb.com (Marcus Kool)
Date: Fri, 13 Oct 2017 15:16:19 -0300
Subject: [squid-users] Compiling with OpenSSL Support
In-Reply-To: <CAN+1GvWxCXhuO--WM205QK5GD8kWiPznJdaLfd8rkE3EVsQPEg@mail.gmail.com>
References: <669935060.1252411.1507907922939.ref@mail.yahoo.com>
 <669935060.1252411.1507907922939@mail.yahoo.com>
 <CAN+1GvWxCXhuO--WM205QK5GD8kWiPznJdaLfd8rkE3EVsQPEg@mail.gmail.com>
Message-ID: <439c4f3b-d663-7bdb-a380-a4fd20ee45e8@urlfilterdb.com>

Debian 9 has openssl 1.1.x while most platforms have older versions.

I noticed myself when I ported ufdbGuard to Debian 9 that openssl 1.1.x has many changes in the API.

Marcus

On 13/10/17 13:19, S?rgio Abrantes Junior wrote:
> Hello,
> 
> I installed this package to resolve this: libssl1.0-dev
> 
> 2017-10-13 12:18 GMT-03:00 Tyn Li <tynli at yahoo.com <mailto:tynli at yahoo.com>>:
> 
>     Hello,
> 
>     I am trying to compile squid on Debian 9 and include OpenSSL support.  Here are the configure options I am using:
> 
>     ./configure --with-openssl --enable-disk-io --enable-storeio --enable-icmp --enable-delay-pools --enable-linux-netfilter --enable-log-daemon-helpers --enable-external-acl-helpers
>     --enable-url-rewrite-helpers --enable-storeid-rewrite-helpers
> 
>     The error that I'm getting during make is this:
> 
>     ../../src/ssl/gadgets.h:83:45: error: ?CRYPTO_LOCK_X509? was not declared in this scope
>       typedef LockingPointer<X509, X509_free_cpp, CRYPTO_LOCK_X509> X509_Pointer;
> 
>     I cannot find the CRYPTO_LOCK_X509 macro defined anywhere in the OpenSSL headers I've installed with libssl-dev (which is probably why I'm getting the error).
> 
>     How do I get around this particular compilation error?  What additional software/steps do I need?
> 
>     Thanks!
> 
> 
>     _______________________________________________
>     squid-users mailing list
>     squid-users at lists.squid-cache.org
>     http://lists.squid-cache.org/listinfo/squid-users
> 
> 
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 


From tynli at yahoo.com  Fri Oct 13 18:20:11 2017
From: tynli at yahoo.com (Tyn Li)
Date: Fri, 13 Oct 2017 18:20:11 +0000 (UTC)
Subject: [squid-users] Compiling with OpenSSL Support
In-Reply-To: <CAN+1GvWxCXhuO--WM205QK5GD8kWiPznJdaLfd8rkE3EVsQPEg@mail.gmail.com>
References: <669935060.1252411.1507907922939.ref@mail.yahoo.com>
 <669935060.1252411.1507907922939@mail.yahoo.com>
 <CAN+1GvWxCXhuO--WM205QK5GD8kWiPznJdaLfd8rkE3EVsQPEg@mail.gmail.com>
Message-ID: <899233744.1350544.1507918811233@mail.yahoo.com>

 Hi?S?rgio,
This fixed it for me, too.
Thanks!

    On Friday, October 13, 2017, 11:20:15 AM CDT, S?rgio Abrantes Junior <sergioabrantes at gmail.com> wrote:  
 
 Hello,

I installed this package to resolve this: libssl1.0-dev
2017-10-13 12:18 GMT-03:00 Tyn Li <tynli at yahoo.com>:

Hello,
I am trying to compile squid on Debian 9 and include OpenSSL support.? Here are the configure options I am using:
./configure --with-openssl --enable-disk-io --enable-storeio --enable-icmp --enable-delay-pools --enable-linux-netfilter --enable-log-daemon-helpers --enable-external-acl-helpers --enable-url-rewrite-helpers --enable-storeid-rewrite- helpers

The error that I'm getting during make is this:
../../src/ssl/gadgets.h:83:45: error: ?CRYPTO_LOCK_X509? was not declared in this scope?typedef LockingPointer<X509, X509_free_cpp, CRYPTO_LOCK_X509> X509_Pointer;
I cannot find the CRYPTO_LOCK_X509 macro defined anywhere in the OpenSSL headers I've installed with libssl-dev (which is probably why I'm getting the error).
How do I get around this particular compilation error?? What additional software/steps do I need?
Thanks!

______________________________ _________________
squid-users mailing list
squid-users at lists.squid-cache. org
http://lists.squid-cache.org/ listinfo/squid-users



_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171013/75ef221f/attachment.htm>

From squid3 at treenet.co.nz  Sat Oct 14 09:01:01 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 14 Oct 2017 22:01:01 +1300
Subject: [squid-users] Question about: ext_session_acl Splash/Portal
 solution.
In-Reply-To: <20171013174053.Horde.x7SZ4RI4K6WkCTFcw_ZSTyp@buero.tachtler.net>
References: <20171013174053.Horde.x7SZ4RI4K6WkCTFcw_ZSTyp@buero.tachtler.net>
Message-ID: <df530d74-c36b-56bd-19a4-e666a3c7a407@treenet.co.nz>

On 14/10/17 04:40, Klaus Tachtler wrote:>
> Why I'm on a loop between splash page and accept page?


You have two *separate* active (-a) session contexts going on 
simultaneously. They are both fighting over the session database.

Amos


From squid3 at treenet.co.nz  Sat Oct 14 09:06:18 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 14 Oct 2017 22:06:18 +1300
Subject: [squid-users] Squid slow down after awhile
In-Reply-To: <CAJeef3hGAbKSi8MPyYSuix=71=c5hNFGh+=z2tbedMz8Gtm+xA@mail.gmail.com>
References: <CAJeef3hGAbKSi8MPyYSuix=71=c5hNFGh+=z2tbedMz8Gtm+xA@mail.gmail.com>
Message-ID: <b933aba9-8797-90a2-187d-e642ec5ce363@treenet.co.nz>

On 13/10/17 22:09, masoud mazarei wrote:
> I setup squid as traspsrent proxy with wccp configuration(layer 2).
> All things work propery but after awhile it slows down.
> I try to findout whats going to happen using tcpdump
> And i know packets have delay to go out from squid machine. And I guess 
> it may happened cause of tproxy config of linux kernel then i check 
> linux kernel tproxy with
> https://github.com/LiamHaworth/go-tproxy
> And there is not delay to send packet out. All things work correctly 
> with no delay. but when I stsrt to use squid after awhile I have delay 
> in packet sending.
> Whats your opinion?
> 

Insufficient data:

* Check you WCCP TCAM table size.

* Check your iptables/netfilter memory usage and table capacities.

* Check your available TCP ports.

* Check your Squid machines per-process FD limitations. As viewed by the 
OS and what Squid thinks are available.

* Check for forwarding loops (set 'via on' in squid.conf).

* Check your logs for any issues that may be reported. Especially squid 
cache.log and OS system log.


Amos


From squid3 at treenet.co.nz  Sat Oct 14 09:47:38 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 14 Oct 2017 22:47:38 +1300
Subject: [squid-users] Squid not failing over to secondary DNS host
In-Reply-To: <CAEq3_te+ixhoCwrTQEtxuqUuZfLHMTYwRWwUad=_Q1+xZbGOUg@mail.gmail.com>
References: <CAEq3_tdW_PmsAh2jT_ORLPKMx+sqKa86qHGo19egzoXn_HL3xw@mail.gmail.com>
 <f998451e-2602-0a0f-382e-c1cd499a4e87@treenet.co.nz>
 <CAEq3_te+ixhoCwrTQEtxuqUuZfLHMTYwRWwUad=_Q1+xZbGOUg@mail.gmail.com>
Message-ID: <9a596135-d65d-889c-bd6f-2c3b4a9b9007@treenet.co.nz>

On 12/10/17 18:44, Geoffrey wrote:
> Thanks for your reply Amos.
> 
> I just realised I left out some info in the original email that was
> pertinent. :)
> 
> 
>> How are you determining that exactly?
>> squid logs? DNS logs? firewall counters? packet traces?
> 
> Quite simply by trial and error and monitoring the results of taking
> the 2 DNS/DCs offline/online, and using the cachemgr report.
> 
> EG. here is the report after I loaded one page and then took the
> primary DNS offline, then continued to browse to two more pages. The
> latter two pages did not load and the cachemgr report seems to verify
> that squid is not using the secondary dns server at all (primary dns
> server having 27 queries to 9 replies and the secondary getting none).
> 
> 
> root at websafetyv51:~# squidclient mgr:idns
> Date: Thu, 12 Oct 2017 05:30:12 GMT
 > Via: 1.1 websafetyv51.localdom.local (squid/3.5.23)
...
> 
> Internal DNS Statistics:
> 
> The Queue:
>                         DELAY SINCE
>    ID   SIZE SENDS FIRST SEND LAST SEND M FQDN
> ------ ---- ----- ---------- --------- - ----
> 
> DNS jumbo-grams: not working
> 
> Nameservers:
> IP ADDRESS                                     # QUERIES # REPLIES Type
> ---------------------------------------------- --------- --------- --------
> 192.168.100.249                                      27         9 recurse
> 192.168.100.248                                       0         0 recurse
> 
> Rcode Matrix:
> RCODE ATTEMPT1 ATTEMPT2 ATTEMPT3 PROBLEM
>      0     1550        0        0 : Success
...

That is a bit odd. Also the fact that ~1550 queries are not showing up 
in the nameserver counters.

Do you have ICMP and ICMPv6 working in your network? If not that is 
probably part of the issue.

Are you using DROP rules or policies in your firewalls? that can also 
lead to missing packets like this.

Are you able to perform some more careful tests?
  * restart Squid with both resolvers active and take snapshots of that 
report periodically across the test. It will need sufficient time after 
shutting down the first resolver for any packet or query TTLs to expire.


If you could also check whether either resolver is responding using 
alternative IP addresses it would help clarify what is going on.


Amos


From msd.mazarei at gmail.com  Sat Oct 14 10:03:03 2017
From: msd.mazarei at gmail.com (masoud mazarei)
Date: Sat, 14 Oct 2017 13:33:03 +0330
Subject: [squid-users] Squid slow down after awhile
In-Reply-To: <b933aba9-8797-90a2-187d-e642ec5ce363@treenet.co.nz>
References: <CAJeef3hGAbKSi8MPyYSuix=71=c5hNFGh+=z2tbedMz8Gtm+xA@mail.gmail.com>
 <b933aba9-8797-90a2-187d-e642ec5ce363@treenet.co.nz>
Message-ID: <CAJeef3jAweLJtQqn4k3NcKR7v2LzT50mow1UHjssyq+C90ifwQ@mail.gmail.com>

TCP ESTABLISHED=54
TCP SYNC/WAIT/FIN=0

FD limitation=64000
net.core.rmem_max = 33554432
net.core.wmem_max = 33554432
net.ipv4.tcp_rmem = 4096 87380 33554432
net.ipv4.tcp_wmem = 4096 65536 33554432
net.ipv4.tcp_window_scaling=1
net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_mem = 50576   64768   98152
net.core.netdev_max_backlog = 2500
net.ipv4.netfilter.ip_conntrack_max = 1048576
net.ipv4.ip_local_port_range = 18000    65535

CISCO TCAM 10 mac learned(cache server mac,gateway mac ...)

no forward loop
no error in cache.log and syslog
iptables totaly have 10 rows in all chains. and no mem usage which affects
os and machine
and i have only 1 user behind cache server.
also i have checked with many users behind cache but no differ in result.
i have same problem with squid 3.5 and squid 3.1




On Sat, Oct 14, 2017 at 12:36 PM, Amos Jeffries <squid3 at treenet.co.nz>
wrote:

> On 13/10/17 22:09, masoud mazarei wrote:
>
>> I setup squid as traspsrent proxy with wccp configuration(layer 2).
>> All things work propery but after awhile it slows down.
>> I try to findout whats going to happen using tcpdump
>> And i know packets have delay to go out from squid machine. And I guess
>> it may happened cause of tproxy config of linux kernel then i check linux
>> kernel tproxy with
>> https://github.com/LiamHaworth/go-tproxy
>> And there is not delay to send packet out. All things work correctly with
>> no delay. but when I stsrt to use squid after awhile I have delay in packet
>> sending.
>> Whats your opinion?
>>
>>
> Insufficient data:
>
> * Check you WCCP TCAM table size.
>
> * Check your iptables/netfilter memory usage and table capacities.
>
> * Check your available TCP ports.
>
> * Check your Squid machines per-process FD limitations. As viewed by the
> OS and what Squid thinks are available.
>
> * Check for forwarding loops (set 'via on' in squid.conf).
>
> * Check your logs for any issues that may be reported. Especially squid
> cache.log and OS system log.
>
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>



-- 
Yours Sincerely
Masoud Mazarei
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171014/d520704e/attachment.htm>

From squid3 at treenet.co.nz  Sat Oct 14 20:27:44 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sun, 15 Oct 2017 09:27:44 +1300
Subject: [squid-users] Squid slow down after awhile
In-Reply-To: <CAJeef3hf-_-tu-A8TORjTL5ToJLwQNRAWm+isNpy_mKpZ3XuWA@mail.gmail.com>
References: <CAJeef3hGAbKSi8MPyYSuix=71=c5hNFGh+=z2tbedMz8Gtm+xA@mail.gmail.com>
 <b933aba9-8797-90a2-187d-e642ec5ce363@treenet.co.nz>
 <CAJeef3hf-_-tu-A8TORjTL5ToJLwQNRAWm+isNpy_mKpZ3XuWA@mail.gmail.com>
Message-ID: <4f640157-235d-d58e-25b6-63cd79bbf2ca@treenet.co.nz>

On 15/10/17 05:20, masoud mazarei wrote:
> i sent you an pcap file which shows the problem.
> my client ip is 172.22.127.1 and target host is??94.182.227.21.
> squid machine mac is?e4:11:5b:ea:30:c2.
> filter pcap file in wireshark by filter "ip.host==94.182.227.21" you 
> will see that the first SYN packet arrived in No.304 and relative time 
> 6.637173 but first packet which goes out from cache machine as client by 
> squid happend in No.371 and relative time 45.013691

That kind of indicates the problem is either in how long the client 
takes to deliver the HTTP request to Squid, or DNS lookups to find the 
destination(s).

> what is happend in (6.637173 - 45.013691) duration.?

For a transparent proxy these things have happened between SYN on 
client<->Squid and SYN on Squid<->server:


* NAT/TPROXY record lookups for client connection state

* wait for the client to send its HTTP request.
  - with happy eyeballs there may be a large wait between the SYN and 
first data sent by client for ~50% of connections.

* parsing of that HTTP request message.

* DNS lookup(s) for Host header verification

* http_access checks

* Adaptation hooks (ICAP / eCAP), if any

* URL re-writer lookups, if any

* HTTP 'cache' directive ACL checks

* HTTP cache lookup

* DNS lookups to find destination, if any
  - this should be very fast since the Host verify results should be 
cached. But if any of the above took longer than DNS TTL new lookups may 
be required - naturally increasing the delay further.

* Destination selection

* TCP server connection(s) setup
  - if you are only looking at IPv4 packets you may be missing multiple 
SYN packets for IPv6 servers before the first IPv4 SYN packet appears.


The points above with sub-notes are the ones most likely to be delayed 
for seconds. You may be seeing one particular source of the problem, or 
multiple adding together. 45 sec seems an unusual number. Most of the 
timeouts in Squid and networking are multiples of 30 sec.



> which debug level will help me to know what is happend in background?
> i enabled
> "debug_options 5,3 6,3 46,3 11,3 19,3 55,3 58,3"
> BUT there is no valuable data to solve this problem.
> 

You may need an ALL,6 trace then to see if there are any clues in odd 
places. As verbose as it is the debugging in Squid is far from complete 
so for some of these delay issues there no specific lines to look for 
mention and we have to go by relative timing of things.

The durations between actions on the list of points above should narrow 
down a bit better what to look at.

Amos


From klaus at tachtler.net  Sat Oct 14 21:02:37 2017
From: klaus at tachtler.net (Klaus Tachtler)
Date: Sat, 14 Oct 2017 23:02:37 +0200
Subject: [squid-users] Question about: ext_session_acl Splash/Portal
 solution.
In-Reply-To: <df530d74-c36b-56bd-19a4-e666a3c7a407@treenet.co.nz>
References: <20171013174053.Horde.x7SZ4RI4K6WkCTFcw_ZSTyp@buero.tachtler.net>
 <df530d74-c36b-56bd-19a4-e666a3c7a407@treenet.co.nz>
Message-ID: <20171014230237.Horde.7lXgVKZUrx1iDHZ-Z3zO3Re@buero.tachtler.net>

Hi Amos,

> On 14/10/17 04:40, Klaus Tachtler wrote:>
>> Why I'm on a loop between splash page and accept page?
>
>
> You have two *separate* active (-a) session contexts going on  
> simultaneously. They are both fighting over the session database.

Oh my god, to delete "-a" on the "session_active_def" was the solution.
I was searching hours and hours for that!

Thank you so much for the simple line you wrote to me!

> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

Thank you!
Klaus.


-- 

------------------------------------------
e-Mail  : klaus at tachtler.net
Homepage: http://www.tachtler.net
DokuWiki: http://www.dokuwiki.tachtler.net
------------------------------------------
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-keys
Size: 3120 bytes
Desc: ?ffentlicher PGP-Schl?ssel
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171014/f9c2c79c/attachment.key>

From squid3 at treenet.co.nz  Sun Oct 15 12:17:54 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 16 Oct 2017 01:17:54 +1300
Subject: [squid-users] Question about: ext_session_acl Splash/Portal
 solution.
In-Reply-To: <20171014230237.Horde.7lXgVKZUrx1iDHZ-Z3zO3Re@buero.tachtler.net>
References: <20171013174053.Horde.x7SZ4RI4K6WkCTFcw_ZSTyp@buero.tachtler.net>
 <df530d74-c36b-56bd-19a4-e666a3c7a407@treenet.co.nz>
 <20171014230237.Horde.7lXgVKZUrx1iDHZ-Z3zO3Re@buero.tachtler.net>
Message-ID: <9db803ba-8e68-6629-3b5d-e93dea82d723@treenet.co.nz>

On 15/10/17 10:02, Klaus Tachtler wrote:
> Hi Amos,
> 
>> On 14/10/17 04:40, Klaus Tachtler wrote:>
>>> Why I'm on a loop between splash page and accept page?
>>
>>
>> You have two *separate* active (-a) session contexts going on 
>> simultaneously. They are both fighting over the session database.
> 
> Oh my god, to delete "-a" on the "session_active_def" was the solution.
> I was searching hours and hours for that!
> 
> Thank you so much for the simple line you wrote to me!

If that is the only change you made it is still not solved either, your 
sessions will never end.

You need *one* session. You get to pick active or passive:

* Active has specific ACLs for LOGIN/LOGOUT/test.
  - for when the clicked URL just *has* to be the specific one.

* Passive has only one ACL for atomic test+login.
  - for when either click OR refresh OR any other page fetch is enough 
to continue.
  - every test of the ACL updates the session timestamp not to expire.

Amos


From uhlar at fantomas.sk  Sun Oct 15 16:17:26 2017
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Sun, 15 Oct 2017 18:17:26 +0200
Subject: [squid-users] Compiling with OpenSSL Support
In-Reply-To: <439c4f3b-d663-7bdb-a380-a4fd20ee45e8@urlfilterdb.com>
References: <669935060.1252411.1507907922939.ref@mail.yahoo.com>
 <669935060.1252411.1507907922939@mail.yahoo.com>
 <CAN+1GvWxCXhuO--WM205QK5GD8kWiPznJdaLfd8rkE3EVsQPEg@mail.gmail.com>
 <439c4f3b-d663-7bdb-a380-a4fd20ee45e8@urlfilterdb.com>
Message-ID: <20171015161726.GB5817@fantomas.sk>

>>2017-10-13 12:18 GMT-03:00 Tyn Li <tynli at yahoo.com <mailto:tynli at yahoo.com>>:
>>    ../../src/ssl/gadgets.h:83:45: error: ?CRYPTO_LOCK_X509? was not declared in this scope
>>      typedef LockingPointer<X509, X509_free_cpp, CRYPTO_LOCK_X509> X509_Pointer;

>On 13/10/17 13:19, S?rgio Abrantes Junior wrote:
>>I installed this package to resolve this: libssl1.0-dev

why not libssl-dev?

On 13.10.17 15:16, Marcus Kool wrote:
>Debian 9 has openssl 1.1.x while most platforms have older versions.

that means, you should use libssl-dev unless you know squid can't compile
with openssl-1.1

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Atheism is a non-prophet organization. 


From klaus at tachtler.net  Sun Oct 15 18:17:33 2017
From: klaus at tachtler.net (Klaus Tachtler)
Date: Sun, 15 Oct 2017 20:17:33 +0200
Subject: [squid-users] Question about: ext_session_acl Splash/Portal
 solution.
In-Reply-To: <9db803ba-8e68-6629-3b5d-e93dea82d723@treenet.co.nz>
References: <20171013174053.Horde.x7SZ4RI4K6WkCTFcw_ZSTyp@buero.tachtler.net>
 <df530d74-c36b-56bd-19a4-e666a3c7a407@treenet.co.nz>
 <20171014230237.Horde.7lXgVKZUrx1iDHZ-Z3zO3Re@buero.tachtler.net>
 <9db803ba-8e68-6629-3b5d-e93dea82d723@treenet.co.nz>
Message-ID: <20171015201733.Horde.Wc7rCYoHpdMV8ZC3tsQfvio@buero.tachtler.net>

Hi Amos,

after a little bit more testing, of course I must agree with you, it  
doesn't work as expected.

Please can you give me another advice? Where is my fault?

I tried to use the *ACTIVE* example from the squid documentation and  
modified it a little bit on 3 parts of the code, BUT a LOOP are still  
there!

https://wiki.squid-cache.org/ConfigExamples/Portal/Splash#Squid_Configuration_File_-_Active_Mode

--- code ---

# Set up the session helper in active mode. Mind the wrap - this is  
one line: - *MODIFIED* - (all in one line)
external_acl_type session concurrency=100 ttl=3 negative_ttl=0  
children-max=1 %LOGIN /usr/lib64/squid/ext_session_acl -a -T 60 -b  
/var/lib/squid/sessions/

# Pass the LOGIN command to the session helper with this ACL
acl session_login external session LOGIN

# Normal session ACL as per simple example
acl session_is_active external session

# ACL to match URL - *MODIFIED* -
acl clicked_login_url url_regex -i http://my.pages.net/html/accept.php

# First check for the login URL. If present, login session
http_access allow clicked_login_url session_login

# If we get here, URL not present, so renew session or deny request.
http_access deny !session_is_active

# Deny page to display - *MODIFIED* - NOT using a template with HTML-Code 511!
deny_info http://my.pages.net/html/splash.php?url=%u session_is_active

--- code ---

If you want, I can share the code from the pages
- http://my.pages.net/html/accept.php
- http://my.pages.net/html/splash.php?url=%u
too?

The idea behind the two PHP pages are, to store the original URL with  
the splash.php inside a PHP session and make a redirect inside the  
accept.php to the original URL.


Thank you for your time and your patience with me!
Klaus.

> On 15/10/17 10:02, Klaus Tachtler wrote:
>> Hi Amos,
>>
>>> On 14/10/17 04:40, Klaus Tachtler wrote:>
>>>> Why I'm on a loop between splash page and accept page?
>>>
>>>
>>> You have two *separate* active (-a) session contexts going on  
>>> simultaneously. They are both fighting over the session database.
>>
>> Oh my god, to delete "-a" on the "session_active_def" was the solution.
>> I was searching hours and hours for that!
>>
>> Thank you so much for the simple line you wrote to me!
>
> If that is the only change you made it is still not solved either,  
> your sessions will never end.
>
> You need *one* session. You get to pick active or passive:
>
> * Active has specific ACLs for LOGIN/LOGOUT/test.
>  - for when the clicked URL just *has* to be the specific one.
>
> * Passive has only one ACL for atomic test+login.
>  - for when either click OR refresh OR any other page fetch is  
> enough to continue.
>  - every test of the ACL updates the session timestamp not to expire.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


----- Ende der Nachricht von Amos Jeffries <squid3 at treenet.co.nz> -----




-- 

------------------------------------------
e-Mail  : klaus at tachtler.net
Homepage: http://www.tachtler.net
DokuWiki: http://www.dokuwiki.tachtler.net
------------------------------------------
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-keys
Size: 3120 bytes
Desc: ?ffentlicher PGP-Schl?ssel
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171015/6f44c6b3/attachment.key>

From marcus.kool at urlfilterdb.com  Sun Oct 15 20:43:28 2017
From: marcus.kool at urlfilterdb.com (Marcus Kool)
Date: Sun, 15 Oct 2017 18:43:28 -0200
Subject: [squid-users] Compiling with OpenSSL Support
In-Reply-To: <20171015161726.GB5817@fantomas.sk>
References: <669935060.1252411.1507907922939.ref@mail.yahoo.com>
 <669935060.1252411.1507907922939@mail.yahoo.com>
 <CAN+1GvWxCXhuO--WM205QK5GD8kWiPznJdaLfd8rkE3EVsQPEg@mail.gmail.com>
 <439c4f3b-d663-7bdb-a380-a4fd20ee45e8@urlfilterdb.com>
 <20171015161726.GB5817@fantomas.sk>
Message-ID: <a9e7a91c-1764-be57-d337-77f198ebf7fa@urlfilterdb.com>



On 15/10/17 14:17, Matus UHLAR - fantomas wrote:
>>> 2017-10-13 12:18 GMT-03:00 Tyn Li <tynli at yahoo.com <mailto:tynli at yahoo.com>>:
>>>    ../../src/ssl/gadgets.h:83:45: error: ?CRYPTO_LOCK_X509? was not declared in this scope
>>>      typedef LockingPointer<X509, X509_free_cpp, CRYPTO_LOCK_X509> X509_Pointer;
> 
>> On 13/10/17 13:19, S?rgio Abrantes Junior wrote:
>>> I installed this package to resolve this: libssl1.0-dev
> 
> why not libssl-dev?
> 
> On 13.10.17 15:16, Marcus Kool wrote:
>> Debian 9 has openssl 1.1.x while most platforms have older versions.
> 
> that means, you should use libssl-dev unless you know squid can't compile
> with openssl-1.1

Openssl 1.1.x is not backwards compatible and does not have the symbol CRYPTO_LOCK_X509 while openssl 1.0.2 has.


From uhlar at fantomas.sk  Mon Oct 16 10:47:51 2017
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Mon, 16 Oct 2017 12:47:51 +0200
Subject: [squid-users] Compiling with OpenSSL Support
In-Reply-To: <a9e7a91c-1764-be57-d337-77f198ebf7fa@urlfilterdb.com>
References: <669935060.1252411.1507907922939.ref@mail.yahoo.com>
 <669935060.1252411.1507907922939@mail.yahoo.com>
 <CAN+1GvWxCXhuO--WM205QK5GD8kWiPznJdaLfd8rkE3EVsQPEg@mail.gmail.com>
 <439c4f3b-d663-7bdb-a380-a4fd20ee45e8@urlfilterdb.com>
 <20171015161726.GB5817@fantomas.sk>
 <a9e7a91c-1764-be57-d337-77f198ebf7fa@urlfilterdb.com>
Message-ID: <20171016104751.GB31683@fantomas.sk>

>On 15/10/17 14:17, Matus UHLAR - fantomas wrote:
>>>>2017-10-13 12:18 GMT-03:00 Tyn Li <tynli at yahoo.com <mailto:tynli at yahoo.com>>:
>>>>   ../../src/ssl/gadgets.h:83:45: error: ?CRYPTO_LOCK_X509? was not declared in this scope
>>>>     typedef LockingPointer<X509, X509_free_cpp, CRYPTO_LOCK_X509> X509_Pointer;
>>
>>>On 13/10/17 13:19, S?rgio Abrantes Junior wrote:
>>>>I installed this package to resolve this: libssl1.0-dev
>>
>>why not libssl-dev?
>>
>>On 13.10.17 15:16, Marcus Kool wrote:
>>>Debian 9 has openssl 1.1.x while most platforms have older versions.
>>
>>that means, you should use libssl-dev unless you know squid can't compile
>>with openssl-1.1

On 15.10.17 18:43, Marcus Kool wrote:
>Openssl 1.1.x is not backwards compatible and does not have the symbol
> CRYPTO_LOCK_X509 while openssl 1.0.2 has.

are you talking about squid or ufdbguard?

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
Eagles may soar, but weasels don't get sucked into jet engines. 


From duanyao at ustc.edu  Mon Oct 16 12:26:01 2017
From: duanyao at ustc.edu (duanyao)
Date: Mon, 16 Oct 2017 20:26:01 +0800
Subject: [squid-users] Is it safe to resize a rock storage file?
Message-ID: <8e8339c9-89bf-fb65-5eec-96d820107d31@ustc.edu>

Hi,

Is it safe to resize a rock storage file as follow (while squid is not 
running)?

1) Increase a rock storage file by increasing the size specified in the 
configuration file;

2) Decrease a rock storage file by decreasing the size specified in the 
configuration file and run `truncate --size <new size> rock_file`;

By "safe" I mean no rubbish data will ever be delivered to clients after 
resizing, while loss of some cached data is OK.


Regards,

Duan, Yao





From squid3 at treenet.co.nz  Mon Oct 16 14:04:06 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 17 Oct 2017 03:04:06 +1300
Subject: [squid-users] Compiling with OpenSSL Support
In-Reply-To: <20171016104751.GB31683@fantomas.sk>
References: <669935060.1252411.1507907922939.ref@mail.yahoo.com>
 <669935060.1252411.1507907922939@mail.yahoo.com>
 <CAN+1GvWxCXhuO--WM205QK5GD8kWiPznJdaLfd8rkE3EVsQPEg@mail.gmail.com>
 <439c4f3b-d663-7bdb-a380-a4fd20ee45e8@urlfilterdb.com>
 <20171015161726.GB5817@fantomas.sk>
 <a9e7a91c-1764-be57-d337-77f198ebf7fa@urlfilterdb.com>
 <20171016104751.GB31683@fantomas.sk>
Message-ID: <90c7992e-db2c-af5e-cf63-1c8c6b355c9c@treenet.co.nz>

On 16/10/17 23:47, Matus UHLAR - fantomas wrote:
>> On 15/10/17 14:17, Matus UHLAR - fantomas wrote:
>>>>> 2017-10-13 12:18 GMT-03:00 Tyn Li:
>>>>> ? ../../src/ssl/gadgets.h:83:45: error: ?CRYPTO_LOCK_X509? was not 
>>>>> declared in this scope
>>>>> ??? typedef LockingPointer<X509, X509_free_cpp, CRYPTO_LOCK_X509> 
>>>>> X509_Pointer;
>>>
>>>> On 13/10/17 13:19, S?rgio Abrantes Junior wrote:
>>>>> I installed this package to resolve this: libssl1.0-dev
>>>
>>> why not libssl-dev?
>>>
>>> On 13.10.17 15:16, Marcus Kool wrote:
>>>> Debian 9 has openssl 1.1.x while most platforms have older versions.
>>>
>>> that means, you should use libssl-dev unless you know squid can't 
>>> compile
>>> with openssl-1.1
> 
> On 15.10.17 18:43, Marcus Kool wrote:
>> Openssl 1.1.x is not backwards compatible and does not have the symbol
>> CRYPTO_LOCK_X509 while openssl 1.0.2 has.
> 
> are you talking about squid or ufdbguard?
> 

Doesn't matter, it is a problem with OpenSSL 1.0 vs 1.1.
Anything which uses OpenSSL 1.0 specific symbols needs libssl1.0-dev on 
Debian.

Amos


From squid3 at treenet.co.nz  Mon Oct 16 14:22:32 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 17 Oct 2017 03:22:32 +1300
Subject: [squid-users] Squid not failing over to secondary DNS host
In-Reply-To: <CAEq3_tfchAqLw01yhXbxyeTX5Q1A2VUOqR-h6mrN660a_MDfJA@mail.gmail.com>
References: <CAEq3_tdW_PmsAh2jT_ORLPKMx+sqKa86qHGo19egzoXn_HL3xw@mail.gmail.com>
 <f998451e-2602-0a0f-382e-c1cd499a4e87@treenet.co.nz>
 <CAEq3_te+ixhoCwrTQEtxuqUuZfLHMTYwRWwUad=_Q1+xZbGOUg@mail.gmail.com>
 <9a596135-d65d-889c-bd6f-2c3b4a9b9007@treenet.co.nz>
 <CAEq3_tfchAqLw01yhXbxyeTX5Q1A2VUOqR-h6mrN660a_MDfJA@mail.gmail.com>
Message-ID: <db0ed306-bb56-c8bc-30f6-1086981b23e9@treenet.co.nz>

On 16/10/17 20:24, Geoffrey wrote:
> Hello Amos
> 
>> Do you have ICMP and ICMPv6 working in your network? If not that is probably part of the issue.
> 
> AND
> 
>> Are you using DROP rules or policies in your firewalls? that can also lead to missing packets like this.
> 
> You may be getting warm. I have IPv6 disabled on the proxy server
> (kernel), but more interestingly I notice that the Windows System
> Admin has a bunch of ICMP ingress block rules on the Windows DNS
> servers.
> 
> What ICMP does Squid (or is it the pinger involved?) require for DNS
> to failover. I will have to ask the Windows Admin to make the changes
> via group policy, as i cannot modify.
> 

pinger uses ICMP echo, so that is optional.

The other parts of ICMP which control TCP routing, path MTU, IP 
discovery / ARP and such things which are critical.

See <https://tools.ietf.org/html/rfc4890> for guidelines
and <https://sites.google.com/site/ipv6center/icmpv6-is-non-optional> 
for a case study on why those guidelines need to be followed.

Amos


From rousskov at measurement-factory.com  Mon Oct 16 14:59:23 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 16 Oct 2017 08:59:23 -0600
Subject: [squid-users] Is it safe to resize a rock storage file?
In-Reply-To: <8e8339c9-89bf-fb65-5eec-96d820107d31@ustc.edu>
References: <8e8339c9-89bf-fb65-5eec-96d820107d31@ustc.edu>
Message-ID: <b83b0802-e308-b0d3-7904-b22f1bebe532@measurement-factory.com>

On 10/16/2017 06:26 AM, duanyao wrote:

> Is it safe to resize a rock storage file as follow (while squid is not
> running)?
> 
> 1) Increase a rock storage file by increasing the size specified in the
> configuration file;

I would recommend running truncate after this as well because that is
what Squid does when it initializes the database (squid -z).


> 2) Decrease a rock storage file by decreasing the size specified in the
> configuration file and run `truncate --size <new size> rock_file`;
> 
> By "safe" I mean no rubbish data will ever be delivered to clients after
> resizing, while loss of some cached data is OK.

I have not tested this, but I believe the above operations are safe to
perform while Squid is not running. The second operation may generate
many warnings during Squid startup as Squid discovers and complains
about corrupted entries.

Alex.


From squid3 at treenet.co.nz  Mon Oct 16 14:59:28 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 17 Oct 2017 03:59:28 +1300
Subject: [squid-users] Question about: ext_session_acl Splash/Portal
 solution.
In-Reply-To: <20171015201733.Horde.Wc7rCYoHpdMV8ZC3tsQfvio@buero.tachtler.net>
References: <20171013174053.Horde.x7SZ4RI4K6WkCTFcw_ZSTyp@buero.tachtler.net>
 <df530d74-c36b-56bd-19a4-e666a3c7a407@treenet.co.nz>
 <20171014230237.Horde.7lXgVKZUrx1iDHZ-Z3zO3Re@buero.tachtler.net>
 <9db803ba-8e68-6629-3b5d-e93dea82d723@treenet.co.nz>
 <20171015201733.Horde.Wc7rCYoHpdMV8ZC3tsQfvio@buero.tachtler.net>
Message-ID: <244ce742-2bcf-f601-2b80-ab077828c243@treenet.co.nz>

On 16/10/17 07:17, Klaus Tachtler wrote:
> Hi Amos,
> 
> after a little bit more testing, of course I must agree with you, it 
> doesn't work as expected.
> 
> Please can you give me another advice? Where is my fault?
> 
> I tried to use the *ACTIVE* example from the squid documentation and 
> modified it a little bit on 3 parts of the code, BUT a LOOP are still 
> there!
> 
> https://wiki.squid-cache.org/ConfigExamples/Portal/Splash#Squid_Configuration_File_-_Active_Mode 
> 
> 
> --- code ---
> 
> # Set up the session helper in active mode. Mind the wrap - this is one 
> line: - *MODIFIED* - (all in one line)
> external_acl_type session concurrency=100 ttl=3 negative_ttl=0 
> children-max=1 %LOGIN /usr/lib64/squid/ext_session_acl -a -T 60 -b 
> /var/lib/squid/sessions/
> 
> # Pass the LOGIN command to the session helper with this ACL
> acl session_login external session LOGIN
> 
> # Normal session ACL as per simple example
> acl session_is_active external session
> 
> # ACL to match URL - *MODIFIED* -
> acl clicked_login_url url_regex -i http://my.pages.net/html/accept.php
> 
> # First check for the login URL. If present, login session
> http_access allow clicked_login_url session_login
> 
> # If we get here, URL not present, so renew session or deny request.
> http_access deny !session_is_active
> 
> # Deny page to display - *MODIFIED* - NOT using a template with 
> HTML-Code 511!
> deny_info http://my.pages.net/html/splash.php?url=%u session_is_active


Please double-check the cacheing related headers on both your custom 
URLs are set to make them non-cacheable. 302 is a weak substitute for 
511 semantics, and requires caching headers to clearly and explicitly 
prevent caching *and* to be followed by the client or the system can 
breaks badly (which is why 511 was created).


Which exact version of Squid are you using? some of the early v4 had 
issues with the format parameter changes which broke the active session 
mode for a while.


Also, be aware that since the helper API is *only* using %LOGIN if any 
visitor happens to send a request for the clicked_login_url without 
credentials attached they will make a logged-in session for anonymous 
access and the proxy becomes an 'open proxy' for any subsequent client 
requests from *anywhere* for 63 seconds. Things like that are why %SRC 
is usually used to make a session depend on things not as easily under 
client control - such as src-IP.


If those don't work I'm stuck as well. The wiki config examples are ones 
I used myself for many years before I moved to the sql_session helper.

Amos


From squid3 at treenet.co.nz  Mon Oct 16 15:23:13 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 17 Oct 2017 04:23:13 +1300
Subject: [squid-users] Is it safe to resize a rock storage file?
In-Reply-To: <8e8339c9-89bf-fb65-5eec-96d820107d31@ustc.edu>
References: <8e8339c9-89bf-fb65-5eec-96d820107d31@ustc.edu>
Message-ID: <be79798a-0f51-7737-80fd-25241bdfdc29@treenet.co.nz>

On 17/10/17 01:26, duanyao wrote:
> Hi,
> 
> Is it safe to resize a rock storage file as follow (while squid is not 
> running)?
> 
> 1) Increase a rock storage file by increasing the size specified in the 
> configuration file;
> 
> 2) Decrease a rock storage file by decreasing the size specified in the 
> configuration file and run `truncate --size <new size> rock_file`;
> 
> By "safe" I mean no rubbish data will ever be delivered to clients after 
> resizing, while loss of some cached data is OK.

Hell No.

*none* of Squids caches should be manipulated manually. Especially while 
the proxy is running. The UFS based caches are a lot more forgiving of 
file deletion, but that is an artifact of their lazy validation.

rock cache is a single file with more similarities to SQL-type databases 
or a memmap swap file than Squids other cache areas. The -z process for 
rock caches actively formats the file used for data storage into cells 
and blocks. Changing its size manually will definitely lead to some form 
of corruption.

Adding a tool for properly managing these type of changes to caches has 
been on my wishlist for many years now and the design is mostly planned 
out. Please discuss on squid-dev if you are interested in picking up 
that project.

Amos


From uhlar at fantomas.sk  Mon Oct 16 16:38:16 2017
From: uhlar at fantomas.sk (Matus UHLAR - fantomas)
Date: Mon, 16 Oct 2017 18:38:16 +0200
Subject: [squid-users] Compiling with OpenSSL Support
In-Reply-To: <90c7992e-db2c-af5e-cf63-1c8c6b355c9c@treenet.co.nz>
References: <669935060.1252411.1507907922939.ref@mail.yahoo.com>
 <669935060.1252411.1507907922939@mail.yahoo.com>
 <CAN+1GvWxCXhuO--WM205QK5GD8kWiPznJdaLfd8rkE3EVsQPEg@mail.gmail.com>
 <439c4f3b-d663-7bdb-a380-a4fd20ee45e8@urlfilterdb.com>
 <20171015161726.GB5817@fantomas.sk>
 <a9e7a91c-1764-be57-d337-77f198ebf7fa@urlfilterdb.com>
 <20171016104751.GB31683@fantomas.sk>
 <90c7992e-db2c-af5e-cf63-1c8c6b355c9c@treenet.co.nz>
Message-ID: <20171016163816.GA8074@fantomas.sk>

>>>On 15/10/17 14:17, Matus UHLAR - fantomas wrote:
>>>>why not libssl-dev?

>>>>On 13.10.17 15:16, Marcus Kool wrote:
>>>>>Debian 9 has openssl 1.1.x while most platforms have older versions.

>On 16/10/17 23:47, Matus UHLAR - fantomas wrote:
>>>>that means, you should use libssl-dev unless you know squid 
>>>>can't compile
>>>>with openssl-1.1

>>On 15.10.17 18:43, Marcus Kool wrote:
>>>Openssl 1.1.x is not backwards compatible and does not have the symbol
>>>CRYPTO_LOCK_X509 while openssl 1.0.2 has.
>>
>>are you talking about squid or ufdbguard?

On 17.10.17 03:04, Amos Jeffries wrote:
>Doesn't matter, it is a problem with OpenSSL 1.0 vs 1.1.
>Anything which uses OpenSSL 1.0 specific symbols needs libssl1.0-dev 
>on Debian.

so, does squid reauire openssl-1.0? 
ok, found finally:

https://wiki.squid-cache.org/SquidFaq/CompilingSquid#Debian.2C_Ubuntu

	However, please note that Squid-3.5 is not compatible with OpenSSL
	v1.1+.  As of Debian Squeeze, or Ubuntu Zesty the libssl1.0-dev
	package must be used instead.  This is resolved in the Squid-4
	packages when they become available.

-- 
Matus UHLAR - fantomas, uhlar at fantomas.sk ; http://www.fantomas.sk/
Warning: I wish NOT to receive e-mail advertising to this address.
Varovanie: na tuto adresu chcem NEDOSTAVAT akukolvek reklamnu postu.
The early bird may get the worm, but the second mouse gets the cheese. 


From rousskov at measurement-factory.com  Mon Oct 16 18:05:07 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 16 Oct 2017 12:05:07 -0600
Subject: [squid-users] Is it safe to resize a rock storage file?
In-Reply-To: <be79798a-0f51-7737-80fd-25241bdfdc29@treenet.co.nz>
References: <8e8339c9-89bf-fb65-5eec-96d820107d31@ustc.edu>
 <be79798a-0f51-7737-80fd-25241bdfdc29@treenet.co.nz>
Message-ID: <9d6a4fa1-6431-3699-ce5e-68befd530777@measurement-factory.com>

On 10/16/2017 09:23 AM, Amos Jeffries wrote:

> The -z process for
> rock caches actively formats the file used for data storage into cells
> and blocks. 

Not really. "squid -z" adds a small db header, but the rest of the
database is assumed to be nothing but zeros. Squid -z used to fill the
whole db file with zeros (see SLOWLY_FILL_WITH_ZEROS), but I believe we
stopped doing that (by default) and expect an "enlarging truncate" to
have the same side effect. The comit log may have more info about that.


> Changing its size manually will definitely lead to some form
> of corruption.

What makes you think that? Bugs notwithstanding, there are three cases
to consider AFAICT:

* Adding a partial empty slot should be a no-op because Squid will not
notice the added space after rounding the number of slots down.

* Adding a full all-zeros slot will not affect any data already stored
in the database -- nothing will point to that new slot. It will be used
for new cache entries.

* Removing a slot, whole or partial, will invalidate the cache entry
that was using that slot (if any). The affected entry will not be added
to the shared memory index. Skipping an entry should not lead to cache
corruption. It will lead to loss of cache data (and probably some
warnings) but that was explicitly allowed in the original question.

Please let me know if I missed something or if there are reasons to
believe there are bugs affecting the above logic.


Thank you,

Alex.


From david at davidwbarratt.com  Mon Oct 16 22:05:35 2017
From: david at davidwbarratt.com (David Barratt)
Date: Mon, 16 Oct 2017 18:05:35 -0400
Subject: [squid-users] Official Docker Image?
Message-ID: <CAMq59O6znE2puEKGGBjmU5XLTSb6Xju8FmPFngwaNmqkDL=ybg@mail.gmail.com>

Would a maintainer be willing to submit a request for an official docker
image of Squid?
https://github.com/docker-library/official-images

I would love to do this, but they need maintainers of the project to submit
the request. I am certainly willing to help make a docker image for Squid,
but a repo ("squid-docker"?) will need to be created under the squid org (
https://github.com/squid-cache).
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171016/fe3968fb/attachment.htm>

From rousskov at measurement-factory.com  Mon Oct 16 23:31:23 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 16 Oct 2017 17:31:23 -0600
Subject: [squid-users] Official Docker Image?
In-Reply-To: <CAMq59O6znE2puEKGGBjmU5XLTSb6Xju8FmPFngwaNmqkDL=ybg@mail.gmail.com>
References: <CAMq59O6znE2puEKGGBjmU5XLTSb6Xju8FmPFngwaNmqkDL=ybg@mail.gmail.com>
Message-ID: <a0707a9c-879a-0327-3748-f776b8609596@measurement-factory.com>

On 10/16/2017 04:05 PM, David Barratt wrote:
> but a repo ("squid-docker"?) will need to be created under the squid org

The only checklist I found[1] says "associated with or contacted
upstream" so it looks like you can do it without creating a repository
inside the squid-cache organization. Moreover, there are official docker
repositories that the Docker team maintains on their own (e.g., Apache
httpd [2]).

[1]
https://github.com/docker-library/official-images/blob/master/NEW-IMAGE-CHECKLIST.md

[2] https://github.com/docker-library/httpd


FWIW, I do no object to creating a squid-docker repository in the
squid-cache organization if others think we should do it, but since the
Project resources are already spread too thin, I recommend creating that
repository in your own GitHub account if possible. A Project admin can
comment on your Docker PR that we are very happy with your contribution
(which would be a one-time action rather than a yet another small but
on-going administration/maintenance burden).


Thank you,

Alex.


From squid3 at treenet.co.nz  Tue Oct 17 03:35:12 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 17 Oct 2017 16:35:12 +1300
Subject: [squid-users] Is it safe to resize a rock storage file?
In-Reply-To: <9d6a4fa1-6431-3699-ce5e-68befd530777@measurement-factory.com>
References: <8e8339c9-89bf-fb65-5eec-96d820107d31@ustc.edu>
 <be79798a-0f51-7737-80fd-25241bdfdc29@treenet.co.nz>
 <9d6a4fa1-6431-3699-ce5e-68befd530777@measurement-factory.com>
Message-ID: <b0bd3514-e28a-3d71-f641-4a6e09d711ac@treenet.co.nz>

On 17/10/17 07:05, Alex Rousskov wrote:
> On 10/16/2017 09:23 AM, Amos Jeffries wrote:
> 
>> The -z process for
>> rock caches actively formats the file used for data storage into cells
>> and blocks.
> 
> Not really. "squid -z" adds a small db header, but the rest of the
> database is assumed to be nothing but zeros. Squid -z used to fill the
> whole db file with zeros (see SLOWLY_FILL_WITH_ZEROS), but I believe we
> stopped doing that (by default) and expect an "enlarging truncate" to
> have the same side effect. The comit log may have more info about that.
> 

Oh, I thought each block had a TLV and checksum bits as well.

> 
>> Changing its size manually will definitely lead to some form
>> of corruption.
> 
> What makes you think that? Bugs notwithstanding, there are three cases
> to consider AFAICT:
> 
> * Adding a partial empty slot should be a no-op because Squid will not
> notice the added space after rounding the number of slots down.
> 
> * Adding a full all-zeros slot will not affect any data already stored
> in the database -- nothing will point to that new slot. It will be used
> for new cache entries.
> 
> * Removing a slot, whole or partial, will invalidate the cache entry
> that was using that slot (if any). The affected entry will not be added
> to the shared memory index. Skipping an entry should not lead to cache
> corruption. It will lead to loss of cache data (and probably some
> warnings) but that was explicitly allowed in the original question.

This last one was what I was referring to as corruption. Though I expect 
that *removing* slots would lead memory index pointing to no longer 
valid locations in the rock database.

Is it harmless to access out-of-range offsets into a memmap'ed file - 
specifically ones which *were* valid when it was initially mapped?

Amos


From duanyao at ustc.edu  Tue Oct 17 04:30:37 2017
From: duanyao at ustc.edu (duanyao)
Date: Tue, 17 Oct 2017 12:30:37 +0800
Subject: [squid-users] Unable to get TCP_MEM_HIT (just TCP_HIT) with rock
	storage
Message-ID: <d3d3b9a4-3f69-6690-fad8-7bf228e164a5@ustc.edu>

Hi,

When I test squid with rock storage, I have never got a TCP_MEM_HIT 
(just TCP_HIT) in access.log. I do get TCP_MEM_HIT with ufs storage.

Is this normal, or something is mis-configured?


I run squid locally, and run `curl -v -x localhost:3128 
http://localhost:8001/1000 > /dev/null` two times successively, and 
expect at least the second one being TCP_MEM_HIT, but it is always TCP_HIT.


Attachment "squid.conf" is my configuration file; and "cache.rock.log" 
is the part of cache.log during 2 successive accesses to a same URL; 
"anysize-server.js" is the HTTP server at port 8001 for the test, and 
you can run it by `node anysize-server.js`.


I tested squid 3.5.27 and 4.0.21, both compiled and run on Linux x86_64: 
`./configure --with-default-user=duanyao 
--prefix=/home/duanyao/project/proxy/squid-root/`.


Thanks.


Duan, Yao

-------------- next part --------------
#workers 2

shutdown_lifetime 3 second

acl localnet src 10.0.0.0/8	# RFC1918 possible internal network
acl localnet src 172.16.0.0/12	# RFC1918 possible internal network
acl localnet src 192.168.0.0/16	# RFC1918 possible internal network
acl localnet src fc00::/7       # RFC 4193 local private network range
acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged) machines

acl SSL_ports port 443
acl Safe_ports port 80		# http
acl Safe_ports port 21		# ftp
acl Safe_ports port 443		# https
acl Safe_ports port 70		# gopher
acl Safe_ports port 210		# wais
acl Safe_ports port 1025-65535	# unregistered ports
acl Safe_ports port 280		# http-mgmt
acl Safe_ports port 488		# gss-http
acl Safe_ports port 591		# filemaker
acl Safe_ports port 777		# multiling http
acl CONNECT method CONNECT

http_access deny !Safe_ports

http_access deny CONNECT !SSL_ports

http_access allow localhost manager
http_access deny manager

http_access allow localnet
http_access allow localhost

http_access deny all

http_port 3128

#cache_dir ufs /home/duanyao/project/proxy/squid-root/var/cache/squid/ufs 10 16 256
cache_dir rock /home/duanyao/project/proxy/squid-root/var/cache/squid/rock 10 slot-size=16384

cache_effective_user duanyao

# Leave coredumps in the first cache dir
coredump_dir /home/duanyao/project/proxy/squid-root/var/cache/squid

debug_options ALL,1 11,7 16,7 19,7 20,7 92,7 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: cache.rock.log
Type: text/x-log
Size: 16063 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171017/a93ea68f/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: anysize-server.js
Type: application/x-javascript
Size: 1905 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171017/a93ea68f/attachment-0001.bin>

From klaus at tachtler.net  Tue Oct 17 04:57:06 2017
From: klaus at tachtler.net (Klaus Tachtler)
Date: Tue, 17 Oct 2017 06:57:06 +0200
Subject: [squid-users] Question about: ext_session_acl Splash/Portal
 solution.
In-Reply-To: <244ce742-2bcf-f601-2b80-ab077828c243@treenet.co.nz>
References: <20171013174053.Horde.x7SZ4RI4K6WkCTFcw_ZSTyp@buero.tachtler.net>
 <df530d74-c36b-56bd-19a4-e666a3c7a407@treenet.co.nz>
 <20171014230237.Horde.7lXgVKZUrx1iDHZ-Z3zO3Re@buero.tachtler.net>
 <9db803ba-8e68-6629-3b5d-e93dea82d723@treenet.co.nz>
 <20171015201733.Horde.Wc7rCYoHpdMV8ZC3tsQfvio@buero.tachtler.net>
 <244ce742-2bcf-f601-2b80-ab077828c243@treenet.co.nz>
Message-ID: <20171017065706.Horde.NnIYkej1jKBSKJxGW2-63oj@buero.tachtler.net>

Hi Amos,

first of all, thank you for help and advise, BUT I have still a  
problem - see my latest try:

--- code ---

# Set up the session helper in active mode. Mind the wrap - this is  
one line: - MODIFIED -
external_acl_type session concurrency=100 ttl=3 negative_ttl=0  
children-max=1 %SRC /usr/lib64/squid/ext_session_acl -a -T 60 -b  
/var/lib/squid/sessions/

# Pass the LOGIN command to the session helper with this ACL
acl session_login external session LOGIN

# Normal session ACL as per simple example
acl session_is_active external session

# ACL to match URL - MODIFIED -
acl clicked_login_url url_regex -i http://my.page.net/html/accept.php

# First check for the login URL. If present, login session
http_access allow clicked_login_url session_login

# If we get here, URL not present, so renew session or deny request.
http_access deny !session_is_active

# Deny page to display - MODIFIED -
deny_info 511:splash.php session_is_active

--- code ---

1.) I changed in the external_acl_type from: %LOGIN to: %SRC - after  
that NO authentication request against LDAP was done! - If I go back  
to %LOGIN a authentication request against LDAP comes as popup back!

2.) Disabled redirect insie the page -  
http://my.page.net/html/accept.php - so loading the page are done with  
200 and NO redirect inside - only the  
http://my.page.net/html/accept.php was displayed.

3.) deny_info uses now 511 and a "symbolic link" inside  
"/usr/share/squid/errors/templates" goes to the real location.

---> How it works <---

The splash.php page was shown. If I click on the submit button the  
http://my.page.net/html/accept.php was loaded and shown too, but after  
that it's NOT POSSIBLE to go to Google for example, the splash page  
was shwon over and over again! - I'm a little bit frustrated.

I use the CentOS 7.4 squid version 3.5.20 which comes with the base  
repository.

Thank you so much for your patience and help!
Klaus.


-- 

------------------------------------------
e-Mail  : klaus at tachtler.net
Homepage: http://www.tachtler.net
DokuWiki: http://www.dokuwiki.tachtler.net
------------------------------------------
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-keys
Size: 3120 bytes
Desc: ?ffentlicher PGP-Schl?ssel
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171017/e2e68b97/attachment.key>

From rousskov at measurement-factory.com  Tue Oct 17 05:24:07 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 16 Oct 2017 23:24:07 -0600
Subject: [squid-users] Is it safe to resize a rock storage file?
In-Reply-To: <b0bd3514-e28a-3d71-f641-4a6e09d711ac@treenet.co.nz>
References: <8e8339c9-89bf-fb65-5eec-96d820107d31@ustc.edu>
 <be79798a-0f51-7737-80fd-25241bdfdc29@treenet.co.nz>
 <9d6a4fa1-6431-3699-ce5e-68befd530777@measurement-factory.com>
 <b0bd3514-e28a-3d71-f641-4a6e09d711ac@treenet.co.nz>
Message-ID: <988a9fe9-e0d1-a170-9402-ef15a38cec92@measurement-factory.com>

On 10/16/2017 09:35 PM, Amos Jeffries wrote:
> On 17/10/17 07:05, Alex Rousskov wrote:
>> On 10/16/2017 09:23 AM, Amos Jeffries wrote:
>>> The -z process for
>>> rock caches actively formats the file used for data storage into cells
>>> and blocks.

>> Not really. "squid -z" adds a small db header, but the rest of the
>> database is assumed to be nothing but zeros. Squid -z used to fill the
>> whole db file with zeros (see SLOWLY_FILL_WITH_ZEROS), but I believe we
>> stopped doing that (by default) and expect an "enlarging truncate" to
>> have the same side effect. The comit log may have more info about that.


> Oh, I thought each block had a TLV and checksum bits as well.

There is slot-specific metadata (and associated consistency checks), but
it is designed to work fine with all-zeros (i.e., initial or empty)
slots. Filling a 1TB disk cache with something just to "initialize" it
would be rather wasteful/annoying...

There are no true slot checksums.


>> * Removing a slot, whole or partial, will invalidate the cache entry
>> that was using that slot (if any). The affected entry will not be added
>> to the shared memory index. Skipping an entry should not lead to cache
>> corruption. It will lead to loss of cache data (and probably some
>> warnings) but that was explicitly allowed in the original question.

> This last one was what I was referring to as corruption. 

AFAICT, OP has explicitly stated that some loss of cached data is fine
(i.e., it is not considered cache corruption). In the original question,
corruption was defined as "rubbish data delivered to clients".


> Though I expect
> that *removing* slots would lead memory index pointing to no longer
> valid locations in the rock database.

The in-memory index is created from the on-disk metadata. Bugs
notwithstanding, if on-disk metadata contains an incomplete entry (e.g.,
an entry slot pointer pointing beyond the current database boundary),
then Rock will not add that entry to the in-memory index, and, hence,
Squid will not know about that entry existence.


> Is it harmless to access out-of-range offsets into a memmap'ed file -
> specifically ones which *were* valid when it was initially mapped?

Out-of-range accesses are probably deadly, but no such accesses should
be happening due to database size changes. Please note that the question
was about database size changes while Squid "is not running". When Squid
starts, it creates memory segments and builds its in-memory disk index
there from scratch, ignoring any bad on-disk entries.


HTH,

Alex.


From hazri at ymail.com  Tue Oct 17 08:56:11 2017
From: hazri at ymail.com (hoje)
Date: Tue, 17 Oct 2017 01:56:11 -0700 (MST)
Subject: [squid-users] External user cant access web server
Message-ID: <1508230571076-0.post@n4.nabble.com>

Hi Mr.Amos,

Thank you for helping in my previous post. I have a question. I?ve tried the
same squid.conf setup to a new topology, and it works only for all internal
users. But, external users that want to access my public web server, will
get an access denied error (?The requested URL could not be retrieved?).
Anything that i need to do to fix this problem? Please advice. Thank you
again.

My setup
???
debian 9, squid-3.5.26-20170702-r14182


Old topology (that works)
????
WAN +-->RT+?>(linux+SQUID+bridge)?>SW+---> INT USER
                      
                       

New topology (ext user can?t access my web server) 
???????
WAN +-->RT+?>(linux+SQUID+bridge)+?> FW+---> SW+---> INT USER
                                                                     +
                                                                     |
                                                                     v
                                                                DMZ SW
                                                                    +
                                                                    |
                                                                    v
                                                               WEB SRV
My squid.conf
?????
https://pastebin.com/AbU6nihK



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From rafael.akchurin at diladele.com  Tue Oct 17 09:39:25 2017
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Tue, 17 Oct 2017 09:39:25 +0000
Subject: [squid-users] Pseudo proxy authentication (mapping of IP address to
 user name) in intercept mode.
Message-ID: <AM6PR0402MB3576C71EE0495C01CE6B62DE8F4C0@AM6PR0402MB3576.eurprd04.prod.outlook.com>

Hello everyone,

I would like to get your opinions on the subject.

Problem: admin needs to manage squid acls (and icap web filter settings) using security groups from Active Directory. For non-technical reasons, setup of explicit proxy settings and thus enforcing proxy authentication on Squid is not possible.

Solution:


1.      Deploy some agent on domain controller that would periodically enumerate workstation IPs and get currently logged on users by WMI or something like this. This is fine and already working in our project at https://github.com/diladele/active-directory-inspector

2.      Let Squid somehow use the remote running inspector to match the IP address to user names (and expose the user name to ICAP eventually). May be anyone knows the type of helper/acl/annotation that needs to be in running/configured on the Squid box?

Thanks for anyone responding.

Best regards,
Rafael Akchurin
Diladele B.V.




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171017/2c286d33/attachment.htm>

From inspirit1986 at gmail.com  Tue Oct 17 11:03:06 2017
From: inspirit1986 at gmail.com (inspirit)
Date: Tue, 17 Oct 2017 14:03:06 +0300
Subject: [squid-users] Fwd: ftp-relay squestion
In-Reply-To: <CAKodO4U__5nkx=v=4b8T6kzg+VQCNMBqtSTUFF41K0iiZMa1Cw@mail.gmail.com>
References: <CAKodO4U__5nkx=v=4b8T6kzg+VQCNMBqtSTUFF41K0iiZMa1Cw@mail.gmail.com>
Message-ID: <CAKodO4Xn6oXH+HMUkYLTzFR_3ZeuXywtQ5viA+f=1Fv=kWkM4A@mail.gmail.com>

Hi, we want to use
https://wiki.squid-cache.org/Features/FtpRelay functions. I try to setup
this feature but I have some troubles with it.

When I connect to ftp with filezilla over proxy, squid says me about 407
error. Need authenticate. How I can authenticate with my proxy user/pass
over ftp relay in filezilla and then connect to remote ftp over squid.

Thank in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171017/99a48554/attachment.htm>

From squid3 at treenet.co.nz  Tue Oct 17 13:53:45 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 18 Oct 2017 02:53:45 +1300
Subject: [squid-users] Pseudo proxy authentication (mapping of IP
 address to user name) in intercept mode.
In-Reply-To: <AM6PR0402MB3576C71EE0495C01CE6B62DE8F4C0@AM6PR0402MB3576.eurprd04.prod.outlook.com>
References: <AM6PR0402MB3576C71EE0495C01CE6B62DE8F4C0@AM6PR0402MB3576.eurprd04.prod.outlook.com>
Message-ID: <08b477fe-b9a1-8c5d-5f51-5792223fe46f@treenet.co.nz>

On 17/10/17 22:39, Rafael Akchurin wrote:
> Hello everyone,
> 
> I would like to get your opinions on the subject.
> 
> *Problem*: admin needs to manage squid acls (and icap web filter 
> settings) using security groups from Active Directory. For non-technical 
> reasons, setup of explicit proxy settings and thus enforcing proxy 
> authentication on Squid is not possible.
> 
> *Solution*:
> 
> 1.Deploy some agent on domain controller that would periodically 
> enumerate workstation IPs and get currently logged on users by WMI or 
> something like this. This is fine and already working in our project at 
> https://github.com/diladele/active-directory-inspector
> 
> 2.Let Squid somehow use the remote running inspector to match the IP 
> address to user names (and expose the user name to ICAP eventually). May 
> be anyone knows the type of helper/acl/annotation that needs to be in 
> running/configured on the Squid box?
> 

That kind of authorization is the purpose of the session and LDAP 
external ACL helpers. Though AFAIK neither of them uses the AD interface 
(YMMV if the Perl DB module can use AD as an SQL-like database).

You might be able to also be use the Basic auth LDAP helper from 
Squid-3.4+ as an external ACL helper. It will require some fiddling of 
the LDAP parameters and the ACL input format to make the external ACL 
input into the Basic-auth lookup.

Amos


From rafael.akchurin at diladele.com  Tue Oct 17 14:21:04 2017
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Tue, 17 Oct 2017 14:21:04 +0000
Subject: [squid-users] Pseudo proxy authentication (mapping of IP
 address to user name) in intercept mode.
In-Reply-To: <08b477fe-b9a1-8c5d-5f51-5792223fe46f@treenet.co.nz>
References: <AM6PR0402MB3576C71EE0495C01CE6B62DE8F4C0@AM6PR0402MB3576.eurprd04.prod.outlook.com>
 <08b477fe-b9a1-8c5d-5f51-5792223fe46f@treenet.co.nz>
Message-ID: <AM6PR0402MB3576EB9CA97712496FAD63748F4C0@AM6PR0402MB3576.eurprd04.prod.outlook.com>

Hello Amos,

Thanks for your responses.

What I do not understand completely - if we have intercept style of deployment, when browsers know nothing about the proxy - how basic (or any other type of authenticator) will work? I always thought browsers will discard proxy-auth responses just because they do not know if proxy is in-between.

May it be that only session helper is applicable in this case?

Best regards,
Rafael

-----Original Message-----
> *Problem*: admin needs to manage squid acls (and icap web filter
> settings) using security groups from Active Directory. For 
> non-technical reasons, setup of explicit proxy settings and thus 
> enforcing proxy authentication on Squid is not possible.
> 
> *Solution*:
> 
> 1.Deploy some agent on domain controller that would periodically 
> enumerate workstation IPs and get currently logged on users by WMI or 
> something like this. This is fine and already working in our project 
> at https://github.com/diladele/active-directory-inspector
> 
> 2.Let Squid somehow use the remote running inspector to match the IP 
> address to user names (and expose the user name to ICAP eventually). 
> May be anyone knows the type of helper/acl/annotation that needs to be 
> in running/configured on the Squid box?
> 

That kind of authorization is the purpose of the session and LDAP external ACL helpers. Though AFAIK neither of them uses the AD interface (YMMV if the Perl DB module can use AD as an SQL-like database).

You might be able to also be use the Basic auth LDAP helper from Squid-3.4+ as an external ACL helper. It will require some fiddling of the LDAP parameters and the ACL input format to make the external ACL input into the Basic-auth lookup.
 

From rousskov at measurement-factory.com  Tue Oct 17 16:23:34 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 17 Oct 2017 10:23:34 -0600
Subject: [squid-users] Unable to get TCP_MEM_HIT (just TCP_HIT) with
 rock storage
In-Reply-To: <d3d3b9a4-3f69-6690-fad8-7bf228e164a5@ustc.edu>
References: <d3d3b9a4-3f69-6690-fad8-7bf228e164a5@ustc.edu>
Message-ID: <c9e1bc2c-f129-1e28-4a10-473ecd1378ea@measurement-factory.com>

On 10/16/2017 10:30 PM, duanyao wrote:

> When I test squid with rock storage, I have never got a TCP_MEM_HIT
> (just TCP_HIT) in access.log.
> 
> Is this normal, or something is mis-configured?

Neither :-). You are testing with a Vary-controlled response. The shared
memory cache does not support caching of Vary-controlled responses yet.
I failed to find a dedicated feature request for implementing this, but
the problem has been known for several years [1,2,3].

[1]
http://bazaar.launchpad.net/~measurement-factory/squid/bag5s/revision/12743
[2] https://bugs.squid-cache.org/show_bug.cgi?id=3806#c9
[3]
https://github.com/squid-cache/squid/commit/b8a899c01051c27f2d46f5b9fcbcd27622f388ff


> I do get TCP_MEM_HIT with ufs storage.

To be more precise, you are getting TCP_MEM_HIT with a non-shared memory
cache. This is not a Rock problem; it is a shared memory cache problem.
Switching to UFS appears to help because it disables SMP and shared
memory caching in your specific Squid configuration.


Please note that your cache.log does not contain the lines relevant to
storing the response in the memory cache so there may be other,
additional reasons why your test response does not get memory-cached. If
you continue testing and need to report more details, please start from
a clean cache and post the log containing the very first (cache miss)
transaction as well as the subsequent (hit) transactions. Compress the
logs as needed.


Thank you,

Alex.



> I run squid locally, and run `curl -v -x localhost:3128
> http://localhost:8001/1000 > /dev/null` two times successively, and
> expect at least the second one being TCP_MEM_HIT, but it is always TCP_HIT.
> 
> 
> Attachment "squid.conf" is my configuration file; and "cache.rock.log"
> is the part of cache.log during 2 successive accesses to a same URL;
> "anysize-server.js" is the HTTP server at port 8001 for the test, and
> you can run it by `node anysize-server.js`.
> 
> 
> I tested squid 3.5.27 and 4.0.21, both compiled and run on Linux x86_64:
> `./configure --with-default-user=duanyao
> --prefix=/home/duanyao/project/proxy/squid-root/`.
> 
> 
> Thanks.
> 
> 
> Duan, Yao
> 
> 
> 
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 



From rafael.akchurin at diladele.com  Tue Oct 17 21:00:41 2017
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Tue, 17 Oct 2017 21:00:41 +0000
Subject: [squid-users] Pseudo proxy authentication (mapping of IP
 address to user name) in intercept mode.
In-Reply-To: <08b477fe-b9a1-8c5d-5f51-5792223fe46f@treenet.co.nz>
References: <AM6PR0402MB3576C71EE0495C01CE6B62DE8F4C0@AM6PR0402MB3576.eurprd04.prod.outlook.com>
 <08b477fe-b9a1-8c5d-5f51-5792223fe46f@treenet.co.nz>
Message-ID: <AM6PR0402MB3576D5CC21B56FFA79225A8D8F4C0@AM6PR0402MB3576.eurprd04.prod.outlook.com>

Ok thanks again Amos.

The plan is then: 

- external acl helper gets the SRC and connects to REST server running on AD DC with IP <-> user mapping database
- replies with OK user=<name>
- this name get's delivered to access log and ICAP/eCAP
- (optional) we are able to match the user to security group and apply designated filtering policy in our ICAP server.

Written above seems to work in the test lab.

Best regards,
Rafael Akchurin
Diladele B.V.

-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Amos Jeffries
Sent: Tuesday, October 17, 2017 3:54 PM
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Pseudo proxy authentication (mapping of IP address to user name) in intercept mode.

On 17/10/17 22:39, Rafael Akchurin wrote:
> Hello everyone,
> 
> I would like to get your opinions on the subject.
> 
> *Problem*: admin needs to manage squid acls (and icap web filter
> settings) using security groups from Active Directory. For 
> non-technical reasons, setup of explicit proxy settings and thus 
> enforcing proxy authentication on Squid is not possible.
> 
> *Solution*:
> 
> 1.Deploy some agent on domain controller that would periodically 
> enumerate workstation IPs and get currently logged on users by WMI or 
> something like this. This is fine and already working in our project 
> at https://github.com/diladele/active-directory-inspector
> 
> 2.Let Squid somehow use the remote running inspector to match the IP 
> address to user names (and expose the user name to ICAP eventually). 
> May be anyone knows the type of helper/acl/annotation that needs to be 
> in running/configured on the Squid box?
> 

That kind of authorization is the purpose of the session and LDAP external ACL helpers. Though AFAIK neither of them uses the AD interface (YMMV if the Perl DB module can use AD as an SQL-like database).

You might be able to also be use the Basic auth LDAP helper from Squid-3.4+ as an external ACL helper. It will require some fiddling of the LDAP parameters and the ACL input format to make the external ACL input into the Basic-auth lookup.

Amos
_______________________________________________
squid-users mailing list
squid-users at lists.squid-cache.org
http://lists.squid-cache.org/listinfo/squid-users

From eliezer at ngtech.co.il  Tue Oct 17 23:54:21 2017
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Wed, 18 Oct 2017 02:54:21 +0300
Subject: [squid-users] Official Docker Image?
In-Reply-To: <CAMq59O6znE2puEKGGBjmU5XLTSb6Xju8FmPFngwaNmqkDL=ybg@mail.gmail.com>
References: <CAMq59O6znE2puEKGGBjmU5XLTSb6Xju8FmPFngwaNmqkDL=ybg@mail.gmail.com>
Message-ID: <!&!AAAAAAAAAAAuAAAAAAAAAGDVRrtF13VDjYYZR9MgvgYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAACFqlCBg3AkTZcvRoi3FlNfAQAAAAA=@ngtech.co.il>

What version of squid should be installed?
Also what base Linux distribution should we use?
Since it's Docker container it won't be simple to use it as a gateway router and will only be usable as a simple forward proxy with or without ssl-bump.
Since I already package squid for many OS I believe you can choose one of these and then use a specific mounted directory for persistent settings.

Eliezer

----
http://ngtech.co.il/lmgtfy/
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il


From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of David Barratt
Sent: Tuesday, October 17, 2017 01:06
To: squid-users at lists.squid-cache.org
Subject: [squid-users] Official Docker Image?

Would a maintainer be willing to submit a request for an official docker image of Squid?
https://github.com/docker-library/official-images
I would love to do this, but they need maintainers of the project to submit the request. I am certainly willing to help make a docker image for Squid, but a repo ("squid-docker"?) will need to be created under the squid org (https://github.com/squid-cache).



From eliezer at ngtech.co.il  Tue Oct 17 23:57:54 2017
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Wed, 18 Oct 2017 02:57:54 +0300
Subject: [squid-users] Have anyone seen this black list?
Message-ID: <08c801d347a3$bfa02060$3ee06120$@ngtech.co.il>

I don't know exactly how I got a hold of this repository but it looks nice
and up-to-date:
https://github.com/StevenBlack/hosts/

The hosts file can be converted to a SquidGuard\ufdbguard\other domains
blocklists.
I have not verified all of their lists but since these are meant to be used
for hosts files it might include topper and lower level domains mixing.
If someone is interested in converting these files into squid\SquidGuard
domains lists let me know.

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il





From eliezer at ngtech.co.il  Wed Oct 18 00:06:43 2017
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Wed, 18 Oct 2017 03:06:43 +0300
Subject: [squid-users] Squid 3.5.20 and 3.1.23 getting re-started with
	bogus "FATAL: Bungled" acls
In-Reply-To: <CAH+mwvo5MK58oGcqRgkURObnJpgoy1=Knp2vQV=E92kf7gYijQ@mail.gmail.com>
References: <CAH+mwvo5MK58oGcqRgkURObnJpgoy1=Knp2vQV=E92kf7gYijQ@mail.gmail.com>
Message-ID: <08cd01d347a4$fb3130f0$f19392d0$@ngtech.co.il>

Are you validating your config files before committing them??
If you have about 100 clients this is the first thing to do...
Either run a asciii validation script for the whole file(I can write it if you really need it) or maintain two configuration testing node (CentOS 6+7).
You don't even need to apply the configurations into the a running squid, you just need to run a command like "squid -kparse -f /etc/squid/squid.conf" and it will tell you what's wrong.

Let me know if you need more help.

Eliezer

* CC me since I'm not watching the list daily these days.

----
http://ngtech.co.il/lmgtfy/
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il


From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Francisco Amaro
Sent: Thursday, October 12, 2017 19:25
To: squid-users at lists.squid-cache.org
Subject: [squid-users] Squid 3.5.20 and 3.1.23 getting re-started with bogus "FATAL: Bungled" acls

Hello all,

We are running stock CentOS 6 and CentOS 7 Squid builds, patched to the latest version, 3.1.23 and 3.5.20.
We have several machines, running on separate locations, with an ACL file unique to all, that get's pushed to all machines using an homemade script. So local configuration (interfaces, cache locations, etc) is one file, and the bulk of the ACL's are included on
a separate file, that is the same on all servers.

For some time now, but getting more frequent on the last couple of weeks, we have been getting errors on our cache.log about bogus ACL's, forcing a squid restart. This happens on configuration reloads, which we do very frequently,  maybe 10-20 times a day.

On CentOS 6, the most frequent error is :

FATAL: Bungled (null) line 203: icap_retry deny all

We do not use icap_retry, it is missing from the config file, but this seems to be fixed on 3.2.4:

Changes to squid-3.2.4 (03 Dec 2012):
- Remove 'Bungled' warning on missing component directives

On CentOS 7, the most frequent error is :

FATAL: Bungled (null) line 3: sslproxy_cert_sign signTrusted all

Now this one even has a bug entry, and was fixed on 3.3.5:

Changes to squid-3.3.5 (20 May 2013):
- Bug 3744: squid terminated: FATAL: Bungled (null) line 3: sslproxy_cert_sign signTrusted all

But we are still seeing it on 3.5.20...

Now what is even more weird is that besides that, we are getting what seem complete random bogus entries, like this ones:

FATAL: Bungled /etc/squid/squid_acls line 11796: acl xyz_allow_url
FATAL: Bungled /etc/squid/squid_acls line 10905: acl abc_url108 dstdomai

FATAL: Bungled squid_acls line 10033: http_access allow def_
FATAL: Bungled squid_acls line 9605: http_access allow ms_src_teste ms_t
FATAL: Bungled squid_acls line 11025: http_access allow xpto

The problem is that these lines are 100% correct , they are not "bungled" at all,  it seems the parser as some issue with it.

Each time we get an error like this, Squid does a full restart, and that on CentOS 6 is time consuming, maybe 2-3 minutes, time enough for our users reaching for the Helpdesk tickets... On CentOS 7, since the restart is very fast, we do not have many complaints...

Our ACL file is currently 7500 lines, mostly comprising of dstdomain and url_regex entries. We support a lot of costumers (about 100) and each one has a specific configuration. Mostly have while lists, and there are a  few blacklists in the middle... so, not very big in terms of line numbers, but somewhat  complex regarding site/VLAN entries...

For security/privacy reasons I cannot share my complete configuration, namely the ACL's part, since they contain client information, but I am able to get detailed logging and/or redacted information...

So... anyone has any clue what is happenning ? 



-- 


Francisco Amaro 
Email: mailto:famaro at gmail.com



From duanyao at ustc.edu  Wed Oct 18 03:51:48 2017
From: duanyao at ustc.edu (duanyao)
Date: Wed, 18 Oct 2017 11:51:48 +0800
Subject: [squid-users] Unable to get TCP_MEM_HIT (just TCP_HIT) with
 rock storage
In-Reply-To: <c9e1bc2c-f129-1e28-4a10-473ecd1378ea@measurement-factory.com>
References: <d3d3b9a4-3f69-6690-fad8-7bf228e164a5@ustc.edu>
 <c9e1bc2c-f129-1e28-4a10-473ecd1378ea@measurement-factory.com>
Message-ID: <c6b7f2aa-5a7d-0ee0-a0e3-f439b519b367@ustc.edu>

? 2017/10/18 ??12:23, Alex Rousskov ??:
> On 10/16/2017 10:30 PM, duanyao wrote:
>
>> When I test squid with rock storage, I have never got a TCP_MEM_HIT
>> (just TCP_HIT) in access.log.
>>
>> Is this normal, or something is mis-configured?
> Neither :-). You are testing with a Vary-controlled response. The shared
> memory cache does not support caching of Vary-controlled responses yet.
> I failed to find a dedicated feature request for implementing this, but
> the problem has been known for several years [1,2,3].
>
> [1]
> http://bazaar.launchpad.net/~measurement-factory/squid/bag5s/revision/12743
> [2] https://bugs.squid-cache.org/show_bug.cgi?id=3806#c9
> [3]
> https://github.com/squid-cache/squid/commit/b8a899c01051c27f2d46f5b9fcbcd27622f388ff
Thanks!
Indeed, by testing with a fresh rock database, I got
   2017/10/18 11:39:15.283 kid1| 20,5| MemStore.cc(623) shouldCache: 
Vary not yet supported: accept-encoding
in cache.log ; and if "vary" header was not sent from the server, I 
could get TCP_MEM_HIT.

>
>> I do get TCP_MEM_HIT with ufs storage.
> To be more precise, you are getting TCP_MEM_HIT with a non-shared memory
> cache. This is not a Rock problem; it is a shared memory cache problem.
> Switching to UFS appears to help because it disables SMP and shared
> memory caching in your specific Squid configuration.
>
>
> Please note that your cache.log does not contain the lines relevant to
> storing the response in the memory cache so there may be other,
> additional reasons why your test response does not get memory-cached. If
> you continue testing and need to report more details, please start from
> a clean cache and post the log containing the very first (cache miss)
> transaction as well as the subsequent (hit) transactions. Compress the
> logs as needed.
>
>
> Thank you,
>
> Alex.
>
>
>
>> I run squid locally, and run `curl -v -x localhost:3128
>> http://localhost:8001/1000 > /dev/null` two times successively, and
>> expect at least the second one being TCP_MEM_HIT, but it is always TCP_HIT.
>>
>>
>> Attachment "squid.conf" is my configuration file; and "cache.rock.log"
>> is the part of cache.log during 2 successive accesses to a same URL;
>> "anysize-server.js" is the HTTP server at port 8001 for the test, and
>> you can run it by `node anysize-server.js`.
>>
>>
>> I tested squid 3.5.27 and 4.0.21, both compiled and run on Linux x86_64:
>> `./configure --with-default-user=duanyao
>> --prefix=/home/duanyao/project/proxy/squid-root/`.
>>
>>
>> Thanks.
>>
>>
>> Duan, Yao
>>
>>
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>>




From duanyao at ustc.edu  Wed Oct 18 03:54:36 2017
From: duanyao at ustc.edu (duanyao)
Date: Wed, 18 Oct 2017 11:54:36 +0800
Subject: [squid-users] Is it safe to resize a rock storage file?
In-Reply-To: <b83b0802-e308-b0d3-7904-b22f1bebe532@measurement-factory.com>
References: <8e8339c9-89bf-fb65-5eec-96d820107d31@ustc.edu>
 <b83b0802-e308-b0d3-7904-b22f1bebe532@measurement-factory.com>
Message-ID: <ad284107-6498-ced5-9879-380f4fb016d2@ustc.edu>

? 2017/10/16 ??10:59, Alex Rousskov ??:
> On 10/16/2017 06:26 AM, duanyao wrote:
>
>> Is it safe to resize a rock storage file as follow (while squid is not
>> running)?
>>
>> 1) Increase a rock storage file by increasing the size specified in the
>> configuration file;
> I would recommend running truncate after this as well because that is
> what Squid does when it initializes the database (squid -z).
>
Ok, I'll do that.
>> 2) Decrease a rock storage file by decreasing the size specified in the
>> configuration file and run `truncate --size <new size> rock_file`;
>>
>> By "safe" I mean no rubbish data will ever be delivered to clients after
>> resizing, while loss of some cached data is OK.
> I have not tested this, but I believe the above operations are safe to
> perform while Squid is not running. The second operation may generate
> many warnings during Squid startup as Squid discovers and complains
> about corrupted entries.
Thanks. I do see those warnings in the log.
>
> Alex.





From duanyao at ustc.edu  Wed Oct 18 05:48:50 2017
From: duanyao at ustc.edu (duanyao)
Date: Wed, 18 Oct 2017 13:48:50 +0800
Subject: [squid-users] Unable to get TCP_MEM_HIT (just TCP_HIT) with
 rock storage
In-Reply-To: <c9e1bc2c-f129-1e28-4a10-473ecd1378ea@measurement-factory.com>
References: <d3d3b9a4-3f69-6690-fad8-7bf228e164a5@ustc.edu>
 <c9e1bc2c-f129-1e28-4a10-473ecd1378ea@measurement-factory.com>
Message-ID: <7efbaf47-bb07-01e5-19e6-c430b93c202b@ustc.edu>

? 2017/10/18 ??12:23, Alex Rousskov ??:
> On 10/16/2017 10:30 PM, duanyao wrote:
>
>> When I test squid with rock storage, I have never got a TCP_MEM_HIT
>> (just TCP_HIT) in access.log.
>>
>> Is this normal, or something is mis-configured?
> Neither :-). You are testing with a Vary-controlled response. The shared
> memory cache does not support caching of Vary-controlled responses yet.
> I failed to find a dedicated feature request for implementing this, but
> the problem has been known for several years [1,2,3].
>
> [1]
> http://bazaar.launchpad.net/~measurement-factory/squid/bag5s/revision/12743
> [2] https://bugs.squid-cache.org/show_bug.cgi?id=3806#c9
> [3]
> https://github.com/squid-cache/squid/commit/b8a899c01051c27f2d46f5b9fcbcd27622f388ff
>

I guess this issue will unlikely be fixed any time soon. So is there any 
workaround? Something in my mind:
1) Configure squid to ignore "Vary: Accept-Encoding" and assume all 
clients can handle any Content-Encoding from original servers (this make 
sense in my use case).
2) Use non-shared memory cache with Rock storage.

>> I do get TCP_MEM_HIT with ufs storage.
> To be more precise, you are getting TCP_MEM_HIT with a non-shared memory
> cache. This is not a Rock problem; it is a shared memory cache problem.
> Switching to UFS appears to help because it disables SMP and shared
> memory caching in your specific Squid configuration.
>
>
> Please note that your cache.log does not contain the lines relevant to
> storing the response in the memory cache so there may be other,
> additional reasons why your test response does not get memory-cached. If
> you continue testing and need to report more details, please start from
> a clean cache and post the log containing the very first (cache miss)
> transaction as well as the subsequent (hit) transactions. Compress the
> logs as needed.
>
>
> Thank you,
>
> Alex.
>
>
>
>> I run squid locally, and run `curl -v -x localhost:3128
>> http://localhost:8001/1000 > /dev/null` two times successively, and
>> expect at least the second one being TCP_MEM_HIT, but it is always TCP_HIT.
>>
>>
>> Attachment "squid.conf" is my configuration file; and "cache.rock.log"
>> is the part of cache.log during 2 successive accesses to a same URL;
>> "anysize-server.js" is the HTTP server at port 8001 for the test, and
>> you can run it by `node anysize-server.js`.
>>
>>
>> I tested squid 3.5.27 and 4.0.21, both compiled and run on Linux x86_64:
>> `./configure --with-default-user=duanyao
>> --prefix=/home/duanyao/project/proxy/squid-root/`.
>>
>>
>> Thanks.
>>
>>
>> Duan, Yao
>>
>>
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>>




From famaro at gmail.com  Wed Oct 18 14:33:50 2017
From: famaro at gmail.com (Francisco Amaro)
Date: Wed, 18 Oct 2017 15:33:50 +0100
Subject: [squid-users] Squid 3.5.20 and 3.1.23 getting re-started with
 bogus "FATAL: Bungled" acls
In-Reply-To: <08cd01d347a4$fb3130f0$f19392d0$@ngtech.co.il>
References: <CAH+mwvo5MK58oGcqRgkURObnJpgoy1=Knp2vQV=E92kf7gYijQ@mail.gmail.com>
 <08cd01d347a4$fb3130f0$f19392d0$@ngtech.co.il>
Message-ID: <CAH+mwvpMp91qO0_u_wtoMt4uYoXT52aVejzckkDS+XsZtapULQ@mail.gmail.com>

Hi all,

So, we've been (slowly) investigating this issue these past days, and have
reached some conclusions.

a) First, and sorry for not being clear on that, this only happens on
"squid reload", not on full stop/start cycles.
A full start cycle does not give this error, that's why we are pretty sure
the issue is not a bungled ACL, per se.

b) Besides that, it only happens when the proxy has some load on it, we
have been unable to reproduce this on
our test machines, since they do not have a significant load. We've been
postponing our ACL's changes for
early morning/lunch-hour these past days, and we didn't have had a FATAL
error since last week.

c) Although we don't have non US-ASCII on the ACL's themselves, we have a
lot of them on comments, so
I've stripped down all the comments of the ACL's files and tried that on
our test bed, it didn't generare any
kind of errors, but since they do not have some load on it, we are not sure
if it was the comments stripping
or the lack of load on the server...

So, we are now searching for an "easy" way of generating traffic on a squid
server, so we can, at least, be
able to reproduce the error, so we can try the different solutions....








2017-10-18 1:06 GMT+01:00 Eliezer Croitoru <eliezer at ngtech.co.il>:

> Are you validating your config files before committing them??
> If you have about 100 clients this is the first thing to do...
> Either run a asciii validation script for the whole file(I can write it if
> you really need it) or maintain two configuration testing node (CentOS 6+7).
> You don't even need to apply the configurations into the a running squid,
> you just need to run a command like "squid -kparse -f
> /etc/squid/squid.conf" and it will tell you what's wrong.
>
> Let me know if you need more help.
>
> Eliezer
>
> * CC me since I'm not watching the list daily these days.
>
> ----
> http://ngtech.co.il/lmgtfy/
> Linux System Administrator
> Mobile: +972-5-28704261
> Email: eliezer at ngtech.co.il
>
>
> From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On
> Behalf Of Francisco Amaro
> Sent: Thursday, October 12, 2017 19:25
> To: squid-users at lists.squid-cache.org
> Subject: [squid-users] Squid 3.5.20 and 3.1.23 getting re-started with
> bogus "FATAL: Bungled" acls
>
> Hello all,
>
> We are running stock CentOS 6 and CentOS 7 Squid builds, patched to the
> latest version, 3.1.23 and 3.5.20.
> We have several machines, running on separate locations, with an ACL file
> unique to all, that get's pushed to all machines using an homemade script.
> So local configuration (interfaces, cache locations, etc) is one file, and
> the bulk of the ACL's are included on
> a separate file, that is the same on all servers.
>
> For some time now, but getting more frequent on the last couple of weeks,
> we have been getting errors on our cache.log about bogus ACL's, forcing a
> squid restart. This happens on configuration reloads, which we do very
> frequently,  maybe 10-20 times a day.
>
> On CentOS 6, the most frequent error is :
>
> FATAL: Bungled (null) line 203: icap_retry deny all
>
> We do not use icap_retry, it is missing from the config file, but this
> seems to be fixed on 3.2.4:
>
> Changes to squid-3.2.4 (03 Dec 2012):
> - Remove 'Bungled' warning on missing component directives
>
> On CentOS 7, the most frequent error is :
>
> FATAL: Bungled (null) line 3: sslproxy_cert_sign signTrusted all
>
> Now this one even has a bug entry, and was fixed on 3.3.5:
>
> Changes to squid-3.3.5 (20 May 2013):
> - Bug 3744: squid terminated: FATAL: Bungled (null) line 3:
> sslproxy_cert_sign signTrusted all
>
> But we are still seeing it on 3.5.20...
>
> Now what is even more weird is that besides that, we are getting what seem
> complete random bogus entries, like this ones:
>
> FATAL: Bungled /etc/squid/squid_acls line 11796: acl xyz_allow_url
> FATAL: Bungled /etc/squid/squid_acls line 10905: acl abc_url108 dstdomai
>
> FATAL: Bungled squid_acls line 10033: http_access allow def_
> FATAL: Bungled squid_acls line 9605: http_access allow ms_src_teste ms_t
> FATAL: Bungled squid_acls line 11025: http_access allow xpto
>
> The problem is that these lines are 100% correct , they are not "bungled"
> at all,  it seems the parser as some issue with it.
>
> Each time we get an error like this, Squid does a full restart, and that
> on CentOS 6 is time consuming, maybe 2-3 minutes, time enough for our users
> reaching for the Helpdesk tickets... On CentOS 7, since the restart is very
> fast, we do not have many complaints...
>
> Our ACL file is currently 7500 lines, mostly comprising of dstdomain and
> url_regex entries. We support a lot of costumers (about 100) and each one
> has a specific configuration. Mostly have while lists, and there are a  few
> blacklists in the middle... so, not very big in terms of line numbers, but
> somewhat  complex regarding site/VLAN entries...
>
> For security/privacy reasons I cannot share my complete configuration,
> namely the ACL's part, since they contain client information, but I am able
> to get detailed logging and/or redacted information...
>
> So... anyone has any clue what is happenning ?
>
>
>
> --
>
>
> Francisco Amaro
> Email: mailto:famaro at gmail.com
>
>


-- 
Francisco Amaro
Email: famaro at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171018/a61e417a/attachment.htm>

From rousskov at measurement-factory.com  Wed Oct 18 15:17:42 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 18 Oct 2017 09:17:42 -0600
Subject: [squid-users] Unable to get TCP_MEM_HIT (just TCP_HIT) with
 rock storage
In-Reply-To: <7efbaf47-bb07-01e5-19e6-c430b93c202b@ustc.edu>
References: <d3d3b9a4-3f69-6690-fad8-7bf228e164a5@ustc.edu>
 <c9e1bc2c-f129-1e28-4a10-473ecd1378ea@measurement-factory.com>
 <7efbaf47-bb07-01e5-19e6-c430b93c202b@ustc.edu>
Message-ID: <65b1be14-239e-d7c4-a7d6-6b8f18df566f@measurement-factory.com>

On 10/17/2017 11:48 PM, duanyao wrote:
> ? 2017/10/18 ??12:23, Alex Rousskov ??:

>> The shared
>> memory cache does not support caching of Vary-controlled responses yet.

> I guess this issue will unlikely be fixed any time soon. 

The timing of adding Vary caching support for the shared memory cache is
largely controlled by you and other Squid users:

http://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F


> So is there any workaround? Something in my mind:

> 1) Configure squid to ignore "Vary: Accept-Encoding" and assume all
> clients can handle any Content-Encoding from original servers (this make
> sense in my use case).

Vary is not limited to Content-Encoding. I do not think it is possible
to configure Squid to ignore Vary (reply_header_access does not work for
that!), and even if it is possible, it will certainly break web clients
in all but the most restrictive/limited environments.

You can modify Squid code to ignore Vary, of course. Sorry, I do not
have a ready-to-use instructions for doing that. Again, disabling Vary
is a bad idea unless proxied traffic does not use Vary at all.


> 2) Use non-shared memory cache with Rock storage.

That is always an option, but you should not use SMP then. If you want
to use rock cache_dirs without SMP, start Squid with -N.

Alex.


From duanyao at ustc.edu  Thu Oct 19 03:37:19 2017
From: duanyao at ustc.edu (duanyao)
Date: Thu, 19 Oct 2017 11:37:19 +0800
Subject: [squid-users] Unable to get TCP_MEM_HIT (just TCP_HIT) with
 rock storage
In-Reply-To: <65b1be14-239e-d7c4-a7d6-6b8f18df566f@measurement-factory.com>
References: <d3d3b9a4-3f69-6690-fad8-7bf228e164a5@ustc.edu>
 <c9e1bc2c-f129-1e28-4a10-473ecd1378ea@measurement-factory.com>
 <7efbaf47-bb07-01e5-19e6-c430b93c202b@ustc.edu>
 <65b1be14-239e-d7c4-a7d6-6b8f18df566f@measurement-factory.com>
Message-ID: <879cdbd9-7667-d6cf-690a-ed9eed0c70d5@ustc.edu>

? 2017/10/18 ??11:17, Alex Rousskov ??:
> On 10/17/2017 11:48 PM, duanyao wrote:
>> ? 2017/10/18 ??12:23, Alex Rousskov ??:
>>> The shared
>>> memory cache does not support caching of Vary-controlled responses yet.
>> I guess this issue will unlikely be fixed any time soon.
> The timing of adding Vary caching support for the shared memory cache is
> largely controlled by you and other Squid users:
>
> http://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F
>

Fair enough, I'll consider it. Maybe I can implement ignoring "Vary: 
Accept-Encoding" as an option, it looks relatively simple.

>> So is there any workaround? Something in my mind:
>> 1) Configure squid to ignore "Vary: Accept-Encoding" and assume all
>> clients can handle any Content-Encoding from original servers (this make
>> sense in my use case).
> Vary is not limited to Content-Encoding. I do not think it is possible
> to configure Squid to ignore Vary (reply_header_access does not work for
> that!), and even if it is possible, it will certainly break web clients
> in all but the most restrictive/limited environments.
>
> You can modify Squid code to ignore Vary, of course. Sorry, I do not
> have a ready-to-use instructions for doing that. Again, disabling Vary
> is a bad idea unless proxied traffic does not use Vary at all.
>

I mean just ignore "Vary: Accept-Encoding" and nothing more ?? if the 
original server sends "Vary: User-Agent" or "Vary: Cookie", don't ignore 
them.
To my knowledge, Accept-Encoding and Content-Encoding are only used for 
compressing,
and almost all decent HTTP clients can handle compressed content, so the 
risk looks low enough.

>> 2) Use non-shared memory cache with Rock storage.
> That is always an option, but you should not use SMP then. If you want
> to use rock cache_dirs without SMP, start Squid with -N.

So it's not possible to make each worker process to own a non-shared 
memory cache?
Well, the main point to use Rock is SMP support.

>
> Alex.





From rousskov at measurement-factory.com  Thu Oct 19 03:59:02 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 18 Oct 2017 21:59:02 -0600
Subject: [squid-users] Unable to get TCP_MEM_HIT (just TCP_HIT) with
 rock storage
In-Reply-To: <879cdbd9-7667-d6cf-690a-ed9eed0c70d5@ustc.edu>
References: <d3d3b9a4-3f69-6690-fad8-7bf228e164a5@ustc.edu>
 <c9e1bc2c-f129-1e28-4a10-473ecd1378ea@measurement-factory.com>
 <7efbaf47-bb07-01e5-19e6-c430b93c202b@ustc.edu>
 <65b1be14-239e-d7c4-a7d6-6b8f18df566f@measurement-factory.com>
 <879cdbd9-7667-d6cf-690a-ed9eed0c70d5@ustc.edu>
Message-ID: <31280af2-e864-a99a-8992-650919b85fb2@measurement-factory.com>

On 10/18/2017 09:37 PM, duanyao wrote:

> Maybe I can implement ignoring "Vary: Accept-Encoding" as an option,
> it looks relatively simple.

It is probably simple indeed. One caveat: If you want your changes to be
officially accepted, then you may want to discuss your idea on squid-dev
first. I suspect that a long-term implementation that the Project can
accept may involve quite a bit more than an option to ignore
Vary:Accept-Encoding.


>>> 2) Use non-shared memory cache with Rock storage.

>> That is always an option, but you should not use SMP then. If you want
>> to use rock cache_dirs without SMP, start Squid with -N.

> So it's not possible to make each worker process to own a non-shared
> memory cache?

It is possible (see memory_cache_shared), but:

* you must not combine SMP Squid, rock, and non-shared memory cache and,

* IMO, you should not combine SMP Squid and non-shared memory cache
  (and/or any other SMP-unaware cache such as ufs).

If you want more information on this confusing subject, please search
the mailing list archives. The topic of combining SMP-unaware caches and
SMP has been discussed extensively.


Thank you,

Alex.


From squid3 at treenet.co.nz  Thu Oct 19 05:12:33 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Thu, 19 Oct 2017 18:12:33 +1300
Subject: [squid-users] Official Docker Image?
In-Reply-To: <!&!AAAAAAAAAAAuAAAAAAAAAGDVRrtF13VDjYYZR9MgvgYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAACFqlCBg3AkTZcvRoi3FlNfAQAAAAA=@ngtech.co.il>
References: <CAMq59O6znE2puEKGGBjmU5XLTSb6Xju8FmPFngwaNmqkDL=ybg@mail.gmail.com>
 <!&!AAAAAAAAAAAuAAAAAAAAAGDVRrtF13VDjYYZR9MgvgYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAACFqlCBg3AkTZcvRoi3FlNfAQAAAAA=@ngtech.co.il>
Message-ID: <e952cd68-4c46-0c09-fbc7-4fa75fcf59b0@treenet.co.nz>

On 18/10/17 12:54, Eliezer Croitoru wrote:
> What version of squid should be installed?
> Also what base Linux distribution should we use?
> Since it's Docker container it won't be simple to use it as a gateway router and will only be usable as a simple forward proxy with or without ssl-bump.
> Since I already package squid for many OS I believe you can choose one of these and then use a specific mounted directory for persistent settings.

All of the Squid modes of operation are relatively easy in a docker 
container, no more complex than in a VM and there are more than a 
handful of companies already providing Squid based VM products.

It would be very hard to setup One True Image for Docker because there 
are so many use-cases that Squid satisfies - many of which involve 
conflicting configuration details. This same reason is part of why we 
provide the wiki ConfigExample section(s) instead of shipping example 
config files for each popular use-case.

Amos


From eraya at a21an.org  Thu Oct 19 05:28:46 2017
From: eraya at a21an.org (Eray Aslan)
Date: Thu, 19 Oct 2017 08:28:46 +0300
Subject: [squid-users] Official Docker Image?
In-Reply-To: <e952cd68-4c46-0c09-fbc7-4fa75fcf59b0@treenet.co.nz>
References: <CAMq59O6znE2puEKGGBjmU5XLTSb6Xju8FmPFngwaNmqkDL=ybg@mail.gmail.com>
 <!&!AAAAAAAAAAAuAAAAAAAAAGDVRrtF13VDjYYZR9MgvgYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAACFqlCBg3AkTZcvRoi3FlNfAQAAAAA=@ngtech.co.il>
 <e952cd68-4c46-0c09-fbc7-4fa75fcf59b0@treenet.co.nz>
Message-ID: <20171019052846.GA4776@angelfall.a21an.org>

On Thu, Oct 19, 2017 at 06:12:33PM +1300, Amos Jeffries wrote:
> It would be very hard to setup One True Image for Docker because there 
> are so many use-cases that Squid satisfies - many of which involve 
> conflicting configuration details.

That is true, although perhaps to a lesser extent, for a lot of
projects.  Just choose a simple config - say forward proxy, no ssl-bump,
no persistant storage etc - and let the sysadmin deal the rest.  Your
CI/CD setup should be able to automate the process with relative ease.

-- 
Eray


From klaus at tachtler.net  Thu Oct 19 06:11:56 2017
From: klaus at tachtler.net (Klaus Tachtler)
Date: Thu, 19 Oct 2017 08:11:56 +0200
Subject: [squid-users] Question about: ext_session_acl Splash/Portal
 solution.
In-Reply-To: <20171017065706.Horde.NnIYkej1jKBSKJxGW2-63oj@buero.tachtler.net>
References: <20171013174053.Horde.x7SZ4RI4K6WkCTFcw_ZSTyp@buero.tachtler.net>
 <df530d74-c36b-56bd-19a4-e666a3c7a407@treenet.co.nz>
 <20171014230237.Horde.7lXgVKZUrx1iDHZ-Z3zO3Re@buero.tachtler.net>
 <9db803ba-8e68-6629-3b5d-e93dea82d723@treenet.co.nz>
 <20171015201733.Horde.Wc7rCYoHpdMV8ZC3tsQfvio@buero.tachtler.net>
 <244ce742-2bcf-f601-2b80-ab077828c243@treenet.co.nz>
 <20171017065706.Horde.NnIYkej1jKBSKJxGW2-63oj@buero.tachtler.net>
Message-ID: <20171019081156.Horde.TamSAXKQvP2kB0nMzXbs9tX@buero.tachtler.net>

Hi Amos,
hi list,

is there a problem with the Splash-Screen example from squid homepage
  - https://wiki.squid-cache.org/ConfigExamples/Portal/Splash
if the squid is BEHIND a e2Guardian(Fork of DansGuardian)?


Thank you!
Klaus.


-- 

------------------------------------------
e-Mail  : klaus at tachtler.net
Homepage: http://www.tachtler.net
DokuWiki: http://www.dokuwiki.tachtler.net
------------------------------------------
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-keys
Size: 3120 bytes
Desc: ?ffentlicher PGP-Schl?ssel
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171019/c75d644b/attachment.key>

From duanyao at ustc.edu  Thu Oct 19 06:31:23 2017
From: duanyao at ustc.edu (duanyao)
Date: Thu, 19 Oct 2017 14:31:23 +0800
Subject: [squid-users] Unable to get TCP_MEM_HIT (just TCP_HIT) with
 rock storage
In-Reply-To: <31280af2-e864-a99a-8992-650919b85fb2@measurement-factory.com>
References: <d3d3b9a4-3f69-6690-fad8-7bf228e164a5@ustc.edu>
 <c9e1bc2c-f129-1e28-4a10-473ecd1378ea@measurement-factory.com>
 <7efbaf47-bb07-01e5-19e6-c430b93c202b@ustc.edu>
 <65b1be14-239e-d7c4-a7d6-6b8f18df566f@measurement-factory.com>
 <879cdbd9-7667-d6cf-690a-ed9eed0c70d5@ustc.edu>
 <31280af2-e864-a99a-8992-650919b85fb2@measurement-factory.com>
Message-ID: <4ab49911-832a-dfed-d08f-85ea42adfc1e@ustc.edu>

? 2017/10/19 ??11:59, Alex Rousskov ??:
> On 10/18/2017 09:37 PM, duanyao wrote:
>
>> Maybe I can implement ignoring "Vary: Accept-Encoding" as an option,
>> it looks relatively simple.
> It is probably simple indeed. One caveat: If you want your changes to be
> officially accepted, then you may want to discuss your idea on squid-dev
> first. I suspect that a long-term implementation that the Project can
> accept may involve quite a bit more than an option to ignore
> Vary:Accept-Encoding.
>

I see, thanks.
>>>> 2) Use non-shared memory cache with Rock storage.
>>> That is always an option, but you should not use SMP then. If you want
>>> to use rock cache_dirs without SMP, start Squid with -N.
>> So it's not possible to make each worker process to own a non-shared
>> memory cache?
> It is possible (see memory_cache_shared), but:
>
> * you must not combine SMP Squid, rock, and non-shared memory cache and,
>
> * IMO, you should not combine SMP Squid and non-shared memory cache
>    (and/or any other SMP-unaware cache such as ufs).
>
> If you want more information on this confusing subject, please search
> the mailing list archives. The topic of combining SMP-unaware caches and
> SMP has been discussed extensively.

So this option is out because I still need SMP.

>
> Thank you,
>
> Alex.





From eliezer at ngtech.co.il  Thu Oct 19 10:55:37 2017
From: eliezer at ngtech.co.il (Eliezer Croitoru)
Date: Thu, 19 Oct 2017 13:55:37 +0300
Subject: [squid-users] Unable to get TCP_MEM_HIT (just TCP_HIT) with
	rock	storage
In-Reply-To: <d3d3b9a4-3f69-6690-fad8-7bf228e164a5@ustc.edu>
References: <d3d3b9a4-3f69-6690-fad8-7bf228e164a5@ustc.edu>
Message-ID: <002101d348c8$cbe41d60$63ac5820$@ngtech.co.il>

Hey,

It's not clear to me if the issue you are trying to resolve is for a specific service or squid-wide.
Your tests are done on localhost so it might reflect other services as well but still I want to be sure I understand what you are aiming for.
If you are indeed aiming a specific service then I believe that your setup+squid.conf maybe not what you need.

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: eliezer at ngtech.co.il


-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of duanyao
Sent: Tuesday, October 17, 2017 07:31
To: squid-users at lists.squid-cache.org
Subject: [squid-users] Unable to get TCP_MEM_HIT (just TCP_HIT) with rock storage

Hi,

When I test squid with rock storage, I have never got a TCP_MEM_HIT 
(just TCP_HIT) in access.log. I do get TCP_MEM_HIT with ufs storage.

Is this normal, or something is mis-configured?


I run squid locally, and run `curl -v -x localhost:3128 
http://localhost:8001/1000 > /dev/null` two times successively, and 
expect at least the second one being TCP_MEM_HIT, but it is always TCP_HIT.


Attachment "squid.conf" is my configuration file; and "cache.rock.log" 
is the part of cache.log during 2 successive accesses to a same URL; 
"anysize-server.js" is the HTTP server at port 8001 for the test, and 
you can run it by `node anysize-server.js`.


I tested squid 3.5.27 and 4.0.21, both compiled and run on Linux x86_64: 
`./configure --with-default-user=duanyao 
--prefix=/home/duanyao/project/proxy/squid-root/`.


Thanks.


Duan, Yao




From squid3 at treenet.co.nz  Thu Oct 19 11:37:01 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 20 Oct 2017 00:37:01 +1300
Subject: [squid-users] External user cant access web server
In-Reply-To: <1508230571076-0.post@n4.nabble.com>
References: <1508230571076-0.post@n4.nabble.com>
Message-ID: <fdcf6916-cc0c-f263-6502-d56d3875794e@treenet.co.nz>

On 17/10/17 21:56, hoje wrote:
> Hi Mr.Amos,
> 
> Thank you for helping in my previous post. I have a question. I?ve tried the
> same squid.conf setup to a new topology, and it works only for all internal
> users. But, external users that want to access my public web server, will
> get an access denied error (?The requested URL could not be retrieved?).
> Anything that i need to do to fix this problem? Please advice. Thank you
> again.
> 
> My setup
> ???
> debian 9, squid-3.5.26-20170702-r14182
> 
> 
> Old topology (that works)
> ????
> WAN +-->RT+?>(linux+SQUID+bridge)?>SW+---> INT USER
> 

What are the WAN users supposed to be accessing in this "working" topology?
  ( the "->" indicates request flow).

> 
> New topology (ext user can?t access my web server)
> ???????
> WAN +-->RT+?>(linux+SQUID+bridge)+?> FW+---> SW+---> INT USER
>                                                                       +
>                                                                       |
>                                                                       v
>                                                                  DMZ SW
>                                                                      +
>                                                                      |
>                                                                      v
>                                                                 WEB SRV

You seem to be describing WAN users accessing internal user accounts, 
which relay to internal web server. That right ?


> My squid.conf
> ?????
> https://pastebin.com/AbU6nihK
> 

This config only permits the LAN 10/8, fe80::/16, and fc00::/16 ranges - 
though the ports are IPv4-only so those IPv6 ranges cannot even connect 
in the first place.

To run Squid as a gateway for an internal server you need an accel port, 
cache_peer and http_access + cache_peer_access to permit access to the 
hosted domains.
  see 
<https://wiki.squid-cache.org/ConfigExamples/Reverse/BasicAccelerator> 
and <https://wiki.squid-cache.org/ConfigExamples/Reverse/VirtualHosting>



Amos


From klaus at tachtler.net  Thu Oct 19 11:47:18 2017
From: klaus at tachtler.net (Klaus Tachtler)
Date: Thu, 19 Oct 2017 13:47:18 +0200
Subject: [squid-users] [SOLVED] Re: Question about: ext_session_acl
 Splash/Portal solution.
In-Reply-To: <20171019081156.Horde.TamSAXKQvP2kB0nMzXbs9tX@buero.tachtler.net>
References: <20171013174053.Horde.x7SZ4RI4K6WkCTFcw_ZSTyp@buero.tachtler.net>
 <df530d74-c36b-56bd-19a4-e666a3c7a407@treenet.co.nz>
 <20171014230237.Horde.7lXgVKZUrx1iDHZ-Z3zO3Re@buero.tachtler.net>
 <9db803ba-8e68-6629-3b5d-e93dea82d723@treenet.co.nz>
 <20171015201733.Horde.Wc7rCYoHpdMV8ZC3tsQfvio@buero.tachtler.net>
 <244ce742-2bcf-f601-2b80-ab077828c243@treenet.co.nz>
 <20171017065706.Horde.NnIYkej1jKBSKJxGW2-63oj@buero.tachtler.net>
 <20171019081156.Horde.TamSAXKQvP2kB0nMzXbs9tX@buero.tachtler.net>
Message-ID: <20171019134718.Horde.2A2JFukr4i_oHrtTTQ36gh_@buero.tachtler.net>

Hi Amos,
hi list,

I found my problem and the solution for it. The problem was inside the  
apache host, who is holding my accept.php page. The splash.php and  
accept.php page had some problems too, but now it's working.

For my solution, see following link (sorry the description are only in  
German language available):
-  
https://www.dokuwiki.tachtler.net/doku.php?id=tachtler:squid_centos_7#portal_splash_pages


Thank you Amos, for your patience and help!
Klaus.




-- 

------------------------------------------
e-Mail  : klaus at tachtler.net
Homepage: http://www.tachtler.net
DokuWiki: http://www.dokuwiki.tachtler.net
------------------------------------------
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-keys
Size: 3120 bytes
Desc: ?ffentlicher PGP-Schl?ssel
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171019/99156259/attachment.key>

From duanyao at ustc.edu  Thu Oct 19 13:34:39 2017
From: duanyao at ustc.edu (duanyao)
Date: Thu, 19 Oct 2017 21:34:39 +0800
Subject: [squid-users] Unable to get TCP_MEM_HIT (just TCP_HIT) with
 rock storage
In-Reply-To: <002101d348c8$cbe41d60$63ac5820$@ngtech.co.il>
References: <d3d3b9a4-3f69-6690-fad8-7bf228e164a5@ustc.edu>
 <002101d348c8$cbe41d60$63ac5820$@ngtech.co.il>
Message-ID: <47daf9bb-c578-992b-50cb-35691b372b42@ustc.edu>

? 2017/10/19 ??6:55, Eliezer Croitoru ??:
> Hey,
>
> It's not clear to me if the issue you are trying to resolve is for a specific service or squid-wide.

I'm not sure what do "a specific service" and "squid-wide" mean.
I think Alex Rousskov already solved my issue in this thread: shared 
memory cache can't hold responses with a "Vary" header.
Thank you anyway.

> Your tests are done on localhost so it might reflect other services as well but still I want to be sure I understand what you are aiming for.

My goal was figuring out why Squid with Rock always send TCP_HIT instead 
of TCP_MEM_HIT for some responses (turned out they have "Vary" header).

> If you are indeed aiming a specific service then I believe that your setup+squid.conf maybe not what you need.
>
> Eliezer
>
> ----
> Eliezer Croitoru
> Linux System Administrator
> Mobile: +972-5-28704261
> Email: eliezer at ngtech.co.il
>
>
> -----Original Message-----
> From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of duanyao
> Sent: Tuesday, October 17, 2017 07:31
> To: squid-users at lists.squid-cache.org
> Subject: [squid-users] Unable to get TCP_MEM_HIT (just TCP_HIT) with rock storage
>
> Hi,
>
> When I test squid with rock storage, I have never got a TCP_MEM_HIT
> (just TCP_HIT) in access.log. I do get TCP_MEM_HIT with ufs storage.
>
> Is this normal, or something is mis-configured?
>
>
> I run squid locally, and run `curl -v -x localhost:3128
> http://localhost:8001/1000 > /dev/null` two times successively, and
> expect at least the second one being TCP_MEM_HIT, but it is always TCP_HIT.
>
>
> Attachment "squid.conf" is my configuration file; and "cache.rock.log"
> is the part of cache.log during 2 successive accesses to a same URL;
> "anysize-server.js" is the HTTP server at port 8001 for the test, and
> you can run it by `node anysize-server.js`.
>
>
> I tested squid 3.5.27 and 4.0.21, both compiled and run on Linux x86_64:
> `./configure --with-default-user=duanyao
> --prefix=/home/duanyao/project/proxy/squid-root/`.
>
>
> Thanks.
>
>
> Duan, Yao
>
>




From squid3 at treenet.co.nz  Thu Oct 19 13:42:48 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 20 Oct 2017 02:42:48 +1300
Subject: [squid-users] [SOLVED] Re: Question about: ext_session_acl
 Splash/Portal solution.
In-Reply-To: <20171019134718.Horde.2A2JFukr4i_oHrtTTQ36gh_@buero.tachtler.net>
References: <20171013174053.Horde.x7SZ4RI4K6WkCTFcw_ZSTyp@buero.tachtler.net>
 <df530d74-c36b-56bd-19a4-e666a3c7a407@treenet.co.nz>
 <20171014230237.Horde.7lXgVKZUrx1iDHZ-Z3zO3Re@buero.tachtler.net>
 <9db803ba-8e68-6629-3b5d-e93dea82d723@treenet.co.nz>
 <20171015201733.Horde.Wc7rCYoHpdMV8ZC3tsQfvio@buero.tachtler.net>
 <244ce742-2bcf-f601-2b80-ab077828c243@treenet.co.nz>
 <20171017065706.Horde.NnIYkej1jKBSKJxGW2-63oj@buero.tachtler.net>
 <20171019081156.Horde.TamSAXKQvP2kB0nMzXbs9tX@buero.tachtler.net>
 <20171019134718.Horde.2A2JFukr4i_oHrtTTQ36gh_@buero.tachtler.net>
Message-ID: <2198a4c6-0fac-9d41-11f4-a1d69b2befa1@treenet.co.nz>

On 20/10/17 00:47, Klaus Tachtler wrote:
> Hi Amos,
> hi list,
> 
> I found my problem and the solution for it. The problem was inside the 
> apache host, who is holding my accept.php page. The splash.php and 
> accept.php page had some problems too, but now it's working.
> 
> For my solution, see following link (sorry the description are only in 
> German language available):
> - 
> https://www.dokuwiki.tachtler.net/doku.php?id=tachtler:squid_centos_7#portal_splash_pages 
> 

I'm not quite following from the Google-translate of that page what you 
mean. Was it a PHP specific issue, or something(s) that you think we 
should warn others about in our wiki Splash config example?
  If the latter, please propose some text to add to the wiki about it.



The config files I see in that page contains some configuration lines I 
am trying to get people to stop doing:

  "always_direct allow all" - was an old hack that is no longer needed 
for SSL-Bump. Mentioning it adds confusion for people who dont 
understand the directive already - and those who know about its meaning 
should know whether they need it or not.


  "sslproxy_cert_error allow all" - PLEASE don't even mention doing 
"allow all" on this directive. It prevents debugging problems and even 
worse adds many major security vulnerabilities in production proxies. So 
just dont.
  If you need to mention the directive at all, please do so in terms of 
specific errors which are relatively harmless to ignore. (if there is no 
safely ignored error for the use-case, then this directive is not safe 
to use obviously).


  "sslproxy_flags DONT_VERIFY_PEER" - just no. This disables TLS 
security checks. Period. like the above it prevents debugging problems 
and even worse adds many major security vulnerabilities in production 
proxies. So just dont. And please pass that advice to others you find 
doing this as well - this setting really cannot die fast enough.

The system trusted CA should work for most servers. Main cause of errors 
is admin not updating their system CA certs list regularly enough. Next 
most common is really broken servers - for those you can add entries to 
the files loaded by:

  * Squid-3.4 and older add any missing CA with 
<http://www.squid-cache.org/Doc/config/sslproxy_cafile/> as necessary.

  * Squid-3.5 add intermediate CA (most common cert error situation) to 
<http://www.squid-cache.org/Doc/config/sslproxy_foreign_intermediate_certs/> 
and root CA (if any) to 
<http://www.squid-cache.org/Doc/config/sslproxy_cafile/> as necessary.

* Squid-4 should auto-fetch the missing intermediates. So you should 
only need to add trust for some occasional root CA to 
<http://www.squid-cache.org/Doc/config/sslproxy_foreign_intermediate_certs/>.

It should be obvious, but to be very clear all of the above CA loading 
options should *only* be done for CA certs which you actually trust. 
Letting the client hit CA cert errors for dangerous CA is a *good* thing 
- that is precisely the point of having CA certs in TLS.



> 
> Thank you Amos, for your patience and help!
> Klaus.
> 

You are very welcome. :-)

Amos


From klaus at tachtler.net  Thu Oct 19 14:09:03 2017
From: klaus at tachtler.net (Klaus Tachtler)
Date: Thu, 19 Oct 2017 16:09:03 +0200
Subject: [squid-users] [SOLVED] Re: Question about: ext_session_acl
 Splash/Portal solution.
In-Reply-To: <2198a4c6-0fac-9d41-11f4-a1d69b2befa1@treenet.co.nz>
References: <20171013174053.Horde.x7SZ4RI4K6WkCTFcw_ZSTyp@buero.tachtler.net>
 <df530d74-c36b-56bd-19a4-e666a3c7a407@treenet.co.nz>
 <20171014230237.Horde.7lXgVKZUrx1iDHZ-Z3zO3Re@buero.tachtler.net>
 <9db803ba-8e68-6629-3b5d-e93dea82d723@treenet.co.nz>
 <20171015201733.Horde.Wc7rCYoHpdMV8ZC3tsQfvio@buero.tachtler.net>
 <244ce742-2bcf-f601-2b80-ab077828c243@treenet.co.nz>
 <20171017065706.Horde.NnIYkej1jKBSKJxGW2-63oj@buero.tachtler.net>
 <20171019081156.Horde.TamSAXKQvP2kB0nMzXbs9tX@buero.tachtler.net>
 <20171019134718.Horde.2A2JFukr4i_oHrtTTQ36gh_@buero.tachtler.net>
 <2198a4c6-0fac-9d41-11f4-a1d69b2befa1@treenet.co.nz>
Message-ID: <20171019160903.Horde.k5iyBuQVqYpGjOu67Mxeohw@buero.tachtler.net>

Hi Amos,

> On 20/10/17 00:47, Klaus Tachtler wrote:
>> Hi Amos,
>> hi list,
>>
>> I found my problem and the solution for it. The problem was inside  
>> the apache host, who is holding my accept.php page. The splash.php  
>> and accept.php page had some problems too, but now it's working.
>>
>> For my solution, see following link (sorry the description are only  
>> in German language available):
>> -  
>> https://www.dokuwiki.tachtler.net/doku.php?id=tachtler:squid_centos_7#portal_splash_pages
>
> I'm not quite following from the Google-translate of that page what  
> you mean. Was it a PHP specific issue, or something(s) that you  
> think we should warn others about in our wiki Splash config example?
>  If the latter, please propose some text to add to the wiki about it.
>

On my first splash.php I was trying to redirect the url with  
splash.php?url=%u - that was one of the the problems with the loop  
between splash.php and accept.php - because the browser could not  
fullfill the request - because of a loop.

--- splash.php - NOT WORKING ---

<?php
session_start();
$_SESSION["goto"] = htmlspecialchars($_GET["url"]);
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"  
"http://www.w3.org/TR/html4/strict.dtd">
... and so on ...

--- splash.php - NOT WORKING ---

--- accept.php - NOT WORKING ---

<?php
session_start();
header("Location: " . $_SESSION["goto"] ); /* Browser umleiten */
session_unset();
session_destroy();
exit;
?>
<body>
</body>
</html>

--- accept.php - NOT WORKING ---

>
> The config files I see in that page contains some configuration  
> lines I am trying to get people to stop doing:

I will delete the problematic lines from my configuration example. BUT  
fist I will read the documentation again, to understand what I'm doing.

By the way, I don't use it in my small family production environment,  
I was doing that only for testing an learning, how MITM could be done.

I respect the privacy of my family, so I wouldn't use it productively.

>  "always_direct allow all" - was an old hack that is no longer  
> needed for SSL-Bump. Mentioning it adds confusion for people who  
> dont understand the directive already - and those who know about its  
> meaning should know whether they need it or not.
>
>  "sslproxy_cert_error allow all" - PLEASE don't even mention doing  
> "allow all" on this directive. It prevents debugging problems and  
> even worse adds many major security vulnerabilities in production  
> proxies. So just dont.
>  If you need to mention the directive at all, please do so in terms  
> of specific errors which are relatively harmless to ignore. (if  
> there is no safely ignored error for the use-case, then this  
> directive is not safe to use obviously).
>
>  "sslproxy_flags DONT_VERIFY_PEER" - just no. This disables TLS  
> security checks. Period. like the above it prevents debugging  
> problems and even worse adds many major security vulnerabilities in  
> production proxies. So just dont. And please pass that advice to  
> others you find doing this as well - this setting really cannot die  
> fast enough.
>
> The system trusted CA should work for most servers. Main cause of  
> errors is admin not updating their system CA certs list regularly  
> enough. Next most common is really broken servers - for those you  
> can add entries to the files loaded by:
>
>  * Squid-3.4 and older add any missing CA with  
> <http://www.squid-cache.org/Doc/config/sslproxy_cafile/> as necessary.
>
>  * Squid-3.5 add intermediate CA (most common cert error situation)  
> to  
> <http://www.squid-cache.org/Doc/config/sslproxy_foreign_intermediate_certs/>  
> and root CA (if any) to  
> <http://www.squid-cache.org/Doc/config/sslproxy_cafile/> as necessary.
>
> * Squid-4 should auto-fetch the missing intermediates. So you should  
> only need to add trust for some occasional root CA to  
> <http://www.squid-cache.org/Doc/config/sslproxy_foreign_intermediate_certs/>.
>
> It should be obvious, but to be very clear all of the above CA  
> loading options should *only* be done for CA certs which you  
> actually trust. Letting the client hit CA cert errors for dangerous  
> CA is a *good* thing - that is precisely the point of having CA  
> certs in TLS.
>
>
>
>>
>> Thank you Amos, for your patience and help!
>> Klaus.
>>
>
> You are very welcome. :-)
>
> Amos

Thank you so much for your help and reading my DokuWiki to make it better!
Klaus.


-- 

------------------------------------------
e-Mail  : klaus at tachtler.net
Homepage: http://www.tachtler.net
DokuWiki: http://www.dokuwiki.tachtler.net
------------------------------------------
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-keys
Size: 3120 bytes
Desc: ?ffentlicher PGP-Schl?ssel
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171019/be92f122/attachment.key>

From squid3 at treenet.co.nz  Thu Oct 19 14:11:05 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 20 Oct 2017 03:11:05 +1300
Subject: [squid-users] Squid 3.5.20 and 3.1.23 getting re-started with
 bogus "FATAL: Bungled" acls
In-Reply-To: <CAH+mwvpMp91qO0_u_wtoMt4uYoXT52aVejzckkDS+XsZtapULQ@mail.gmail.com>
References: <CAH+mwvo5MK58oGcqRgkURObnJpgoy1=Knp2vQV=E92kf7gYijQ@mail.gmail.com>
 <08cd01d347a4$fb3130f0$f19392d0$@ngtech.co.il>
 <CAH+mwvpMp91qO0_u_wtoMt4uYoXT52aVejzckkDS+XsZtapULQ@mail.gmail.com>
Message-ID: <7be2afb8-5785-d895-6eff-7245196f50b0@treenet.co.nz>

On 19/10/17 03:33, Francisco Amaro wrote:
> Hi all,
> 
> So, we've been (slowly) investigating this issue these past days, and 
> have reached some conclusions.
> 
> a) First, and sorry for not being clear on that, this only happens on 
> "squid reload", not on full stop/start cycles.
> A full start cycle does not give this error, that's why we are pretty 
> sure the issue is not a bungled ACL, per se.

That is unfortunately not a guarantee of success. squid.conf and files 
it refers to can be changed while Squid is running and have no effect 
until next reload happens.

Also what system infrastructure is running this "squid reload" command?

The correct commands to reload squid.conf are "squid -k reconfigure" 
[just reload] or "squid -k check" [validate then reload *if* it passes]. 
Any other system scripts or processes (eg systemd or openrc, or upstart) 
trying to manage Squid may be adding bugs of its own.


> 
> b) Besides that, it only happens when the proxy has some load on it, we 
> have been unable to reproduce this on
> our test machines, since they do not have a significant load. We've been 
> postponing our ACL's changes for
> early morning/lunch-hour these past days, and we didn't have had a FATAL 
> error since last week.
> 
> c) Although we don't have non US-ASCII on the ACL's themselves, we have 
> a lot of them on comments, so
> I've stripped down all the comments of the ACL's files and tried that on 
> our test bed, it didn't generare any
> kind of errors, but since they do not have some load on it, we are not 
> sure if it was the comments stripping
> or the lack of load on the server...

Filtering the config down to 7-bit / US-ASCII characters is a very good 
idea. We have done a bunch of work making Squid handle UTF-8, but the 
config file is one are where that is far from complete so the behaviour 
is unpredictable.

I do know that a Unicode character at the end of a line or Windows / 
MacOS line terminators have been known to cause admin a lot of headaches.


> 
> So, we are now searching for an "easy" way of generating traffic on a 
> squid server, so we can, at least, be
> able to reproduce the error, so we can try the different solutions....
> 


The Squid dev team tend to use Apache Bench ("ab" tool) to generate lots 
of simple transactions very fast if the same URL repeatedly is 
sufficient for the test or caching is disabled.
   Or a tool called Polygraph if the URLs have to be variable and 
stressing all sorts of cache and post-cache logic.

I believe there are also tools that can take a feed of web traffic and 
replay it. But I have not had to use any of those yet on Squid.

Amos


From squid3 at treenet.co.nz  Thu Oct 19 14:27:12 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 20 Oct 2017 03:27:12 +1300
Subject: [squid-users] [SOLVED] Re: Question about: ext_session_acl
 Splash/Portal solution.
In-Reply-To: <20171019160903.Horde.k5iyBuQVqYpGjOu67Mxeohw@buero.tachtler.net>
References: <20171013174053.Horde.x7SZ4RI4K6WkCTFcw_ZSTyp@buero.tachtler.net>
 <df530d74-c36b-56bd-19a4-e666a3c7a407@treenet.co.nz>
 <20171014230237.Horde.7lXgVKZUrx1iDHZ-Z3zO3Re@buero.tachtler.net>
 <9db803ba-8e68-6629-3b5d-e93dea82d723@treenet.co.nz>
 <20171015201733.Horde.Wc7rCYoHpdMV8ZC3tsQfvio@buero.tachtler.net>
 <244ce742-2bcf-f601-2b80-ab077828c243@treenet.co.nz>
 <20171017065706.Horde.NnIYkej1jKBSKJxGW2-63oj@buero.tachtler.net>
 <20171019081156.Horde.TamSAXKQvP2kB0nMzXbs9tX@buero.tachtler.net>
 <20171019134718.Horde.2A2JFukr4i_oHrtTTQ36gh_@buero.tachtler.net>
 <2198a4c6-0fac-9d41-11f4-a1d69b2befa1@treenet.co.nz>
 <20171019160903.Horde.k5iyBuQVqYpGjOu67Mxeohw@buero.tachtler.net>
Message-ID: <f76be58f-585c-e85e-963f-cea512762d23@treenet.co.nz>

On 20/10/17 03:09, Klaus Tachtler wrote:
>>
>> The config files I see in that page contains some configuration lines 
>> I am trying to get people to stop doing:
> 
> I will delete the problematic lines from my configuration example. BUT 
> fist I will read the documentation again, to understand what I'm doing.
> 
> By the way, I don't use it in my small family production environment, I 
> was doing that only for testing an learning, how MITM could be done.
> 

Ah, thats part of what I was worried about. These settings make Squid 
actively hide problems from both you as admin and the user / clients. 
Having almost all the useful error messages hidden does not help you 
learning / debugging what is going on.


> I respect the privacy of my family, so I wouldn't use it productively.
> 

These settings do not affect privacy. They make Squid stay silent even 
if your network and clients are under heavy active attacks by outside 
services. They also as a side-effect provide invisibility *to the 
attackers* (not to your clients! ouch).
  Effectively they do the opposite of what a sane admin wants in todays 
environment.

Amos


From squid3 at treenet.co.nz  Thu Oct 19 14:40:48 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 20 Oct 2017 03:40:48 +1300
Subject: [squid-users] Question about: ext_session_acl Splash/Portal
 solution.
In-Reply-To: <20171019081156.Horde.TamSAXKQvP2kB0nMzXbs9tX@buero.tachtler.net>
References: <20171013174053.Horde.x7SZ4RI4K6WkCTFcw_ZSTyp@buero.tachtler.net>
 <df530d74-c36b-56bd-19a4-e666a3c7a407@treenet.co.nz>
 <20171014230237.Horde.7lXgVKZUrx1iDHZ-Z3zO3Re@buero.tachtler.net>
 <9db803ba-8e68-6629-3b5d-e93dea82d723@treenet.co.nz>
 <20171015201733.Horde.Wc7rCYoHpdMV8ZC3tsQfvio@buero.tachtler.net>
 <244ce742-2bcf-f601-2b80-ab077828c243@treenet.co.nz>
 <20171017065706.Horde.NnIYkej1jKBSKJxGW2-63oj@buero.tachtler.net>
 <20171019081156.Horde.TamSAXKQvP2kB0nMzXbs9tX@buero.tachtler.net>
Message-ID: <9f4f0d16-d45d-bb8d-f89a-b04a65b7591e@treenet.co.nz>

On 19/10/17 19:11, Klaus Tachtler wrote:
> Hi Amos,
> hi list,
> 
> is there a problem with the Splash-Screen example from squid homepage
>  ?- https://wiki.squid-cache.org/ConfigExamples/Portal/Splash
> if the squid is BEHIND a e2Guardian(Fork of DansGuardian)?
> 

No, http_access and the related session things are all done first using 
the URLs sent by the client.

Amos


From rousskov at measurement-factory.com  Thu Oct 19 15:32:37 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 19 Oct 2017 09:32:37 -0600
Subject: [squid-users] Squid 3.5.20 and 3.1.23 getting re-started with
 bogus "FATAL: Bungled" acls
In-Reply-To: <7be2afb8-5785-d895-6eff-7245196f50b0@treenet.co.nz>
References: <CAH+mwvo5MK58oGcqRgkURObnJpgoy1=Knp2vQV=E92kf7gYijQ@mail.gmail.com>
 <08cd01d347a4$fb3130f0$f19392d0$@ngtech.co.il>
 <CAH+mwvpMp91qO0_u_wtoMt4uYoXT52aVejzckkDS+XsZtapULQ@mail.gmail.com>
 <7be2afb8-5785-d895-6eff-7245196f50b0@treenet.co.nz>
Message-ID: <8083a2c4-48a2-2c1e-e3f2-6458a0674b49@measurement-factory.com>

On 10/19/2017 08:11 AM, Amos Jeffries wrote:

> The Squid dev team tend to use Apache Bench ("ab" tool) to generate lots
> of simple transactions very fast if the same URL repeatedly is
> sufficient for the test or caching is disabled.
> ? Or a tool called Polygraph if the URLs have to be variable and
> stressing all sorts of cache and post-cache logic.
> 
> I believe there are also tools that can take a feed of web traffic and
> replay it. But I have not had to use any of those yet on Squid.

Web Polygraph can play URL lists (but not full HTTP request captures).

Alex.


From Jordan.Oldham at hammonds-uk.com  Sat Oct 21 16:06:45 2017
From: Jordan.Oldham at hammonds-uk.com (jloldham)
Date: Sat, 21 Oct 2017 09:06:45 -0700 (MST)
Subject: [squid-users] Squid Proxy 3.5.12 - Certain Website not loading
Message-ID: <1508602005947-0.post@n4.nabble.com>

Hi,

We have a website that we cannot access through squid, tracking the logs we
cannot see anything getting blocked.

Can anyone else get to this website via squid https://crm.zoho.com/.  Or
does anyone have any advice on what we can do so that the we can get the
website to work. 

Best Regards
Jordan



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From yvoinov at gmail.com  Sat Oct 21 17:17:19 2017
From: yvoinov at gmail.com (Yuri)
Date: Sat, 21 Oct 2017 23:17:19 +0600
Subject: [squid-users] Squid Proxy 3.5.12 - Certain Website not loading
In-Reply-To: <1508602005947-0.post@n4.nabble.com>
References: <1508602005947-0.post@n4.nabble.com>
Message-ID: <11111ca7-e177-c015-553f-276ff0b706b2@gmail.com>

Works okay for me. Tested on 3 squid's.


21.10.2017 22:06, jloldham ?????:
> Hi,
>
> We have a website that we cannot access through squid, tracking the logs we
> cannot see anything getting blocked.
>
> Can anyone else get to this website via squid https://crm.zoho.com/.  Or
> does anyone have any advice on what we can do so that the we can get the
> website to work. 
>
> Best Regards
> Jordan
>
>
>
> --
> Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
**************************
* C++: Bug to the future *
**************************

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171021/12caa089/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171021/12caa089/attachment.sig>

From cccc.under at gmail.com  Sun Oct 22 05:40:38 2017
From: cccc.under at gmail.com (seroto_nin)
Date: Sat, 21 Oct 2017 22:40:38 -0700 (MST)
Subject: [squid-users] Help to Compile Squid for Windows
In-Reply-To: <21663892-5f8d-a362-c896-738ae8ab0f79@measurement-factory.com>
References: <BY2PR20MB0213DAF20EB51B7A4762CADBAEEE0@BY2PR20MB0213.namprd20.prod.outlook.com>
 <BY2PR20MB021315DB4D8FD5421C2A0D68AEEE0@BY2PR20MB0213.namprd20.prod.outlook.com>
 <21663892-5f8d-a362-c896-738ae8ab0f79@measurement-factory.com>
Message-ID: <1508650838488-0.post@n4.nabble.com>

Hi.
> SBuf.cc:760:61: error: ?memrchr? was not declared in this scope 
>      const void *i = memrchr(buf(), (int)c, (size_type)endPos); 

I encounterd this problem too.
To avoid this, you may edit "config.status" as described below after running
"/.configure".
-D["HAVE_MEMRCHR"]=" 1"
+D["HAVE_MEMRCHR"]=" 0"

Perhaps .configure's bug.
".configure" recognizes that system has memrchr() but In fact Windows
doesn't.
So you need to indicate the system does not have memrchr(). 
Then "make" comes to use memrchr() included in squid's source code.
(compat/memrchr.cc)



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From for.work2920 at gmail.com  Sun Oct 22 16:08:33 2017
From: for.work2920 at gmail.com (Hanoch Hanoch K)
Date: Sun, 22 Oct 2017 19:08:33 +0300
Subject: [squid-users] tproxy first time implementation on squid.
Message-ID: <CAHWcLuNt4TNF1BW_yS5ynvMnDBj=0PHz5Yvfjs2FxHHJqpfUHA@mail.gmail.com>

Hi
I am trying to configure tproxy to expose the ip address i am using to
internet sites and not the ip address of the squid server.
I did read the wiki from the squid web site and acted upon.
the environment i am using is test and i will need to deploy it into
producton when test will work and all the subject will be clear to me.
so the server is ubuntu 14.04.
squid was compiled with netfilter prefix.
the kernel is new and seems to have built in support in the tproxy.
iptables rules where created as the wiki request.
route option had been applied and the sysctl was configured as requested by
the wiki.
the client is windows 7 vmware vm and also the server is vmware vm with 2
ethernet adapters.
one of  the interfaces connect the windows 7 and one having ip from the
built in dhcp server at the router and it is the internet interface.
the server and the client both behind router and all have private ip.
till now the setup.
the problem is when I try to surf with this configuration i get time out.
at the wiki it says it is routing problem.
but digging the logs i do not understand where is my mistake.
can i use this configuration? lets say can i send ip like 10.0.0.2 to be
discovered at internet?
is this configuration is legal?
do not i need public ip on all the interfaces?
if not what is wrong.
i will be happy to supply any log or conf file.
please try to help me.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171022/977979e7/attachment.htm>

From rightkicktech at gmail.com  Sun Oct 22 17:51:37 2017
From: rightkicktech at gmail.com (Alex K)
Date: Sun, 22 Oct 2017 20:51:37 +0300
Subject: [squid-users] tproxy first time implementation on squid.
In-Reply-To: <CAHWcLuNt4TNF1BW_yS5ynvMnDBj=0PHz5Yvfjs2FxHHJqpfUHA@mail.gmail.com>
References: <CAHWcLuNt4TNF1BW_yS5ynvMnDBj=0PHz5Yvfjs2FxHHJqpfUHA@mail.gmail.com>
Message-ID: <CABMULtJd_FGF_4ifA2SgjOuO1+eKMYE5G9A5SEAPKKGKn9uK8w@mail.gmail.com>

You might be missing a NAT at last node before the packet is left to
Internet otherwise you need a public IP at the windows client.

On Oct 22, 2017 19:08, "Hanoch Hanoch K" <for.work2920 at gmail.com> wrote:

> Hi
> I am trying to configure tproxy to expose the ip address i am using to
> internet sites and not the ip address of the squid server.
> I did read the wiki from the squid web site and acted upon.
> the environment i am using is test and i will need to deploy it into
> producton when test will work and all the subject will be clear to me.
> so the server is ubuntu 14.04.
> squid was compiled with netfilter prefix.
> the kernel is new and seems to have built in support in the tproxy.
> iptables rules where created as the wiki request.
> route option had been applied and the sysctl was configured as requested
> by the wiki.
> the client is windows 7 vmware vm and also the server is vmware vm with 2
> ethernet adapters.
> one of  the interfaces connect the windows 7 and one having ip from the
> built in dhcp server at the router and it is the internet interface.
> the server and the client both behind router and all have private ip.
> till now the setup.
> the problem is when I try to surf with this configuration i get time out.
> at the wiki it says it is routing problem.
> but digging the logs i do not understand where is my mistake.
> can i use this configuration? lets say can i send ip like 10.0.0.2 to be
> discovered at internet?
> is this configuration is legal?
> do not i need public ip on all the interfaces?
> if not what is wrong.
> i will be happy to supply any log or conf file.
> please try to help me.
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171022/66b422a1/attachment.htm>

From Jordan.Oldham at hammonds-uk.com  Mon Oct 23 08:38:15 2017
From: Jordan.Oldham at hammonds-uk.com (Jordan Oldham)
Date: Mon, 23 Oct 2017 08:38:15 +0000
Subject: [squid-users] Squid Proxy 3.5.12 - Certain Website not loading
In-Reply-To: <11111ca7-e177-c015-553f-276ff0b706b2@gmail.com>
References: <1508602005947-0.post@n4.nabble.com>
 <11111ca7-e177-c015-553f-276ff0b706b2@gmail.com>
Message-ID: <FC06D316CCD269449A0275B77E8D56770111D684A4@SRV-NL-MBX-01.hammonds-uk.com>

Hi Yuri,

Thank you for testing, please can you let me know the version you are using so I can make sure ours matches :)

Thanks for your help
Jordan



-----Original Message-----
From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Yuri
Sent: 21 October 2017 18:17
To: squid-users at lists.squid-cache.org
Subject: Re: [squid-users] Squid Proxy 3.5.12 - Certain Website not loading

Works okay for me. Tested on 3 squid's.


21.10.2017 22:06, jloldham ?????:
> Hi,
>
> We have a website that we cannot access through squid, tracking the 
> logs we cannot see anything getting blocked.
>
> Can anyone else get to this website via squid https://crm.zoho.com/.  
> Or does anyone have any advice on what we can do so that the we can 
> get the website to work.
>
> Best Regards
> Jordan
>
>
>
> --
> Sent from: 
> http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f101909
> 1.html _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

--
**************************
* C++: Bug to the future *
**************************


From yvoinov at gmail.com  Mon Oct 23 12:05:30 2017
From: yvoinov at gmail.com (Yuri)
Date: Mon, 23 Oct 2017 18:05:30 +0600
Subject: [squid-users] Squid Proxy 3.5.12 - Certain Website not loading
In-Reply-To: <FC06D316CCD269449A0275B77E8D56770111D684A4@SRV-NL-MBX-01.hammonds-uk.com>
References: <1508602005947-0.post@n4.nabble.com>
 <11111ca7-e177-c015-553f-276ff0b706b2@gmail.com>
 <FC06D316CCD269449A0275B77E8D56770111D684A4@SRV-NL-MBX-01.hammonds-uk.com>
Message-ID: <59bf317a-be13-18a7-c939-5f999c69259c@gmail.com>

3.5.27 and 5.0.0 (latest)


23.10.2017 14:38, Jordan Oldham ?????:
> Hi Yuri,
>
> Thank you for testing, please can you let me know the version you are using so I can make sure ours matches :)
>
> Thanks for your help
> Jordan
>
>
>
> -----Original Message-----
> From: squid-users [mailto:squid-users-bounces at lists.squid-cache.org] On Behalf Of Yuri
> Sent: 21 October 2017 18:17
> To: squid-users at lists.squid-cache.org
> Subject: Re: [squid-users] Squid Proxy 3.5.12 - Certain Website not loading
>
> Works okay for me. Tested on 3 squid's.3.5.27
>
>
> 21.10.2017 22:06, jloldham ?????:
>> Hi,
>>
>> We have a website that we cannot access through squid, tracking the
>> logs we cannot see anything getting blocked.
>>
>> Can anyone else get to this website via squid https://crm.zoho.com/.
>> Or does anyone have any advice on what we can do so that the we can
>> get the website to work.
>>
>> Best Regards
>> Jordan
>>
>>
>>
>> --
>> Sent from:
>> http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f101909
>> 1.html _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
> --
> **************************
> * C++: Bug to the future *
> **************************
>



From squid-user at tlinx.org  Mon Oct 23 17:51:11 2017
From: squid-user at tlinx.org (L A Walsh)
Date: Mon, 23 Oct 2017 10:51:11 -0700
Subject: [squid-users] Opera (Win7SP1-x64) not connecting to google.com
	because of "HSTS"?
Message-ID: <59EE2C0F.2080600@tlinx.org>

I've seen this before w/google in Opera -- but it doesn't seem
 to happen with IE or Palemoon (both going through my SSL-bumping proxy).
Even my housemate, going through the proxy using Chrome doesn't
get this error (it also uses the system cert location). 

When I bring up the security dialog in Opera, it brings up the same
dialog I see under the Win Control Panel under Internet Settings,
the "Content" tab -- where I see Certificates.  My proxy cert is listed 
under the Trusted Root Cert Authorities.


So why is Opera failing when going to google.com?
Ideas?

Thanks!
Linda




  Your connection is not private

This server could not prove that it is *www.google.com*; its security 
certificate does not specify Subject Alternative Names. This may be 
caused by a misconfiguration or an attacker intercepting your connection.

You cannot proceed because the website operator has requested heightened 
security for this domain.

Back to safety


        Help me understand

When you connect to a secure website, the server hosting that site 
presents your browser with something called a "certificate" to verify 
its identity. This certificate contains identity information, such as 
the address of the website, which is verified by a third party that your 
computer trusts. By checking that the address in the certificate matches 
the address of the website, it is possible to verify that you are 
securely communicating with the website you intended, and not a third 
party (such as an attacker on your network).

You cannot visit www.google.com right now because the website uses HSTS. 
Network errors and attacks are usually temporary, so this page will 
probably work later.



From squid-user at tlinx.org  Mon Oct 23 18:48:12 2017
From: squid-user at tlinx.org (L A Walsh)
Date: Mon, 23 Oct 2017 11:48:12 -0700
Subject: [squid-users] Squid Proxy 3.5.12 - Certain Website not loading
In-Reply-To: <1508602005947-0.post@n4.nabble.com>
References: <1508602005947-0.post@n4.nabble.com>
Message-ID: <59EE396C.1070506@tlinx.org>

jloldham wrote:
> Hi,
>
> We have a website that we cannot access through squid, tracking the logs we
> cannot see anything getting blocked.
>
> Can anyone else get to this website via squid https://crm.zoho.com/.  Or
> does anyone have any advice on what we can do so that the we can get the
> website to work. 
>   
----
    Works mostly fine here -- goes to https://www.zoho.com/crm/.

I keep getting Invalid certificate w/Opera
but it lets me continue... except for the HSTS sites like google.






From yvoinov at gmail.com  Mon Oct 23 19:30:31 2017
From: yvoinov at gmail.com (Yuri)
Date: Tue, 24 Oct 2017 01:30:31 +0600
Subject: [squid-users] Opera (Win7SP1-x64) not connecting to google.com
 because of "HSTS"?
In-Reply-To: <59EE2C0F.2080600@tlinx.org>
References: <59EE2C0F.2080600@tlinx.org>
Message-ID: <d7e0cd97-c2b2-86d7-68b9-c5115cf3809c@gmail.com>



23.10.2017 23:51, L A Walsh ?????:
> I've seen this before w/google in Opera -- but it doesn't seem
> to happen with IE or Palemoon (both going through my SSL-bumping proxy).
> Even my housemate, going through the proxy using Chrome doesn't
> get this error (it also uses the system cert location).
> When I bring up the security dialog in Opera, it brings up the same
> dialog I see under the Win Control Panel under Internet Settings,
> the "Content" tab -- where I see Certificates.? My proxy cert is
> listed under the Trusted Root Cert Authorities.
>
>
> So why is Opera failing when going to google.com?
> Ideas?
Try to add this:

# Disable HSTS
reply_header_access Strict-Transport-Security deny all
reply_header_replace Strict-Transport-Security max-age=0; includeSubDomains

in your config.
>
> Thanks!
> Linda
>
>
>
>
> ?Your connection is not private
>
> This server could not prove that it is *www.google.com*; its security
> certificate does not specify Subject Alternative Names. This may be
> caused by a misconfiguration or an attacker intercepting your connection.
>
> You cannot proceed because the website operator has requested
> heightened security for this domain.
>
> Back to safety
>
>
> ?????? Help me understand
>
> When you connect to a secure website, the server hosting that site
> presents your browser with something called a "certificate" to verify
> its identity. This certificate contains identity information, such as
> the address of the website, which is verified by a third party that
> your computer trusts. By checking that the address in the certificate
> matches the address of the website, it is possible to verify that you
> are securely communicating with the website you intended, and not a
> third party (such as an attacker on your network).
>
> You cannot visit www.google.com right now because the website uses
> HSTS. Network errors and attacks are usually temporary, so this page
> will probably work later.
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
**************************
* C++: Bug to the future *
**************************

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171024/a56f2608/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171024/a56f2608/attachment.sig>

From squid-user at tlinx.org  Mon Oct 23 22:12:30 2017
From: squid-user at tlinx.org (L A Walsh)
Date: Mon, 23 Oct 2017 15:12:30 -0700
Subject: [squid-users] Opera (Win7SP1-x64) not connecting to google.com
	because of "HSTS"?
In-Reply-To: <d7e0cd97-c2b2-86d7-68b9-c5115cf3809c@gmail.com>
References: <59EE2C0F.2080600@tlinx.org>
 <d7e0cd97-c2b2-86d7-68b9-c5115cf3809c@gmail.com>
Message-ID: <59EE694E.4010008@tlinx.org>

Yuri wrote:
>
> Try to add this:
>
> # Disable HSTS
> reply_header_access Strict-Transport-Security deny all
> reply_header_replace Strict-Transport-Security max-age=0; includeSubDomains
>   

Sorry, but no difference.

I placed them between these keywords -- just above the request_header_add
comment (if that makes any difference).



#  TAG: reply_header_replace
#        Usage:   reply_header_replace header_name message
#        Example: reply_header_replace Server Foo/1.0
#
#        This option allows you to change the contents of headers
#        denied with reply_header_access above, by replacing them
#        with some fixed string.
#
#        This only applies to reply headers, not request headers.
#
#        By default, headers are removed if denied.
#Default:
# none

#Disable HSTS

reply_header_access Strict-Transport-Security deny all
reply_header_replace Strict-Transport-Security max-age=0; includeSubDomains

#  TAG: request_header_add
#    Usage:   request_header_add field-name field-value acl1 [acl2] ...
#    Example: request_header_add X-Client-CA "CA=%ssl::>cert_issuer" all
#



From yvoinov at gmail.com  Mon Oct 23 22:35:57 2017
From: yvoinov at gmail.com (Yuri)
Date: Tue, 24 Oct 2017 04:35:57 +0600
Subject: [squid-users] Opera (Win7SP1-x64) not connecting to google.com
 because of "HSTS"?
In-Reply-To: <59EE694E.4010008@tlinx.org>
References: <59EE2C0F.2080600@tlinx.org>
 <d7e0cd97-c2b2-86d7-68b9-c5115cf3809c@gmail.com> <59EE694E.4010008@tlinx.org>
Message-ID: <758653f7-a3e7-c39f-560d-4cf5b9464e88@gmail.com>

Sadly, I have no Opera to test. This works perfectly with
Chrome/Firefox. Of course, it is require to reconfigure squid ;)


24.10.2017 4:12, L A Walsh ?????:
> Yuri wrote:
>>
>> Try to add this:
>>
>> # Disable HSTS
>> reply_header_access Strict-Transport-Security deny all
>> reply_header_replace Strict-Transport-Security max-age=0;
>> includeSubDomains
>> ? 
>
> Sorry, but no difference.
>
> I placed them between these keywords -- just above the request_header_add
> comment (if that makes any difference).
>
>
>
> #? TAG: reply_header_replace
> #??????? Usage:?? reply_header_replace header_name message
> #??????? Example: reply_header_replace Server Foo/1.0
> #
> #??????? This option allows you to change the contents of headers
> #??????? denied with reply_header_access above, by replacing them
> #??????? with some fixed string.
> #
> #??????? This only applies to reply headers, not request headers.
> #
> #??????? By default, headers are removed if denied.
> #Default:
> # none
>
> #Disable HSTS
>
> reply_header_access Strict-Transport-Security deny all
> reply_header_replace Strict-Transport-Security max-age=0;
> includeSubDomains
>
> #? TAG: request_header_add
> #??? Usage:?? request_header_add field-name field-value acl1 [acl2] ...
> #??? Example: request_header_add X-Client-CA "CA=%ssl::>cert_issuer" all
> #
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
**************************
* C++: Bug to the future *
**************************

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171024/a4e4d763/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171024/a4e4d763/attachment.sig>

From squid-user at tlinx.org  Mon Oct 23 23:28:49 2017
From: squid-user at tlinx.org (L A Walsh)
Date: Mon, 23 Oct 2017 16:28:49 -0700
Subject: [squid-users] Opera (Win7SP1-x64) not connecting to google.com
	because of "HSTS"?
In-Reply-To: <758653f7-a3e7-c39f-560d-4cf5b9464e88@gmail.com>
References: <59EE2C0F.2080600@tlinx.org>
 <d7e0cd97-c2b2-86d7-68b9-c5115cf3809c@gmail.com> <59EE694E.4010008@tlinx.org>
 <758653f7-a3e7-c39f-560d-4cf5b9464e88@gmail.com>
Message-ID: <59EE7B31.3020909@tlinx.org>

Yuri wrote:
> Sadly, I have no Opera to test. This works perfectly with
> Chrome/Firefox. Of course, it is require to reconfigure squid ;)
>   
----
    Well rats!.... um, it is a free download for Win/Mac & Linux
@ http://www.opera.com/computer. :~)

Not sure about mobile versions... 

    I don't use it as a mainstay, but I like to have at least 2-4
different browsers to try things on.  Opera is pretty fast though
not very easy to customize.  ;-/ (even customizing security seems
to be a problem at times... ;-)).  I do have both FF and IE
working on google ... I'm a bit wary of google -- it tends to
swamp my computer when it starts (and the more resources it takes,
the more I like to shut it down when I do something else), not to
mention they have too many ways to get my data now as it is.  ;-)

-linda

   



From yvoinov at gmail.com  Mon Oct 23 23:32:45 2017
From: yvoinov at gmail.com (Yuri)
Date: Tue, 24 Oct 2017 05:32:45 +0600
Subject: [squid-users] Opera (Win7SP1-x64) not connecting to google.com
 because of "HSTS"?
In-Reply-To: <59EE7B31.3020909@tlinx.org>
References: <59EE2C0F.2080600@tlinx.org>
 <d7e0cd97-c2b2-86d7-68b9-c5115cf3809c@gmail.com> <59EE694E.4010008@tlinx.org>
 <758653f7-a3e7-c39f-560d-4cf5b9464e88@gmail.com> <59EE7B31.3020909@tlinx.org>
Message-ID: <745d74ea-93f3-78ee-9c09-d332b424efd9@gmail.com>

Waaaaaaaaa, I dont like to make zoo on my laptop...... It is not
softwarehouse, and, of course, not in junk dump ;)

Well, may be test now on my remote station behind proxy. It is junk dump
as well. :)

24.10.2017 5:28, L A Walsh ?????:
> Yuri wrote:
>> Sadly, I have no Opera to test. This works perfectly with
>> Chrome/Firefox. Of course, it is require to reconfigure squid ;)
>> ? 
> ----
> ?? Well rats!.... um, it is a free download for Win/Mac & Linux
> @ http://www.opera.com/computer. :~)
>
> Not sure about mobile versions...
> ?? I don't use it as a mainstay, but I like to have at least 2-4
> different browsers to try things on.? Opera is pretty fast though
> not very easy to customize.? ;-/ (even customizing security seems
> to be a problem at times... ;-)).? I do have both FF and IE
> working on google ... I'm a bit wary of google -- it tends to
> swamp my computer when it starts (and the more resources it takes,
> the more I like to shut it down when I do something else), not to
> mention they have too many ways to get my data now as it is.? ;-)
>
> -linda
>
> ?
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
**************************
* C++: Bug to the future *
**************************

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171024/d643fb99/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171024/d643fb99/attachment.sig>

From yvoinov at gmail.com  Mon Oct 23 23:44:22 2017
From: yvoinov at gmail.com (Yuri)
Date: Tue, 24 Oct 2017 05:44:22 +0600
Subject: [squid-users] Opera (Win7SP1-x64) not connecting to google.com
 because of "HSTS"?
In-Reply-To: <59EE7B31.3020909@tlinx.org>
References: <59EE2C0F.2080600@tlinx.org>
 <d7e0cd97-c2b2-86d7-68b9-c5115cf3809c@gmail.com> <59EE694E.4010008@tlinx.org>
 <758653f7-a3e7-c39f-560d-4cf5b9464e88@gmail.com> <59EE7B31.3020909@tlinx.org>
Message-ID: <46ec0348-6969-9252-732f-10861b56842d@gmail.com>

https://i.imgur.com/oNbX7pB.png

https://i.imgur.com/x9rkaxd.png

https://i.imgur.com/97YOGjA.png

I see absolutely no problem with? Opera and HSTS via my proxy, as by as
Chrome/Firefox. As shown on screenshoots.

I see access.log entries and no errors in cache.log.

Works like charm.


24.10.2017 5:28, L A Walsh ?????:
> Yuri wrote:
>> Sadly, I have no Opera to test. This works perfectly with
>> Chrome/Firefox. Of course, it is require to reconfigure squid ;)
>> ? 
> ----
> ?? Well rats!.... um, it is a free download for Win/Mac & Linux
> @ http://www.opera.com/computer. :~)
>
> Not sure about mobile versions...
> ?? I don't use it as a mainstay, but I like to have at least 2-4
> different browsers to try things on.? Opera is pretty fast though
> not very easy to customize.? ;-/ (even customizing security seems
> to be a problem at times... ;-)).? I do have both FF and IE
> working on google ... I'm a bit wary of google -- it tends to
> swamp my computer when it starts (and the more resources it takes,
> the more I like to shut it down when I do something else), not to
> mention they have too many ways to get my data now as it is.? ;-)
>
> -linda
>
> ?
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
**************************
* C++: Bug to the future *
**************************

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171024/7655a8d0/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171024/7655a8d0/attachment.sig>

From rentorbuy at yahoo.com  Tue Oct 24 12:34:00 2017
From: rentorbuy at yahoo.com (Vieri)
Date: Tue, 24 Oct 2017 12:34:00 +0000 (UTC)
Subject: [squid-users] squid cpu usage
References: <742455879.1992418.1508848440399.ref@mail.yahoo.com>
Message-ID: <742455879.1992418.1508848440399@mail.yahoo.com>

Hi,

During the last 3 days my Squid process has gone wild with 100% CPU usage once a day. Since this is a production system (never had this issue before), I "quickly restart" the Squid daemon, and that solves the issue until the next day.
Restarting takes quite a while...

Next time I get a 100% squid process that brings my proxy to a crawl HTTP-wise, what can I try in order to get more info, and possibly see the cause of this?
Would squidclient mgr:info shed some light on this?

Squid Object Cache: Version 3.5.27-20170916-re69e56c

Thanks,

Vieri


From squid3 at treenet.co.nz  Tue Oct 24 14:16:04 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 25 Oct 2017 03:16:04 +1300
Subject: [squid-users] squid cpu usage
In-Reply-To: <742455879.1992418.1508848440399@mail.yahoo.com>
References: <742455879.1992418.1508848440399.ref@mail.yahoo.com>
 <742455879.1992418.1508848440399@mail.yahoo.com>
Message-ID: <a790d649-2943-620a-116a-b03aa95f7971@treenet.co.nz>

On 25/10/17 01:34, Vieri wrote:
> Hi,
> 
> During the last 3 days my Squid process has gone wild with 100% CPU usage once a day. Since this is a production system (never had this issue before), I "quickly restart" the Squid daemon, and that solves the issue until the next day.
> Restarting takes quite a while...
> 
> Next time I get a 100% squid process that brings my proxy to a crawl HTTP-wise, what can I try in order to get more info, and possibly see the cause of this?
> Would squidclient mgr:info shed some light on this?

That one is just the overview, so not likely to show more than that 
things are going slowly.

Usually the 100% CPU is an indicator that the machine is swapping. So 
check the memory usage when it is happening.

Next is probably the cache garbage collection. mgr:storedir report might 
show that. Or an strace showing a lot of cycles in the cache replacement 
calls.

Amos


From rousskov at measurement-factory.com  Tue Oct 24 16:07:45 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 24 Oct 2017 10:07:45 -0600
Subject: [squid-users] squid cpu usage
In-Reply-To: <742455879.1992418.1508848440399@mail.yahoo.com>
References: <742455879.1992418.1508848440399.ref@mail.yahoo.com>
 <742455879.1992418.1508848440399@mail.yahoo.com>
Message-ID: <efb11c97-0368-a8ff-c1be-9781ac450026@measurement-factory.com>

On 10/24/2017 06:34 AM, Vieri wrote:

> Next time I get a 100% squid process that brings my proxy to a crawl
> HTTP-wise, what can I try in order to get more info, and possibly see
> the cause of this?

Here are two additional tricks to consider:

* If 100% CPU usage lasts for more than a few seconds, then attaching
gdb to the running Squid worker and generating a few backtraces (a few
seconds apart) may identify the code that got stuck. Make sure you give
gdb a non-stripped Squid binary when doing that. Squid wiki should have
more instructions about the whole process.

Please note that the above is less likely to help if your Squid
continues to respond to new requests while you see ~100% CPU usage. You
may increase your chances by blocking new traffic from reaching the
problematic Squid (e.g., by redirecting all traffic to other Squid(s)
that you have in load balancing or hot standby mode OR allowing all
traffic to bypass Squid). If you cannot easily remove a problematic
Squid from user traffic path, then use this problem as an excuse to fix
your deployment architecture so that you can :-).

* Another potentially useful trick is to log mgr:events every minute or
so. Perhaps 100% CPU usage is associated with a particular regularly
scheduled event?

Please note that some modern Squids abuse the events API for frequently
occurring notifications. If you see hundreds or more events in your log,
this trick may be too expensive/intrusive for your environment.


HTH,

Alex.


From squid-user at tlinx.org  Wed Oct 25 02:14:43 2017
From: squid-user at tlinx.org (L A Walsh)
Date: Tue, 24 Oct 2017 19:14:43 -0700
Subject: [squid-users] Opera (Win7SP1-x64) not connecting to google.com
	because of "HSTS"?
In-Reply-To: <46ec0348-6969-9252-732f-10861b56842d@gmail.com>
References: <59EE2C0F.2080600@tlinx.org>
 <d7e0cd97-c2b2-86d7-68b9-c5115cf3809c@gmail.com> <59EE694E.4010008@tlinx.org>
 <758653f7-a3e7-c39f-560d-4cf5b9464e88@gmail.com> <59EE7B31.3020909@tlinx.org>
 <46ec0348-6969-9252-732f-10861b56842d@gmail.com>
Message-ID: <59EFF393.1000109@tlinx.org>

Yuri wrote:
> I see absolutely no problem with  Opera and HSTS via my proxy, as by as
> Chrome/Firefox. As shown on screenshoots.
>   
Well poo!... I see your access... but still have probs on my end.

I don't have it on IE or Pale moon.

I tried private mode on google -- same problem.

I also am trying VPN builtin to Opera -- it works.

Verifying: you didn't have to add your cert to anything for
Opera -- it just uses your Win cert store, right?

This is strange...




From yvoinov at gmail.com  Wed Oct 25 08:16:12 2017
From: yvoinov at gmail.com (Yuri)
Date: Wed, 25 Oct 2017 14:16:12 +0600
Subject: [squid-users] Opera (Win7SP1-x64) not connecting to google.com
 because of "HSTS"?
In-Reply-To: <59EFF393.1000109@tlinx.org>
References: <59EE2C0F.2080600@tlinx.org>
 <d7e0cd97-c2b2-86d7-68b9-c5115cf3809c@gmail.com> <59EE694E.4010008@tlinx.org>
 <758653f7-a3e7-c39f-560d-4cf5b9464e88@gmail.com> <59EE7B31.3020909@tlinx.org>
 <46ec0348-6969-9252-732f-10861b56842d@gmail.com> <59EFF393.1000109@tlinx.org>
Message-ID: <8fe4a541-6aec-81f3-9b51-38e8bdc40782@gmail.com>



25.10.2017 8:14, L A Walsh ?????:
> Yuri wrote:
>> I see absolutely no problem with? Opera and HSTS via my proxy, as by as
>> Chrome/Firefox. As shown on screenshoots.
>> ? 
> Well poo!... I see your access... but still have probs on my end.
>
> I don't have it on IE or Pale moon.
>
> I tried private mode on google -- same problem.
>
> I also am trying VPN builtin to Opera -- it works.
>
> Verifying: you didn't have to add your cert to anything for
> Opera -- it just uses your Win cert store, right?
Exactly.
>
> This is strange...
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
**************************
* C++: Bug to the future *
**************************

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171025/4f8dc5ef/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171025/4f8dc5ef/attachment.sig>

From rousskov at measurement-factory.com  Wed Oct 25 17:22:07 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Wed, 25 Oct 2017 11:22:07 -0600
Subject: [squid-users] tuning squid memory (aka avoiding the reaper)
In-Reply-To: <CANAZdzW84wLyRLfw=8Kn=i8cvKBBRe1T+REfdnqgAo2UJwG+Fg@mail.gmail.com>
References: <CANAZdzXS7jFH_n44BgdYALzE_r3D7t78HRamz9qdKsbtfOVyqg@mail.gmail.com>
 <6fd4bb1b-8ec5-4883-2c57-8debb3890d9a@measurement-factory.com>
 <CANAZdzUDViPoOxXVUyd0=Krz+xdyn_R0viJXxLNEMmmGtFs5jA@mail.gmail.com>
 <54372253-c45a-7ca2-37f8-8ecbdbd3ba27@treenet.co.nz>
 <CANAZdzXK4D14OaNpBLCm5ZPcgau_2+B38sXM2mTDe_bB8QwFvg@mail.gmail.com>
 <763e182c-d966-fd6a-ed2b-0c20d17c3274@treenet.co.nz>
 <CANAZdzV293R30V4Eex7B99vCJz_5JQ=4+SiaGD-65GivsQzALw@mail.gmail.com>
 <CANAZdzVsEGcPhCgC0tWAwumoGS4kRUJTXgY8ftP3H9L9HOYq4w@mail.gmail.com>
 <CANAZdzXWDn_FvQYdYn=ufK5-CdCPQBQWUx+0Z5+akzpwh_sMYg@mail.gmail.com>
 <23fca10f-f62a-7091-085d-0fb83fc1321e@treenet.co.nz>
 <CANAZdzXNxt6ZgXVsA9XE0N5RHxujVyMHccro52gXOPspJH99Aw@mail.gmail.com>
 <e13ba30e-adae-3ac9-aa1e-6ef4ea22b56f@measurement-factory.com>
 <CANAZdzXsCD2A4pxDRZ-9TevXvsWkUiBZenKDGEM-4iQ_3znoUw@mail.gmail.com>
 <CANAZdzW84wLyRLfw=8Kn=i8cvKBBRe1T+REfdnqgAo2UJwG+Fg@mail.gmail.com>
Message-ID: <3e5cc35f-810b-3a76-9c4c-19d6cc6503f7@measurement-factory.com>

On 10/25/2017 10:41 AM, Aaron Turner wrote:
> More testing.  This time with 4.0.21.  Disabled all caching, only
> enabled ssl bumping.  Same config as last time.  Still leaking memory.
> I took two snapshots of info & mem usage and honestly I don't see a
> smoking gun pointing to why my squid processes were getting as large
> as 1.4GB.
> 
> I've attached the two files incase someone with more experience can
> find something useful.

I do not have the time to study your snapshots, unfortunately, but I do
continue to recommend that you take a lot more than two snapshots (e.g.
one snapshot every 10 minutes over a few hours of steady load) and then
either find lines with an increasing counter of alive objects OR confirm
that those lines do not exist.

A Perl script at [1] implements the above analysis, but it has not been
updated for a few years, may not work "as is" with the current mgr:mem
output format, and may need additional tuning to work well in your
specific case, so you may better off starting from scratch.

  [1] http://www.measurement-factory.com/tmp/attachments/memdiff.pl


Cheers,

Alex.


> On Mon, Oct 9, 2017 at 5:04 PM, Aaron Turner <synfinatic at gmail.com> wrote:
>> So more testing.  I haven't found the line in the info:mem logs which
>> is the red flag, but additional testing proves that the memleak has
>> something to do with ssl bumping.  Once I turn that off, the memory
>> leaks stop.
>>
>> this was the ssl related config options:
>>
>> http_port 10.0.0.1:3128 ssl-bump generate-host-certificates=on
>> dynamic_cert_mem_cache_size=400MB cert=/etc/squid/ssl_cert/myCA.pem
>> sslflags=NO_DEFAULT_CA
>> http_port localhost:3128
>> ssl_bump bump all
>>
>> sslcrtd_program /usr/lib64/squid/ssl_crtd -s /var/lib/squid/ssl_db -M 4MB
>> sslcrtd_children 32 startup=2 idle=2
>> sslproxy_session_cache_size 100 MB
>> sslproxy_cert_error allow all
>> sslproxy_flags DONT_VERIFY_PEER
>>
>> --
>> Aaron Turner
>> https://synfin.net/         Twitter: @synfinatic
>> My father once told me that respect for the truth comes close to being
>> the basis for all morality.  "Something cannot emerge from nothing,"
>> he said.  This is profound thinking if you understand how unstable
>> "the truth" can be.  -- Frank Herbert, Dune
>>
>>
>> On Wed, Oct 4, 2017 at 10:53 AM, Alex Rousskov
>> <rousskov at measurement-factory.com> wrote:
>>> On 10/02/2017 09:37 PM, Aaron Turner wrote:
>>>> So it's leaking memory and not tracking it?
>>>
>>>
>>> That combination (or, to be more precise, its implication) is possible
>>> but relatively unlikely in your specific case -- when GBs are leaked,
>>> there is usually something tracked related to those GBs. Please note
>>> that what Squid _tracks_ may not amount to GBs of RAM! For example,
>>> Squid can track a tiny object that is included in every large untracked
>>> leaked object.
>>>
>>> A frequent leak often manifests itself in mgr:mem snapshots as a nearly
>>> always increasing counter of alive associated objects. If you take one
>>> snapshot every 30 minutes or so, then you may be able to identify
>>> suspects by comparing same-object alive counters across 5-10 snapshots.
>>> Sorry, I do not have the time to do that for the snapshots you have
>>> shared (and you probably need a different collection of snapshots to
>>> make this search more productive).
>>>
>>> Alex.
>>>
>>>
>>>> On Mon, Oct 2, 2017 at 8:25 PM, Amos Jeffries <squid3 at treenet.co.nz> wrote:
>>>>> On 03/10/17 04:39, Aaron Turner wrote:
>>>>>>
>>>>>> Anyone see anything useful?
>>>>>
>>>>>
>>>>> The numbers in those reports all seem reasonable to me. Nothing is showing
>>>>> up with GB of RAM used.



From rentorbuy at yahoo.com  Thu Oct 26 11:15:14 2017
From: rentorbuy at yahoo.com (Vieri)
Date: Thu, 26 Oct 2017 11:15:14 +0000 (UTC)
Subject: [squid-users] squid cpu usage
In-Reply-To: <efb11c97-0368-a8ff-c1be-9781ac450026@measurement-factory.com>
References: <742455879.1992418.1508848440399.ref@mail.yahoo.com>
 <742455879.1992418.1508848440399@mail.yahoo.com>
 <efb11c97-0368-a8ff-c1be-9781ac450026@measurement-factory.com>
Message-ID: <790628251.3784841.1509016514244@mail.yahoo.com>

Well, I've just had another issue with my CPU usage gone bonkers.

Here's the strace (compressed with gz):

https://drive.google.com/file/d/0B-tpkY1LkI67WFBaNnVpR2lteEE/view?usp=sharing

There are a lot of "Resource temporarily unavailable" messages.
However, I'm seeing these messages even when my Squid process has been restarted, and everything seems to be OK from a "user experience" point of view.
Do you see anything useful in the trace?
If not, how can I improve the trace next time I have this issue?

Here's what squidclient has to say during the "storm":

HTTP/1.1 200 OK
Server: squid
Mime-Version: 1.0
Date: Thu, 26 Oct 2017 08:34:43 GMT
Content-Type: text/plain;charset=utf-8
Expires: Thu, 26 Oct 2017 08:34:43 GMT
Last-Modified: Thu, 26 Oct 2017 08:34:43 GMT
X-Cache: MISS from inf-fw2
X-Cache-Lookup: MISS from inf-fw2:3128
Connection: close

Squid Object Cache: Version 3.5.27-20170916-re69e56c
Build Info: 
Service Name: squid
Start Time:	Thu, 26 Oct 2017 02:09:30 GMT
Current Time:	Thu, 26 Oct 2017 08:34:43 GMT
Connection information for squid:
Number of clients accessing cache:	471
Number of HTTP requests received:	267968
Number of ICP messages received:	0
Number of ICP messages sent:	0
Number of queued ICP replies:	0
Number of HTCP messages received:	0
Number of HTCP messages sent:	0
Request failure ratio:	 0.00
Average HTTP requests per minute since start:	695.6
Average ICP messages per minute since start:	0.0
Select loop called: 10630162 times, 2.174 ms avg
Cache information for squid:
Hits as % of all requests:	5min: 2.3%, 60min: 2.5%
Hits as % of bytes sent:	5min: 10.6%, 60min: -4.4%
Memory hits as % of hit requests:	5min: 22.1%, 60min: 36.5%
Disk hits as % of hit requests:	5min: 4.3%, 60min: 0.3%
Storage Swap size:	29484 KB
Storage Swap capacity:	90.0% used, 10.0% free
Storage Mem size:	28492 KB
Storage Mem capacity:	87.0% used, 13.0% free
Mean Object Size:	22.29 KB
Requests given to unlinkd:	17424
Median Service Times (seconds)  5 min    60 min:
HTTP Requests (All):   2.64709  0.27332
Cache Misses:          1.54242  0.27332
Cache Hits:            0.64968  0.00000
Near Hits:             1.31166  0.22004
Not-Modified Replies:  0.44492  0.00000
DNS Lookups:           0.12472  0.07968
ICP Queries:           0.00000  0.00000
Resource usage for squid:
UP Time:	23113.055 seconds
CPU Time:	1599.750 seconds
CPU Usage:	6.92%
CPU Usage, 5 minute avg:	99.80%
CPU Usage, 60 minute avg:	32.48%
Maximum Resident Size: 987392 KB
Page faults with physical i/o: 0
Memory accounted for:
Total accounted:       148456 KB
memPoolAlloc calls:  87698086
memPoolFree calls:   89179152
File descriptor usage for squid:
Maximum number of file descriptors:   1024
Largest file desc currently in use:    913
Number of file desc currently in use:  791
Files queued for open:                   0
Available number of file descriptors:  233
Reserved number of file descriptors:   100
Store Disk files open:                   0
Internal Data Structures:
1642 StoreEntries
1640 StoreEntries with MemObjects
1375 Hot Object Cache Items
1323 on-disk objects

A little later (still during the "storm"):

HTTP/1.1 200 OK
Server: squid
Mime-Version: 1.0
Date: Thu, 26 Oct 2017 08:40:13 GMT
Content-Type: text/plain;charset=utf-8
Expires: Thu, 26 Oct 2017 08:40:13 GMT
Last-Modified: Thu, 26 Oct 2017 08:40:13 GMT
X-Cache: MISS from inf-fw2
X-Cache-Lookup: MISS from inf-fw2:3128
Connection: close

Squid Object Cache: Version 3.5.27-20170916-re69e56c
Build Info: 
Service Name: squid
Start Time:	Thu, 26 Oct 2017 02:09:30 GMT
Current Time:	Thu, 26 Oct 2017 08:40:13 GMT
Connection information for squid:
Number of clients accessing cache:	472
Number of HTTP requests received:	274183
Number of ICP messages received:	0
Number of ICP messages sent:	0
Number of queued ICP replies:	0
Number of HTCP messages received:	0
Number of HTCP messages sent:	0
Request failure ratio:	 0.00
Average HTTP requests per minute since start:	701.8
Average ICP messages per minute since start:	0.0
Select loop called: 10679512 times, 2.195 ms avg
Cache information for squid:
Hits as % of all requests:	5min: 0.2%, 60min: 2.3%
Hits as % of bytes sent:	5min: -3.2%, 60min: -3.6%
Memory hits as % of hit requests:	5min: 9.1%, 60min: 35.2%
Disk hits as % of hit requests:	5min: 0.0%, 60min: 0.4%
Storage Swap size:	29484 KB
Storage Swap capacity:	90.0% used, 10.0% free
Storage Mem size:	27304 KB
Storage Mem capacity:	83.3% used, 16.7% free
Mean Object Size:	16.25 KB
Requests given to unlinkd:	17424
Median Service Times (seconds)  5 min    60 min:
HTTP Requests (All):   1.05672  0.30459
Cache Misses:          0.94847  0.30459
Cache Hits:            0.00000  0.00000
Near Hits:             0.58309  0.23230
Not-Modified Replies:  0.00000  0.00000
DNS Lookups:           0.11405  0.08334
ICP Queries:           0.00000  0.00000
Resource usage for squid:
UP Time:	23442.516 seconds
CPU Time:	1888.520 seconds
CPU Usage:	8.06%
CPU Usage, 5 minute avg:	86.51%
CPU Usage, 60 minute avg:	39.31%
Maximum Resident Size: 988768 KB
Page faults with physical i/o: 0
Memory accounted for:
Total accounted:       151913 KB
memPoolAlloc calls:  89548742
memPoolFree calls:   91062557
File descriptor usage for squid:
Maximum number of file descriptors:   1024
Largest file desc currently in use:    913
Number of file desc currently in use:  814
Files queued for open:                   0
Available number of file descriptors:  210
Reserved number of file descriptors:   100
Store Disk files open:                   0
Internal Data Structures:
2139 StoreEntries
2135 StoreEntries with MemObjects
1863 Hot Object Cache Items
1814 on-disk objects

Memory info:

TTP/1.1 200 OK
Server: squid
Mime-Version: 1.0
Date: Thu, 26 Oct 2017 08:34:51 GMT
Content-Type: text/plain;charset=utf-8
Expires: Thu, 26 Oct 2017 08:34:51 GMT
Last-Modified: Thu, 26 Oct 2017 08:34:51 GMT
X-Cache: MISS from inf-fw2
X-Cache-Lookup: MISS from inf-fw2:3128
Connection: close

Current memory usage:
Pool	 Obj Size	Chunks							Allocated					In Use					Idle			Allocations Saved			Rate 
(bytes)	KB/ch	 obj/ch	(#)	 used	 free	 part	 %Frag	 (#)	 (KB)	 high (KB)	 high (hrs)	 %Tot	(#)	 (KB)	 high (KB)	 high (hrs)	 %alloc	(#)	 (KB)	 high (KB)	(#)	 %cnt	 %vol	(#)/sec 
64K Buffer          	 65536	 	 	 	 	 	 	 	 1366	 87424	 88064	 0.03	 58.871	 1340	 85760	 88064	 0.03	 98.097	 26	 1664	 5248	 283321	 0.317	 35.761	 21.750
mem_node            	 4136	 	 	 	 	 	 	 	 7326	 29591	 30843	 1.38	 19.926	 7096	 28662	 30843	 1.38	 96.860	 230	 929	 6802	 558119	 0.624	 4.446	 48.467
32K Buffer          	 32768	 	 	 	 	 	 	 	 129	 4128	 5984	 0.77	 2.780	 123	 3936	 5984	 0.77	 95.349	 6	 192	 2272	 49708	 0.056	 3.137	 4.285
ExternalACLEntry    	  256	 	 	 	 	 	 	 	 16447	 4112	 4953	 4.32	 2.769	 16447	 4112	 4953	 4.32	 100.000	 0	 0	 4953	 591	 0.001	 0.000	 5.834
16K Buffer          	 16384	 	 	 	 	 	 	 	 189	 3024	 6992	 4.35	 2.036	 167	 2672	 6992	 4.35	 88.360	 22	 352	 3152	 223171	 0.250	 7.042	 16.461
8K Buffer           	 8192	 	 	 	 	 	 	 	 368	 2944	 3464	 0.17	 1.982	 347	 2776	 3464	 0.17	 94.293	 21	 168	 1112	 288150	 0.322	 4.546	 27.526
Short Strings       	   40	 	 	 	 	 	 	 	 73543	 2873	 3066	 0.57	 1.935	 73511	 2872	 3066	 0.57	 99.956	 32	 2	 867	 50208368	 56.164	 3.868	 3944.297
4K Buffer           	 4096	 	 	 	 	 	 	 	 497	 1988	 2696	 1.51	 1.339	 466	 1864	 2696	 1.51	 93.763	 31	 124	 1012	 397819	 0.445	 3.138	 37.339
HttpHeaderEntry     	   56	 	 	 	 	 	 	 	 30961	 1694	 1862	 0.57	 1.140	 30959	 1694	 1862	 0.57	 99.994	 2	 1	 590	 12908222	 14.439	 1.392	 1001.067
HttpRequest         	 1784	 	 	 	 	 	 	 	 891	 1553	 1631	 0.02	 1.045	 885	 1542	 1631	 0.02	 99.327	 6	 11	 295	 613472	 0.686	 2.108	 52.175
Medium Strings      	  128	 	 	 	 	 	 	 	 6801	 851	 954	 4.33	 0.572	 6644	 831	 954	 4.33	 97.692	 157	 20	 360	 2746616	 3.072	 0.677	 219.037
4KB Strings         	 4096	 	 	 	 	 	 	 	 208	 832	 1168	 1.42	 0.560	 143	 572	 1168	 1.42	 68.750	 65	 260	 444	 262956	 0.294	 2.074	 23.268
HttpReply           	  280	 	 	 	 	 	 	 	 2884	 789	 861	 0.57	 0.531	 2865	 784	 861	 0.57	 99.341	 19	 6	 291	 1030249	 1.152	 0.556	 82.441
2K Buffer           	 2048	 	 	 	 	 	 	 	 374	 748	 1416	 4.32	 0.504	 346	 692	 1416	 4.32	 92.513	 28	 56	 768	 4412257	 4.936	 17.404	 317.415
16KB Strings        	 16384	 	 	 	 	 	 	 	 44	 704	 4400	 1.71	 0.474	 40	 640	 4400	 1.71	 90.909	 4	 64	 2368	 76985	 0.086	 2.429	 7.763
cbdata clientReplyContext (25)	 4352	 	 	 	 	 	 	 	 140	 595	 706	 0.08	 0.401	 122	 519	 706	 0.08	 87.143	 18	 77	 489	 264790	 0.296	 2.219	 23.215
cbdata ClientSocketContext (24)	 4256	 	 	 	 	 	 	 	 140	 582	 690	 0.08	 0.392	 122	 508	 690	 0.08	 87.143	 18	 75	 478	 264789	 0.296	 2.170	 23.215
MemObject           	  328	 	 	 	 	 	 	 	 1682	 539	 794	 4.33	 0.363	 1663	 533	 794	 4.33	 98.870	 19	 7	 339	 255955	 0.286	 0.162	 23.520
Long Strings        	  512	 	 	 	 	 	 	 	 958	 479	 811	 4.35	 0.323	 950	 475	 811	 4.35	 99.165	 8	 4	 369	 677454	 0.758	 0.668	 56.843
Comm::Connection    	  200	 	 	 	 	 	 	 	 1533	 300	 307	 0.28	 0.202	 1495	 292	 307	 0.28	 97.521	 38	 8	 70	 606480	 0.678	 0.234	 65.623
cbdata Server (20)  	  520	 	 	 	 	 	 	 	 549	 279	 304	 0.44	 0.188	 528	 269	 304	 0.44	 96.175	 21	 11	 114	 108934	 0.122	 0.109	 12.423
cbdata BodyPipe (38)	  152	 	 	 	 	 	 	 	 1659	 247	 293	 0.56	 0.166	 1640	 244	 293	 0.56	 98.855	 19	 3	 109	 215397	 0.241	 0.063	 15.348
ClientInfo          	  448	 	 	 	 	 	 	 	 471	 207	 207	 0.09	 0.139	 471	 207	 207	 0.09	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.007
1KB Strings         	 1024	 	 	 	 	 	 	 	 189	 189	 208	 0.29	 0.127	 156	 156	 208	 0.29	 82.540	 33	 33	 107	 134127	 0.150	 0.265	 13.835
cbdata MemBuf (12)  	   64	 	 	 	 	 	 	 	 2999	 188	 201	 0.57	 0.126	 2963	 186	 201	 0.57	 98.800	 36	 3	 67	 1535006	 1.717	 0.189	 123.213
StoreEntry          	  104	 	 	 	 	 	 	 	 1683	 171	 1670	 6.42	 0.115	 1665	 170	 1670	 6.42	 98.930	 18	 2	 1478	 256816	 0.287	 0.051	 23.520
cbdata ModXact (41) 	  512	 	 	 	 	 	 	 	 319	 160	 162	 0.12	 0.107	 308	 154	 162	 0.12	 96.552	 11	 6	 16	 131784	 0.147	 0.130	 10.001
netdbEntry          	  168	 	 	 	 	 	 	 	 970	 160	 165	 1.91	 0.107	 970	 160	 165	 1.91	 100.000	 0	 0	 17	 261	 0.000	 0.000	 0.180
fqdncache_entry     	  160	 	 	 	 	 	 	 	 934	 146	 152	 2.16	 0.098	 926	 145	 152	 2.16	 99.143	 8	 2	 8	 30025	 0.034	 0.009	 2.861
ipcache_entry       	  128	 	 	 	 	 	 	 	 927	 116	 119	 2.19	 0.078	 921	 116	 119	 2.19	 99.353	 6	 1	 5	 16480	 0.018	 0.004	 1.682
MemBlob             	   48	 	 	 	 	 	 	 	 2355	 111	 145	 1.30	 0.074	 2226	 105	 145	 1.30	 94.522	 129	 7	 33	 3054760	 3.417	 0.282	 267.710
HttpHdrCc           	   96	 	 	 	 	 	 	 	 1112	 105	 159	 4.35	 0.070	 1067	 101	 159	 4.35	 95.953	 45	 5	 70	 485419	 0.543	 0.090	 37.649
cbdata idns_query (9)	 8696	 	 	 	 	 	 	 	 12	 102	 391	 2.28	 0.069	 2	 17	 391	 2.28	 16.667	 10	 85	 391	 62918	 0.070	 1.054	 5.848
net_db_name         	   32	 	 	 	 	 	 	 	 2228	 70	 72	 0.16	 0.047	 2228	 70	 72	 0.16	 100.000	 0	 0	 6	 493	 0.001	 0.000	 0.275
cbdata ClientHttpRequest (23)	  392	 	 	 	 	 	 	 	 174	 67	 77	 0.01	 0.045	 152	 59	 77	 0.01	 87.356	 22	 9	 46	 264283	 0.296	 0.200	 23.215
LRU policy node     	   24	 	 	 	 	 	 	 	 2692	 64	 384	 6.42	 0.042	 2666	 63	 384	 6.42	 99.034	 26	 1	 341	 32395	 0.036	 0.001	 4.782
cbdata IdleConnList (18)	 4160	 	 	 	 	 	 	 	 15	 61	 252	 1.97	 0.041	 14	 57	 252	 1.97	 93.333	 1	 5	 200	 13686	 0.015	 0.110	 0.972
cbdata store_client (31)	  160	 	 	 	 	 	 	 	 288	 45	 56	 1.52	 0.030	 278	 44	 56	 1.52	 96.528	 10	 2	 27	 275536	 0.308	 0.085	 24.485
NotePairs::Entry    	   48	 	 	 	 	 	 	 	 927	 44	 46	 2.92	 0.029	 924	 44	 46	 2.92	 99.676	 3	 1	 46	 18571	 0.021	 0.002	 1.796
cbdata clientStreamNode (26)	  128	 	 	 	 	 	 	 	 280	 35	 42	 0.08	 0.024	 244	 31	 42	 0.08	 87.143	 36	 5	 29	 529580	 0.592	 0.131	 46.431
cbdata ServerBump (30)	  104	 	 	 	 	 	 	 	 259	 27	 34	 1.52	 0.018	 240	 25	 34	 1.52	 92.664	 19	 2	 17	 81041	 0.091	 0.016	 9.000
MD5 digest          	   16	 	 	 	 	 	 	 	 1683	 27	 257	 6.42	 0.018	 1665	 27	 257	 6.42	 98.930	 18	 1	 228	 287894	 0.322	 0.009	 26.086
MimeEntry           	  128	 	 	 	 	 	 	 	 177	 23	 23	 6.42	 0.015	 177	 23	 23	 6.42	 100.000	 0	 0	 23	 1062	 0.001	 0.000	 0.063
cbdata HttpStateData (36)	  320	 	 	 	 	 	 	 	 58	 19	 19	 0.07	 0.012	 37	 12	 19	 0.07	 63.793	 21	 7	 15	 133511	 0.149	 0.082	 10.258
cbdata FwdState (32)	  176	 	 	 	 	 	 	 	 101	 18	 18	 0.28	 0.012	 59	 11	 18	 0.28	 58.416	 42	 8	 13	 211946	 0.237	 0.072	 18.843
cbdata helper_server (11)	  240	 	 	 	 	 	 	 	 55	 13	 13	 0.09	 0.009	 55	 13	 13	 0.09	 100.000	 0	 0	 9	 209	 0.000	 0.000	 0.019
cbdata ConnOpener (34)	  136	 	 	 	 	 	 	 	 64	 9	 9	 0.01	 0.006	 4	 1	 9	 0.01	 6.250	 60	 8	 9	 98344	 0.110	 0.026	 10.905
cbdata PeerConnector (35)	  136	 	 	 	 	 	 	 	 61	 9	 9	 0.01	 0.005	 18	 3	 9	 0.01	 29.508	 43	 6	 9	 77220	 0.086	 0.020	 8.531
Acl::AndNode        	  160	 	 	 	 	 	 	 	 44	 7	 7	 6.42	 0.005	 44	 7	 7	 6.42	 100.000	 0	 0	 7	 264	 0.000	 0.000	 0.016
cbdata Iterator (39)	  168	 	 	 	 	 	 	 	 31	 6	 8	 0.77	 0.003	 23	 4	 8	 0.77	 74.194	 8	 2	 6	 131859	 0.148	 0.043	 9.978
cbdata ACLFilledChecklist (22)	  464	 	 	 	 	 	 	 	 11	 5	 11	 2.28	 0.003	 10	 5	 11	 2.28	 90.909	 1	 1	 11	 756320	 0.846	 0.676	 66.886
cbdata ModXactLauncher (40)	  160	 	 	 	 	 	 	 	 30	 5	 8	 0.77	 0.003	 20	 4	 8	 0.77	 66.667	 10	 2	 5	 131871	 0.148	 0.041	 9.978
ACLStrategised      	  160	 	 	 	 	 	 	 	 19	 3	 3	 6.42	 0.002	 19	 3	 3	 6.42	 100.000	 0	 0	 3	 114	 0.000	 0.000	 0.007
cbdata ServiceRep (17)	  344	 	 	 	 	 	 	 	 7	 3	 3	 0.78	 0.002	 7	 3	 3	 0.78	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata Tree (4)     	  216	 	 	 	 	 	 	 	 11	 3	 3	 6.42	 0.002	 11	 3	 3	 6.42	 100.000	 0	 0	 3	 66	 0.000	 0.000	 0.004
cbdata AccessCheck (29)	  152	 	 	 	 	 	 	 	 15	 3	 4	 0.57	 0.001	 0	 0	 4	 0.57	 0.000	 15	 3	 4	 352429	 0.394	 0.103	 29.244
Acl::NotNode        	  160	 	 	 	 	 	 	 	 14	 3	 3	 6.42	 0.001	 14	 3	 3	 6.42	 100.000	 0	 0	 3	 84	 0.000	 0.000	 0.005
acl_ip_data         	   96	 	 	 	 	 	 	 	 19	 2	 2	 6.42	 0.001	 19	 2	 2	 6.42	 100.000	 0	 0	 2	 289	 0.000	 0.000	 0.016
cbdata ClientRequestContext (27)	  104	 	 	 	 	 	 	 	 17	 2	 4	 0.08	 0.001	 11	 2	 4	 0.08	 64.706	 6	 1	 4	 262994	 0.294	 0.053	 22.940
cbdata WriteRequest (47)	   80	 	 	 	 	 	 	 	 20	 2	 6	 4.28	 0.001	 0	 0	 6	 4.28	 0.000	 20	 2	 6	 190311	 0.213	 0.029	 15.692
cbdata UFSStoreState (45)	  176	 	 	 	 	 	 	 	 8	 2	 3	 0.26	 0.001	 0	 0	 3	 0.26	 0.000	 8	 2	 3	 28910	 0.032	 0.010	 2.397
Helper::Request     	   48	 	 	 	 	 	 	 	 28	 2	 2	 0.08	 0.001	 16	 1	 2	 0.08	 57.143	 12	 1	 2	 158681	 0.178	 0.015	 14.377
HttpHdrContRange    	   24	 	 	 	 	 	 	 	 48	 2	 2	 0.18	 0.001	 48	 2	 2	 0.18	 100.000	 0	 0	 1	 410	 0.000	 0.000	 0.036
RegexList           	   88	 	 	 	 	 	 	 	 10	 1	 1	 6.42	 0.001	 10	 1	 1	 6.42	 100.000	 0	 0	 1	 60	 0.000	 0.000	 0.004
cbdata externalAclState (14)	   88	 	 	 	 	 	 	 	 10	 1	 2	 0.28	 0.001	 10	 1	 2	 0.28	 100.000	 0	 0	 2	 81199	 0.091	 0.014	 6.014
ACLSourceIP         	  144	 	 	 	 	 	 	 	 6	 1	 1	 6.42	 0.001	 6	 1	 1	 6.42	 100.000	 0	 0	 1	 36	 0.000	 0.000	 0.002
cbdata DiskdFile (46)	  104	 	 	 	 	 	 	 	 8	 1	 2	 0.26	 0.001	 0	 0	 2	 0.26	 0.000	 8	 1	 2	 28910	 0.032	 0.006	 2.397
ev_entry            	   48	 	 	 	 	 	 	 	 17	 1	 2	 0.24	 0.001	 14	 1	 2	 0.24	 82.353	 3	 1	 1	 63038	 0.071	 0.006	 3.019
ACLStrategised      	  160	 	 	 	 	 	 	 	 5	 1	 1	 6.42	 0.001	 5	 1	 1	 6.42	 100.000	 0	 0	 1	 30	 0.000	 0.000	 0.002
cbdata helper (10)  	  168	 	 	 	 	 	 	 	 3	 1	 1	 0.78	 0.000	 3	 1	 1	 0.78	 100.000	 0	 0	 1	 17	 0.000	 0.000	 0.001
wordlist            	   16	 	 	 	 	 	 	 	 31	 1	 2	 0.78	 0.000	 31	 1	 2	 0.78	 100.000	 0	 0	 1	 837	 0.001	 0.000	 0.064
cbdata CbDataList (2)	   40	 	 	 	 	 	 	 	 12	 1	 1	 6.42	 0.000	 12	 1	 1	 6.42	 100.000	 0	 0	 1	 72	 0.000	 0.000	 0.004
cbdata ErrorState (37)	  240	 	 	 	 	 	 	 	 2	 1	 3	 0.05	 0.000	 0	 0	 3	 0.05	 0.000	 2	 1	 3	 53117	 0.059	 0.025	 4.356
ACLExternal         	  152	 	 	 	 	 	 	 	 3	 1	 1	 6.42	 0.000	 3	 1	 1	 6.42	 100.000	 0	 0	 1	 18	 0.000	 0.000	 0.001
ACLStringData       	   56	 	 	 	 	 	 	 	 8	 1	 1	 6.42	 0.000	 8	 1	 1	 6.42	 100.000	 0	 0	 1	 18	 0.000	 0.000	 0.001
ACLRegexData        	   16	 	 	 	 	 	 	 	 25	 1	 1	 6.42	 0.000	 25	 1	 1	 6.42	 100.000	 0	 0	 1	 54	 0.000	 0.000	 0.003
cbdata CbDataList (1)	   40	 	 	 	 	 	 	 	 10	 1	 1	 6.42	 0.000	 10	 1	 1	 6.42	 100.000	 0	 0	 1	 60	 0.000	 0.000	 0.004
cbdata external_acl (5)	  192	 	 	 	 	 	 	 	 2	 1	 1	 6.42	 0.000	 2	 1	 1	 6.42	 100.000	 0	 0	 1	 12	 0.000	 0.000	 0.001
cbdata generic_cbdata (21)	   32	 	 	 	 	 	 	 	 12	 1	 2	 2.28	 0.000	 1	 1	 2	 2.28	 8.333	 11	 1	 2	 86571	 0.097	 0.005	 7.694
ACLCertificateData  	  120	 	 	 	 	 	 	 	 3	 1	 1	 6.42	 0.000	 3	 1	 1	 6.42	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
acl_name_list       	   72	 	 	 	 	 	 	 	 5	 1	 1	 6.42	 0.000	 5	 1	 1	 6.42	 100.000	 0	 0	 1	 30	 0.000	 0.000	 0.002
cbdata Logfile (15) 	  352	 	 	 	 	 	 	 	 1	 1	 1	 5.76	 0.000	 1	 1	 1	 5.76	 100.000	 0	 0	 1	 6	 0.000	 0.000	 0.001
ACLStrategised      	  160	 	 	 	 	 	 	 	 2	 1	 1	 6.42	 0.000	 2	 1	 1	 6.42	 100.000	 0	 0	 1	 12	 0.000	 0.000	 0.001
cbdata TcpAcceptor (19)	  104	 	 	 	 	 	 	 	 3	 1	 1	 6.42	 0.000	 3	 1	 1	 6.42	 100.000	 0	 0	 1	 18	 0.000	 0.000	 0.001
ACLDestinationIP    	  144	 	 	 	 	 	 	 	 2	 1	 1	 6.42	 0.000	 2	 1	 1	 6.42	 100.000	 0	 0	 1	 12	 0.000	 0.000	 0.001
ACLUserData         	   64	 	 	 	 	 	 	 	 4	 1	 1	 6.42	 0.000	 4	 1	 1	 6.42	 100.000	 0	 0	 1	 6	 0.000	 0.000	 0.000
cbdata ps_state (33)	  256	 	 	 	 	 	 	 	 1	 1	 1	 0.05	 0.000	 0	 0	 1	 0.05	 0.000	 1	 1	 1	 215092	 0.241	 0.106	 18.843
cbdata RemovalPolicy (7)	  104	 	 	 	 	 	 	 	 2	 1	 1	 6.42	 0.000	 2	 1	 1	 6.42	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata statefulhelper (13)	  192	 	 	 	 	 	 	 	 1	 1	 1	 6.42	 0.000	 1	 1	 1	 6.42	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
AclDenyInfoList     	   32	 	 	 	 	 	 	 	 5	 1	 1	 6.42	 0.000	 5	 1	 1	 6.42	 100.000	 0	 0	 1	 30	 0.000	 0.000	 0.002
ACLStrategised      	  160	 	 	 	 	 	 	 	 1	 1	 1	 6.42	 0.000	 1	 1	 1	 6.42	 100.000	 0	 0	 1	 6	 0.000	 0.000	 0.000
ACLProxyAuth        	  152	 	 	 	 	 	 	 	 1	 1	 1	 6.42	 0.000	 1	 1	 1	 6.42	 100.000	 0	 0	 1	 6	 0.000	 0.000	 0.000
ACLDomainData       	   16	 	 	 	 	 	 	 	 9	 1	 1	 6.42	 0.000	 9	 1	 1	 6.42	 100.000	 0	 0	 1	 42	 0.000	 0.000	 0.002
cbdata external_acl_data (6)	   48	 	 	 	 	 	 	 	 3	 1	 1	 6.42	 0.000	 3	 1	 1	 6.42	 100.000	 0	 0	 1	 18	 0.000	 0.000	 0.001
external_acl_format 	   64	 	 	 	 	 	 	 	 2	 1	 1	 6.42	 0.000	 2	 1	 1	 6.42	 100.000	 0	 0	 1	 12	 0.000	 0.000	 0.001
cbdata StoreSearchHashIndex (28)	  104	 	 	 	 	 	 	 	 1	 1	 1	 6.42	 0.000	 1	 1	 1	 6.42	 100.000	 0	 0	 1	 0	 0.000	 0.000	 0.000
ACLHTTPHeaderData   	   48	 	 	 	 	 	 	 	 2	 1	 1	 6.42	 0.000	 2	 1	 1	 6.42	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLSslErrorData     	   16	 	 	 	 	 	 	 	 6	 1	 1	 6.42	 0.000	 6	 1	 1	 6.42	 100.000	 0	 0	 1	 30	 0.000	 0.000	 0.002
cbdata nsvc (8)     	   72	 	 	 	 	 	 	 	 1	 1	 1	 6.42	 0.000	 0	 0	 1	 6.42	 0.000	 1	 1	 1	 75	 0.000	 0.000	 0.009
StoreSwapLogData    	   72	 	 	 	 	 	 	 	 1	 1	 1	 6.42	 0.000	 0	 0	 1	 6.42	 0.000	 1	 1	 1	 89577	 0.100	 0.012	 4.858
cbdata RemovalPurgeWalker (44)	   72	 	 	 	 	 	 	 	 1	 1	 1	 6.42	 0.000	 0	 0	 1	 6.42	 0.000	 1	 1	 1	 1961	 0.002	 0.000	 0.211
cbdata ReadRequest (48)	   72	 	 	 	 	 	 	 	 1	 1	 1	 6.30	 0.000	 0	 0	 1	 6.30	 0.000	 1	 1	 1	 111	 0.000	 0.000	 0.006
cbdata CbDataList (3)	   64	 	 	 	 	 	 	 	 1	 1	 1	 6.42	 0.000	 1	 1	 1	 6.42	 100.000	 0	 0	 1	 6	 0.000	 0.000	 0.000
dwrite_q            	   48	 	 	 	 	 	 	 	 1	 1	 1	 6.42	 0.000	 0	 0	 1	 6.42	 0.000	 1	 1	 1	 89578	 0.100	 0.008	 4.858
FwdServer           	   24	 	 	 	 	 	 	 	 2	 1	 1	 0.05	 0.000	 0	 0	 1	 0.05	 0.000	 2	 1	 1	 318128	 0.356	 0.015	 25.710
ACLNoteData         	   40	 	 	 	 	 	 	 	 1	 1	 1	 6.42	 0.000	 1	 1	 1	 6.42	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
CacheDigest         	   40	 	 	 	 	 	 	 	 1	 1	 1	 6.42	 0.000	 1	 1	 1	 6.42	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLHierCodeData     	   32	 	 	 	 	 	 	 	 1	 1	 1	 6.42	 0.000	 1	 1	 1	 6.42	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLMethodData       	   16	 	 	 	 	 	 	 	 2	 1	 1	 6.42	 0.000	 2	 1	 1	 6.42	 100.000	 0	 0	 1	 6	 0.000	 0.000	 0.000
ACLTimeData         	   32	 	 	 	 	 	 	 	 1	 1	 1	 6.42	 0.000	 1	 1	 1	 6.42	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLAtStepData       	   32	 	 	 	 	 	 	 	 1	 1	 1	 6.42	 0.000	 1	 1	 1	 6.42	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLASN              	   16	 	 	 	 	 	 	 	 2	 1	 1	 6.42	 0.000	 2	 1	 1	 6.42	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
StoreMetaMD5        	   32	 	 	 	 	 	 	 	 1	 1	 1	 6.42	 0.000	 0	 0	 1	 6.42	 0.000	 1	 1	 1	 29043	 0.032	 0.002	 2.398
StoreMetaSTDLFS     	   32	 	 	 	 	 	 	 	 1	 1	 1	 6.42	 0.000	 0	 0	 1	 6.42	 0.000	 1	 1	 1	 29043	 0.032	 0.002	 2.398
StoreMetaURL        	   32	 	 	 	 	 	 	 	 1	 1	 1	 6.42	 0.000	 0	 0	 1	 6.42	 0.000	 1	 1	 1	 29043	 0.032	 0.002	 2.398
StoreMetaObjSize    	   32	 	 	 	 	 	 	 	 1	 1	 1	 6.42	 0.000	 0	 0	 1	 6.42	 0.000	 1	 1	 1	 29043	 0.032	 0.002	 2.398
UFSStoreState::_queued_write	   32	 	 	 	 	 	 	 	 1	 1	 1	 6.42	 0.000	 0	 0	 1	 6.42	 0.000	 1	 1	 1	 193581	 0.217	 0.012	 15.692
StoreMetaVary       	   32	 	 	 	 	 	 	 	 1	 1	 1	 6.42	 0.000	 0	 0	 1	 6.42	 0.000	 1	 1	 1	 7514	 0.008	 0.000	 0.565
ACLProtocolData     	   16	 	 	 	 	 	 	 	 1	 1	 1	 6.42	 0.000	 1	 1	 1	 6.42	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLServerNameData   	   16	 	 	 	 	 	 	 	 1	 1	 1	 6.42	 0.000	 1	 1	 1	 6.42	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
link_list           	   16	 	 	 	 	 	 	 	 1	 1	 1	 6.42	 0.000	 0	 0	 1	 6.42	 0.000	 1	 1	 1	 193581	 0.217	 0.006	 15.692
dlink_node          	   24	 	 	 	 	 	 	 	 0	 0	 1	 1.63	 0.000	 0	 0	 1	 1.63	 -1.000	 0	 0	 1	 0	 0.000	 0.000	 0.001
cbdata RebuildState (16)	  944	 	 	 	 	 	 	 	 0	 0	 1	 6.42	 0.000	 0	 0	 1	 6.42	 -1.000	 0	 0	 1	 0	 0.000	 0.000	 0.000
cbdata OptXactLauncher (42)	  128	 	 	 	 	 	 	 	 0	 0	 1	 6.42	 0.000	 0	 0	 1	 6.42	 -1.000	 0	 0	 1	 1	 0.000	 0.000	 0.000
cbdata OptXact (43) 	  320	 	 	 	 	 	 	 	 0	 0	 1	 6.42	 0.000	 0	 0	 1	 6.42	 -1.000	 0	 0	 1	 1	 0.000	 0.000	 0.000
HttpHdrRange        	   32	 	 	 	 	 	 	 	 0	 0	 1	 1.82	 0.000	 0	 0	 1	 1.82	 -1.000	 0	 0	 1	 314	 0.000	 0.000	 0.020
HttpHdrRangeSpec    	   16	 	 	 	 	 	 	 	 0	 0	 1	 1.82	 0.000	 0	 0	 1	 1.82	 -1.000	 0	 0	 1	 314	 0.000	 0.000	 0.020
cbdata CbDataList (49)	   96	 	 	 	 	 	 	 	 0	 0	 1	 6.21	 0.000	 0	 0	 1	 6.21	 -1.000	 0	 0	 1	 4662	 0.005	 0.001	 1.421
HttpHdrSc           	   16	 	 	 	 	 	 	 	 0	 0	 1	 2.84	 0.000	 0	 0	 1	 2.84	 -1.000	 0	 0	 1	 12	 0.000	 0.000	 0.005
HttpHdrScTarget     	   88	 	 	 	 	 	 	 	 0	 0	 1	 2.84	 0.000	 0	 0	 1	 2.84	 -1.000	 0	 0	 1	 12	 0.000	 0.000	 0.005
cbdata BodySink (50)	   80	 	 	 	 	 	 	 	 0	 0	 1	 2.34	 0.000	 0	 0	 1	 2.34	 -1.000	 0	 0	 1	 0	 0.000	 0.000	 0.000
Auth::Negotiate::User	  184	 	 	 	 	 	 	 	 0	 0	 1	 1.63	 0.000	 0	 0	 1	 1.63	 -1.000	 0	 0	 1	 0	 0.000	 0.000	 0.000
Auth::Negotiate::UserRequest	   88	 	 	 	 	 	 	 	 0	 0	 1	 1.63	 0.000	 0	 0	 1	 1.63	 -1.000	 0	 0	 1	 0	 0.000	 0.000	 0.000
cbdata StateData (51)	   48	 	 	 	 	 	 	 	 0	 0	 1	 1.63	 0.000	 0	 0	 1	 1.63	 -1.000	 0	 0	 1	 0	 0.000	 0.000	 0.000
cbdata helper_stateful_server (52)	  232	 	 	 	 	 	 	 	 0	 0	 1	 1.63	 0.000	 0	 0	 1	 1.63	 -1.000	 0	 0	 1	 0	 0.000	 0.000	 0.000
Total               	    1	 	 	 	 	 	 	 	 170288	 148501	 150273	 0.03	 100.000	 168782	 144272	 146333	 0.03	 97.152	 1506	 4229	 18484	 87746747	 98.156	 98.226	 31638.278
Cumulative allocated volume: 51.921 GB
Current overhead: 43294 bytes (0.029%)
Idle pool limit: 5.00 MB
Total Pools created: 138
Pools ever used:     135 (shown above)
Currently in use:    102
String Pool	 Impact 
(%strings)	 (%volume)
Short Strings       	 90	 47
Medium Strings      	 8	 14
Long Strings        	 1	 8
1KB Strings         	 0	 3
4KB Strings         	 0	 9
16KB Strings        	 0	 11
Other Strings       	 0	 9

Large buffers: 0 (0 KB)

Again, a little later:

HTTP/1.1 200 OK
Server: squid
Mime-Version: 1.0
Date: Thu, 26 Oct 2017 08:39:42 GMT
Content-Type: text/plain;charset=utf-8
Expires: Thu, 26 Oct 2017 08:39:42 GMT
Last-Modified: Thu, 26 Oct 2017 08:39:42 GMT
X-Cache: MISS from inf-fw2
X-Cache-Lookup: MISS from inf-fw2:3128
Connection: close

Current memory usage:
Pool	 Obj Size	Chunks							Allocated					In Use					Idle			Allocations Saved			Rate 
(bytes)	KB/ch	 obj/ch	(#)	 used	 free	 part	 %Frag	 (#)	 (KB)	 high (KB)	 high (hrs)	 %Tot	(#)	 (KB)	 high (KB)	 high (hrs)	 %alloc	(#)	 (KB)	 high (KB)	(#)	 %cnt	 %vol	(#)/sec 
64K Buffer          	 65536	 	 	 	 	 	 	 	 1366	 87424	 89280	 0.01	 59.621	 1364	 87296	 89280	 0.01	 99.854	 2	 128	 5248	 288796	 0.317	 35.771	 19.344
mem_node            	 4136	 	 	 	 	 	 	 	 6798	 27458	 30843	 1.46	 18.725	 6783	 27397	 30843	 1.46	 99.779	 15	 61	 6802	 568521	 0.624	 4.444	 38.660
ExternalACLEntry    	  256	 	 	 	 	 	 	 	 17998	 4500	 4953	 4.40	 3.069	 17998	 4500	 4953	 4.40	 100.000	 0	 0	 4953	 591	 0.001	 0.000	 5.325
32K Buffer          	 32768	 	 	 	 	 	 	 	 136	 4352	 5984	 0.85	 2.968	 134	 4288	 5984	 0.85	 98.529	 2	 64	 2272	 51135	 0.056	 3.167	 5.133
Short Strings       	   40	 	 	 	 	 	 	 	 80835	 3158	 3208	 0.00	 2.153	 80636	 3150	 3208	 0.00	 99.754	 199	 8	 867	 51148695	 56.142	 3.867	 3308.818
16K Buffer          	 16384	 	 	 	 	 	 	 	 169	 2704	 6992	 4.43	 1.844	 169	 2704	 6992	 4.43	 100.000	 0	 0	 3152	 227118	 0.249	 7.033	 13.881
8K Buffer           	 8192	 	 	 	 	 	 	 	 290	 2320	 3464	 0.25	 1.582	 282	 2256	 3464	 0.25	 97.241	 8	 64	 1112	 294270	 0.323	 4.556	 21.610
HttpHeaderEntry     	   56	 	 	 	 	 	 	 	 34149	 1868	 1899	 0.00	 1.274	 34114	 1866	 1899	 0.00	 99.898	 35	 2	 590	 13142150	 14.425	 1.391	 835.378
4K Buffer           	 4096	 	 	 	 	 	 	 	 439	 1756	 2696	 1.59	 1.198	 409	 1636	 2696	 1.59	 93.166	 30	 120	 1012	 406215	 0.446	 3.145	 29.469
HttpRequest         	 1784	 	 	 	 	 	 	 	 873	 1521	 1631	 0.10	 1.037	 859	 1497	 1631	 0.10	 98.396	 14	 25	 295	 625953	 0.687	 2.111	 43.460
2K Buffer           	 2048	 	 	 	 	 	 	 	 539	 1078	 1416	 4.40	 0.735	 535	 1070	 1416	 4.40	 99.258	 4	 8	 768	 4472923	 4.910	 17.313	 209.220
Medium Strings      	  128	 	 	 	 	 	 	 	 7899	 988	 1002	 0.00	 0.673	 7893	 987	 1002	 0.00	 99.924	 6	 1	 360	 2798935	 3.072	 0.677	 186.051
16KB Strings        	 16384	 	 	 	 	 	 	 	 59	 944	 4400	 1.79	 0.644	 54	 864	 4400	 1.79	 91.525	 5	 80	 2368	 78587	 0.086	 2.434	 5.827
HttpReply           	  280	 	 	 	 	 	 	 	 3294	 901	 911	 0.00	 0.614	 3288	 900	 911	 0.00	 99.818	 6	 2	 291	 1049980	 1.152	 0.556	 70.385
MemObject           	  328	 	 	 	 	 	 	 	 2077	 666	 794	 4.41	 0.454	 2071	 664	 794	 4.41	 99.711	 6	 2	 339	 261223	 0.287	 0.162	 20.347
4KB Strings         	 4096	 	 	 	 	 	 	 	 149	 596	 1168	 1.50	 0.406	 142	 568	 1168	 1.50	 95.302	 7	 28	 444	 267713	 0.294	 2.072	 16.635
cbdata clientReplyContext (25)	 4352	 	 	 	 	 	 	 	 118	 502	 706	 0.16	 0.342	 109	 464	 706	 0.16	 92.373	 9	 39	 489	 270088	 0.296	 2.222	 18.736
cbdata ClientSocketContext (24)	 4256	 	 	 	 	 	 	 	 118	 491	 690	 0.16	 0.334	 109	 454	 690	 0.16	 92.373	 9	 38	 478	 270087	 0.296	 2.173	 18.736
Long Strings        	  512	 	 	 	 	 	 	 	 751	 376	 811	 4.43	 0.256	 718	 359	 811	 4.43	 95.606	 33	 17	 369	 692635	 0.760	 0.670	 52.968
Comm::Connection    	  200	 	 	 	 	 	 	 	 1499	 293	 307	 0.36	 0.200	 1464	 286	 307	 0.36	 97.665	 35	 7	 70	 623501	 0.684	 0.236	 59.278
cbdata Server (20)  	  520	 	 	 	 	 	 	 	 563	 286	 304	 0.52	 0.195	 542	 276	 304	 0.52	 96.270	 21	 11	 114	 111986	 0.123	 0.110	 10.935
cbdata BodyPipe (38)	  152	 	 	 	 	 	 	 	 1798	 267	 293	 0.64	 0.182	 1796	 267	 293	 0.64	 99.889	 2	 1	 109	 219412	 0.241	 0.063	 15.090
cbdata MemBuf (12)  	   64	 	 	 	 	 	 	 	 3382	 212	 215	 0.00	 0.144	 3377	 212	 215	 0.00	 99.852	 5	 1	 67	 1564605	 1.717	 0.189	 104.318
StoreEntry          	  104	 	 	 	 	 	 	 	 2081	 212	 1670	 6.50	 0.144	 2075	 211	 1670	 6.50	 99.712	 6	 1	 1478	 262085	 0.288	 0.052	 20.347
ClientInfo          	  448	 	 	 	 	 	 	 	 472	 207	 207	 0.02	 0.141	 472	 207	 207	 0.02	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.003
cbdata ModXact (41) 	  512	 	 	 	 	 	 	 	 309	 155	 164	 0.07	 0.105	 308	 154	 164	 0.07	 99.676	 1	 1	 16	 134215	 0.147	 0.130	 8.549
netdbEntry          	  168	 	 	 	 	 	 	 	 925	 152	 165	 1.99	 0.103	 925	 152	 165	 1.99	 100.000	 0	 0	 17	 286	 0.000	 0.000	 0.196
fqdncache_entry     	  160	 	 	 	 	 	 	 	 931	 146	 152	 2.24	 0.099	 920	 144	 152	 2.24	 98.818	 11	 2	 8	 30868	 0.034	 0.009	 3.083
cbdata idns_query (9)	 8696	 	 	 	 	 	 	 	 16	 136	 391	 2.36	 0.093	 0	 0	 391	 2.36	 0.000	 16	 136	 391	 64579	 0.071	 1.061	 5.881
ipcache_entry       	  128	 	 	 	 	 	 	 	 923	 116	 119	 2.28	 0.079	 923	 116	 119	 2.28	 100.000	 0	 0	 5	 16903	 0.019	 0.004	 1.528
MemBlob             	   48	 	 	 	 	 	 	 	 2438	 115	 145	 1.38	 0.078	 2304	 108	 145	 1.38	 94.504	 134	 7	 33	 3118212	 3.423	 0.283	 223.259
HttpHdrCc           	   96	 	 	 	 	 	 	 	 1159	 109	 159	 4.43	 0.074	 1158	 109	 159	 4.43	 99.914	 1	 1	 70	 493512	 0.542	 0.090	 28.676
1KB Strings         	 1024	 	 	 	 	 	 	 	 101	 101	 208	 0.37	 0.069	 97	 97	 208	 0.37	 96.040	 4	 4	 107	 137459	 0.151	 0.266	 11.691
LRU policy node     	   24	 	 	 	 	 	 	 	 3530	 83	 384	 6.50	 0.056	 3530	 83	 384	 6.50	 100.000	 0	 0	 341	 33829	 0.037	 0.002	 9.150
net_db_name         	   32	 	 	 	 	 	 	 	 2187	 69	 72	 0.24	 0.047	 2187	 69	 72	 0.24	 100.000	 0	 0	 6	 540	 0.001	 0.000	 0.336
cbdata ClientHttpRequest (23)	  392	 	 	 	 	 	 	 	 144	 56	 77	 0.10	 0.038	 131	 51	 77	 0.10	 90.972	 13	 5	 46	 269589	 0.296	 0.200	 18.736
cbdata IdleConnList (18)	 4160	 	 	 	 	 	 	 	 12	 49	 252	 2.05	 0.033	 11	 45	 252	 2.05	 91.667	 1	 5	 200	 13861	 0.015	 0.109	 0.663
NotePairs::Entry    	   48	 	 	 	 	 	 	 	 995	 47	 47	 0.00	 0.032	 992	 47	 47	 0.00	 99.698	 3	 1	 46	 18882	 0.021	 0.002	 1.346
cbdata store_client (31)	  160	 	 	 	 	 	 	 	 263	 42	 56	 1.60	 0.028	 256	 40	 56	 1.60	 97.338	 7	 2	 27	 281020	 0.308	 0.085	 19.251
MD5 digest          	   16	 	 	 	 	 	 	 	 2081	 33	 257	 6.50	 0.022	 2075	 33	 257	 6.50	 99.712	 6	 1	 228	 294523	 0.323	 0.009	 25.016
cbdata clientStreamNode (26)	  128	 	 	 	 	 	 	 	 236	 30	 42	 0.16	 0.020	 218	 28	 42	 0.16	 92.373	 18	 3	 29	 540176	 0.593	 0.131	 37.472
cbdata ServerBump (30)	  104	 	 	 	 	 	 	 	 234	 24	 34	 1.60	 0.016	 219	 23	 34	 1.60	 93.590	 15	 2	 17	 83160	 0.091	 0.016	 7.626
MimeEntry           	  128	 	 	 	 	 	 	 	 177	 23	 23	 6.50	 0.015	 177	 23	 23	 6.50	 100.000	 0	 0	 23	 1062	 0.001	 0.000	 0.000
cbdata helper_server (11)	  240	 	 	 	 	 	 	 	 55	 13	 13	 0.17	 0.009	 55	 13	 13	 0.17	 100.000	 0	 0	 9	 209	 0.000	 0.000	 0.000
cbdata HttpStateData (36)	  320	 	 	 	 	 	 	 	 32	 10	 19	 0.15	 0.007	 32	 10	 19	 0.15	 100.000	 0	 0	 15	 135965	 0.149	 0.082	 8.642
cbdata FwdState (32)	  176	 	 	 	 	 	 	 	 56	 10	 19	 0.08	 0.007	 43	 8	 19	 0.08	 76.786	 13	 3	 14	 216432	 0.238	 0.072	 15.828
Acl::AndNode        	  160	 	 	 	 	 	 	 	 44	 7	 7	 6.50	 0.005	 44	 7	 7	 6.50	 100.000	 0	 0	 7	 264	 0.000	 0.000	 0.000
cbdata ACLFilledChecklist (22)	  464	 	 	 	 	 	 	 	 10	 5	 11	 2.36	 0.003	 1	 1	 11	 2.36	 10.000	 9	 5	 11	 772759	 0.848	 0.678	 56.648
ACLStrategised      	  160	 	 	 	 	 	 	 	 19	 3	 3	 6.50	 0.002	 19	 3	 3	 6.50	 100.000	 0	 0	 3	 114	 0.000	 0.000	 0.000
cbdata PeerConnector (35)	  136	 	 	 	 	 	 	 	 22	 3	 9	 0.08	 0.002	 10	 2	 9	 0.08	 45.455	 12	 2	 9	 79214	 0.087	 0.020	 7.172
cbdata Iterator (39)	  168	 	 	 	 	 	 	 	 15	 3	 8	 0.85	 0.002	 15	 3	 8	 0.85	 100.000	 0	 0	 6	 134291	 0.147	 0.043	 8.549
cbdata ServiceRep (17)	  344	 	 	 	 	 	 	 	 7	 3	 3	 0.86	 0.002	 7	 3	 3	 0.86	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata ModXactLauncher (40)	  160	 	 	 	 	 	 	 	 15	 3	 8	 0.85	 0.002	 14	 3	 8	 0.85	 93.333	 1	 1	 5	 134308	 0.147	 0.041	 8.549
cbdata Tree (4)     	  216	 	 	 	 	 	 	 	 11	 3	 3	 6.50	 0.002	 11	 3	 3	 6.50	 100.000	 0	 0	 3	 66	 0.000	 0.000	 0.000
Acl::NotNode        	  160	 	 	 	 	 	 	 	 14	 3	 3	 6.50	 0.001	 14	 3	 3	 6.50	 100.000	 0	 0	 3	 84	 0.000	 0.000	 0.000
acl_ip_data         	   96	 	 	 	 	 	 	 	 19	 2	 2	 6.50	 0.001	 19	 2	 2	 6.50	 100.000	 0	 0	 2	 289	 0.000	 0.000	 0.000
cbdata ConnOpener (34)	  136	 	 	 	 	 	 	 	 11	 2	 10	 0.08	 0.001	 1	 1	 10	 0.08	 9.091	 10	 2	 10	 101038	 0.111	 0.026	 9.638
cbdata ClientRequestContext (27)	  104	 	 	 	 	 	 	 	 12	 2	 4	 0.16	 0.001	 1	 1	 4	 0.16	 8.333	 11	 2	 4	 268308	 0.294	 0.053	 18.499
HttpHdrContRange    	   24	 	 	 	 	 	 	 	 48	 2	 2	 0.27	 0.001	 48	 2	 2	 0.27	 100.000	 0	 0	 1	 410	 0.000	 0.000	 0.000
cbdata AccessCheck (29)	  152	 	 	 	 	 	 	 	 7	 2	 4	 0.65	 0.001	 0	 0	 4	 0.65	 0.000	 7	 2	 4	 359554	 0.395	 0.103	 24.631
RegexList           	   88	 	 	 	 	 	 	 	 10	 1	 1	 6.50	 0.001	 10	 1	 1	 6.50	 100.000	 0	 0	 1	 60	 0.000	 0.000	 0.000
ACLSourceIP         	  144	 	 	 	 	 	 	 	 6	 1	 1	 6.50	 0.001	 6	 1	 1	 6.50	 100.000	 0	 0	 1	 36	 0.000	 0.000	 0.000
Helper::Request     	   48	 	 	 	 	 	 	 	 17	 1	 2	 0.17	 0.001	 4	 1	 2	 0.17	 23.529	 13	 1	 2	 162246	 0.178	 0.015	 12.498
ACLStrategised      	  160	 	 	 	 	 	 	 	 5	 1	 1	 6.50	 0.001	 5	 1	 1	 6.50	 100.000	 0	 0	 1	 30	 0.000	 0.000	 0.000
cbdata WriteRequest (47)	   80	 	 	 	 	 	 	 	 10	 1	 6	 4.36	 0.001	 0	 0	 6	 4.36	 0.000	 10	 1	 6	 196846	 0.216	 0.030	 23.134
cbdata UFSStoreState (45)	  176	 	 	 	 	 	 	 	 4	 1	 3	 0.34	 0.000	 4	 1	 3	 0.34	 100.000	 0	 0	 3	 30203	 0.033	 0.010	 4.587
ev_entry            	   48	 	 	 	 	 	 	 	 14	 1	 2	 0.32	 0.000	 14	 1	 2	 0.32	 100.000	 0	 0	 1	 63810	 0.070	 0.006	 2.712
cbdata externalAclState (14)	   88	 	 	 	 	 	 	 	 7	 1	 2	 0.08	 0.000	 1	 1	 2	 0.08	 14.286	 6	 1	 2	 82716	 0.091	 0.014	 5.373
cbdata generic_cbdata (21)	   32	 	 	 	 	 	 	 	 16	 1	 2	 2.36	 0.000	 4	 1	 2	 2.36	 25.000	 12	 1	 2	 89441	 0.098	 0.005	 10.084
cbdata helper (10)  	  168	 	 	 	 	 	 	 	 3	 1	 1	 0.86	 0.000	 3	 1	 1	 0.86	 100.000	 0	 0	 1	 17	 0.000	 0.000	 0.000
wordlist            	   16	 	 	 	 	 	 	 	 31	 1	 2	 0.86	 0.000	 31	 1	 2	 0.86	 100.000	 0	 0	 1	 837	 0.001	 0.000	 0.000
cbdata CbDataList (2)	   40	 	 	 	 	 	 	 	 12	 1	 1	 6.50	 0.000	 12	 1	 1	 6.50	 100.000	 0	 0	 1	 72	 0.000	 0.000	 0.000
ACLExternal         	  152	 	 	 	 	 	 	 	 3	 1	 1	 6.50	 0.000	 3	 1	 1	 6.50	 100.000	 0	 0	 1	 18	 0.000	 0.000	 0.000
ACLStringData       	   56	 	 	 	 	 	 	 	 8	 1	 1	 6.50	 0.000	 8	 1	 1	 6.50	 100.000	 0	 0	 1	 18	 0.000	 0.000	 0.000
cbdata DiskdFile (46)	  104	 	 	 	 	 	 	 	 4	 1	 2	 0.34	 0.000	 4	 1	 2	 0.34	 100.000	 0	 0	 2	 30203	 0.033	 0.006	 4.587
ACLRegexData        	   16	 	 	 	 	 	 	 	 25	 1	 1	 6.50	 0.000	 25	 1	 1	 6.50	 100.000	 0	 0	 1	 54	 0.000	 0.000	 0.000
cbdata CbDataList (1)	   40	 	 	 	 	 	 	 	 10	 1	 1	 6.50	 0.000	 10	 1	 1	 6.50	 100.000	 0	 0	 1	 60	 0.000	 0.000	 0.000
cbdata external_acl (5)	  192	 	 	 	 	 	 	 	 2	 1	 1	 6.50	 0.000	 2	 1	 1	 6.50	 100.000	 0	 0	 1	 12	 0.000	 0.000	 0.000
ACLCertificateData  	  120	 	 	 	 	 	 	 	 3	 1	 1	 6.50	 0.000	 3	 1	 1	 6.50	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
acl_name_list       	   72	 	 	 	 	 	 	 	 5	 1	 1	 6.50	 0.000	 5	 1	 1	 6.50	 100.000	 0	 0	 1	 30	 0.000	 0.000	 0.000
cbdata Logfile (15) 	  352	 	 	 	 	 	 	 	 1	 1	 1	 5.84	 0.000	 1	 1	 1	 5.84	 100.000	 0	 0	 1	 6	 0.000	 0.000	 0.003
ACLStrategised      	  160	 	 	 	 	 	 	 	 2	 1	 1	 6.50	 0.000	 2	 1	 1	 6.50	 100.000	 0	 0	 1	 12	 0.000	 0.000	 0.000
cbdata TcpAcceptor (19)	  104	 	 	 	 	 	 	 	 3	 1	 1	 6.50	 0.000	 3	 1	 1	 6.50	 100.000	 0	 0	 1	 18	 0.000	 0.000	 0.000
ACLDestinationIP    	  144	 	 	 	 	 	 	 	 2	 1	 1	 6.50	 0.000	 2	 1	 1	 6.50	 100.000	 0	 0	 1	 12	 0.000	 0.000	 0.000
ACLUserData         	   64	 	 	 	 	 	 	 	 4	 1	 1	 6.50	 0.000	 4	 1	 1	 6.50	 100.000	 0	 0	 1	 6	 0.000	 0.000	 0.000
cbdata ps_state (33)	  256	 	 	 	 	 	 	 	 1	 1	 1	 0.13	 0.000	 0	 0	 1	 0.13	 0.000	 1	 1	 1	 219697	 0.241	 0.106	 15.828
cbdata ErrorState (37)	  240	 	 	 	 	 	 	 	 1	 1	 3	 0.13	 0.000	 0	 0	 3	 0.13	 0.000	 1	 1	 3	 53986	 0.059	 0.024	 3.008
cbdata RemovalPolicy (7)	  104	 	 	 	 	 	 	 	 2	 1	 1	 6.50	 0.000	 2	 1	 1	 6.50	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata statefulhelper (13)	  192	 	 	 	 	 	 	 	 1	 1	 1	 6.50	 0.000	 1	 1	 1	 6.50	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
AclDenyInfoList     	   32	 	 	 	 	 	 	 	 5	 1	 1	 6.50	 0.000	 5	 1	 1	 6.50	 100.000	 0	 0	 1	 30	 0.000	 0.000	 0.000
ACLStrategised      	  160	 	 	 	 	 	 	 	 1	 1	 1	 6.50	 0.000	 1	 1	 1	 6.50	 100.000	 0	 0	 1	 6	 0.000	 0.000	 0.000
ACLProxyAuth        	  152	 	 	 	 	 	 	 	 1	 1	 1	 6.50	 0.000	 1	 1	 1	 6.50	 100.000	 0	 0	 1	 6	 0.000	 0.000	 0.000
ACLDomainData       	   16	 	 	 	 	 	 	 	 9	 1	 1	 6.50	 0.000	 9	 1	 1	 6.50	 100.000	 0	 0	 1	 42	 0.000	 0.000	 0.000
cbdata external_acl_data (6)	   48	 	 	 	 	 	 	 	 3	 1	 1	 6.50	 0.000	 3	 1	 1	 6.50	 100.000	 0	 0	 1	 18	 0.000	 0.000	 0.000
external_acl_format 	   64	 	 	 	 	 	 	 	 2	 1	 1	 6.50	 0.000	 2	 1	 1	 6.50	 100.000	 0	 0	 1	 12	 0.000	 0.000	 0.000
cbdata StoreSearchHashIndex (28)	  104	 	 	 	 	 	 	 	 1	 1	 1	 6.50	 0.000	 1	 1	 1	 6.50	 100.000	 0	 0	 1	 0	 0.000	 0.000	 0.000
ACLHTTPHeaderData   	   48	 	 	 	 	 	 	 	 2	 1	 1	 6.50	 0.000	 2	 1	 1	 6.50	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLSslErrorData     	   16	 	 	 	 	 	 	 	 6	 1	 1	 6.50	 0.000	 6	 1	 1	 6.50	 100.000	 0	 0	 1	 30	 0.000	 0.000	 0.000
cbdata CbDataList (3)	   64	 	 	 	 	 	 	 	 1	 1	 1	 6.50	 0.000	 1	 1	 1	 6.50	 100.000	 0	 0	 1	 6	 0.000	 0.000	 0.000
FwdServer           	   24	 	 	 	 	 	 	 	 2	 1	 1	 0.13	 0.000	 0	 0	 1	 0.13	 0.000	 2	 1	 1	 324323	 0.356	 0.015	 21.304
ACLNoteData         	   40	 	 	 	 	 	 	 	 1	 1	 1	 6.50	 0.000	 1	 1	 1	 6.50	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
CacheDigest         	   40	 	 	 	 	 	 	 	 1	 1	 1	 6.50	 0.000	 1	 1	 1	 6.50	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLHierCodeData     	   32	 	 	 	 	 	 	 	 1	 1	 1	 6.50	 0.000	 1	 1	 1	 6.50	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLMethodData       	   16	 	 	 	 	 	 	 	 2	 1	 1	 6.50	 0.000	 2	 1	 1	 6.50	 100.000	 0	 0	 1	 6	 0.000	 0.000	 0.000
ACLTimeData         	   32	 	 	 	 	 	 	 	 1	 1	 1	 6.50	 0.000	 1	 1	 1	 6.50	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLAtStepData       	   32	 	 	 	 	 	 	 	 1	 1	 1	 6.50	 0.000	 1	 1	 1	 6.50	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLASN              	   16	 	 	 	 	 	 	 	 2	 1	 1	 6.50	 0.000	 2	 1	 1	 6.50	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
StoreMetaMD5        	   32	 	 	 	 	 	 	 	 1	 1	 1	 6.50	 0.000	 0	 0	 1	 6.50	 0.000	 1	 1	 1	 30374	 0.033	 0.002	 4.587
StoreMetaSTDLFS     	   32	 	 	 	 	 	 	 	 1	 1	 1	 6.50	 0.000	 0	 0	 1	 6.50	 0.000	 1	 1	 1	 30374	 0.033	 0.002	 4.587
StoreMetaURL        	   32	 	 	 	 	 	 	 	 1	 1	 1	 6.50	 0.000	 0	 0	 1	 6.50	 0.000	 1	 1	 1	 30374	 0.033	 0.002	 4.587
StoreMetaObjSize    	   32	 	 	 	 	 	 	 	 1	 1	 1	 6.50	 0.000	 0	 0	 1	 6.50	 0.000	 1	 1	 1	 30374	 0.033	 0.002	 4.587
UFSStoreState::_queued_write	   32	 	 	 	 	 	 	 	 1	 1	 1	 6.50	 0.000	 0	 0	 1	 6.50	 0.000	 1	 1	 1	 200314	 0.220	 0.012	 23.134
StoreMetaVary       	   32	 	 	 	 	 	 	 	 1	 1	 1	 6.50	 0.000	 0	 0	 1	 6.50	 0.000	 1	 1	 1	 7963	 0.009	 0.000	 1.559
ACLProtocolData     	   16	 	 	 	 	 	 	 	 1	 1	 1	 6.50	 0.000	 1	 1	 1	 6.50	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLServerNameData   	   16	 	 	 	 	 	 	 	 1	 1	 1	 6.50	 0.000	 1	 1	 1	 6.50	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
link_list           	   16	 	 	 	 	 	 	 	 1	 1	 1	 6.50	 0.000	 0	 0	 1	 6.50	 0.000	 1	 1	 1	 200314	 0.220	 0.006	 23.134
dlink_node          	   24	 	 	 	 	 	 	 	 0	 0	 1	 1.71	 0.000	 0	 0	 1	 1.71	 -1.000	 0	 0	 1	 0	 0.000	 0.000	 0.000
dwrite_q            	   48	 	 	 	 	 	 	 	 0	 0	 1	 6.50	 0.000	 0	 0	 1	 6.50	 -1.000	 0	 0	 1	 91807	 0.101	 0.008	 7.667
cbdata nsvc (8)     	   72	 	 	 	 	 	 	 	 0	 0	 1	 6.50	 0.000	 0	 0	 1	 6.50	 -1.000	 0	 0	 1	 75	 0.000	 0.000	 0.003
cbdata RebuildState (16)	  944	 	 	 	 	 	 	 	 0	 0	 1	 6.50	 0.000	 0	 0	 1	 6.50	 -1.000	 0	 0	 1	 0	 0.000	 0.000	 0.000
StoreSwapLogData    	   72	 	 	 	 	 	 	 	 0	 0	 1	 6.50	 0.000	 0	 0	 1	 6.50	 -1.000	 0	 0	 1	 91806	 0.101	 0.012	 7.667
cbdata OptXactLauncher (42)	  128	 	 	 	 	 	 	 	 0	 0	 1	 6.50	 0.000	 0	 0	 1	 6.50	 -1.000	 0	 0	 1	 1	 0.000	 0.000	 0.000
cbdata OptXact (43) 	  320	 	 	 	 	 	 	 	 0	 0	 1	 6.50	 0.000	 0	 0	 1	 6.50	 -1.000	 0	 0	 1	 1	 0.000	 0.000	 0.000
cbdata RemovalPurgeWalker (44)	   72	 	 	 	 	 	 	 	 0	 0	 1	 6.50	 0.000	 0	 0	 1	 6.50	 -1.000	 0	 0	 1	 2048	 0.002	 0.000	 0.312
cbdata ReadRequest (48)	   72	 	 	 	 	 	 	 	 0	 0	 1	 6.38	 0.000	 0	 0	 1	 6.38	 -1.000	 0	 0	 1	 111	 0.000	 0.000	 0.000
HttpHdrRange        	   32	 	 	 	 	 	 	 	 0	 0	 1	 1.90	 0.000	 0	 0	 1	 1.90	 -1.000	 0	 0	 1	 314	 0.000	 0.000	 0.000
HttpHdrRangeSpec    	   16	 	 	 	 	 	 	 	 0	 0	 1	 1.90	 0.000	 0	 0	 1	 1.90	 -1.000	 0	 0	 1	 314	 0.000	 0.000	 0.000
cbdata CbDataList (49)	   96	 	 	 	 	 	 	 	 0	 0	 1	 6.29	 0.000	 0	 0	 1	 6.29	 -1.000	 0	 0	 1	 4662	 0.005	 0.001	 0.000
HttpHdrSc           	   16	 	 	 	 	 	 	 	 0	 0	 1	 2.92	 0.000	 0	 0	 1	 2.92	 -1.000	 0	 0	 1	 12	 0.000	 0.000	 0.000
HttpHdrScTarget     	   88	 	 	 	 	 	 	 	 0	 0	 1	 2.92	 0.000	 0	 0	 1	 2.92	 -1.000	 0	 0	 1	 12	 0.000	 0.000	 0.000
cbdata BodySink (50)	   80	 	 	 	 	 	 	 	 0	 0	 1	 2.42	 0.000	 0	 0	 1	 2.42	 -1.000	 0	 0	 1	 0	 0.000	 0.000	 0.000
Auth::Negotiate::User	  184	 	 	 	 	 	 	 	 0	 0	 1	 1.71	 0.000	 0	 0	 1	 1.71	 -1.000	 0	 0	 1	 0	 0.000	 0.000	 0.000
Auth::Negotiate::UserRequest	   88	 	 	 	 	 	 	 	 0	 0	 1	 1.71	 0.000	 0	 0	 1	 1.71	 -1.000	 0	 0	 1	 0	 0.000	 0.000	 0.000
cbdata StateData (51)	   48	 	 	 	 	 	 	 	 0	 0	 1	 1.71	 0.000	 0	 0	 1	 1.71	 -1.000	 0	 0	 1	 0	 0.000	 0.000	 0.000
cbdata helper_stateful_server (52)	  232	 	 	 	 	 	 	 	 0	 0	 1	 1.71	 0.000	 0	 0	 1	 1.71	 -1.000	 0	 0	 1	 0	 0.000	 0.000	 0.000
Total               	    1	 	 	 	 	 	 	 	 185173	 146634	 151763	 0.00	 100.000	 184369	 145755	 146812	 0.00	 99.401	 804	 880	 18484	 89409360	 98.137	 98.206	 312807.853
Cumulative allocated volume: 52.910 GB
Current overhead: 43294 bytes (0.029%)
Idle pool limit: 5.00 MB
Total Pools created: 138
Pools ever used:     135 (shown above)
Currently in use:    103
String Pool	 Impact 
(%strings)	 (%volume)
Short Strings       	 90	 48
Medium Strings      	 9	 15
Long Strings        	 1	 5
1KB Strings         	 0	 1
4KB Strings         	 0	 9
16KB Strings        	 0	 13
Other Strings       	 0	 8

Large buffers: 0 (0 KB)

Finally, storedir:

Store Directory Statistics:
Store Entries          : 1673
Maximum Swap Size      : 32768 KB
Current Store Swap Size: 29484.00 KB
Current Capacity       : 89.98% used, 10.02% free

Store Directory #0 (diskd): /var/cache/squid
FS Block Size 4096 Bytes
First level subdirectories: 16
Second level subdirectories: 256
Maximum Size: 32768 KB
Current Size: 29484.00 KB
Percent Used: 89.98%
Filemap bits in use: 1338 of 16384 (8%)
Filesystem Space in use: 44360368/192108884 KB (23%)
Filesystem Inodes in use: 454196/12271616 (4%)
Flags: SELECTED
Pending operations: 0
Removal policy: lru
LRU reference age: 0.01 days

# free --bytes
total        used        free      shared  buff/cache   available
Mem:    33653817344  3982090240   929779712   162263040 28741947392 29162274816
Swap:   37925875712   173297664 37752578048

I read Alex's e-mail too late, so I'll try to attach gdb next time.
The problem is that Squid continues to respond, but slowly.
Having a backup Squid is not that simple in my scenario because I require to do content analysis on ssl-bumped traffic. I'm using TPROXY on the gateway/firewall with Squid. A true backup on this production system would mean having a full conntrackd'ed firewall with Squid as I cannot TPROXY on a redirected machine.
I know Squid 4 is recommended for SSL-Bump, but it's still beta, and I'm not sure I can take that leap now.

I didn't run mgr:events while the CPU was at 100%, but here's what came up afterwards:

# squidclient mgr:events
HTTP/1.1 200 OK
Server: squid
Mime-Version: 1.0
Date: Thu, 26 Oct 2017 11:02:42 GMT
Content-Type: text/plain;charset=utf-8
Expires: Thu, 26 Oct 2017 11:02:42 GMT
Last-Modified: Thu, 26 Oct 2017 11:02:42 GMT
X-Cache: MISS from inf-fw2
X-Cache-Lookup: MISS from inf-fw2:3128
Connection: close

Last event to run: MaintainSwapSpace

Operation                       Next Execution  Weight  Callback Valid?
logfileFlush                    0.511 sec           1    yes
MaintainSwapSpace               0.511 sec           1    N/A
fqdncache_purgelru              1.481 sec           1    N/A
idnsCheckQueue                  2.507 sec           1    N/A
statAvgTick                     3.821 sec           1    N/A
storeDirClean                   5.484 sec           1    N/A
memPoolCleanIdlePools           5.484 sec           1    N/A
ipcache_purgelru                6.900 sec           1    N/A
peerRefreshDNS                  348.872 sec         1    N/A
netdbSaveState                  678.327 sec         1    N/A
Adaptation::Icap::ServiceRep::noteTimeToUpdate  3243.778 sec        0    yes
User Cache Maintenance          3302.980 sec        1    N/A
storeDigestRebuildStart         3303.451 sec        1    N/A
storeDigestRewriteStart         3303.451 sec        1    N/A

# squidclient mgr:events
HTTP/1.1 200 OK
Server: squid
Mime-Version: 1.0
Date: Thu, 26 Oct 2017 11:08:04 GMT
Content-Type: text/plain;charset=utf-8
Expires: Thu, 26 Oct 2017 11:08:04 GMT
Last-Modified: Thu, 26 Oct 2017 11:08:04 GMT
X-Cache: MISS from inf-fw2
X-Cache-Lookup: MISS from inf-fw2:3128
Connection: close

Last event to run: fqdncache_purgelru

Operation                       Next Execution  Weight  Callback Valid?
logfileFlush                    0.141 sec           1    yes
MaintainSwapSpace               0.141 sec           1    N/A
idnsCheckQueue                  3.212 sec           1    N/A
ipcache_purgelru                5.393 sec           1    N/A
fqdncache_purgelru              9.962 sec           1    N/A
storeDirClean                   13.942 sec          1    N/A
memPoolCleanIdlePools           13.942 sec          1    N/A
peerRefreshDNS                  27.243 sec          1    N/A
statAvgTick                     42.223 sec          1    N/A
netdbSaveState                  356.698 sec         1    N/A
Adaptation::Icap::ServiceRep::noteTimeToUpdate  2922.149 sec        0    yes
User Cache Maintenance          2981.351 sec        1    N/A
storeDigestRebuildStart         2981.822 sec        1    N/A
storeDigestRewriteStart         2981.822 sec        1    N/A

I haven't been able to associate the 100% CPU issue with a scheduled event.
I'll keep looking.

Thanks,

Vieri


From rousskov at measurement-factory.com  Thu Oct 26 15:55:05 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 26 Oct 2017 09:55:05 -0600
Subject: [squid-users] squid cpu usage
In-Reply-To: <790628251.3784841.1509016514244@mail.yahoo.com>
References: <742455879.1992418.1508848440399.ref@mail.yahoo.com>
 <742455879.1992418.1508848440399@mail.yahoo.com>
 <efb11c97-0368-a8ff-c1be-9781ac450026@measurement-factory.com>
 <790628251.3784841.1509016514244@mail.yahoo.com>
Message-ID: <5f672c1b-ce28-35f3-df09-982e9c76c9cc@measurement-factory.com>

On 10/26/2017 05:15 AM, Vieri wrote:

> Here's the strace (compressed with gz):
> Do you see anything useful in the trace?

FWIW, nothing jumped at me. As you know, I was asking for a gdb
backtrace, but I no longer think that it is likely to help at this
stage: Your further comments and strace itself confirm that Squid is
_not_ stuck in some tight loop, consuming 100% of CPU. It may be
consuming a lot of CPU cycles, but it is not doing the same compact
operation over and over again, so random gdb backtraces are unlikely to
pinpoint the culprit (if there is one).


> If not, how can I improve the trace next time I have this issue?

Please add (relative) timestamps between system calls (strace -r). It
may help detect periods of time when Squid was not making any system
calls. If possible, I would also add time spend in each system call
(strace -T), just in case, but it is unlikely to be useful in this case.

Please also report how many request did Squid finished handling during
the traced period. You can run mgr:info before/after and/or count
access.log lines.

For mgr:info snapshots, please consider doing the legwork to identify
potentially relevant entries that have changed between the snapshots. I
do not have time to do that (but others on the list might, of course).

I would not bother with mgr:mem snapshots unless mgr:info shows that the
memory has grown a lot during the 100% CPU usage.

Finally, consider enabling Squid debugging for a few seconds of that
100% CPU usage period. Wiki has instructions revolving around sending
Squid a debug signal.


> Having a backup Squid is not that simple in my scenario

It rarely is!


> I didn't run mgr:events while the CPU was at 100%

Please run mgr:events all the time (e.g., every minute) so that you can
catch event(s) (if any) that _lead_ to the 100% CPU usage period. You
can also run mgr:events more often (e.g., every 5 seconds) during the
100% CPU usage period, of course.


HTH,

Alex.


From rentorbuy at yahoo.com  Thu Oct 26 21:58:27 2017
From: rentorbuy at yahoo.com (Vieri)
Date: Thu, 26 Oct 2017 21:58:27 +0000 (UTC)
Subject: [squid-users] squid cpu usage
In-Reply-To: <5f672c1b-ce28-35f3-df09-982e9c76c9cc@measurement-factory.com>
References: <742455879.1992418.1508848440399.ref@mail.yahoo.com>
 <742455879.1992418.1508848440399@mail.yahoo.com>
 <efb11c97-0368-a8ff-c1be-9781ac450026@measurement-factory.com>
 <790628251.3784841.1509016514244@mail.yahoo.com>
 <5f672c1b-ce28-35f3-df09-982e9c76c9cc@measurement-factory.com>
Message-ID: <2087507399.4185171.1509055107307@mail.yahoo.com>

Thanks for all the tips.

I should've done this before, but I just took a second look at cache.log and found the following message repeated a few times before the 100% CPU issue:

"Your cache is running out of filedescriptors"

I have no more info because the debug level was low.

If this is the cause then I'm even more worried now because:

# ulimit -a
core file size          (blocks, -c) 0
data seg size           (kbytes, -d) unlimited
scheduling priority             (-e) 0
file size               (blocks, -f) unlimited
pending signals                 (-i) 127521
max locked memory       (kbytes, -l) 64
max memory size         (kbytes, -m) unlimited
open files                      (-n) 16384
pipe size            (512 bytes, -p) 8
POSIX message queues     (bytes, -q) 819200
real-time priority              (-r) 0
stack size              (kbytes, -s) 8192
cpu time               (seconds, -t) unlimited
max user processes              (-u) 127521
virtual memory          (kbytes, -v) unlimited
file locks                      (-x) unlimited

# cat /etc/security/limits.d/01_squid.conf 
* hard nofile 65535
* soft nofile 16384

It just so happens I ran mgr:filedescriptors while the CPU was at 100%.

Here's the output (stripped of domains and IP addresses):

HTTP/1.1 200 OK
Server: squid
Mime-Version: 1.0
Date: Thu, 26 Oct 2017 08:35:16 GMT
Content-Type: text/plain;charset=utf-8
Expires: Thu, 26 Oct 2017 08:35:16 GMT
Last-Modified: Thu, 26 Oct 2017 08:35:16 GMT
X-Cache: MISS from inf-fw2
X-Cache-Lookup: MISS from inf-fw2:3128
Connection: close

Active file descriptors:
File Type   Tout Nread  * Nwrite * Remote Address        Description
---- ------ ---- -------- -------- --------------------- ------------------------------
5 Log       0       0        0                        /var/log/squid/cache.log
6 Pipe      0       0        0                        IPC UNIX STREAM Parent
9 Socket 28796       0        0  x.x.x.x:3199    client https start
11 Socket    8    1829*  174558  x.x.x.x:62569  Idle client: Waiting for next request
12 Socket    0   77571   243300  x.x.x.x:1344        x.x.x.x
13 Socket 28798       0        0  x.x.x.x:1428   client https start
14 Socket  113     201*    3316  x.x.x.x:49847  Idle client: Waiting for next request
15 Socket 7614       0*       0  x.x.x.x:56204   client https start
16 Socket    0   70492    72860  x.x.x.x:1344        x.x.x.x
17 Socket    0  184736   412668  x.x.x.x:1344        x.x.x.x
18 Socket    0  269207   467337  x.x.x.x:1344        x.x.x.x
19 Socket    0   70386    70846  x.x.x.x:1344        x.x.x.x
20 Socket   56     319*     452  x.x.x.x:59366   Idle client: Waiting for next request
21 Socket    0   74155   160454  x.x.x.x:1344        x.x.x.x
22 Socket    0   70373   184389  x.x.x.x:1344        x.x.x.x
23 Socket    0  321566   418429  x.x.x.x:1344        x.x.x.x
24 Socket 28783    1633*       0  x.x.x.x:60033  Reading next request
25 Socket  895    1809*   37539  x.x.x.x:1344        x.x.x.x
26 Socket    0  171606   765947  x.x.x.x:1344        x.x.x.x
27 Socket    0  505651   936639  x.x.x.x:1344        x.x.x.x
28 Socket    0   77690   579865  x.x.x.x:1344        x.x.x.x
29 Socket  893 1120129* 1356723  x.x.x.x:1344        x.x.x.x
30 Socket   99    1409*    1067  x.x.x.x:51458  Idle client: Waiting for next request
31 Socket    0  697084   991951  x.x.x.x:1344        x.x.x.x
32 Socket    0   72740   380302  x.x.x.x:1344        x.x.x.x
33 Socket    0  133319  4018875  x.x.x.x:1344        x.x.x.x
34 Socket  885  365084*  418439  x.x.x.x:1344        x.x.x.x
35 Socket    0  230550   976940  x.x.x.x:1344        x.x.x.x
36 Socket    0   72085   159051  x.x.x.x:1344        x.x.x.x
37 Socket    0  142361   344294  x.x.x.x:1344        x.x.x.x
38 Socket    0 1008147  1644576  x.x.x.x:1344        x.x.x.x
39 Socket    0  861819  1334921  x.x.x.x:1344        x.x.x.x
40 Socket 28800    2851*     344  x.x.x.x:60799  Reading next request
41 Socket    0       0        0  [::]:39163            DNS Socket IPv6
42 Socket    0  152497   327514  x.x.x.x:1344        x.x.x.x
43 Socket    0 1139088  1516707  x.x.x.x:1344        x.x.x.x
44 Socket    0  237721   398977  x.x.x.x:1344        x.x.x.x
45 Socket    0   91801   114000  x.x.x.x:1344        x.x.x.x
46 Socket    0       0        0  x.x.x.x:3233    HTTP Request
47 Socket    0  131675   695360  x.x.x.x:1344        x.x.x.x
48 Socket    0  159372   179649  x.x.x.x:1344        x.x.x.x
49 Socket    0       0*       0  x.x.x.x:443    x.x.x.x pinned connection for x.x.x.x (187)
50 Socket    0     161*    1378  x.x.x.x:443      https://domain.org
52 Socket   69     286*    1430  x.x.x.x:55771   Idle client: Waiting for next request
53 Socket    8     397*   48788  x.x.x.x:62572  Idle client: Waiting for next request
54 Socket    0  341879   480589  x.x.x.x:1344        x.x.x.x
55 Socket   91     201*    3315  x.x.x.x:56787   Idle client: Waiting for next request
56 Socket    0  726999  1336667  x.x.x.x:1344        x.x.x.x
57 Socket  113     201*    3316  x.x.x.x:51036  Idle client: Waiting for next request
58 Socket  119     556*    3723  x.x.x.x:51851   Idle client: Waiting for next request
59 Socket   99    1322*     766  x.x.x.x:1968    Idle client: Waiting for next request
60 Socket    0   78554   216848  x.x.x.x:1344        x.x.x.x
61 Socket    0   70211   717853  x.x.x.x:1344        x.x.x.x
62 Socket    0   78361   182762  x.x.x.x:1344        x.x.x.x
63 Socket    0 1945692  4239277  x.x.x.x:1344        x.x.x.x
64 Socket   66    1092*    1117  x.x.x.x:50080   Idle client: Waiting for next request
65 Socket   62     202*     286  x.x.x.x:55769   Idle client: Waiting for next request
66 Socket    0   17396*     904  x.x.x.x:443    https://domain.org
67 Socket    0    3536*    1166  x.x.x.x:443     https://domain.org
68 Socket 28798    3038*     797  x.x.x.x:65116  Reading next request
69 Socket 28798       0*       0  x.x.x.x:1426   client https start
70 Socket 28780       0*       0  x.x.x.x:60791  client https start
71 Socket    0   70387    70867  x.x.x.x:1344        x.x.x.x
72 Socket    0  254449   502590  x.x.x.x:1344        x.x.x.x
73 Socket    9   11524*    1152  x.x.x.x:54067  Idle client: Waiting for next request
74 Socket    0   96195   103010  x.x.x.x:1344        x.x.x.x
75 Socket   28    1516*    1291  x.x.x.x:3023    Idle client: Waiting for next request
76 Socket    0  205806   602151  x.x.x.x:1344        x.x.x.x
77 Socket  115    2195*    1248  x.x.x.x:59024  Idle client: Waiting for next request
78 Socket    0  352877   444820  x.x.x.x:1344        x.x.x.x
79 Socket    6     384*     612  x.x.x.x:80      Idle server: x.x.x.x:80/some_path
80 Socket    0   71272   230010  x.x.x.x:1344        x.x.x.x
81 Socket    5    1490*  168706  x.x.x.x:54376  Idle client: Waiting for next request
82 Socket    0 4403371   651548  x.x.x.x:47443         DNS Socket IPv4
83 Socket    0  782173   984402  x.x.x.x:1344        x.x.x.x
84 Pipe      0       0        0                        unlinkd -> squid
85 Socket 28798     433*       0  x.x.x.x:1423   Reading next request
86 Socket    5    2211*    1249  x.x.x.x:49400  Idle client: Waiting for next request
87 Pipe      0       0        0                        squid -> unlinkd
88 Pipe      0       0        0                        squid -> diskd
89 Socket 28792    4914*    2557  x.x.x.x:3381   Reading next request
90 Socket   66     598*     712  x.x.x.x:2262   Idle client: Waiting for next request
91 Socket    0  486500  1052648  x.x.x.x:1344        x.x.x.x
92 Socket    0   84149   459690  x.x.x.x:1344        x.x.x.x
93 Socket    0  446707   703970  x.x.x.x:1344        x.x.x.x
94 Socket 28797    1744*       0  x.x.x.x:49666  Reading next request
95 Socket    0  196505  1356207  x.x.x.x:1344        x.x.x.x
96 Socket    0   71430   747104  x.x.x.x:1344        x.x.x.x
97 Pipe      0 55385864* 83254354                        ssl_crtd #1
98 Socket   99    4720*   74394  x.x.x.x:51833   Idle client: Waiting for next request
99 Socket    0   80191   352164  x.x.x.x:1344        x.x.x.x
100 Socket    0  831352  1205057  x.x.x.x:1344        x.x.x.x
101 Socket    0   67263    68047  x.x.x.x:1344        x.x.x.x
102 Socket 28734       0*       0  x.x.x.x:56784   client https start
103 Socket    0   90037   239742  x.x.x.x:1344        x.x.x.x
104 Socket    0   86557   182854  x.x.x.x:1344        x.x.x.x
105 Socket    0   74680   272842  x.x.x.x:1344        x.x.x.x
106 Socket    0   82432   182773  x.x.x.x:1344        x.x.x.x
107 Socket    0   91159   110508  x.x.x.x:1344        x.x.x.x
108 Socket    0   74341   182862  x.x.x.x:1344        x.x.x.x
109 Socket   58  354520*  417712  x.x.x.x:1344        x.x.x.x
110 Socket  896  110923*  238345  x.x.x.x:1344        x.x.x.x
111 Socket    0  367211   830710  x.x.x.x:1344        x.x.x.x
112 Socket    0  799681  2454675  x.x.x.x:1344        x.x.x.x
113 Socket    0  174639   526254  x.x.x.x:1344        x.x.x.x
114 Socket    0  224143   626713  x.x.x.x:1344        x.x.x.x
115 Socket    0     825*    4338  x.x.x.x:443    https://domain.org
116 Socket   50       0        0* x.x.x.x:80       domain.org
117 Socket 28799       0        0  x.x.x.x:3208    client https start
118 Socket    0   29387*    3248  x.x.x.x:443   https://domain.org
119 Socket   69   13796*    1117  x.x.x.x:64434  Idle client: Waiting for next request
120 Socket    0  401186   536770  x.x.x.x:1344        x.x.x.x
121 Socket    0   70420    72431  x.x.x.x:1344        x.x.x.x
122 Socket    0 1248701  2243251  x.x.x.x:1344        x.x.x.x
123 Pipe      0 12387700* 18425650                        ssl_crtd #2
124 Socket    0   74579   186204  x.x.x.x:1344        x.x.x.x
125 Socket    0  147688   317832  x.x.x.x:1344        x.x.x.x
126 Socket    0  157570  1000064  x.x.x.x:1344        x.x.x.x
127 Socket    0  484039   932396  x.x.x.x:1344        x.x.x.x
128 Socket    0   72709   204331  x.x.x.x:1344        x.x.x.x
129 Socket    0  121209   121541  x.x.x.x:1344        x.x.x.x
130 Socket    0   89678   203510  x.x.x.x:1344        x.x.x.x
131 Socket    0 1096513  1775872  x.x.x.x:1344        x.x.x.x
132 Socket 28774    1636*       0  x.x.x.x:65117  Reading next request
133 Socket   53     378*    1542  x.x.x.x:80        Idle server: x.x.x.x:80/some_path
134 Socket  108     482*     654  x.x.x.x:59022  Idle client: Waiting for next request
135 Socket    0   67261    67977  x.x.x.x:1344        x.x.x.x
136 Socket    0  353852  1257798  x.x.x.x:1344        x.x.x.x
137 Socket  120    3820*    3424  x.x.x.x:64559  Idle client: Waiting for next request
138 Socket    8     829*    1280  x.x.x.x:3040    Idle client: Waiting for next request
139 Socket 6069       0*       0  x.x.x.x:56177   client https start
140 Socket    0   75215   314184  x.x.x.x:1344        x.x.x.x
141 Socket    0   72428   421624  x.x.x.x:1344        x.x.x.x
142 Socket    0  205459   279606  x.x.x.x:1344        x.x.x.x
143 Socket    0  983140  1528993  x.x.x.x:1344        x.x.x.x
144 Socket    0   72254   128634  x.x.x.x:1344        x.x.x.x
145 Socket  108     470*     654  x.x.x.x:2259   Idle client: Waiting for next request
146 Socket 28798       0        0  x.x.x.x:1839   client https start
147 Socket 28754    6505*    2748  x.x.x.x:2121   Reading next request
148 Socket    0   94387   437023  x.x.x.x:1344        x.x.x.x
149 Socket  112     526*     636  x.x.x.x:54464  Idle client: Waiting for next request
150 Socket    0  291712   418901  x.x.x.x:1344        x.x.x.x
151 Socket    0  260125   466643  x.x.x.x:1344        x.x.x.x
152 Socket    0   75500   192364  x.x.x.x:1344        x.x.x.x
153 Socket   91    6720*   31850  x.x.x.x:51199   Idle client: Waiting for next request
154 Socket    0  340510  3310843  x.x.x.x:1344        x.x.x.x
155 Socket 28799       0        0  x.x.x.x:3206    client https start
156 Socket    0   74500   184502  x.x.x.x:1344        x.x.x.x
157 Socket  888  208562*  377059  x.x.x.x:1344        x.x.x.x
158 Pipe      0 5872190* 8607084                        ssl_crtd #3
159 Socket    0  103064   525215  x.x.x.x:1344        x.x.x.x
160 Socket   98     482*     654  x.x.x.x:60031  Idle client: Waiting for next request
161 Socket   62     516*     675  x.x.x.x:51195   Idle client: Waiting for next request
162 Socket 28799       0        0  x.x.x.x:3209    client https start
163 Socket   66    2211*    2150  x.x.x.x:54426  Idle client: Waiting for next request
164 Socket 28798    3348*     798  x.x.x.x:2255   Reading next request
165 Socket    0  222093   321752  x.x.x.x:1344        x.x.x.x
166 Socket    0  126144   442862  x.x.x.x:1344        x.x.x.x
167 Socket   62   16353*   41096  x.x.x.x:3235    Idle client: Waiting for next request
168 Socket    0   67365    68179  x.x.x.x:1344        x.x.x.x
169 Socket    0    9195*    2294  x.x.x.x:443   https://domain.org
170 Socket  113     201*    3316  x.x.x.x:51037  Idle client: Waiting for next request
171 Socket 28800       0        0  x.x.x.x:55497  client https connect
172 Socket    0  126735   522798  x.x.x.x:1344        x.x.x.x
173 Socket    0   27366*    6978  x.x.x.x:443    https://domain.org
174 Socket 28779    3231*     870  x.x.x.x:2142   Reading next request
175 Socket    0 1214190  1308440  x.x.x.x:1344        x.x.x.x
176 Socket 28745    3983*       0  x.x.x.x:1365   Reading next request
177 Socket 27422       0*       0  x.x.x.x:56749   client https start
178 Socket    0   71305   194143  x.x.x.x:1344        x.x.x.x
179 Socket   66     306*     452  x.x.x.x:1353   Idle client: Waiting for next request
180 Socket 28774    1758*       0  x.x.x.x:59375   Reading next request
181 Socket 28798    3618*     609* x.x.x.x:55780   Reading next request
182 Socket    0  463907  4817276  x.x.x.x:1344        x.x.x.x
183 Socket    0  366549   818689  x.x.x.x:1344        x.x.x.x
184 Pipe      0 3597805* 5272955                        ssl_crtd #4
185 Socket    0  330910   964399  x.x.x.x:1344        x.x.x.x
186 Socket  113     645*    1205  x.x.x.x:4116    Idle client: Waiting for next request
187 Socket 28800     876*       0* x.x.x.x:62588  Reading next request
188 Socket    0 1484456  1616112  x.x.x.x:1344        x.x.x.x
189 Socket    0  902153  1747543  x.x.x.x:1344        x.x.x.x
190 Socket   99   13466*    1117  x.x.x.x:64687   Idle client: Waiting for next request
191 Socket    0       0*       0  x.x.x.x:443    x.x.x.x pinned connection for x.x.x.x (505)
192 Socket   58  277899*  415305  x.x.x.x:1344        x.x.x.x
193 Socket   19     838*     739  x.x.x.x:62578  Idle client: Waiting for next request
194 Socket   58   32594*   53867  x.x.x.x:1344        x.x.x.x
195 Socket    0   74412   748176  x.x.x.x:1344        x.x.x.x
196 Socket    0  294684   832445  x.x.x.x:1344        x.x.x.x
197 Socket  876  431920*  668818  x.x.x.x:1344        x.x.x.x
198 Socket 28744    2487*       0  x.x.x.x:3267    Reading next request
199 Socket  113     201*    3316  x.x.x.x:51238  Idle client: Waiting for next request
200 Socket    0    1043*     886  x.x.x.x:443    https://domain.org
201 Socket 28779    3150*     870  x.x.x.x:2134   Reading next request
202 Socket  104     361*    3527  x.x.x.x:3173    Idle client: Waiting for next request
203 Socket    0       0        0  x.x.x.x:3234    HTTP Request
204 Socket    8    1450*    1308  x.x.x.x:65097  Reading next request
205 Socket   19     566*     784  x.x.x.x:54405  Idle client: Waiting for next request
206 Socket    0 1018301  1251632  x.x.x.x:1344        x.x.x.x
207 Socket    0  243460   725933  x.x.x.x:1344        x.x.x.x
208 Pipe      0 2674774* 3914935                        ssl_crtd #5
209 Socket  115     610*     712  x.x.x.x:64689   Idle client: Waiting for next request
210 Socket    0     764*    7298  x.x.x.x:443    https://domain.org
211 Socket  105    1277*     344  x.x.x.x:2283   Idle client: Waiting for next request
212 Socket    0  131679  1220103  x.x.x.x:1344        x.x.x.x
213 Socket  876   30969*  222063  x.x.x.x:1344        x.x.x.x
214 Socket    0  191177   438150  x.x.x.x:1344        x.x.x.x
215 Socket    0   78829   290995  x.x.x.x:1344        x.x.x.x
216 Socket  112    1002*    1328  x.x.x.x:51197   Idle client: Waiting for next request
217 Socket    0  174193*    3658  x.x.x.x:443    https://domain.org
218 Socket 28781       0*       0  x.x.x.x:60795  client https start
219 Pipe      0 1969670* 2885654                        ssl_crtd #6
220 Socket   67    5709*   13745  x.x.x.x:1366   Idle client: Waiting for next request
221 Socket    0  570053   628689  x.x.x.x:1344        x.x.x.x
222 Socket 28790     308*       0  x.x.x.x:2899   Reading next request
223 Socket 28798     704*  267112  x.x.x.x:1827    Reading next request
224 Pipe      0 1464643* 2151275                        ssl_crtd #7
225 Socket  107    3463*   26520  x.x.x.x:51202   Idle client: Waiting for next request
226 Socket 28799     433*       0  x.x.x.x:1425   Reading next request
227 Socket  118    1424*     344  x.x.x.x:1826    Idle client: Waiting for next request
228 Socket    0  321598   669611  x.x.x.x:1344        x.x.x.x
229 Socket    0       0*       0  x.x.x.x:443    x.x.x.x pinned connection for x.x.x.x (686)
230 Socket   87     909*     718  x.x.x.x:1389   Idle client: Waiting for next request
231 Socket    0   70445    89872  x.x.x.x:1344        x.x.x.x
232 Socket 28797       0*       0  x.x.x.x:3389   client https start
233 Socket    0  145988   147306  x.x.x.x:1344        x.x.x.x
234 Socket    0  586261  1258275  x.x.x.x:1344        x.x.x.x
235 Socket    0  285602   466348  x.x.x.x:1344        x.x.x.x
236 Socket    0  131679  3752672  x.x.x.x:1344        x.x.x.x
237 Socket    0  447059  1790353  x.x.x.x:1344        x.x.x.x
238 Socket    0   87910  2010315  x.x.x.x:1344        x.x.x.x
239 Socket 5812       0*       0  x.x.x.x:56171   client https start
240 Socket   28   48115*    1178  x.x.x.x:80        Idle server: x.x.x.x:80/some_path
241 Socket   66    4466*   18377  x.x.x.x:3268    Idle client: Waiting for next request
242 Socket    0  596879  1296258  x.x.x.x:1344        x.x.x.x
243 Socket    0  568370   987503  x.x.x.x:1344        x.x.x.x
244 Pipe      0 1150405* 1697637                        ssl_crtd #8
245 Socket   56     485*  682630  x.x.x.x:62580  Idle client: Waiting for next request
246 Socket    0  175607  1683506  x.x.x.x:1344        x.x.x.x
247 Socket   16    1424*   17194  x.x.x.x:54395  Idle client: Waiting for next request
248 Socket 28798     829*   12831* x.x.x.x:2308   Reading next request
249 Socket   56     318*     452  x.x.x.x:62585  Idle client: Waiting for next request
250 Socket  875    1734*    5924  x.x.x.x:443    https://domain.org
251 Socket    5     518*   70059  x.x.x.x:54373  Idle client: Waiting for next request
252 Socket    0  149322   313136  x.x.x.x:1344        x.x.x.x
253 Socket    0  589520   836807  x.x.x.x:1344        x.x.x.x
254 Socket 28797       0        0* x.x.x.x:54932   client https start
255 Socket 28771    1660*       0  x.x.x.x:51201   Reading next request
256 Pipe      0  916891* 1351785                        ssl_crtd #9
257 Socket   60   22466*  111364  x.x.x.x:1344        x.x.x.x
258 Socket 28796    3294*    1180  x.x.x.x:59020  Reading next request
259 Socket    0    1055*     872  x.x.x.x:443    https://domain.org
260 Socket    0   14835*     624  x.x.x.x:443    https://domain.org
261 Socket  875  289287*  581694  x.x.x.x:1344        x.x.x.x
262 Socket    7    2437*   10773  x.x.x.x:65303  Idle client: Waiting for next request
263 Socket 28796       0        0  x.x.x.x:3197    client https start
264 Pipe      0  729453* 1059077                        ssl_crtd #10
265 Socket   66    4370*    5763  x.x.x.x:3269    Idle client: Waiting for next request
266 Socket  107    3233*    4119  x.x.x.x:64586  Idle client: Waiting for next request
267 Socket    0  212472   431063  x.x.x.x:1344        x.x.x.x
268 Pipe      0  578076*  850440                        ssl_crtd #11
269 Socket  113     407*     613  x.x.x.x:51460  Idle client: Waiting for next request
270 Socket    0    1101*    4474  x.x.x.x:443    https://domain.org
271 Socket    0 2563693  3830336  x.x.x.x:1344        x.x.x.x
272 Socket    0  828859  1380776  x.x.x.x:1344        x.x.x.x
273 Socket    0   71319   259076  x.x.x.x:1344        x.x.x.x
274 Socket  105     609*     435  x.x.x.x:3171    Idle client: Waiting for next request
275 Socket 28799     433*       0  x.x.x.x:1427   Reading next request
276 Socket    0   74500   185574  x.x.x.x:1344        x.x.x.x
277 Socket    0  189973   564948  x.x.x.x:1344        x.x.x.x
278 Socket   60  129925*  458165  x.x.x.x:1344        x.x.x.x
279 Socket 28783       0*       0  x.x.x.x:60797  client https start
280 Socket 28797     731*       0  x.x.x.x:54488  Reading next request
281 Socket    0   70962    98876  x.x.x.x:1344        x.x.x.x
282 Socket    0   77789   334559  x.x.x.x:1344        x.x.x.x
283 Socket  115     649*     623  x.x.x.x:54482  Idle client: Waiting for next request
284 Socket    0  131737   182857  x.x.x.x:1344        x.x.x.x
285 Socket 28799       0        0  x.x.x.x:3216    client https start
286 Socket   74     469*     555  x.x.x.x:60744  Idle client: Waiting for next request
287 Pipe      0   85247*  124165                        ssl_crtd #1
288 Socket    0  996913  1509983  x.x.x.x:1344        x.x.x.x
289 Pipe      0  466480*  700518                        ssl_crtd #12
290 Socket    0   70702    74868  x.x.x.x:1344        x.x.x.x
291 Socket   88     518*   43112  x.x.x.x:60756  Idle client: Waiting for next request
292 Socket    9   10213*    1158  x.x.x.x:54068  Idle client: Waiting for next request
293 Socket  900  269761*  431423* x.x.x.x:1344        x.x.x.x
294 Socket    0   88023   296477  x.x.x.x:1344        x.x.x.x
295 Socket  113     201*    3316  x.x.x.x:51038  Idle client: Waiting for next request
296 Socket 28800       0        0  x.x.x.x:2385   client https start
297 Socket    0 1409562  1861582  x.x.x.x:1344        x.x.x.x
298 Socket    0   74282   713086  x.x.x.x:1344        x.x.x.x
299 Socket    0   74290   182774  x.x.x.x:1344        x.x.x.x
300 Socket   97    2215*    1301  x.x.x.x:51848   Idle client: Waiting for next request
301 Socket    0   85396   343984  x.x.x.x:1344        x.x.x.x
302 Socket    0   78177   143882  x.x.x.x:1344        x.x.x.x
303 Socket   66    5881*    6604  x.x.x.x:1367   Idle client: Waiting for next request
304 Socket    0 2942297  3069551  x.x.x.x:1344        x.x.x.x
305 Pipe      0  364706*  534055                        ssl_crtd #13
306 Socket 28758       0        0  x.x.x.x:55095  client https start
307 Socket  118     410*    1231  x.x.x.x:2311   Idle client: Waiting for next request
308 Socket    0  503380  1071795  x.x.x.x:1344        x.x.x.x
309 Socket    0   96839   350661  x.x.x.x:1344        x.x.x.x
310 Socket    0  556795  5837880  x.x.x.x:1344        x.x.x.x
311 Socket  112     254*     787  x.x.x.x:50711  Idle client: Waiting for next request
312 Socket 28800       0        0  x.x.x.x:3220    client https start
313 Socket    0   72449   172781  x.x.x.x:1344        x.x.x.x
314 Socket    0  185849  1747378  x.x.x.x:1344        x.x.x.x
315 Socket    0       0        0  x.x.x.x:3232    HTTP Request
316 Socket   87     201*    3316  x.x.x.x:56871  Idle client: Waiting for next request
317 Socket    9     888*    1066  x.x.x.x:2976    Idle client: Waiting for next request
318 Socket    0       0*       0  x.x.x.x:443       x.x.x.x pinned connection for x.x.x.x (269)
319 Socket    0   73737    86419  x.x.x.x:1344        x.x.x.x
320 Socket    0  648346   962465  x.x.x.x:1344        x.x.x.x
321 Socket    0  151927   449211  x.x.x.x:1344        x.x.x.x
322 Socket    0     275*    2398  x.x.x.x:443      https://domain.org
323 Socket    2     354*     466  x.x.x.x:80     Idle server: x.x.x.x:80/some_path
324 Socket  108     470*     654  x.x.x.x:2257   Idle client: Waiting for next request
325 Pipe      0   68850*  103401                        ssl_crtd #2
326 Socket    0       0        0  x.x.x.x:3230    client https connect
327 Socket 28773       0*       0  x.x.x.x:56789   client https start
328 Socket    0  242751   910187  x.x.x.x:1344        x.x.x.x
329 Socket 28730    1146*       0  x.x.x.x:2150   Reading next request
330 Pipe      0  309147*  463388                        ssl_crtd #14
331 Socket 28783    1366*       0  x.x.x.x:64173  Reading next request
332 Socket    0     531*    1360  x.x.x.x:443    https://domain.org
333 Socket    0  467739   655208  x.x.x.x:1344        x.x.x.x
334 Socket    0       0        0  x.x.x.x:55499  client https connect
335 Socket   10    2143*     880  x.x.x.x:54391  Idle client: Waiting for next request
336 Socket  113   10176*    1157  x.x.x.x:31352   Idle client: Waiting for next request
337 Socket    0  520857  1758549  x.x.x.x:1344        x.x.x.x
338 Socket    0  232302   359424  x.x.x.x:1344        x.x.x.x
339 Socket   59  164364*  422776  x.x.x.x:1344        x.x.x.x
340 Socket    0 1459622  1885753  x.x.x.x:1344        x.x.x.x
341 Socket 28800       0        0  x.x.x.x:60102  client https start
342 Socket   16     201*    3316  x.x.x.x:54400  Idle client: Waiting for next request
343 Socket 28799     433*       0  x.x.x.x:1429   Reading next request
344 Socket    0  170597   572080  x.x.x.x:1344        x.x.x.x
345 Pipe      0  256576*  380163                        ssl_crtd #15
346 Socket   16     399*     286  x.x.x.x:61194   Idle client: Waiting for next request
347 Pipe      0   59571*   89389                        ssl_crtd #3
348 Socket   19     563*     784  x.x.x.x:54402  Idle client: Waiting for next request
349 Socket 28800       0        0  x.x.x.x:3219    client https start
350 Socket    0  381663  1005072  x.x.x.x:1344        x.x.x.x
351 Socket 28799    2283*       0  x.x.x.x:49667  Reading next request
352 Socket  112     964*    1306  x.x.x.x:51189   Idle client: Waiting for next request
353 Pipe      0  218850*  321361                        ssl_crtd #16
354 Socket  106     526*     276  x.x.x.x:51461  Idle client: Waiting for next request
355 Socket   19     573*     784  x.x.x.x:54403  Idle client: Waiting for next request
356 Socket   66     490*    8229  x.x.x.x:3144    Idle client: Waiting for next request
357 Pipe      0  179339*  269018                        ssl_crtd #17
358 Socket 28800       0        0  x.x.x.x:3217    client https start
359 Socket 28798       0        0  x.x.x.x:1840   client https start
360 Socket    0 1080220  1947420  x.x.x.x:1344        x.x.x.x
361 Socket    0       0        0  x.x.x.x:443     x.x.x.x pinned connection for x.x.x.x (46)
362 Socket    0  217293   913828  x.x.x.x:1344        x.x.x.x
363 Socket   44     630*    2746  x.x.x.x:80     Idle server: x.x.x.x:80/some_path
364 Socket    0   12335*   15764  x.x.x.x:443      https://domain.org
365 Socket 28800       0        0  x.x.x.x:3221    client https start
366 Socket    0       0*       0  x.x.x.x:443    x.x.x.x pinned connection for x.x.x.x (479)
367 Socket    0  343536   972237  x.x.x.x:1344        x.x.x.x
368 Socket    0 1138072  1520823  x.x.x.x:1344        x.x.x.x
369 Socket    0       0*       0  x.x.x.x:443       x.x.x.x pinned connection for x.x.x.x (254)
370 Socket   19     563*     784  x.x.x.x:54404  Idle client: Waiting for next request
371 Socket   98     537*    1246  x.x.x.x:54444  Idle client: Waiting for next request
372 Socket    0  860350  1104913  x.x.x.x:1344        x.x.x.x
373 Socket    0    1060*   23048  x.x.x.x:443    https://domain.org
374 Socket    0    1066*   20478  x.x.x.x:443    https://domain.org
375 Socket 28799       0        0  x.x.x.x:3210    client https start
376 Socket  900       0*    4618  x.x.x.x:443    https://domain.org
377 Pipe      0   55913*   81124                        ssl_crtd #4
378 Socket  113     201*    3316  x.x.x.x:51039  Idle client: Waiting for next request
379 Socket    0       0*       0  x.x.x.x:443      x.x.x.x pinned connection for x.x.x.x (263)
380 Socket  113     201*    3316  x.x.x.x:51040  Idle client: Waiting for next request
381 Socket   46    3906*   24391  x.x.x.x:1344        x.x.x.x
382 Socket 28798       0        0  x.x.x.x:2320   client https start
383 Socket    0   72481   157154  x.x.x.x:1344        x.x.x.x
384 Pipe      0  133145*  199159                        ssl_crtd #18
385 Socket 28776    7538*    1630  x.x.x.x:54399  Reading next request
386 Pipe      0    7025*   10746                        ssl_crtd #1
387 Socket   86     482*     654  x.x.x.x:49662  Idle client: Waiting for next request
388 Socket   91    1173*     343  x.x.x.x:60760  Idle client: Waiting for next request
389 Socket    0 1560783  3101138  x.x.x.x:1344        x.x.x.x
390 Socket 28796       0        0  x.x.x.x:3198    client https start
391 Socket    0  580399   792546  x.x.x.x:1344        x.x.x.x
392 Socket    0   78307   198904  x.x.x.x:1344        x.x.x.x
393 Socket 28737       0*       0  x.x.x.x:51806  client https start
394 Socket   18     470*    3778  x.x.x.x:3088    Idle client: Waiting for next request
395 Socket 28800       0        0  x.x.x.x:3223    client https start
396 Socket    0       0        0  x.x.x.x:3235    HTTP Request
397 Socket    7    1934*     615  x.x.x.x:54066  Idle client: Waiting for next request
398 Pipe      0  113172*  166273                        ssl_crtd #19
399 Socket  893  195206*  214787  x.x.x.x:1344        x.x.x.x
400 Socket 28754   10860*   10436  x.x.x.x:4100    Reading next request
401 Socket   17     201*    1324  x.x.x.x:80       Idle server: x.x.x.x:80/some_path
402 Socket    0 2234270  2503172  x.x.x.x:1344        x.x.x.x
403 Socket 28800    5134*    2537  x.x.x.x:1834   Reading next request
404 Socket 28772    1637*       0  x.x.x.x:51847   Reading next request
405 Socket   54     306*     452  x.x.x.x:31306   Idle client: Waiting for next request
406 Socket   63     819*    1961  x.x.x.x:52887  Idle client: Waiting for next request
407 Socket   28     253*    2550  x.x.x.x:3093    Idle client: Waiting for next request
408 Socket 28793     536*    8935* x.x.x.x:60800  Reading next request
409 Socket    0   67261    67880  x.x.x.x:1344        x.x.x.x
410 Pipe      0    7959*   12590                        ssl_crtd #2
411 Pipe      0   37269*   56216                        ssl_crtd #5
412 Socket    0   76888   138606  x.x.x.x:1344        x.x.x.x
413 Socket 28800       0        0  x.x.x.x:3225    client https start
414 Socket   98     549*    1141  x.x.x.x:54445  Idle client: Waiting for next request
415 Socket    0  873728  1316366  x.x.x.x:1344        x.x.x.x
416 Socket    0       0*       0  x.x.x.x:443      x.x.x.x pinned connection for x.x.x.x (390)
417 Socket   97     482*     654  x.x.x.x:49408  Idle client: Waiting for next request
418 Socket    0 4690935  6430992  x.x.x.x:1344        x.x.x.x
419 Pipe      0    7549*   11042                        ssl_crtd #3
420 Socket    0 1058661  1673219  x.x.x.x:1344        x.x.x.x
421 Socket 28796   10874*  125020* x.x.x.x:54421  Reading next request
422 Socket    0  619900  1893341  x.x.x.x:1344        x.x.x.x
423 Socket    0  484497   639048  x.x.x.x:1344        x.x.x.x
424 Socket    0       0*       0  x.x.x.x:443      x.x.x.x pinned connection for x.x.x.x (497)
425 Socket 28798       0        0  x.x.x.x:3200    client https start
426 Socket    0  217686   282356  x.x.x.x:1344        x.x.x.x
427 Socket    0  171843  2226884  x.x.x.x:1344        x.x.x.x
428 Socket    0  742382  1291857  x.x.x.x:1344        x.x.x.x
429 Socket  104     249*     776  x.x.x.x:61437   Idle client: Waiting for next request
430 Socket  876  338749*  449700  x.x.x.x:1344        x.x.x.x
431 Socket    0  638966   976750  x.x.x.x:1344        x.x.x.x
432 Socket    0   67626   109037  x.x.x.x:1344        x.x.x.x
433 Socket 28799       0        0  x.x.x.x:3207    client https start
434 Socket    0  539438   762345  x.x.x.x:1344        x.x.x.x
435 Socket    0  529527   740350  x.x.x.x:1344        x.x.x.x
436 Socket    0  133828   244486  x.x.x.x:1344        x.x.x.x
437 Socket   91     273*    3437  x.x.x.x:55776   Idle client: Waiting for next request
438 Socket 28799       0        0  x.x.x.x:3212    client https start
439 Socket    0  175285   360548  x.x.x.x:1344        x.x.x.x
440 Socket 28800       0        0  x.x.x.x:55498  client https connect
441 Socket  900  866564* 1274512* x.x.x.x:1344        x.x.x.x
442 Socket    0  104615   259266  x.x.x.x:1344        x.x.x.x
443 Socket    0  767495  1513964  x.x.x.x:1344        x.x.x.x
444 Socket  113     557*    3604  x.x.x.x:3187    Idle client: Waiting for next request
445 Socket    0  589528   777412  x.x.x.x:1344        x.x.x.x
446 Pipe      0   99772*  143323                        ssl_crtd #20
447 Socket    0   51392*    5692  x.x.x.x:443    https://domain.org
448 Socket    0     622*    3326  x.x.x.x:443    https://domain.org
449 Socket    0  178130   479705  x.x.x.x:1344        x.x.x.x
450 Socket    0   75335   249026  x.x.x.x:1344        x.x.x.x
451 Socket    0  584110  1041464  x.x.x.x:1344        x.x.x.x
452 Socket    0 5989855  7840009  x.x.x.x:1344        x.x.x.x
453 Socket    0   70378   183780  x.x.x.x:1344        x.x.x.x
454 Socket    9     397*     817  x.x.x.x:60714  Idle client: Waiting for next request
455 Socket    0       0*       0  x.x.x.x:443    x.x.x.x pinned connection for x.x.x.x (615)
456 Socket    0   67473    70236  x.x.x.x:1344        x.x.x.x
457 Socket  113     647*     811  x.x.x.x:54477  Idle client: Waiting for next request
458 Socket  106     277*    3421  x.x.x.x:55778   Idle client: Waiting for next request
459 Socket    0   80521   283037  x.x.x.x:1344        x.x.x.x
460 Socket   98     598*     712  x.x.x.x:50085   Idle client: Waiting for next request
461 Socket    0  167275   298854  x.x.x.x:1344        x.x.x.x
462 Socket 28781       0*       0  x.x.x.x:60792  client https start
463 Socket  115     281*    3428  x.x.x.x:55779   Idle client: Waiting for next request
464 Socket    0   10405*    4874  x.x.x.x:443    https://domain.org
465 Socket    0    1025*   27592  x.x.x.x:443    https://domain.org
466 Socket    0       0*       0  x.x.x.x:443     x.x.x.x pinned connection for x.x.x.x (9)
467 Socket   98     555*    2252  x.x.x.x:60770  Idle client: Waiting for next request
468 Socket    0    9354*    2314  x.x.x.x:443   https://domain.org
469 Socket    0   91540   325953  x.x.x.x:1344        x.x.x.x
470 Socket    0  762551  1389788  x.x.x.x:1344        x.x.x.x
471 Socket   74    7830*   12535  x.x.x.x:4097    Idle client: Waiting for next request
472 Socket    0  380016   476604  x.x.x.x:1344        x.x.x.x
473 Socket  885   15670*   85733  x.x.x.x:1344        x.x.x.x
474 Socket    0  406074   456587  x.x.x.x:1344        x.x.x.x
475 Socket 28800    1335*     253  x.x.x.x:3180    Reading next request
476 Socket   46     315*    4617  x.x.x.x:1344        x.x.x.x
477 Socket   58   32530*   49384  x.x.x.x:1344        x.x.x.x
478 Socket    0  172630   242324  x.x.x.x:1344        x.x.x.x
479 Socket  118     387*    3558  x.x.x.x:2316   Idle client: Waiting for next request
480 Socket    0   74290   182781  x.x.x.x:1344        x.x.x.x
481 Socket    0   80770   197294  x.x.x.x:1344        x.x.x.x
482 Socket    0   75048   281261  x.x.x.x:1344        x.x.x.x
483 Socket    0   74554   185351  x.x.x.x:1344        x.x.x.x
484 Socket   97     482*     654  x.x.x.x:49409  Idle client: Waiting for next request
485 Socket   60    1302*   11029  x.x.x.x:1344        x.x.x.x
486 Socket   86    4856*    5810  x.x.x.x:4112    Idle client: Waiting for next request
487 Socket  105     250*     779  x.x.x.x:56421  Idle client: Waiting for next request
488 Socket    0    2063*    4526  x.x.x.x:443    https://domain.org
489 Pipe      0   30386*   47145                        ssl_crtd #6
490 Socket 28756       0        0  x.x.x.x:55093  client https start
491 Socket 28800    5190*    1214  x.x.x.x:1835   Reading next request
492 Socket  878     105*    4307  x.x.x.x:1344        x.x.x.x
493 Socket    0       0*       0  x.x.x.x:443      x.x.x.x pinned connection for x.x.x.x (232)
494 Socket  900     429      866  x.x.x.x:443   https://domain.org
495 Socket  900  160740*  529879* x.x.x.x:1344        x.x.x.x
496 Socket    0  474171   673500  x.x.x.x:1344        x.x.x.x
497 Socket  113     331*    3485  x.x.x.x:54480  Idle client: Waiting for next request
498 Socket   74    1595*     730  x.x.x.x:49696  Idle client: Waiting for next request
499 Socket    0  559618   865116  x.x.x.x:1344        x.x.x.x
500 Socket  898     595*    3540  x.x.x.x:443    https://domain.org
501 Socket    0   75127   273504  x.x.x.x:1344        x.x.x.x
502 Socket    0  171003   603908  x.x.x.x:1344        x.x.x.x
503 Socket    0  377031   835100  x.x.x.x:1344        x.x.x.x
504 Socket    0   67366    69093  x.x.x.x:1344        x.x.x.x
505 Socket   88     520*     675  x.x.x.x:51841   Idle client: Waiting for next request
506 Socket    0   70420    71693  x.x.x.x:1344        x.x.x.x
507 Socket    0   71047   275124  x.x.x.x:1344        x.x.x.x
508 Socket    0  196158*   23334  x.x.x.x:443    https://domain.org
509 Socket    0       0*       0  ::1:48239             ext_wbinfo_group_acl #1
510 Socket    0  136980   194711  x.x.x.x:1344        x.x.x.x
511 Socket  898    9550*   41835  x.x.x.x:1344        x.x.x.x
512 Socket    0  921556  1321574  x.x.x.x:1344        x.x.x.x
513 Socket   98     537*    1068  x.x.x.x:54446  Idle client: Waiting for next request
514 Socket    0   70273   182857  x.x.x.x:1344        x.x.x.x
515 Socket    0       0        0  x.x.x.x:443     x.x.x.x pinned connection for x.x.x.x (315)
516 Socket   74     507*    1559  x.x.x.x:60741  Idle client: Waiting for next request
517 Socket   87    1531*   29663  x.x.x.x:54429  Idle client: Waiting for next request
518 Socket   87    1085*    9379  x.x.x.x:54430  Idle client: Waiting for next request
519 Socket    0   36043*     842  x.x.x.x:443      https://domain.org
520 Socket    0  156225   280780  x.x.x.x:1344        x.x.x.x
521 Socket   87    1095*    9538  x.x.x.x:54431  Idle client: Waiting for next request
522 Socket    0 1090575  1456044  x.x.x.x:1344        x.x.x.x
523 Socket    0   67263    67988  x.x.x.x:1344        x.x.x.x
524 Socket    0  133693   347078  x.x.x.x:1344        x.x.x.x
525 Socket    0       0*       0  x.x.x.x:443   x.x.x.x pinned connection for x.x.x.x (69)
526 Socket  898  311676*  510052  x.x.x.x:1344        x.x.x.x
527 Socket  900     425      866  x.x.x.x:443   https://domain.org
528 Socket    0       0*       0  ::1:59459             ext_wbinfo_group_acl #2
529 Socket    0   78353   989595  x.x.x.x:1344        x.x.x.x
530 Socket    0    1096*    1782  x.x.x.x:443    https://domain.org
531 Socket 28800       0        0  x.x.x.x:3222    client https start
532 Socket    0       0*       0  x.x.x.x:443    x.x.x.x pinned connection for x.x.x.x (764)
533 Socket    0   71390   110141  x.x.x.x:1344        x.x.x.x
534 Socket    0 1203421  1809900  x.x.x.x:1344        x.x.x.x
535 Socket    0   70832    76525  x.x.x.x:1344        x.x.x.x
536 Socket  118     417*    1219  x.x.x.x:2310   Idle client: Waiting for next request
537 Socket   77     662*     275  x.x.x.x:1392   Idle client: Waiting for next request
538 Socket    0   76434   486358  x.x.x.x:1344        x.x.x.x
539 Socket  898  445876*  531378  x.x.x.x:1344        x.x.x.x
540 Socket    0       0        0  x.x.x.x:443     x.x.x.x pinned connection for x.x.x.x (203)
541 Socket    0   69878*    1098  x.x.x.x:443    https://domain.org
542 Socket   46     384*     612  x.x.x.x:80      Idle server: x.x.x.x:80/some_path
543 Socket    0     636*     794  x.x.x.x:443    https://domain.org
544 Socket    0 2182761  2218810  x.x.x.x:1344        x.x.x.x
545 Socket   46  150988*  321272  x.x.x.x:1344        x.x.x.x
546 Socket    0   68503    78530  x.x.x.x:1344        x.x.x.x
547 Socket  896    1598*    6692  x.x.x.x:443    https://domain.org
548 Socket    0       0*       0  x.x.x.x:443   x.x.x.x pinned connection for x.x.x.x (13)
549 Socket  900       0*     866  x.x.x.x:443   https://domain.org
550 Socket 28799       0        0  x.x.x.x:3203    client https start
551 Socket   59  302774*  595817  x.x.x.x:1344        x.x.x.x
552 Socket    0     515*    1112  x.x.x.x:443     https://domain.org
553 Socket    7     395*     286  x.x.x.x:61191   Idle client: Waiting for next request
554 Socket    0  438847   475815  x.x.x.x:1344        x.x.x.x
555 Socket    0 1666817  2225879  x.x.x.x:1344        x.x.x.x
556 Socket    0       0*       0  x.x.x.x:443    x.x.x.x pinned connection for x.x.x.x (625)
557 Socket    0   87652   250185  x.x.x.x:1344        x.x.x.x
558 Socket    0  888616  1629204  x.x.x.x:1344        x.x.x.x
559 Socket  878    2012*   15232  x.x.x.x:443    https://domain.org
560 Socket   85     201*    3316  x.x.x.x:49698  Idle client: Waiting for next request
561 Socket 28774    2910*    1058  x.x.x.x:64166  Reading next request
562 Socket  898    1211*    6180  x.x.x.x:443    https://domain.org
563 Socket   97     940*    1308  x.x.x.x:3376   Idle client: Waiting for next request
564 Socket    0     275*    4748  x.x.x.x:443      https://domain.org
565 Socket   15    1446*    1306  x.x.x.x:51817   Reading next request
566 Socket    0       0*       0  x.x.x.x:443    x.x.x.x pinned connection for x.x.x.x (324)
567 Socket    0  594802   827936  x.x.x.x:1344        x.x.x.x
568 Socket    0  303279   409733  x.x.x.x:1344        x.x.x.x
569 Socket  117    1849*     615  x.x.x.x:2304   Idle client: Waiting for next request
570 Socket    0    3110*    7764  x.x.x.x:443      https://domain.org
571 Socket    0   75913*    9544  x.x.x.x:443    https://domain.org
572 Socket   57     198*     286  x.x.x.x:55768   Idle client: Waiting for next request
573 Socket   27    2763*   51668  x.x.x.x:62577  Idle client: Waiting for next request
574 Socket    0    1025*    2184  x.x.x.x:443    https://domain.org
575 Socket   99   11511*  192197  x.x.x.x:50483   Idle client: Waiting for next request
576 Socket    0       0*       0  ::1:37181             ext_wbinfo_group_acl #3
577 Socket  113    1181*     629  x.x.x.x:51203   Idle client: Waiting for next request
578 Socket    0  125227   327390  x.x.x.x:1344        x.x.x.x
579 Socket    0   80821   222391  x.x.x.x:1344        x.x.x.x
580 Socket 28798       0        0  x.x.x.x:1841   client https start
581 Socket 28798       0        0  x.x.x.x:2321   client https start
582 Socket    0       0        0  x.x.x.x:443     x.x.x.x pinned connection for x.x.x.x (396)
583 Socket    0       0*       0  ::1:39025             ext_wbinfo_group_acl #4
584 Socket 28798       0        0  x.x.x.x:2322   client https start
585 Socket    0   67261    67974  x.x.x.x:1344        x.x.x.x
586 Socket  900  192830*    7818  x.x.x.x:443     https://domain.org
587 Socket    0  464123  1899880  x.x.x.x:1344        x.x.x.x
588 Socket    0   74290   182755  x.x.x.x:1344        x.x.x.x
589 Socket    0     647*    1728  x.x.x.x:443    https://domain.org
590 Socket    0       0*       0  x.x.x.x:443    x.x.x.x pinned connection for x.x.x.x (145)
591 Socket 28799       0        0  x.x.x.x:2323   client https start
592 Socket 28799       0        0  x.x.x.x:3201    client https start
593 Pipe      0   18335*   25554                        ssl_crtd #7
594 Socket   91     292*     452  x.x.x.x:52893  Idle client: Waiting for next request
595 Socket    0  302843  1136496  x.x.x.x:1344        x.x.x.x
596 Socket 28800       0        0  x.x.x.x:2386   client https start
597 Socket    0   86639   207373  x.x.x.x:1344        x.x.x.x
598 Socket    0       0*       0  x.x.x.x:443      x.x.x.x pinned connection for x.x.x.x (279)
599 Socket    0       0*       0  ::1:51769             ext_wbinfo_group_acl #5
600 Socket    0   71364   312248  x.x.x.x:1344        x.x.x.x
601 Socket    0  919397  1075737  x.x.x.x:1344        x.x.x.x
602 Socket    0  180943  1358113  x.x.x.x:1344        x.x.x.x
603 Socket 28799       0        0  x.x.x.x:3214    client https start
604 Socket    0     692*    1178  x.x.x.x:443    https://domain.org
605 Socket   62    7966*   12814  x.x.x.x:1230   Idle client: Waiting for next request
606 Socket    0     638*    7316  x.x.x.x:443    https://domain.org
607 Socket   23     306*     452  x.x.x.x:1767    Idle client: Waiting for next request
608 Socket 28799       0        0  x.x.x.x:3205    client https start
609 Socket    0   85591   164291  x.x.x.x:1344        x.x.x.x
610 Socket    0     692*    1198  x.x.x.x:443    https://domain.org
611 Socket 28785       0*       0  x.x.x.x:3183    client https start
612 Socket    0     692*    1178  x.x.x.x:443    https://domain.org
613 Socket    0       0*       0  x.x.x.x:443    x.x.x.x pinned connection for x.x.x.x (134)
614 Socket  900   28870*  195741* x.x.x.x:1344        x.x.x.x
615 Socket 28754       0        0  x.x.x.x:55092  client https start
616 Socket  118     390*   36111  x.x.x.x:2319   Idle client: Waiting for next request
617 Socket   98     555*    2252  x.x.x.x:60769  Idle client: Waiting for next request
618 Socket  299       0*       0  x.x.x.x:1828    client http connect
619 Socket    0  473529   793634  x.x.x.x:1344        x.x.x.x
620 Socket  900  450715*  716503  x.x.x.x:1344        x.x.x.x
621 Socket 28799       0        0  x.x.x.x:3202    client https start
622 Socket    0     692*    1184  x.x.x.x:443    https://domain.org
623 Socket  874   16754*   21876  x.x.x.x:443      https://domain.org
624 Socket 28788    4986*    1596  x.x.x.x:49406  Reading next request
625 Socket   98     482*     654  x.x.x.x:64171  Idle client: Waiting for next request
626 Pipe      0   14687*   22194                        ssl_crtd #8
627 Socket   59     210*    2635  x.x.x.x:1344        x.x.x.x
628 Socket    0  134507  1462114  x.x.x.x:1344        x.x.x.x
629 Socket    0  108885* 2533583* ::1:34453             squid_url_lookup.pl #1
630 Socket    0   72439   150972  x.x.x.x:1344        x.x.x.x
631 Socket 28799       0        0  x.x.x.x:3204    client https start
632 Socket  879     734*    6486  x.x.x.x:443    https://domain.org
633 Socket    0 1051410  1201280  x.x.x.x:1344        x.x.x.x
634 Socket 28799       0        0  x.x.x.x:3211    client https start
635 Socket  879     734*    6648  x.x.x.x:443    https://domain.org
636 Socket    0       0*       0  x.x.x.x:443     x.x.x.x pinned connection for x.x.x.x (611)
637 Socket    0  163962   604624  x.x.x.x:1344        x.x.x.x
638 Socket    0   48696*     856  x.x.x.x:443     https://domain.org
639 Socket    0  729827  1196381  x.x.x.x:1344        x.x.x.x
640 Socket    0  232516   347567  x.x.x.x:1344        x.x.x.x
641 Socket 28798    3754*  128113  x.x.x.x:2303   Reading next request
642 Socket    0  325777   602015  x.x.x.x:1344        x.x.x.x
643 Socket 28799       0        0  x.x.x.x:3213    client https start
644 Socket   18     397*     265  x.x.x.x:1258   Idle client: Waiting for next request
645 Socket   99    3596*     822  x.x.x.x:54417  Idle client: Waiting for next request
646 Pipe      0   14180*   21549                        ssl_crtd #9
647 Socket    0  571668  1758812  x.x.x.x:1344        x.x.x.x
648 Socket    0     252*    3372  x.x.x.x:443    https://domain.org
649 Socket    0   68228   116478  x.x.x.x:1344        x.x.x.x
650 Socket    0     582*    1818  x.x.x.x:443   https://domain.org
651 Pipe      0    7520*   11022                        ssl_crtd #10
652 Socket   90     435*     285  x.x.x.x:3386   Idle client: Waiting for next request
653 Socket 28799       0        0  x.x.x.x:3215    client https start
654 Socket   99    1110*    2214  x.x.x.x:60771  Idle client: Waiting for next request
655 Socket 28800       0        0  x.x.x.x:3218    client https connect
656 Socket    0     882*    1880  x.x.x.x:443    https://domain.org
657 Socket   59       0        0* x.x.x.x:80        domain.org
658 Socket    0    1283*    4442  x.x.x.x:443    https://domain.org
659 Socket    0       0        0  x.x.x.x:443    x.x.x.x pinned connection for x.x.x.x (807)
660 Socket   90     435*     285  x.x.x.x:3384   Idle client: Waiting for next request
661 Socket 28800       0        0  x.x.x.x:3224    client https start
662 Socket    0  365673   608482  x.x.x.x:1344        x.x.x.x
663 Socket    0   81625   110628  x.x.x.x:1344        x.x.x.x
664 Socket 28800     156*       0* ::1:35046             Reading next request
665 Socket   97    2215*    1279  x.x.x.x:51849   Idle client: Waiting for next request
666 Socket   90     435*     285  x.x.x.x:3385   Idle client: Waiting for next request
667 Socket    0     620*    1220  x.x.x.x:443    https://domain.org
668 Socket 28800     201*       0* x.x.x.x:50010  Reading next request
669 Socket    0  136145   440062  x.x.x.x:1344        x.x.x.x
670 Socket    0   17564*  323089* ::1:33603             squid_url_lookup.pl #2
671 Socket   91    2348*     343  x.x.x.x:60757  Idle client: Waiting for next request
672 Socket  118     421*   17488  x.x.x.x:51046  Idle client: Waiting for next request
673 Socket 28800       0        0  x.x.x.x:3228    client https start
674 Socket    0  168525*    3042  x.x.x.x:443    https://domain.org
675 Socket    0  449451  1179110  x.x.x.x:1344        x.x.x.x
676 Socket    0   81705   176401  x.x.x.x:1344        x.x.x.x
677 Socket 28800       0        0  x.x.x.x:3229    client https connect
678 Socket    0  607338   804760  x.x.x.x:1344        x.x.x.x
679 Socket    0       0*       0  x.x.x.x:443    x.x.x.x pinned connection for x.x.x.x (417)
680 Socket    0    7879*  141662  ::1:59195             squid_url_lookup.pl #3
681 Socket    0       0*       0  x.x.x.x:443    x.x.x.x pinned connection for x.x.x.x (387)
682 Socket    0       0*       0  x.x.x.x:443    x.x.x.x pinned connection for x.x.x.x (393)
683 Socket    0       0*       0  x.x.x.x:443    x.x.x.x pinned connection for x.x.x.x (70)
684 Socket 28800    5112*    2235  x.x.x.x:1838   Reading next request
685 Socket    0     586*     990  x.x.x.x:443    https://domain.org
686 Socket   99     482*     654  x.x.x.x:60032  Idle client: Waiting for next request
687 Socket    0    1065*   20404  x.x.x.x:443    https://domain.org
688 Socket    0    4874*   61424  ::1:48333             squid_url_lookup.pl #4
689 Socket    0  225785   342266  x.x.x.x:1344        x.x.x.x
690 Socket    0       0*       0  x.x.x.x:443    x.x.x.x pinned connection for x.x.x.x (484)
691 Socket    0  247595   638177  x.x.x.x:1344        x.x.x.x
692 Socket    0     544*    1104  x.x.x.x:443    https://domain.org
693 Socket    0   70387    70862  x.x.x.x:1344        x.x.x.x
694 Socket 27680       0*       0  x.x.x.x:56755   client https start
695 Socket  300       0*       0  x.x.x.x:60802  client http connect
696 Socket    0       0        0  x.x.x.x:3231    HTTP Request
697 Socket    0   67261    67986  x.x.x.x:1344        x.x.x.x
698 Socket    0    1129*    2870  x.x.x.x:443    https://domain.org
700 Socket    0       0*       0  x.x.x.x:443    x.x.x.x pinned connection for x.x.x.x (462)
702 Socket   18     402*     266  x.x.x.x:1262   Idle client: Waiting for next request
703 Socket    9    1338*     634  x.x.x.x:80     Idle server: x.x.x.x:80/some_path
704 Socket   58     491*  682630  x.x.x.x:62581  Idle client: Waiting for next request
705 Socket    0   67626    91631  x.x.x.x:1344        x.x.x.x
706 Socket    0   67780   149096  x.x.x.x:1344        x.x.x.x
707 Socket    0   93177   639083  x.x.x.x:1344        x.x.x.x
708 Socket    0  875386  1172221  x.x.x.x:1344        x.x.x.x
709 Socket  876     588*    3324  x.x.x.x:443    https://domain.org
710 Socket   19     444*     384  x.x.x.x:1265   Idle client: Waiting for next request
711 Socket   19     425*     384  x.x.x.x:1266   Idle client: Waiting for next request
712 Socket    0       0*       0  x.x.x.x:443    x.x.x.x pinned connection for x.x.x.x (218)
716 Socket   57     420*     158  x.x.x.x:62586  Idle client: Waiting for next request
717 Socket    0    1491*    1066  x.x.x.x:443      https://domain.org
719 Socket    0  169746*   21748  x.x.x.x:443    https://domain.org
720 Socket    0   17102*    2910  x.x.x.x:443    https://domain.org
721 Socket    0    3279*   43331  ::1:42983             squid_url_lookup.pl #5
722 Socket    0  256289   269402  x.x.x.x:1344        x.x.x.x
723 Socket    0    7714*    2384  x.x.x.x:443    https://domain.org
724 Socket    0    1830*   24920  ::1:47149             squid_url_lookup.pl #6
725 Socket    0       0*       0  x.x.x.x:443      x.x.x.x pinned connection for x.x.x.x (327)
726 Socket    0 1063154  1790141  x.x.x.x:1344        x.x.x.x
727 Socket    0     616*   13608  ::1:48873             squid_url_lookup.pl #7
729 Socket   18     329*    3506  x.x.x.x:1267   Idle client: Waiting for next request
730 Socket    0   67260    67952  x.x.x.x:1344        x.x.x.x
731 Socket    0   32251*   13544  x.x.x.x:443    https://domain.org
732 Socket    0   12614*   16036  x.x.x.x:443      https://domain.org
733 Socket    0     298*    5090  ::1:59995             squid_url_lookup.pl #8
734 Socket    0     638*    3252  x.x.x.x:443     https://domain.org
735 Socket    0     252*    2900  x.x.x.x:443    https://domain.org
736 Socket  900    2405*   10516  x.x.x.x:443    https://domain.org
737 Socket    0     241*    2542  ::1:44247             squid_url_lookup.pl #9
738 Socket    0  256065  1016479  x.x.x.x:1344        x.x.x.x
740 Socket    0   69188   114543  x.x.x.x:1344        x.x.x.x
741 Socket   97     940*    1308  x.x.x.x:3379   Idle client: Waiting for next request
742 Socket  900   41281*    1514  x.x.x.x:443    https://domain.org
743 Socket    0  681278  1185273  x.x.x.x:1344        x.x.x.x
744 Socket    0       0*       0  x.x.x.x:443    x.x.x.x pinned connection for x.x.x.x (306)
745 Socket  900    1082*   10628  x.x.x.x:443    https://domain.org
746 Socket    0    5718*    9764  x.x.x.x:443      https://domain.org
747 Socket    0     620*    1196  x.x.x.x:443    https://domain.org
748 Socket    0     207*    2293  ::1:33591             squid_url_lookup.pl #10
749 Socket    0       0        0  [::]:3128             HTTP Socket
750 Socket  876     592*    3568  x.x.x.x:443    https://domain.org
751 Socket    0       0        0  [::]:3129             HTTP Socket
752 Socket    0   71255   145856  x.x.x.x:1344        x.x.x.x
753 Socket    0       0*       0  x.x.x.x:443    x.x.x.x pinned connection for x.x.x.x (569)
754 Socket    0       0        0  [::]:3130             HTTPS Socket
755 Socket    0       0*       0  x.x.x.x:443    x.x.x.x pinned connection for x.x.x.x (490)
756 Socket    0   70375   184071  x.x.x.x:1344        x.x.x.x
758 Socket    0   68918   187587  x.x.x.x:1344        x.x.x.x
760 Socket    0  132072   189220  x.x.x.x:1344        x.x.x.x
762 Socket    0     367*    1280  x.x.x.x:443       https://domain.org
763 Socket    0   74474   206574  x.x.x.x:1344        x.x.x.x
764 Socket   87     482*     654  x.x.x.x:49665  Idle client: Waiting for next request
765 Socket    0       0        0  ::1:50813             pinger
766 File      0       0   993744                        /var/cache/squid/swap.state
767 Socket  893    2800*    9984  x.x.x.x:443    https://domain.org
769 Socket    0     537*    2414  x.x.x.x:443    https://domain.org
770 Socket    0     628*    3372  x.x.x.x:443    https://domain.org
771 Socket    0  306851   815547  x.x.x.x:1344        x.x.x.x
772 Socket   56     516*     676  x.x.x.x:54415  Idle client: Waiting for next request
773 Socket    0     620*    1196  x.x.x.x:443    https://domain.org
774 Socket    0   43044*    1098  x.x.x.x:443       https://domain.org
775 Socket    0    2458*     568  x.x.x.x:443     https://domain.org
776 Socket    0     173*     794  x.x.x.x:443    https://domain.org
777 Socket    0  131967   194732  x.x.x.x:1344        x.x.x.x
778 Socket    0   30285*    1720  x.x.x.x:443     https://domain.org
780 Socket  898    1213*    6800  x.x.x.x:443    https://domain.org
781 Socket  900    2103*   10472  x.x.x.x:443    https://domain.org
782 Socket    0    3627*   14436  x.x.x.x:443    https://domain.org
783 Socket    0     174*     804  x.x.x.x:443    https://domain.org
784 Socket    0  199486   463497  x.x.x.x:1344        x.x.x.x
785 Socket    0    1099*    4762  x.x.x.x:443    https://domain.org
787 Socket    0     316*     888  x.x.x.x:443   https://domain.org
790 Socket    0    2078*    2324  x.x.x.x:443      https://domain.org
791 Socket    0     316*     850  x.x.x.x:443   https://domain.org
792 Socket    0    2184*    1162  x.x.x.x:443      https://domain.org
793 Socket    0    2184*    1162  x.x.x.x:443      https://domain.org
794 Socket    0       0*       0  x.x.x.x:443    x.x.x.x pinned connection for x.x.x.x (202)
796 Socket    0 1290186  1774914  x.x.x.x:1344        x.x.x.x
797 Socket    0   67263    67949  x.x.x.x:1344        x.x.x.x
798 Socket    0       0*       0  x.x.x.x:443    x.x.x.x pinned connection for x.x.x.x (160)
799 Socket   99    7140*    3811  x.x.x.x:54406  Idle client: Waiting for next request
800 Socket    0   70622    74503  x.x.x.x:1344        x.x.x.x
801 Socket   27    2355*    1251  x.x.x.x:54407  Idle client: Waiting for next request
802 Socket    0    1154*    1136  x.x.x.x:443   https://domain.org
803 Socket    0   69578    75080  x.x.x.x:1344        x.x.x.x
804 Socket    0    1049*    1160  x.x.x.x:443   https://domain.org
805 Socket    0     976*    1136  x.x.x.x:443   https://domain.org
806 Socket    0    1261*    4482  x.x.x.x:443    https://domain.org
808 Socket  885     589*    3318  x.x.x.x:443    https://domain.org
809 Socket    0    1317*    4482  x.x.x.x:443    https://domain.org
810 Socket  900   82342*     866  x.x.x.x:443   https://domain.org
811 Socket    0     719*    1346  x.x.x.x:443    https://domain.org
812 Socket    0    1113*    1342  x.x.x.x:443     https://domain.org
814 Socket  855    2387*   13320  x.x.x.x:443    https://domain.org
815 Socket   27     500*     286  x.x.x.x:55764   Idle client: Waiting for next request
816 Socket    0 1080317  1867520  x.x.x.x:1344        x.x.x.x
820 Socket   66    1192*    7898  x.x.x.x:4110    Idle client: Waiting for next request
821 Socket    0    1025*   26932  x.x.x.x:443    https://domain.org
822 Socket    0   86033    89065  x.x.x.x:1344        x.x.x.x
823 Socket   59  326800*  558361  x.x.x.x:1344        x.x.x.x
824 Socket  893    5922*    5026  x.x.x.x:443      https://domain.org
826 Socket    0 1317411  1355916  x.x.x.x:1344        x.x.x.x
827 Pipe      0    7431*    9205                        ssl_crtd #4
828 Socket  895    6112*    8018  x.x.x.x:443      https://domain.org
829 Socket    0   67263    68003  x.x.x.x:1344        x.x.x.x
830 Socket    0   13653*   11470  x.x.x.x:443      https://domain.org
831 Pipe      0    4461*    5937                        ssl_crtd #5
832 Socket    0   98682   230913  x.x.x.x:1344        x.x.x.x
833 Socket    0   18285*    8984  x.x.x.x:443      https://domain.org
834 Socket    0 2769082  3379609  x.x.x.x:1344        x.x.x.x
835 Socket    0    5671*    8792  x.x.x.x:443      https://domain.org
837 Socket    0    6512*   11814  x.x.x.x:443      https://domain.org
838 Pipe      0    4461*    5937                        ssl_crtd #6
839 Socket    0     252*    2606  x.x.x.x:443    https://domain.org
840 Socket    0   67366    74962  x.x.x.x:1344        x.x.x.x
842 Socket    0   71312   221653  x.x.x.x:1344        x.x.x.x
846 Pipe      0    4461*    5937                        ssl_crtd #7
847 Socket    0  225360   346218  x.x.x.x:1344        x.x.x.x
849 Pipe      0    4461*    5937                        ssl_crtd #8
850 Socket    0    8137*    1042  x.x.x.x:443     https://domain.org
851 Socket  885     591*    2784  x.x.x.x:443    https://domain.org
852 Pipe      0       0*       0                        ssl_crtd #9
854 Socket    0    3983*    6570  x.x.x.x:443    https://domain.org
857 Pipe      0       0*       0                        ssl_crtd #10
869 Socket    0   40620*   32966  x.x.x.x:443      https://domain.org
870 Socket    0 4328494  4704878  x.x.x.x:1344        x.x.x.x
878 Socket    0   70812  1451399  x.x.x.x:1344        x.x.x.x
885 Socket    0  646465  1098283  x.x.x.x:1344        x.x.x.x
891 Socket    0  949722  1844840  x.x.x.x:1344        x.x.x.x
904 Socket  888    1837*   10128  x.x.x.x:443    https://domain.org
909 Socket    0   85268   151920  x.x.x.x:1344        x.x.x.x
911 Socket  831       0*    2354  x.x.x.x:443    https://domain.org
913 Socket    0   70315    70855  x.x.x.x:1344        x.x.x.x


I don't get it. There aren't that many active file descriptors (less than 1000).
Also, on low traffic (late evening) with no CPU or mem issues at all, mgr:filedescriptors shows that there are about 2500 active file descriptors.

The only two things I can think of that could mess with Squid are:

- squid_url_lookup.pl which is an external_acl_type perl script that does a MySQL lookup (ttl=86400 negative_ttl=86400 children-max=80 children-startup=10 children-idle=3 concurrency=8)

- c-icap content scanning with clamav and libarchive

If push comes to shove I might consider temporarily disabling one or both just to see what happens, but I'm not sure if that can really be the cause of a Squid process coming down to a crawl.

Thanks,

Vieri


From rousskov at measurement-factory.com  Thu Oct 26 22:43:18 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Thu, 26 Oct 2017 16:43:18 -0600
Subject: [squid-users] squid cpu usage
In-Reply-To: <2087507399.4185171.1509055107307@mail.yahoo.com>
References: <742455879.1992418.1508848440399.ref@mail.yahoo.com>
 <742455879.1992418.1508848440399@mail.yahoo.com>
 <efb11c97-0368-a8ff-c1be-9781ac450026@measurement-factory.com>
 <790628251.3784841.1509016514244@mail.yahoo.com>
 <5f672c1b-ce28-35f3-df09-982e9c76c9cc@measurement-factory.com>
 <2087507399.4185171.1509055107307@mail.yahoo.com>
Message-ID: <1d42585b-d96f-f261-fa2b-61b54b1641ef@measurement-factory.com>

On 10/26/2017 03:58 PM, Vieri wrote:

> I should've done this before, but I just took a second look at
> cache.log and found the following message repeated a few times before
> the 100% CPU issue:

> "Your cache is running out of filedescriptors"

That warning matches the dangerously low number of available descriptor
reported by your mgr:info:

> File descriptor usage for squid:
> Maximum number of file descriptors:   1024
> Largest file desc currently in use:    913
> Number of file desc currently in use:  791
> Files queued for open:                   0
> Available number of file descriptors:  233
> Reserved number of file descriptors:   100


> If this is the cause then I'm even more worried now because:
> 
> open files                      (-n) 16384

> # cat /etc/security/limits.d/01_squid.conf 
> * hard nofile 65535
> * soft nofile 16384

Your Squid does not know about the above configured limits. It thinks
the limit is 1024.


> I don't get it. There aren't that many active file descriptors (less than 1000).

~900 descriptors is "a lot" when the limit is 1024.


> Also, on low traffic (late evening) with no CPU or mem issues at all,
> mgr:filedescriptors shows that there are about 2500 active file
> descriptors.

Please note that "2500 active descriptors" contradicts the 1024 limit
reported in mgr:info in your earlier email (quoted by me above). Squid
also reports the limit at startup. Here is an example (not from your logs):

> 2017/10/26 15:48:04.744| With 65535 file descriptors available


There are many email threads and probably some wiki documents that
discuss increasing the number of file descriptors available to your
Squid and numerous related caveats.


Cheers,

Alex.


From yvoinov at gmail.com  Fri Oct 27 00:06:48 2017
From: yvoinov at gmail.com (Yuri)
Date: Fri, 27 Oct 2017 06:06:48 +0600
Subject: [squid-users] Squid regex grammar
Message-ID: <0fa85075-13e5-410f-20d1-a270ce558167@gmail.com>

Just for clarify (it is not well-documented. At least I can't find any
documentation about):

Squid's regex supports only POSIX Basic grammar?

-- 
**************************
* C++: Bug to the future *
**************************

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171027/ff466eb7/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171027/ff466eb7/attachment.sig>

From squid3 at treenet.co.nz  Fri Oct 27 06:01:27 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Fri, 27 Oct 2017 19:01:27 +1300
Subject: [squid-users] Squid regex grammar
In-Reply-To: <0fa85075-13e5-410f-20d1-a270ce558167@gmail.com>
References: <0fa85075-13e5-410f-20d1-a270ce558167@gmail.com>
Message-ID: <788b0bc8-9246-b38d-9fe8-23e7fe147dda@treenet.co.nz>

On 27/10/17 13:06, Yuri wrote:
> Just for clarify (it is not well-documented. At least I can't find any
> documentation about):
> 
> Squid's regex supports only POSIX Basic grammar?
> 

The specific grammar depends on your regex library used to build Squid, 
so YMMV.

Basic POSIX is the only portable grammar that *all* regex libraries can 
be expected to support. So Squid does not officially support other 
grammars (yet) even if they work in your particular build.

Amos


From rentorbuy at yahoo.com  Fri Oct 27 07:05:55 2017
From: rentorbuy at yahoo.com (Vieri)
Date: Fri, 27 Oct 2017 07:05:55 +0000 (UTC)
Subject: [squid-users] squid cpu usage
In-Reply-To: <1d42585b-d96f-f261-fa2b-61b54b1641ef@measurement-factory.com>
References: <742455879.1992418.1508848440399.ref@mail.yahoo.com>
 <742455879.1992418.1508848440399@mail.yahoo.com>
 <efb11c97-0368-a8ff-c1be-9781ac450026@measurement-factory.com>
 <790628251.3784841.1509016514244@mail.yahoo.com>
 <5f672c1b-ce28-35f3-df09-982e9c76c9cc@measurement-factory.com>
 <2087507399.4185171.1509055107307@mail.yahoo.com>
 <1d42585b-d96f-f261-fa2b-61b54b1641ef@measurement-factory.com>
Message-ID: <1020871781.4395613.1509087955443@mail.yahoo.com>


> From: Alex Rousskov <rousskov at measurement-factory.com>
>
>> # cat /etc/security/limits.d/01_squid.conf 
>> * hard nofile 65535
>> * soft nofile 16384
>
> Your Squid does not know about the above configured limits. It thinks the limit is 1024.


That's interesting.

# grep "file descriptors available" cache.log
2017/10/24 11:49:33 kid1| With 1024 file descriptors available
2017/10/24 12:57:10 kid1| With 16384 file descriptors available
2017/10/24 12:57:52 kid1| With 16384 file descriptors available
2017/10/25 05:50:32 kid1| With 1024 file descriptors available
2017/10/25 09:20:15 kid1| With 1024 file descriptors available
2017/10/25 10:00:15 kid1| With 1024 file descriptors available
2017/10/25 12:00:15 kid1| With 1024 file descriptors available
2017/10/25 13:00:16 kid1| With 1024 file descriptors available
2017/10/25 13:20:16 kid1| With 1024 file descriptors available
2017/10/25 14:00:15 kid1| With 1024 file descriptors available
2017/10/26 04:09:30 kid1| With 1024 file descriptors available
2017/10/26 10:57:45 kid1| With 16384 file descriptors available

The issues I reported yesterday came up after 2017/10/26 04:09:30, so here's the relevant part in the log:

2017/10/26 04:09:27 kid1| Reconfiguring Squid Cache (version 3.5.27-20170916-re69e56c)...
2017/10/26 04:09:27 kid1| Closing HTTP port [::]:3128
2017/10/26 04:09:27 kid1| Closing HTTP port [::]:3129
2017/10/26 04:09:27 kid1| Closing HTTPS port [::]:3130
2017/10/26 04:09:27 kid1| Closing Pinger socket on FD 801
2017/10/26 04:09:27 kid1| Logfile: closing log daemon:/var/log/squid/access.log
2017/10/26 04:09:27 kid1| Logfile Daemon: closing log daemon:/var/log/squid/access.log
2017/10/26 04:09:27 kid1| FATAL: dying from an unhandled exception: IsConnOpen(conn)
2017/10/26 04:09:30| Pinger exiting.
2017/10/26 04:09:30 kid1| Set Current Directory to /var/cache/squid
2017/10/26 04:09:30 kid1| Starting Squid Cache version 3.5.27-20170916-re69e56c for x86_64-pc-linux-gnu...
2017/10/26 04:09:30 kid1| Service Name: squid
2017/10/26 04:09:30 kid1| Process ID 22581
2017/10/26 04:09:30 kid1| Process Roles: worker
2017/10/26 04:09:30 kid1| With 1024 file descriptors available

A "reload" was issued at that time.

When my openrc init script reloads, it runs the following command:

# /etc/init.d/squid reload
* Reloading squid with /usr/sbin/squid -k reconfigure -f /etc/squid/squid.conf -n squid ...                                                            [ ok ]

I issued another "reload" today, and I didn't come up with any "file descriptors available" messages in cache.log (as expected).
I also checked mgr:info, and all seems OK:

File descriptor usage for squid:
Maximum number of file descriptors:   16384
Largest file desc currently in use:   3067
Number of file desc currently in use: 2901
Files queued for open:                   0
Available number of file descriptors: 13483
Reserved number of file descriptors:   100
Store Disk files open:                   0

I also grep'ed for the log lines around "2017/10/25 05:50:32 kid1| With 1024 file descriptors available" where I see 1024 file descriptors for the first time.
It was a clean restart (with no "FATAL" error message).
The "restart" command was launched from crontab as a daily job (calling the openrc init script) just like it is launched at boot time from openrc (when the number of file descriptors is "as expected").

In particular, I have: KRB5_KTNAME="/etc/krb5.keytab" /usr/sbin/squid -YC -f /etc/squid/squid.conf -n squid

I'm wondering why Squid only detected 1024 file descriptors available after that restart.

Moving back in time:

- "2017/10/24 12:57:52 kid1| With 16384 file descriptors available" was probably a manual restart on my behalf (passing "restart" to the init script on the console).

- the one right before (2017/10/24 12:57:10) was probably also a manual restart as the init script probably exited non-zero due to an error I found in the log: "FATAL: dying from an unhandled exception: IsConnOpen(conn)"

- moving back a little (11:49:30), I had a "reload" with a fatal error:

2017/10/24 11:49:30.406 kid1| Reconfiguring Squid Cache (version 3.5.27-20170916-re69e56c)...
2017/10/24 11:49:30.406 kid1| Closing HTTP port [::]:3128
2017/10/24 11:49:30.406 kid1| Closing HTTP port [::]:3129
2017/10/24 11:49:30.406 kid1| Closing HTTPS port [::]:3130
2017/10/24 11:49:30.406 kid1| Closing Pinger socket on FD 788
2017/10/24 11:49:30.406 kid1| Logfile: closing log daemon:/var/log/squid/access.log
2017/10/24 11:49:30.406 kid1| Logfile Daemon: closing log daemon:/var/log/squid/access.log
2017/10/24 11:49:30.406 kid1| FATAL: dying from an unhandled exception: IsConnOpen(conn)
2017/10/24 11:49:33 kid1| Set Current Directory to /var/cache/squid
2017/10/24 11:49:33 kid1| Starting Squid Cache version 3.5.27-20170916-re69e56c for x86_64-pc-linux-gnu...
2017/10/24 11:49:33 kid1| Service Name: squid
2017/10/24 11:49:33 kid1| Process ID 30753
2017/10/24 11:49:33 kid1| Process Roles: worker
2017/10/24 11:49:33 kid1| With 1024 file descriptors available

- searching within the older rotated cache.log files I noticed this:

2017/10/20 10:42:12 kid1| With 16384 file descriptors available
2017/10/21 05:50:32 kid1| With 1024 file descriptors available

The restart at 05:50:32 is performed by a cron job.

Conclusion: it seems that the cron daemon I use (https://github.com/cronie-crond/cronie) is not honoring system-wide ulimits defined in /etc/security/limits.d/* as, eg.:
* hard nofile 65535
* soft nofile 16384

Weird.

I'm not going to be using the cron job anymore.

Thanks,

Vieri


From rentorbuy at yahoo.com  Fri Oct 27 07:22:12 2017
From: rentorbuy at yahoo.com (Vieri)
Date: Fri, 27 Oct 2017 07:22:12 +0000 (UTC)
Subject: [squid-users] Authentication not applicable on intercepted requests
References: <901873509.4402527.1509088932155.ref@mail.yahoo.com>
Message-ID: <901873509.4402527.1509088932155@mail.yahoo.com>

Hi,

I have:

debug_options rotate=1 ALL,1

and I'm getting lots of these messages in cache.log:

NOTICE: Authentication not applicable on intercepted requests.

I have a mixed tproxy/sslbump + auth (via /usr/libexec/squid/negotiate_kerberos_auth) config. I know authentication can't be done on intercepted requests.
I'd like to know how to fix my squid conf file in order to avoid logging this message.

The relevant parts of my squid.conf should be:

external_acl_type nt_group ttl=0 children-max=50 %LOGIN /usr/libexec/squid/ext_wbinfo_group_acl -K

auth_param negotiate program /usr/libexec/squid/negotiate_kerberos_auth -s HTTP/myserver.mydomain.org at MYDOMAIN.ORG
auth_param negotiate children 60
auth_param negotiate keep_alive on

auth_param basic realm My REALM proxy

acl localnet src 10.0.0.0/8
acl localnet src 192.168.0.0/16

acl ORG_all proxy_auth REQUIRED

acl explicit myportname 3128
acl intercepted myportname 3129
acl interceptedssl myportname 3130

[...]
acl allowed_groups external nt_group "/opt/proxy-settings/allowed.groups"
[...]
acl restricted_groups external nt_group "/opt/proxy-settings/restricted.groups"

[...]
http_access deny SSL_ports ORG_all
http_access deny explicit !ORG_all
#http_access deny intercepted ORG_all
#http_access deny interceptedssl ORG_all
http_access deny intercepted !localnet
http_access deny interceptedssl !localnet

[...]
debug_options rotate=1 ALL,1
[...]
http_port 3128
http_port 3129 tproxy
https_port 3130 tproxy ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=16MB cert=/etc/ssl/squid/proxyserver.pem
sslcrtd_program /usr/libexec/squid/ssl_crtd -s /var/lib/squid/ssl_db -M 16MB
sslcrtd_children 40 startup=20 idle=10

reply_header_access Alternate-Protocol deny all
ssl_bump stare all
ssl_bump bump all
[...]

Thanks,

Vieri


From squid3 at treenet.co.nz  Fri Oct 27 13:50:12 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 28 Oct 2017 02:50:12 +1300
Subject: [squid-users] Authentication not applicable on intercepted
 requests
In-Reply-To: <901873509.4402527.1509088932155@mail.yahoo.com>
References: <901873509.4402527.1509088932155.ref@mail.yahoo.com>
 <901873509.4402527.1509088932155@mail.yahoo.com>
Message-ID: <04b26f85-b231-7bb9-627a-a19a9f5fe379@treenet.co.nz>

On 27/10/17 20:22, Vieri wrote:
> Hi,
> 
> I have:
> 
> debug_options rotate=1 ALL,1
> 
> and I'm getting lots of these messages in cache.log:
> 
> NOTICE: Authentication not applicable on intercepted requests.
> 
> I have a mixed tproxy/sslbump + auth (via /usr/libexec/squid/negotiate_kerberos_auth) config. I know authentication can't be done on intercepted requests.
> I'd like to know how to fix my squid conf file in order to avoid logging this message.
> 
> The relevant parts of my squid.conf should be:
> 
> external_acl_type nt_group ttl=0 children-max=50 %LOGIN /usr/libexec/squid/ext_wbinfo_group_acl -K
> 
> auth_param negotiate program /usr/libexec/squid/negotiate_kerberos_auth -s HTTP/myserver.mydomain.org at MYDOMAIN.ORG
> auth_param negotiate children 60
> auth_param negotiate keep_alive on
> 
> auth_param basic realm My REALM proxy
> 

You do not seem to be using Basic auth. Setting the realm for an unused 
auth mechanism is pointless.

> acl localnet src 10.0.0.0/8
> acl localnet src 192.168.0.0/16
> 
> acl ORG_all proxy_auth REQUIRED
> 
> acl explicit myportname 3128
> acl intercepted myportname 3129
> acl interceptedssl myportname 3130
> 
> [...]
> acl allowed_groups external nt_group "/opt/proxy-settings/allowed.groups"
> [...]
> acl restricted_groups external nt_group "/opt/proxy-settings/restricted.groups"
> 
> [...]
> http_access deny SSL_ports ORG_all
> http_access deny explicit !ORG_all
> #http_access deny intercepted ORG_all
> #http_access deny interceptedssl ORG_all
> http_access deny intercepted !localnet
> http_access deny interceptedssl !localnet
> 

Try:
   http_access deny explicit !ORG_all
   http_access deny explicit SSL_ports
   http_access deny intercepted !localnet
   http_access deny interceptedssl !localnet


Amos


From yvoinov at gmail.com  Fri Oct 27 13:59:30 2017
From: yvoinov at gmail.com (Yuri)
Date: Fri, 27 Oct 2017 19:59:30 +0600
Subject: [squid-users] Squid regex grammar
In-Reply-To: <788b0bc8-9246-b38d-9fe8-23e7fe147dda@treenet.co.nz>
References: <0fa85075-13e5-410f-20d1-a270ce558167@gmail.com>
 <788b0bc8-9246-b38d-9fe8-23e7fe147dda@treenet.co.nz>
Message-ID: <b1dbeff3-13f3-dd15-f7b5-aa61f1569a48@gmail.com>



27.10.2017 12:01, Amos Jeffries ?????:
> On 27/10/17 13:06, Yuri wrote:
>> Just for clarify (it is not well-documented. At least I can't find any
>> documentation about):
>>
>> Squid's regex supports only POSIX Basic grammar?
>>
>
> The specific grammar depends on your regex library used to build
> Squid, so YMMV.
>
> Basic POSIX is the only portable grammar that *all* regex libraries
> can be expected to support. So Squid does not officially support other
> grammars (yet) even if they work in your particular build.
That's why I'm asking that the POSIX Extended in the Squid does not
work. And it is not well documented anywhere. And there is no easy way
to check what regex library Squid uses.

I'm trying to find it in configuration, found that:
root @ cthulhu /patch/squid-5.0.0-patched-v2.26 # ./configure
--help|grep regex
? --enable-gnuregex?????? Compile GNUregex. Unless you have reason to
use this
????????????????????????? Unix boxes which do not have their own regex
library

Then see ldd:

root @ cthulhu /patch/squid-5.0.0-patched-v2.26 # ldd
/usr/local/squid/sbin/squid??????? libpthread.so.1 =>??????
/lib/64/libpthread.so.1
??????? libnettle.so.6 =>??????? /opt/csw/lib/amd64/libnettle.so.6
??????? libmd5.so.1 =>?? /lib/64/libmd5.so.1
??????? libecap.so.3 =>? /usr/local/lib/libecap.so.3
??????? libatomic.so.1 =>??????? /opt/csw/lib/amd64/libatomic.so.1
??????? libssl.so.1.0.0 =>?????? /opt/csw/lib/amd64/libssl.so.1.0.0
??????? libcrypto.so.1.0.0 =>??? /opt/csw/lib/amd64/libcrypto.so.1.0.0
??????? libkrb5.so.1 =>? /usr/lib/64/libkrb5.so.1
??????? libstdc++.so.6 =>??????? /opt/csw/lib/amd64/libstdc++.so.6
??????? libsocket.so.1 =>??????? /lib/64/libsocket.so.1
??????? libresolv.so.2 =>??????? /lib/64/libresolv.so.2
??????? libnsl.so.1 =>?? /lib/64/libnsl.so.1
??????? libltdl.so.7 =>? /opt/csw/lib/amd64/libltdl.so.7
??????? libm.so.2 =>???? /lib/64/libm.so.2
??????? librt.so.1 =>??? /lib/64/librt.so.1
??????? libgcc_s.so.1 =>???????? /opt/csw/lib/amd64/libgcc_s.so.1
??????? libc.so.1 =>???? /lib/64/libc.so.1
??????? libmp.so.2 =>??? /lib/64/libmp.so.2
??????? libmd.so.1 =>??? /lib/64/libmd.so.1
??????? libscf.so.1 =>?? /lib/64/libscf.so.1
??????? libaio.so.1 =>?? /lib/64/libaio.so.1
??????? libdoor.so.1 =>? /lib/64/libdoor.so.1
??????? libuutil.so.1 =>???????? /lib/64/libuutil.so.1
??????? libgen.so.1 =>?? /lib/64/libgen.so.1
??????? mech_krb5.so.1 =>??????? /usr/lib/64/gss/mech_krb5.so.1
??????? libgss.so.1 =>?? /usr/lib/64/libgss.so.1
??????? libpkcs11.so.1 =>??????? /usr/lib/64/libpkcs11.so.1
??????? libcmd.so.1 =>?? /lib/64/libcmd.so.1
??????? libcryptoutil.so.1 =>??? /usr/lib/64/libcryptoutil.so.1

From this output, you can not determine the regular expression library
that is being used. Although maybe I'm just not looking there.

Experimentally, I was able to find out that the grammar of POSIX
Extended does not work in any case.

However, I believe that such things should be well documented, otherwise
the regular expression is simply silently ignored and it is extremely
difficult to detect.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
**************************
* C++: Bug to the future *
**************************

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171027/17b11680/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171027/17b11680/attachment.sig>

From squid3 at treenet.co.nz  Fri Oct 27 14:32:03 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Sat, 28 Oct 2017 03:32:03 +1300
Subject: [squid-users] Squid regex grammar
In-Reply-To: <b1dbeff3-13f3-dd15-f7b5-aa61f1569a48@gmail.com>
References: <0fa85075-13e5-410f-20d1-a270ce558167@gmail.com>
 <788b0bc8-9246-b38d-9fe8-23e7fe147dda@treenet.co.nz>
 <b1dbeff3-13f3-dd15-f7b5-aa61f1569a48@gmail.com>
Message-ID: <4fbea726-2ec4-f2f5-adaa-1052b9cb19fe@treenet.co.nz>

On 28/10/17 02:59, Yuri wrote:
> 
> 
> 27.10.2017 12:01, Amos Jeffries ?????:
>> On 27/10/17 13:06, Yuri wrote:
>>> Just for clarify (it is not well-documented. At least I can't find any
>>> documentation about):
>>>
>>> Squid's regex supports only POSIX Basic grammar?
>>>
>>
>> The specific grammar depends on your regex library used to build
>> Squid, so YMMV.
>>
>> Basic POSIX is the only portable grammar that *all* regex libraries
>> can be expected to support. So Squid does not officially support other
>> grammars (yet) even if they work in your particular build.
> That's why I'm asking that the POSIX Extended in the Squid does not
> work. And it is not well documented anywhere. And there is no easy way
> to check what regex library Squid uses.
> 
> I'm trying to find it in configuration, found that:
> root @ cthulhu /patch/squid-5.0.0-patched-v2.26 # ./configure
> --help|grep regex
>  ? --enable-gnuregex?????? Compile GNUregex. Unless you have reason to
> use this
>  ????????????????????????? Unix boxes which do not have their own regex
> library
> 

The full text there is:
  "
   --enable-gnuregex

   Compile GNUregex. Unless you have reason to use this
   option, you should not enable it. This library file
   is usually only required on Windows and very old
   Unix boxes which do not have their own regex library
   built in.
"

If you *dont* override the local environment by setting that build 
option Squid uses whatever your build tools link to with "-lregex".

> Then see ldd:
> 
> root @ cthulhu /patch/squid-5.0.0-patched-v2.26 # ldd
> /usr/local/squid/sbin/squid??????? libpthread.so.1 =>
> /lib/64/libpthread.so.1
>  ??????? libnettle.so.6 =>??????? /opt/csw/lib/amd64/libnettle.so.6
>  ??????? libmd5.so.1 =>?? /lib/64/libmd5.so.1
>  ??????? libecap.so.3 =>? /usr/local/lib/libecap.so.3
>  ??????? libatomic.so.1 =>??????? /opt/csw/lib/amd64/libatomic.so.1
>  ??????? libssl.so.1.0.0 =>?????? /opt/csw/lib/amd64/libssl.so.1.0.0
>  ??????? libcrypto.so.1.0.0 =>??? /opt/csw/lib/amd64/libcrypto.so.1.0.0
>  ??????? libkrb5.so.1 =>? /usr/lib/64/libkrb5.so.1
>  ??????? libstdc++.so.6 =>??????? /opt/csw/lib/amd64/libstdc++.so.6
>  ??????? libsocket.so.1 =>??????? /lib/64/libsocket.so.1
>  ??????? libresolv.so.2 =>??????? /lib/64/libresolv.so.2
>  ??????? libnsl.so.1 =>?? /lib/64/libnsl.so.1
>  ??????? libltdl.so.7 =>? /opt/csw/lib/amd64/libltdl.so.7
>  ??????? libm.so.2 =>???? /lib/64/libm.so.2
>  ??????? librt.so.1 =>??? /lib/64/librt.so.1
>  ??????? libgcc_s.so.1 =>???????? /opt/csw/lib/amd64/libgcc_s.so.1
>  ??????? libc.so.1 =>???? /lib/64/libc.so.1
>  ??????? libmp.so.2 =>??? /lib/64/libmp.so.2
>  ??????? libmd.so.1 =>??? /lib/64/libmd.so.1
>  ??????? libscf.so.1 =>?? /lib/64/libscf.so.1
>  ??????? libaio.so.1 =>?? /lib/64/libaio.so.1
>  ??????? libdoor.so.1 =>? /lib/64/libdoor.so.1
>  ??????? libuutil.so.1 =>???????? /lib/64/libuutil.so.1
>  ??????? libgen.so.1 =>?? /lib/64/libgen.so.1
>  ??????? mech_krb5.so.1 =>??????? /usr/lib/64/gss/mech_krb5.so.1
>  ??????? libgss.so.1 =>?? /usr/lib/64/libgss.so.1
>  ??????? libpkcs11.so.1 =>??????? /usr/lib/64/libpkcs11.so.1
>  ??????? libcmd.so.1 =>?? /lib/64/libcmd.so.1
>  ??????? libcryptoutil.so.1 =>??? /usr/lib/64/libcryptoutil.so.1
> 
>  From this output, you can not determine the regular expression library
> that is being used. Although maybe I'm just not looking there.
> 

I believe the -lregex ABI is presented by libstdc++ nowdays since regex 
was made part of the C++11 standard library. So quite difficult to see.

OR, if that Squid was built with the GNUregex setting it will show up in 
"squid -v" output rather than the ldd dependency list.


> Experimentally, I was able to find out that the grammar of POSIX
> Extended does not work in any case.
> 
> However, I believe that such things should be well documented, otherwise
> the regular expression is simply silently ignored and it is extremely
> difficult to detect.

That sounds like a library problem. If Squid receives a regex error code 
from the library when compiling any regex from your squid.conf it logs 
the relevant error to cache.log.

Amos


From yvoinov at gmail.com  Fri Oct 27 14:49:44 2017
From: yvoinov at gmail.com (Yuri)
Date: Fri, 27 Oct 2017 20:49:44 +0600
Subject: [squid-users] Squid regex grammar
In-Reply-To: <4fbea726-2ec4-f2f5-adaa-1052b9cb19fe@treenet.co.nz>
References: <0fa85075-13e5-410f-20d1-a270ce558167@gmail.com>
 <788b0bc8-9246-b38d-9fe8-23e7fe147dda@treenet.co.nz>
 <b1dbeff3-13f3-dd15-f7b5-aa61f1569a48@gmail.com>
 <4fbea726-2ec4-f2f5-adaa-1052b9cb19fe@treenet.co.nz>
Message-ID: <a851eec3-946e-70b0-1d9c-10d172f89508@gmail.com>



27.10.2017 20:32, Amos Jeffries ?????:
> On 28/10/17 02:59, Yuri wrote:
>>
>>
>> 27.10.2017 12:01, Amos Jeffries ?????:
>>> On 27/10/17 13:06, Yuri wrote:
>>>> Just for clarify (it is not well-documented. At least I can't find any
>>>> documentation about):
>>>>
>>>> Squid's regex supports only POSIX Basic grammar?
>>>>
>>>
>>> The specific grammar depends on your regex library used to build
>>> Squid, so YMMV.
>>>
>>> Basic POSIX is the only portable grammar that *all* regex libraries
>>> can be expected to support. So Squid does not officially support other
>>> grammars (yet) even if they work in your particular build.
>> That's why I'm asking that the POSIX Extended in the Squid does not
>> work. And it is not well documented anywhere. And there is no easy way
>> to check what regex library Squid uses.
>>
>> I'm trying to find it in configuration, found that:
>> root @ cthulhu /patch/squid-5.0.0-patched-v2.26 # ./configure
>> --help|grep regex
>> ?? --enable-gnuregex?????? Compile GNUregex. Unless you have reason to
>> use this
>> ?????????????????????????? Unix boxes which do not have their own regex
>> library
>>
>
> The full text there is:
> ?"
> ? --enable-gnuregex
>
> ? Compile GNUregex. Unless you have reason to use this
> ? option, you should not enable it. This library file
> ? is usually only required on Windows and very old
> ? Unix boxes which do not have their own regex library
> ? built in.
> "
>
> If you *dont* override the local environment by setting that build
> option Squid uses whatever your build tools link to with "-lregex".
>
>> Then see ldd:
>>
>> root @ cthulhu /patch/squid-5.0.0-patched-v2.26 # ldd
>> /usr/local/squid/sbin/squid??????? libpthread.so.1 =>
>> /lib/64/libpthread.so.1
>> ???????? libnettle.so.6 =>??????? /opt/csw/lib/amd64/libnettle.so.6
>> ???????? libmd5.so.1 =>?? /lib/64/libmd5.so.1
>> ???????? libecap.so.3 =>? /usr/local/lib/libecap.so.3
>> ???????? libatomic.so.1 =>??????? /opt/csw/lib/amd64/libatomic.so.1
>> ???????? libssl.so.1.0.0 =>?????? /opt/csw/lib/amd64/libssl.so.1.0.0
>> ???????? libcrypto.so.1.0.0 =>??? /opt/csw/lib/amd64/libcrypto.so.1.0.0
>> ???????? libkrb5.so.1 =>? /usr/lib/64/libkrb5.so.1
>> ???????? libstdc++.so.6 =>??????? /opt/csw/lib/amd64/libstdc++.so.6
>> ???????? libsocket.so.1 =>??????? /lib/64/libsocket.so.1
>> ???????? libresolv.so.2 =>??????? /lib/64/libresolv.so.2
>> ???????? libnsl.so.1 =>?? /lib/64/libnsl.so.1
>> ???????? libltdl.so.7 =>? /opt/csw/lib/amd64/libltdl.so.7
>> ???????? libm.so.2 =>???? /lib/64/libm.so.2
>> ???????? librt.so.1 =>??? /lib/64/librt.so.1
>> ???????? libgcc_s.so.1 =>???????? /opt/csw/lib/amd64/libgcc_s.so.1
>> ???????? libc.so.1 =>???? /lib/64/libc.so.1
>> ???????? libmp.so.2 =>??? /lib/64/libmp.so.2
>> ???????? libmd.so.1 =>??? /lib/64/libmd.so.1
>> ???????? libscf.so.1 =>?? /lib/64/libscf.so.1
>> ???????? libaio.so.1 =>?? /lib/64/libaio.so.1
>> ???????? libdoor.so.1 =>? /lib/64/libdoor.so.1
>> ???????? libuutil.so.1 =>???????? /lib/64/libuutil.so.1
>> ???????? libgen.so.1 =>?? /lib/64/libgen.so.1
>> ???????? mech_krb5.so.1 =>??????? /usr/lib/64/gss/mech_krb5.so.1
>> ???????? libgss.so.1 =>?? /usr/lib/64/libgss.so.1
>> ???????? libpkcs11.so.1 =>??????? /usr/lib/64/libpkcs11.so.1
>> ???????? libcmd.so.1 =>?? /lib/64/libcmd.so.1
>> ???????? libcryptoutil.so.1 =>??? /usr/lib/64/libcryptoutil.so.1
>>
>> ?From this output, you can not determine the regular expression library
>> that is being used. Although maybe I'm just not looking there.
>>
>
> I believe the -lregex ABI is presented by libstdc++ nowdays since
> regex was made part of the C++11 standard library. So quite difficult
> to see.
Does not fit, Amos. The standard C ++ library for regular expressions
uses the ECMAScript syntax by default. AFAIK.

But acl's regexes behaviour demonstrate POSIX Basic behaviour. This is
simple to check:
\w and \d metacharacters does not work in regex acl's.
>
> OR, if that Squid was built with the GNUregex setting it will show up
> in "squid -v" output rather than the ldd dependency list.
>
>
>> Experimentally, I was able to find out that the grammar of POSIX
>> Extended does not work in any case.
>>
>> However, I believe that such things should be well documented, otherwise
>> the regular expression is simply silently ignored and it is extremely
>> difficult to detect.
>
> That sounds like a library problem. If Squid receives a regex error
> code from the library when compiling any regex from your squid.conf it
> logs the relevant error to cache.log.
Don't think so. Because of same behaviour demostrates on another server
with another platform (OS) with similar squid's
configuration/version/configs. And I see not any regex error in cache.log.

I want to clarify. I asked the question not because there are some
errors. And because the regular expressions in the ECMAScript syntax do
not work in the ACL. Without any errors. Just simple ignores acl parts
with ECMAS grammar constructions.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
**************************
* C++: Bug to the future *
**************************

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171027/696bdb17/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171027/696bdb17/attachment.sig>

From rousskov at measurement-factory.com  Fri Oct 27 14:55:26 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 27 Oct 2017 08:55:26 -0600
Subject: [squid-users] Squid regex grammar
In-Reply-To: <4fbea726-2ec4-f2f5-adaa-1052b9cb19fe@treenet.co.nz>
References: <0fa85075-13e5-410f-20d1-a270ce558167@gmail.com>
 <788b0bc8-9246-b38d-9fe8-23e7fe147dda@treenet.co.nz>
 <b1dbeff3-13f3-dd15-f7b5-aa61f1569a48@gmail.com>
 <4fbea726-2ec4-f2f5-adaa-1052b9cb19fe@treenet.co.nz>
Message-ID: <0b2cbff3-76f9-37cd-b389-0f2631a05757@measurement-factory.com>

On 10/27/2017 08:32 AM, Amos Jeffries wrote:
> On 28/10/17 02:59, Yuri wrote:
>> the regular expression is simply silently ignored and it is extremely
>> difficult to detect.

> That sounds like a library problem. If Squid receives a regex error code
> from the library when compiling any regex from your squid.conf it logs
> the relevant error to cache.log.

When a regular expression is using extended features, the basic regular
expression compiler often (or even always?!) does not fail because it
views the extended features as ordinary plain characters. Thus, Squid
cannot tell that something went wrong.

I cannot give a Squid-based example quickly, but here is a related
illustration using grep (which is not exactly the same as what happens
inside Squid, but I suspect it is similar enough for the illustration
purposes in this context):

> $ echo "foobar" | grep --basic-regexp    'foo|bar'
> $ echo "foobar" | grep --extended-regexp 'foo|bar'
> foobar

As you can see, the basic compiler is silent about the "|" character
that it does not support. Here is a similar example where a malformed
extended regular expression is silently accepted by the basic compiler:


> $ echo "foobar" | grep --basic-regexp 'foo(bar'
> $ echo "foobar" | grep --extended-regexp 'foo(bar'
> grep: Unmatched ( or \(


In theory, Squid itself could detect special characters unsupported by
the current regex library but doing so correctly without breaking many
existing working configurations may be impossible. On the other hand,
this validation could become an optional feature that admins can control.

The best strategy for a Squid admin working with complex regex ACLs may
be to add external test cases that validate ACL matching expectations,
but doing so requires significant amount of work and discipline.

Alex.


From yvoinov at gmail.com  Fri Oct 27 15:06:01 2017
From: yvoinov at gmail.com (Yuri)
Date: Fri, 27 Oct 2017 21:06:01 +0600
Subject: [squid-users] Squid regex grammar
In-Reply-To: <0b2cbff3-76f9-37cd-b389-0f2631a05757@measurement-factory.com>
References: <0fa85075-13e5-410f-20d1-a270ce558167@gmail.com>
 <788b0bc8-9246-b38d-9fe8-23e7fe147dda@treenet.co.nz>
 <b1dbeff3-13f3-dd15-f7b5-aa61f1569a48@gmail.com>
 <4fbea726-2ec4-f2f5-adaa-1052b9cb19fe@treenet.co.nz>
 <0b2cbff3-76f9-37cd-b389-0f2631a05757@measurement-factory.com>
Message-ID: <b9c58223-8068-b54e-d599-170a0331e245@gmail.com>



27.10.2017 20:55, Alex Rousskov ?????:
> On 10/27/2017 08:32 AM, Amos Jeffries wrote:
>> On 28/10/17 02:59, Yuri wrote:
>>> the regular expression is simply silently ignored and it is extremely
>>> difficult to detect.
>> That sounds like a library problem. If Squid receives a regex error code
>> from the library when compiling any regex from your squid.conf it logs
>> the relevant error to cache.log.
> When a regular expression is using extended features, the basic regular
> expression compiler often (or even always?!) does not fail because it
> views the extended features as ordinary plain characters. Thus, Squid
> cannot tell that something went wrong.
>
> I cannot give a Squid-based example quickly, but here is a related
> illustration using grep (which is not exactly the same as what happens
> inside Squid, but I suspect it is similar enough for the illustration
> purposes in this context):
>
>> $ echo "foobar" | grep --basic-regexp    'foo|bar'
>> $ echo "foobar" | grep --extended-regexp 'foo|bar'
>> foobar
> As you can see, the basic compiler is silent about the "|" character
> that it does not support. Here is a similar example where a malformed
> extended regular expression is silently accepted by the basic compiler:
>
>
>> $ echo "foobar" | grep --basic-regexp 'foo(bar'
>> $ echo "foobar" | grep --extended-regexp 'foo(bar'
>> grep: Unmatched ( or \(
>
> In theory, Squid itself could detect special characters unsupported by
> the current regex library but doing so correctly without breaking many
> existing working configurations may be impossible. On the other hand,
> this validation could become an optional feature that admins can control.
>
> The best strategy for a Squid admin working with complex regex ACLs may
> be to add external test cases that validate ACL matching expectations,
> but doing so requires significant amount of work and discipline.

That's what I'm talking about. Just when it comes to hundreds and
thousands of regular expressions - this approach seems not too
acceptable. Therefore, I would like to see that the grammars used are
clearly documented. Squid with a simple configuration check often does
not show anything (if there are no obvious errors - i.e. incomplete
regex or similar) and, in a productive configuration, it is extremely
difficult to detect a non-working access control list parts. The
websites are also thousands.

Therefore, I would like either a clear documentation or some tool for
checking whether the regular expression is correct from the point of
view of the current library used by Squid or not. The existing
opportunities seem completely unsatisfactory.
>
> Alex.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
**************************
* C++: Bug to the future *
**************************

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171027/b9bacfb2/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171027/b9bacfb2/attachment.sig>

From Antony.Stone at squid.open.source.it  Fri Oct 27 15:17:14 2017
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Fri, 27 Oct 2017 17:17:14 +0200
Subject: [squid-users] Squid regex grammar
In-Reply-To: <b9c58223-8068-b54e-d599-170a0331e245@gmail.com>
References: <0fa85075-13e5-410f-20d1-a270ce558167@gmail.com>
 <0b2cbff3-76f9-37cd-b389-0f2631a05757@measurement-factory.com>
 <b9c58223-8068-b54e-d599-170a0331e245@gmail.com>
Message-ID: <201710271717.14778.Antony.Stone@squid.open.source.it>

On Friday 27 October 2017 at 17:06:01, Yuri wrote:

> 27.10.2017 20:55, Alex Rousskov ?????:
> > 
> > When a regular expression is using extended features, the basic regular
> > expression compiler often (or even always?!) does not fail because it
> > views the extended features as ordinary plain characters. Thus, Squid
> > cannot tell that something went wrong.

> >> $ echo "foobar" | grep --basic-regexp    'foo|bar'
> >> $ echo "foobar" | grep --extended-regexp 'foo|bar'
> >> foobar
> > 
> > As you can see, the basic compiler is silent about the "|" character
> > that it does not support. Here is a similar example where a malformed
> > 
> > extended regular expression is silently accepted by the basic compiler:
> >> $ echo "foobar" | grep --basic-regexp 'foo(bar'
> >> $ echo "foobar" | grep --extended-regexp 'foo(bar'
> >> grep: Unmatched ( or \(

> I would like either a clear documentation

That sounds entirely reasonable - a statement something like "Squid is 
guaranteed to use basic POSIX grammar, but extended grammar may be available 
on different systems; the sysadmin should check"?

> or some tool for checking whether the regular expression is correct from the
> point of view of the current library used by Squid or not.

What does "correct" mean?

As Alex's examples above demonstrate, both are "correct" regexes from the 
basic POSIX point of view; they just don't do what the admin might have wanted 
or expected.

How could Squid know whether you expect ( in a regex to be a literal character 
or a meta-character?

> The existing opportunities seem completely unsatisfactory.

Nothing documents that Squid uses other than basic POSIX grammar, so why would 
you assume that it does?


Antony.

-- 
It is also possible that putting the birds in a laboratory setting 
inadvertently renders them relatively incompetent.

 - Daniel C Dennett

                                                   Please reply to the list;
                                                         please *don't* CC me.


From yvoinov at gmail.com  Fri Oct 27 15:26:18 2017
From: yvoinov at gmail.com (Yuri)
Date: Fri, 27 Oct 2017 21:26:18 +0600
Subject: [squid-users] Squid regex grammar
In-Reply-To: <201710271717.14778.Antony.Stone@squid.open.source.it>
References: <0fa85075-13e5-410f-20d1-a270ce558167@gmail.com>
 <0b2cbff3-76f9-37cd-b389-0f2631a05757@measurement-factory.com>
 <b9c58223-8068-b54e-d599-170a0331e245@gmail.com>
 <201710271717.14778.Antony.Stone@squid.open.source.it>
Message-ID: <eda2df4c-1edf-6f72-301a-1b5682a7a3f4@gmail.com>



27.10.2017 21:17, Antony Stone ?????:
> On Friday 27 October 2017 at 17:06:01, Yuri wrote:
>
>> 27.10.2017 20:55, Alex Rousskov ?????:
>>> When a regular expression is using extended features, the basic regular
>>> expression compiler often (or even always?!) does not fail because it
>>> views the extended features as ordinary plain characters. Thus, Squid
>>> cannot tell that something went wrong.
>>>> $ echo "foobar" | grep --basic-regexp    'foo|bar'
>>>> $ echo "foobar" | grep --extended-regexp 'foo|bar'
>>>> foobar
>>> As you can see, the basic compiler is silent about the "|" character
>>> that it does not support. Here is a similar example where a malformed
>>>
>>> extended regular expression is silently accepted by the basic compiler:
>>>> $ echo "foobar" | grep --basic-regexp 'foo(bar'
>>>> $ echo "foobar" | grep --extended-regexp 'foo(bar'
>>>> grep: Unmatched ( or \(
>> I would like either a clear documentation
> That sounds entirely reasonable - a statement something like "Squid is 
> guaranteed to use basic POSIX grammar, but extended grammar may be available 
> on different systems; the sysadmin should check"?
>
>> or some tool for checking whether the regular expression is correct from the
>> point of view of the current library used by Squid or not.
> What does "correct" mean?
"correct" mean "this will correctly works in Squid, not silently
ignored". This is simple and obvious, isn't it?
>
> As Alex's examples above demonstrate, both are "correct" regexes from the 
> basic POSIX point of view; they just don't do what the admin might have wanted 
> or expected.
>
> How could Squid know whether you expect ( in a regex to be a literal character 
> or a meta-character?
I expect following known documented behaviour.

And not a casket with a surprise, which should be investigated in each
specific configuration. Adherence to standards provides interoperability
- a familiar word?
>
>> The existing opportunities seem completely unsatisfactory.
> Nothing documents that Squid uses other than basic POSIX grammar, so why would 
> you assume that it does?
Antonio, the problem is that this too is not documented. Maybe someone
will work hard to clearly describe the behavior in the documentation?
Because I did not find, as I said, a direct mention of the default
grammar. Do I clearly express my thoughts?
>
>
> Antony.
>
I asked a simple question. And wanted a simple answer. And not
reasoning, what can be, and what can not. Interoperability is a simple
thing.

-- 
**************************
* C++: Bug to the future *
**************************

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171027/5458ce96/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171027/5458ce96/attachment.sig>

From Antony.Stone at squid.open.source.it  Fri Oct 27 15:33:09 2017
From: Antony.Stone at squid.open.source.it (Antony Stone)
Date: Fri, 27 Oct 2017 17:33:09 +0200
Subject: [squid-users] Squid regex grammar
In-Reply-To: <eda2df4c-1edf-6f72-301a-1b5682a7a3f4@gmail.com>
References: <0fa85075-13e5-410f-20d1-a270ce558167@gmail.com>
 <201710271717.14778.Antony.Stone@squid.open.source.it>
 <eda2df4c-1edf-6f72-301a-1b5682a7a3f4@gmail.com>
Message-ID: <201710271733.09320.Antony.Stone@squid.open.source.it>

On Friday 27 October 2017 at 17:26:18, Yuri wrote:

> 27.10.2017 21:17, Antony Stone ?????:
> > On Friday 27 October 2017 at 17:06:01, Yuri wrote:
> >> 27.10.2017 20:55, Alex Rousskov ?????:
> >>> When a regular expression is using extended features, the basic regular
> >>> expression compiler often (or even always?!) does not fail because it
> >>> views the extended features as ordinary plain characters. Thus, Squid
> >>> cannot tell that something went wrong.
> >>> 
> >>>> $ echo "foobar" | grep --basic-regexp    'foo|bar'
> >>>> $ echo "foobar" | grep --extended-regexp 'foo|bar'
> >>>> foobar
> >>> 
> >>> As you can see, the basic compiler is silent about the "|" character
> >>> that it does not support. Here is a similar example where a malformed
> >>> 
> >>> extended regular expression is silently accepted by the basic compiler:
> >>>> $ echo "foobar" | grep --basic-regexp 'foo(bar'
> >>>> $ echo "foobar" | grep --extended-regexp 'foo(bar'
> >>>> grep: Unmatched ( or \(
> >> 
> >> I would like either a clear documentation
> > 
> > That sounds entirely reasonable - a statement something like "Squid is
> > guaranteed to use basic POSIX grammar, but extended grammar may be
> > available on different systems; the sysadmin should check"?
> > 
> >> or some tool for checking whether the regular expression is correct from
> >> the point of view of the current library used by Squid or not.
> > 
> > What does "correct" mean?
> 
> "correct" mean "this will correctly works in Squid, not silently
> ignored". This is simple and obvious, isn't it?

No.

Suppose I write a | character (as per Alex's first example above) in my regex.

Basic POSIX will match that literally.

Extended grep will not.

Judging purely from what is written in my regex, did I mean the character to 
be matched literally, or not?

Squid cannot tell.

> Adherence to standards provides interoperability - a familiar word?

Indeed.

> I asked a simple question. And wanted a simple answer.

Maybe there isn't one.

> And not reasoning, what can be, and what can not.

Then I apologise for trying to explain.

> Interoperability is a simple thing.

Er, no, it isn't.


Antony.

-- 
If the human brain were so simple that we could understand it,
we'd be so simple that we couldn't.

                                                   Please reply to the list;
                                                         please *don't* CC me.


From yvoinov at gmail.com  Fri Oct 27 15:43:09 2017
From: yvoinov at gmail.com (Yuri)
Date: Fri, 27 Oct 2017 21:43:09 +0600
Subject: [squid-users] Squid regex grammar
In-Reply-To: <201710271733.09320.Antony.Stone@squid.open.source.it>
References: <0fa85075-13e5-410f-20d1-a270ce558167@gmail.com>
 <201710271717.14778.Antony.Stone@squid.open.source.it>
 <eda2df4c-1edf-6f72-301a-1b5682a7a3f4@gmail.com>
 <201710271733.09320.Antony.Stone@squid.open.source.it>
Message-ID: <cc464e5b-71ab-cdd7-01b0-8a1a25e07e4c@gmail.com>



27.10.2017 21:33, Antony Stone ?????:
> On Friday 27 October 2017 at 17:26:18, Yuri wrote:
>
>> 27.10.2017 21:17, Antony Stone ?????:
>>> On Friday 27 October 2017 at 17:06:01, Yuri wrote:
>>>> 27.10.2017 20:55, Alex Rousskov ?????:
>>>>> When a regular expression is using extended features, the basic regular
>>>>> expression compiler often (or even always?!) does not fail because it
>>>>> views the extended features as ordinary plain characters. Thus, Squid
>>>>> cannot tell that something went wrong.
>>>>>
>>>>>> $ echo "foobar" | grep --basic-regexp    'foo|bar'
>>>>>> $ echo "foobar" | grep --extended-regexp 'foo|bar'
>>>>>> foobar
>>>>> As you can see, the basic compiler is silent about the "|" character
>>>>> that it does not support. Here is a similar example where a malformed
>>>>>
>>>>> extended regular expression is silently accepted by the basic compiler:
>>>>>> $ echo "foobar" | grep --basic-regexp 'foo(bar'
>>>>>> $ echo "foobar" | grep --extended-regexp 'foo(bar'
>>>>>> grep: Unmatched ( or \(
>>>> I would like either a clear documentation
>>> That sounds entirely reasonable - a statement something like "Squid is
>>> guaranteed to use basic POSIX grammar, but extended grammar may be
>>> available on different systems; the sysadmin should check"?
>>>
>>>> or some tool for checking whether the regular expression is correct from
>>>> the point of view of the current library used by Squid or not.
>>> What does "correct" mean?
>> "correct" mean "this will correctly works in Squid, not silently
>> ignored". This is simple and obvious, isn't it?
> No.
>
> Suppose I write a | character (as per Alex's first example above) in my regex.
>
> Basic POSIX will match that literally.
>
> Extended grep will not.
>
> Judging purely from what is written in my regex, did I mean the character to 
> be matched literally, or not?
>
> Squid cannot tell.
Yes. You now understanding root case. If we're say - "Squid uses POSIX
Basic until _admin_ specify 'POSIX Extended' in config option" - we're
can expecting POSIX Basic behaviour and only it. Agree? But point is:
we're don't know and can't know, what library functionality exists and
what will work or will not.

So, in each separate case we're should make testcase for EACH regex in
acl to make sure it will or not will work.

Generally speaking, with thousands of regular expressions and thousands
of sites - it sounds pretty dumb, right? Many to many relasions,
thousands tests etc.
>
>> Adherence to standards provides interoperability - a familiar word?
> Indeed.
>
>> I asked a simple question. And wanted a simple answer.
> Maybe there isn't one.
Noooooooo.

What could be simpler is to clearly document the following: "Never use
anything other than POSIX Basic in regular expressions because we do not
guarantee and can not guarantee it will work"?
>
>> And not reasoning, what can be, and what can not.
> Then I apologise for trying to explain.
Yes, I understand everything, Anthony. It's easier to unsubscribe -
"Test every regular expression yourself."
>
>> Interoperability is a simple thing.
> Er, no, it isn't.
Simple. You just have to follow standards and standard *documented*
behavior. As soon as rabbid's dances begin with self-made
interpretations of the standard, problems begin.
>
>
> Antony.
>

-- 
**************************
* C++: Bug to the future *
**************************

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171027/52bce01f/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171027/52bce01f/attachment.sig>

From yvoinov at gmail.com  Fri Oct 27 15:52:02 2017
From: yvoinov at gmail.com (Yuri)
Date: Fri, 27 Oct 2017 21:52:02 +0600
Subject: [squid-users] Squid regex grammar
In-Reply-To: <201710271733.09320.Antony.Stone@squid.open.source.it>
References: <0fa85075-13e5-410f-20d1-a270ce558167@gmail.com>
 <201710271717.14778.Antony.Stone@squid.open.source.it>
 <eda2df4c-1edf-6f72-301a-1b5682a7a3f4@gmail.com>
 <201710271733.09320.Antony.Stone@squid.open.source.it>
Message-ID: <e5290729-83bf-1fe7-549e-f71444378bc0@gmail.com>

27.10.2017 21:33, Antony Stone ?????:
> On Friday 27 October 2017 at 17:26:18, Yuri wrote:
>
>> 27.10.2017 21:17, Antony Stone ?????:
>>> On Friday 27 October 2017 at 17:06:01, Yuri wrote:
>>>> 27.10.2017 20:55, Alex Rousskov ?????:
>>>>> When a regular expression is using extended features, the basic regular
>>>>> expression compiler often (or even always?!) does not fail because it
>>>>> views the extended features as ordinary plain characters. Thus, Squid
>>>>> cannot tell that something went wrong.
>>>>>
>>>>>> $ echo "foobar" | grep --basic-regexp    'foo|bar'
>>>>>> $ echo "foobar" | grep --extended-regexp 'foo|bar'
>>>>>> foobar
>>>>> As you can see, the basic compiler is silent about the "|" character
>>>>> that it does not support. Here is a similar example where a malformed
>>>>>
>>>>> extended regular expression is silently accepted by the basic compiler:
>>>>>> $ echo "foobar" | grep --basic-regexp 'foo(bar'
>>>>>> $ echo "foobar" | grep --extended-regexp 'foo(bar'
>>>>>> grep: Unmatched ( or \(

As for me personally, I would like ECMAScript syntax to be supported in
regular expressions of access control lists by default. :)

-- 
**************************
* C++: Bug to the future *
**************************

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171027/c6df5a7b/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171027/c6df5a7b/attachment.sig>

From rousskov at measurement-factory.com  Fri Oct 27 16:01:42 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 27 Oct 2017 10:01:42 -0600
Subject: [squid-users] Squid regex grammar
In-Reply-To: <cc464e5b-71ab-cdd7-01b0-8a1a25e07e4c@gmail.com>
References: <0fa85075-13e5-410f-20d1-a270ce558167@gmail.com>
 <201710271717.14778.Antony.Stone@squid.open.source.it>
 <eda2df4c-1edf-6f72-301a-1b5682a7a3f4@gmail.com>
 <201710271733.09320.Antony.Stone@squid.open.source.it>
 <cc464e5b-71ab-cdd7-01b0-8a1a25e07e4c@gmail.com>
Message-ID: <a3ba4480-d1d0-87a6-35e6-a459e73b0d38@measurement-factory.com>

On 10/27/2017 09:43 AM, Yuri wrote:

> So, in each separate case we're should make testcase for EACH regex in
> acl to make sure it will or not will work.
> 
> Generally speaking, with thousands of regular expressions and thousands
> of sites - it sounds pretty dumb, right? Many to many relasions,
> thousands tests etc.

What an admin has to do is onerous, but not as bad as you make it sound:

* A handful of test cases is sufficient to validate whether Squid
instance X supports all extended regular expressions used by its ACLs.
In fact, Squid can be easily modified to run such test cases on startup!

* If you want to test that each of the 10K ACLs matches what you want it
to match, then you have to write a lot more test cases, of course, but
such deployment-specific functionality testing is a completely different
topic out of this thread scope.


> What could be simpler is to clearly document the following: "Never use
> anything other than POSIX Basic in regular expressions because we do not
> guarantee and can not guarantee it will work"?

You are right: Adding the above text to squid.cond.documented is fairly
simple. If Squid actually supports extended regular expressions in some
environments, then such a text will also be a bit misleading/misguiding.
Wiki updates or pull requests improving Squid documentation are always
welcomed!

Personally, I cannot volunteer to add this documentation because I do
not know whether Squid can support extended regular expressions in some
environments, and I do not want to spend time adding potentially
misleading/misguiding documentation.

Long-term, we should introduce a configuration option that specifies the
exact regex flavor an admin wants _and_ forces Squid to quit if that
exact flavor is not supported by the running Squid instance.

Alex.


From rousskov at measurement-factory.com  Fri Oct 27 16:15:44 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Fri, 27 Oct 2017 10:15:44 -0600
Subject: [squid-users] Squid regex grammar
In-Reply-To: <e5290729-83bf-1fe7-549e-f71444378bc0@gmail.com>
References: <0fa85075-13e5-410f-20d1-a270ce558167@gmail.com>
 <201710271717.14778.Antony.Stone@squid.open.source.it>
 <eda2df4c-1edf-6f72-301a-1b5682a7a3f4@gmail.com>
 <201710271733.09320.Antony.Stone@squid.open.source.it>
 <e5290729-83bf-1fe7-549e-f71444378bc0@gmail.com>
Message-ID: <57c8b9da-7307-aecb-2a2a-61848b32fbbc@measurement-factory.com>

On 10/27/2017 09:52 AM, Yuri wrote:

> As for me personally, I would like ECMAScript syntax to be supported in
> regular expressions of access control lists by default. :)

I think it is pointless to argue whether regex flavor X should be
supported. Once the necessary infrastructure is in place, the cost of
adding support for one more popular flavor is negligible compared to the
benefits it offers. The admin should be able to select the regex flavor
they want (even if they want a flavor that cannot look behind or match
an arbitrary character with a dot :-).

Alex.


From yvoinov at gmail.com  Fri Oct 27 16:33:33 2017
From: yvoinov at gmail.com (Yuri)
Date: Fri, 27 Oct 2017 22:33:33 +0600
Subject: [squid-users] Squid regex grammar
In-Reply-To: <a3ba4480-d1d0-87a6-35e6-a459e73b0d38@measurement-factory.com>
References: <0fa85075-13e5-410f-20d1-a270ce558167@gmail.com>
 <201710271717.14778.Antony.Stone@squid.open.source.it>
 <eda2df4c-1edf-6f72-301a-1b5682a7a3f4@gmail.com>
 <201710271733.09320.Antony.Stone@squid.open.source.it>
 <cc464e5b-71ab-cdd7-01b0-8a1a25e07e4c@gmail.com>
 <a3ba4480-d1d0-87a6-35e6-a459e73b0d38@measurement-factory.com>
Message-ID: <548d502c-eae0-62ed-adfb-a6e3c53c174e@gmail.com>



27.10.2017 22:01, Alex Rousskov ?????:
> On 10/27/2017 09:43 AM, Yuri wrote:
>
>> So, in each separate case we're should make testcase for EACH regex in
>> acl to make sure it will or not will work.
>>
>> Generally speaking, with thousands of regular expressions and thousands
>> of sites - it sounds pretty dumb, right? Many to many relasions,
>> thousands tests etc.
> What an admin has to do is onerous, but not as bad as you make it sound:
>
> * A handful of test cases is sufficient to validate whether Squid
> instance X supports all extended regular expressions used by its ACLs.
> In fact, Squid can be easily modified to run such test cases on startup!
>
> * If you want to test that each of the 10K ACLs matches what you want it
> to match, then you have to write a lot more test cases, of course, but
> such deployment-specific functionality testing is a completely different
> topic out of this thread scope.
>
>
>> What could be simpler is to clearly document the following: "Never use
>> anything other than POSIX Basic in regular expressions because we do not
>> guarantee and can not guarantee it will work"?
> You are right: Adding the above text to squid.cond.documented is fairly
> simple. If Squid actually supports extended regular expressions in some
> environments, then such a text will also be a bit misleading/misguiding.
> Wiki updates or pull requests improving Squid documentation are always
> welcomed!
Yes. In some cases/environments POSIX Extended works and this introduces
problems when we're trying to populate good working config from one
environment to another (especially when it slightly different).
>
> Personally, I cannot volunteer to add this documentation because I do
> not know whether Squid can support extended regular expressions in some
> environments, and I do not want to spend time adding potentially
> misleading/misguiding documentation.
>
> Long-term, we should introduce a configuration option that specifies the
> exact regex flavor an admin wants _and_ forces Squid to quit if that
> exact flavor is not supported by the running Squid instance.
Or put warning in cache.log. This will be ideally.
>
> Alex.
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
**************************
* C++: Bug to the future *
**************************

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171027/23a34011/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171027/23a34011/attachment.sig>

From rentorbuy at yahoo.com  Fri Oct 27 21:07:18 2017
From: rentorbuy at yahoo.com (Vieri)
Date: Fri, 27 Oct 2017 21:07:18 +0000 (UTC)
Subject: [squid-users] squid cpu usage
In-Reply-To: <1d42585b-d96f-f261-fa2b-61b54b1641ef@measurement-factory.com>
References: <742455879.1992418.1508848440399.ref@mail.yahoo.com>
 <742455879.1992418.1508848440399@mail.yahoo.com>
 <efb11c97-0368-a8ff-c1be-9781ac450026@measurement-factory.com>
 <790628251.3784841.1509016514244@mail.yahoo.com>
 <5f672c1b-ce28-35f3-df09-982e9c76c9cc@measurement-factory.com>
 <2087507399.4185171.1509055107307@mail.yahoo.com>
 <1d42585b-d96f-f261-fa2b-61b54b1641ef@measurement-factory.com>
Message-ID: <76415116.4826893.1509138438033@mail.yahoo.com>

Just in case someone else bumps into this issue, I can confirm that ulimits are not honored when running a cron job (at least from cronie).

In my case, if I set ulimits globally with:
* hard nofile 65535
* soft nofile 16384

I get this outside cron:
open files                      (-n) 16384

However, I get the following within cron:

open files                      (-n) 1024

as demonstrated by running the following test from crontab:

root	ulimit -a >/tmp/ulimit 2>&1 3>&1

So beware.

I guess one can avoid this by setting ulimits within Squid's init script, and calling that within cron.

No idea whether this is a cron bug or feature.

Vieri


From rentorbuy at yahoo.com  Fri Oct 27 21:26:46 2017
From: rentorbuy at yahoo.com (Vieri)
Date: Fri, 27 Oct 2017 21:26:46 +0000 (UTC)
Subject: [squid-users] Authentication not applicable on intercepted
 requests
In-Reply-To: <04b26f85-b231-7bb9-627a-a19a9f5fe379@treenet.co.nz>
References: <901873509.4402527.1509088932155.ref@mail.yahoo.com>
 <901873509.4402527.1509088932155@mail.yahoo.com>
 <04b26f85-b231-7bb9-627a-a19a9f5fe379@treenet.co.nz>
Message-ID: <799195119.4824492.1509139606755@mail.yahoo.com>

________________________________
From: Amos Jeffries <squid3 at treenet.co.nz>
>
> You do not seem to be using Basic auth. Setting the realm for an unused auth mechanism is pointless.
>
> Try:
>   http_access deny explicit !ORG_all
>   http_access deny explicit SSL_ports
>   http_access deny intercepted !localnet
>   http_access deny interceptedssl !localnet


Works great.

Thanks!

Vieri


From jimoe at sohnen-moe.com  Sun Oct 29 07:02:16 2017
From: jimoe at sohnen-moe.com (James Moe)
Date: Sun, 29 Oct 2017 00:02:16 -0700
Subject: [squid-users] Manager access for statistics
Message-ID: <sig.047579d404.7174992d-28e1-c1db-4b74-f31953ac35f9@sohnen-moe.com>

Hello,
  opensuse v42.2
  linux v4.4.87-18.29-default x86_64
  squid v3.5.21

  On occasion I look at the squid statistics; it has been a while since
I last checked them, at least a month. The request was denied as not
having access privileges. I do not see why it is now being denied.
  My understanding is that the ACL names "manager" and "manager_admin"
would be allowed since they are first in the list (see below).
  What have I misunderstood?

http://proxy1.sma.com:3128/squid-internal-mgr/info

acl manager url_regex -i ^cache_object:// /squid-internal-mgr/
acl manager_admin src 192.168.69.115
#
acl localnet src 192.168.69.0/24
acl localnet src fc00::/7
acl localnet src fe80::/10
#
acl SSL_ports port 443
acl SSL_ports port 631
#
# Jumpline cPanel ports
acl SSL_ports port 2083
acl SSL_ports port 2096
#
acl SSL_ports port 5000		# NAS
acl SSL_ports port 9100
acl SSL_ports port 10000	# Webmin
#
acl Safe_ports port 563		# nntp
acl Safe_ports port 631		# cups
acl Safe_ports port 9100	# ?network printer?
#
# From the default conf:
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
#
acl CONNECT method CONNECT
#
http_access allow manager_admin manager
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localnet
http_access deny all

# Squid normally listens to port 3128
http_port 3128

access_log /var/log/squid/access.log


-- 
James Moe
moe dot james at sohnen-moe dot com
520.743.3936
Think.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 181 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171029/aba119c7/attachment.sig>

From squid3 at treenet.co.nz  Sun Oct 29 11:54:27 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Mon, 30 Oct 2017 00:54:27 +1300
Subject: [squid-users] Manager access for statistics
In-Reply-To: <sig.047579d404.7174992d-28e1-c1db-4b74-f31953ac35f9@sohnen-moe.com>
References: <sig.047579d404.7174992d-28e1-c1db-4b74-f31953ac35f9@sohnen-moe.com>
Message-ID: <3b04ac5e-9188-45f6-6b67-9972b9690cf5@treenet.co.nz>



On 29/10/17 20:02, James Moe wrote:
> Hello,
>    opensuse v42.2
>    linux v4.4.87-18.29-default x86_64
>    squid v3.5.21
> 
>    On occasion I look at the squid statistics; it has been a while since
> I last checked them, at least a month. The request was denied as not
> having access privileges. I do not see why it is now being denied.
>    My understanding is that the ACL names "manager" and "manager_admin"
> would be allowed since they are first in the list (see below).
>    What have I misunderstood?
> 
> http://proxy1.sma.com:3128/squid-internal-mgr/info
> 
> acl manager url_regex -i ^cache_object:// /squid-internal-mgr/
> acl manager_admin src 192.168.69.115
> #
...

> #
> http_access allow manager_admin manager
> http_access deny !Safe_ports
> http_access deny CONNECT !SSL_ports
> http_access allow localnet
> http_access deny all


Two things:

1) 'manager' is a pre-defined ACL. The your redefinition contradicts the 
case sensitive URI path. Best not to re-define it.


2) the current recommended practice is to place the manager ACLs after 
the 'CONNECT !SSL_Ports' line.
  That does not affect the admin access but prevents several more attack 
scenarios against Squid.


3) you are not denying manager access to any of the 'localnet' ranges. 
So the whole manager ACL section is pretty pointless.


> 
> # Squid normally listens to port 3128
> http_port 3128
> 

What does access.log show for the manager request?
The above port is IPv6-enabled but the manager_admin ACL only allows an 
IPv4.


Amos


From jimoe at sohnen-moe.com  Sun Oct 29 23:01:28 2017
From: jimoe at sohnen-moe.com (James Moe)
Date: Sun, 29 Oct 2017 16:01:28 -0700
Subject: [squid-users] Manager access for statistics
In-Reply-To: <3b04ac5e-9188-45f6-6b67-9972b9690cf5@treenet.co.nz>
References: <sig.047579d404.7174992d-28e1-c1db-4b74-f31953ac35f9@sohnen-moe.com>
 <3b04ac5e-9188-45f6-6b67-9972b9690cf5@treenet.co.nz>
Message-ID: <sig.14753a271a.faebd09c-ba20-b8bc-a9ad-ac5680912266@sohnen-moe.com>

On 10/29/2017 04:54 AM, Amos Jeffries wrote:
> 
>> #
>> http_access allow manager_admin manager
>> http_access deny !Safe_ports
>> http_access deny CONNECT !SSL_ports
>> http_access allow localnet
>> http_access deny all
> 
> Two things:
> 
> 1) 'manager' is a pre-defined ACL. The your redefinition contradicts the 
> case sensitive URI path. Best not to re-define it.
> 
  Okay.
  I commented the "manager" line.
> 
> 2) the current recommended practice is to place the manager ACLs after 
> the 'CONNECT !SSL_Ports' line.
>   That does not affect the admin access but prevents several more attack 
> scenarios against Squid.
> 
  Okay.
> 
> 3) you are not denying manager access to any of the 'localnet' ranges. 
> So the whole manager ACL section is pretty pointless.
> 
  I do not understand.

  I made the changes you indicated (that I understood) and restarted
Squid. No change.

# acl manager url_regex -i ^cache_object:// /squid-internal-mgr/

http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow manager_admin
http_access allow manager localhost
http_access deny manager
http_access allow localnet
http_access deny all

> 
> What does access.log show for the manager request?
> The above port is IPv6-enabled but the manager_admin ACL only allows an 
> IPv4.
> 
1509311060.445     15 192.168.69.115 TCP_MISS/403 4464 GET
http://proxy1.sma.com:3128/squid-internal-mgr/info -
HIER_DIRECT/192.168.69.246 text/html
1509311060.822      0 192.168.69.115 TCP_IMS_HIT/304 311 GET
http://sma-server3:3128/squid-internal-static/icons/SN.png - HIER_NONE/-
image/png

-- 
James Moe
moe dot james at sohnen-moe dot com
520.743.3936
Think.



-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 181 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171029/c01ec258/attachment.sig>

From alessio.troiano at leonardocompany.com  Mon Oct 30 09:51:09 2017
From: alessio.troiano at leonardocompany.com (Troiano Alessio)
Date: Mon, 30 Oct 2017 09:51:09 +0000
Subject: [squid-users] Squid doesn't reload webpage like other clients do
Message-ID: <f877aee786b8477e9c6191a9d6edc32a@ocgepvsw3101.ocr.priv>

Hello,
I've squid 3.5.20 running on RHEL 7.4.
I have a problem to access some websites, for example www.nato.int.
This website apply an Anti-DDoS system that reset the first connection after the TCP 3-way handshake (SYN/SYN-ACK/ACK/RST-ACK). All subsequent TCP connections are accepted. The website administrator say's it is by design.
When I browse that site directly with all browser (IE, FF, Chrome) I see the normal site showed. Anyway it is because after the first reset the client try to reload the page. I've the same behaviour also with wget:

[root at soc-pe-nagios01 ~]# wget www.nato.int
--2017-10-30 10:02:50--  http://www.nato.int/
Resolving www.nato.int... 152.152.31.120
Connecting to www.nato.int|152.152.31.120|:80... connected.
HTTP request sent, awaiting response... No data received.
Retrying.

--2017-10-30 10:02:51--  (try: 2)  http://www.nato.int/
Connecting to www.nato.int|152.152.31.120|:80... connected.
HTTP request sent, awaiting response... 301 Moved Permanently
Location: https://www.nato.int/ [following]
--2017-10-30 10:02:51--  https://www.nato.int/
Connecting to www.nato.int|152.152.31.120|:443... connected.
WARNING: cannot verify www.nato.int's certificate, issued by '/C=BE/O=GlobalSign nv-sa/CN=GlobalSign Organization Validation CA - SHA256 - G2':
  Unable to locally verify the issuer's authority.
HTTP request sent, awaiting response... 200 OK
Length: unspecified [text/html]
Saving to: 'index.html.17'

    [      <=>                                                                                         ] 168,229      147K/s   in 1.1s

2017-10-30 10:03:39 (147 KB/s) - index.html.17 saved [168229]

When I browse the site with squid proxy the browser receive an "Empty Response" squid error page (HTTP error code 502 Bad Gateway) and doesn't do the automatic retry:

[root at soc-pe-nagios01 ~]# wget www.nato.int -e use_proxy=yes -e http_proxy=172.31.1.67:8080
--2017-10-30 10:41:09--  http://www.nato.int/
Connecting to 172.31.1.67:8080... connected.
Proxy request sent, awaiting response... 502 Bad Gateway
2017-10-30 10:41:09 ERROR 502: Bad Gateway.

I can't find an RFC that confirm if browser and proxyes should try a page reload, or if squid has an option to do that.

Any help is appreciated.

Best Regards, Alessio.

Il presente messaggio e-mail e ogni suo allegato devono intendersi indirizzati esclusivamente al destinatario indicato e considerarsi dal contenuto strettamente riservato e confidenziale. Se non siete l'effettivo destinatario o avete ricevuto il messaggio e-mail per errore, siete pregati di avvertire immediatamente il mittente e di cancellare il suddetto messaggio e ogni suo allegato dal vostro sistema informatico. Qualsiasi utilizzo, diffusione, copia o archiviazione del presente messaggio da parte di chi non ne ? il destinatario ? strettamente proibito e pu? dar luogo a responsabilit? di carattere civile e penale punibili ai sensi di legge.
Questa e-mail ha valore legale solo se firmata digitalmente ai sensi della normativa vigente.

The contents of this email message and any attachments are intended solely for the addressee(s) and contain confidential and/or privileged information.
If you are not the intended recipient of this message, or if this message has been addressed to you in error, please immediately notify the sender and then delete this message and any attachments from your system. If you are not the intended recipient, you are hereby notified that any use, dissemination, copying, or storage of this message or its attachments is strictly prohibited. Unauthorized disclosure and/or use of information contained in this email message may result in civil and criminal liability. ?
This e-mail has legal value according to the applicable laws only if it is digitally signed by the sender

From erdosain9 at gmail.com  Mon Oct 30 15:29:25 2017
From: erdosain9 at gmail.com (erdosain9)
Date: Mon, 30 Oct 2017 08:29:25 -0700 (MST)
Subject: [squid-users] Certificate for bump?
Message-ID: <1509377365051-0.post@n4.nabble.com>


Hi. What you think about using certificate for bump from
https://letsencrypt.org???
Thanks to all.



--
Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html


From synfinatic at gmail.com  Mon Oct 30 15:36:28 2017
From: synfinatic at gmail.com (Aaron Turner)
Date: Mon, 30 Oct 2017 08:36:28 -0700
Subject: [squid-users] Certificate for bump?
In-Reply-To: <1509377365051-0.post@n4.nabble.com>
References: <1509377365051-0.post@n4.nabble.com>
Message-ID: <CANAZdzV5J3a3Z6BNJaycs5cScBE2RZfKj6ch6iGDZNf8jXJuTw@mail.gmail.com>

Unless you have very very narrow bump requirements for only domains
you control, I don't see much use in that.
--
Aaron Turner
https://synfin.net/         Twitter: @synfinatic
My father once told me that respect for the truth comes close to being
the basis for all morality.  "Something cannot emerge from nothing,"
he said.  This is profound thinking if you understand how unstable
"the truth" can be.  -- Frank Herbert, Dune


On Mon, Oct 30, 2017 at 8:29 AM, erdosain9 <erdosain9 at gmail.com> wrote:
>
> Hi. What you think about using certificate for bump from
> https://letsencrypt.org???
> Thanks to all.
>
>
>
> --
> Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users


From yvoinov at gmail.com  Mon Oct 30 15:48:44 2017
From: yvoinov at gmail.com (Yuri)
Date: Mon, 30 Oct 2017 21:48:44 +0600
Subject: [squid-users] Certificate for bump?
In-Reply-To: <1509377365051-0.post@n4.nabble.com>
References: <1509377365051-0.post@n4.nabble.com>
Message-ID: <b0d35117-69a4-5b07-9d61-c7e4563ec585@gmail.com>

Will not work. You need a root CA certificate with the "signing
certificate request" property, not just "server/client authentication".


30.10.2017 21:29, erdosain9 ?????:
> Hi. What you think about using certificate for bump from
> https://letsencrypt.org???
> Thanks to all.
>
>
>
> --
> Sent from: http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
**************************
* C++: Bug to the future *
**************************

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171030/e90ab3ad/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171030/e90ab3ad/attachment.sig>

From rousskov at measurement-factory.com  Mon Oct 30 16:22:09 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 30 Oct 2017 10:22:09 -0600
Subject: [squid-users] Squid doesn't reload webpage like other clients do
In-Reply-To: <f877aee786b8477e9c6191a9d6edc32a@ocgepvsw3101.ocr.priv>
References: <f877aee786b8477e9c6191a9d6edc32a@ocgepvsw3101.ocr.priv>
Message-ID: <6a0985c1-394d-c19b-f03d-a658e937ab42@measurement-factory.com>

On 10/30/2017 03:51 AM, Troiano Alessio wrote:

> I've squid 3.5.20 running on RHEL 7.4. I have a problem to access
> some websites, for example www.nato.int. This website apply an
> Anti-DDoS system that reset the first connection after the TCP 3-way
> handshake (SYN/SYN-ACK/ACK/RST-ACK). All subsequent TCP connections
> are accepted. The website administrator say's it is by design.


> When I browse the site with squid proxy the browser receive an "Empty
> Response" squid error page (HTTP error code 502 Bad Gateway) and
> doesn't do the automatic retry:

This is by design as well :-).

We can change Squid behavior to retry connection resets, but I am sure
that some folks will not like the new behavior because in _their_ use
cases a retry is wasteful and/or painful. IMHO, the new behavior should
be controlled by a configuration directive, possibly an ACL-driven one.

Quality patches implementing the above feature should be welcomed IMO.
The tip of the relevant code is probably in ERR_ZERO_SIZE_OBJECT
handling inside FwdState::fail(). There is a similar code that handles
persistent connection races there already, but the zero-size reply code
may need a new dedicated FwdState flag to prevent infinite retry loops
when the origin server is broken (a much more typical use case than the
weird attempt at DDoS mitigation that you have described above).

https://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F


HTH,

Alex.



> [root at soc-pe-nagios01 ~]# wget www.nato.int -e use_proxy=yes -e http_proxy=172.31.1.67:8080
> --2017-10-30 10:41:09--  http://www.nato.int/
> Connecting to 172.31.1.67:8080... connected.
> Proxy request sent, awaiting response... 502 Bad Gateway
> 2017-10-30 10:41:09 ERROR 502: Bad Gateway.
> 
> I can't find an RFC that confirm if browser and proxyes should try a page reload, or if squid has an option to do that.
> 
> Any help is appreciated.
> 
> Best Regards, Alessio.
> 
> Il presente messaggio e-mail e ogni suo allegato devono intendersi indirizzati esclusivamente al destinatario indicato e considerarsi dal contenuto strettamente riservato e confidenziale. Se non siete l'effettivo destinatario o avete ricevuto il messaggio e-mail per errore, siete pregati di avvertire immediatamente il mittente e di cancellare il suddetto messaggio e ogni suo allegato dal vostro sistema informatico. Qualsiasi utilizzo, diffusione, copia o archiviazione del presente messaggio da parte di chi non ne ? il destinatario ? strettamente proibito e pu? dar luogo a responsabilit? di carattere civile e penale punibili ai sensi di legge.
> Questa e-mail ha valore legale solo se firmata digitalmente ai sensi della normativa vigente.
> 
> The contents of this email message and any attachments are intended solely for the addressee(s) and contain confidential and/or privileged information.
> If you are not the intended recipient of this message, or if this message has been addressed to you in error, please immediately notify the sender and then delete this message and any attachments from your system. If you are not the intended recipient, you are hereby notified that any use, dissemination, copying, or storage of this message or its attachments is strictly prohibited. Unauthorized disclosure and/or use of information contained in this email message may result in civil and criminal liability. ?
> This e-mail has legal value according to the applicable laws only if it is digitally signed by the sender
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
> 



From squid3 at treenet.co.nz  Mon Oct 30 17:16:01 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 31 Oct 2017 06:16:01 +1300
Subject: [squid-users] Manager access for statistics
In-Reply-To: <sig.14753a271a.faebd09c-ba20-b8bc-a9ad-ac5680912266@sohnen-moe.com>
References: <sig.047579d404.7174992d-28e1-c1db-4b74-f31953ac35f9@sohnen-moe.com>
 <3b04ac5e-9188-45f6-6b67-9972b9690cf5@treenet.co.nz>
 <sig.14753a271a.faebd09c-ba20-b8bc-a9ad-ac5680912266@sohnen-moe.com>
Message-ID: <f1be1e45-4647-c9d4-53dc-668f0fc8e3cf@treenet.co.nz>

On 30/10/17 12:01, James Moe wrote:
> On 10/29/2017 04:54 AM, Amos Jeffries wrote:
>>
>>
>> What does access.log show for the manager request?
>> The above port is IPv6-enabled but the manager_admin ACL only allows an
>> IPv4.
>>
> 1509311060.445     15 192.168.69.115 TCP_MISS/403 4464 GET
> http://proxy1.sma.com:3128/squid-internal-mgr/info -
> HIER_DIRECT/192.168.69.246 text/html
> 1509311060.822      0 192.168.69.115 TCP_IMS_HIT/304 311 GET
> http://sma-server3:3128/squid-internal-static/icons/SN.png - HIER_NONE/-
> image/png
> 

Responses which are generated by your Squid will all have that 
"HEIR_NONE/-" tag on their access.log lines. Because Squid generated the 
response no upstream server was involved.


The manager report request got passed on upstream to some server at 
192.168.69.246 which appears to think its public domain name / hostname 
is "sma-server3".

Between them these entries appear to be saying that you have very 
probably configured the Squid machines host name as "sma-server3" 
instead of "proxy1.sma.com". That would make the mgr request is enter a 
forwarding loop when your Squid passes it on instead of generating the 
wanted report.


Amos


From lagged at gmail.com  Mon Oct 30 18:15:25 2017
From: lagged at gmail.com (Andrei)
Date: Mon, 30 Oct 2017 13:15:25 -0500
Subject: [squid-users] Squid doesn't reload webpage like other clients do
In-Reply-To: <6a0985c1-394d-c19b-f03d-a658e937ab42@measurement-factory.com>
References: <f877aee786b8477e9c6191a9d6edc32a@ocgepvsw3101.ocr.priv>
 <6a0985c1-394d-c19b-f03d-a658e937ab42@measurement-factory.com>
Message-ID: <CAP+vvEuvKcoes==LUCmXaGPAMnd5Ay-k-mAUPucbx5RN1K0Rug@mail.gmail.com>

You do realize that there's nothing "weird" about p0f, right? Perhaps you
should have a read over:

http://lcamtuf.coredump.cx/p0f3/
https://blog.cloudflare.com/introducing-the-p0f-bpf-compiler/


On Mon, Oct 30, 2017 at 11:22 AM, Alex Rousskov <
rousskov at measurement-factory.com> wrote:

> On 10/30/2017 03:51 AM, Troiano Alessio wrote:
>
> > I've squid 3.5.20 running on RHEL 7.4. I have a problem to access
> > some websites, for example www.nato.int. This website apply an
> > Anti-DDoS system that reset the first connection after the TCP 3-way
> > handshake (SYN/SYN-ACK/ACK/RST-ACK). All subsequent TCP connections
> > are accepted. The website administrator say's it is by design.
>
>
> > When I browse the site with squid proxy the browser receive an "Empty
> > Response" squid error page (HTTP error code 502 Bad Gateway) and
> > doesn't do the automatic retry:
>
> This is by design as well :-).
>
> We can change Squid behavior to retry connection resets, but I am sure
> that some folks will not like the new behavior because in _their_ use
> cases a retry is wasteful and/or painful. IMHO, the new behavior should
> be controlled by a configuration directive, possibly an ACL-driven one.
>
> Quality patches implementing the above feature should be welcomed IMO.
> The tip of the relevant code is probably in ERR_ZERO_SIZE_OBJECT
> handling inside FwdState::fail(). There is a similar code that handles
> persistent connection races there already, but the zero-size reply code
> may need a new dedicated FwdState flag to prevent infinite retry loops
> when the origin server is broken (a much more typical use case than the
> weird attempt at DDoS mitigation that you have described above).
>
> https://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_
> add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F
>
>
> HTH,
>
> Alex.
>
>
>
> > [root at soc-pe-nagios01 ~]# wget www.nato.int -e use_proxy=yes -e
> http_proxy=172.31.1.67:8080
> > --2017-10-30 10:41:09--  http://www.nato.int/
> > Connecting to 172.31.1.67:8080... connected.
> > Proxy request sent, awaiting response... 502 Bad Gateway
> > 2017-10-30 10:41:09 ERROR 502: Bad Gateway.
> >
> > I can't find an RFC that confirm if browser and proxyes should try a
> page reload, or if squid has an option to do that.
> >
> > Any help is appreciated.
> >
> > Best Regards, Alessio.
> >
> > Il presente messaggio e-mail e ogni suo allegato devono intendersi
> indirizzati esclusivamente al destinatario indicato e considerarsi dal
> contenuto strettamente riservato e confidenziale. Se non siete l'effettivo
> destinatario o avete ricevuto il messaggio e-mail per errore, siete pregati
> di avvertire immediatamente il mittente e di cancellare il suddetto
> messaggio e ogni suo allegato dal vostro sistema informatico. Qualsiasi
> utilizzo, diffusione, copia o archiviazione del presente messaggio da parte
> di chi non ne ? il destinatario ? strettamente proibito e pu? dar luogo a
> responsabilit? di carattere civile e penale punibili ai sensi di legge.
> > Questa e-mail ha valore legale solo se firmata digitalmente ai sensi
> della normativa vigente.
> >
> > The contents of this email message and any attachments are intended
> solely for the addressee(s) and contain confidential and/or privileged
> information.
> > If you are not the intended recipient of this message, or if this
> message has been addressed to you in error, please immediately notify the
> sender and then delete this message and any attachments from your system.
> If you are not the intended recipient, you are hereby notified that any
> use, dissemination, copying, or storage of this message or its attachments
> is strictly prohibited. Unauthorized disclosure and/or use of information
> contained in this email message may result in civil and criminal liability.
> ?
> > This e-mail has legal value according to the applicable laws only if it
> is digitally signed by the sender
> > _______________________________________________
> > squid-users mailing list
> > squid-users at lists.squid-cache.org
> > http://lists.squid-cache.org/listinfo/squid-users
> >
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171030/44757e2a/attachment.htm>

From rousskov at measurement-factory.com  Mon Oct 30 19:41:21 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Mon, 30 Oct 2017 13:41:21 -0600
Subject: [squid-users] Squid doesn't reload webpage like other clients do
In-Reply-To: <CAP+vvEuvKcoes==LUCmXaGPAMnd5Ay-k-mAUPucbx5RN1K0Rug@mail.gmail.com>
References: <f877aee786b8477e9c6191a9d6edc32a@ocgepvsw3101.ocr.priv>
 <6a0985c1-394d-c19b-f03d-a658e937ab42@measurement-factory.com>
 <CAP+vvEuvKcoes==LUCmXaGPAMnd5Ay-k-mAUPucbx5RN1K0Rug@mail.gmail.com>
Message-ID: <91c062a2-5049-cf56-5a33-64ab3e30fc34@measurement-factory.com>

On 10/30/2017 12:15 PM, Andrei wrote:
> You do realize that there's nothing "weird" about p0f, right?

Right. I do not know why you had to ask though: There is nothing related
to p0f (i.e., a passive traffic analysis tool) in my response. And the
original question is probably unrelated to p0f as well since active
connection resets are incompatible with the idea of passive analysis.

Alex.



> On Mon, Oct 30, 2017 at 11:22 AM, Alex Rousskov wrote:
> 
>     On 10/30/2017 03:51 AM, Troiano Alessio wrote:
> 
>     > I've squid 3.5.20 running on RHEL 7.4. I have a problem to access
>     > some websites, for example www.nato.int <http://www.nato.int>. This website apply an
>     > Anti-DDoS system that reset the first connection after the TCP 3-way
>     > handshake (SYN/SYN-ACK/ACK/RST-ACK). All subsequent TCP connections
>     > are accepted. The website administrator say's it is by design.
> 
> 
>     > When I browse the site with squid proxy the browser receive an "Empty
>     > Response" squid error page (HTTP error code 502 Bad Gateway) and
>     > doesn't do the automatic retry:
> 
>     This is by design as well :-).
> 
>     We can change Squid behavior to retry connection resets, but I am sure
>     that some folks will not like the new behavior because in _their_ use
>     cases a retry is wasteful and/or painful. IMHO, the new behavior should
>     be controlled by a configuration directive, possibly an ACL-driven one.
> 
>     Quality patches implementing the above feature should be welcomed IMO.
>     The tip of the relevant code is probably in ERR_ZERO_SIZE_OBJECT
>     handling inside FwdState::fail(). There is a similar code that handles
>     persistent connection races there already, but the zero-size reply code
>     may need a new dedicated FwdState flag to prevent infinite retry loops
>     when the origin server is broken (a much more typical use case than the
>     weird attempt at DDoS mitigation that you have described above).
> 
>     https://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F




From lagged at gmail.com  Mon Oct 30 20:39:30 2017
From: lagged at gmail.com (Andrei)
Date: Mon, 30 Oct 2017 15:39:30 -0500
Subject: [squid-users] Squid doesn't reload webpage like other clients do
In-Reply-To: <91c062a2-5049-cf56-5a33-64ab3e30fc34@measurement-factory.com>
References: <f877aee786b8477e9c6191a9d6edc32a@ocgepvsw3101.ocr.priv>
 <6a0985c1-394d-c19b-f03d-a658e937ab42@measurement-factory.com>
 <CAP+vvEuvKcoes==LUCmXaGPAMnd5Ay-k-mAUPucbx5RN1K0Rug@mail.gmail.com>
 <91c062a2-5049-cf56-5a33-64ab3e30fc34@measurement-factory.com>
Message-ID: <CAP+vvEtDjHar74RmK2hNLQqDFa4vicvVS_3nEhk9514PyjP5Pw@mail.gmail.com>

It's regarding active fingerprinting and mitigating attacks, not just it's
passive use. (Sorry for the dbl send)

On Oct 30, 2017 21:41, "Alex Rousskov" <rousskov at measurement-factory.com>
wrote:

> On 10/30/2017 12:15 PM, Andrei wrote:
> > You do realize that there's nothing "weird" about p0f, right?
>
> Right. I do not know why you had to ask though: There is nothing related
> to p0f (i.e., a passive traffic analysis tool) in my response. And the
> original question is probably unrelated to p0f as well since active
> connection resets are incompatible with the idea of passive analysis.
>
> Alex.
>
>
>
> > On Mon, Oct 30, 2017 at 11:22 AM, Alex Rousskov wrote:
> >
> >     On 10/30/2017 03:51 AM, Troiano Alessio wrote:
> >
> >     > I've squid 3.5.20 running on RHEL 7.4. I have a problem to access
> >     > some websites, for example www.nato.int <http://www.nato.int>.
> This website apply an
> >     > Anti-DDoS system that reset the first connection after the TCP
> 3-way
> >     > handshake (SYN/SYN-ACK/ACK/RST-ACK). All subsequent TCP connections
> >     > are accepted. The website administrator say's it is by design.
> >
> >
> >     > When I browse the site with squid proxy the browser receive an
> "Empty
> >     > Response" squid error page (HTTP error code 502 Bad Gateway) and
> >     > doesn't do the automatic retry:
> >
> >     This is by design as well :-).
> >
> >     We can change Squid behavior to retry connection resets, but I am
> sure
> >     that some folks will not like the new behavior because in _their_ use
> >     cases a retry is wasteful and/or painful. IMHO, the new behavior
> should
> >     be controlled by a configuration directive, possibly an ACL-driven
> one.
> >
> >     Quality patches implementing the above feature should be welcomed
> IMO.
> >     The tip of the relevant code is probably in ERR_ZERO_SIZE_OBJECT
> >     handling inside FwdState::fail(). There is a similar code that
> handles
> >     persistent connection races there already, but the zero-size reply
> code
> >     may need a new dedicated FwdState flag to prevent infinite retry
> loops
> >     when the origin server is broken (a much more typical use case than
> the
> >     weird attempt at DDoS mitigation that you have described above).
> >
> >     https://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_
> add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171030/c6e5bd71/attachment.htm>

From xpro6000 at gmail.com  Tue Oct 31 05:34:38 2017
From: xpro6000 at gmail.com (xpro6000)
Date: Tue, 31 Oct 2017 01:34:38 -0400
Subject: [squid-users] IPv6 only network
Message-ID: <CAFoK1azfez2-Kda9idhGc+8_SKG7bpavU0UTsyzrM9srFHA8Kg@mail.gmail.com>

Unfortunately my ISP does not provide an IPv6 IP, I need to create an only
IPv6 network so I can test an iphone app as required by the Apple store

https://developer.apple.com/support/ipv6/

What I did was, I created a VPS with IPv6 support, I added the following to
squid.conf

http_port 3001
acl port1 myport 3001
tcp_outgoing_address 2001:19f1:9232:d4d:b757:3535:1910:412e port1
server_persistent_connections off

The config above works fine. If the website supports IPv6, it does use that
IPv6 IP. But Squid uses IPv4 if the website does not support IPv6

Is there anyway to prevent Squid to use IPv4 for outgoing connections?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171031/69c4e541/attachment.htm>

From squid3 at treenet.co.nz  Tue Oct 31 07:13:22 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 31 Oct 2017 20:13:22 +1300
Subject: [squid-users] IPv6 only network
In-Reply-To: <CAFoK1azfez2-Kda9idhGc+8_SKG7bpavU0UTsyzrM9srFHA8Kg@mail.gmail.com>
References: <CAFoK1azfez2-Kda9idhGc+8_SKG7bpavU0UTsyzrM9srFHA8Kg@mail.gmail.com>
Message-ID: <743353c0-30db-0013-c8e4-0b609ea625ff@treenet.co.nz>

On 31/10/17 18:34, xpro6000 wrote:
> Unfortunately my ISP does not provide an IPv6 IP, I need to create an 
> only IPv6 network so I can test an iphone app as required by the Apple store
> 
> https://developer.apple.com/support/ipv6/ 
> <https://developer.apple.com/support/ipv6/>
> 

Squids' default behaviour is to follow BCP 177. So any use of IPv4 is a 
strong indication that the server used by your app is having IPv6 
connectivity issues.

see "Limitations of Local Testing" at 
<https://developer.apple.com/library/ios/documentation/NetworkingInternetWeb/Conceptual/NetworkingOverview/UnderstandingandPreparingfortheIPv6Transition/UnderstandingandPreparingfortheIPv6Transition.html#//apple_ref/doc/uid/TP40010220-CH213-SW1>.


> What I did was, I created a VPS with IPv6 support, I added the following 
> to squid.conf
> 
> http_port 3001
> acl port1 myport 3001

Use "myportname" ACL type. 'myport' is deprecated.

> tcp_outgoing_address 2001:19f1:9232:d4d:b757:3535:1910:412e port1
> server_persistent_connections off

Why disabling persistence? it has nothing to do with IPv4 vs IPv6.

> 
> The config above works fine. If the website supports IPv6, it does use 
> that IPv6 IP. But Squid uses IPv4 if the website does not support IPv6
> 
> Is there anyway to prevent Squid to use IPv4 for outgoing connections?
> 

IPv4 is not yet an optional protocol so technically no. But there are 
several ways to safely achieve IPv6-only traffic:

* some DNS resolvers can be configured not to deliver A records.

* ensure the NIC of the machine running Squid has no IPv4 addresses.

* ensure that IPv4 space is all non-routable.

* ensure your Squid machines firewall is configured to reject (_not_ 
drop) IPv4 packets.


Notice how all of those are things you would need to do to make your 
network *actually* IPv6-only and have nothing directly to do with Squid.

Amos


From rafael.akchurin at diladele.com  Tue Oct 31 08:11:02 2017
From: rafael.akchurin at diladele.com (Rafael Akchurin)
Date: Tue, 31 Oct 2017 08:11:02 +0000
Subject: [squid-users] [icap] Web Safety 5.2 ICAP web filter plugin for
 Squid is now Release Candidate
Message-ID: <AM6PR0402MB357647616FD5DA19A3CDDCB48F5E0@AM6PR0402MB3576.eurprd04.prod.outlook.com>

Greetings all,

The version 5.2.0.210A of Web Safety ICAP web filter for Squid proxy is announced as Release Candidate.
It is now ready for broad deployment to production systems. The code is complete and anything new will only be added to the upcoming 5.3.

This version contains the following fixes and improvements:


*        Added management sections for Squid cache (refresh patterns) and logging submodules to Admin UI. It is now very easy to enable different log level for a separate Squid module to make troubleshooting simpler.

*        New version of definition files database. Some categories were combined to make the usage more straightforward, several new categories added.

*        Added support for "brotli" transfer encoding, greatly improving filtering on YouTube and other Google services.

*        Improved correctness of traffic monitoring reports built over the Squid access logs.

*        Added support for recently released pfSense 2.4. Also dropped support for FreeBSD 10 and added FreeBSD 11.

The version is available from https://www.diladele.com/download_next_version.html . It is recommended to use Ubuntu 16 and CentOS 7 based virtual appliances in production. Direct links to virtual appliances are:


*        http://packages.diladele.com/websafety/5.2.0.210A/va/ubuntu16/websafety.zip

*        http://packages.diladele.com/websafety/5.2.0.210A/va/centos7/websafety.zip

Final release is expected in two weeks (approx. 15 of November, 2017).

Next version 5.3 will contain eCAP based ClamAV adapter antivirus from Measurement Factory, available from http://www.e-cap.org/downloads  (except for FreeBSD 11), support for haproxy's PROXY protocol and proxy pseudo authentication based on IP to Active Directory open source project Active Directory Inspector ( see https://github.com/diladele/active-directory-inspector ).  Builds of 5.3 for now is in beta stage and thus freely available to Early Adopters community ( https://www.diladele.com/community.html ).

Thanks to all of you for making this possible!

Best regards,
Rafael Akchurin
Diladele B.V.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171031/0c617991/attachment.htm>

From alessio.troiano at leonardocompany.com  Tue Oct 31 08:29:41 2017
From: alessio.troiano at leonardocompany.com (Troiano Alessio)
Date: Tue, 31 Oct 2017 08:29:41 +0000
Subject: [squid-users] R: Squid doesn't reload webpage like other clients do
In-Reply-To: <18853_1509380533_59F751B5_18853_6776_1_6a0985c1-394d-c19b-f03d-a658e937ab42@measurement-factory.com>
References: <f877aee786b8477e9c6191a9d6edc32a@ocgepvsw3101.ocr.priv>
 <18853_1509380533_59F751B5_18853_6776_1_6a0985c1-394d-c19b-f03d-a658e937ab42@measurement-factory.com>
Message-ID: <e44ab64f28f947818d9ff3fdd1a3ed0b@ocgepvsw3101.ocr.priv>

Thank you Alex.
Can't be an idea to "forward" the rst to the client? In this way the proxy will be totally transparent and the reload is demanded to the client (browser).

Alessio


Il presente messaggio e-mail e ogni suo allegato devono intendersi indirizzati esclusivamente al destinatario indicato e considerarsi dal contenuto strettamente riservato e confidenziale. Se non siete l'effettivo destinatario o avete ricevuto il messaggio e-mail per errore, siete pregati di avvertire immediatamente il mittente e di cancellare il suddetto messaggio e ogni suo allegato dal vostro sistema informatico. Qualsiasi utilizzo, diffusione, copia o archiviazione del presente messaggio da parte di chi non ne ? il destinatario ? strettamente proibito e pu? dar luogo a responsabilit? di carattere civile e penale punibili ai sensi di legge.
Questa e-mail ha valore legale solo se firmata digitalmente ai sensi della normativa vigente.

The contents of this email message and any attachments are intended solely for the addressee(s) and contain confidential and/or privileged information.
If you are not the intended recipient of this message, or if this message has been addressed to you in error, please immediately notify the sender and then delete this message and any attachments from your system. If you are not the intended recipient, you are hereby notified that any use, dissemination, copying, or storage of this message or its attachments is strictly prohibited. Unauthorized disclosure and/or use of information contained in this email message may result in civil and criminal liability. ?
This e-mail has legal value according to the applicable laws only if it is digitally signed by the sender
-----Messaggio originale-----
Da: Alex Rousskov [mailto:rousskov at measurement-factory.com]
Inviato: luned? 30 ottobre 2017 17:22
A: Troiano Alessio <alessio.troiano at leonardocompany.com>; squid-users at lists.squid-cache.org
Oggetto: Re: [squid-users] Squid doesn't reload webpage like other clients do

On 10/30/2017 03:51 AM, Troiano Alessio wrote:

> I've squid 3.5.20 running on RHEL 7.4. I have a problem to access some
> websites, for example www.nato.int. This website apply an Anti-DDoS
> system that reset the first connection after the TCP 3-way handshake
> (SYN/SYN-ACK/ACK/RST-ACK). All subsequent TCP connections are
> accepted. The website administrator say's it is by design.


> When I browse the site with squid proxy the browser receive an "Empty
> Response" squid error page (HTTP error code 502 Bad Gateway) and
> doesn't do the automatic retry:

This is by design as well :-).

We can change Squid behavior to retry connection resets, but I am sure that some folks will not like the new behavior because in _their_ use cases a retry is wasteful and/or painful. IMHO, the new behavior should be controlled by a configuration directive, possibly an ACL-driven one.

Quality patches implementing the above feature should be welcomed IMO.
The tip of the relevant code is probably in ERR_ZERO_SIZE_OBJECT handling inside FwdState::fail(). There is a similar code that handles persistent connection races there already, but the zero-size reply code may need a new dedicated FwdState flag to prevent infinite retry loops when the origin server is broken (a much more typical use case than the weird attempt at DDoS mitigation that you have described above).

https://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F


HTH,

Alex.


From squid3 at treenet.co.nz  Tue Oct 31 08:51:36 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 31 Oct 2017 21:51:36 +1300
Subject: [squid-users] Squid doesn't reload webpage like other clients do
In-Reply-To: <6a0985c1-394d-c19b-f03d-a658e937ab42@measurement-factory.com>
References: <f877aee786b8477e9c6191a9d6edc32a@ocgepvsw3101.ocr.priv>
 <6a0985c1-394d-c19b-f03d-a658e937ab42@measurement-factory.com>
Message-ID: <98941ab1-fc1d-8d2a-b1bf-41ab834d7be9@treenet.co.nz>

On 31/10/17 05:22, Alex Rousskov wrote:
> On 10/30/2017 03:51 AM, Troiano Alessio wrote:
> 
>> I've squid 3.5.20 running on RHEL 7.4. I have a problem to access
>> some websites, for example www.nato.int. This website apply an
>> Anti-DDoS system that reset the first connection after the TCP 3-way
>> handshake (SYN/SYN-ACK/ACK/RST-ACK). All subsequent TCP connections
>> are accepted. The website administrator say's it is by design.
> 
> 
>> When I browse the site with squid proxy the browser receive an "Empty
>> Response" squid error page (HTTP error code 502 Bad Gateway) and
>> doesn't do the automatic retry:
> 
> This is by design as well :-).
> 
> We can change Squid behavior to retry connection resets, but I am sure
> that some folks will not like the new behavior because in _their_ use
> cases a retry is wasteful and/or painful. IMHO, the new behavior should
> be controlled by a configuration directive, possibly an ACL-driven one.
> > Quality patches implementing the above feature should be welcomed IMO.
> The tip of the relevant code is probably in ERR_ZERO_SIZE_OBJECT
> handling inside FwdState::fail(). There is a similar code that handles
> persistent connection races there already, but the zero-size reply code
> may need a new dedicated FwdState flag to prevent infinite retry loops
> when the origin server is broken (a much more typical use case than the
> weird attempt at DDoS mitigation that you have described above).
> 
> https://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F
> 
> 
> HTH,
> 
> Alex.
> 
> 
> 
>> [root at soc-pe-nagios01 ~]# wget www.nato.int -e use_proxy=yes -e http_proxy=172.31.1.67:8080
>> --2017-10-30 10:41:09--  http://www.nato.int/
>> Connecting to 172.31.1.67:8080... connected.
>> Proxy request sent, awaiting response... 502 Bad Gateway
>> 2017-10-30 10:41:09 ERROR 502: Bad Gateway.
>>
>> I can't find an RFC that confirm if browser and proxyes should try a page reload, or if squid has an option to do that.

FWIW: what Squid is seeing is that the TCP is *successful*, then the 
HTTP request delivery gets a TCP RST. This is indistinguishable from the 
many broken IP/VPN tunnel, path-MTU and NAT errors that occur all over 
the Internet on a regular basis.


That operational state (HTTP underway) also means RFC 7230 is the 
relevant place to look for behaviour requirements. Section 6.3.1 says:

Browsers requirement:
"
   a client MAY open a
    new connection and automatically retransmit an aborted sequence of
    requests if all of those requests have idempotent methods (Section
    4.2.2 of [RFC7231]).
"

Squid requirement:
"
   A proxy MUST NOT automatically retry non-idempotent requests.
"

So it depends entirely on what type of HTTP request was being performed. 
If it was CONNECT, POST or similar then retry is forbidden.

Squid should already be re-trying for GET requests and similar. If it is 
not then that can be treated as a bug. Alex already pointed out the code 
place to look at for retry handling. The 'Method' class in Squid 
provides an isIdempotent() accessor that can be used to check whether 
the request is retriable or not.

Amos


From squid3 at treenet.co.nz  Tue Oct 31 08:53:19 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Tue, 31 Oct 2017 21:53:19 +1300
Subject: [squid-users] R: Squid doesn't reload webpage like other
 clients do
In-Reply-To: <e44ab64f28f947818d9ff3fdd1a3ed0b@ocgepvsw3101.ocr.priv>
References: <f877aee786b8477e9c6191a9d6edc32a@ocgepvsw3101.ocr.priv>
 <18853_1509380533_59F751B5_18853_6776_1_6a0985c1-394d-c19b-f03d-a658e937ab42@measurement-factory.com>
 <e44ab64f28f947818d9ff3fdd1a3ed0b@ocgepvsw3101.ocr.priv>
Message-ID: <c7d19fa0-8c02-3e62-f8a0-9a239efff913@treenet.co.nz>

On 31/10/17 21:29, Troiano Alessio wrote:
> Thank you Alex.
> Can't be an idea to "forward" the rst to the client? In this way the proxy will be totally transparent and the reload is demanded to the client (browser).
> 
> Alessio
> 

That one is already on the wishlist and even has a old patch that seems 
never to have received the final steps for submission:
<https://bugs.squid-cache.org/show_bug.cgi?id=2042>

Amos


From m_zouhairy at skno.by  Tue Oct 31 09:05:21 2017
From: m_zouhairy at skno.by (Vacheslav)
Date: Tue, 31 Oct 2017 12:05:21 +0300
Subject: [squid-users] can't block streaming
Message-ID: <01df01d35227$6188bdf0$249a39d0$@skno.by>

Peace,

I tired searching and debugging but I couldn't find a solution, whatever I
do youtube keeps working.

Here is my configuration:

 

 

# Recommended minimum configuration:

#

 

# Example rule allowing access from your local networks.

# Adapt to list your (internal) IP networks from where browsing

# should be allowed

acl localnet src 10.0.0.0/8              # RFC1918 possible internal network

#acl localnet src 172.16.0.0/12    # RFC1918 possible internal network

#acl localnet src 192.168.0.0/16  # RFC1918 possible internal network

#acl localnet src fc00::/7       # RFC 4193 local private network range

#acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged)
machines

 

acl SSL_ports port 443

acl Safe_ports port 80                    # http

acl Safe_ports port 21                    # ftp

acl Safe_ports port 443                  # https

acl Safe_ports port 70                    # gopher

acl Safe_ports port 210                  # wais

acl Safe_ports port 1025-65535  # unregistered ports

acl Safe_ports port 280                  # http-mgmt

acl Safe_ports port 488                  # gss-http

acl Safe_ports port 591                  # filemaker

acl Safe_ports port 777                  # multiling http

acl CONNECT method CONNECT

acl blockfiles urlpath_regex -i "/etc/squid/blocks.files.acl"

 

 

 

# Media Streams

 

 

## MediaPlayer MMS Protocol

acl media rep_mime_type mms

acl mediapr url_regex dvrplayer mediastream ^mms://

## (Squid does not yet handle the URI as a known proto type.)

 

 

## Active Stream Format (Windows Media Player)

acl media rep_mime_type x-ms-asf

acl mediapr1 urlpath_regex \.(afx|asf)(\?.*)?$

 

 

## Flash Video Format

acl media rep_mime_type video/flv video/x-flv

acl mediapr2 urlpath_regex \.flv(\?.*)?$

 

 

## Flash General Media Scripts (Animation)

acl media rep_mime_type application/x-shockwave-flash

acl mediapr3 urlpath_regex \.swf(\?.*)?$

 

 

## Others currently unknown

acl media rep_mime_type ms-hdr

acl media rep_mime_type x-fcs

 

 

http_access deny mediapr

http_access deny mediapr1

http_access deny mediapr2

http_access deny mediapr3

http_reply_access deny media

#

# Recommended minimum Access Permission configuration:

#

# Deny requests to certain unsafe ports

http_access deny !Safe_ports

 

# Deny CONNECT to other than secure SSL ports

http_access deny CONNECT !SSL_ports

 

# Only allow cachemgr access from localhost

http_access allow localhost manager

http_access deny manager

 

# We strongly recommend the following be uncommented to protect innocent

# web applications running on the proxy server who think the only

# one who can access services on "localhost" is a local user

#http_access deny to_localhost

 

# Deny all blocked extension

error_directory /usr/share/squid/errors/en

deny_info ERR_BLOCKED_FILES blockfiles

http_access deny blockfiles

 

#

# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS

#

 

# Example rule allowing access from your local networks.

# Adapt localnet in the ACL section to list your (internal) IP networks

# from where browsing should be allowed

http_access allow localnet

 

# Allow localhost always proxy functionality

http_access allow localhost

 

# And finally deny all other access to this proxy

http_access deny all

 

# Squid normally listens to port 3128

http_port 3128

 

# Uncomment and adjust the following to add a disk cache directory.

#cache_dir aufs /var/cache/squid 100 16 256

 

# Leave coredumps in the first cache dir

coredump_dir /var/cache/squid

 

#

# Add any of your own refresh_pattern entries above these.

#

refresh_pattern ^ftp:                     1440       20%        10080

refresh_pattern ^gopher:            1440       0%          1440

refresh_pattern -i (/cgi-bin/|\?) 0             0%          0

refresh_pattern .                             0              20%        4320

 

#url_rewrite_program /usr/sbin/squidGuard

#url_rewrite_children 5

#debug_options ALL,1 33,2 28,9

 

And where must I place the before last 2 lines in order for squid guard to
work?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171031/d7999b8f/attachment.htm>

From squid3 at treenet.co.nz  Tue Oct 31 14:45:18 2017
From: squid3 at treenet.co.nz (Amos Jeffries)
Date: Wed, 1 Nov 2017 03:45:18 +1300
Subject: [squid-users] can't block streaming
In-Reply-To: <01df01d35227$6188bdf0$249a39d0$@skno.by>
References: <01df01d35227$6188bdf0$249a39d0$@skno.by>
Message-ID: <0142c03e-f30b-f1a9-b331-2d1c7e9697a0@treenet.co.nz>

On 31/10/17 22:05, Vacheslav wrote:
> Peace,
> 
> I tired searching and debugging but I couldn?t find a solution, whatever 
> I do youtube keeps working.
> 
> Here is my configuration:
...
> # Media Streams
> 
> ## MediaPlayer MMS Protocol
> 
> acl media rep_mime_type mms
> 
> acl mediapr url_regex dvrplayer mediastream ^mms://
> 
> ## (Squid does not yet handle the URI as a known proto type.)

Unsupported URI schemes should result in the client receiving an HTTP 
error page instead of Squid handling the traffic.

Which also explains your problems: the Browser is either not using the 
proxy at all for this traffic, or sending the traffic through a CONNECT 
tunnel that is allowed to be created for other reasons.

...

> # We strongly recommend the following be uncommented to protect innocent
> 
> # web applications running on the proxy server who think the only
> 
> # one who can access services on "localhost" is a local user
> 
> #http_access deny to_localhost
> 
> # Deny all blocked extension
> 
> error_directory /usr/share/squid/errors/en
> 
> deny_info ERR_BLOCKED_FILES blockfiles
> 
> http_access deny blockfiles
> 
> #
> 
> # INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
> 

Please read the above line, and consider all the custom rules you placed 
above it.

...
> 
> #url_rewrite_program /usr/sbin/squidGuard
> 
> #url_rewrite_children 5
> 
> #debug_options ALL,1 33,2 28,9
> 
> And where must I place the before last 2 lines in order for squid guard 
> to work?
> 

Right there where they are in your config will do.

What do you expect SquidGuard to do?

If Squid itself cannot identify any URLs with "mms://" scheme there is 
no hope of SG being passed the non-existent URLs.

Amos


From xpro6000 at gmail.com  Tue Oct 31 15:09:07 2017
From: xpro6000 at gmail.com (xpro6000)
Date: Tue, 31 Oct 2017 11:09:07 -0400
Subject: [squid-users] IPv6 only network
In-Reply-To: <743353c0-30db-0013-c8e4-0b609ea625ff@treenet.co.nz>
References: <CAFoK1azfez2-Kda9idhGc+8_SKG7bpavU0UTsyzrM9srFHA8Kg@mail.gmail.com>
 <743353c0-30db-0013-c8e4-0b609ea625ff@treenet.co.nz>
Message-ID: <CAFoK1axpP5i7M59=6Ysf5jHdFOVd4ps2DfcBmFO1KzRKOdi7Rw@mail.gmail.com>

Since at home I only have IPv4, I can't fully disable ipv4 on the squid
server OS. I think the best option for me would be to configure iptables to
reject ipv4 on any port other than port "3001" which is what squid is
accepting ipv4 connections to. Would that be possible with iptables?

On Tue, Oct 31, 2017 at 3:13 AM, Amos Jeffries <squid3 at treenet.co.nz> wrote:

> On 31/10/17 18:34, xpro6000 wrote:
>
>> Unfortunately my ISP does not provide an IPv6 IP, I need to create an
>> only IPv6 network so I can test an iphone app as required by the Apple store
>>
>> https://developer.apple.com/support/ipv6/ <https://developer.apple.com/s
>> upport/ipv6/>
>>
>>
> Squids' default behaviour is to follow BCP 177. So any use of IPv4 is a
> strong indication that the server used by your app is having IPv6
> connectivity issues.
>
> see "Limitations of Local Testing" at <https://developer.apple.com/l
> ibrary/ios/documentation/NetworkingInternetWeb/Conceptual/
> NetworkingOverview/UnderstandingandPreparingfortheIPv6Transi
> tion/UnderstandingandPreparingfortheIPv6Transition.html#//
> apple_ref/doc/uid/TP40010220-CH213-SW1>.
>
>
> What I did was, I created a VPS with IPv6 support, I added the following
>> to squid.conf
>>
>> http_port 3001
>> acl port1 myport 3001
>>
>
> Use "myportname" ACL type. 'myport' is deprecated.
>
> tcp_outgoing_address 2001:19f1:9232:d4d:b757:3535:1910:412e port1
>> server_persistent_connections off
>>
>
> Why disabling persistence? it has nothing to do with IPv4 vs IPv6.
>
>
>> The config above works fine. If the website supports IPv6, it does use
>> that IPv6 IP. But Squid uses IPv4 if the website does not support IPv6
>>
>> Is there anyway to prevent Squid to use IPv4 for outgoing connections?
>>
>>
> IPv4 is not yet an optional protocol so technically no. But there are
> several ways to safely achieve IPv6-only traffic:
>
> * some DNS resolvers can be configured not to deliver A records.
>
> * ensure the NIC of the machine running Squid has no IPv4 addresses.
>
> * ensure that IPv4 space is all non-routable.
>
> * ensure your Squid machines firewall is configured to reject (_not_ drop)
> IPv4 packets.
>
>
> Notice how all of those are things you would need to do to make your
> network *actually* IPv6-only and have nothing directly to do with Squid.
>
> Amos
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171031/13afb1ed/attachment.htm>

From rousskov at measurement-factory.com  Tue Oct 31 15:32:36 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 31 Oct 2017 09:32:36 -0600
Subject: [squid-users] IPv6 only network
In-Reply-To: <743353c0-30db-0013-c8e4-0b609ea625ff@treenet.co.nz>
References: <CAFoK1azfez2-Kda9idhGc+8_SKG7bpavU0UTsyzrM9srFHA8Kg@mail.gmail.com>
 <743353c0-30db-0013-c8e4-0b609ea625ff@treenet.co.nz>
Message-ID: <29010f0f-7f24-b003-7757-444fff4a8730@measurement-factory.com>

On 10/31/2017 01:13 AM, Amos Jeffries wrote:

> Why disabling persistence? it has nothing to do with IPv4 vs IPv6.

FWIW, the author is correctly following squid.conf instructions: "The
use of this directive using client dependent ACLs is incompatible with
the use of server side persistent connections. To ensure correct results
it is best to set server_persistent_connections to off when using this
directive in such configurations."

As you know, the tcp_outgoing_address directive has an implicit (but
documented) "preserve selected address family" rule which makes it
useless for directing requests to IPv6 servers.

Squid appears to lack a good general-purpose knob to route traffic to a
particular address family: The address resolution code accepts any
supported family, and the address selection code has no family
discrimination code either. Adding destination_access or a similar new
configuration directive (with a few new ACLs?) would address this and
similar use cases.

Alex.


> acl port1 myport 3001

> tcp_outgoing_address 2001:19f1:9232:d4d:b757:3535:1910:412e port1

> server_persistent_connections off 



From rousskov at measurement-factory.com  Tue Oct 31 16:39:13 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 31 Oct 2017 10:39:13 -0600
Subject: [squid-users] R: Squid doesn't reload webpage like other
 clients do
In-Reply-To: <c7d19fa0-8c02-3e62-f8a0-9a239efff913@treenet.co.nz>
References: <f877aee786b8477e9c6191a9d6edc32a@ocgepvsw3101.ocr.priv>
 <18853_1509380533_59F751B5_18853_6776_1_6a0985c1-394d-c19b-f03d-a658e937ab42@measurement-factory.com>
 <e44ab64f28f947818d9ff3fdd1a3ed0b@ocgepvsw3101.ocr.priv>
 <c7d19fa0-8c02-3e62-f8a0-9a239efff913@treenet.co.nz>
Message-ID: <181c99bb-4ec7-c95b-66df-89d5376c607b@measurement-factory.com>

On 10/31/2017 02:53 AM, Amos Jeffries wrote:
> On 31/10/17 21:29, Troiano Alessio wrote:
>> Can't be an idea to "forward" the rst to the client? In this way the
>> proxy will be totally transparent and the reload is demanded to the
>> client (browser).

> That one is already on the wishlist and even has a old patch

... but the patch claims to have no affect on cases where Squid responds
with an error page. That choice made it possible for that implementation
to be configuration-free.

If Squid starts forwarding *all* connection resets to clients, then some
admins will rightfully complain that their users deserve a nice
proxy-generated error page with a support ticket submission interface
(instead of a silent connection reset with a confusing browser error page).

In summary, no single behavior will satisfy everybody. We need a new
configuration option flexible enough to cover known use cases, including
Alessio's. For example, on_server_error with "retry", "respond", and
"terminate" actions (ideally with an ACL to detect cases where there are
no unused peer addresses left to try and an ACL to count the number of
retries for the current peer address).

Alex.


From rousskov at measurement-factory.com  Tue Oct 31 16:53:13 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 31 Oct 2017 10:53:13 -0600
Subject: [squid-users] Squid doesn't reload webpage like other clients do
In-Reply-To: <98941ab1-fc1d-8d2a-b1bf-41ab834d7be9@treenet.co.nz>
References: <f877aee786b8477e9c6191a9d6edc32a@ocgepvsw3101.ocr.priv>
 <6a0985c1-394d-c19b-f03d-a658e937ab42@measurement-factory.com>
 <98941ab1-fc1d-8d2a-b1bf-41ab834d7be9@treenet.co.nz>
Message-ID: <6e9f85bc-5dc6-c377-1fb5-204619972ace@measurement-factory.com>

On 10/31/2017 02:51 AM, Amos Jeffries wrote:
> That operational state (HTTP underway) also means RFC 7230 is the
> relevant place to look for behaviour requirements. Section 6.3.1 says:

> ? A proxy MUST NOT automatically retry non-idempotent requests.

> So it depends entirely on what type of HTTP request was being performed.

Unfortunately, it is more nuanced than that. The RFC section you are
quoting lives inside the "6.3. Persistence" section about persistent
connections. It also talks about retransmitting a "sequence of
requests", further implying connection persistency scope. The old RFC
2616 even gave a very pconn-specific example as the rationale.

Squid implementation assumes that all those requirements apply to
persistent connection race conditions and only to those conditions.
Whether that is what RFC authors wanted is not clear to me. It would be
nice to clarify that with the HTTP WG. Any volunteers?

Alex.


From jimoe at sohnen-moe.com  Tue Oct 31 17:50:55 2017
From: jimoe at sohnen-moe.com (James Moe)
Date: Tue, 31 Oct 2017 10:50:55 -0700
Subject: [squid-users] Manager access for statistics
In-Reply-To: <f1be1e45-4647-c9d4-53dc-668f0fc8e3cf@treenet.co.nz>
References: <sig.047579d404.7174992d-28e1-c1db-4b74-f31953ac35f9@sohnen-moe.com>
 <3b04ac5e-9188-45f6-6b67-9972b9690cf5@treenet.co.nz>
 <sig.14753a271a.faebd09c-ba20-b8bc-a9ad-ac5680912266@sohnen-moe.com>
 <f1be1e45-4647-c9d4-53dc-668f0fc8e3cf@treenet.co.nz>
Message-ID: <sig.1477c9a09c.6c0322f0-d71a-689d-adea-8e93115570f4@sohnen-moe.com>

On 10/30/2017 10:16 AM, Amos Jeffries wrote:
>
> Between them these entries appear to be saying that you have very 
> probably configured the Squid machines host name as "sma-server3" 
> instead of "proxy1.sma.com".
>
  "proxy1.sma.com" is an alias for sma-server3.sma.com.
  I have tried using sma-server3 directly with the same disappointing
result.
  I presume that I have mis-configured Squid somehow, a safe assumption.
I do not see the error, though.

-- 
James Moe
moe dot james at sohnen-moe dot com
520.743.3936
Think.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 181 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171031/cc4cb425/attachment.sig>

From pheriko.support at gmail.com  Tue Oct 31 20:16:12 2017
From: pheriko.support at gmail.com (Periko Support)
Date: Tue, 31 Oct 2017 13:16:12 -0700
Subject: [squid-users] WIndows Server AD+Squid Integration: Query User Specs
Message-ID: <CAK2yrTaty2uFRugOHOiKLZXbraePx1DCvrLm-hhxSSOK393Bxw@mail.gmail.com>

HI Guys.

I want to integrate my authtenticacion vs a Windows Server 2012 R2 AD,
my doubt is related to the user I have to use from the AD.

What type of user can I use for squid config to query our AD?

Must be from the Admin group or must a specific role?

Squid 3.5.x, thanks guys for your time!!!


From yvoinov at gmail.com  Tue Oct 31 20:19:17 2017
From: yvoinov at gmail.com (Yuri)
Date: Wed, 1 Nov 2017 02:19:17 +0600
Subject: [squid-users] WIndows Server AD+Squid Integration: Query User
 Specs
In-Reply-To: <CAK2yrTaty2uFRugOHOiKLZXbraePx1DCvrLm-hhxSSOK393Bxw@mail.gmail.com>
References: <CAK2yrTaty2uFRugOHOiKLZXbraePx1DCvrLm-hhxSSOK393Bxw@mail.gmail.com>
Message-ID: <c3fa4c52-6366-51df-5549-c0c0a0e2b6d0@gmail.com>



01.11.2017 2:16, Periko Support ?????:
> HI Guys.
>
> I want to integrate my authtenticacion vs a Windows Server 2012 R2 AD,
> my doubt is related to the user I have to use from the AD.
>
> What type of user can I use for squid config to query our AD?
>
> Must be from the Admin group or must a specific role?
The principle of the least privilege. What kind of devil is a member of
the "Administrators" group?!

At max member of group "Users".
>
> Squid 3.5.x, thanks guys for your time!!!
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
**************************
* C++: Bug to the future *
**************************

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171101/7ecefae9/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171101/7ecefae9/attachment.sig>

From pheriko.support at gmail.com  Tue Oct 31 20:28:39 2017
From: pheriko.support at gmail.com (Periko Support)
Date: Tue, 31 Oct 2017 13:28:39 -0700
Subject: [squid-users] WIndows Server AD+Squid Integration: Query User
	Specs
In-Reply-To: <c3fa4c52-6366-51df-5549-c0c0a0e2b6d0@gmail.com>
References: <CAK2yrTaty2uFRugOHOiKLZXbraePx1DCvrLm-hhxSSOK393Bxw@mail.gmail.com>
 <c3fa4c52-6366-51df-5549-c0c0a0e2b6d0@gmail.com>
Message-ID: <CAK2yrTa+yxkNjNWcVzC=O6DkuvaNqnqt6M1vCeDU6NX1rcojbA@mail.gmail.com>

Don't hate me Yuri, this is why I ask first.
Group Users, them I can use any user for my squid settings?
Thanks...don't hate me please..

On Tue, Oct 31, 2017 at 1:19 PM, Yuri <yvoinov at gmail.com> wrote:
>
>
> 01.11.2017 2:16, Periko Support ?????:
>> HI Guys.
>>
>> I want to integrate my authtenticacion vs a Windows Server 2012 R2 AD,
>> my doubt is related to the user I have to use from the AD.
>>
>> What type of user can I use for squid config to query our AD?
>>
>> Must be from the Admin group or must a specific role?
> The principle of the least privilege. What kind of devil is a member of
> the "Administrators" group?!
>
> At max member of group "Users".
>>
>> Squid 3.5.x, thanks guys for your time!!!
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>
> --
> **************************
> * C++: Bug to the future *
> **************************
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


From yvoinov at gmail.com  Tue Oct 31 20:30:37 2017
From: yvoinov at gmail.com (Yuri)
Date: Wed, 1 Nov 2017 02:30:37 +0600
Subject: [squid-users] WIndows Server AD+Squid Integration: Query User
 Specs
In-Reply-To: <CAK2yrTa+yxkNjNWcVzC=O6DkuvaNqnqt6M1vCeDU6NX1rcojbA@mail.gmail.com>
References: <CAK2yrTaty2uFRugOHOiKLZXbraePx1DCvrLm-hhxSSOK393Bxw@mail.gmail.com>
 <c3fa4c52-6366-51df-5549-c0c0a0e2b6d0@gmail.com>
 <CAK2yrTa+yxkNjNWcVzC=O6DkuvaNqnqt6M1vCeDU6NX1rcojbA@mail.gmail.com>
Message-ID: <29846fb0-e69d-d1fe-f629-bf0bb3f2db46@gmail.com>

(facepalm) Don't use superuser rights (or equivalent) - never - if you
really won't require it.

Yes, any user who has permissions to read access to AD.

01.11.2017 2:28, Periko Support ?????:
> Don't hate me Yuri, this is why I ask first.
> Group Users, them I can use any user for my squid settings?
> Thanks...don't hate me please..
>
> On Tue, Oct 31, 2017 at 1:19 PM, Yuri <yvoinov at gmail.com> wrote:
>>
>> 01.11.2017 2:16, Periko Support ?????:
>>> HI Guys.
>>>
>>> I want to integrate my authtenticacion vs a Windows Server 2012 R2 AD,
>>> my doubt is related to the user I have to use from the AD.
>>>
>>> What type of user can I use for squid config to query our AD?
>>>
>>> Must be from the Admin group or must a specific role?
>> The principle of the least privilege. What kind of devil is a member of
>> the "Administrators" group?!
>>
>> At max member of group "Users".
>>> Squid 3.5.x, thanks guys for your time!!!
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users
>> --
>> **************************
>> * C++: Bug to the future *
>> **************************
>>
>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users

-- 
**************************
* C++: Bug to the future *
**************************

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171101/d5252e49/attachment.key>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171101/d5252e49/attachment.sig>

From pheriko.support at gmail.com  Tue Oct 31 20:36:41 2017
From: pheriko.support at gmail.com (Periko Support)
Date: Tue, 31 Oct 2017 13:36:41 -0700
Subject: [squid-users] WIndows Server AD+Squid Integration: Query User
	Specs
In-Reply-To: <29846fb0-e69d-d1fe-f629-bf0bb3f2db46@gmail.com>
References: <CAK2yrTaty2uFRugOHOiKLZXbraePx1DCvrLm-hhxSSOK393Bxw@mail.gmail.com>
 <c3fa4c52-6366-51df-5549-c0c0a0e2b6d0@gmail.com>
 <CAK2yrTa+yxkNjNWcVzC=O6DkuvaNqnqt6M1vCeDU6NX1rcojbA@mail.gmail.com>
 <29846fb0-e69d-d1fe-f629-bf0bb3f2db46@gmail.com>
Message-ID: <CAK2yrTbqWoBLW_XjAxGYYaoNf-1Yc=xAs+b=otR+_dUPxxnDFg@mail.gmail.com>

Testing teacher, let u know, thanks and hi-5...

On Tue, Oct 31, 2017 at 1:30 PM, Yuri <yvoinov at gmail.com> wrote:
> (facepalm) Don't use superuser rights (or equivalent) - never - if you
> really won't require it.
>
> Yes, any user who has permissions to read access to AD.
>
> 01.11.2017 2:28, Periko Support ?????:
>> Don't hate me Yuri, this is why I ask first.
>> Group Users, them I can use any user for my squid settings?
>> Thanks...don't hate me please..
>>
>> On Tue, Oct 31, 2017 at 1:19 PM, Yuri <yvoinov at gmail.com> wrote:
>>>
>>> 01.11.2017 2:16, Periko Support ?????:
>>>> HI Guys.
>>>>
>>>> I want to integrate my authtenticacion vs a Windows Server 2012 R2 AD,
>>>> my doubt is related to the user I have to use from the AD.
>>>>
>>>> What type of user can I use for squid config to query our AD?
>>>>
>>>> Must be from the Admin group or must a specific role?
>>> The principle of the least privilege. What kind of devil is a member of
>>> the "Administrators" group?!
>>>
>>> At max member of group "Users".
>>>> Squid 3.5.x, thanks guys for your time!!!
>>>> _______________________________________________
>>>> squid-users mailing list
>>>> squid-users at lists.squid-cache.org
>>>> http://lists.squid-cache.org/listinfo/squid-users
>>> --
>>> **************************
>>> * C++: Bug to the future *
>>> **************************
>>>
>>>
>>> _______________________________________________
>>> squid-users mailing list
>>> squid-users at lists.squid-cache.org
>>> http://lists.squid-cache.org/listinfo/squid-users
>>>
>> _______________________________________________
>> squid-users mailing list
>> squid-users at lists.squid-cache.org
>> http://lists.squid-cache.org/listinfo/squid-users
>
> --
> **************************
> * C++: Bug to the future *
> **************************
>
>
> _______________________________________________
> squid-users mailing list
> squid-users at lists.squid-cache.org
> http://lists.squid-cache.org/listinfo/squid-users
>


From johnrefwe at mail.com  Tue Oct 31 20:42:45 2017
From: johnrefwe at mail.com (John Refwe)
Date: Tue, 31 Oct 2017 21:42:45 +0100
Subject: [squid-users] adaptation_meta not passing through "%<a"
Message-ID: <trinity-e6017c42-0dcb-4dfe-9d09-948998bf5cb0-1509482565396@3c-app-mailcom-lxa02>

An HTML attachment was scrubbed...
URL: <http://lists.squid-cache.org/pipermail/squid-users/attachments/20171031/ed56bed6/attachment.htm>

From rousskov at measurement-factory.com  Tue Oct 31 21:31:42 2017
From: rousskov at measurement-factory.com (Alex Rousskov)
Date: Tue, 31 Oct 2017 15:31:42 -0600
Subject: [squid-users] adaptation_meta not passing through "%<a"
In-Reply-To: <trinity-e6017c42-0dcb-4dfe-9d09-948998bf5cb0-1509482565396@3c-app-mailcom-lxa02>
References: <trinity-e6017c42-0dcb-4dfe-9d09-948998bf5cb0-1509482565396@3c-app-mailcom-lxa02>
Message-ID: <7f0919d9-fdec-3ad4-9c15-aea831e82aa9@measurement-factory.com>

On 10/31/2017 02:42 PM, John Refwe wrote:
 ?
> I am trying to have squid pass through the destination server IP address
> to my RESPMOD ICAP via the adaptation_meta directive.
> ?
> My configuration line looks as follows:
> ?
> adaptation_meta DST_IP "%<a" all

The bug fix started as master 7d1dac7 (a.k.a. r14505) and was fully
fixed in master 1ce66e2 (a.k.a. r14525):

  https://github.com/squid-cache/squid/commit/7d1dac7
  https://github.com/squid-cache/squid/commit/1ce66e2

AFAICT, the fix has not been backported to v3 but is available in v4+.

Alex.
P.S. It is traditional to use "-" instead of "_" in HTTP and ICAP header
field names and prefix non-standard names with X. In your particular
case, there is an almost-standard ICAP header name that you may want to
use instead of DST_IP: X-Server-IP.


From synfinatic at gmail.com  Wed Oct 25 16:41:36 2017
From: synfinatic at gmail.com (Aaron Turner)
Date: Wed, 25 Oct 2017 16:41:36 -0000
Subject: [squid-users] tuning squid memory (aka avoiding the reaper)
In-Reply-To: <CANAZdzXsCD2A4pxDRZ-9TevXvsWkUiBZenKDGEM-4iQ_3znoUw@mail.gmail.com>
References: <CANAZdzXS7jFH_n44BgdYALzE_r3D7t78HRamz9qdKsbtfOVyqg@mail.gmail.com>
 <6fd4bb1b-8ec5-4883-2c57-8debb3890d9a@measurement-factory.com>
 <CANAZdzUDViPoOxXVUyd0=Krz+xdyn_R0viJXxLNEMmmGtFs5jA@mail.gmail.com>
 <54372253-c45a-7ca2-37f8-8ecbdbd3ba27@treenet.co.nz>
 <CANAZdzXK4D14OaNpBLCm5ZPcgau_2+B38sXM2mTDe_bB8QwFvg@mail.gmail.com>
 <763e182c-d966-fd6a-ed2b-0c20d17c3274@treenet.co.nz>
 <CANAZdzV293R30V4Eex7B99vCJz_5JQ=4+SiaGD-65GivsQzALw@mail.gmail.com>
 <CANAZdzVsEGcPhCgC0tWAwumoGS4kRUJTXgY8ftP3H9L9HOYq4w@mail.gmail.com>
 <CANAZdzXWDn_FvQYdYn=ufK5-CdCPQBQWUx+0Z5+akzpwh_sMYg@mail.gmail.com>
 <23fca10f-f62a-7091-085d-0fb83fc1321e@treenet.co.nz>
 <CANAZdzXNxt6ZgXVsA9XE0N5RHxujVyMHccro52gXOPspJH99Aw@mail.gmail.com>
 <e13ba30e-adae-3ac9-aa1e-6ef4ea22b56f@measurement-factory.com>
 <CANAZdzXsCD2A4pxDRZ-9TevXvsWkUiBZenKDGEM-4iQ_3znoUw@mail.gmail.com>
Message-ID: <CANAZdzW84wLyRLfw=8Kn=i8cvKBBRe1T+REfdnqgAo2UJwG+Fg@mail.gmail.com>

More testing.  This time with 4.0.21.  Disabled all caching, only
enabled ssl bumping.  Same config as last time.  Still leaking memory.
I took two snapshots of info & mem usage and honestly I don't see a
smoking gun pointing to why my squid processes were getting as large
as 1.4GB.

I've attached the two files incase someone with more experience can
find something useful.
--
Aaron Turner
https://synfin.net/         Twitter: @synfinatic
My father once told me that respect for the truth comes close to being
the basis for all morality.  "Something cannot emerge from nothing,"
he said.  This is profound thinking if you understand how unstable
"the truth" can be.  -- Frank Herbert, Dune


On Mon, Oct 9, 2017 at 5:04 PM, Aaron Turner <synfinatic at gmail.com> wrote:
> So more testing.  I haven't found the line in the info:mem logs which
> is the red flag, but additional testing proves that the memleak has
> something to do with ssl bumping.  Once I turn that off, the memory
> leaks stop.
>
> this was the ssl related config options:
>
> http_port 10.0.0.1:3128 ssl-bump generate-host-certificates=on
> dynamic_cert_mem_cache_size=400MB cert=/etc/squid/ssl_cert/myCA.pem
> sslflags=NO_DEFAULT_CA
> http_port localhost:3128
> ssl_bump bump all
>
> sslcrtd_program /usr/lib64/squid/ssl_crtd -s /var/lib/squid/ssl_db -M 4MB
> sslcrtd_children 32 startup=2 idle=2
> sslproxy_session_cache_size 100 MB
> sslproxy_cert_error allow all
> sslproxy_flags DONT_VERIFY_PEER
>
> --
> Aaron Turner
> https://synfin.net/         Twitter: @synfinatic
> My father once told me that respect for the truth comes close to being
> the basis for all morality.  "Something cannot emerge from nothing,"
> he said.  This is profound thinking if you understand how unstable
> "the truth" can be.  -- Frank Herbert, Dune
>
>
> On Wed, Oct 4, 2017 at 10:53 AM, Alex Rousskov
> <rousskov at measurement-factory.com> wrote:
>> On 10/02/2017 09:37 PM, Aaron Turner wrote:
>>> So it's leaking memory and not tracking it?
>>
>>
>> That combination (or, to be more precise, its implication) is possible
>> but relatively unlikely in your specific case -- when GBs are leaked,
>> there is usually something tracked related to those GBs. Please note
>> that what Squid _tracks_ may not amount to GBs of RAM! For example,
>> Squid can track a tiny object that is included in every large untracked
>> leaked object.
>>
>> A frequent leak often manifests itself in mgr:mem snapshots as a nearly
>> always increasing counter of alive associated objects. If you take one
>> snapshot every 30 minutes or so, then you may be able to identify
>> suspects by comparing same-object alive counters across 5-10 snapshots.
>> Sorry, I do not have the time to do that for the snapshots you have
>> shared (and you probably need a different collection of snapshots to
>> make this search more productive).
>>
>> Alex.
>>
>>
>>> On Mon, Oct 2, 2017 at 8:25 PM, Amos Jeffries <squid3 at treenet.co.nz> wrote:
>>>> On 03/10/17 04:39, Aaron Turner wrote:
>>>>>
>>>>> Anyone see anything useful?
>>>>
>>>>
>>>> The numbers in those reports all seem reasonable to me. Nothing is showing
>>>> up with GB of RAM used.
-------------- next part --------------
HTTP/1.1 200 OK
Server: squid/4.0.21
Mime-Version: 1.0
Date: Mon, 23 Oct 2017 23:41:36 GMT
Content-Type: text/plain
Expires: Mon, 23 Oct 2017 23:41:36 GMT
Last-Modified: Mon, 23 Oct 2017 23:41:36 GMT
Connection: close

Squid Object Cache: Version 4.0.21
Build Info: 
Service Name: squid
Start Time:	Mon, 16 Oct 2017 18:33:27 GMT
Current Time:	Mon, 23 Oct 2017 23:41:36 GMT
Connection information for squid:
	Number of clients accessing cache:	16
	Number of HTTP requests received:	2028508
	Number of ICP messages received:	0
	Number of ICP messages sent:	0
	Number of queued ICP replies:	0
	Number of HTCP messages received:	0
	Number of HTCP messages sent:	0
	Request failure ratio:	 0.00
	Average HTTP requests per minute since start:	3312.7
	Average ICP messages per minute since start:	0.0
	Select loop called: 34173597 times, 50.898 ms avg
Cache information for squid:
	Hits as % of all requests:	5min: 0.0%, 60min: 0.0%
	Hits as % of bytes sent:	5min: 2.8%, 60min: 0.4%
	Memory hits as % of hit requests:	5min: 0.0%, 60min: 0.0%
	Disk hits as % of hit requests:	5min: 0.0%, 60min: 0.0%
	Storage Swap size:	0 KB
	Storage Swap capacity:	 0.0% used,  0.0% free
	Storage Mem size:	0 KB
	Storage Mem capacity:	 0.0% used,  0.0% free
	Mean Object Size:	0.00 KB
	Requests given to unlinkd:	0
Median Service Times (seconds)  5 min    60 min:
	HTTP Requests (All):   0.01498  0.01074
	Cache Misses:          0.05951  0.04053
	Cache Hits:            0.00000  0.00000
	Near Hits:             0.00000  0.00000
	Not-Modified Replies:  0.00000  0.00000
	DNS Lookups:           0.06734  0.06734
	ICP Queries:           0.00000  0.00000
Resource usage for squid:
	UP Time:	623288.509 seconds
	CPU Time:	3400.908 seconds
	CPU Usage:	11.12%
	CPU Usage, 5 minute avg:	24.60%
	CPU Usage, 60 minute avg:	50.72%
	Maximum Resident Size: 7643328 KB
	Page faults with physical i/o: 0
Memory accounted for:
	Total accounted:        16881 KB
	memPoolAlloc calls: 249677045
	memPoolFree calls:  250784841
File descriptor usage for squid:
	Maximum number of file descriptors:   65536
	Largest file desc currently in use:    471
	Number of file desc currently in use:  562
	Files queued for open:                   0
	Available number of file descriptors: 64974
	Reserved number of file descriptors:   400
	Store Disk files open:                   0
Internal Data Structures:
	     7 StoreEntries
	     7 StoreEntries with MemObjects
	     0 Hot Object Cache Items
	     0 on-disk objects
HTTP/1.1 200 OK
Server: squid/4.0.21
Mime-Version: 1.0
Date: Mon, 23 Oct 2017 23:41:37 GMT
Content-Type: text/plain
Expires: Mon, 23 Oct 2017 23:41:37 GMT
Last-Modified: Mon, 23 Oct 2017 23:41:37 GMT
Connection: close

by kid1 {
Current memory usage:
Pool	 Obj Size	Chunks							Allocated					In Use					Idle			Allocations Saved			Rate	
 	 (bytes)	KB/ch	 obj/ch	(#)	 used	 free	 part	 %Frag	 (#)	 (KB)	 high (KB)	 high (hrs)	 %Tot	(#)	 (KB)	 high (KB)	 high (hrs)	 %alloc	(#)	 (KB)	 high (KB)	(#)	 %cnt	 %vol	(#)/sec	
16KB Strings        	 16384	 	 	 	 	 	 	 	 112	 1792	 16128	 0.42	 35.862	 75	 1200	 16128	 0.42	 66.964	 37	 592	 6064	 3246796	 2.865	 46.210	 89.295
4KB Strings         	 4096	 	 	 	 	 	 	 	 328	 1312	 3524	 1.21	 26.256	 288	 1152	 3524	 1.21	 87.805	 40	 160	 1548	 1730462	 1.527	 6.157	 138.273
HttpRequest         	 1880	 	 	 	 	 	 	 	 93	 171	 1355	 1.21	 3.417	 55	 101	 1355	 1.21	 59.140	 38	 70	 482	 934344	 0.824	 1.526	 71.002
cbdata IdleConnList (27)	 4168	 	 	 	 	 	 	 	 40	 163	 3623	 0.42	 3.258	 32	 131	 3623	 0.42	 80.000	 8	 33	 1173	 112078	 0.099	 0.406	 5.005
cbdata Server (13)  	  776	 	 	 	 	 	 	 	 197	 150	 670	 1.21	 2.988	 188	 143	 670	 1.21	 95.431	 9	 7	 219	 321784	 0.284	 0.217	 28.136
cbdata clientReplyContext (15)	 4352	 	 	 	 	 	 	 	 32	 136	 272	 0.98	 2.722	 0	 0	 272	 0.98	 0.000	 32	 136	 268	 936372	 0.826	 3.540	 71.002
Stream              	 4216	 	 	 	 	 	 	 	 32	 132	 264	 0.98	 2.637	 0	 0	 264	 0.98	 0.000	 32	 132	 260	 935032	 0.825	 3.424	 71.002
32K Buffer          	 32768	 	 	 	 	 	 	 	 4	 128	 448	 1.21	 2.562	 4	 128	 448	 1.21	 100.000	 0	 0	 320	 16213	 0.014	 0.462	 0.003
ipcache_entry       	  128	 	 	 	 	 	 	 	 928	 116	 138	 0.43	 2.321	 920	 115	 138	 0.43	 99.138	 8	 1	 23	 18655	 0.016	 0.002	 0.572
mem_node            	 4136	 	 	 	 	 	 	 	 26	 106	 513	 0.98	 2.102	 1	 5	 513	 0.98	 3.846	 25	 101	 513	 4441490	 3.919	 15.958	 163.990
cbdata idns_query (21)	 8696	 	 	 	 	 	 	 	 11	 94	 128	 1.19	 1.869	 0	 0	 128	 1.19	 0.000	 11	 94	 128	 20817	 0.018	 0.157	 0.572
HttpHeaderEntry     	   56	 	 	 	 	 	 	 	 1651	 91	 930	 0.42	 1.807	 1287	 71	 930	 0.42	 77.953	 364	 20	 271	 36199087	 31.941	 1.761	 2530.065
Comm::Connection    	  208	 	 	 	 	 	 	 	 403	 82	 435	 0.42	 1.638	 282	 58	 435	 0.42	 69.975	 121	 25	 124	 1673834	 1.477	 0.302	 273.842
Long Strings        	  512	 	 	 	 	 	 	 	 145	 73	 387	 1.21	 1.451	 88	 44	 387	 1.21	 60.690	 57	 29	 133	 2048326	 1.807	 0.911	 215.367
MemBlob             	   48	 	 	 	 	 	 	 	 1363	 64	 335	 1.21	 1.279	 1240	 59	 335	 1.21	 90.976	 123	 6	 82	 21542706	 19.009	 0.898	 1353.119
Medium Strings      	  128	 	 	 	 	 	 	 	 495	 62	 413	 1.26	 1.238	 352	 44	 413	 1.26	 71.111	 143	 18	 119	 10387795	 9.166	 1.155	 772.473
8K Buffer           	 8192	 	 	 	 	 	 	 	 6	 48	 88	 1.25	 0.961	 1	 8	 88	 1.25	 16.667	 5	 40	 72	 355642	 0.314	 2.531	 7.586
cbdata ACLFilledChecklist (18)	  496	 	 	 	 	 	 	 	 81	 40	 344	 1.21	 0.785	 55	 27	 344	 1.21	 67.901	 26	 13	 115	 1650916	 1.457	 0.711	 154.605
HttpReply           	  288	 	 	 	 	 	 	 	 94	 27	 211	 1.21	 0.529	 56	 16	 211	 1.21	 59.574	 38	 11	 76	 2405466	 2.123	 0.602	 171.236
MimeEntry           	  144	 	 	 	 	 	 	 	 177	 25	 25	 173.14	 0.498	 177	 25	 25	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
1KB Strings         	 1024	 	 	 	 	 	 	 	 24	 24	 151	 1.35	 0.480	 7	 7	 151	 1.35	 29.167	 17	 17	 71	 464695	 0.410	 0.413	 21.021
cbdata FwdState (23)	  176	 	 	 	 	 	 	 	 139	 24	 26	 0.12	 0.478	 110	 19	 26	 0.12	 79.137	 29	 5	 11	 654591	 0.578	 0.100	 50.311
2K Buffer           	 2048	 	 	 	 	 	 	 	 10	 20	 124	 1.21	 0.400	 2	 4	 124	 1.21	 20.000	 8	 16	 62	 4920374	 4.342	 8.754	 350.334
16K Buffer          	 16384	 	 	 	 	 	 	 	 1	 16	 192	 1.54	 0.320	 1	 16	 192	 1.54	 100.000	 0	 0	 192	 59552	 0.053	 0.848	 0.017
cbdata ClientHttpRequest (14)	  392	 	 	 	 	 	 	 	 32	 13	 25	 0.98	 0.245	 0	 0	 25	 0.98	 0.000	 32	 13	 25	 936372	 0.826	 0.319	 71.002
4K Buffer           	 4096	 	 	 	 	 	 	 	 3	 12	 52	 1.27	 0.240	 0	 0	 52	 1.27	 0.000	 3	 12	 44	 199869	 0.176	 0.711	 11.784
MemObject           	  352	 	 	 	 	 	 	 	 31	 11	 23	 0.98	 0.213	 1	 1	 23	 0.98	 3.226	 30	 11	 22	 881582	 0.778	 0.270	 60.641
cbdata clientStreamNode (16)	  128	 	 	 	 	 	 	 	 64	 8	 16	 0.98	 0.160	 0	 0	 16	 0.98	 0.000	 64	 8	 16	 1872744	 1.652	 0.208	 142.004
cbdata HttpStateData (26)	  352	 	 	 	 	 	 	 	 21	 8	 21	 0.98	 0.144	 0	 0	 21	 0.98	 0.000	 21	 8	 21	 649831	 0.573	 0.199	 46.503
cbdata MemBuf (4)   	   72	 	 	 	 	 	 	 	 99	 7	 53	 1.21	 0.139	 60	 5	 53	 1.21	 60.606	 39	 3	 19	 3077741	 2.716	 0.192	 228.833
HttpHdrCc           	   96	 	 	 	 	 	 	 	 74	 7	 53	 1.21	 0.139	 51	 5	 53	 1.21	 68.919	 23	 3	 21	 1771410	 1.563	 0.148	 127.068
cbdata store_client (12)	  160	 	 	 	 	 	 	 	 31	 5	 10	 0.98	 0.097	 1	 1	 10	 0.98	 3.226	 30	 5	 10	 663190	 0.585	 0.092	 50.317
cbdata UdsSender (8)	 4528	 	 	 	 	 	 	 	 1	 5	 9	 173.14	 0.088	 0	 0	 9	 173.14	 0.000	 1	 5	 9	 5696	 0.005	 0.022	 0.007
cbdata Strand (9)   	 4520	 	 	 	 	 	 	 	 1	 5	 5	 173.14	 0.088	 1	 5	 5	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata Filler (11)  	 4216	 	 	 	 	 	 	 	 1	 5	 5	 173.09	 0.082	 1	 5	 5	 173.09	 100.000	 0	 0	 5	 4138	 0.004	 0.015	 0.007
StoreEntry          	  120	 	 	 	 	 	 	 	 31	 4	 8	 0.98	 0.073	 1	 1	 8	 0.98	 3.226	 30	 4	 8	 881582	 0.778	 0.092	 60.641
cbdata ps_state (24)	  256	 	 	 	 	 	 	 	 11	 3	 4	 1.19	 0.055	 0	 0	 4	 1.19	 0.000	 11	 3	 4	 655446	 0.578	 0.146	 50.311
cbdata BlindPeerConnector (29)	  224	 	 	 	 	 	 	 	 12	 3	 6	 1.32	 0.053	 0	 0	 6	 1.32	 0.000	 12	 3	 6	 87793	 0.077	 0.017	 32.495
ClientInfo          	  448	 	 	 	 	 	 	 	 5	 3	 3	 61.23	 0.044	 5	 3	 3	 61.23	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata Tree (1)     	  176	 	 	 	 	 	 	 	 12	 3	 3	 173.14	 0.041	 12	 3	 3	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata ConnOpener (25)	  136	 	 	 	 	 	 	 	 13	 2	 4	 1.17	 0.035	 0	 0	 4	 1.17	 0.000	 13	 2	 4	 100320	 0.089	 0.012	 33.266
AndNode             	  120	 	 	 	 	 	 	 	 13	 2	 2	 173.14	 0.030	 13	 2	 2	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata helper_server (3)	  328	 	 	 	 	 	 	 	 4	 2	 2	 1.55	 0.026	 4	 2	 2	 1.55	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata ErrorState (22)	  240	 	 	 	 	 	 	 	 5	 2	 2	 1.43	 0.023	 0	 0	 2	 1.43	 0.000	 5	 2	 2	 33106	 0.029	 0.007	 30.211
fqdncache_entry     	  160	 	 	 	 	 	 	 	 6	 1	 2	 0.55	 0.019	 6	 1	 2	 0.55	 100.000	 0	 0	 1	 10	 0.000	 0.000	 0.000
ACLStrategised      	  120	 	 	 	 	 	 	 	 5	 1	 1	 173.14	 0.012	 5	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
acl_ip_data         	   96	 	 	 	 	 	 	 	 6	 1	 1	 173.14	 0.011	 6	 1	 1	 173.14	 100.000	 0	 0	 1	 3	 0.000	 0.000	 0.000
MD5 digest          	   16	 	 	 	 	 	 	 	 31	 1	 2	 0.98	 0.010	 1	 1	 2	 0.98	 3.226	 30	 1	 1	 2171054	 1.916	 0.030	 137.836
ev_entry            	   48	 	 	 	 	 	 	 	 10	 1	 1	 1.26	 0.009	 7	 1	 1	 1.26	 70.000	 3	 1	 1	 1430023	 1.262	 0.060	 2.610
BodyPipe            	  136	 	 	 	 	 	 	 	 3	 1	 8	 1.22	 0.008	 0	 0	 8	 1.22	 0.000	 3	 1	 4	 18658	 0.016	 0.002	 0.024
cbdata Logfile (5)  	  352	 	 	 	 	 	 	 	 1	 1	 1	 173.14	 0.007	 1	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata generic_cbdata (20)	   32	 	 	 	 	 	 	 	 11	 1	 1	 1.19	 0.007	 0	 0	 1	 1.19	 0.000	 11	 1	 1	 20817	 0.018	 0.001	 0.572
FwdServer           	   32	 	 	 	 	 	 	 	 11	 1	 1	 1.19	 0.007	 0	 0	 1	 1.19	 0.000	 11	 1	 1	 655446	 0.578	 0.018	 50.311
cbdata helper (2)   	  296	 	 	 	 	 	 	 	 1	 1	 1	 173.14	 0.006	 1	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLSslErrorData     	   56	 	 	 	 	 	 	 	 5	 1	 1	 173.14	 0.005	 5	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLSourceIP         	  104	 	 	 	 	 	 	 	 2	 1	 1	 173.14	 0.004	 2	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata TcpAcceptor (10)	  104	 	 	 	 	 	 	 	 2	 1	 1	 173.14	 0.004	 2	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata CbDataList (30)	   96	 	 	 	 	 	 	 	 2	 1	 1	 1.39	 0.004	 0	 0	 1	 1.39	 0.000	 2	 1	 1	 712008	 0.628	 0.059	 7.158
ACLStrategised      	  120	 	 	 	 	 	 	 	 1	 1	 1	 173.14	 0.002	 1	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLDestinationIP    	  112	 	 	 	 	 	 	 	 1	 1	 1	 173.14	 0.002	 1	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata RemovalPolicy (6)	  104	 	 	 	 	 	 	 	 1	 1	 1	 173.14	 0.002	 1	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata ClientRequestContext (17)	  104	 	 	 	 	 	 	 	 1	 1	 1	 173.09	 0.002	 0	 0	 1	 173.09	 0.000	 1	 1	 1	 935036	 0.825	 0.084	 71.002
wordlist            	   16	 	 	 	 	 	 	 	 5	 1	 1	 173.14	 0.002	 5	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata RemovalPurgeWalker (7)	   72	 	 	 	 	 	 	 	 1	 1	 1	 173.14	 0.001	 0	 0	 1	 173.14	 0.000	 1	 1	 1	 8096	 0.007	 0.001	 0.982
CacheDigest         	   40	 	 	 	 	 	 	 	 1	 1	 1	 173.14	 0.001	 1	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLRegexData        	   24	 	 	 	 	 	 	 	 1	 1	 1	 173.14	 0.000	 1	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
64K Buffer          	 65536	 	 	 	 	 	 	 	 0	 0	 320	 1.28	 0.000	 0	 0	 320	 1.28	 -1.000	 0	 0	 320	 199	 0.000	 0.011	 0.000
cbdata Forwarder (19)	  112	 	 	 	 	 	 	 	 0	 0	 1	 173.09	 0.000	 0	 0	 1	 173.09	 -1.000	 0	 0	 1	 1543	 0.001	 0.000	 0.000
cbdata GeneratorRequest (28)	   72	 	 	 	 	 	 	 	 0	 0	 1	 1.33	 0.000	 0	 0	 1	 1.33	 -1.000	 0	 0	 1	 7609	 0.007	 0.000	 0.013
Helper::Xaction     	  184	 	 	 	 	 	 	 	 0	 0	 1	 1.33	 0.000	 0	 0	 1	 1.33	 -1.000	 0	 0	 1	 7609	 0.007	 0.001	 0.013
cbdata Downloader (31)	  144	 	 	 	 	 	 	 	 0	 0	 1	 1.26	 0.000	 0	 0	 1	 1.26	 -1.000	 0	 0	 1	 1268	 0.001	 0.000	 0.000
DownloaderContext   	 4144	 	 	 	 	 	 	 	 0	 0	 21	 1.26	 0.000	 0	 0	 21	 1.26	 -1.000	 0	 0	 21	 1268	 0.001	 0.005	 0.000
HttpHdrRange        	   32	 	 	 	 	 	 	 	 0	 0	 1	 1.17	 0.000	 0	 0	 1	 1.17	 -1.000	 0	 0	 1	 153	 0.000	 0.000	 0.000
HttpHdrRangeSpec    	   16	 	 	 	 	 	 	 	 0	 0	 1	 1.17	 0.000	 0	 0	 1	 1.17	 -1.000	 0	 0	 1	 153	 0.000	 0.000	 0.000
HttpHdrContRange    	   24	 	 	 	 	 	 	 	 0	 0	 1	 0.43	 0.000	 0	 0	 1	 0.43	 -1.000	 0	 0	 1	 237	 0.000	 0.000	 0.000
cbdata nsvc (32)    	   72	 	 	 	 	 	 	 	 0	 0	 1	 1.49	 0.000	 0	 0	 1	 1.49	 -1.000	 0	 0	 1	 7	 0.000	 0.000	 0.000
HttpHdrSc           	   16	 	 	 	 	 	 	 	 0	 0	 1	 0.21	 0.000	 0	 0	 1	 0.21	 -1.000	 0	 0	 1	 340	 0.000	 0.000	 0.000
HttpHdrScTarget     	   88	 	 	 	 	 	 	 	 0	 0	 1	 0.44	 0.000	 0	 0	 1	 0.44	 -1.000	 0	 0	 1	 365	 0.000	 0.000	 0.000
Total               	    1	 	 	 	 	 	 	 	 6964	 4997	 29276	 0.42	 100.000	 5417	 3398	 27581	 0.42	 67.984	 1547	 1600	 9544	 112869749	 99.594	 99.769	 381229.754
Cumulative allocated volume: 115.116 GB
Current overhead: 25651 bytes (0.737%)
Idle pool limit: 5.00 MB
Total Pools created: 82
Pools ever used:     78 (shown above)
Currently in use:    48
String Pool	 Impact		
 	 (%strings)	 (%volume)
Short Strings       	 0	 0
Medium Strings      	 8	 1
Long Strings        	 2	 1
1KB Strings         	 0	 0
4KB Strings         	 6	 16
16KB Strings        	 2	 16
Other Strings       	 82	 67

Large buffers: 0 (0 KB)
} by kid1

by kid2 {
Current memory usage:
Pool	 Obj Size	Chunks							Allocated					In Use					Idle			Allocations Saved			Rate	
 	 (bytes)	KB/ch	 obj/ch	(#)	 used	 free	 part	 %Frag	 (#)	 (KB)	 high (KB)	 high (hrs)	 %Tot	(#)	 (KB)	 high (KB)	 high (hrs)	 %alloc	(#)	 (KB)	 high (KB)	(#)	 %cnt	 %vol	(#)/sec	
16KB Strings        	 16384	 	 	 	 	 	 	 	 70	 1120	 9616	 1.22	 37.728	 38	 608	 9616	 1.22	 54.286	 32	 512	 3824	 978208	 3.200	 48.927	 22.858
4KB Strings         	 4096	 	 	 	 	 	 	 	 129	 516	 1920	 1.22	 17.382	 94	 376	 1920	 1.22	 72.868	 35	 140	 1076	 456723	 1.494	 5.711	 37.871
cbdata IdleConnList (27)	 4168	 	 	 	 	 	 	 	 35	 143	 1637	 0.79	 4.799	 29	 119	 1637	 0.79	 82.857	 6	 25	 1287	 48893	 0.160	 0.622	 4.323
32K Buffer          	 32768	 	 	 	 	 	 	 	 4	 128	 320	 1.28	 4.312	 4	 128	 320	 1.28	 100.000	 0	 0	 192	 3729	 0.012	 0.373	 0.000
ipcache_entry       	  128	 	 	 	 	 	 	 	 924	 116	 126	 0.80	 3.891	 920	 115	 126	 0.80	 99.567	 4	 1	 11	 8103	 0.027	 0.003	 0.437
HttpRequest         	 1880	 	 	 	 	 	 	 	 54	 100	 790	 1.22	 3.340	 31	 57	 790	 1.22	 57.407	 23	 43	 320	 246695	 0.807	 1.416	 19.645
mem_node            	 4136	 	 	 	 	 	 	 	 23	 93	 324	 0.73	 3.129	 1	 5	 324	 0.73	 4.348	 22	 89	 324	 1307969	 4.278	 16.515	 44.161
cbdata clientReplyContext (15)	 4352	 	 	 	 	 	 	 	 20	 85	 141	 1.27	 2.863	 1	 5	 141	 1.27	 5.000	 19	 81	 141	 247770	 0.810	 3.292	 19.645
Stream              	 4216	 	 	 	 	 	 	 	 20	 83	 136	 1.27	 2.774	 1	 5	 136	 1.27	 5.000	 19	 79	 136	 247329	 0.809	 3.183	 19.645
cbdata Server (11)  	  776	 	 	 	 	 	 	 	 85	 65	 379	 1.22	 2.170	 64	 49	 379	 1.22	 75.294	 21	 16	 150	 81461	 0.266	 0.193	 7.956
HttpHeaderEntry     	   56	 	 	 	 	 	 	 	 952	 53	 546	 1.22	 1.754	 702	 39	 546	 1.22	 73.739	 250	 14	 139	 9849180	 32.215	 1.684	 687.401
cbdata idns_query (13)	 8696	 	 	 	 	 	 	 	 6	 51	 85	 1.24	 1.716	 0	 0	 85	 1.24	 0.000	 6	 51	 85	 9384	 0.031	 0.249	 0.437
8K Buffer           	 8192	 	 	 	 	 	 	 	 6	 48	 80	 1.24	 1.617	 0	 0	 80	 1.24	 0.000	 6	 48	 64	 78080	 0.255	 1.953	 2.028
Long Strings        	  512	 	 	 	 	 	 	 	 95	 48	 232	 1.22	 1.600	 43	 22	 232	 1.22	 45.263	 52	 26	 102	 532721	 1.742	 0.833	 59.127
Comm::Connection    	  208	 	 	 	 	 	 	 	 229	 47	 204	 0.79	 1.567	 126	 26	 204	 0.79	 55.022	 103	 21	 73	 570551	 1.866	 0.362	 87.115
MemBlob             	   48	 	 	 	 	 	 	 	 841	 40	 200	 1.22	 1.328	 689	 33	 200	 1.22	 81.926	 152	 8	 50	 5846460	 19.123	 0.857	 365.394
Medium Strings      	  128	 	 	 	 	 	 	 	 295	 37	 240	 1.22	 1.242	 173	 22	 240	 1.22	 58.644	 122	 16	 62	 2733814	 8.942	 1.068	 214.042
MimeEntry           	  144	 	 	 	 	 	 	 	 177	 25	 25	 1.32	 0.838	 177	 25	 25	 1.32	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata ACLFilledChecklist (18)	  496	 	 	 	 	 	 	 	 47	 23	 205	 1.21	 0.767	 30	 15	 205	 1.21	 63.830	 17	 9	 82	 434953	 1.423	 0.659	 43.246
HttpReply           	  288	 	 	 	 	 	 	 	 57	 17	 122	 1.22	 0.540	 32	 9	 122	 1.22	 56.140	 25	 8	 50	 656115	 2.146	 0.577	 46.509
2K Buffer           	 2048	 	 	 	 	 	 	 	 8	 16	 76	 1.22	 0.539	 2	 4	 76	 1.22	 25.000	 6	 12	 54	 1226353	 4.011	 7.667	 90.375
16K Buffer          	 16384	 	 	 	 	 	 	 	 1	 16	 144	 0.83	 0.539	 1	 16	 144	 0.83	 100.000	 0	 0	 128	 15987	 0.052	 0.800	 0.000
1KB Strings         	 1024	 	 	 	 	 	 	 	 14	 14	 57	 1.26	 0.472	 4	 4	 57	 1.26	 28.571	 10	 10	 39	 119001	 0.389	 0.372	 5.497
4K Buffer           	 4096	 	 	 	 	 	 	 	 3	 12	 48	 1.27	 0.404	 1	 4	 48	 1.27	 33.333	 2	 8	 44	 42346	 0.139	 0.530	 2.917
cbdata FwdState (21)	  176	 	 	 	 	 	 	 	 66	 12	 12	 0.06	 0.382	 48	 9	 12	 0.06	 72.727	 18	 4	 6	 173923	 0.569	 0.093	 13.812
cbdata ClientHttpRequest (14)	  392	 	 	 	 	 	 	 	 20	 8	 13	 1.27	 0.258	 1	 1	 13	 1.27	 5.000	 19	 8	 13	 247770	 0.810	 0.297	 19.645
MemObject           	  352	 	 	 	 	 	 	 	 21	 8	 11	 1.27	 0.243	 2	 1	 11	 1.27	 9.524	 19	 7	 11	 242653	 0.794	 0.261	 16.460
cbdata HttpStateData (26)	  352	 	 	 	 	 	 	 	 15	 6	 9	 1.23	 0.174	 1	 1	 9	 1.23	 6.667	 14	 5	 9	 172766	 0.565	 0.186	 12.766
cbdata clientStreamNode (16)	  128	 	 	 	 	 	 	 	 40	 5	 9	 1.27	 0.168	 2	 1	 9	 1.27	 5.000	 38	 5	 9	 495540	 1.621	 0.194	 39.290
cbdata UdsSender (8)	 4528	 	 	 	 	 	 	 	 1	 5	 9	 1.32	 0.149	 0	 0	 9	 1.32	 0.000	 1	 5	 9	 44	 0.000	 0.001	 0.013
cbdata Strand (9)   	 4520	 	 	 	 	 	 	 	 1	 5	 5	 1.32	 0.149	 1	 5	 5	 1.32	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata MemBuf (4)   	   72	 	 	 	 	 	 	 	 61	 5	 31	 1.22	 0.144	 36	 3	 31	 1.22	 59.016	 25	 2	 13	 834067	 2.728	 0.183	 62.229
cbdata Filler (30)  	 4216	 	 	 	 	 	 	 	 1	 5	 5	 1.25	 0.139	 1	 5	 5	 1.25	 100.000	 0	 0	 5	 25	 0.000	 0.000	 0.007
HttpHdrCc           	   96	 	 	 	 	 	 	 	 39	 4	 33	 1.22	 0.123	 26	 3	 33	 1.22	 66.667	 13	 2	 13	 475501	 1.555	 0.139	 34.060
cbdata store_client (20)	  160	 	 	 	 	 	 	 	 20	 4	 5	 1.27	 0.105	 2	 1	 5	 1.27	 10.000	 18	 3	 5	 174037	 0.569	 0.085	 13.826
StoreEntry          	  120	 	 	 	 	 	 	 	 21	 3	 4	 1.27	 0.083	 2	 1	 4	 1.27	 9.524	 19	 3	 4	 242653	 0.794	 0.089	 16.460
cbdata Tree (1)     	  176	 	 	 	 	 	 	 	 12	 3	 3	 1.32	 0.069	 12	 3	 3	 1.32	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata ps_state (22)	  256	 	 	 	 	 	 	 	 7	 2	 3	 1.24	 0.059	 0	 0	 3	 1.24	 0.000	 7	 2	 3	 174077	 0.569	 0.136	 13.812
cbdata BlindPeerConnector (24)	  224	 	 	 	 	 	 	 	 8	 2	 3	 0.74	 0.059	 0	 0	 3	 0.74	 0.000	 8	 2	 3	 25024	 0.082	 0.017	 9.120
AndNode             	  120	 	 	 	 	 	 	 	 13	 2	 2	 1.32	 0.051	 13	 2	 2	 1.32	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ClientInfo          	  448	 	 	 	 	 	 	 	 3	 2	 2	 1.17	 0.044	 3	 2	 2	 1.17	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata helper_server (3)	  328	 	 	 	 	 	 	 	 4	 2	 2	 1.31	 0.043	 4	 2	 2	 1.31	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata ConnOpener (23)	  136	 	 	 	 	 	 	 	 8	 2	 2	 0.74	 0.036	 0	 0	 2	 0.74	 0.000	 8	 2	 2	 29451	 0.096	 0.012	 9.604
cbdata ErrorState (25)	  240	 	 	 	 	 	 	 	 4	 1	 1	 1.16	 0.032	 0	 0	 1	 1.16	 0.000	 4	 1	 1	 6811	 0.022	 0.005	 8.141
fqdncache_entry     	  160	 	 	 	 	 	 	 	 5	 1	 1	 1.32	 0.026	 5	 1	 1	 1.32	 100.000	 0	 0	 1	 1	 0.000	 0.000	 0.000
ACLStrategised      	  120	 	 	 	 	 	 	 	 5	 1	 1	 1.32	 0.020	 5	 1	 1	 1.32	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
acl_ip_data         	   96	 	 	 	 	 	 	 	 6	 1	 1	 1.32	 0.019	 6	 1	 1	 1.32	 100.000	 0	 0	 1	 3	 0.000	 0.000	 0.000
ev_entry            	   48	 	 	 	 	 	 	 	 9	 1	 1	 0.75	 0.014	 7	 1	 1	 0.75	 77.778	 2	 1	 1	 13297	 0.043	 0.002	 2.513
cbdata Logfile (5)  	  352	 	 	 	 	 	 	 	 1	 1	 1	 1.32	 0.012	 1	 1	 1	 1.32	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
MD5 digest          	   16	 	 	 	 	 	 	 	 21	 1	 1	 1.27	 0.011	 2	 1	 1	 1.27	 9.524	 19	 1	 1	 615223	 2.012	 0.030	 37.686
cbdata helper (2)   	  296	 	 	 	 	 	 	 	 1	 1	 1	 1.32	 0.010	 1	 1	 1	 1.32	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLSslErrorData     	   56	 	 	 	 	 	 	 	 5	 1	 1	 1.32	 0.009	 5	 1	 1	 1.32	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
FwdServer           	   32	 	 	 	 	 	 	 	 7	 1	 1	 1.24	 0.007	 0	 0	 1	 1.24	 0.000	 7	 1	 1	 174077	 0.569	 0.017	 13.812
ACLSourceIP         	  104	 	 	 	 	 	 	 	 2	 1	 1	 1.32	 0.007	 2	 1	 1	 1.32	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata TcpAcceptor (10)	  104	 	 	 	 	 	 	 	 2	 1	 1	 1.32	 0.007	 2	 1	 1	 1.32	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata generic_cbdata (12)	   32	 	 	 	 	 	 	 	 6	 1	 1	 1.24	 0.006	 0	 0	 1	 1.24	 0.000	 6	 1	 1	 9384	 0.031	 0.001	 0.437
cbdata CbDataList (28)	   96	 	 	 	 	 	 	 	 2	 1	 1	 1.24	 0.006	 0	 0	 1	 1.24	 0.000	 2	 1	 1	 304055	 0.995	 0.089	 2.917
ACLStrategised      	  120	 	 	 	 	 	 	 	 1	 1	 1	 1.32	 0.004	 1	 1	 1	 1.32	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLDestinationIP    	  112	 	 	 	 	 	 	 	 1	 1	 1	 1.32	 0.004	 1	 1	 1	 1.32	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata Forwarder (32)	  112	 	 	 	 	 	 	 	 1	 1	 1	 1.17	 0.004	 0	 0	 1	 1.17	 0.000	 1	 1	 1	 12	 0.000	 0.000	 0.007
cbdata RemovalPolicy (6)	  104	 	 	 	 	 	 	 	 1	 1	 1	 1.32	 0.003	 1	 1	 1	 1.32	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata ClientRequestContext (17)	  104	 	 	 	 	 	 	 	 1	 1	 1	 1.32	 0.003	 0	 0	 1	 1.32	 0.000	 1	 1	 1	 247963	 0.811	 0.079	 19.645
wordlist            	   16	 	 	 	 	 	 	 	 5	 1	 1	 1.32	 0.003	 5	 1	 1	 1.32	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata RemovalPurgeWalker (7)	   72	 	 	 	 	 	 	 	 1	 1	 1	 1.32	 0.002	 0	 0	 1	 1.32	 0.000	 1	 1	 1	 4540	 0.015	 0.001	 0.861
CacheDigest         	   40	 	 	 	 	 	 	 	 1	 1	 1	 1.32	 0.001	 1	 1	 1	 1.32	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLRegexData        	   24	 	 	 	 	 	 	 	 1	 1	 1	 1.32	 0.001	 1	 1	 1	 1.32	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
64K Buffer          	 65536	 	 	 	 	 	 	 	 0	 0	 256	 1.28	 0.000	 0	 0	 256	 1.28	 -1.000	 0	 0	 256	 41	 0.000	 0.008	 0.000
cbdata GeneratorRequest (19)	   72	 	 	 	 	 	 	 	 0	 0	 1	 1.30	 0.000	 0	 0	 1	 1.30	 -1.000	 0	 0	 1	 3492	 0.011	 0.001	 0.013
Helper::Xaction     	  184	 	 	 	 	 	 	 	 0	 0	 1	 1.30	 0.000	 0	 0	 1	 1.30	 -1.000	 0	 0	 1	 3492	 0.011	 0.002	 0.013
BodyPipe            	  136	 	 	 	 	 	 	 	 0	 0	 6	 1.22	 0.000	 0	 0	 6	 1.22	 -1.000	 0	 0	 3	 5373	 0.018	 0.002	 0.010
cbdata Downloader (29)	  144	 	 	 	 	 	 	 	 0	 0	 1	 0.44	 0.000	 0	 0	 1	 0.44	 -1.000	 0	 0	 1	 424	 0.001	 0.000	 0.000
DownloaderContext   	 4144	 	 	 	 	 	 	 	 0	 0	 13	 0.44	 0.000	 0	 0	 13	 0.44	 -1.000	 0	 0	 13	 424	 0.001	 0.005	 0.000
HttpHdrRange        	   32	 	 	 	 	 	 	 	 0	 0	 1	 1.31	 0.000	 0	 0	 1	 1.31	 -1.000	 0	 0	 1	 45	 0.000	 0.000	 0.000
HttpHdrRangeSpec    	   16	 	 	 	 	 	 	 	 0	 0	 1	 1.31	 0.000	 0	 0	 1	 1.31	 -1.000	 0	 0	 1	 45	 0.000	 0.000	 0.000
HttpHdrContRange    	   24	 	 	 	 	 	 	 	 0	 0	 1	 1.21	 0.000	 0	 0	 1	 1.21	 -1.000	 0	 0	 1	 78	 0.000	 0.000	 0.000
cbdata nsvc (31)    	   72	 	 	 	 	 	 	 	 0	 0	 1	 1.23	 0.000	 0	 0	 1	 1.23	 -1.000	 0	 0	 1	 3	 0.000	 0.000	 0.000
HttpHdrSc           	   16	 	 	 	 	 	 	 	 0	 0	 1	 0.21	 0.000	 0	 0	 1	 0.21	 -1.000	 0	 0	 1	 50	 0.000	 0.000	 0.000
HttpHdrScTarget     	   88	 	 	 	 	 	 	 	 0	 0	 1	 0.21	 0.000	 0	 0	 1	 0.21	 -1.000	 0	 0	 1	 51	 0.000	 0.000	 0.000
Total               	    1	 	 	 	 	 	 	 	 4545	 2969	 17268	 1.21	 100.000	 3363	 1713	 15529	 1.22	 57.700	 1182	 1256	 7917	 30418240	 99.493	 99.780	 102845.432
Cumulative allocated volume: 32.757 GB
Current overhead: 25651 bytes (1.462%)
Idle pool limit: 5.00 MB
Total Pools created: 82
Pools ever used:     78 (shown above)
Currently in use:    53
String Pool	 Impact		
 	 (%strings)	 (%volume)
Short Strings       	 0	 0
Medium Strings      	 7	 1
Long Strings        	 2	 1
1KB Strings         	 0	 0
4KB Strings         	 4	 11
16KB Strings        	 2	 17
Other Strings       	 86	 71

Large buffers: 0 (0 KB)
} by kid2

by kid3 {
Current memory usage:
Pool	 Obj Size	Chunks							Allocated					In Use					Idle			Allocations Saved			Rate	
 	 (bytes)	KB/ch	 obj/ch	(#)	 used	 free	 part	 %Frag	 (#)	 (KB)	 high (KB)	 high (hrs)	 %Tot	(#)	 (KB)	 high (KB)	 high (hrs)	 %alloc	(#)	 (KB)	 high (KB)	(#)	 %cnt	 %vol	(#)/sec	
16KB Strings        	 16384	 	 	 	 	 	 	 	 145	 2320	 12208	 1.21	 42.759	 57	 912	 12208	 1.21	 39.310	 88	 1408	 5136	 2027976	 3.290	 49.602	 41.746
4KB Strings         	 4096	 	 	 	 	 	 	 	 202	 808	 2400	 1.23	 14.892	 141	 564	 2400	 1.23	 69.802	 61	 244	 1176	 885907	 1.437	 5.417	 68.240
cbdata IdleConnList (27)	 4168	 	 	 	 	 	 	 	 134	 546	 2369	 0.42	 10.052	 29	 119	 2369	 0.42	 21.642	 105	 428	 1177	 72281	 0.117	 0.450	 4.609
HttpRequest         	 1880	 	 	 	 	 	 	 	 112	 206	 1001	 1.21	 3.790	 43	 79	 1001	 1.21	 38.393	 69	 127	 384	 487445	 0.791	 1.368	 34.985
32K Buffer          	 32768	 	 	 	 	 	 	 	 6	 192	 480	 1.28	 3.539	 6	 192	 480	 1.28	 100.000	 0	 0	 288	 9720	 0.016	 0.475	 0.000
cbdata clientReplyContext (15)	 4352	 	 	 	 	 	 	 	 31	 132	 209	 1.26	 2.428	 1	 5	 209	 1.26	 3.226	 30	 128	 200	 488804	 0.793	 3.176	 34.985
Stream              	 4216	 	 	 	 	 	 	 	 31	 128	 178	 1.27	 2.352	 1	 5	 178	 1.27	 3.226	 30	 124	 173	 488031	 0.792	 3.072	 34.985
cbdata Server (13)  	  776	 	 	 	 	 	 	 	 164	 125	 471	 1.21	 2.291	 97	 74	 471	 1.21	 59.146	 67	 51	 188	 160112	 0.260	 0.185	 14.310
ipcache_entry       	  128	 	 	 	 	 	 	 	 928	 116	 130	 0.43	 2.138	 920	 115	 130	 0.43	 99.138	 8	 1	 15	 12350	 0.020	 0.002	 0.468
mem_node            	 4136	 	 	 	 	 	 	 	 27	 110	 400	 0.97	 2.010	 1	 5	 400	 0.97	 3.704	 26	 106	 400	 2648325	 4.296	 16.352	 79.584
cbdata idns_query (21)	 8696	 	 	 	 	 	 	 	 11	 94	 102	 0.92	 1.722	 0	 0	 102	 0.92	 0.000	 11	 94	 102	 13754	 0.022	 0.179	 0.468
Comm::Connection    	  208	 	 	 	 	 	 	 	 396	 81	 259	 0.79	 1.483	 175	 36	 259	 0.79	 44.192	 221	 45	 104	 1022750	 1.659	 0.318	 151.602
HttpHeaderEntry     	   56	 	 	 	 	 	 	 	 1262	 70	 669	 1.21	 1.272	 997	 55	 669	 1.21	 79.002	 265	 15	 180	 19182644	 31.121	 1.604	 1216.449
Long Strings        	  512	 	 	 	 	 	 	 	 135	 68	 293	 1.21	 1.244	 66	 33	 293	 1.21	 48.889	 69	 35	 107	 995409	 1.615	 0.761	 103.464
8K Buffer           	 8192	 	 	 	 	 	 	 	 7	 56	 104	 1.26	 1.032	 2	 16	 104	 1.26	 28.571	 5	 40	 80	 190480	 0.309	 2.329	 4.101
cbdata ACLFilledChecklist (18)	  496	 	 	 	 	 	 	 	 105	 51	 258	 1.21	 0.937	 42	 21	 258	 1.21	 40.000	 63	 31	 95	 854876	 1.387	 0.633	 78.783
MemBlob             	   48	 	 	 	 	 	 	 	 1042	 49	 247	 1.21	 0.900	 877	 42	 247	 1.21	 84.165	 165	 8	 61	 11777417	 19.107	 0.844	 656.707
Medium Strings      	  128	 	 	 	 	 	 	 	 353	 45	 292	 1.21	 0.813	 241	 31	 292	 1.21	 68.272	 112	 14	 87	 5421111	 8.795	 1.036	 379.762
HttpReply           	  288	 	 	 	 	 	 	 	 113	 32	 155	 1.21	 0.586	 44	 13	 155	 1.21	 38.938	 69	 20	 60	 1285010	 2.085	 0.552	 82.503
MimeEntry           	  144	 	 	 	 	 	 	 	 177	 25	 25	 173.14	 0.459	 177	 25	 25	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
2K Buffer           	 2048	 	 	 	 	 	 	 	 11	 22	 84	 1.22	 0.405	 2	 4	 84	 1.22	 18.182	 9	 18	 50	 2524324	 4.095	 7.718	 156.197
cbdata FwdState (23)	  176	 	 	 	 	 	 	 	 110	 19	 19	 0.01	 0.348	 82	 15	 19	 0.01	 74.545	 28	 5	 8	 341792	 0.555	 0.090	 24.375
1KB Strings         	 1024	 	 	 	 	 	 	 	 17	 17	 92	 1.35	 0.313	 5	 5	 92	 1.35	 29.412	 12	 12	 57	 242878	 0.394	 0.371	 9.782
16K Buffer          	 16384	 	 	 	 	 	 	 	 1	 16	 128	 0.78	 0.295	 1	 16	 128	 0.78	 100.000	 0	 0	 112	 34146	 0.055	 0.835	 0.007
cbdata ClientHttpRequest (14)	  392	 	 	 	 	 	 	 	 31	 12	 19	 1.26	 0.219	 1	 1	 19	 1.26	 3.226	 30	 12	 18	 488804	 0.793	 0.286	 34.985
MemObject           	  352	 	 	 	 	 	 	 	 31	 11	 17	 1.26	 0.196	 2	 1	 17	 1.26	 6.452	 29	 10	 17	 476150	 0.772	 0.250	 29.182
HttpHdrCc           	   96	 	 	 	 	 	 	 	 98	 10	 40	 1.21	 0.169	 37	 4	 40	 1.21	 37.755	 61	 6	 17	 933120	 1.514	 0.134	 60.332
cbdata MemBuf (4)   	   72	 	 	 	 	 	 	 	 120	 9	 40	 1.21	 0.156	 50	 4	 40	 1.21	 41.667	 70	 5	 15	 1634951	 2.652	 0.176	 110.811
4K Buffer           	 4096	 	 	 	 	 	 	 	 2	 8	 44	 1.22	 0.147	 0	 0	 44	 1.22	 0.000	 2	 8	 32	 87275	 0.142	 0.534	 5.591
cbdata clientStreamNode (16)	  128	 	 	 	 	 	 	 	 62	 8	 13	 1.26	 0.143	 2	 1	 13	 1.26	 3.226	 60	 8	 12	 977608	 1.586	 0.187	 69.969
cbdata HttpStateData (26)	  352	 	 	 	 	 	 	 	 16	 6	 11	 1.27	 0.101	 1	 1	 11	 1.27	 6.250	 15	 6	 11	 339050	 0.550	 0.178	 22.266
cbdata store_client (12)	  160	 	 	 	 	 	 	 	 30	 5	 8	 1.26	 0.086	 2	 1	 8	 1.26	 6.667	 28	 5	 8	 346864	 0.563	 0.083	 24.382
cbdata UdsSender (8)	 4528	 	 	 	 	 	 	 	 1	 5	 9	 173.14	 0.081	 0	 0	 9	 173.14	 0.000	 1	 5	 9	 4249	 0.007	 0.029	 0.007
cbdata Strand (9)   	 4520	 	 	 	 	 	 	 	 1	 5	 5	 173.14	 0.081	 1	 5	 5	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata Filler (11)  	 4216	 	 	 	 	 	 	 	 1	 5	 5	 173.09	 0.076	 1	 5	 5	 173.09	 100.000	 0	 0	 5	 4142	 0.007	 0.026	 0.007
StoreEntry          	  120	 	 	 	 	 	 	 	 31	 4	 6	 1.26	 0.067	 2	 1	 6	 1.26	 6.452	 29	 4	 6	 476150	 0.772	 0.085	 29.182
cbdata BlindPeerConnector (29)	  224	 	 	 	 	 	 	 	 13	 3	 4	 1.54	 0.052	 0	 0	 4	 1.54	 0.000	 13	 3	 4	 48204	 0.078	 0.016	 17.835
cbdata ps_state (24)	  256	 	 	 	 	 	 	 	 11	 3	 4	 0.11	 0.051	 0	 0	 4	 0.11	 0.000	 11	 3	 4	 342127	 0.555	 0.131	 24.375
cbdata Tree (1)     	  176	 	 	 	 	 	 	 	 12	 3	 3	 173.14	 0.038	 12	 3	 3	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata helper_server (3)	  328	 	 	 	 	 	 	 	 6	 2	 2	 1.55	 0.035	 6	 2	 2	 1.55	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ClientInfo          	  448	 	 	 	 	 	 	 	 4	 2	 2	 61.23	 0.032	 4	 2	 2	 61.23	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata ConnOpener (25)	  136	 	 	 	 	 	 	 	 13	 2	 2	 0.01	 0.032	 0	 0	 2	 0.01	 0.000	 13	 2	 2	 55059	 0.089	 0.011	 18.451
AndNode             	  120	 	 	 	 	 	 	 	 13	 2	 2	 173.14	 0.028	 13	 2	 2	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata ErrorState (22)	  240	 	 	 	 	 	 	 	 5	 2	 2	 1.16	 0.022	 0	 0	 2	 1.16	 0.000	 5	 2	 2	 17557	 0.028	 0.006	 16.557
fqdncache_entry     	  160	 	 	 	 	 	 	 	 6	 1	 3	 0.55	 0.017	 6	 1	 3	 0.55	 100.000	 0	 0	 2	 5	 0.000	 0.000	 0.000
BodyPipe            	  136	 	 	 	 	 	 	 	 7	 1	 6	 1.22	 0.017	 1	 1	 6	 1.22	 14.286	 6	 1	 3	 9208	 0.015	 0.002	 0.000
ACLStrategised      	  120	 	 	 	 	 	 	 	 5	 1	 1	 173.14	 0.011	 5	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
acl_ip_data         	   96	 	 	 	 	 	 	 	 6	 1	 1	 173.14	 0.010	 6	 1	 1	 173.14	 100.000	 0	 0	 1	 3	 0.000	 0.000	 0.000
MD5 digest          	   16	 	 	 	 	 	 	 	 31	 1	 1	 1.26	 0.009	 2	 1	 1	 1.26	 6.452	 29	 1	 1	 1207198	 1.958	 0.029	 66.232
ev_entry            	   48	 	 	 	 	 	 	 	 10	 1	 1	 0.82	 0.009	 7	 1	 1	 0.82	 70.000	 3	 1	 1	 1428253	 2.317	 0.102	 2.516
cbdata Logfile (5)  	  352	 	 	 	 	 	 	 	 1	 1	 1	 173.14	 0.006	 1	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata generic_cbdata (20)	   32	 	 	 	 	 	 	 	 11	 1	 1	 0.92	 0.006	 0	 0	 1	 0.92	 0.000	 11	 1	 1	 13754	 0.022	 0.001	 0.468
FwdServer           	   32	 	 	 	 	 	 	 	 11	 1	 1	 0.11	 0.006	 0	 0	 1	 0.11	 0.000	 11	 1	 1	 342127	 0.555	 0.016	 24.375
cbdata helper (2)   	  296	 	 	 	 	 	 	 	 1	 1	 1	 173.14	 0.005	 1	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLSslErrorData     	   56	 	 	 	 	 	 	 	 5	 1	 1	 173.14	 0.005	 5	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLSourceIP         	  104	 	 	 	 	 	 	 	 2	 1	 1	 173.14	 0.004	 2	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata TcpAcceptor (10)	  104	 	 	 	 	 	 	 	 2	 1	 1	 173.14	 0.004	 2	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata CbDataList (30)	   96	 	 	 	 	 	 	 	 2	 1	 1	 1.54	 0.003	 0	 0	 1	 1.54	 0.000	 2	 1	 1	 451755	 0.733	 0.065	 3.354
ACLStrategised      	  120	 	 	 	 	 	 	 	 1	 1	 1	 173.14	 0.002	 1	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLDestinationIP    	  112	 	 	 	 	 	 	 	 1	 1	 1	 173.14	 0.002	 1	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata RemovalPolicy (6)	  104	 	 	 	 	 	 	 	 1	 1	 1	 173.14	 0.002	 1	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata ClientRequestContext (17)	  104	 	 	 	 	 	 	 	 1	 1	 1	 167.17	 0.002	 0	 0	 1	 167.17	 0.000	 1	 1	 1	 488601	 0.793	 0.076	 34.985
wordlist            	   16	 	 	 	 	 	 	 	 5	 1	 1	 173.14	 0.001	 5	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata RemovalPurgeWalker (7)	   72	 	 	 	 	 	 	 	 1	 1	 1	 173.14	 0.001	 0	 0	 1	 173.14	 0.000	 1	 1	 1	 7879	 0.013	 0.001	 0.935
CacheDigest         	   40	 	 	 	 	 	 	 	 1	 1	 1	 173.14	 0.001	 1	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLRegexData        	   24	 	 	 	 	 	 	 	 1	 1	 1	 173.14	 0.000	 1	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
64K Buffer          	 65536	 	 	 	 	 	 	 	 0	 0	 192	 1.28	 0.000	 0	 0	 192	 1.28	 -1.000	 0	 0	 192	 67	 0.000	 0.007	 0.000
cbdata Forwarder (19)	  112	 	 	 	 	 	 	 	 0	 0	 1	 167.17	 0.000	 0	 0	 1	 167.17	 -1.000	 0	 0	 1	 104	 0.000	 0.000	 0.000
cbdata GeneratorRequest (28)	   72	 	 	 	 	 	 	 	 0	 0	 1	 1.55	 0.000	 0	 0	 1	 1.55	 -1.000	 0	 0	 1	 4552	 0.007	 0.000	 0.000
Helper::Xaction     	  184	 	 	 	 	 	 	 	 0	 0	 1	 1.55	 0.000	 0	 0	 1	 1.55	 -1.000	 0	 0	 1	 4552	 0.007	 0.001	 0.000
cbdata Downloader (31)	  144	 	 	 	 	 	 	 	 0	 0	 2	 1.26	 0.000	 0	 0	 2	 1.26	 -1.000	 0	 0	 2	 734	 0.001	 0.000	 0.000
DownloaderContext   	 4144	 	 	 	 	 	 	 	 0	 0	 33	 1.26	 0.000	 0	 0	 33	 1.26	 -1.000	 0	 0	 33	 734	 0.001	 0.005	 0.000
HttpHdrRange        	   32	 	 	 	 	 	 	 	 0	 0	 1	 1.26	 0.000	 0	 0	 1	 1.26	 -1.000	 0	 0	 1	 122	 0.000	 0.000	 0.000
HttpHdrRangeSpec    	   16	 	 	 	 	 	 	 	 0	 0	 1	 1.26	 0.000	 0	 0	 1	 1.26	 -1.000	 0	 0	 1	 122	 0.000	 0.000	 0.000
HttpHdrContRange    	   24	 	 	 	 	 	 	 	 0	 0	 1	 0.42	 0.000	 0	 0	 1	 0.42	 -1.000	 0	 0	 1	 232	 0.000	 0.000	 0.000
cbdata nsvc (32)    	   72	 	 	 	 	 	 	 	 0	 0	 1	 1.35	 0.000	 0	 0	 1	 1.35	 -1.000	 0	 0	 1	 9	 0.000	 0.000	 0.000
HttpHdrSc           	   16	 	 	 	 	 	 	 	 0	 0	 1	 0.18	 0.000	 0	 0	 1	 0.18	 -1.000	 0	 0	 1	 170	 0.000	 0.000	 0.000
HttpHdrScTarget     	   88	 	 	 	 	 	 	 	 0	 0	 1	 0.18	 0.000	 0	 0	 1	 0.18	 -1.000	 0	 0	 1	 195	 0.000	 0.000	 0.000
Total               	    1	 	 	 	 	 	 	 	 6133	 5426	 21493	 1.21	 100.000	 4189	 2403	 19096	 1.21	 44.275	 1944	 3024	 8489	 61359228	 99.546	 99.806	 207348.831
Cumulative allocated volume: 66.985 GB
Current overhead: 25651 bytes (1.043%)
Idle pool limit: 5.00 MB
Total Pools created: 82
Pools ever used:     78 (shown above)
Currently in use:    54
String Pool	 Impact		
 	 (%strings)	 (%volume)
Short Strings       	 0	 0
Medium Strings      	 7	 1
Long Strings        	 2	 1
1KB Strings         	 0	 0
4KB Strings         	 4	 11
16KB Strings        	 2	 18
Other Strings       	 85	 70

Large buffers: 0 (0 KB)
} by kid3

by kid4 {
Current memory usage:
Pool	 Obj Size	Chunks							Allocated					In Use					Idle			Allocations Saved			Rate	
 	 (bytes)	KB/ch	 obj/ch	(#)	 used	 free	 part	 %Frag	 (#)	 (KB)	 high (KB)	 high (hrs)	 %Tot	(#)	 (KB)	 high (KB)	 high (hrs)	 %alloc	(#)	 (KB)	 high (KB)	(#)	 %cnt	 %vol	(#)/sec	
16KB Strings        	 16384	 	 	 	 	 	 	 	 80	 1280	 10320	 1.21	 36.542	 54	 864	 10320	 1.21	 67.500	 26	 416	 4976	 1492093	 3.296	 49.741	 35.880
4KB Strings         	 4096	 	 	 	 	 	 	 	 147	 588	 2344	 1.22	 16.787	 100	 400	 2344	 1.22	 68.027	 47	 188	 1092	 635081	 1.403	 5.293	 47.892
32K Buffer          	 32768	 	 	 	 	 	 	 	 6	 192	 448	 1.21	 5.481	 6	 192	 448	 1.21	 100.000	 0	 0	 256	 7764	 0.017	 0.518	 0.000
cbdata IdleConnList (29)	 4168	 	 	 	 	 	 	 	 42	 171	 1686	 0.79	 4.880	 30	 123	 1686	 0.79	 71.429	 12	 49	 994	 53689	 0.119	 0.455	 3.451
ipcache_entry       	  128	 	 	 	 	 	 	 	 929	 117	 125	 0.43	 3.315	 920	 115	 125	 0.43	 99.031	 9	 2	 10	 9708	 0.021	 0.003	 0.488
HttpRequest         	 1880	 	 	 	 	 	 	 	 63	 116	 896	 1.21	 3.302	 40	 74	 896	 1.21	 63.492	 23	 43	 410	 352058	 0.778	 1.347	 25.552
cbdata idns_query (21)	 8696	 	 	 	 	 	 	 	 13	 111	 128	 1.54	 3.152	 0	 0	 128	 1.54	 0.000	 13	 111	 128	 10919	 0.024	 0.193	 0.488
cbdata clientReplyContext (15)	 4352	 	 	 	 	 	 	 	 25	 107	 192	 1.27	 3.033	 1	 5	 192	 1.27	 4.000	 24	 102	 187	 353374	 0.781	 3.129	 25.552
mem_node            	 4136	 	 	 	 	 	 	 	 26	 106	 328	 0.99	 2.998	 1	 5	 328	 0.99	 3.846	 25	 101	 328	 1977084	 4.368	 16.638	 68.456
Stream              	 4216	 	 	 	 	 	 	 	 25	 103	 182	 1.27	 2.939	 1	 5	 182	 1.27	 4.000	 24	 99	 178	 352743	 0.779	 3.026	 25.552
cbdata Server (13)  	  776	 	 	 	 	 	 	 	 100	 76	 429	 1.21	 2.163	 72	 55	 429	 1.21	 72.000	 28	 22	 179	 112985	 0.250	 0.178	 10.189
HttpHeaderEntry     	   56	 	 	 	 	 	 	 	 1268	 70	 592	 1.21	 1.980	 915	 51	 592	 1.21	 72.161	 353	 20	 153	 13918821	 30.750	 1.586	 908.228
Comm::Connection    	  208	 	 	 	 	 	 	 	 289	 59	 229	 1.21	 1.676	 156	 32	 229	 1.21	 53.979	 133	 28	 93	 765367	 1.691	 0.324	 118.353
Long Strings        	  512	 	 	 	 	 	 	 	 105	 53	 244	 1.21	 1.499	 62	 31	 244	 1.21	 59.048	 43	 22	 97	 701902	 1.551	 0.731	 75.328
8K Buffer           	 8192	 	 	 	 	 	 	 	 6	 48	 64	 1.27	 1.370	 0	 0	 64	 1.27	 0.000	 6	 48	 56	 140285	 0.310	 2.338	 2.846
MemBlob             	   48	 	 	 	 	 	 	 	 947	 45	 221	 1.21	 1.267	 777	 37	 221	 1.21	 82.049	 170	 8	 56	 8565674	 18.924	 0.837	 486.669
Medium Strings      	  128	 	 	 	 	 	 	 	 328	 41	 264	 1.27	 1.170	 221	 28	 264	 1.27	 67.378	 107	 14	 77	 3911273	 8.641	 1.019	 287.615
cbdata ACLFilledChecklist (18)	  496	 	 	 	 	 	 	 	 57	 28	 225	 1.21	 0.788	 39	 19	 225	 1.21	 68.421	 18	 9	 107	 615867	 1.361	 0.622	 56.776
MimeEntry           	  144	 	 	 	 	 	 	 	 177	 25	 25	 173.14	 0.711	 177	 25	 25	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
HttpReply           	  288	 	 	 	 	 	 	 	 65	 19	 140	 1.21	 0.522	 41	 12	 140	 1.21	 63.077	 24	 7	 64	 937988	 2.072	 0.550	 61.452
2K Buffer           	 2048	 	 	 	 	 	 	 	 9	 18	 72	 1.21	 0.514	 2	 4	 72	 1.21	 22.222	 7	 14	 50	 1803754	 3.985	 7.516	 114.777
1KB Strings         	 1024	 	 	 	 	 	 	 	 17	 17	 66	 1.22	 0.485	 5	 5	 66	 1.22	 29.412	 12	 12	 40	 174166	 0.385	 0.363	 7.276
16K Buffer          	 16384	 	 	 	 	 	 	 	 1	 16	 144	 0.78	 0.457	 1	 16	 144	 0.78	 100.000	 0	 0	 112	 26341	 0.058	 0.878	 0.000
cbdata FwdState (23)	  176	 	 	 	 	 	 	 	 80	 14	 15	 0.11	 0.393	 58	 10	 15	 0.11	 72.500	 22	 4	 8	 246882	 0.545	 0.088	 18.017
cbdata ClientHttpRequest (14)	  392	 	 	 	 	 	 	 	 25	 10	 18	 1.27	 0.273	 1	 1	 18	 1.27	 4.000	 24	 10	 17	 353374	 0.781	 0.282	 25.552
MemObject           	  352	 	 	 	 	 	 	 	 24	 9	 16	 1.27	 0.236	 2	 1	 16	 1.27	 8.333	 22	 8	 16	 349741	 0.773	 0.250	 21.802
4K Buffer           	 4096	 	 	 	 	 	 	 	 2	 8	 40	 1.48	 0.228	 1	 4	 40	 1.48	 50.000	 1	 4	 32	 55807	 0.123	 0.465	 3.347
cbdata clientStreamNode (16)	  128	 	 	 	 	 	 	 	 50	 7	 12	 1.27	 0.178	 2	 1	 12	 1.27	 4.000	 48	 6	 11	 706748	 1.561	 0.184	 51.105
cbdata HttpStateData (28)	  352	 	 	 	 	 	 	 	 16	 6	 11	 1.27	 0.157	 0	 0	 11	 1.27	 0.000	 16	 6	 11	 244739	 0.541	 0.175	 16.550
HttpHdrCc           	   96	 	 	 	 	 	 	 	 54	 6	 35	 1.21	 0.145	 35	 4	 35	 1.21	 64.815	 19	 2	 18	 675969	 1.493	 0.132	 44.582
cbdata MemBuf (4)   	   72	 	 	 	 	 	 	 	 71	 5	 36	 1.21	 0.143	 47	 4	 36	 1.21	 66.197	 24	 2	 16	 1190379	 2.630	 0.174	 82.231
cbdata UdsSender (8)	 4528	 	 	 	 	 	 	 	 1	 5	 9	 173.14	 0.126	 0	 0	 9	 173.14	 0.000	 1	 5	 9	 4179	 0.009	 0.039	 0.007
cbdata Strand (9)   	 4520	 	 	 	 	 	 	 	 1	 5	 5	 173.14	 0.126	 1	 5	 5	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata Filler (11)  	 4216	 	 	 	 	 	 	 	 1	 5	 5	 173.09	 0.118	 1	 5	 5	 173.09	 100.000	 0	 0	 5	 4145	 0.009	 0.036	 0.007
cbdata store_client (12)	  160	 	 	 	 	 	 	 	 24	 4	 8	 1.27	 0.107	 2	 1	 8	 1.27	 8.333	 22	 4	 7	 251379	 0.555	 0.082	 18.024
cbdata ps_state (24)	  256	 	 	 	 	 	 	 	 13	 4	 4	 1.54	 0.093	 0	 0	 4	 1.54	 0.000	 13	 4	 4	 247157	 0.546	 0.129	 18.017
cbdata BlindPeerConnector (27)	  224	 	 	 	 	 	 	 	 13	 3	 6	 1.55	 0.081	 0	 0	 6	 1.55	 0.000	 13	 3	 6	 35795	 0.079	 0.016	 12.652
StoreEntry          	  120	 	 	 	 	 	 	 	 24	 3	 6	 1.27	 0.080	 2	 1	 6	 1.27	 8.333	 22	 3	 6	 349741	 0.773	 0.085	 21.802
cbdata Tree (1)     	  176	 	 	 	 	 	 	 	 12	 3	 3	 173.14	 0.059	 12	 3	 3	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata ConnOpener (26)	  136	 	 	 	 	 	 	 	 15	 2	 2	 1.54	 0.057	 1	 1	 2	 1.54	 6.667	 14	 2	 2	 40463	 0.089	 0.011	 13.197
cbdata helper_server (3)	  328	 	 	 	 	 	 	 	 6	 2	 2	 1.30	 0.055	 6	 2	 2	 1.30	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata ErrorState (22)	  240	 	 	 	 	 	 	 	 8	 2	 2	 0.01	 0.054	 0	 0	 2	 0.01	 0.000	 8	 2	 2	 13091	 0.029	 0.006	 11.555
ClientInfo          	  448	 	 	 	 	 	 	 	 4	 2	 2	 61.22	 0.050	 4	 2	 2	 61.22	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
AndNode             	  120	 	 	 	 	 	 	 	 13	 2	 2	 173.14	 0.043	 13	 2	 2	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
fqdncache_entry     	  160	 	 	 	 	 	 	 	 6	 1	 2	 0.55	 0.027	 6	 1	 2	 0.55	 100.000	 0	 0	 1	 4	 0.000	 0.000	 0.000
ACLStrategised      	  120	 	 	 	 	 	 	 	 5	 1	 1	 173.14	 0.017	 5	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
acl_ip_data         	   96	 	 	 	 	 	 	 	 6	 1	 1	 173.14	 0.016	 6	 1	 1	 173.14	 100.000	 0	 0	 1	 3	 0.000	 0.000	 0.000
ev_entry            	   48	 	 	 	 	 	 	 	 9	 1	 1	 1.28	 0.012	 7	 1	 1	 1.28	 77.778	 2	 1	 1	 1428293	 3.155	 0.139	 2.493
cbdata generic_cbdata (20)	   32	 	 	 	 	 	 	 	 13	 1	 1	 1.54	 0.012	 0	 0	 1	 1.54	 0.000	 13	 1	 1	 10919	 0.024	 0.001	 0.488
FwdServer           	   32	 	 	 	 	 	 	 	 13	 1	 1	 1.54	 0.012	 0	 0	 1	 1.54	 0.000	 13	 1	 1	 247157	 0.546	 0.016	 18.017
MD5 digest          	   16	 	 	 	 	 	 	 	 24	 1	 1	 1.27	 0.011	 2	 1	 1	 1.27	 8.333	 22	 1	 1	 899755	 1.988	 0.029	 52.084
cbdata Logfile (5)  	  352	 	 	 	 	 	 	 	 1	 1	 1	 173.14	 0.010	 1	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata helper (2)   	  296	 	 	 	 	 	 	 	 1	 1	 1	 173.14	 0.008	 1	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLSslErrorData     	   56	 	 	 	 	 	 	 	 5	 1	 1	 173.14	 0.008	 5	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLSourceIP         	  104	 	 	 	 	 	 	 	 2	 1	 1	 173.14	 0.006	 2	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata TcpAcceptor (10)	  104	 	 	 	 	 	 	 	 2	 1	 1	 173.14	 0.006	 2	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata CbDataList (30)	   96	 	 	 	 	 	 	 	 2	 1	 1	 1.13	 0.005	 0	 0	 1	 1.13	 0.000	 2	 1	 1	 383356	 0.847	 0.075	 4.154
ACLStrategised      	  120	 	 	 	 	 	 	 	 1	 1	 1	 173.14	 0.003	 1	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLDestinationIP    	  112	 	 	 	 	 	 	 	 1	 1	 1	 173.14	 0.003	 1	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata RemovalPolicy (6)	  104	 	 	 	 	 	 	 	 1	 1	 1	 173.14	 0.003	 1	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata ClientRequestContext (17)	  104	 	 	 	 	 	 	 	 1	 1	 1	 165.84	 0.003	 0	 0	 1	 165.84	 0.000	 1	 1	 1	 353530	 0.781	 0.075	 25.552
wordlist            	   16	 	 	 	 	 	 	 	 5	 1	 1	 173.14	 0.002	 5	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata RemovalPurgeWalker (7)	   72	 	 	 	 	 	 	 	 1	 1	 1	 173.14	 0.002	 0	 0	 1	 173.14	 0.000	 1	 1	 1	 7481	 0.017	 0.001	 0.861
CacheDigest         	   40	 	 	 	 	 	 	 	 1	 1	 1	 173.14	 0.001	 1	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLRegexData        	   24	 	 	 	 	 	 	 	 1	 1	 1	 173.14	 0.001	 1	 1	 1	 173.14	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
64K Buffer          	 65536	 	 	 	 	 	 	 	 0	 0	 384	 1.27	 0.000	 0	 0	 384	 1.27	 -1.000	 0	 0	 384	 51	 0.000	 0.007	 0.000
cbdata Forwarder (19)	  112	 	 	 	 	 	 	 	 0	 0	 1	 165.84	 0.000	 0	 0	 1	 165.84	 -1.000	 0	 0	 1	 32	 0.000	 0.000	 0.000
cbdata GeneratorRequest (25)	   72	 	 	 	 	 	 	 	 0	 0	 1	 1.30	 0.000	 0	 0	 1	 1.30	 -1.000	 0	 0	 1	 3537	 0.008	 0.001	 0.003
Helper::Xaction     	  184	 	 	 	 	 	 	 	 0	 0	 1	 1.30	 0.000	 0	 0	 1	 1.30	 -1.000	 0	 0	 1	 3537	 0.008	 0.001	 0.003
BodyPipe            	  136	 	 	 	 	 	 	 	 0	 0	 5	 1.22	 0.000	 0	 0	 5	 1.22	 -1.000	 0	 0	 3	 5992	 0.013	 0.002	 0.000
cbdata Downloader (31)	  144	 	 	 	 	 	 	 	 0	 0	 1	 1.15	 0.000	 0	 0	 1	 1.15	 -1.000	 0	 0	 1	 594	 0.001	 0.000	 0.000
DownloaderContext   	 4144	 	 	 	 	 	 	 	 0	 0	 25	 1.15	 0.000	 0	 0	 25	 1.15	 -1.000	 0	 0	 25	 594	 0.001	 0.005	 0.000
HttpHdrRange        	   32	 	 	 	 	 	 	 	 0	 0	 1	 1.49	 0.000	 0	 0	 1	 1.49	 -1.000	 0	 0	 1	 54	 0.000	 0.000	 0.000
HttpHdrRangeSpec    	   16	 	 	 	 	 	 	 	 0	 0	 1	 1.49	 0.000	 0	 0	 1	 1.49	 -1.000	 0	 0	 1	 54	 0.000	 0.000	 0.000
HttpHdrContRange    	   24	 	 	 	 	 	 	 	 0	 0	 1	 1.49	 0.000	 0	 0	 1	 1.49	 -1.000	 0	 0	 1	 100	 0.000	 0.000	 0.000
cbdata nsvc (32)    	   72	 	 	 	 	 	 	 	 0	 0	 1	 1.43	 0.000	 0	 0	 1	 1.43	 -1.000	 0	 0	 1	 3	 0.000	 0.000	 0.000
HttpHdrSc           	   16	 	 	 	 	 	 	 	 0	 0	 1	 0.18	 0.000	 0	 0	 1	 0.18	 -1.000	 0	 0	 1	 61	 0.000	 0.000	 0.000
HttpHdrScTarget     	   88	 	 	 	 	 	 	 	 0	 0	 1	 0.44	 0.000	 0	 0	 1	 0.44	 -1.000	 0	 0	 1	 76	 0.000	 0.000	 0.000
Total               	    1	 	 	 	 	 	 	 	 5283	 3503	 18981	 1.21	 100.000	 3856	 2134	 16605	 1.21	 60.899	 1427	 1370	 8079	 45033708	 99.492	 99.792	 152263.812
Cumulative allocated volume: 49.147 GB
Current overhead: 25651 bytes (1.174%)
Idle pool limit: 5.00 MB
Total Pools created: 82
Pools ever used:     78 (shown above)
Currently in use:    53
String Pool	 Impact		
 	 (%strings)	 (%volume)
Short Strings       	 0	 0
Medium Strings      	 7	 1
Long Strings        	 2	 1
1KB Strings         	 0	 0
4KB Strings         	 3	 8
16KB Strings        	 2	 18
Other Strings       	 86	 73

Large buffers: 0 (0 KB)
} by kid4

-------------- next part --------------
HTTP/1.1 200 OK
Server: squid/4.0.21
Mime-Version: 1.0
Date: Tue, 24 Oct 2017 17:10:19 GMT
Content-Type: text/plain
Expires: Tue, 24 Oct 2017 17:10:19 GMT
Last-Modified: Tue, 24 Oct 2017 17:10:19 GMT
Connection: close

Squid Object Cache: Version 4.0.21
Build Info: 
Service Name: squid
Start Time:	Mon, 16 Oct 2017 18:33:27 GMT
Current Time:	Tue, 24 Oct 2017 17:10:19 GMT
Connection information for squid:
	Number of clients accessing cache:	16
	Number of HTTP requests received:	5042117
	Number of ICP messages received:	0
	Number of ICP messages sent:	0
	Number of queued ICP replies:	0
	Number of HTCP messages received:	0
	Number of HTCP messages sent:	0
	Request failure ratio:	 0.00
	Average HTTP requests per minute since start:	961.2
	Average ICP messages per minute since start:	0.0
	Select loop called: 80667517 times, 27.093 ms avg
Cache information for squid:
	Hits as % of all requests:	5min: 0.0%, 60min: 0.0%
	Hits as % of bytes sent:	5min: 0.0%, 60min: 0.0%
	Memory hits as % of hit requests:	5min: 0.0%, 60min: 0.0%
	Disk hits as % of hit requests:	5min: 0.0%, 60min: 0.0%
	Storage Swap size:	0 KB
	Storage Swap capacity:	 0.0% used,  0.0% free
	Storage Mem size:	0 KB
	Storage Mem capacity:	 0.0% used,  0.0% free
	Mean Object Size:	0.00 KB
	Requests given to unlinkd:	0
Median Service Times (seconds)  5 min    60 min:
	HTTP Requests (All):   0.00000  0.00000
	Cache Misses:          0.00000  0.00000
	Cache Hits:            0.00000  0.00000
	Near Hits:             0.00000  0.00000
	Not-Modified Replies:  0.00000  0.00000
	DNS Lookups:           0.00000  0.00000
	ICP Queries:           0.00000  0.00000
Resource usage for squid:
	UP Time:	686211.950 seconds
	CPU Time:	8283.388 seconds
	CPU Usage:	2.94%
	CPU Usage, 5 minute avg:	0.03%
	CPU Usage, 60 minute avg:	0.02%
	Maximum Resident Size: 13643328 KB
	Page faults with physical i/o: 0
Memory accounted for:
	Total accounted:        12080 KB
	memPoolAlloc calls: 607640214
	memPoolFree calls:  610595420
File descriptor usage for squid:
	Maximum number of file descriptors:   65536
	Largest file desc currently in use:    371
	Number of file desc currently in use:   50
	Files queued for open:                   0
	Available number of file descriptors: 65486
	Reserved number of file descriptors:   400
	Store Disk files open:                   0
Internal Data Structures:
	     4 StoreEntries
	     4 StoreEntries with MemObjects
	     0 Hot Object Cache Items
	     0 on-disk objects
HTTP/1.1 200 OK
Server: squid/4.0.21
Mime-Version: 1.0
Date: Tue, 24 Oct 2017 17:10:28 GMT
Content-Type: text/plain
Expires: Tue, 24 Oct 2017 17:10:28 GMT
Last-Modified: Tue, 24 Oct 2017 17:10:28 GMT
Connection: close

by kid1 {
Current memory usage:
Pool	 Obj Size	Chunks							Allocated					In Use					Idle			Allocations Saved			Rate	
 	 (bytes)	KB/ch	 obj/ch	(#)	 used	 free	 part	 %Frag	 (#)	 (KB)	 high (KB)	 high (hrs)	 %Tot	(#)	 (KB)	 high (KB)	 high (hrs)	 %alloc	(#)	 (KB)	 high (KB)	(#)	 %cnt	 %vol	(#)/sec	
16KB Strings        	 16384	 	 	 	 	 	 	 	 110	 1760	 16752	 16.42	 65.404	 0	 0	 16752	 16.42	 0.000	 110	 1760	 6064	 7975433	 2.734	 45.734	 0.004
32K Buffer          	 32768	 	 	 	 	 	 	 	 4	 128	 480	 15.07	 4.757	 4	 128	 480	 15.07	 100.000	 0	 0	 352	 27897	 0.010	 0.320	 0.000
HttpRequest         	 1880	 	 	 	 	 	 	 	 65	 120	 1385	 16.42	 4.435	 0	 0	 1385	 16.42	 0.000	 65	 120	 482	 2445400	 0.838	 1.609	 0.004
ipcache_entry       	  128	 	 	 	 	 	 	 	 920	 115	 140	 15.47	 4.274	 920	 115	 140	 15.47	 100.000	 0	 0	 25	 58526	 0.020	 0.003	 0.000
4KB Strings         	 4096	 	 	 	 	 	 	 	 27	 108	 3524	 18.69	 4.013	 0	 0	 3524	 18.69	 0.000	 27	 108	 1548	 4520586	 1.550	 6.481	 0.004
cbdata IdleConnList (27)	 4168	 	 	 	 	 	 	 	 24	 98	 3623	 17.90	 3.630	 0	 0	 3623	 17.90	 0.000	 24	 98	 1368	 333049	 0.114	 0.486	 0.000
cbdata FwdState (23)	  176	 	 	 	 	 	 	 	 324	 56	 62	 14.09	 2.069	 324	 56	 62	 14.09	 100.000	 0	 0	 11	 1709974	 0.586	 0.105	 0.000
cbdata Server (13)  	  776	 	 	 	 	 	 	 	 61	 47	 670	 18.69	 1.718	 0	 0	 670	 18.69	 0.000	 61	 47	 219	 861351	 0.295	 0.234	 0.004
16K Buffer          	 16384	 	 	 	 	 	 	 	 2	 32	 192	 19.02	 1.189	 1	 16	 192	 19.02	 50.000	 1	 16	 192	 129269	 0.044	 0.741	 0.000
cbdata ACLFilledChecklist (18)	  496	 	 	 	 	 	 	 	 65	 32	 359	 16.42	 1.170	 0	 0	 359	 16.42	 0.000	 65	 32	 115	 4419018	 1.515	 0.767	 0.004
Comm::Connection    	  208	 	 	 	 	 	 	 	 137	 28	 435	 17.90	 1.034	 12	 3	 435	 17.90	 8.759	 125	 26	 126	 4616445	 1.582	 0.336	 0.058
MimeEntry           	  144	 	 	 	 	 	 	 	 177	 25	 25	 190.62	 0.925	 177	 25	 25	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
HttpReply           	  288	 	 	 	 	 	 	 	 65	 19	 213	 16.42	 0.679	 1	 1	 213	 16.42	 1.538	 64	 18	 76	 6281994	 2.153	 0.633	 0.022
2K Buffer           	 2048	 	 	 	 	 	 	 	 8	 16	 124	 18.69	 0.595	 2	 4	 124	 18.69	 25.000	 6	 12	 66	 12340493	 4.230	 8.846	 0.000
MemBlob             	   48	 	 	 	 	 	 	 	 308	 15	 335	 18.69	 0.537	 301	 15	 335	 18.69	 97.727	 7	 1	 82	 55782759	 19.122	 0.937	 0.040
Long Strings        	  512	 	 	 	 	 	 	 	 25	 13	 388	 16.42	 0.465	 0	 0	 388	 16.42	 0.000	 25	 13	 161	 5347163	 1.833	 0.958	 0.000
mem_node            	 4136	 	 	 	 	 	 	 	 3	 13	 513	 18.46	 0.450	 1	 5	 513	 18.46	 33.333	 2	 9	 513	 10851009	 3.720	 15.708	 0.013
1KB Strings         	 1024	 	 	 	 	 	 	 	 12	 12	 151	 18.83	 0.446	 0	 0	 151	 18.83	 0.000	 12	 12	 71	 1099940	 0.377	 0.394	 0.000
8K Buffer           	 8192	 	 	 	 	 	 	 	 1	 8	 104	 15.49	 0.297	 1	 8	 104	 15.49	 100.000	 0	 0	 88	 742406	 0.254	 2.129	 0.000
HttpHdrCc           	   96	 	 	 	 	 	 	 	 69	 7	 56	 16.42	 0.240	 0	 0	 56	 16.42	 0.000	 69	 7	 21	 4580823	 1.570	 0.154	 0.000
Medium Strings      	  128	 	 	 	 	 	 	 	 39	 5	 426	 16.19	 0.181	 39	 5	 426	 16.19	 100.000	 0	 0	 119	 26928483	 9.231	 1.206	 0.000
cbdata MemBuf (4)   	   72	 	 	 	 	 	 	 	 69	 5	 54	 16.42	 0.180	 5	 1	 54	 16.42	 7.246	 64	 5	 19	 8029857	 2.753	 0.202	 0.022
cbdata UdsSender (8)	 4528	 	 	 	 	 	 	 	 1	 5	 9	 190.62	 0.164	 0	 0	 9	 190.62	 0.000	 1	 5	 9	 6238	 0.002	 0.010	 0.022
cbdata Strand (9)   	 4520	 	 	 	 	 	 	 	 1	 5	 5	 190.62	 0.164	 1	 5	 5	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata clientReplyContext (15)	 4352	 	 	 	 	 	 	 	 1	 5	 277	 15.96	 0.158	 0	 0	 277	 15.96	 0.000	 1	 5	 277	 2454353	 0.841	 3.738	 0.004
cbdata Filler (11)  	 4216	 	 	 	 	 	 	 	 1	 5	 5	 190.57	 0.153	 1	 5	 5	 190.57	 100.000	 0	 0	 5	 4538	 0.002	 0.007	 0.018
Stream              	 4216	 	 	 	 	 	 	 	 1	 5	 268	 15.96	 0.153	 0	 0	 268	 15.96	 0.000	 1	 5	 268	 2450377	 0.840	 3.616	 0.004
ClientInfo          	  448	 	 	 	 	 	 	 	 5	 3	 3	 78.71	 0.081	 5	 3	 3	 78.71	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata Tree (1)     	  176	 	 	 	 	 	 	 	 12	 3	 3	 190.62	 0.077	 12	 3	 3	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
AndNode             	  120	 	 	 	 	 	 	 	 13	 2	 2	 190.62	 0.057	 13	 2	 2	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata helper_server (3)	  328	 	 	 	 	 	 	 	 4	 2	 2	 19.03	 0.048	 4	 2	 2	 19.03	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
fqdncache_entry     	  160	 	 	 	 	 	 	 	 6	 1	 3	 17.03	 0.035	 6	 1	 3	 17.03	 100.000	 0	 0	 2	 13	 0.000	 0.000	 0.000
BodyPipe            	  136	 	 	 	 	 	 	 	 7	 1	 9	 15.74	 0.035	 0	 0	 9	 15.74	 0.000	 7	 1	 4	 69191	 0.024	 0.003	 0.000
ACLStrategised      	  120	 	 	 	 	 	 	 	 5	 1	 1	 190.62	 0.022	 5	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
acl_ip_data         	   96	 	 	 	 	 	 	 	 6	 1	 1	 190.62	 0.021	 6	 1	 1	 190.62	 100.000	 0	 0	 1	 3	 0.000	 0.000	 0.000
cbdata ClientHttpRequest (14)	  392	 	 	 	 	 	 	 	 1	 1	 25	 15.96	 0.014	 0	 0	 25	 15.96	 0.000	 1	 1	 25	 2454353	 0.841	 0.337	 0.004
ev_entry            	   48	 	 	 	 	 	 	 	 8	 1	 1	 16.48	 0.014	 7	 1	 1	 16.48	 87.500	 1	 1	 1	 1583964	 0.543	 0.027	 2.288
cbdata Logfile (5)  	  352	 	 	 	 	 	 	 	 1	 1	 1	 190.62	 0.013	 1	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
MemObject           	  352	 	 	 	 	 	 	 	 1	 1	 23	 18.46	 0.013	 1	 1	 23	 18.46	 100.000	 0	 0	 23	 2298739	 0.788	 0.283	 0.022
cbdata helper (2)   	  296	 	 	 	 	 	 	 	 1	 1	 1	 190.62	 0.011	 1	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLSslErrorData     	   56	 	 	 	 	 	 	 	 5	 1	 1	 190.62	 0.010	 5	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata clientStreamNode (16)	  128	 	 	 	 	 	 	 	 2	 1	 17	 15.96	 0.009	 0	 0	 17	 15.96	 0.000	 2	 1	 17	 4908706	 1.683	 0.220	 0.009
HttpHeaderEntry     	   56	 	 	 	 	 	 	 	 4	 1	 947	 16.42	 0.008	 0	 0	 947	 16.42	 0.000	 4	 1	 271	 95076740	 32.592	 1.863	 0.022
ACLSourceIP         	  104	 	 	 	 	 	 	 	 2	 1	 1	 190.62	 0.008	 2	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata TcpAcceptor (10)	  104	 	 	 	 	 	 	 	 2	 1	 1	 190.62	 0.008	 2	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata store_client (12)	  160	 	 	 	 	 	 	 	 1	 1	 11	 15.96	 0.006	 1	 1	 11	 15.96	 100.000	 0	 0	 11	 1719876	 0.590	 0.096	 0.022
ACLStrategised      	  120	 	 	 	 	 	 	 	 1	 1	 1	 190.62	 0.004	 1	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
StoreEntry          	  120	 	 	 	 	 	 	 	 1	 1	 8	 18.46	 0.004	 1	 1	 8	 18.46	 100.000	 0	 0	 8	 2298739	 0.788	 0.097	 0.022
ACLDestinationIP    	  112	 	 	 	 	 	 	 	 1	 1	 1	 190.62	 0.004	 1	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata Forwarder (19)	  112	 	 	 	 	 	 	 	 1	 1	 1	 190.57	 0.004	 0	 0	 1	 190.57	 0.000	 1	 1	 1	 1666	 0.001	 0.000	 0.004
cbdata RemovalPolicy (6)	  104	 	 	 	 	 	 	 	 1	 1	 1	 190.62	 0.004	 1	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata ClientRequestContext (17)	  104	 	 	 	 	 	 	 	 1	 1	 1	 190.57	 0.004	 0	 0	 1	 190.57	 0.000	 1	 1	 1	 2454619	 0.841	 0.089	 0.004
wordlist            	   16	 	 	 	 	 	 	 	 5	 1	 1	 190.62	 0.003	 5	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata RemovalPurgeWalker (7)	   72	 	 	 	 	 	 	 	 1	 1	 1	 190.62	 0.003	 0	 0	 1	 190.62	 0.000	 1	 1	 1	 20094	 0.007	 0.001	 0.004
CacheDigest         	   40	 	 	 	 	 	 	 	 1	 1	 1	 190.62	 0.001	 1	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLRegexData        	   24	 	 	 	 	 	 	 	 1	 1	 1	 190.62	 0.001	 1	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
MD5 digest          	   16	 	 	 	 	 	 	 	 1	 1	 2	 18.46	 0.001	 1	 1	 2	 18.46	 100.000	 0	 0	 2	 5665023	 1.942	 0.032	 0.022
4K Buffer           	 4096	 	 	 	 	 	 	 	 0	 0	 72	 16.40	 0.000	 0	 0	 72	 16.40	 -1.000	 0	 0	 52	 473177	 0.162	 0.678	 0.000
64K Buffer          	 65536	 	 	 	 	 	 	 	 0	 0	 512	 15.12	 0.000	 0	 0	 512	 15.12	 -1.000	 0	 0	 512	 526	 0.000	 0.012	 0.000
cbdata generic_cbdata (20)	   32	 	 	 	 	 	 	 	 0	 0	 1	 15.83	 0.000	 0	 0	 1	 15.83	 -1.000	 0	 0	 1	 63181	 0.022	 0.001	 0.000
cbdata idns_query (21)	 8696	 	 	 	 	 	 	 	 0	 0	 230	 15.83	 0.000	 0	 0	 230	 15.83	 -1.000	 0	 0	 230	 63181	 0.022	 0.192	 0.000
cbdata ErrorState (22)	  240	 	 	 	 	 	 	 	 0	 0	 2	 17.36	 0.000	 0	 0	 2	 17.36	 -1.000	 0	 0	 2	 90396	 0.031	 0.008	 0.000
cbdata ps_state (24)	  256	 	 	 	 	 	 	 	 0	 0	 7	 15.83	 0.000	 0	 0	 7	 15.83	 -1.000	 0	 0	 7	 1712056	 0.587	 0.153	 0.000
FwdServer           	   32	 	 	 	 	 	 	 	 0	 0	 1	 15.83	 0.000	 0	 0	 1	 15.83	 -1.000	 0	 0	 1	 1712056	 0.587	 0.019	 0.000
cbdata ConnOpener (25)	  136	 	 	 	 	 	 	 	 0	 0	 4	 15.83	 0.000	 0	 0	 4	 15.83	 -1.000	 0	 0	 4	 316057	 0.108	 0.015	 0.000
cbdata HttpStateData (26)	  352	 	 	 	 	 	 	 	 0	 0	 21	 18.46	 0.000	 0	 0	 21	 18.46	 -1.000	 0	 0	 21	 1696404	 0.582	 0.209	 0.000
cbdata GeneratorRequest (28)	   72	 	 	 	 	 	 	 	 0	 0	 1	 18.81	 0.000	 0	 0	 1	 18.81	 -1.000	 0	 0	 1	 16755	 0.006	 0.000	 0.000
Helper::Xaction     	  184	 	 	 	 	 	 	 	 0	 0	 1	 18.81	 0.000	 0	 0	 1	 18.81	 -1.000	 0	 0	 1	 16755	 0.006	 0.001	 0.000
cbdata BlindPeerConnector (29)	  224	 	 	 	 	 	 	 	 0	 0	 8	 15.77	 0.000	 0	 0	 8	 15.77	 -1.000	 0	 0	 8	 269786	 0.092	 0.021	 0.000
cbdata CbDataList (30)	   96	 	 	 	 	 	 	 	 0	 0	 1	 18.87	 0.000	 0	 0	 1	 18.87	 -1.000	 0	 0	 1	 1470123	 0.504	 0.049	 0.000
cbdata Downloader (31)	  144	 	 	 	 	 	 	 	 0	 0	 2	 15.91	 0.000	 0	 0	 2	 15.91	 -1.000	 0	 0	 2	 3768	 0.001	 0.000	 0.000
DownloaderContext   	 4144	 	 	 	 	 	 	 	 0	 0	 53	 15.91	 0.000	 0	 0	 53	 15.91	 -1.000	 0	 0	 53	 3769	 0.001	 0.005	 0.000
HttpHdrRange        	   32	 	 	 	 	 	 	 	 0	 0	 1	 15.91	 0.000	 0	 0	 1	 15.91	 -1.000	 0	 0	 1	 882	 0.000	 0.000	 0.000
HttpHdrRangeSpec    	   16	 	 	 	 	 	 	 	 0	 0	 1	 15.91	 0.000	 0	 0	 1	 15.91	 -1.000	 0	 0	 1	 882	 0.000	 0.000	 0.000
HttpHdrContRange    	   24	 	 	 	 	 	 	 	 0	 0	 1	 15.91	 0.000	 0	 0	 1	 15.91	 -1.000	 0	 0	 1	 1536	 0.001	 0.000	 0.000
cbdata nsvc (32)    	   72	 	 	 	 	 	 	 	 0	 0	 1	 18.97	 0.000	 0	 0	 1	 18.97	 -1.000	 0	 0	 1	 23	 0.000	 0.000	 0.000
HttpHdrSc           	   16	 	 	 	 	 	 	 	 0	 0	 1	 17.69	 0.000	 0	 0	 1	 17.69	 -1.000	 0	 0	 1	 599	 0.000	 0.000	 0.000
HttpHdrScTarget     	   88	 	 	 	 	 	 	 	 0	 0	 1	 17.92	 0.000	 0	 0	 1	 17.92	 -1.000	 0	 0	 1	 646	 0.000	 0.000	 0.000
Total               	    1	 	 	 	 	 	 	 	 2621	 2691	 30122	 16.41	 100.000	 1873	 399	 28210	 16.42	 14.793	 748	 2293	 9544	 290461665	 99.569	 99.768	 1298769.344
Cumulative allocated volume: 285.715 GB
Current overhead: 25651 bytes (6.293%)
Idle pool limit: 5.00 MB
Total Pools created: 82
Pools ever used:     78 (shown above)
Currently in use:    38
String Pool	 Impact		
 	 (%strings)	 (%volume)
Short Strings       	 0	 0
Medium Strings      	 10	 38
Long Strings        	 0	 0
1KB Strings         	 0	 0
4KB Strings         	 0	 0
16KB Strings        	 0	 0
Other Strings       	 90	 62

Large buffers: 0 (0 KB)
} by kid1

by kid2 {
Current memory usage:
Pool	 Obj Size	Chunks							Allocated					In Use					Idle			Allocations Saved			Rate	
 	 (bytes)	KB/ch	 obj/ch	(#)	 used	 free	 part	 %Frag	 (#)	 (KB)	 high (KB)	 high (hrs)	 %Tot	(#)	 (KB)	 high (KB)	 high (hrs)	 %alloc	(#)	 (KB)	 high (KB)	(#)	 %cnt	 %vol	(#)/sec	
16KB Strings        	 16384	 	 	 	 	 	 	 	 155	 2480	 9616	 18.70	 55.079	 0	 0	 9616	 18.70	 0.000	 155	 2480	 4960	 2285414	 2.896	 47.118	 0.013
4KB Strings         	 4096	 	 	 	 	 	 	 	 124	 496	 1920	 18.70	 11.016	 0	 0	 1920	 18.70	 0.000	 124	 496	 1076	 1194387	 1.514	 6.156	 0.013
cbdata IdleConnList (27)	 4168	 	 	 	 	 	 	 	 55	 224	 1763	 16.20	 4.972	 0	 0	 1763	 16.20	 0.000	 55	 224	 1287	 149641	 0.190	 0.785	 0.000
32K Buffer          	 32768	 	 	 	 	 	 	 	 6	 192	 384	 15.13	 4.264	 6	 192	 384	 15.13	 100.000	 0	 0	 192	 7462	 0.009	 0.308	 0.000
HttpRequest         	 1880	 	 	 	 	 	 	 	 93	 171	 790	 18.70	 3.792	 0	 0	 790	 18.70	 0.000	 93	 171	 395	 647766	 0.821	 1.532	 0.013
ipcache_entry       	  128	 	 	 	 	 	 	 	 930	 117	 132	 14.43	 2.582	 920	 115	 132	 14.43	 98.925	 10	 2	 17	 27191	 0.034	 0.004	 0.000
mem_node            	 4136	 	 	 	 	 	 	 	 24	 97	 324	 18.21	 2.153	 1	 5	 324	 18.21	 4.167	 23	 93	 324	 3080639	 3.904	 16.033	 0.013
cbdata Server (11)  	  776	 	 	 	 	 	 	 	 113	 86	 379	 18.70	 1.902	 0	 0	 379	 18.70	 0.000	 113	 86	 160	 220400	 0.279	 0.215	 0.013
16K Buffer          	 16384	 	 	 	 	 	 	 	 5	 80	 144	 18.31	 1.777	 1	 16	 144	 18.31	 20.000	 4	 64	 128	 37929	 0.048	 0.782	 0.000
cbdata clientReplyContext (15)	 4352	 	 	 	 	 	 	 	 17	 73	 145	 15.96	 1.605	 0	 0	 145	 15.96	 0.000	 17	 73	 145	 650506	 0.824	 3.562	 0.013
Stream              	 4216	 	 	 	 	 	 	 	 17	 70	 140	 15.96	 1.554	 0	 0	 140	 15.96	 0.000	 17	 70	 140	 649211	 0.823	 3.444	 0.013
Comm::Connection    	  208	 	 	 	 	 	 	 	 252	 52	 204	 18.27	 1.137	 16	 4	 204	 18.27	 6.349	 236	 48	 78	 1638104	 2.076	 0.429	 0.062
cbdata idns_query (13)	 8696	 	 	 	 	 	 	 	 5	 43	 170	 15.94	 0.943	 0	 0	 170	 15.94	 0.000	 5	 43	 170	 29017	 0.037	 0.318	 0.000
cbdata ACLFilledChecklist (18)	  496	 	 	 	 	 	 	 	 84	 41	 205	 18.69	 0.904	 0	 0	 205	 18.69	 0.000	 84	 41	 103	 1169425	 1.482	 0.730	 0.013
cbdata FwdState (21)	  176	 	 	 	 	 	 	 	 169	 30	 30	 14.15	 0.645	 152	 27	 30	 14.15	 89.941	 17	 3	 6	 455910	 0.578	 0.101	 0.000
HttpReply           	  288	 	 	 	 	 	 	 	 95	 27	 122	 18.70	 0.593	 1	 1	 122	 18.70	 1.053	 94	 27	 61	 1704255	 2.160	 0.618	 0.031
2K Buffer           	 2048	 	 	 	 	 	 	 	 13	 26	 76	 18.70	 0.577	 2	 4	 76	 18.70	 15.385	 11	 22	 54	 3164453	 4.010	 8.155	 0.000
1KB Strings         	 1024	 	 	 	 	 	 	 	 25	 25	 57	 18.74	 0.555	 0	 0	 57	 18.74	 0.000	 25	 25	 44	 279884	 0.355	 0.361	 0.000
MimeEntry           	  144	 	 	 	 	 	 	 	 177	 25	 25	 18.80	 0.553	 177	 25	 25	 18.80	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
8K Buffer           	 8192	 	 	 	 	 	 	 	 3	 24	 80	 18.72	 0.533	 1	 8	 80	 18.72	 33.333	 2	 16	 64	 181893	 0.231	 1.875	 0.000
Long Strings        	  512	 	 	 	 	 	 	 	 46	 23	 232	 18.70	 0.511	 0	 0	 232	 18.70	 0.000	 46	 23	 104	 1384318	 1.754	 0.892	 0.000
MemBlob             	   48	 	 	 	 	 	 	 	 307	 15	 200	 18.70	 0.320	 300	 15	 200	 18.70	 97.720	 7	 1	 50	 15018637	 19.033	 0.907	 0.120
4K Buffer           	 4096	 	 	 	 	 	 	 	 3	 12	 48	 18.75	 0.267	 0	 0	 48	 18.75	 0.000	 3	 12	 44	 103479	 0.131	 0.533	 0.000
cbdata MemBuf (4)   	   72	 	 	 	 	 	 	 	 102	 8	 31	 18.70	 0.159	 7	 1	 31	 18.70	 6.863	 95	 7	 16	 2169695	 2.750	 0.197	 0.031
HttpHdrCc           	   96	 	 	 	 	 	 	 	 72	 7	 33	 18.70	 0.150	 0	 0	 33	 18.70	 0.000	 72	 7	 16	 1227868	 1.556	 0.148	 0.000
cbdata ClientHttpRequest (14)	  392	 	 	 	 	 	 	 	 17	 7	 14	 15.96	 0.145	 0	 0	 14	 15.96	 0.000	 17	 7	 14	 650506	 0.824	 0.321	 0.013
MemObject           	  352	 	 	 	 	 	 	 	 18	 7	 12	 15.96	 0.137	 1	 1	 12	 15.96	 5.556	 17	 6	 12	 628085	 0.796	 0.278	 0.031
Medium Strings      	  128	 	 	 	 	 	 	 	 39	 5	 240	 18.70	 0.108	 39	 5	 240	 18.70	 100.000	 0	 0	 82	 7116399	 9.019	 1.146	 0.000
cbdata HttpStateData (26)	  352	 	 	 	 	 	 	 	 14	 5	 9	 18.71	 0.107	 0	 0	 9	 18.71	 0.000	 14	 5	 9	 452308	 0.573	 0.200	 0.000
cbdata UdsSender (8)	 4528	 	 	 	 	 	 	 	 1	 5	 9	 18.80	 0.098	 0	 0	 9	 18.80	 0.000	 1	 5	 9	 697	 0.001	 0.004	 0.031
cbdata Strand (9)   	 4520	 	 	 	 	 	 	 	 1	 5	 5	 18.80	 0.098	 1	 5	 5	 18.80	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata clientStreamNode (16)	  128	 	 	 	 	 	 	 	 34	 5	 9	 15.96	 0.094	 0	 0	 9	 15.96	 0.000	 34	 5	 9	 1301012	 1.649	 0.210	 0.027
cbdata Filler (30)  	 4216	 	 	 	 	 	 	 	 1	 5	 5	 18.73	 0.091	 1	 5	 5	 18.73	 100.000	 0	 0	 5	 436	 0.001	 0.002	 0.018
DownloaderContext   	 4144	 	 	 	 	 	 	 	 1	 5	 21	 15.87	 0.090	 0	 0	 21	 15.87	 0.000	 1	 5	 21	 1241	 0.002	 0.006	 0.000
cbdata store_client (20)	  160	 	 	 	 	 	 	 	 17	 3	 6	 15.96	 0.059	 1	 1	 6	 15.96	 5.882	 16	 3	 6	 456834	 0.579	 0.092	 0.031
StoreEntry          	  120	 	 	 	 	 	 	 	 18	 3	 4	 15.96	 0.047	 1	 1	 4	 15.96	 5.556	 17	 2	 4	 628085	 0.796	 0.095	 0.031
cbdata Tree (1)     	  176	 	 	 	 	 	 	 	 12	 3	 3	 18.80	 0.046	 12	 3	 3	 18.80	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata helper_server (3)	  328	 	 	 	 	 	 	 	 6	 2	 2	 15.50	 0.043	 6	 2	 2	 15.50	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
AndNode             	  120	 	 	 	 	 	 	 	 13	 2	 2	 18.80	 0.034	 13	 2	 2	 18.80	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ClientInfo          	  448	 	 	 	 	 	 	 	 3	 2	 2	 18.65	 0.029	 3	 2	 2	 18.65	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata ps_state (22)	  256	 	 	 	 	 	 	 	 5	 2	 5	 15.94	 0.028	 0	 0	 5	 15.94	 0.000	 5	 2	 5	 456286	 0.578	 0.147	 0.000
cbdata BlindPeerConnector (24)	  224	 	 	 	 	 	 	 	 5	 2	 5	 15.94	 0.024	 0	 0	 5	 15.94	 0.000	 5	 2	 5	 80861	 0.102	 0.023	 0.000
BodyPipe            	  136	 	 	 	 	 	 	 	 8	 2	 6	 18.70	 0.024	 0	 0	 6	 18.70	 0.000	 8	 2	 3	 20245	 0.026	 0.003	 0.000
fqdncache_entry     	  160	 	 	 	 	 	 	 	 5	 1	 2	 16.80	 0.017	 5	 1	 2	 16.80	 100.000	 0	 0	 1	 4	 0.000	 0.000	 0.000
cbdata ConnOpener (23)	  136	 	 	 	 	 	 	 	 5	 1	 3	 15.94	 0.015	 0	 0	 3	 15.94	 0.000	 5	 1	 3	 96135	 0.122	 0.016	 0.000
ACLStrategised      	  120	 	 	 	 	 	 	 	 5	 1	 1	 18.80	 0.013	 5	 1	 1	 18.80	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
acl_ip_data         	   96	 	 	 	 	 	 	 	 6	 1	 1	 18.80	 0.012	 6	 1	 1	 18.80	 100.000	 0	 0	 1	 3	 0.000	 0.000	 0.000
ev_entry            	   48	 	 	 	 	 	 	 	 10	 1	 1	 18.23	 0.010	 7	 1	 1	 18.23	 70.000	 3	 1	 1	 161556	 0.205	 0.010	 2.288
Helper::Xaction     	  184	 	 	 	 	 	 	 	 2	 1	 2	 15.50	 0.008	 0	 0	 2	 15.50	 0.000	 2	 1	 2	 6900	 0.009	 0.002	 0.000
cbdata Logfile (5)  	  352	 	 	 	 	 	 	 	 1	 1	 1	 18.80	 0.008	 1	 1	 1	 18.80	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata helper (2)   	  296	 	 	 	 	 	 	 	 1	 1	 1	 18.80	 0.006	 1	 1	 1	 18.80	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
MD5 digest          	   16	 	 	 	 	 	 	 	 18	 1	 1	 15.96	 0.006	 1	 1	 1	 15.96	 5.556	 17	 1	 1	 1577427	 1.999	 0.032	 0.031
ACLSslErrorData     	   56	 	 	 	 	 	 	 	 5	 1	 1	 18.80	 0.006	 5	 1	 1	 18.80	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata ErrorState (25)	  240	 	 	 	 	 	 	 	 1	 1	 1	 18.64	 0.005	 0	 0	 1	 18.64	 0.000	 1	 1	 1	 21382	 0.027	 0.006	 0.000
HttpHeaderEntry     	   56	 	 	 	 	 	 	 	 4	 1	 546	 18.70	 0.005	 0	 0	 546	 18.70	 0.000	 4	 1	 139	 25584461	 32.423	 1.803	 0.067
ACLSourceIP         	  104	 	 	 	 	 	 	 	 2	 1	 1	 18.80	 0.005	 2	 1	 1	 18.80	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata TcpAcceptor (10)	  104	 	 	 	 	 	 	 	 2	 1	 1	 18.80	 0.005	 2	 1	 1	 18.80	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata CbDataList (28)	   96	 	 	 	 	 	 	 	 2	 1	 1	 18.72	 0.004	 0	 0	 1	 18.72	 0.000	 2	 1	 1	 601954	 0.763	 0.073	 0.000
cbdata generic_cbdata (12)	   32	 	 	 	 	 	 	 	 5	 1	 1	 15.94	 0.003	 0	 0	 1	 15.94	 0.000	 5	 1	 1	 29017	 0.037	 0.001	 0.000
FwdServer           	   32	 	 	 	 	 	 	 	 5	 1	 1	 15.94	 0.003	 0	 0	 1	 15.94	 0.000	 5	 1	 1	 456286	 0.578	 0.018	 0.000
cbdata GeneratorRequest (19)	   72	 	 	 	 	 	 	 	 2	 1	 1	 15.50	 0.003	 0	 0	 1	 15.50	 0.000	 2	 1	 1	 6900	 0.009	 0.001	 0.000
cbdata Downloader (29)	  144	 	 	 	 	 	 	 	 1	 1	 1	 15.87	 0.003	 0	 0	 1	 15.87	 0.000	 1	 1	 1	 1240	 0.002	 0.000	 0.000
ACLStrategised      	  120	 	 	 	 	 	 	 	 1	 1	 1	 18.80	 0.003	 1	 1	 1	 18.80	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLDestinationIP    	  112	 	 	 	 	 	 	 	 1	 1	 1	 18.80	 0.002	 1	 1	 1	 18.80	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata Forwarder (32)	  112	 	 	 	 	 	 	 	 1	 1	 1	 18.65	 0.002	 0	 0	 1	 18.65	 0.000	 1	 1	 1	 244	 0.000	 0.000	 0.013
cbdata RemovalPolicy (6)	  104	 	 	 	 	 	 	 	 1	 1	 1	 18.80	 0.002	 1	 1	 1	 18.80	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata ClientRequestContext (17)	  104	 	 	 	 	 	 	 	 1	 1	 1	 18.80	 0.002	 0	 0	 1	 18.80	 0.000	 1	 1	 1	 650973	 0.825	 0.085	 0.013
wordlist            	   16	 	 	 	 	 	 	 	 5	 1	 1	 18.80	 0.002	 5	 1	 1	 18.80	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata RemovalPurgeWalker (7)	   72	 	 	 	 	 	 	 	 1	 1	 1	 18.80	 0.002	 0	 0	 1	 18.80	 0.000	 1	 1	 1	 16219	 0.021	 0.001	 0.004
CacheDigest         	   40	 	 	 	 	 	 	 	 1	 1	 1	 18.80	 0.001	 1	 1	 1	 18.80	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLRegexData        	   24	 	 	 	 	 	 	 	 1	 1	 1	 18.80	 0.001	 1	 1	 1	 18.80	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
64K Buffer          	 65536	 	 	 	 	 	 	 	 0	 0	 256	 18.76	 0.000	 0	 0	 256	 18.76	 -1.000	 0	 0	 256	 95	 0.000	 0.008	 0.000
HttpHdrRange        	   32	 	 	 	 	 	 	 	 0	 0	 1	 16.12	 0.000	 0	 0	 1	 16.12	 -1.000	 0	 0	 1	 221	 0.000	 0.000	 0.000
HttpHdrRangeSpec    	   16	 	 	 	 	 	 	 	 0	 0	 1	 16.12	 0.000	 0	 0	 1	 16.12	 -1.000	 0	 0	 1	 221	 0.000	 0.000	 0.000
HttpHdrContRange    	   24	 	 	 	 	 	 	 	 0	 0	 1	 15.42	 0.000	 0	 0	 1	 15.42	 -1.000	 0	 0	 1	 398	 0.001	 0.000	 0.000
cbdata nsvc (31)    	   72	 	 	 	 	 	 	 	 0	 0	 1	 15.47	 0.000	 0	 0	 1	 15.47	 -1.000	 0	 0	 1	 17	 0.000	 0.000	 0.000
HttpHdrSc           	   16	 	 	 	 	 	 	 	 0	 0	 1	 17.69	 0.000	 0	 0	 1	 17.69	 -1.000	 0	 0	 1	 153	 0.000	 0.000	 0.000
HttpHdrScTarget     	   88	 	 	 	 	 	 	 	 0	 0	 1	 15.75	 0.000	 0	 0	 1	 15.75	 -1.000	 0	 0	 1	 158	 0.000	 0.000	 0.000
Total               	    1	 	 	 	 	 	 	 	 3200	 4503	 17268	 18.69	 100.000	 1707	 434	 15529	 18.70	 9.618	 1493	 4070	 8027	 78482443	 99.461	 99.788	 351304.735
Cumulative allocated volume: 79.469 GB
Current overhead: 25651 bytes (5.785%)
Idle pool limit: 5.00 MB
Total Pools created: 82
Pools ever used:     78 (shown above)
Currently in use:    38
String Pool	 Impact		
 	 (%strings)	 (%volume)
Short Strings       	 0	 0
Medium Strings      	 10	 38
Long Strings        	 0	 0
1KB Strings         	 0	 0
4KB Strings         	 0	 0
16KB Strings        	 0	 0
Other Strings       	 90	 62

Large buffers: 0 (0 KB)
} by kid2

by kid3 {
Current memory usage:
Pool	 Obj Size	Chunks							Allocated					In Use					Idle			Allocations Saved			Rate	
 	 (bytes)	KB/ch	 obj/ch	(#)	 used	 free	 part	 %Frag	 (#)	 (KB)	 high (KB)	 high (hrs)	 %Tot	(#)	 (KB)	 high (KB)	 high (hrs)	 %alloc	(#)	 (KB)	 high (KB)	(#)	 %cnt	 %vol	(#)/sec	
16KB Strings        	 16384	 	 	 	 	 	 	 	 112	 1792	 12208	 18.69	 63.967	 0	 0	 12208	 18.69	 0.000	 112	 1792	 5136	 4419680	 3.107	 48.646	 0.000
32K Buffer          	 32768	 	 	 	 	 	 	 	 6	 192	 480	 18.76	 6.854	 6	 192	 480	 18.76	 100.000	 0	 0	 288	 15863	 0.011	 0.349	 0.000
4KB Strings         	 4096	 	 	 	 	 	 	 	 32	 128	 2400	 18.72	 4.569	 0	 0	 2400	 18.72	 0.000	 32	 128	 1176	 2088764	 1.469	 5.748	 0.000
HttpRequest         	 1880	 	 	 	 	 	 	 	 68	 125	 1001	 18.69	 4.456	 0	 0	 1001	 18.69	 0.000	 68	 125	 384	 1148350	 0.807	 1.450	 0.000
ipcache_entry       	  128	 	 	 	 	 	 	 	 920	 115	 132	 14.43	 4.105	 920	 115	 132	 14.43	 100.000	 0	 0	 17	 37690	 0.026	 0.003	 0.000
cbdata IdleConnList (27)	 4168	 	 	 	 	 	 	 	 28	 114	 2369	 17.90	 4.068	 0	 0	 2369	 17.90	 0.000	 28	 114	 1177	 203871	 0.143	 0.571	 0.000
cbdata Server (13)  	  776	 	 	 	 	 	 	 	 67	 51	 471	 18.69	 1.812	 0	 0	 471	 18.69	 0.000	 67	 51	 188	 388049	 0.273	 0.202	 0.000
cbdata FwdState (23)	  176	 	 	 	 	 	 	 	 214	 37	 42	 14.24	 1.313	 214	 37	 42	 14.24	 100.000	 0	 0	 8	 809497	 0.569	 0.096	 0.000
cbdata ACLFilledChecklist (18)	  496	 	 	 	 	 	 	 	 68	 33	 258	 18.69	 1.176	 0	 0	 258	 18.69	 0.000	 68	 33	 98	 2059519	 1.448	 0.686	 0.000
Comm::Connection    	  208	 	 	 	 	 	 	 	 150	 31	 259	 18.27	 1.088	 16	 4	 259	 18.27	 10.667	 134	 28	 104	 2587227	 1.819	 0.362	 0.053
MimeEntry           	  144	 	 	 	 	 	 	 	 177	 25	 25	 190.62	 0.888	 177	 25	 25	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
HttpReply           	  288	 	 	 	 	 	 	 	 68	 20	 155	 18.69	 0.683	 1	 1	 155	 18.69	 1.471	 67	 19	 60	 3035341	 2.134	 0.587	 0.018
16K Buffer          	 16384	 	 	 	 	 	 	 	 1	 16	 128	 18.26	 0.571	 1	 16	 128	 18.26	 100.000	 0	 0	 112	 70207	 0.049	 0.773	 0.000
Long Strings        	  512	 	 	 	 	 	 	 	 29	 15	 293	 18.69	 0.518	 0	 0	 293	 18.69	 0.000	 29	 15	 107	 2375259	 1.670	 0.817	 0.000
MemBlob             	   48	 	 	 	 	 	 	 	 306	 15	 247	 18.69	 0.512	 299	 15	 247	 18.69	 97.712	 7	 1	 61	 27380394	 19.251	 0.883	 0.000
1KB Strings         	 1024	 	 	 	 	 	 	 	 14	 14	 92	 18.83	 0.500	 0	 0	 92	 18.83	 0.000	 14	 14	 57	 512516	 0.360	 0.353	 0.000
mem_node            	 4136	 	 	 	 	 	 	 	 3	 13	 400	 18.45	 0.433	 1	 5	 400	 18.45	 33.333	 2	 9	 400	 5820752	 4.093	 16.173	 0.013
2K Buffer           	 2048	 	 	 	 	 	 	 	 5	 10	 84	 18.70	 0.357	 2	 4	 84	 18.70	 40.000	 3	 6	 52	 5767132	 4.055	 7.935	 0.000
8K Buffer           	 8192	 	 	 	 	 	 	 	 1	 8	 104	 18.75	 0.286	 1	 8	 104	 18.75	 100.000	 0	 0	 80	 372622	 0.262	 2.051	 0.000
HttpHdrCc           	   96	 	 	 	 	 	 	 	 72	 7	 40	 18.69	 0.241	 0	 0	 40	 18.69	 0.000	 72	 7	 17	 2188003	 1.538	 0.141	 0.000
cbdata MemBuf (4)   	   72	 	 	 	 	 	 	 	 74	 6	 40	 18.69	 0.186	 7	 1	 40	 18.69	 9.459	 67	 5	 15	 3861803	 2.715	 0.187	 0.018
Medium Strings      	  128	 	 	 	 	 	 	 	 38	 5	 292	 18.69	 0.170	 38	 5	 292	 18.69	 100.000	 0	 0	 87	 12670531	 8.909	 1.090	 0.000
cbdata UdsSender (8)	 4528	 	 	 	 	 	 	 	 1	 5	 9	 190.62	 0.158	 0	 0	 9	 190.62	 0.000	 1	 5	 9	 4689	 0.003	 0.014	 0.018
cbdata Strand (9)   	 4520	 	 	 	 	 	 	 	 1	 5	 5	 190.62	 0.158	 1	 5	 5	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata clientReplyContext (15)	 4352	 	 	 	 	 	 	 	 1	 5	 209	 18.74	 0.152	 0	 0	 209	 18.74	 0.000	 1	 5	 200	 1152951	 0.811	 3.371	 0.000
cbdata Filler (11)  	 4216	 	 	 	 	 	 	 	 1	 5	 5	 190.57	 0.147	 1	 5	 5	 190.57	 100.000	 0	 0	 5	 4548	 0.003	 0.013	 0.018
Stream              	 4216	 	 	 	 	 	 	 	 1	 5	 182	 15.96	 0.147	 0	 0	 182	 15.96	 0.000	 1	 5	 182	 1150886	 0.809	 3.260	 0.000
cbdata Tree (1)     	  176	 	 	 	 	 	 	 	 12	 3	 3	 190.62	 0.074	 12	 3	 3	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata helper_server (3)	  328	 	 	 	 	 	 	 	 6	 2	 2	 19.03	 0.069	 6	 2	 2	 19.03	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ClientInfo          	  448	 	 	 	 	 	 	 	 4	 2	 2	 78.72	 0.062	 4	 2	 2	 78.72	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
AndNode             	  120	 	 	 	 	 	 	 	 13	 2	 2	 190.62	 0.054	 13	 2	 2	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
fqdncache_entry     	  160	 	 	 	 	 	 	 	 6	 1	 3	 17.03	 0.033	 6	 1	 3	 17.03	 100.000	 0	 0	 2	 8	 0.000	 0.000	 0.000
ACLStrategised      	  120	 	 	 	 	 	 	 	 5	 1	 1	 190.62	 0.021	 5	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
acl_ip_data         	   96	 	 	 	 	 	 	 	 6	 1	 1	 190.62	 0.020	 6	 1	 1	 190.62	 100.000	 0	 0	 1	 3	 0.000	 0.000	 0.000
BodyPipe            	  136	 	 	 	 	 	 	 	 3	 1	 6	 18.70	 0.014	 0	 0	 6	 18.70	 0.000	 3	 1	 4	 29024	 0.020	 0.003	 0.000
cbdata ClientHttpRequest (14)	  392	 	 	 	 	 	 	 	 1	 1	 19	 18.74	 0.014	 0	 0	 19	 18.74	 0.000	 1	 1	 18	 1152951	 0.811	 0.304	 0.000
ev_entry            	   48	 	 	 	 	 	 	 	 8	 1	 1	 18.30	 0.013	 7	 1	 1	 18.30	 87.500	 1	 1	 1	 1577907	 1.109	 0.051	 2.275
cbdata Logfile (5)  	  352	 	 	 	 	 	 	 	 1	 1	 1	 190.62	 0.012	 1	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
MemObject           	  352	 	 	 	 	 	 	 	 1	 1	 17	 18.74	 0.012	 1	 1	 17	 18.74	 100.000	 0	 0	 17	 1121029	 0.788	 0.265	 0.018
cbdata helper (2)   	  296	 	 	 	 	 	 	 	 1	 1	 1	 190.62	 0.010	 1	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLSslErrorData     	   56	 	 	 	 	 	 	 	 5	 1	 1	 190.62	 0.010	 5	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata clientStreamNode (16)	  128	 	 	 	 	 	 	 	 2	 1	 13	 18.74	 0.009	 0	 0	 13	 18.74	 0.000	 2	 1	 12	 2305902	 1.621	 0.198	 0.000
HttpHeaderEntry     	   56	 	 	 	 	 	 	 	 4	 1	 669	 18.69	 0.008	 0	 0	 669	 18.69	 0.000	 4	 1	 180	 45339083	 31.878	 1.706	 0.000
ACLSourceIP         	  104	 	 	 	 	 	 	 	 2	 1	 1	 190.62	 0.007	 2	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata TcpAcceptor (10)	  104	 	 	 	 	 	 	 	 2	 1	 1	 190.62	 0.007	 2	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata store_client (12)	  160	 	 	 	 	 	 	 	 1	 1	 8	 18.74	 0.006	 1	 1	 8	 18.74	 100.000	 0	 0	 8	 815222	 0.573	 0.088	 0.018
ACLStrategised      	  120	 	 	 	 	 	 	 	 1	 1	 1	 190.62	 0.004	 1	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
StoreEntry          	  120	 	 	 	 	 	 	 	 1	 1	 6	 18.74	 0.004	 1	 1	 6	 18.74	 100.000	 0	 0	 6	 1121029	 0.788	 0.090	 0.018
ACLDestinationIP    	  112	 	 	 	 	 	 	 	 1	 1	 1	 190.62	 0.004	 1	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata Forwarder (19)	  112	 	 	 	 	 	 	 	 1	 1	 1	 184.66	 0.004	 0	 0	 1	 184.66	 0.000	 1	 1	 1	 131	 0.000	 0.000	 0.000
cbdata RemovalPolicy (6)	  104	 	 	 	 	 	 	 	 1	 1	 1	 190.62	 0.004	 1	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata ClientRequestContext (17)	  104	 	 	 	 	 	 	 	 1	 1	 1	 184.66	 0.004	 0	 0	 1	 184.66	 0.000	 1	 1	 1	 1153363	 0.811	 0.081	 0.000
wordlist            	   16	 	 	 	 	 	 	 	 5	 1	 1	 190.62	 0.003	 5	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata RemovalPurgeWalker (7)	   72	 	 	 	 	 	 	 	 1	 1	 1	 190.62	 0.003	 0	 0	 1	 190.62	 0.000	 1	 1	 1	 19719	 0.014	 0.001	 0.004
CacheDigest         	   40	 	 	 	 	 	 	 	 1	 1	 1	 190.62	 0.001	 1	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLRegexData        	   24	 	 	 	 	 	 	 	 1	 1	 1	 190.62	 0.001	 1	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
MD5 digest          	   16	 	 	 	 	 	 	 	 1	 1	 1	 18.74	 0.001	 1	 1	 1	 18.74	 100.000	 0	 0	 1	 2840947	 1.997	 0.031	 0.018
4K Buffer           	 4096	 	 	 	 	 	 	 	 0	 0	 44	 18.71	 0.000	 0	 0	 44	 18.71	 -1.000	 0	 0	 36	 189834	 0.133	 0.522	 0.000
64K Buffer          	 65536	 	 	 	 	 	 	 	 0	 0	 192	 18.76	 0.000	 0	 0	 192	 18.76	 -1.000	 0	 0	 192	 155	 0.000	 0.007	 0.000
cbdata generic_cbdata (20)	   32	 	 	 	 	 	 	 	 0	 0	 1	 15.94	 0.000	 0	 0	 1	 15.94	 -1.000	 0	 0	 1	 40143	 0.028	 0.001	 0.000
cbdata idns_query (21)	 8696	 	 	 	 	 	 	 	 0	 0	 145	 15.94	 0.000	 0	 0	 145	 15.94	 -1.000	 0	 0	 145	 40143	 0.028	 0.235	 0.000
cbdata ErrorState (22)	  240	 	 	 	 	 	 	 	 0	 0	 2	 17.41	 0.000	 0	 0	 2	 17.41	 -1.000	 0	 0	 2	 44526	 0.031	 0.007	 0.000
cbdata ps_state (24)	  256	 	 	 	 	 	 	 	 0	 0	 5	 15.94	 0.000	 0	 0	 5	 15.94	 -1.000	 0	 0	 5	 810292	 0.570	 0.139	 0.000
FwdServer           	   32	 	 	 	 	 	 	 	 0	 0	 1	 15.94	 0.000	 0	 0	 1	 15.94	 -1.000	 0	 0	 1	 810292	 0.570	 0.017	 0.000
cbdata ConnOpener (25)	  136	 	 	 	 	 	 	 	 0	 0	 3	 17.14	 0.000	 0	 0	 3	 17.14	 -1.000	 0	 0	 3	 156780	 0.110	 0.014	 0.000
cbdata HttpStateData (26)	  352	 	 	 	 	 	 	 	 0	 0	 12	 15.06	 0.000	 0	 0	 12	 15.06	 -1.000	 0	 0	 12	 802534	 0.564	 0.190	 0.000
cbdata GeneratorRequest (28)	   72	 	 	 	 	 	 	 	 0	 0	 1	 19.03	 0.000	 0	 0	 1	 19.03	 -1.000	 0	 0	 1	 8868	 0.006	 0.000	 0.000
Helper::Xaction     	  184	 	 	 	 	 	 	 	 0	 0	 1	 19.03	 0.000	 0	 0	 1	 19.03	 -1.000	 0	 0	 1	 8868	 0.006	 0.001	 0.000
cbdata BlindPeerConnector (29)	  224	 	 	 	 	 	 	 	 0	 0	 6	 15.53	 0.000	 0	 0	 6	 15.53	 -1.000	 0	 0	 6	 132896	 0.093	 0.020	 0.000
cbdata CbDataList (30)	   96	 	 	 	 	 	 	 	 0	 0	 1	 19.02	 0.000	 0	 0	 1	 19.02	 -1.000	 0	 0	 1	 850860	 0.598	 0.055	 0.000
cbdata Downloader (31)	  144	 	 	 	 	 	 	 	 0	 0	 2	 18.74	 0.000	 0	 0	 2	 18.74	 -1.000	 0	 0	 2	 1965	 0.001	 0.000	 0.000
DownloaderContext   	 4144	 	 	 	 	 	 	 	 0	 0	 33	 18.74	 0.000	 0	 0	 33	 18.74	 -1.000	 0	 0	 33	 1966	 0.001	 0.005	 0.000
HttpHdrRange        	   32	 	 	 	 	 	 	 	 0	 0	 1	 15.42	 0.000	 0	 0	 1	 15.42	 -1.000	 0	 0	 1	 373	 0.000	 0.000	 0.000
HttpHdrRangeSpec    	   16	 	 	 	 	 	 	 	 0	 0	 1	 15.42	 0.000	 0	 0	 1	 15.42	 -1.000	 0	 0	 1	 373	 0.000	 0.000	 0.000
HttpHdrContRange    	   24	 	 	 	 	 	 	 	 0	 0	 1	 15.42	 0.000	 0	 0	 1	 15.42	 -1.000	 0	 0	 1	 691	 0.000	 0.000	 0.000
cbdata nsvc (32)    	   72	 	 	 	 	 	 	 	 0	 0	 1	 18.83	 0.000	 0	 0	 1	 18.83	 -1.000	 0	 0	 1	 24	 0.000	 0.000	 0.000
HttpHdrSc           	   16	 	 	 	 	 	 	 	 0	 0	 1	 15.75	 0.000	 0	 0	 1	 15.75	 -1.000	 0	 0	 1	 278	 0.000	 0.000	 0.000
HttpHdrScTarget     	   88	 	 	 	 	 	 	 	 0	 0	 1	 15.75	 0.000	 0	 0	 1	 15.75	 -1.000	 0	 0	 1	 325	 0.000	 0.000	 0.000
Total               	    1	 	 	 	 	 	 	 	 2556	 2802	 21493	 18.69	 100.000	 1769	 445	 19096	 18.69	 15.853	 787	 2358	 8489	 141504648	 99.492	 99.789	 633210.957
Cumulative allocated volume: 148.857 GB
Current overhead: 25651 bytes (5.640%)
Idle pool limit: 5.00 MB
Total Pools created: 82
Pools ever used:     78 (shown above)
Currently in use:    38
String Pool	 Impact		
 	 (%strings)	 (%volume)
Short Strings       	 0	 0
Medium Strings      	 9	 38
Long Strings        	 0	 0
1KB Strings         	 0	 0
4KB Strings         	 0	 0
16KB Strings        	 0	 0
Other Strings       	 91	 62

Large buffers: 0 (0 KB)
} by kid3

by kid4 {
Current memory usage:
Pool	 Obj Size	Chunks							Allocated					In Use					Idle			Allocations Saved			Rate	
 	 (bytes)	KB/ch	 obj/ch	(#)	 used	 free	 part	 %Frag	 (#)	 (KB)	 high (KB)	 high (hrs)	 %Tot	(#)	 (KB)	 high (KB)	 high (hrs)	 %alloc	(#)	 (KB)	 high (KB)	(#)	 %cnt	 %vol	(#)/sec	
16KB Strings        	 16384	 	 	 	 	 	 	 	 80	 1280	 10320	 18.69	 61.380	 0	 0	 10320	 18.69	 0.000	 80	 1280	 4976	 3116948	 3.189	 49.302	 0.000
32K Buffer          	 32768	 	 	 	 	 	 	 	 6	 192	 448	 18.69	 9.207	 6	 192	 448	 18.69	 100.000	 0	 0	 256	 11974	 0.012	 0.379	 0.000
ipcache_entry       	  128	 	 	 	 	 	 	 	 920	 115	 125	 17.91	 5.515	 920	 115	 125	 17.91	 100.000	 0	 0	 10	 29233	 0.030	 0.004	 0.000
HttpRequest         	 1880	 	 	 	 	 	 	 	 45	 83	 896	 18.69	 3.962	 0	 0	 896	 18.69	 0.000	 45	 83	 410	 775405	 0.793	 1.407	 0.000
cbdata IdleConnList (29)	 4168	 	 	 	 	 	 	 	 18	 74	 1686	 18.27	 3.513	 0	 0	 1686	 18.27	 0.000	 18	 74	 1034	 146492	 0.150	 0.589	 0.000
4KB Strings         	 4096	 	 	 	 	 	 	 	 14	 56	 2344	 18.70	 2.685	 0	 0	 2344	 18.70	 0.000	 14	 56	 1092	 1396546	 1.429	 5.522	 0.000
cbdata Server (13)  	  776	 	 	 	 	 	 	 	 42	 32	 429	 18.69	 1.526	 0	 0	 429	 18.69	 0.000	 42	 32	 179	 255166	 0.261	 0.191	 0.000
Medium Strings      	  128	 	 	 	 	 	 	 	 244	 31	 264	 18.75	 1.463	 39	 5	 264	 18.75	 15.984	 205	 26	 77	 8569496	 8.767	 1.059	 0.000
cbdata FwdState (23)	  176	 	 	 	 	 	 	 	 172	 30	 34	 14.36	 1.418	 172	 30	 34	 14.36	 100.000	 0	 0	 8	 549617	 0.562	 0.093	 0.000
MimeEntry           	  144	 	 	 	 	 	 	 	 177	 25	 25	 190.62	 1.194	 177	 25	 25	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata ACLFilledChecklist (18)	  496	 	 	 	 	 	 	 	 45	 22	 225	 18.69	 1.045	 0	 0	 225	 18.69	 0.000	 45	 22	 107	 1384947	 1.417	 0.663	 0.000
Comm::Connection    	  208	 	 	 	 	 	 	 	 102	 21	 229	 18.69	 0.994	 16	 4	 229	 18.69	 15.686	 86	 18	 93	 1828114	 1.870	 0.367	 0.053
16K Buffer          	 16384	 	 	 	 	 	 	 	 1	 16	 144	 18.26	 0.767	 1	 16	 144	 18.26	 100.000	 0	 0	 112	 48710	 0.050	 0.770	 0.000
MemBlob             	   48	 	 	 	 	 	 	 	 307	 15	 221	 18.69	 0.690	 300	 15	 221	 18.69	 97.720	 7	 1	 56	 18730040	 19.162	 0.868	 0.000
HttpReply           	  288	 	 	 	 	 	 	 	 45	 13	 140	 18.69	 0.607	 1	 1	 140	 18.69	 2.222	 44	 13	 64	 2079475	 2.127	 0.578	 0.018
mem_node            	 4136	 	 	 	 	 	 	 	 3	 13	 328	 18.47	 0.581	 1	 5	 328	 18.47	 33.333	 2	 9	 328	 4133928	 4.229	 16.507	 0.013
2K Buffer           	 2048	 	 	 	 	 	 	 	 6	 12	 72	 18.69	 0.575	 2	 4	 72	 18.69	 33.333	 4	 8	 50	 3867204	 3.956	 7.646	 0.000
1KB Strings         	 1024	 	 	 	 	 	 	 	 7	 7	 66	 18.70	 0.336	 0	 0	 66	 18.70	 0.000	 7	 7	 43	 342774	 0.351	 0.339	 0.000
Long Strings        	  512	 	 	 	 	 	 	 	 12	 6	 244	 18.69	 0.288	 0	 0	 244	 18.69	 0.000	 12	 6	 97	 1569000	 1.605	 0.776	 0.000
cbdata UdsSender (8)	 4528	 	 	 	 	 	 	 	 1	 5	 9	 190.62	 0.212	 0	 0	 9	 190.62	 0.000	 1	 5	 9	 4594	 0.005	 0.020	 0.018
cbdata Strand (9)   	 4520	 	 	 	 	 	 	 	 1	 5	 5	 190.62	 0.212	 1	 5	 5	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
HttpHdrCc           	   96	 	 	 	 	 	 	 	 46	 5	 35	 18.69	 0.207	 0	 0	 35	 18.69	 0.000	 46	 5	 18	 1490707	 1.525	 0.138	 0.000
cbdata clientReplyContext (15)	 4352	 	 	 	 	 	 	 	 1	 5	 192	 18.75	 0.204	 0	 0	 192	 18.75	 0.000	 1	 5	 187	 779035	 0.797	 3.273	 0.000
cbdata Filler (11)  	 4216	 	 	 	 	 	 	 	 1	 5	 5	 190.57	 0.197	 1	 5	 5	 190.57	 100.000	 0	 0	 5	 4554	 0.005	 0.019	 0.018
Stream              	 4216	 	 	 	 	 	 	 	 1	 5	 182	 18.75	 0.197	 0	 0	 182	 18.75	 0.000	 1	 5	 178	 777556	 0.795	 3.165	 0.000
4K Buffer           	 4096	 	 	 	 	 	 	 	 1	 4	 44	 15.43	 0.192	 1	 4	 44	 15.43	 100.000	 0	 0	 36	 111278	 0.114	 0.440	 0.000
cbdata MemBuf (4)   	   72	 	 	 	 	 	 	 	 51	 4	 36	 18.69	 0.172	 7	 1	 36	 18.69	 13.725	 44	 4	 16	 2640365	 2.701	 0.184	 0.018
cbdata Tree (1)     	  176	 	 	 	 	 	 	 	 12	 3	 3	 190.62	 0.099	 12	 3	 3	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata helper_server (3)	  328	 	 	 	 	 	 	 	 6	 2	 2	 18.78	 0.092	 6	 2	 2	 18.78	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ClientInfo          	  448	 	 	 	 	 	 	 	 4	 2	 2	 78.70	 0.084	 4	 2	 2	 78.70	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
AndNode             	  120	 	 	 	 	 	 	 	 13	 2	 2	 190.62	 0.073	 13	 2	 2	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
fqdncache_entry     	  160	 	 	 	 	 	 	 	 6	 1	 3	 17.03	 0.045	 6	 1	 3	 17.03	 100.000	 0	 0	 2	 7	 0.000	 0.000	 0.000
ACLStrategised      	  120	 	 	 	 	 	 	 	 5	 1	 1	 190.62	 0.028	 5	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
acl_ip_data         	   96	 	 	 	 	 	 	 	 6	 1	 1	 190.62	 0.027	 6	 1	 1	 190.62	 100.000	 0	 0	 1	 3	 0.000	 0.000	 0.000
BodyPipe            	  136	 	 	 	 	 	 	 	 4	 1	 5	 18.70	 0.025	 0	 0	 5	 18.70	 0.000	 4	 1	 3	 17799	 0.018	 0.002	 0.000
cbdata ClientHttpRequest (14)	  392	 	 	 	 	 	 	 	 1	 1	 18	 18.75	 0.018	 0	 0	 18	 18.75	 0.000	 1	 1	 17	 779035	 0.797	 0.295	 0.000
ev_entry            	   48	 	 	 	 	 	 	 	 8	 1	 1	 18.76	 0.018	 7	 1	 1	 18.76	 87.500	 1	 1	 1	 1576550	 1.613	 0.073	 2.284
cbdata Logfile (5)  	  352	 	 	 	 	 	 	 	 1	 1	 1	 190.62	 0.016	 1	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
MemObject           	  352	 	 	 	 	 	 	 	 1	 1	 16	 18.75	 0.016	 1	 1	 16	 18.75	 100.000	 0	 0	 16	 771652	 0.789	 0.262	 0.018
cbdata helper (2)   	  296	 	 	 	 	 	 	 	 1	 1	 1	 190.62	 0.014	 1	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLSslErrorData     	   56	 	 	 	 	 	 	 	 5	 1	 1	 190.62	 0.013	 5	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata clientStreamNode (16)	  128	 	 	 	 	 	 	 	 2	 1	 12	 18.75	 0.012	 0	 0	 12	 18.75	 0.000	 2	 1	 11	 1558071	 1.594	 0.193	 0.000
HttpHeaderEntry     	   56	 	 	 	 	 	 	 	 4	 1	 592	 18.69	 0.010	 0	 0	 592	 18.69	 0.000	 4	 1	 153	 30831494	 31.542	 1.667	 0.000
ACLSourceIP         	  104	 	 	 	 	 	 	 	 2	 1	 1	 190.62	 0.010	 2	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata TcpAcceptor (10)	  104	 	 	 	 	 	 	 	 2	 1	 1	 190.62	 0.010	 2	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata store_client (12)	  160	 	 	 	 	 	 	 	 1	 1	 8	 18.75	 0.007	 1	 1	 8	 18.75	 100.000	 0	 0	 7	 554669	 0.567	 0.086	 0.018
ACLStrategised      	  120	 	 	 	 	 	 	 	 1	 1	 1	 190.62	 0.006	 1	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
StoreEntry          	  120	 	 	 	 	 	 	 	 1	 1	 6	 18.75	 0.006	 1	 1	 6	 18.75	 100.000	 0	 0	 6	 771652	 0.789	 0.089	 0.018
ACLDestinationIP    	  112	 	 	 	 	 	 	 	 1	 1	 1	 190.62	 0.005	 1	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata Forwarder (19)	  112	 	 	 	 	 	 	 	 1	 1	 1	 183.32	 0.005	 0	 0	 1	 183.32	 0.000	 1	 1	 1	 34	 0.000	 0.000	 0.000
cbdata RemovalPolicy (6)	  104	 	 	 	 	 	 	 	 1	 1	 1	 190.62	 0.005	 1	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata ClientRequestContext (17)	  104	 	 	 	 	 	 	 	 1	 1	 1	 183.32	 0.005	 0	 0	 1	 183.32	 0.000	 1	 1	 1	 779593	 0.798	 0.078	 0.000
wordlist            	   16	 	 	 	 	 	 	 	 5	 1	 1	 190.62	 0.004	 5	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
cbdata RemovalPurgeWalker (7)	   72	 	 	 	 	 	 	 	 1	 1	 1	 190.62	 0.003	 0	 0	 1	 190.62	 0.000	 1	 1	 1	 19088	 0.020	 0.001	 0.004
CacheDigest         	   40	 	 	 	 	 	 	 	 1	 1	 1	 190.62	 0.002	 1	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
ACLRegexData        	   24	 	 	 	 	 	 	 	 1	 1	 1	 190.62	 0.001	 1	 1	 1	 190.62	 100.000	 0	 0	 0	 0	 0.000	 0.000	 0.000
MD5 digest          	   16	 	 	 	 	 	 	 	 1	 1	 1	 18.75	 0.001	 1	 1	 1	 18.75	 100.000	 0	 0	 1	 1984828	 2.031	 0.031	 0.018
8K Buffer           	 8192	 	 	 	 	 	 	 	 0	 0	 64	 18.75	 0.000	 0	 0	 64	 18.75	 -1.000	 0	 0	 56	 250505	 0.256	 1.981	 0.000
64K Buffer          	 65536	 	 	 	 	 	 	 	 0	 0	 384	 18.76	 0.000	 0	 0	 384	 18.76	 -1.000	 0	 0	 384	 111	 0.000	 0.007	 0.000
cbdata generic_cbdata (20)	   32	 	 	 	 	 	 	 	 0	 0	 1	 16.11	 0.000	 0	 0	 1	 16.11	 -1.000	 0	 0	 1	 30934	 0.032	 0.001	 0.000
cbdata idns_query (21)	 8696	 	 	 	 	 	 	 	 0	 0	 162	 16.11	 0.000	 0	 0	 162	 16.11	 -1.000	 0	 0	 162	 30934	 0.032	 0.260	 0.000
cbdata ErrorState (22)	  240	 	 	 	 	 	 	 	 0	 0	 2	 17.49	 0.000	 0	 0	 2	 17.49	 -1.000	 0	 0	 2	 31178	 0.032	 0.007	 0.000
cbdata ps_state (24)	  256	 	 	 	 	 	 	 	 0	 0	 5	 16.11	 0.000	 0	 0	 5	 16.11	 -1.000	 0	 0	 5	 550189	 0.563	 0.136	 0.000
FwdServer           	   32	 	 	 	 	 	 	 	 0	 0	 1	 16.11	 0.000	 0	 0	 1	 16.11	 -1.000	 0	 0	 1	 550189	 0.563	 0.017	 0.000
cbdata GeneratorRequest (25)	   72	 	 	 	 	 	 	 	 0	 0	 1	 18.78	 0.000	 0	 0	 1	 18.78	 -1.000	 0	 0	 1	 6380	 0.007	 0.000	 0.000
Helper::Xaction     	  184	 	 	 	 	 	 	 	 0	 0	 1	 18.78	 0.000	 0	 0	 1	 18.78	 -1.000	 0	 0	 1	 6380	 0.007	 0.001	 0.000
cbdata ConnOpener (26)	  136	 	 	 	 	 	 	 	 0	 0	 3	 15.96	 0.000	 0	 0	 3	 15.96	 -1.000	 0	 0	 3	 108872	 0.111	 0.014	 0.000
cbdata BlindPeerConnector (27)	  224	 	 	 	 	 	 	 	 0	 0	 6	 19.04	 0.000	 0	 0	 6	 19.04	 -1.000	 0	 0	 6	 92439	 0.095	 0.020	 0.000
cbdata HttpStateData (28)	  352	 	 	 	 	 	 	 	 0	 0	 11	 18.75	 0.000	 0	 0	 11	 18.75	 -1.000	 0	 0	 11	 544636	 0.557	 0.185	 0.000
cbdata CbDataList (30)	   96	 	 	 	 	 	 	 	 0	 0	 1	 15.94	 0.000	 0	 0	 1	 15.94	 -1.000	 0	 0	 1	 697196	 0.713	 0.065	 0.000
cbdata Downloader (31)	  144	 	 	 	 	 	 	 	 0	 0	 1	 18.63	 0.000	 0	 0	 1	 18.63	 -1.000	 0	 0	 1	 1397	 0.001	 0.000	 0.000
DownloaderContext   	 4144	 	 	 	 	 	 	 	 0	 0	 25	 18.63	 0.000	 0	 0	 25	 18.63	 -1.000	 0	 0	 25	 1397	 0.001	 0.006	 0.000
HttpHdrRange        	   32	 	 	 	 	 	 	 	 0	 0	 1	 16.10	 0.000	 0	 0	 1	 16.10	 -1.000	 0	 0	 1	 235	 0.000	 0.000	 0.000
HttpHdrRangeSpec    	   16	 	 	 	 	 	 	 	 0	 0	 1	 16.10	 0.000	 0	 0	 1	 16.10	 -1.000	 0	 0	 1	 235	 0.000	 0.000	 0.000
HttpHdrContRange    	   24	 	 	 	 	 	 	 	 0	 0	 1	 15.42	 0.000	 0	 0	 1	 15.42	 -1.000	 0	 0	 1	 429	 0.000	 0.000	 0.000
cbdata nsvc (32)    	   72	 	 	 	 	 	 	 	 0	 0	 1	 18.91	 0.000	 0	 0	 1	 18.91	 -1.000	 0	 0	 1	 16	 0.000	 0.000	 0.000
HttpHdrSc           	   16	 	 	 	 	 	 	 	 0	 0	 1	 17.66	 0.000	 0	 0	 1	 17.66	 -1.000	 0	 0	 1	 154	 0.000	 0.000	 0.000
HttpHdrScTarget     	   88	 	 	 	 	 	 	 	 0	 0	 1	 16.29	 0.000	 0	 0	 1	 16.29	 -1.000	 0	 0	 1	 180	 0.000	 0.000	 0.000
cbdata ESIContext (33)	  296	 	 	 	 	 	 	 	 0	 0	 1	 16.99	 0.000	 0	 0	 1	 16.99	 -1.000	 0	 0	 1	 0	 0.000	 0.000	 0.000
esiSequence         	   96	 	 	 	 	 	 	 	 0	 0	 1	 16.99	 0.000	 0	 0	 1	 16.99	 -1.000	 0	 0	 1	 0	 0.000	 0.000	 0.000
cbdata ESIVarState (34)	  144	 	 	 	 	 	 	 	 0	 0	 1	 16.99	 0.000	 0	 0	 1	 16.99	 -1.000	 0	 0	 1	 0	 0.000	 0.000	 0.000
cbdata ESISegment (35)	 4160	 	 	 	 	 	 	 	 0	 0	 17	 16.99	 0.000	 0	 0	 17	 16.99	 -1.000	 0	 0	 17	 3	 0.000	 0.000	 0.000
esiLiteral          	   48	 	 	 	 	 	 	 	 0	 0	 1	 16.99	 0.000	 0	 0	 1	 16.99	 -1.000	 0	 0	 1	 0	 0.000	 0.000	 0.000
Total               	    1	 	 	 	 	 	 	 	 2448	 2086	 18981	 18.69	 100.000	 1729	 434	 16605	 18.69	 20.767	 719	 1653	 8079	 97191622	 99.432	 99.777	 435177.927
Cumulative allocated volume: 103.583 GB
Current overhead: 27224 bytes (6.139%)
Idle pool limit: 5.00 MB
Total Pools created: 87
Pools ever used:     83 (shown above)
Currently in use:    38
String Pool	 Impact		
 	 (%strings)	 (%volume)
Short Strings       	 0	 0
Medium Strings      	 10	 38
Long Strings        	 0	 0
1KB Strings         	 0	 0
4KB Strings         	 0	 0
16KB Strings        	 0	 0
Other Strings       	 90	 62

Large buffers: 0 (0 KB)
} by kid4


