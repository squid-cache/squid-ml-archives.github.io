<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] ipv6 acl access not working properly
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ipv6%20acl%20access%20not%20working%20properly&In-Reply-To=%3Cc2332aa1-6338-d834-a9df-9e2a92d8702b%40suse.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016531.html">
   <LINK REL="Next"  HREF="016533.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] ipv6 acl access not working properly</H1>
    <B>Adam Majer</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20ipv6%20acl%20access%20not%20working%20properly&In-Reply-To=%3Cc2332aa1-6338-d834-a9df-9e2a92d8702b%40suse.de%3E"
       TITLE="[squid-users] ipv6 acl access not working properly">amajer at suse.de
       </A><BR>
    <I>Mon Oct  2 09:58:20 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016531.html">[squid-users] Make all IPv6 ips on system to be used as a proxy
</A></li>
        <LI>Next message (by thread): <A HREF="016533.html">[squid-users] Cache digest vs ICP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16532">[ date ]</a>
              <a href="thread.html#16532">[ thread ]</a>
              <a href="subject.html#16532">[ subject ]</a>
              <a href="author.html#16532">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 09/28/2017 06:10 PM, anwesh tiwari wrote:
&gt;<i> Ipv6 acl is not working as expected, if the ipv6 address of domain is
</I>&gt;<i> unrouteable and it fallbacks to ipv4 even when its denied.
</I>&gt;<i> 
</I>&gt;<i> Details : What I am trying to achieve :  I want to disable all IPv4
</I>&gt;<i> domain access from proxy and disable all ipv4 connections.
</I>

You appear to be correct. The ACL behaviour is checked before
connections are attempted.

So, trying to connect to IPv4 only sites fails, as expected. But if you
have a dualstack site, like whatismyipv6.com, then it passes the ACL but
fails on the IPv6 connection. Then it falls back to Ipv4 and succeeds.

This seems to be the not very intuitive part of the ACL mechanism. ACL
guards access to squid-cache, not to the site themselves. So as long as
the ACL succeeds *before* connection is ever attempted (and sometimes it
may not even be attempted, because things are cached after all), then it
passes.

If you want to disable access to outside world on IPv4, you can disable
it outside of squid. Like via iptables or dropping IPv4 from your
network interface.

- Adam

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016531.html">[squid-users] Make all IPv6 ips on system to be used as a proxy
</A></li>
	<LI>Next message (by thread): <A HREF="016533.html">[squid-users] Cache digest vs ICP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16532">[ date ]</a>
              <a href="thread.html#16532">[ thread ]</a>
              <a href="subject.html#16532">[ subject ]</a>
              <a href="author.html#16532">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
