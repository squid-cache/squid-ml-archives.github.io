<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid and kernel options
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20and%20kernel%20options&In-Reply-To=%3C%21%26%21AAAAAAAAAAAuAAAAAAAAAGDVRrtF13VDjYYZR9MgvgYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAACJVhr8QKYmQI5FI8Saf/Z%2BAQAAAAA%3D%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016541.html">
   <LINK REL="Next"  HREF="016544.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid and kernel options</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20and%20kernel%20options&In-Reply-To=%3C%21%26%21AAAAAAAAAAAuAAAAAAAAAGDVRrtF13VDjYYZR9MgvgYBAMO2jhD3dRHOtM0AqgC7tuYAAAAAAA4AABAAAACJVhr8QKYmQI5FI8Saf/Z%2BAQAAAAA%3D%40ngtech.co.il%3E"
       TITLE="[squid-users] squid and kernel options">eliezer at ngtech.co.il
       </A><BR>
    <I>Mon Oct  2 20:55:34 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016541.html">[squid-users] squid and kernel options
</A></li>
        <LI>Next message (by thread): <A HREF="016544.html">[squid-users] squid and kernel options
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16543">[ date ]</a>
              <a href="thread.html#16543">[ thread ]</a>
              <a href="subject.html#16543">[ subject ]</a>
              <a href="author.html#16543">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Vieri,

I think it's specific to your distro since... it exists in the netfilter sources as you can see at:
<A HREF="https://github.com/torvalds/linux/blob/4ac4d584886a4f47f8ff3bca0f32ff9a2987d3e5/net/netfilter/xt_socket.c">https://github.com/torvalds/linux/blob/4ac4d584886a4f47f8ff3bca0f32ff9a2987d3e5/net/netfilter/xt_socket.c</A>

Squid doesn't use it directly but the iptables rules for tproxy to work requires this module to be available.
It is used to identify which connections are local socket and not incoming connections and if these are local sockets these will not be hijacked by tproxy and will be treated like a local connection.
Without this you cannot use tproxy.
To test if it exists you need to run the next command:
$ iptables -t mangle -A PREROUTING -p tcp -m socket -j MARK --set-mark 1

And see what happens.
If it works, then you have the module on your OS and it should be fine.

Eliezer

----
<A HREF="http://ngtech.co.il/lmgtfy/">http://ngtech.co.il/lmgtfy/</A>
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>


From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Vieri
Sent: Monday, October 2, 2017 22:54
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [squid-users] squid and kernel options

Hi,

My distro's Squid package checks for the presence of several kernel config options. In particular, it checks for these:

NF_CONNTRACK 
NETFILTER_XT_MATCH_SOCKET 
NETFILTER_XT_TARGET_TPROXY

However, in recent kernels such as 4.12.12, it seems that the following option is not available anymore:

NETFILTER_XT_MATCH_SOCKET

How does Squid use this kernel config option, and how can I be affected by its absence?

Thanks,

Vieri



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016541.html">[squid-users] squid and kernel options
</A></li>
	<LI>Next message (by thread): <A HREF="016544.html">[squid-users] squid and kernel options
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16543">[ date ]</a>
              <a href="thread.html#16543">[ thread ]</a>
              <a href="subject.html#16543">[ subject ]</a>
              <a href="author.html#16543">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
