<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] SSL Bump Failures with Google and Wikipedia	[SOLVED]
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20Bump%20Failures%20with%20Google%20and%20Wikipedia%0A%09%5BSOLVED%5D&In-Reply-To=%3CCA%2BekxPVFjc_JUCDGPw7ct9Xg8hacnvN6L0gG9MYfCpmbROhJUA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016567.html">
   <LINK REL="Next"  HREF="016514.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] SSL Bump Failures with Google and Wikipedia	[SOLVED]</H1>
    <B>Jeffrey Merkey</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20SSL%20Bump%20Failures%20with%20Google%20and%20Wikipedia%0A%09%5BSOLVED%5D&In-Reply-To=%3CCA%2BekxPVFjc_JUCDGPw7ct9Xg8hacnvN6L0gG9MYfCpmbROhJUA%40mail.gmail.com%3E"
       TITLE="[squid-users] SSL Bump Failures with Google and Wikipedia	[SOLVED]">jeffmerkey at gmail.com
       </A><BR>
    <I>Wed Oct  4 20:54:45 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016567.html">[squid-users] SSL Bump Failures with Google and Wikipedia [SOLVED]
</A></li>
        <LI>Next message (by thread): <A HREF="016514.html">[squid-users] Make all IPv6 ips on system to be used as a proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16570">[ date ]</a>
              <a href="thread.html#16570">[ thread ]</a>
              <a href="subject.html#16570">[ subject ]</a>
              <a href="author.html#16570">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/4/17, Alex Rousskov &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rousskov at measurement-factory.com</A>&gt; wrote:
&gt;<i> On 09/30/2017 11:14 PM, Jeffrey Merkey wrote:
</I>&gt;&gt;&gt;<i> After reviewing this problem and all of the great technical
</I>&gt;&gt;&gt;<i> information folks provided, I have it working and I figured out the
</I>&gt;&gt;&gt;<i> best way to deal with this transparently allowing squid to remotely
</I>&gt;&gt;&gt;<i> spoof the server side with modified request headers.
</I>&gt;<i>
</I>&gt;<i> Overall, the above is _not_ the best way to deal with the encoding
</I>&gt;<i> problem. The overall best way is for your eCAP or ICAP service to decode
</I>&gt;<i> virgin and encode adapted message bodies as needed. That way, your Squid
</I>&gt;<i> does not mangle client requests to lie about accepted encodings and your
</I>&gt;<i> service can handle cases where the origin server sends encoded messages
</I>&gt;<i> regardless of the request Accept headers.
</I>&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i>
</I>Hi Alex,

great minds think alike.  I came to the same conclusion about using
that request header hackery and I have almost completed a c-icap
service called &quot;inflate&quot; that ungzip's the data as part of an icap
service chain.  I already have incorporated gzip and deflate libs into
the icap service , and I am now integrating brotli as well.  The
service is not fully completed but will be finished sometime this
week.

The code is stored as a branch at:

<A HREF="https://github.com/jeffmerkey/icap/tree/inflate">https://github.com/jeffmerkey/icap/tree/inflate</A>

I will say this, the hack I discussed in the above thread with sending
altered request headers for &quot;accept-encoding:*;p=0&quot; does seem to work
in terms of spoofing remote servers into not sending compressed data,
but I also noticed that not all servers on the internet respond to it
correctly, and some web servers ignore it and send compressed gzip
data anyway.

I will post to the icap list a patch series which contains this
&quot;inflate&quot; service module.

Jeff

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016567.html">[squid-users] SSL Bump Failures with Google and Wikipedia [SOLVED]
</A></li>
	<LI>Next message (by thread): <A HREF="016514.html">[squid-users] Make all IPv6 ips on system to be used as a proxy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16570">[ date ]</a>
              <a href="thread.html#16570">[ thread ]</a>
              <a href="subject.html#16570">[ subject ]</a>
              <a href="author.html#16570">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
