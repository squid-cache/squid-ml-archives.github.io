<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] New Squid 3.5 reconfigure causes service down
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20New%20Squid%203.5%20reconfigure%20causes%20service%20down&In-Reply-To=%3Cbeda769e-8155-387e-123f-fed5d9fd7195%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016579.html">
   <LINK REL="Next"  HREF="016588.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] New Squid 3.5 reconfigure causes service down</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20New%20Squid%203.5%20reconfigure%20causes%20service%20down&In-Reply-To=%3Cbeda769e-8155-387e-123f-fed5d9fd7195%40measurement-factory.com%3E"
       TITLE="[squid-users] New Squid 3.5 reconfigure causes service down">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Oct  5 17:28:06 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016579.html">[squid-users] New Squid 3.5 reconfigure causes service down
</A></li>
        <LI>Next message (by thread): <A HREF="016588.html">[squid-users] New Squid 3.5 reconfigure causes service down
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16581">[ date ]</a>
              <a href="thread.html#16581">[ thread ]</a>
              <a href="subject.html#16581">[ subject ]</a>
              <a href="author.html#16581">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/05/2017 10:44 AM, Nicola Ferrari (#554252) wrote:
&gt;<i> On 05/10/2017 18:25, Alex Rousskov wrote:
</I>&gt;&gt;<i> The &quot;couple of minutes&quot; part might be related to your upgrade and, if
</I>&gt;&gt;<i> so, you may be able to avoid such delays. For list readers not familiar
</I>&gt;&gt;<i> with Debian releases, which _Squid_ version are you upgrading from?
</I>
&gt;<i> I was running squid 3.4 on top of Debian 8 (jessie)
</I>&gt;<i> I upgraded to squid 3.5 on top of Debian 9 (stretch)
</I>
&gt;&gt;<i> I suggest to start by figuring our what Squid is doing during those
</I>&gt;&gt;<i> &quot;couple of minutes&quot; if you have not already.
</I>&gt;<i> 
</I>&gt;<i> What I notice by checking cache.log is that it stops for a while on
</I>&gt;<i> 
</I>&gt;<i> helperOpenServers: Starting 1/60 'ntlm_auth' processes
</I>&gt;<i> 2017/10/05 11:36:06 kid1| Starting new ntlmauthenticator helpers...
</I>&gt;<i> 
</I>&gt;<i> This was not a usual behaviour on Squid 3.4;
</I>
The next task is to figure out what changed related to that line (i.e.,
to starting ntlmauthenticator helpers). Here are a few things you may
want to check: Do you start the same number of helpers as before? Does
starting a single helper take longer in v3.5 than in v3.4? Does Squid
v3.5 consume a lot more RAM before it tries to start that helper than
Squid v3.4 consumed? Does Squid v3.5 helper itself consume a lot more
RAM than Squid v3.4 helper?

Something must have changed. If you can pinpoint that change, it is
likely that you can reverse or work around it. Since we probably do not
know what that change is, have no access to your server, and no free
time to investigate, you have to narrow the suspects down yourself.


&gt;<i> Just for testing purposes, I would try my config on a new clean install
</I>
That is a good initial test as well. And remember that you are not
looking for something that broke or does not work. You are looking for
something that works differently. And your initial focus should be on
things that affect helper startup (i.e., fork() and exec() system
calls): process size, number of processes, etc. Commands like strace can
help you measure delays down to a single system call level if needed.


Good luck,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016579.html">[squid-users] New Squid 3.5 reconfigure causes service down
</A></li>
	<LI>Next message (by thread): <A HREF="016588.html">[squid-users] New Squid 3.5 reconfigure causes service down
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16581">[ date ]</a>
              <a href="thread.html#16581">[ thread ]</a>
              <a href="subject.html#16581">[ subject ]</a>
              <a href="author.html#16581">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
