<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] New Squid 3.5 reconfigure causes service down
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20New%20Squid%203.5%20reconfigure%20causes%20service%20down&In-Reply-To=%3Cfa33cae5-efe0-c53b-e2e7-d2ec7b21f093%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016581.html">
   <LINK REL="Next"  HREF="016577.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] New Squid 3.5 reconfigure causes service down</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20New%20Squid%203.5%20reconfigure%20causes%20service%20down&In-Reply-To=%3Cfa33cae5-efe0-c53b-e2e7-d2ec7b21f093%40treenet.co.nz%3E"
       TITLE="[squid-users] New Squid 3.5 reconfigure causes service down">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Oct  6 06:11:40 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016581.html">[squid-users] New Squid 3.5 reconfigure causes service down
</A></li>
        <LI>Next message (by thread): <A HREF="016577.html">[squid-users] Is your kerberos ticket expired?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16588">[ date ]</a>
              <a href="thread.html#16588">[ thread ]</a>
              <a href="subject.html#16588">[ subject ]</a>
              <a href="author.html#16588">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 06/10/17 05:44, Nicola Ferrari (#554252) wrote:
&gt;<i> On 05/10/2017 18:25, Alex Rousskov wrote:
</I>&gt;&gt;<i> The &quot;couple of minutes&quot; part might be related to your upgrade and, if
</I>&gt;&gt;<i> so, you may be able to avoid such delays. For list readers not familiar
</I>&gt;&gt;<i> with Debian releases, which _Squid_ version are you upgrading from?
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> I was running squid 3.4 on top of Debian 8 (jessie)
</I>&gt;<i> I upgraded to squid 3.5 on top of Debian 9 (stretch)
</I>&gt;<i> 
</I>&gt;&gt;<i> I suggest to start by figuring our what Squid is doing during those
</I>&gt;&gt;<i> &quot;couple of minutes&quot; if you have not already.
</I>&gt;<i> 
</I>&gt;<i> What I notice by checking cache.log is that it stops for a while on
</I>&gt;<i> 
</I>&gt;<i> helperOpenServers: Starting 1/60 'ntlm_auth' processes
</I>&gt;<i> 2017/10/05 11:36:06 kid1| Starting new ntlmauthenticator helpers...
</I>&gt;<i> 
</I>&gt;<i> This was not a usual behaviour on Squid 3.4;
</I>
The behaviour of starting helpers has been present since forever - 
though it may not have been logged correctly. The &quot;Starting N/N 
'helper_name' processes&quot; log entry was added with dynamic helper in 
Squid-3.2, so should have been visible in Jesse.

The 1/60 indicates that the number of ntlm_auth helpers running was 1 
less than your startup=N configuration value. The N defaults to the max 
value (60) if not configured explicitly.


&gt;<i> 
</I>&gt;<i> At the moment of the upgrade, I had to adjust various path from
</I>&gt;<i> &quot;/squid3&quot; to &quot;/squid&quot; ..
</I>&gt;<i> 
</I>&gt;<i> I checked authenticators path and other occurrences in conf file,
</I>&gt;<i> everything seems to be ok.
</I>
Did Squid start properly and at least seem to work okay after the 
upgrade and before you manually ran the &quot;-k reconfigure&quot; ?

FYI: Stretch brings somewhat deeper SELinux integration in the 
background. The packaged init script updates the SELinux permissions for 
cache_dir. But if you have any custom directories for other things you 
may need to run /sbin/restorecon on them manually after any changes to 
the path or OS permissions - or do it anyway just in case SELinux is 
being confused.

&gt;<i> 
</I>&gt;<i> Just for testing purposes, I would try my config on a new clean install,
</I>&gt;<i> just to be sure this is not related to the upgrade in some way, and let
</I>&gt;<i> you know!
</I>&gt;<i> 
</I>
Please also try a full clean restart of Squid:

  Shutdown completely using the init script. If any 'squid' or 
'(squid-N)' process remains after that use kill -9 to halt that process, 
and manually delete the squid.pid / squid3.pid file if any still exists.

  Starting Squid using the Stretch package init script should then 
ensure that the expected paths have the right permissions, and runs the 
'-k parse' checks for you.

Since this is the Samba NTLM helper you should also check that the 
Samba, winbind etc components still have it enabled. Behaviour is 
undefined if the OS components are only partially functioning.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016581.html">[squid-users] New Squid 3.5 reconfigure causes service down
</A></li>
	<LI>Next message (by thread): <A HREF="016577.html">[squid-users] Is your kerberos ticket expired?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16588">[ date ]</a>
              <a href="thread.html#16588">[ thread ]</a>
              <a href="subject.html#16588">[ subject ]</a>
              <a href="author.html#16588">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
