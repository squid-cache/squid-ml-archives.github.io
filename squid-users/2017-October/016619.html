<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TCP_REFRESH_UNMODIFIEDs are really MISSes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_REFRESH_UNMODIFIEDs%20are%20really%20MISSes&In-Reply-To=%3Cd4488810-1e11-31a7-914b-c46c34a9839b%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016618.html">
   <LINK REL="Next"  HREF="016620.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TCP_REFRESH_UNMODIFIEDs are really MISSes</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_REFRESH_UNMODIFIEDs%20are%20really%20MISSes&In-Reply-To=%3Cd4488810-1e11-31a7-914b-c46c34a9839b%40treenet.co.nz%3E"
       TITLE="[squid-users] TCP_REFRESH_UNMODIFIEDs are really MISSes">squid3 at treenet.co.nz
       </A><BR>
    <I>Wed Oct 11 10:52:10 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016618.html">[squid-users] TCP_REFRESH_UNMODIFIEDs are really MISSes
</A></li>
        <LI>Next message (by thread): <A HREF="016620.html">[squid-users] TCP_REFRESH_UNMODIFIEDs are really MISSes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16619">[ date ]</a>
              <a href="thread.html#16619">[ thread ]</a>
              <a href="subject.html#16619">[ subject ]</a>
              <a href="author.html#16619">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/10/17 23:31, Victor Sudakov wrote:
&gt;<i> Alex Rousskov wrote:
</I>&gt;&gt;<i> On 10/10/2017 07:50 PM, Victor Sudakov wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> When updating several almost identical FreeBSD hosts via a
</I>&gt;&gt;&gt;<i> squid-3.5.27 proxy, I expect to see lots of HITs, because the patches
</I>&gt;&gt;&gt;<i> on the update server should be identical too.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> However, I see lots of TCP_REFRESH_UNMODIFIED lines, and only
</I>&gt;&gt;&gt;<i> occasional HIT statuses.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> There are many kinds of &quot;hits&quot;:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * If your primary concern is data transfer/bandwidth usage, then you
</I>&gt;&gt;<i> should focus on so called byte hits. TCP_REFRESH_UNMODIFIED is
</I>&gt;&gt;<i> essentially one of those because the origin server sends a tiny
</I>&gt;&gt;<i> headers-only response to Squid.
</I>&gt;<i> 
</I>&gt;<i> My primary concern is bandwidth usage. You are saying that the
</I>&gt;<i> TCP_REFRESH_UNMODIFIED transaction means that the bulk of the data is
</I>&gt;<i> not transferred from Webserver to Squid, only the headers are fetched?
</I>
Yes.

&gt;<i> 
</I>&gt;<i> If you look at this line:
</I>&gt;<i> 
</I>&gt;<i> 1507630625.515    448 212.73.124.12 TCP_REFRESH_UNMODIFIED/200 980593 GET <A HREF="http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/1195d725efce75f0db6317f507d8a9514f35613c7466673a86db23100bd6fa77-c4150431df5b14b15546b3db5e30f2bd2c35d6d52812f057dc101fab20847324">http://update6.freebsd.org/to-10.4-RELEASE/i386/bp/1195d725efce75f0db6317f507d8a9514f35613c7466673a86db23100bd6fa77-c4150431df5b14b15546b3db5e30f2bd2c35d6d52812f057dc101fab20847324</A> - HIER_DIRECT/198.148.79.66 application/octet-stream
</I>&gt;<i> 
</I>&gt;<i> There cannot be 980593 bytes of headers? What kind of gigantic header
</I>&gt;<i> does it make?
</I>&gt;<i> 
</I>
That is header only between Squid and server (REFRESH_UNMODIFIED), with 
full object delivered to the client (final status &quot;200&quot;).

...
&gt;&gt;<i>
</I>&gt;&gt;<i> According to your pasted log and HTTP messages, the GET request URL that
</I>&gt;&gt;<i> resulted an &quot;X-Cache-Lookup: MISS&quot; response header does not match any of
</I>&gt;&gt;<i> the logged URLs; even the host part of the URL does not match.
</I>&gt;<i> 
</I>&gt;<i> Of course, there are just unrelated examples. There are thousands of
</I>&gt;<i> fetches from update*.freebsd.org
</I>
So you just posted them to waste everybody on this lists bandwidth? 
Thanks, and kind of ironic given your &quot;problem&quot;.

&gt;<i> 
</I>&gt;&gt;<i> To be sure that you are comparing apples to apples, you would need
</I>&gt;&gt;<i> to log the X-Cache-Lookup response header to access.log (or enable
</I>&gt;&gt;<i> ALL,2 debugging to see headers and/or collect packet traces).
</I>&gt;<i> 
</I>&gt;<i> I don't think the freebsd-update cares about the X-Cache-Lookup
</I>&gt;<i> response, I'm just trying to save bandwidth and don't quite like the
</I>&gt;<i> result.
</I>&gt;<i> 
</I>
The X-Cache* headers are debug output from Squid. Of course the updater 
software does not care about it ... you do, sort of anyway since it 
shows whether server bandwidth was involved. They do not show REFRESH, 
so MISS means a server was contacted for _something_ and HIT means local 
cache only was used.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016618.html">[squid-users] TCP_REFRESH_UNMODIFIEDs are really MISSes
</A></li>
	<LI>Next message (by thread): <A HREF="016620.html">[squid-users] TCP_REFRESH_UNMODIFIEDs are really MISSes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16619">[ date ]</a>
              <a href="thread.html#16619">[ thread ]</a>
              <a href="subject.html#16619">[ subject ]</a>
              <a href="author.html#16619">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
