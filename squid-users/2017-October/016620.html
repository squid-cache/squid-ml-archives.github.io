<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TCP_REFRESH_UNMODIFIEDs are really MISSes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_REFRESH_UNMODIFIEDs%20are%20really%20MISSes&In-Reply-To=%3C779c664f-a183-0519-fe25-9613fa31688e%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016619.html">
   <LINK REL="Next"  HREF="016634.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TCP_REFRESH_UNMODIFIEDs are really MISSes</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TCP_REFRESH_UNMODIFIEDs%20are%20really%20MISSes&In-Reply-To=%3C779c664f-a183-0519-fe25-9613fa31688e%40measurement-factory.com%3E"
       TITLE="[squid-users] TCP_REFRESH_UNMODIFIEDs are really MISSes">rousskov at measurement-factory.com
       </A><BR>
    <I>Wed Oct 11 14:49:50 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016619.html">[squid-users] TCP_REFRESH_UNMODIFIEDs are really MISSes
</A></li>
        <LI>Next message (by thread): <A HREF="016634.html">[squid-users] TCP_REFRESH_UNMODIFIEDs are really MISSes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16620">[ date ]</a>
              <a href="thread.html#16620">[ thread ]</a>
              <a href="subject.html#16620">[ subject ]</a>
              <a href="author.html#16620">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/11/2017 04:52 AM, Amos Jeffries wrote:
&gt;<i> On 11/10/17 23:31, Victor Sudakov wrote:
</I>&gt;&gt;<i> Alex Rousskov wrote:
</I>&gt;&gt;&gt;<i> To be sure that you are comparing apples to apples, you would need
</I>&gt;&gt;&gt;<i> to log the X-Cache-Lookup response header to access.log (or enable
</I>&gt;&gt;&gt;<i> ALL,2 debugging to see headers and/or collect packet traces).
</I>
&gt;&gt;<i> I don't think the freebsd-update cares about the X-Cache-Lookup
</I>&gt;&gt;<i> response, I'm just trying to save bandwidth and don't quite like the
</I>&gt;&gt;<i> result.
</I>
&gt;<i> The X-Cache* headers are debug output from Squid. [...]
</I>&gt;<i> MISS means a server was contacted for _something_ and HIT means local
</I>&gt;<i> cache only was used.
</I>

Here is a more accurate description of the X-Cache and X-Cache-Lookup
header fields:

X-Cache-Lookup:MISS means that Squid did not find the requested object
in its cache after parsing the client request, and X-Cache-Lookup:HIT
means that it did. In either case, the X-Cache-Lookup header field does
not tell us whether the server was contacted afterwards, although:

* X-Cache-Lookup:MISS implies that the server contact is very likely
(but various errors and other corner cases may prevent any server
contact) and

* X-Cache-Lookup:HIT implies that the server contact is less likely (but
client revalidation requests, stale cached responses, and other cases
make such contact possible).

* X-Cache-Lookup:NONE means that there was no cache lookup at all.
(Listed here for completeness sake)


There is also X-Cache header field, but its value is just a mapping of
the final(?) status code to HIT or MISS categories. In Squid v3.5, the
HIT category is assigned to TCP_HIT, TCP_IMS_HIT, TCP_INM_HIT,
TCP_REFRESH_FAIL_OLD, TCP_REFRESH_UNMODIFIED, TCP_NEGATIVE_HIT,
TCP_MEM_HIT, and TCP_OFFLINE_HIT statuses. The rest are categorized as
MISSes. The X-Cache header field does not tell us whether the server was
contacted.



To avoid misunderstanding, I have provided this information to help you
triage why Squid revalidates so much in your use case, and not to
justify Squid behavior or blame the freebsd-update client. You now know
what the logged status and the header values mean. And you now know that
you have to look at the same transaction to analyze the combination of
logged values and headers. If you want to know _why_ Squid does what it
does, the information Amos and I have provided may help you dig deeper.
Once you know &quot;why&quot;, you may be able to adjust Squid configuration (or
something else!) to reduce excessive revalidations.


HTH,

Alex.
P.S. If the above is not documented on Squid wiki, please consider
documenting it. Thank you in advance.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016619.html">[squid-users] TCP_REFRESH_UNMODIFIEDs are really MISSes
</A></li>
	<LI>Next message (by thread): <A HREF="016634.html">[squid-users] TCP_REFRESH_UNMODIFIEDs are really MISSes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16620">[ date ]</a>
              <a href="thread.html#16620">[ thread ]</a>
              <a href="subject.html#16620">[ subject ]</a>
              <a href="author.html#16620">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
