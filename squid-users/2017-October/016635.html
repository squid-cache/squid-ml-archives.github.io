<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Question about refresh_pattern and access time...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Question%20about%20refresh_pattern%20and%20access%20time...&In-Reply-To=%3Ca7b2383c-3851-fce3-25ee-53fcbed33914%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016632.html">
   <LINK REL="Next"  HREF="016629.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Question about refresh_pattern and access time...</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Question%20about%20refresh_pattern%20and%20access%20time...&In-Reply-To=%3Ca7b2383c-3851-fce3-25ee-53fcbed33914%40treenet.co.nz%3E"
       TITLE="[squid-users] Question about refresh_pattern and access time...">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Oct 12 14:14:57 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016632.html">[squid-users] Question about refresh_pattern and access time...
</A></li>
        <LI>Next message (by thread): <A HREF="016629.html">[squid-users] Squid not failing over to secondary DNS host
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16635">[ date ]</a>
              <a href="thread.html#16635">[ thread ]</a>
              <a href="subject.html#16635">[ subject ]</a>
              <a href="author.html#16635">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12/10/17 19:43, EdouardM wrote:
&gt;<i> Amos,
</I>&gt;<i> here is an example:
</I>&gt;<i> <A HREF="http://au.download.windowsupdate.com/d/msdownload/update/software/updt/2017/09/windows10.0-kb4023814-x86_f07f9708c76807b1b19545521f17d6e2fefdd627.cab">http://au.download.windowsupdate.com/d/msdownload/update/software/updt/2017/09/windows10.0-kb4023814-x86_f07f9708c76807b1b19545521f17d6e2fefdd627.cab</A>
</I>&gt;<i>    HTTP/1.1 200 OK
</I>&gt;<i>    Cache-Control: public,max-age=172800
</I>&gt;<i>    Content-Length: 6150968
</I>&gt;<i>    Content-Type: application/vnd.ms-cab-compressed
</I>&gt;<i>    Last-Modified: Wed, 27 Sep 2017 21:16:36 GMT
</I>&gt;<i>    Accept-Ranges: bytes
</I>&gt;<i>    ETag: &quot;09295e6d537d31:0&quot;
</I>&gt;<i>    Server: Microsoft-IIS/8.5
</I>&gt;<i>    X-Powered-By: ASP.NET
</I>&gt;<i>    X-CID: 7
</I>&gt;<i>    X-CCC: IN
</I>&gt;<i>    X-MSEdge-Ref: Ref A: 7A93444FAE0B4491BE72E049496DEC25 Ref B: BOM02EDGE0119
</I>&gt;<i> Ref C: 2017-10-12T06:36:40Z
</I>&gt;<i>    X-MSEdge-Ref-OriginShield: Ref A: C8FD899B17694B8AA6641257C2636B9B Ref B:
</I>&gt;<i> BOM01EDGE0318 Ref C: 2017-10-11T14:02:56Z
</I>&gt;<i>    Date: Thu, 12 Oct 2017 06:36:40 GMT
</I>&gt;<i> Length: 6150968 (5.9M) [application/vnd.ms-cab-compressed]
</I>&gt;<i> 
</I>&gt;<i> does it mean the object will be valid for 2 days (max-age=172800) only, then
</I>&gt;<i> the Squid will download a fresh copy from internet even if we set the
</I>&gt;<i> refresh_pattern to 1 month ?
</I>
CC:max-age=172800 means it can be served unconditionally from cache for 
172800 seconds from Date: Thu, 12 Oct 2017 06:36:40 GMT.

After Sat, 14 Oct 2017 06:36:40 GMT (Date + CC:max-age) it is stale and 
needs revalidating before any use. The headers from the revalidation 
response will alter the above headers to provide new values for Date and 
maybe other bits.

Altering Date naturally alters the base time for the max-age freshness 
calculation. So it should be served unconditionally for the next 48hrs 
from time of revalidation. Rinse and repeat. **

refresh_pattern is irrelevant here because all the necessary algorithm 
parameters for exact expiry (Date and CC:max-age) are provided by that 
server.


** NP: that is what should happen anyway, modulo bugs in Squid 
calculations or admin configuration settings to force other behaviour.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016632.html">[squid-users] Question about refresh_pattern and access time...
</A></li>
	<LI>Next message (by thread): <A HREF="016629.html">[squid-users] Squid not failing over to secondary DNS host
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16635">[ date ]</a>
              <a href="thread.html#16635">[ thread ]</a>
              <a href="subject.html#16635">[ subject ]</a>
              <a href="author.html#16635">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
