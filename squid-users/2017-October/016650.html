<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid slow down after awhile
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20slow%20down%20after%20awhile&In-Reply-To=%3CCAJeef3jAweLJtQqn4k3NcKR7v2LzT50mow1UHjssyq%2BC90ifwQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016648.html">
   <LINK REL="Next"  HREF="016651.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid slow down after awhile</H1>
    <B>masoud mazarei</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20slow%20down%20after%20awhile&In-Reply-To=%3CCAJeef3jAweLJtQqn4k3NcKR7v2LzT50mow1UHjssyq%2BC90ifwQ%40mail.gmail.com%3E"
       TITLE="[squid-users] Squid slow down after awhile">msd.mazarei at gmail.com
       </A><BR>
    <I>Sat Oct 14 10:03:03 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016648.html">[squid-users] Squid slow down after awhile
</A></li>
        <LI>Next message (by thread): <A HREF="016651.html">[squid-users] Squid slow down after awhile
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16650">[ date ]</a>
              <a href="thread.html#16650">[ thread ]</a>
              <a href="subject.html#16650">[ subject ]</a>
              <a href="author.html#16650">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>TCP ESTABLISHED=54
TCP SYNC/WAIT/FIN=0

FD limitation=64000
net.core.rmem_max = 33554432
net.core.wmem_max = 33554432
net.ipv4.tcp_rmem = 4096 87380 33554432
net.ipv4.tcp_wmem = 4096 65536 33554432
net.ipv4.tcp_window_scaling=1
net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_mem = 50576   64768   98152
net.core.netdev_max_backlog = 2500
net.ipv4.netfilter.ip_conntrack_max = 1048576
net.ipv4.ip_local_port_range = 18000    65535

CISCO TCAM 10 mac learned(cache server mac,gateway mac ...)

no forward loop
no error in cache.log and syslog
iptables totaly have 10 rows in all chains. and no mem usage which affects
os and machine
and i have only 1 user behind cache server.
also i have checked with many users behind cache but no differ in result.
i have same problem with squid 3.5 and squid 3.1




On Sat, Oct 14, 2017 at 12:36 PM, Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
wrote:

&gt;<i> On 13/10/17 22:09, masoud mazarei wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> I setup squid as traspsrent proxy with wccp configuration(layer 2).
</I>&gt;&gt;<i> All things work propery but after awhile it slows down.
</I>&gt;&gt;<i> I try to findout whats going to happen using tcpdump
</I>&gt;&gt;<i> And i know packets have delay to go out from squid machine. And I guess
</I>&gt;&gt;<i> it may happened cause of tproxy config of linux kernel then i check linux
</I>&gt;&gt;<i> kernel tproxy with
</I>&gt;&gt;<i> <A HREF="https://github.com/LiamHaworth/go-tproxy">https://github.com/LiamHaworth/go-tproxy</A>
</I>&gt;&gt;<i> And there is not delay to send packet out. All things work correctly with
</I>&gt;&gt;<i> no delay. but when I stsrt to use squid after awhile I have delay in packet
</I>&gt;&gt;<i> sending.
</I>&gt;&gt;<i> Whats your opinion?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i> Insufficient data:
</I>&gt;<i>
</I>&gt;<i> * Check you WCCP TCAM table size.
</I>&gt;<i>
</I>&gt;<i> * Check your iptables/netfilter memory usage and table capacities.
</I>&gt;<i>
</I>&gt;<i> * Check your available TCP ports.
</I>&gt;<i>
</I>&gt;<i> * Check your Squid machines per-process FD limitations. As viewed by the
</I>&gt;<i> OS and what Squid thinks are available.
</I>&gt;<i>
</I>&gt;<i> * Check for forwarding loops (set 'via on' in squid.conf).
</I>&gt;<i>
</I>&gt;<i> * Check your logs for any issues that may be reported. Especially squid
</I>&gt;<i> cache.log and OS system log.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>


-- 
Yours Sincerely
Masoud Mazarei
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20171014/d520704e/attachment.htm">http://lists.squid-cache.org/pipermail/squid-users/attachments/20171014/d520704e/attachment.htm</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016648.html">[squid-users] Squid slow down after awhile
</A></li>
	<LI>Next message (by thread): <A HREF="016651.html">[squid-users] Squid slow down after awhile
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16650">[ date ]</a>
              <a href="thread.html#16650">[ thread ]</a>
              <a href="subject.html#16650">[ subject ]</a>
              <a href="author.html#16650">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
