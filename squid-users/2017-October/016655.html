<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Question about: ext_session_acl Splash/Portal solution.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Question%20about%3A%20ext_session_acl%20Splash/Portal%0A%20solution.&In-Reply-To=%3C20171015201733.Horde.Wc7rCYoHpdMV8ZC3tsQfvio%40buero.tachtler.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016653.html">
   <LINK REL="Next"  HREF="016662.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Question about: ext_session_acl Splash/Portal solution.</H1>
    <B>Klaus Tachtler</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Question%20about%3A%20ext_session_acl%20Splash/Portal%0A%20solution.&In-Reply-To=%3C20171015201733.Horde.Wc7rCYoHpdMV8ZC3tsQfvio%40buero.tachtler.net%3E"
       TITLE="[squid-users] Question about: ext_session_acl Splash/Portal solution.">klaus at tachtler.net
       </A><BR>
    <I>Sun Oct 15 18:17:33 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016653.html">[squid-users] Question about: ext_session_acl Splash/Portal solution.
</A></li>
        <LI>Next message (by thread): <A HREF="016662.html">[squid-users] Question about: ext_session_acl Splash/Portal solution.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16655">[ date ]</a>
              <a href="thread.html#16655">[ thread ]</a>
              <a href="subject.html#16655">[ subject ]</a>
              <a href="author.html#16655">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Amos,

after a little bit more testing, of course I must agree with you, it  
doesn't work as expected.

Please can you give me another advice? Where is my fault?

I tried to use the *ACTIVE* example from the squid documentation and  
modified it a little bit on 3 parts of the code, BUT a LOOP are still  
there!

<A HREF="https://wiki.squid-cache.org/ConfigExamples/Portal/Splash#Squid_Configuration_File_-_Active_Mode">https://wiki.squid-cache.org/ConfigExamples/Portal/Splash#Squid_Configuration_File_-_Active_Mode</A>

--- code ---

# Set up the session helper in active mode. Mind the wrap - this is  
one line: - *MODIFIED* - (all in one line)
external_acl_type session concurrency=100 ttl=3 negative_ttl=0  
children-max=1 %LOGIN /usr/lib64/squid/ext_session_acl -a -T 60 -b  
/var/lib/squid/sessions/

# Pass the LOGIN command to the session helper with this ACL
acl session_login external session LOGIN

# Normal session ACL as per simple example
acl session_is_active external session

# ACL to match URL - *MODIFIED* -
acl clicked_login_url url_regex -i <A HREF="http://my.pages.net/html/accept.php">http://my.pages.net/html/accept.php</A>

# First check for the login URL. If present, login session
http_access allow clicked_login_url session_login

# If we get here, URL not present, so renew session or deny request.
http_access deny !session_is_active

# Deny page to display - *MODIFIED* - NOT using a template with HTML-Code 511!
deny_info <A HREF="http://my.pages.net/html/splash.php?url=%u">http://my.pages.net/html/splash.php?url=%u</A> session_is_active

--- code ---

If you want, I can share the code from the pages
- <A HREF="http://my.pages.net/html/accept.php">http://my.pages.net/html/accept.php</A>
- <A HREF="http://my.pages.net/html/splash.php?url=%u">http://my.pages.net/html/splash.php?url=%u</A>
too?

The idea behind the two PHP pages are, to store the original URL with  
the splash.php inside a PHP session and make a redirect inside the  
accept.php to the original URL.


Thank you for your time and your patience with me!
Klaus.

&gt;<i> On 15/10/17 10:02, Klaus Tachtler wrote:
</I>&gt;&gt;<i> Hi Amos,
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On 14/10/17 04:40, Klaus Tachtler wrote:&gt;
</I>&gt;&gt;&gt;&gt;<i> Why I'm on a loop between splash page and accept page?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> You have two *separate* active (-a) session contexts going on  
</I>&gt;&gt;&gt;<i> simultaneously. They are both fighting over the session database.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Oh my god, to delete &quot;-a&quot; on the &quot;session_active_def&quot; was the solution.
</I>&gt;&gt;<i> I was searching hours and hours for that!
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thank you so much for the simple line you wrote to me!
</I>&gt;<i>
</I>&gt;<i> If that is the only change you made it is still not solved either,  
</I>&gt;<i> your sessions will never end.
</I>&gt;<i>
</I>&gt;<i> You need *one* session. You get to pick active or passive:
</I>&gt;<i>
</I>&gt;<i> * Active has specific ACLs for LOGIN/LOGOUT/test.
</I>&gt;<i>  - for when the clicked URL just *has* to be the specific one.
</I>&gt;<i>
</I>&gt;<i> * Passive has only one ACL for atomic test+login.
</I>&gt;<i>  - for when either click OR refresh OR any other page fetch is  
</I>&gt;<i> enough to continue.
</I>&gt;<i>  - every test of the ACL updates the session timestamp not to expire.
</I>&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

----- Ende der Nachricht von Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt; -----




-- 

------------------------------------------
e-Mail  : <A HREF="https://lists.squid-cache.org/listinfo/squid-users">klaus at tachtler.net</A>
Homepage: <A HREF="http://www.tachtler.net">http://www.tachtler.net</A>
DokuWiki: <A HREF="http://www.dokuwiki.tachtler.net">http://www.dokuwiki.tachtler.net</A>
------------------------------------------
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-keys
Size: 3120 bytes
Desc: ?ffentlicher PGP-Schl?ssel
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20171015/6f44c6b3/attachment.key">http://lists.squid-cache.org/pipermail/squid-users/attachments/20171015/6f44c6b3/attachment.key</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016653.html">[squid-users] Question about: ext_session_acl Splash/Portal solution.
</A></li>
	<LI>Next message (by thread): <A HREF="016662.html">[squid-users] Question about: ext_session_acl Splash/Portal solution.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16655">[ date ]</a>
              <a href="thread.html#16655">[ thread ]</a>
              <a href="subject.html#16655">[ subject ]</a>
              <a href="author.html#16655">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
