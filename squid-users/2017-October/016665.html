<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Is it safe to resize a rock storage file?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Is%20it%20safe%20to%20resize%20a%20rock%20storage%20file%3F&In-Reply-To=%3C9d6a4fa1-6431-3699-ce5e-68befd530777%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016663.html">
   <LINK REL="Next"  HREF="016668.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Is it safe to resize a rock storage file?</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Is%20it%20safe%20to%20resize%20a%20rock%20storage%20file%3F&In-Reply-To=%3C9d6a4fa1-6431-3699-ce5e-68befd530777%40measurement-factory.com%3E"
       TITLE="[squid-users] Is it safe to resize a rock storage file?">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Oct 16 18:05:07 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016663.html">[squid-users] Is it safe to resize a rock storage file?
</A></li>
        <LI>Next message (by thread): <A HREF="016668.html">[squid-users] Is it safe to resize a rock storage file?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16665">[ date ]</a>
              <a href="thread.html#16665">[ thread ]</a>
              <a href="subject.html#16665">[ subject ]</a>
              <a href="author.html#16665">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/16/2017 09:23 AM, Amos Jeffries wrote:

&gt;<i> The -z process for
</I>&gt;<i> rock caches actively formats the file used for data storage into cells
</I>&gt;<i> and blocks. 
</I>
Not really. &quot;squid -z&quot; adds a small db header, but the rest of the
database is assumed to be nothing but zeros. Squid -z used to fill the
whole db file with zeros (see SLOWLY_FILL_WITH_ZEROS), but I believe we
stopped doing that (by default) and expect an &quot;enlarging truncate&quot; to
have the same side effect. The comit log may have more info about that.


&gt;<i> Changing its size manually will definitely lead to some form
</I>&gt;<i> of corruption.
</I>
What makes you think that? Bugs notwithstanding, there are three cases
to consider AFAICT:

* Adding a partial empty slot should be a no-op because Squid will not
notice the added space after rounding the number of slots down.

* Adding a full all-zeros slot will not affect any data already stored
in the database -- nothing will point to that new slot. It will be used
for new cache entries.

* Removing a slot, whole or partial, will invalidate the cache entry
that was using that slot (if any). The affected entry will not be added
to the shared memory index. Skipping an entry should not lead to cache
corruption. It will lead to loss of cache data (and probably some
warnings) but that was explicitly allowed in the original question.

Please let me know if I missed something or if there are reasons to
believe there are bugs affecting the above logic.


Thank you,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016663.html">[squid-users] Is it safe to resize a rock storage file?
</A></li>
	<LI>Next message (by thread): <A HREF="016668.html">[squid-users] Is it safe to resize a rock storage file?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16665">[ date ]</a>
              <a href="thread.html#16665">[ thread ]</a>
              <a href="subject.html#16665">[ subject ]</a>
              <a href="author.html#16665">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
