<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Pseudo proxy authentication (mapping of IP address to user name) in intercept mode.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Pseudo%20proxy%20authentication%20%28mapping%20of%20IP%0A%20address%20to%20user%20name%29%20in%20intercept%20mode.&In-Reply-To=%3CAM6PR0402MB3576D5CC21B56FFA79225A8D8F4C0%40AM6PR0402MB3576.eurprd04.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016676.html">
   <LINK REL="Next"  HREF="016674.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Pseudo proxy authentication (mapping of IP address to user name) in intercept mode.</H1>
    <B>Rafael Akchurin</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Pseudo%20proxy%20authentication%20%28mapping%20of%20IP%0A%20address%20to%20user%20name%29%20in%20intercept%20mode.&In-Reply-To=%3CAM6PR0402MB3576D5CC21B56FFA79225A8D8F4C0%40AM6PR0402MB3576.eurprd04.prod.outlook.com%3E"
       TITLE="[squid-users] Pseudo proxy authentication (mapping of IP address to user name) in intercept mode.">rafael.akchurin at diladele.com
       </A><BR>
    <I>Tue Oct 17 21:00:41 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016676.html">[squid-users] Pseudo proxy authentication (mapping of IP address to user name) in intercept mode.
</A></li>
        <LI>Next message (by thread): <A HREF="016674.html">[squid-users] Fwd: ftp-relay squestion
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16678">[ date ]</a>
              <a href="thread.html#16678">[ thread ]</a>
              <a href="subject.html#16678">[ subject ]</a>
              <a href="author.html#16678">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ok thanks again Amos.

The plan is then: 

- external acl helper gets the SRC and connects to REST server running on AD DC with IP &lt;-&gt; user mapping database
- replies with OK user=&lt;name&gt;
- this name get's delivered to access log and ICAP/eCAP
- (optional) we are able to match the user to security group and apply designated filtering policy in our ICAP server.

Written above seems to work in the test lab.

Best regards,
Rafael Akchurin
Diladele B.V.

-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Amos Jeffries
Sent: Tuesday, October 17, 2017 3:54 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Pseudo proxy authentication (mapping of IP address to user name) in intercept mode.

On 17/10/17 22:39, Rafael Akchurin wrote:
&gt;<i> Hello everyone,
</I>&gt;<i> 
</I>&gt;<i> I would like to get your opinions on the subject.
</I>&gt;<i> 
</I>&gt;<i> *Problem*: admin needs to manage squid acls (and icap web filter
</I>&gt;<i> settings) using security groups from Active Directory. For 
</I>&gt;<i> non-technical reasons, setup of explicit proxy settings and thus 
</I>&gt;<i> enforcing proxy authentication on Squid is not possible.
</I>&gt;<i> 
</I>&gt;<i> *Solution*:
</I>&gt;<i> 
</I>&gt;<i> 1.Deploy some agent on domain controller that would periodically 
</I>&gt;<i> enumerate workstation IPs and get currently logged on users by WMI or 
</I>&gt;<i> something like this. This is fine and already working in our project 
</I>&gt;<i> at <A HREF="https://github.com/diladele/active-directory-inspector">https://github.com/diladele/active-directory-inspector</A>
</I>&gt;<i> 
</I>&gt;<i> 2.Let Squid somehow use the remote running inspector to match the IP 
</I>&gt;<i> address to user names (and expose the user name to ICAP eventually). 
</I>&gt;<i> May be anyone knows the type of helper/acl/annotation that needs to be 
</I>&gt;<i> in running/configured on the Squid box?
</I>&gt;<i> 
</I>
That kind of authorization is the purpose of the session and LDAP external ACL helpers. Though AFAIK neither of them uses the AD interface (YMMV if the Perl DB module can use AD as an SQL-like database).

You might be able to also be use the Basic auth LDAP helper from Squid-3.4+ as an external ACL helper. It will require some fiddling of the LDAP parameters and the ACL input format to make the external ACL input into the Basic-auth lookup.

Amos
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016676.html">[squid-users] Pseudo proxy authentication (mapping of IP address to user name) in intercept mode.
</A></li>
	<LI>Next message (by thread): <A HREF="016674.html">[squid-users] Fwd: ftp-relay squestion
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16678">[ date ]</a>
              <a href="thread.html#16678">[ thread ]</a>
              <a href="subject.html#16678">[ subject ]</a>
              <a href="author.html#16678">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
