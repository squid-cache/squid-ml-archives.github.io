<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] External user cant access web server
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20External%20user%20cant%20access%20web%20server&In-Reply-To=%3Cfdcf6916-cc0c-f263-6502-d56d3875794e%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016672.html">
   <LINK REL="Next"  HREF="016673.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] External user cant access web server</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20External%20user%20cant%20access%20web%20server&In-Reply-To=%3Cfdcf6916-cc0c-f263-6502-d56d3875794e%40treenet.co.nz%3E"
       TITLE="[squid-users] External user cant access web server">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Oct 19 11:37:01 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016672.html">[squid-users] External user cant access web server
</A></li>
        <LI>Next message (by thread): <A HREF="016673.html">[squid-users] Pseudo proxy authentication (mapping of IP address to user name) in intercept mode.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16694">[ date ]</a>
              <a href="thread.html#16694">[ thread ]</a>
              <a href="subject.html#16694">[ subject ]</a>
              <a href="author.html#16694">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 17/10/17 21:56, hoje wrote:
&gt;<i> Hi Mr.Amos,
</I>&gt;<i> 
</I>&gt;<i> Thank you for helping in my previous post. I have a question. I&#8217;ve tried the
</I>&gt;<i> same squid.conf setup to a new topology, and it works only for all internal
</I>&gt;<i> users. But, external users that want to access my public web server, will
</I>&gt;<i> get an access denied error (&#8217;The requested URL could not be retrieved&#8217;).
</I>&gt;<i> Anything that i need to do to fix this problem? Please advice. Thank you
</I>&gt;<i> again.
</I>&gt;<i> 
</I>&gt;<i> My setup
</I>&gt;<i> &#8212;&#8212;&#8212;
</I>&gt;<i> debian 9, squid-3.5.26-20170702-r14182
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Old topology (that works)
</I>&gt;<i> &#8212;&#8212;&#8212;&#8212;
</I>&gt;<i> WAN +--&gt;RT+&#8212;&gt;(linux+SQUID+bridge)&#8212;&gt;SW+---&gt; INT USER
</I>&gt;<i> 
</I>
What are the WAN users supposed to be accessing in this &quot;working&quot; topology?
  ( the &quot;-&gt;&quot; indicates request flow).

&gt;<i> 
</I>&gt;<i> New topology (ext user can&#8217;t access my web server)
</I>&gt;<i> &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;
</I>&gt;<i> WAN +--&gt;RT+&#8212;&gt;(linux+SQUID+bridge)+&#8212;&gt; FW+---&gt; SW+---&gt; INT USER
</I>&gt;<i>                                                                       +
</I>&gt;<i>                                                                       |
</I>&gt;<i>                                                                       v
</I>&gt;<i>                                                                  DMZ SW
</I>&gt;<i>                                                                      +
</I>&gt;<i>                                                                      |
</I>&gt;<i>                                                                      v
</I>&gt;<i>                                                                 WEB SRV
</I>
You seem to be describing WAN users accessing internal user accounts, 
which relay to internal web server. That right ?


&gt;<i> My squid.conf
</I>&gt;<i> &#8212;&#8212;&#8212;&#8212;&#8212;
</I>&gt;<i> <A HREF="https://pastebin.com/AbU6nihK">https://pastebin.com/AbU6nihK</A>
</I>&gt;<i> 
</I>
This config only permits the LAN 10/8, fe80::/16, and fc00::/16 ranges - 
though the ports are IPv4-only so those IPv6 ranges cannot even connect 
in the first place.

To run Squid as a gateway for an internal server you need an accel port, 
cache_peer and http_access + cache_peer_access to permit access to the 
hosted domains.
  see 
&lt;<A HREF="https://wiki.squid-cache.org/ConfigExamples/Reverse/BasicAccelerator">https://wiki.squid-cache.org/ConfigExamples/Reverse/BasicAccelerator</A>&gt; 
and &lt;<A HREF="https://wiki.squid-cache.org/ConfigExamples/Reverse/VirtualHosting">https://wiki.squid-cache.org/ConfigExamples/Reverse/VirtualHosting</A>&gt;



Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016672.html">[squid-users] External user cant access web server
</A></li>
	<LI>Next message (by thread): <A HREF="016673.html">[squid-users] Pseudo proxy authentication (mapping of IP address to user name) in intercept mode.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16694">[ date ]</a>
              <a href="thread.html#16694">[ thread ]</a>
              <a href="subject.html#16694">[ subject ]</a>
              <a href="author.html#16694">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
