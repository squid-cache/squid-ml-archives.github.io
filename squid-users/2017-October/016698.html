<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] [SOLVED] Re: Question about: ext_session_acl Splash/Portal solution.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5BSOLVED%5D%20Re%3A%20Question%20about%3A%20ext_session_acl%0A%20Splash/Portal%20solution.&In-Reply-To=%3C20171019160903.Horde.k5iyBuQVqYpGjOu67Mxeohw%40buero.tachtler.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016697.html">
   <LINK REL="Next"  HREF="016700.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] [SOLVED] Re: Question about: ext_session_acl Splash/Portal solution.</H1>
    <B>Klaus Tachtler</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20%5BSOLVED%5D%20Re%3A%20Question%20about%3A%20ext_session_acl%0A%20Splash/Portal%20solution.&In-Reply-To=%3C20171019160903.Horde.k5iyBuQVqYpGjOu67Mxeohw%40buero.tachtler.net%3E"
       TITLE="[squid-users] [SOLVED] Re: Question about: ext_session_acl Splash/Portal solution.">klaus at tachtler.net
       </A><BR>
    <I>Thu Oct 19 14:09:03 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016697.html">[squid-users] [SOLVED] Re: Question about: ext_session_acl Splash/Portal solution.
</A></li>
        <LI>Next message (by thread): <A HREF="016700.html">[squid-users] [SOLVED] Re: Question about: ext_session_acl Splash/Portal solution.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16698">[ date ]</a>
              <a href="thread.html#16698">[ thread ]</a>
              <a href="subject.html#16698">[ subject ]</a>
              <a href="author.html#16698">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Amos,

&gt;<i> On 20/10/17 00:47, Klaus Tachtler wrote:
</I>&gt;&gt;<i> Hi Amos,
</I>&gt;&gt;<i> hi list,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I found my problem and the solution for it. The problem was inside  
</I>&gt;&gt;<i> the apache host, who is holding my accept.php page. The splash.php  
</I>&gt;&gt;<i> and accept.php page had some problems too, but now it's working.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> For my solution, see following link (sorry the description are only  
</I>&gt;&gt;<i> in German language available):
</I>&gt;&gt;<i> -  
</I>&gt;&gt;<i> <A HREF="https://www.dokuwiki.tachtler.net/doku.php?id=tachtler:squid_centos_7#portal_splash_pages">https://www.dokuwiki.tachtler.net/doku.php?id=tachtler:squid_centos_7#portal_splash_pages</A>
</I>&gt;<i>
</I>&gt;<i> I'm not quite following from the Google-translate of that page what  
</I>&gt;<i> you mean. Was it a PHP specific issue, or something(s) that you  
</I>&gt;<i> think we should warn others about in our wiki Splash config example?
</I>&gt;<i>  If the latter, please propose some text to add to the wiki about it.
</I>&gt;<i>
</I>
On my first splash.php I was trying to redirect the url with  
splash.php?url=%u - that was one of the the problems with the loop  
between splash.php and accept.php - because the browser could not  
fullfill the request - because of a loop.

--- splash.php - NOT WORKING ---

&lt;?php
session_start();
$_SESSION[&quot;goto&quot;] = htmlspecialchars($_GET[&quot;url&quot;]);
?&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01//EN&quot;  
&quot;<A HREF="http://www.w3.org/TR/html4/strict.dtd">http://www.w3.org/TR/html4/strict.dtd</A>&quot;&gt;
... and so on ...

--- splash.php - NOT WORKING ---

--- accept.php - NOT WORKING ---

&lt;?php
session_start();
header(&quot;Location: &quot; . $_SESSION[&quot;goto&quot;] ); /* Browser umleiten */
session_unset();
session_destroy();
exit;
?&gt;
&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;

--- accept.php - NOT WORKING ---

&gt;<i>
</I>&gt;<i> The config files I see in that page contains some configuration  
</I>&gt;<i> lines I am trying to get people to stop doing:
</I>
I will delete the problematic lines from my configuration example. BUT  
fist I will read the documentation again, to understand what I'm doing.

By the way, I don't use it in my small family production environment,  
I was doing that only for testing an learning, how MITM could be done.

I respect the privacy of my family, so I wouldn't use it productively.

&gt;<i>  &quot;always_direct allow all&quot; - was an old hack that is no longer  
</I>&gt;<i> needed for SSL-Bump. Mentioning it adds confusion for people who  
</I>&gt;<i> dont understand the directive already - and those who know about its  
</I>&gt;<i> meaning should know whether they need it or not.
</I>&gt;<i>
</I>&gt;<i>  &quot;sslproxy_cert_error allow all&quot; - PLEASE don't even mention doing  
</I>&gt;<i> &quot;allow all&quot; on this directive. It prevents debugging problems and  
</I>&gt;<i> even worse adds many major security vulnerabilities in production  
</I>&gt;<i> proxies. So just dont.
</I>&gt;<i>  If you need to mention the directive at all, please do so in terms  
</I>&gt;<i> of specific errors which are relatively harmless to ignore. (if  
</I>&gt;<i> there is no safely ignored error for the use-case, then this  
</I>&gt;<i> directive is not safe to use obviously).
</I>&gt;<i>
</I>&gt;<i>  &quot;sslproxy_flags DONT_VERIFY_PEER&quot; - just no. This disables TLS  
</I>&gt;<i> security checks. Period. like the above it prevents debugging  
</I>&gt;<i> problems and even worse adds many major security vulnerabilities in  
</I>&gt;<i> production proxies. So just dont. And please pass that advice to  
</I>&gt;<i> others you find doing this as well - this setting really cannot die  
</I>&gt;<i> fast enough.
</I>&gt;<i>
</I>&gt;<i> The system trusted CA should work for most servers. Main cause of  
</I>&gt;<i> errors is admin not updating their system CA certs list regularly  
</I>&gt;<i> enough. Next most common is really broken servers - for those you  
</I>&gt;<i> can add entries to the files loaded by:
</I>&gt;<i>
</I>&gt;<i>  * Squid-3.4 and older add any missing CA with  
</I>&gt;<i> &lt;<A HREF="http://www.squid-cache.org/Doc/config/sslproxy_cafile/">http://www.squid-cache.org/Doc/config/sslproxy_cafile/</A>&gt; as necessary.
</I>&gt;<i>
</I>&gt;<i>  * Squid-3.5 add intermediate CA (most common cert error situation)  
</I>&gt;<i> to  
</I>&gt;<i> &lt;<A HREF="http://www.squid-cache.org/Doc/config/sslproxy_foreign_intermediate_certs/">http://www.squid-cache.org/Doc/config/sslproxy_foreign_intermediate_certs/</A>&gt;  
</I>&gt;<i> and root CA (if any) to  
</I>&gt;<i> &lt;<A HREF="http://www.squid-cache.org/Doc/config/sslproxy_cafile/">http://www.squid-cache.org/Doc/config/sslproxy_cafile/</A>&gt; as necessary.
</I>&gt;<i>
</I>&gt;<i> * Squid-4 should auto-fetch the missing intermediates. So you should  
</I>&gt;<i> only need to add trust for some occasional root CA to  
</I>&gt;<i> &lt;<A HREF="http://www.squid-cache.org/Doc/config/sslproxy_foreign_intermediate_certs/">http://www.squid-cache.org/Doc/config/sslproxy_foreign_intermediate_certs/</A>&gt;.
</I>&gt;<i>
</I>&gt;<i> It should be obvious, but to be very clear all of the above CA  
</I>&gt;<i> loading options should *only* be done for CA certs which you  
</I>&gt;<i> actually trust. Letting the client hit CA cert errors for dangerous  
</I>&gt;<i> CA is a *good* thing - that is precisely the point of having CA  
</I>&gt;<i> certs in TLS.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thank you Amos, for your patience and help!
</I>&gt;&gt;<i> Klaus.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> You are very welcome. :-)
</I>&gt;<i>
</I>&gt;<i> Amos
</I>
Thank you so much for your help and reading my DokuWiki to make it better!
Klaus.


-- 

------------------------------------------
e-Mail  : <A HREF="https://lists.squid-cache.org/listinfo/squid-users">klaus at tachtler.net</A>
Homepage: <A HREF="http://www.tachtler.net">http://www.tachtler.net</A>
DokuWiki: <A HREF="http://www.dokuwiki.tachtler.net">http://www.dokuwiki.tachtler.net</A>
------------------------------------------
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-keys
Size: 3120 bytes
Desc: ?ffentlicher PGP-Schl?ssel
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20171019/be92f122/attachment.key">http://lists.squid-cache.org/pipermail/squid-users/attachments/20171019/be92f122/attachment.key</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016697.html">[squid-users] [SOLVED] Re: Question about: ext_session_acl Splash/Portal solution.
</A></li>
	<LI>Next message (by thread): <A HREF="016700.html">[squid-users] [SOLVED] Re: Question about: ext_session_acl Splash/Portal solution.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16698">[ date ]</a>
              <a href="thread.html#16698">[ thread ]</a>
              <a href="subject.html#16698">[ subject ]</a>
              <a href="author.html#16698">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
