<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid 3.5.20 and 3.1.23 getting re-started with bogus &quot;FATAL: Bungled&quot; acls
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.20%20and%203.1.23%20getting%20re-started%20with%0A%20bogus%20%22FATAL%3A%20Bungled%22%20acls&In-Reply-To=%3C7be2afb8-5785-d895-6eff-7245196f50b0%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016685.html">
   <LINK REL="Next"  HREF="016702.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid 3.5.20 and 3.1.23 getting re-started with bogus &quot;FATAL: Bungled&quot; acls</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%203.5.20%20and%203.1.23%20getting%20re-started%20with%0A%20bogus%20%22FATAL%3A%20Bungled%22%20acls&In-Reply-To=%3C7be2afb8-5785-d895-6eff-7245196f50b0%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid 3.5.20 and 3.1.23 getting re-started with bogus &quot;FATAL: Bungled&quot; acls">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Oct 19 14:11:05 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016685.html">[squid-users] Squid 3.5.20 and 3.1.23 getting re-started with bogus &quot;FATAL: Bungled&quot; acls
</A></li>
        <LI>Next message (by thread): <A HREF="016702.html">[squid-users] Squid 3.5.20 and 3.1.23 getting re-started with bogus &quot;FATAL: Bungled&quot; acls
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16699">[ date ]</a>
              <a href="thread.html#16699">[ thread ]</a>
              <a href="subject.html#16699">[ subject ]</a>
              <a href="author.html#16699">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 19/10/17 03:33, Francisco Amaro wrote:
&gt;<i> Hi all,
</I>&gt;<i> 
</I>&gt;<i> So, we've been (slowly) investigating this issue these past days, and 
</I>&gt;<i> have reached some conclusions.
</I>&gt;<i> 
</I>&gt;<i> a) First, and sorry for not being clear on that, this only happens on 
</I>&gt;<i> &quot;squid reload&quot;, not on full stop/start cycles.
</I>&gt;<i> A full start cycle does not give this error, that's why we are pretty 
</I>&gt;<i> sure the issue is not a bungled ACL, per se.
</I>
That is unfortunately not a guarantee of success. squid.conf and files 
it refers to can be changed while Squid is running and have no effect 
until next reload happens.

Also what system infrastructure is running this &quot;squid reload&quot; command?

The correct commands to reload squid.conf are &quot;squid -k reconfigure&quot; 
[just reload] or &quot;squid -k check&quot; [validate then reload *if* it passes]. 
Any other system scripts or processes (eg systemd or openrc, or upstart) 
trying to manage Squid may be adding bugs of its own.


&gt;<i> 
</I>&gt;<i> b) Besides that, it only happens when the proxy has some load on it, we 
</I>&gt;<i> have been unable to reproduce this on
</I>&gt;<i> our test machines, since they do not have a significant load. We've been 
</I>&gt;<i> postponing our ACL's changes for
</I>&gt;<i> early morning/lunch-hour these past days, and we didn't have had a FATAL 
</I>&gt;<i> error since last week.
</I>&gt;<i> 
</I>&gt;<i> c) Although we don't have non US-ASCII on the ACL's themselves, we have 
</I>&gt;<i> a lot of them on comments, so
</I>&gt;<i> I've stripped down all the comments of the ACL's files and tried that on 
</I>&gt;<i> our test bed, it didn't generare any
</I>&gt;<i> kind of errors, but since they do not have some load on it, we are not 
</I>&gt;<i> sure if it was the comments stripping
</I>&gt;<i> or the lack of load on the server...
</I>
Filtering the config down to 7-bit / US-ASCII characters is a very good 
idea. We have done a bunch of work making Squid handle UTF-8, but the 
config file is one are where that is far from complete so the behaviour 
is unpredictable.

I do know that a Unicode character at the end of a line or Windows / 
MacOS line terminators have been known to cause admin a lot of headaches.


&gt;<i> 
</I>&gt;<i> So, we are now searching for an &quot;easy&quot; way of generating traffic on a 
</I>&gt;<i> squid server, so we can, at least, be
</I>&gt;<i> able to reproduce the error, so we can try the different solutions....
</I>&gt;<i> 
</I>

The Squid dev team tend to use Apache Bench (&quot;ab&quot; tool) to generate lots 
of simple transactions very fast if the same URL repeatedly is 
sufficient for the test or caching is disabled.
   Or a tool called Polygraph if the URLs have to be variable and 
stressing all sorts of cache and post-cache logic.

I believe there are also tools that can take a feed of web traffic and 
replay it. But I have not had to use any of those yet on Squid.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016685.html">[squid-users] Squid 3.5.20 and 3.1.23 getting re-started with bogus &quot;FATAL: Bungled&quot; acls
</A></li>
	<LI>Next message (by thread): <A HREF="016702.html">[squid-users] Squid 3.5.20 and 3.1.23 getting re-started with bogus &quot;FATAL: Bungled&quot; acls
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16699">[ date ]</a>
              <a href="thread.html#16699">[ thread ]</a>
              <a href="subject.html#16699">[ subject ]</a>
              <a href="author.html#16699">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
