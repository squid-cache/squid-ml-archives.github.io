<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid cpu usage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20cpu%20usage&In-Reply-To=%3C5f672c1b-ce28-35f3-df09-982e9c76c9cc%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016724.html">
   <LINK REL="Next"  HREF="016726.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid cpu usage</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20cpu%20usage&In-Reply-To=%3C5f672c1b-ce28-35f3-df09-982e9c76c9cc%40measurement-factory.com%3E"
       TITLE="[squid-users] squid cpu usage">rousskov at measurement-factory.com
       </A><BR>
    <I>Thu Oct 26 15:55:05 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016724.html">[squid-users] squid cpu usage
</A></li>
        <LI>Next message (by thread): <A HREF="016726.html">[squid-users] squid cpu usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16725">[ date ]</a>
              <a href="thread.html#16725">[ thread ]</a>
              <a href="subject.html#16725">[ subject ]</a>
              <a href="author.html#16725">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/26/2017 05:15 AM, Vieri wrote:

&gt;<i> Here's the strace (compressed with gz):
</I>&gt;<i> Do you see anything useful in the trace?
</I>
FWIW, nothing jumped at me. As you know, I was asking for a gdb
backtrace, but I no longer think that it is likely to help at this
stage: Your further comments and strace itself confirm that Squid is
_not_ stuck in some tight loop, consuming 100% of CPU. It may be
consuming a lot of CPU cycles, but it is not doing the same compact
operation over and over again, so random gdb backtraces are unlikely to
pinpoint the culprit (if there is one).


&gt;<i> If not, how can I improve the trace next time I have this issue?
</I>
Please add (relative) timestamps between system calls (strace -r). It
may help detect periods of time when Squid was not making any system
calls. If possible, I would also add time spend in each system call
(strace -T), just in case, but it is unlikely to be useful in this case.

Please also report how many request did Squid finished handling during
the traced period. You can run mgr:info before/after and/or count
access.log lines.

For mgr:info snapshots, please consider doing the legwork to identify
potentially relevant entries that have changed between the snapshots. I
do not have time to do that (but others on the list might, of course).

I would not bother with mgr:mem snapshots unless mgr:info shows that the
memory has grown a lot during the 100% CPU usage.

Finally, consider enabling Squid debugging for a few seconds of that
100% CPU usage period. Wiki has instructions revolving around sending
Squid a debug signal.


&gt;<i> Having a backup Squid is not that simple in my scenario
</I>
It rarely is!


&gt;<i> I didn't run mgr:events while the CPU was at 100%
</I>
Please run mgr:events all the time (e.g., every minute) so that you can
catch event(s) (if any) that _lead_ to the 100% CPU usage period. You
can also run mgr:events more often (e.g., every 5 seconds) during the
100% CPU usage period, of course.


HTH,

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016724.html">[squid-users] squid cpu usage
</A></li>
	<LI>Next message (by thread): <A HREF="016726.html">[squid-users] squid cpu usage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16725">[ date ]</a>
              <a href="thread.html#16725">[ thread ]</a>
              <a href="subject.html#16725">[ subject ]</a>
              <a href="author.html#16725">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
