<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid regex grammar
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20regex%20grammar&In-Reply-To=%3C4fbea726-2ec4-f2f5-adaa-1052b9cb19fe%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016733.html">
   <LINK REL="Next"  HREF="016735.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid regex grammar</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20regex%20grammar&In-Reply-To=%3C4fbea726-2ec4-f2f5-adaa-1052b9cb19fe%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid regex grammar">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Oct 27 14:32:03 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016733.html">[squid-users] Squid regex grammar
</A></li>
        <LI>Next message (by thread): <A HREF="016735.html">[squid-users] Squid regex grammar
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16734">[ date ]</a>
              <a href="thread.html#16734">[ thread ]</a>
              <a href="subject.html#16734">[ subject ]</a>
              <a href="author.html#16734">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 28/10/17 02:59, Yuri wrote:
&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 27.10.2017 12:01, Amos Jeffries &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;&gt;<i> On 27/10/17 13:06, Yuri wrote:
</I>&gt;&gt;&gt;<i> Just for clarify (it is not well-documented. At least I can't find any
</I>&gt;&gt;&gt;<i> documentation about):
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Squid's regex supports only POSIX Basic grammar?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The specific grammar depends on your regex library used to build
</I>&gt;&gt;<i> Squid, so YMMV.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Basic POSIX is the only portable grammar that *all* regex libraries
</I>&gt;&gt;<i> can be expected to support. So Squid does not officially support other
</I>&gt;&gt;<i> grammars (yet) even if they work in your particular build.
</I>&gt;<i> That's why I'm asking that the POSIX Extended in the Squid does not
</I>&gt;<i> work. And it is not well documented anywhere. And there is no easy way
</I>&gt;<i> to check what regex library Squid uses.
</I>&gt;<i> 
</I>&gt;<i> I'm trying to find it in configuration, found that:
</I>&gt;<i> root @ cthulhu /patch/squid-5.0.0-patched-v2.26 # ./configure
</I>&gt;<i> --help|grep regex
</I>&gt;<i>  &#160; --enable-gnuregex&#160;&#160;&#160;&#160;&#160;&#160; Compile GNUregex. Unless you have reason to
</I>&gt;<i> use this
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Unix boxes which do not have their own regex
</I>&gt;<i> library
</I>&gt;<i> 
</I>
The full text there is:
  &quot;
   --enable-gnuregex

   Compile GNUregex. Unless you have reason to use this
   option, you should not enable it. This library file
   is usually only required on Windows and very old
   Unix boxes which do not have their own regex library
   built in.
&quot;

If you *dont* override the local environment by setting that build 
option Squid uses whatever your build tools link to with &quot;-lregex&quot;.

&gt;<i> Then see ldd:
</I>&gt;<i> 
</I>&gt;<i> root @ cthulhu /patch/squid-5.0.0-patched-v2.26 # ldd
</I>&gt;<i> /usr/local/squid/sbin/squid&#160;&#160;&#160;&#160;&#160;&#160;&#160; libpthread.so.1 =&gt;
</I>&gt;<i> /lib/64/libpthread.so.1
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; libnettle.so.6 =&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /opt/csw/lib/amd64/libnettle.so.6
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; libmd5.so.1 =&gt;&#160;&#160; /lib/64/libmd5.so.1
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; libecap.so.3 =&gt;&#160; /usr/local/lib/libecap.so.3
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; libatomic.so.1 =&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /opt/csw/lib/amd64/libatomic.so.1
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; libssl.so.1.0.0 =&gt;&#160;&#160;&#160;&#160;&#160;&#160; /opt/csw/lib/amd64/libssl.so.1.0.0
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; libcrypto.so.1.0.0 =&gt;&#160;&#160;&#160; /opt/csw/lib/amd64/libcrypto.so.1.0.0
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; libkrb5.so.1 =&gt;&#160; /usr/lib/64/libkrb5.so.1
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; libstdc++.so.6 =&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /opt/csw/lib/amd64/libstdc++.so.6
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; libsocket.so.1 =&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /lib/64/libsocket.so.1
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; libresolv.so.2 =&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /lib/64/libresolv.so.2
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; libnsl.so.1 =&gt;&#160;&#160; /lib/64/libnsl.so.1
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; libltdl.so.7 =&gt;&#160; /opt/csw/lib/amd64/libltdl.so.7
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; libm.so.2 =&gt;&#160;&#160;&#160;&#160; /lib/64/libm.so.2
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; librt.so.1 =&gt;&#160;&#160;&#160; /lib/64/librt.so.1
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; libgcc_s.so.1 =&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /opt/csw/lib/amd64/libgcc_s.so.1
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; libc.so.1 =&gt;&#160;&#160;&#160;&#160; /lib/64/libc.so.1
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; libmp.so.2 =&gt;&#160;&#160;&#160; /lib/64/libmp.so.2
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; libmd.so.1 =&gt;&#160;&#160;&#160; /lib/64/libmd.so.1
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; libscf.so.1 =&gt;&#160;&#160; /lib/64/libscf.so.1
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; libaio.so.1 =&gt;&#160;&#160; /lib/64/libaio.so.1
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; libdoor.so.1 =&gt;&#160; /lib/64/libdoor.so.1
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; libuutil.so.1 =&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /lib/64/libuutil.so.1
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; libgen.so.1 =&gt;&#160;&#160; /lib/64/libgen.so.1
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; mech_krb5.so.1 =&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /usr/lib/64/gss/mech_krb5.so.1
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; libgss.so.1 =&gt;&#160;&#160; /usr/lib/64/libgss.so.1
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; libpkcs11.so.1 =&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /usr/lib/64/libpkcs11.so.1
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; libcmd.so.1 =&gt;&#160;&#160; /lib/64/libcmd.so.1
</I>&gt;<i>  &#160;&#160;&#160;&#160;&#160;&#160;&#160; libcryptoutil.so.1 =&gt;&#160;&#160;&#160; /usr/lib/64/libcryptoutil.so.1
</I>&gt;<i> 
</I>&gt;<i>  From this output, you can not determine the regular expression library
</I>&gt;<i> that is being used. Although maybe I'm just not looking there.
</I>&gt;<i> 
</I>
I believe the -lregex ABI is presented by libstdc++ nowdays since regex 
was made part of the C++11 standard library. So quite difficult to see.

OR, if that Squid was built with the GNUregex setting it will show up in 
&quot;squid -v&quot; output rather than the ldd dependency list.


&gt;<i> Experimentally, I was able to find out that the grammar of POSIX
</I>&gt;<i> Extended does not work in any case.
</I>&gt;<i> 
</I>&gt;<i> However, I believe that such things should be well documented, otherwise
</I>&gt;<i> the regular expression is simply silently ignored and it is extremely
</I>&gt;<i> difficult to detect.
</I>
That sounds like a library problem. If Squid receives a regex error code 
from the library when compiling any regex from your squid.conf it logs 
the relevant error to cache.log.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016733.html">[squid-users] Squid regex grammar
</A></li>
	<LI>Next message (by thread): <A HREF="016735.html">[squid-users] Squid regex grammar
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16734">[ date ]</a>
              <a href="thread.html#16734">[ thread ]</a>
              <a href="subject.html#16734">[ subject ]</a>
              <a href="author.html#16734">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
