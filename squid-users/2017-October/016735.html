<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid regex grammar
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20regex%20grammar&In-Reply-To=%3Ca851eec3-946e-70b0-1d9c-10d172f89508%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016734.html">
   <LINK REL="Next"  HREF="016736.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid regex grammar</H1>
    <B>Yuri</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20regex%20grammar&In-Reply-To=%3Ca851eec3-946e-70b0-1d9c-10d172f89508%40gmail.com%3E"
       TITLE="[squid-users] Squid regex grammar">yvoinov at gmail.com
       </A><BR>
    <I>Fri Oct 27 14:49:44 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016734.html">[squid-users] Squid regex grammar
</A></li>
        <LI>Next message (by thread): <A HREF="016736.html">[squid-users] Squid regex grammar
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16735">[ date ]</a>
              <a href="thread.html#16735">[ thread ]</a>
              <a href="subject.html#16735">[ subject ]</a>
              <a href="author.html#16735">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

27.10.2017 20:32, Amos Jeffries &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> On 28/10/17 02:59, Yuri wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 27.10.2017 12:01, Amos Jeffries &#1087;&#1080;&#1096;&#1077;&#1090;:
</I>&gt;&gt;&gt;<i> On 27/10/17 13:06, Yuri wrote:
</I>&gt;&gt;&gt;&gt;<i> Just for clarify (it is not well-documented. At least I can't find any
</I>&gt;&gt;&gt;&gt;<i> documentation about):
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Squid's regex supports only POSIX Basic grammar?
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> The specific grammar depends on your regex library used to build
</I>&gt;&gt;&gt;<i> Squid, so YMMV.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Basic POSIX is the only portable grammar that *all* regex libraries
</I>&gt;&gt;&gt;<i> can be expected to support. So Squid does not officially support other
</I>&gt;&gt;&gt;<i> grammars (yet) even if they work in your particular build.
</I>&gt;&gt;<i> That's why I'm asking that the POSIX Extended in the Squid does not
</I>&gt;&gt;<i> work. And it is not well documented anywhere. And there is no easy way
</I>&gt;&gt;<i> to check what regex library Squid uses.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'm trying to find it in configuration, found that:
</I>&gt;&gt;<i> root @ cthulhu /patch/squid-5.0.0-patched-v2.26 # ./configure
</I>&gt;&gt;<i> --help|grep regex
</I>&gt;&gt;<i> &#160;&#160; --enable-gnuregex&#160;&#160;&#160;&#160;&#160;&#160; Compile GNUregex. Unless you have reason to
</I>&gt;&gt;<i> use this
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Unix boxes which do not have their own regex
</I>&gt;&gt;<i> library
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The full text there is:
</I>&gt;<i> &#160;&quot;
</I>&gt;<i> &#160; --enable-gnuregex
</I>&gt;<i>
</I>&gt;<i> &#160; Compile GNUregex. Unless you have reason to use this
</I>&gt;<i> &#160; option, you should not enable it. This library file
</I>&gt;<i> &#160; is usually only required on Windows and very old
</I>&gt;<i> &#160; Unix boxes which do not have their own regex library
</I>&gt;<i> &#160; built in.
</I>&gt;<i> &quot;
</I>&gt;<i>
</I>&gt;<i> If you *dont* override the local environment by setting that build
</I>&gt;<i> option Squid uses whatever your build tools link to with &quot;-lregex&quot;.
</I>&gt;<i>
</I>&gt;&gt;<i> Then see ldd:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> root @ cthulhu /patch/squid-5.0.0-patched-v2.26 # ldd
</I>&gt;&gt;<i> /usr/local/squid/sbin/squid&#160;&#160;&#160;&#160;&#160;&#160;&#160; libpthread.so.1 =&gt;
</I>&gt;&gt;<i> /lib/64/libpthread.so.1
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; libnettle.so.6 =&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /opt/csw/lib/amd64/libnettle.so.6
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; libmd5.so.1 =&gt;&#160;&#160; /lib/64/libmd5.so.1
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; libecap.so.3 =&gt;&#160; /usr/local/lib/libecap.so.3
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; libatomic.so.1 =&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /opt/csw/lib/amd64/libatomic.so.1
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; libssl.so.1.0.0 =&gt;&#160;&#160;&#160;&#160;&#160;&#160; /opt/csw/lib/amd64/libssl.so.1.0.0
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; libcrypto.so.1.0.0 =&gt;&#160;&#160;&#160; /opt/csw/lib/amd64/libcrypto.so.1.0.0
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; libkrb5.so.1 =&gt;&#160; /usr/lib/64/libkrb5.so.1
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; libstdc++.so.6 =&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /opt/csw/lib/amd64/libstdc++.so.6
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; libsocket.so.1 =&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /lib/64/libsocket.so.1
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; libresolv.so.2 =&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /lib/64/libresolv.so.2
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; libnsl.so.1 =&gt;&#160;&#160; /lib/64/libnsl.so.1
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; libltdl.so.7 =&gt;&#160; /opt/csw/lib/amd64/libltdl.so.7
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; libm.so.2 =&gt;&#160;&#160;&#160;&#160; /lib/64/libm.so.2
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; librt.so.1 =&gt;&#160;&#160;&#160; /lib/64/librt.so.1
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; libgcc_s.so.1 =&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /opt/csw/lib/amd64/libgcc_s.so.1
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; libc.so.1 =&gt;&#160;&#160;&#160;&#160; /lib/64/libc.so.1
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; libmp.so.2 =&gt;&#160;&#160;&#160; /lib/64/libmp.so.2
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; libmd.so.1 =&gt;&#160;&#160;&#160; /lib/64/libmd.so.1
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; libscf.so.1 =&gt;&#160;&#160; /lib/64/libscf.so.1
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; libaio.so.1 =&gt;&#160;&#160; /lib/64/libaio.so.1
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; libdoor.so.1 =&gt;&#160; /lib/64/libdoor.so.1
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; libuutil.so.1 =&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /lib/64/libuutil.so.1
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; libgen.so.1 =&gt;&#160;&#160; /lib/64/libgen.so.1
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; mech_krb5.so.1 =&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /usr/lib/64/gss/mech_krb5.so.1
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; libgss.so.1 =&gt;&#160;&#160; /usr/lib/64/libgss.so.1
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; libpkcs11.so.1 =&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /usr/lib/64/libpkcs11.so.1
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; libcmd.so.1 =&gt;&#160;&#160; /lib/64/libcmd.so.1
</I>&gt;&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; libcryptoutil.so.1 =&gt;&#160;&#160;&#160; /usr/lib/64/libcryptoutil.so.1
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &#160;From this output, you can not determine the regular expression library
</I>&gt;&gt;<i> that is being used. Although maybe I'm just not looking there.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I believe the -lregex ABI is presented by libstdc++ nowdays since
</I>&gt;<i> regex was made part of the C++11 standard library. So quite difficult
</I>&gt;<i> to see.
</I>Does not fit, Amos. The standard C ++ library for regular expressions
uses the ECMAScript syntax by default. AFAIK.

But acl's regexes behaviour demonstrate POSIX Basic behaviour. This is
simple to check:
\w and \d metacharacters does not work in regex acl's.
&gt;<i>
</I>&gt;<i> OR, if that Squid was built with the GNUregex setting it will show up
</I>&gt;<i> in &quot;squid -v&quot; output rather than the ldd dependency list.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> Experimentally, I was able to find out that the grammar of POSIX
</I>&gt;&gt;<i> Extended does not work in any case.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> However, I believe that such things should be well documented, otherwise
</I>&gt;&gt;<i> the regular expression is simply silently ignored and it is extremely
</I>&gt;&gt;<i> difficult to detect.
</I>&gt;<i>
</I>&gt;<i> That sounds like a library problem. If Squid receives a regex error
</I>&gt;<i> code from the library when compiling any regex from your squid.conf it
</I>&gt;<i> logs the relevant error to cache.log.
</I>Don't think so. Because of same behaviour demostrates on another server
with another platform (OS) with similar squid's
configuration/version/configs. And I see not any regex error in cache.log.

I want to clarify. I asked the question not because there are some
errors. And because the regular expressions in the ECMAScript syntax do
not work in the ACL. Without any errors. Just simple ignores acl parts
with ECMAS grammar constructions.
&gt;<i>
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
-- 
**************************
* C++: Bug to the future *
**************************

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20171027/696bdb17/attachment.key">http://lists.squid-cache.org/pipermail/squid-users/attachments/20171027/696bdb17/attachment.key</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20171027/696bdb17/attachment.sig">http://lists.squid-cache.org/pipermail/squid-users/attachments/20171027/696bdb17/attachment.sig</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016734.html">[squid-users] Squid regex grammar
</A></li>
	<LI>Next message (by thread): <A HREF="016736.html">[squid-users] Squid regex grammar
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16735">[ date ]</a>
              <a href="thread.html#16735">[ thread ]</a>
              <a href="subject.html#16735">[ subject ]</a>
              <a href="author.html#16735">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
