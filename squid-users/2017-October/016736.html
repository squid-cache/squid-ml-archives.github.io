<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid regex grammar
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20regex%20grammar&In-Reply-To=%3C0b2cbff3-76f9-37cd-b389-0f2631a05757%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016735.html">
   <LINK REL="Next"  HREF="016737.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid regex grammar</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20regex%20grammar&In-Reply-To=%3C0b2cbff3-76f9-37cd-b389-0f2631a05757%40measurement-factory.com%3E"
       TITLE="[squid-users] Squid regex grammar">rousskov at measurement-factory.com
       </A><BR>
    <I>Fri Oct 27 14:55:26 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016735.html">[squid-users] Squid regex grammar
</A></li>
        <LI>Next message (by thread): <A HREF="016737.html">[squid-users] Squid regex grammar
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16736">[ date ]</a>
              <a href="thread.html#16736">[ thread ]</a>
              <a href="subject.html#16736">[ subject ]</a>
              <a href="author.html#16736">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/27/2017 08:32 AM, Amos Jeffries wrote:
&gt;<i> On 28/10/17 02:59, Yuri wrote:
</I>&gt;&gt;<i> the regular expression is simply silently ignored and it is extremely
</I>&gt;&gt;<i> difficult to detect.
</I>
&gt;<i> That sounds like a library problem. If Squid receives a regex error code
</I>&gt;<i> from the library when compiling any regex from your squid.conf it logs
</I>&gt;<i> the relevant error to cache.log.
</I>
When a regular expression is using extended features, the basic regular
expression compiler often (or even always?!) does not fail because it
views the extended features as ordinary plain characters. Thus, Squid
cannot tell that something went wrong.

I cannot give a Squid-based example quickly, but here is a related
illustration using grep (which is not exactly the same as what happens
inside Squid, but I suspect it is similar enough for the illustration
purposes in this context):

&gt;<i> $ echo &quot;foobar&quot; | grep --basic-regexp    'foo|bar'
</I>&gt;<i> $ echo &quot;foobar&quot; | grep --extended-regexp 'foo|bar'
</I>&gt;<i> foobar
</I>
As you can see, the basic compiler is silent about the &quot;|&quot; character
that it does not support. Here is a similar example where a malformed
extended regular expression is silently accepted by the basic compiler:


&gt;<i> $ echo &quot;foobar&quot; | grep --basic-regexp 'foo(bar'
</I>&gt;<i> $ echo &quot;foobar&quot; | grep --extended-regexp 'foo(bar'
</I>&gt;<i> grep: Unmatched ( or \(
</I>

In theory, Squid itself could detect special characters unsupported by
the current regex library but doing so correctly without breaking many
existing working configurations may be impossible. On the other hand,
this validation could become an optional feature that admins can control.

The best strategy for a Squid admin working with complex regex ACLs may
be to add external test cases that validate ACL matching expectations,
but doing so requires significant amount of work and discipline.

Alex.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016735.html">[squid-users] Squid regex grammar
</A></li>
	<LI>Next message (by thread): <A HREF="016737.html">[squid-users] Squid regex grammar
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16736">[ date ]</a>
              <a href="thread.html#16736">[ thread ]</a>
              <a href="subject.html#16736">[ subject ]</a>
              <a href="author.html#16736">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
