<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid regex grammar
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20regex%20grammar&In-Reply-To=%3Cb9c58223-8068-b54e-d599-170a0331e245%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016736.html">
   <LINK REL="Next"  HREF="016738.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid regex grammar</H1>
    <B>Yuri</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20regex%20grammar&In-Reply-To=%3Cb9c58223-8068-b54e-d599-170a0331e245%40gmail.com%3E"
       TITLE="[squid-users] Squid regex grammar">yvoinov at gmail.com
       </A><BR>
    <I>Fri Oct 27 15:06:01 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016736.html">[squid-users] Squid regex grammar
</A></li>
        <LI>Next message (by thread): <A HREF="016738.html">[squid-users] Squid regex grammar
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16737">[ date ]</a>
              <a href="thread.html#16737">[ thread ]</a>
              <a href="subject.html#16737">[ subject ]</a>
              <a href="author.html#16737">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

27.10.2017 20:55, Alex Rousskov &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> On 10/27/2017 08:32 AM, Amos Jeffries wrote:
</I>&gt;&gt;<i> On 28/10/17 02:59, Yuri wrote:
</I>&gt;&gt;&gt;<i> the regular expression is simply silently ignored and it is extremely
</I>&gt;&gt;&gt;<i> difficult to detect.
</I>&gt;&gt;<i> That sounds like a library problem. If Squid receives a regex error code
</I>&gt;&gt;<i> from the library when compiling any regex from your squid.conf it logs
</I>&gt;&gt;<i> the relevant error to cache.log.
</I>&gt;<i> When a regular expression is using extended features, the basic regular
</I>&gt;<i> expression compiler often (or even always?!) does not fail because it
</I>&gt;<i> views the extended features as ordinary plain characters. Thus, Squid
</I>&gt;<i> cannot tell that something went wrong.
</I>&gt;<i>
</I>&gt;<i> I cannot give a Squid-based example quickly, but here is a related
</I>&gt;<i> illustration using grep (which is not exactly the same as what happens
</I>&gt;<i> inside Squid, but I suspect it is similar enough for the illustration
</I>&gt;<i> purposes in this context):
</I>&gt;<i>
</I>&gt;&gt;<i> $ echo &quot;foobar&quot; | grep --basic-regexp    'foo|bar'
</I>&gt;&gt;<i> $ echo &quot;foobar&quot; | grep --extended-regexp 'foo|bar'
</I>&gt;&gt;<i> foobar
</I>&gt;<i> As you can see, the basic compiler is silent about the &quot;|&quot; character
</I>&gt;<i> that it does not support. Here is a similar example where a malformed
</I>&gt;<i> extended regular expression is silently accepted by the basic compiler:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> $ echo &quot;foobar&quot; | grep --basic-regexp 'foo(bar'
</I>&gt;&gt;<i> $ echo &quot;foobar&quot; | grep --extended-regexp 'foo(bar'
</I>&gt;&gt;<i> grep: Unmatched ( or \(
</I>&gt;<i>
</I>&gt;<i> In theory, Squid itself could detect special characters unsupported by
</I>&gt;<i> the current regex library but doing so correctly without breaking many
</I>&gt;<i> existing working configurations may be impossible. On the other hand,
</I>&gt;<i> this validation could become an optional feature that admins can control.
</I>&gt;<i>
</I>&gt;<i> The best strategy for a Squid admin working with complex regex ACLs may
</I>&gt;<i> be to add external test cases that validate ACL matching expectations,
</I>&gt;<i> but doing so requires significant amount of work and discipline.
</I>
That's what I'm talking about. Just when it comes to hundreds and
thousands of regular expressions - this approach seems not too
acceptable. Therefore, I would like to see that the grammars used are
clearly documented. Squid with a simple configuration check often does
not show anything (if there are no obvious errors - i.e. incomplete
regex or similar) and, in a productive configuration, it is extremely
difficult to detect a non-working access control list parts. The
websites are also thousands.

Therefore, I would like either a clear documentation or some tool for
checking whether the regular expression is correct from the point of
view of the current library used by Squid or not. The existing
opportunities seem completely unsatisfactory.
&gt;<i>
</I>&gt;<i> Alex.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>
-- 
**************************
* C++: Bug to the future *
**************************

-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0x3E3743A7.asc
Type: application/pgp-keys
Size: 2887 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20171027/b9bacfb2/attachment.key">http://lists.squid-cache.org/pipermail/squid-users/attachments/20171027/b9bacfb2/attachment.key</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 659 bytes
Desc: OpenPGP digital signature
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20171027/b9bacfb2/attachment.sig">http://lists.squid-cache.org/pipermail/squid-users/attachments/20171027/b9bacfb2/attachment.sig</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016736.html">[squid-users] Squid regex grammar
</A></li>
	<LI>Next message (by thread): <A HREF="016738.html">[squid-users] Squid regex grammar
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16737">[ date ]</a>
              <a href="thread.html#16737">[ thread ]</a>
              <a href="subject.html#16737">[ subject ]</a>
              <a href="author.html#16737">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
