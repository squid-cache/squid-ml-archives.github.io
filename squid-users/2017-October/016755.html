<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid doesn't reload webpage like other clients do
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20doesn%27t%20reload%20webpage%20like%20other%20clients%20do&In-Reply-To=%3C6a0985c1-394d-c19b-f03d-a658e937ab42%40measurement-factory.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016751.html">
   <LINK REL="Next"  HREF="016757.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid doesn't reload webpage like other clients do</H1>
    <B>Alex Rousskov</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20doesn%27t%20reload%20webpage%20like%20other%20clients%20do&In-Reply-To=%3C6a0985c1-394d-c19b-f03d-a658e937ab42%40measurement-factory.com%3E"
       TITLE="[squid-users] Squid doesn't reload webpage like other clients do">rousskov at measurement-factory.com
       </A><BR>
    <I>Mon Oct 30 16:22:09 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016751.html">[squid-users] Squid doesn't reload webpage like other clients do
</A></li>
        <LI>Next message (by thread): <A HREF="016757.html">[squid-users] Squid doesn't reload webpage like other clients do
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16755">[ date ]</a>
              <a href="thread.html#16755">[ thread ]</a>
              <a href="subject.html#16755">[ subject ]</a>
              <a href="author.html#16755">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/30/2017 03:51 AM, Troiano Alessio wrote:

&gt;<i> I've squid 3.5.20 running on RHEL 7.4. I have a problem to access
</I>&gt;<i> some websites, for example www.nato.int. This website apply an
</I>&gt;<i> Anti-DDoS system that reset the first connection after the TCP 3-way
</I>&gt;<i> handshake (SYN/SYN-ACK/ACK/RST-ACK). All subsequent TCP connections
</I>&gt;<i> are accepted. The website administrator say's it is by design.
</I>

&gt;<i> When I browse the site with squid proxy the browser receive an &quot;Empty
</I>&gt;<i> Response&quot; squid error page (HTTP error code 502 Bad Gateway) and
</I>&gt;<i> doesn't do the automatic retry:
</I>
This is by design as well :-).

We can change Squid behavior to retry connection resets, but I am sure
that some folks will not like the new behavior because in _their_ use
cases a retry is wasteful and/or painful. IMHO, the new behavior should
be controlled by a configuration directive, possibly an ACL-driven one.

Quality patches implementing the above feature should be welcomed IMO.
The tip of the relevant code is probably in ERR_ZERO_SIZE_OBJECT
handling inside FwdState::fail(). There is a similar code that handles
persistent connection races there already, but the zero-size reply code
may need a new dedicated FwdState flag to prevent infinite retry loops
when the origin server is broken (a much more typical use case than the
weird attempt at DDoS mitigation that you have described above).

<A HREF="https://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F">https://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F</A>


HTH,

Alex.



&gt;<i> [<A HREF="https://lists.squid-cache.org/listinfo/squid-users">root at soc-pe-nagios01</A> ~]# wget www.nato.int -e use_proxy=yes -e http_proxy=172.31.1.67:8080
</I>&gt;<i> --2017-10-30 10:41:09--  <A HREF="http://www.nato.int/">http://www.nato.int/</A>
</I>&gt;<i> Connecting to 172.31.1.67:8080... connected.
</I>&gt;<i> Proxy request sent, awaiting response... 502 Bad Gateway
</I>&gt;<i> 2017-10-30 10:41:09 ERROR 502: Bad Gateway.
</I>&gt;<i> 
</I>&gt;<i> I can't find an RFC that confirm if browser and proxyes should try a page reload, or if squid has an option to do that.
</I>&gt;<i> 
</I>&gt;<i> Any help is appreciated.
</I>&gt;<i> 
</I>&gt;<i> Best Regards, Alessio.
</I>&gt;<i> 
</I>&gt;<i> Il presente messaggio e-mail e ogni suo allegato devono intendersi indirizzati esclusivamente al destinatario indicato e considerarsi dal contenuto strettamente riservato e confidenziale. Se non siete l'effettivo destinatario o avete ricevuto il messaggio e-mail per errore, siete pregati di avvertire immediatamente il mittente e di cancellare il suddetto messaggio e ogni suo allegato dal vostro sistema informatico. Qualsiasi utilizzo, diffusione, copia o archiviazione del presente messaggio da parte di chi non ne &#232; il destinatario &#232; strettamente proibito e pu&#242; dar luogo a responsabilit&#224; di carattere civile e penale punibili ai sensi di legge.
</I>&gt;<i> Questa e-mail ha valore legale solo se firmata digitalmente ai sensi della normativa vigente.
</I>&gt;<i> 
</I>&gt;<i> The contents of this email message and any attachments are intended solely for the addressee(s) and contain confidential and/or privileged information.
</I>&gt;<i> If you are not the intended recipient of this message, or if this message has been addressed to you in error, please immediately notify the sender and then delete this message and any attachments from your system. If you are not the intended recipient, you are hereby notified that any use, dissemination, copying, or storage of this message or its attachments is strictly prohibited. Unauthorized disclosure and/or use of information contained in this email message may result in civil and criminal liability. &#8220;
</I>&gt;<i> This e-mail has legal value according to the applicable laws only if it is digitally signed by the sender
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016751.html">[squid-users] Squid doesn't reload webpage like other clients do
</A></li>
	<LI>Next message (by thread): <A HREF="016757.html">[squid-users] Squid doesn't reload webpage like other clients do
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16755">[ date ]</a>
              <a href="thread.html#16755">[ thread ]</a>
              <a href="subject.html#16755">[ subject ]</a>
              <a href="author.html#16755">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
