<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Your cache is running out of filedescriptors
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Your%20cache%20is%20running%20out%20of%20filedescriptors&In-Reply-To=%3C2a8001d322fe%24c5a09770%2450e1c650%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016254.html">
   <LINK REL="Next"  HREF="016258.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Your cache is running out of filedescriptors</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Your%20cache%20is%20running%20out%20of%20filedescriptors&In-Reply-To=%3C2a8001d322fe%24c5a09770%2450e1c650%24%40ngtech.co.il%3E"
       TITLE="[squid-users] Your cache is running out of filedescriptors">eliezer at ngtech.co.il
       </A><BR>
    <I>Fri Sep  1 08:46:15 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016254.html">[squid-users] Recompiling Squid3 for Mips hardware, enabling captive portal?
</A></li>
        <LI>Next message (by thread): <A HREF="016258.html">[squid-users] Your cache is running out of filedescriptors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16253">[ date ]</a>
              <a href="thread.html#16253">[ thread ]</a>
              <a href="subject.html#16253">[ subject ]</a>
              <a href="author.html#16253">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sorry a typo..

You will need to use:
ulimit -Hn 65535

first and after this apply the lower limit:
ulimit -n 16384

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>



-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Eliezer Croitoru
Sent: Friday, September 1, 2017 02:43
To: 'Vieri' &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">rentorbuy at yahoo.com</A>&gt;; <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Your cache is running out of filedescriptors

Hey Vieri,

The hard and soft limit are designed to administratively allow a specific service or user have a &quot;space&quot; between the expected to the unexpected.
I assume it's meant also for other things like giving a specific user or service a basic(soft) limit and a higher limit that will not cripple the whole machine(hard..).
But I don't remember the exact idea behind it.

For a sysadmin it's only a matter of restrictions to not wear out the hardware or to prevent resources abuse.

As Amos suggested, since squid almost 100% requires root privileges then you can add to the openrc or system startup service\script the specific limit you want to apply in the scope of any start\restart of the service(squid).
You will need to use:
ulimit -Hn 65535

first and after this apply the lower limit:
ulimit -Hn 16384

just notice that depends on the hardware and the network you should monitor the server and the services to make sure squid will not be used to abuse your connection.

I hope the above will help you.

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>



-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Vieri
Sent: Thursday, August 31, 2017 10:27
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] Your cache is running out of filedescriptors

I'd like to add a note to my previous message.

I set the following values, and I'll see what happens:

* hard nofile 65535
* soft nofile 16384


(&quot;hard&quot; being a top limit a non-root process cannot exceed)

So I take it that Squid will start with a default of 16384, but will be able to increase up to 65535 if it needs to.


By the way, restarting squid from the same shell (ssh) does not apply the new values.
I had to re-log into the system.

There's probably a ulimit command line option to apply the values without logging out.

Anyway, the squid log confirms the new value.


Also, I guess it would be preferable to reboot the server if I wanted the same limits to apply to all running processes (or restart each and every service/daemon one by one).


I also set the following directives.
For local caching proxy:

client_lifetime 480 minutes


For reverse proxies:

client_lifetime 60 minutes


I left the other options alone: 
read_timeout, request_timeout, persistent_request_timeout and quick_abort

Vieri
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>

_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016254.html">[squid-users] Recompiling Squid3 for Mips hardware, enabling captive portal?
</A></li>
	<LI>Next message (by thread): <A HREF="016258.html">[squid-users] Your cache is running out of filedescriptors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16253">[ date ]</a>
              <a href="thread.html#16253">[ thread ]</a>
              <a href="subject.html#16253">[ subject ]</a>
              <a href="author.html#16253">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
