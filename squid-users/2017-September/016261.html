<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid Cache_peer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20Cache_peer&In-Reply-To=%3C4a2a09e6-f9fd-12cc-ed0a-8f295afe138d%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016260.html">
   <LINK REL="Next"  HREF="016262.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid Cache_peer</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20Cache_peer&In-Reply-To=%3C4a2a09e6-f9fd-12cc-ed0a-8f295afe138d%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid Cache_peer">squid3 at treenet.co.nz
       </A><BR>
    <I>Sun Sep  3 08:20:58 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016260.html">[squid-users] Squid Cache_peer
</A></li>
        <LI>Next message (by thread): <A HREF="016262.html">[squid-users] squid with quota limit using external helper problem !
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16261">[ date ]</a>
              <a href="thread.html#16261">[ thread ]</a>
              <a href="subject.html#16261">[ subject ]</a>
              <a href="author.html#16261">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 03/09/17 17:37, Jonathan thomas Cho wrote:
&gt;<i> Hello, I seem to have a issue with cache peer. I have 2 parent IPS, 
</I>&gt;<i> however, I want port 3128 to go to 1 parent while 3129 go to the second 
</I>&gt;<i> parent. &#160;Here is my current config, I hope you can adjust it for me. 
</I>
Not without understanding what it is you are actually trying to achieve. 
What you ask for above is satisfied by adding cache_peer_access rules.

BUT your explanation below of _why_ you want it indicates you may 
actually need something entirely different to what you are asking about.


&gt;<i> Thank you
</I>&gt;<i> 
</I>&gt;<i> Http_port 3128
</I>&gt;<i> 
</I>&gt;<i> http_port 3129
</I>&gt;<i> 
</I>&gt;<i> coredump_dir /var/spool/squid3
</I>&gt;<i> 
</I>&gt;<i> refresh_pattern ^ftp:&#160;&#160;&#160;&#160;&#160;&#160; 1440&#160;&#160;&#160; 20% 10080
</I>&gt;<i> 
</I>&gt;<i> refresh_pattern ^gopher:&#160;&#160;&#160; 1440&#160;&#160;&#160; 0%&#160; 1440
</I>&gt;<i> 
</I>&gt;<i> refresh_pattern -i (/cgi-bin/|\?) 0 0%&#160; 0
</I>&gt;<i> 
</I>&gt;<i> refresh_pattern (Release|Packages(.gz)*)$&#160;&#160;&#160;&#160;&#160; 0&#160;&#160;&#160;&#160;&#160;&#160; 20%&#160;&#160;&#160;&#160; 2880
</I>&gt;<i> 
</I>&gt;<i> refresh_pattern .&#160;&#160;&#160;&#160;&#160;&#160; 0&#160;&#160; 20% 4320
</I>&gt;<i> 
</I>&gt;<i> cache_peer 1xx.xxx.xxx.xxx parent 3128 0 proxy-only no-query default 
</I>&gt;<i> login=username:password name=user1
</I>&gt;<i> 
</I>&gt;<i> cache_peer 1xx.xxx.xxx.xxx parent 3128 0 proxy-only no-query default 
</I>&gt;<i> login=username:password name=user2
</I>&gt;<i> 
</I>&gt;<i> never_direct allow all
</I>&gt;<i> 
</I>&gt;<i> as you can see, I&#8217;m not entirely sure on what to do to route each parent 
</I>&gt;<i> ip to specific port so users cant use more ports than needed.
</I>&gt;<i> 
</I>
That sentence does not compute.

a) there is no sign of any &quot;user&quot; in your config.

Squid does have credentials that is sends to each peer - but that has 
nothing to do with any human / user. It is a pair of *machine* 
credentials for Basic auth representing Squid itself.


b) You have not configured the standby= parameters which force Squid to 
open more connections than it needs. So your Squid already does require 
every single port it opens to those peers.
  ie It is not possible for this Squid to be encountering the problem 
you say your are trying to avoid.


Also, Squid uses the multiplexing and pipeline mechanisms in HTTP. So 
any port opens to the peer *will* be used for multiple messages until 
one requires it to be closed.
  By manually configuring specific routing you are add limits to those 
mechanisms which are likely to result in *more* ports being used to each 
peer. Since Squid can no longer pipeline traffic contradictory to your 
rules even if peer #1 has no open ports and peer #2 has an open and 
available port waiting for messages such as the one your rules send to 
peer #1 - and vice versa.

So, you are apparently trying to work around a problem that this Squid 
cannot encounter by adding complexity that will cause it to happen.


Can you more clearly describe what exactly you are trying to achieve here?
  and what problem you have encountered (or think you might) that is 
behind your request?


Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016260.html">[squid-users] Squid Cache_peer
</A></li>
	<LI>Next message (by thread): <A HREF="016262.html">[squid-users] squid with quota limit using external helper problem !
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16261">[ date ]</a>
              <a href="thread.html#16261">[ thread ]</a>
              <a href="subject.html#16261">[ subject ]</a>
              <a href="author.html#16261">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
