<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] RC4-MD5 cipher is always enabled?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20RC4-MD5%20cipher%20is%20always%20enabled%3F&In-Reply-To=%3C46c7124d-58bc-5300-8e41-81716d67747e%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016276.html">
   <LINK REL="Next"  HREF="016287.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] RC4-MD5 cipher is always enabled?</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20RC4-MD5%20cipher%20is%20always%20enabled%3F&In-Reply-To=%3C46c7124d-58bc-5300-8e41-81716d67747e%40treenet.co.nz%3E"
       TITLE="[squid-users] RC4-MD5 cipher is always enabled?">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Sep  5 09:57:06 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016276.html">[squid-users] RC4-MD5 cipher is always enabled?
</A></li>
        <LI>Next message (by thread): <A HREF="016287.html">[squid-users] RC4-MD5 cipher is always enabled?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16279">[ date ]</a>
              <a href="thread.html#16279">[ thread ]</a>
              <a href="subject.html#16279">[ subject ]</a>
              <a href="author.html#16279">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 05/09/17 20:55, chiasa.men wrote&gt; Thanks, that was easy... but:
&gt;<i> 
</I>&gt;<i> That does not work:
</I>&gt;<i> 
</I>&gt;<i> https_port 3128 accel defaultsite=www.example.com cert=/example/cert.pem key=/
</I>&gt;<i> example/key.pem cipher=ECDHE-ECDSA-AES256-GCM-SHA384:!RC4:!MD5
</I>&gt;<i> 
</I>&gt;<i> openssl s_client -connect localhost:3128
</I>&gt;<i> 140048907216536:error:14077410:SSL routines:SSL23_GET_SERVER_HELLO:sslv3 alert
</I>&gt;<i> handshake failure:s23_clnt.c:769:
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Allowing RC4 and MD5 works:
</I>&gt;<i> 
</I>&gt;<i> https_port 3128 accel defaultsite=www.example.com cert=/example/cert.pem key=/
</I>&gt;<i> example/key.pem cipher=ECDHE-ECDSA-AES256-GCM-SHA384:RC4:MD5
</I>&gt;<i> 
</I>&gt;<i> openssl s_client -connect localhost:3128
</I>&gt;<i>      Cipher    : ECDH-ECDSA-RC4-SHA
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> But openssl works without allowing RC4 and MD5:
</I>&gt;<i> 
</I>&gt;<i> openssl s_server -cert /example/cert.pem -key /example/key.pem -cipher 'ECDHE-
</I>&gt;<i> ECDSA-AES256-GCM-SHA384:!RC4:!MD5'
</I>&gt;<i> 
</I>&gt;<i> openssl s_client -connect localhost:4433
</I>&gt;<i>      Cipher    : ECDHE-ECDSA-AES256-GCM-SHA384
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> So I guess the certificate and the openssl part should work.
</I>&gt;<i> Maybe you could give another advice?
</I>
&quot;
cipher=
	Colon separated list of supported ciphers.
	NOTE: some ciphers such as EDH ciphers depend on
	additional settings. If those settings are
	omitted the ciphers may be silently ignored
	by the OpenSSL library.&quot;
&quot;

For the ECDHE-* ciphers to work the server end needs to be configured 
with curve parameters. That is done the tls-dh= option with a curve name 
and

&quot;
tls-dh=[curve:]file
	File containing DH parameters for temporary/ephemeral DH key
	exchanges, optionally prefixed by a curve for ephemeral ECDH
	key exchanges.
	See OpenSSL documentation for details on how to create the
	DH parameter file. Supported curves for ECDH can be listed
	using the &quot;openssl ecparam -list_curves&quot; command.

	WARNING: EDH and EECDH ciphers will be silently disabled if
	this option is not set.
&quot;


&gt;<i> 
</I>&gt;<i> btw, the used squid version:
</I>&gt;<i> Squid Cache: Version 3.5.12
</I>&gt;<i> Service Name: squid
</I>&gt;<i> Ubuntu linux
</I>

Please upgrade. Somewhat urgently.

* TLS/SSL has had a *lot* of progress in the past few years. There are 
many security related issues resolved in the latest releases which exist 
in the older ones.

* ECDHE is a good example of the change. It is not supported *at all* by 
that old version of Squid.

When using TLS/SSL support Squid-3.5.24 is currently the oldest 
acceptable Squid release as it contains extra mitigation for TLS DoS 
vulnerabilities. The current 3.5.27 would be best from the 3.5 series.

If you are not already aware there is no official security 
support/tracking from Debian and Ubuntu for TLS/SSL vulnerabilities as 
their packages do not ship with OpenSSL support. So following their 
stable/security package version is of no benefit for TLS/SSL issues, you 
need to track upstream releases yourself when custom building software 
(that goes for anything, not just Squid).

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016276.html">[squid-users] RC4-MD5 cipher is always enabled?
</A></li>
	<LI>Next message (by thread): <A HREF="016287.html">[squid-users] RC4-MD5 cipher is always enabled?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16279">[ date ]</a>
              <a href="thread.html#16279">[ thread ]</a>
              <a href="subject.html#16279">[ subject ]</a>
              <a href="author.html#16279">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
