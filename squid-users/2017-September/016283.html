<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] gateway failure
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20gateway%20failure&In-Reply-To=%3C375001d32668%243e82f360%24bb88da20%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016280.html">
   <LINK REL="Next"  HREF="016284.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] gateway failure</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20gateway%20failure&In-Reply-To=%3C375001d32668%243e82f360%24bb88da20%24%40ngtech.co.il%3E"
       TITLE="[squid-users] gateway failure">eliezer at ngtech.co.il
       </A><BR>
    <I>Tue Sep  5 16:58:48 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016280.html">[squid-users] gateway failure
</A></li>
        <LI>Next message (by thread): <A HREF="016284.html">[squid-users] How to setup squid as reverse proxy to intercept	Office365 traffic
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16283">[ date ]</a>
              <a href="thread.html#16283">[ thread ]</a>
              <a href="subject.html#16283">[ subject ]</a>
              <a href="author.html#16283">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Vieri,

You can run a crontab job(s) that will run periodic tests against public dns and http(s) servers.
Also try to enable path mtu discovery which might help in some cases.
You can also try to use iptables clamp-mss  \ set-mss to either set a static or by the path mtu. Take a peek at:
<A HREF="http://lartc.org/howto/lartc.cookbook.mtu-mss.html">http://lartc.org/howto/lartc.cookbook.mtu-mss.html</A>

You can try first to use:
iptables -I FORWARD -p tcp --tcp-flags SYN,RST SYN -j TCPMSS --set-mss 1450

or:
iptables -I FORWARD -p tcp --tcp-flags SYN,RST SYN -j TCPMSS  --clamp-mss-to-pmtu

Also try to actually discover the path mtu using:
# tracepath -n www.squid-cache.org

I don't know what OS you are running there but it's nice to have either munin or nagios on the squid server to debug such issues.(after you verify it's not or is mtu issue).

Let me know if you need any help setting up a couple testing scripts.

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>



-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Vieri
Sent: Tuesday, September 5, 2017 12:32
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: [squid-users] gateway failure

Hi,

I'm sometimes getting hit by ERR_GATEWAY_FAILURE. I'd like to know what could be causing this issue.
When this happens on a production server, I don't have much time to investigate.
I usually only have enough time to ssh into the squid server, test internet access via command line, and before I know it, the issue's gone.

Nothing much in cache.log. I have debug_options rotate=1 ALL,1. I'd rather not set ALL,9 on a production system for something that happens maybe only once every 2 or 3 days.
I'm not sure however which sections and levels to  set so I can get an idea as to why I'm getting ERR_GATEWAY_FAILURE.

<A HREF="https://wiki.squid-cache.org/KnowledgeBase/DebugSections">https://wiki.squid-cache.org/KnowledgeBase/DebugSections</A>

Any suggestions?

Thanks,

Vieri
_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016280.html">[squid-users] gateway failure
</A></li>
	<LI>Next message (by thread): <A HREF="016284.html">[squid-users] How to setup squid as reverse proxy to intercept	Office365 traffic
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16283">[ date ]</a>
              <a href="thread.html#16283">[ thread ]</a>
              <a href="subject.html#16283">[ subject ]</a>
              <a href="author.html#16283">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
