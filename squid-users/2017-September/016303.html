<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TLS: 1st time w/intermediate cert: not working; ideas on what I'm doing wrong?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TLS%3A%201st%20time%20w/intermediate%20cert%3A%20not%20working%3B%0A%20ideas%20on%20what%20I%27m%20doing%20wrong%3F&In-Reply-To=%3CDB6PR0401MB26803D83F5B9EFB1FD19B9E88F940%40DB6PR0401MB2680.eurprd04.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016311.html">
   <LINK REL="Next"  HREF="016304.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TLS: 1st time w/intermediate cert: not working; ideas on what I'm doing wrong?</H1>
    <B>Rafael Akchurin</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TLS%3A%201st%20time%20w/intermediate%20cert%3A%20not%20working%3B%0A%20ideas%20on%20what%20I%27m%20doing%20wrong%3F&In-Reply-To=%3CDB6PR0401MB26803D83F5B9EFB1FD19B9E88F940%40DB6PR0401MB2680.eurprd04.prod.outlook.com%3E"
       TITLE="[squid-users] TLS: 1st time w/intermediate cert: not working; ideas on what I'm doing wrong?">rafael.akchurin at diladele.com
       </A><BR>
    <I>Thu Sep  7 21:42:47 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016311.html">[squid-users] TLS: 1st time w/intermediate cert: not working; ideas on what I'm doing wrong?
</A></li>
        <LI>Next message (by thread): <A HREF="016304.html">[squid-users] TLS: 1st time w/intermediate cert: not working; ideas on what I'm doing wrong?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16303">[ date ]</a>
              <a href="thread.html#16303">[ thread ]</a>
              <a href="subject.html#16303">[ subject ]</a>
              <a href="author.html#16303">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello LA, Yuri,

The server analysis at <A HREF="https://www.ssllabs.com/ssltest/analyze.html?d=help.ea.com&amp;s=52.0.220.87&amp;latest">https://www.ssllabs.com/ssltest/analyze.html?d=help.ea.com&amp;s=52.0.220.87&amp;latest</A> shows the certificate chain presented by the remote server is indeed incomplete, specifically the following certificate is not presented:

---
Symantec Class 3 Secure Server CA - G4
Fingerprint SHA256: eae72eb454bf6c3977ebd289e970b2f5282949190093d0d26f98d0f0d6a9cf17
Pin SHA256: 9n0izTnSRF+W4W4JTq51avSXkWhQB8duS2bxVLfzXsY=
RSA 2048 bits (e 65537) / SHA256withRSA
---

Adding it to the intermediate certificate file as indicated on <A HREF="https://docs.diladele.com/faq/squid/fix_unable_to_get_issuer_cert_locally.html#way-1-add-missing-certificate-to-squid-web-safety-5-1-recommended">https://docs.diladele.com/faq/squid/fix_unable_to_get_issuer_cert_locally.html#way-1-add-missing-certificate-to-squid-web-safety-5-1-recommended</A> and reloading Squid 3.5.23 allows to successfully see and bump the site.

Our UI generates exactly the same config setting as you have tried:
sslproxy_foreign_intermediate_certs /opt/websafety/etc/squid/foreign_intermediate_certs.pem

So it must be working :)

Best regards,
Rafael Akchurin
Diladele B.V.



-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of L A Walsh
Sent: Thursday, September 7, 2017 11:15 PM
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at squid-cache.org</A>
Subject: [squid-users] TLS: 1st time w/intermediate cert: not working; ideas on what I'm doing wrong?

Got an error message from squid where I'm doing https-bumping:

--------------------------
The following error was encountered while trying to retrieve the URL: 
<A HREF="https://help.ea.com/">https://help.ea.com/</A>

    *Failed to establish a secure connection to 52.0.220.87*

The system returned:

    (71) Protocol error (TLS code: X509_V_ERR_UNABLE_TO_GET_ISSUER_CERT_LOCALLY)

    SSL Certficate error: certificate issuer (CA) not known:
    /C=US/O=Symantec Corporation/OU=Symantec Trust Network/CN=Symantec
    Class 3 Secure Server CA - G4

This proxy and the remote host failed to negotiate a mutually acceptable security settings for handling your request. It is possible that the remote host does not support secure connections, or the proxy is not satisfied with the host security credentials.

--------------------------------

Googling found:
<A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Howto-fix-X509-V-ERR-UNABLE-TO-GET-ISSUER-CERT-LOCALLY-Squid-error-td4682015.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Howto-fix-X509-V-ERR-UNABLE-TO-GET-ISSUER-CERT-LOCALLY-Squid-error-td4682015.html</A>

Used openssl.com to get the intermediate certs (2 hosts are referenced in parallel chains).  The two certs looked like:

-----BEGIN CERTIFICATE-----
...hexstuff==
-----END CERTIFICATE-----


Added the certs to a file and that filename to my squid.conf on a line:

sslproxy_foreign_intermediate_certs /etc/squid/ssl_intermediates/cert.pem

restarted squid, but am still getting same error.

Am I missing some obvious step?

Looking for a clue... ;-)

Thanks!
-l






_______________________________________________
squid-users mailing list
<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
<A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016311.html">[squid-users] TLS: 1st time w/intermediate cert: not working; ideas on what I'm doing wrong?
</A></li>
	<LI>Next message (by thread): <A HREF="016304.html">[squid-users] TLS: 1st time w/intermediate cert: not working; ideas on what I'm doing wrong?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16303">[ date ]</a>
              <a href="thread.html#16303">[ thread ]</a>
              <a href="subject.html#16303">[ subject ]</a>
              <a href="author.html#16303">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
