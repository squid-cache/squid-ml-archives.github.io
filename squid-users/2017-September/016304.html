<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] TLS: 1st time w/intermediate cert: not working; ideas on what I'm doing wrong?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TLS%3A%201st%20time%20w/intermediate%20cert%3A%20not%20working%3B%0A%20ideas%20on%20what%20I%27m%20doing%20wrong%3F&In-Reply-To=%3C11116601-1553-37c9-2632-ac4cdbec1201%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016303.html">
   <LINK REL="Next"  HREF="016312.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] TLS: 1st time w/intermediate cert: not working; ideas on what I'm doing wrong?</H1>
    <B>Yuri</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20TLS%3A%201st%20time%20w/intermediate%20cert%3A%20not%20working%3B%0A%20ideas%20on%20what%20I%27m%20doing%20wrong%3F&In-Reply-To=%3C11116601-1553-37c9-2632-ac4cdbec1201%40gmail.com%3E"
       TITLE="[squid-users] TLS: 1st time w/intermediate cert: not working; ideas on what I'm doing wrong?">yvoinov at gmail.com
       </A><BR>
    <I>Thu Sep  7 21:44:40 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016303.html">[squid-users] TLS: 1st time w/intermediate cert: not working; ideas on what I'm doing wrong?
</A></li>
        <LI>Next message (by thread): <A HREF="016312.html">[squid-users] High memory usage associated with ssl_bump and broken	clients
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16304">[ date ]</a>
              <a href="thread.html#16304">[ thread ]</a>
              <a href="subject.html#16304">[ subject ]</a>
              <a href="author.html#16304">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, Raf. Just checking on two my servers - works like charm without any
movings :) I'm already have good intermediate CA's bundle :)


08.09.2017 3:42, Rafael Akchurin &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> Hello LA, Yuri,
</I>&gt;<i>
</I>&gt;<i> The server analysis at <A HREF="https://www.ssllabs.com/ssltest/analyze.html?d=help.ea.com&amp;s=52.0.220.87&amp;latest">https://www.ssllabs.com/ssltest/analyze.html?d=help.ea.com&amp;s=52.0.220.87&amp;latest</A> shows the certificate chain presented by the remote server is indeed incomplete, specifically the following certificate is not presented:
</I>&gt;<i>
</I>&gt;<i> ---
</I>&gt;<i> Symantec Class 3 Secure Server CA - G4
</I>&gt;<i> Fingerprint SHA256: eae72eb454bf6c3977ebd289e970b2f5282949190093d0d26f98d0f0d6a9cf17
</I>&gt;<i> Pin SHA256: 9n0izTnSRF+W4W4JTq51avSXkWhQB8duS2bxVLfzXsY=
</I>&gt;<i> RSA 2048 bits (e 65537) / SHA256withRSA
</I>&gt;<i> ---
</I>&gt;<i>
</I>&gt;<i> Adding it to the intermediate certificate file as indicated on <A HREF="https://docs.diladele.com/faq/squid/fix_unable_to_get_issuer_cert_locally.html#way-1-add-missing-certificate-to-squid-web-safety-5-1-recommended">https://docs.diladele.com/faq/squid/fix_unable_to_get_issuer_cert_locally.html#way-1-add-missing-certificate-to-squid-web-safety-5-1-recommended</A> and reloading Squid 3.5.23 allows to successfully see and bump the site.
</I>&gt;<i>
</I>&gt;<i> Our UI generates exactly the same config setting as you have tried:
</I>&gt;<i> sslproxy_foreign_intermediate_certs /opt/websafety/etc/squid/foreign_intermediate_certs.pem
</I>&gt;<i>
</I>&gt;<i> So it must be working :)
</I>&gt;<i>
</I>&gt;<i> Best regards,
</I>&gt;<i> Rafael Akchurin
</I>&gt;<i> Diladele B.V.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of L A Walsh
</I>&gt;<i> Sent: Thursday, September 7, 2017 11:15 PM
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at squid-cache.org</A>
</I>&gt;<i> Subject: [squid-users] TLS: 1st time w/intermediate cert: not working; ideas on what I'm doing wrong?
</I>&gt;<i>
</I>&gt;<i> Got an error message from squid where I'm doing https-bumping:
</I>&gt;<i>
</I>&gt;<i> --------------------------
</I>&gt;<i> The following error was encountered while trying to retrieve the URL: 
</I>&gt;<i> <A HREF="https://help.ea.com/">https://help.ea.com/</A>
</I>&gt;<i>
</I>&gt;<i>     *Failed to establish a secure connection to 52.0.220.87*
</I>&gt;<i>
</I>&gt;<i> The system returned:
</I>&gt;<i>
</I>&gt;<i>     (71) Protocol error (TLS code: X509_V_ERR_UNABLE_TO_GET_ISSUER_CERT_LOCALLY)
</I>&gt;<i>
</I>&gt;<i>     SSL Certficate error: certificate issuer (CA) not known:
</I>&gt;<i>     /C=US/O=Symantec Corporation/OU=Symantec Trust Network/CN=Symantec
</I>&gt;<i>     Class 3 Secure Server CA - G4
</I>&gt;<i>
</I>&gt;<i> This proxy and the remote host failed to negotiate a mutually acceptable security settings for handling your request. It is possible that the remote host does not support secure connections, or the proxy is not satisfied with the host security credentials.
</I>&gt;<i>
</I>&gt;<i> --------------------------------
</I>&gt;<i>
</I>&gt;<i> Googling found:
</I>&gt;<i> <A HREF="http://squid-web-proxy-cache.1019090.n4.nabble.com/Howto-fix-X509-V-ERR-UNABLE-TO-GET-ISSUER-CERT-LOCALLY-Squid-error-td4682015.html">http://squid-web-proxy-cache.1019090.n4.nabble.com/Howto-fix-X509-V-ERR-UNABLE-TO-GET-ISSUER-CERT-LOCALLY-Squid-error-td4682015.html</A>
</I>&gt;<i>
</I>&gt;<i> Used openssl.com to get the intermediate certs (2 hosts are referenced in parallel chains).  The two certs looked like:
</I>&gt;<i>
</I>&gt;<i> -----BEGIN CERTIFICATE-----
</I>&gt;<i> ...hexstuff==
</I>&gt;<i> -----END CERTIFICATE-----
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Added the certs to a file and that filename to my squid.conf on a line:
</I>&gt;<i>
</I>&gt;<i> sslproxy_foreign_intermediate_certs /etc/squid/ssl_intermediates/cert.pem
</I>&gt;<i>
</I>&gt;<i> restarted squid, but am still getting same error.
</I>&gt;<i>
</I>&gt;<i> Am I missing some obvious step?
</I>&gt;<i>
</I>&gt;<i> Looking for a clue... ;-)
</I>&gt;<i>
</I>&gt;<i> Thanks!
</I>&gt;<i> -l
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 473 bytes
Desc: OpenPGP digital signature
URL: &lt;<A HREF="http://lists.squid-cache.org/pipermail/squid-users/attachments/20170908/f2590d02/attachment.sig">http://lists.squid-cache.org/pipermail/squid-users/attachments/20170908/f2590d02/attachment.sig</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016303.html">[squid-users] TLS: 1st time w/intermediate cert: not working; ideas on what I'm doing wrong?
</A></li>
	<LI>Next message (by thread): <A HREF="016312.html">[squid-users] High memory usage associated with ssl_bump and broken	clients
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16304">[ date ]</a>
              <a href="thread.html#16304">[ thread ]</a>
              <a href="subject.html#16304">[ subject ]</a>
              <a href="author.html#16304">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
