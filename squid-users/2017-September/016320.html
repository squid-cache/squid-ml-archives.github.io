<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid cache takes a break
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20cache%20takes%20a%20break&In-Reply-To=%3C500349185.1012564.1505119741831%40mail.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016314.html">
   <LINK REL="Next"  HREF="016322.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid cache takes a break</H1>
    <B>Vieri</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20cache%20takes%20a%20break&In-Reply-To=%3C500349185.1012564.1505119741831%40mail.yahoo.com%3E"
       TITLE="[squid-users] squid cache takes a break">rentorbuy at yahoo.com
       </A><BR>
    <I>Mon Sep 11 08:49:01 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016314.html">[squid-users] squid cache takes a break
</A></li>
        <LI>Next message (by thread): <A HREF="016322.html">[squid-users] squid cache takes a break
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16320">[ date ]</a>
              <a href="thread.html#16320">[ thread ]</a>
              <a href="subject.html#16320">[ subject ]</a>
              <a href="author.html#16320">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
________________________________
From: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
&gt;<i>
</I>&gt;<i> a) start fewer helpers at a time.
</I>&gt;<i> 
</I>&gt;<i> b) reduce cache_mem.
</I>&gt;<i> 
</I>&gt;<i> c) add concurrency support to the helpers.
</I>

So I decreased the startup, idle, cache_mem values:

# egrep 'startup=|idle=' squid.conf
external_acl_type bllookup ttl=86400 negative_ttl=86400 children-max=80 children-startup=10 children-idle=3 %URI /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl [...]
sslcrtd_children 128 startup=10 idle=3

# grep cache_mem squid.conf
cache_mem 64 MB

I also set debug_options to &quot;ALL,1 5,9 50,6 51,3 54,9&quot;.

As far as concurrency is concerned, I never programmed a helper to support this feature.
If it were to be done in Perl, do you know by any chance if it would require Perl6 &quot;promises&quot; with await/start function calls?

Currently, my &quot;bllookup&quot; helper is a simple Perl5 script which reads from standard input like so:

while( &lt;STDIN&gt; )
{
[...lookup URI in a MySQL database and reply accordingly to Squid...]
}

It does not handle the channel-ID field.

I haven't found many Squid concurrency-enabled helper examples out there.

By the way, I see that Squid defaults to IPv6 for helper communications. I suppose it wouldn't make any real difference if I tried &quot;ipv4&quot; with &quot;external_acl_type&quot;.
If I don't get any new info next time Squid slows down to a crawl, I'll probably try ipv4 just for kicks.

What I still don't get is how long it takes for Squid to get back to work after I do a complete restart (after thoroughly killing all related processes, including helpers). I'm talking more than 5 minutes here...
If I ever get the same issue again, I understand that I can:

- stop squid &amp; eventually kill all apparently stalled processes

- modify squid.conf, and decrease or comment out all *startup= and *idle= options

- start squid

At this point, I should expect Squid to be up and serving within a reasonable amount of time, even if I may get squid warnings later on asking me to increase those values.
Or maybe not, because the Linux kernel might be busy cleaning up the swap space anyway?

One last thing. I'm running squid 3.5.26. I'll try to upgrade to 3.5.27 asap.

Thanks,

Vieri

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016314.html">[squid-users] squid cache takes a break
</A></li>
	<LI>Next message (by thread): <A HREF="016322.html">[squid-users] squid cache takes a break
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16320">[ date ]</a>
              <a href="thread.html#16320">[ thread ]</a>
              <a href="subject.html#16320">[ subject ]</a>
              <a href="author.html#16320">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
