<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] squid cache takes a break
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20cache%20takes%20a%20break&In-Reply-To=%3C04a501d32c1f%249528e550%24bf7aaff0%24%40ngtech.co.il%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016352.html">
   <LINK REL="Next"  HREF="016354.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] squid cache takes a break</H1>
    <B>Eliezer Croitoru</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20squid%20cache%20takes%20a%20break&In-Reply-To=%3C04a501d32c1f%249528e550%24bf7aaff0%24%40ngtech.co.il%3E"
       TITLE="[squid-users] squid cache takes a break">eliezer at ngtech.co.il
       </A><BR>
    <I>Tue Sep 12 23:33:48 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016352.html">[squid-users] squid cache takes a break
</A></li>
        <LI>Next message (by thread): <A HREF="016354.html">[squid-users] squid cache takes a break
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16353">[ date ]</a>
              <a href="thread.html#16353">[ thread ]</a>
              <a href="subject.html#16353">[ subject ]</a>
              <a href="author.html#16353">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Well, the ready to use products are not always what you need or want.
Even squid is not good enough for many scenarios...

If it works with shallalist it's nice but not the real deal for most cases.
Vieri might or might not clarify his scenario, but the issue here is not other then working with squid and a helper.

Eliezer

----
Eliezer Croitoru
Linux System Administrator
Mobile: +972-5-28704261
Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>



-----Original Message-----
From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Yuri
Sent: Tuesday, September 12, 2017 23:54
To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
Subject: Re: [squid-users] squid cache takes a break

It is just enough not to reinvent the wheel. What needs op - already
exists and is called ufdbguard. And it's works perfectly with shallalist :)


13.09.2017 2:51, Eliezer Croitoru &#1087;&#1080;&#1096;&#1077;&#1090;:
&gt;<i> I just must add that if you understand how TCP works(which the helpers use to communicate with squid) then it makes sense that it is possible that...
</I>&gt;<i> The sender (ie squid) sent 100 lines but the client software yet to process them since it's in the OS or other software\hardware related buffer.
</I>&gt;<i>
</I>&gt;<i> For me it was hard to understand at first since it's an STDIN\STDOUT interface so it would block after every write but it's not...
</I>&gt;<i>
</I>&gt;<i> There is a possibility that if the helper can process every incoming request with threading or other method of concurrency then the performance of the helper and by that squid will be better but if only using the basic buffer works fine for you then great.
</I>&gt;<i>
</I>&gt;<i> Eliezer
</I>&gt;<i>
</I>&gt;<i> ----
</I>&gt;<i> Eliezer Croitoru
</I>&gt;<i> Linux System Administrator
</I>&gt;<i> Mobile: +972-5-28704261
</I>&gt;<i> Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Amos Jeffries
</I>&gt;<i> Sent: Tuesday, September 12, 2017 16:08
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: Re: [squid-users] squid cache takes a break
</I>&gt;<i>
</I>&gt;<i> On 12/09/17 22:59, Vieri wrote:
</I>&gt;&gt;<i> ________________________________
</I>&gt;&gt;<i> From: Amos Jeffries &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid3 at treenet.co.nz</A>&gt;
</I>&gt;&gt;&gt;<i> That is all it needs to do to begin with; parse off the numeric value
</I>&gt;&gt;&gt;<i> from the input line and send it back as prefix on the output line. The
</I>&gt;&gt;&gt;<i> helper does not need threading or anything particularly special for the &gt; minimal support.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I thought it had to be asynchronous.
</I>&gt;&gt;<i> The docs say &quot;Only used with helpers capable of processing more than one query at a time.&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Example:
</I>&gt;&gt;<i> Squid sends &quot;1 URI1&quot; (or whatever) to the helper.
</I>&gt;&gt;<i> It does not wait for an immediate response.
</I>&gt;&gt;<i> In fact, Squid can send &quot;2 URI2&quot; before getting the reply to ID 1, right?
</I>&gt;<i> Yes.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> In my case, the helper is synchronous, non-MT. I don't think it will improve the time responses per-se.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In any case, my helper won't be able to process more than one query AT A TIME.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I tried it anyway. So here's the relevant code:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> while( &lt;STDIN&gt; )
</I>&gt;&gt;<i> {
</I>&gt;&gt;<i> s/^\s*//;
</I>&gt;&gt;<i> s/\s*$//;
</I>&gt;&gt;<i> my @squidin = split;
</I>&gt;&gt;<i> my $squidn = scalar @squidin;
</I>&gt;&gt;<i> undef $url;
</I>&gt;&gt;<i> undef $channelid;
</I>&gt;&gt;<i> if ( ($squidn == 2 ) &amp;&amp; (defined $squidin[0]) &amp;&amp; ($squidin[0] =~ /^\d+?$/) ) {
</I>&gt;&gt;<i> $channelid = $squidin[0];
</I>&gt;&gt;<i> $url = $squidin[1] if (defined $squidin[1]);
</I>&gt;&gt;<i> } else {
</I>&gt;&gt;<i> $url = $squidin[0] if (defined $squidin[0]);
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> [...]
</I>&gt;&gt;<i> logtofile(&quot;Channel-ID: &quot;.$channelid.&quot;\n&quot;) if ((defined $channelid) &amp;&amp; ($debug &gt;= 1));
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> [...do DB lookups, reply accordingly...]
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> if (defined $channelid) {
</I>&gt;&gt;<i> print( $channelid.&quot; OK\n&quot; );
</I>&gt;&gt;<i> logtofile( $channelid.&quot; OK\n&quot; ) if ($debug &gt;= 1);
</I>&gt;&gt;<i> } else {
</I>&gt;&gt;<i> print( &quot;OK\n&quot; );
</I>&gt;&gt;<i> logtofile( &quot;OK\n&quot; ) if ($debug &gt;= 1);
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i> [...similar responses for ERR messages...]
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Here's the relevant squid.conf line:
</I>&gt;&gt;<i> external_acl_type bllookup ttl=86400 negative_ttl=86400 children-max=80 children-startup=10 children-idle=3 concurrency=8 %URI /opt/custom/scripts/run/scripts/firewall/squid_url_lookup.pl [...]
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> How can I check in the Squid log that concurrency is &quot;working&quot;?
</I>&gt;<i> Section 82, level 2 or 4 should log the queries.
</I>&gt;<i>
</I>&gt;<i> Better info is in the cachemgr/squidclient &quot;external_acl&quot; report. Each 
</I>&gt;<i> helper is listed with its total and summary stats for each helper child.
</I>&gt;<i>
</I>&gt;&gt;<i> If the helper logs to a text file as in the trimmed code above, I notice that the channel ID is always 0. I get messages such as:
</I>&gt;&gt;<i> Channel-ID: 0
</I>&gt;&gt;<i> 0 OK
</I>&gt;&gt;<i> Channel-ID: 0
</I>&gt;&gt;<i> 0 ERR ...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Is this expected?
</I>&gt;<i> Maybe.
</I>&gt;<i>
</I>&gt;<i> If you make the helper pause a bit and throw a large number of different 
</I>&gt;<i> URLs at Squid you should see it grow a bit higher than 0.
</I>&gt;<i>
</I>&gt;&gt;<i> Despite this, I can see that the number of helper processes does not increase over time for now, and that HTTP/S client browsing is responsive enough.
</I>&gt;&gt;<i> # ps aux | grep -c squid_url_lookup.pl
</I>&gt;&gt;<i> 11
</I>&gt;&gt;<i>
</I>&gt;<i> Yay.
</I>&gt;<i>
</I>&gt;&gt;<i> One last thing. I'm using:
</I>&gt;&gt;<i> cache_dir diskd /var/cache/squid 100 16 256
</I>&gt;&gt;<i> I may want to try to comment out this directive for improved I/O performance.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Vieri
</I>&gt;<i> Cheers
</I>&gt;<i> Amos
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016352.html">[squid-users] squid cache takes a break
</A></li>
	<LI>Next message (by thread): <A HREF="016354.html">[squid-users] squid cache takes a break
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16353">[ date ]</a>
              <a href="thread.html#16353">[ thread ]</a>
              <a href="subject.html#16353">[ subject ]</a>
              <a href="author.html#16353">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
