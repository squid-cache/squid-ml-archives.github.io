<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Is it a good idea to use Linux swap partition/file with rock storage?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Is%20it%20a%20good%20idea%20to%20use%20Linux%20swap%0A%20partition/file%20with%20rock%20storage%3F&In-Reply-To=%3Cc29e1690-bc49-c8be-e332-cc07db10b770%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016382.html">
   <LINK REL="Next"  HREF="016383.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Is it a good idea to use Linux swap partition/file with rock storage?</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Is%20it%20a%20good%20idea%20to%20use%20Linux%20swap%0A%20partition/file%20with%20rock%20storage%3F&In-Reply-To=%3Cc29e1690-bc49-c8be-e332-cc07db10b770%40treenet.co.nz%3E"
       TITLE="[squid-users] Is it a good idea to use Linux swap partition/file with rock storage?">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Sep 19 09:43:47 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016382.html">[squid-users] Is it a good idea to use Linux swap partition/file	with rock storage?
</A></li>
        <LI>Next message (by thread): <A HREF="016383.html">[squid-users] Squid 3.5.27 for Microsoft Windows 64-bit is available
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16385">[ date ]</a>
              <a href="thread.html#16385">[ thread ]</a>
              <a href="subject.html#16385">[ subject ]</a>
              <a href="author.html#16385">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 19/09/17 18:25, duanyao wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I notice that squid's rock storage uses large (and fixed) amount of 
</I>&gt;<i> shared memory even if it is not accessed. It's estimated as 
</I>&gt;<i> 110byte/slot, so for a 256GB rock storage with 16KB slot, the memory 
</I>&gt;<i> requirement is about 1.7GB, which is quite large.
</I>&gt;<i> 
</I>&gt;<i> So my questions are:
</I>&gt;<i> 
</I>&gt;<i> 1. Is there a way to reduce memory usage of rock storage?
</I>&gt;<i> 
</I>
Reducing the cache size is the only thing that will do that.

For the entire time your Squid is running it is adding to the cache 
contents. The rate of growth decreases over time, but will only ever 
stop growing if the cache reaches 100% full.

So going out of your way to make it use less memory during that warm-up 
phaze is pointless long-term. The memory *is* needed and not having it 
available for use with zero advance notice will lead to serious 
performance problems, up to and including DoS vulnerability in your proxy.

For general memory reduction see the FAQ:
&lt;<A HREF="https://wiki.squid-cache.org/SquidFaq/SquidMemory#What_can_I_do_to_reduce_Squid.27s_memory_usage.3F">https://wiki.squid-cache.org/SquidFaq/SquidMemory#What_can_I_do_to_reduce_Squid.27s_memory_usage.3F</A>&gt;


&gt;<i> 2. On Linux squid puts its shared memory in /dev/shm, which can be 
</I>&gt;<i> backed by swap partition/file. Is it a good idea to use swap 
</I>&gt;<i> partition/file with rock storage to save some physical memory?
</I>&gt;<i> 
</I>
Definitely No. The cache index has an extremely high rate of churn and a 
large number of random location reads per transaction. If any of it ever 
gets pushed out to a swap disk/file the proxy operational speed 
undergoes a performance reduction of 3-4 orders of magnitude. eg. 50GBps 
-&gt; 2MBps.


&gt;<i> 3. For rock storage, are /dev/shm/squid* frequently and randomly 
</I>&gt;<i> written? If the Linux swap is on SSD, will this causes 
</I>&gt;<i> performance/lifetime issues?
</I>&gt;<i> 
</I>
see the answer to (2).

Squid stresses disks in ways vastly different to what manufacturers 
optimize the hardware to handle. The HTTP caches have a very high 
write-to-read ratio. No disk actually survives more than a fraction of 
its manufacturer advertised lifetime. This problem is less visible with 
HDD due to their naturally long lifetimes.

Specific to your question, due to the churn mentioned in (2) using a 
disk as storage location for the cache index faces it with the worst of 
both worlds - very high read throughput and even higher write 
throughput. SSD avoid (some of) the speed problem, but at cost of 
shorter lifetimes. So the churn is much more relevant and perhapse 
costly in hardware replacements.

YMMV depending on the specific SSD model and how it is designed to cope 
with dead sectors - but it is guaranteed to wear out much faster than 
advertised.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016382.html">[squid-users] Is it a good idea to use Linux swap partition/file	with rock storage?
</A></li>
	<LI>Next message (by thread): <A HREF="016383.html">[squid-users] Squid 3.5.27 for Microsoft Windows 64-bit is available
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16385">[ date ]</a>
              <a href="thread.html#16385">[ thread ]</a>
              <a href="subject.html#16385">[ subject ]</a>
              <a href="author.html#16385">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
