<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Peek and Splice - Termination Log
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Peek%20and%20Splice%20-%20Termination%20Log&In-Reply-To=%3C4626D608-CC19-486E-BA71-259A55FCEEE3%40daveramsey.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016447.html">
   <LINK REL="Next"  HREF="016424.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Peek and Splice - Termination Log</H1>
    <B>Eric Lackey</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Peek%20and%20Splice%20-%20Termination%20Log&In-Reply-To=%3C4626D608-CC19-486E-BA71-259A55FCEEE3%40daveramsey.com%3E"
       TITLE="[squid-users] Peek and Splice - Termination Log">EricL at daveramsey.com
       </A><BR>
    <I>Fri Sep 22 15:27:18 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016447.html">[squid-users] Negotiate Authenticator and DNS
</A></li>
        <LI>Next message (by thread): <A HREF="016424.html">[squid-users] Peek and Splice - Termination Log
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16419">[ date ]</a>
              <a href="thread.html#16419">[ thread ]</a>
              <a href="subject.html#16419">[ subject ]</a>
              <a href="author.html#16419">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello, we&#8217;re beginning to enable the Peek and Splice feature on Squid 3.5. Our ssl_bump configuration looks like below where we&#8217;re validating the request matches a domain in our allowed_sites file and then terminating the SSL connection if it does not. 

This is all working well except for the fact that we don&#8217;t have a good way to determine what is being blocked. In the configuration below, the only log we get is when Squid connects to the external server to get the SSL certificate and that is usually a 200 response. If the domain does not match our allowed list the connection is then terminated and no additional log is written. 

I know that we can see this in cache.log by enabling debugging (debug_options 28,4), but that&#8217;s a large amount of log data to try to process and report on and the structure of the log is not something that we can easily ingest into our logging platform. It would be great if we could get it into a JSON format similar to how we can with access_log. 

Does anyone else have a solution for this and if not, is this something that has been requested as a feature in the past?

Thanks in advance for any help.

======

# Define allowed sites
acl allowed_https_sites ssl::server_name_regex &quot;/etc/squid/allowed_sites&quot;

ssl_bump peek all
ssl_bump splice allowed_https_sites
ssl_bump terminate step3 all

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016447.html">[squid-users] Negotiate Authenticator and DNS
</A></li>
	<LI>Next message (by thread): <A HREF="016424.html">[squid-users] Peek and Splice - Termination Log
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16419">[ date ]</a>
              <a href="thread.html#16419">[ thread ]</a>
              <a href="subject.html#16419">[ subject ]</a>
              <a href="author.html#16419">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
