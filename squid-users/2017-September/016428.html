<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Bug: Missing MemObject::storeId value
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Bug%3A%20Missing%20MemObject%3A%3AstoreId%20value&In-Reply-To=%3CCANAZdzVHj_hbmv%3D8ChDUSH_-UOHFPNc3VUurmiVROeJOMAtwYg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016427.html">
   <LINK REL="Next"  HREF="016431.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Bug: Missing MemObject::storeId value</H1>
    <B>Aaron Turner</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Bug%3A%20Missing%20MemObject%3A%3AstoreId%20value&In-Reply-To=%3CCANAZdzVHj_hbmv%3D8ChDUSH_-UOHFPNc3VUurmiVROeJOMAtwYg%40mail.gmail.com%3E"
       TITLE="[squid-users] Bug: Missing MemObject::storeId value">synfinatic at gmail.com
       </A><BR>
    <I>Mon Sep 25 19:56:56 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016427.html">[squid-users] Bug: Missing MemObject::storeId value
</A></li>
        <LI>Next message (by thread): <A HREF="016431.html">[squid-users] Bug: Missing MemObject::storeId value
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16428">[ date ]</a>
              <a href="thread.html#16428">[ thread ]</a>
              <a href="subject.html#16428">[ subject ]</a>
              <a href="author.html#16428">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>So is v4 stable?  I was the impression it was beta?  That said, if v4
has better memory tuning options then I'm all ears.  Right now I'm
fighting OOM errors (and the kernel OOM reaper) under sustained load.
I've come to realize 6GB is way way too much for my 14GB RAM systems,
but finding even 1GB is too much since each squid process is exceeding
4GB.  About to try 500MB now.

I can disable rock cache, but I need some disk cache- is there a better option?

As for haproxy, I actually don't care about the client IP... I'm
running haproxy locally on the servers where the clients reside.
Mostly I'm using it for squid failover and cache affinity so I don't
have to make all my caches peers of each other.


--
Aaron Turner
<A HREF="https://synfin.net/">https://synfin.net/</A>         Twitter: @synfinatic
My father once told me that respect for the truth comes close to being
the basis for all morality.  &quot;Something cannot emerge from nothing,&quot;
he said.  This is profound thinking if you understand how unstable
&quot;the truth&quot; can be.  -- Frank Herbert, Dune


On Mon, Sep 25, 2017 at 11:45 AM, Eliezer Croitoru &lt;<A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>&gt; wrote:
&gt;<i> Hey Aaron,
</I>&gt;<i>
</I>&gt;<i> Just to clear out the doubt's, what happen when you use squid-cache without rock cache_dir? Is the problem appearing again?
</I>&gt;<i> Also, there is a possibility of a bug which is related to squid ssl-bump termination code on 3.5.X.
</I>&gt;<i> Testing 4.0.21 would be the best to understand if the issue is 3.5 local or if it was fixed in 4.X+ but, from my memory I think you will need to adapt your squid.conf ssl_bump configurations.
</I>&gt;<i> You can get the latest beta and stable binaries from my repo and the beta repo details are at:
</I>&gt;<i> <A HREF="https://wiki.squid-cache.org/action/edit/KnowledgeBase/CentOS#Squid_Beta_release">https://wiki.squid-cache.org/action/edit/KnowledgeBase/CentOS#Squid_Beta_release</A>
</I>&gt;<i>
</I>&gt;<i> Also, since you are using haproxy in front of squid I would suggest you to use the proxy protocol(v1) which is the best way to pass the source ip addresses to the proxy.
</I>&gt;<i> I have tested squid to work with the proxy protocol v1 but yet to test v2.
</I>&gt;<i>
</I>&gt;<i> All The Bests,
</I>&gt;<i> Eliezer
</I>&gt;<i>
</I>&gt;<i> ----
</I>&gt;<i> Eliezer Croitoru
</I>&gt;<i> Linux System Administrator
</I>&gt;<i> Mobile: +972-5-28704261
</I>&gt;<i> Email: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">eliezer at ngtech.co.il</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: squid-users [mailto:<A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users-bounces at lists.squid-cache.org</A>] On Behalf Of Aaron Turner
</I>&gt;<i> Sent: Saturday, September 23, 2017 02:19
</I>&gt;<i> To: <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> Subject: [squid-users] Bug: Missing MemObject::storeId value
</I>&gt;<i>
</I>&gt;<i> Version: 3.5.26 on CentOS 7.3 on AWS EC2 m3.xlarge and 2x 100GB EBS
</I>&gt;<i> volumes for rock cache.
</I>&gt;<i>
</I>&gt;<i> Doing some basic system tests and we're seeing a bunch of errors like:
</I>&gt;<i>
</I>&gt;<i> 2017/09/22 22:43:15 kid1| Bug: Missing MemObject::storeId value
</I>&gt;<i> 2017/09/22 22:43:15 kid1| mem_hdr: 0x7f169d0a2a70 nodes.start() 0x7f169c6cc9d0
</I>&gt;<i> 2017/09/22 22:43:15 kid1| mem_hdr: 0x7f169d0a2a70 nodes.finish() 0x7f169dae4e40
</I>&gt;<i> 2017/09/22 22:43:15 kid1| MemObject-&gt;start_ping: 0.000000
</I>&gt;<i> 2017/09/22 22:43:15 kid1| MemObject-&gt;inmem_hi: 20209
</I>&gt;<i> 2017/09/22 22:43:15 kid1| MemObject-&gt;inmem_lo: 0
</I>&gt;<i> 2017/09/22 22:43:15 kid1| MemObject-&gt;nclients: 0
</I>&gt;<i> 2017/09/22 22:43:15 kid1| MemObject-&gt;reply: 0x7f167ee60db0
</I>&gt;<i> 2017/09/22 22:43:15 kid1| MemObject-&gt;request: 0
</I>&gt;<i> 2017/09/22 22:43:15 kid1| MemObject-&gt;logUri:
</I>&gt;<i> 2017/09/22 22:43:15 kid1| MemObject-&gt;storeId:
</I>&gt;<i> 2017/09/22 22:43:15 kid1| Bug: Missing MemObject::storeId value
</I>&gt;<i> 2017/09/22 22:43:15 kid1| mem_hdr: 0x7f16a0388760 nodes.start() 0x7f16a6a4a500
</I>&gt;<i> 2017/09/22 22:43:15 kid1| mem_hdr: 0x7f16a0388760 nodes.finish() 0x7f16a6a4a4d0
</I>&gt;<i> 2017/09/22 22:43:15 kid1| MemObject-&gt;start_ping: 0.000000
</I>&gt;<i> 2017/09/22 22:43:15 kid1| MemObject-&gt;inmem_hi: 50265
</I>&gt;<i> 2017/09/22 22:43:15 kid1| MemObject-&gt;inmem_lo: 0
</I>&gt;<i> 2017/09/22 22:43:15 kid1| MemObject-&gt;nclients: 0
</I>&gt;<i> 2017/09/22 22:43:15 kid1| MemObject-&gt;reply: 0x7f169f83d7d0
</I>&gt;<i> 2017/09/22 22:43:15 kid1| MemObject-&gt;request: 0
</I>&gt;<i> 2017/09/22 22:43:15 kid1| MemObject-&gt;logUri:
</I>&gt;<i> 2017/09/22 22:43:15 kid1| MemObject-&gt;storeId:
</I>&gt;<i>
</I>&gt;<i> I did some googling and seems like a lot of comments about this with
</I>&gt;<i> Rock (we're using) and ICP/HTCP (not using).  Curious if this the same
</I>&gt;<i> bug or something new?  Are there config changes we can make to prevent
</I>&gt;<i> this (perhaps switching away from rock cache??)
</I>&gt;<i>
</I>&gt;<i> We have a bunch of clients behind haproxy which is load balancing to
</I>&gt;<i> 4x Squid.  Config of the squids is as:
</I>&gt;<i>
</I>&gt;<i> http_access allow localhost manager
</I>&gt;<i> http_access deny manager
</I>&gt;<i>
</I>&gt;<i> external_acl_type client_ip_map_0 %&gt;ha{Our-Client}
</I>&gt;<i> /usr/lib64/squid/user_loadbalance.py 0 4
</I>&gt;<i> external_acl_type client_ip_map_1 %&gt;ha{Our-Client}
</I>&gt;<i> /usr/lib64/squid/user_loadbalance.py 1 4
</I>&gt;<i> external_acl_type client_ip_map_2 %&gt;ha{Our-Client}
</I>&gt;<i> /usr/lib64/squid/user_loadbalance.py 2 4
</I>&gt;<i> external_acl_type client_ip_map_3 %&gt;ha{Our-Client}
</I>&gt;<i> /usr/lib64/squid/user_loadbalance.py 3 4
</I>&gt;<i>
</I>&gt;<i> acl client_group_0 external client_ip_map_0
</I>&gt;<i> acl client_group_1 external client_ip_map_1
</I>&gt;<i> acl client_group_2 external client_ip_map_2
</I>&gt;<i> acl client_group_3 external client_ip_map_3
</I>&gt;<i>
</I>&gt;<i> http_access allow client_group_0
</I>&gt;<i> http_access allow client_group_1
</I>&gt;<i> http_access allow client_group_2
</I>&gt;<i> http_access allow client_group_3
</I>&gt;<i> http_access deny all
</I>&gt;<i>
</I>&gt;<i> tcp_outgoing_address 10.93.2.41 client_group_0
</I>&gt;<i> tcp_outgoing_address 10.93.2.76 client_group_1
</I>&gt;<i> tcp_outgoing_address 10.93.2.198 client_group_2
</I>&gt;<i> tcp_outgoing_address 10.93.3.178 client_group_3
</I>&gt;<i>
</I>&gt;<i> cache_dir rock /var/lib/squid/cache1 51200
</I>&gt;<i> cache_dir rock /var/lib/squid/cache2 51200
</I>&gt;<i> coredump_dir /var/spool/squid
</I>&gt;<i> maximum_object_size_in_memory 8 MB
</I>&gt;<i> maximum_object_size 8 MB
</I>&gt;<i>
</I>&gt;<i> cache_mem 6 GB
</I>&gt;<i> memory_cache_shared on
</I>&gt;<i> workers 4
</I>&gt;<i>
</I>&gt;<i> refresh_pattern . 0 100% 30
</I>&gt;<i>
</I>&gt;<i> http_port squid0001:3128 ssl-bump generate-host-certificates=on
</I>&gt;<i> dynamic_cert_mem_cache_size=400MB cert=/etc/squid/ssl_cert/myCA.pem
</I>&gt;<i> http_port localhost:3128
</I>&gt;<i> ssl_bump bump all
</I>&gt;<i>
</I>&gt;<i> request_header_access Our-Client deny all
</I>&gt;<i> request_header_access Via deny all
</I>&gt;<i> forwarded_for delete
</I>&gt;<i>
</I>&gt;<i> visible_hostname squid0001.lab.company.com
</I>&gt;<i> logformat adttest %tg %6tr %&gt;a %Ss/%03&gt;Hs %&lt;st %rm %&gt;ru %[un %Sh/%&lt;a %mt %ea
</I>&gt;<i> access_log daemon:/var/log/squid/access.${process_number}.log adttest
</I>&gt;<i> icon_directory /usr/share/squid/icons
</I>&gt;<i>
</I>&gt;<i> sslcrtd_program /usr/lib64/squid/ssl_crtd -s /var/lib/squid/ssl_db -M 4MB
</I>&gt;<i> sslcrtd_children 32 startup=2 idle=2
</I>&gt;<i> sslproxy_session_cache_size 100 MB
</I>&gt;<i> sslproxy_cert_error allow all
</I>&gt;<i> sslproxy_flags DONT_VERIFY_PEER
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Aaron Turner
</I>&gt;<i> <A HREF="https://synfin.net/">https://synfin.net/</A>         Twitter: @synfinatic
</I>&gt;<i> My father once told me that respect for the truth comes close to being
</I>&gt;<i> the basis for all morality.  &quot;Something cannot emerge from nothing,&quot;
</I>&gt;<i> he said.  This is profound thinking if you understand how unstable
</I>&gt;<i> &quot;the truth&quot; can be.  -- Frank Herbert, Dune
</I>&gt;<i> _______________________________________________
</I>&gt;<i> squid-users mailing list
</I>&gt;<i> <A HREF="https://lists.squid-cache.org/listinfo/squid-users">squid-users at lists.squid-cache.org</A>
</I>&gt;<i> <A HREF="http://lists.squid-cache.org/listinfo/squid-users">http://lists.squid-cache.org/listinfo/squid-users</A>
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016427.html">[squid-users] Bug: Missing MemObject::storeId value
</A></li>
	<LI>Next message (by thread): <A HREF="016431.html">[squid-users] Bug: Missing MemObject::storeId value
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16428">[ date ]</a>
              <a href="thread.html#16428">[ thread ]</a>
              <a href="subject.html#16428">[ subject ]</a>
              <a href="author.html#16428">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
