<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] cache hit rate isn't what I'd expect
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20cache%20hit%20rate%20isn%27t%20what%20I%27d%20expect&In-Reply-To=%3Ca5a92f62-e187-e7c0-f667-9d7773041b2f%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016481.html">
   <LINK REL="Next"  HREF="016485.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] cache hit rate isn't what I'd expect</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20cache%20hit%20rate%20isn%27t%20what%20I%27d%20expect&In-Reply-To=%3Ca5a92f62-e187-e7c0-f667-9d7773041b2f%40treenet.co.nz%3E"
       TITLE="[squid-users] cache hit rate isn't what I'd expect">squid3 at treenet.co.nz
       </A><BR>
    <I>Thu Sep 28 22:47:29 UTC 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="016481.html">[squid-users] cache hit rate isn't what I'd expect
</A></li>
        <LI>Next message (by thread): <A HREF="016485.html">[squid-users] cache hit rate isn't what I'd expect
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16483">[ date ]</a>
              <a href="thread.html#16483">[ thread ]</a>
              <a href="subject.html#16483">[ subject ]</a>
              <a href="author.html#16483">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 29/09/17 11:29, Aaron Turner wrote:
&gt;<i> So this grep through my access logs for this single URL does a good
</I>&gt;<i> job illustrating a rather interesting problem:
</I>&gt;<i> 
</I>&gt;<i> $ grep -h '<A HREF="https://static.licdn.com/sc/h/ddzuq7qeny6qn0ysh3hj6pzmr">https://static.licdn.com/sc/h/ddzuq7qeny6qn0ysh3hj6pzmr</A>
</I>&gt;<i> text/css ip_index=0,client=m0078269' access.*.log | sort
</I>&gt;<i> 
</I>&gt;<i> 
</I>...
 &gt;
&gt;<i> At first I thought this was because the because I have a bunch of
</I>&gt;<i> clients, each of which behaves exactly the same except for one thing:
</I>&gt;<i> the client includes a unique request header that squid strips off
</I>&gt;<i> before forwarding to the server (you can see it logged as
</I>&gt;<i> client=mXXXXX_XXXX).  But in this case I've controlled for that and
</I>&gt;<i> only grep'd for a single client's request.  I've even tried setting
</I>&gt;<i> &quot;vary_ignore_expire on&quot;, but that doesn't seem to be a complete fix.
</I>&gt;<i> 
</I>&gt;<i> I can't for the life of me understand why the low hit rate though.
</I>&gt;<i> 
</I>
The duration and size fields are quite useful for detecting reasons for 
HIT/MISS.

Request headers should not affect the response caching, unless they are 
listed in the servers Vary header.

In this case the server is delivering broken Vary responses. redbot.org 
says it is using Vary:Accept-Encoding sometimes, so both the Vary and 
Accept-Encoding would be useful info to log.

I expect it is the usual problem of clients fighting over whose variant 
gets cached when this type of server breakage happens - when the Vary 
header changes or disappears, old variants become unfindable until it 
changes back.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="016481.html">[squid-users] cache hit rate isn't what I'd expect
</A></li>
	<LI>Next message (by thread): <A HREF="016485.html">[squid-users] cache hit rate isn't what I'd expect
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16483">[ date ]</a>
              <a href="thread.html#16483">[ thread ]</a>
              <a href="subject.html#16483">[ subject ]</a>
              <a href="author.html#16483">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
