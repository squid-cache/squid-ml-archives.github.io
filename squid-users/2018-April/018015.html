<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] allways_direct SSL
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20allways_direct%20SSL&In-Reply-To=%3Cc826f6de-f955-8e27-932d-3940d5d04baa%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018014.html">
   <LINK REL="Next"  HREF="018019.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] allways_direct SSL</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20allways_direct%20SSL&In-Reply-To=%3Cc826f6de-f955-8e27-932d-3940d5d04baa%40treenet.co.nz%3E"
       TITLE="[squid-users] allways_direct SSL">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Apr  6 10:22:14 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018014.html">[squid-users] allways_direct SSL
</A></li>
        <LI>Next message (by thread): <A HREF="018019.html">[squid-users] Proxy through another proxy possible?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18015">[ date ]</a>
              <a href="thread.html#18015">[ thread ]</a>
              <a href="subject.html#18015">[ subject ]</a>
              <a href="author.html#18015">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 06/04/18 20:02, j.emerlik wrote:
&gt;<i> On Thu, Apr 5, 2018, 23:44 Amos Jeffries wrote:
</I>&gt;<i> 
</I>&gt;<i>     On 06/04/18 08:56, j.e. wrote:
</I>&gt;<i>     &gt; (squid 3.5) I have in my config acl for some domains like:
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; acl mydomains dstdomain &quot;/usr/local.....&quot;
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; and
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; cache_peer_access 10.10.x.x allow mydomains
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; so all http traffic to domains from my list is forwarded (port 80)&#160;to
</I>&gt;<i>     &gt; another squid and that's&#160;works correct but only for port 80,
</I>&gt;<i>     traffic to
</I>&gt;<i>     &gt; port 443 does work probably because there in config is set:
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; allways_direct allow SSL_ports
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; and forwarding to&#160;my another squid not working.
</I>&gt;<i> 
</I>&gt;<i>     How is your cache_peer directive setup?
</I>&gt;<i> 
</I>&gt;<i>     It is more likely because your peer is not setup to receive HTTPS
</I>&gt;<i>     traffic, so the &quot;mydomains&quot; stuff is not going where you may think.
</I>&gt;<i> 
</I>&gt;<i>     Amos
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Thx for response , below part of my config :
</I>&gt;<i> 
</I>&gt;<i> cache_peer 10.10.x.x parent 31281 0 proxy-only no-tproxy
</I>&gt;<i> 
</I>&gt;<i> acl mydomains dstdomain &quot;use/local.....&quot;
</I>&gt;<i> 
</I>&gt;<i> cache_pee_access 10.10.x.x allow mydomain
</I>&gt;<i> 
</I>&gt;<i> never_direct allow mydomain
</I>&gt;<i> 
</I>&gt;<i> peer_connect_timeout 5 seconds
</I>&gt;<i> 
</I>
Okay. So normal forward-proxy setup.

If the port 443 traffic is being intercepted then SSL-Bump'ed, then
Squid requires that cache_peer connection to be using TLS/SSL in order
to deliver it there. For that this Squid requires the 'ssl cafile='
options, with the CA one pointing to a PEM file containing public cert
of the CA which signed the peers server certificate.
 The peer of course requires its listening port (or another) to have TLS
setup at its end, and appropriate security setting for its own outbound
connections.

Other non-bumped traffic and CONNECT messages should &quot;just work&quot; already.


[ While TLS being end-to-end is a myth, Squid and most TLS software
still do ensure the whole connection chain stays secured. So no
conversions from HTTPS to HTTP in either direction along the way. ]

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018014.html">[squid-users] allways_direct SSL
</A></li>
	<LI>Next message (by thread): <A HREF="018019.html">[squid-users] Proxy through another proxy possible?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18015">[ date ]</a>
              <a href="thread.html#18015">[ thread ]</a>
              <a href="subject.html#18015">[ subject ]</a>
              <a href="author.html#18015">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
