<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid4 '%&lt;la' empty sometimes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid4%20%27%25%3Cla%27%20empty%20sometimes&In-Reply-To=%3Ce1b0d696-1574-b840-840d-8ed77ace902e%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018016.html">
   <LINK REL="Next"  HREF="018018.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid4 '%&lt;la' empty sometimes</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid4%20%27%25%3Cla%27%20empty%20sometimes&In-Reply-To=%3Ce1b0d696-1574-b840-840d-8ed77ace902e%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid4 '%&lt;la' empty sometimes">squid3 at treenet.co.nz
       </A><BR>
    <I>Fri Apr  6 13:59:46 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018016.html">[squid-users] Squid4 '%&lt;la' empty sometimes
</A></li>
        <LI>Next message (by thread): <A HREF="018018.html">[squid-users] Squid4 '%&lt;la' empty sometimes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18017">[ date ]</a>
              <a href="thread.html#18017">[ thread ]</a>
              <a href="subject.html#18017">[ subject ]</a>
              <a href="author.html#18017">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 07/04/18 00:48, Peter Viskup wrote:
&gt;<i> Amos,
</I>&gt;<i> thank you for your helpful reply.
</I>&gt;<i> 
</I>&gt;<i> Setup with use of %note is working. Both servers have same
</I>&gt;<i> configuration from GIT. Added one include for the proxyNode note
</I>&gt;<i> configuration with &quot;GIT ignore&quot; flag on that file.
</I>&gt;<i> Realized the note can be used to track the ACL the transaction passed to.
</I>&gt;<i> 
</I>&gt;<i> Proxy node ID:
</I>&gt;<i> note proxyNode 10.x.y.a
</I>&gt;<i> logformat ... proxyNode=%{proxyNode}note ...
</I>&gt;<i> 
</I>&gt;<i> Passed via ACL:
</I>&gt;<i> acl sslstep1 at_step SslBump1
</I>&gt;<i> acl sslstep3 at_step SslBump3
</I>&gt;<i> 
</I>&gt;<i> acl test_s src &lt;some_ip&gt;
</I>&gt;<i> acl test_d dstdomain &lt;some_domain&gt;
</I>&gt;<i> acl test_ssl ssl::server_name &lt;some_domain&gt;
</I>&gt;<i> acl SSH_port port 22
</I>&gt;<i> 
</I>&gt;<i> # splice at step1 for SSH connections
</I>&gt;<i> note acl test_splice_ssh test_s test_d SSH_port
</I>&gt;<i> ssl_bump splice sslstep1 test_s test_d SSH_port
</I>
dstdomain ACL type (test_d is not valid at ssl_bump processing time. The
HTTP request the domain comes from has not (yet or ever) been decrypted
from the crypted bytes.


&gt;<i> 
</I>&gt;<i> # splice at step3 for other TLS connections
</I>&gt;<i> note acl test_splice_http test_s test_ssl
</I>&gt;<i> ssl_bump splice sslstep3 test_s test_ssl
</I>&gt;<i> 
</I>&gt;<i> logformat ... acl=%{acl}note ...
</I>
Well, yes for this - but take care. Since the 'note ...' directive is
ONLY evaluated right at logging time it may show the wrong thing if the
ACL state changes between the initial directive (ssl_bump) evaluation
and the logging at the end of the transaction.
For example;
* the ssl_server_name ACL state changes with each SSL-Bump step that
completes, and
* dstdomain uses DNS lookups when only a raw-IP exists (eg in ssl_bump
step 1). The DNS records may expire and be changed in the time it takes
to transfer all the data in a spliced tunnel, before note re-runs the
dstdomain test_d check for logging.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018016.html">[squid-users] Squid4 '%&lt;la' empty sometimes
</A></li>
	<LI>Next message (by thread): <A HREF="018018.html">[squid-users] Squid4 '%&lt;la' empty sometimes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18017">[ date ]</a>
              <a href="thread.html#18017">[ thread ]</a>
              <a href="subject.html#18017">[ subject ]</a>
              <a href="author.html#18017">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
