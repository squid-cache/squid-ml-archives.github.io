<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid ipcache and DNS TTL smaller than 60 seconds
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20ipcache%20and%20DNS%20TTL%20smaller%20than%2060%20seconds&In-Reply-To=%3C8aa3ffd6-0bfc-d0c9-08d4-d87fa980fc50%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018053.html">
   <LINK REL="Next"  HREF="018058.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid ipcache and DNS TTL smaller than 60 seconds</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20ipcache%20and%20DNS%20TTL%20smaller%20than%2060%20seconds&In-Reply-To=%3C8aa3ffd6-0bfc-d0c9-08d4-d87fa980fc50%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid ipcache and DNS TTL smaller than 60 seconds">squid3 at treenet.co.nz
       </A><BR>
    <I>Tue Apr 10 15:19:35 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018053.html">[squid-users] Squid ipcache and DNS TTL smaller than 60 seconds
</A></li>
        <LI>Next message (by thread): <A HREF="018058.html">[squid-users] Squid ipcache and DNS TTL smaller than 60 seconds
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18055">[ date ]</a>
              <a href="thread.html#18055">[ thread ]</a>
              <a href="subject.html#18055">[ subject ]</a>
              <a href="author.html#18055">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 11/04/18 02:14, Peter Viskup wrote:
&gt;<i> Squid use TTL of 60 seconds for DNS resource records with TTL smaller
</I>&gt;<i> than that value.
</I>&gt;<i> 
</I>&gt;<i> Some sites can have DNS TTL set to lower value due to high availability
</I>&gt;<i> design (DNS load balancer).
</I>&gt;<i> 
</I>&gt;<i> In RFCs [1][2][3] it is explained the received TTL can be lowered to the
</I>&gt;<i> upper bound TTL value of DNS cache, but not to increase it.
</I>&gt;<i> 
</I>&gt;<i> Is it possible to change that 60 seconds default somewhere in
</I>&gt;<i> configuration? Was the 60 seconds default chosen according some reference?
</I>&gt;<i> 
</I>
&lt;<A HREF="http://www.squid-cache.org/Doc/config/negative_dns_ttl/">http://www.squid-cache.org/Doc/config/negative_dns_ttl/</A>&gt;

Please note that Best Practice for DNS records is to use *24 hour* TTLs
as the minimum. Shorter times are provided to allow for clean server
migrations, not for load balancing. RRset rotation is for DNS load
balancing, is enabled in most resolvers by default and does not require
short TTLs to operate. It is also compatible with the behaviour of load
balancing mechanisms in every protocol from TCP itself up the stack (ie
they are designed to account for rotation, not for widespread abusive TTLs).


Since you ask;

One reason Squid sets a minimum is that extremely short TTLs in DNS
conflicts directly with both HTTP persistence mechanisms and the load
balancing performed by Squid itself. The default ensures that for any
given server IP Squid can re-use persistent connections to it for ~60
seconds.

NP: These services are actually *worsening* their service times. Squid
and numerous other middleware now has to ignore already setup and
perfectly usable connections in order to perform several entire TCP (and
TLS) handshake processes all over again for the changed IPs.


Another (which no longer applies) was that Squid used to base each new
retry attempt on new DNS record lookup. If the RRset changed on every
retry it could end up trying the same IP from a large set N times in a
row and failing when a different IP from the same RRset would be fine.
 Current Squid do a single lookup and only retry the IPs found there
(think about what that means for TTL). This was explicitly to workaround
and counter the breakages caused by those servers you mention doing
short TTLs.

Consider, what would you expect to happen when DNS RRset changes
_multiple_ times within the same TTL that TCP uses for a SYN-ACK timeout
and retry?



&gt;<i> [1] <A HREF="https://tools.ietf.org/html/rfc2181#section-8">https://tools.ietf.org/html/rfc2181#section-8</A>
</I>&gt;<i> &lt;<A HREF="https://tools.ietf.org/html/rfc2181#section-8">https://tools.ietf.org/html/rfc2181#section-8</A>&gt;
</I>&gt;<i> [2] <A HREF="https://tools.ietf.org/html/rfc1035#section-3.2.1">https://tools.ietf.org/html/rfc1035#section-3.2.1</A>
</I>&gt;<i> &lt;<A HREF="https://tools.ietf.org/html/rfc1035#section-3.2.1">https://tools.ietf.org/html/rfc1035#section-3.2.1</A>&gt;
</I>&gt;<i> [3] <A HREF="https://tools.ietf.org/html/rfc7719#section-4">https://tools.ietf.org/html/rfc7719#section-4</A>
</I>&gt;<i> &lt;<A HREF="https://tools.ietf.org/html/rfc1035#section-3.2.1">https://tools.ietf.org/html/rfc1035#section-3.2.1</A>&gt;
</I>
Which states:
 &quot;Some servers are known to ignore the TTL on some RRsets (such as when
the authoritative data has a very short TTL)&quot;.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018053.html">[squid-users] Squid ipcache and DNS TTL smaller than 60 seconds
</A></li>
	<LI>Next message (by thread): <A HREF="018058.html">[squid-users] Squid ipcache and DNS TTL smaller than 60 seconds
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18055">[ date ]</a>
              <a href="thread.html#18055">[ thread ]</a>
              <a href="subject.html#18055">[ subject ]</a>
              <a href="author.html#18055">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
