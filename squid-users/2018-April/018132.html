<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Multiple responses in cache objects
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Multiple%20responses%20in%20cache%20objects&In-Reply-To=%3C557634c9-2795-6ac6-97c8-1e1c5ab70a0f%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018131.html">
   <LINK REL="Next"  HREF="018140.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Multiple responses in cache objects</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Multiple%20responses%20in%20cache%20objects&In-Reply-To=%3C557634c9-2795-6ac6-97c8-1e1c5ab70a0f%40treenet.co.nz%3E"
       TITLE="[squid-users] Multiple responses in cache objects">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Apr 23 14:20:18 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018131.html">[squid-users] Multiple responses in cache objects
</A></li>
        <LI>Next message (by thread): <A HREF="018140.html">[squid-users] Multiple responses in cache objects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18132">[ date ]</a>
              <a href="thread.html#18132">[ thread ]</a>
              <a href="subject.html#18132">[ subject ]</a>
              <a href="author.html#18132">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 24/04/18 00:43, Tobias Wolter wrote:
&gt;<i> Cheers,
</I>&gt;<i> 
</I>&gt;<i> I'm having some pretty weird issues with a customer's squid
</I>&gt;<i> installation - we're seeing multiple responses in a single cache
</I>&gt;<i> object.
</I>&gt;<i> 
</I>
Please note the:

&gt;<i> X-Transformed-From: HTTP/0.9
</I>
... in your example cached objects.

Squid should not be caching these. Which implies that a) you have some
config settings forcing things to cache when they are not supposed to,
and b) either upstream server or client is broken.


 * do you have any refresh_pattern rules forcing it to do so?

 * what version of Squid are you running?

 * have you tried the latest Squid version?
 there have been a few fixes in detection this protocol version for Squid-4.


&gt;<i> Sadly, this isn't a singular incident and seems to be happening more
</I>&gt;<i> often recently. We've rolled back all changes since the date people
</I>&gt;<i> first started noticing the issues, but it still hasn't helped.
</I>&gt;<i> 
</I>&gt;<i> This occasionally leads to e.g. fragged CSS files, which users see by
</I>&gt;<i> the way of the stylesheet not working.
</I>&gt;<i> 
</I>&gt;<i> I'm currently out of debugging ideas. Aside from the rollback, we've
</I>&gt;<i> thus far isolated it to the Squid; the Apache which is the originserver
</I>&gt;<i> for this successfully returns the correct site.
</I>

Squid is apparently receiving HTTP/0.9 response objects (a raw data
stream of octets) not HTTP 1.0 or 1.1 objects (stream of messages with
specific start and end points to each message object).


How do you determine that &quot;successful&quot; for the server?
 using any tool that hides away the protocols octet-level format details
 (eg curl, wget, browser, etc) can hide the HTTP/0.9 oddity from view.

Locate the URL which was originally requested by the client. The first
line of the cache file should be a single byte representing the
request-method, then the URL in plain-text ending with newline (\n). Use
squidclient to fetch that URL directly from the server like so:

  squidclient -h example.com -p 80 -V &quot;-&quot; <A HREF="http://example.com/">http://example.com/</A>




This is what a normal HTTP/1.x response message is supposed to look like:

( from &quot;squidclient -h example.com -p 80 /&quot; )

&quot;
HTTP/1.0 404 Not Found
Content-Type: text/html
Date: Mon, 23 Apr 2018 13:56:18 GMT
Server: ECS (oxr/837F)
Content-Length: 345
Connection: close

&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot;?&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
         &quot;<A HREF="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</A>&quot;&gt;
&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xml:lang=&quot;en&quot; lang=&quot;en&quot;&gt;
	&lt;head&gt;
		&lt;title&gt;404 - Not Found&lt;/title&gt;
	&lt;/head&gt;
	&lt;body&gt;
		&lt;h1&gt;404 - Not Found&lt;/h1&gt;
	&lt;/body&gt;
&lt;/html&gt;
&quot;

And this is what your cache file 000255F5 says Squid is receiving from
the upstream server (for the URL you should see in the very start of
that 000255F5 file):

&quot;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
&quot;<A HREF="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</A>&quot;&gt;;
&lt;html&gt;
        &lt;head&gt;
                &lt;script type=&quot;text/javascript&quot;&gt;var contextPath =
'';&lt;/script&gt;

                &lt;script type=&quot;text/javascript&quot;
src=&quot;/js/jquery-1.11.2.min.js&quot;&gt;&lt;/script&gt;
            &lt;script type=&quot;text/javascript&quot; src=&quot;/js/layer.js&quot;&gt;&lt;/script&gt;
                &lt;script type=&quot;text/javascript&quot;
src=&quot;/js/jquery.colorbox-1.5.15.min.js&quot;&gt;&lt;/script&gt;
                &lt;script type=&quot;text/javascript&quot;
src=&quot;/js/cookies.js&quot;&gt;&lt;/script&gt;
...
&quot;

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018131.html">[squid-users] Multiple responses in cache objects
</A></li>
	<LI>Next message (by thread): <A HREF="018140.html">[squid-users] Multiple responses in cache objects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18132">[ date ]</a>
              <a href="thread.html#18132">[ thread ]</a>
              <a href="subject.html#18132">[ subject ]</a>
              <a href="author.html#18132">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
