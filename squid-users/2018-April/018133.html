<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid returns 400 to GET / HTTP/1.1 with Host Header
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20returns%20400%20to%20GET%20/%20HTTP/1.1%20with%20Host%20Header&In-Reply-To=%3CCABqtqVRha%2BfWwkkakTiWhZM3Le0SoVE2aob8gmFbzdW4XdU44Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018148.html">
   <LINK REL="Next"  HREF="018134.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid returns 400 to GET / HTTP/1.1 with Host Header</H1>
    <B>Stephen Nelson-Smith</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20returns%20400%20to%20GET%20/%20HTTP/1.1%20with%20Host%20Header&In-Reply-To=%3CCABqtqVRha%2BfWwkkakTiWhZM3Le0SoVE2aob8gmFbzdW4XdU44Q%40mail.gmail.com%3E"
       TITLE="[squid-users] Squid returns 400 to GET / HTTP/1.1 with Host Header">sanelson at gmail.com
       </A><BR>
    <I>Mon Apr 23 15:15:13 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018148.html">[squid-users] [SOLVED-ish] Multiple responses in cache objects
</A></li>
        <LI>Next message (by thread): <A HREF="018134.html">[squid-users] Squid returns 400 to GET / HTTP/1.1 with Host Header
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18133">[ date ]</a>
              <a href="thread.html#18133">[ thread ]</a>
              <a href="subject.html#18133">[ subject ]</a>
              <a href="author.html#18133">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I need to demonstrate and test a Squid setup, which should blacklist
by default, and allow requests only to whitelisted URLs from known
networks. This is currently running in my staging environment, and is
working as expected, but I want to test and demo it on demand, with
nicer feedback than with curl.

I've deployed Redbot (<A HREF="https://github.com/mnot/redbot">https://github.com/mnot/redbot</A>), which I've set
up to send all HTTP requests via the Squid proxy

Using curl -x from the Redbot machine, all my tests pass, but using
the application, Squid returns a 400 whatever happens. All requests go
to Squid, and I see every request, but instead of returning a 403 and
X-Squid-Error: ERR_ACCESS_DENIED 0, or allowing the request, every
request gets a 400, and X-Squid-Error: ERR_INVALID_URL 0.

Digging into it - logs and tcpdump - the key difference I see is that
Redbot sends a request of the form:

GET / HTTP/1.1
Host: chess.com

Curl sends:

GET <A HREF="http://chess.com/">http://chess.com/</A> HTTP/1.1
Host: chess.com

&gt;<i>From the RFC it seems like Redbot's request is perfectly valid, and so
</I>I feel like Squid should do the right thing and deduce from the host
header what Redbot wants, and go through its ACLs. However, it just
errors with:

HTTP/1.1 400 Bad Request
Server: squid/3.5.27
Mime-Version: 1.0
Date: Mon, 23 Apr 2018 11:50:23 GMT
Content-Type: text/html;charset=utf-8
Content-Length: 3465
X-Squid-Error: ERR_INVALID_URL 0
X-Cache: MISS from proxy.redaction.com
Via: 1.1 proxy.redaction.com (squid/3.5.27)

Does this seem like a Squid config issue? Or do I need to make Redbot
make a request like Curl does?

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018148.html">[squid-users] [SOLVED-ish] Multiple responses in cache objects
</A></li>
	<LI>Next message (by thread): <A HREF="018134.html">[squid-users] Squid returns 400 to GET / HTTP/1.1 with Host Header
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18133">[ date ]</a>
              <a href="thread.html#18133">[ thread ]</a>
              <a href="subject.html#18133">[ subject ]</a>
              <a href="author.html#18133">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
