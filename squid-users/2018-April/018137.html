<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Squid returns 400 to GET / HTTP/1.1 with Host Header
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20returns%20400%20to%20GET%20/%20HTTP/1.1%20with%20Host%0A%20Header&In-Reply-To=%3Cffc16fdc-bc83-e0bf-f019-b520026e51db%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018136.html">
   <LINK REL="Next"  HREF="018138.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Squid returns 400 to GET / HTTP/1.1 with Host Header</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Squid%20returns%20400%20to%20GET%20/%20HTTP/1.1%20with%20Host%0A%20Header&In-Reply-To=%3Cffc16fdc-bc83-e0bf-f019-b520026e51db%40treenet.co.nz%3E"
       TITLE="[squid-users] Squid returns 400 to GET / HTTP/1.1 with Host Header">squid3 at treenet.co.nz
       </A><BR>
    <I>Mon Apr 23 16:58:46 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018136.html">[squid-users] Squid returns 400 to GET / HTTP/1.1 with Host	Header
</A></li>
        <LI>Next message (by thread): <A HREF="018138.html">[squid-users] Squid returns 400 to GET / HTTP/1.1 with Host	Header
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18137">[ date ]</a>
              <a href="thread.html#18137">[ thread ]</a>
              <a href="subject.html#18137">[ subject ]</a>
              <a href="author.html#18137">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 24/04/18 04:03, Stephen Nelson-Smith wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> On Mon, Apr 23, 2018 at 4:48 PM, Stephen Nelson-Smith wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> Adding that functionality would be an option,
</I>
I think that is worth asking Mark Nottingham about adding that
functionality.


&gt;&gt;<i> but am I right in
</I>&gt;&gt;<i> thinking squid should be able to infer the destination from the host
</I>&gt;&gt;<i> header?
</I>
No, that is rather dangerous. The CVE-2009-0801 and related nest of
vulnerabilities are opened up if Host header is trusted by a proxy.


&gt;&gt;<i>
</I>&gt;&gt;<i> Just looking at the documentation for http_port, would adding
</I>&gt;&gt;<i> 'intercept' help, or is that explicitly for interception caching in
</I>&gt;&gt;<i> conjunction with a traffic filter?
</I>&gt;<i> 
</I>&gt;<i> Adding `intercept` to `http_port` has resulted in the host header
</I>&gt;<i> appearing as the URL in the request.
</I>&gt;<i> 
</I>&gt;<i> Squid is now giving a 403... which it shouldn't... I think:
</I>&gt;<i> 
</I>&gt;<i> 1524498993.558      0 10.8.0.33 TCP_MISS/403 3985 GET
</I>&gt;<i> <A HREF="http://www.openstreetmap.com/">http://www.openstreetmap.com/</A> - HIER_NONE/- text/html
</I>&gt;<i> 1524498993.559      0 10.8.2.19 TCP_MISS/403 4077 GET
</I>&gt;<i> <A HREF="http://www.openstreetmap.com/">http://www.openstreetmap.com/</A> - ORIGINAL_DST/10.8.0.33 text/html
</I>&gt;<i> 
</I>
That is the CVE-2009-0801 protections doing their thing for intercept'ed
traffic (second log line). The 10.8.0.33 IP is where the client was
apparently going before MITM'd into the proxy, so the server there MUST
be able to handle whatever the client is expecting back regardless of
whether the proxy trusts it for caching purposes.

But 10.8.0.33 is your Squid, so the traffic loops (first log line).
Squid detects the loop and rejects it to prevent infinite memory and TCP
port numbers being consumed.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018136.html">[squid-users] Squid returns 400 to GET / HTTP/1.1 with Host	Header
</A></li>
	<LI>Next message (by thread): <A HREF="018138.html">[squid-users] Squid returns 400 to GET / HTTP/1.1 with Host	Header
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18137">[ date ]</a>
              <a href="thread.html#18137">[ thread ]</a>
              <a href="subject.html#18137">[ subject ]</a>
              <a href="author.html#18137">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
