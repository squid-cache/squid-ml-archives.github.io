<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [squid-users] Bypass HSTS sites in squid?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Bypass%20HSTS%20sites%20in%20squid%3F&In-Reply-To=%3Ce491cb84-38fb-65c2-ecde-1283744b0b21%40treenet.co.nz%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018166.html">
   <LINK REL="Next"  HREF="018167.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[squid-users] Bypass HSTS sites in squid?</H1>
    <B>Amos Jeffries</B> 
    <A HREF="mailto:squid-users%40lists.squid-cache.org?Subject=Re%3A%20%5Bsquid-users%5D%20Bypass%20HSTS%20sites%20in%20squid%3F&In-Reply-To=%3Ce491cb84-38fb-65c2-ecde-1283744b0b21%40treenet.co.nz%3E"
       TITLE="[squid-users] Bypass HSTS sites in squid?">squid3 at treenet.co.nz
       </A><BR>
    <I>Sat Apr 28 23:09:59 UTC 2018</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="018166.html">[squid-users] Bypass HSTS sites in squid?
</A></li>
        <LI>Next message (by thread): <A HREF="018167.html">[squid-users] Squid 4 %R in deny_info
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18168">[ date ]</a>
              <a href="thread.html#18168">[ thread ]</a>
              <a href="subject.html#18168">[ subject ]</a>
              <a href="author.html#18168">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 29/04/18 07:22, Matthias Eder wrote:
&gt;<i> I have set up after along struggle a transparent proxy with squid,
</I>&gt;<i> squidguard and privoxy. This works quite fine, surprisingly also for
</I>&gt;<i> https sites. Unfortunately the performance is not too good, but I guess
</I>&gt;<i> the man-in-the-middle attack is quite a lot of work for squid ;-).
</I>&gt;<i> Before anyone is complaining: this is for my private network at home and
</I>&gt;<i> this is more or less part of a project to set up a home router and learn
</I>&gt;<i> a little bit of this stuff :-).
</I>&gt;<i> 
</I>&gt;<i> Anyway, here is the problem where I am stuck at the moment: as mentioned
</I>&gt;<i> connection to most of the https sites works without problems, but I
</I>&gt;<i> guess connection to sites with public key pinning (HSTS...?) gives me a
</I>
FYI: Current Squid releases all erase HSTS headers from traffic which
gets decrypted. So for HSTS to have any effect the Browsers need to be
fetching content without the proxy knowing about it. eg old HSTS details
received before they started use the proxy.


&gt;<i> SSL_ERROR_BAD_CERT_DOMAIN error in Firefox; here i can't add an
</I>&gt;<i> exception for this site (e.g. in my case <A HREF="https://ubuntuusers.de/">https://ubuntuusers.de/</A>). After
</I>&gt;<i> some googling it seems that there is no way that squid could &quot;break&quot;
</I>&gt;<i> into this connection, so the question is: is there any way to exclude or
</I>&gt;<i> bypass some sites so that the proxy is not used? I guess the difficulty
</I>&gt;<i> may be the https here...
</I>
Connections that cannot (or you do not want to be) bump'ed is what the
SSL-Bump &quot;splice&quot; action is for. If you do not have a Squid accepting
that action you urgently need to upgrade.


Also, SG re-writes the URLs (including domain) of HTTP(S) traffic it
gets asked about. Naturally if it changes the domain for messages they
will no longer have the &quot;old&quot; domain which was linked explicitly to the
X.509 certificate the client was given by TLS. Some servers tolerate
that, some do not. This is one of many reasons SG (and re-writers in
general) should not be used, especially with HTTPS traffic.

Amos

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="018166.html">[squid-users] Bypass HSTS sites in squid?
</A></li>
	<LI>Next message (by thread): <A HREF="018167.html">[squid-users] Squid 4 %R in deny_info
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18168">[ date ]</a>
              <a href="thread.html#18168">[ thread ]</a>
              <a href="subject.html#18168">[ subject ]</a>
              <a href="author.html#18168">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.squid-cache.org/listinfo/squid-users">More information about the squid-users
mailing list</a><br>
</body></html>
